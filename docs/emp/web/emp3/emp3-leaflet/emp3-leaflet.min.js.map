{"version":3,"sources":["../../../src/mapengine/leaflet/js/lib/leaflet-src.js","../../../src/mapengine/leaflet/js/lib/KML.js","../../../src/mapengine/leaflet/js/lib/leaflet.markercluster-src.js","../../../src/mapengine/leaflet/js/utils/emp.typeLibrary.utils.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.js","../../../src/mapengine/leaflet/js/lib/leaflet-eng.leaflet.extensions.js","../../../src/mapengine/leaflet/js/lib/KML.extensions.js","../../../src/mapengine/leaflet/js/lib/leaflet-eng.markerCluster.extensions.js","../../../src/mapengine/leaflet/js/lib/leaflet-eng.leaflet.extension.Ellipse.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.selectionManager.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.empObject.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.DisplayableObject.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.EmpClusterGroup.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.overlay.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.wms.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.EmpBoundary.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.milstd.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.kml.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.geojson.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.airspace.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.image.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.AOI.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.milstdmodifiers.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.text.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.GeoRectangle.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.GeoSquare.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.GeoCircle.js","../../../src/mapengine/leaflet/js/typeLibrary/leaflet-eng.typeLibrary.feature.GeoEllipse.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.attributes.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.cylinder.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.polygon.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.curtain.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.orbit.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.route.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.track.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.radarc.js","../../../src/mapengine/leaflet/js/typeLibrary/airspace/leaflet-eng.typeLibrary.airspace.polyarc.js","../../../src/mapengine/leaflet/js/utils/leaflet-eng.utils.js","../../../src/mapengine/leaflet/js/utils/leaflet-eng.utils.geoJson.js","../../../src/mapengine/leaflet/js/utils/leaflet-eng.utils.milstd.js","../../../src/mapengine/leaflet/js/utils/leaflet-eng.utils.kml.js","../../../src/mapengine/leaflet/js/utils/leaflet-eng.utils.airspace.js","../../../src/mapengine/leaflet/js/utils/leaflet-eng.utils.oval.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.controlpoint.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.AbstractEditor.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.GeoJson.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.MilStd.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.AOI.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.KML.js","../../../src/mapengine/leaflet/js/editor/leaflet-eng.editor.airspace.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcautoshape.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dccircularautoshape.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dccircularrangefan.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcline.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcpolygon.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcrectparamautoshape.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcroute.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcsectorparamautoshape.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dcsuperautoshape.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dctwopointline.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.dctwopointrectas.js","../../../src/mapengine/leaflet/js/editor/milstd/leaflet-eng.editor.milstd.singlepoint.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.curtain.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.polygon.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.cylinder.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.orbit.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.route.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.track.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.radarc.js","../../../src/mapengine/leaflet/js/editor/airspace/leaflet-eng.editor.airspace.polyarc.js","../../../src/mapengine/leaflet/js/leaflet-map-engine.debug.js"],"names":["window","document","undefined","oldL","L","version","noConflict","this","Util","extend","dest","i","j","len","src","sources","Array","prototype","slice","call","arguments","length","hasOwnProperty","bind","fn","obj","args","apply","stamp","lastId","key","invokeEach","method","context","concat","limitExecByInterval","time","lock","execOnUnlock","wrapperFn","setTimeout","falseFn","formatNum","num","digits","pow","Math","round","trim","str","replace","splitWords","split","setOptions","options","getParamString","existingUrl","uppercase","params","push","encodeURIComponent","toUpperCase","indexOf","join","template","data","value","Error","isArray","Object","toString","emptyImageUrl","getPrefixed","name","prefixes","timeoutDefer","Date","timeToCall","max","lastTime","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","id","clearTimeout","requestAnimFrame","immediate","element","cancelAnimFrame","Class","props","NewClass","initialize","_initHooks","callInitHooks","F","proto","constructor","statics","includes","parent","__super__","_initHooksCalled","include","mergeOptions","addInitHook","init","eventsKey","Mixin","Events","addEventListener","types","event","type","indexKey","indexLenKey","typeIndex","events","contextId","action","hasEventListeners","removeEventListener","clearAllEventListeners","listeners","removed","splice","fireEvent","target","addOneTimeEventListener","handler","on","off","once","fire","ie","ielt9","ua","navigator","userAgent","toLowerCase","webkit","chrome","phantomjs","android","android23","search","gecko","mobile","orientation","msPointer","msPointerEnabled","msMaxTouchPoints","PointerEvent","pointer","pointerEnabled","maxTouchPoints","retina","devicePixelRatio","matchMedia","matches","doc","documentElement","ie3d","style","webkit3d","WebKitCSSMatrix","gecko3d","opera3d","any3d","L_DISABLE_3D","touch","L_NO_TOUCH","startName","div","createElement","supported","setAttribute","removeAttribute","Browser","opera","mobileWebkit","mobileWebkit3d","mobileOpera","Point","x","y","clone","add","point","_add","subtract","_subtract","divideBy","_divideBy","multiplyBy","_multiplyBy","_round","floor","_floor","distanceTo","sqrt","equals","contains","abs","Bounds","a","b","points","min","getCenter","getBottomLeft","getTopRight","getSize","bounds","intersects","min2","max2","xIntersects","yIntersects","isValid","Transformation","c","d","_a","_b","_c","_d","transform","scale","_transform","untransform","DomUtil","get","getElementById","getStyle","el","currentStyle","defaultView","css","getComputedStyle","getViewportOffset","pos","top","left","docBody","body","docEl","offsetTop","offsetLeft","parseInt","offsetParent","scrollTop","scrollLeft","width","maxWidth","r","getBoundingClientRect","clientLeft","parentNode","documentIsLtr","_docIsLtrCached","_docIsLtr","create","tagName","className","container","appendChild","hasClass","classList","_getClass","RegExp","test","addClass","classes","_setClass","removeClass","remove","baseVal","setOpacity","opacity","filter","filterName","filters","item","e","Enabled","Opacity","testProp","getTranslateString","is3d","open","close","getScaleString","origin","preTranslateStr","scaleStr","setPosition","disable3D","_leaflet_pos","TRANSFORM","getPosition","TRANSITION","TRANSITION_END","disableTextSelection","DomEvent","preventDefault","enableTextSelection","userSelectProperty","_userSelect","disableImageDrag","enableImageDrag","LatLng","lat","lng","alt","parseFloat","isNaN","DEG_TO_RAD","PI","RAD_TO_DEG","MAX_MARGIN","latLng","margin","precision","other","R","d2r","dLat","dLon","lat1","lat2","sin1","sin","sin2","cos","atan2","wrap","lon","LatLngBounds","southWest","northEast","latlngs","latLngBounds","_southWest","_northEast","pad","bufferRatio","sw","ne","heightBuffer","widthBuffer","getSouthWest","getNorthEast","getNorthWest","getNorth","getWest","getSouthEast","getSouth","getEast","sw2","ne2","latIntersects","lngIntersects","toBBoxString","Projection","SphericalMercator","MAX_LATITUDE","project","latlng","log","tan","unproject","atan","exp","LonLat","CRS","latLngToPoint","zoom","projectedPoint","projection","transformation","pointToLatLng","untransformedPoint","s","Simple","EPSG3857","code","earthRadius","EPSG900913","EPSG4326","Map","crs","fadeAnimation","trackResize","markerZoomAnimation","_initContainer","_initLayout","_onResize","_initEvents","maxBounds","setMaxBounds","center","setView","reset","_handlers","_layers","_zoomBoundLayers","_tileLayersNum","_addLayers","layers","getZoom","_resetView","_limitZoom","setZoom","_loaded","_zoom","zoomIn","delta","zoomOut","setZoomAround","getZoomScale","viewHalf","containerPoint","latLngToContainerPoint","centerOffset","newCenter","containerPointToLatLng","fitBounds","getBounds","paddingTL","paddingTopLeft","padding","paddingBR","paddingBottomRight","getBoundsZoom","paddingOffset","swPoint","nePoint","maxZoom","fitWorld","panTo","pan","panBy","offset","_rawPanBy","_panInsideMaxBounds","panInsideBounds","_limitCenter","addLayer","layer","minZoom","_updateZoomLevels","zoomAnimation","TileLayer","_tileLayersToLoad","_onTileLayerLoad","_layerAdd","removeLayer","onRemove","hasLayer","eachLayer","invalidateSize","animate","oldSize","_sizeChanged","_initialCenter","newSize","oldCenter","debounceMoveend","_sizeTimer","addHandler","HandlerClass","enable","_container","_leaflet","_clearPanes","_clearControlPos","_clearHandlers","_checkIfLoaded","_moved","layerPointToLatLng","_getCenterLayerPoint","getPixelBounds","getMinZoom","_layersMinZoom","getMaxZoom","_layersMaxZoom","Infinity","inside","boundsSize","size","nw","se","zoomNotFound","_size","clientWidth","clientHeight","topLeftPoint","_getTopLeftPoint","getPixelOrigin","_initialTopLeftPoint","getPanes","_panes","getContainer","toZoom","getScaleZoom","LN2","latLngToLayerPoint","containerPointToLayerPoint","_getMapPanePos","layerPointToContainerPoint","layerPoint","mouseEventToContainerPoint","getMousePosition","mouseEventToLayerPoint","mouseEventToLatLng","position","_initPanes","_initControlPos","panes","_mapPane","mapPane","_createPane","_tilePane","tilePane","objectsPane","shadowPane","overlayPane","markerPane","popupPane","zoomHide","removeChild","preserveMapOffset","afterZoomAnim","zoomChanged","_getNewTopLeftPoint","loading","hard","_getZoomSpan","oldZoomSpan","onOff","_onMouseClick","_fireMouseEvent","_resizeRequest","_simulated","dragging","moved","boxZoom","_skipped","originalEvent","disable","whenReady","callback","onAdd","_latLngToNewLayerPoint","newZoom","topLeft","_getCenterOffset","centerPoint","viewBounds","_getBoundsOffset","_limitOffset","newBounds","pxBounds","nwOffset","seOffset","dx","_rebound","dy","right","ceil","map","Mercator","R_MINOR","R_MAJOR","r2","tmp","eccent","con","ts","phi","numIter","tol","dphi","EPSG3395","m","tileSize","subdomains","errorTileUrl","attribution","zoomOffset","unloadInvisibleTiles","updateWhenIdle","url","detectRetina","_url","_map","_animated","_zoomAnimated","viewreset","_reset","moveend","_update","zoomanim","_animateZoom","zoomend","_endZoomAnim","_limitedUpdate","addTo","bringToFront","pane","_setAutoZIndex","bringToBack","insertBefore","firstChild","getAttribution","_updateOpacity","setZIndex","zIndex","_updateZIndex","setUrl","noRedraw","redraw","compare","children","edgeZIndex","isFinite","tiles","_tiles","_bgBuffer","_tileContainer","tile","_tilesToLoad","reuseTiles","_unusedTiles","innerHTML","_clearBgBuffer","_getTileSize","zoomN","maxNativeZoom","tileBounds","_addTilesFromCenterOut","_removeOtherTiles","queue","_tileShouldBeLoaded","tilesToLoad","sort","fragment","createDocumentFragment","_addTile","tilePoint","continuousWorld","limit","_getWrapTileNum","noWrap","nwPoint","sePoint","kArr","_removeTile","onload","tilePos","_getTilePos","_getTile","_loadTile","_getZoomForUrl","zoomReverse","getTileUrl","_getSubdomain","z","_adjustTilePoint","tms","index","pop","_resetTile","_createTile","height","galleryimg","onselectstart","onmousemove","WebkitBackfaceVisibility","_layer","_tileOnLoad","onerror","_tileOnError","_tileLoaded","_clearBgBufferTimer","newUrl","tileLayer","WMS","defaultWmsParams","service","request","styles","format","transparent","wmsParams","_crs","_wmsVersion","projectionKey","bbox","setParams","wms","Canvas","async","_redrawTile","drawTile","_tilePoint","tileDrawn","canvas","ImageOverlay","_bounds","_image","_initImage","_onImageLoad","image","imageOverlay","Icon","createIcon","oldIcon","_createIcon","createShadow","_getIconUrl","img","_createImg","_setIconStyles","anchor","shadowAnchor","iconAnchor","marginLeft","marginTop","icon","Default","iconSize","popupAnchor","shadowSize","path","imagePath","scripts","getElementsByTagName","leafletRe","match","Marker","title","clickable","draggable","keyboard","zIndexOffset","riseOnHover","riseOffset","_latlng","update","_initIcon","_removeIcon","_removeShadow","getLatLng","setLatLng","setZIndexOffset","setIcon","_popup","bindPopup","_icon","_setPos","animation","classToAdd","addIcon","tabIndex","_initInteraction","_bringToFront","_resetZIndex","newShadow","_shadow","addShadow","_zIndex","opt","_onKeyPress","Handler","MarkerDrag","wasDragged","stopPropagation","_enabled","keyCode","marker","DivIcon","html","bgPos","backgroundPosition","divIcon","closePopupOnClick","Popup","minWidth","autoPan","closeButton","autoPanPadding","keepInView","source","_source","_isOpen","animFade","_getEvents","popup","openOn","openPopup","offsetWidth","_updatePosition","_adjustPan","getContent","_content","setContent","content","visibility","_updateContent","_updateLayout","_zoomAnimation","closeOnClick","preclick","_close","closePopup","prefix","containerClass","_closeButton","href","disableClickPropagation","_onCloseButtonClick","wrapper","_wrapper","_contentNode","disableScrollPropagation","_tipContainer","_tip","hasChildNodes","whiteSpace","offsetHeight","maxHeight","scrolledClass","_containerWidth","animated","_containerBottom","_containerLeft","bottom","containerHeight","containerWidth","layerPos","containerPos","autoPanPaddingTopLeft","autoPanPaddingBottomRight","stop","togglePopup","_popupHandlersAdded","_movePopup","setPopupContent","unbindPopup","getPopup","LayerGroup","getLayerId","clearLayers","invoke","methodName","getLayer","getLayers","layerGroup","FeatureGroup","EVENTS","_propagateEvent","_popupContent","_popupOptions","setStyle","featureGroup","Path","CLIP_PADDING","outerWidth","outerHeight","stroke","color","dashArray","lineCap","lineJoin","weight","fill","fillColor","fillOpacity","_initElements","projectLatlngs","_updatePath","_pathRoot","vml","_stroke","_fill","_updateStyle","_updatePathViewport","p","panePos","_pathViewport","SVG_NS","svg","createElementNS","createSVGRect","SVG","root","lastChild","first","getPathString","_createElement","_initPathRoot","_initPath","_initStyle","_path","pointerEvents","_animatePathZoom","_endPathZoom","_updateSvgViewport","_pathZooming","vp","_openPopup","_latlngs","shape","behavior","adj","VML","namespaces","coordsize","stroked","filled","endcap","dashStyle","joinstyle","display","v","getContext","L_PREFER_CANVAS","CANVAS","_requestUpdate","_onClick","_onMouseMove","_updateRequest","_fireMapMoveEnd","_ctx","_canvasCtx","lineWidth","strokeStyle","fillStyle","_drawPath","len2","drawMethod","beginPath","_parts","Polygon","closePath","_checkIfEmpty","ctx","save","globalAlpha","restore","_containsPoint","_animatingZoom","cursor","_mouseInside","_updateCanvasViewport","translate","LineUtil","simplify","tolerance","sqTolerance","_reducePoints","_simplifyDP","pointToSegmentDistance","p1","p2","_sqClosestPointOnSegment","closestPointOnSegment","ArrayConstructor","Uint8Array","markers","_simplifyDPStep","newPoints","last","sqDist","maxSqDist","reducedPoints","prev","_sqDist","clipSegment","useLastCode","codeOut","newCode","codeA","_lastCode","_getBitCode","codeB","_getEdgeIntersection","t","dot","Polyline","_convertLatLngs","smoothFactor","noClip","_originalPoints","_getPathPartStr","getLatLngs","setLatLngs","addLatLng","spliceLatLngs","closestLayerPoint","minDistance","parts","minPoint","jLen","distance","overwrite","_clipPoints","k","segment","lu","_simplifyPoints","polyline","PolyUtil","clipPolygon","clippedPoints","edge","edges","_code","_initWithHoles","hole","_holes","_holePoints","newParts","clipped","polygon","createMulti","Klass","_options","MultiPolyline","MultiPolygon","multiPolyline","multiPolygon","Rectangle","_boundsToLatLngs","setBounds","rectangle","Circle","radius","_mRadius","setRadius","lngRadius","_getLngRadius","pointLeft","_point","_radius","latRadius","getRadius","_getLatRadius","circle","CircleMarker","circleMarker","closed","dist","part","w","arc","w2","GeoJSON","geojson","addData","feature","features","geometries","geometry","coordinates","geometryToLayer","pointToLayer","coordsToLatLng","asFeature","defaultOptions","resetStyle","onEachFeature","_setLayerStyle","vectorOptions","coords","coordsToLatLngs","properties","levelsDeep","latLngToCoords","latLngsToCoords","latLngs","getFeature","newGeometry","geoJSON","PointToGeoJSON","toGeoJSON","multiToGeoJSON","json","jsons","isGeometryCollection","geoJson","addListener","originalHandler","newType","_getEvent","addPointerListener","addDoubleTapListener","_checkMouse","_filterClick","attachEvent","removeListener","removePointerListener","removeDoubleTapListener","detachEvent","cancelBubble","Draggable","START","_fakeStop","returnValue","clientX","clientY","rect","clientTop","getWheelDelta","wheelDelta","detail","_skipEvents","skipped","related","relatedTarget","err","caller","callee","Event","timeStamp","elapsed","_lastClick","_simulatedClick","END","mousedown","touchstart","pointerdown","MSPointerDown","MOVE","dragStartTarget","_element","_dragStartTarget","_onDown","shiftKey","which","button","touches","_disabled","_moving","_startPoint","_startPos","_newPos","_onMove","_onUp","newPoint","_lastTarget","srcElement","_animRequest","addHooks","removeHooks","enabled","inertia","inertiaDeceleration","inertiaMaxSpeed","inertiaThreshold","easeLinearity","worldCopyJump","Drag","_draggable","dragstart","_onDragStart","drag","_onDrag","dragend","_onDragEnd","_onPreDrag","_onViewReset","_panAnim","_positions","_times","_lastTime","_lastPos","shift","pxCenter","pxWorldCenter","_initialWorldOffset","_worldWidth","worldWidth","halfWidth","newX1","newX2","newX","delay","noInertia","direction","duration","ease","speedVector","speed","limitedSpeed","limitedSpeedVector","decelerationDuration","noMoveStart","doubleClickZoom","DoubleClickZoom","_onDoubleClick","scrollWheelZoom","ScrollWheelZoom","_onWheelScroll","_delta","_lastMousePos","_startTime","_timer","_performZoom","_touchstart","_touchend","onTouchStart","count","trackedTouches","pointerId","now","doubleTap","onTouchEnd","idx","prop","newTouch","pre","touchend","endElement","POINTER_CANCEL","POINTER_DOWN","POINTER_MOVE","POINTER_UP","_pointers","_pointerDocumentListener","addPointerListenerStart","addPointerListenerEnd","addPointerListenerMove","pointers","cb","alreadyInArray","changedTouches","internalCb","pointerType","MSPOINTER_TYPE_MOUSE","buttons","touchZoom","bounceAtZoomLimits","TouchZoom","_onTouchStart","_zooming","viewCenter","_startCenter","_startDist","_centerOffset","_onTouchMove","_onTouchEnd","_scale","_updateOnMove","_getScaleOrigin","oldZoom","floatZoomDelta","roundZoomDelta","tap","tapTolerance","Tap","_fireClick","_holdTimeout","_isTapValid","_simulateEvent","simulatedEvent","createEvent","initMouseEvent","screenX","screenY","dispatchEvent","BoxZoom","_pane","_onMouseDown","_startLayerPoint","_onMouseUp","_onKeyDown","_box","startPoint","box","newPos","_finish","boxZoomBounds","keyboardPanOffset","keyboardZoomOffset","Keyboard","keyCodes","down","up","_setPanOffset","_setZoomOffset","_onFocus","_onBlur","_addHooks","_removeHooks","_focused","focus","scrollTo","keys","_panKeys","codes","_zoomKeys","_inProgress","_marker","shadow","iconPos","Control","removeControl","addControl","corner","_controlCorners","removeFrom","_refocusOnMap","control","createCorner","vSide","hSide","l","corners","_controlContainer","Zoom","zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","zoomName","_zoomInButton","_createButton","_zoomIn","_zoomOutButton","_zoomOut","_updateDisabled","link","zoomControl","Attribution","_attributions","addAttribution","_onLayerAdd","_onLayerRemove","setPrefix","text","removeAttribution","attribs","prefixAndAttribs","attributionControl","Scale","metric","imperial","_addScales","_mScale","_iScale","centerLat","halfWorldMeters","maxMeters","_updateScales","_updateMetric","_updateImperial","meters","_getRoundNum","_getScaleWidth","maxMiles","miles","feet","maxFeet","ratio","pow10","Layers","collapsed","autoZIndex","baseLayers","overlays","_lastZIndex","_handlingClick","_addLayer","_onLayerChange","addBaseLayer","addOverlay","form","_form","_expand","_collapse","_layersLink","_onInputClick","_baseLayersList","_separator","_overlaysList","overlay","baseLayersPresent","overlaysPresent","_addItem","_createRadioElement","checked","radioHtml","radioFragment","input","label","defaultChecked","layerId","inputs","inputsLen","PosAnimation","run","_el","_onTransitionEnd","_stepTimer","setInterval","_onStep","_getPos","stepPos","_transformRe","clearInterval","_tryAnimatedZoom","_tryAnimatedPan","step","_onPanTransitionStep","end","_onPanTransitionEnd","_duration","_easeOutPower","_offset","_animate","_step","_complete","_animId","_runFrame","_easeOut","progress","zoomAnimationThreshold","_catchTransitionEnd","propertyName","_onZoomTransitionEnd","_nothingToAnimate","getElementsByClassName","backwards","forTouchZoom","_animateToCenter","_animateToZoom","_animating","_prepareBgBuffer","bg","initialTransform","front","bgLoaded","_getLoadedTilesPercentage","frontLoaded","_stopLoadingImages","complete","_defaultLocateOptions","watch","timeout","maximumAge","enableHighAccuracy","locate","_locateOptions","geolocation","_handleGeolocationError","message","onResponse","_handleGeolocationResponse","onError","_locationWatchId","watchPosition","getCurrentPosition","stopLocate","clearWatch","error","latitude","longitude","latAccuracy","accuracy","lngAccuracy","timestamp","KML","kml","_kml","addKML","loadXML","req","XMLHttpRequest","overrideMimeType","onreadystatechange","readyState","status","responseXML","send","_this","gpx","_addKML","xml","parseKML","parseStyle","parseStyleMap","_check_folder","parseFolder","parsePlacemark","parseGroundOverlay","folder","parentElement","_parse","childNodes","attributes","nodeValue","substring","ioptions","sl","hotSpot","poptions","KMLIcon","iconUrl","shadowUrl","iconAnchorRef","iconAnchorType","xunits","yunits","getAttribute","existingStyles","smKey","smStyleUrl","textContent","place","h","multi","parse","tag","descr","parseCoords","_read_coords","parseLineString","line","parseTrack","_read_gxcoords","parsePoint","ll","KMLMarker","parsePolygon","polys","inner","latlonbox","rotation","RotatedImageOverlay","angle","anchorType","_rotate","rad","costheta","sintheta","MarkerClusterGroup","maxClusterRadius","iconCreateFunction","spiderfyOnMaxZoom","showCoverageOnHover","zoomToBoundsOnClick","singleMarkerMode","disableClusteringAtZoom","removeOutsideVisibleBounds","animateAddingMarkers","spiderfyDistanceMultiplier","spiderLegPolylineOptions","chunkedLoading","chunkInterval","chunkDelay","chunkProgress","polygonOptions","_defaultIconCreateFunction","_featureGroup","_nonPointGroup","_inZoomAnimation","_needsClustering","_needsRemoving","_currentShownBounds","_queue","array","addLayers","_unspiderfy","_maxZoom","visibleLayer","currentZoom","__parent","_animationAddLayer","_animationAddLayerNonAnimated","removeLayers","_unspiderfyLayer","_removeLayer","clusterShow","_arraySplice","layersArray","newMarkers","fg","npg","chunked","started","getTime","process","start","getChildCount","getAllChildMarkers","otherMarker","MarkerCluster","_iconNeedsUpdate","_updateIcon","_topClusterLevel","_recursivelyAddChildrenToMap","_gridClusters","_gridUnclustered","_noanimationUnspiderfy","_generateInitialClusters","result","anArray","_group","zoomToShowLayer","showMarker","afterSpiderfy","spiderfy","moveStart","zoomToBounds","_getExpandedVisibleBounds","_zoomEnd","_moveEnd","_spiderfierOnAdd","_bindEvents","_unbindEvents","_spiderfierOnRemove","_hideCoverage","getVisibleParent","vMarker","removeFromDistanceGrid","dontUpdateMap","gridClusters","gridUnclustered","removeObject","cluster","_markers","_childCount","_cLatLng","addObject","_childClusters","_recalculateBounds","_isOrIsParent","oel","childCount","_zoomOrSpiderfy","_showCoverage","_shownPolygon","_spiderfied","getConvexHull","_mergeSplitClusters","_recursivelyRemoveChildrenFromMap","radiusFn","DistanceGrid","markerPoint","closest","getNearObject","_addChild","newCluster","lastParent","_enqueue","_queueTimeout","_processQueue","_animationStart","_animationZoomIn","_animationZoomOut","latDiff","lngDiff","_addToMap","_animationEnd","previousZoomLevel","newZoomLevel","_recursively","startPos","_isSingleParent","clusterHide","_forceLayout","_recursivelyBecomeVisible","n","_recursivelyRestoreChildPositions","_animationZoomOutSingle","_recursivelyAnimateChildrenInAndAddSelfToMap","me","markerClusterGroup","group","storageArray","childClusters","boundsZoom","mapZoom","newClusters","_iconObj","new1","isNotificationFromChild","_expandBounds","addedCount","addedLatLng","_wLatLng","totalCount","_backupLatlng","_recursivelyAnimateChildrenIn","cm","zoomLevel","nm","_restorePosition","previousBounds","exceptBounds","boundsToApplyTo","zoomLevelToStart","zoomLevelToStop","runAtEveryLevel","runAtBottomLevel","opacityWhenUnclustered","ret","cellSize","_cellSize","_sqCellSize","_grid","_objectPoint","_getCoord","grid","row","cell","updateObject","eachObject","objectPoint","closestDistSq","QuickHull","getDistant","cpt","bl","vY","vX","findMostDistantPointFromBaseLine","baseLine","pt","maxD","maxPt","maxPoint","buildConvexHull","convexHullBaseLines","maxLat","minLat","minPt","ch","childMarkers","_2PI","_circleFootSeparation","_circleStartAngle","_spiralFootSeparation","_spiralLengthStart","_spiralLengthFactor","_circleSpiralSwitchover","positions","_generatePointsSpiral","_generatePointsCircle","_animationSpiderfy","unspiderfy","zoomDetails","_animationUnspiderfy","centerPt","circumference","legLength","angleStep","res","separation","lengthFactor","_preSpiderfyLatlng","_spiderLeg","SVG_ANIMATION","leg","thisLayerPos","initialLegOpacity","xmlns","legOptions","getTotalLength","anim","beginElement","stillThereChildCount","_unspiderfyWrapper","_unspiderfyZoomStart","_unspiderfyZoomAnim","emp","typeLibrary","utils","offsetUnit","FRACTION","PIXEL","INSETPIXELS","calculateOffset","iIconSize","sOffset","sOffsetType","iOffsetValue","dFraction","iOffset","leafLet","editor","airspace","internalPrivateClass","objectType","OVERLAY","FEATURE","LL_CONTROL","LL_DEFAULT_MAP","featureType","AOI","LEAFLET_DEFAULT_LINE_COLOR","LEAFLET_DEFAULT_LINE_WEIGHT","fromEmpLatLon","oEmpLatLon","_lat","_lon","toEmpLatLon","LatLon","oCoord","oThis","oThat","bearingTo","destinationPoint","brng","moveCoordinate","intersectLines","dBrng1","oCoord2","dBrng2","oResult","intersection","midPointTo","dBrng","dDist","pointAtFractionOfDistanceTo","pointAt3QtrDistanceTo","EmpIcon","publicInterface","oIconImag","_applyAnchorRef","oDefaultIcon","utilities","getDefaultIcon","basePath","xUnits","yUnits","oIconUtils","oImg","oOffset","oUnits","sXUnits","sYUnits","calculateXOffset","calculateYOffset","referencePoint","TOP_LEFT","iXOffset","iYOffset","BOTTOM_LEFT","sTemp","helpers","isEmptyString","heading","empSelect","labelStyle","oFeature","getEngineInstanceInterface","selectLabelStyle","getFormat","featureFormatType","MILSTD","isMultiPointTG","$","find","red","green","blue","empDeselect","getLabelStyle","oSelectAttributes","instanceInterface","selectAttributes","tempColor","tempWeight","oStyle","util","sURL","isDefaultMap","useProxyForDefault","config","getProxyUrl","useProxy","getCoreId","coreId","getObjectType","EmpKMLIcon","oMarker","_getRealScale","dKMLScale","dScale","naturalWidth","naturalHeight","_calculatXOffset","iIconWidth","_calculatYOffset","iIconHeight","dAngle","dTempX","dTempY","fHeading","iCenterX","iCenterY","referencePoin","dSin","dCos","dNewX","dNewY","EmpKMLMarker","KMLPluginExtension","isUrl","parseXML","getIconUrl","sKmlUrl","oFeatureProperties","getUseProxySetting","escape","kmlDoc","oIconOptions","sIndex","sID","kmlName","kmlDescription","sSubItemID","getOptions","sType","oOptions","oColor","oProperties","iconXOffset","iconYOffset","isSelected","convertColor","lineColor","sColor","EmpKmlObject","titleText","popupText","setPopupHeading","sText","getPopupHeading","setPopupText","getPopupText","setOverlay","oOverlay","getOverlayId","Overlay","getParentId","getFeatureId","EllipseObject","oMap","leafletMap","semiMajor","semiMinor","azimuth","centerLatLng","oCoordList","_generatePolygon","tempLatLng","angleTan","angleTan2","xyPoint","q1PointList","q2PointList","q3PointList","q4PointList","coordList","northCoord","eastCoord","northPoint","eastPoint","semiMajorPx","semiMinorPx","nPtePtDist","semiMajorPx2","semiMinorPx2","majorMinor","cosAzimuth","toRad","sinAzimuth","deltaRadian","maxRadian","SelectionManager","eventData","featureSelectedList","mapInstance","destroy","iIndex","oKeyList","associativeArray","getKeys","getKey","sSubFeatureID","sKey","_createSelectionObject","oSelectedListObject","oSelectionData","overlayId","parentId","featureId","select","selectedId","deselectAllFeatures","oFeatureSelection","isInEditMode","applyHighlight2LeafletObject","_removeFeatureFromSelectedList","_addFeatureToSelectedList","bSelected","selectFeature","deselectFeature","_removeFeaturesEntries","generateEvent","eventing","SelectionChange","resetEventData","_applyHighlight","oLeafletObj","oItemList","getLeafletObject","sCoreID","removeFeature","empObject","globalType","description","newGUID","parentCoreId","oClusteredParent","objectChildren","oParent","getParentObject","clearChildren","removeChildObject","removeEmpObject","aKeys","oCurrentEditor","cancelEdit","bInEditMode","bInDrawMode","oEditTransaction","removeChildObjectById","getRootOverlay","rootOverlay","getLeafletMap","leafletInstance","getEngObject","sCoreId","mapEngObjectList","getParentCoreId","getName","getDescription","setName","sValue","getChild","getChildList","getChildKeyList","getClusteredOverlay","isCurrentlyClustered","deactivateParentCluster","clusterDeactivate","activateParentCluster","clusterActivate","addChildObject","oChild","oClusteredOverlay","getClusterObject","hasChildren","isEmpty","DisplayableObject","visible","leafletObject","oLeafletObject","isVisible","setVisibility","oItem","oMapBounds","_updateLeafletObject","aKeyList","setFeatureStyle","EmpClusterGroup","oClusterDef","getClusterDef","getDistance","oCluster","_iconCreateFunction","getOverlay","_ParamReplacementCB","sParam","sRet","oFeatureList","oClusterStyle","getClusterStyle","getIconStyle","getPointStyle","_setClusterHeadingText","sPopupText","sTitle","getReplacementString","getTitle","_setClusterPopupText","sSummary","getSummary","sDescription","oClusterIcon","oIconStyle","oPointStyle","sStr","getLabel","getURL","sLabel","oImage","iRadius","toDataURL","createCircleCanvas","dOpacity","sStrokeColor","sFillColor","sTextColor","oEvent","handleFeatureClicked","Feature","Cluster","bClusterActive","oLeafletClusterObject","hasClusterDef","clusterRemove","hasFeatures","getFeatureBounds","oChildBounds","oBounds","oChildList","sKeys","addCoordinate","EmpBoundary","_setClusterDef","isClusterActive","activateCluster","clusterSet","_doClusterActivate","copyObject","defaultLabelStyle","selected","bEditable","isEditMode","originalStyle","setLeafletObject","_createFeature","oSelectionManager","getAzimuth","setEditMode","render","resetEditMode","oObject","getData","setData","oData","getProperties","setProperties","oProp","isEditable","isMilStd","isGeoJson","GEOJSON","isKML","isAirspace","AIRSPACE","isImage","IMAGE","isAOI","AOIFeature","isGeoEllipse","GeoEllipseFeature","getAngleUnits","AngleUnits","DEGREES","getAzimuthUnits","getAltitudeUnits","Units","FEET","METERS","oMilStdModifiers","SYMSTD","getUnits","getAltitudeModeAbbr","AltitudeModeAbbr","altitudeMode","_getAltUnitsAndModeText","aAltMode","_getPopupDescription","updateFeature","oNewLeafletObject","oArgs","oCoreFeature","bUpdateGraphic","_updateFeature","setSelection","bValue","bWrappedAlready","iLevel","oLatLngList","oNewLatLngList","bCoordWrapped","iCurrentLevel","wrapCoordinates","iList","bHasNotWrapped","updateCoordinates","getLineStyle","sEMPStyle","sLeaftletStyle","OutlineStyleType","DOT","DASH","DASH_DOT","LONG_DASH","LONG_DASH_DOT","SOLID","setFeatureStyleProperties","_getPolygonProperties","argsProperties","mergeGeoJSONProperties","strokeColor","defaultStrokeStyle","activeLayer","activeLayers","createWMS","addMapLayer","removeMapLayer","getId","oWMS","updateWMS","oSouthWest","oNorthEast","degNorth","degSouth","degWest","degEast","oSW","oNE","oCoordinate","degSE2Coord","geoLibrary","GetAzimuth","degSW2Coord","getCenterWest","dCenterLat","getCenterEast","containsCoordiante","containsIDL","contained","oBoundary","oBNorthEast","oSouthEast","oBNorthWest","getCenterWidth","oCenterWest","oCenterEast","setCenterWidth","dWidth","oCenter","oNewWestCoord","oNewEastCoord","MilStdFeature","sBasicSymbolCode","i2525Version","bIsMultiPointTG","getMilStdModifiers","getBasicSymbolCode","sUnits","RendererSettings","armyc2","c2sd","renderer","oBasicSymbolCode","milstd","basicSymbolCode","RECTANGULAR_TARGET","get2525Version","Symbology_2525Bch2_USAS_13_14","MILS","Symbology_2525C","retValue","cMilStdModifiers","Modifiers","oModifiers","UNIQUE_DESIGNATOR_1","getCoordinateList","symbolCode","toFixed","_createMultiPointFeature","oModifier","applyRequiredModifiers","renderMPGraphic","sName","sSymbolCode","oCoordData","_createSinglePointFeature","oCoordinates","convertCoordinatesToLatLng","oMilStdIcon","_getSinglePointIcon","_modifierOnList","sModifier","oLabelList","oMainModifiers","oImageBounds","renderingOptimization","baseURL","sModifiers","svgColor","oModifierArray","sClassName","strippedSymbolCode","msa","MilStdAttributes","T","longModifiers","FILL_COLOR","FillColor","LINE_COLOR","LineColor","STANDARD","SIZE","iMilStdIconSize","MilStdIconRenderer","Render","toDataUrl","getCenterPoint","getImageBounds","viewInZone","charAt","farDistanceThreshold","RED","BLUE","GREEN","YELLOW","getSVG","engine","rendererUrl","location","protocol","host","_updateSinglePointFeature","bUpdateIcon","oIcon","convertModifiersTo2525","isMultiPoint","SymbolUtilities","getBasicSymbolID","oSymbolDef","SymbolDefTable","getSymbolDef","minPoints","MilStdModifiers","modifiers","toLongModifiers","oMapBoundry","setCoordinates","convertLatLngListToGeoJson","oEmpBoundary","_updateMilStdFeature","oNewFeafure","oMilStdUtil","areModifierValuesEqual","updateIconSize","toModifiers","KMLFeature","sKMLName","sKMLDesctiption","sKMLDescription","oLatLng","_getUrlViaProxy","proxyUrl","appSetup","urlProxy","_setKMLParameters","oKmlDoc","each","oNameElem","oDescElem","_createFeatureFromString","sProxyUrl","bUseProxy","getProxyURL","getBasePath","_createFeatureFromURL","bDoUpdate","bMultiGeometry","OverlayStyleType","POINT","LINE","POLYGON","MULTIGEOMETRY","GeoJsonFeature","_createGeoJSONPolygon","oGeoJSON","bIsSelected","_createGeoJSONLine","_getDefaultIcon","_createGeoJSONPoint","oLatLon","iconOptions","_createGeoJSONComplex","oGeoJSONData","oGeoJsonfeature","basPath","getGeometryType","sGeoJsonType","AirspaceFeature","iMinPoint","iMaxPoints","iMinPoints","oAirspaceAttributeList","AttributeList","getMinPoints","getMaxPoints","oAttributes","getAttributes","cAirspaceAttribute","AirspaceAttribute","getValue","AIRSPACE_ALTITUDE_MODE","getAttributeList","setAttributeList","oList","ImageFeature","_convertBBox","sImageURL","oBBox","getParams","oOriginalData","iBuffer","sAOIType","oGeoJson","setAOIType","aoi","setAOIBuffer","buffer","setAOISymbolCode","setModifiers","getAOISymbolCode","getModifiers","eAOIType","AOIType","getAOIType","POINT_RADIUS","BBOX","getAOIBuffer","setAOIBufferProperty","eMilStdModifiers","DISTANCE","sShortName","oMilStdFeature","o2525Modifiers","oStringModifiers","oLongToShortModifierName","stringToModifiers","o2525ModifierToLong","getAMValueCount","getAMValue","NaN","dValue","METERS_PER_FEET","setAMValue","FEET_PER_METERS","getANValueCount","AZIMUTH","getANValue","DEGREE_PER_MILS","setANValue","MILS_PER_DEGREE","getXValueCount","ALTITUDE_DEPTH","getXValue","setXValue","oNewModifiers","sLongModifier","featureMilStdVersionType","convertToString","sProp","X_OFFSET","X_UNITS","Y_OFFSET","Y_UNITS","LINE_THICKNESS","convertToNumeric","GeoTextFeature","myIcon","iTextPixelDim","oLeafletFeature","sLabelText","htmlFontStyle","htmlFontWeight","sCSSTextShadow","typeface","cmapi","enums","REGULAR","BOLD","ITALIC","BOLDITALIC","getStringPixelDimensions","family","justification","CENTER","LEFT","RIGHT","outlineColor","GeoRectangleFeature","newLatLng","angleOffset","toDeg","GeoSquareFeature","GeoCircleFeature","AIRSPACE_FILL_COLOR","AIRSPACE_LINE_COLOR","AIRSPACE_LINE_WIDTH","AIRSPACE_LEFT_WIDTH","AIRSPACE_RIGHT_WIDTH","AIRSPACE_WIDTH","AIRSPACE_HEIGHT","AIRSPACE_ALTITUDE","AIRSPACE_MIN_ALTITUDE","AIRSPACE_MAX_ALTITUDE","AIRSPACE_INNER_RADIUS","AIRSPACE_RADIUS","AIRSPACE_LEFT_AZIMUTH","AIRSPACE_RIGHT_AZIMUTH","AIRSPACE_ORBIT_TURN","AirspaceAttributes","sAttr","setValue","Value","setRequiredAttributes","sAirspaceType","cAirspaceType","airspaceSymbolCode","SHAPE3D_CURTAIN","SHAPE3D_CYLINDER","SHAPE3D_ORBIT","orbitTurnType","SHAPE3D_POLYARC","SHAPE3D_POLYGON","SHAPE3D_RADARC","SHAPE3D_ROUTE","SHAPE3D_TRACK","dMinAlt","getAirspaceAttributes","oAttr","duplicateAttribute","Attributes","AirspaceAttributeList","oAttrList","oAttributeList","insert","getAirspaceAttributeList","getMinAltitude","dMin","Number","MAX_VALUE","cAttributeConst","getMaxAltitude","dMax","MIN_VALUE","CylinderAirspace","oLineColor","oFillColor","iWidth","Cylinder","PolygonAirspace","oPolygonOptions","CurtainAirspace","Curtain","OrbitAirspace","sTurn","dBearing","dAnglePt1Pt2","OvalObject","Orbit","RouteAirspace","oOvalLeafletObject","oLegCoords","Route","TrackAirspace","dLeftWidth","dRightWidth","Bearing","dBearingPt1Pt2","Track","RadArcAirspace","oPartialCoordList","oCenterLatLng","dLeftAzimuth","dRightAzimuth","dInnerRadius","dOutterRadius","getEngineInstanceInterfacee","getArcCoordinates","RadArc","PolyArcAirspace","dRadius","PolyArc","sMode","featureAltitudeModeType","RELATIVE_TO_GROUND","ABSOLUTE","normilizeLongitude","convertViewBound","oView","west","south","east","north","isInt","anyCoordinateInBounds","bRet","oaCoordList","wrapLongitude","oMapCenter","oNewLatLng","oNorthEastBoundry","oNorthWestBoundry","tempLng","bLnginView","iCoorCnt","empBoundary","bIDLinView","dateLineInFeature","lng1","lng2","bDataLineInFeature","iCount","iCountMinus1","convertToColorString","sNewColor","iColor","mergeProperties","oProperties1","oProperties2","metersToFeet","iMeters","feetToMeters","iFeet","oRet","substr","angleBetween","oVertice","oPt1","oPt2","dAngleVPt1","dAngleVPt2","dStartAzimuth","dEndAzimuth","bClockwise","oNewPt","dNewAngleDelta","dAngleInc","oPoint1","oPoint2","dAngleVPt1Pt2","dPointDist","geoColorToHexColorString","geoColor","convertCoordinatesToString","convertCoordinateToLatLng","convertLatLngToGeoJson","oGeoJsonCoord","oGeoJSONProperties","sDefaultIconUrl","weigh","privateInterface","getAutoWidth","checkModifier","sBasicSymbol","sBaseModifier","sDigit","iDigit","oTGModifiers","ModifiersTG","oBasicCodes","T_UNIQUE_DESIGNATION_1","AM_DISTANCE","AN_AZIMUTH","S_OFFSET_INDICATOR","V_EQUIP_TYPE","W_DTG_1","H_ADDITIONAL_INFO_1","AIR_CORRIDOR","MINIMUM_RISK_ROUTE","STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE","UBMANNED_AERIAL_VEHICLE_ROUTE","LOW_LEVEL_TRANSIT_ROUTE","X_ALTITUDE_DEPTH","dBaseValue","CIRCULAR_RANGE_FAN","SECTOR_RANGE_FAN","createMilStdEditor","oPrivateInterface","oTransaction","oEmpItem","oEditor","oSymbolDefTable","oParameters","transaction","EmpDrawEditItem","SymbolDef","multiPoint","drawCategory","DRAW_CATEGORY_LINE","DRAW_CATEGORY_ARROW","MilStdDCLine","DRAW_CATEGORY_AUTOSHAPE","MilStdDCAutoShape","DRAW_CATEGORY_POLYGON","MilStdDCPolygon","DRAW_CATEGORY_ROUTE","MilStdDCRoute","DRAW_CATEGORY_TWOPOINTLINE","DRAW_CATEGORY_TWOPOINTARROW","MilStdDC2PointLine","DRAW_CATEGORY_POINT","MilStdSinglePoint","DRAW_CATEGORY_SUPERAUTOSHAPE","MilStdDCSuperAutoShape","DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE","MilStdDCCircularAutoShape","DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE","MilStdDCRectParamAutoShape","DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE","MilStdDCSectorParamAutoShape","DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE","MilStdDCCircularRangeFan","DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE","MilStdDC2PointRectAutoShape","DRAW_CATEGORY_3D_AIRSPACE","oValue1","oValue2","sValue1","JSON","stringify","sValue2","getRequiredModifiers","sReqModifiers","oSymDefTable","sRequiredModifiers","oRequiredModifiers","oPropModifiers","MILSTD_2525B","s2525Modifier","createEditor","symStd","iOutputFormat","mapBounds","empMapBounds","oRenderer","sec","web","SECWebRenderer","sCoordinateStr","iZoom","getScale","dMaxLabelScale","sBBox","oDimension","pointConverter","PointConverter","sGeoJsonData","RenderSymbol2D","oLeaftletGeoJSON","lineOpacity","strokeWidth","fontFamily","fontSize","fontWeight","sTextAlignment","labelAlign","labelBaseline","fontColor","oNewChildren","FlantenGroup","oGroup","oChildren","Ex","console","createTGFromDraw","oEnginePrivateInterface","oLeafletMap","oDrawItem","dBrngInc","oMapSouthWest","oMapNorthEast","oMapCenterWest","oMapCenterEast","oMapCenterNorth","oMapCenterSouth","dViewWidth","dViewHeight","dQtrWidth","d3rdHeight","oGeoJsonData","TASK_ISOLATE","TASK_OCCUPY","TASK_RETIAN","TASK_SECURE","TASK_CORDON_SEARCH","TASK_CORDON_KNOCK","MINIMUM_SAFE_DISTANCE_ZONES","CCGM_OFFENCE_SUPPORT_BY_FIRE_POSITION","QUANTITY","REDUCED_OR_REINFORCED","STAFF_COMMENTS","ADDITIONAL_INFO_1","ADDITIONAL_INFO_2","ADDITIONAL_INFO_3","EVALUATION_RATING","COMBAT_EFFECTIVENESS","SIGNATURE_EQUIPMENT","HIGHER_FORMATION","HOSTILE","IFF_SIF","DIRECTION_OF_MOVEMENT","OFFSET_INDICATOR","UNIQUE_DESIGNATOR_2","EQUIPMENT_TYPE","DATE_TIME_GROUP","DATE_TIME_GROUP_2","LOCATION","SPEED","SPECIAL_C2_HEADQUARTERS","HEADING","mapping","s2525Modifiers","AIRSPACE_COORDINATION_AREA_IRREGULAR","AIRSPACE_COORDINATION_AREA_RECTANGULAR","AIRSPACE_COORDINATION_AREA_CIRCULAR","RESTRICTED_OPERATIONS_ZONE","HIGH_DENSITY_AIRSPACE_CONTROL_ZONE","MISSILE_ENGAGEMENT_ZONE","MISSILE_ENGAGEMENT_ZONE_LOW_ALTITUDE","MISSILE_ENGAGEMENT_ZONE_HIGH_ALTITUDE","CIRCULAR_TARGET","FORD_EASY","FORD_DIFFICULT","ROADBLOCK_COMPLETE_EXECUTED","SEIZE","AMBUSH","BLOCK_TASK","BRIDGE_OR_GAP","ASSAULT_CROSSING_AREA","FORWARD_AREA_AIR_DEFENSE_ZONE","SHORT_RANGE_AIR_DEFENSE_ENGAGEMENT_ZONE","KILL_BOX_PURPLE_CIRCULAR","KILL_BOX_PURPLE_RECTANGULAR","KILL_BOX_PURPLE_IRREGULAR","iValue","MILSTD_2525C","sKML","sCoordStr","bIsPolygon","aCoord","dLng","dAlt","aStrCoordList","convertLatLngListToKML","getXmlAsString","xmlDom","XMLSerializer","serializeToString","$oKmlDoc","bDone","createAirspace","oAirspace","oInstanceInterface","AirspaceCurtain","AirspacePolygon","AirspaceCylinder","AirspaceOrbit","AirspaceRoute","AirspaceTrack","AirspaceRadArc","AirspacePolyArc","oOvalCoordList","dLeftBearing","dRightBearing","ControlPoint","Type","NEW_POSITION_CP","POSITION_CP","ALTITUDE_CP","RADIUS_CP","INNER_RADIUS_CP","WIDTH_CP","LEFT_WIDTH_CP","RIGHT_WIDTH_CP","RANGE_CP","LENGTH_CP","AZIMUTH_CP","LEFT_AZIMUTH_CP","RIGHT_AZIMUTH_CP","ATTITUDE_CP","SEGMENT_CP","AOI_BUFFER","CPIcon","CP_ICON_DEF","newCP","iLineWidth","positionCP","altitudeCP","radiusCP","innerRadiusCP","widthCP","leftWidthCP","rightWidthCP","rangeCP","lengthCP","azimuthCP","leftAzimuthCP","rightAzimuthCP","attitudeCP","segmentCP","aoiBufferCP","oIconDef","cpType","oCPIcons","oPosition","iSubIndex","cpIndex","cpSubIndex","cpValue","cpPopup","getType","_updateCoordinate","setParent","setType","getIndex","setIndex","getSubIndex","setSubIndex","setCPPosition","oValue","_getAngleValue","_getUnitValue","_getAltitudeValue","sAltMode","showPopup","oPopup","hidePopup","updatePopup","oOffsetPoint","StateType","IDLE","ADDING_CP","DELETE_CP","DRAGGING_CP","FEATURE_DRAG","AbstractEditor","bDestroyFeature","editorState","isDrawing","Draw","oEmpDrawEditItem","oCurrentCP","oControlPointList","featureStartLocation","updateIndex","oMarkerPopUp","bCPDragged","isDrawMode","preapareForDrawOperation","preapareForEditOperation","assembleControlPoints","onClickEvent","onFeatureMouseUpEvent","setLeafletObjectEvents","_issueStartEvent","removeLeafletObjectEvents","onCPMouseUpEvent","removeAllControlPoints","getMarkerObject","isMarker","setMarkerEvents","onFeatureMouseDown","removeMarkerEvents","removeCP","getMarkerPopupText","setMarkerPopup","oMarkerObject","bringCPForward","setFeature","getDrawEditItem","createEMPFeature","oEMPFeature","getCenterPT","getCP","iCPIndex","oCPList","doAddControlPoint","doDeleteControlPoint","oCP","doControlPointMoved","doFeatureMove","dDistance","getState","isIdle","isAddingCP","isDeletingCP","isDraggingCP","isDraggingFeature","_setState","eState","isCPAddEvent","altKey","ctrlKey","shiftkey","isCPDeleteEvent","isCPDragStartEvent","isFeatureDragStartEvent","updateCPIndex","addControlPoint","_issueCPAddEvent","onDblClick","_issueCPDeleteEvent","releaseCapture","onCPMouseMoveEvent","_issueCPUpdateEvent","UpdateEventType","UPDATE","aiIndex","onCPMouseDown","setCapture","onFeatureMouseMoveEvent","oOrgLL","oEventCoord","setCPEvents","removeCPEvents","removeAllCPByType","iStartIndex","iDelta","convertToUpdateCoordinates","oUpdateCoordList","empMapInstance","DrawStart","EditStart","oIndexArray","updateEventType","oUpdateEvent","plotFeature","updates","CoordinateUpdateType","indices","mapInstanceId","ADD","REMOVE","_issueEndEvent","COMPLETE","DrawEnd","EditEnd","_issueCancelEvent","oErrArray","level","failures","endEdit","updateLeafletObject","GeoJsonEditor","geoJsonType","_addNewCP","oNewCoord","_createLeafletObject","iNewIndex","iCoordIndex","GeoJson","MilStdEditor","bMultiPoint","oCurrentCoordianteList","oRendererUtils","oCList","MilStd","AOIEditor","dNorth","dSouth","dWest","dEast","oBufferCoord","oMidPointCoord","iMostEastCoord","oMostEastCoord","oNextCoord","aRet","oRefCoord","dMouseAngle","oTempCP","KMLEditor","AirspaceEditor","emp3","api","FeatureTypeEnum","GEO_ACM","Airspace","MilStdDCAutoShapeEditor","dDistC1","dDistC2","dDistC3","Temp","maxPoints","oCPPt2","oCPt","iIndex2","MilStdDCCircularAutoShapeEditor","_addRadiusCP","oCPPosition","dRange","oCPPos","MilStdDCCircularRangeFanEditor","_addRangeCPs","oAMList","iAMCnt","dNextRange","dPrevRange","MilStdDCLineEditor","MilStdDCPolygonEditor","MilStdDCRectParamAutoShapeEditor","_addWidthCP","oWidthPoint","_addLengthCP","oLengthPoint","dLength","_addAttitudeCP","oAttitudePoint","MilStdDCRouteEditor","MilStdDCSectorParamAutoShapeEditor","dMidAzimuth","oANList","iANIndex","bMinimumRange","_addAzimuthCPs","dAzimuthCPDist","iAzimuthIndex","MilStdDCSuperAutoShapeEditor","_createWidthCP","oBasicSymbolCodes","dBearingWLine","oIntPoint","_moveFordCP","oMidPoint","dBearingMidPt3","dNewBearingMidPt3","dNewBearingPt1Pt2","oCP3","Pt3Coord","dBearingMidMouse","_moveBlockCP","_moveAmbushCP","dBearingMidPt1","dNewBearingMidPt1","dBearingPt2Pt3","dNewBearingPt2Pt3","oCP1","Pt1Coord","_moveSeizeCP","oRendererSettings","_moveCP","oCPPt3","MilStdDC2PointLineEditor","MilStdDC2PointRectAutoShapeEditor","MilStdSinglePointEditor","AirspaceCurtainEditor","_addSegmentCP","oCPCoord","AirspacePolygonEditor","AirspaceCylinderEditor","AirspaceOrbitEditor","Pt1","Pt2","dMouseBearing","dDelatAngle","AirspaceRouteEditor","AirspaceTrackEditor","oMidCoord","AirspaceRadArcEditor","_addAzimuthCP","dAvgRadius","AirspacePolyArcEditor","milstdColorFix","engineDefs","leafletMapEngine","checkMapWidth","angularWidth","checkMapCenter","oNorthWest","oTopLeft","oBottomRight","$Container","iContainerHeight","setupEventListeners","onMouseMove","mgrs","ddToMGRS","Pointer","EventType","onMoveEnd","refreshZone","view","getView","lookAt","viewToLookAt","scheduleRendering","ViewChange","processViewSetTrans","onMapClick","generatePointerEvent","onZoomEnd","onViewReset","onMouseUpDown","engineInterface","createEngineTemplate","selectedGeoColor","IGeoColor","bIsV2Core","isV2Core","midDistanceThreshold","zoneChanged","renderList","removeFromRenderList","addToRenderList","isOnRenderList","isRenderListEmpty","getRenderList","altitude","engineParameters","IGeoLabelStyle","sContentCoreId","tacticalGraphics","rangeToScaleMultiplier","zoomScaleMap","rootOverlayId","oLayerControl","hTGRenderingTimer","oGraphicsInViewingArea","oTransactionList","oZoomControl","empProxyURL","engineBasePath","addEmpObject","oEmpObject","storeTransaction","transactionId","findTransaction","oTranID","findTransactionByIntent","sIntent","sTranID","aRetList","intent","removeTransaction","getEmpObject","sSelectedID","oPointerData","getAutoSelect","popupInfo","getLevel","tilt","range","constant","CLAMP_TO_GROUND","roll","oLL","elevation","SINGLE_CLICK","DBL_CLICK","MOUSEDOWN","MOUSEUP","oPoint","pageX","pageY","oEmpMapBounds","oFeatureBounds","RerenderingTimerHdlr","currentGraphic","removedGraphicId","oTrans","aViewSetTransList","intents","VIEW_SET","items","mapResizeFn","setLookAt","succeed","oLayerEntry","oControl","oLeafletContent","oLayerList","myElement","addResizeListener","Static","storage","getRootGuid","coreParent","oMainMap","StaticContent","StatusChange","states","READY","fail","MAP_INSTANCE_INIT_FAILED","Status","getStatus","state","removeResizeListener","set","oaItems","MAJOR","jsError","oNewOverlay","oParentOverlay","oNewParent","clear","MINOR","activate","deactivate","bZoom","oEmpBounds","failList","oNewFeature","GEO_POINT","GEO_PATH","GEO_POLYGON","GEO_TEXT","GEO_RECTANGLE","GEO_SQUARE","GEO_CIRCLE","GEO_ELLIPSE","destCoreParent","oOldParent","draw","begin","oOriginalFeature","originFeature","pause","cancel","edit","oEditItem","selection","navigation","settings","mil2525","labels","oNewWMS","createParent","getLatLonFromXY","getXYFromLatLon","newConfig","previousRenderSettings","implementation","displayName","sGenericHelpText","help","capabilities","flat","mapType","type2D","formats","GEOJSON_BASIC","plot","GEOJSON_FULL","version_1_1","version_1_3","KML_BASIC","KML_COMPLEX","version2525B","version2525C","ArcGIS","overlayClustering","labelOption","initialExtent","centerLon"],"mappings":"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","file":"emp3-leaflet.min.js","sourcesContent":["/*\r\n Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com\r\n (c) 2010-2013, Vladimir Agafonkin\r\n (c) 2010-2011, CloudMade\r\n*/\r\n(function (window, document, undefined) {\r\nvar oldL = window.L,\r\n    L = {};\r\n\r\nL.version = '0.7.3';\r\n/*\r\n// define Leaflet for Node module pattern loaders, including Browserify\r\nif (typeof module === 'object' && typeof module.exports === 'object') {\r\n\tmodule.exports = L;\r\n\r\n// define Leaflet as an AMD module\r\n} else if (typeof define === 'function' && define.amd) {\r\n\tdefine(L);\r\n}\r\n*/\r\n\r\n// define Leaflet as a global L variable, saving the original L to restore later if needed\r\n\r\nL.noConflict = function () {\r\n\twindow.L = oldL;\r\n\treturn this;\r\n};\r\n\r\nwindow.L = L;\r\n\r\n\r\n/*\r\n * L.Util contains various utility functions used throughout Leaflet code.\r\n */\r\n\r\nL.Util = {\r\n\textend: function (dest) { // (Object[, Object, ...]) ->\r\n\t\tvar sources = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, j, len, src;\r\n\r\n\t\tfor (j = 0, len = sources.length; j < len; j++) {\r\n\t\t\tsrc = sources[j] || {};\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tif (src.hasOwnProperty(i)) {\r\n\t\t\t\t\tdest[i] = src[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tbind: function (fn, obj) { // (Function, Object) -> Function\r\n\t\tvar args = arguments.length > 2 ? Array.prototype.slice.call(arguments, 2) : null;\r\n\t\treturn function () {\r\n\t\t\treturn fn.apply(obj, args || arguments);\r\n\t\t};\r\n\t},\r\n\r\n\tstamp: (function () {\r\n\t\tvar lastId = 0,\r\n\t\t    key = '_leaflet_id';\r\n\t\treturn function (obj) {\r\n\t\t\tobj[key] = obj[key] || ++lastId;\r\n\t\t\treturn obj[key];\r\n\t\t};\r\n\t}()),\r\n\r\n\tinvokeEach: function (obj, method, context) {\r\n\t\tvar i, args;\r\n\r\n\t\tif (typeof obj === 'object') {\r\n\t\t\targs = Array.prototype.slice.call(arguments, 3);\r\n\r\n\t\t\tfor (i in obj) {\r\n\t\t\t\tmethod.apply(context, [i, obj[i]].concat(args));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\tlimitExecByInterval: function (fn, time, context) {\r\n\t\tvar lock, execOnUnlock;\r\n\r\n\t\treturn function wrapperFn() {\r\n\t\t\tvar args = arguments;\r\n\r\n\t\t\tif (lock) {\r\n\t\t\t\texecOnUnlock = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlock = true;\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tlock = false;\r\n\r\n\t\t\t\tif (execOnUnlock) {\r\n\t\t\t\t\twrapperFn.apply(context, args);\r\n\t\t\t\t\texecOnUnlock = false;\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\r\n\t\t\tfn.apply(context, args);\r\n\t\t};\r\n\t},\r\n\r\n\tfalseFn: function () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\tformatNum: function (num, digits) {\r\n\t\tvar pow = Math.pow(10, digits || 5);\r\n\t\treturn Math.round(num * pow) / pow;\r\n\t},\r\n\r\n\ttrim: function (str) {\r\n\t\treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n\t},\r\n\r\n\tsplitWords: function (str) {\r\n\t\treturn L.Util.trim(str).split(/\\s+/);\r\n\t},\r\n\r\n\tsetOptions: function (obj, options) {\r\n\t\tobj.options = L.extend({}, obj.options, options);\r\n\t\treturn obj.options;\r\n\t},\r\n\r\n\tgetParamString: function (obj, existingUrl, uppercase) {\r\n\t\tvar params = [];\r\n\t\tfor (var i in obj) {\r\n\t\t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\t\treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n\t},\r\n\ttemplate: function (str, data) {\r\n\t\treturn str.replace(/\\{ *([\\w_]+) *\\}/g, function (str, key) {\r\n\t\t\tvar value = data[key];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthrow new Error('No value provided for variable ' + str);\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\tvalue = value(data);\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t});\r\n\t},\r\n\r\n\tisArray: Array.isArray || function (obj) {\r\n\t\treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n\t},\r\n\r\n\temptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\r\n};\r\n\r\n(function () {\r\n\r\n\t// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n\tfunction getPrefixed(name) {\r\n\t\tvar i, fn,\r\n\t\t    prefixes = ['webkit', 'moz', 'o', 'ms'];\r\n\r\n\t\tfor (i = 0; i < prefixes.length && !fn; i++) {\r\n\t\t\tfn = window[prefixes[i] + name];\r\n\t\t}\r\n\r\n\t\treturn fn;\r\n\t}\r\n\r\n\tvar lastTime = 0;\r\n\r\n\tfunction timeoutDefer(fn) {\r\n\t\tvar time = +new Date(),\r\n\t\t    timeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n\t\tlastTime = time + timeToCall;\r\n\t\treturn window.setTimeout(fn, timeToCall);\r\n\t}\r\n\r\n\tvar requestFn = window.requestAnimationFrame ||\r\n\t        getPrefixed('RequestAnimationFrame') || timeoutDefer;\r\n\r\n\tvar cancelFn = window.cancelAnimationFrame ||\r\n\t        getPrefixed('CancelAnimationFrame') ||\r\n\t        getPrefixed('CancelRequestAnimationFrame') ||\r\n\t        function (id) { window.clearTimeout(id); };\r\n\r\n\r\n\tL.Util.requestAnimFrame = function (fn, context, immediate, element) {\r\n\t\tfn = L.bind(fn, context);\r\n\r\n\t\tif (immediate && requestFn === timeoutDefer) {\r\n\t\t\tfn();\r\n\t\t} else {\r\n\t\t\treturn requestFn.call(window, fn, element);\r\n\t\t}\r\n\t};\r\n\r\n\tL.Util.cancelAnimFrame = function (id) {\r\n\t\tif (id) {\r\n\t\t\tcancelFn.call(window, id);\r\n\t\t}\r\n\t};\r\n\r\n}());\r\n\r\n// shortcuts for most used utility functions\r\nL.extend = L.Util.extend;\r\nL.bind = L.Util.bind;\r\nL.stamp = L.Util.stamp;\r\nL.setOptions = L.Util.setOptions;\r\n\r\n\r\n/*\r\n * L.Class powers the OOP facilities of the library.\r\n * Thanks to John Resig and Dean Edwards for inspiration!\r\n */\r\n\r\nL.Class = function () {};\r\n\r\nL.Class.extend = function (props) {\r\n\r\n\t// extended class with the new prototype\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tif (this._initHooks) {\r\n\t\t\tthis.callInitHooks();\r\n\t\t}\r\n\t};\r\n\r\n\t// instantiate class without calling constructor\r\n\tvar F = function () {};\r\n\tF.prototype = this.prototype;\r\n\r\n\tvar proto = new F();\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t//inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tL.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tL.Util.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (props.options && proto.options) {\r\n\t\tprops.options = L.extend({}, proto.options, props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tL.extend(proto, props);\r\n\r\n\tproto._initHooks = [];\r\n\r\n\tvar parent = this;\r\n\t// jshint camelcase: false\r\n\tNewClass.__super__ = parent.prototype;\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parent.prototype.callInitHooks) {\r\n\t\t\tparent.prototype.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// method for adding properties to prototype\r\nL.Class.include = function (props) {\r\n\tL.extend(this.prototype, props);\r\n};\r\n\r\n// merge new default options to the Class\r\nL.Class.mergeOptions = function (options) {\r\n\tL.extend(this.prototype.options, options);\r\n};\r\n\r\n// add a constructor hook\r\nL.Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n};\r\n\r\n\r\n/*\r\n * L.Mixin.Events is used to add custom events functionality to Leaflet classes.\r\n */\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\nL.Mixin = {};\r\n\r\nL.Mixin.Events = {\r\n\r\n\taddEventListener: function (types, fn, context) { // (String, Function[, Object]) or (Object[, Object])\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey] = this[eventsKey] || {},\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, event, type, indexKey, indexLenKey, typeIndex;\r\n\r\n\t\t// types can be a string of space-separated words\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\tevent = {\r\n\t\t\t\taction: fn,\r\n\t\t\t\tcontext: context || this\r\n\t\t\t};\r\n\t\t\ttype = types[i];\r\n\r\n\t\t\tif (contextId) {\r\n\t\t\t\t// store listeners of a particular context in a separate hash (if it has an id)\r\n\t\t\t\t// gives a major performance boost when removing thousands of map layers\r\n\r\n\t\t\t\tindexKey = type + '_idx';\r\n\t\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\t\ttypeIndex = events[indexKey] = events[indexKey] || {};\r\n\r\n\t\t\t\tif (!typeIndex[contextId]) {\r\n\t\t\t\t\ttypeIndex[contextId] = [];\r\n\r\n\t\t\t\t\t// keep track of the number of keys in the index to quickly check if it's empty\r\n\t\t\t\t\tevents[indexLenKey] = (events[indexLenKey] || 0) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttypeIndex[contextId].push(event);\r\n\r\n\r\n\t\t\t} else {\r\n\t\t\t\tevents[type] = events[type] || [];\r\n\t\t\t\tevents[type].push(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasEventListeners: function (type) { // (String) -> Boolean\r\n\t\tvar events = this[eventsKey];\r\n\t\treturn !!events && ((type in events && events[type].length > 0) ||\r\n\t\t                    (type + '_idx' in events && events[type + '_idx_len'] > 0));\r\n\t},\r\n\r\n\tremoveEventListener: function (types, fn, context) { // ([String, Function, Object]) or (Object[, Object])\r\n\r\n\t\tif (!this[eventsKey]) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!types) {\r\n\t\t\treturn this.clearAllEventListeners();\r\n\t\t}\r\n\r\n\t\tif (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;\r\n\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\ttype = types[i];\r\n\t\t\tindexKey = type + '_idx';\r\n\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\ttypeIndex = events[indexKey];\r\n\r\n\t\t\tif (!fn) {\r\n\t\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\t\tdelete events[type];\r\n\t\t\t\tdelete events[indexKey];\r\n\t\t\t\tdelete events[indexLenKey];\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlisteners = contextId && typeIndex ? typeIndex[contextId] : events[type];\r\n\r\n\t\t\t\tif (listeners) {\r\n\t\t\t\t\tfor (j = listeners.length - 1; j >= 0; j--) {\r\n\t\t\t\t\t\tif ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {\r\n\t\t\t\t\t\t\tremoved = listeners.splice(j, 1);\r\n\t\t\t\t\t\t\t// set the old action to a no-op, because it is possible\r\n\t\t\t\t\t\t\t// that the listener is being iterated over as part of a dispatch\r\n\t\t\t\t\t\t\tremoved[0].action = L.Util.falseFn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (context && typeIndex && (listeners.length === 0)) {\r\n\t\t\t\t\t\tdelete typeIndex[contextId];\r\n\t\t\t\t\t\tevents[indexLenKey]--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclearAllEventListeners: function () {\r\n\t\tdelete this[eventsKey];\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfireEvent: function (type, data) { // (String[, Object])\r\n\t\tif (!this.hasEventListeners(type)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar event = L.Util.extend({}, data, { type: type, target: this });\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    listeners, i, len, typeIndex, contextId;\r\n\r\n\t\tif (events[type]) {\r\n\t\t\t// make sure adding/removing listeners inside other listeners won't cause infinite loop\r\n\t\t\tlisteners = events[type].slice();\r\n\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// fire event for the context-indexed listeners as well\r\n\t\ttypeIndex = events[type + '_idx'];\r\n\r\n\t\tfor (contextId in typeIndex) {\r\n\t\t\tlisteners = typeIndex[contextId].slice();\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOneTimeEventListener: function (types, fn, context) {\r\n\r\n\t\tif (L.Util.invokeEach(types, this.addOneTimeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar handler = L.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .removeEventListener(types, fn, context)\r\n\t\t\t    .removeEventListener(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\treturn this\r\n\t\t    .addEventListener(types, fn, context)\r\n\t\t    .addEventListener(types, handler, context);\r\n\t}\r\n};\r\n\r\nL.Mixin.Events.on = L.Mixin.Events.addEventListener;\r\nL.Mixin.Events.off = L.Mixin.Events.removeEventListener;\r\nL.Mixin.Events.once = L.Mixin.Events.addOneTimeEventListener;\r\nL.Mixin.Events.fire = L.Mixin.Events.fireEvent;\r\n\r\n\r\n/*\r\n * L.Browser handles different browser and feature detections for internal Leaflet use.\r\n */\r\n\r\n(function () {\r\n\r\n\tvar ie = 'ActiveXObject' in window,\r\n\t\tielt9 = ie && !document.addEventListener,\r\n\r\n\t    // terrible browser detection to work around Safari / iOS / Android browser bugs\r\n\t    ua = navigator.userAgent.toLowerCase(),\r\n\t    webkit = ua.indexOf('webkit') !== -1,\r\n\t    chrome = ua.indexOf('chrome') !== -1,\r\n\t    phantomjs = ua.indexOf('phantom') !== -1,\r\n\t    android = ua.indexOf('android') !== -1,\r\n\t    android23 = ua.search('android [23]') !== -1,\r\n\t\tgecko = ua.indexOf('gecko') !== -1,\r\n\r\n\t    mobile = typeof orientation !== undefined + '',\r\n\t    msPointer = window.navigator && window.navigator.msPointerEnabled &&\r\n\t              window.navigator.msMaxTouchPoints && !window.PointerEvent,\r\n\t\tpointer = (window.PointerEvent && window.navigator.pointerEnabled && window.navigator.maxTouchPoints) ||\r\n\t\t\t\t  msPointer,\r\n\t    retina = ('devicePixelRatio' in window && window.devicePixelRatio > 1) ||\r\n\t             ('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&\r\n\t              window.matchMedia('(min-resolution:144dpi)').matches),\r\n\r\n\t    doc = document.documentElement,\r\n\t    ie3d = ie && ('transition' in doc.style),\r\n\t    webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,\r\n\t    gecko3d = 'MozPerspective' in doc.style,\r\n\t    opera3d = 'OTransition' in doc.style,\r\n\t    any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;\r\n\r\n\r\n\t// PhantomJS has 'ontouchstart' in document.documentElement, but doesn't actually support touch.\r\n\t// https://github.com/Leaflet/Leaflet/pull/1434#issuecomment-13843151\r\n\r\n\tvar touch = !window.L_NO_TOUCH && !phantomjs && (function () {\r\n\r\n\t\tvar startName = 'ontouchstart';\r\n\r\n\t\t// IE10+ (We simulate these into touch* events in L.DomEvent and L.DomEvent.Pointer) or WebKit, etc.\r\n\t\tif (pointer || (startName in doc)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Firefox/Gecko\r\n\t\tvar div = document.createElement('div'),\r\n\t\t    supported = false;\r\n\r\n\t\tif (!div.setAttribute) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tdiv.setAttribute(startName, 'return;');\r\n\r\n\t\tif (typeof div[startName] === 'function') {\r\n\t\t\tsupported = true;\r\n\t\t}\r\n\r\n\t\tdiv.removeAttribute(startName);\r\n\t\tdiv = null;\r\n\r\n\t\treturn supported;\r\n\t}());\r\n\r\n\r\n\tL.Browser = {\r\n\t\tie: ie,\r\n\t\tielt9: ielt9,\r\n\t\twebkit: webkit,\r\n\t\tgecko: gecko && !webkit && !window.opera && !ie,\r\n\r\n\t\tandroid: android,\r\n\t\tandroid23: android23,\r\n\r\n\t\tchrome: chrome,\r\n\r\n\t\tie3d: ie3d,\r\n\t\twebkit3d: webkit3d,\r\n\t\tgecko3d: gecko3d,\r\n\t\topera3d: opera3d,\r\n\t\tany3d: any3d,\r\n\r\n\t\tmobile: mobile,\r\n\t\tmobileWebkit: mobile && webkit,\r\n\t\tmobileWebkit3d: mobile && webkit3d,\r\n\t\tmobileOpera: mobile && window.opera,\r\n\r\n\t\ttouch: touch,\r\n\t\tmsPointer: msPointer,\r\n\t\tpointer: pointer,\r\n\r\n\t\tretina: retina\r\n\t};\r\n\r\n}());\r\n\r\n\r\n/*\r\n * L.Point represents a point with x and y coordinates.\r\n */\r\n\r\nL.Point = function (/*Number*/ x, /*Number*/ y, /*Boolean*/ round) {\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\tthis.y = (round ? Math.round(y) : y);\r\n};\r\n\r\nL.Point.prototype = {\r\n\r\n\tclone: function () {\r\n\t\treturn new L.Point(this.x, this.y);\r\n\t},\r\n\r\n\t// non-destructive, returns a new point\r\n\tadd: function (point) {\r\n\t\treturn this.clone()._add(L.point(point));\r\n\t},\r\n\r\n\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t_add: function (point) {\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(L.point(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\tequals: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\tcontains: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        L.Util.formatNum(this.x) + ', ' +\r\n\t\t        L.Util.formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\nL.point = function (x, y, round) {\r\n\tif (x instanceof L.Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (L.Util.isArray(x)) {\r\n\t\treturn new L.Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\treturn new L.Point(x, y, round);\r\n};\r\n\r\n\r\n/*\r\n * L.Bounds represents a rectangular area on the screen in pixel coordinates.\r\n */\r\n\r\nL.Bounds = function (a, b) { //(Point, Point) or Point[]\r\n\tif (!a) { return; }\r\n\r\n\tvar points = b ? [a, b] : a;\r\n\r\n\tfor (var i = 0, len = points.length; i < len; i++) {\r\n\t\tthis.extend(points[i]);\r\n\t}\r\n};\r\n\r\nL.Bounds.prototype = {\r\n\t// extend the bounds to contain the given point\r\n\textend: function (point) { // (Point)\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tif (!this.min && !this.max) {\r\n\t\t\tthis.min = point.clone();\r\n\t\t\tthis.max = point.clone();\r\n\t\t} else {\r\n\t\t\tthis.min.x = Math.min(point.x, this.min.x);\r\n\t\t\tthis.max.x = Math.max(point.x, this.max.x);\r\n\t\t\tthis.min.y = Math.min(point.y, this.min.y);\r\n\t\t\tthis.max.y = Math.max(point.y, this.max.y);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetCenter: function (round) { // (Boolean) -> Point\r\n\t\treturn new L.Point(\r\n\t\t        (this.min.x + this.max.x) / 2,\r\n\t\t        (this.min.y + this.max.y) / 2, round);\r\n\t},\r\n\r\n\tgetBottomLeft: function () { // -> Point\r\n\t\treturn new L.Point(this.min.x, this.max.y);\r\n\t},\r\n\r\n\tgetTopRight: function () { // -> Point\r\n\t\treturn new L.Point(this.max.x, this.min.y);\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\treturn this.max.subtract(this.min);\r\n\t},\r\n\r\n\tcontains: function (obj) { // (Bounds) or (Point) -> Boolean\r\n\t\tvar min, max;\r\n\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.Point) {\r\n\t\t\tobj = L.point(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.bounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.Bounds) {\r\n\t\t\tmin = obj.min;\r\n\t\t\tmax = obj.max;\r\n\t\t} else {\r\n\t\t\tmin = max = obj;\r\n\t\t}\r\n\r\n\t\treturn (min.x >= this.min.x) &&\r\n\t\t       (max.x <= this.max.x) &&\r\n\t\t       (min.y >= this.min.y) &&\r\n\t\t       (max.y <= this.max.y);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (Bounds) -> Boolean\r\n\t\tbounds = L.bounds(bounds);\r\n\r\n\t\tvar min = this.min,\r\n\t\t    max = this.max,\r\n\t\t    min2 = bounds.min,\r\n\t\t    max2 = bounds.max,\r\n\t\t    xIntersects = (max2.x >= min.x) && (min2.x <= max.x),\r\n\t\t    yIntersects = (max2.y >= min.y) && (min2.y <= max.y);\r\n\r\n\t\treturn xIntersects && yIntersects;\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this.min && this.max);\r\n\t}\r\n};\r\n\r\nL.bounds = function (a, b) { // (Bounds) or (Point, Point) or (Point[])\r\n\tif (!a || a instanceof L.Bounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.Bounds(a, b);\r\n};\r\n\r\n\r\n/*\r\n * L.Transformation is an utility class to perform simple point transformations through a 2d-matrix.\r\n */\r\n\r\nL.Transformation = function (a, b, c, d) {\r\n\tthis._a = a;\r\n\tthis._b = b;\r\n\tthis._c = c;\r\n\tthis._d = d;\r\n};\r\n\r\nL.Transformation.prototype = {\r\n\ttransform: function (point, scale) { // (Point, Number) -> Point\r\n\t\treturn this._transform(point.clone(), scale);\r\n\t},\r\n\r\n\t// destructive transform (faster)\r\n\t_transform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\tpoint.x = scale * (this._a * point.x + this._b);\r\n\t\tpoint.y = scale * (this._c * point.y + this._d);\r\n\t\treturn point;\r\n\t},\r\n\r\n\tuntransform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\treturn new L.Point(\r\n\t\t        (point.x / scale - this._b) / this._a,\r\n\t\t        (point.y / scale - this._d) / this._c);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * L.DomUtil contains various utility functions for working with DOM.\r\n */\r\n\r\nL.DomUtil = {\r\n\tget: function (id) {\r\n\t\treturn (typeof id === 'string' ? document.getElementById(id) : id);\r\n\t},\r\n\r\n\tgetStyle: function (el, style) {\r\n\r\n\t\tvar value = el.style[style];\r\n\r\n\t\tif (!value && el.currentStyle) {\r\n\t\t\tvalue = el.currentStyle[style];\r\n\t\t}\r\n\r\n\t\tif ((!value || value === 'auto') && document.defaultView) {\r\n\t\t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n\t\t\tvalue = css ? css[style] : null;\r\n\t\t}\r\n\r\n\t\treturn value === 'auto' ? null : value;\r\n\t},\r\n\r\n\tgetViewportOffset: function (element) {\r\n\r\n\t\tvar top = 0,\r\n\t\t    left = 0,\r\n\t\t    el = element,\r\n\t\t    docBody = document.body,\r\n\t\t    docEl = document.documentElement,\r\n\t\t    pos;\r\n\r\n\t\tdo {\r\n\t\t\ttop  += el.offsetTop  || 0;\r\n\t\t\tleft += el.offsetLeft || 0;\r\n\r\n\t\t\t//add borders\r\n\t\t\ttop += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;\r\n\t\t\tleft += parseInt(L.DomUtil.getStyle(el, 'borderLeftWidth'), 10) || 0;\r\n\r\n\t\t\tpos = L.DomUtil.getStyle(el, 'position');\r\n\r\n\t\t\tif (el.offsetParent === docBody && pos === 'absolute') { break; }\r\n\r\n\t\t\tif (pos === 'fixed') {\r\n\t\t\t\ttop  += docBody.scrollTop  || docEl.scrollTop  || 0;\r\n\t\t\t\tleft += docBody.scrollLeft || docEl.scrollLeft || 0;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (pos === 'relative' && !el.offsetLeft) {\r\n\t\t\t\tvar width = L.DomUtil.getStyle(el, 'width'),\r\n\t\t\t\t    maxWidth = L.DomUtil.getStyle(el, 'max-width'),\r\n\t\t\t\t    r = el.getBoundingClientRect();\r\n\r\n\t\t\t\tif (width !== 'none' || maxWidth !== 'none') {\r\n\t\t\t\t\tleft += r.left + el.clientLeft;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//calculate full y offset since we're breaking out of the loop\r\n\t\t\t\ttop += r.top + (docBody.scrollTop  || docEl.scrollTop  || 0);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tel = el.offsetParent;\r\n\r\n\t\t} while (el);\r\n\r\n\t\tel = element;\r\n\r\n\t\tdo {\r\n\t\t\tif (el === docBody) { break; }\r\n\r\n\t\t\ttop  -= el.scrollTop  || 0;\r\n\t\t\tleft -= el.scrollLeft || 0;\r\n\r\n\t\t\tel = el.parentNode;\r\n\t\t} while (el);\r\n\r\n\t\treturn new L.Point(left, top);\r\n\t},\r\n\r\n\tdocumentIsLtr: function () {\r\n\t\tif (!L.DomUtil._docIsLtrCached) {\r\n\t\t\tL.DomUtil._docIsLtrCached = true;\r\n\t\t\tL.DomUtil._docIsLtr = L.DomUtil.getStyle(document.body, 'direction') === 'ltr';\r\n\t\t}\r\n\t\treturn L.DomUtil._docIsLtr;\r\n\t},\r\n\r\n\tcreate: function (tagName, className, container) {\r\n\r\n\t\tvar el = document.createElement(tagName);\r\n\t\tel.className = className;\r\n\r\n\t\tif (container) {\r\n\t\t\tcontainer.appendChild(el);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\thasClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\treturn el.classList.contains(name);\r\n\t\t}\r\n\t\tvar className = L.DomUtil._getClass(el);\r\n\t\treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n\t},\r\n\r\n\taddClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tvar classes = L.Util.splitWords(name);\r\n\t\t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n\t\t\t\tel.classList.add(classes[i]);\r\n\t\t\t}\r\n\t\t} else if (!L.DomUtil.hasClass(el, name)) {\r\n\t\t\tvar className = L.DomUtil._getClass(el);\r\n\t\t\tL.DomUtil._setClass(el, (className ? className + ' ' : '') + name);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tel.classList.remove(name);\r\n\t\t} else {\r\n\t\t\tL.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n\t\t}\r\n\t},\r\n\r\n\t_setClass: function (el, name) {\r\n\t\tif (el.className.baseVal === undefined) {\r\n\t\t\tel.className = name;\r\n\t\t} else {\r\n\t\t\t// in case of SVG element\r\n\t\t\tel.className.baseVal = name;\r\n\t\t}\r\n\t},\r\n\r\n\t_getClass: function (el) {\r\n\t\treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n\t},\r\n\r\n\tsetOpacity: function (el, value) {\r\n\r\n\t\tif ('opacity' in el.style) {\r\n\t\t\tel.style.opacity = value;\r\n\r\n\t\t} else if ('filter' in el.style) {\r\n\r\n\t\t\tvar filter = false,\r\n\t\t\t    filterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n\t\t\t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n\t\t\ttry {\r\n\t\t\t\tfilter = el.filters.item(filterName);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n\t\t\t\t// it isn't needed and breaks transparent pngs.\r\n\t\t\t\tif (value === 1) { return; }\r\n\t\t\t}\r\n\r\n\t\t\tvalue = Math.round(value * 100);\r\n\r\n\t\t\tif (filter) {\r\n\t\t\t\tfilter.Enabled = (value !== 100);\r\n\t\t\t\tfilter.Opacity = value;\r\n\t\t\t} else {\r\n\t\t\t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\ttestProp: function (props) {\r\n\r\n\t\tvar style = document.documentElement.style;\r\n\r\n\t\tfor (var i = 0; i < props.length; i++) {\r\n\t\t\tif (props[i] in style) {\r\n\t\t\t\treturn props[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tgetTranslateString: function (point) {\r\n\t\t// on WebKit browsers (Chrome/Safari/iOS Safari/Android) using translate3d instead of translate\r\n\t\t// makes animation smoother as it ensures HW accel is used. Firefox 13 doesn't care\r\n\t\t// (same speed either way), Opera 12 doesn't support translate3d\r\n\r\n\t\tvar is3d = L.Browser.webkit3d,\r\n\t\t    open = 'translate' + (is3d ? '3d' : '') + '(',\r\n\t\t    close = (is3d ? ',0' : '') + ')';\r\n\r\n\t\treturn open + point.x + 'px,' + point.y + 'px' + close;\r\n\t},\r\n\r\n\tgetScaleString: function (scale, origin) {\r\n\r\n\t\tvar preTranslateStr = L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1 * scale))),\r\n\t\t    scaleStr = ' scale(' + scale + ') ';\r\n\r\n\t\treturn preTranslateStr + scaleStr;\r\n\t},\r\n\r\n\tsetPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])\r\n\r\n\t\t// jshint camelcase: false\r\n\t\tel._leaflet_pos = point;\r\n\r\n\t\tif (!disable3D && L.Browser.any3d) {\r\n\t\t\tel.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(point);\r\n\t\t} else {\r\n\t\t\tel.style.left = point.x + 'px';\r\n\t\t\tel.style.top = point.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\tgetPosition: function (el) {\r\n\t\t// this method is only used for elements previously positioned using setPosition,\r\n\t\t// so it's safe to cache the position for performance\r\n\r\n\t\t// jshint camelcase: false\r\n\t\treturn el._leaflet_pos;\r\n\t}\r\n};\r\n\r\n\r\n// prefix style property names\r\n\r\nL.DomUtil.TRANSFORM = L.DomUtil.testProp(\r\n        ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n// the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\nL.DomUtil.TRANSITION = L.DomUtil.testProp(\r\n        ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\nL.DomUtil.TRANSITION_END =\r\n        L.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?\r\n        L.DomUtil.TRANSITION + 'End' : 'transitionend';\r\n\r\n(function () {\r\n    if ('onselectstart' in document) {\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);\r\n            }\r\n        });\r\n    } else {\r\n        var userSelectProperty = L.DomUtil.testProp(\r\n            ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    var style = document.documentElement.style;\r\n                    this._userSelect = style[userSelectProperty];\r\n                    style[userSelectProperty] = 'none';\r\n                }\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    document.documentElement.style[userSelectProperty] = this._userSelect;\r\n                    delete this._userSelect;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\tL.extend(L.DomUtil, {\r\n\t\tdisableImageDrag: function () {\r\n\t\t\tL.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t},\r\n\r\n\t\tenableImageDrag: function () {\r\n\t\t\tL.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t}\r\n\t});\r\n})();\r\n\r\n\r\n/*\r\n * L.LatLng represents a geographical point with latitude and longitude coordinates.\r\n */\r\n\r\nL.LatLng = function (lat, lng, alt) { // (Number, Number, Number)\r\n\tlat = parseFloat(lat);\r\n\tlng = parseFloat(lng);\r\n\r\n\tif (isNaN(lat) || isNaN(lng)) {\r\n\t\tthrow new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');\r\n\t}\r\n\r\n\tthis.lat = lat;\r\n\tthis.lng = lng;\r\n\r\n\tif (alt !== undefined) {\r\n\t\tthis.alt = parseFloat(alt);\r\n\t}\r\n};\r\n\r\nL.extend(L.LatLng, {\r\n\tDEG_TO_RAD: Math.PI / 180,\r\n\tRAD_TO_DEG: 180 / Math.PI,\r\n\tMAX_MARGIN: 1.0E-9 // max margin of error for the \"equals\" check\r\n});\r\n\r\nL.LatLng.prototype = {\r\n\tequals: function (obj) { // (LatLng) -> Boolean\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tobj = L.latLng(obj);\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.lat - obj.lat),\r\n\t\t        Math.abs(this.lng - obj.lng));\r\n\r\n\t\treturn margin <= L.LatLng.MAX_MARGIN;\r\n\t},\r\n\r\n\ttoString: function (precision) { // (Number) -> String\r\n\t\treturn 'LatLng(' +\r\n\t\t        L.Util.formatNum(this.lat, precision) + ', ' +\r\n\t\t        L.Util.formatNum(this.lng, precision) + ')';\r\n\t},\r\n\r\n\t// Haversine distance formula, see http://en.wikipedia.org/wiki/Haversine_formula\r\n\t// TODO move to projection code, LatLng shouldn't know about Earth\r\n\tdistanceTo: function (other) { // (LatLng) -> Number\r\n\t\tother = L.latLng(other);\r\n\r\n\t\tvar R = 6378137, // earth radius in meters\r\n\t\t    d2r = L.LatLng.DEG_TO_RAD,\r\n\t\t    dLat = (other.lat - this.lat) * d2r,\r\n\t\t    dLon = (other.lng - this.lng) * d2r,\r\n\t\t    lat1 = this.lat * d2r,\r\n\t\t    lat2 = other.lat * d2r,\r\n\t\t    sin1 = Math.sin(dLat / 2),\r\n\t\t    sin2 = Math.sin(dLon / 2);\r\n\r\n\t\tvar a = sin1 * sin1 + sin2 * sin2 * Math.cos(lat1) * Math.cos(lat2);\r\n\r\n\t\treturn R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t},\r\n\r\n\twrap: function (a, b) { // (Number, Number) -> LatLng\r\n\t\tvar lng = this.lng;\r\n\r\n\t\ta = a || -180;\r\n\t\tb = b ||  180;\r\n\r\n\t\tlng = (lng + b) % (b - a) + (lng < a || lng === b ? b : a);\r\n\r\n\t\treturn new L.LatLng(this.lat, lng);\r\n\t}\r\n};\r\n\r\nL.latLng = function (a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)\r\n\tif (a instanceof L.LatLng) {\r\n\t\treturn a;\r\n\t}\r\n\tif (L.Util.isArray(a)) {\r\n\t\tif (typeof a[0] === 'number' || typeof a[0] === 'string') {\r\n\t\t\treturn new L.LatLng(a[0], a[1], a[2]);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tif (a === undefined || a === null) {\r\n\t\treturn a;\r\n\t}\r\n\tif (typeof a === 'object' && 'lat' in a) {\r\n\t\treturn new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);\r\n\t}\r\n\tif (b === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\treturn new L.LatLng(a, b);\r\n};\r\n\r\n\r\n\r\n/*\r\n * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.\r\n */\r\n\r\nL.LatLngBounds = function (southWest, northEast) { // (LatLng, LatLng) or (LatLng[])\r\n\tif (!southWest) { return; }\r\n\r\n\tvar latlngs = northEast ? [southWest, northEast] : southWest;\r\n\r\n\tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n\t\tthis.extend(latlngs[i]);\r\n\t}\r\n};\r\n\r\nL.LatLngBounds.prototype = {\r\n\t// extend the bounds to contain the given point or bounds\r\n\textend: function (obj) { // (LatLng) or (LatLngBounds)\r\n\t\tif (!obj) { return this; }\r\n\r\n\t\tvar latLng = L.latLng(obj);\r\n\t\tif (latLng !== null) {\r\n\t\t\tobj = latLng;\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.LatLng) {\r\n\t\t\tif (!this._southWest && !this._northEast) {\r\n\t\t\t\tthis._southWest = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t\tthis._northEast = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t} else {\r\n\t\t\t\tthis._southWest.lat = Math.min(obj.lat, this._southWest.lat);\r\n\t\t\t\tthis._southWest.lng = Math.min(obj.lng, this._southWest.lng);\r\n\r\n\t\t\t\tthis._northEast.lat = Math.max(obj.lat, this._northEast.lat);\r\n\t\t\t\tthis._northEast.lng = Math.max(obj.lng, this._northEast.lng);\r\n\t\t\t}\r\n\t\t} else if (obj instanceof L.LatLngBounds) {\r\n\t\t\tthis.extend(obj._southWest);\r\n\t\t\tthis.extend(obj._northEast);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// extend the bounds by a percentage\r\n\tpad: function (bufferRatio) { // (Number) -> LatLngBounds\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,\r\n\t\t    widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        new L.LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),\r\n\t\t        new L.LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));\r\n\t},\r\n\r\n\tgetCenter: function () { // -> LatLng\r\n\t\treturn new L.LatLng(\r\n\t\t        (this._southWest.lat + this._northEast.lat) / 2,\r\n\t\t        (this._southWest.lng + this._northEast.lng) / 2);\r\n\t},\r\n\r\n\tgetSouthWest: function () {\r\n\t\treturn this._southWest;\r\n\t},\r\n\r\n\tgetNorthEast: function () {\r\n\t\treturn this._northEast;\r\n\t},\r\n\r\n\tgetNorthWest: function () {\r\n\t\treturn new L.LatLng(this.getNorth(), this.getWest());\r\n\t},\r\n\r\n\tgetSouthEast: function () {\r\n\t\treturn new L.LatLng(this.getSouth(), this.getEast());\r\n\t},\r\n\r\n\tgetWest: function () {\r\n\t\treturn this._southWest.lng;\r\n\t},\r\n\r\n\tgetSouth: function () {\r\n\t\treturn this._southWest.lat;\r\n\t},\r\n\r\n\tgetEast: function () {\r\n\t\treturn this._northEast.lng;\r\n\t},\r\n\r\n\tgetNorth: function () {\r\n\t\treturn this._northEast.lat;\r\n\t},\r\n\r\n\tcontains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.LatLng) {\r\n\t\t\tobj = L.latLng(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2, ne2;\r\n\r\n\t\tif (obj instanceof L.LatLngBounds) {\r\n\t\t\tsw2 = obj.getSouthWest();\r\n\t\t\tne2 = obj.getNorthEast();\r\n\t\t} else {\r\n\t\t\tsw2 = ne2 = obj;\r\n\t\t}\r\n\r\n\t\treturn (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\r\n\t\t       (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (LatLngBounds)\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2 = bounds.getSouthWest(),\r\n\t\t    ne2 = bounds.getNorthEast(),\r\n\r\n\t\t    latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),\r\n\t\t    lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\r\n\r\n\t\treturn latIntersects && lngIntersects;\r\n\t},\r\n\r\n\ttoBBoxString: function () {\r\n\t\treturn [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\r\n\t},\r\n\r\n\tequals: function (bounds) { // (LatLngBounds)\r\n\t\tif (!bounds) { return false; }\r\n\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\treturn this._southWest.equals(bounds.getSouthWest()) &&\r\n\t\t       this._northEast.equals(bounds.getNorthEast());\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this._southWest && this._northEast);\r\n\t}\r\n};\r\n\r\n//TODO International date line?\r\n\r\nL.latLngBounds = function (a, b) { // (LatLngBounds) or (LatLng, LatLng)\r\n\tif (!a || a instanceof L.LatLngBounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.LatLngBounds(a, b);\r\n};\r\n\r\n\r\n/*\r\n * L.Projection contains various geographical projections used by CRS classes.\r\n */\r\n\r\nL.Projection = {};\r\n\r\n\r\n/*\r\n * Spherical Mercator is the most popular map projection, used by EPSG:3857 CRS used by default.\r\n */\r\n\r\nL.Projection.SphericalMercator = {\r\n\tMAX_LATITUDE: 85.0511287798,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    x = latlng.lng * d,\r\n\t\t    y = lat * d;\r\n\r\n\t\ty = Math.log(Math.tan((Math.PI / 4) + (y / 2)));\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    lng = point.x * d,\r\n\t\t    lat = (2 * Math.atan(Math.exp(point.y)) - (Math.PI / 2)) * d;\r\n\r\n\t\treturn new L.LatLng(lat, lng);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * Simple equirectangular (Plate Carree) projection, used by CRS like EPSG:4326 and Simple.\r\n */\r\n\r\nL.Projection.LonLat = {\r\n\tproject: function (latlng) {\r\n\t\treturn new L.Point(latlng.lng, latlng.lat);\r\n\t},\r\n\r\n\tunproject: function (point) {\r\n\t\treturn new L.LatLng(point.y, point.x);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * L.CRS is a base object for all defined CRS (Coordinate Reference Systems) in Leaflet.\r\n */\r\n\r\nL.CRS = {\r\n\tlatLngToPoint: function (latlng, zoom) { // (LatLng, Number) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    scale = this.scale(zoom);\r\n\r\n\t\treturn this.transformation._transform(projectedPoint, scale);\r\n\t},\r\n\r\n\tpointToLatLng: function (point, zoom) { // (Point, Number[, Boolean]) -> LatLng\r\n\t\tvar scale = this.scale(zoom),\r\n\t\t    untransformedPoint = this.transformation.untransform(point, scale);\r\n\r\n\t\treturn this.projection.unproject(untransformedPoint);\r\n\t},\r\n\r\n\tproject: function (latlng) {\r\n\t\treturn this.projection.project(latlng);\r\n\t},\r\n\r\n\tscale: function (zoom) {\r\n\t\treturn 256 * Math.pow(2, zoom);\r\n\t},\r\n\r\n\tgetSize: function (zoom) {\r\n\t\tvar s = this.scale(zoom);\r\n\t\treturn L.point(s, s);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.\r\n */\r\n\r\nL.CRS.Simple = L.extend({}, L.CRS, {\r\n\tprojection: L.Projection.LonLat,\r\n\ttransformation: new L.Transformation(1, 0, -1, 0),\r\n\r\n\tscale: function (zoom) {\r\n\t\treturn Math.pow(2, zoom);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.CRS.EPSG3857 (Spherical Mercator) is the most common CRS for web mapping\r\n * and is used by Leaflet by default.\r\n */\r\n\r\nL.CRS.EPSG3857 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3857',\r\n\r\n\tprojection: L.Projection.SphericalMercator,\r\n\ttransformation: new L.Transformation(0.5 / Math.PI, 0.5, -0.5 / Math.PI, 0.5),\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    earthRadius = 6378137;\r\n\t\treturn projectedPoint.multiplyBy(earthRadius);\r\n\t}\r\n});\r\n\r\nL.CRS.EPSG900913 = L.extend({}, L.CRS.EPSG3857, {\r\n\tcode: 'EPSG:900913'\r\n});\r\n\r\n\r\n/*\r\n * L.CRS.EPSG4326 is a CRS popular among advanced GIS specialists.\r\n */\r\n\r\nL.CRS.EPSG4326 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:4326',\r\n\r\n\tprojection: L.Projection.LonLat,\r\n\ttransformation: new L.Transformation(1 / 360, 0.5, -1 / 360, 0.5)\r\n});\r\n\r\n\r\n/*\r\n * L.Map is the central class of the API - it is used to create a map.\r\n */\r\n\r\nL.Map = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tcrs: L.CRS.EPSG3857,\r\n\r\n\t\t/*\r\n\t\tcenter: LatLng,\r\n\t\tzoom: Number,\r\n\t\tlayers: Array,\r\n\t\t*/\r\n\r\n\t\tfadeAnimation: L.DomUtil.TRANSITION && !L.Browser.android23,\r\n\t\ttrackResize: true,\r\n\t\tmarkerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d\r\n\t},\r\n\r\n\tinitialize: function (id, options) { // (HTMLElement or String, Object)\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\r\n\t\tthis._initContainer(id);\r\n\t\tthis._initLayout();\r\n\r\n\t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\r\n\t\tthis._onResize = L.bind(this._onResize, this);\r\n\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (options.maxBounds) {\r\n\t\t\tthis.setMaxBounds(options.maxBounds);\r\n\t\t}\r\n\r\n\t\tif (options.center && options.zoom !== undefined) {\r\n\t\t\tthis.setView(L.latLng(options.center), options.zoom, {reset: true});\r\n\t\t}\r\n\r\n\t\tthis._handlers = [];\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._zoomBoundLayers = {};\r\n\t\tthis._tileLayersNum = 0;\r\n\r\n\t\tthis.callInitHooks();\r\n\r\n\t\tthis._addLayers(options.layers);\r\n\t},\r\n\r\n\r\n\t// public methods that modify map state\r\n\r\n\t// replaced by animation-powered implementation in Map.PanAnimation.js\r\n\tsetView: function (center, zoom) {\r\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\r\n\t\tthis._resetView(L.latLng(center), this._limitZoom(zoom));\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZoom: function (zoom, options) {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthis._zoom = this._limitZoom(zoom);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn this.setView(this.getCenter(), zoom, {zoom: options});\r\n\t},\r\n\r\n\tzoomIn: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom + (delta || 1), options);\r\n\t},\r\n\r\n\tzoomOut: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom - (delta || 1), options);\r\n\t},\r\n\r\n\tsetZoomAround: function (latlng, zoom, options) {\r\n\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    containerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPoint(latlng),\r\n\r\n\t\t    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\r\n\t\t    newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));\r\n\r\n\t\treturn this.setView(newCenter, zoom, {zoom: options});\r\n\t},\r\n\r\n\tfitBounds: function (bounds, options) {\r\n\r\n\t\toptions = options || {};\r\n\t\tbounds = bounds.getBounds ? bounds.getBounds() : L.latLngBounds(bounds);\r\n\r\n\t\tvar paddingTL = L.point(options.paddingTopLeft || options.padding || [0, 0]),\r\n\t\t    paddingBR = L.point(options.paddingBottomRight || options.padding || [0, 0]),\r\n\r\n\t\t    zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR)),\r\n\t\t    paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),\r\n\r\n\t\t    swPoint = this.project(bounds.getSouthWest(), zoom),\r\n\t\t    nePoint = this.project(bounds.getNorthEast(), zoom),\r\n\t\t    center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);\r\n\r\n\t\tzoom = options && options.maxZoom ? Math.min(options.maxZoom, zoom) : zoom;\r\n\r\n\t\treturn this.setView(center, zoom, options);\r\n\t},\r\n\r\n\tfitWorld: function (options) {\r\n\t\treturn this.fitBounds([[-90, -180], [90, 180]], options);\r\n\t},\r\n\r\n\tpanTo: function (center, options) { // (LatLng)\r\n\t\treturn this.setView(center, this._zoom, {pan: options});\r\n\t},\r\n\r\n\tpanBy: function (offset) { // (Point)\r\n\t\t// replaced with animated panBy in Map.PanAnimation.js\r\n\t\tthis.fire('movestart');\r\n\r\n\t\tthis._rawPanBy(L.point(offset));\r\n\r\n\t\tthis.fire('move');\r\n\t\treturn this.fire('moveend');\r\n\t},\r\n\r\n\tsetMaxBounds: function (bounds) {\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tthis.options.maxBounds = bounds;\r\n\r\n\t\tif (!bounds) {\r\n\t\t\treturn this.off('moveend', this._panInsideMaxBounds, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._panInsideMaxBounds();\r\n\t\t}\r\n\r\n\t\treturn this.on('moveend', this._panInsideMaxBounds, this);\r\n\t},\r\n\r\n\tpanInsideBounds: function (bounds, options) {\r\n\t\tvar center = this.getCenter(),\r\n\t\t\tnewCenter = this._limitCenter(center, this._zoom, bounds);\r\n\r\n\t\tif (center.equals(newCenter)) { return this; }\r\n\r\n\t\treturn this.panTo(newCenter, options);\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\t// TODO method is too big, refactor\r\n\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (this._layers[id]) { return this; }\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\t// TODO getMaxZoom, getMinZoom in ILayer (instead of options)\r\n\t\tif (layer.options && (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom))) {\r\n\t\t\tthis._zoomBoundLayers[id] = layer;\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor!!!\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum++;\r\n\t\t\tthis._tileLayersToLoad++;\r\n\t\t\tlayer.on('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._layerAdd(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (!this._layers[id]) { return this; }\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tlayer.onRemove(this);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('layerremove', {layer: layer});\r\n\t\t}\r\n\r\n\t\tif (this._zoomBoundLayers[id]) {\r\n\t\t\tdelete this._zoomBoundLayers[id];\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum--;\r\n\t\t\tthis._tileLayersToLoad--;\r\n\t\t\tlayer.off('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (L.stamp(layer) in this._layers);\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvalidateSize: function (options) {\r\n\t\tif (!this._loaded) { return this; }\r\n\r\n\t\toptions = L.extend({\r\n\t\t\tanimate: false,\r\n\t\t\tpan: true\r\n\t\t}, options === true ? {animate: true} : options);\r\n\r\n\t\tvar oldSize = this.getSize();\r\n\t\tthis._sizeChanged = true;\r\n\t\tthis._initialCenter = null;\r\n\r\n\t\tvar newSize = this.getSize(),\r\n\t\t    oldCenter = oldSize.divideBy(2).round(),\r\n\t\t    newCenter = newSize.divideBy(2).round(),\r\n\t\t    offset = oldCenter.subtract(newCenter);\r\n\r\n\t\tif (!offset.x && !offset.y) { return this; }\r\n\r\n\t\tif (options.animate && options.pan) {\r\n\t\t\tthis.panBy(offset);\r\n\r\n\t\t} else {\r\n\t\t\tif (options.pan) {\r\n\t\t\t\tthis._rawPanBy(offset);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('move');\r\n\r\n\t\t\tif (options.debounceMoveend) {\r\n\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\tthis._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);\r\n\t\t\t} else {\r\n\t\t\t\tthis.fire('moveend');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.fire('resize', {\r\n\t\t\toldSize: oldSize,\r\n\t\t\tnewSize: newSize\r\n\t\t});\r\n\t},\r\n\r\n\t// TODO handler.addTo\r\n\taddHandler: function (name, HandlerClass) {\r\n\t\tif (!HandlerClass) { return this; }\r\n\r\n\t\tvar handler = this[name] = new HandlerClass(this);\r\n\r\n\t\tthis._handlers.push(handler);\r\n\r\n\t\tif (this.options[name]) {\r\n\t\t\thandler.enable();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremove: function () {\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('unload');\r\n\t\t}\r\n\r\n\t\tthis._initEvents('off');\r\n\r\n\t\ttry {\r\n\t\t\t// throws error in IE6-8\r\n\t\t\tdelete this._container._leaflet;\r\n\t\t} catch (e) {\r\n\t\t\tthis._container._leaflet = undefined;\r\n\t\t}\r\n\r\n\t\tthis._clearPanes();\r\n\t\tif (this._clearControlPos) {\r\n\t\t\tthis._clearControlPos();\r\n\t\t}\r\n\r\n\t\tthis._clearHandlers();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\r\n\t// public methods for getting map state\r\n\r\n\tgetCenter: function () { // (Boolean) -> LatLng\r\n\t\tthis._checkIfLoaded();\r\n\r\n\t\tif (this._initialCenter && !this._moved()) {\r\n\t\t\treturn this._initialCenter;\r\n\t\t}\r\n\t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\tgetZoom: function () {\r\n\t\treturn this._zoom;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = this.getPixelBounds(),\r\n\t\t    sw = this.unproject(bounds.getBottomLeft()),\r\n\t\t    ne = this.unproject(bounds.getTopRight());\r\n\r\n\t\treturn new L.LatLngBounds(sw, ne);\r\n\t},\r\n\r\n\tgetMinZoom: function () {\r\n\t\treturn this.options.minZoom === undefined ?\r\n\t\t\t(this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :\r\n\t\t\tthis.options.minZoom;\r\n\t},\r\n\r\n\tgetMaxZoom: function () {\r\n\t\treturn this.options.maxZoom === undefined ?\r\n\t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\r\n\t\t\tthis.options.maxZoom;\r\n\t},\r\n\r\n\tgetBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar zoom = this.getMinZoom() - (inside ? 1 : 0),\r\n\t\t    maxZoom = this.getMaxZoom(),\r\n\t\t    size = this.getSize(),\r\n\r\n\t\t    nw = bounds.getNorthWest(),\r\n\t\t    se = bounds.getSouthEast(),\r\n\r\n\t\t    zoomNotFound = true,\r\n\t\t    boundsSize;\r\n\r\n\t\tpadding = L.point(padding || [0, 0]);\r\n\r\n\t\tdo {\r\n\t\t\tzoom++;\r\n\t\t\tboundsSize = this.project(se, zoom).subtract(this.project(nw, zoom)).add(padding);\r\n\t\t\tzoomNotFound = !inside ? size.contains(boundsSize) : boundsSize.x < size.x || boundsSize.y < size.y;\r\n\r\n\t\t} while (zoomNotFound && zoom <= maxZoom);\r\n\r\n\t\tif (zoomNotFound && inside) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn inside ? zoom : zoom - 1;\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\tif (!this._size || this._sizeChanged) {\r\n\t\t\tthis._size = new L.Point(\r\n\t\t\t\tthis._container.clientWidth,\r\n\t\t\t\tthis._container.clientHeight);\r\n\r\n\t\t\tthis._sizeChanged = false;\r\n\t\t}\r\n\t\treturn this._size.clone();\r\n\t},\r\n\r\n\tgetPixelBounds: function () {\r\n\t\tvar topLeftPoint = this._getTopLeftPoint();\r\n\t\treturn new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\r\n\t},\r\n\r\n\tgetPixelOrigin: function () {\r\n\t\tthis._checkIfLoaded();\r\n\t\treturn this._initialTopLeftPoint;\r\n\t},\r\n\r\n\tgetPanes: function () {\r\n\t\treturn this._panes;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\r\n\t// TODO replace with universal implementation after refactoring projections\r\n\r\n\tgetZoomScale: function (toZoom) {\r\n\t\tvar crs = this.options.crs;\r\n\t\treturn crs.scale(toZoom) / crs.scale(this._zoom);\r\n\t},\r\n\r\n\tgetScaleZoom: function (scale) {\r\n\t\treturn this._zoom + (Math.log(scale) / Math.LN2);\r\n\t},\r\n\r\n\r\n\t// conversion methods\r\n\r\n\tproject: function (latlng, zoom) { // (LatLng[, Number]) -> Point\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.latLngToPoint(L.latLng(latlng), zoom);\r\n\t},\r\n\r\n\tunproject: function (point, zoom) { // (Point[, Number]) -> LatLng\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.pointToLatLng(L.point(point), zoom);\r\n\t},\r\n\r\n\tlayerPointToLatLng: function (point) { // (Point)\r\n\t\tvar projectedPoint = L.point(point).add(this.getPixelOrigin());\r\n\t\treturn this.unproject(projectedPoint);\r\n\t},\r\n\r\n\tlatLngToLayerPoint: function (latlng) { // (LatLng)\r\n\t\tvar projectedPoint = this.project(L.latLng(latlng))._round();\r\n\t\treturn projectedPoint._subtract(this.getPixelOrigin());\r\n\t},\r\n\r\n\tcontainerPointToLayerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\tlayerPointToContainerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).add(this._getMapPanePos());\r\n\t},\r\n\r\n\tcontainerPointToLatLng: function (point) {\r\n\t\tvar layerPoint = this.containerPointToLayerPoint(L.point(point));\r\n\t\treturn this.layerPointToLatLng(layerPoint);\r\n\t},\r\n\r\n\tlatLngToContainerPoint: function (latlng) {\r\n\t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));\r\n\t},\r\n\r\n\tmouseEventToContainerPoint: function (e) { // (MouseEvent)\r\n\t\treturn L.DomEvent.getMousePosition(e, this._container);\r\n\t},\r\n\r\n\tmouseEventToLayerPoint: function (e) { // (MouseEvent)\r\n\t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\r\n\t},\r\n\r\n\tmouseEventToLatLng: function (e) { // (MouseEvent)\r\n\t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\r\n\t},\r\n\r\n\r\n\t// map initialization methods\r\n\r\n\t_initContainer: function (id) {\r\n\t\tvar container = this._container = L.DomUtil.get(id);\r\n\r\n\t\tif (!container) {\r\n\t\t\tthrow new Error('Map container not found.');\r\n\t\t} else if (container._leaflet) {\r\n\t\t\tthrow new Error('Map container is already initialized.');\r\n\t\t}\r\n\r\n\t\tcontainer._leaflet = true;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar container = this._container;\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-container' +\r\n\t\t\t(L.Browser.touch ? ' leaflet-touch' : '') +\r\n\t\t\t(L.Browser.retina ? ' leaflet-retina' : '') +\r\n\t\t\t(L.Browser.ielt9 ? ' leaflet-oldie' : '') +\r\n\t\t\t(this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));\r\n\r\n\t\tvar position = L.DomUtil.getStyle(container, 'position');\r\n\r\n\t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {\r\n\t\t\tcontainer.style.position = 'relative';\r\n\t\t}\r\n\r\n\t\tthis._initPanes();\r\n\r\n\t\tif (this._initControlPos) {\r\n\t\t\tthis._initControlPos();\r\n\t\t}\r\n\t},\r\n\r\n\t_initPanes: function () {\r\n\t\tvar panes = this._panes = {};\r\n\r\n\t\tthis._mapPane = panes.mapPane = this._createPane('leaflet-map-pane', this._container);\r\n\r\n\t\tthis._tilePane = panes.tilePane = this._createPane('leaflet-tile-pane', this._mapPane);\r\n\t\tpanes.objectsPane = this._createPane('leaflet-objects-pane', this._mapPane);\r\n\t\tpanes.shadowPane = this._createPane('leaflet-shadow-pane');\r\n\t\tpanes.overlayPane = this._createPane('leaflet-overlay-pane');\r\n\t\tpanes.markerPane = this._createPane('leaflet-marker-pane');\r\n\t\tpanes.popupPane = this._createPane('leaflet-popup-pane');\r\n\r\n\t\tvar zoomHide = ' leaflet-zoom-hide';\r\n\r\n\t\tif (!this.options.markerZoomAnimation) {\r\n\t\t\tL.DomUtil.addClass(panes.markerPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.shadowPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.popupPane, zoomHide);\r\n\t\t}\r\n\t},\r\n\r\n\t_createPane: function (className, container) {\r\n\t\treturn L.DomUtil.create('div', className, container || this._panes.objectsPane);\r\n\t},\r\n\r\n\t_clearPanes: function () {\r\n\t\tthis._container.removeChild(this._mapPane);\r\n\t},\r\n\r\n\t_addLayers: function (layers) {\r\n\t\tlayers = layers ? (L.Util.isArray(layers) ? layers : [layers]) : [];\r\n\r\n\t\tfor (var i = 0, len = layers.length; i < len; i++) {\r\n\t\t\tthis.addLayer(layers[i]);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// private methods that modify map state\r\n\r\n\t_resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {\r\n\r\n\t\tvar zoomChanged = (this._zoom !== zoom);\r\n\r\n\t\tif (!afterZoomAnim) {\r\n\t\t\tthis.fire('movestart');\r\n\r\n\t\t\tif (zoomChanged) {\r\n\t\t\t\tthis.fire('zoomstart');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._zoom = zoom;\r\n\t\tthis._initialCenter = center;\r\n\r\n\t\tthis._initialTopLeftPoint = this._getNewTopLeftPoint(center);\r\n\r\n\t\tif (!preserveMapOffset) {\r\n\t\t\tL.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));\r\n\t\t} else {\r\n\t\t\tthis._initialTopLeftPoint._add(this._getMapPanePos());\r\n\t\t}\r\n\r\n\t\tthis._tileLayersToLoad = this._tileLayersNum;\r\n\r\n\t\tvar loading = !this._loaded;\r\n\t\tthis._loaded = true;\r\n\r\n\t\tthis.fire('viewreset', {hard: !preserveMapOffset});\r\n\r\n\t\tif (loading) {\r\n\t\t\tthis.fire('load');\r\n\t\t\tthis.eachLayer(this._layerAdd, this);\r\n\t\t}\r\n\r\n\t\tthis.fire('move');\r\n\r\n\t\tif (zoomChanged || afterZoomAnim) {\r\n\t\t\tthis.fire('zoomend');\r\n\t\t}\r\n\r\n\t\tthis.fire('moveend', {hard: !preserveMapOffset});\r\n\t},\r\n\r\n\t_rawPanBy: function (offset) {\r\n\t\tL.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));\r\n\t},\r\n\r\n\t_getZoomSpan: function () {\r\n\t\treturn this.getMaxZoom() - this.getMinZoom();\r\n\t},\r\n\r\n\t_updateZoomLevels: function () {\r\n\t\tvar i,\r\n\t\t\tminZoom = Infinity,\r\n\t\t\tmaxZoom = -Infinity,\r\n\t\t\toldZoomSpan = this._getZoomSpan();\r\n\r\n\t\tfor (i in this._zoomBoundLayers) {\r\n\t\t\tvar layer = this._zoomBoundLayers[i];\r\n\t\t\tif (!isNaN(layer.options.minZoom)) {\r\n\t\t\t\tminZoom = Math.min(minZoom, layer.options.minZoom);\r\n\t\t\t}\r\n\t\t\tif (!isNaN(layer.options.maxZoom)) {\r\n\t\t\t\tmaxZoom = Math.max(maxZoom, layer.options.maxZoom);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (i === undefined) { // we have no tilelayers\r\n\t\t\tthis._layersMaxZoom = this._layersMinZoom = undefined;\r\n\t\t} else {\r\n\t\t\tthis._layersMaxZoom = maxZoom;\r\n\t\t\tthis._layersMinZoom = minZoom;\r\n\t\t}\r\n\r\n\t\tif (oldZoomSpan !== this._getZoomSpan()) {\r\n\t\t\tthis.fire('zoomlevelschange');\r\n\t\t}\r\n\t},\r\n\r\n\t_panInsideMaxBounds: function () {\r\n\t\tthis.panInsideBounds(this.options.maxBounds);\r\n\t},\r\n\r\n\t_checkIfLoaded: function () {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthrow new Error('Set map center and zoom first.');\r\n\t\t}\r\n\t},\r\n\r\n\t// map events\r\n\r\n\t_initEvents: function (onOff) {\r\n\t\tif (!L.DomEvent) { return; }\r\n\r\n\t\tonOff = onOff || 'on';\r\n\r\n\t\tL.DomEvent[onOff](this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\tvar events = ['dblclick', 'mousedown', 'mouseup', 'mouseenter',\r\n\t\t              'mouseleave', 'mousemove', 'contextmenu'],\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = events.length; i < len; i++) {\r\n\t\t\tL.DomEvent[onOff](this._container, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (this.options.trackResize) {\r\n\t\t\tL.DomEvent[onOff](window, 'resize', this._onResize, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onResize: function () {\r\n\t\tL.Util.cancelAnimFrame(this._resizeRequest);\r\n\t\tthis._resizeRequest = L.Util.requestAnimFrame(\r\n\t\t        function () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (!this._loaded || (!e._simulated &&\r\n\t\t        ((this.dragging && this.dragging.moved()) ||\r\n\t\t         (this.boxZoom  && this.boxZoom.moved()))) ||\r\n\t\t            L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tthis.fire('preclick');\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this._loaded || L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tvar type = e.type;\r\n\r\n\t\ttype = (type === 'mouseenter' ? 'mouseover' : (type === 'mouseleave' ? 'mouseout' : type));\r\n\r\n\t\tif (!this.hasEventListeners(type)) { return; }\r\n\r\n\t\tif (type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\r\n\t\tvar containerPoint = this.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = this.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = this.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\t},\r\n\r\n\t_onTileLayerLoad: function () {\r\n\t\tthis._tileLayersToLoad--;\r\n\t\tif (this._tileLayersNum && !this._tileLayersToLoad) {\r\n\t\t\tthis.fire('tilelayersload');\r\n\t\t}\r\n\t},\r\n\r\n\t_clearHandlers: function () {\r\n\t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\r\n\t\t\tthis._handlers[i].disable();\r\n\t\t}\r\n\t},\r\n\r\n\twhenReady: function (callback, context) {\r\n\t\tif (this._loaded) {\r\n\t\t\tcallback.call(context || this, this);\r\n\t\t} else {\r\n\t\t\tthis.on('load', callback, context);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_layerAdd: function (layer) {\r\n\t\tlayer.onAdd(this);\r\n\t\tthis.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\r\n\t// private methods for getting map state\r\n\r\n\t_getMapPanePos: function () {\r\n\t\treturn L.DomUtil.getPosition(this._mapPane);\r\n\t},\r\n\r\n\t_moved: function () {\r\n\t\tvar pos = this._getMapPanePos();\r\n\t\treturn pos && !pos.equals([0, 0]);\r\n\t},\r\n\r\n\t_getTopLeftPoint: function () {\r\n\t\treturn this.getPixelOrigin().subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\t_getNewTopLeftPoint: function (center, zoom) {\r\n\t\tvar viewHalf = this.getSize()._divideBy(2);\r\n\t\t// TODO round on display, not calculation to increase precision?\r\n\t\treturn this.project(center, zoom)._subtract(viewHalf)._round();\r\n\t},\r\n\r\n\t_latLngToNewLayerPoint: function (latlng, newZoom, newCenter) {\r\n\t\tvar topLeft = this._getNewTopLeftPoint(newCenter, newZoom).add(this._getMapPanePos());\r\n\t\treturn this.project(latlng, newZoom)._subtract(topLeft);\r\n\t},\r\n\r\n\t// layer point of the current center\r\n\t_getCenterLayerPoint: function () {\r\n\t\treturn this.containerPointToLayerPoint(this.getSize()._divideBy(2));\r\n\t},\r\n\r\n\t// offset of the specified place to the current center in pixels\r\n\t_getCenterOffset: function (latlng) {\r\n\t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\t// adjust center for view to get inside bounds\r\n\t_limitCenter: function (center, zoom, bounds) {\r\n\r\n\t\tif (!bounds) { return center; }\r\n\r\n\t\tvar centerPoint = this.project(center, zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\r\n\t\t    offset = this._getBoundsOffset(viewBounds, bounds, zoom);\r\n\r\n\t\treturn this.unproject(centerPoint.add(offset), zoom);\r\n\t},\r\n\r\n\t// adjust offset for view to get inside bounds\r\n\t_limitOffset: function (offset, bounds) {\r\n\t\tif (!bounds) { return offset; }\r\n\r\n\t\tvar viewBounds = this.getPixelBounds(),\r\n\t\t    newBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));\r\n\r\n\t\treturn offset.add(this._getBoundsOffset(newBounds, bounds));\r\n\t},\r\n\r\n\t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\r\n\t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\r\n\t\tvar nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),\r\n\t\t    seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),\r\n\r\n\t\t    dx = this._rebound(nwOffset.x, -seOffset.x),\r\n\t\t    dy = this._rebound(nwOffset.y, -seOffset.y);\r\n\r\n\t\treturn new L.Point(dx, dy);\r\n\t},\r\n\r\n\t_rebound: function (left, right) {\r\n\t\treturn left + right > 0 ?\r\n\t\t\tMath.round(left - right) / 2 :\r\n\t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\r\n\t},\r\n\r\n\t_limitZoom: function (zoom) {\r\n\t\tvar min = this.getMinZoom(),\r\n\t\t    max = this.getMaxZoom();\r\n\r\n\t\treturn Math.max(min, Math.min(max, zoom));\r\n\t}\r\n});\r\n\r\nL.map = function (id, options) {\r\n\treturn new L.Map(id, options);\r\n};\r\n\r\n\r\n/*\r\n * Mercator projection that takes into account that the Earth is not a perfect sphere.\r\n * Less popular than spherical mercator; used by projections like EPSG:3395.\r\n */\r\n\r\nL.Projection.Mercator = {\r\n\tMAX_LATITUDE: 85.0840591556,\r\n\r\n\tR_MINOR: 6356752.314245179,\r\n\tR_MAJOR: 6378137,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    x = latlng.lng * d * r,\r\n\t\t    y = lat * d,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1.0 - tmp * tmp),\r\n\t\t    con = eccent * Math.sin(y);\r\n\r\n\t\tcon = Math.pow((1 - con) / (1 + con), eccent * 0.5);\r\n\r\n\t\tvar ts = Math.tan(0.5 * ((Math.PI * 0.5) - y)) / con;\r\n\t\ty = -r * Math.log(ts);\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    lng = point.x * d / r,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1 - (tmp * tmp)),\r\n\t\t    ts = Math.exp(- point.y / r),\r\n\t\t    phi = (Math.PI / 2) - 2 * Math.atan(ts),\r\n\t\t    numIter = 15,\r\n\t\t    tol = 1e-7,\r\n\t\t    i = numIter,\r\n\t\t    dphi = 0.1,\r\n\t\t    con;\r\n\r\n\t\twhile ((Math.abs(dphi) > tol) && (--i > 0)) {\r\n\t\t\tcon = eccent * Math.sin(phi);\r\n\t\t\tdphi = (Math.PI / 2) - 2 * Math.atan(ts *\r\n\t\t\t            Math.pow((1.0 - con) / (1.0 + con), 0.5 * eccent)) - phi;\r\n\t\t\tphi += dphi;\r\n\t\t}\r\n\r\n\t\treturn new L.LatLng(phi * d, lng);\r\n\t}\r\n};\r\n\r\n\r\n\r\nL.CRS.EPSG3395 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3395',\r\n\r\n\tprojection: L.Projection.Mercator,\r\n\r\n\ttransformation: (function () {\r\n\t\tvar m = L.Projection.Mercator,\r\n\t\t    r = m.R_MAJOR,\r\n\t\t    scale = 0.5 / (Math.PI * r);\r\n\r\n\t\treturn new L.Transformation(scale, 0.5, -scale, 0.5);\r\n\t}())\r\n});\r\n\r\n\r\n/*\r\n * L.TileLayer is used for standard xyz-numbered tile layers.\r\n */\r\n\r\nL.TileLayer = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminZoom: 0,\r\n\t\tmaxZoom: 18,\r\n\t\ttileSize: 256,\r\n\t\tsubdomains: 'abc',\r\n\t\terrorTileUrl: '',\r\n\t\tattribution: '',\r\n\t\tzoomOffset: 0,\r\n\t\topacity: 1,\r\n\t\t/*\r\n\t\tmaxNativeZoom: null,\r\n\t\tzIndex: null,\r\n\t\ttms: false,\r\n\t\tcontinuousWorld: false,\r\n\t\tnoWrap: false,\r\n\t\tzoomReverse: false,\r\n\t\tdetectRetina: false,\r\n\t\treuseTiles: false,\r\n\t\tbounds: false,\r\n\t\t*/\r\n\t\tunloadInvisibleTiles: L.Browser.mobile,\r\n\t\tupdateWhenIdle: L.Browser.mobile\r\n\t},\r\n\r\n\tinitialize: function (url, options) {\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\t\t// detecting retina displays, adjusting tileSize and zoom levels\r\n\t\tif (options.detectRetina && L.Browser.retina && options.maxZoom > 0) {\r\n\r\n\t\t\toptions.tileSize = Math.floor(options.tileSize / 2);\r\n\t\t\toptions.zoomOffset++;\r\n\r\n\t\t\tif (options.minZoom > 0) {\r\n\t\t\t\toptions.minZoom--;\r\n\t\t\t}\r\n\t\t\tthis.options.maxZoom--;\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\toptions.bounds = L.latLngBounds(options.bounds);\r\n\t\t}\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar subdomains = this.options.subdomains;\r\n\r\n\t\tif (typeof subdomains === 'string') {\r\n\t\t\tthis.options.subdomains = subdomains.split('');\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._animated = map._zoomAnimated;\r\n\r\n\t\t// create a container div for tiles\r\n\t\tthis._initContainer();\r\n\r\n\t\t// set up events\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.on({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tthis._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);\r\n\t\t\tmap.on('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t\tthis._update();\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis._container.parentNode.removeChild(this._container);\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.off({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tmap.off('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._container = null;\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.appendChild(this._container);\r\n\t\t\tthis._setAutoZIndex(pane, Math.max);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.insertBefore(this._container, pane.firstChild);\r\n\t\t\tthis._setAutoZIndex(pane, Math.min);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.options.zIndex = zIndex;\r\n\t\tthis._updateZIndex();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url, noRedraw) {\r\n\t\tthis._url = url;\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateZIndex: function () {\r\n\t\tif (this._container && this.options.zIndex !== undefined) {\r\n\t\t\tthis._container.style.zIndex = this.options.zIndex;\r\n\t\t}\r\n\t},\r\n\r\n\t_setAutoZIndex: function (pane, compare) {\r\n\r\n\t\tvar layers = pane.children,\r\n\t\t    edgeZIndex = -compare(Infinity, -Infinity), // -Infinity for max, Infinity for min\r\n\t\t    zIndex, i, len;\r\n\r\n\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\r\n\t\t\tif (layers[i] !== this._container) {\r\n\t\t\t\tzIndex = parseInt(layers[i].style.zIndex, 10);\r\n\r\n\t\t\t\tif (!isNaN(zIndex)) {\r\n\t\t\t\t\tedgeZIndex = compare(edgeZIndex, zIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.options.zIndex = this._container.style.zIndex =\r\n\t\t        (isFinite(edgeZIndex) ? edgeZIndex : 0) + compare(1, -1);\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tvar i,\r\n\t\t    tiles = this._tiles;\r\n\r\n\t\tif (L.Browser.ielt9) {\r\n\t\t\tfor (i in tiles) {\r\n\t\t\t\tL.DomUtil.setOpacity(tiles[i], this.options.opacity);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tL.DomUtil.setOpacity(this._container, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_initContainer: function () {\r\n\t\tvar tilePane = this._map._panes.tilePane;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-layer');\r\n\r\n\t\t\tthis._updateZIndex();\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tvar className = 'leaflet-tile-container';\r\n\r\n\t\t\t\tthis._bgBuffer = L.DomUtil.create('div', className, this._container);\r\n\t\t\t\tthis._tileContainer = L.DomUtil.create('div', className, this._container);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._tileContainer = this._container;\r\n\t\t\t}\r\n\r\n\t\t\ttilePane.appendChild(this._container);\r\n\r\n\t\t\tif (this.options.opacity < 1) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_reset: function (e) {\r\n\t\tfor (var key in this._tiles) {\r\n\t\t\tthis.fire('tileunload', {tile: this._tiles[key]});\r\n\t\t}\r\n\r\n\t\tthis._tiles = {};\r\n\t\tthis._tilesToLoad = 0;\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tthis._unusedTiles = [];\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.innerHTML = '';\r\n\r\n\t\tif (this._animated && e && e.hard) {\r\n\t\t\tthis._clearBgBuffer();\r\n\t\t}\r\n\r\n\t\tthis._initContainer();\r\n\t},\r\n\r\n\t_getTileSize: function () {\r\n\t\tvar map = this._map,\r\n\t\t    zoom = map.getZoom() + this.options.zoomOffset,\r\n\t\t    zoomN = this.options.maxNativeZoom,\r\n\t\t    tileSize = this.options.tileSize;\r\n\r\n\t\tif (zoomN && zoom > zoomN) {\r\n\t\t\ttileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);\r\n\t\t}\r\n\r\n\t\treturn tileSize;\r\n\t},\r\n\r\n\t_update: function () {\r\n\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    bounds = map.getPixelBounds(),\r\n\t\t    zoom = map.getZoom(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar tileBounds = L.bounds(\r\n\t\t        bounds.min.divideBy(tileSize)._floor(),\r\n\t\t        bounds.max.divideBy(tileSize)._floor());\r\n\r\n\t\tthis._addTilesFromCenterOut(tileBounds);\r\n\r\n\t\tif (this.options.unloadInvisibleTiles || this.options.reuseTiles) {\r\n\t\t\tthis._removeOtherTiles(tileBounds);\r\n\t\t}\r\n\t},\r\n\r\n\t_addTilesFromCenterOut: function (bounds) {\r\n\t\tvar queue = [],\r\n\t\t    center = bounds.getCenter();\r\n\r\n\t\tvar j, i, point;\r\n\r\n\t\tfor (j = bounds.min.y; j <= bounds.max.y; j++) {\r\n\t\t\tfor (i = bounds.min.x; i <= bounds.max.x; i++) {\r\n\t\t\t\tpoint = new L.Point(i, j);\r\n\r\n\t\t\t\tif (this._tileShouldBeLoaded(point)) {\r\n\t\t\t\t\tqueue.push(point);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar tilesToLoad = queue.length;\r\n\r\n\t\tif (tilesToLoad === 0) { return; }\r\n\r\n\t\t// load tiles in order of their distance to center\r\n\t\tqueue.sort(function (a, b) {\r\n\t\t\treturn a.distanceTo(center) - b.distanceTo(center);\r\n\t\t});\r\n\r\n\t\tvar fragment = document.createDocumentFragment();\r\n\r\n\t\t// if its the first batch of tiles to load\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('loading');\r\n\t\t}\r\n\r\n\t\tthis._tilesToLoad += tilesToLoad;\r\n\r\n\t\tfor (i = 0; i < tilesToLoad; i++) {\r\n\t\t\tthis._addTile(queue[i], fragment);\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.appendChild(fragment);\r\n\t},\r\n\r\n\t_tileShouldBeLoaded: function (tilePoint) {\r\n\t\tif ((tilePoint.x + ':' + tilePoint.y) in this._tiles) {\r\n\t\t\treturn false; // already loaded\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (!options.continuousWorld) {\r\n\t\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t\t// don't load if exceeds world bounds\r\n\t\t\tif ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit.x)) ||\r\n\t\t\t\ttilePoint.y < 0 || tilePoint.y >= limit.y) { return false; }\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\tvar tileSize = options.tileSize,\r\n\t\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\t\t\t    nw = this._map.unproject(nwPoint),\r\n\t\t\t    se = this._map.unproject(sePoint);\r\n\r\n\t\t\t// TODO temporary hack, will be removed after refactoring projections\r\n\t\t\t// https://github.com/Leaflet/Leaflet/issues/1618\r\n\t\t\tif (!options.continuousWorld && !options.noWrap) {\r\n\t\t\t\tnw = nw.wrap();\r\n\t\t\t\tse = se.wrap();\r\n\t\t\t}\r\n\r\n\t\t\tif (!options.bounds.intersects([nw, se])) { return false; }\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_removeOtherTiles: function (bounds) {\r\n\t\tvar kArr, x, y, key;\r\n\r\n\t\tfor (key in this._tiles) {\r\n\t\t\tkArr = key.split(':');\r\n\t\t\tx = parseInt(kArr[0], 10);\r\n\t\t\ty = parseInt(kArr[1], 10);\r\n\r\n\t\t\t// remove tile if it's out of bounds\r\n\t\t\tif (x < bounds.min.x || x > bounds.max.x || y < bounds.min.y || y > bounds.max.y) {\r\n\t\t\t\tthis._removeTile(key);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeTile: function (key) {\r\n\t\tvar tile = this._tiles[key];\r\n\r\n\t\tthis.fire('tileunload', {tile: tile, url: tile.src});\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tL.DomUtil.removeClass(tile, 'leaflet-tile-loaded');\r\n\t\t\tthis._unusedTiles.push(tile);\r\n\r\n\t\t} else if (tile.parentNode === this._tileContainer) {\r\n\t\t\tthis._tileContainer.removeChild(tile);\r\n\t\t}\r\n\r\n\t\t// for https://github.com/CloudMade/Leaflet/issues/137\r\n\t\tif (!L.Browser.android) {\r\n\t\t\ttile.onload = null;\r\n\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\t\t}\r\n\r\n\t\tdelete this._tiles[key];\r\n\t},\r\n\r\n\t_addTile: function (tilePoint, container) {\r\n\t\tvar tilePos = this._getTilePos(tilePoint);\r\n\r\n\t\t// get unused tile - or create a new tile\r\n\t\tvar tile = this._getTile();\r\n\r\n\t\t/*\r\n\t\tChrome 20 layouts much faster with top/left (verify with timeline, frames)\r\n\t\tAndroid 4 browser has display issues with top/left and requires transform instead\r\n\t\t(other browsers don't currently care) - see debug/hacks/jitter.html for an example\r\n\t\t*/\r\n\t\tL.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);\r\n\r\n\t\tthis._tiles[tilePoint.x + ':' + tilePoint.y] = tile;\r\n\r\n\t\tthis._loadTile(tile, tilePoint);\r\n\r\n\t\tif (tile.parentNode !== this._tileContainer) {\r\n\t\t\tcontainer.appendChild(tile);\r\n\t\t}\r\n\t},\r\n\r\n\t_getZoomForUrl: function () {\r\n\r\n\t\tvar options = this.options,\r\n\t\t    zoom = this._map.getZoom();\r\n\r\n\t\tif (options.zoomReverse) {\r\n\t\t\tzoom = options.maxZoom - zoom;\r\n\t\t}\r\n\r\n\t\tzoom += options.zoomOffset;\r\n\r\n\t\treturn options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;\r\n\t},\r\n\r\n\t_getTilePos: function (tilePoint) {\r\n\t\tvar origin = this._map.getPixelOrigin(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\treturn tilePoint.multiplyBy(tileSize).subtract(origin);\r\n\t},\r\n\r\n\t// image-specific code (override to implement e.g. Canvas or SVG tile layer)\r\n\r\n\tgetTileUrl: function (tilePoint) {\r\n\t\treturn L.Util.template(this._url, L.extend({\r\n\t\t\ts: this._getSubdomain(tilePoint),\r\n\t\t\tz: tilePoint.z,\r\n\t\t\tx: tilePoint.x,\r\n\t\t\ty: tilePoint.y\r\n\t\t}, this.options));\r\n\t},\r\n\r\n\t_getWrapTileNum: function () {\r\n\t\tvar crs = this._map.options.crs,\r\n\t\t    size = crs.getSize(this._map.getZoom());\r\n\t\treturn size.divideBy(this._getTileSize())._floor();\r\n\t},\r\n\r\n\t_adjustTilePoint: function (tilePoint) {\r\n\r\n\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t// wrap tile coordinates\r\n\t\tif (!this.options.continuousWorld && !this.options.noWrap) {\r\n\t\t\ttilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;\r\n\t\t}\r\n\r\n\t\tif (this.options.tms) {\r\n\t\t\ttilePoint.y = limit.y - tilePoint.y - 1;\r\n\t\t}\r\n\r\n\t\ttilePoint.z = this._getZoomForUrl();\r\n\t},\r\n\r\n\t_getSubdomain: function (tilePoint) {\r\n\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\r\n\t\treturn this.options.subdomains[index];\r\n\t},\r\n\r\n\t_getTile: function () {\r\n\t\tif (this.options.reuseTiles && this._unusedTiles.length > 0) {\r\n\t\t\tvar tile = this._unusedTiles.pop();\r\n\t\t\tthis._resetTile(tile);\r\n\t\t\treturn tile;\r\n\t\t}\r\n\t\treturn this._createTile();\r\n\t},\r\n\r\n\t// Override if data stored on a tile needs to be cleaned up before reuse\r\n\t_resetTile: function (/*tile*/) {},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('img', 'leaflet-tile');\r\n\t\ttile.style.width = tile.style.height = this._getTileSize() + 'px';\r\n\t\ttile.galleryimg = 'no';\r\n\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\r\n\t\tif (L.Browser.ielt9 && this.options.opacity !== undefined) {\r\n\t\t\tL.DomUtil.setOpacity(tile, this.options.opacity);\r\n\t\t}\r\n\t\t// without this hack, tiles disappear after zoom on Chrome for Android\r\n\t\t// https://github.com/Leaflet/Leaflet/issues/2078\r\n\t\tif (L.Browser.mobileWebkit3d) {\r\n\t\t\ttile.style.WebkitBackfaceVisibility = 'hidden';\r\n\t\t}\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer  = this;\r\n\t\ttile.onload  = this._tileOnLoad;\r\n\t\ttile.onerror = this._tileOnError;\r\n\r\n\t\tthis._adjustTilePoint(tilePoint);\r\n\t\ttile.src     = this.getTileUrl(tilePoint);\r\n\r\n\t\tthis.fire('tileloadstart', {\r\n\t\t\ttile: tile,\r\n\t\t\turl: tile.src\r\n\t\t});\r\n\t},\r\n\r\n\t_tileLoaded: function () {\r\n\t\tthis._tilesToLoad--;\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tL.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');\r\n\t\t}\r\n\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('load');\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\t// clear scaled tiles after all new tiles are loaded (for performance)\r\n\t\t\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t\t\t\tthis._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_tileOnLoad: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\t//Only if we are loading an actual image\r\n\t\tif (this.src !== L.Util.emptyImageUrl) {\r\n\t\t\tL.DomUtil.addClass(this, 'leaflet-tile-loaded');\r\n\r\n\t\t\tlayer.fire('tileload', {\r\n\t\t\t\ttile: this,\r\n\t\t\t\turl: this.src\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t},\r\n\r\n\t_tileOnError: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\tlayer.fire('tileerror', {\r\n\t\t\ttile: this,\r\n\t\t\turl: this.src\r\n\t\t});\r\n\r\n\t\tvar newUrl = layer.options.errorTileUrl;\r\n\t\tif (newUrl) {\r\n\t\t\tthis.src = newUrl;\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t}\r\n});\r\n\r\nL.tileLayer = function (url, options) {\r\n\treturn new L.TileLayer(url, options);\r\n};\r\n\r\n\r\n/*\r\n * L.TileLayer.WMS is used for putting WMS tile layers on the map.\r\n */\r\n\r\nL.TileLayer.WMS = L.TileLayer.extend({\r\n\r\n\tdefaultWmsParams: {\r\n\t\tservice: 'WMS',\r\n\t\trequest: 'GetMap',\r\n\t\tversion: '1.1.1',\r\n\t\tlayers: '',\r\n\t\tstyles: '',\r\n\t\tformat: 'image/jpeg',\r\n\t\ttransparent: false\r\n\t},\r\n\r\n\tinitialize: function (url, options) { // (String, Object)\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar wmsParams = L.extend({}, this.defaultWmsParams),\r\n\t\t    tileSize = options.tileSize || this.options.tileSize;\r\n\r\n\t\tif (options.detectRetina && L.Browser.retina) {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize * 2;\r\n\t\t} else {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize;\r\n\t\t}\r\n\r\n\t\tfor (var i in options) {\r\n\t\t\t// all keys that are not TileLayer options go to WMS params\r\n\t\t\tif (!this.options.hasOwnProperty(i) && i !== 'crs') {\r\n\t\t\t\twmsParams[i] = options[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.wmsParams = wmsParams;\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\r\n\t\tthis._crs = this.options.crs || map.options.crs;\r\n\r\n\t\tthis._wmsVersion = parseFloat(this.wmsParams.version);\r\n\r\n\t\tvar projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';\r\n\t\tthis.wmsParams[projectionKey] = this._crs.code;\r\n\r\n\t\tL.TileLayer.prototype.onAdd.call(this, map);\r\n\t},\r\n\r\n\tgetTileUrl: function (tilePoint) { // (Point, Number) -> String\r\n\r\n\t\tvar map = this._map,\r\n\t\t    tileSize = this.options.tileSize,\r\n\r\n\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\r\n\t\t    nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\r\n\t\t    se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\r\n\t\t    bbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ?\r\n\t\t        [se.y, nw.x, nw.y, se.x].join(',') :\r\n\t\t        [nw.x, se.y, se.x, nw.y].join(','),\r\n\r\n\t\t    url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\r\n\r\n\t\treturn url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;\r\n\t},\r\n\r\n\tsetParams: function (params, noRedraw) {\r\n\r\n\t\tL.extend(this.wmsParams, params);\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.tileLayer.wms = function (url, options) {\r\n\treturn new L.TileLayer.WMS(url, options);\r\n};\r\n\r\n\r\n/*\r\n * L.TileLayer.Canvas is a class that you can use as a base for creating\r\n * dynamically drawn Canvas-based tile layers.\r\n */\r\n\r\nL.TileLayer.Canvas = L.TileLayer.extend({\r\n\toptions: {\r\n\t\tasync: false\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tfor (var i in this._tiles) {\r\n\t\t\tthis._redrawTile(this._tiles[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_redrawTile: function (tile) {\r\n\t\tthis.drawTile(tile, tile._tilePoint, this._map._zoom);\r\n\t},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n\t\ttile.width = tile.height = this.options.tileSize;\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer = this;\r\n\t\ttile._tilePoint = tilePoint;\r\n\r\n\t\tthis._redrawTile(tile);\r\n\r\n\t\tif (!this.options.async) {\r\n\t\t\tthis.tileDrawn(tile);\r\n\t\t}\r\n\t},\r\n\r\n\tdrawTile: function (/*tile, tilePoint*/) {\r\n\t\t// override with rendering code\r\n\t},\r\n\r\n\ttileDrawn: function (tile) {\r\n\t\tthis._tileOnLoad.call(tile);\r\n\t}\r\n});\r\n\r\n\r\nL.tileLayer.canvas = function (options) {\r\n\treturn new L.TileLayer.Canvas(options);\r\n};\r\n\r\n\r\n/*\r\n * L.ImageOverlay is used to overlay images over the map (to specific geographical bounds).\r\n */\r\n\r\nL.ImageOverlay = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\topacity: 1\r\n\t},\r\n\r\n\tinitialize: function (url, bounds, options) { // (String, LatLngBounds, Object)\r\n\t\tthis._url = url;\r\n\t\tthis._bounds = L.latLngBounds(bounds);\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._image) {\r\n\t\t\tthis._initImage();\r\n\t\t}\r\n\r\n\t\tmap._panes.overlayPane.appendChild(this._image);\r\n\r\n\t\tmap.on('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.getPanes().overlayPane.removeChild(this._image);\r\n\r\n\t\tmap.off('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation) {\r\n\t\t\tmap.off('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tthis._updateOpacity();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// TODO remove bringToFront/bringToBack duplication from TileLayer/Path\r\n\tbringToFront: function () {\r\n\t\tif (this._image) {\r\n\t\t\tthis._map._panes.overlayPane.appendChild(this._image);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.overlayPane;\r\n\t\tif (this._image) {\r\n\t\t\tpane.insertBefore(this._image, pane.firstChild);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url) {\r\n\t\tthis._url = url;\r\n\t\tthis._image.src = this._url;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\t_initImage: function () {\r\n\t\tthis._image = L.DomUtil.create('img', 'leaflet-image-layer');\r\n\r\n\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-animated');\r\n\t\t} else {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-hide');\r\n\t\t}\r\n\r\n\t\tthis._updateOpacity();\r\n\r\n\t\t//TODO createImage util method to remove duplication\r\n\t\tL.extend(this._image, {\r\n\t\t\tgalleryimg: 'no',\r\n\t\t\tonselectstart: L.Util.falseFn,\r\n\t\t\tonmousemove: L.Util.falseFn,\r\n\t\t\tonload: L.bind(this._onImageLoad, this),\r\n\t\t\tsrc: this._url\r\n\t\t});\r\n\t},\r\n\r\n\t_animateZoom: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    image = this._image,\r\n\t\t    scale = map.getZoomScale(e.zoom),\r\n\t\t    nw = this._bounds.getNorthWest(),\r\n\t\t    se = this._bounds.getSouthEast(),\r\n\r\n\t\t    topLeft = map._latLngToNewLayerPoint(nw, e.zoom, e.center),\r\n\t\t    size = map._latLngToNewLayerPoint(se, e.zoom, e.center)._subtract(topLeft),\r\n\t\t    origin = topLeft._add(size._multiplyBy((1 / 2) * (1 - 1 / scale)));\r\n\r\n\t\timage.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(origin) + ' scale(' + scale + ') ';\r\n\t},\r\n\r\n\t_reset: function () {\r\n\t\tvar image   = this._image,\r\n\t\t    topLeft = this._map.latLngToLayerPoint(this._bounds.getNorthWest()),\r\n\t\t    size = this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);\r\n\r\n\t\tL.DomUtil.setPosition(image, topLeft);\r\n\r\n\t\timage.style.width  = size.x + 'px';\r\n\t\timage.style.height = size.y + 'px';\r\n\t},\r\n\r\n\t_onImageLoad: function () {\r\n\t\tthis.fire('load');\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._image, this.options.opacity);\r\n\t}\r\n});\r\n\r\nL.imageOverlay = function (url, bounds, options) {\r\n\treturn new L.ImageOverlay(url, bounds, options);\r\n};\r\n\r\n\r\n/*\r\n * L.Icon is an image-based icon class that you can use with L.Marker for custom markers.\r\n */\r\n\r\nL.Icon = L.Class.extend({\r\n\toptions: {\r\n\t\t/*\r\n\t\ticonUrl: (String) (required)\r\n\t\ticonRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\ticonSize: (Point) (can be set through CSS)\r\n\t\ticonAnchor: (Point) (centered by default, can be set in CSS with negative margins)\r\n\t\tpopupAnchor: (Point) (if not specified, popup opens in the anchor point)\r\n\t\tshadowUrl: (String) (no shadow by default)\r\n\t\tshadowRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\tshadowSize: (Point)\r\n\t\tshadowAnchor: (Point)\r\n\t\t*/\r\n\t\tclassName: ''\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tcreateIcon: function (oldIcon) {\r\n\t\treturn this._createIcon('icon', oldIcon);\r\n\t},\r\n\r\n\tcreateShadow: function (oldIcon) {\r\n\t\treturn this._createIcon('shadow', oldIcon);\r\n\t},\r\n\r\n\t_createIcon: function (name, oldIcon) {\r\n\t\tvar src = this._getIconUrl(name);\r\n\r\n\t\tif (!src) {\r\n\t\t\tif (name === 'icon') {\r\n\t\t\t\tthrow new Error('iconUrl not set in Icon options (see the docs).');\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar img;\r\n\t\tif (!oldIcon || oldIcon.tagName !== 'IMG') {\r\n\t\t\timg = this._createImg(src);\r\n\t\t} else {\r\n\t\t\timg = this._createImg(src, oldIcon);\r\n\t\t}\r\n\t\tthis._setIconStyles(img, name);\r\n\r\n\t\treturn img;\r\n\t},\r\n\r\n\t_setIconStyles: function (img, name) {\r\n\t\tvar options = this.options,\r\n\t\t    size = L.point(options[name + 'Size']),\r\n\t\t    anchor;\r\n\r\n\t\tif (name === 'shadow') {\r\n\t\t\tanchor = L.point(options.shadowAnchor || options.iconAnchor);\r\n\t\t} else {\r\n\t\t\tanchor = L.point(options.iconAnchor);\r\n\t\t}\r\n\r\n\t\tif (!anchor && size) {\r\n\t\t\tanchor = size.divideBy(2, true);\r\n\t\t}\r\n\r\n\t\timg.className = 'leaflet-marker-' + name + ' ' + options.className;\r\n\r\n\t\tif (anchor) {\r\n\t\t\timg.style.marginLeft = (-anchor.x) + 'px';\r\n\t\t\timg.style.marginTop  = (-anchor.y) + 'px';\r\n\t\t}\r\n\r\n\t\tif (size) {\r\n\t\t\timg.style.width  = size.x + 'px';\r\n\t\t\timg.style.height = size.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t_createImg: function (src, el) {\r\n\t\tel = el || document.createElement('img');\r\n\t\tel.src = src;\r\n\t\treturn el;\r\n\t},\r\n\r\n\t_getIconUrl: function (name) {\r\n\t\tif (L.Browser.retina && this.options[name + 'RetinaUrl']) {\r\n\t\t\treturn this.options[name + 'RetinaUrl'];\r\n\t\t}\r\n\t\treturn this.options[name + 'Url'];\r\n\t}\r\n});\r\n\r\nL.icon = function (options) {\r\n\treturn new L.Icon(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Icon.Default is the blue marker icon used by default in Leaflet.\r\n */\r\n\r\nL.Icon.Default = L.Icon.extend({\r\n\r\n\toptions: {\r\n\t\ticonSize: [25, 41],\r\n\t\ticonAnchor: [12, 41],\r\n\t\tpopupAnchor: [1, -34],\r\n\r\n\t\tshadowSize: [41, 41]\r\n\t},\r\n\r\n\t_getIconUrl: function (name) {\r\n\t\tvar key = name + 'Url';\r\n\r\n\t\tif (this.options[key]) {\r\n\t\t\treturn this.options[key];\r\n\t\t}\r\n\r\n\t\tif (L.Browser.retina && name === 'icon') {\r\n\t\t\tname += '-2x';\r\n\t\t}\r\n\r\n\t\tvar path = L.Icon.Default.imagePath;\r\n\r\n\t\tif (!path) {\r\n\t\t\tthrow new Error('Couldn\\'t autodetect L.Icon.Default.imagePath, set it manually.');\r\n\t\t}\r\n\r\n\t\treturn path + '/marker-' + name + '.png';\r\n\t}\r\n});\r\n\r\nL.Icon.Default.imagePath = (function () {\r\n\tvar scripts = document.getElementsByTagName('script'),\r\n\t    leafletRe = /[\\/^]leaflet[\\-\\._]?([\\w\\-\\._]*)\\.js\\??/;\r\n\r\n\tvar i, len, src, matches, path;\r\n\r\n\tfor (i = 0, len = scripts.length; i < len; i++) {\r\n\t\tsrc = scripts[i].src;\r\n\t\tmatches = src.match(leafletRe);\r\n\r\n\t\tif (matches) {\r\n\t\t\tpath = src.split(leafletRe)[0];\r\n\t\t\treturn (path ? path + '/' : '') + 'images';\r\n\t\t}\r\n\t}\r\n}());\r\n\r\n\r\n/*\r\n * L.Marker is used to display clickable/draggable icons on the map.\r\n */\r\n\r\nL.Marker = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\ticon: new L.Icon.Default(),\r\n\t\ttitle: '',\r\n\t\talt: '',\r\n\t\tclickable: true,\r\n\t\tdraggable: false,\r\n\t\tkeyboard: true,\r\n\t\tzIndexOffset: 0,\r\n\t\topacity: 1,\r\n\t\triseOnHover: false,\r\n\t\triseOffset: 250\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.setOptions(this, options);\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tmap.on('viewreset', this.update, this);\r\n\r\n\t\tthis._initIcon();\r\n\t\tthis.update();\r\n\t\tthis.fire('add');\r\n\r\n\t\tif (map.options.zoomAnimation && map.options.markerZoomAnimation) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tif (this.dragging) {\r\n\t\t\tthis.dragging.disable();\r\n\t\t}\r\n\r\n\t\tthis._removeIcon();\r\n\t\tthis._removeShadow();\r\n\r\n\t\tthis.fire('remove');\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.update,\r\n\t\t\t'zoomanim': this._animateZoom\r\n\t\t}, this);\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\r\n\t\tthis.update();\r\n\r\n\t\treturn this.fire('move', { latlng: this._latlng });\r\n\t},\r\n\r\n\tsetZIndexOffset: function (offset) {\r\n\t\tthis.options.zIndexOffset = offset;\r\n\t\tthis.update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetIcon: function (icon) {\r\n\r\n\t\tthis.options.icon = icon;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._initIcon();\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tif (this._popup) {\r\n\t\t\tthis.bindPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (this._icon) {\r\n\t\t\tvar pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n\t\t\tthis._setPos(pos);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initIcon: function () {\r\n\t\tvar options = this.options,\r\n\t\t    map = this._map,\r\n\t\t    animation = (map.options.zoomAnimation && map.options.markerZoomAnimation),\r\n\t\t    classToAdd = animation ? 'leaflet-zoom-animated' : 'leaflet-zoom-hide';\r\n\r\n\t\tvar icon = options.icon.createIcon(this._icon),\r\n\t\t\taddIcon = false;\r\n\r\n\t\t// if we're not reusing the icon, remove the old one and init new one\r\n\t\tif (icon !== this._icon) {\r\n\t\t\tif (this._icon) {\r\n\t\t\t\tthis._removeIcon();\r\n\t\t\t}\r\n\t\t\taddIcon = true;\r\n\r\n\t\t\tif (options.title) {\r\n\t\t\t\ticon.title = options.title;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (options.alt) {\r\n\t\t\t\ticon.alt = options.alt;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tL.DomUtil.addClass(icon, classToAdd);\r\n\r\n\t\tif (options.keyboard) {\r\n\t\t\ticon.tabIndex = '0';\r\n\t\t}\r\n\r\n\t\tthis._icon = icon;\r\n\r\n\t\tthis._initInteraction();\r\n\r\n\t\tif (options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(icon, 'mouseover', this._bringToFront, this)\r\n\t\t\t\t.on(icon, 'mouseout', this._resetZIndex, this);\r\n\t\t}\r\n\r\n\t\tvar newShadow = options.icon.createShadow(this._shadow),\r\n\t\t\taddShadow = false;\r\n\r\n\t\tif (newShadow !== this._shadow) {\r\n\t\t\tthis._removeShadow();\r\n\t\t\taddShadow = true;\r\n\t\t}\r\n\r\n\t\tif (newShadow) {\r\n\t\t\tL.DomUtil.addClass(newShadow, classToAdd);\r\n\t\t}\r\n\t\tthis._shadow = newShadow;\r\n\r\n\r\n\t\tif (options.opacity < 1) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\r\n\t\tvar panes = this._map._panes;\r\n\r\n\t\tif (addIcon) {\r\n\t\t\tpanes.markerPane.appendChild(this._icon);\r\n\t\t}\r\n\r\n\t\tif (newShadow && addShadow) {\r\n\t\t\tpanes.shadowPane.appendChild(this._shadow);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeIcon: function () {\r\n\t\tif (this.options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(this._icon, 'mouseover', this._bringToFront)\r\n\t\t\t    .off(this._icon, 'mouseout', this._resetZIndex);\r\n\t\t}\r\n\r\n\t\tthis._map._panes.markerPane.removeChild(this._icon);\r\n\r\n\t\tthis._icon = null;\r\n\t},\r\n\r\n\t_removeShadow: function () {\r\n\t\tif (this._shadow) {\r\n\t\t\tthis._map._panes.shadowPane.removeChild(this._shadow);\r\n\t\t}\r\n\t\tthis._shadow = null;\r\n\t},\r\n\r\n\t_setPos: function (pos) {\r\n\t\tL.DomUtil.setPosition(this._icon, pos);\r\n\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setPosition(this._shadow, pos);\r\n\t\t}\r\n\r\n\t\tthis._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n\t\tthis._resetZIndex();\r\n\t},\r\n\r\n\t_updateZIndex: function (offset) {\r\n\t\tthis._icon.style.zIndex = this._zIndex + offset;\r\n\t},\r\n\r\n\t_animateZoom: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n\t\tthis._setPos(pos);\r\n\t},\r\n\r\n\t_initInteraction: function () {\r\n\r\n\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\r\n\r\n\t\tvar icon = this._icon,\r\n\t\t    events = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\r\n\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\r\n\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\r\n\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (L.Handler.MarkerDrag) {\r\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\r\n\r\n\t\t\tif (this.options.draggable) {\r\n\t\t\t\tthis.dragging.enable();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tvar wasDragged = this.dragging && this.dragging.moved();\r\n\r\n\t\tif (this.hasEventListeners(e.type) || wasDragged) {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\r\n\t\tif (wasDragged) { return; }\r\n\r\n\t\tif ((!this.dragging || !this.dragging._enabled) && this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\t},\r\n\r\n\t_onKeyPress: function (e) {\r\n\t\tif (e.keyCode === 13) {\r\n\t\t\tthis.fire('click', {\r\n\t\t\t\toriginalEvent: e,\r\n\t\t\t\tlatlng: this._latlng\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\r\n\t\t// TODO proper custom event propagation\r\n\t\t// this line will always be called if marker is in a FeatureGroup\r\n\t\tif (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousedown') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._icon, this.options.opacity);\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setOpacity(this._shadow, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_bringToFront: function () {\r\n\t\tthis._updateZIndex(this.options.riseOffset);\r\n\t},\r\n\r\n\t_resetZIndex: function () {\r\n\t\tthis._updateZIndex(0);\r\n\t}\r\n});\r\n\r\nL.marker = function (latlng, options) {\r\n\treturn new L.Marker(latlng, options);\r\n};\r\n\r\n\r\n/*\r\n * L.DivIcon is a lightweight HTML-based icon class (as opposed to the image-based L.Icon)\r\n * to use with L.Marker.\r\n */\r\n\r\nL.DivIcon = L.Icon.extend({\r\n\toptions: {\r\n\t\ticonSize: [12, 12], // also can be set through CSS\r\n\t\t/*\r\n\t\ticonAnchor: (Point)\r\n\t\tpopupAnchor: (Point)\r\n\t\thtml: (String)\r\n\t\tbgPos: (Point)\r\n\t\t*/\r\n\t\tclassName: 'leaflet-div-icon',\r\n\t\thtml: false\r\n\t},\r\n\r\n\tcreateIcon: function (oldIcon) {\r\n\t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\r\n\t\t    options = this.options;\r\n\r\n\t\tif (options.html !== false) {\r\n\t\t\tdiv.innerHTML = options.html;\r\n\t\t} else {\r\n\t\t\tdiv.innerHTML = '';\r\n\t\t}\r\n\r\n\t\tif (options.bgPos) {\r\n\t\t\tdiv.style.backgroundPosition =\r\n\t\t\t        (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\r\n\t\t}\r\n\r\n\t\tthis._setIconStyles(div, 'icon');\r\n\t\treturn div;\r\n\t},\r\n\r\n\tcreateShadow: function () {\r\n\t\treturn null;\r\n\t}\r\n});\r\n\r\nL.divIcon = function (options) {\r\n\treturn new L.DivIcon(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Popup is used for displaying popups on the map.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tclosePopupOnClick: true\r\n});\r\n\r\nL.Popup = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminWidth: 50,\r\n\t\tmaxWidth: 300,\r\n\t\t// maxHeight: null,\r\n\t\tautoPan: true,\r\n\t\tcloseButton: true,\r\n\t\toffset: [0, 7],\r\n\t\tautoPanPadding: [5, 5],\r\n\t\t// autoPanPaddingTopLeft: null,\r\n\t\t// autoPanPaddingBottomRight: null,\r\n\t\tkeepInView: false,\r\n\t\tclassName: '',\r\n\t\tzoomAnimation: true\r\n\t},\r\n\r\n\tinitialize: function (options, source) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._source = source;\r\n\t\tthis._animated = L.Browser.any3d && this.options.zoomAnimation;\r\n\t\tthis._isOpen = false;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initLayout();\r\n\t\t}\r\n\r\n\t\tvar animFade = map.options.fadeAnimation;\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\t\tmap._panes.popupPane.appendChild(this._container);\r\n\r\n\t\tmap.on(this._getEvents(), this);\r\n\r\n\t\tthis.update();\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 1);\r\n\t\t}\r\n\r\n\t\tthis.fire('open');\r\n\r\n\t\tmap.fire('popupopen', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupopen', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenOn: function (map) {\r\n\t\tmap.openPopup(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._panes.popupPane.removeChild(this._container);\r\n\r\n\t\tL.Util.falseFn(this._container.offsetWidth); // force reflow\r\n\r\n\t\tmap.off(this._getEvents(), this);\r\n\r\n\t\tif (map.options.fadeAnimation) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\r\n\t\tthis._map = null;\r\n\r\n\t\tthis.fire('close');\r\n\r\n\t\tmap.fire('popupclose', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupclose', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tif (this._map) {\r\n\t\t\tthis._updatePosition();\r\n\t\t\tthis._adjustPan();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContent: function () {\r\n\t\treturn this._content;\r\n\t},\r\n\r\n\tsetContent: function (content) {\r\n\t\tthis._content = content;\r\n\t\tthis.update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._container.style.visibility = 'hidden';\r\n\r\n\t\tthis._updateContent();\r\n\t\tthis._updateLayout();\r\n\t\tthis._updatePosition();\r\n\r\n\t\tthis._container.style.visibility = '';\r\n\r\n\t\tthis._adjustPan();\r\n\t},\r\n\r\n\t_getEvents: function () {\r\n\t\tvar events = {\r\n\t\t\tviewreset: this._updatePosition\r\n\t\t};\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tevents.zoomanim = this._zoomAnimation;\r\n\t\t}\r\n\t\tif ('closeOnClick' in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) {\r\n\t\t\tevents.preclick = this._close;\r\n\t\t}\r\n\t\tif (this.options.keepInView) {\r\n\t\t\tevents.moveend = this._adjustPan;\r\n\t\t}\r\n\r\n\t\treturn events;\r\n\t},\r\n\r\n\t_close: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.closePopup(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar prefix = 'leaflet-popup',\r\n\t\t\tcontainerClass = prefix + ' ' + this.options.className + ' leaflet-zoom-' +\r\n\t\t\t        (this._animated ? 'animated' : 'hide'),\r\n\t\t\tcontainer = this._container = L.DomUtil.create('div', containerClass),\r\n\t\t\tcloseButton;\r\n\r\n\t\tif (this.options.closeButton) {\r\n\t\t\tcloseButton = this._closeButton =\r\n\t\t\t        L.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\tcloseButton.href = '#close';\r\n\t\t\tcloseButton.innerHTML = '&#215;';\r\n\t\t\tL.DomEvent.disableClickPropagation(closeButton);\r\n\r\n\t\t\tL.DomEvent.on(closeButton, 'click', this._onCloseButtonClick, this);\r\n\t\t}\r\n\r\n\t\tvar wrapper = this._wrapper =\r\n\t\t        L.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\tL.DomEvent.disableClickPropagation(wrapper);\r\n\r\n\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\tL.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\t},\r\n\r\n\t_updateContent: function () {\r\n\t\tif (!this._content) { return; }\r\n\r\n\t\tif (typeof this._content === 'string') {\r\n\t\t\tthis._contentNode.innerHTML = this._content;\r\n\t\t} else {\r\n\t\t\twhile (this._contentNode.hasChildNodes()) {\r\n\t\t\t\tthis._contentNode.removeChild(this._contentNode.firstChild);\r\n\t\t\t}\r\n\t\t\tthis._contentNode.appendChild(this._content);\r\n\t\t}\r\n\t\tthis.fire('contentupdate');\r\n\t},\r\n\r\n\t_updateLayout: function () {\r\n\t\tvar container = this._contentNode,\r\n\t\t    style = container.style;\r\n\r\n\t\tstyle.width = '';\r\n\t\tstyle.whiteSpace = 'nowrap';\r\n\r\n\t\tvar width = container.offsetWidth;\r\n\t\twidth = Math.min(width, this.options.maxWidth);\r\n\t\twidth = Math.max(width, this.options.minWidth);\r\n\r\n\t\tstyle.width = (width + 1) + 'px';\r\n\t\tstyle.whiteSpace = '';\r\n\r\n\t\tstyle.height = '';\r\n\r\n\t\tvar height = container.offsetHeight,\r\n\t\t    maxHeight = this.options.maxHeight,\r\n\t\t    scrolledClass = 'leaflet-popup-scrolled';\r\n\r\n\t\tif (maxHeight && height > maxHeight) {\r\n\t\t\tstyle.height = maxHeight + 'px';\r\n\t\t\tL.DomUtil.addClass(container, scrolledClass);\r\n\t\t} else {\r\n\t\t\tL.DomUtil.removeClass(container, scrolledClass);\r\n\t\t}\r\n\r\n\t\tthis._containerWidth = this._container.offsetWidth;\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t\t    animated = this._animated,\r\n\t\t    offset = L.point(this.options.offset);\r\n\r\n\t\tif (animated) {\r\n\t\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t\t}\r\n\r\n\t\tthis._containerBottom = -offset.y - (animated ? 0 : pos.y);\r\n\t\tthis._containerLeft = -Math.round(this._containerWidth / 2) + offset.x + (animated ? 0 : pos.x);\r\n\r\n\t\t// bottom position the popup in case the height of the popup changes (images loading etc)\r\n\t\tthis._container.style.bottom = this._containerBottom + 'px';\r\n\t\tthis._container.style.left = this._containerLeft + 'px';\r\n\t},\r\n\r\n\t_zoomAnimation: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);\r\n\r\n\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t},\r\n\r\n\t_adjustPan: function () {\r\n\t\tif (!this.options.autoPan) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerHeight = this._container.offsetHeight,\r\n\t\t    containerWidth = this._containerWidth,\r\n\r\n\t\t    layerPos = new L.Point(this._containerLeft, -containerHeight - this._containerBottom);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tlayerPos._add(L.DomUtil.getPosition(this._container));\r\n\t\t}\r\n\r\n\t\tvar containerPos = map.layerPointToContainerPoint(layerPos),\r\n\t\t    padding = L.point(this.options.autoPanPadding),\r\n\t\t    paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t    paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t\t    size = map.getSize(),\r\n\t\t    dx = 0,\r\n\t\t    dy = 0;\r\n\r\n\t\tif (containerPos.x + containerWidth + paddingBR.x > size.x) { // right\r\n\t\t\tdx = containerPos.x + containerWidth - size.x + paddingBR.x;\r\n\t\t}\r\n\t\tif (containerPos.x - dx - paddingTL.x < 0) { // left\r\n\t\t\tdx = containerPos.x - paddingTL.x;\r\n\t\t}\r\n\t\tif (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom\r\n\t\t\tdy = containerPos.y + containerHeight - size.y + paddingBR.y;\r\n\t\t}\r\n\t\tif (containerPos.y - dy - paddingTL.y < 0) { // top\r\n\t\t\tdy = containerPos.y - paddingTL.y;\r\n\t\t}\r\n\r\n\t\tif (dx || dy) {\r\n\t\t\tmap\r\n\t\t\t    .fire('autopanstart')\r\n\t\t\t    .panBy([dx, dy]);\r\n\t\t}\r\n\t},\r\n\r\n\t_onCloseButtonClick: function (e) {\r\n\t\tthis._close();\r\n\t\tL.DomEvent.stop(e);\r\n\t}\r\n});\r\n\r\nL.popup = function (options, source) {\r\n\treturn new L.Popup(options, source);\r\n};\r\n\r\n\r\nL.Map.include({\r\n\topenPopup: function (popup, latlng, options) { // (Popup) or (String || HTMLElement, LatLng[, Object])\r\n\t\tthis.closePopup();\r\n\r\n\t\tif (!(popup instanceof L.Popup)) {\r\n\t\t\tvar content = popup;\r\n\r\n\t\t\tpopup = new L.Popup(options)\r\n\t\t\t    .setLatLng(latlng)\r\n\t\t\t    .setContent(content);\r\n\t\t}\r\n\t\tpopup._isOpen = true;\r\n\r\n\t\tthis._popup = popup;\r\n\t\treturn this.addLayer(popup);\r\n\t},\r\n\r\n\tclosePopup: function (popup) {\r\n\t\tif (!popup || popup === this._popup) {\r\n\t\t\tpopup = this._popup;\r\n\t\t\tthis._popup = null;\r\n\t\t}\r\n\t\tif (popup) {\r\n\t\t\tthis.removeLayer(popup);\r\n\t\t\tpopup._isOpen = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Popup extension to L.Marker, adding popup-related methods.\r\n */\r\n\r\nL.Marker.include({\r\n\topenPopup: function () {\r\n\t\tif (this._popup && this._map && !this._map.hasLayer(this._popup)) {\r\n\t\t\tthis._popup.setLatLng(this._latlng);\r\n\t\t\tthis._map.openPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttogglePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tif (this._popup._isOpen) {\r\n\t\t\t\tthis.closePopup();\r\n\t\t\t} else {\r\n\t\t\t\tthis.openPopup();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tvar anchor = L.point(this.options.icon.options.popupAnchor || [0, 0]);\r\n\r\n\t\tanchor = anchor.add(L.Popup.prototype.options.offset);\r\n\r\n\t\tif (options && options.offset) {\r\n\t\t\tanchor = anchor.add(options.offset);\r\n\t\t}\r\n\r\n\t\toptions = L.extend({offset: anchor}, options);\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this.togglePopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this)\r\n\t\t\t    .on('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tL.setOptions(content, options);\r\n\t\t\tthis._popup = content;\r\n\t\t} else {\r\n\t\t\tthis._popup = new L.Popup(options, this)\r\n\t\t\t\t.setContent(content);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetPopupContent: function (content) {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this.togglePopup, this)\r\n\t\t\t    .off('remove', this.closePopup, this)\r\n\t\t\t    .off('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPopup: function () {\r\n\t\treturn this._popup;\r\n\t},\r\n\r\n\t_movePopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.LayerGroup is a class to combine several layers into one so that\r\n * you can manipulate the group (e.g. add/remove it) as one layer.\r\n */\r\n\r\nL.LayerGroup = L.Class.extend({\r\n\tinitialize: function (layers) {\r\n\t\tthis._layers = {};\r\n\r\n\t\tvar i, len;\r\n\r\n\t\tif (layers) {\r\n\t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\t\t\t\tthis.addLayer(layers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tvar id = this.getLayerId(layer);\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.addLayer(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = layer in this._layers ? layer : this.getLayerId(layer);\r\n\r\n\t\tif (this._map && this._layers[id]) {\r\n\t\t\tthis._map.removeLayer(this._layers[id]);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (layer in this._layers || this.getLayerId(layer) in this._layers);\r\n\t},\r\n\r\n\tclearLayers: function () {\r\n\t\tthis.eachLayer(this.removeLayer, this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvoke: function (methodName) {\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, layer;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tlayer = this._layers[i];\r\n\r\n\t\t\tif (layer[methodName]) {\r\n\t\t\t\tlayer[methodName].apply(layer, args);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis.eachLayer(map.addLayer, map);\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis.eachLayer(map.removeLayer, map);\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetLayer: function (id) {\r\n\t\treturn this._layers[id];\r\n\t},\r\n\r\n\tgetLayers: function () {\r\n\t\tvar layers = [];\r\n\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tlayers.push(this._layers[i]);\r\n\t\t}\r\n\t\treturn layers;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\treturn this.invoke('setZIndex', zIndex);\r\n\t},\r\n\r\n\tgetLayerId: function (layer) {\r\n\t\treturn L.stamp(layer);\r\n\t}\r\n});\r\n\r\nL.layerGroup = function (layers) {\r\n\treturn new L.LayerGroup(layers);\r\n};\r\n\r\n\r\n/*\r\n * L.FeatureGroup extends L.LayerGroup by introducing mouse events and additional methods\r\n * shared between a group of interactive layers (like vectors or markers).\r\n */\r\n\r\nL.FeatureGroup = L.LayerGroup.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tEVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tif (this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif ('on' in layer) {\r\n\t\t\tlayer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t}\r\n\r\n\t\tL.LayerGroup.prototype.addLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent && layer.bindPopup) {\r\n\t\t\tlayer.bindPopup(this._popupContent, this._popupOptions);\r\n\t\t}\r\n\r\n\t\treturn this.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tif (!this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif (layer in this._layers) {\r\n\t\t\tlayer = this._layers[layer];\r\n\t\t}\r\n\r\n\t\tlayer.off(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\r\n\t\tL.LayerGroup.prototype.removeLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent) {\r\n\t\t\tthis.invoke('unbindPopup');\r\n\t\t}\r\n\r\n\t\treturn this.fire('layerremove', {layer: layer});\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tthis._popupContent = content;\r\n\t\tthis._popupOptions = options;\r\n\t\treturn this.invoke('bindPopup', content, options);\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\t\t// open popup on the first layer\r\n\t\tfor (var id in this._layers) {\r\n\t\t\tthis._layers[id].openPopup(latlng);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\treturn this.invoke('setStyle', style);\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\treturn this.invoke('bringToFront');\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\treturn this.invoke('bringToBack');\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tbounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());\r\n\t\t});\r\n\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\te = L.extend({\r\n\t\t\tlayer: e.target,\r\n\t\t\ttarget: this\r\n\t\t}, e);\r\n\t\tthis.fire(e.type, e);\r\n\t}\r\n});\r\n\r\nL.featureGroup = function (layers) {\r\n\treturn new L.FeatureGroup(layers);\r\n};\r\n\r\n\r\n/*\r\n * L.Path is a base class for rendering vector paths on a map. Inherited by Polyline, Circle, etc.\r\n */\r\n\r\nL.Path = L.Class.extend({\r\n\tincludes: [L.Mixin.Events],\r\n\r\n\tstatics: {\r\n\t\t// how much to extend the clip area around the map view\r\n\t\t// (relative to its size, e.g. 0.5 is half the screen in each direction)\r\n\t\t// set it so that SVG element doesn't exceed 1280px (vectors flicker on dragend if it is)\r\n\t\tCLIP_PADDING: (function () {\r\n\t\t\tvar max = L.Browser.mobile ? 1280 : 2000,\r\n\t\t\t    target = (max / Math.max(window.outerWidth, window.outerHeight) - 1) / 2;\r\n\t\t\treturn Math.max(0, Math.min(0.5, target));\r\n\t\t})()\r\n\t},\r\n\r\n\toptions: {\r\n\t\tstroke: true,\r\n\t\tcolor: '#0033ff',\r\n\t\tdashArray: null,\r\n\t\tlineCap: null,\r\n\t\tlineJoin: null,\r\n\t\tweight: 5,\r\n\t\topacity: 0.5,\r\n\r\n\t\tfill: false,\r\n\t\tfillColor: null, //same as color by default\r\n\t\tfillOpacity: 0.2,\r\n\r\n\t\tclickable: true\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initElements();\r\n\t\t\tthis._initEvents();\r\n\t\t}\r\n\r\n\t\tthis.projectLatlngs();\r\n\t\tthis._updatePath();\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._map._pathRoot.appendChild(this._container);\r\n\t\t}\r\n\r\n\t\tthis.fire('add');\r\n\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._pathRoot.removeChild(this._container);\r\n\r\n\t\t// Need to fire remove event before we set _map to null as the event hooks might need the object\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\r\n\t\tif (L.Browser.vml) {\r\n\t\t\tthis._container = null;\r\n\t\t\tthis._stroke = null;\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\t// do all projection stuff here\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._updateStyle();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._updatePath();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_updatePathViewport: function () {\r\n\t\tvar p = L.Path.CLIP_PADDING,\r\n\t\t    size = this.getSize(),\r\n\t\t    panePos = L.DomUtil.getPosition(this._mapPane),\r\n\t\t    min = panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),\r\n\t\t    max = min.add(size.multiplyBy(1 + p * 2)._round());\r\n\r\n\t\tthis._pathViewport = new L.Bounds(min, max);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Path with SVG-specific rendering code.\r\n */\r\n\r\nL.Path.SVG_NS = 'http://www.w3.org/2000/svg';\r\n\r\nL.Browser.svg = !!(document.createElementNS && document.createElementNS(L.Path.SVG_NS, 'svg').createSVGRect);\r\n\r\nL.Path = L.Path.extend({\r\n\tstatics: {\r\n\t\tSVG: L.Browser.svg\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container;\r\n\r\n\t\tif (path && root.lastChild !== path) {\r\n\t\t\troot.appendChild(path);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container,\r\n\t\t    first = root.firstChild;\r\n\r\n\t\tif (path && first !== path) {\r\n\t\t\troot.insertBefore(path, first);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\t// form path string here\r\n\t},\r\n\r\n\t_createElement: function (name) {\r\n\t\treturn document.createElementNS(L.Path.SVG_NS, name);\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._initPath();\r\n\t\tthis._initStyle();\r\n\t},\r\n\r\n\t_initPath: function () {\r\n\t\tthis._container = this._createElement('g');\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\r\n\t\tif (this.options.className) {\r\n\t\t\tL.DomUtil.addClass(this._path, this.options.className);\r\n\t\t}\r\n\r\n\t\tthis._container.appendChild(this._path);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke-linejoin', 'round');\r\n\t\t\tthis._path.setAttribute('stroke-linecap', 'round');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill-rule', 'evenodd');\r\n\t\t}\r\n\t\tif (this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', this.options.pointerEvents);\r\n\t\t}\r\n\t\tif (!this.options.clickable && !this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', 'none');\r\n\t\t}\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke', this.options.color);\r\n\t\t\tthis._path.setAttribute('stroke-opacity', this.options.opacity);\r\n\t\t\tthis._path.setAttribute('stroke-width', this.options.weight);\r\n\t\t\tif (this.options.dashArray) {\r\n\t\t\t\tthis._path.setAttribute('stroke-dasharray', this.options.dashArray);\r\n\t\t\t} else {\r\n\t\t\t\tthis._path.removeAttribute('stroke-dasharray');\r\n\t\t\t}\r\n\t\t\tif (this.options.lineCap) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linecap', this.options.lineCap);\r\n\t\t\t}\r\n\t\t\tif (this.options.lineJoin) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linejoin', this.options.lineJoin);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('stroke', 'none');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill', this.options.fillColor || this.options.color);\r\n\t\t\tthis._path.setAttribute('fill-opacity', this.options.fillOpacity);\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('fill', 'none');\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar str = this.getPathString();\r\n\t\tif (!str) {\r\n\t\t\t// fix webkit empty string parsing bug\r\n\t\t\tstr = 'M0 0';\r\n\t\t}\r\n\t\tthis._path.setAttribute('d', str);\r\n\t},\r\n\r\n\t// TODO remove duplication with L.Map\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\tif (L.Browser.svg || !L.Browser.vml) {\r\n\t\t\t\tL.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\tvar events = ['dblclick', 'mousedown', 'mouseover',\r\n\t\t\t              'mouseout', 'mousemove', 'contextmenu'];\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this.hasEventListeners(e.type)) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerPoint = map.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = map.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = map.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\r\n\t\tif (e.type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousemove') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_initPathRoot: function () {\r\n\t\tif (!this._pathRoot) {\r\n\t\t\tthis._pathRoot = L.Path.prototype._createElement('svg');\r\n\t\t\tthis._panes.overlayPane.appendChild(this._pathRoot);\r\n\r\n\t\t\tif (this.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');\r\n\r\n\t\t\t\tthis.on({\r\n\t\t\t\t\t'zoomanim': this._animatePathZoom,\r\n\t\t\t\t\t'zoomend': this._endPathZoom\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');\r\n\t\t\t}\r\n\r\n\t\t\tthis.on('moveend', this._updateSvgViewport);\r\n\t\t\tthis._updateSvgViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_animatePathZoom: function (e) {\r\n\t\tvar scale = this.getZoomScale(e.zoom),\r\n\t\t    offset = this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);\r\n\r\n\t\tthis._pathRoot.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(offset) + ' scale(' + scale + ') ';\r\n\r\n\t\tthis._pathZooming = true;\r\n\t},\r\n\r\n\t_endPathZoom: function () {\r\n\t\tthis._pathZooming = false;\r\n\t},\r\n\r\n\t_updateSvgViewport: function () {\r\n\r\n\t\tif (this._pathZooming) {\r\n\t\t\t// Do not update SVGs while a zoom animation is going on otherwise the animation will break.\r\n\t\t\t// When the zoom animation ends we will be updated again anyway\r\n\t\t\t// This fixes the case where you do a momentum move and zoom while the move is still ongoing.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    max = vp.max,\r\n\t\t    width = max.x - min.x,\r\n\t\t    height = max.y - min.y,\r\n\t\t    root = this._pathRoot,\r\n\t\t    pane = this._panes.overlayPane;\r\n\r\n\t\t// Hack to make flicker on drag end on mobile webkit less irritating\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.removeChild(root);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.setAttribute('width', width);\r\n\t\troot.setAttribute('height', height);\r\n\t\troot.setAttribute('viewBox', [min.x, min.y, width, height].join(' '));\r\n\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.appendChild(root);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Popup extension to L.Path (polylines, polygons, circles), adding popup-related methods.\r\n */\r\n\r\nL.Path.include({\r\n\r\n\tbindPopup: function (content, options) {\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tthis._popup = content;\r\n\t\t} else {\r\n\t\t\tif (!this._popup || options) {\r\n\t\t\t\tthis._popup = new L.Popup(options, this);\r\n\t\t\t}\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this._openPopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this);\r\n\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this._openPopup)\r\n\t\t\t    .off('remove', this.closePopup);\r\n\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\r\n\t\tif (this._popup) {\r\n\t\t\t// open the popup from one of the path's points if not specified\r\n\t\t\tlatlng = latlng || this._latlng ||\r\n\t\t\t         this._latlngs[Math.floor(this._latlngs.length / 2)];\r\n\r\n\t\t\tthis._openPopup({latlng: latlng});\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_openPopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t\tthis._map.openPopup(this._popup);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Vector rendering for IE6-8 through VML.\r\n * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!\r\n */\r\n\r\nL.Browser.vml = !L.Browser.svg && (function () {\r\n\ttry {\r\n\t\tvar div = document.createElement('div');\r\n\t\tdiv.innerHTML = '<v:shape adj=\"1\"/>';\r\n\r\n\t\tvar shape = div.firstChild;\r\n\t\tshape.style.behavior = 'url(#default#VML)';\r\n\r\n\t\treturn shape && (typeof shape.adj === 'object');\r\n\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}());\r\n\r\nL.Path = L.Browser.svg || !L.Browser.vml ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\tVML: true,\r\n\t\tCLIP_PADDING: 0.02\r\n\t},\r\n\r\n\t_createElement: (function () {\r\n\t\ttry {\r\n\t\t\tdocument.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement('<lvml:' + name + ' class=\"lvml\">');\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement(\r\n\t\t\t\t        '<' + name + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">');\r\n\t\t\t};\r\n\t\t}\r\n\t}()),\r\n\r\n\t_initPath: function () {\r\n\t\tvar container = this._container = this._createElement('shape');\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-vml-shape' +\r\n\t\t\t(this.options.className ? ' ' + this.options.className : ''));\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-clickable');\r\n\t\t}\r\n\r\n\t\tcontainer.coordsize = '1 1';\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\t\tcontainer.appendChild(this._path);\r\n\r\n\t\tthis._map._pathRoot.appendChild(container);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar stroke = this._stroke,\r\n\t\t    fill = this._fill,\r\n\t\t    options = this.options,\r\n\t\t    container = this._container;\r\n\r\n\t\tcontainer.stroked = options.stroke;\r\n\t\tcontainer.filled = options.fill;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tif (!stroke) {\r\n\t\t\t\tstroke = this._stroke = this._createElement('stroke');\r\n\t\t\t\tstroke.endcap = 'round';\r\n\t\t\t\tcontainer.appendChild(stroke);\r\n\t\t\t}\r\n\t\t\tstroke.weight = options.weight + 'px';\r\n\t\t\tstroke.color = options.color;\r\n\t\t\tstroke.opacity = options.opacity;\r\n\r\n\t\t\tif (options.dashArray) {\r\n\t\t\t\tstroke.dashStyle = L.Util.isArray(options.dashArray) ?\r\n\t\t\t\t    options.dashArray.join(' ') :\r\n\t\t\t\t    options.dashArray.replace(/( *, *)/g, ' ');\r\n\t\t\t} else {\r\n\t\t\t\tstroke.dashStyle = '';\r\n\t\t\t}\r\n\t\t\tif (options.lineCap) {\r\n\t\t\t\tstroke.endcap = options.lineCap.replace('butt', 'flat');\r\n\t\t\t}\r\n\t\t\tif (options.lineJoin) {\r\n\t\t\t\tstroke.joinstyle = options.lineJoin;\r\n\t\t\t}\r\n\r\n\t\t} else if (stroke) {\r\n\t\t\tcontainer.removeChild(stroke);\r\n\t\t\tthis._stroke = null;\r\n\t\t}\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tif (!fill) {\r\n\t\t\t\tfill = this._fill = this._createElement('fill');\r\n\t\t\t\tcontainer.appendChild(fill);\r\n\t\t\t}\r\n\t\t\tfill.color = options.fillColor || options.color;\r\n\t\t\tfill.opacity = options.fillOpacity;\r\n\r\n\t\t} else if (fill) {\r\n\t\t\tcontainer.removeChild(fill);\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar style = this._container.style;\r\n\r\n\t\tstyle.display = 'none';\r\n\t\tthis._path.v = this.getPathString() + ' '; // the space fixes IE empty path string bug\r\n\t\tstyle.display = '';\r\n\t}\r\n});\r\n\r\nL.Map.include(L.Browser.svg || !L.Browser.vml ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tif (this._pathRoot) { return; }\r\n\r\n\t\tvar root = this._pathRoot = document.createElement('div');\r\n\t\troot.className = 'leaflet-vml-container';\r\n\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\tthis.on('moveend', this._updatePathViewport);\r\n\t\tthis._updatePathViewport();\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Vector rendering for all browsers that support canvas.\r\n */\r\n\r\nL.Browser.canvas = (function () {\r\n\treturn !!document.createElement('canvas').getContext;\r\n}());\r\n\r\nL.Path = (L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\t//CLIP_PADDING: 0.02, // not sure if there's a need to set it to a small value\r\n\t\tCANVAS: true,\r\n\t\tSVG: false\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateStyle();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('viewreset', this.projectLatlngs, this)\r\n\t\t    .off('moveend', this._updatePath, this);\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tthis._map.off('click', this._onClick, this);\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\r\n\t\tthis._requestUpdate();\r\n\t\t\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\t_requestUpdate: function () {\r\n\t\tif (this._map && !L.Path._updateRequest) {\r\n\t\t\tL.Path._updateRequest = L.Util.requestAnimFrame(this._fireMapMoveEnd, this._map);\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMapMoveEnd: function () {\r\n\t\tL.Path._updateRequest = null;\r\n\t\tthis.fire('moveend');\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._ctx = this._map._canvasCtx;\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tthis._ctx.lineWidth = options.weight;\r\n\t\t\tthis._ctx.strokeStyle = options.color;\r\n\t\t}\r\n\t\tif (options.fill) {\r\n\t\t\tthis._ctx.fillStyle = options.fillColor || options.color;\r\n\t\t}\r\n\t},\r\n\r\n\t_drawPath: function () {\r\n\t\tvar i, j, len, len2, point, drawMethod;\r\n\r\n\t\tthis._ctx.beginPath();\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tfor (j = 0, len2 = this._parts[i].length; j < len2; j++) {\r\n\t\t\t\tpoint = this._parts[i][j];\r\n\t\t\t\tdrawMethod = (j === 0 ? 'move' : 'line') + 'To';\r\n\r\n\t\t\t\tthis._ctx[drawMethod](point.x, point.y);\r\n\t\t\t}\r\n\t\t\t// TODO refactor ugly hack\r\n\t\t\tif (this instanceof L.Polygon) {\r\n\t\t\t\tthis._ctx.closePath();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\treturn !this._parts.length;\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (this._checkIfEmpty()) { return; }\r\n\r\n\t\tvar ctx = this._ctx,\r\n\t\t    options = this.options;\r\n\r\n\t\tthis._drawPath();\r\n\t\tctx.save();\r\n\t\tthis._updateStyle();\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tctx.globalAlpha = options.fillOpacity;\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tctx.globalAlpha = options.opacity;\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\r\n\t\tctx.restore();\r\n\r\n\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\t// TODO dblclick\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t\tthis._map.on('click', this._onClick, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onClick: function (e) {\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis.fire('click', e);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tif (!this._map || this._map._animatingZoom) { return; }\r\n\r\n\t\t// TODO don't do on each move\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis._ctx.canvas.style.cursor = 'pointer';\r\n\t\t\tthis._mouseInside = true;\r\n\t\t\tthis.fire('mouseover', e);\r\n\r\n\t\t} else if (this._mouseInside) {\r\n\t\t\tthis._ctx.canvas.style.cursor = '';\r\n\t\t\tthis._mouseInside = false;\r\n\t\t\tthis.fire('mouseout', e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include((L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tvar root = this._pathRoot,\r\n\t\t    ctx;\r\n\r\n\t\tif (!root) {\r\n\t\t\troot = this._pathRoot = document.createElement('canvas');\r\n\t\t\troot.style.position = 'absolute';\r\n\t\t\tctx = this._canvasCtx = root.getContext('2d');\r\n\r\n\t\t\tctx.lineCap = 'round';\r\n\t\t\tctx.lineJoin = 'round';\r\n\r\n\t\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\t\tif (this.options.zoomAnimation) {\r\n\t\t\t\tthis._pathRoot.className = 'leaflet-zoom-animated';\r\n\t\t\t\tthis.on('zoomanim', this._animatePathZoom);\r\n\t\t\t\tthis.on('zoomend', this._endPathZoom);\r\n\t\t\t}\r\n\t\t\tthis.on('moveend', this._updateCanvasViewport);\r\n\t\t\tthis._updateCanvasViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateCanvasViewport: function () {\r\n\t\t// don't redraw while zooming. See _updateSvgViewport for more details\r\n\t\tif (this._pathZooming) { return; }\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    size = vp.max.subtract(min),\r\n\t\t    root = this._pathRoot;\r\n\r\n\t\t//TODO check if this works properly on mobile webkit\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.width = size.x;\r\n\t\troot.height = size.y;\r\n\t\troot.getContext('2d').translate(-min.x, -min.y);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.LineUtil contains different utility functions for line segments\r\n * and polylines (clipping, simplification, distances, etc.)\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations for this file\r\n\r\nL.LineUtil = {\r\n\r\n\t// Simplify polyline with vertex reduction and Douglas-Peucker simplification.\r\n\t// Improves rendering performance dramatically by lessening the number of points to draw.\r\n\r\n\tsimplify: function (/*Point[]*/ points, /*Number*/ tolerance) {\r\n\t\tif (!tolerance || !points.length) {\r\n\t\t\treturn points.slice();\r\n\t\t}\r\n\r\n\t\tvar sqTolerance = tolerance * tolerance;\r\n\r\n\t\t// stage 1: vertex reduction\r\n\t\tpoints = this._reducePoints(points, sqTolerance);\r\n\r\n\t\t// stage 2: Douglas-Peucker simplification\r\n\t\tpoints = this._simplifyDP(points, sqTolerance);\r\n\r\n\t\treturn points;\r\n\t},\r\n\r\n\t// distance from a point to a segment between two points\r\n\tpointToSegmentDistance:  function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn Math.sqrt(this._sqClosestPointOnSegment(p, p1, p2, true));\r\n\t},\r\n\r\n\tclosestPointOnSegment: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn this._sqClosestPointOnSegment(p, p1, p2);\r\n\t},\r\n\r\n\t// Douglas-Peucker simplification, see http://en.wikipedia.org/wiki/Douglas-Peucker_algorithm\r\n\t_simplifyDP: function (points, sqTolerance) {\r\n\r\n\t\tvar len = points.length,\r\n\t\t    ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,\r\n\t\t    markers = new ArrayConstructor(len);\r\n\r\n\t\tmarkers[0] = markers[len - 1] = 1;\r\n\r\n\t\tthis._simplifyDPStep(points, markers, sqTolerance, 0, len - 1);\r\n\r\n\t\tvar i,\r\n\t\t    newPoints = [];\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tif (markers[i]) {\r\n\t\t\t\tnewPoints.push(points[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newPoints;\r\n\t},\r\n\r\n\t_simplifyDPStep: function (points, markers, sqTolerance, first, last) {\r\n\r\n\t\tvar maxSqDist = 0,\r\n\t\t    index, i, sqDist;\r\n\r\n\t\tfor (i = first + 1; i <= last - 1; i++) {\r\n\t\t\tsqDist = this._sqClosestPointOnSegment(points[i], points[first], points[last], true);\r\n\r\n\t\t\tif (sqDist > maxSqDist) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tmaxSqDist = sqDist;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (maxSqDist > sqTolerance) {\r\n\t\t\tmarkers[index] = 1;\r\n\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, first, index);\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, index, last);\r\n\t\t}\r\n\t},\r\n\r\n\t// reduce points that are too close to each other to a single point\r\n\t_reducePoints: function (points, sqTolerance) {\r\n\t\tvar reducedPoints = [points[0]];\r\n\r\n\t\tfor (var i = 1, prev = 0, len = points.length; i < len; i++) {\r\n\t\t\tif (this._sqDist(points[i], points[prev]) > sqTolerance) {\r\n\t\t\t\treducedPoints.push(points[i]);\r\n\t\t\t\tprev = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (prev < len - 1) {\r\n\t\t\treducedPoints.push(points[len - 1]);\r\n\t\t}\r\n\t\treturn reducedPoints;\r\n\t},\r\n\r\n\t// Cohen-Sutherland line clipping algorithm.\r\n\t// Used to avoid rendering parts of a polyline that are not currently visible.\r\n\r\n\tclipSegment: function (a, b, bounds, useLastCode) {\r\n\t\tvar codeA = useLastCode ? this._lastCode : this._getBitCode(a, bounds),\r\n\t\t    codeB = this._getBitCode(b, bounds),\r\n\r\n\t\t    codeOut, p, newCode;\r\n\r\n\t\t// save 2nd code to avoid calculating it on the next segment\r\n\t\tthis._lastCode = codeB;\r\n\r\n\t\twhile (true) {\r\n\t\t\t// if a,b is inside the clip window (trivial accept)\r\n\t\t\tif (!(codeA | codeB)) {\r\n\t\t\t\treturn [a, b];\r\n\t\t\t// if a,b is outside the clip window (trivial reject)\r\n\t\t\t} else if (codeA & codeB) {\r\n\t\t\t\treturn false;\r\n\t\t\t// other cases\r\n\t\t\t} else {\r\n\t\t\t\tcodeOut = codeA || codeB;\r\n\t\t\t\tp = this._getEdgeIntersection(a, b, codeOut, bounds);\r\n\t\t\t\tnewCode = this._getBitCode(p, bounds);\r\n\r\n\t\t\t\tif (codeOut === codeA) {\r\n\t\t\t\t\ta = p;\r\n\t\t\t\t\tcodeA = newCode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tb = p;\r\n\t\t\t\t\tcodeB = newCode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getEdgeIntersection: function (a, b, code, bounds) {\r\n\t\tvar dx = b.x - a.x,\r\n\t\t    dy = b.y - a.y,\r\n\t\t    min = bounds.min,\r\n\t\t    max = bounds.max;\r\n\r\n\t\tif (code & 8) { // top\r\n\t\t\treturn new L.Point(a.x + dx * (max.y - a.y) / dy, max.y);\r\n\t\t} else if (code & 4) { // bottom\r\n\t\t\treturn new L.Point(a.x + dx * (min.y - a.y) / dy, min.y);\r\n\t\t} else if (code & 2) { // right\r\n\t\t\treturn new L.Point(max.x, a.y + dy * (max.x - a.x) / dx);\r\n\t\t} else if (code & 1) { // left\r\n\t\t\treturn new L.Point(min.x, a.y + dy * (min.x - a.x) / dx);\r\n\t\t}\r\n\t},\r\n\r\n\t_getBitCode: function (/*Point*/ p, bounds) {\r\n\t\tvar code = 0;\r\n\r\n\t\tif (p.x < bounds.min.x) { // left\r\n\t\t\tcode |= 1;\r\n\t\t} else if (p.x > bounds.max.x) { // right\r\n\t\t\tcode |= 2;\r\n\t\t}\r\n\t\tif (p.y < bounds.min.y) { // bottom\r\n\t\t\tcode |= 4;\r\n\t\t} else if (p.y > bounds.max.y) { // top\r\n\t\t\tcode |= 8;\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t},\r\n\r\n\t// square distance (to avoid unnecessary Math.sqrt calls)\r\n\t_sqDist: function (p1, p2) {\r\n\t\tvar dx = p2.x - p1.x,\r\n\t\t    dy = p2.y - p1.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\t},\r\n\r\n\t// return closest point on segment or distance to that point\r\n\t_sqClosestPointOnSegment: function (p, p1, p2, sqDist) {\r\n\t\tvar x = p1.x,\r\n\t\t    y = p1.y,\r\n\t\t    dx = p2.x - x,\r\n\t\t    dy = p2.y - y,\r\n\t\t    dot = dx * dx + dy * dy,\r\n\t\t    t;\r\n\r\n\t\tif (dot > 0) {\r\n\t\t\tt = ((p.x - x) * dx + (p.y - y) * dy) / dot;\r\n\r\n\t\t\tif (t > 1) {\r\n\t\t\t\tx = p2.x;\r\n\t\t\t\ty = p2.y;\r\n\t\t\t} else if (t > 0) {\r\n\t\t\t\tx += dx * t;\r\n\t\t\t\ty += dy * t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdx = p.x - x;\r\n\t\tdy = p.y - y;\r\n\r\n\t\treturn sqDist ? dx * dx + dy * dy : new L.Point(x, y);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * L.Polyline is used to display polylines on a map.\r\n */\r\n\r\nL.Polyline = L.Path.extend({\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t},\r\n\r\n\toptions: {\r\n\t\t// how much to simplify the polyline on each zoom level\r\n\t\t// more = better performance and smoother look, less = more accurate\r\n\t\tsmoothFactor: 1.0,\r\n\t\tnoClip: false\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._originalPoints = [];\r\n\r\n\t\tfor (var i = 0, len = this._latlngs.length; i < len; i++) {\r\n\t\t\tthis._originalPoints[i] = this._map.latLngToLayerPoint(this._latlngs[i]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tfor (var i = 0, len = this._parts.length, str = ''; i < len; i++) {\r\n\t\t\tstr += this._getPathPartStr(this._parts[i]);\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\tgetLatLngs: function () {\r\n\t\treturn this._latlngs;\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\taddLatLng: function (latlng) {\r\n\t\tthis._latlngs.push(L.latLng(latlng));\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tspliceLatLngs: function () { // (Number index, Number howMany)\r\n\t\tvar removed = [].splice.apply(this._latlngs, arguments);\r\n\t\tthis._convertLatLngs(this._latlngs, true);\r\n\t\tthis.redraw();\r\n\t\treturn removed;\r\n\t},\r\n\r\n\tclosestLayerPoint: function (p) {\r\n\t\tvar minDistance = Infinity, parts = this._parts, p1, p2, minPoint = null;\r\n\r\n\t\tfor (var j = 0, jLen = parts.length; j < jLen; j++) {\r\n\t\t\tvar points = parts[j];\r\n\t\t\tfor (var i = 1, len = points.length; i < len; i++) {\r\n\t\t\t\tp1 = points[i - 1];\r\n\t\t\t\tp2 = points[i];\r\n\t\t\t\tvar sqDist = L.LineUtil._sqClosestPointOnSegment(p, p1, p2, true);\r\n\t\t\t\tif (sqDist < minDistance) {\r\n\t\t\t\t\tminDistance = sqDist;\r\n\t\t\t\t\tminPoint = L.LineUtil._sqClosestPointOnSegment(p, p1, p2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (minPoint) {\r\n\t\t\tminPoint.distance = Math.sqrt(minDistance);\r\n\t\t}\r\n\t\treturn minPoint;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\treturn new L.LatLngBounds(this.getLatLngs());\r\n\t},\r\n\r\n\t_convertLatLngs: function (latlngs, overwrite) {\r\n\t\tvar i, len, target = overwrite ? latlngs : [];\r\n\r\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\r\n\t\t\tif (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttarget[i] = L.latLng(latlngs[i]);\r\n\t\t}\r\n\t\treturn target;\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tL.Path.prototype._initEvents.call(this);\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar round = L.Path.VML;\r\n\r\n\t\tfor (var j = 0, len2 = points.length, str = '', p; j < len2; j++) {\r\n\t\t\tp = points[j];\r\n\t\t\tif (round) {\r\n\t\t\t\tp._round();\r\n\t\t\t}\r\n\t\t\tstr += (j ? 'L' : 'M') + p.x + ' ' + p.y;\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    len = points.length,\r\n\t\t    i, k, segment;\r\n\r\n\t\tif (this.options.noClip) {\r\n\t\t\tthis._parts = [points];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._parts = [];\r\n\r\n\t\tvar parts = this._parts,\r\n\t\t    vp = this._map._pathViewport,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (i = 0, k = 0; i < len - 1; i++) {\r\n\t\t\tsegment = lu.clipSegment(points[i], points[i + 1], vp, i);\r\n\t\t\tif (!segment) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tparts[k] = parts[k] || [];\r\n\t\t\tparts[k].push(segment[0]);\r\n\r\n\t\t\t// if segment goes out of screen, or it's the last one, it's the end of the line part\r\n\t\t\tif ((segment[1] !== points[i + 1]) || (i === len - 2)) {\r\n\t\t\t\tparts[k].push(segment[1]);\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// simplify each clipped part of the polyline\r\n\t_simplifyPoints: function () {\r\n\t\tvar parts = this._parts,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tparts[i] = lu.simplify(parts[i], this.options.smoothFactor);\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._clipPoints();\r\n\t\tthis._simplifyPoints();\r\n\r\n\t\tL.Path.prototype._updatePath.call(this);\r\n\t}\r\n});\r\n\r\nL.polyline = function (latlngs, options) {\r\n\treturn new L.Polyline(latlngs, options);\r\n};\r\n\r\n\r\n/*\r\n * L.PolyUtil contains utility functions for polygons (clipping, etc.).\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations here\r\n\r\nL.PolyUtil = {};\r\n\r\n/*\r\n * Sutherland-Hodgeman polygon clipping algorithm.\r\n * Used to avoid rendering parts of a polygon that are not currently visible.\r\n */\r\nL.PolyUtil.clipPolygon = function (points, bounds) {\r\n\tvar clippedPoints,\r\n\t    edges = [1, 4, 2, 8],\r\n\t    i, j, k,\r\n\t    a, b,\r\n\t    len, edge, p,\r\n\t    lu = L.LineUtil;\r\n\r\n\tfor (i = 0, len = points.length; i < len; i++) {\r\n\t\tpoints[i]._code = lu._getBitCode(points[i], bounds);\r\n\t}\r\n\r\n\t// for each edge (left, bottom, right, top)\r\n\tfor (k = 0; k < 4; k++) {\r\n\t\tedge = edges[k];\r\n\t\tclippedPoints = [];\r\n\r\n\t\tfor (i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n\t\t\ta = points[i];\r\n\t\t\tb = points[j];\r\n\r\n\t\t\t// if a is inside the clip window\r\n\t\t\tif (!(a._code & edge)) {\r\n\t\t\t\t// if b is outside the clip window (a->b goes out of screen)\r\n\t\t\t\tif (b._code & edge) {\r\n\t\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\t\tclippedPoints.push(p);\r\n\t\t\t\t}\r\n\t\t\t\tclippedPoints.push(a);\r\n\r\n\t\t\t// else if b is inside the clip window (a->b enters the screen)\r\n\t\t\t} else if (!(b._code & edge)) {\r\n\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\tclippedPoints.push(p);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpoints = clippedPoints;\r\n\t}\r\n\r\n\treturn points;\r\n};\r\n\r\n\r\n/*\r\n * L.Polygon is used to display polygons on a map.\r\n */\r\n\r\nL.Polygon = L.Polyline.extend({\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Polyline.prototype.initialize.call(this, latlngs, options);\r\n\t\tthis._initWithHoles(latlngs);\r\n\t},\r\n\r\n\t_initWithHoles: function (latlngs) {\r\n\t\tvar i, len, hole;\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._latlngs = this._convertLatLngs(latlngs[0]);\r\n\t\t\tthis._holes = latlngs.slice(1);\r\n\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = this._holes[i] = this._convertLatLngs(this._holes[i]);\r\n\t\t\t\tif (hole[0].equals(hole[hole.length - 1])) {\r\n\t\t\t\t\thole.pop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// filter out last point if its equal to the first one\r\n\t\tlatlngs = this._latlngs;\r\n\r\n\t\tif (latlngs.length >= 2 && latlngs[0].equals(latlngs[latlngs.length - 1])) {\r\n\t\t\tlatlngs.pop();\r\n\t\t}\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tL.Polyline.prototype.projectLatlngs.call(this);\r\n\r\n\t\t// project polygon holes points\r\n\t\t// TODO move this logic to Polyline to get rid of duplication\r\n\t\tthis._holePoints = [];\r\n\r\n\t\tif (!this._holes) { return; }\r\n\r\n\t\tvar i, j, len, len2;\r\n\r\n\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\tthis._holePoints[i] = [];\r\n\r\n\t\t\tfor (j = 0, len2 = this._holes[i].length; j < len2; j++) {\r\n\t\t\t\tthis._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._initWithHoles(latlngs);\r\n\t\t\treturn this.redraw();\r\n\t\t} else {\r\n\t\t\treturn L.Polyline.prototype.setLatLngs.call(this, latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    newParts = [];\r\n\r\n\t\tthis._parts = [points].concat(this._holePoints);\r\n\r\n\t\tif (this.options.noClip) { return; }\r\n\r\n\t\tfor (var i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tvar clipped = L.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);\r\n\t\t\tif (clipped.length) {\r\n\t\t\t\tnewParts.push(clipped);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._parts = newParts;\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar str = L.Polyline.prototype._getPathPartStr.call(this, points);\r\n\t\treturn str + (L.Browser.svg ? 'z' : 'x');\r\n\t}\r\n});\r\n\r\nL.polygon = function (latlngs, options) {\r\n\treturn new L.Polygon(latlngs, options);\r\n};\r\n\r\n\r\n/*\r\n * Contains L.MultiPolyline and L.MultiPolygon layers.\r\n */\r\n\r\n(function () {\r\n\tfunction createMulti(Klass) {\r\n\r\n\t\treturn L.FeatureGroup.extend({\r\n\r\n\t\t\tinitialize: function (latlngs, options) {\r\n\t\t\t\tthis._layers = {};\r\n\t\t\t\tthis._options = options;\r\n\t\t\t\tthis.setLatLngs(latlngs);\r\n\t\t\t},\r\n\r\n\t\t\tsetLatLngs: function (latlngs) {\r\n\t\t\t\tvar i = 0,\r\n\t\t\t\t    len = latlngs.length;\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tif (i < len) {\r\n\t\t\t\t\t\tlayer.setLatLngs(latlngs[i++]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.removeLayer(layer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\twhile (i < len) {\r\n\t\t\t\t\tthis.addLayer(new Klass(latlngs[i++], this._options));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tgetLatLngs: function () {\r\n\t\t\t\tvar latlngs = [];\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tlatlngs.push(layer.getLatLngs());\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn latlngs;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tL.MultiPolyline = createMulti(L.Polyline);\r\n\tL.MultiPolygon = createMulti(L.Polygon);\r\n\r\n\tL.multiPolyline = function (latlngs, options) {\r\n\t\treturn new L.MultiPolyline(latlngs, options);\r\n\t};\r\n\r\n\tL.multiPolygon = function (latlngs, options) {\r\n\t\treturn new L.MultiPolygon(latlngs, options);\r\n\t};\r\n}());\r\n\r\n\r\n/*\r\n * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.\r\n */\r\n\r\nL.Rectangle = L.Polygon.extend({\r\n\tinitialize: function (latLngBounds, options) {\r\n\t\tL.Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);\r\n\t},\r\n\r\n\tsetBounds: function (latLngBounds) {\r\n\t\tthis.setLatLngs(this._boundsToLatLngs(latLngBounds));\r\n\t},\r\n\r\n\t_boundsToLatLngs: function (latLngBounds) {\r\n\t\tlatLngBounds = L.latLngBounds(latLngBounds);\r\n\t\treturn [\r\n\t\t\tlatLngBounds.getSouthWest(),\r\n\t\t\tlatLngBounds.getNorthWest(),\r\n\t\t\tlatLngBounds.getNorthEast(),\r\n\t\t\tlatLngBounds.getSouthEast()\r\n\t\t];\r\n\t}\r\n});\r\n\r\nL.rectangle = function (latLngBounds, options) {\r\n\treturn new L.Rectangle(latLngBounds, options);\r\n};\r\n\r\n\r\n/*\r\n * L.Circle is a circle overlay (with a certain radius in meters).\r\n */\r\n\r\nL.Circle = L.Path.extend({\r\n\tinitialize: function (latlng, radius, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tthis._mRadius = radius;\r\n\t},\r\n\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis._mRadius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latlng = this._latlng,\r\n\t\t    pointLeft = this._map.latLngToLayerPoint([latlng.lat, latlng.lng - lngRadius]);\r\n\r\n\t\tthis._point = this._map.latLngToLayerPoint(latlng);\r\n\t\tthis._radius = Math.max(this._point.x - pointLeft.x, 1);\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latRadius = (this._mRadius / 40075017) * 360,\r\n\t\t    latlng = this._latlng;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        [latlng.lat - latRadius, latlng.lng - lngRadius],\r\n\t\t        [latlng.lat + latRadius, latlng.lng + lngRadius]);\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tvar p = this._point,\r\n\t\t    r = this._radius;\r\n\r\n\t\tif (this._checkIfEmpty()) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif (L.Browser.svg) {\r\n\t\t\treturn 'M' + p.x + ',' + (p.y - r) +\r\n\t\t\t       'A' + r + ',' + r + ',0,1,1,' +\r\n\t\t\t       (p.x - 0.1) + ',' + (p.y - r) + ' z';\r\n\t\t} else {\r\n\t\t\tp._round();\r\n\t\t\tr = Math.round(r);\r\n\t\t\treturn 'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r + ' 0,' + (65535 * 360);\r\n\t\t}\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._mRadius;\r\n\t},\r\n\r\n\t// TODO Earth hardcoded, move into projection code!\r\n\r\n\t_getLatRadius: function () {\r\n\t\treturn (this._mRadius / 40075017) * 360;\r\n\t},\r\n\r\n\t_getLngRadius: function () {\r\n\t\treturn this._getLatRadius() / Math.cos(L.LatLng.DEG_TO_RAD * this._latlng.lat);\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\tif (!this._map) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar vp = this._map._pathViewport,\r\n\t\t    r = this._radius,\r\n\t\t    p = this._point;\r\n\r\n\t\treturn p.x - r > vp.max.x || p.y - r > vp.max.y ||\r\n\t\t       p.x + r < vp.min.x || p.y + r < vp.min.y;\r\n\t}\r\n});\r\n\r\nL.circle = function (latlng, radius, options) {\r\n\treturn new L.Circle(latlng, radius, options);\r\n};\r\n\r\n\r\n/*\r\n * L.CircleMarker is a circle overlay with a permanent pixel radius.\r\n */\r\n\r\nL.CircleMarker = L.Circle.extend({\r\n\toptions: {\r\n\t\tradius: 10,\r\n\t\tweight: 2\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.Circle.prototype.initialize.call(this, latlng, null, options);\r\n\t\tthis._radius = this.options.radius;\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\r\n\t},\r\n\r\n\t_updateStyle : function () {\r\n\t\tL.Circle.prototype._updateStyle.call(this);\r\n\t\tthis.setRadius(this.options.radius);\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tL.Circle.prototype.setLatLng.call(this, latlng);\r\n\t\tif (this._popup && this._popup._isOpen) {\r\n\t\t\tthis._popup.setLatLng(latlng);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis.options.radius = this._radius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._radius;\r\n\t}\r\n});\r\n\r\nL.circleMarker = function (latlng, options) {\r\n\treturn new L.CircleMarker(latlng, options);\r\n};\r\n\r\n\r\n/*\r\n * Extends L.Polyline to be able to manually detect clicks on Canvas-rendered polylines.\r\n */\r\n\r\nL.Polyline.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p, closed) {\r\n\t\tvar i, j, k, len, len2, dist, part,\r\n\t\t    w = this.options.weight / 2;\r\n\r\n\t\tif (L.Browser.touch) {\r\n\t\t\tw += 10; // polyline click tolerance on touch devices\r\n\t\t}\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tif (!closed && (j === 0)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist = L.LineUtil.pointToSegmentDistance(p, part[k], part[j]);\r\n\r\n\t\t\t\tif (dist <= w) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Polygon to be able to manually detect clicks on Canvas-rendered polygons.\r\n */\r\n\r\nL.Polygon.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p) {\r\n\t\tvar inside = false,\r\n\t\t    part, p1, p2,\r\n\t\t    i, j, k,\r\n\t\t    len, len2;\r\n\r\n\t\t// TODO optimization: check if within bounds first\r\n\r\n\t\tif (L.Polyline.prototype._containsPoint.call(this, p, true)) {\r\n\t\t\t// click on polygon border\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// ray casting algorithm for detecting if point is in polygon\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tp1 = part[j];\r\n\t\t\t\tp2 = part[k];\r\n\r\n\t\t\t\tif (((p1.y > p.y) !== (p2.y > p.y)) &&\r\n\t\t\t\t\t\t(p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n\t\t\t\t\tinside = !inside;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn inside;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Circle with Canvas-specific code.\r\n */\r\n\r\nL.Circle.include(!L.Path.CANVAS ? {} : {\r\n\t_drawPath: function () {\r\n\t\tvar p = this._point;\r\n\t\tthis._ctx.beginPath();\r\n\t\tthis._ctx.arc(p.x, p.y, this._radius, 0, Math.PI * 2, false);\r\n\t},\r\n\r\n\t_containsPoint: function (p) {\r\n\t\tvar center = this._point,\r\n\t\t    w2 = this.options.stroke ? this.options.weight / 2 : 0;\r\n\r\n\t\treturn (p.distanceTo(center) <= this._radius + w2);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * CircleMarker canvas specific drawing parts.\r\n */\r\n\r\nL.CircleMarker.include(!L.Path.CANVAS ? {} : {\r\n\t_updateStyle: function () {\r\n\t\tL.Path.prototype._updateStyle.call(this);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.GeoJSON turns any GeoJSON data into a Leaflet layer.\r\n */\r\n\r\nL.GeoJSON = L.FeatureGroup.extend({\r\n\r\n\tinitialize: function (geojson, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\r\n\t\tif (geojson) {\r\n\t\t\tthis.addData(geojson);\r\n\t\t}\r\n\t},\r\n\r\n\taddData: function (geojson) {\r\n\t\tvar features = L.Util.isArray(geojson) ? geojson : geojson.features,\r\n\t\t    i, len, feature;\r\n\r\n\t\tif (features) {\r\n\t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n\t\t\t\t// Only add this if geometry or geometries are set and not null\r\n\t\t\t\tfeature = features[i];\r\n\t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n\t\t\t\t\tthis.addData(features[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.filter && !options.filter(geojson)) { return; }\r\n\r\n\t\tvar layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);\r\n\t\tlayer.feature = L.GeoJSON.asFeature(geojson);\r\n\r\n\t\tlayer.defaultOptions = layer.options;\r\n\t\tthis.resetStyle(layer);\r\n\r\n\t\tif (options.onEachFeature) {\r\n\t\t\toptions.onEachFeature(geojson, layer);\r\n\t\t}\r\n\r\n\t\treturn this.addLayer(layer);\r\n\t},\r\n\r\n\tresetStyle: function (layer) {\r\n\t\tvar style = this.options.style;\r\n\t\tif (style) {\r\n\t\t\t// reset any custom styles\r\n\t\t\tL.Util.extend(layer.options, layer.defaultOptions);\r\n\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_setLayerStyle: function (layer, style) {\r\n\t\tif (typeof style === 'function') {\r\n\t\t\tstyle = style(layer.feature);\r\n\t\t}\r\n\t\tif (layer.setStyle) {\r\n\t\t\tlayer.setStyle(style);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.extend(L.GeoJSON, {\r\n\tgeometryToLayer: function (geojson, pointToLayer, coordsToLatLng, vectorOptions) {\r\n\t\tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n\t\t    coords = geometry.coordinates,\r\n\t\t    layers = [],\r\n\t\t    latlng, latlngs, i, len;\r\n\r\n\t\tcoordsToLatLng = coordsToLatLng || this.coordsToLatLng;\r\n\r\n\t\tswitch (geometry.type) {\r\n\t\tcase 'Point':\r\n\t\t\tlatlng = coordsToLatLng(coords);\r\n\t\t\treturn pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);\r\n\r\n\t\tcase 'MultiPoint':\r\n\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\tlatlng = coordsToLatLng(coords[i]);\r\n\t\t\t\tlayers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tcase 'LineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);\r\n\t\t\treturn new L.Polyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'Polygon':\r\n\t\t\tif (coords.length === 2 && !coords[1].length) {\r\n\t\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t\t}\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.Polygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiLineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiPolygon':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'GeometryCollection':\r\n\t\t\tfor (i = 0, len = geometry.geometries.length; i < len; i++) {\r\n\r\n\t\t\t\tlayers.push(this.geometryToLayer({\r\n\t\t\t\t\tgeometry: geometry.geometries[i],\r\n\t\t\t\t\ttype: 'Feature',\r\n\t\t\t\t\tproperties: geojson.properties\r\n\t\t\t\t}, pointToLayer, coordsToLatLng, vectorOptions));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tdefault:\r\n\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t}\r\n\t},\r\n\r\n\tcoordsToLatLng: function (coords) { // (Array[, Boolean]) -> LatLng\r\n\t\treturn new L.LatLng(coords[1], coords[0], coords[2]);\r\n\t},\r\n\r\n\tcoordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array\r\n\t\tvar latlng, i, len,\r\n\t\t    latlngs = [];\r\n\r\n\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\tlatlng = levelsDeep ?\r\n\t\t\t        this.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :\r\n\t\t\t        (coordsToLatLng || this.coordsToLatLng)(coords[i]);\r\n\r\n\t\t\tlatlngs.push(latlng);\r\n\t\t}\r\n\r\n\t\treturn latlngs;\r\n\t},\r\n\r\n\tlatLngToCoords: function (latlng) {\r\n\t\tvar coords = [latlng.lng, latlng.lat];\r\n\r\n\t\tif (latlng.alt !== undefined) {\r\n\t\t\tcoords.push(latlng.alt);\r\n\t\t}\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tlatLngsToCoords: function (latLngs) {\r\n\t\tvar coords = [];\r\n\r\n\t\tfor (var i = 0, len = latLngs.length; i < len; i++) {\r\n\t\t\tcoords.push(L.GeoJSON.latLngToCoords(latLngs[i]));\r\n\t\t}\r\n\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tgetFeature: function (layer, newGeometry) {\r\n\t\treturn layer.feature ? L.extend({}, layer.feature, {geometry: newGeometry}) : L.GeoJSON.asFeature(newGeometry);\r\n\t},\r\n\r\n\tasFeature: function (geoJSON) {\r\n\t\tif (geoJSON.type === 'Feature') {\r\n\t\t\treturn geoJSON;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: 'Feature',\r\n\t\t\tproperties: {},\r\n\t\t\tgeometry: geoJSON\r\n\t\t};\r\n\t}\r\n});\r\n\r\nvar PointToGeoJSON = {\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Point',\r\n\t\t\tcoordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\r\n\t\t});\r\n\t}\r\n};\r\n\r\nL.Marker.include(PointToGeoJSON);\r\nL.Circle.include(PointToGeoJSON);\r\nL.CircleMarker.include(PointToGeoJSON);\r\n\r\nL.Polyline.include({\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'LineString',\r\n\t\t\tcoordinates: L.GeoJSON.latLngsToCoords(this.getLatLngs())\r\n\t\t});\r\n\t}\r\n});\r\n\r\nL.Polygon.include({\r\n\ttoGeoJSON: function () {\r\n\t\tvar coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],\r\n\t\t    i, len, hole;\r\n\r\n\t\tcoords[0].push(coords[0][0]);\r\n\r\n\t\tif (this._holes) {\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = L.GeoJSON.latLngsToCoords(this._holes[i]);\r\n\t\t\t\thole.push(hole[0]);\r\n\t\t\t\tcoords.push(hole);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Polygon',\r\n\t\t\tcoordinates: coords\r\n\t\t});\r\n\t}\r\n});\r\n\r\n(function () {\r\n\tfunction multiToGeoJSON(type) {\r\n\t\treturn function () {\r\n\t\t\tvar coords = [];\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tcoords.push(layer.toGeoJSON().geometry.coordinates);\r\n\t\t\t});\r\n\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tcoordinates: coords\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\r\n\tL.MultiPolyline.include({toGeoJSON: multiToGeoJSON('MultiLineString')});\r\n\tL.MultiPolygon.include({toGeoJSON: multiToGeoJSON('MultiPolygon')});\r\n\r\n\tL.LayerGroup.include({\r\n\t\ttoGeoJSON: function () {\r\n\r\n\t\t\tvar geometry = this.feature && this.feature.geometry,\r\n\t\t\t\tjsons = [],\r\n\t\t\t\tjson;\r\n\r\n\t\t\tif (geometry && geometry.type === 'MultiPoint') {\r\n\t\t\t\treturn multiToGeoJSON('MultiPoint').call(this);\r\n\t\t\t}\r\n\r\n\t\t\tvar isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tif (layer.toGeoJSON) {\r\n\t\t\t\t\tjson = layer.toGeoJSON();\r\n\t\t\t\t\tjsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (isGeometryCollection) {\r\n\t\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\t\tgeometries: jsons,\r\n\t\t\t\t\ttype: 'GeometryCollection'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'FeatureCollection',\r\n\t\t\t\tfeatures: jsons\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n}());\r\n\r\nL.geoJson = function (geojson, options) {\r\n\treturn new L.GeoJSON(geojson, options);\r\n};\r\n\r\n\r\n/*\r\n * L.DomEvent contains functions for working with DOM events.\r\n */\r\n\r\nL.DomEvent = {\r\n\t/* inspired by John Resig, Dean Edwards and YUI addEvent implementations */\r\n\taddListener: function (obj, type, fn, context) { // (HTMLElement, String, Function[, Object])\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler, originalHandler, newType;\r\n\r\n\t\tif (obj[key]) { return this; }\r\n\r\n\t\thandler = function (e) {\r\n\t\t\treturn fn.call(context || obj, e || L.DomEvent._getEvent());\r\n\t\t};\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\treturn this.addPointerListener(obj, type, handler, id);\r\n\t\t}\r\n\t\tif (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {\r\n\t\t\tthis.addDoubleTapListener(obj, handler, id);\r\n\t\t}\r\n\r\n\t\tif ('addEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.addEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\tnewType = (type === 'mouseenter' ? 'mouseover' : 'mouseout');\r\n\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tif (!L.DomEvent._checkMouse(obj, e)) { return; }\r\n\t\t\t\t\treturn originalHandler(e);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(newType, handler, false);\r\n\r\n\t\t\t} else if (type === 'click' && L.Browser.android) {\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\treturn L.DomEvent._filterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t}\r\n\r\n\t\t} else if ('attachEvent' in obj) {\r\n\t\t\tobj.attachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = handler;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveListener: function (obj, type, fn) {  // (HTMLElement, String, Function)\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler = obj[key];\r\n\r\n\t\tif (!handler) { return this; }\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\tthis.removePointerListener(obj, type, id);\r\n\t\t} else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {\r\n\t\t\tthis.removeDoubleTapListener(obj, id);\r\n\r\n\t\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.removeEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\t\tobj.removeEventListener((type === 'mouseenter' ? 'mouseover' : 'mouseout'), handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\t\t\t}\r\n\t\t} else if ('detachEvent' in obj) {\r\n\t\t\tobj.detachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = null;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopPropagation: function (e) {\r\n\r\n\t\tif (e.stopPropagation) {\r\n\t\t\te.stopPropagation();\r\n\t\t} else {\r\n\t\t\te.cancelBubble = true;\r\n\t\t}\r\n\t\tL.DomEvent._skipped(e);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdisableScrollPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'mousewheel', stop)\r\n\t\t\t.on(el, 'MozMousePixelScroll', stop);\r\n\t},\r\n\r\n\tdisableClickPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(el, L.Draggable.START[i], stop);\r\n\t\t}\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'click', L.DomEvent._fakeStop)\r\n\t\t\t.on(el, 'dblclick', stop);\r\n\t},\r\n\r\n\tpreventDefault: function (e) {\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t} else {\r\n\t\t\te.returnValue = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstop: function (e) {\r\n\t\treturn L.DomEvent\r\n\t\t\t.preventDefault(e)\r\n\t\t\t.stopPropagation(e);\r\n\t},\r\n\r\n\tgetMousePosition: function (e, container) {\r\n\t\tif (!container) {\r\n\t\t\treturn new L.Point(e.clientX, e.clientY);\r\n\t\t}\r\n\r\n\t\tvar rect = container.getBoundingClientRect();\r\n\r\n\t\treturn new L.Point(\r\n\t\t\te.clientX - rect.left - container.clientLeft,\r\n\t\t\te.clientY - rect.top - container.clientTop);\r\n\t},\r\n\r\n\tgetWheelDelta: function (e) {\r\n\r\n\t\tvar delta = 0;\r\n\r\n\t\tif (e.wheelDelta) {\r\n\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t}\r\n\t\tif (e.detail) {\r\n\t\t\tdelta = -e.detail / 3;\r\n\t\t}\r\n\t\treturn delta;\r\n\t},\r\n\r\n\t_skipEvents: {},\r\n\r\n\t_fakeStop: function (e) {\r\n\t\t// fakes stopPropagation by setting a special event flag, checked/reset with L.DomEvent._skipped(e)\r\n\t\tL.DomEvent._skipEvents[e.type] = true;\r\n\t},\r\n\r\n\t_skipped: function (e) {\r\n\t\tvar skipped = this._skipEvents[e.type];\r\n\t\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\t\tthis._skipEvents[e.type] = false;\r\n\t\treturn skipped;\r\n\t},\r\n\r\n\t// check if element really left/entered the event target (for mouseenter/mouseleave)\r\n\t_checkMouse: function (el, e) {\r\n\r\n\t\tvar related = e.relatedTarget;\r\n\r\n\t\tif (!related) { return true; }\r\n\r\n\t\ttry {\r\n\t\t\twhile (related && (related !== el)) {\r\n\t\t\t\trelated = related.parentNode;\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn (related !== el);\r\n\t},\r\n\r\n\t_getEvent: function () { // evil magic for IE\r\n\t\t/*jshint noarg:false */\r\n\t\tvar e = window.event;\r\n\t\tif (!e) {\r\n\t\t\tvar caller = arguments.callee.caller;\r\n\t\t\twhile (caller) {\r\n\t\t\t\te = caller['arguments'][0];\r\n\t\t\t\tif (e && window.Event === e.constructor) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcaller = caller.caller;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn e;\r\n\t},\r\n\r\n\t// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\n\t_filterClick: function (e, handler) {\r\n\t\tvar timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\r\n\t\t\telapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\r\n\r\n\t\t// are they closer together than 500ms yet more than 100ms?\r\n\t\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t\t// on the same event should be triggered far faster;\r\n\t\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\t\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\t\tL.DomEvent.stop(e);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tL.DomEvent._lastClick = timeStamp;\r\n\r\n\t\treturn handler(e);\r\n\t}\r\n};\r\n\r\nL.DomEvent.on = L.DomEvent.addListener;\r\nL.DomEvent.off = L.DomEvent.removeListener;\r\n\r\n\r\n/*\r\n * L.Draggable allows you to add dragging capabilities to any element. Supports mobile devices too.\r\n */\r\n\r\nL.Draggable = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tSTART: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],\r\n\t\tEND: {\r\n\t\t\tmousedown: 'mouseup',\r\n\t\t\ttouchstart: 'touchend',\r\n\t\t\tpointerdown: 'touchend',\r\n\t\t\tMSPointerDown: 'touchend'\r\n\t\t},\r\n\t\tMOVE: {\r\n\t\t\tmousedown: 'mousemove',\r\n\t\t\ttouchstart: 'touchmove',\r\n\t\t\tpointerdown: 'touchmove',\r\n\t\t\tMSPointerDown: 'touchmove'\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function (element, dragStartTarget) {\r\n\t\tthis._element = element;\r\n\t\tthis._dragStartTarget = dragStartTarget || element;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = true;\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.off(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = false;\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\t_onDown: function (e) {\r\n\t\tthis._moved = false;\r\n\r\n\t\tif (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }\r\n\r\n\t\tL.DomEvent.stopPropagation(e);\r\n\r\n\t\tif (L.Draggable._disabled) { return; }\r\n\r\n\t\tL.DomUtil.disableImageDrag();\r\n\t\tL.DomUtil.disableTextSelection();\r\n\r\n\t\tif (this._moving) { return; }\r\n\r\n\t\tvar first = e.touches ? e.touches[0] : e;\r\n\r\n\t\tthis._startPoint = new L.Point(first.clientX, first.clientY);\r\n\t\tthis._startPos = this._newPos = L.DomUtil.getPosition(this._element);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, L.Draggable.MOVE[e.type], this._onMove, this)\r\n\t\t    .on(document, L.Draggable.END[e.type], this._onUp, this);\r\n\t},\r\n\r\n\t_onMove: function (e) {\r\n\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\tthis._moved = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),\r\n\t\t    newPoint = new L.Point(first.clientX, first.clientY),\r\n\t\t    offset = newPoint.subtract(this._startPoint);\r\n\r\n\t\tif (!offset.x && !offset.y) { return; }\r\n\t\tif (L.Browser.touch && Math.abs(offset.x) + Math.abs(offset.y) < 3) { return; }\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\tif (!this._moved) {\r\n\t\t\tthis.fire('dragstart');\r\n\r\n\t\t\tthis._moved = true;\r\n\t\t\tthis._startPos = L.DomUtil.getPosition(this._element).subtract(offset);\r\n\r\n\t\t\tL.DomUtil.addClass(document.body, 'leaflet-dragging');\r\n\t\t\tthis._lastTarget = e.target || e.srcElement;\r\n\t\t\tL.DomUtil.addClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t}\r\n\r\n\t\tthis._newPos = this._startPos.add(offset);\r\n\t\tthis._moving = true;\r\n\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\tthis._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tthis.fire('predrag');\r\n\t\tL.DomUtil.setPosition(this._element, this._newPos);\r\n\t\tthis.fire('drag');\r\n\t},\r\n\r\n\t_onUp: function () {\r\n\t\tL.DomUtil.removeClass(document.body, 'leaflet-dragging');\r\n\r\n\t\tif (this._lastTarget) {\r\n\t\t\tL.DomUtil.removeClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t\tthis._lastTarget = null;\r\n\t\t}\r\n\r\n\t\tfor (var i in L.Draggable.MOVE) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(document, L.Draggable.MOVE[i], this._onMove)\r\n\t\t\t    .off(document, L.Draggable.END[i], this._onUp);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.enableImageDrag();\r\n\t\tL.DomUtil.enableTextSelection();\r\n\r\n\t\tif (this._moved && this._moving) {\r\n\t\t\t// ensure drag is not fired after dragend\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\t\tthis.fire('dragend', {\r\n\t\t\t\tdistance: this._newPos.distanceTo(this._startPos)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._moving = false;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n\tL.Handler is a base class for handler classes that are used internally to inject\r\n\tinteraction features like dragging to classes like Map and Marker.\r\n*/\r\n\r\nL.Handler = L.Class.extend({\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tthis._enabled = true;\r\n\t\tthis.addHooks();\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tthis._enabled = false;\r\n\t\tthis.removeHooks();\r\n\t},\r\n\r\n\tenabled: function () {\r\n\t\treturn !!this._enabled;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tdragging: true,\r\n\r\n\tinertia: !L.Browser.android23,\r\n\tinertiaDeceleration: 3400, // px/s^2\r\n\tinertiaMaxSpeed: Infinity, // px/s\r\n\tinertiaThreshold: L.Browser.touch ? 32 : 18, // ms\r\n\teaseLinearity: 0.25,\r\n\r\n\t// TODO refactor, move to CRS\r\n\tworldCopyJump: false\r\n});\r\n\r\nL.Map.Drag = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tif (!this._draggable) {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tthis._draggable = new L.Draggable(map._mapPane, map._container);\r\n\r\n\t\t\tthis._draggable.on({\r\n\t\t\t\t'dragstart': this._onDragStart,\r\n\t\t\t\t'drag': this._onDrag,\r\n\t\t\t\t'dragend': this._onDragEnd\r\n\t\t\t}, this);\r\n\r\n\t\t\tif (map.options.worldCopyJump) {\r\n\t\t\t\tthis._draggable.on('predrag', this._onPreDrag, this);\r\n\t\t\t\tmap.on('viewreset', this._onViewReset, this);\r\n\r\n\t\t\t\tmap.whenReady(this._onViewReset, this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._draggable.enable();\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._draggable.disable();\r\n\t},\r\n\r\n\tmoved: function () {\r\n\t\treturn this._draggable && this._draggable._moved;\r\n\t},\r\n\r\n\t_onDragStart: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map._panAnim) {\r\n\t\t\tmap._panAnim.stop();\r\n\t\t}\r\n\r\n\t\tmap\r\n\t\t    .fire('movestart')\r\n\t\t    .fire('dragstart');\r\n\r\n\t\tif (map.options.inertia) {\r\n\t\t\tthis._positions = [];\r\n\t\t\tthis._times = [];\r\n\t\t}\r\n\t},\r\n\r\n\t_onDrag: function () {\r\n\t\tif (this._map.options.inertia) {\r\n\t\t\tvar time = this._lastTime = +new Date(),\r\n\t\t\t    pos = this._lastPos = this._draggable._newPos;\r\n\r\n\t\t\tthis._positions.push(pos);\r\n\t\t\tthis._times.push(time);\r\n\r\n\t\t\tif (time - this._times[0] > 200) {\r\n\t\t\t\tthis._positions.shift();\r\n\t\t\t\tthis._times.shift();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._map\r\n\t\t    .fire('move')\r\n\t\t    .fire('drag');\r\n\t},\r\n\r\n\t_onViewReset: function () {\r\n\t\t// TODO fix hardcoded Earth values\r\n\t\tvar pxCenter = this._map.getSize()._divideBy(2),\r\n\t\t    pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);\r\n\r\n\t\tthis._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;\r\n\t\tthis._worldWidth = this._map.project([0, 180]).x;\r\n\t},\r\n\r\n\t_onPreDrag: function () {\r\n\t\t// TODO refactor to be able to adjust map pane position after zoom\r\n\t\tvar worldWidth = this._worldWidth,\r\n\t\t    halfWidth = Math.round(worldWidth / 2),\r\n\t\t    dx = this._initialWorldOffset,\r\n\t\t    x = this._draggable._newPos.x,\r\n\t\t    newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,\r\n\t\t    newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,\r\n\t\t    newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;\r\n\r\n\t\tthis._draggable._newPos.x = newX;\r\n\t},\r\n\r\n\t_onDragEnd: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    options = map.options,\r\n\t\t    delay = +new Date() - this._lastTime,\r\n\r\n\t\t    noInertia = !options.inertia || delay > options.inertiaThreshold || !this._positions[0];\r\n\r\n\t\tmap.fire('dragend', e);\r\n\r\n\t\tif (noInertia) {\r\n\t\t\tmap.fire('moveend');\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar direction = this._lastPos.subtract(this._positions[0]),\r\n\t\t\t    duration = (this._lastTime + delay - this._times[0]) / 1000,\r\n\t\t\t    ease = options.easeLinearity,\r\n\r\n\t\t\t    speedVector = direction.multiplyBy(ease / duration),\r\n\t\t\t    speed = speedVector.distanceTo([0, 0]),\r\n\r\n\t\t\t    limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),\r\n\t\t\t    limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),\r\n\r\n\t\t\t    decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),\r\n\t\t\t    offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();\r\n\r\n\t\t\tif (!offset.x || !offset.y) {\r\n\t\t\t\tmap.fire('moveend');\r\n\r\n\t\t\t} else {\r\n\t\t\t\toffset = map._limitOffset(offset, map.options.maxBounds);\r\n\r\n\t\t\t\tL.Util.requestAnimFrame(function () {\r\n\t\t\t\t\tmap.panBy(offset, {\r\n\t\t\t\t\t\tduration: decelerationDuration,\r\n\t\t\t\t\t\teaseLinearity: ease,\r\n\t\t\t\t\t\tnoMoveStart: true\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'dragging', L.Map.Drag);\r\n\r\n\r\n/*\r\n * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tdoubleClickZoom: true\r\n});\r\n\r\nL.Map.DoubleClickZoom = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tthis._map.on('dblclick', this._onDoubleClick, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._map.off('dblclick', this._onDoubleClick, this);\r\n\t},\r\n\r\n\t_onDoubleClick: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    zoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);\r\n\r\n\t\tif (map.options.doubleClickZoom === 'center') {\r\n\t\t\tmap.setZoom(zoom);\r\n\t\t} else {\r\n\t\t\tmap.setZoomAround(e.containerPoint, zoom);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);\r\n\r\n\r\n/*\r\n * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tscrollWheelZoom: true\r\n});\r\n\r\nL.Map.ScrollWheelZoom = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._onWheelScroll, this);\r\n\t\tL.DomEvent.on(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\r\n\t\tthis._delta = 0;\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._map._container, 'mousewheel', this._onWheelScroll);\r\n\t\tL.DomEvent.off(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\r\n\t},\r\n\r\n\t_onWheelScroll: function (e) {\r\n\t\tvar delta = L.DomEvent.getWheelDelta(e);\r\n\r\n\t\tthis._delta += delta;\r\n\t\tthis._lastMousePos = this._map.mouseEventToContainerPoint(e);\r\n\r\n\t\tif (!this._startTime) {\r\n\t\t\tthis._startTime = +new Date();\r\n\t\t}\r\n\r\n\t\tvar left = Math.max(40 - (+new Date() - this._startTime), 0);\r\n\r\n\t\tclearTimeout(this._timer);\r\n\t\tthis._timer = setTimeout(L.bind(this._performZoom, this), left);\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\t\tL.DomEvent.stopPropagation(e);\r\n\t},\r\n\r\n\t_performZoom: function () {\r\n\t\tvar map = this._map,\r\n\t\t    delta = this._delta,\r\n\t\t    zoom = map.getZoom();\r\n\r\n\t\tdelta = delta > 0 ? Math.ceil(delta) : Math.floor(delta);\r\n\t\tdelta = Math.max(Math.min(delta, 4), -4);\r\n\t\tdelta = map._limitZoom(zoom + delta) - zoom;\r\n\r\n\t\tthis._delta = 0;\r\n\t\tthis._startTime = null;\r\n\r\n\t\tif (!delta) { return; }\r\n\r\n\t\tif (map.options.scrollWheelZoom === 'center') {\r\n\t\t\tmap.setZoom(zoom + delta);\r\n\t\t} else {\r\n\t\t\tmap.setZoomAround(this._lastMousePos, zoom + delta);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);\r\n\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nL.extend(L.DomEvent, {\r\n\r\n\t_touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\r\n\t_touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',\r\n\r\n\t// inspired by Zepto touch code by Thomas Fuchs\r\n\taddDoubleTapListener: function (obj, handler, id) {\r\n\t\tvar last,\r\n\t\t    doubleTap = false,\r\n\t\t    delay = 250,\r\n\t\t    touch,\r\n\t\t    pre = '_leaflet_',\r\n\t\t    touchstart = this._touchstart,\r\n\t\t    touchend = this._touchend,\r\n\t\t    trackedTouches = [];\r\n\r\n\t\tfunction onTouchStart(e) {\r\n\t\t\tvar count;\r\n\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\ttrackedTouches.push(e.pointerId);\r\n\t\t\t\tcount = trackedTouches.length;\r\n\t\t\t} else {\r\n\t\t\t\tcount = e.touches.length;\r\n\t\t\t}\r\n\t\t\tif (count > 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar now = Date.now(),\r\n\t\t\t\tdelta = now - (last || now);\r\n\r\n\t\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\t\tlast = now;\r\n\t\t}\r\n\r\n\t\tfunction onTouchEnd(e) {\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\tvar idx = trackedTouches.indexOf(e.pointerId);\r\n\t\t\t\tif (idx === -1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ttrackedTouches.splice(idx, 1);\r\n\t\t\t}\r\n\r\n\t\t\tif (doubleTap) {\r\n\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\t\tvar newTouch = { },\r\n\t\t\t\t\t\tprop;\r\n\r\n\t\t\t\t\t// jshint forin:false\r\n\t\t\t\t\tfor (var i in touch) {\r\n\t\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\t\tif (typeof prop === 'function') {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop.bind(touch);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttouch = newTouch;\r\n\t\t\t\t}\r\n\t\t\t\ttouch.type = 'dblclick';\r\n\t\t\t\thandler(touch);\r\n\t\t\t\tlast = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tobj[pre + touchstart + id] = onTouchStart;\r\n\t\tobj[pre + touchend + id] = onTouchEnd;\r\n\r\n\t\t// on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen\r\n\t\t// will not come through to us, so we will lose track of how many touches are ongoing\r\n\t\tvar endElement = L.Browser.pointer ? document.documentElement : obj;\r\n\r\n\t\tobj.addEventListener(touchstart, onTouchStart, false);\r\n\t\tendElement.addEventListener(touchend, onTouchEnd, false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tendElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveDoubleTapListener: function (obj, id) {\r\n\t\tvar pre = '_leaflet_';\r\n\r\n\t\tobj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);\r\n\t\t(L.Browser.pointer ? document.documentElement : obj).removeEventListener(\r\n\t\t        this._touchend, obj[pre + this._touchend + id], false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tdocument.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],\r\n\t\t\t\tfalse);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\r\n */\r\n\r\nL.extend(L.DomEvent, {\r\n\r\n\t//static\r\n\tPOINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',\r\n\tPOINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',\r\n\tPOINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',\r\n\tPOINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\r\n\r\n\t_pointers: [],\r\n\t_pointerDocumentListener: false,\r\n\r\n\t// Provides a touch events wrapper for (ms)pointer events.\r\n\t// Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019\r\n\t//ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\r\n\r\n\taddPointerListener: function (obj, type, handler, id) {\r\n\r\n\t\tswitch (type) {\r\n\t\tcase 'touchstart':\r\n\t\t\treturn this.addPointerListenerStart(obj, type, handler, id);\r\n\t\tcase 'touchend':\r\n\t\t\treturn this.addPointerListenerEnd(obj, type, handler, id);\r\n\t\tcase 'touchmove':\r\n\t\t\treturn this.addPointerListenerMove(obj, type, handler, id);\r\n\t\tdefault:\r\n\t\t\tthrow 'Unknown touch event type';\r\n\t\t}\r\n\t},\r\n\r\n\taddPointerListenerStart: function (obj, type, handler, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    pointers = this._pointers;\r\n\r\n\t\tvar cb = function (e) {\r\n\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\t\tvar alreadyInArray = false;\r\n\t\t\tfor (var i = 0; i < pointers.length; i++) {\r\n\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\r\n\t\t\t\t\talreadyInArray = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!alreadyInArray) {\r\n\t\t\t\tpointers.push(e);\r\n\t\t\t}\r\n\r\n\t\t\te.touches = pointers.slice();\r\n\t\t\te.changedTouches = [e];\r\n\r\n\t\t\thandler(e);\r\n\t\t};\r\n\r\n\t\tobj[pre + 'touchstart' + id] = cb;\r\n\t\tobj.addEventListener(this.POINTER_DOWN, cb, false);\r\n\r\n\t\t// need to also listen for end events to keep the _pointers list accurate\r\n\t\t// this needs to be on the body and never go away\r\n\t\tif (!this._pointerDocumentListener) {\r\n\t\t\tvar internalCb = function (e) {\r\n\t\t\t\tfor (var i = 0; i < pointers.length; i++) {\r\n\t\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\r\n\t\t\t\t\t\tpointers.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t//We listen on the documentElement as any drags that end by moving the touch off the screen get fired there\r\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_UP, internalCb, false);\r\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);\r\n\r\n\t\t\tthis._pointerDocumentListener = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddPointerListenerMove: function (obj, type, handler, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    touches = this._pointers;\r\n\r\n\t\tfunction cb(e) {\r\n\r\n\t\t\t// don't fire touch moves when mouse isn't down\r\n\t\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\r\n\r\n\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\r\n\t\t\t\t\ttouches[i] = e;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.touches = touches.slice();\r\n\t\t\te.changedTouches = [e];\r\n\r\n\t\t\thandler(e);\r\n\t\t}\r\n\r\n\t\tobj[pre + 'touchmove' + id] = cb;\r\n\t\tobj.addEventListener(this.POINTER_MOVE, cb, false);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddPointerListenerEnd: function (obj, type, handler, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    touches = this._pointers;\r\n\r\n\t\tvar cb = function (e) {\r\n\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\r\n\t\t\t\t\ttouches.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.touches = touches.slice();\r\n\t\t\te.changedTouches = [e];\r\n\r\n\t\t\thandler(e);\r\n\t\t};\r\n\r\n\t\tobj[pre + 'touchend' + id] = cb;\r\n\t\tobj.addEventListener(this.POINTER_UP, cb, false);\r\n\t\tobj.addEventListener(this.POINTER_CANCEL, cb, false);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremovePointerListener: function (obj, type, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    cb = obj[pre + type + id];\r\n\r\n\t\tswitch (type) {\r\n\t\tcase 'touchstart':\r\n\t\t\tobj.removeEventListener(this.POINTER_DOWN, cb, false);\r\n\t\t\tbreak;\r\n\t\tcase 'touchmove':\r\n\t\t\tobj.removeEventListener(this.POINTER_MOVE, cb, false);\r\n\t\t\tbreak;\r\n\t\tcase 'touchend':\r\n\t\t\tobj.removeEventListener(this.POINTER_UP, cb, false);\r\n\t\t\tobj.removeEventListener(this.POINTER_CANCEL, cb, false);\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\ttouchZoom: L.Browser.touch && !L.Browser.android23,\r\n\tbounceAtZoomLimits: true\r\n});\r\n\r\nL.Map.TouchZoom = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onTouchStart, this);\r\n\t},\r\n\r\n\t_onTouchStart: function (e) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }\r\n\r\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\r\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]),\r\n\t\t    viewCenter = map._getCenterLayerPoint();\r\n\r\n\t\tthis._startCenter = p1.add(p2)._divideBy(2);\r\n\t\tthis._startDist = p1.distanceTo(p2);\r\n\r\n\t\tthis._moved = false;\r\n\t\tthis._zooming = true;\r\n\r\n\t\tthis._centerOffset = viewCenter.subtract(this._startCenter);\r\n\r\n\t\tif (map._panAnim) {\r\n\t\t\tmap._panAnim.stop();\r\n\t\t}\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, 'touchmove', this._onTouchMove, this)\r\n\t\t    .on(document, 'touchend', this._onTouchEnd, this);\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\t},\r\n\r\n\t_onTouchMove: function (e) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }\r\n\r\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\r\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]);\r\n\r\n\t\tthis._scale = p1.distanceTo(p2) / this._startDist;\r\n\t\tthis._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);\r\n\r\n\t\tif (this._scale === 1) { return; }\r\n\r\n\t\tif (!map.options.bounceAtZoomLimits) {\r\n\t\t\tif ((map.getZoom() === map.getMinZoom() && this._scale < 1) ||\r\n\t\t\t    (map.getZoom() === map.getMaxZoom() && this._scale > 1)) { return; }\r\n\t\t}\r\n\r\n\t\tif (!this._moved) {\r\n\t\t\tL.DomUtil.addClass(map._mapPane, 'leaflet-touching');\r\n\r\n\t\t\tmap\r\n\t\t\t    .fire('movestart')\r\n\t\t\t    .fire('zoomstart');\r\n\r\n\t\t\tthis._moved = true;\r\n\t\t}\r\n\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\tthis._animRequest = L.Util.requestAnimFrame(\r\n\t\t        this._updateOnMove, this, true, this._map._container);\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\t},\r\n\r\n\t_updateOnMove: function () {\r\n\t\tvar map = this._map,\r\n\t\t    origin = this._getScaleOrigin(),\r\n\t\t    center = map.layerPointToLatLng(origin),\r\n\t\t    zoom = map.getScaleZoom(this._scale);\r\n\r\n\t\tmap._animateZoom(center, zoom, this._startCenter, this._scale, this._delta, false, true);\r\n\t},\r\n\r\n\t_onTouchEnd: function () {\r\n\t\tif (!this._moved || !this._zooming) {\r\n\t\t\tthis._zooming = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar map = this._map;\r\n\r\n\t\tthis._zooming = false;\r\n\t\tL.DomUtil.removeClass(map._mapPane, 'leaflet-touching');\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .off(document, 'touchmove', this._onTouchMove)\r\n\t\t    .off(document, 'touchend', this._onTouchEnd);\r\n\r\n\t\tvar origin = this._getScaleOrigin(),\r\n\t\t    center = map.layerPointToLatLng(origin),\r\n\r\n\t\t    oldZoom = map.getZoom(),\r\n\t\t    floatZoomDelta = map.getScaleZoom(this._scale) - oldZoom,\r\n\t\t    roundZoomDelta = (floatZoomDelta > 0 ?\r\n\t\t            Math.ceil(floatZoomDelta) : Math.floor(floatZoomDelta)),\r\n\r\n\t\t    zoom = map._limitZoom(oldZoom + roundZoomDelta),\r\n\t\t    scale = map.getZoomScale(zoom) / this._scale;\r\n\r\n\t\tmap._animateZoom(center, zoom, origin, scale);\r\n\t},\r\n\r\n\t_getScaleOrigin: function () {\r\n\t\tvar centerOffset = this._centerOffset.subtract(this._delta).divideBy(this._scale);\r\n\t\treturn this._startCenter.add(centerOffset);\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'touchZoom', L.Map.TouchZoom);\r\n\r\n\r\n/*\r\n * L.Map.Tap is used to enable mobile hacks like quick taps and long hold.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\ttap: true,\r\n\ttapTolerance: 15\r\n});\r\n\r\nL.Map.Tap = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onDown, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onDown, this);\r\n\t},\r\n\r\n\t_onDown: function (e) {\r\n\t\tif (!e.touches) { return; }\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\tthis._fireClick = true;\r\n\r\n\t\t// don't simulate click or track longpress if more than 1 touch\r\n\t\tif (e.touches.length > 1) {\r\n\t\t\tthis._fireClick = false;\r\n\t\t\tclearTimeout(this._holdTimeout);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar first = e.touches[0],\r\n\t\t    el = first.target;\r\n\r\n\t\tthis._startPos = this._newPos = new L.Point(first.clientX, first.clientY);\r\n\r\n\t\t// if touching a link, highlight it\r\n\t\tif (el.tagName && el.tagName.toLowerCase() === 'a') {\r\n\t\t\tL.DomUtil.addClass(el, 'leaflet-active');\r\n\t\t}\r\n\r\n\t\t// simulate long hold but setting a timeout\r\n\t\tthis._holdTimeout = setTimeout(L.bind(function () {\r\n\t\t\tif (this._isTapValid()) {\r\n\t\t\t\tthis._fireClick = false;\r\n\t\t\t\tthis._onUp();\r\n\t\t\t\tthis._simulateEvent('contextmenu', first);\r\n\t\t\t}\r\n\t\t}, this), 1000);\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.on(document, 'touchmove', this._onMove, this)\r\n\t\t\t.on(document, 'touchend', this._onUp, this);\r\n\t},\r\n\r\n\t_onUp: function (e) {\r\n\t\tclearTimeout(this._holdTimeout);\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.off(document, 'touchmove', this._onMove, this)\r\n\t\t\t.off(document, 'touchend', this._onUp, this);\r\n\r\n\t\tif (this._fireClick && e && e.changedTouches) {\r\n\r\n\t\t\tvar first = e.changedTouches[0],\r\n\t\t\t    el = first.target;\r\n\r\n\t\t\tif (el && el.tagName && el.tagName.toLowerCase() === 'a') {\r\n\t\t\t\tL.DomUtil.removeClass(el, 'leaflet-active');\r\n\t\t\t}\r\n\r\n\t\t\t// simulate click if the touch didn't move too much\r\n\t\t\tif (this._isTapValid()) {\r\n\t\t\t\tthis._simulateEvent('click', first);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_isTapValid: function () {\r\n\t\treturn this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;\r\n\t},\r\n\r\n\t_onMove: function (e) {\r\n\t\tvar first = e.touches[0];\r\n\t\tthis._newPos = new L.Point(first.clientX, first.clientY);\r\n\t},\r\n\r\n\t_simulateEvent: function (type, e) {\r\n\t\tvar simulatedEvent = document.createEvent('MouseEvents');\r\n\r\n\t\tsimulatedEvent._simulated = true;\r\n\t\te.target._simulatedClick = true;\r\n\r\n\t\tsimulatedEvent.initMouseEvent(\r\n\t\t        type, true, true, window, 1,\r\n\t\t        e.screenX, e.screenY,\r\n\t\t        e.clientX, e.clientY,\r\n\t\t        false, false, false, false, 0, null);\r\n\r\n\t\te.target.dispatchEvent(simulatedEvent);\r\n\t}\r\n});\r\n\r\nif (L.Browser.touch && !L.Browser.pointer) {\r\n\tL.Map.addInitHook('addHandler', 'tap', L.Map.Tap);\r\n}\r\n\r\n\r\n/*\r\n * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map\r\n  * (zoom to a selected bounding box), enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tboxZoom: true\r\n});\r\n\r\nL.Map.BoxZoom = L.Handler.extend({\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._container = map._container;\r\n\t\tthis._pane = map._panes.overlayPane;\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._container, 'mousedown', this._onMouseDown);\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\tmoved: function () {\r\n\t\treturn this._moved;\r\n\t},\r\n\r\n\t_onMouseDown: function (e) {\r\n\t\tthis._moved = false;\r\n\r\n\t\tif (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }\r\n\r\n\t\tL.DomUtil.disableTextSelection();\r\n\t\tL.DomUtil.disableImageDrag();\r\n\r\n\t\tthis._startLayerPoint = this._map.mouseEventToLayerPoint(e);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, 'mousemove', this._onMouseMove, this)\r\n\t\t    .on(document, 'mouseup', this._onMouseUp, this)\r\n\t\t    .on(document, 'keydown', this._onKeyDown, this);\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tif (!this._moved) {\r\n\t\t\tthis._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);\r\n\t\t\tL.DomUtil.setPosition(this._box, this._startLayerPoint);\r\n\r\n\t\t\t//TODO refactor: move cursor to styles\r\n\t\t\tthis._container.style.cursor = 'crosshair';\r\n\t\t\tthis._map.fire('boxzoomstart');\r\n\t\t}\r\n\r\n\t\tvar startPoint = this._startLayerPoint,\r\n\t\t    box = this._box,\r\n\r\n\t\t    layerPoint = this._map.mouseEventToLayerPoint(e),\r\n\t\t    offset = layerPoint.subtract(startPoint),\r\n\r\n\t\t    newPos = new L.Point(\r\n\t\t        Math.min(layerPoint.x, startPoint.x),\r\n\t\t        Math.min(layerPoint.y, startPoint.y));\r\n\r\n\t\tL.DomUtil.setPosition(box, newPos);\r\n\r\n\t\tthis._moved = true;\r\n\r\n\t\t// TODO refactor: remove hardcoded 4 pixels\r\n\t\tbox.style.width  = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';\r\n\t\tbox.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';\r\n\t},\r\n\r\n\t_finish: function () {\r\n\t\tif (this._moved) {\r\n\t\t\tthis._pane.removeChild(this._box);\r\n\t\t\tthis._container.style.cursor = '';\r\n\t\t}\r\n\r\n\t\tL.DomUtil.enableTextSelection();\r\n\t\tL.DomUtil.enableImageDrag();\r\n\r\n\t\tL.DomEvent\r\n\t\t    .off(document, 'mousemove', this._onMouseMove)\r\n\t\t    .off(document, 'mouseup', this._onMouseUp)\r\n\t\t    .off(document, 'keydown', this._onKeyDown);\r\n\t},\r\n\r\n\t_onMouseUp: function (e) {\r\n\r\n\t\tthis._finish();\r\n\r\n\t\tvar map = this._map,\r\n\t\t    layerPoint = map.mouseEventToLayerPoint(e);\r\n\r\n\t\tif (this._startLayerPoint.equals(layerPoint)) { return; }\r\n\r\n\t\tvar bounds = new L.LatLngBounds(\r\n\t\t        map.layerPointToLatLng(this._startLayerPoint),\r\n\t\t        map.layerPointToLatLng(layerPoint));\r\n\r\n\t\tmap.fitBounds(bounds);\r\n\r\n\t\tmap.fire('boxzoomend', {\r\n\t\t\tboxZoomBounds: bounds\r\n\t\t});\r\n\t},\r\n\r\n\t_onKeyDown: function (e) {\r\n\t\tif (e.keyCode === 27) {\r\n\t\t\tthis._finish();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'boxZoom', L.Map.BoxZoom);\r\n\r\n\r\n/*\r\n * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tkeyboard: true,\r\n\tkeyboardPanOffset: 80,\r\n\tkeyboardZoomOffset: 1\r\n});\r\n\r\nL.Map.Keyboard = L.Handler.extend({\r\n\r\n\tkeyCodes: {\r\n\t\tleft:    [37],\r\n\t\tright:   [39],\r\n\t\tdown:    [40],\r\n\t\tup:      [38],\r\n\t\tzoomIn:  [187, 107, 61, 171],\r\n\t\tzoomOut: [189, 109, 173]\r\n\t},\r\n\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._setPanOffset(map.options.keyboardPanOffset);\r\n\t\tthis._setZoomOffset(map.options.keyboardZoomOffset);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar container = this._map._container;\r\n\r\n\t\t// make the container focusable by tabbing\r\n\t\tif (container.tabIndex === -1) {\r\n\t\t\tcontainer.tabIndex = '0';\r\n\t\t}\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(container, 'focus', this._onFocus, this)\r\n\t\t    .on(container, 'blur', this._onBlur, this)\r\n\t\t    .on(container, 'mousedown', this._onMouseDown, this);\r\n\r\n\t\tthis._map\r\n\t\t    .on('focus', this._addHooks, this)\r\n\t\t    .on('blur', this._removeHooks, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._removeHooks();\r\n\r\n\t\tvar container = this._map._container;\r\n\r\n\t\tL.DomEvent\r\n\t\t    .off(container, 'focus', this._onFocus, this)\r\n\t\t    .off(container, 'blur', this._onBlur, this)\r\n\t\t    .off(container, 'mousedown', this._onMouseDown, this);\r\n\r\n\t\tthis._map\r\n\t\t    .off('focus', this._addHooks, this)\r\n\t\t    .off('blur', this._removeHooks, this);\r\n\t},\r\n\r\n\t_onMouseDown: function () {\r\n\t\tif (this._focused) { return; }\r\n\r\n\t\tvar body = document.body,\r\n\t\t    docEl = document.documentElement,\r\n\t\t    top = body.scrollTop || docEl.scrollTop,\r\n\t\t    left = body.scrollLeft || docEl.scrollLeft;\r\n\r\n\t\tthis._map._container.focus();\r\n\r\n\t\twindow.scrollTo(left, top);\r\n\t},\r\n\r\n\t_onFocus: function () {\r\n\t\tthis._focused = true;\r\n\t\tthis._map.fire('focus');\r\n\t},\r\n\r\n\t_onBlur: function () {\r\n\t\tthis._focused = false;\r\n\t\tthis._map.fire('blur');\r\n\t},\r\n\r\n\t_setPanOffset: function (pan) {\r\n\t\tvar keys = this._panKeys = {},\r\n\t\t    codes = this.keyCodes,\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = codes.left.length; i < len; i++) {\r\n\t\t\tkeys[codes.left[i]] = [-1 * pan, 0];\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.right.length; i < len; i++) {\r\n\t\t\tkeys[codes.right[i]] = [pan, 0];\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.down.length; i < len; i++) {\r\n\t\t\tkeys[codes.down[i]] = [0, pan];\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.up.length; i < len; i++) {\r\n\t\t\tkeys[codes.up[i]] = [0, -1 * pan];\r\n\t\t}\r\n\t},\r\n\r\n\t_setZoomOffset: function (zoom) {\r\n\t\tvar keys = this._zoomKeys = {},\r\n\t\t    codes = this.keyCodes,\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = codes.zoomIn.length; i < len; i++) {\r\n\t\t\tkeys[codes.zoomIn[i]] = zoom;\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.zoomOut.length; i < len; i++) {\r\n\t\t\tkeys[codes.zoomOut[i]] = -zoom;\r\n\t\t}\r\n\t},\r\n\r\n\t_addHooks: function () {\r\n\t\tL.DomEvent.on(document, 'keydown', this._onKeyDown, this);\r\n\t},\r\n\r\n\t_removeHooks: function () {\r\n\t\tL.DomEvent.off(document, 'keydown', this._onKeyDown, this);\r\n\t},\r\n\r\n\t_onKeyDown: function (e) {\r\n\t\tvar key = e.keyCode,\r\n\t\t    map = this._map;\r\n\r\n\t\tif (key in this._panKeys) {\r\n\r\n\t\t\tif (map._panAnim && map._panAnim._inProgress) { return; }\r\n\r\n\t\t\tmap.panBy(this._panKeys[key]);\r\n\r\n\t\t\tif (map.options.maxBounds) {\r\n\t\t\t\tmap.panInsideBounds(map.options.maxBounds);\r\n\t\t\t}\r\n\r\n\t\t} else if (key in this._zoomKeys) {\r\n\t\t\tmap.setZoom(map.getZoom() + this._zoomKeys[key]);\r\n\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tL.DomEvent.stop(e);\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'keyboard', L.Map.Keyboard);\r\n\r\n\r\n/*\r\n * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.\r\n */\r\n\r\nL.Handler.MarkerDrag = L.Handler.extend({\r\n\tinitialize: function (marker) {\r\n\t\tthis._marker = marker;\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar icon = this._marker._icon;\r\n\t\tif (!this._draggable) {\r\n\t\t\tthis._draggable = new L.Draggable(icon, icon);\r\n\t\t}\r\n\r\n\t\tthis._draggable\r\n\t\t\t.on('dragstart', this._onDragStart, this)\r\n\t\t\t.on('drag', this._onDrag, this)\r\n\t\t\t.on('dragend', this._onDragEnd, this);\r\n\t\tthis._draggable.enable();\r\n\t\tL.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._draggable\r\n\t\t\t.off('dragstart', this._onDragStart, this)\r\n\t\t\t.off('drag', this._onDrag, this)\r\n\t\t\t.off('dragend', this._onDragEnd, this);\r\n\r\n\t\tthis._draggable.disable();\r\n\t\tL.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t},\r\n\r\n\tmoved: function () {\r\n\t\treturn this._draggable && this._draggable._moved;\r\n\t},\r\n\r\n\t_onDragStart: function () {\r\n\t\tthis._marker\r\n\t\t    .closePopup()\r\n\t\t    .fire('movestart')\r\n\t\t    .fire('dragstart');\r\n\t},\r\n\r\n\t_onDrag: function () {\r\n\t\tvar marker = this._marker,\r\n\t\t    shadow = marker._shadow,\r\n\t\t    iconPos = L.DomUtil.getPosition(marker._icon),\r\n\t\t    latlng = marker._map.layerPointToLatLng(iconPos);\r\n\r\n\t\t// update shadow position\r\n\t\tif (shadow) {\r\n\t\t\tL.DomUtil.setPosition(shadow, iconPos);\r\n\t\t}\r\n\r\n\t\tmarker._latlng = latlng;\r\n\r\n\t\tmarker\r\n\t\t    .fire('move', {latlng: latlng})\r\n\t\t    .fire('drag');\r\n\t},\r\n\r\n\t_onDragEnd: function (e) {\r\n\t\tthis._marker\r\n\t\t    .fire('moveend')\r\n\t\t    .fire('dragend', e);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Control is a base class for implementing map controls. Handles positioning.\r\n * All other controls extend from this class.\r\n */\r\n\r\nL.Control = L.Class.extend({\r\n\toptions: {\r\n\t\tposition: 'topright'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tgetPosition: function () {\r\n\t\treturn this.options.position;\r\n\t},\r\n\r\n\tsetPosition: function (position) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.removeControl(this);\r\n\t\t}\r\n\r\n\t\tthis.options.position = position;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.addControl(this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar container = this._container = this.onAdd(map),\r\n\t\t    pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\r\n\t\tif (pos.indexOf('bottom') !== -1) {\r\n\t\t\tcorner.insertBefore(container, corner.firstChild);\r\n\t\t} else {\r\n\t\t\tcorner.appendChild(container);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveFrom: function (map) {\r\n\t\tvar pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tcorner.removeChild(this._container);\r\n\t\tthis._map = null;\r\n\r\n\t\tif (this.onRemove) {\r\n\t\t\tthis.onRemove(map);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_refocusOnMap: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.getContainer().focus();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.control = function (options) {\r\n\treturn new L.Control(options);\r\n};\r\n\r\n\r\n// adds control-related methods to L.Map\r\n\r\nL.Map.include({\r\n\taddControl: function (control) {\r\n\t\tcontrol.addTo(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveControl: function (control) {\r\n\t\tcontrol.removeFrom(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initControlPos: function () {\r\n\t\tvar corners = this._controlCorners = {},\r\n\t\t    l = 'leaflet-',\r\n\t\t    container = this._controlContainer =\r\n\t\t            L.DomUtil.create('div', l + 'control-container', this._container);\r\n\r\n\t\tfunction createCorner(vSide, hSide) {\r\n\t\t\tvar className = l + vSide + ' ' + l + hSide;\r\n\r\n\t\t\tcorners[vSide + hSide] = L.DomUtil.create('div', className, container);\r\n\t\t}\r\n\r\n\t\tcreateCorner('top', 'left');\r\n\t\tcreateCorner('top', 'right');\r\n\t\tcreateCorner('bottom', 'left');\r\n\t\tcreateCorner('bottom', 'right');\r\n\t},\r\n\r\n\t_clearControlPos: function () {\r\n\t\tthis._container.removeChild(this._controlContainer);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Control.Zoom is used for the default zoom buttons on the map.\r\n */\r\n\r\nL.Control.Zoom = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'topleft',\r\n\t\tzoomInText: '+',\r\n\t\tzoomInTitle: 'Zoom in',\r\n\t\tzoomOutText: '-',\r\n\t\tzoomOutTitle: 'Zoom out'\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tvar zoomName = 'leaflet-control-zoom',\r\n\t\t    container = L.DomUtil.create('div', zoomName + ' leaflet-bar');\r\n\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._zoomInButton  = this._createButton(\r\n\t\t        this.options.zoomInText, this.options.zoomInTitle,\r\n\t\t        zoomName + '-in',  container, this._zoomIn,  this);\r\n\t\tthis._zoomOutButton = this._createButton(\r\n\t\t        this.options.zoomOutText, this.options.zoomOutTitle,\r\n\t\t        zoomName + '-out', container, this._zoomOut, this);\r\n\r\n\t\tthis._updateDisabled();\r\n\t\tmap.on('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.off('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\t},\r\n\r\n\t_zoomIn: function (e) {\r\n\t\tthis._map.zoomIn(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_zoomOut: function (e) {\r\n\t\tthis._map.zoomOut(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_createButton: function (html, title, className, container, fn, context) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.innerHTML = html;\r\n\t\tlink.href = '#';\r\n\t\tlink.title = title;\r\n\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(link, 'click', stop)\r\n\t\t    .on(link, 'mousedown', stop)\r\n\t\t    .on(link, 'dblclick', stop)\r\n\t\t    .on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t    .on(link, 'click', fn, context)\r\n\t\t    .on(link, 'click', this._refocusOnMap, context);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_updateDisabled: function () {\r\n\t\tvar map = this._map,\r\n\t\t\tclassName = 'leaflet-disabled';\r\n\r\n\t\tL.DomUtil.removeClass(this._zoomInButton, className);\r\n\t\tL.DomUtil.removeClass(this._zoomOutButton, className);\r\n\r\n\t\tif (map._zoom === map.getMinZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomOutButton, className);\r\n\t\t}\r\n\t\tif (map._zoom === map.getMaxZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomInButton, className);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tzoomControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.zoomControl) {\r\n\t\tthis.zoomControl = new L.Control.Zoom();\r\n\t\tthis.addControl(this.zoomControl);\r\n\t}\r\n});\r\n\r\nL.control.zoom = function (options) {\r\n\treturn new L.Control.Zoom(options);\r\n};\r\n\r\n\r\n\r\n/*\r\n * L.Control.Attribution is used for displaying attribution on the map (added by default).\r\n */\r\n\r\nL.Control.Attribution = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomright',\r\n\t\tprefix: '<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._attributions = {};\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-attribution');\r\n\t\tL.DomEvent.disableClickPropagation(this._container);\r\n\r\n\t\tfor (var i in map._layers) {\r\n\t\t\tif (map._layers[i].getAttribution) {\r\n\t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerAdd, this)\r\n\t\t    .on('layerremove', this._onLayerRemove, this);\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerAdd)\r\n\t\t    .off('layerremove', this._onLayerRemove);\r\n\r\n\t},\r\n\r\n\tsetPrefix: function (prefix) {\r\n\t\tthis.options.prefix = prefix;\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (!this._attributions[text]) {\r\n\t\t\tthis._attributions[text] = 0;\r\n\t\t}\r\n\t\tthis._attributions[text]++;\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (this._attributions[text]) {\r\n\t\t\tthis._attributions[text]--;\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar attribs = [];\r\n\r\n\t\tfor (var i in this._attributions) {\r\n\t\t\tif (this._attributions[i]) {\r\n\t\t\t\tattribs.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar prefixAndAttribs = [];\r\n\r\n\t\tif (this.options.prefix) {\r\n\t\t\tprefixAndAttribs.push(this.options.prefix);\r\n\t\t}\r\n\t\tif (attribs.length) {\r\n\t\t\tprefixAndAttribs.push(attribs.join(', '));\r\n\t\t}\r\n\r\n\t\tthis._container.innerHTML = prefixAndAttribs.join(' | ');\r\n\t},\r\n\r\n\t_onLayerAdd: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.addAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t},\r\n\r\n\t_onLayerRemove: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.removeAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tattributionControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.attributionControl) {\r\n\t\tthis.attributionControl = (new L.Control.Attribution()).addTo(this);\r\n\t}\r\n});\r\n\r\nL.control.attribution = function (options) {\r\n\treturn new L.Control.Attribution(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Control.Scale is used for displaying metric/imperial scale on the map.\r\n */\r\n\r\nL.Control.Scale = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomleft',\r\n\t\tmaxWidth: 100,\r\n\t\tmetric: true,\r\n\t\timperial: true,\r\n\t\tupdateWhenIdle: false\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar className = 'leaflet-control-scale',\r\n\t\t    container = L.DomUtil.create('div', className),\r\n\t\t    options = this.options;\r\n\r\n\t\tthis._addScales(options, className, container);\r\n\r\n\t\tmap.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\r\n\t\tmap.whenReady(this._update, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\r\n\t},\r\n\r\n\t_addScales: function (options, className, container) {\r\n\t\tif (options.metric) {\r\n\t\t\tthis._mScale = L.DomUtil.create('div', className + '-line', container);\r\n\t\t}\r\n\t\tif (options.imperial) {\r\n\t\t\tthis._iScale = L.DomUtil.create('div', className + '-line', container);\r\n\t\t}\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tvar bounds = this._map.getBounds(),\r\n\t\t    centerLat = bounds.getCenter().lat,\r\n\t\t    halfWorldMeters = 6378137 * Math.PI * Math.cos(centerLat * Math.PI / 180),\r\n\t\t    dist = halfWorldMeters * (bounds.getNorthEast().lng - bounds.getSouthWest().lng) / 180,\r\n\r\n\t\t    size = this._map.getSize(),\r\n\t\t    options = this.options,\r\n\t\t    maxMeters = 0;\r\n\r\n\t\tif (size.x > 0) {\r\n\t\t\tmaxMeters = dist * (options.maxWidth / size.x);\r\n\t\t}\r\n\r\n\t\tthis._updateScales(options, maxMeters);\r\n\t},\r\n\r\n\t_updateScales: function (options, maxMeters) {\r\n\t\tif (options.metric && maxMeters) {\r\n\t\t\tthis._updateMetric(maxMeters);\r\n\t\t}\r\n\r\n\t\tif (options.imperial && maxMeters) {\r\n\t\t\tthis._updateImperial(maxMeters);\r\n\t\t}\r\n\t},\r\n\r\n\t_updateMetric: function (maxMeters) {\r\n\t\tvar meters = this._getRoundNum(maxMeters);\r\n\r\n\t\tthis._mScale.style.width = this._getScaleWidth(meters / maxMeters) + 'px';\r\n\t\tthis._mScale.innerHTML = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';\r\n\t},\r\n\r\n\t_updateImperial: function (maxMeters) {\r\n\t\tvar maxFeet = maxMeters * 3.2808399,\r\n\t\t    scale = this._iScale,\r\n\t\t    maxMiles, miles, feet;\r\n\r\n\t\tif (maxFeet > 5280) {\r\n\t\t\tmaxMiles = maxFeet / 5280;\r\n\t\t\tmiles = this._getRoundNum(maxMiles);\r\n\r\n\t\t\tscale.style.width = this._getScaleWidth(miles / maxMiles) + 'px';\r\n\t\t\tscale.innerHTML = miles + ' mi';\r\n\r\n\t\t} else {\r\n\t\t\tfeet = this._getRoundNum(maxFeet);\r\n\r\n\t\t\tscale.style.width = this._getScaleWidth(feet / maxFeet) + 'px';\r\n\t\t\tscale.innerHTML = feet + ' ft';\r\n\t\t}\r\n\t},\r\n\r\n\t_getScaleWidth: function (ratio) {\r\n\t\treturn Math.round(this.options.maxWidth * ratio) - 10;\r\n\t},\r\n\r\n\t_getRoundNum: function (num) {\r\n\t\tvar pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),\r\n\t\t    d = num / pow10;\r\n\r\n\t\td = d >= 10 ? 10 : d >= 5 ? 5 : d >= 3 ? 3 : d >= 2 ? 2 : 1;\r\n\r\n\t\treturn pow10 * d;\r\n\t}\r\n});\r\n\r\nL.control.scale = function (options) {\r\n\treturn new L.Control.Scale(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Control.Layers is a control to allow users to switch between different layers on the map.\r\n */\r\n\r\nL.Control.Layers = L.Control.extend({\r\n\toptions: {\r\n\t\tcollapsed: true,\r\n\t\tposition: 'topright',\r\n\t\tautoZIndex: true\r\n\t},\r\n\r\n\tinitialize: function (baseLayers, overlays, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._lastZIndex = 0;\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tfor (var i in baseLayers) {\r\n\t\t\tthis._addLayer(baseLayers[i], i);\r\n\t\t}\r\n\r\n\t\tfor (i in overlays) {\r\n\t\t\tthis._addLayer(overlays[i], i, true);\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._initLayout();\r\n\t\tthis._update();\r\n\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerChange, this)\r\n\t\t    .on('layerremove', this._onLayerChange, this);\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerChange, this)\r\n\t\t    .off('layerremove', this._onLayerChange, this);\r\n\t},\r\n\r\n\taddBaseLayer: function (layer, name) {\r\n\t\tthis._addLayer(layer, name);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOverlay: function (layer, name) {\r\n\t\tthis._addLayer(layer, name, true);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\t\tdelete this._layers[id];\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar className = 'leaflet-control-layers',\r\n\t\t    container = this._container = L.DomUtil.create('div', className);\r\n\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!L.Browser.touch) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container)\r\n\t\t\t\t.disableScrollPropagation(container);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tvar form = this._form = L.DomUtil.create('form', className + '-list');\r\n\r\n\t\tif (this.options.collapsed) {\r\n\t\t\tif (!L.Browser.android) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t    .on(container, 'mouseout', this._collapse, this);\r\n\t\t\t}\r\n\t\t\tvar link = this._layersLink = L.DomUtil.create('a', className + '-toggle', container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = 'Layers';\r\n\r\n\t\t\tif (L.Browser.touch) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t    .on(link, 'click', this._expand, this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._expand, this);\r\n\t\t\t}\r\n\t\t\t//Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033\r\n\t\t\tL.DomEvent.on(form, 'click', function () {\r\n\t\t\t\tsetTimeout(L.bind(this._onInputClick, this), 0);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t// TODO keyboard accessibility\r\n\t\t} else {\r\n\t\t\tthis._expand();\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList = L.DomUtil.create('div', className + '-base', form);\r\n\t\tthis._separator = L.DomUtil.create('div', className + '-separator', form);\r\n\t\tthis._overlaysList = L.DomUtil.create('div', className + '-overlays', form);\r\n\r\n\t\tcontainer.appendChild(form);\r\n\t},\r\n\r\n\t_addLayer: function (layer, name, overlay) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tthis._layers[id] = {\r\n\t\t\tlayer: layer,\r\n\t\t\tname: name,\r\n\t\t\toverlay: overlay\r\n\t\t};\r\n\r\n\t\tif (this.options.autoZIndex && layer.setZIndex) {\r\n\t\t\tthis._lastZIndex++;\r\n\t\t\tlayer.setZIndex(this._lastZIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._container) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList.innerHTML = '';\r\n\t\tthis._overlaysList.innerHTML = '';\r\n\r\n\t\tvar baseLayersPresent = false,\r\n\t\t    overlaysPresent = false,\r\n\t\t    i, obj;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tobj = this._layers[i];\r\n\t\t\tthis._addItem(obj);\r\n\t\t\toverlaysPresent = overlaysPresent || obj.overlay;\r\n\t\t\tbaseLayersPresent = baseLayersPresent || !obj.overlay;\r\n\t\t}\r\n\r\n\t\tthis._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';\r\n\t},\r\n\r\n\t_onLayerChange: function (e) {\r\n\t\tvar obj = this._layers[L.stamp(e.layer)];\r\n\r\n\t\tif (!obj) { return; }\r\n\r\n\t\tif (!this._handlingClick) {\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tvar type = obj.overlay ?\r\n\t\t\t(e.type === 'layeradd' ? 'overlayadd' : 'overlayremove') :\r\n\t\t\t(e.type === 'layeradd' ? 'baselayerchange' : null);\r\n\r\n\t\tif (type) {\r\n\t\t\tthis._map.fire(type, obj);\r\n\t\t}\r\n\t},\r\n\r\n\t// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see http://bit.ly/PqYLBe)\r\n\t_createRadioElement: function (name, checked) {\r\n\r\n\t\tvar radioHtml = '<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\"' + name + '\"';\r\n\t\tif (checked) {\r\n\t\t\tradioHtml += ' checked=\"checked\"';\r\n\t\t}\r\n\t\tradioHtml += '/>';\r\n\r\n\t\tvar radioFragment = document.createElement('div');\r\n\t\tradioFragment.innerHTML = radioHtml;\r\n\r\n\t\treturn radioFragment.firstChild;\r\n\t},\r\n\r\n\t_addItem: function (obj) {\r\n\t\tvar label = document.createElement('label'),\r\n\t\t    input,\r\n\t\t    checked = this._map.hasLayer(obj.layer);\r\n\r\n\t\tif (obj.overlay) {\r\n\t\t\tinput = document.createElement('input');\r\n\t\t\tinput.type = 'checkbox';\r\n\t\t\tinput.className = 'leaflet-control-layers-selector';\r\n\t\t\tinput.defaultChecked = checked;\r\n\t\t} else {\r\n\t\t\tinput = this._createRadioElement('leaflet-base-layers', checked);\r\n\t\t}\r\n\r\n\t\tinput.layerId = L.stamp(obj.layer);\r\n\r\n\t\tL.DomEvent.on(input, 'click', this._onInputClick, this);\r\n\r\n\t\tvar name = document.createElement('span');\r\n\t\tname.innerHTML = ' ' + obj.name;\r\n\r\n\t\tlabel.appendChild(input);\r\n\t\tlabel.appendChild(name);\r\n\r\n\t\tvar container = obj.overlay ? this._overlaysList : this._baseLayersList;\r\n\t\tcontainer.appendChild(label);\r\n\r\n\t\treturn label;\r\n\t},\r\n\r\n\t_onInputClick: function () {\r\n\t\tvar i, input, obj,\r\n\t\t    inputs = this._form.getElementsByTagName('input'),\r\n\t\t    inputsLen = inputs.length;\r\n\r\n\t\tthis._handlingClick = true;\r\n\r\n\t\tfor (i = 0; i < inputsLen; i++) {\r\n\t\t\tinput = inputs[i];\r\n\t\t\tobj = this._layers[input.layerId];\r\n\r\n\t\t\tif (input.checked && !this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.addLayer(obj.layer);\r\n\r\n\t\t\t} else if (!input.checked && this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.removeLayer(obj.layer);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tthis._refocusOnMap();\r\n\t},\r\n\r\n\t_expand: function () {\r\n\t\tL.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');\r\n\t},\r\n\r\n\t_collapse: function () {\r\n\t\tthis._container.className = this._container.className.replace(' leaflet-control-layers-expanded', '');\r\n\t}\r\n});\r\n\r\nL.control.layers = function (baseLayers, overlays, options) {\r\n\treturn new L.Control.Layers(baseLayers, overlays, options);\r\n};\r\n\r\n\r\n/*\r\n * L.PosAnimation is used by Leaflet internally for pan animations.\r\n */\r\n\r\nL.PosAnimation = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\r\n\t\tthis.stop();\r\n\r\n\t\tthis._el = el;\r\n\t\tthis._inProgress = true;\r\n\t\tthis._newPos = newPos;\r\n\r\n\t\tthis.fire('start');\r\n\r\n\t\tel.style[L.DomUtil.TRANSITION] = 'all ' + (duration || 0.25) +\r\n\t\t        's cubic-bezier(0,0,' + (easeLinearity || 0.5) + ',1)';\r\n\r\n\t\tL.DomEvent.on(el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\r\n\t\tL.DomUtil.setPosition(el, newPos);\r\n\r\n\t\t// toggle reflow, Chrome flickers for some reason if you don't do this\r\n\t\tL.Util.falseFn(el.offsetWidth);\r\n\r\n\t\t// there's no native way to track value updates of transitioned properties, so we imitate this\r\n\t\tthis._stepTimer = setInterval(L.bind(this._onStep, this), 50);\r\n\t},\r\n\r\n\tstop: function () {\r\n\t\tif (!this._inProgress) { return; }\r\n\r\n\t\t// if we just removed the transition property, the element would jump to its final position,\r\n\t\t// so we need to make it stay at the current position\r\n\r\n\t\tL.DomUtil.setPosition(this._el, this._getPos());\r\n\t\tthis._onTransitionEnd();\r\n\t\tL.Util.falseFn(this._el.offsetWidth); // force reflow in case we are about to start a new animation\r\n\t},\r\n\r\n\t_onStep: function () {\r\n\t\tvar stepPos = this._getPos();\r\n\t\tif (!stepPos) {\r\n\t\t\tthis._onTransitionEnd();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// jshint camelcase: false\r\n\t\t// make L.DomUtil.getPosition return intermediate position value during animation\r\n\t\tthis._el._leaflet_pos = stepPos;\r\n\r\n\t\tthis.fire('step');\r\n\t},\r\n\r\n\t// you can't easily get intermediate values of properties animated with CSS3 Transitions,\r\n\t// we need to parse computed style (in case of transform it returns matrix string)\r\n\r\n\t_transformRe: /([-+]?(?:\\d*\\.)?\\d+)\\D*, ([-+]?(?:\\d*\\.)?\\d+)\\D*\\)/,\r\n\r\n\t_getPos: function () {\r\n\t\tvar left, top, matches,\r\n\t\t    el = this._el,\r\n\t\t    style = window.getComputedStyle(el);\r\n\r\n\t\tif (L.Browser.any3d) {\r\n\t\t\tmatches = style[L.DomUtil.TRANSFORM].match(this._transformRe);\r\n\t\t\tif (!matches) { return; }\r\n\t\t\tleft = parseFloat(matches[1]);\r\n\t\t\ttop  = parseFloat(matches[2]);\r\n\t\t} else {\r\n\t\t\tleft = parseFloat(style.left);\r\n\t\t\ttop  = parseFloat(style.top);\r\n\t\t}\r\n\r\n\t\treturn new L.Point(left, top, true);\r\n\t},\r\n\r\n\t_onTransitionEnd: function () {\r\n\t\tL.DomEvent.off(this._el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\r\n\r\n\t\tif (!this._inProgress) { return; }\r\n\t\tthis._inProgress = false;\r\n\r\n\t\tthis._el.style[L.DomUtil.TRANSITION] = '';\r\n\r\n\t\t// jshint camelcase: false\r\n\t\t// make sure L.DomUtil.getPosition returns the final position value after animation\r\n\t\tthis._el._leaflet_pos = this._newPos;\r\n\r\n\t\tclearInterval(this._stepTimer);\r\n\r\n\t\tthis.fire('step').fire('end');\r\n\t}\r\n\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Map to handle panning animations.\r\n */\r\n\r\nL.Map.include({\r\n\r\n\tsetView: function (center, zoom, options) {\r\n\r\n\t\tzoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);\r\n\t\tcenter = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);\r\n\t\toptions = options || {};\r\n\r\n\t\tif (this._panAnim) {\r\n\t\t\tthis._panAnim.stop();\r\n\t\t}\r\n\r\n\t\tif (this._loaded && !options.reset && options !== true) {\r\n\r\n\t\t\tif (options.animate !== undefined) {\r\n\t\t\t\toptions.zoom = L.extend({animate: options.animate}, options.zoom);\r\n\t\t\t\toptions.pan = L.extend({animate: options.animate}, options.pan);\r\n\t\t\t}\r\n\r\n\t\t\t// try animating pan or zoom\r\n\t\t\tvar animated = (this._zoom !== zoom) ?\r\n\t\t\t\tthis._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :\r\n\t\t\t\tthis._tryAnimatedPan(center, options.pan);\r\n\r\n\t\t\tif (animated) {\r\n\t\t\t\t// prevent resize handler call, the view will refresh after animation anyway\r\n\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// animation didn't start, just reset the map view\r\n\t\tthis._resetView(center, zoom);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tpanBy: function (offset, options) {\r\n\t\toffset = L.point(offset).round();\r\n\t\toptions = options || {};\r\n\r\n\t\tif (!offset.x && !offset.y) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!this._panAnim) {\r\n\t\t\tthis._panAnim = new L.PosAnimation();\r\n\r\n\t\t\tthis._panAnim.on({\r\n\t\t\t\t'step': this._onPanTransitionStep,\r\n\t\t\t\t'end': this._onPanTransitionEnd\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\t// don't fire movestart if animating inertia\r\n\t\tif (!options.noMoveStart) {\r\n\t\t\tthis.fire('movestart');\r\n\t\t}\r\n\r\n\t\t// animate pan unless animate: false specified\r\n\t\tif (options.animate !== false) {\r\n\t\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-pan-anim');\r\n\r\n\t\t\tvar newPos = this._getMapPanePos().subtract(offset);\r\n\t\t\tthis._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);\r\n\t\t} else {\r\n\t\t\tthis._rawPanBy(offset);\r\n\t\t\tthis.fire('move').fire('moveend');\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_onPanTransitionStep: function () {\r\n\t\tthis.fire('move');\r\n\t},\r\n\r\n\t_onPanTransitionEnd: function () {\r\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-pan-anim');\r\n\t\tthis.fire('moveend');\r\n\t},\r\n\r\n\t_tryAnimatedPan: function (center, options) {\r\n\t\t// difference between the new and current centers in pixels\r\n\t\tvar offset = this._getCenterOffset(center)._floor();\r\n\r\n\t\t// don't animate too far unless animate: true specified in options\r\n\t\tif ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n\t\tthis.panBy(offset, options);\r\n\r\n\t\treturn true;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.PosAnimation fallback implementation that powers Leaflet pan animations\r\n * in browsers that don't support CSS3 Transitions.\r\n */\r\n\r\nL.PosAnimation = L.DomUtil.TRANSITION ? L.PosAnimation : L.PosAnimation.extend({\r\n\r\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\r\n\t\tthis.stop();\r\n\r\n\t\tthis._el = el;\r\n\t\tthis._inProgress = true;\r\n\t\tthis._duration = duration || 0.25;\r\n\t\tthis._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);\r\n\r\n\t\tthis._startPos = L.DomUtil.getPosition(el);\r\n\t\tthis._offset = newPos.subtract(this._startPos);\r\n\t\tthis._startTime = +new Date();\r\n\r\n\t\tthis.fire('start');\r\n\r\n\t\tthis._animate();\r\n\t},\r\n\r\n\tstop: function () {\r\n\t\tif (!this._inProgress) { return; }\r\n\r\n\t\tthis._step();\r\n\t\tthis._complete();\r\n\t},\r\n\r\n\t_animate: function () {\r\n\t\t// animation loop\r\n\t\tthis._animId = L.Util.requestAnimFrame(this._animate, this);\r\n\t\tthis._step();\r\n\t},\r\n\r\n\t_step: function () {\r\n\t\tvar elapsed = (+new Date()) - this._startTime,\r\n\t\t    duration = this._duration * 1000;\r\n\r\n\t\tif (elapsed < duration) {\r\n\t\t\tthis._runFrame(this._easeOut(elapsed / duration));\r\n\t\t} else {\r\n\t\t\tthis._runFrame(1);\r\n\t\t\tthis._complete();\r\n\t\t}\r\n\t},\r\n\r\n\t_runFrame: function (progress) {\r\n\t\tvar pos = this._startPos.add(this._offset.multiplyBy(progress));\r\n\t\tL.DomUtil.setPosition(this._el, pos);\r\n\r\n\t\tthis.fire('step');\r\n\t},\r\n\r\n\t_complete: function () {\r\n\t\tL.Util.cancelAnimFrame(this._animId);\r\n\r\n\t\tthis._inProgress = false;\r\n\t\tthis.fire('end');\r\n\t},\r\n\r\n\t_easeOut: function (t) {\r\n\t\treturn 1 - Math.pow(1 - t, this._easeOutPower);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Map to handle zoom animations.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tzoomAnimation: true,\r\n\tzoomAnimationThreshold: 4\r\n});\r\n\r\nif (L.DomUtil.TRANSITION) {\r\n\r\n\tL.Map.addInitHook(function () {\r\n\t\t// don't animate on browsers without hardware-accelerated transitions or old Android/Opera\r\n\t\tthis._zoomAnimated = this.options.zoomAnimation && L.DomUtil.TRANSITION &&\r\n\t\t\t\tL.Browser.any3d && !L.Browser.android23 && !L.Browser.mobileOpera;\r\n\r\n\t\t// zoom transitions run with the same duration for all layers, so if one of transitionend events\r\n\t\t// happens after starting zoom animation (propagating to the map pane), we know that it ended globally\r\n\t\tif (this._zoomAnimated) {\r\n\t\t\tL.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nL.Map.include(!L.DomUtil.TRANSITION ? {} : {\r\n\r\n\t_catchTransitionEnd: function (e) {\r\n\t\tif (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {\r\n\t\t\tthis._onZoomTransitionEnd();\r\n\t\t}\r\n\t},\r\n\r\n\t_nothingToAnimate: function () {\r\n\t\treturn !this._container.getElementsByClassName('leaflet-zoom-animated').length;\r\n\t},\r\n\r\n\t_tryAnimatedZoom: function (center, zoom, options) {\r\n\r\n\t\tif (this._animatingZoom) { return true; }\r\n\r\n\t\toptions = options || {};\r\n\r\n\t\t// don't animate if disabled, not supported or zoom difference is too large\r\n\t\tif (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||\r\n\t\t        Math.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }\r\n\r\n\t\t// offset is the pixel coords of the zoom origin relative to the current center\r\n\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t    offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale),\r\n\t\t\torigin = this._getCenterLayerPoint()._add(offset);\r\n\r\n\t\t// don't animate if the zoom origin isn't within one screen from the current center, unless forced\r\n\t\tif (options.animate !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n\t\tthis\r\n\t\t    .fire('movestart')\r\n\t\t    .fire('zoomstart');\r\n\r\n\t\tthis._animateZoom(center, zoom, origin, scale, null, true);\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_animateZoom: function (center, zoom, origin, scale, delta, backwards, forTouchZoom) {\r\n\r\n\t\tif (!forTouchZoom) {\r\n\t\t\tthis._animatingZoom = true;\r\n\t\t}\r\n\r\n\t\t// put transform transition on all layers with leaflet-zoom-animated class\r\n\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-zoom-anim');\r\n\r\n\t\t// remember what center/zoom to set after animation\r\n\t\tthis._animateToCenter = center;\r\n\t\tthis._animateToZoom = zoom;\r\n\r\n\t\t// disable any dragging during animation\r\n\t\tif (L.Draggable) {\r\n\t\t\tL.Draggable._disabled = true;\r\n\t\t}\r\n\r\n\t\tL.Util.requestAnimFrame(function () {\r\n\t\t\tthis.fire('zoomanim', {\r\n\t\t\t\tcenter: center,\r\n\t\t\t\tzoom: zoom,\r\n\t\t\t\torigin: origin,\r\n\t\t\t\tscale: scale,\r\n\t\t\t\tdelta: delta,\r\n\t\t\t\tbackwards: backwards\r\n\t\t\t});\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_onZoomTransitionEnd: function () {\r\n\r\n\t\tthis._animatingZoom = false;\r\n\r\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-zoom-anim');\r\n\r\n\t\tthis._resetView(this._animateToCenter, this._animateToZoom, true, true);\r\n\r\n\t\tif (L.Draggable) {\r\n\t\t\tL.Draggable._disabled = false;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n\tZoom animation logic for L.TileLayer.\r\n*/\r\n\r\nL.TileLayer.include({\r\n\t_animateZoom: function (e) {\r\n\t\tif (!this._animating) {\r\n\t\t\tthis._animating = true;\r\n\t\t\tthis._prepareBgBuffer();\r\n\t\t}\r\n\r\n\t\tvar bg = this._bgBuffer,\r\n\t\t    transform = L.DomUtil.TRANSFORM,\r\n\t\t    initialTransform = e.delta ? L.DomUtil.getTranslateString(e.delta) : bg.style[transform],\r\n\t\t    scaleStr = L.DomUtil.getScaleString(e.scale, e.origin);\r\n\r\n\t\tbg.style[transform] = e.backwards ?\r\n\t\t\t\tscaleStr + ' ' + initialTransform :\r\n\t\t\t\tinitialTransform + ' ' + scaleStr;\r\n\t},\r\n\r\n\t_endZoomAnim: function () {\r\n\t\tvar front = this._tileContainer,\r\n\t\t    bg = this._bgBuffer;\r\n\r\n\t\tfront.style.visibility = '';\r\n\t\tfront.parentNode.appendChild(front); // Bring to fore\r\n\r\n\t\t// force reflow\r\n\t\tL.Util.falseFn(bg.offsetWidth);\r\n\r\n\t\tthis._animating = false;\r\n\t},\r\n\r\n\t_clearBgBuffer: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map && !map._animatingZoom && !map.touchZoom._zooming) {\r\n\t\t\tthis._bgBuffer.innerHTML = '';\r\n\t\t\tthis._bgBuffer.style[L.DomUtil.TRANSFORM] = '';\r\n\t\t}\r\n\t},\r\n\r\n\t_prepareBgBuffer: function () {\r\n\r\n\t\tvar front = this._tileContainer,\r\n\t\t    bg = this._bgBuffer;\r\n\r\n\t\t// if foreground layer doesn't have many tiles but bg layer does,\r\n\t\t// keep the existing bg layer and just zoom it some more\r\n\r\n\t\tvar bgLoaded = this._getLoadedTilesPercentage(bg),\r\n\t\t    frontLoaded = this._getLoadedTilesPercentage(front);\r\n\r\n\t\tif (bg && bgLoaded > 0.5 && frontLoaded < 0.5) {\r\n\r\n\t\t\tfront.style.visibility = 'hidden';\r\n\t\t\tthis._stopLoadingImages(front);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// prepare the buffer to become the front tile pane\r\n\t\tbg.style.visibility = 'hidden';\r\n\t\tbg.style[L.DomUtil.TRANSFORM] = '';\r\n\r\n\t\t// switch out the current layer to be the new bg layer (and vice-versa)\r\n\t\tthis._tileContainer = bg;\r\n\t\tbg = this._bgBuffer = front;\r\n\r\n\t\tthis._stopLoadingImages(bg);\r\n\r\n\t\t//prevent bg buffer from clearing right after zoom\r\n\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t},\r\n\r\n\t_getLoadedTilesPercentage: function (container) {\r\n\t\tvar tiles = container.getElementsByTagName('img'),\r\n\t\t    i, len, count = 0;\r\n\r\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\r\n\t\t\tif (tiles[i].complete) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count / len;\r\n\t},\r\n\r\n\t// stops loading all tiles in the background layer\r\n\t_stopLoadingImages: function (container) {\r\n\t\tvar tiles = Array.prototype.slice.call(container.getElementsByTagName('img')),\r\n\t\t    i, len, tile;\r\n\r\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\r\n\t\t\ttile = tiles[i];\r\n\r\n\t\t\tif (!tile.complete) {\r\n\t\t\t\ttile.onload = L.Util.falseFn;\r\n\t\t\t\ttile.onerror = L.Util.falseFn;\r\n\t\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\r\n\t\t\t\ttile.parentNode.removeChild(tile);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Provides L.Map with convenient shortcuts for using browser geolocation features.\r\n */\r\n\r\nL.Map.include({\r\n\t_defaultLocateOptions: {\r\n\t\twatch: false,\r\n\t\tsetView: false,\r\n\t\tmaxZoom: Infinity,\r\n\t\ttimeout: 10000,\r\n\t\tmaximumAge: 0,\r\n\t\tenableHighAccuracy: false\r\n\t},\r\n\r\n\tlocate: function (/*Object*/ options) {\r\n\r\n\t\toptions = this._locateOptions = L.extend(this._defaultLocateOptions, options);\r\n\r\n\t\tif (!navigator.geolocation) {\r\n\t\t\tthis._handleGeolocationError({\r\n\t\t\t\tcode: 0,\r\n\t\t\t\tmessage: 'Geolocation not supported.'\r\n\t\t\t});\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar onResponse = L.bind(this._handleGeolocationResponse, this),\r\n\t\t\tonError = L.bind(this._handleGeolocationError, this);\r\n\r\n\t\tif (options.watch) {\r\n\t\t\tthis._locationWatchId =\r\n\t\t\t        navigator.geolocation.watchPosition(onResponse, onError, options);\r\n\t\t} else {\r\n\t\t\tnavigator.geolocation.getCurrentPosition(onResponse, onError, options);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopLocate: function () {\r\n\t\tif (navigator.geolocation) {\r\n\t\t\tnavigator.geolocation.clearWatch(this._locationWatchId);\r\n\t\t}\r\n\t\tif (this._locateOptions) {\r\n\t\t\tthis._locateOptions.setView = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_handleGeolocationError: function (error) {\r\n\t\tvar c = error.code,\r\n\t\t    message = error.message ||\r\n\t\t            (c === 1 ? 'permission denied' :\r\n\t\t            (c === 2 ? 'position unavailable' : 'timeout'));\r\n\r\n\t\tif (this._locateOptions.setView && !this._loaded) {\r\n\t\t\tthis.fitWorld();\r\n\t\t}\r\n\r\n\t\tthis.fire('locationerror', {\r\n\t\t\tcode: c,\r\n\t\t\tmessage: 'Geolocation error: ' + message + '.'\r\n\t\t});\r\n\t},\r\n\r\n\t_handleGeolocationResponse: function (pos) {\r\n\t\tvar lat = pos.coords.latitude,\r\n\t\t    lng = pos.coords.longitude,\r\n\t\t    latlng = new L.LatLng(lat, lng),\r\n\r\n\t\t    latAccuracy = 180 * pos.coords.accuracy / 40075017,\r\n\t\t    lngAccuracy = latAccuracy / Math.cos(L.LatLng.DEG_TO_RAD * lat),\r\n\r\n\t\t    bounds = L.latLngBounds(\r\n\t\t            [lat - latAccuracy, lng - lngAccuracy],\r\n\t\t            [lat + latAccuracy, lng + lngAccuracy]),\r\n\r\n\t\t    options = this._locateOptions;\r\n\r\n\t\tif (options.setView) {\r\n\t\t\tvar zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);\r\n\t\t\tthis.setView(latlng, zoom);\r\n\t\t}\r\n\r\n\t\tvar data = {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tbounds: bounds,\r\n\t\t\ttimestamp: pos.timestamp\r\n\t\t};\r\n\r\n\t\tfor (var i in pos.coords) {\r\n\t\t\tif (typeof pos.coords[i] === 'number') {\r\n\t\t\t\tdata[i] = pos.coords[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.fire('locationfound', data);\r\n\t}\r\n});\r\n\r\n\r\n}(window, document));","L.KML = L.FeatureGroup.extend({\r\n\toptions: {\r\n\t\tasync: true\r\n\t},\r\n\r\n\tinitialize: function(kml, options) {\r\n\t\tL.Util.setOptions(this, options);\r\n\t\tthis._kml = kml;\r\n\t\tthis._layers = {};\r\n\r\n\t\tif (kml) {\r\n\t\t\tthis.addKML(kml, options, this.options.async);\r\n\t\t}\r\n\t},\r\n\r\n\tloadXML: function(url, cb, options, async) {\r\n\t\tif (async === undefined) async = this.options.async;\r\n\t\tif (options === undefined) options = this.options;\r\n\r\n\t\tvar req = new window.XMLHttpRequest();\r\n\t\treq.open('GET', url, async);\r\n\t\ttry {\r\n\t\t\treq.overrideMimeType('text/xml'); // unsupported by IE\r\n\t\t} catch(e) {}\r\n\t\treq.onreadystatechange = function() {\r\n\t\t\tif (req.readyState !== 4) return;\r\n\t\t\tif (req.status === 200) cb(req.responseXML, options);\r\n\t\t};\r\n\t\treq.send(null);\r\n\t},\r\n\r\n\taddKML: function(url, options, async) {\r\n\t\tvar _this = this;\r\n\t\tvar cb = function(gpx, options) { _this._addKML(gpx, options); };\r\n\t\tthis.loadXML(url, cb, options, async);\r\n\t},\r\n\r\n\t_addKML: function(xml, options) {\r\n\t\tvar layers = this.parseKML(xml);\r\n\t\tif (!layers || !layers.length) return;\r\n\t\tfor (var i = 0; i < layers.length; i++) {\r\n\t\t\tthis.fire('addlayer', {\r\n\t\t\t\tlayer: layers[i]\r\n\t\t\t});\r\n\t\t\tthis.addLayer(layers[i]);\r\n\t\t}\r\n\t\tthis.latLngs = this.getLatLngs(xml);\r\n\t\tthis.fire('loaded');\r\n\t},\r\n\r\n\tlatLngs: []\r\n});\r\n\r\nL.KML = L.KML.extend({\r\n\r\n\tparseKML: function (xml) {\r\n\t\tvar style = this.parseStyle(xml);\r\n\t\tthis.parseStyleMap(xml, style);\r\n\t\tvar el = xml.getElementsByTagName('Folder');\r\n\t\tvar layers = [], l;\r\n\t\tfor (var i = 0; i < el.length; i++) {\r\n\t\t\tif (!this._check_folder(el[i])) { continue; }\r\n\t\t\tl = this.parseFolder(el[i], style);\r\n\t\t\tif (l) { layers.push(l); }\r\n\t\t}\r\n\t\tel = xml.getElementsByTagName('Placemark');\r\n\t\tfor (var j = 0; j < el.length; j++) {\r\n\t\t\tif (!this._check_folder(el[j])) { continue; }\r\n\t\t\tl = this.parsePlacemark(el[j], xml, style);\r\n\t\t\tif (l) { layers.push(l); }\r\n\t\t}\r\n\t\tel = xml.getElementsByTagName('GroundOverlay');\r\n\t\tfor (var k = 0; k < el.length; k++) {\r\n\t\t\tl = this.parseGroundOverlay(el[k]);\r\n\t\t\tif (l) { layers.push(l); }\r\n\t\t}\r\n\t\treturn layers;\r\n\t},\r\n\r\n\t// Return false if e's first parent Folder is not [folder]\r\n\t// - returns true if no parent Folders\r\n\t_check_folder: function (e, folder) {\r\n\t\te = e.parentElement;\r\n\t\twhile (e && e.tagName !== 'Folder')\r\n\t\t{\r\n\t\t\te = e.parentElement;\r\n\t\t}\r\n\t\treturn !e || e === folder;\r\n\t},\r\n\r\n\tparseStyle: function (xml) {\r\n\t\tvar style = {};\r\n\t\tvar sl = xml.getElementsByTagName('Style');\r\n\r\n\t\t//for (var i = 0; i < sl.length; i++) {\r\n\t\tvar attributes = {color: true, width: true, Icon: true, href: true,\r\n\t\t\t\t\t\t  hotSpot: true};\r\n\r\n\t\tfunction _parse(xml) {\r\n\t\t\tvar options = {};\r\n\t\t\tfor (var i = 0; i < xml.childNodes.length; i++) {\r\n\t\t\t\tvar e = xml.childNodes[i];\r\n\t\t\t\tvar key = e.tagName;\r\n\t\t\t\tif (!attributes[key]) { continue; }\r\n\t\t\t\tif (key === 'hotSpot')\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (var j = 0; j < e.attributes.length; j++) {\r\n\t\t\t\t\t\toptions[e.attributes[j].name] = e.attributes[j].nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar value = e.childNodes[0].nodeValue;\r\n\t\t\t\t\tif (key === 'color') {\r\n\t\t\t\t\t\toptions.opacity = parseInt(value.substring(0, 2), 16) / 255.0;\r\n\t\t\t\t\t\toptions.color = '#' + value.substring(6, 8) + value.substring(4, 6) + value.substring(2, 4);\r\n\t\t\t\t\t} else if (key === 'width') {\r\n\t\t\t\t\t\toptions.weight = value;\r\n\t\t\t\t\t} else if (key === 'Icon') {\r\n\t\t\t\t\t\tioptions = _parse(e);\r\n\t\t\t\t\t\tif (ioptions.href) { options.href = ioptions.href; }\r\n\t\t\t\t\t} else if (key === 'href') {\r\n\t\t\t\t\t\toptions.href = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn options;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < sl.length; i++) {\r\n\t\t\tvar e = sl[i], el;\r\n\t\t\tvar options = {}, poptions = {}, ioptions = {};\r\n\t\t\tel = e.getElementsByTagName('LineStyle');\r\n\t\t\tif (el && el[0]) { options = _parse(el[0]); }\r\n\t\t\tel = e.getElementsByTagName('PolyStyle');\r\n\t\t\tif (el && el[0]) { poptions = _parse(el[0]); }\r\n\t\t\tif (poptions.color) { options.fillColor = poptions.color; }\r\n\t\t\tif (poptions.opacity) { options.fillOpacity = poptions.opacity; }\r\n\t\t\tel = e.getElementsByTagName('IconStyle');\r\n\t\t\tif (el && el[0]) { ioptions = _parse(el[0]); }\r\n\t\t\tif (ioptions.href) {\r\n\t\t\t\t// save anchor info until the image is loaded\r\n\t\t\t\toptions.icon = new L.KMLIcon({\r\n\t\t\t\t\ticonUrl: ioptions.href,\r\n\t\t\t\t\tshadowUrl: null,\r\n\t\t\t\t\ticonAnchorRef: {x: ioptions.x, y: ioptions.y},\r\n\t\t\t\t\ticonAnchorType:\t{x: ioptions.xunits, y: ioptions.yunits}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tstyle['#' + e.getAttribute('id')] = options;\r\n\t\t}\r\n\t\treturn style;\r\n\t},\r\n\t\r\n\tparseStyleMap: function (xml, existingStyles) {\r\n\t\tvar sl = xml.getElementsByTagName('StyleMap');\r\n\t\t\r\n\t\tfor (var i = 0; i < sl.length; i++) {\r\n\t\t\tvar e = sl[i], el;\r\n\t\t\tvar smKey, smStyleUrl;\r\n\t\t\t\r\n\t\t\tel = e.getElementsByTagName('key');\r\n\t\t\tif (el && el[0]) { smKey = el[0].textContent; }\r\n\t\t\tel = e.getElementsByTagName('styleUrl');\r\n\t\t\tif (el && el[0]) { smStyleUrl = el[0].textContent; }\r\n\t\t\t\r\n\t\t\tif (smKey === 'normal')\r\n\t\t\t{\r\n\t\t\t\texistingStyles['#' + e.getAttribute('id')] = existingStyles[smStyleUrl];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn;\r\n\t},\r\n\r\n\tparseFolder: function (xml, style) {\r\n\t\tvar el, layers = [], l;\r\n\t\tel = xml.getElementsByTagName('Folder');\r\n\t\tfor (var i = 0; i < el.length; i++) {\r\n\t\t\tif (!this._check_folder(el[i], xml)) { continue; }\r\n\t\t\tl = this.parseFolder(el[i], style);\r\n\t\t\tif (l) { layers.push(l); }\r\n\t\t}\r\n\t\tel = xml.getElementsByTagName('Placemark');\r\n\t\tfor (var j = 0; j < el.length; j++) {\r\n\t\t\tif (!this._check_folder(el[j], xml)) { continue; }\r\n\t\t\tl = this.parsePlacemark(el[j], xml, style);\r\n\t\t\tif (l) { layers.push(l); }\r\n\t\t}\r\n\t\tel = xml.getElementsByTagName('GroundOverlay');\r\n\t\tfor (var k = 0; k < el.length; k++) {\r\n\t\t\tif (!this._check_folder(el[k], xml)) { continue; }\r\n\t\t\tl = this.parseGroundOverlay(el[k]);\r\n\t\t\tif (l) { layers.push(l); }\r\n\t\t}\r\n\t\tif (!layers.length) { return; }\r\n\t\tif (layers.length === 1) { return layers[0]; }\r\n\t\treturn new L.FeatureGroup(layers);\r\n\t},\r\n\r\n\tparsePlacemark: function (place, xml, style) {\r\n\t\tvar h, i, j, el, options = {};\r\n\r\n\t\tvar multi = ['MultiGeometry', 'gx:MultiTrack'];\r\n\t\tfor (h in multi) {\r\n                    if (!multi.hasOwnProperty(h)) {\r\n                        continue;\r\n                    }\r\n                    el = place.getElementsByTagName(multi[h]);\r\n                    for (i = 0; i < el.length; i++) {\r\n                            return this.parsePlacemark(el[i], xml, style);\r\n                    }\r\n\t\t}\r\n\r\n\t\tel = place.getElementsByTagName('styleUrl');\r\n\t\tfor (i = 0; i < el.length; i++) {\r\n\t\t\tvar url = el[i].childNodes[0].nodeValue;\r\n\t\t\tfor (var a in style[url]) {\r\n                            if (!style[url].hasOwnProperty(a)) {\r\n                                continue;\r\n                            }\r\n                            options[a] = style[url][a];\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar layers = [];\r\n\r\n\t\tvar parse = ['LineString', 'Polygon', 'Point', 'gx:Track'];\r\n\t\tfor (j in parse) {\r\n                    if (!parse.hasOwnProperty(j)) {\r\n                        continue;\r\n                    }\r\n                    var tag = parse[j];\r\n                    el = place.getElementsByTagName(tag);\r\n                    for (i = 0; i < el.length; i++) {\r\n                            var l = this['parse' + tag.replace(/gx:/, '')](el[i], xml, options);\r\n                            if (l) { layers.push(l); }\r\n                    }\r\n\t\t}\r\n\r\n\t\tif (!layers.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar layer = layers[0];\r\n\t\tif (layers.length > 1) {\r\n\t\t\tlayer = new L.FeatureGroup(layers);\r\n\t\t}\r\n\r\n\t\tvar name, descr = '';\r\n\t\tel = place.getElementsByTagName('name');\r\n\t\tif (el.length && el[0].childNodes.length) {\r\n\t\t\tname = el[0].childNodes[0].nodeValue;\r\n\t\t}\r\n\t\tel = place.getElementsByTagName('description');\r\n\t\tfor (i = 0; i < el.length; i++) {\r\n\t\t\tfor (j = 0; j < el[i].childNodes.length; j++) {\r\n\t\t\t\tdescr = descr + el[i].childNodes[j].nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (name) {\r\n\t\t\tlayer.bindPopup('<h2>' + name + '</h2>' + descr);\r\n\t\t}\r\n\r\n\t\treturn layer;\r\n\t},\r\n\r\n\tparseCoords: function (xml) {\r\n\t\tvar el = xml.getElementsByTagName('coordinates');\r\n\t\treturn this._read_coords(el[0]);\r\n\t},\r\n\r\n\tparseLineString: function (line, xml, options) {\r\n\t\tvar coords = this.parseCoords(line);\r\n\t\tif (!coords.length) { return; }\r\n\t\treturn new L.Polyline(coords, options);\r\n\t},\r\n\r\n\tparseTrack: function (line, xml, options) {\r\n\t\tvar el = xml.getElementsByTagName('gx:coord');\r\n\t\tvar coords = [];\r\n\t\tfor (var j = 0; j < el.length; j++) {\r\n\t\t\tcoords = coords.concat(this._read_gxcoords(el[j]));\r\n\t\t}\r\n\t\tif (!coords.length) { return; }\r\n\t\treturn new L.Polyline(coords, options);\r\n\t},\r\n\r\n\tparsePoint: function (line, xml, options) {\r\n\t\tvar el = line.getElementsByTagName('coordinates');\r\n\t\tif (!el.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ll = el[0].childNodes[0].nodeValue.split(',');\r\n\t\treturn new L.KMLMarker(new L.LatLng(ll[1], ll[0]), options);\r\n\t},\r\n\r\n\tparsePolygon: function (line, xml, options) {\r\n\t\tvar el, polys = [], inner = [], i, coords;\r\n\t\tel = line.getElementsByTagName('outerBoundaryIs');\r\n\t\tfor (i = 0; i < el.length; i++) {\r\n\t\t\tcoords = this.parseCoords(el[i]);\r\n\t\t\tif (coords) {\r\n\t\t\t\tpolys.push(coords);\r\n\t\t\t}\r\n\t\t}\r\n\t\tel = line.getElementsByTagName('innerBoundaryIs');\r\n\t\tfor (i = 0; i < el.length; i++) {\r\n\t\t\tcoords = this.parseCoords(el[i]);\r\n\t\t\tif (coords) {\r\n\t\t\t\tinner.push(coords);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!polys.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (options.fillColor) {\r\n\t\t\toptions.fill = true;\r\n\t\t}\r\n\t\tif (polys.length === 1) {\r\n\t\t\treturn new L.Polygon(polys.concat(inner), options);\r\n\t\t}\r\n\t\treturn new L.MultiPolygon(polys, options);\r\n\t},\r\n\r\n\tgetLatLngs: function (xml) {\r\n\t\tvar el = xml.getElementsByTagName('coordinates');\r\n\t\tvar coords = [];\r\n\t\tfor (var j = 0; j < el.length; j++) {\r\n\t\t\t// text might span many childNodes\r\n\t\t\tcoords = coords.concat(this._read_coords(el[j]));\r\n\t\t}\r\n\t\treturn coords;\r\n\t},\r\n\r\n\t_read_coords: function (el) {\r\n\t\tvar text = '', coords = [], i;\r\n\t\tfor (i = 0; i < el.childNodes.length; i++) {\r\n\t\t\ttext = text + el.childNodes[i].nodeValue;\r\n\t\t}\r\n\t\ttext = text.split(/[\\s\\n]+/);\r\n\t\tfor (i = 0; i < text.length; i++) {\r\n\t\t\tvar ll = text[i].split(',');\r\n\t\t\tif (ll.length < 2) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcoords.push(new L.LatLng(ll[1], ll[0]));\r\n\t\t}\r\n\t\treturn coords;\r\n\t},\r\n\r\n\t_read_gxcoords: function (el) {\r\n\t\tvar text = '', coords = [];\r\n\t\ttext = el.firstChild.nodeValue.split(' ');\r\n\t\tcoords.push(new L.LatLng(text[1], text[0]));\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tparseGroundOverlay: function (xml) {\r\n\t\tvar latlonbox = xml.getElementsByTagName('LatLonBox')[0];\r\n\t\tvar bounds = new L.LatLngBounds(\r\n\t\t\t[\r\n\t\t\t\tlatlonbox.getElementsByTagName('south')[0].childNodes[0].nodeValue,\r\n\t\t\t\tlatlonbox.getElementsByTagName('west')[0].childNodes[0].nodeValue\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\tlatlonbox.getElementsByTagName('north')[0].childNodes[0].nodeValue,\r\n\t\t\t\tlatlonbox.getElementsByTagName('east')[0].childNodes[0].nodeValue\r\n\t\t\t]\r\n\t\t);\r\n\t\tvar attributes = {Icon: true, href: true, color: true};\r\n\t\tfunction _parse(xml) {\r\n\t\t\tvar options = {}, ioptions = {};\r\n\t\t\tfor (var i = 0; i < xml.childNodes.length; i++) {\r\n\t\t\t\tvar e = xml.childNodes[i];\r\n\t\t\t\tvar key = e.tagName;\r\n\t\t\t\tif (!attributes[key]) { continue; }\r\n\t\t\t\tvar value = e.childNodes[0].nodeValue;\r\n\t\t\t\tif (key === 'Icon') {\r\n\t\t\t\t\tioptions = _parse(e);\r\n\t\t\t\t\tif (ioptions.href) { options.href = ioptions.href; }\r\n\t\t\t\t} else if (key === 'href') {\r\n\t\t\t\t\toptions.href = value;\r\n\t\t\t\t} else if (key === 'color') {\r\n\t\t\t\t\toptions.opacity = parseInt(value.substring(0, 2), 16) / 255.0;\r\n\t\t\t\t\toptions.color = '#' + value.substring(6, 8) + value.substring(4, 6) + value.substring(2, 4);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\tvar options = {};\r\n\t\toptions = _parse(xml);\r\n\t\tif (latlonbox.getElementsByTagName('rotation')[0] !== undefined) {\r\n\t\t\tvar rotation = latlonbox.getElementsByTagName('rotation')[0].childNodes[0].nodeValue;\r\n\t\t\toptions.rotation = parseFloat(rotation);\r\n\t\t}\r\n\t\treturn new L.RotatedImageOverlay(options.href, bounds, {opacity: options.opacity, angle: options.rotation});\r\n\t}\r\n\r\n});\r\n\r\nL.KMLIcon = L.Icon.extend({\r\n\r\n\tcreateIcon: function () {\r\n\t\tvar img = this._createIcon('icon');\r\n\t\timg.onload = function () {\r\n\t\t\tvar i = img;\r\n\t\t\tthis.style.width = i.width + 'px';\r\n\t\t\tthis.style.height = i.height + 'px';\r\n\r\n\t\t\tif (this.anchorType.x === 'UNITS_FRACTION' || this.anchorType.x === 'fraction') {\r\n\t\t\t\timg.style.marginLeft = (-this.anchor.x * i.width) + 'px';\r\n\t\t\t}\r\n\t\t\tif (this.anchorType.y === 'UNITS_FRACTION' || this.anchorType.x === 'fraction') {\r\n\t\t\t\timg.style.marginTop  = (-(1 - this.anchor.y) * i.height) + 'px';\r\n\t\t\t}\r\n\t\t\tthis.style.display = '';\r\n\t\t};\r\n\t\treturn img;\r\n\t},\r\n\r\n\t_setIconStyles: function (img, name) {\r\n\t\tL.Icon.prototype._setIconStyles.apply(this, [img, name]);\r\n\t\t// save anchor information to the image\r\n\t\timg.anchor = this.options.iconAnchorRef;\r\n\t\timg.anchorType = this.options.iconAnchorType;\r\n\t}\r\n});\r\n\r\n\r\nL.KMLMarker = L.Marker.extend({\r\n\toptions: {\r\n\t\ticon: new L.KMLIcon.Default()\r\n\t}\r\n});\r\n\r\n// Inspired by https://github.com/bbecquet/Leaflet.PolylineDecorator/tree/master/src\r\nL.RotatedImageOverlay = L.ImageOverlay.extend({\r\n\toptions: {\r\n\t\tangle: 0\r\n\t},\r\n\t_reset: function () {\r\n\t\tL.ImageOverlay.prototype._reset.call(this);\r\n\t\tthis._rotate();\r\n\t},\r\n\t_animateZoom: function (e) {\r\n\t\tL.ImageOverlay.prototype._animateZoom.call(this, e);\r\n\t\tthis._rotate();\r\n\t},\r\n\t_rotate: function () {\r\n        if (L.DomUtil.TRANSFORM) {\r\n            // use the CSS transform rule if available\r\n            this._image.style[L.DomUtil.TRANSFORM] += ' rotate(' + this.options.angle + 'deg)';\r\n        } else if(L.Browser.ie) {\r\n            // fallback for IE6, IE7, IE8\r\n            var rad = this.options.angle * (Math.PI / 180),\r\n                costheta = Math.cos(rad),\r\n                sintheta = Math.sin(rad);\r\n            this._image.style.filter += ' progid:DXImageTransform.Microsoft.Matrix(sizingMethod=\\'auto expand\\', M11=' + \r\n                costheta + ', M12=' + (-sintheta) + ', M21=' + sintheta + ', M22=' + costheta + ')';                \r\n        }\r\n\t},\r\n\tgetBounds: function() {\r\n\t\treturn this._bounds;\r\n\t}\r\n});\r\n\r\n","/*\r\n Leaflet.markercluster, Provides Beautiful Animated Marker Clustering functionality for Leaflet, a JS library for interactive maps.\r\n https://github.com/Leaflet/Leaflet.markercluster\r\n (c) 2012-2013, Dave Leaver, smartrak\r\n*/\r\n(function (window, document, undefined) {/*\r\n * L.MarkerClusterGroup extends L.FeatureGroup by clustering the markers contained within\r\n */\r\n\r\nL.MarkerClusterGroup = L.FeatureGroup.extend({\r\n\r\n\toptions: {\r\n\t\tmaxClusterRadius: 80, //A cluster will cover at most this many pixels from its center\r\n\t\ticonCreateFunction: null,\r\n\r\n\t\tspiderfyOnMaxZoom: true,\r\n\t\tshowCoverageOnHover: true,\r\n\t\tzoomToBoundsOnClick: true,\r\n\t\tsingleMarkerMode: false,\r\n\r\n\t\tdisableClusteringAtZoom: null,\r\n\r\n\t\t// Setting this to false prevents the removal of any clusters outside of the viewpoint, which\r\n\t\t// is the default behaviour for performance reasons.\r\n\t\tremoveOutsideVisibleBounds: true,\r\n\r\n\t\t//Whether to animate adding markers after adding the MarkerClusterGroup to the map\r\n\t\t// If you are adding individual markers set to true, if adding bulk markers leave false for massive performance gains.\r\n\t\tanimateAddingMarkers: false,\r\n\r\n\t\t//Increase to increase the distance away that spiderfied markers appear from the center\r\n\t\tspiderfyDistanceMultiplier: 1,\r\n\r\n\t\t// Make it possible to specify a polyline options on a spider leg\r\n\t\tspiderLegPolylineOptions: { weight: 1.5, color: '#222' },\r\n\r\n\t\t// When bulk adding layers, adds markers in chunks. Means addLayers may not add all the layers in the call, others will be loaded during setTimeouts\r\n\t\tchunkedLoading: false,\r\n\t\tchunkInterval: 200, // process markers for a maximum of ~ n milliseconds (then trigger the chunkProgress callback)\r\n\t\tchunkDelay: 50, // at the end of each interval, give n milliseconds back to system/browser\r\n\t\tchunkProgress: null, // progress callback: function(processed, total, elapsed) (e.g. for a progress indicator)\r\n\r\n\t\t//Options to pass to the L.Polygon constructor\r\n\t\tpolygonOptions: {}\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.Util.setOptions(this, options);\r\n\t\tif (!this.options.iconCreateFunction) {\r\n\t\t\tthis.options.iconCreateFunction = this._defaultIconCreateFunction;\r\n\t\t}\r\n\r\n\t\tthis._featureGroup = L.featureGroup();\r\n\t\tthis._featureGroup.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\r\n\t\tthis._nonPointGroup = L.featureGroup();\r\n\t\tthis._nonPointGroup.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\r\n\t\tthis._inZoomAnimation = 0;\r\n\t\tthis._needsClustering = [];\r\n\t\tthis._needsRemoving = []; //Markers removed while we aren't on the map need to be kept track of\r\n\t\t//The bounds of the currently shown area (from _getExpandedVisibleBounds) Updated on zoom/move\r\n\t\tthis._currentShownBounds = null;\r\n\r\n\t\tthis._queue = [];\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\r\n\t\tif (layer instanceof L.LayerGroup) {\r\n\t\t\tvar array = [];\r\n\t\t\tfor (var i in layer._layers) {\r\n\t\t\t\tarray.push(layer._layers[i]);\r\n\t\t\t}\r\n\t\t\treturn this.addLayers(array);\r\n\t\t}\r\n\r\n\t\t//Don't cluster non point data\r\n\t\tif (!layer.getLatLng) {\r\n\t\t\tthis._nonPointGroup.addLayer(layer);\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!this._map) {\r\n\t\t\tthis._needsClustering.push(layer);\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\r\n\t\t//If we have already clustered we'll need to add this one to a cluster\r\n\r\n\t\tif (this._unspiderfy) {\r\n\t\t\tthis._unspiderfy();\r\n\t\t}\r\n\r\n\t\tthis._addLayer(layer, this._maxZoom);\r\n\r\n\t\t//Work out what is visible\r\n\t\tvar visibleLayer = layer,\r\n\t\t\tcurrentZoom = this._map.getZoom();\r\n\t\tif (layer.__parent) {\r\n\t\t\twhile (visibleLayer.__parent._zoom >= currentZoom) {\r\n\t\t\t\tvisibleLayer = visibleLayer.__parent;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._currentShownBounds.contains(visibleLayer.getLatLng())) {\r\n\t\t\tif (this.options.animateAddingMarkers) {\r\n\t\t\t\tthis._animationAddLayer(layer, visibleLayer);\r\n\t\t\t} else {\r\n\t\t\t\tthis._animationAddLayerNonAnimated(layer, visibleLayer);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\r\n\t\tif (layer instanceof L.LayerGroup)\r\n\t\t{\r\n\t\t\tvar array = [];\r\n\t\t\tfor (var i in layer._layers) {\r\n\t\t\t\tarray.push(layer._layers[i]);\r\n\t\t\t}\r\n\t\t\treturn this.removeLayers(array);\r\n\t\t}\r\n\r\n\t\t//Non point layers\r\n\t\tif (!layer.getLatLng) {\r\n\t\t\tthis._nonPointGroup.removeLayer(layer);\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!this._map) {\r\n\t\t\tif (!this._arraySplice(this._needsClustering, layer) && this.hasLayer(layer)) {\r\n\t\t\t\tthis._needsRemoving.push(layer);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!layer.__parent) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (this._unspiderfy) {\r\n\t\t\tthis._unspiderfy();\r\n\t\t\tthis._unspiderfyLayer(layer);\r\n\t\t}\r\n\r\n\t\t//Remove the marker from clusters\r\n\t\tthis._removeLayer(layer, true);\r\n\r\n\t\tif (this._featureGroup.hasLayer(layer)) {\r\n\t\t\tthis._featureGroup.removeLayer(layer);\r\n\t\t\tif (layer.clusterShow) {\r\n\t\t\t\tlayer.clusterShow();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//Takes an array of markers and adds them in bulk\r\n\taddLayers: function (layersArray) {\r\n\t\tvar fg = this._featureGroup,\r\n\t\t\tnpg = this._nonPointGroup,\r\n\t\t\tchunked = this.options.chunkedLoading,\r\n\t\t\tchunkInterval = this.options.chunkInterval,\r\n\t\t\tchunkProgress = this.options.chunkProgress,\r\n\t\t\tnewMarkers, i, l, m;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tvar offset = 0,\r\n\t\t\t\tstarted = (new Date()).getTime();\r\n\t\t\tvar process = L.bind(function () {\r\n\t\t\t\tvar start = (new Date()).getTime();\r\n\t\t\t\tfor (; offset < layersArray.length; offset++) {\r\n\t\t\t\t\tif (chunked && offset % 200 === 0) {\r\n\t\t\t\t\t\t// every couple hundred markers, instrument the time elapsed since processing started:\r\n\t\t\t\t\t\tvar elapsed = (new Date()).getTime() - start;\r\n\t\t\t\t\t\tif (elapsed > chunkInterval) {\r\n\t\t\t\t\t\t\tbreak; // been working too hard, time to take a break :-)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tm = layersArray[offset];\r\n\r\n\t\t\t\t\t//Not point data, can't be clustered\r\n\t\t\t\t\tif (!m.getLatLng) {\r\n\t\t\t\t\t\tnpg.addLayer(m);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.hasLayer(m)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._addLayer(m, this._maxZoom);\r\n\r\n\t\t\t\t\t//If we just made a cluster of size 2 then we need to remove the other marker from the map (if it is) or we never will\r\n\t\t\t\t\tif (m.__parent) {\r\n\t\t\t\t\t\tif (m.__parent.getChildCount() === 2) {\r\n\t\t\t\t\t\t\tvar markers = m.__parent.getAllChildMarkers(),\r\n\t\t\t\t\t\t\t\totherMarker = markers[0] === m ? markers[1] : markers[0];\r\n\t\t\t\t\t\t\tfg.removeLayer(otherMarker);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (chunkProgress) {\r\n\t\t\t\t\t// report progress and time elapsed:\r\n\t\t\t\t\tchunkProgress(offset, layersArray.length, (new Date()).getTime() - started);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offset === layersArray.length) {\r\n\t\t\t\t\t//Update the icons of all those visible clusters that were affected\r\n\t\t\t\t\tthis._featureGroup.eachLayer(function (c) {\r\n\t\t\t\t\t\tif (c instanceof L.MarkerCluster && c._iconNeedsUpdate) {\r\n\t\t\t\t\t\t\tc._updateIcon();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tthis._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(process, this.options.chunkDelay);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\r\n\t\t\tprocess();\r\n\t\t} else {\r\n\t\t\tnewMarkers = [];\r\n\t\t\tfor (i = 0, l = layersArray.length; i < l; i++) {\r\n\t\t\t\tm = layersArray[i];\r\n\r\n\t\t\t\t//Not point data, can't be clustered\r\n\t\t\t\tif (!m.getLatLng) {\r\n\t\t\t\t\tnpg.addLayer(m);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.hasLayer(m)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewMarkers.push(m);\r\n\t\t\t}\r\n\t\t\tthis._needsClustering = this._needsClustering.concat(newMarkers);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//Takes an array of markers and removes them in bulk\r\n\tremoveLayers: function (layersArray) {\r\n\t\tvar i, l, m,\r\n\t\t\tfg = this._featureGroup,\r\n\t\t\tnpg = this._nonPointGroup;\r\n\r\n\t\tif (this._unspiderfy) {\r\n\t\t\tthis._unspiderfy();\r\n\t\t}\r\n\r\n\t\tif (!this._map) {\r\n\t\t\tfor (i = 0, l = layersArray.length; i < l; i++) {\r\n\t\t\t\tm = layersArray[i];\r\n\t\t\t\tthis._arraySplice(this._needsClustering, m);\r\n\t\t\t\tnpg.removeLayer(m);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tfor (i = 0, l = layersArray.length; i < l; i++) {\r\n\t\t\tm = layersArray[i];\r\n\r\n\t\t\tif (!m.__parent) {\r\n\t\t\t\tnpg.removeLayer(m);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tthis._removeLayer(m, true, true);\r\n\r\n\t\t\tif (fg.hasLayer(m)) {\r\n\t\t\t\tfg.removeLayer(m);\r\n\t\t\t\tif (m.clusterShow) {\r\n\t\t\t\t\tm.clusterShow();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Fix up the clusters and markers on the map\r\n\t\tthis._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);\r\n\r\n\t\tfg.eachLayer(function (c) {\r\n\t\t\tif (c instanceof L.MarkerCluster) {\r\n\t\t\t\tc._updateIcon();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//Removes all layers from the MarkerClusterGroup\r\n\tclearLayers: function () {\r\n\t\t//Need our own special implementation as the LayerGroup one doesn't work for us\r\n\r\n\t\t//If we aren't on the map (yet), blow away the markers we know of\r\n\t\tif (!this._map) {\r\n\t\t\tthis._needsClustering = [];\r\n\t\t\tdelete this._gridClusters;\r\n\t\t\tdelete this._gridUnclustered;\r\n\t\t}\r\n\r\n\t\tif (this._noanimationUnspiderfy) {\r\n\t\t\tthis._noanimationUnspiderfy();\r\n\t\t}\r\n\r\n\t\t//Remove all the visible layers\r\n\t\tthis._featureGroup.clearLayers();\r\n\t\tthis._nonPointGroup.clearLayers();\r\n\r\n\t\tthis.eachLayer(function (marker) {\r\n\t\t\tdelete marker.__parent;\r\n\t\t});\r\n\r\n\t\tif (this._map) {\r\n\t\t\t//Reset _topClusterLevel and the DistanceGrids\r\n\t\t\tthis._generateInitialClusters();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//Override FeatureGroup.getBounds as it doesn't work\r\n\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\tif (this._topClusterLevel) {\r\n\t\t\tbounds.extend(this._topClusterLevel._bounds);\r\n\t\t}\r\n\r\n\t\tfor (var i = this._needsClustering.length - 1; i >= 0; i--) {\r\n\t\t\tbounds.extend(this._needsClustering[i].getLatLng());\r\n\t\t}\r\n\r\n\t\tbounds.extend(this._nonPointGroup.getBounds());\r\n\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t//Overrides LayerGroup.eachLayer\r\n\teachLayer: function (method, context) {\r\n\t\tvar markers = this._needsClustering.slice(),\r\n\t\t\ti;\r\n\r\n\t\tif (this._topClusterLevel) {\r\n\t\t\tthis._topClusterLevel.getAllChildMarkers(markers);\r\n\t\t}\r\n\r\n\t\tfor (i = markers.length - 1; i >= 0; i--) {\r\n\t\t\tmethod.call(context, markers[i]);\r\n\t\t}\r\n\r\n\t\tthis._nonPointGroup.eachLayer(method, context);\r\n\t},\r\n\r\n\t//Overrides LayerGroup.getLayers\r\n\tgetLayers: function () {\r\n\t\tvar layers = [];\r\n\t\tthis.eachLayer(function (l) {\r\n\t\t\tlayers.push(l);\r\n\t\t});\r\n\t\treturn layers;\r\n\t},\r\n\r\n\t//Overrides LayerGroup.getLayer, WARNING: Really bad performance\r\n\tgetLayer: function (id) {\r\n\t\tvar result = null;\r\n\r\n\t\tthis.eachLayer(function (l) {\r\n\t\t\tif (L.stamp(l) === id) {\r\n\t\t\t\tresult = l;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t},\r\n\r\n\t//Returns true if the given layer is in this MarkerClusterGroup\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar i, anArray = this._needsClustering;\r\n\r\n\t\tfor (i = anArray.length - 1; i >= 0; i--) {\r\n\t\t\tif (anArray[i] === layer) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tanArray = this._needsRemoving;\r\n\t\tfor (i = anArray.length - 1; i >= 0; i--) {\r\n\t\t\tif (anArray[i] === layer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn !!(layer.__parent && layer.__parent._group === this) || this._nonPointGroup.hasLayer(layer);\r\n\t},\r\n\r\n\t//Zoom down to show the given layer (spiderfying if necessary) then calls the callback\r\n\tzoomToShowLayer: function (layer, callback) {\r\n\r\n\t\tvar showMarker = function () {\r\n\t\t\tif ((layer._icon || layer.__parent._icon) && !this._inZoomAnimation) {\r\n\t\t\t\tthis._map.off('moveend', showMarker, this);\r\n\t\t\t\tthis.off('animationend', showMarker, this);\r\n\r\n\t\t\t\tif (layer._icon) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} else if (layer.__parent._icon) {\r\n\t\t\t\t\tvar afterSpiderfy = function () {\r\n\t\t\t\t\t\tthis.off('spiderfied', afterSpiderfy, this);\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.on('spiderfied', afterSpiderfy, this);\r\n\t\t\t\t\tlayer.__parent.spiderfy();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (layer._icon && this._map.getBounds().contains(layer.getLatLng())) {\r\n\t\t\t//Layer is visible ond on screen, immediate return\r\n\t\t\tcallback();\r\n\t\t} else if (layer.__parent._zoom < this._map.getZoom()) {\r\n\t\t\t//Layer should be visible at this zoom level. It must not be on screen so just pan over to it\r\n\t\t\tthis._map.on('moveend', showMarker, this);\r\n\t\t\tthis._map.panTo(layer.getLatLng());\r\n\t\t} else {\r\n\t\t\tvar moveStart = function () {\r\n\t\t\t\tthis._map.off('movestart', moveStart, this);\r\n\t\t\t\tmoveStart = null;\r\n\t\t\t};\r\n\r\n\t\t\tthis._map.on('movestart', moveStart, this);\r\n\t\t\tthis._map.on('moveend', showMarker, this);\r\n\t\t\tthis.on('animationend', showMarker, this);\r\n\t\t\tlayer.__parent.zoomToBounds();\r\n\r\n\t\t\tif (moveStart) {\r\n\t\t\t\t//Never started moving, must already be there, probably need clustering however\r\n\t\t\t\tshowMarker.call(this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t//Overrides FeatureGroup.onAdd\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tvar i, l, layer;\r\n\r\n\t\tif (!isFinite(this._map.getMaxZoom())) {\r\n\t\t\tthrow \"Map has no maxZoom specified\";\r\n\t\t}\r\n\r\n\t\tthis._featureGroup.onAdd(map);\r\n\t\tthis._nonPointGroup.onAdd(map);\r\n\r\n\t\tif (!this._gridClusters) {\r\n\t\t\tthis._generateInitialClusters();\r\n\t\t}\r\n\r\n\t\tfor (i = 0, l = this._needsRemoving.length; i < l; i++) {\r\n\t\t\tlayer = this._needsRemoving[i];\r\n\t\t\tthis._removeLayer(layer, true);\r\n\t\t}\r\n\t\tthis._needsRemoving = [];\r\n\r\n\t\t//Remember the current zoom level and bounds\r\n\t\tthis._zoom = this._map.getZoom();\r\n\t\tthis._currentShownBounds = this._getExpandedVisibleBounds();\r\n\r\n\t\tthis._map.on('zoomend', this._zoomEnd, this);\r\n\t\tthis._map.on('moveend', this._moveEnd, this);\r\n\r\n\t\tif (this._spiderfierOnAdd) { //TODO FIXME: Not sure how to have spiderfier add something on here nicely\r\n\t\t\tthis._spiderfierOnAdd();\r\n\t\t}\r\n\r\n\t\tthis._bindEvents();\r\n\r\n\t\t//Actually add our markers to the map:\r\n\t\tl = this._needsClustering;\r\n\t\tthis._needsClustering = [];\r\n\t\tthis.addLayers(l);\r\n\t},\r\n\r\n\t//Overrides FeatureGroup.onRemove\r\n\tonRemove: function (map) {\r\n\t\tmap.off('zoomend', this._zoomEnd, this);\r\n\t\tmap.off('moveend', this._moveEnd, this);\r\n\r\n\t\tthis._unbindEvents();\r\n\r\n\t\t//In case we are in a cluster animation\r\n\t\tthis._map._mapPane.className = this._map._mapPane.className.replace(' leaflet-cluster-anim', '');\r\n\r\n\t\tif (this._spiderfierOnRemove) { //TODO FIXME: Not sure how to have spiderfier add something on here nicely\r\n\t\t\tthis._spiderfierOnRemove();\r\n\t\t}\r\n\r\n\r\n\r\n\t\t//Clean up all the layers we added to the map\r\n\t\tthis._hideCoverage();\r\n\t\tthis._featureGroup.onRemove(map);\r\n\t\tthis._nonPointGroup.onRemove(map);\r\n\r\n\t\tthis._featureGroup.clearLayers();\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tgetVisibleParent: function (marker) {\r\n\t\tvar vMarker = marker;\r\n\t\twhile (vMarker && !vMarker._icon) {\r\n\t\t\tvMarker = vMarker.__parent;\r\n\t\t}\r\n\t\treturn vMarker || null;\r\n\t},\r\n\r\n\t//Remove the given object from the given array\r\n\t_arraySplice: function (anArray, obj) {\r\n\t\tfor (var i = anArray.length - 1; i >= 0; i--) {\r\n\t\t\tif (anArray[i] === obj) {\r\n\t\t\t\tanArray.splice(i, 1);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t//Internal function for removing a marker from everything.\r\n\t//dontUpdateMap: set to true if you will handle updating the map manually (for bulk functions)\r\n\t_removeLayer: function (marker, removeFromDistanceGrid, dontUpdateMap) {\r\n\t\tvar gridClusters = this._gridClusters,\r\n\t\t\tgridUnclustered = this._gridUnclustered,\r\n\t\t\tfg = this._featureGroup,\r\n\t\t\tmap = this._map;\r\n\r\n\t\t//Remove the marker from distance clusters it might be in\r\n\t\tif (removeFromDistanceGrid) {\r\n\t\t\tfor (var z = this._maxZoom; z >= 0; z--) {\r\n\t\t\t\tif (!gridUnclustered[z].removeObject(marker, map.project(marker.getLatLng(), z))) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Work our way up the clusters removing them as we go if required\r\n\t\tvar cluster = marker.__parent,\r\n\t\t\tmarkers = cluster._markers,\r\n\t\t\totherMarker;\r\n\r\n\t\t//Remove the marker from the immediate parents marker list\r\n\t\tthis._arraySplice(markers, marker);\r\n\r\n\t\twhile (cluster) {\r\n\t\t\tcluster._childCount--;\r\n\r\n\t\t\tif (cluster._zoom < 0) {\r\n\t\t\t\t//Top level, do nothing\r\n\t\t\t\tbreak;\r\n\t\t\t} else if (removeFromDistanceGrid && cluster._childCount <= 1) { //Cluster no longer required\r\n\t\t\t\t//We need to push the other marker up to the parent\r\n\t\t\t\totherMarker = cluster._markers[0] === marker ? cluster._markers[1] : cluster._markers[0];\r\n\r\n\t\t\t\t//Update distance grid\r\n\t\t\t\tgridClusters[cluster._zoom].removeObject(cluster, map.project(cluster._cLatLng, cluster._zoom));\r\n\t\t\t\tgridUnclustered[cluster._zoom].addObject(otherMarker, map.project(otherMarker.getLatLng(), cluster._zoom));\r\n\r\n\t\t\t\t//Move otherMarker up to parent\r\n\t\t\t\tthis._arraySplice(cluster.__parent._childClusters, cluster);\r\n\t\t\t\tcluster.__parent._markers.push(otherMarker);\r\n\t\t\t\totherMarker.__parent = cluster.__parent;\r\n\r\n\t\t\t\tif (cluster._icon) {\r\n\t\t\t\t\t//Cluster is currently on the map, need to put the marker on the map instead\r\n\t\t\t\t\tfg.removeLayer(cluster);\r\n\t\t\t\t\tif (!dontUpdateMap) {\r\n\t\t\t\t\t\tfg.addLayer(otherMarker);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcluster._recalculateBounds();\r\n\t\t\t\tif (!dontUpdateMap || !cluster._icon) {\r\n\t\t\t\t\tcluster._updateIcon();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcluster = cluster.__parent;\r\n\t\t}\r\n\r\n\t\tdelete marker.__parent;\r\n\t},\r\n\r\n\t_isOrIsParent: function (el, oel) {\r\n\t\twhile (oel) {\r\n\t\t\tif (el === oel) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\toel = oel.parentNode;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\tif (e.layer instanceof L.MarkerCluster) {\r\n\t\t\t//Prevent multiple clustermouseover/off events if the icon is made up of stacked divs (Doesn't work in ie <= 8, no relatedTarget)\r\n\t\t\tif (e.originalEvent && this._isOrIsParent(e.layer._icon, e.originalEvent.relatedTarget)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\te.type = 'cluster' + e.type;\r\n\t\t}\r\n\r\n\t\tthis.fire(e.type, e);\r\n\t},\r\n\r\n\t//Default functionality\r\n\t_defaultIconCreateFunction: function (cluster) {\r\n\t\tvar childCount = cluster.getChildCount();\r\n\r\n\t\tvar c = ' marker-cluster-';\r\n\t\tif (childCount < 10) {\r\n\t\t\tc += 'small';\r\n\t\t} else if (childCount < 100) {\r\n\t\t\tc += 'medium';\r\n\t\t} else {\r\n\t\t\tc += 'large';\r\n\t\t}\r\n\r\n\t\treturn new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(40, 40) });\r\n\t},\r\n\r\n\t_bindEvents: function () {\r\n\t\tvar map = this._map,\r\n\t\t    spiderfyOnMaxZoom = this.options.spiderfyOnMaxZoom,\r\n\t\t    showCoverageOnHover = this.options.showCoverageOnHover,\r\n\t\t    zoomToBoundsOnClick = this.options.zoomToBoundsOnClick;\r\n\r\n\t\t//Zoom on cluster click or spiderfy if we are at the lowest level\r\n\t\tif (spiderfyOnMaxZoom || zoomToBoundsOnClick) {\r\n\t\t\tthis.on('clusterclick', this._zoomOrSpiderfy, this);\r\n\t\t}\r\n\r\n\t\t//Show convex hull (boundary) polygon on mouse over\r\n\t\tif (showCoverageOnHover) {\r\n\t\t\tthis.on('clustermouseover', this._showCoverage, this);\r\n\t\t\tthis.on('clustermouseout', this._hideCoverage, this);\r\n\t\t\tmap.on('zoomend', this._hideCoverage, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_zoomOrSpiderfy: function (e) {\r\n\t\tvar map = this._map;\r\n\t\tif (e.layer._bounds._northEast.equals(e.layer._bounds._southWest)) {\r\n\t\t\tif (this.options.spiderfyOnMaxZoom) {\r\n\t\t\t\te.layer.spiderfy();\r\n\t\t\t}\r\n\t\t} else if (map.getMaxZoom() === map.getZoom()) {\r\n\t\t\tif (this.options.spiderfyOnMaxZoom) {\r\n\t\t\t\te.layer.spiderfy();\r\n\t\t\t}\r\n\t\t} else if (this.options.zoomToBoundsOnClick) {\r\n\t\t\te.layer.zoomToBounds();\r\n\t\t}\r\n\r\n\t\t// Focus the map again for keyboard users.\r\n\t\tif (e.originalEvent && e.originalEvent.keyCode === 13) {\r\n\t\t\tmap._container.focus();\r\n\t\t}\r\n\t},\r\n\r\n\t_showCoverage: function (e) {\r\n\t\tvar map = this._map;\r\n\t\tif (this._inZoomAnimation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._shownPolygon) {\r\n\t\t\tmap.removeLayer(this._shownPolygon);\r\n\t\t}\r\n\t\tif (e.layer.getChildCount() > 2 && e.layer !== this._spiderfied) {\r\n\t\t\tthis._shownPolygon = new L.Polygon(e.layer.getConvexHull(), this.options.polygonOptions);\r\n\t\t\tmap.addLayer(this._shownPolygon);\r\n\t\t}\r\n\t},\r\n\r\n\t_hideCoverage: function () {\r\n\t\tif (this._shownPolygon) {\r\n\t\t\tthis._map.removeLayer(this._shownPolygon);\r\n\t\t\tthis._shownPolygon = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_unbindEvents: function () {\r\n\t\tvar spiderfyOnMaxZoom = this.options.spiderfyOnMaxZoom,\r\n\t\t\tshowCoverageOnHover = this.options.showCoverageOnHover,\r\n\t\t\tzoomToBoundsOnClick = this.options.zoomToBoundsOnClick,\r\n\t\t\tmap = this._map;\r\n\r\n\t\tif (spiderfyOnMaxZoom || zoomToBoundsOnClick) {\r\n\t\t\tthis.off('clusterclick', this._zoomOrSpiderfy, this);\r\n\t\t}\r\n\t\tif (showCoverageOnHover) {\r\n\t\t\tthis.off('clustermouseover', this._showCoverage, this);\r\n\t\t\tthis.off('clustermouseout', this._hideCoverage, this);\r\n\t\t\tmap.off('zoomend', this._hideCoverage, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_zoomEnd: function () {\r\n\t\tif (!this._map) { //May have been removed from the map by a zoomEnd handler\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._mergeSplitClusters();\r\n\r\n\t\tthis._zoom = this._map._zoom;\r\n\t\tthis._currentShownBounds = this._getExpandedVisibleBounds();\r\n\t},\r\n\r\n\t_moveEnd: function () {\r\n\t\tif (this._inZoomAnimation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar newBounds = this._getExpandedVisibleBounds();\r\n\r\n\t\tthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, this._zoom, newBounds);\r\n\t\tthis._topClusterLevel._recursivelyAddChildrenToMap(null, this._map._zoom, newBounds);\r\n\r\n\t\tthis._currentShownBounds = newBounds;\r\n\t\treturn;\r\n\t},\r\n\r\n\t_generateInitialClusters: function () {\r\n\t\tvar maxZoom = this._map.getMaxZoom(),\r\n\t\t\tradius = this.options.maxClusterRadius,\r\n\t\t\tradiusFn = radius;\r\n\t\r\n\t\t//If we just set maxClusterRadius to a single number, we need to create\r\n\t\t//a simple function to return that number. Otherwise, we just have to\r\n\t\t//use the function we've passed in.\r\n\t\tif (typeof radius !== \"function\") {\r\n\t\t\tradiusFn = function () { return radius; };\r\n\t\t}\r\n\r\n\t\tif (this.options.disableClusteringAtZoom) {\r\n\t\t\tmaxZoom = this.options.disableClusteringAtZoom - 1;\r\n\t\t}\r\n\t\tthis._maxZoom = maxZoom;\r\n\t\tthis._gridClusters = {};\r\n\t\tthis._gridUnclustered = {};\r\n\t\r\n\t\t//Set up DistanceGrids for each zoom\r\n\t\tfor (var zoom = maxZoom; zoom >= 0; zoom--) {\r\n\t\t\tthis._gridClusters[zoom] = new L.DistanceGrid(radiusFn(zoom));\r\n\t\t\tthis._gridUnclustered[zoom] = new L.DistanceGrid(radiusFn(zoom));\r\n\t\t}\r\n\r\n\t\tthis._topClusterLevel = new L.MarkerCluster(this, -1);\r\n\t},\r\n\r\n\t//Zoom: Zoom to start adding at (Pass this._maxZoom to start at the bottom)\r\n\t_addLayer: function (layer, zoom) {\r\n\t\tvar gridClusters = this._gridClusters,\r\n\t\t    gridUnclustered = this._gridUnclustered,\r\n\t\t    markerPoint, z;\r\n\r\n\t\tif (this.options.singleMarkerMode) {\r\n\t\t\tlayer.options.icon = this.options.iconCreateFunction({\r\n\t\t\t\tgetChildCount: function () {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t},\r\n\t\t\t\tgetAllChildMarkers: function () {\r\n\t\t\t\t\treturn [layer];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//Find the lowest zoom level to slot this one in\r\n\t\tfor (; zoom >= 0; zoom--) {\r\n\t\t\tmarkerPoint = this._map.project(layer.getLatLng(), zoom); // calculate pixel position\r\n\r\n\t\t\t//Try find a cluster close by\r\n\t\t\tvar closest = gridClusters[zoom].getNearObject(markerPoint);\r\n\t\t\tif (closest) {\r\n\t\t\t\tclosest._addChild(layer);\r\n\t\t\t\tlayer.__parent = closest;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//Try find a marker close by to form a new cluster with\r\n\t\t\tclosest = gridUnclustered[zoom].getNearObject(markerPoint);\r\n\t\t\tif (closest) {\r\n\t\t\t\tvar parent = closest.__parent;\r\n\t\t\t\tif (parent) {\r\n\t\t\t\t\tthis._removeLayer(closest, false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//Create new cluster with these 2 in it\r\n\r\n\t\t\t\tvar newCluster = new L.MarkerCluster(this, zoom, closest, layer);\r\n\t\t\t\tgridClusters[zoom].addObject(newCluster, this._map.project(newCluster._cLatLng, zoom));\r\n\t\t\t\tclosest.__parent = newCluster;\r\n\t\t\t\tlayer.__parent = newCluster;\r\n\r\n\t\t\t\t//First create any new intermediate parent clusters that don't exist\r\n\t\t\t\tvar lastParent = newCluster;\r\n\t\t\t\tfor (z = zoom - 1; z > parent._zoom; z--) {\r\n\t\t\t\t\tlastParent = new L.MarkerCluster(this, z, lastParent);\r\n\t\t\t\t\tgridClusters[z].addObject(lastParent, this._map.project(closest.getLatLng(), z));\r\n\t\t\t\t}\r\n\t\t\t\tparent._addChild(lastParent);\r\n\r\n\t\t\t\t//Remove closest from this zoom level and any above that it is in, replace with newCluster\r\n\t\t\t\tfor (z = zoom; z >= 0; z--) {\r\n\t\t\t\t\tif (!gridUnclustered[z].removeObject(closest, this._map.project(closest.getLatLng(), z))) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//Didn't manage to cluster in at this zoom, record us as a marker here and continue upwards\r\n\t\t\tgridUnclustered[zoom].addObject(layer, markerPoint);\r\n\t\t}\r\n\r\n\t\t//Didn't get in anything, add us to the top\r\n\t\tthis._topClusterLevel._addChild(layer);\r\n\t\tlayer.__parent = this._topClusterLevel;\r\n\t\treturn;\r\n\t},\r\n\r\n\t//Enqueue code to fire after the marker expand/contract has happened\r\n\t_enqueue: function (fn) {\r\n\t\tthis._queue.push(fn);\r\n\t\tif (!this._queueTimeout) {\r\n\t\t\tthis._queueTimeout = setTimeout(L.bind(this._processQueue, this), 300);\r\n\t\t}\r\n\t},\r\n\t_processQueue: function () {\r\n\t\tfor (var i = 0; i < this._queue.length; i++) {\r\n\t\t\tthis._queue[i].call(this);\r\n\t\t}\r\n\t\tthis._queue.length = 0;\r\n\t\tclearTimeout(this._queueTimeout);\r\n\t\tthis._queueTimeout = null;\r\n\t},\r\n\r\n\t//Merge and split any existing clusters that are too big or small\r\n\t_mergeSplitClusters: function () {\r\n\r\n\t\t//Incase we are starting to split before the animation finished\r\n\t\tthis._processQueue();\r\n\r\n\t\tif (this._zoom < this._map._zoom && this._currentShownBounds.intersects(this._getExpandedVisibleBounds())) { //Zoom in, split\r\n\t\t\tthis._animationStart();\r\n\t\t\t//Remove clusters now off screen\r\n\t\t\tthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, this._zoom, this._getExpandedVisibleBounds());\r\n\r\n\t\t\tthis._animationZoomIn(this._zoom, this._map._zoom);\r\n\r\n\t\t} else if (this._zoom > this._map._zoom) { //Zoom out, merge\r\n\t\t\tthis._animationStart();\r\n\r\n\t\t\tthis._animationZoomOut(this._zoom, this._map._zoom);\r\n\t\t} else {\r\n\t\t\tthis._moveEnd();\r\n\t\t}\r\n\t},\r\n\r\n\t//Gets the maps visible bounds expanded in each direction by the size of the screen (so the user cannot see an area we do not cover in one pan)\r\n\t_getExpandedVisibleBounds: function () {\r\n\t\tif (!this.options.removeOutsideVisibleBounds) {\r\n\t\t\treturn this._map.getBounds();\r\n\t\t}\r\n\r\n\t\tvar map = this._map,\r\n\t\t\tbounds = map.getBounds(),\r\n\t\t\tsw = bounds._southWest,\r\n\t\t\tne = bounds._northEast,\r\n\t\t\tlatDiff = L.Browser.mobile ? 0 : Math.abs(sw.lat - ne.lat),\r\n\t\t\tlngDiff = L.Browser.mobile ? 0 : Math.abs(sw.lng - ne.lng);\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t\tnew L.LatLng(sw.lat - latDiff, sw.lng - lngDiff, true),\r\n\t\t\tnew L.LatLng(ne.lat + latDiff, ne.lng + lngDiff, true));\r\n\t},\r\n\r\n\t//Shared animation code\r\n\t_animationAddLayerNonAnimated: function (layer, newCluster) {\r\n\t\tif (newCluster === layer) {\r\n\t\t\tthis._featureGroup.addLayer(layer);\r\n\t\t} else if (newCluster._childCount === 2) {\r\n\t\t\tnewCluster._addToMap();\r\n\r\n\t\t\tvar markers = newCluster.getAllChildMarkers();\r\n\t\t\tthis._featureGroup.removeLayer(markers[0]);\r\n\t\t\tthis._featureGroup.removeLayer(markers[1]);\r\n\t\t} else {\r\n\t\t\tnewCluster._updateIcon();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.MarkerClusterGroup.include(!L.DomUtil.TRANSITION ? {\r\n\r\n\t//Non Animated versions of everything\r\n\t_animationStart: function () {\r\n\t\t//Do nothing...\r\n\t},\r\n\t_animationZoomIn: function (previousZoomLevel, newZoomLevel) {\r\n\t\tthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel);\r\n\t\tthis._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());\r\n\r\n\t\t//We didn't actually animate, but we use this event to mean \"clustering animations have finished\"\r\n\t\tthis.fire('animationend');\r\n\t},\r\n\t_animationZoomOut: function (previousZoomLevel, newZoomLevel) {\r\n\t\tthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel);\r\n\t\tthis._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());\r\n\r\n\t\t//We didn't actually animate, but we use this event to mean \"clustering animations have finished\"\r\n\t\tthis.fire('animationend');\r\n\t},\r\n\t_animationAddLayer: function (layer, newCluster) {\r\n\t\tthis._animationAddLayerNonAnimated(layer, newCluster);\r\n\t}\r\n} : {\r\n\r\n\t//Animated versions here\r\n\t_animationStart: function () {\r\n\t\tthis._map._mapPane.className += ' leaflet-cluster-anim';\r\n\t\tthis._inZoomAnimation++;\r\n\t},\r\n\t_animationEnd: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map._mapPane.className = this._map._mapPane.className.replace(' leaflet-cluster-anim', '');\r\n\t\t}\r\n\t\tthis._inZoomAnimation--;\r\n\t\tthis.fire('animationend');\r\n\t},\r\n\t_animationZoomIn: function (previousZoomLevel, newZoomLevel) {\r\n\t\tvar bounds = this._getExpandedVisibleBounds(),\r\n\t\t    fg = this._featureGroup,\r\n\t\t    i;\r\n\r\n\t\t//Add all children of current clusters to map and remove those clusters from map\r\n\t\tthis._topClusterLevel._recursively(bounds, previousZoomLevel, 0, function (c) {\r\n\t\t\tvar startPos = c._latlng,\r\n\t\t\t\tmarkers = c._markers,\r\n\t\t\t\tm;\r\n\r\n\t\t\tif (!bounds.contains(startPos)) {\r\n\t\t\t\tstartPos = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (c._isSingleParent() && previousZoomLevel + 1 === newZoomLevel) { //Immediately add the new child and remove us\r\n\t\t\t\tfg.removeLayer(c);\r\n\t\t\t\tc._recursivelyAddChildrenToMap(null, newZoomLevel, bounds);\r\n\t\t\t} else {\r\n\t\t\t\t//Fade out old cluster\r\n\t\t\t\tc.clusterHide();\r\n\t\t\t\tc._recursivelyAddChildrenToMap(startPos, newZoomLevel, bounds);\r\n\t\t\t}\r\n\r\n\t\t\t//Remove all markers that aren't visible any more\r\n\t\t\t//TODO: Do we actually need to do this on the higher levels too?\r\n\t\t\tfor (i = markers.length - 1; i >= 0; i--) {\r\n\t\t\t\tm = markers[i];\r\n\t\t\t\tif (!bounds.contains(m._latlng)) {\r\n\t\t\t\t\tfg.removeLayer(m);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\tthis._forceLayout();\r\n\r\n\t\t//Update opacities\r\n\t\tthis._topClusterLevel._recursivelyBecomeVisible(bounds, newZoomLevel);\r\n\t\t//TODO Maybe? Update markers in _recursivelyBecomeVisible\r\n\t\tfg.eachLayer(function (n) {\r\n\t\t\tif (!(n instanceof L.MarkerCluster) && n._icon) {\r\n\t\t\t\tn.clusterShow();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//update the positions of the just added clusters/markers\r\n\t\tthis._topClusterLevel._recursively(bounds, previousZoomLevel, newZoomLevel, function (c) {\r\n\t\t\tc._recursivelyRestoreChildPositions(newZoomLevel);\r\n\t\t});\r\n\r\n\t\t//Remove the old clusters and close the zoom animation\r\n\t\tthis._enqueue(function () {\r\n\t\t\t//update the positions of the just added clusters/markers\r\n\t\t\tthis._topClusterLevel._recursively(bounds, previousZoomLevel, 0, function (c) {\r\n\t\t\t\tfg.removeLayer(c);\r\n\t\t\t\tc.clusterShow();\r\n\t\t\t});\r\n\r\n\t\t\tthis._animationEnd();\r\n\t\t});\r\n\t},\r\n\r\n\t_animationZoomOut: function (previousZoomLevel, newZoomLevel) {\r\n\t\tthis._animationZoomOutSingle(this._topClusterLevel, previousZoomLevel - 1, newZoomLevel);\r\n\r\n\t\t//Need to add markers for those that weren't on the map before but are now\r\n\t\tthis._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());\r\n\t\t//Remove markers that were on the map before but won't be now\r\n\t\tthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel, this._getExpandedVisibleBounds());\r\n\t},\r\n\t_animationZoomOutSingle: function (cluster, previousZoomLevel, newZoomLevel) {\r\n\t\tvar bounds = this._getExpandedVisibleBounds();\r\n\r\n\t\t//Animate all of the markers in the clusters to move to their cluster center point\r\n\t\tcluster._recursivelyAnimateChildrenInAndAddSelfToMap(bounds, previousZoomLevel + 1, newZoomLevel);\r\n\r\n\t\tvar me = this;\r\n\r\n\t\t//Update the opacity (If we immediately set it they won't animate)\r\n\t\tthis._forceLayout();\r\n\t\tcluster._recursivelyBecomeVisible(bounds, newZoomLevel);\r\n\r\n\t\t//TODO: Maybe use the transition timing stuff to make this more reliable\r\n\t\t//When the animations are done, tidy up\r\n\t\tthis._enqueue(function () {\r\n\r\n\t\t\t//This cluster stopped being a cluster before the timeout fired\r\n\t\t\tif (cluster._childCount === 1) {\r\n\t\t\t\tvar m = cluster._markers[0];\r\n\t\t\t\t//If we were in a cluster animation at the time then the opacity and position of our child could be wrong now, so fix it\r\n\t\t\t\tm.setLatLng(m.getLatLng());\r\n\t\t\t\tif (m.clusterShow) {\r\n\t\t\t\t\tm.clusterShow();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcluster._recursively(bounds, newZoomLevel, 0, function (c) {\r\n\t\t\t\t\tc._recursivelyRemoveChildrenFromMap(bounds, previousZoomLevel + 1);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tme._animationEnd();\r\n\t\t});\r\n\t},\r\n\t_animationAddLayer: function (layer, newCluster) {\r\n\t\tvar me = this,\r\n\t\t\tfg = this._featureGroup;\r\n\r\n\t\tfg.addLayer(layer);\r\n\t\tif (newCluster !== layer) {\r\n\t\t\tif (newCluster._childCount > 2) { //Was already a cluster\r\n\r\n\t\t\t\tnewCluster._updateIcon();\r\n\t\t\t\tthis._forceLayout();\r\n\t\t\t\tthis._animationStart();\r\n\r\n\t\t\t\tlayer._setPos(this._map.latLngToLayerPoint(newCluster.getLatLng()));\r\n\t\t\t\tlayer.clusterHide();\r\n\r\n\t\t\t\tthis._enqueue(function () {\r\n\t\t\t\t\tfg.removeLayer(layer);\r\n\t\t\t\t\tlayer.clusterShow();\r\n\r\n\t\t\t\t\tme._animationEnd();\r\n\t\t\t\t});\r\n\r\n\t\t\t} else { //Just became a cluster\r\n\t\t\t\tthis._forceLayout();\r\n\r\n\t\t\t\tme._animationStart();\r\n\t\t\t\tme._animationZoomOutSingle(newCluster, this._map.getMaxZoom(), this._map.getZoom());\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t//Force a browser layout of stuff in the map\r\n\t// Should apply the current opacity and location to all elements so we can update them again for an animation\r\n\t_forceLayout: function () {\r\n\t\t//In my testing this works, infact offsetWidth of any element seems to work.\r\n\t\t//Could loop all this._layers and do this for each _icon if it stops working\r\n\r\n\t\tL.Util.falseFn(document.body.offsetWidth);\r\n\t}\r\n});\r\n\r\nL.markerClusterGroup = function (options) {\r\n\treturn new L.MarkerClusterGroup(options);\r\n};\r\n\r\n\r\nL.MarkerCluster = L.Marker.extend({\r\n\tinitialize: function (group, zoom, a, b) {\r\n\r\n\t\tL.Marker.prototype.initialize.call(this, a ? (a._cLatLng || a.getLatLng()) : new L.LatLng(0, 0), { icon: this });\r\n\r\n\r\n\t\tthis._group = group;\r\n\t\tthis._zoom = zoom;\r\n\r\n\t\tthis._markers = [];\r\n\t\tthis._childClusters = [];\r\n\t\tthis._childCount = 0;\r\n\t\tthis._iconNeedsUpdate = true;\r\n\r\n\t\tthis._bounds = new L.LatLngBounds();\r\n\r\n\t\tif (a) {\r\n\t\t\tthis._addChild(a);\r\n\t\t}\r\n\t\tif (b) {\r\n\t\t\tthis._addChild(b);\r\n\t\t}\r\n\t},\r\n\r\n\t//Recursively retrieve all child markers of this cluster\r\n\tgetAllChildMarkers: function (storageArray) {\r\n\t\tstorageArray = storageArray || [];\r\n\r\n\t\tfor (var i = this._childClusters.length - 1; i >= 0; i--) {\r\n\t\t\tthis._childClusters[i].getAllChildMarkers(storageArray);\r\n\t\t}\r\n\r\n\t\tfor (var j = this._markers.length - 1; j >= 0; j--) {\r\n\t\t\tstorageArray.push(this._markers[j]);\r\n\t\t}\r\n\r\n\t\treturn storageArray;\r\n\t},\r\n\r\n\t//Returns the count of how many child markers we have\r\n\tgetChildCount: function () {\r\n\t\treturn this._childCount;\r\n\t},\r\n\r\n\t//Zoom to the minimum of showing all of the child markers, or the extents of this cluster\r\n\tzoomToBounds: function () {\r\n\t\tvar childClusters = this._childClusters.slice(),\r\n\t\t\tmap = this._group._map,\r\n\t\t\tboundsZoom = map.getBoundsZoom(this._bounds),\r\n\t\t\tzoom = this._zoom + 1,\r\n\t\t\tmapZoom = map.getZoom(),\r\n\t\t\ti;\r\n\r\n\t\t//calculate how far we need to zoom down to see all of the markers\r\n\t\twhile (childClusters.length > 0 && boundsZoom > zoom) {\r\n\t\t\tzoom++;\r\n\t\t\tvar newClusters = [];\r\n\t\t\tfor (i = 0; i < childClusters.length; i++) {\r\n\t\t\t\tnewClusters = newClusters.concat(childClusters[i]._childClusters);\r\n\t\t\t}\r\n\t\t\tchildClusters = newClusters;\r\n\t\t}\r\n\r\n\t\tif (boundsZoom > zoom) {\r\n\t\t\tthis._group._map.setView(this._latlng, zoom);\r\n\t\t} else if (boundsZoom <= mapZoom) { //If fitBounds wouldn't zoom us down, zoom us down instead\r\n\t\t\tthis._group._map.setView(this._latlng, mapZoom + 1);\r\n\t\t} else {\r\n\t\t\tthis._group._map.fitBounds(this._bounds);\r\n\t\t}\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\t\tbounds.extend(this._bounds);\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t_updateIcon: function () {\r\n\t\tthis._iconNeedsUpdate = true;\r\n\t\tif (this._icon) {\r\n\t\t\tthis.setIcon(this);\r\n\t\t}\r\n\t},\r\n\r\n\t//Cludge for Icon, we pretend to be an icon for performance\r\n\tcreateIcon: function () {\r\n\t\tif (this._iconNeedsUpdate) {\r\n\t\t\tthis._iconObj = this._group.options.iconCreateFunction(this);\r\n\t\t\tthis._iconNeedsUpdate = false;\r\n\t\t}\r\n\t\treturn this._iconObj.createIcon();\r\n\t},\r\n\tcreateShadow: function () {\r\n\t\treturn this._iconObj.createShadow();\r\n\t},\r\n\r\n\r\n\t_addChild: function (new1, isNotificationFromChild) {\r\n\r\n\t\tthis._iconNeedsUpdate = true;\r\n\t\tthis._expandBounds(new1);\r\n\r\n\t\tif (new1 instanceof L.MarkerCluster) {\r\n\t\t\tif (!isNotificationFromChild) {\r\n\t\t\t\tthis._childClusters.push(new1);\r\n\t\t\t\tnew1.__parent = this;\r\n\t\t\t}\r\n\t\t\tthis._childCount += new1._childCount;\r\n\t\t} else {\r\n\t\t\tif (!isNotificationFromChild) {\r\n\t\t\t\tthis._markers.push(new1);\r\n\t\t\t}\r\n\t\t\tthis._childCount++;\r\n\t\t}\r\n\r\n\t\tif (this.__parent) {\r\n\t\t\tthis.__parent._addChild(new1, true);\r\n\t\t}\r\n\t},\r\n\r\n\t//Expand our bounds and tell our parent to\r\n\t_expandBounds: function (marker) {\r\n\t\tvar addedCount,\r\n\t\t    addedLatLng = marker._wLatLng || marker._latlng;\r\n\r\n\t\tif (marker instanceof L.MarkerCluster) {\r\n\t\t\tthis._bounds.extend(marker._bounds);\r\n\t\t\taddedCount = marker._childCount;\r\n\t\t} else {\r\n\t\t\tthis._bounds.extend(addedLatLng);\r\n\t\t\taddedCount = 1;\r\n\t\t}\r\n\r\n\t\tif (!this._cLatLng) {\r\n\t\t\t// when clustering, take position of the first point as the cluster center\r\n\t\t\tthis._cLatLng = marker._cLatLng || addedLatLng;\r\n\t\t}\r\n\r\n\t\t// when showing clusters, take weighted average of all points as cluster center\r\n\t\tvar totalCount = this._childCount + addedCount;\r\n\r\n\t\t//Calculate weighted latlng for display\r\n\t\tif (!this._wLatLng) {\r\n\t\t\tthis._latlng = this._wLatLng = new L.LatLng(addedLatLng.lat, addedLatLng.lng);\r\n\t\t} else {\r\n\t\t\tthis._wLatLng.lat = (addedLatLng.lat * addedCount + this._wLatLng.lat * this._childCount) / totalCount;\r\n\t\t\tthis._wLatLng.lng = (addedLatLng.lng * addedCount + this._wLatLng.lng * this._childCount) / totalCount;\r\n\t\t}\r\n\t},\r\n\r\n\t//Set our markers position as given and add it to the map\r\n\t_addToMap: function (startPos) {\r\n\t\tif (startPos) {\r\n\t\t\tthis._backupLatlng = this._latlng;\r\n\t\t\tthis.setLatLng(startPos);\r\n\t\t}\r\n\t\tthis._group._featureGroup.addLayer(this);\r\n\t},\r\n\r\n\t_recursivelyAnimateChildrenIn: function (bounds, center, maxZoom) {\r\n\t\tthis._recursively(bounds, 0, maxZoom - 1,\r\n\t\t\tfunction (c) {\r\n\t\t\t\tvar markers = c._markers,\r\n\t\t\t\t\ti, m;\r\n\t\t\t\tfor (i = markers.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tm = markers[i];\r\n\r\n\t\t\t\t\t//Only do it if the icon is still on the map\r\n\t\t\t\t\tif (m._icon) {\r\n\t\t\t\t\t\tm._setPos(center);\r\n\t\t\t\t\t\tm.clusterHide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfunction (c) {\r\n\t\t\t\tvar childClusters = c._childClusters,\r\n\t\t\t\t\tj, cm;\r\n\t\t\t\tfor (j = childClusters.length - 1; j >= 0; j--) {\r\n\t\t\t\t\tcm = childClusters[j];\r\n\t\t\t\t\tif (cm._icon) {\r\n\t\t\t\t\t\tcm._setPos(center);\r\n\t\t\t\t\t\tcm.clusterHide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t_recursivelyAnimateChildrenInAndAddSelfToMap: function (bounds, previousZoomLevel, newZoomLevel) {\r\n\t\tthis._recursively(bounds, newZoomLevel, 0,\r\n\t\t\tfunction (c) {\r\n\t\t\t\tc._recursivelyAnimateChildrenIn(bounds, c._group._map.latLngToLayerPoint(c.getLatLng()).round(), previousZoomLevel);\r\n\r\n\t\t\t\t//TODO: depthToAnimateIn affects _isSingleParent, if there is a multizoom we may/may not be.\r\n\t\t\t\t//As a hack we only do a animation free zoom on a single level zoom, if someone does multiple levels then we always animate\r\n\t\t\t\tif (c._isSingleParent() && previousZoomLevel - 1 === newZoomLevel) {\r\n\t\t\t\t\tc.clusterShow();\r\n\t\t\t\t\tc._recursivelyRemoveChildrenFromMap(bounds, previousZoomLevel); //Immediately remove our children as we are replacing them. TODO previousBounds not bounds\r\n\t\t\t\t} else {\r\n\t\t\t\t\tc.clusterHide();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tc._addToMap();\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t_recursivelyBecomeVisible: function (bounds, zoomLevel) {\r\n\t\tthis._recursively(bounds, 0, zoomLevel, null, function (c) {\r\n\t\t\tc.clusterShow();\r\n\t\t});\r\n\t},\r\n\r\n\t_recursivelyAddChildrenToMap: function (startPos, zoomLevel, bounds) {\r\n\t\tthis._recursively(bounds, -1, zoomLevel,\r\n\t\t\tfunction (c) {\r\n\t\t\t\tif (zoomLevel === c._zoom) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//Add our child markers at startPos (so they can be animated out)\r\n\t\t\t\tfor (var i = c._markers.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tvar nm = c._markers[i];\r\n\r\n\t\t\t\t\tif (!bounds.contains(nm._latlng)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (startPos) {\r\n\t\t\t\t\t\tnm._backupLatlng = nm.getLatLng();\r\n\r\n\t\t\t\t\t\tnm.setLatLng(startPos);\r\n\t\t\t\t\t\tif (nm.clusterHide) {\r\n\t\t\t\t\t\t\tnm.clusterHide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tc._group._featureGroup.addLayer(nm);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfunction (c) {\r\n\t\t\t\tc._addToMap(startPos);\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t_recursivelyRestoreChildPositions: function (zoomLevel) {\r\n\t\t//Fix positions of child markers\r\n\t\tfor (var i = this._markers.length - 1; i >= 0; i--) {\r\n\t\t\tvar nm = this._markers[i];\r\n\t\t\tif (nm._backupLatlng) {\r\n\t\t\t\tnm.setLatLng(nm._backupLatlng);\r\n\t\t\t\tdelete nm._backupLatlng;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (zoomLevel - 1 === this._zoom) {\r\n\t\t\t//Reposition child clusters\r\n\t\t\tfor (var j = this._childClusters.length - 1; j >= 0; j--) {\r\n\t\t\t\tthis._childClusters[j]._restorePosition();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (var k = this._childClusters.length - 1; k >= 0; k--) {\r\n\t\t\t\tthis._childClusters[k]._recursivelyRestoreChildPositions(zoomLevel);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_restorePosition: function () {\r\n\t\tif (this._backupLatlng) {\r\n\t\t\tthis.setLatLng(this._backupLatlng);\r\n\t\t\tdelete this._backupLatlng;\r\n\t\t}\r\n\t},\r\n\r\n\t//exceptBounds: If set, don't remove any markers/clusters in it\r\n\t_recursivelyRemoveChildrenFromMap: function (previousBounds, zoomLevel, exceptBounds) {\r\n\t\tvar m, i;\r\n\t\tthis._recursively(previousBounds, -1, zoomLevel - 1,\r\n\t\t\tfunction (c) {\r\n\t\t\t\t//Remove markers at every level\r\n\t\t\t\tfor (i = c._markers.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tm = c._markers[i];\r\n\t\t\t\t\tif (!exceptBounds || !exceptBounds.contains(m._latlng)) {\r\n\t\t\t\t\t\tc._group._featureGroup.removeLayer(m);\r\n\t\t\t\t\t\tif (m.clusterShow) {\r\n\t\t\t\t\t\t\tm.clusterShow();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfunction (c) {\r\n\t\t\t\t//Remove child clusters at just the bottom level\r\n\t\t\t\tfor (i = c._childClusters.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tm = c._childClusters[i];\r\n\t\t\t\t\tif (!exceptBounds || !exceptBounds.contains(m._latlng)) {\r\n\t\t\t\t\t\tc._group._featureGroup.removeLayer(m);\r\n\t\t\t\t\t\tif (m.clusterShow) {\r\n\t\t\t\t\t\t\tm.clusterShow();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t//Run the given functions recursively to this and child clusters\r\n\t// boundsToApplyTo: a L.LatLngBounds representing the bounds of what clusters to recurse in to\r\n\t// zoomLevelToStart: zoom level to start running functions (inclusive)\r\n\t// zoomLevelToStop: zoom level to stop running functions (inclusive)\r\n\t// runAtEveryLevel: function that takes an L.MarkerCluster as an argument that should be applied on every level\r\n\t// runAtBottomLevel: function that takes an L.MarkerCluster as an argument that should be applied at only the bottom level\r\n\t_recursively: function (boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel) {\r\n\t\tvar childClusters = this._childClusters,\r\n\t\t    zoom = this._zoom,\r\n\t\t    i, c;\r\n\r\n\t\tif (zoomLevelToStart > zoom) { //Still going down to required depth, just recurse to child clusters\r\n\t\t\tfor (i = childClusters.length - 1; i >= 0; i--) {\r\n\t\t\t\tc = childClusters[i];\r\n\t\t\t\tif (boundsToApplyTo.intersects(c._bounds)) {\r\n\t\t\t\t\tc._recursively(boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else { //In required depth\r\n\r\n\t\t\tif (runAtEveryLevel) {\r\n\t\t\t\trunAtEveryLevel(this);\r\n\t\t\t}\r\n\t\t\tif (runAtBottomLevel && this._zoom === zoomLevelToStop) {\r\n\t\t\t\trunAtBottomLevel(this);\r\n\t\t\t}\r\n\r\n\t\t\t//TODO: This loop is almost the same as above\r\n\t\t\tif (zoomLevelToStop > zoom) {\r\n\t\t\t\tfor (i = childClusters.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tc = childClusters[i];\r\n\t\t\t\t\tif (boundsToApplyTo.intersects(c._bounds)) {\r\n\t\t\t\t\t\tc._recursively(boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_recalculateBounds: function () {\r\n\t\tvar markers = this._markers,\r\n\t\t\tchildClusters = this._childClusters,\r\n\t\t\ti;\r\n\r\n\t\tthis._bounds = new L.LatLngBounds();\r\n\t\tdelete this._wLatLng;\r\n\r\n\t\tfor (i = markers.length - 1; i >= 0; i--) {\r\n\t\t\tthis._expandBounds(markers[i]);\r\n\t\t}\r\n\t\tfor (i = childClusters.length - 1; i >= 0; i--) {\r\n\t\t\tthis._expandBounds(childClusters[i]);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t//Returns true if we are the parent of only one cluster and that cluster is the same as us\r\n\t_isSingleParent: function () {\r\n\t\t//Don't need to check this._markers as the rest won't work if there are any\r\n\t\treturn this._childClusters.length > 0 && this._childClusters[0]._childCount === this._childCount;\r\n\t}\r\n});\r\n\r\n\r\n\r\n/*\r\n* Extends L.Marker to include two extra methods: clusterHide and clusterShow.\r\n* \r\n* They work as setOpacity(0) and setOpacity(1) respectively, but\r\n* they will remember the marker's opacity when hiding and showing it again.\r\n* \r\n*/\r\n\r\n\r\nL.Marker.include({\r\n\t\r\n\tclusterHide: function () {\r\n\t\tthis.options.opacityWhenUnclustered = this.options.opacity || 1;\r\n\t\treturn this.setOpacity(0);\r\n\t},\r\n\t\r\n\tclusterShow: function () {\r\n\t\tvar ret = this.setOpacity(this.options.opacity || this.options.opacityWhenUnclustered);\r\n\t\tdelete this.options.opacityWhenUnclustered;\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n});\r\n\r\n\r\n\r\n\r\n\r\nL.DistanceGrid = function (cellSize) {\r\n\tthis._cellSize = cellSize;\r\n\tthis._sqCellSize = cellSize * cellSize;\r\n\tthis._grid = {};\r\n\tthis._objectPoint = { };\r\n};\r\n\r\nL.DistanceGrid.prototype = {\r\n\r\n\taddObject: function (obj, point) {\r\n\t\tvar x = this._getCoord(point.x),\r\n\t\t    y = this._getCoord(point.y),\r\n\t\t    grid = this._grid,\r\n\t\t    row = grid[y] = grid[y] || {},\r\n\t\t    cell = row[x] = row[x] || [],\r\n\t\t    stamp = L.Util.stamp(obj);\r\n\r\n\t\tthis._objectPoint[stamp] = point;\r\n\r\n\t\tcell.push(obj);\r\n\t},\r\n\r\n\tupdateObject: function (obj, point) {\r\n\t\tthis.removeObject(obj);\r\n\t\tthis.addObject(obj, point);\r\n\t},\r\n\r\n\t//Returns true if the object was found\r\n\tremoveObject: function (obj, point) {\r\n\t\tvar x = this._getCoord(point.x),\r\n\t\t    y = this._getCoord(point.y),\r\n\t\t    grid = this._grid,\r\n\t\t    row = grid[y] = grid[y] || {},\r\n\t\t    cell = row[x] = row[x] || [],\r\n\t\t    i, len;\r\n\r\n\t\tdelete this._objectPoint[L.Util.stamp(obj)];\r\n\r\n\t\tfor (i = 0, len = cell.length; i < len; i++) {\r\n\t\t\tif (cell[i] === obj) {\r\n\r\n\t\t\t\tcell.splice(i, 1);\r\n\r\n\t\t\t\tif (len === 1) {\r\n\t\t\t\t\tdelete row[x];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\teachObject: function (fn, context) {\r\n\t\tvar i, j, k, len, row, cell, removed,\r\n\t\t    grid = this._grid;\r\n\r\n\t\tfor (i in grid) {\r\n\t\t\trow = grid[i];\r\n\r\n\t\t\tfor (j in row) {\r\n\t\t\t\tcell = row[j];\r\n\r\n\t\t\t\tfor (k = 0, len = cell.length; k < len; k++) {\r\n\t\t\t\t\tremoved = fn.call(context, cell[k]);\r\n\t\t\t\t\tif (removed) {\r\n\t\t\t\t\t\tk--;\r\n\t\t\t\t\t\tlen--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tgetNearObject: function (point) {\r\n\t\tvar x = this._getCoord(point.x),\r\n\t\t    y = this._getCoord(point.y),\r\n\t\t    i, j, k, row, cell, len, obj, dist,\r\n\t\t    objectPoint = this._objectPoint,\r\n\t\t    closestDistSq = this._sqCellSize,\r\n\t\t    closest = null;\r\n\r\n\t\tfor (i = y - 1; i <= y + 1; i++) {\r\n\t\t\trow = this._grid[i];\r\n\t\t\tif (row) {\r\n\r\n\t\t\t\tfor (j = x - 1; j <= x + 1; j++) {\r\n\t\t\t\t\tcell = row[j];\r\n\t\t\t\t\tif (cell) {\r\n\r\n\t\t\t\t\t\tfor (k = 0, len = cell.length; k < len; k++) {\r\n\t\t\t\t\t\t\tobj = cell[k];\r\n\t\t\t\t\t\t\tdist = this._sqDist(objectPoint[L.Util.stamp(obj)], point);\r\n\t\t\t\t\t\t\tif (dist < closestDistSq) {\r\n\t\t\t\t\t\t\t\tclosestDistSq = dist;\r\n\t\t\t\t\t\t\t\tclosest = obj;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest;\r\n\t},\r\n\r\n\t_getCoord: function (x) {\r\n\t\treturn Math.floor(x / this._cellSize);\r\n\t},\r\n\r\n\t_sqDist: function (p, p2) {\r\n\t\tvar dx = p2.x - p.x,\r\n\t\t    dy = p2.y - p.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\t}\r\n};\r\n\r\n\r\n/* Copyright (c) 2012 the authors listed at the following URL, and/or\r\nthe authors of referenced articles or incorporated external code:\r\nhttp://en.literateprograms.org/Quickhull_(Javascript)?action=history&offset=20120410175256\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining\r\na copy of this software and associated documentation files (the\r\n\"Software\"), to deal in the Software without restriction, including\r\nwithout limitation the rights to use, copy, modify, merge, publish,\r\ndistribute, sublicense, and/or sell copies of the Software, and to\r\npermit persons to whom the Software is furnished to do so, subject to\r\nthe following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be\r\nincluded in all copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\r\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\r\nIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\r\nCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\r\nTORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\nSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n\r\nRetrieved from: http://en.literateprograms.org/Quickhull_(Javascript)?oldid=18434\r\n*/\r\n\r\n(function () {\r\n\tL.QuickHull = {\r\n\r\n\t\t/*\r\n\t\t * @param {Object} cpt a point to be measured from the baseline\r\n\t\t * @param {Array} bl the baseline, as represented by a two-element\r\n\t\t *   array of latlng objects.\r\n\t\t * @returns {Number} an approximate distance measure\r\n\t\t */\r\n\t\tgetDistant: function (cpt, bl) {\r\n\t\t\tvar vY = bl[1].lat - bl[0].lat,\r\n\t\t\t\tvX = bl[0].lng - bl[1].lng;\r\n\t\t\treturn (vX * (cpt.lat - bl[0].lat) + vY * (cpt.lng - bl[0].lng));\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t * @param {Array} baseLine a two-element array of latlng objects\r\n\t\t *   representing the baseline to project from\r\n\t\t * @param {Array} latLngs an array of latlng objects\r\n\t\t * @returns {Object} the maximum point and all new points to stay\r\n\t\t *   in consideration for the hull.\r\n\t\t */\r\n\t\tfindMostDistantPointFromBaseLine: function (baseLine, latLngs) {\r\n\t\t\tvar maxD = 0,\r\n\t\t\t\tmaxPt = null,\r\n\t\t\t\tnewPoints = [],\r\n\t\t\t\ti, pt, d;\r\n\r\n\t\t\tfor (i = latLngs.length - 1; i >= 0; i--) {\r\n\t\t\t\tpt = latLngs[i];\r\n\t\t\t\td = this.getDistant(pt, baseLine);\r\n\r\n\t\t\t\tif (d > 0) {\r\n\t\t\t\t\tnewPoints.push(pt);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (d > maxD) {\r\n\t\t\t\t\tmaxD = d;\r\n\t\t\t\t\tmaxPt = pt;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn { maxPoint: maxPt, newPoints: newPoints };\r\n\t\t},\r\n\r\n\r\n\t\t/*\r\n\t\t * Given a baseline, compute the convex hull of latLngs as an array\r\n\t\t * of latLngs.\r\n\t\t *\r\n\t\t * @param {Array} latLngs\r\n\t\t * @returns {Array}\r\n\t\t */\r\n\t\tbuildConvexHull: function (baseLine, latLngs) {\r\n\t\t\tvar convexHullBaseLines = [],\r\n\t\t\t\tt = this.findMostDistantPointFromBaseLine(baseLine, latLngs);\r\n\r\n\t\t\tif (t.maxPoint) { // if there is still a point \"outside\" the base line\r\n\t\t\t\tconvexHullBaseLines =\r\n\t\t\t\t\tconvexHullBaseLines.concat(\r\n\t\t\t\t\t\tthis.buildConvexHull([baseLine[0], t.maxPoint], t.newPoints)\r\n\t\t\t\t\t);\r\n\t\t\t\tconvexHullBaseLines =\r\n\t\t\t\t\tconvexHullBaseLines.concat(\r\n\t\t\t\t\t\tthis.buildConvexHull([t.maxPoint, baseLine[1]], t.newPoints)\r\n\t\t\t\t\t);\r\n\t\t\t\treturn convexHullBaseLines;\r\n\t\t\t} else {  // if there is no more point \"outside\" the base line, the current base line is part of the convex hull\r\n\t\t\t\treturn [baseLine[0]];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t * Given an array of latlngs, compute a convex hull as an array\r\n\t\t * of latlngs\r\n\t\t *\r\n\t\t * @param {Array} latLngs\r\n\t\t * @returns {Array}\r\n\t\t */\r\n\t\tgetConvexHull: function (latLngs) {\r\n\t\t\t// find first baseline\r\n\t\t\tvar maxLat = false, minLat = false,\r\n\t\t\t\tmaxPt = null, minPt = null,\r\n\t\t\t\ti;\r\n\r\n\t\t\tfor (i = latLngs.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar pt = latLngs[i];\r\n\t\t\t\tif (maxLat === false || pt.lat >= maxLat) {\r\n\t\t\t\t\tmaxPt = pt;\r\n\t\t\t\t\tmaxLat = pt.lat;\r\n\t\t\t\t}\r\n\t\t\t\tif (minLat === false || pt.lat < minLat) {\r\n\t\t\t\t\tminPt = pt;\r\n\t\t\t\t\tminLat = pt.lat;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar ch = [].concat(this.buildConvexHull([minPt, maxPt], latLngs),\r\n\t\t\t\t\t\t\t\tthis.buildConvexHull([maxPt, minPt], latLngs));\r\n\t\t\treturn ch;\r\n\t\t}\r\n\t};\r\n}());\r\n\r\nL.MarkerCluster.include({\r\n\tgetConvexHull: function () {\r\n\t\tvar childMarkers = this.getAllChildMarkers(),\r\n\t\t\tpoints = [],\r\n\t\t\tp, i;\r\n\r\n\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\tp = childMarkers[i].getLatLng();\r\n\t\t\tpoints.push(p);\r\n\t\t}\r\n\r\n\t\treturn L.QuickHull.getConvexHull(points);\r\n\t}\r\n});\r\n\r\n\r\n//This code is 100% based on https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet\r\n//Huge thanks to jawj for implementing it first to make my job easy :-)\r\n\r\nL.MarkerCluster.include({\r\n\r\n\t_2PI: Math.PI * 2,\r\n\t_circleFootSeparation: 25, //related to circumference of circle\r\n\t_circleStartAngle: Math.PI / 6,\r\n\r\n\t_spiralFootSeparation:  28, //related to size of spiral (experiment!)\r\n\t_spiralLengthStart: 11,\r\n\t_spiralLengthFactor: 5,\r\n\r\n\t_circleSpiralSwitchover: 9, //show spiral instead of circle from this marker count upwards.\r\n\t\t\t\t\t\t\t\t// 0 -> always spiral; Infinity -> always circle\r\n\r\n\tspiderfy: function () {\r\n\t\tif (this._group._spiderfied === this || this._group._inZoomAnimation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar childMarkers = this.getAllChildMarkers(),\r\n\t\t\tgroup = this._group,\r\n\t\t\tmap = group._map,\r\n\t\t\tcenter = map.latLngToLayerPoint(this._latlng),\r\n\t\t\tpositions;\r\n\r\n\t\tthis._group._unspiderfy();\r\n\t\tthis._group._spiderfied = this;\r\n\r\n\t\t//TODO Maybe: childMarkers order by distance to center\r\n\r\n\t\tif (childMarkers.length >= this._circleSpiralSwitchover) {\r\n\t\t\tpositions = this._generatePointsSpiral(childMarkers.length, center);\r\n\t\t} else {\r\n\t\t\tcenter.y += 10; //Otherwise circles look wrong\r\n\t\t\tpositions = this._generatePointsCircle(childMarkers.length, center);\r\n\t\t}\r\n\r\n\t\tthis._animationSpiderfy(childMarkers, positions);\r\n\t},\r\n\r\n\tunspiderfy: function (zoomDetails) {\r\n\t\t/// <param Name=\"zoomDetails\">Argument from zoomanim if being called in a zoom animation or null otherwise</param>\r\n\t\tif (this._group._inZoomAnimation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._animationUnspiderfy(zoomDetails);\r\n\r\n\t\tthis._group._spiderfied = null;\r\n\t},\r\n\r\n\t_generatePointsCircle: function (count, centerPt) {\r\n\t\tvar circumference = this._group.options.spiderfyDistanceMultiplier * this._circleFootSeparation * (2 + count),\r\n\t\t\tlegLength = circumference / this._2PI,  //radius from circumference\r\n\t\t\tangleStep = this._2PI / count,\r\n\t\t\tres = [],\r\n\t\t\ti, angle;\r\n\r\n\t\tres.length = count;\r\n\r\n\t\tfor (i = count - 1; i >= 0; i--) {\r\n\t\t\tangle = this._circleStartAngle + i * angleStep;\r\n\t\t\tres[i] = new L.Point(centerPt.x + legLength * Math.cos(angle), centerPt.y + legLength * Math.sin(angle))._round();\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_generatePointsSpiral: function (count, centerPt) {\r\n\t\tvar legLength = this._group.options.spiderfyDistanceMultiplier * this._spiralLengthStart,\r\n\t\t\tseparation = this._group.options.spiderfyDistanceMultiplier * this._spiralFootSeparation,\r\n\t\t\tlengthFactor = this._group.options.spiderfyDistanceMultiplier * this._spiralLengthFactor,\r\n\t\t\tangle = 0,\r\n\t\t\tres = [],\r\n\t\t\ti;\r\n\r\n\t\tres.length = count;\r\n\r\n\t\tfor (i = count - 1; i >= 0; i--) {\r\n\t\t\tangle += separation / legLength + i * 0.0005;\r\n\t\t\tres[i] = new L.Point(centerPt.x + legLength * Math.cos(angle), centerPt.y + legLength * Math.sin(angle))._round();\r\n\t\t\tlegLength += this._2PI * lengthFactor / angle;\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_noanimationUnspiderfy: function () {\r\n\t\tvar group = this._group,\r\n\t\t\tmap = group._map,\r\n\t\t\tfg = group._featureGroup,\r\n\t\t\tchildMarkers = this.getAllChildMarkers(),\r\n\t\t\tm, i;\r\n\r\n\t\tthis.setOpacity(1);\r\n\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\tm = childMarkers[i];\r\n\r\n\t\t\tfg.removeLayer(m);\r\n\r\n\t\t\tif (m._preSpiderfyLatlng) {\r\n\t\t\t\tm.setLatLng(m._preSpiderfyLatlng);\r\n\t\t\t\tdelete m._preSpiderfyLatlng;\r\n\t\t\t}\r\n\t\t\tif (m.setZIndexOffset) {\r\n\t\t\t\tm.setZIndexOffset(0);\r\n\t\t\t}\r\n\r\n\t\t\tif (m._spiderLeg) {\r\n\t\t\t\tmap.removeLayer(m._spiderLeg);\r\n\t\t\t\tdelete m._spiderLeg;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgroup._spiderfied = null;\r\n\t}\r\n});\r\n\r\nL.MarkerCluster.include(!L.DomUtil.TRANSITION ? {\r\n\t//Non Animated versions of everything\r\n\t_animationSpiderfy: function (childMarkers, positions) {\r\n\t\tvar group = this._group,\r\n\t\t\tmap = group._map,\r\n\t\t\tfg = group._featureGroup,\r\n\t\t\ti, m, leg, newPos;\r\n\r\n\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\tnewPos = map.layerPointToLatLng(positions[i]);\r\n\t\t\tm = childMarkers[i];\r\n\r\n\t\t\tm._preSpiderfyLatlng = m._latlng;\r\n\t\t\tm.setLatLng(newPos);\r\n\t\t\tif (m.setZIndexOffset) {\r\n\t\t\t\tm.setZIndexOffset(1000000); //Make these appear on top of EVERYTHING\r\n\t\t\t}\r\n\r\n\t\t\tfg.addLayer(m);\r\n\r\n\t\t\tvar legOptions = this._group.options.spiderLegPolylineOptions;\r\n\t\t\tleg = new L.Polyline([this._latlng, newPos], legOptions);\r\n\t\t\tmap.addLayer(leg);\r\n\t\t\tm._spiderLeg = leg;\r\n\t\t}\r\n\t\tthis.setOpacity(0.3);\r\n\t\tgroup.fire('spiderfied');\r\n\t},\r\n\r\n\t_animationUnspiderfy: function () {\r\n\t\tthis._noanimationUnspiderfy();\r\n\t}\r\n} : {\r\n\t//Animated versions here\r\n\tSVG_ANIMATION: (function () {\r\n\t\treturn document.createElementNS('http://www.w3.org/2000/svg', 'animate').toString().indexOf('SVGAnimate') > -1;\r\n\t}()),\r\n\r\n\t_animationSpiderfy: function (childMarkers, positions) {\r\n\t\tvar me = this,\r\n\t\t\tgroup = this._group,\r\n\t\t\tmap = group._map,\r\n\t\t\tfg = group._featureGroup,\r\n\t\t\tthisLayerPos = map.latLngToLayerPoint(this._latlng),\r\n\t\t\ti, m, leg, newPos;\r\n\r\n\t\t//Add markers to map hidden at our center point\r\n\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\tm = childMarkers[i];\r\n\r\n\t\t\t//If it is a marker, add it now and we'll animate it out\r\n\t\t\tif (m.setOpacity) {\r\n\t\t\t\tm.setZIndexOffset(1000000); //Make these appear on top of EVERYTHING\r\n\t\t\t\tm.clusterHide();\r\n\t\t\t\r\n\t\t\t\tfg.addLayer(m);\r\n\r\n\t\t\t\tm._setPos(thisLayerPos);\r\n\t\t\t} else {\r\n\t\t\t\t//Vectors just get immediately added\r\n\t\t\t\tfg.addLayer(m);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgroup._forceLayout();\r\n\t\tgroup._animationStart();\r\n\r\n\t\tvar initialLegOpacity = L.Path.SVG ? 0 : 0.3,\r\n\t\t\txmlns = L.Path.SVG_NS;\r\n\r\n\r\n\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\tnewPos = map.layerPointToLatLng(positions[i]);\r\n\t\t\tm = childMarkers[i];\r\n\r\n\t\t\t//Move marker to new position\r\n\t\t\tm._preSpiderfyLatlng = m._latlng;\r\n\t\t\tm.setLatLng(newPos);\r\n\t\t\t\r\n\t\t\tif (m.setOpacity) {\r\n\t\t\t\tm.clusterShow();\r\n\t\t\t}\r\n\r\n\r\n\t\t\t//Add Legs.\r\n\t\t\tvar legOptions = this._group.options.spiderLegPolylineOptions;\r\n\t\t\tif (legOptions.opacity === undefined) {\r\n\t\t\t\tlegOptions.opacity = initialLegOpacity;\r\n\t\t\t}\r\n\t\t\tleg = new L.Polyline([me._latlng, newPos], legOptions);\r\n\t\t\tmap.addLayer(leg);\r\n\t\t\tm._spiderLeg = leg;\r\n\r\n\t\t\t//Following animations don't work for canvas\r\n\t\t\tif (!L.Path.SVG || !this.SVG_ANIMATION) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t//How this works:\r\n\t\t\t//http://stackoverflow.com/questions/5924238/how-do-you-animate-an-svg-path-in-ios\r\n\t\t\t//http://dev.opera.com/articles/view/advanced-svg-animation-techniques/\r\n\r\n\t\t\t//Animate length\r\n\t\t\tvar length = leg._path.getTotalLength();\r\n\t\t\tleg._path.setAttribute(\"stroke-dasharray\", length + \",\" + length);\r\n\r\n\t\t\tvar anim = document.createElementNS(xmlns, \"animate\");\r\n\t\t\tanim.setAttribute(\"attributeName\", \"stroke-dashoffset\");\r\n\t\t\tanim.setAttribute(\"begin\", \"indefinite\");\r\n\t\t\tanim.setAttribute(\"from\", length);\r\n\t\t\tanim.setAttribute(\"to\", 0);\r\n\t\t\tanim.setAttribute(\"dur\", 0.25);\r\n\t\t\tleg._path.appendChild(anim);\r\n\t\t\tanim.beginElement();\r\n\r\n\t\t\t//Animate opacity\r\n\t\t\tanim = document.createElementNS(xmlns, \"animate\");\r\n\t\t\tanim.setAttribute(\"attributeName\", \"stroke-opacity\");\r\n\t\t\tanim.setAttribute(\"attributeName\", \"stroke-opacity\");\r\n\t\t\tanim.setAttribute(\"begin\", \"indefinite\");\r\n\t\t\tanim.setAttribute(\"from\", 0);\r\n\t\t\tanim.setAttribute(\"to\", 0.5);\r\n\t\t\tanim.setAttribute(\"dur\", 0.25);\r\n\t\t\tleg._path.appendChild(anim);\r\n\t\t\tanim.beginElement();\r\n\t\t}\r\n\t\tme.setOpacity(0.3);\r\n\r\n\t\t//Set the opacity of the spiderLegs back to their correct value\r\n\t\t// The animations above override this until they complete.\r\n\t\t// If the initial opacity of the spiderlegs isn't 0 then they appear before the animation starts.\r\n\t\tif (L.Path.SVG) {\r\n\t\t\tthis._group._forceLayout();\r\n\r\n\t\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\t\tm = childMarkers[i]._spiderLeg;\r\n\r\n\t\t\t\tm.options.opacity = 0.5;\r\n\t\t\t\tm._path.setAttribute('stroke-opacity', 0.5);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\tgroup._animationEnd();\r\n\t\t\tgroup.fire('spiderfied');\r\n\t\t}, 200);\r\n\t},\r\n\r\n\t_animationUnspiderfy: function (zoomDetails) {\r\n\t\tvar group = this._group,\r\n\t\t\tmap = group._map,\r\n\t\t\tfg = group._featureGroup,\r\n\t\t\tthisLayerPos = zoomDetails ? map._latLngToNewLayerPoint(this._latlng, zoomDetails.zoom, zoomDetails.center) : map.latLngToLayerPoint(this._latlng),\r\n\t\t\tchildMarkers = this.getAllChildMarkers(),\r\n\t\t\tsvg = L.Path.SVG && this.SVG_ANIMATION,\r\n\t\t\tm, i, a;\r\n\r\n\t\tgroup._animationStart();\r\n\r\n\t\t//Make us visible and bring the child markers back in\r\n\t\tthis.setOpacity(1);\r\n\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\tm = childMarkers[i];\r\n\r\n\t\t\t//Marker was added to us after we were spidified\r\n\t\t\tif (!m._preSpiderfyLatlng) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t//Fix up the location to the real one\r\n\t\t\tm.setLatLng(m._preSpiderfyLatlng);\r\n\t\t\tdelete m._preSpiderfyLatlng;\r\n\t\t\t//Hack override the location to be our center\r\n\t\t\tif (m.setOpacity) {\r\n\t\t\t\tm._setPos(thisLayerPos);\r\n\t\t\t\tm.clusterHide();\r\n\t\t\t} else {\r\n\t\t\t\tfg.removeLayer(m);\r\n\t\t\t}\r\n\r\n\t\t\t//Animate the spider legs back in\r\n\t\t\tif (svg) {\r\n\t\t\t\ta = m._spiderLeg._path.childNodes[0];\r\n\t\t\t\ta.setAttribute('to', a.getAttribute('from'));\r\n\t\t\t\ta.setAttribute('from', 0);\r\n\t\t\t\ta.beginElement();\r\n\r\n\t\t\t\ta = m._spiderLeg._path.childNodes[1];\r\n\t\t\t\ta.setAttribute('from', 0.5);\r\n\t\t\t\ta.setAttribute('to', 0);\r\n\t\t\t\ta.setAttribute('stroke-opacity', 0);\r\n\t\t\t\ta.beginElement();\r\n\r\n\t\t\t\tm._spiderLeg._path.setAttribute('stroke-opacity', 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\t//If we have only <= one child left then that marker will be shown on the map so don't remove it!\r\n\t\t\tvar stillThereChildCount = 0;\r\n\t\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\t\tm = childMarkers[i];\r\n\t\t\t\tif (m._spiderLeg) {\r\n\t\t\t\t\tstillThereChildCount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor (i = childMarkers.length - 1; i >= 0; i--) {\r\n\t\t\t\tm = childMarkers[i];\r\n\r\n\t\t\t\tif (!m._spiderLeg) { //Has already been unspiderfied\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif (m.setOpacity) {\r\n\t\t\t\t\tm.clusterShow();\r\n\t\t\t\t\tm.setZIndexOffset(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (stillThereChildCount > 1) {\r\n\t\t\t\t\tfg.removeLayer(m);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmap.removeLayer(m._spiderLeg);\r\n\t\t\t\tdelete m._spiderLeg;\r\n\t\t\t}\r\n\t\t\tgroup._animationEnd();\r\n\t\t}, 200);\r\n\t}\r\n});\r\n\r\n\r\nL.MarkerClusterGroup.include({\r\n\t//The MarkerCluster currently spiderfied (if any)\r\n\t_spiderfied: null,\r\n\r\n\t_spiderfierOnAdd: function () {\r\n\t\tthis._map.on('click', this._unspiderfyWrapper, this);\r\n\r\n\t\tif (this._map.options.zoomAnimation) {\r\n\t\t\tthis._map.on('zoomstart', this._unspiderfyZoomStart, this);\r\n\t\t}\r\n\t\t//Browsers without zoomAnimation or a big zoom don't fire zoomstart\r\n\t\tthis._map.on('zoomend', this._noanimationUnspiderfy, this);\r\n\r\n\t\tif (L.Path.SVG && !L.Browser.touch) {\r\n\t\t\tthis._map._initPathRoot();\r\n\t\t\t//Needs to happen in the pageload, not after, or animations don't work in webkit\r\n\t\t\t//  http://stackoverflow.com/questions/8455200/svg-animate-with-dynamically-added-elements\r\n\t\t\t//Disable on touch browsers as the animation messes up on a touch zoom and isn't very noticable\r\n\t\t}\r\n\t},\r\n\r\n\t_spiderfierOnRemove: function () {\r\n\t\tthis._map.off('click', this._unspiderfyWrapper, this);\r\n\t\tthis._map.off('zoomstart', this._unspiderfyZoomStart, this);\r\n\t\tthis._map.off('zoomanim', this._unspiderfyZoomAnim, this);\r\n\r\n\t\tthis._unspiderfy(); //Ensure that markers are back where they should be\r\n\t},\r\n\r\n\r\n\t//On zoom start we add a zoomanim handler so that we are guaranteed to be last (after markers are animated)\r\n\t//This means we can define the animation they do rather than Markers doing an animation to their actual location\r\n\t_unspiderfyZoomStart: function () {\r\n\t\tif (!this._map) { //May have been removed from the map by a zoomEnd handler\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._map.on('zoomanim', this._unspiderfyZoomAnim, this);\r\n\t},\r\n\t_unspiderfyZoomAnim: function (zoomDetails) {\r\n\t\t//Wait until the first zoomanim after the user has finished touch-zooming before running the animation\r\n\t\tif (L.DomUtil.hasClass(this._map._mapPane, 'leaflet-touching')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._map.off('zoomanim', this._unspiderfyZoomAnim, this);\r\n\t\tthis._unspiderfy(zoomDetails);\r\n\t},\r\n\r\n\r\n\t_unspiderfyWrapper: function () {\r\n\t\t/// <summary>_unspiderfy but passes no arguments</summary>\r\n\t\tthis._unspiderfy();\r\n\t},\r\n\r\n\t_unspiderfy: function (zoomDetails) {\r\n\t\tif (this._spiderfied) {\r\n\t\t\tthis._spiderfied.unspiderfy(zoomDetails);\r\n\t\t}\r\n\t},\r\n\r\n\t_noanimationUnspiderfy: function () {\r\n\t\tif (this._spiderfied) {\r\n\t\t\tthis._spiderfied._noanimationUnspiderfy();\r\n\t\t}\r\n\t},\r\n\r\n\t//If the given layer is currently being spiderfied then we unspiderfy it so it isn't on the map anymore etc\r\n\t_unspiderfyLayer: function (layer) {\r\n\t\tif (layer._spiderLeg) {\r\n\t\t\tthis._featureGroup.removeLayer(layer);\r\n\r\n\t\t\tlayer.setOpacity(1);\r\n\t\t\t//Position will be fixed up immediately in _animationUnspiderfy\r\n\t\t\tlayer.setZIndexOffset(0);\r\n\r\n\t\t\tthis._map.removeLayer(layer._spiderLeg);\r\n\t\t\tdelete layer._spiderLeg;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n}(window, document));","/* global emp */\r\n\r\n/*\r\n * This file should be moved to emp-map core so it does not have to be\r\n * recoded or copied to each map engine.\r\n */\r\n\r\nemp.typeLibrary.utils = emp.typeLibrary.utils || {};\r\n\r\nemp.typeLibrary.utils.icon = {\r\n    offsetUnit: {\r\n        FRACTION: 'fraction',\r\n        PIXEL: 'pixels',\r\n        INSETPIXELS: 'insetpixels'\r\n    },\r\n    calculateOffset: function(iIconSize, sOffset, sOffsetType)\r\n    {\r\n        var iOffset = 0;\r\n        var iOffsetValue;\r\n        var dFraction;\r\n\r\n        switch (sOffsetType.toLowerCase())\r\n        {\r\n            case emp.typeLibrary.utils.icon.offsetUnit.FRACTION:\r\n                dFraction = parseFloat(sOffset);\r\n                iOffset = Math.floor(iIconSize * dFraction);\r\n                break;\r\n            case emp.typeLibrary.utils.icon.offsetUnit.PIXEL:\r\n                iOffsetValue = parseInt(sOffset);\r\n                iOffset = iOffsetValue;\r\n                break;\r\n            case emp.typeLibrary.utils.icon.offsetUnit.INSETPIXELS:\r\n                iOffsetValue = parseInt(sOffset);\r\n                iOffset = iIconSize - iOffsetValue;\r\n                break;\r\n        }\r\n\r\n        return iOffset;\r\n    }\r\n};\r\n\r\n\r\n","/* global leafLet */\r\n\r\nif (window.leafLet === undefined)\r\n{\r\n    leafLet = {};\r\n}\r\nleafLet.typeLibrary = {};\r\nleafLet.editor = {};\r\nleafLet.typeLibrary.airspace = {};\r\nleafLet.internalPrivateClass = {};\r\n\r\nleafLet.typeLibrary.objectType = {\r\n    OVERLAY: \"overlay\",\r\n    FEATURE: \"feature\",\r\n    WMS: \"wms\",\r\n    LL_CONTROL: 'leafletControl',\r\n    LL_DEFAULT_MAP: 'leafletDefaultMap'\r\n};\r\n\r\nleafLet.typeLibrary.featureType = leafLet.typeLibrary.featureType || {};\r\nleafLet.typeLibrary.featureType.AOI = 'aoi';","/* global L, emp, LatLon, leafLet */\r\nL.LEAFLET_DEFAULT_LINE_COLOR = '#0033ff';\r\nL.LEAFLET_DEFAULT_LINE_WEIGHT = 5;\r\n\r\nL.LatLng.fromEmpLatLon = function (oEmpLatLon) {\r\n    return new L.LatLng(oEmpLatLon._lat, oEmpLatLon._lon);\r\n};\r\n\r\nL.LatLng.prototype.toEmpLatLon = function () {\r\n    return new LatLon(this.lat, this.lng);\r\n};\r\n\r\nL.LatLng.prototype.distanceTo = function (oCoord) {\r\n    var oThis = this.toEmpLatLon();\r\n    var oThat = oCoord.toEmpLatLon();\r\n\r\n    return oThis.distanceTo(oThat) * 1000.0;\r\n};\r\n\r\nL.LatLng.prototype.bearingTo = function (oCoord) {\r\n    var oThis = this.toEmpLatLon();\r\n    var oThat = oCoord.toEmpLatLon();\r\n\r\n    return oThis.bearingTo(oThat);\r\n};\r\n\r\nL.LatLng.prototype.destinationPoint = function (brng, dist) {\r\n    var oThis = this.toEmpLatLon();\r\n    var oThat = oThis.destinationPoint(brng, dist / 1000.0);\r\n\r\n    return new L.LatLng(oThat._lat, oThat._lon, this.alt);\r\n};\r\n\r\nL.LatLng.prototype.moveCoordinate = function (brng, dist) {\r\n    var oThis = this.toEmpLatLon();\r\n    var oThat = oThis.destinationPoint(brng, dist / 1000.0);\r\n\r\n    this.lat = oThat._lat;\r\n    this.lng = oThat._lon;\r\n};\r\n\r\nL.LatLng.prototype.intersectLines = function (dBrng1, oCoord2, dBrng2) {\r\n    var oThis = this.toEmpLatLon();\r\n    var oThat = oCoord2.toEmpLatLon();\r\n    var oResult = undefined;\r\n\r\n    try {\r\n        oResult = LatLon.intersection(oThis, dBrng1, oThat, dBrng2);\r\n    } catch (error) {\r\n    }\r\n\r\n    if (oResult) {\r\n        return new L.LatLng(oResult._lat, oResult._lon);\r\n    }\r\n\r\n    return oResult;\r\n};\r\n\r\nL.LatLng.prototype.wrap = function (a, b) { // (Number, Number) -> LatLng\r\n    var lng = this.lng;\r\n\r\n    a = a || -180;\r\n    b = b || 180;\r\n\r\n    lng = (lng + b) % (b - a) + (lng < a || lng === b ? b : a);\r\n\r\n    return new L.LatLng(this.lat, lng, this.alt);\r\n};\r\n\r\nL.LatLng.prototype.midPointTo = function (oCoord) {\r\n    var dBrng = this.bearingTo(oCoord);\r\n    var dDist = this.distanceTo(oCoord) / 2.0;\r\n\r\n    return this.destinationPoint(dBrng, dDist);\r\n};\r\n\r\nL.LatLng.prototype.pointAtFractionOfDistanceTo = function (oCoord, dFraction) {\r\n    var dBrng = this.bearingTo(oCoord);\r\n    var dDist = this.distanceTo(oCoord) * dFraction;\r\n\r\n    return this.destinationPoint(dBrng, dDist);\r\n};\r\n\r\nL.LatLng.prototype.pointAt3QtrDistanceTo = function (oCoord) {\r\n    var dBrng = this.bearingTo(oCoord);\r\n    var dDist = this.distanceTo(oCoord) * 0.75;\r\n\r\n    return this.destinationPoint(dBrng, dDist);\r\n};\r\n\r\nleafLet.internalPrivateClass.EmpIcon = function () {\r\n    var publicInterface = {\r\n        createIcon: function (oldIcon) {\r\n            var oThis = this;\r\n            var img = this._createIcon('icon');\r\n\r\n            this.options.oIconImag = img;\r\n\r\n            img.onload = function () {\r\n                var i = img;\r\n                this.style.width = i.width + 'px';\r\n                this.style.height = i.height + 'px';\r\n                oThis._applyAnchorRef();\r\n                this.style.display = '';\r\n            };\r\n\r\n            img.onerror = function () {\r\n                var oDefaultIcon = emp.utilities.icon.getDefaultIcon(oThis.options.basePath);\r\n\r\n                oThis.options.iconSize = new L.Point(oDefaultIcon.size.width, oDefaultIcon.size.height);\r\n                oThis.options.iconAnchorRef = {x: oDefaultIcon.offset.x, y: oDefaultIcon.offset.y};\r\n                oThis.options.iconAnchorType = {x: oDefaultIcon.offset.xUnits, y: oDefaultIcon.offset.yUnits};\r\n\r\n                img.src = oDefaultIcon.iconUrl;\r\n            };\r\n            return img;\r\n        },\r\n        _applyAnchorRef: function () {\r\n            var oIconUtils = emp.utilities.icon;\r\n            var oImg = this.options.oIconImag;\r\n\r\n            if (this.options.iconAnchor) {\r\n                var oOffset = this.options.iconAnchor;\r\n                var oUnits = this.options.iconAnchorType;\r\n                var sXUnits = 'pixels';\r\n                var sYUnits = 'pixels';\r\n\r\n                if (oUnits && (typeof (oUnits.x) === 'string')) {\r\n                    sXUnits = oUnits.x;\r\n                }\r\n\r\n                if (oUnits && (typeof (oUnits.y) === 'string')) {\r\n                    sYUnits = oUnits.y;\r\n                }\r\n\r\n                oImg.style.marginLeft = oIconUtils.calculateXOffset(oImg.width, oOffset.x, sXUnits) + 'px';\r\n                oImg.style.marginTop = oIconUtils.calculateYOffset(oImg.height, oOffset.y, sYUnits, oIconUtils.referencePoint.TOP_LEFT) + 'px';\r\n            } else {\r\n                var oDefaultIcon = emp.utilities.icon.getDefaultIcon(this.options.basePath);\r\n                var iXOffset = oIconUtils.calculateXOffset(oDefaultIcon.offset.width, oDefaultIcon.offset.x.toString(), oDefaultIcon.offset.xUnits);\r\n                var iYOffset = oIconUtils.calculateYOffset(oDefaultIcon.offset.height, oDefaultIcon.offset.y.toString(), oDefaultIcon.offset.yUnits, oIconUtils.referencePoint.TOP_LEFT);\r\n\r\n                oImg.style.marginLeft = iXOffset + 'px';\r\n                oImg.style.marginTop = iYOffset + 'px';\r\n            }\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.EmpIcon = L.Icon.extend(leafLet.internalPrivateClass.EmpIcon());\r\n\r\n\r\nL.Icon.Default = L.Icon.Default.extend({\r\n    options: {\r\n        iconSize: [25, 41],\r\n        iconAnchor: [12, 41]\r\n    },\r\n    _getIconUrl: function (name) {\r\n        if (name === 'shadow') {\r\n            return undefined;\r\n        }\r\n        var oDefaultIcon = emp.utilities.icon.getDefaultIcon(this.options.basePath);\r\n        var iXOffset = emp.utilities.icon.calculateXOffset(oDefaultIcon.offset.width, oDefaultIcon.offset.x, oDefaultIcon.offset.xUnits);\r\n        var iYOffset = emp.utilities.icon.calculateYOffset(oDefaultIcon.offset.height, oDefaultIcon.offset.y, oDefaultIcon.offset.yUnits, emp.utilities.icon.referencePoint.BOTTOM_LEFT);\r\n\r\n        this.options.iconSize = new L.Point(oDefaultIcon.size.width, oDefaultIcon.size.height);\r\n        this.options.iconAnchor = new L.Point(iXOffset, iYOffset);\r\n\r\n        return oDefaultIcon.iconUrl;\r\n    }\r\n});\r\n\r\nL.Marker = L.Marker.extend({\r\n    options: {\r\n        icon: new L.Icon.Default()\r\n    },\r\n    _initInteraction: function () {\r\n        if (!this.options.clickable) {\r\n            return;\r\n        }\r\n\r\n        // TODO refactor into something shared with Map/Path/etc. to DRY it up\r\n\r\n        var icon = this._icon,\r\n                events = ['dblclick', 'mouseup', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n        L.DomUtil.addClass(icon, 'leaflet-clickable');\r\n        L.DomEvent.on(icon, 'click', this._onMouseClick, this);\r\n        L.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\r\n\r\n        for (var i = 0; i < events.length; i++) {\r\n            L.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\r\n        }\r\n\r\n        if (L.Handler.MarkerDrag) {\r\n            this.dragging = new L.Handler.MarkerDrag(this);\r\n\r\n            if (this.options.draggable) {\r\n                this.dragging.enable();\r\n            }\r\n        }\r\n    },\r\n    _fireMouseEvent: function (e) {\r\n\r\n        this.fire(e.type, {\r\n            originalEvent: e,\r\n            latlng: this._latlng\r\n        });\r\n\r\n        // TODO proper custom event propagation\r\n        // this line will always be called if marker is in a FeatureGroup\r\n        if (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n            L.DomEvent.preventDefault(e);\r\n        }\r\n        if ((e.type !== 'mousedown') && (e.type !== 'mouseup')) {\r\n            L.DomEvent.stopPropagation(e);\r\n        } else {\r\n            L.DomEvent.preventDefault(e);\r\n        }\r\n    },\r\n    _setPos: function (pos) {\r\n        var oImg;\r\n        var sTemp;\r\n\r\n        L.DomUtil.setPosition(this._icon, pos);\r\n\r\n        if (this._shadow) {\r\n            L.DomUtil.setPosition(this._shadow, pos);\r\n        }\r\n\r\n        this._zIndex = pos.y + this.options.zIndexOffset;\r\n        this._resetZIndex();\r\n\r\n        oImg = this._icon;\r\n        sTemp = oImg.style[L.DomUtil.TRANSFORM];\r\n\r\n        sTemp = emp.helpers.isEmptyString(oImg.style[L.DomUtil.TRANSFORM]) ? '' : oImg.style[L.DomUtil.TRANSFORM];\r\n\r\n        if (!emp.helpers.isEmptyString(this.options.icon.options.heading)) {\r\n            sTemp += ' rotate(' + this.options.icon.options.heading + 'deg)';\r\n        }\r\n        if (!emp.helpers.isEmptyString(this.options.icon.options.scale)) {\r\n            sTemp += ' scale(' + this.options.icon.options.scale + ',' + this.options.icon.options.scale + ')';\r\n        }\r\n\r\n        oImg.style[L.DomUtil.TRANSFORM] = sTemp;\r\n    },\r\n    empSelect: function () {\r\n        var labelStyle = this.options.oFeature.getEngineInstanceInterface().selectLabelStyle;\r\n\r\n        if (this.options.oFeature &&\r\n                (this.options.oFeature.getFormat() === emp.typeLibrary.featureFormatType.MILSTD) &&\r\n                this.options.oFeature.isMultiPointTG()) {\r\n            return;\r\n        }\r\n\r\n        if (this.options.icon instanceof L.DivIcon) {\r\n            if (labelStyle) {\r\n                emp.$(this._icon).find('p').css('color', 'rgb(' + labelStyle.color.red + ', ' + labelStyle.color.green + ', ' + labelStyle.color.blue + ')');\r\n            }\r\n        } else if (this.options.icon instanceof L.Icon) {\r\n            emp.$(this._icon).addClass('icon-selected');\r\n        }\r\n    },\r\n    empDeselect: function () {\r\n        var labelStyle = this.options.oFeature.getLabelStyle();\r\n\r\n        if (this.options.oFeature &&\r\n                (this.options.oFeature.getFormat() === emp.typeLibrary.featureFormatType.MILSTD) &&\r\n                this.options.oFeature.isMultiPointTG()) {\r\n            return;\r\n        }\r\n\r\n        if (this.options.icon instanceof L.DivIcon) {\r\n            if (labelStyle) {\r\n                emp.$(this._icon).find('p').css('color', 'rgb(' + labelStyle.color.red + ', ' + labelStyle.color.green + ', ' + labelStyle.color.blue + ')');\r\n            }\r\n        } else if (this.options.icon instanceof L.Icon) {\r\n            emp.$(this._icon).removeClass('icon-selected');\r\n        }\r\n    }\r\n});\r\n\r\nL.Path = L.Path.extend({\r\n    _initEvents: function () {\r\n        if (this.options.clickable) {\r\n            if (L.Browser.svg || !L.Browser.vml) {\r\n                L.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n            }\r\n\r\n            L.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n            var events = ['dblclick', 'mouseup', 'mousedown', 'mouseover',\r\n                'mouseout', 'mousemove', 'contextmenu'];\r\n            for (var i = 0; i < events.length; i++) {\r\n                L.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n            }\r\n        }\r\n    },\r\n    _updateStyle: function () {\r\n        if (this.options.stroke) {\r\n            this._path.setAttribute('stroke', this.options.color);\r\n            this._path.setAttribute('stroke-opacity', this.options.opacity);\r\n            this._path.setAttribute('stroke-width', this.options.weight + 2);\r\n            if (this.options.dashArray) {\r\n                this._path.setAttribute('stroke-dasharray', this.options.dashArray);\r\n            } else {\r\n                this._path.removeAttribute('stroke-dasharray');\r\n            }\r\n            if (this.options.lineCap) {\r\n                this._path.setAttribute('stroke-linecap', this.options.lineCap);\r\n            }\r\n            if (this.options.lineJoin) {\r\n                this._path.setAttribute('stroke-linejoin', this.options.lineJoin);\r\n            }\r\n        } else {\r\n            this._path.setAttribute('stroke', 'none');\r\n        }\r\n        if (this.options.fill) {\r\n            this._path.setAttribute('fill', this.options.fillColor || this.options.color);\r\n            this._path.setAttribute('fill-opacity', this.options.fillOpacity);\r\n        } else {\r\n            this._path.setAttribute('fill', 'none');\r\n        }\r\n    }\r\n});\r\n\r\nL.Polyline = L.Polyline.extend({\r\n    empSelect: function () {\r\n        var oSelectAttributes = this.options.oFeature.options.instanceInterface.selectAttributes;\r\n        this.options.tempColor = this.options.color;\r\n        this.options.tempWeight = this.options.weight;\r\n\r\n        //this.options.color = '#' + oSelectAttributes.color;\r\n        //this.options.weight = oSelectAttributes.width;\r\n        this.setStyle({\r\n            color: '#' + oSelectAttributes.color,\r\n            weight: oSelectAttributes.width\r\n        });\r\n    },\r\n    empDeselect: function () {\r\n        var oStyle = {};\r\n\r\n        if (this.options.hasOwnProperty('tempColor') && (!emp.util.isEmptyString(this.options.tempColor))) {\r\n            oStyle.color = this.options.tempColor;\r\n            if (oStyle.color === null) {\r\n                oStyle.stroke = false;\r\n            }\r\n            delete this.options['tempColor'];\r\n        }\r\n\r\n        if (this.options.hasOwnProperty('tempWeight') && (!isNaN(this.options.tempWeight))) {\r\n            oStyle.weight = this.options.tempWeight;\r\n            delete this.options['tempWeight'];\r\n        }\r\n\r\n        if (oStyle.hasOwnProperty('color') || oStyle.hasOwnProperty('weight')) {\r\n            this.setStyle(oStyle);\r\n        }\r\n    }\r\n});\r\n\r\nL.Polygon = L.Polygon.extend({\r\n    empSelect: function () {\r\n        var oSelectAttributes = this.options.oFeature.options.instanceInterface.selectAttributes;\r\n        this.options.tempColor = this.options.color;\r\n        this.options.tempWeight = this.options.weight;\r\n\r\n        //this.options.color = '#' + oSelectAttributes.color;\r\n        //this.options.weight = oSelectAttributes.width;\r\n        this.setStyle({\r\n            color: '#' + oSelectAttributes.color,\r\n            weight: oSelectAttributes.width\r\n        });\r\n    },\r\n    empDeselect: function () {\r\n        //this.options.color = this.options.tempColor;\r\n        //this.options.weight = this.options.tempWeight;\r\n        this.setStyle({\r\n            color: this.options.tempColor,\r\n            weight: this.options.tempWeight\r\n        });\r\n    }\r\n});\r\n\r\nL.Circle = L.Circle.extend({\r\n    empSelect: function () {\r\n        var oSelectAttributes = this.options.oFeature.options.instanceInterface.selectAttributes;\r\n        this.options.tempColor = this.options.color;\r\n        this.options.tempWeight = this.options.weight;\r\n\r\n        //this.options.color = '#' + oSelectAttributes.color;\r\n        //this.options.weight = oSelectAttributes.width;\r\n        this.setStyle({\r\n            color: '#' + oSelectAttributes.color,\r\n            weight: oSelectAttributes.width\r\n        });\r\n    },\r\n    empDeselect: function () {\r\n        //this.options.color = this.options.tempColor;\r\n        //this.options.weight = this.options.tempWeight;\r\n        this.setStyle({\r\n            color: this.options.tempColor,\r\n            weight: this.options.tempWeight\r\n        });\r\n    }\r\n});\r\n\r\nL.MultiPolyline = L.FeatureGroup.extend({\r\n    initialize: function (latlngs, options) {\r\n        this._layers = {};\r\n        this._options = options;\r\n        this.setLatLngs(latlngs);\r\n    },\r\n    setLatLngs: function (latlngs) {\r\n        var i = 0,\r\n                len = latlngs.length;\r\n\r\n        this.eachLayer(function (layer) {\r\n            if (i < len) {\r\n                layer.setLatLngs(latlngs[i++]);\r\n            } else {\r\n                this.removeLayer(layer);\r\n            }\r\n        }, this);\r\n\r\n        while (i < len) {\r\n            this.addLayer(new L.Polyline(latlngs[i++], this._options));\r\n        }\r\n\r\n        return this;\r\n    },\r\n    getLatLngs: function () {\r\n        var latlngs = [];\r\n\r\n        this.eachLayer(function (layer) {\r\n            latlngs.push(layer.getLatLngs());\r\n        });\r\n\r\n        return latlngs;\r\n    }\r\n});\r\n\r\nL.MultiPolygon = L.FeatureGroup.extend({\r\n    initialize: function (latlngs, options) {\r\n        this._layers = {};\r\n        this._options = options;\r\n        this.setLatLngs(latlngs);\r\n    },\r\n    setLatLngs: function (latlngs) {\r\n        var i = 0,\r\n                len = latlngs.length;\r\n\r\n        this.eachLayer(function (layer) {\r\n            if (i < len) {\r\n                layer.setLatLngs(latlngs[i++]);\r\n            } else {\r\n                this.removeLayer(layer);\r\n            }\r\n        }, this);\r\n\r\n        while (i < len) {\r\n            this.addLayer(new L.Polygon(latlngs[i++], this._options));\r\n        }\r\n\r\n        return this;\r\n    },\r\n    getLatLngs: function () {\r\n        var latlngs = [];\r\n\r\n        this.eachLayer(function (layer) {\r\n            latlngs.push(layer.getLatLngs());\r\n        });\r\n\r\n        return latlngs;\r\n    }\r\n});\r\n\r\nL.multiPolyline = function (latlngs, options) {\r\n    return new L.MultiPolyline(latlngs, options);\r\n};\r\n\r\nL.multiPolygon = function (latlngs, options) {\r\n    return new L.MultiPolygon(latlngs, options);\r\n};\r\n\r\n\r\nL.TileLayer = L.TileLayer.extend({\r\n    getTileUrl: function (tilePoint) {\r\n        var sURL = L.Util.template(this._url, L.extend({\r\n            s: this._getSubdomain(tilePoint),\r\n            z: tilePoint.z,\r\n            x: tilePoint.x,\r\n            y: tilePoint.y\r\n        }, this.options));\r\n\r\n        if (this.options.isDefaultMap) {\r\n            if (this.options.instanceInterface.useProxyForDefault) {\r\n                sURL = emp.util.config.getProxyUrl() + \"?\" + \"mime=image/*&url=\" + encodeURIComponent(sURL);\r\n            }\r\n        } else {\r\n            if (this.options.useProxy) {\r\n                sURL = emp.util.config.getProxyUrl() + \"?\" + \"mime=image/*&url=\" + encodeURIComponent(sURL);\r\n            }\r\n        }\r\n\r\n        return sURL;\r\n    }\r\n});\r\n\r\nL.TileLayer.WMS = L.TileLayer.WMS.extend({\r\n    getTileUrl: function (tilePoint) { // (Point, Number) -> String\r\n\r\n        var sURL;\r\n        var map = this._map,\r\n                tileSize = this.options.tileSize,\r\n                nwPoint = tilePoint.multiplyBy(tileSize),\r\n                sePoint = nwPoint.add([tileSize, tileSize]),\r\n                nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\r\n                se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\r\n                bbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ?\r\n        [se.y, nw.x, nw.y, se.x].join(',') :\r\n        [nw.x, se.y, se.x, nw.y].join(','),\r\n                url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\r\n\r\n        sURL = url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;\r\n\r\n        if (this.options.useProxy) {\r\n            sURL = emp.util.config.getProxyUrl() + \"?\" + \"mime=image/*&url=\" + encodeURIComponent(sURL);\r\n        }\r\n\r\n        return sURL;\r\n    }\r\n});\r\n\r\nL.Control.Zoom = L.Control.Zoom.extend({\r\n    getCoreId: function () {\r\n        return this.options.coreId;\r\n    },\r\n    getObjectType: function () {\r\n        return this.options.objectType;\r\n    }\r\n});\r\n\r\nL.Control.Scale = L.Control.Scale.extend({\r\n    getCoreId: function () {\r\n        return this.options.coreId;\r\n    },\r\n    getObjectType: function () {\r\n        return this.options.objectType;\r\n    }\r\n});\r\n\r\nL.TileLayer = L.TileLayer.extend({\r\n    getCoreId: function () {\r\n        return this.options.coreId;\r\n    },\r\n    getObjectType: function () {\r\n        return this.options.objectType;\r\n    }\r\n});\r\n","/* global L, emp, leafLet */\r\n\r\nleafLet.internalPrivateClass.EmpKMLIcon = function(){\r\n    var publicInterface = {\r\n        createIcon: function (oldIcon) {\r\n            var oThis = this;\r\n            var img = this._createIcon('icon', oldIcon);\r\n            this.options.oIconImag = img;\r\n            \r\n            img.onload = function () {\r\n                //this.width = this.naturalWidth;\r\n                //this.height = this.naturalHeight;\r\n                oThis.options.oMarker.update();\r\n            };\r\n\r\n            img.onerror = function(){\r\n                var oDefaultIcon = emp.utilities.icon.getDefaultIcon(oThis.options.basePath);\r\n                \r\n                oThis.options.iconSize = new L.Point(oDefaultIcon.size.width, oDefaultIcon.size.height);\r\n                oThis.options.iconAnchorRef = {x: oDefaultIcon.offset.x, y: oDefaultIcon.offset.y};\r\n                oThis.options.iconAnchorType =\t{x: oDefaultIcon.offset.xUnits, y: oDefaultIcon.offset.yUnits};\r\n\r\n                img.src = oDefaultIcon.iconUrl;\r\n            };\r\n            return img;\r\n        },\r\n        _getRealScale: function()\r\n        {\r\n            var dKMLScale = 1.0;\r\n            var dScale = 1.0;\r\n            \r\n            if (!emp.helpers.isEmptyString(this.options.scale))\r\n            {\r\n                dKMLScale = parseFloat(this.options.scale);\r\n            }\r\n\r\n            if ((this.options.oIconImag.naturalWidth > this.options.oIconImag.naturalHeight) &&\r\n                    (this.options.oIconImag.naturalWidth > 32))\r\n            {\r\n                dScale = 32 / this.options.oIconImag.naturalWidth;\r\n            }\r\n            else if ((this.options.oIconImag.naturalHeight > this.options.oIconImag.naturalWidth) &&\r\n                    (this.options.oIconImag.naturalHeight > 32))\r\n            {\r\n                dScale = 32 / this.options.oIconImag.naturalHeight;\r\n            }\r\n            else if ((this.options.oIconImag.naturalHeight === this.options.oIconImag.naturalWidth) &&\r\n                    (this.options.oIconImag.naturalHeight > 32))\r\n            {\r\n                dScale = 32 / this.options.oIconImag.naturalHeight;\r\n            }\r\n\r\n            return dKMLScale * dScale;\r\n        },\r\n        _calculatXOffset: function(iIconWidth, sOffset, sOffsetType, dScale)\r\n        {\r\n            var iOffset = 0;\r\n\r\n            switch (sOffsetType.toLowerCase())\r\n            {\r\n                case 'fraction':\r\n                    var dFraction = parseFloat(sOffset);\r\n\r\n                    iOffset = Math.floor(iIconWidth * dFraction * -1.0);\r\n                    break;\r\n                case 'pixels':\r\n                    var iOffsetValue = parseInt(sOffset);\r\n\r\n                    iOffset = iOffsetValue * -1;\r\n                    break;\r\n                case 'insetpixels':\r\n                    var iOffsetValue = parseInt(sOffset);\r\n\r\n                    iOffset = (iIconWidth - iOffsetValue) * -1;\r\n                    break;\r\n            }\r\n\r\n            return Math.floor(iOffset * dScale);\r\n        },\r\n        _calculatYOffset: function(iIconHeight, sOffset, sOffsetType, dScale)\r\n        {\r\n            var iOffset = 0;\r\n\r\n            switch (sOffsetType.toLowerCase())\r\n            {\r\n                case 'fraction':\r\n                    var dFraction = parseFloat(sOffset);\r\n\r\n                    iOffset = Math.floor(iIconHeight * dFraction) - iIconHeight;\r\n                    break;\r\n                case 'pixels':\r\n                    var iOffsetValue = parseInt(sOffset);\r\n\r\n                    iOffset = iOffsetValue - iIconHeight;\r\n                    break;\r\n                case 'insetpixels':\r\n                    var iOffsetValue = parseInt(sOffset);\r\n\r\n                    iOffset = iOffsetValue * -1;\r\n                    break;\r\n            }\r\n\r\n            return Math.floor(iOffset * dScale);\r\n        },\r\n        _applyAnchorRef: function()\r\n        {\r\n            var oImg = this.options.oIconImag;\r\n            var marginLeft;\r\n            var marginTop;\r\n            var iIconWidth;\r\n            var iIconHeight;\r\n            var dAngle;\r\n            var dTempX;\r\n            var dTempY;\r\n            var fHeading;\r\n            var iCenterX;\r\n            var iCenterY;\r\n            var dScale = this._getRealScale();\r\n\r\n            if (this.options.iconAnchorRef)\r\n            {\r\n                var oOffset = this.options.iconAnchorRef;\r\n                var oUnits = this.options.iconAnchorType;\r\n                var sXUnits = 'fraction';\r\n                var sYUnits = 'fraction';\r\n\r\n                if (oUnits && (typeof (oUnits.x) === 'string'))\r\n                {\r\n                    sXUnits = oUnits.x;\r\n                }\r\n\r\n                if (oUnits && (typeof (oUnits.y) === 'string'))\r\n                {\r\n                    sYUnits = oUnits.y;\r\n                }\r\n\r\n                marginLeft = this._calculatXOffset(oImg.naturalWidth, oOffset.x, sXUnits, dScale);\r\n                marginTop = this._calculatYOffset(oImg.naturalHeight, oOffset.y, sYUnits, dScale);\r\n                \r\n                iIconWidth = Math.floor(oImg.naturalWidth * dScale);\r\n                iIconHeight = Math.floor(oImg.naturalHeight * dScale);\r\n            }\r\n            else\r\n            {\r\n                var oIconUtils = emp.typeLibrary.utils.icon;\r\n                var oDefaultIcon = oIconUtils.getDefaultIcon(this.options.basePath);\r\n                var iXOffset = oIconUtils.calculateXOffset(oDefaultIcon.size.width, oDefaultIcon.offset.x, oDefaultIcon.offset.xUnits);\r\n                var iYOffset = oIconUtils.calculateYOffset(oDefaultIcon.size.height, oDefaultIcon.offset.y, oDefaultIcon.offset.yUnits, emp.utilities.icon.referencePoin.BOTTOM_LEFT);\r\n                \r\n                marginLeft = iXOffset;\r\n                marginTop = iYOffset;\r\n                \r\n                iIconWidth = Math.floor(oDefaultIcon.size.width * dScale);\r\n                iIconHeight = Math.floor(oDefaultIcon.size.height * dScale);\r\n            }\r\n\r\n            if (!emp.helpers.isEmptyString(this.options.heading))\r\n            {\r\n                fHeading = parseFloat(this.options.heading);\r\n                iCenterX = marginLeft + (iIconWidth / 2);\r\n                iCenterY = marginTop + (iIconHeight / 2);\r\n                \r\n                dTempX = 0 - iCenterX;\r\n                dTempY = 0 - iCenterY;\r\n\r\n                dAngle = fHeading * Math.PI / 180.0;\r\n                var dSin = Math.sin(dAngle);\r\n                var dCos = Math.cos(dAngle);\r\n\r\n                var dNewX = Math.round((dTempX * dCos) - (dTempY * dSin));\r\n                var dNewY = Math.round((dTempX * dSin) + (dTempY * dCos));\r\n\r\n                dTempX = dNewX + iCenterX;\r\n                dTempY = dNewY + iCenterY;\r\n\r\n                marginLeft -= dTempX;\r\n                marginTop -= dTempY;\r\n            }\r\n\r\n            oImg.style.marginLeft = Math.ceil(marginLeft) + 'px';\r\n            oImg.style.marginTop = Math.ceil(marginTop) + 'px';\r\n            \r\n            oImg.style.width = iIconWidth + 'px';\r\n            oImg.style.height = iIconHeight + 'px';\r\n            \r\n            return Math.floor(dScale * 1000) / 1000;\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.EmpKMLIcon = L.KMLIcon.extend(leafLet.internalPrivateClass.EmpKMLIcon());\r\n\r\nleafLet.internalPrivateClass.EmpKMLMarker = function(){\r\n    var publicInterface = {\r\n\tinitialize: function (latlng, options) {\r\n            options.draggable = false;\r\n\r\n            options.icon.options.oMarker = this;\r\n            L.Marker.prototype.initialize.call(this, latlng, options);\r\n\t},\r\n        setLatLng: function (latlng) {\r\n            this._latlng = L.latLng(latlng);\r\n\r\n            if (this._icon)\r\n            {\r\n                var pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n\r\n                this._setPos(pos);\r\n            }\r\n\r\n            return this.fire('move', { latlng: this._latlng });\r\n        },\r\n        update: function () {\r\n            if (this._icon) {\r\n                var pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n\r\n                this._setPos(pos);\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n\t_setPos: function (pos) {\r\n            var oImg;\r\n            var sTemp;\r\n            var dScale = this.options.icon._applyAnchorRef();\r\n            \r\n            L.Marker.prototype._setPos.call(this, pos);\r\n            \r\n            oImg = this._icon;\r\n\r\n            sTemp = emp.helpers.isEmptyString(oImg.style[L.DomUtil.TRANSFORM])? '': oImg.style[L.DomUtil.TRANSFORM];\r\n            \r\n            //sTemp += ' scale(' + dScale + ',' + dScale + ')';\r\n            \r\n            if (!emp.helpers.isEmptyString(this.options.icon.options.heading))\r\n            {\r\n                sTemp += ' rotate(' + this.options.icon.options.heading + 'deg)';\r\n            }\r\n            \r\n            oImg.style[L.DomUtil.TRANSFORM] = sTemp;\r\n\t}\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.EmpKMLMarker = L.Marker.extend(leafLet.internalPrivateClass.EmpKMLMarker());\r\n\r\nleafLet.internalPrivateClass.KMLPluginExtension = function(){\r\n    var publicInterface = {\r\n        initialize: function(kml, options) {\r\n            L.Util.setOptions(this, options);\r\n            this._kml = kml;\r\n            this._layers = {};\r\n\r\n            if (kml)\r\n            {\r\n                if (typeof (kml) !== 'string')\r\n                {\r\n                    throw new Error('KML or URL must be a string.');\r\n                }\r\n                \r\n                if (emp.helpers.isUrl(kml))\r\n                {\r\n                    this.addKML(kml, options, this.options.async);\r\n                }\r\n                else\r\n                {\r\n                    this._addKML(emp.$.parseXML(kml), options);\r\n                }\r\n            }\r\n        },\r\n        getIconUrl: function(sKmlUrl)\r\n        {\r\n            var sURL = sKmlUrl;\r\n            if (this.options.oFeatureProperties.hasOwnProperty('iconUrl'))\r\n            {\r\n                sURL = this.options.oFeatureProperties.iconUrl;\r\n            }\r\n            \r\n            if (emp.util.config.getUseProxySetting())\r\n            {\r\n                sURL = emp.util.config.getProxyUrl() + \"?\" + \"mime=image/*&url=\" + escape(sURL);\r\n            }\r\n\r\n            return sURL;\r\n        },\r\n        _addKML: function(xml, options)\r\n        {\r\n                this.options.kmlDoc = xml;\r\n                var layers = this.parseKML(xml);\r\n                if (!layers || !layers.length) return;\r\n                for (var i = 0; i < layers.length; i++) {\r\n                    this.fire('addlayer', {\r\n                            layer: layers[i]\r\n                    });\r\n                    this.addLayer(layers[i]);\r\n                }\r\n                this.latLngs = this.getLatLngs(xml);\r\n                this.fire('loaded');\r\n        },\r\n        parseStyle: function (xml) {\r\n            var style = {};\r\n            var sl = xml.getElementsByTagName('Style');\r\n\r\n            //for (var i = 0; i < sl.length; i++) {\r\n            var attributes = {color: true, width: true, Icon: true, href: true,\r\n                              hotSpot: true, scale: true, heading:true};\r\n\r\n            function _parse(xml) {\r\n                var options = {};\r\n                for (var i = 0; i < xml.childNodes.length; i++) {\r\n                    var e = xml.childNodes[i];\r\n                    var key = e.tagName;\r\n                    if (!attributes[key]) { continue; }\r\n                    if (key === 'hotSpot')\r\n                    {\r\n                        for (var j = 0; j < e.attributes.length; j++) {\r\n                            options[e.attributes[j].name] = e.attributes[j].nodeValue;\r\n                        }\r\n                    } else {\r\n                        var value = e.childNodes[0].nodeValue;\r\n                        if (key === 'color') {\r\n                            options.opacity = parseInt(value.substring(0, 2), 16) / 255.0;\r\n                            options.color = '#' + value.substring(6, 8) + value.substring(4, 6) + value.substring(2, 4);\r\n                        } else if (key === 'width') {\r\n                            options.weight = value;\r\n                        } else if (key === 'Icon') {\r\n                            ioptions = _parse(e);\r\n                            if (ioptions.href) { options.href = ioptions.href; }\r\n                        } else if (key === 'href') {\r\n                            options.href = value;\r\n                        } else if (key === 'scale') {\r\n                            options.scale = value;\r\n                        } else if (key === 'heading') {\r\n                            options.heading = value;\r\n                        }\r\n                    }\r\n                }\r\n                return options;\r\n            }\r\n\r\n            for (var i = 0; i < sl.length; i++) {\r\n                var e = sl[i],\r\n                    el;\r\n                var options = {},\r\n                    poptions = {},\r\n                    ioptions = {};\r\n\r\n                el = e.getElementsByTagName('LineStyle');\r\n                if (el && el[0]) { options = _parse(el[0]); }\r\n\r\n                el = e.getElementsByTagName('PolyStyle');\r\n\r\n                if (el && el[0]) { poptions = _parse(el[0]); }\r\n\r\n                if (poptions.color) { options.fillColor = poptions.color; }\r\n\r\n                if (poptions.opacity) { options.fillOpacity = poptions.opacity; }\r\n\r\n                el = e.getElementsByTagName('IconStyle');\r\n                if (el && el[0]) { ioptions = _parse(el[0]); }\r\n\r\n                if (ioptions.href) {\r\n                    // save anchor info until the image is loaded\r\n                    \r\n                    var oIconOptions = {\r\n                        iconUrl: this.getIconUrl(ioptions.href),\r\n                        shadowUrl: null,\r\n                        iconAnchorRef: {x: ioptions.x, y: ioptions.y},\r\n                        iconAnchorType:\t{x: ioptions.xunits, y: ioptions.yunits}\r\n                    };\r\n                    \r\n                    if (!emp.helpers.isEmptyString(ioptions.scale))\r\n                    {\r\n                        oIconOptions.scale = ioptions.scale;\r\n                    }\r\n                    \r\n                    if (!emp.helpers.isEmptyString(ioptions.heading))\r\n                    {\r\n                        oIconOptions.heading = ioptions.heading;\r\n                    }\r\n                    \r\n                    oIconOptions.basePath = this.options.basePath;\r\n                    \r\n                    options.icon = new leafLet.typeLibrary.EmpKMLIcon(oIconOptions);\r\n                }\r\n                style['#' + e.getAttribute('id')] = options;\r\n            }\r\n            return style;\r\n        },\r\n        parsePlacemark: function (place, xml, style) {\r\n            var h, i, j, el, options = {};\r\n\r\n            var multi = ['MultiGeometry', 'gx:MultiTrack'];\r\n            for (h in multi) {\r\n                if (!multi.hasOwnProperty(h)) {\r\n                    continue;\r\n                }\r\n                el = place.getElementsByTagName(multi[h]);\r\n                for (i = 0; i < el.length; i++) {\r\n                    return this.parsePlacemark(el[i], xml, style);\r\n                }\r\n            }\r\n\r\n            el = place.getElementsByTagName('Style');\r\n            \r\n            if (el && (el.length > 0))\r\n            {\r\n                for (i = 0; i < el.length; i++) {\r\n                    var sIndex = '#' + el[i].getAttribute('id');\r\n                    for (var a in style[sIndex]) {\r\n                        if (!style[sIndex].hasOwnProperty(a)) {\r\n                            continue;\r\n                        }\r\n                        options[a] = style[sIndex][a];\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                el = place.getElementsByTagName('styleUrl');\r\n\r\n                for (i = 0; i < el.length; i++) {\r\n                    var url = el[i].childNodes[0].nodeValue;\r\n                    for (var a in style[url]) {\r\n                        if (!style[url].hasOwnProperty(a)) {\r\n                            continue;\r\n                        }\r\n                        options[a] = style[url][a];\r\n                    }\r\n                }\r\n            }\r\n\r\n            var layers = [];\r\n\r\n            var parse = ['LineString', 'Polygon', 'Point', 'gx:Track'];\r\n            for (j in parse) {\r\n                if (!parse.hasOwnProperty(j)) {\r\n                    continue;\r\n                }\r\n                var tag = parse[j];\r\n                el = place.getElementsByTagName(tag);\r\n                for (i = 0; i < el.length; i++) {\r\n                    var l = this['parse' + tag.replace(/gx:/, '')](el[i], xml, options);\r\n                    if (l) { layers.push(l); }\r\n                }\r\n            }\r\n\r\n            if (!layers.length) {\r\n                return;\r\n            }\r\n            var layer = layers[0];\r\n            if (layers.length > 1) {\r\n                layer = new L.FeatureGroup(layers);\r\n            }\r\n\r\n            var sID, name, descr = '';\r\n            \r\n            if (place.id) {\r\n                sID = place.id;\r\n            }\r\n\r\n            el = place.getElementsByTagName('name');\r\n            if (el.length && el[0].childNodes.length) {\r\n                name = el[0].childNodes[0].nodeValue;\r\n            }\r\n            el = place.getElementsByTagName('description');\r\n            for (i = 0; i < el.length; i++) {\r\n                for (j = 0; j < el[i].childNodes.length; j++) {\r\n                    descr = descr + el[i].childNodes[j].nodeValue;\r\n                }\r\n            }\r\n            \r\n            if ((typeof (name) === 'string') && (name.length > 0))\r\n            {\r\n                layer.options.kmlName = name;\r\n            }\r\n            \r\n            if ((typeof (descr) === 'string') && (descr.length > 0))\r\n            {\r\n                layer.options.kmlDescription = descr;\r\n            }\r\n            \r\n            if ((typeof (sID) === 'string') && (sID.length > 0))\r\n            {\r\n                layer.options.sSubItemID = sID;\r\n            }\r\n\r\n            //if (name) {\r\n            //    layer.bindPopup('<h2>' + name + '</h2>' + descr, {\r\n            //        closeButton: false\r\n            //    });\r\n            //}\r\n\r\n            return layer;\r\n        },\r\n        _read_coords: function (el) {\r\n            var text = '', coords = [], i;\r\n            for (i = 0; i < el.childNodes.length; i++) {\r\n                text = text + el.childNodes[i].nodeValue;\r\n            }\r\n            text = text.split(/[\\s\\n]+/);\r\n            for (i = 0; i < text.length; i++) {\r\n                var ll = text[i].split(',');\r\n                if (ll.length < 2) {\r\n                    continue;\r\n                }\r\n                coords.push(new L.LatLng(ll[1], ll[0], ll[2]));\r\n            }\r\n            return coords;\r\n        },\r\n        _read_gxcoords: function (el) {\r\n            var text = '', coords = [];\r\n            text = el.firstChild.nodeValue.split(' ');\r\n            coords.push(new L.LatLng(text[1], text[0], text[2]));\r\n            return coords;\r\n        },\r\n        getOptions: function(sType, oOptions)\r\n        {\r\n            var oColor;\r\n            var oProperties = this.options.oFeatureProperties;\r\n            \r\n            if (sType === 'point') {\r\n                var sURL;\r\n                var iXOffset,\r\n                    iYOffset,\r\n                    sXUnits,\r\n                    sYUnits;\r\n\r\n                if (oProperties.hasOwnProperty('iconUrl'))\r\n                {\r\n                    sURL = this.getIconUrl(oProperties.iconUrl);\r\n                }\r\n\r\n                if (oProperties.hasOwnProperty('iconXOffset'))\r\n                {\r\n                    iXOffset = oProperties.iconXOffset;\r\n                    if (oProperties.hasOwnProperty('xUnits'))\r\n                    {\r\n                        sXUnits = oProperties.xUnits;\r\n                    }\r\n                }\r\n\r\n                if (oProperties.hasOwnProperty('iconYOffset'))\r\n                {\r\n                    iYOffset = oProperties.iconYOffset;\r\n                    if (oProperties.hasOwnProperty('yUnits'))\r\n                    {\r\n                        sYUnits = oProperties.yUnits;\r\n                    }\r\n                }\r\n\r\n                if (!iXOffset)\r\n                {\r\n                    if (oOptions.icon && oOptions.icon.options.iconAnchorRef)\r\n                    {\r\n                        iXOffset = oOptions.icon.options.iconAnchorRef.x;\r\n                    }\r\n                    else\r\n                    {\r\n                        iXOffset = 0;\r\n                    }\r\n                }\r\n\r\n                if (!sXUnits)\r\n                {\r\n                    if (oOptions.icon && oOptions.icon.options.iconAnchorType)\r\n                    {\r\n                        sXUnits = oOptions.icon.options.iconAnchorType.x;\r\n                    }\r\n                    else\r\n                    {\r\n                        sXUnits = 'fraction';\r\n                    }\r\n                }\r\n\r\n                if (!iYOffset)\r\n                {\r\n                    if (oOptions.icon && oOptions.icon.options.iconAnchorRef)\r\n                    {\r\n                        iYOffset = oOptions.icon.options.iconAnchorRef.y;\r\n                    }\r\n                    else\r\n                    {\r\n                        iYOffset = 0;\r\n                    }\r\n                }\r\n\r\n                if (!sYUnits)\r\n                {\r\n                    if (oOptions.icon && oOptions.icon.options.iconAnchorType)\r\n                    {\r\n                        sYUnits = oOptions.icon.options.iconAnchorType.y;\r\n                    }\r\n                    else\r\n                    {\r\n                        sYUnits = 'fraction';\r\n                    }\r\n                }\r\n\r\n                if (!oOptions.icon)\r\n                {\r\n                    if (!sURL)\r\n                    {\r\n                        var oDefaultIcon = emp.utilities.icon.getDefaultIcon(this.options.basePath);\r\n                        \r\n                        sURL = oDefaultIcon.iconUrl;\r\n                        iYOffset = oDefaultIcon.offset.y;\r\n                        iXOffset = oDefaultIcon.offset.x;\r\n                        sXUnits = oDefaultIcon.offset.xUnits;\r\n                        sYUnits = oDefaultIcon.offset.yUnits;\r\n                    }\r\n                    \r\n                    if (this.options.oFeature.isSelected())\r\n                    {\r\n                        oOptions.icon = new leafLet.typeLibrary.EmpKMLIcon({\r\n                            iconUrl: sURL,\r\n                            shadowUrl: null,\r\n                            iconAnchorRef: {x: iXOffset, y: iYOffset},\r\n                            iconAnchorType: {x: sXUnits, y: sYUnits},\r\n                            className: 'icon-selected',\r\n                            basePath: this.options.basePath\r\n                        });\r\n                    }\r\n                    else\r\n                    {\r\n                        oOptions.icon = new leafLet.typeLibrary.EmpKMLIcon({\r\n                            iconUrl: sURL,\r\n                            shadowUrl: null,\r\n                            iconAnchorRef: {x: iXOffset, y: iYOffset},\r\n                            iconAnchorType: {x: sXUnits, y: sYUnits},\r\n                            basePath: this.options.basePath\r\n                        });\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    if ((typeof (sURL) === 'string') && (sURL.length > 0))\r\n                    {\r\n                        oOptions.icon.options.iconUrl = sURL;\r\n                    }\r\n                    oOptions.icon.options.iconAnchorRef = {x: iXOffset, y: iYOffset};\r\n                    oOptions.icon.options.iconAnchorType = {x: sXUnits, y: sYUnits};\r\n\r\n                    if (this.options.oFeature.isSelected())\r\n                    {\r\n                        oOptions.icon.options.className = 'icon-selected';\r\n                    }\r\n                    else\r\n                    {\r\n                        oOptions.icon.options.className = '';\r\n                    }\r\n                }\r\n            }\r\n            \r\n            if (this.options.oFeature.isSelected()) {\r\n                oOptions.color = '#' + this.options.oFeature.options.instanceInterface.selectAttributes.color;\r\n                oOptions.weight = this.options.oFeature.options.instanceInterface.selectAttributes.width;\r\n                \r\n                if ((sType === 'line') || (sType === 'polygon')) {\r\n                    if (oProperties.hasOwnProperty('lineColor')) {\r\n                        oOptions.tempColor = leafLet.utils.convertColor(oProperties.lineColor).sColor;\r\n                    } else {\r\n                        oOptions.tempColor = L.LEAFLET_DEFAULT_LINE_COLOR;\r\n                    }\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        if (typeof (oProperties.lineWidth) === 'string')\r\n                        {\r\n                            oOptions.tempWeight = parseInt(oProperties.lineWidth);\r\n                        }\r\n                        else\r\n                        {\r\n                            oOptions.tempWeight = oProperties.lineWidth;\r\n                        }\r\n                    } else {\r\n                        oOptions.tempWeight = L.LEAFLET_DEFAULT_LINE_WEIGHT;\r\n                    }\r\n                }\r\n            } else if (oProperties.hasOwnProperty('lineColor') && ((sType === 'line') || (sType === 'polygon'))) {\r\n                oColor = leafLet.utils.convertColor(oProperties.lineColor);\r\n                \r\n                oOptions.color = oColor.sColor;\r\n                oOptions.opacity = oColor.opacity;\r\n                \r\n                if (oProperties.hasOwnProperty('lineWidth'))\r\n                {\r\n                    if (typeof (oProperties.lineWidth) === 'string')\r\n                    {\r\n                        oOptions.weight = parseInt(oProperties.lineWidth);\r\n                    }\r\n                    else\r\n                    {\r\n                        oOptions.weight = oProperties.lineWidth;\r\n                    }\r\n                }                    \r\n            }\r\n\r\n            if (oProperties.hasOwnProperty('fillColor') && (sType === 'polygon'))\r\n            {\r\n                oColor = leafLet.utils.convertColor(oProperties.fillColor);\r\n                \r\n                oOptions.fill = true;\r\n                oOptions.fillColor = oColor.sColor;\r\n                oOptions.fillOpacity = oColor.opacity;\r\n            }\r\n            \r\n            oOptions.oFeature = this.options.oFeature;\r\n            \r\n            return oOptions;\r\n        },\r\n        parsePoint: function (line, xml, options) {\r\n            var el = line.getElementsByTagName('coordinates');\r\n            if (!el.length) {\r\n                return;\r\n            }\r\n            var ll = el[0].childNodes[0].nodeValue.split(',');\r\n            return new leafLet.typeLibrary.EmpKMLMarker(new L.LatLng(ll[1], ll[0], ll[2]), this.getOptions('point', options));\r\n        },\r\n\tparseLineString: function (line, xml, options) {\r\n            var coords = this.parseCoords(line);\r\n            if (!coords.length) { return; }\r\n            return new L.Polyline(coords, this.getOptions('line', options));\r\n\t},\r\n\tparseTrack: function (line, xml, options) {\r\n            var el = xml.getElementsByTagName('gx:coord');\r\n            var coords = [];\r\n            for (var j = 0; j < el.length; j++) {\r\n                    coords = coords.concat(this._read_gxcoords(el[j]));\r\n            }\r\n            if (!coords.length) { return; }\r\n            return new L.Polyline(coords, this.getOptions('line', options));\r\n\t},\r\n\tparsePolygon: function (line, xml, options) {\r\n            var el, polys = [], inner = [], i, coords;\r\n            \r\n            el = line.getElementsByTagName('outerBoundaryIs');\r\n            \r\n            for (i = 0; i < el.length; i++) {\r\n                coords = this.parseCoords(el[i]);\r\n                if (coords) {\r\n                    polys.push(coords);\r\n                }\r\n            }\r\n            el = line.getElementsByTagName('innerBoundaryIs');\r\n            for (i = 0; i < el.length; i++) {\r\n                coords = this.parseCoords(el[i]);\r\n                if (coords) {\r\n                    inner.push(coords);\r\n                }\r\n            }\r\n            if (!polys.length) {\r\n                return;\r\n            }\r\n            if (options.fillColor) {\r\n                options.fill = true;\r\n            }\r\n            if (polys.length === 1) {\r\n                return new L.Polygon(polys.concat(inner), this.getOptions('polygon', options));\r\n            }\r\n            return new L.MultiPolygon(polys, this.getOptions('polygon', options));\r\n\t}\r\n/*\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tbounds.extend(layer instanceof leafLet.typeLibrary.EmpKMLMarker ? layer.getLatLng() : layer.getBounds());\r\n\t\t});\r\n\r\n\t\treturn bounds;\r\n\t}\r\n*/\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.EmpKmlObject = L.KML.extend(leafLet.internalPrivateClass.KMLPluginExtension());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nL.MarkerCluster.mergeOptions({\r\n    titleText: \"\",\r\n    popupText: \"\",\r\n    overlay: undefined\r\n});\r\n\r\nL.MarkerCluster.include({\r\n    setPopupHeading: function(sText)\r\n    {\r\n        this.options.titleText = sText;\r\n    },\r\n    getPopupHeading: function()\r\n    {\r\n        return this.options.titleText;\r\n    },\r\n    setPopupText: function(sText)\r\n    {\r\n        this.options.popupText = sText;\r\n    },\r\n    getPopupText: function()\r\n    {\r\n        return this.options.popupText;\r\n    },\r\n    setOverlay: function(oOverlay)\r\n    {\r\n        this.options.overlay = oOverlay;\r\n    },\r\n    getOverlayId: function()\r\n    {\r\n        var sID = undefined;\r\n        \r\n        if (this.options.overlay instanceof leafLet.typeLibrary.Overlay)\r\n        {\r\n            sID = this.options.overlay.getOverlayId();\r\n        }\r\n        \r\n        return sID;\r\n    },\r\n    getParentId: function()\r\n    {\r\n        var sID = undefined;\r\n        \r\n        if (this.options.overlay instanceof leafLet.typeLibrary.Overlay)\r\n        {\r\n            sID = this.options.overlay.getParentId();\r\n        }\r\n        \r\n        return sID;\r\n    },\r\n    getFeatureId: function()\r\n    {\r\n        return undefined;\r\n    }\r\n});\r\n\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.EllipseObject = function() {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n                oMap: args.leafletMap,\r\n                semiMajor: args.semiMajor,\r\n                semiMinor: args.semiMinor,\r\n                azimuth: args.azimuth,\r\n                centerLatLng: args.centerLatLng,\r\n                isSelected: args.isSelected,\r\n                selectAttributes: args.selectAttributes,\r\n                oCoordList: [],\r\n                properties: args.properties,\r\n                oFeature: args.oFeature\r\n            };\r\n\r\n            L.Util.setOptions(this, options);\r\n\r\n            this._generatePolygon();\r\n\r\n            L.Polygon.prototype.initialize.call(this, this.options.oCoordList, this.options.properties);\r\n        },\r\n        isSelected: function() {\r\n            return this.options.isSelected;\r\n        },\r\n        _generatePolygon: function() {\r\n            var x, newX;\r\n            var y, newY;\r\n            var tempLatLng;\r\n            var angle;\r\n            var angleTan;\r\n            var angleTan2;\r\n            var xyPoint, newPoint;\r\n            var oLatLngList = [];\r\n            var q1PointList = [];\r\n            var q2PointList = [];\r\n            var q3PointList = [];\r\n            var q4PointList = [];\r\n            var coordList = this.options.oCoordList;\r\n            var leafletMap = this.options.oMap;\r\n            var centerPoint = leafletMap.latLngToLayerPoint(this.options.centerLatLng);\r\n            var northCoord = this.options.centerLatLng.destinationPoint(0, this.options.semiMinor);\r\n            var eastCoord = this.options.centerLatLng.destinationPoint(90, this.options.semiMajor);\r\n            var northPoint = leafletMap.latLngToLayerPoint(northCoord);\r\n            var eastPoint = leafletMap.latLngToLayerPoint(eastCoord);\r\n            var semiMajorPx = centerPoint.distanceTo(eastPoint);\r\n            var semiMinorPx = centerPoint.distanceTo(northPoint);\r\n            var nPtePtDist = northPoint.distanceTo(eastPoint);\r\n            var semiMajorPx2 = semiMajorPx * semiMajorPx;\r\n            var semiMinorPx2 = semiMinorPx * semiMinorPx;\r\n            var majorMinor = semiMajorPx * semiMinorPx;\r\n            var azimuth = this.options.azimuth;\r\n            var cosAzimuth = Math.cos(azimuth.toRad());\r\n            var sinAzimuth = Math.sin(azimuth.toRad());\r\n            var deltaRadian = (90.0 / nPtePtDist).toRad();\r\n            var maxRadian = Math.PI / 2.0;\r\n\r\n            x = semiMajorPx;\r\n            y = 0;\r\n\r\n            // Create 1st quadrant point and rotate it.\r\n            xyPoint = new L.point(((x * cosAzimuth) - (y * sinAzimuth)), ((y * cosAzimuth) + (x * sinAzimuth)), true);\r\n            newPoint = centerPoint.add(xyPoint);\r\n            q1PointList.push(newPoint);\r\n\r\n            // Create 4th quadrant point and rotate it.\r\n            xyPoint = new L.point(((x * cosAzimuth * -1) - (y * sinAzimuth * -1)), ((y * cosAzimuth * -1) + (x * sinAzimuth * -1)), true);\r\n            newPoint = centerPoint.add(xyPoint);\r\n            q4PointList.push(newPoint);\r\n\r\n            for (angle = deltaRadian; angle < maxRadian; angle += deltaRadian) {\r\n                angleTan = Math.tan(angle);\r\n                angleTan2 = angleTan * angleTan;\r\n                x = majorMinor / (Math.sqrt(semiMinorPx2 + (semiMajorPx2 * angleTan2)));\r\n                y = x * angleTan;\r\n                // Create 1st quadrant point and rotate it.\r\n                xyPoint = new L.point(((x * cosAzimuth) - (y * sinAzimuth)), ((y * cosAzimuth) + (x * sinAzimuth)), true);\r\n                newPoint = centerPoint.add(xyPoint);\r\n                q1PointList.push(newPoint);\r\n\r\n                // Create 2nd quadrant point and rotate it.\r\n                xyPoint = new L.point(((x * cosAzimuth * -1) - (y * sinAzimuth)), ((y * cosAzimuth) + (x * sinAzimuth * -1)), true);\r\n                newPoint = centerPoint.add(xyPoint);\r\n                q2PointList.push(newPoint);\r\n\r\n                // Create 3rd quadrant point and rotate it.\r\n                xyPoint = new L.point(((x * cosAzimuth) - (y * sinAzimuth * -1)), ((y * cosAzimuth * -1) + (x * sinAzimuth)), true);\r\n                newPoint = centerPoint.add(xyPoint);\r\n                q3PointList.push(newPoint);\r\n\r\n                // Create 4th quadrant point and rotate it.\r\n                xyPoint = new L.point(((x * cosAzimuth * -1) - (y * sinAzimuth * -1)), ((y * cosAzimuth * -1) + (x * sinAzimuth * -1)), true);\r\n                newPoint = centerPoint.add(xyPoint);\r\n                q4PointList.push(newPoint);\r\n            }\r\n\r\n            for (x = 0; x < q1PointList.length; x++) {\r\n                tempLatLng = leafletMap.layerPointToLatLng(q1PointList[x]);\r\n                if (tempLatLng) {\r\n                    coordList.push(tempLatLng);\r\n                }\r\n            }\r\n\r\n            for (x = q2PointList.length - 1; x >= 0; x--) {\r\n                tempLatLng = leafletMap.layerPointToLatLng(q2PointList[x]);\r\n                if (tempLatLng) {\r\n                    coordList.push(tempLatLng);\r\n                }\r\n            }\r\n\r\n            for (x = 0; x < q4PointList.length; x++) {\r\n                tempLatLng = leafletMap.layerPointToLatLng(q4PointList[x]);\r\n                if (tempLatLng) {\r\n                    coordList.push(tempLatLng);\r\n                }\r\n            }\r\n\r\n            for (x = q3PointList.length - 1; x >= 0; x--) {\r\n                tempLatLng = leafletMap.layerPointToLatLng(q3PointList[x]);\r\n                if (tempLatLng) {\r\n                    coordList.push(tempLatLng);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.EllipseObject = L.Polygon.extend(leafLet.internalPrivateClass.EllipseObject());\r\n","\r\n/* global leafLet, emp, L */\r\n\r\nleafLet.internalPrivateClass.SelectionManager = function(args){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                eventData: [],\r\n                featureSelectedList: {},\r\n                mapInstance: args.mapInstance\r\n            };\r\n            L.Util.setOptions(this, options);\r\n        },\r\n        destroy: function()\r\n        {\r\n            var iIndex;\r\n            var oKeyList = emp.helpers.associativeArray.getKeys(this.options.featureSelectedList);\r\n            \r\n            for (iIndex = 0; iIndex < oKeyList.length; iIndex++) {\r\n                delete this.options.featureSelectedList[oKeyList[iIndex]];\r\n            }\r\n            \r\n            this.options.eventData = [];\r\n        },\r\n        getKey: function(oFeature, sSubFeatureID)\r\n        {\r\n            var sKey = oFeature.getCoreId();\r\n            \r\n            if (!emp.helpers.isEmptyString(sSubFeatureID))\r\n            {\r\n                sKey += '-' + sSubFeatureID;\r\n            }\r\n            \r\n            return sKey;\r\n        },\r\n        _createSelectionObject: function(oFeature, sSubFeatureID)\r\n        {\r\n            var sKey = this.getKey(oFeature, sSubFeatureID);\r\n            var oSelectedListObject = {\r\n                sKey : sKey,\r\n                oFeature: oFeature,\r\n                oSelectionData: {\r\n                    coreId: oFeature.getCoreId(),\r\n                    overlayId: oFeature.getOverlayId(),\r\n                    parentId: oFeature.getParentId(),\r\n                    featureId: oFeature.getFeatureId(),\r\n                    select: true\r\n                }\r\n            };\r\n            \r\n            if ((typeof (sSubFeatureID) === 'string') && (sSubFeatureID.length > 0))\r\n            {\r\n                oSelectedListObject.oSelectionData.selectedId = sSubFeatureID;\r\n            }\r\n            \r\n            return oSelectedListObject;\r\n        },\r\n        deselectAllFeatures: function()\r\n        {\r\n            var iIndex;\r\n            var oFeatureSelection;\r\n            var oKeyList = emp.helpers.associativeArray.getKeys(this.options.featureSelectedList);\r\n\r\n            for (iIndex = 0; iIndex < oKeyList.length; iIndex++) {\r\n                oFeatureSelection = this.options.featureSelectedList[oKeyList[iIndex]];\r\n                \r\n                if (!oFeatureSelection.oFeature.isInEditMode())\r\n                {\r\n                    oFeatureSelection.oSelectionData.select = false;\r\n\r\n                    this.options.eventData.push(oFeatureSelection.oSelectionData);\r\n                    delete this.options.featureSelectedList[oKeyList[iIndex]];\r\n                    this.applyHighlight2LeafletObject(oFeatureSelection.oFeature, oFeatureSelection.oSelectionData.selectedId, false);\r\n                }\r\n            }\r\n        },\r\n        _removeFeatureFromSelectedList: function(oFeature, sSubFeatureID)\r\n        {\r\n            var sKey = this.getKey(oFeature, sSubFeatureID);\r\n\r\n            if (this.options.featureSelectedList[sKey] !== undefined)\r\n            {\r\n                delete this.options.featureSelectedList[sKey];\r\n            }\r\n        },\r\n        _addFeatureToSelectedList: function(oSelectedListObject)\r\n        {\r\n            if (this.options.featureSelectedList[oSelectedListObject.sKey] === undefined)\r\n            {\r\n                this.options.featureSelectedList[oSelectedListObject.sKey] = oSelectedListObject;\r\n            }\r\n        },\r\n        isSelected: function(oFeature, sSubFeatureID)\r\n        {\r\n            var bSelected = false;\r\n            var sKey = this.getKey(oFeature);\r\n            \r\n            // First check if the entire feature is selected.\r\n            if (this.options.featureSelectedList[sKey] !== undefined)\r\n            {\r\n                return true;\r\n            }\r\n            \r\n            if (!emp.helpers.isEmptyString(sSubFeatureID))\r\n            {\r\n                sKey = this.getKey(oFeature, sSubFeatureID);\r\n                bSelected = ((this.options.featureSelectedList[sKey] === undefined)? false: true);\r\n            }\r\n            \r\n            return bSelected;\r\n        },\r\n        selectFeature: function(oFeature, sSubFeatureID)\r\n        {\r\n            var oSelectedListObject = this._createSelectionObject(oFeature, sSubFeatureID);\r\n\r\n            this.applyHighlight2LeafletObject(oFeature, sSubFeatureID, true);\r\n            this._addFeatureToSelectedList(oSelectedListObject);\r\n            this.options.eventData.push(oSelectedListObject.oSelectionData);\r\n        },\r\n        deselectFeature: function(oFeature, sSubFeatureID)\r\n        {\r\n            var sKey = this.getKey(oFeature, sSubFeatureID);\r\n            var oSelectedListObject = this.options.featureSelectedList[sKey];\r\n\r\n            if (emp.helpers.isEmptyString(sSubFeatureID))\r\n            {\r\n                this._removeFeaturesEntries(oFeature);\r\n            }\r\n            else if (oSelectedListObject)\r\n            {\r\n                this._removeFeatureFromSelectedList(oFeature, sSubFeatureID);\r\n                this.applyHighlight2LeafletObject(oFeature, sSubFeatureID, false);\r\n                oSelectedListObject.oSelectionData.select = false;\r\n                this.options.eventData.push(oSelectedListObject.oSelectionData);\r\n            }\r\n        },\r\n        generateEvent: function()\r\n        {\r\n            if (this.options.eventData.length > 0)\r\n            {\r\n                this.options.mapInstance.eventing.SelectionChange(this.options.eventData);\r\n            }\r\n            \r\n            this.resetEventData();\r\n        },\r\n        resetEventData: function()\r\n        {\r\n            if (this.options.eventData.length > 0)\r\n            {\r\n                this.options.eventData = [];\r\n            }\r\n        },\r\n        _applyHighlight: function(oLeafletObj, oFeature, sSubFeatureID, bSelected)\r\n        {\r\n            var iIndex;\r\n            \r\n            if (oLeafletObj instanceof L.LayerGroup)\r\n            {\r\n                var oItemList = oLeafletObj.getLayers();\r\n                \r\n                for (iIndex = 0; iIndex < oItemList.length; iIndex++)\r\n                {\r\n                    this._applyHighlight(oItemList[iIndex], oFeature, sSubFeatureID, bSelected);\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (typeof (oLeafletObj.empSelect) === 'function')\r\n                {\r\n                    if (emp.helpers.isEmptyString(sSubFeatureID))\r\n                    {\r\n                        if (bSelected && !this.isSelected(oFeature, sSubFeatureID))\r\n                        {\r\n                            oLeafletObj.empSelect();\r\n                        }\r\n                        else if (!bSelected && !this.isSelected(oFeature, sSubFeatureID))\r\n                        {\r\n                            oLeafletObj.empDeselect();\r\n                        }\r\n                    }\r\n                    else if (oLeafletObj && oLeafletObj.options && !emp.helpers.isEmptyString(oLeafletObj.options.sSubItemID))\r\n                    {\r\n                        if (oLeafletObj.options.sSubItemID === sSubFeatureID)\r\n                        {\r\n                            if (bSelected && !this.isSelected(oFeature, sSubFeatureID))\r\n                            {\r\n                                oLeafletObj.empSelect();\r\n                            }\r\n                            else if (!bSelected && !this.isSelected(oFeature, sSubFeatureID))\r\n                            {\r\n                                oLeafletObj.empDeselect();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        applyHighlight2LeafletObject: function(oFeature, sSubFeatureID, bSelected)\r\n        {\r\n            var oLeafletObj = oFeature.getLeafletObject();\r\n            \r\n            this._applyHighlight(oLeafletObj, oFeature, sSubFeatureID, bSelected);\r\n        },\r\n        _removeFeaturesEntries: function(oFeature)\r\n        {\r\n            var oFeatureSelection;\r\n            var sCoreID = oFeature.getCoreId();\r\n            var oKeyList = emp.helpers.associativeArray.getKeys(this.options.featureSelectedList);\r\n\r\n            for (var iIndex in oKeyList)\r\n            {\r\n                oFeatureSelection = this.options.featureSelectedList[oKeyList[iIndex]];\r\n\r\n                if (oFeatureSelection.oSelectionData.coreId === sCoreID)\r\n                {\r\n                    oFeatureSelection.oSelectionData.select = false;\r\n\r\n                    this.options.eventData.push(oFeatureSelection.oSelectionData);\r\n\r\n                    delete this.options.featureSelectedList[oKeyList[iIndex]];\r\n                    this.applyHighlight2LeafletObject(oFeatureSelection.oFeature, oFeatureSelection.oSelectionData.selectedId, false);\r\n                }\r\n            }\r\n        },\r\n        removeFeature: function(oFeature)\r\n        {\r\n            this._removeFeaturesEntries(oFeature);\r\n            this.generateEvent();\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\n\r\nleafLet.SelectionManager = L.Class.extend(leafLet.internalPrivateClass.SelectionManager());\r\n","/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.empObject = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            L.FeatureGroup.prototype.initialize.call(this);\r\n            var options = {\r\n                objectType:  args.item.globalType,\r\n                name: args.item.name,\r\n                description: args.item.description,\r\n                coreId: args.item.coreId || emp.helpers.id.newGUID(),\r\n                parentCoreId: args.item.parentCoreId,\r\n                parentId: args.item.parentId,\r\n                instanceInterface: args.instanceInterface,\r\n                oClusteredParent: undefined,\r\n                objectChildren: {}\r\n            };\r\n            L.Util.setOptions(this, options);\r\n        },\r\n        destroy: function()\r\n        {\r\n            var oParent = this.getParentObject();\r\n            \r\n            this.clearChildren();\r\n\r\n            if (oParent)\r\n            {\r\n                oParent.removeChildObject(this);\r\n            }\r\n\r\n            this.getEngineInstanceInterface().removeEmpObject(this);\r\n        },\r\n        clearChildren: function()\r\n        {\r\n            var aKeys = emp.helpers.associativeArray.getKeys(this.options.objectChildren);\r\n\r\n            for (var sKey in aKeys)\r\n            {\r\n                if (this.options.objectChildren[aKeys[sKey]].options.objectType ===\r\n                        leafLet.typeLibrary.objectType.FEATURE)\r\n                {\r\n                    if (this.options.objectChildren[aKeys[sKey]].isInEditMode())\r\n                    {\r\n                        var instanceInterface = this.getEngineInstanceInterface();\r\n                        instanceInterface.oCurrentEditor.cancelEdit();\r\n                        instanceInterface.oCurrentEditor.destroy();\r\n                        instanceInterface.bInEditMode = false;\r\n                        instanceInterface.bInDrawMode = false;\r\n                        instanceInterface.oCurrentEditor = undefined;\r\n                        instanceInterface.oEditTransaction.run();\r\n                        instanceInterface.oEditTransaction = undefined;\r\n                    }\r\n                }\r\n                this.options.objectChildren[aKeys[sKey]].destroy();\r\n                this.removeChildObjectById(aKeys[sKey]);\r\n            }\r\n\r\n            this.clearLayers();\r\n        },\r\n        getRootOverlay: function()\r\n        {\r\n            return this.getEngineInstanceInterface().rootOverlay;\r\n        },\r\n        getEngineInstanceInterface: function()\r\n        {\r\n            return this.options.instanceInterface;\r\n        },\r\n        getLeafletMap: function()\r\n        {\r\n            return this.getEngineInstanceInterface().leafletInstance;\r\n        },\r\n        getEngObject: function(sCoreId)\r\n        {\r\n            return this.getEngineInstanceInterface().mapEngObjectList[sCoreId];\r\n        },\r\n        getCoreId: function()\r\n        {\r\n            return this.options.coreId;\r\n        },\r\n        getParentCoreId: function()\r\n        {\r\n            return this.options.parentCoreId;\r\n        },\r\n        getOverlayId: function()\r\n        {\r\n            return undefined;\r\n        },\r\n        getFeatureId: function()\r\n        {\r\n            return undefined;\r\n        },\r\n        getParentId: function()\r\n        {\r\n            return this.options.parentId;\r\n        },\r\n        getName: function()\r\n        {\r\n            return this.options.name;\r\n        },\r\n        getDescription: function()\r\n        {\r\n            return this.options.description;\r\n        },\r\n        setName: function(sValue)\r\n        {\r\n            this.options.name = sValue;\r\n        },\r\n        getObjectType: function()\r\n        {\r\n            return this.options.objectType;\r\n        },\r\n        getChild: function(sCoreId)\r\n        {\r\n            return this.options.objectChildren[sCoreId];\r\n        },\r\n        getChildList: function()\r\n        {\r\n            return this.options.objectChildren;\r\n        },\r\n        getChildKeyList: function()\r\n        {\r\n            return emp.helpers.associativeArray.getKeys(this.options.objectChildren);\r\n        },\r\n        getParentObject: function()\r\n        {\r\n            var oParent = this.getEngObject(this.getParentCoreId());\r\n\r\n            if (!oParent)\r\n            {\r\n                oParent = this.getRootOverlay();\r\n            }\r\n            \r\n            return oParent;\r\n        },\r\n        getClusteredOverlay: function()\r\n        {\r\n            var oParent;\r\n            var oOverlay = undefined;\r\n            \r\n            switch (this.getObjectType())\r\n            {\r\n                case leafLet.typeLibrary.objectType.FEATURE:\r\n                case leafLet.typeLibrary.objectType.WMS:\r\n                    oParent = this.getEngObject(this.getParentCoreId());\r\n\r\n                    if (oParent)\r\n                    {\r\n                        oOverlay = oParent.getClusteredOverlay();\r\n                    }\r\n                    break;\r\n                case leafLet.typeLibrary.objectType.OVERLAY:\r\n                    if (this.isCurrentlyClustered())\r\n                    {\r\n                        oOverlay = this;\r\n                    }\r\n                    else\r\n                    {\r\n                        oParent = this.getEngObject(this.getParentCoreId());\r\n                        \r\n                        if (oParent)\r\n                        {\r\n                            oOverlay = oParent.getClusteredOverlay();\r\n                        }\r\n                    }\r\n                    break;\r\n            }\r\n            return oOverlay;\r\n        },\r\n        deactivateParentCluster: function()\r\n        {\r\n            var oParent = this.getParentObject();\r\n\r\n            if (oParent)\r\n            {\r\n                this.options.oClusteredParent = oParent.getClusteredOverlay();\r\n\r\n                if (this.options.oClusteredParent)\r\n                {\r\n                    this.options.oClusteredParent.clusterDeactivate();\r\n                }\r\n            }\r\n        },\r\n        activateParentCluster: function()\r\n        {\r\n            if (this.options.oClusteredParent)\r\n            {\r\n                this.options.oClusteredParent.clusterActivate();\r\n                this.options.oClusteredParent = undefined;\r\n            }\r\n        },\r\n        addChildObject: function(oChild)\r\n        {\r\n            if (this.options.objectChildren[oChild.getCoreId()] === undefined)\r\n            {\r\n                this.options.objectChildren[oChild.getCoreId()] = oChild;\r\n                this.addLayer(oChild);\r\n                \r\n                var oClusteredOverlay = this.getClusteredOverlay();\r\n\r\n                if (oClusteredOverlay)\r\n                {\r\n                    oClusteredOverlay.getClusterObject().addLayer(oChild);\r\n                }\r\n            }\r\n        },\r\n        removeChildObject: function(oFeature)\r\n        {\r\n            this.removeChildObjectById(oFeature.getCoreId());\r\n        },\r\n        removeChildObjectById: function(sCoreId)\r\n        {\r\n            var oChild = this.getChild(sCoreId);\r\n\r\n            if (oChild !== undefined)\r\n            {\r\n                if (this.hasLayer(oChild))\r\n                {\r\n                    this.removeLayer(oChild);\r\n                }\r\n                delete this.options.objectChildren[sCoreId];\r\n                \r\n                var oClusteredOverlay = this.getClusteredOverlay();\r\n\r\n                if (oClusteredOverlay)\r\n                {\r\n                    oClusteredOverlay.getClusterObject().removeLayer(oChild);\r\n                }\r\n            }\r\n        },\r\n        hasChildren: function()\r\n        {\r\n            return !emp.helpers.associativeArray.isEmpty(this.options.objectChildren);\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.empObject = L.FeatureGroup.extend(leafLet.internalPrivateClass.empObject());\r\n","/* global L, leafLet, emp */\r\nleafLet.internalPrivateClass.DisplayableObject = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                visible: args.item.visible,\r\n                leafletObject: undefined //set where needed\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.empObject.prototype.initialize.call(this, args);\r\n        },\r\n        destroy: function()\r\n        {\r\n            var oLeafletObject = this.getLeafletObject();\r\n\r\n            if (oLeafletObject !== undefined)\r\n            {\r\n                if (typeof (oLeafletObject.closePopup) === 'function')\r\n                {\r\n                    oLeafletObject.closePopup();\r\n                }\r\n\r\n                if (this.hasLayer(oLeafletObject))\r\n                {\r\n                    this.removeLayer(oLeafletObject);\r\n                }\r\n                this.options.leafletObject = undefined;\r\n            }\r\n            leafLet.typeLibrary.empObject.prototype.destroy.call(this);\r\n        },\r\n        getLeafletObject: function()\r\n        {\r\n            return this.options.leafletObject;\r\n        },\r\n        isVisible: function()\r\n        {\r\n            return this.options.visible;\r\n        },\r\n        setVisibility: function(oItem)\r\n        {\r\n            this.options.visible = oItem.visible;\r\n            if (this.getLeafletObject() !== undefined)\r\n            {\r\n                if (oItem.visible && !this.hasLayer(this.getLeafletObject()))\r\n                {\r\n                    var oMapBounds = this.getLeafletMap().getBounds();\r\n                    this._updateLeafletObject(oMapBounds, this.getLeafletObject(), false);\r\n                    this.addLayer(this.getLeafletObject());\r\n                }\r\n                else if (!oItem.visible && this.hasLayer(this.getLeafletObject()))\r\n                {\r\n                    this.removeLayer(this.getLeafletObject());\r\n                }\r\n            }\r\n            // We don't have to process its children because the core will send everything that get affected.\r\n        },\r\n        setStyle: function(sType, oProperties)\r\n        {\r\n            var oChild;\r\n            var aKeyList = this.getChildKeyList();\r\n            \r\n            if (this.getObjectType() === leafLet.typeLibrary.objectType.FEATURE)\r\n            {\r\n                this.setFeatureStyle(sType, oProperties);\r\n            }\r\n            \r\n            for (var iIndex = 0; iIndex < aKeyList.length; iIndex++)\r\n            {\r\n                oChild = this.getChild(aKeyList[iIndex]);\r\n                \r\n                switch (oChild.getObjectType())\r\n                {\r\n                    case leafLet.typeLibrary.objectType.FEATURE:\r\n                    case leafLet.typeLibrary.objectType.OVERLAY:\r\n                        oChild.setStyle(sType, oProperties);\r\n                        break;\r\n                    case leafLet.typeLibrary.objectType.WMS:\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.DisplayableObject = leafLet.typeLibrary.empObject.extend(leafLet.internalPrivateClass.DisplayableObject());\r\n","/* global leafLet, emp, L */\r\n\r\nleafLet.internalPrivateClass.EmpClusterGroup = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                oOverlay: args.overlay,\r\n                instanceInterface: args.instanceInterface\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            var oClusterDef = args.overlay.getClusterDef();\r\n            var oThis = this;\r\n            \r\n            L.MarkerClusterGroup.prototype.initialize.call(this, {\r\n                maxClusterRadius: oClusterDef.getDistance(),\r\n                zoomToBoundsOnClick: false,\r\n                iconCreateFunction: function(oCluster){\r\n                    return oThis._iconCreateFunction(oCluster);\r\n                }\r\n            });\r\n        },\r\n        getOverlay: function()\r\n        {\r\n            return this.options.oOverlay;\r\n        },\r\n        _ParamReplacementCB: function(oCluster, sParam)\r\n        {\r\n            var sRet = \"\";\r\n            var oOverlay = this.getOverlay();\r\n            var oClusterDef = oOverlay.getClusterDef();\r\n            \r\n            switch (sParam.toLowerCase())\r\n            {\r\n                case 'count':\r\n                    sRet = oCluster.getChildCount().toString();\r\n                    break;\r\n                case 'name':\r\n                    sRet = oOverlay.getName() || \"\";\r\n                    break;\r\n                case 'description':\r\n                    sRet = oOverlay.getDescription() || \"\";\r\n                    break;\r\n                case 'featurenames':\r\n                    var oFeatureList = oCluster.getAllChildMarkers();\r\n                    \r\n                    for (var iIndex = 0; iIndex < oFeatureList.length; iIndex++)\r\n                    {\r\n                        if (typeof (oFeatureList[iIndex].getName) === 'function')\r\n                        {\r\n                            sRet += oFeatureList[iIndex].getName();\r\n                            sRet += \"<br/>\";\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'maxclusterradius':\r\n                    sRet = oClusterDef.getDistance() + \"m\";\r\n                    break;\r\n                case 'styletype':\r\n                    var oClusterStyle = oClusterDef.getClusterStyle();\r\n                    \r\n                    if (oClusterStyle.getIconStyle())\r\n                    {\r\n                        sRet = \"Icon Style\";\r\n                    }\r\n                    else if (oClusterStyle.getPointStyle())\r\n                    {\r\n                        sRet = \"Point Style\";\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            return sRet;\r\n        },\r\n        _setClusterHeadingText: function(oCluster)\r\n        {\r\n            var oThis = this;\r\n            var sPopupText = \"\";\r\n            var oOverlay = this.getOverlay();\r\n            var oClusterDef = oOverlay.getClusterDef();\r\n            var oClusterStyle = oClusterDef.getClusterStyle();\r\n            var sTitle = emp.helpers.getReplacementString(oClusterStyle.getTitle(),\r\n                function(sParam)\r\n                {\r\n                    return oThis._ParamReplacementCB(oCluster, sParam);\r\n                }\r\n            );\r\n\r\n            if (sTitle.length > 0)\r\n            {\r\n                sPopupText += sTitle;\r\n            }\r\n            \r\n            oCluster.setPopupHeading(sPopupText);\r\n        },\r\n        _setClusterPopupText: function(oCluster)\r\n        {\r\n            var oThis = this;\r\n            var sPopupText = \"\";\r\n            var oOverlay = this.getOverlay();\r\n            var oClusterDef = oOverlay.getClusterDef();\r\n            var oClusterStyle = oClusterDef.getClusterStyle();\r\n            var sSummary = emp.helpers.getReplacementString(oClusterStyle.getSummary(), function(sParam)\r\n                {\r\n                    return oThis._ParamReplacementCB(oCluster, sParam);\r\n                });\r\n            var sDescription = emp.helpers.getReplacementString(oClusterStyle.getDescription(), function(sParam)\r\n                {\r\n                    return oThis._ParamReplacementCB(oCluster, sParam);\r\n                });\r\n\r\n            if (sSummary.length > 0)\r\n            {\r\n                sPopupText += sSummary + \"<br/>\";\r\n            }\r\n\r\n            if (sDescription.length > 0)\r\n            {\r\n                sPopupText += sDescription + \"<br/>\";\r\n            }\r\n            \r\n            oCluster.setPopupText(sPopupText);\r\n        },\r\n        _iconCreateFunction: function(oCluster)\r\n        {\r\n            var oClusterIcon;\r\n            var oThis = this;\r\n            var oOverlay = this.getOverlay();\r\n            var oClusterDef = oOverlay.getClusterDef();\r\n            var oClusterStyle = oClusterDef.getClusterStyle();\r\n            var oIconStyle = oClusterStyle.getIconStyle();\r\n            var oPointStyle = oClusterStyle.getPointStyle();\r\n            \r\n            oCluster.options.overlay = oOverlay;\r\n\r\n            if (oIconStyle)\r\n            {\r\n                var sStr = emp.helpers.getReplacementString(oClusterStyle.getLabel(), function(sParam)\r\n                    {\r\n                        return oThis._ParamReplacementCB(oCluster, sParam);\r\n                    });\r\n\r\n                var sURL = emp.helpers.getReplacementString(oIconStyle.getURL(), function(sParam)\r\n                    {\r\n                        return oThis._ParamReplacementCB(oCluster, sParam);\r\n                    });\r\n\r\n                if (sStr && sStr.length > 0)\r\n                {\r\n                    oClusterIcon = new L.DivIcon({\r\n                        className: \"iconStyleDiv\",\r\n                        html: \"<table><tbody><tr><td><img class='iconStyleDivIcon' src='\" + sURL + \"'></td><td class='iconStyleDivLabel'>\" + sStr + \"</td></tr></tbody></table>\"\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    oClusterIcon = new L.Icon({\r\n                        url: sURL\r\n                    });\r\n                }\r\n            }\r\n            else if (oPointStyle)\r\n            {\r\n                var sStr = emp.helpers.getReplacementString(oClusterStyle.getLabel(), function(sParam)\r\n                    {\r\n                        return oThis._ParamReplacementCB(oCluster, sParam);\r\n                    });\r\n                var sLabel = sStr.replace(\" \", \"\\n\");\r\n\r\n                var oImage = oPointStyle.createIcon(sLabel);\r\n                var iRadius = oPointStyle.getRadius();\r\n                oClusterIcon = new L.Icon({\r\n                    iconUrl: oImage.toDataURL(),\r\n                    iconAnchor: new L.Point(iRadius, iRadius),\r\n                    iconSize: new L.Point(oImage.width, oImage.height),\r\n                    popupAnchor:  new L.Point(iRadius, 0)\r\n                });\r\n            }\r\n            else\r\n            {\r\n                var sStr = emp.helpers.getReplacementString(oClusterStyle.getLabel(), function(sParam)\r\n                    {\r\n                        return oThis._ParamReplacementCB(oCluster, sParam);\r\n                    });\r\n                var sLabel = sStr.replace(\" \", \"\\n\");\r\n                var iRadius = 25;\r\n                var oImage = emp.helpers.createCircleCanvas({\r\n                        iRadius: iRadius,\r\n                        dOpacity: 1.0,\r\n                        sStrokeColor: \"darkBlue\",\r\n                        sFillColor: \"lightblue\",\r\n                        sTextColor: \"black\",\r\n                        sText: sLabel\r\n                    });\r\n\r\n                oClusterIcon = new L.Icon({\r\n                    iconUrl: oImage.toDataURL(),\r\n                    iconAnchor: new L.Point(iRadius / 2, iRadius / 2),\r\n                    iconSize: new L.Point(oImage.width, oImage.height),\r\n                    popupAnchor:  new L.Point(iRadius, 0)\r\n                });\r\n            }\r\n\r\n            this._setClusterPopupText(oCluster);\r\n            this._setClusterHeadingText(oCluster);\r\n\r\n            oCluster.on('click', function(oEvent){\r\n                if (oThis.getEngineInstanceInterface())\r\n                {\r\n                    oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent);\r\n                }\r\n            }, this);\r\n\r\n            oCluster.on('contextmenu', function(oEvent){\r\n                if (oThis.getEngineInstanceInterface())\r\n                {\r\n                    oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent);\r\n                }\r\n            }, this);\r\n\r\n            return oClusterIcon;\r\n        },\r\n        addLayer: function (layer) {\r\n            if (layer instanceof leafLet.typeLibrary.Feature)\r\n            {\r\n                var oChild;\r\n                var oKeyList = layer.getChildKeyList();\r\n\r\n                // If its a multi point TG we do not add it.\r\n                if ((layer.getFormat() !== emp.typeLibrary.featureFormatType.MILSTD) ||\r\n                        !layer.isMultiPointTG())\r\n                {\r\n                    if (layer.getLeafletObject())\r\n                    {\r\n                        var oThis = this;\r\n                        var oLeafletObject = layer.getLeafletObject();\r\n                        layer.removeLayer(oLeafletObject);\r\n                        this.addLayer(oLeafletObject);\r\n\r\n                        oLeafletObject.on('click', function(oEvent){\r\n                            if (oThis.getEngineInstanceInterface())\r\n                            {\r\n                                oEvent.target = layer;\r\n                                oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent);\r\n                            }\r\n                        }, this);\r\n\r\n                        oLeafletObject.on('contextmenu', function(oEvent){\r\n                            if (oThis.getEngineInstanceInterface())\r\n                            {\r\n                                oEvent.target = layer;\r\n                                oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent);\r\n                            }\r\n                        }, this);\r\n                    }\r\n                }\r\n\r\n                // Now we check to see if it\r\n                // has children to add.\r\n                if (layer.hasChildren())\r\n                {\r\n                    for (var iIndex = 0; iIndex < oKeyList.length; iIndex++)\r\n                    {\r\n                        oChild = layer.getChild(oKeyList[iIndex]);\r\n                        this.addLayer(oChild);\r\n                    }\r\n                }\r\n                return this;\r\n            }\r\n\r\n            if (layer instanceof L.LayerGroup) {\r\n                for (var i in layer._layers) {\r\n                    this.addLayer(layer._layers[i]);\r\n                }\r\n                return this;\r\n            }\r\n\r\n            //Don't cluster non point data\r\n            if (!layer.getLatLng) {\r\n                    this._nonPointGroup.addLayer(layer);\r\n                    return this;\r\n            }\r\n\r\n            if (!this._map) {\r\n                    this._needsClustering.push(layer);\r\n                    return this;\r\n            }\r\n\r\n            if (this.hasLayer(layer)) {\r\n                    return this;\r\n            }\r\n\r\n\r\n            //If we have already clustered we'll need to add this one to a cluster\r\n\r\n            if (this._unspiderfy) {\r\n                    this._unspiderfy();\r\n            }\r\n\r\n            this._addLayer(layer, this._maxZoom);\r\n\r\n            //Work out what is visible\r\n            var visibleLayer = layer,\r\n                    currentZoom = this._map.getZoom();\r\n            if (layer.__parent) {\r\n                    while (visibleLayer.__parent._zoom >= currentZoom) {\r\n                            visibleLayer = visibleLayer.__parent;\r\n                    }\r\n            }\r\n\r\n            if (this._currentShownBounds.contains(visibleLayer.getLatLng())) {\r\n                    if (this.options.animateAddingMarkers) {\r\n                            this._animationAddLayer(layer, visibleLayer);\r\n                    } else {\r\n                            this._animationAddLayerNonAnimated(layer, visibleLayer);\r\n                    }\r\n            }\r\n            return this;\r\n        },\r\n        removeLayer: function (layer) {\r\n            if (layer instanceof leafLet.typeLibrary.Feature)\r\n            {\r\n                var oChild;\r\n                var oKeyList = layer.getChildKeyList();\r\n\r\n                // If its a multi point TG we do not process it.\r\n                if ((layer.getFormat() !== emp.typeLibrary.featureFormatType.MILSTD) ||\r\n                        !layer.isMultiPointTG())\r\n                {\r\n                    if (layer.getLeafletObject())\r\n                    {\r\n                        var oLeafletObject = layer.getLeafletObject();\r\n\r\n                        this.removeLayer(oLeafletObject);\r\n                        layer.addLayer(oLeafletObject);\r\n\r\n                        oLeafletObject.off('click', function(oEvent){}, this);\r\n                        oLeafletObject.off('contextmenu', function(oEvent){}, this);\r\n                    }\r\n                }\r\n\r\n                // Now we check to see if it\r\n                // has children to process.\r\n                if (layer.hasChildren())\r\n                {\r\n                    for (var iIndex = 0; iIndex < oKeyList.length; iIndex++)\r\n                    {\r\n                        oChild = layer.getChild(oKeyList[iIndex]);\r\n                        this.removeLayer(oChild);\r\n                    }\r\n                }\r\n                return this;\r\n            }\r\n\r\n            if (layer instanceof L.LayerGroup)\r\n            {\r\n                    for (var i in layer._layers) {\r\n                        this.removeLayer(layer._layers[i]);\r\n                    }\r\n                    return this;\r\n            }\r\n\r\n            //Non point layers\r\n            if (!layer.getLatLng) {\r\n                    this._nonPointGroup.removeLayer(layer);\r\n                    return this;\r\n            }\r\n\r\n            if (!this._map) {\r\n                    if (!this._arraySplice(this._needsClustering, layer) && this.hasLayer(layer)) {\r\n                            this._needsRemoving.push(layer);\r\n                    }\r\n                    return this;\r\n            }\r\n\r\n            if (!layer.__parent) {\r\n                    return this;\r\n            }\r\n\r\n            if (this._unspiderfy) {\r\n                    this._unspiderfy();\r\n                    this._unspiderfyLayer(layer);\r\n            }\r\n\r\n            //Remove the marker from clusters\r\n            this._removeLayer(layer, true);\r\n\r\n            if (this._featureGroup.hasLayer(layer)) {\r\n                    this._featureGroup.removeLayer(layer);\r\n                    if (layer.clusterShow) {\r\n                            layer.clusterShow();\r\n                    }\r\n            }\r\n\r\n            return this;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.EmpClusterGroup = L.MarkerClusterGroup.extend(leafLet.internalPrivateClass.EmpClusterGroup());\r\n","/* global leafLet, L, emp */\r\n/* \r\n *\r\n */\r\nleafLet.internalPrivateClass.Overlay = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                overlayId: args.item.overlayId,\r\n                oProperties: args.item.properties,\r\n                oClusterDef: (args.item.properties.cluster? new emp.typeLibrary.Overlay.Cluster(args.item.properties.cluster): undefined),\r\n                bClusterActive: (args.item.properties.bClusterActive === true) || false,\r\n                oLeafletClusterObject: undefined\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.DisplayableObject.prototype.initialize.call(this, args);\r\n        },\r\n        destroy: function()\r\n        {\r\n            if (this.hasClusterDef())\r\n            {\r\n                this.clusterRemove();\r\n            }\r\n            leafLet.typeLibrary.DisplayableObject.prototype.destroy.call(this);\r\n        },\r\n        getOverlayId: function()\r\n        {\r\n            return this.options.overlayId;\r\n        },\r\n        getDescription: function()\r\n        {\r\n            return (this.options.oProperties.hasOwnProperty('description')? this.options.oProperties.description: \"\");\r\n        },\r\n        hasFeatures: function()\r\n        {\r\n            for(var sCoreId in this.options.objectChildren)\r\n            {\r\n                if (!this.options.objectChildren.hasOwnProperty(sCoreId)) {\r\n                    continue;\r\n                }\r\n                var oChild = this.options.objectChildren[sCoreId];\r\n\r\n                switch (oChild.getObjectType())\r\n                {\r\n                    case leafLet.typeLibrary.objectType.FEATURE:\r\n                        return true;\r\n                    default:\r\n                        break;\r\n                }\r\n\r\n                if (oChild.hasFeatures())\r\n                {\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n        getFeatureBounds: function()\r\n        {\r\n            var oBounds = undefined;\r\n            var oChildBounds;\r\n            var oChildList = this.getChildList();\r\n            \r\n            if (this.hasChildren())\r\n            {\r\n                var sKeys = emp.helpers.associativeArray.getKeys(oChildList);\r\n                \r\n                for (var iIndex = 0; iIndex < sKeys.length; iIndex++)\r\n                {\r\n                    oChildBounds = oChildList[sKeys[iIndex]].getFeatureBounds();\r\n                    \r\n                    if (oChildBounds)\r\n                    {\r\n                        if (!oBounds)\r\n                        {\r\n                            oBounds = new leafLet.typeLibrary.EmpBoundary(oChildBounds.getSouthWest(), oChildBounds.getNorthEast());\r\n                        }\r\n                        else\r\n                        {\r\n                            oBounds.addCoordinate(oChildBounds.getSouthWest());\r\n                            oBounds.addCoordinate(oChildBounds.getNorthEast());\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return oBounds;\r\n        },\r\n        _setClusterDef: function(oClusterDef)\r\n        {\r\n            if (!(oClusterDef instanceof emp.typeLibrary.Overlay.Cluster))\r\n            {\r\n                throw new Error(\"Invalid overlay cluster object.\");\r\n            }\r\n            \r\n            this.options.oClusterDef = new emp.typeLibrary.Overlay.Cluster(oClusterDef);\r\n        },\r\n        getClusterObject: function()\r\n        {\r\n            return this.options.oLeafletClusterObject;\r\n        },\r\n        setName: function(sValue)\r\n        {\r\n            leafLet.typeLibrary.DisplayableObject.prototype.setName.call(this, sValue);\r\n\r\n            if (this.isCurrentlyClustered())\r\n            {\r\n                // we need to reset the cluster popup.\r\n                this.clusterDeactivate();\r\n                this.clusterActivate();\r\n            }\r\n        },\r\n        isCurrentlyClustered: function()\r\n        {\r\n            return this.hasClusterDef() && this.isClusterActive();\r\n        },\r\n        hasClusterDef: function()\r\n        {\r\n            return (this.options.oClusterDef instanceof emp.typeLibrary.Overlay.Cluster);\r\n        },\r\n        getClusterDef: function()\r\n        {\r\n            return this.options.oClusterDef;\r\n        },\r\n        isClusterActive: function()\r\n        {\r\n            return this.options.bClusterActive;\r\n        },\r\n        activateCluster: function()\r\n        {\r\n            this.options.bClusterActive = false;\r\n            this.clusterActivate();\r\n        },\r\n        clusterSet: function(oClusterDef)\r\n        {\r\n            if (this.hasClusterDef())\r\n            {\r\n                this.clusterRemove();\r\n            }\r\n            \r\n            this._setClusterDef(oClusterDef);\r\n            this.clusterActivate();\r\n        },\r\n        _doClusterActivate: function()\r\n        {\r\n            var oKeyList = this.getChildKeyList();\r\n            var oChild;\r\n\r\n            this.options.oLeafletClusterObject = new leafLet.typeLibrary.EmpClusterGroup(\r\n                {\r\n                    overlay: this,\r\n                    instanceInterface: this.getEngineInstanceInterface()\r\n                }\r\n            );\r\n            \r\n            this.getLeafletMap().addLayer(this.getClusterObject());\r\n            \r\n            for (var iIndex = 0; iIndex < oKeyList.length; iIndex++)\r\n            {\r\n                oChild = this.getChild(oKeyList[iIndex]);\r\n\r\n                //this.removeLayer(oChild);\r\n                if (oChild instanceof leafLet.typeLibrary.Overlay)\r\n                {\r\n                    if (oChild.isCurrentlyClustered())\r\n                    {\r\n                        // If we run into an overlay that is currently clusterred we skip it.\r\n                        continue;\r\n                    }\r\n                }\r\n                this.getClusterObject().addLayer(oChild);\r\n            }\r\n        },\r\n        clusterActivate: function()\r\n        {\r\n            if (this.hasClusterDef() && !this.isClusterActive())\r\n            {\r\n                this.deactivateParentCluster();\r\n                this._doClusterActivate();\r\n                this.options.bClusterActive = true;\r\n                this.activateParentCluster();\r\n            }\r\n        },\r\n        clusterDeactivate: function()\r\n        {\r\n            if (this.hasClusterDef() && this.isClusterActive())\r\n            {\r\n                var oChild;\r\n                var oKeyList = this.getChildKeyList();\r\n                //var oParent = this.getParentObject();\r\n\r\n                this.deactivateParentCluster();\r\n                //this.getClusterObject().clearLayers();\r\n                \r\n                for (var iIndex = 0; iIndex < oKeyList.length; iIndex++)\r\n                {\r\n                    oChild = this.getChild(oKeyList[iIndex]);\r\n\r\n                    if (oChild instanceof leafLet.typeLibrary.Overlay)\r\n                    {\r\n                        if (oChild.isCurrentlyClustered())\r\n                        {\r\n                            // If we run into an overlay that is currently clusterred we skip it.\r\n                            continue;\r\n                        }\r\n                    }\r\n                    this.getClusterObject().removeLayer(oChild);\r\n                }\r\n\r\n                this.getLeafletMap().removeLayer(this.getClusterObject());\r\n\r\n                this.options.oLeafletClusterObject = undefined;\r\n                this.options.bClusterActive = false;\r\n            \r\n                //oParent.addLayer(this);\r\n                this.activateParentCluster();\r\n            }\r\n        },\r\n        clusterRemove: function()\r\n        {\r\n            if (this.hasClusterDef())\r\n            {\r\n                this.clusterDeactivate();\r\n                this.options.oClusterDef = undefined;\r\n                this.options.bClusterActive = false;\r\n            }\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.Overlay = leafLet.typeLibrary.DisplayableObject.extend(leafLet.internalPrivateClass.Overlay());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.Feature = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n                objectType: leafLet.typeLibrary.objectType.FEATURE,\r\n                featureId: args.item.featureId,\r\n                overlayId: args.item.overlayId,\r\n                parentId: args.item.parentId,\r\n                format: args.item.format,\r\n                url: args.item.url,\r\n                data: (args.item.data ? emp.helpers.copyObject(args.item.data) : undefined),\r\n                properties: (args.item.properties ? emp.helpers.copyObject(args.item.properties) : {}),\r\n                azimuth: ((args.item.properties && args.item.properties.azimuth) ? args.item.properties.azimuth: 0),\r\n                labelStyle: ((args.item.properties && args.item.properties.labelStyle) ? args.item.properties.labelStyle: args.instanceInterface.defaultLabelStyle),\r\n                selected: false,\r\n                bEditable: true,\r\n                isEditMode: false,\r\n                originalStyle: {} // Used to store the style of the feature before highlighting.\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.DisplayableObject.prototype.initialize.call(this, args);\r\n\r\n            this.setLeafletObject(this._createFeature(this.options));\r\n\r\n            this.on('click', function (oEvent) {\r\n                if (oEvent.target.getEngineInstanceInterface()) {\r\n                    oEvent.target.getEngineInstanceInterface().handleFeatureClicked(oEvent);\r\n                }\r\n            }, this);\r\n\r\n            this.on('contextmenu', function (oEvent) {\r\n                if (oEvent.target.getEngineInstanceInterface()) {\r\n                    oEvent.target.getEngineInstanceInterface().handleFeatureClicked(oEvent);\r\n                }\r\n            }, this);\r\n        },\r\n        destroy: function () {\r\n            this.getEngineInstanceInterface().oSelectionManager.removeFeature(this);\r\n            leafLet.typeLibrary.DisplayableObject.prototype.destroy.call(this);\r\n        },\r\n        getAzimuth: function() {\r\n            return this.options.azimuth;\r\n        },\r\n        getLabelStyle: function() {\r\n            return this.options.labelStyle;\r\n        },\r\n        isInEditMode: function () {\r\n            return this.options.isEditMode;\r\n        },\r\n        setEditMode: function () {\r\n            this.options.isEditMode = true;\r\n            if (this.isSelected()) {\r\n                this.render();\r\n                //this._unSelectFeature(this.getLeafletObject());\r\n            }\r\n        },\r\n        resetEditMode: function () {\r\n            this.options.isEditMode = false;\r\n            if (this.isSelected()) {\r\n                this.render();\r\n            }\r\n        },\r\n        setLeafletObject: function (oObject) {\r\n            //if (!oObject) {\r\n            //    return;\r\n            //}\r\n            \r\n            if (this.options.leafletObject && (this.options.leafletObject !== oObject)) {\r\n                //this.options.leafletObject.clearAllEventListeners();\r\n                this.removeLayer(this.options.leafletObject);\r\n            }\r\n\r\n            if (this.isVisible() && oObject) {\r\n                var oMapBounds = this.getLeafletMap().getBounds();\r\n                this._updateLeafletObject(oMapBounds, oObject, false);\r\n\r\n                if (oObject && (this.options.leafletObject !== oObject)) {\r\n                    this.addLayer(oObject);\r\n                }\r\n            }\r\n            this.options.leafletObject = oObject;\r\n        },\r\n        getOverlayId: function () {\r\n            return this.options.overlayId;\r\n        },\r\n        getFeatureId: function () {\r\n            return this.options.featureId;\r\n        },\r\n        getParentId: function () {\r\n            return this.options.parentId;\r\n        },\r\n        getData: function () {\r\n            return this.options.data;\r\n        },\r\n        setData: function (oData) {\r\n            this.options.data = oData;\r\n        },\r\n        getProperties: function () {\r\n            return this.options.properties;\r\n        },\r\n        setProperties: function (oProp) {\r\n            this.options.properties = oProp;\r\n        },\r\n        getFormat: function () {\r\n            return this.options.format;\r\n        },\r\n        isEditable: function () {\r\n            return this.options.bEditable;\r\n        },\r\n        isSelected: function (sSubItemID) {\r\n            var oSelectionManager = this.getEngineInstanceInterface().oSelectionManager;\r\n\r\n            return oSelectionManager.isSelected(this, sSubItemID);\r\n        },\r\n        isMilStd: function () {\r\n            return (this.options.format === emp.typeLibrary.featureFormatType.MILSTD);\r\n        },\r\n        isGeoJson: function () {\r\n            return (this.options.format === emp.typeLibrary.featureFormatType.GEOJSON);\r\n        },\r\n        isKML: function () {\r\n            return (this.options.format === emp.typeLibrary.featureFormatType.KML);\r\n        },\r\n        isAirspace: function () {\r\n            return (this.options.format === emp.typeLibrary.featureFormatType.AIRSPACE);\r\n        },\r\n        isImage: function () {\r\n            return (this.options.format === emp.typeLibrary.featureFormatType.IMAGE);\r\n        },\r\n        isAOI: function () {\r\n            return (this instanceof leafLet.typeLibrary.AOIFeature);\r\n        },\r\n        isGeoEllipse: function() {\r\n            return (this instanceof leafLet.typeLibrary.GeoEllipseFeature);\r\n        },\r\n        getFeatureBounds: function () {\r\n            var oBounds = undefined;\r\n            var oLeafletObject = this.getLeafletObject();\r\n            //var oMapBoundary = this.getEngineInstanceInterface().leafletInstance.getBounds();\r\n\r\n            if (oLeafletObject) {\r\n                if (typeof (oLeafletObject.getBounds) === 'function') {\r\n                    oBounds = new leafLet.typeLibrary.EmpBoundary(oLeafletObject.getBounds());\r\n                } else if (oLeafletObject instanceof L.Marker) {\r\n                    oBounds = new leafLet.typeLibrary.EmpBoundary(oLeafletObject.getLatLng().wrap(), oLeafletObject.getLatLng().wrap());\r\n                } else {\r\n                    throw new Error(\"Unable to get bounds of leaflet type.\");\r\n                }\r\n            }\r\n\r\n            return oBounds;\r\n        },\r\n        _createFeature: function (args) {\r\n            throw new Error(\"Class for feature of type \" + args.format + \" has not implemented a _createFeature function.\");\r\n        },\r\n        getAngleUnits: function () {\r\n            return leafLet.utils.AngleUnits.DEGREES;\r\n        },\r\n        getAzimuthUnits: function () {\r\n            return leafLet.utils.AngleUnits.DEGREES;\r\n        },\r\n        getAltitudeUnits: function () {\r\n            var sText = leafLet.utils.Units.FEET;\r\n\r\n            switch (this.options.format) {\r\n                case emp.typeLibrary.featureFormatType.GEOJSON:\r\n                case emp.typeLibrary.featureFormatType.AIRSPACE:\r\n                    sText = leafLet.utils.Units.METERS;\r\n                    break;\r\n                case emp.typeLibrary.featureFormatType.MILSTD:\r\n                    if (this.options.oMilStdModifiers.SYMSTD === 0) {\r\n                        sText = leafLet.utils.Units.FEET;\r\n                    } else {\r\n                        sText = leafLet.utils.Units.METERS;\r\n                    }\r\n                    break;\r\n                case emp.typeLibrary.featureFormatType.KML:\r\n                case emp.typeLibrary.featureFormatType.IMAGE:\r\n                    break;\r\n                default:\r\n                    // All Geo Spatial features are meters.\r\n                    sText = leafLet.utils.Units.METERS;\r\n                    break;\r\n            }\r\n\r\n            return sText;\r\n        },\r\n        getUnits: function () {\r\n            return leafLet.utils.Units.FEET;\r\n        },\r\n        getAltitudeModeAbbr: function () {\r\n            return leafLet.utils.AltitudeModeAbbr(this.options.properties.altitudeMode);\r\n        },\r\n        _getAltUnitsAndModeText: function () {\r\n            var sText = this.getAltitudeUnits();\r\n            var aAltMode = this.getAltitudeModeAbbr();\r\n\r\n            if (sText.length === 0) {\r\n                return \"\";\r\n            }\r\n\r\n            if (aAltMode.length > 0) {\r\n                sText += \" \" + aAltMode;\r\n            }\r\n\r\n            return sText;\r\n        },\r\n        _getPopupDescription: function () {\r\n            var sDescription = this.options.properties.description;\r\n\r\n            if (sDescription && (sDescription !== \"\")) {\r\n                //sDescription = \"<b>Description</b>:&nbsp;\" + sDescription + \"<br/>\";\r\n            } else {\r\n                sDescription = \"\";\r\n            }\r\n\r\n            return sDescription;\r\n        },\r\n        getPopupHeading: function () {\r\n            // Each feature class can override this function.\r\n            if (!this.options.name || (typeof (this.options.name) !== 'string') || (this.options.name === \"\")) {\r\n                return \"\";\r\n            }\r\n            return this.options.name;\r\n        },\r\n        getPopupText: function () {\r\n            // Each feature class can override this function.\r\n            return this._getPopupDescription();\r\n        },\r\n        updateFeature: function (args) {\r\n            var oNewLeafletObject;\r\n            var oArgs = {};\r\n            var oCoreFeature = args || {};\r\n\r\n            if (args.hasOwnProperty('bUpdateGraphic')) {\r\n                oArgs.bUpdateGraphic = args.bUpdateGraphic;\r\n            }\r\n\r\n            if (oCoreFeature.hasOwnProperty('format') && (oCoreFeature.format !== this.options.format)) {\r\n                throw new Error(\"A \" + this.options.format + \" feature can not be updated to a \" + oCoreFeature.format + \".\");\r\n            }\r\n\r\n            if (oCoreFeature.hasOwnProperty('name') && (oCoreFeature.name !== this.options.name)) {\r\n                oArgs.name = oCoreFeature.name;\r\n            } else {\r\n                oArgs.name = this.options.name;\r\n            }\r\n\r\n            if (oCoreFeature.hasOwnProperty('url') && (oCoreFeature.url !== this.options.url)) {\r\n                oArgs.url = oCoreFeature.url;\r\n            } else {\r\n                oArgs.url = this.options.url;\r\n            }\r\n\r\n            if (oCoreFeature.hasOwnProperty('data')) {\r\n                oArgs.data = emp.helpers.copyObject(oCoreFeature.data);\r\n            } else {\r\n                oArgs.data = this.options.data;\r\n            }\r\n\r\n            if (oCoreFeature.hasOwnProperty('properties')) {\r\n                oArgs.properties = emp.helpers.copyObject(oCoreFeature.properties);\r\n                if (oArgs.properties.lineColor !== this.getProperties().lineColor) {\r\n                    oArgs.bUpdateGraphic = true;\r\n                } else if (oArgs.properties.fillColor !== this.getProperties().fillColor) {\r\n                    oArgs.bUpdateGraphic = true;\r\n                }\r\n            } else {\r\n                oArgs.properties = this.options.properties;\r\n            }\r\n\r\n            oArgs.leafletObject = this.options.leafletObject;\r\n            //oArgs.instanceInterface = this.getEngineInstanceInterface();\r\n            oArgs.bEditable = this.options.bEditable;\r\n\r\n            oNewLeafletObject = this._updateFeature(oArgs);\r\n\r\n            this.setLeafletObject(oNewLeafletObject);\r\n\r\n            //this.options.featureId = oCoreFeature.featureId;\r\n            //this.options.overlayId = oCoreFeature.overlayId;\r\n            //this.options.parentId = oCoreFeature.parentId;\r\n            this.options.url = oArgs.url;\r\n            this.options.data = oArgs.data;\r\n            this.options.properties = oArgs.properties;\r\n            this.options.bEditable = oArgs.bEditable;\r\n            if (oCoreFeature.hasOwnProperty('name') && (oCoreFeature.name !== this.options.name)) {\r\n                this.setName(oArgs.name);\r\n            }\r\n        },\r\n        setSelection: function (bValue) {\r\n            if (bValue === this.options.selected) {\r\n                return;\r\n            }\r\n\r\n            this.options.selected = bValue;\r\n            if (!this.isInEditMode()) {\r\n                this.render();\r\n            }\r\n        },\r\n        render: function () {\r\n        },\r\n        _updateLeafletObject: function (oMapBounds, oLeafletObject, bWrappedAlready, iLevel) {\r\n            var oLatLngList;\r\n            var oNewLatLngList;\r\n            var bCoordWrapped = bWrappedAlready;\r\n            var iCurrentLevel = iLevel || 0;\r\n\r\n            if (!oLeafletObject) {\r\n                return bCoordWrapped;\r\n            }\r\n\r\n            if ((oLeafletObject instanceof L.Marker) ||\r\n                    (oLeafletObject instanceof L.Popup)) {\r\n                if (oLeafletObject.getLatLng()) {\r\n                    oLatLngList = [oLeafletObject.getLatLng()];\r\n                    bCoordWrapped = leafLet.utils.wrapCoordinates(oMapBounds, oLatLngList, bCoordWrapped);\r\n                    oLeafletObject.setLatLng(oLatLngList[0]);\r\n                }\r\n            } else if (oLeafletObject instanceof L.Polygon) {\r\n                oLatLngList = oLeafletObject.getLatLngs();\r\n\r\n                if (oLatLngList[0] && (oLatLngList[0][0] instanceof Array)) {\r\n                    for (var iList = 0; iList < oLatLngList.length; iList++) {\r\n                        bCoordWrapped = bCoordWrapped || leafLet.utils.wrapCoordinates(oMapBounds, oLatLngList[iIndex], bCoordWrapped);\r\n                    }\r\n                } else if (oLatLngList.length > 0) {\r\n                    bCoordWrapped = leafLet.utils.wrapCoordinates(oMapBounds, oLatLngList, bCoordWrapped);\r\n                }\r\n\r\n                if (bCoordWrapped) {\r\n                    oLeafletObject.setLatLngs(oLatLngList);\r\n                }\r\n            } else if (oLeafletObject instanceof L.Polyline) {\r\n                oNewLatLngList = [];\r\n                oLatLngList = oLeafletObject.getLatLngs();\r\n\r\n                if (oLatLngList.length > 0) {\r\n                    bCoordWrapped = leafLet.utils.wrapCoordinates(oMapBounds, oLatLngList, bCoordWrapped);\r\n                }\r\n\r\n                if (bCoordWrapped) {\r\n                    oLeafletObject.setLatLngs(oLatLngList);\r\n                }\r\n            } else if (oLeafletObject instanceof L.LayerGroup) {\r\n                var oItemList = oLeafletObject.getLayers();\r\n                var bHasNotWrapped = !bCoordWrapped;\r\n\r\n                for (var iIndex = 0; iIndex < oItemList.length; iIndex++) {\r\n                    bCoordWrapped = this._updateLeafletObject(oMapBounds, oItemList[iIndex], bCoordWrapped, iCurrentLevel + 1);\r\n                    if (bCoordWrapped && bHasNotWrapped) {\r\n                        bHasNotWrapped = false;\r\n                        if (iCurrentLevel === 0) {\r\n                            // We need the loop to start again.\r\n                            iIndex = -1;\r\n                        } else {\r\n                            // We need to break out so the top iteration starts over.\r\n                            break;\r\n                            ;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return bCoordWrapped;\r\n        },\r\n        updateCoordinates: function (oMapBounds) {\r\n            if (this.isVisible()) {\r\n                // We only update coordinates to the visible.\r\n                this._updateLeafletObject(oMapBounds, this.getLeafletObject(), false);\r\n            }\r\n        },\r\n        getLineStyle: function (sEMPStyle) {\r\n\r\n            var sLeaftletStyle;\r\n\r\n            switch (sEMPStyle) {\r\n                case emp.typeLibrary.OutlineStyleType.DOT:\r\n                    sLeaftletStyle = \"1, 5\";\r\n                    break;\r\n                case emp.typeLibrary.OutlineStyleType.DASH:\r\n                    sLeaftletStyle = \"10, 5\";\r\n                    break;\r\n                case emp.typeLibrary.OutlineStyleType.DASH_DOT:\r\n                    sLeaftletStyle = \"10, 5, 1, 5\";\r\n                    break;\r\n                case emp.typeLibrary.OutlineStyleType.LONG_DASH:\r\n                    sLeaftletStyle = \"20, 5\";\r\n                    break;\r\n                case emp.typeLibrary.OutlineStyleType.LONG_DASH_DOT:\r\n                    sLeaftletStyle = \"20, 5, 1, 5\";\r\n                    break;\r\n                case emp.typeLibrary.OutlineStyleType.SOLID:\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            return sLeaftletStyle;\r\n        },\r\n        setFeatureStyle: function (sType, oProperties) {\r\n            switch (this.getFormat()) {\r\n                case emp.typeLibrary.featureFormatType.KML:\r\n                case emp.typeLibrary.featureFormatType.GEOJSON:\r\n                    this.setFeatureStyleProperties(sType, oProperties);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n        _propagateEvent: function (e) {\r\n            if (e.target instanceof leafLet.typeLibrary.Feature) {\r\n                // If its a feature don't propagate.\r\n                return;\r\n            }\r\n\r\n            e = L.extend({\r\n                layer: e.target,\r\n                target: this\r\n            }, e);\r\n            this.fire(e.type, e);\r\n        },\r\n        _getPolygonProperties: function(args) {\r\n            var argsProperties = leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(), args.properties);\r\n            var oProperties = {\r\n                smoothFactor: 1.0,\r\n                noClip: false,\r\n                oFeature: this\r\n            };\r\n            var strokeColor = (argsProperties.color? argsProperties.color: undefined);\r\n            var fillColor = (argsProperties.fillColor? argsProperties.fillColor: undefined);\r\n\r\n            // If they are both missing set the default stroke.\r\n            if ((strokeColor === undefined) && (fillColor === undefined)) {\r\n                strokeColor = '#' + this.getEngineInstanceInterface().defaultStrokeStyle.color;\r\n            }\r\n\r\n            if (strokeColor) {\r\n                oProperties['stroke'] = true;\r\n                oProperties['color'] = strokeColor;\r\n                oProperties['opacity'] = (argsProperties.opacity? argsProperties.opacity: this.getEngineInstanceInterface().defaultStrokeStyle.opacity);\r\n                oProperties['weight'] = (argsProperties.weight? argsProperties.weight: this.getEngineInstanceInterface().defaultStrokeStyle.width);\r\n            } else {\r\n                oProperties['stroke'] = false;\r\n                oProperties['color'] = null;\r\n            }\r\n\r\n            if (this.isSelected()) {\r\n                oProperties['tempColor'] = oProperties['color'];\r\n                oProperties['tempWeight'] = oProperties['weight'];\r\n                oProperties['color'] = '#' + this.getEngineInstanceInterface().selectAttributes.color;\r\n                oProperties['weight'] = this.getEngineInstanceInterface().selectAttributes.width;\r\n                oProperties['stroke'] = true;\r\n            }\r\n\r\n            if (fillColor) {\r\n                oProperties['fill'] = true;\r\n                oProperties['fillColor'] = fillColor;\r\n                oProperties['fillOpacity'] = (argsProperties.fillOpacity? argsProperties.fillOpacity: 0.8);\r\n            } else {\r\n                oProperties['fill'] = false;\r\n            }\r\n\r\n            return oProperties;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.Feature = leafLet.typeLibrary.DisplayableObject.extend(leafLet.internalPrivateClass.Feature());\r\n","\r\n/* global L, leafLet, emp */\r\nleafLet.internalPrivateClass.WMS = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            leafLet.typeLibrary.DisplayableObject.prototype.initialize.call(this, args);\r\n            var options = {\r\n                id: args.item.id,\r\n                overlayId: args.item.overlayId,\r\n                transparent: args.item.params.transparent,\r\n                format: args.item.params.format,\r\n                version: args.item.params.version,\r\n                activeLayer: (args.item.activeLayers? emp.helpers.copyObject(args.item.activeLayers): []),\r\n                url: args.item.url,\r\n                useProxy: args.item.useProxy\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            this.options.leafletObject = this.createWMS(this.options);\r\n            if (this.options.leafletObject.wmsParams.hasOwnProperty('useProxy')) {\r\n                delete this.options.leafletObject.wmsParams.useProxy;\r\n            }\r\n            if ((this.options.leafletObject !== undefined) && this.options.visible && (this.options.activeLayer.length > 0))\r\n            {\r\n                this.getEngineInstanceInterface().addMapLayer(this.options.leafletObject);\r\n            }\r\n        },\r\n        destroy: function()\r\n        {\r\n            if (this.options.leafletObject !== undefined)\r\n            {\r\n                this.getEngineInstanceInterface().removeMapLayer(this.options.leafletObject);\r\n                this.options.leafletObject = undefined;\r\n            }\r\n            leafLet.typeLibrary.DisplayableObject.prototype.destroy.call(this);\r\n        },\r\n        getOverlayId: function()\r\n        {\r\n            return this.options.overlayId;\r\n        },\r\n        getId: function()\r\n        {\r\n            return this.options.id;\r\n        },\r\n        createWMS: function(args)\r\n        {\r\n            var oWMS = undefined;\r\n\r\n            oWMS = new L.TileLayer.WMS(args.url, {\r\n                layers: args.activeLayer.join(','),\r\n                format: args.format,\r\n                transparent: args.transparent,\r\n                version: args.version,\r\n                useProxy: args.useProxy\r\n            });\r\n\r\n            return oWMS;\r\n        },\r\n        updateWMS: function(args)\r\n        {\r\n            var options = {\r\n                id: args.id,\r\n                overlayId: args.overlayId,\r\n                transparent: args.params.transparent,\r\n                format: args.params.format,\r\n                version: args.params.version,\r\n                activeLayer: (args.activeLayers? emp.helpers.copyObject(args.activeLayers): []),\r\n                url: args.url,\r\n                useProxy: args.useProxy\r\n            };\r\n            var oWMS = this.createWMS(options);\r\n\r\n            if (this.hasLayer(this.options.leafletObject))\r\n            {\r\n                // Its on the map so we need to remove it.\r\n                this.getEngineInstanceInterface().removeMapLayer(this.options.leafletObject);\r\n            }\r\n\r\n            this.options.leafletObject = oWMS;\r\n            if (this.options.visible)\r\n            {\r\n                this.getEngineInstanceInterface().addMapLayer(this.options.leafletObject);\r\n            }\r\n        },\r\n        setVisibility: function(oItem)\r\n        {\r\n            this.options.activeLayer = (oItem.activeLayers? emp.helpers.copyObject(oItem.activeLayers): []);\r\n\r\n            if (this.options.leafletObject !== undefined)\r\n            {\r\n                if (oItem.visible)\r\n                {\r\n                    this.options.visible = true;\r\n                    this.options.leafletObject.setParams({\r\n                        layers: this.options.activeLayer.join(',')\r\n                    });\r\n                    this.getEngineInstanceInterface().addMapLayer(this.options.leafletObject);\r\n                }\r\n                else if (!oItem.visible && (this.options.activeLayer.length === 0))\r\n                {\r\n                    this.options.visible = false;\r\n                    this.getEngineInstanceInterface().removeMapLayer(this.options.leafletObject);\r\n                }\r\n                else\r\n                {\r\n                    this.options.leafletObject.setParams({\r\n                        layers: this.options.activeLayer.join(',')\r\n                    });\r\n                }\r\n            }\r\n            // We don't have to process its children because the core will send everything that get affected.\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.WMS = leafLet.typeLibrary.DisplayableObject.extend(leafLet.internalPrivateClass.WMS());\r\n","/* global leafLet, emp, L */\r\n\r\nleafLet.typeLibrary.EmpBoundary = function(oSouthWest, oNorthEast) {\r\n    var degNorth = undefined;\r\n    var degSouth = undefined;\r\n    var degWest = undefined;\r\n    var degEast = undefined;\r\n\r\n    this.initialize = function(oSW, oNE) {\r\n        var oLatLngList;\r\n        var index;\r\n\r\n        if (oSW === undefined) {\r\n            throw new Error(\"Invalid oSouthWest parameters.\");\r\n        } else if (oNE === undefined) {\r\n            if (oSW instanceof L.LatLngBounds) {\r\n                if (oSW.getSouthWest() && oSW.getNorthEast()) {\r\n                    oNE = oSW.getNorthEast();\r\n                    oSW = oSW.getSouthWest();\r\n                } else {\r\n                    throw new Error(\"Invalid type oSouthWest.\");\r\n                }\r\n            } else if (oSW instanceof Array) {\r\n                if (oSW.length < 2) {\r\n                    throw new Error(\"Invalid type oSouthWest.\");\r\n                }\r\n                \r\n                for (index = 0; index < oSW.length; index++) {\r\n                    publicInterface.addCoordinate(oSW[index]);\r\n                }\r\n                return;\r\n            } else if (oSW instanceof L.LatLng) {\r\n                oNE = oSW;\r\n            } else {\r\n                throw new Error(\"Invalid type oSouthWest.\");\r\n            }\r\n        }\r\n\r\n        oNE = oNE.wrap();\r\n        oSW = oSW.wrap();\r\n\r\n        degNorth = oNE.lat;\r\n        degEast = oNE.lng;\r\n        degSouth = oSW.lat;\r\n        degWest = oSW.lng;\r\n    };\r\n\r\n    var publicInterface = {\r\n        addCoordinate: function(oCoord) {\r\n            var oCoordinate = oCoord.wrap();\r\n\r\n            if (!degNorth) {\r\n                degNorth = oCoordinate.lat;\r\n                degSouth = oCoordinate.lat;\r\n                degWest = oCoordinate.lng;\r\n                degEast = oCoordinate.lng;\r\n            } else {\r\n                if (oCoordinate.lat > degNorth) {\r\n                    degNorth = oCoordinate.lat;\r\n                } else if (oCoordinate.lat < degSouth) {\r\n                    degSouth = oCoordinate.lat;\r\n                }\r\n\r\n                var degSE2Coord = emp.geoLibrary.GetAzimuth({x: degEast, y: degSouth}, {x: oCoordinate.lng, y: oCoordinate.lat});\r\n\r\n                if (degWest <= degEast) {\r\n                    // The bounds does NOT cross the IDL.\r\n                    if (degSE2Coord >= 0.0) {\r\n                        // The Logitude is east of the east edge.\r\n                        degEast = oCoordinate.lng;\r\n                    } else {\r\n                        var degSW2Coord = emp.geoLibrary.GetAzimuth({x: degWest, y: degSouth}, {x: oCoordinate.lng, y: oCoordinate.lat});\r\n\r\n                        if (degSW2Coord < 0.0) {\r\n                            // The Logitude is to the west of the west edge.\r\n                            degWest = oCoordinate.lng;\r\n                        }\r\n                    }\r\n                } else {\r\n                    // The bounds does cross the IDL.\r\n                    if (degSE2Coord <= 0.0) {\r\n                        // The Logitude is east of the east edge.\r\n                        degEast = oCoordinate.lng;\r\n                    } else {\r\n                        var degSW2Coord = emp.geoLibrary.GetAzimuth({x: degWest, y: degSouth}, {x: oCoordinate.lng, y: oCoordinate.lat});\r\n\r\n                        if (degSW2Coord > 0.0) {\r\n                            // The Logitude is to the west of the west edge.\r\n                            degWest = oCoordinate.lng;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        getNorth: function() {\r\n            return degNorth;\r\n        },\r\n        getSouth: function() {\r\n            return degSouth;\r\n        },\r\n        getWest: function() {\r\n            return degWest;\r\n        },\r\n        getEast: function() {\r\n            return degEast;\r\n        },\r\n        getCenter: function() {\r\n            var lat = (degNorth + degSouth) / 2.0;\r\n            var lng = (degEast + degWest) / 2.0;\r\n            \r\n            if (degWest > degEast) {\r\n                if (lng > 0) {\r\n                    lng -= 180.0;\r\n                } else {\r\n                    lng += 180.0;\r\n                }\r\n            }\r\n            return new L.LatLng(lat, lng);\r\n        },\r\n        getCenterWest: function() {\r\n            var dCenterLat = (degNorth + degSouth) / 2.0;\r\n            return new L.LatLng(dCenterLat, degWest);\r\n        },\r\n        getCenterEast: function() {\r\n            var dCenterLat = (degNorth + degSouth) / 2.0;\r\n            return new L.LatLng(dCenterLat, degEast);\r\n        },\r\n        getSouthWest: function() {\r\n            return new L.LatLng(degSouth, degWest);\r\n        },\r\n        getNorthEast: function() {\r\n            return new L.LatLng(degNorth, degEast);\r\n        },\r\n        getSouthEast: function() {\r\n            return new L.LatLng(degSouth, degEast);\r\n        },\r\n        getNorthWest: function() {\r\n            return new L.LatLng(degNorth, degWest);\r\n        },\r\n        containsCoordiante: function(oCoordinate) {\r\n            if (!degNorth) {\r\n                return false;\r\n            } else {\r\n                if (oCoordinate.lat > degNorth) {\r\n                    return false;\r\n                } else if (oCoordinate.lat < degSouth) {\r\n                    return false;\r\n                }\r\n\r\n                if (this.containsIDL()) {\r\n                    if ((degEast < oCoordinate.lng) && (oCoordinate.lng < degWest)) {\r\n                        return false;\r\n                    }\r\n                } else {\r\n                    if ((degEast < oCoordinate.lng) || (oCoordinate.lng < degWest)) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n        contained: function(oBoundary) {\r\n            if (!degNorth || !oBoundary.getNorth()) {\r\n                return false;\r\n            } else {\r\n                if (oBoundary.getNorth() > degNorth) {\r\n                    return false;\r\n                } else if (oBoundary.getSouth() < degSouth) {\r\n                    return false;\r\n                }\r\n\r\n                var degSE2Coord = emp.geoLibrary.GetAzimuth({x: degEast, y: degSouth}, {x: oBoundary.getEast(), y: oBoundary.getNorth()});\r\n\r\n                if (degWest < degEast) {\r\n                    // The IDL is not in the bounds.\r\n                    if (degSE2Coord > 0.0) {\r\n                        // The Logitude is east of the east edge.\r\n                        return false;\r\n                    } else {\r\n                        var degSW2Coord = emp.geoLibrary.GetAzimuth({x: degWest, y: degSouth}, {x: oCoordinate.lng, y: oCoordinate.lat});\r\n\r\n                        if (degSW2Coord < 0.0) {\r\n                            // The Logitude is to the west of the west edge.\r\n                            return false;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (degSE2Coord < 0.0) {\r\n                        // The Logitude is east of the east edge.\r\n                        return false;\r\n                    } else {\r\n                        var degSW2Coord = emp.geoLibrary.GetAzimuth({x: degWest, y: degSouth}, {x: oCoordinate.lng, y: oCoordinate.lat});\r\n\r\n                        if (degSW2Coord > 0.0) {\r\n                            // The Logitude is to the west of the west edge.\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n        intersects: function(oBoundary) {\r\n            if (!degNorth || !oBoundary.getNorth()) {\r\n                return false;\r\n            } else {\r\n                if ((oBoundary.getNorth() < degSouth) ||\r\n                        (oBoundary.getSouth() > degNorth)) {\r\n                    // The oBoundary is below or above this one.\r\n                    return false;\r\n                } else if (this.containsIDL()) {\r\n                    var bounds = new leafLet.typeLibrary.EmpBoundary(this.getSouthWest(), new L.LatLng(degNorth, 180.0));\r\n                    \r\n                    if (!oBoundary.intersects(bounds)) {\r\n                        bounds = new leafLet.typeLibrary.EmpBoundary(new L.LatLng(degSouth, -180.0), this.getNorthEast());\r\n                        return oBoundary.intersects(bounds);\r\n                    }\r\n                }else if (oBoundary.containsIDL()) {\r\n                    var bounds = new leafLet.typeLibrary.EmpBoundary(oBoundary.getSouthWest(), new L.LatLng(oBoundary.getNorth(), 180.0));\r\n                    \r\n                    if (!this.intersects(bounds)) {\r\n                        bounds = new leafLet.typeLibrary.EmpBoundary(new L.LatLng(oBoundary.getSouth(), -180.0), oBoundary.getNorthEast());\r\n                        return this.intersects(bounds);\r\n                    }\r\n                } else {\r\n                    var oSouthWest = this.getSouthWest();\r\n                    var oBNorthEast = oBoundary.getNorthEast();\r\n                    var dBrng = oSouthWest.bearingTo(oBNorthEast);\r\n\r\n                    if ((dBrng < 0.0) || (dBrng > 90.0)) {\r\n                        return false;\r\n                    }\r\n\r\n                    var oSouthEast = this.getSouthEast();\r\n                    var oBNorthWest = oBoundary.getNorthWest();\r\n\r\n                    dBrng = oSouthEast.bearingTo(oBNorthWest);\r\n\r\n                    if (dBrng < 270.0) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n        isEmpty: function() {\r\n            return (!degNorth || !degSouth || !degWest || !degEast);\r\n        },\r\n        getCenterWidth: function() {\r\n            var oCenterWest = this.getCenterWest();\r\n            var oCenterEast = this.getCenterEast();\r\n            return oCenterWest.distanceTo(oCenterEast);\r\n        },\r\n        setCenterWidth: function(dWidth) {\r\n            var oCenter = this.getCenter();\r\n            var oNewWestCoord = oCenter.destinationPoint(-90.0, dWidth / 2.0);\r\n            var oNewEastCoord = oCenter.destinationPoint(90.0, dWidth / 2.0);\r\n\r\n            degWest = oNewWestCoord.lng;\r\n            degEast = oNewEastCoord.lng;\r\n        },\r\n        containsIDL: function() {\r\n            return (degWest > degEast);\r\n        }\r\n    };\r\n\r\n    this.initialize(oSouthWest, oNorthEast);\r\n\r\n    return publicInterface;\r\n};\r\n","/* global L, leafLet, emp, armyc2, sec */\r\n\r\nleafLet.internalPrivateClass.MilStdFeature = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                oMilStdModifiers: {},\r\n                sBasicSymbolCode: undefined,\r\n                i2525Version: 0,\r\n                bIsMultiPointTG: false\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        getMilStdModifiers: function()\r\n        {\r\n            return this.options.oMilStdModifiers;\r\n        },\r\n        getBasicSymbolCode: function()\r\n        {\r\n            return this.options.sBasicSymbolCode;\r\n        },\r\n        getAzimuthUnits: function()\r\n        {\r\n            var sUnits = leafLet.utils.AngleUnits.DEGREES;\r\n            var RendererSettings = armyc2.c2sd.renderer.utilities.RendererSettings;\r\n            var oBasicSymbolCode = leafLet.utils.milstd.basicSymbolCode;\r\n            \r\n            switch (this.getBasicSymbolCode())\r\n            {\r\n                case oBasicSymbolCode.RECTANGULAR_TARGET:\r\n                    switch (this.get2525Version())\r\n                    {\r\n                        case RendererSettings.Symbology_2525Bch2_USAS_13_14:\r\n                            sUnits = leafLet.utils.AngleUnits.MILS;\r\n                            break;\r\n                        case RendererSettings.Symbology_2525C:\r\n                            sUnits = leafLet.utils.AngleUnits.DEGREES;\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n            return sUnits;\r\n        },\r\n        getAltitudeUnits: function()\r\n        {\r\n            var sRet = leafLet.utils.Units.FEET;\r\n            \r\n            return sRet;\r\n        },\r\n        getUnits: function()\r\n        {\r\n            var retValue = leafLet.utils.Units.METERS;\r\n            var RendererSettings = armyc2.c2sd.renderer.utilities.RendererSettings;\r\n            var oBasicSymbolCode = leafLet.utils.milstd.basicSymbolCode;\r\n            \r\n            switch (this.getBasicSymbolCode())\r\n            {\r\n                case oBasicSymbolCode.RECTANGULAR_TARGET:\r\n/*\r\n                    switch (this.get2525Version())\r\n                    {\r\n                        case RendererSettings.Symbology_2525Bch2_USAS_13_14:\r\n                        case RendererSettings.Symbology_2525C:\r\n                            retValue = leafLet.utils.Units.METERS;\r\n                            break;\r\n                    }\r\n*/\r\n                    break;\r\n            }\r\n            \r\n            return retValue;\r\n        },\r\n        getPopupHeading: function()\r\n        {\r\n            var sText = this.getName();\r\n            \r\n            if (!sText || (typeof (sText) !== 'string') || (sText === \"\"))\r\n            {\r\n                // There is no name, check for a unique identifier.\r\n                var cMilStdModifiers = leafLet.utils.milstd.Modifiers;\r\n                var oModifiers = this.getMilStdModifiers();\r\n                \r\n                if (oModifiers.hasOwnProperty(cMilStdModifiers.UNIQUE_DESIGNATOR_1))\r\n                {\r\n                    sText = oModifiers[cMilStdModifiers.UNIQUE_DESIGNATOR_1];\r\n                }\r\n                else\r\n                {\r\n                    sText = \"\";\r\n                }\r\n            }\r\n\r\n            return sText;\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            if (this.options.leafletObject instanceof L.Marker)\r\n            {\r\n                var oCoordList = this.getCoordinateList();\r\n                \r\n                sPopupText = \"<b>Symbol Code</b>:&nbsp;\" + this.options.data.symbolCode +\r\n                        \"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<b>Lat</b>:&nbsp;\" + oCoordList[0].lat.toFixed(5) +\r\n                        \"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<b>Lon</b>:&nbsp;\" + oCoordList[0].lng.toFixed(5) +\r\n                        (!isNaN(oCoordList[0].alt)? \"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<b>Alt</b>:&nbsp;\" + oCoordList[0].alt + this._getAltUnitsAndModeText(): \"\") + \r\n                        \"<br/><br/>\" + this._getPopupDescription();\r\n            }\r\n            else\r\n            {\r\n                sPopupText = \"<b>Symbol Code</b>:&nbsp;\" + this.options.data.symbolCode + \"<br/><br/>\" +\r\n                        this._getPopupDescription();\r\n            }\r\n            \r\n            return sPopupText;\r\n        },\r\n        _createMultiPointFeature: function(args, oModifier, i2525Version)\r\n        {\r\n            var sDescription = args.properties.description || \"\";\r\n\r\n            leafLet.utils.milstd.applyRequiredModifiers(args.data.symbolCode, oModifier, i2525Version, this.getEngineInstanceInterface().getLeafletMap());\r\n\r\n            return leafLet.utils.milstd.renderMPGraphic({\r\n                instanceInterface: this.getEngineInstanceInterface(),\r\n                isSelected: args.selected,\r\n                sID: args.coreId,\r\n                sName: args.name,\r\n                sDescription: sDescription,\r\n                sSymbolCode: args.data.symbolCode,\r\n                oCoordData: args.data,\r\n                oModifiers: oModifier,\r\n                i2525Version: i2525Version,\r\n                oFeature: this\r\n            });\r\n        },\r\n        _createSinglePointFeature: function(oItem, oModifiers)\r\n        {\r\n            var oFeature;\r\n            var oCoordinates = leafLet.utils.geoJson.convertCoordinatesToLatLng(oItem.data)[0];\r\n            var oMilStdIcon = this._getSinglePointIcon(oItem, oModifiers);\r\n\r\n            oFeature = new L.Marker(oCoordinates, {\r\n                icon: oMilStdIcon,\r\n                oFeature: this\r\n            });\r\n            \r\n            return oFeature;\r\n        },\r\n        _modifierOnList: function(sModifier)\r\n        {\r\n            return ((this.getEngineInstanceInterface().oLabelList.indexOf(sModifier) === -1)? false: true);\r\n        },\r\n        _getSinglePointIcon: function(oItem, oMainModifiers)\r\n        {\r\n          var iconUrl,\r\n              sModifier,\r\n              oModifierArray = [],\r\n              oModifiers = {},\r\n              sClassName = '',\r\n              strippedSymbolCode = '',\r\n              msa = armyc2.c2sd.renderer.utilities.MilStdAttributes,\r\n              image,\r\n              oMilStdIcon,\r\n              oOffset,\r\n              oImageBounds,\r\n              renderingOptimization,\r\n              baseURL,\r\n              sModifiers,\r\n              size,\r\n              svgColor;\r\n\r\n          if (!oMainModifiers.hasOwnProperty('T') ||\r\n            (oMainModifiers.hasOwnProperty('T') && (oMainModifiers.T !== oItem.name))) {\r\n            // If there is no T or its diff than name.\r\n            oMainModifiers[\"CN\"] = oItem.name;\r\n          }\r\n\r\n          for (sModifier in oMainModifiers) {\r\n            if (oMainModifiers.hasOwnProperty(sModifier)) {\r\n              switch (sModifier) {\r\n                case leafLet.utils.milstd.longModifiers.FILL_COLOR:\r\n                  if (L.Browser.canvas) {\r\n                    oModifiers[msa.FillColor] = '#' + oMainModifiers[sModifier];\r\n                  } else {\r\n                    oModifiers['fillcolor'] = oMainModifiers[sModifier];\r\n                  }\r\n                  break;\r\n                case leafLet.utils.milstd.longModifiers.LINE_COLOR:\r\n                  if (L.Browser.canvas) {\r\n                    oModifiers[msa.LineColor] = '#' + oMainModifiers[sModifier];\r\n                  } else {\r\n                    oModifiers['linecolor'] = oMainModifiers[sModifier];\r\n                  }\r\n                  break;\r\n                case leafLet.utils.milstd.Modifiers.STANDARD:\r\n                  oModifiers[sModifier] = oMainModifiers[sModifier];\r\n                  break;\r\n                default:\r\n                  if (this._modifierOnList(sModifier)) {\r\n                    oModifiers[sModifier] = oMainModifiers[sModifier];\r\n                  }\r\n                  break;\r\n              }\r\n            }\r\n          }\r\n\r\n          oModifiers.SIZE = this.getEngineInstanceInterface().iMilStdIconSize;\r\n          if (this.isSelected()) {\r\n            sClassName = 'icon-selected';\r\n          }\r\n\r\n          if (L.Browser.canvas) {\r\n            image = armyc2.c2sd.renderer.MilStdIconRenderer.Render(oItem.data.symbolCode, oModifiers);\r\n            iconUrl = image.toDataUrl();\r\n            oOffset = image.getCenterPoint();\r\n            oImageBounds = image.getImageBounds();\r\n            renderingOptimization = this.getEngineInstanceInterface().renderingOptimization;\r\n            oMilStdIcon;\r\n            if (renderingOptimization.viewInZone) {\r\n              switch (renderingOptimization.viewInZone) {\r\n                case \"farDistanceZone\":\r\n                  switch (oItem.data.symbolCode.charAt(1)) {\r\n                    case \"H\":\r\n                    case \"S\":\r\n                    case \"J\":\r\n                    case \"K\":\r\n                      svgColor = renderingOptimization.farDistanceThreshold.RED;\r\n                      break;\r\n                    case \"F\":\r\n                    case \"D\":\r\n                    case \"A\":\r\n                    case \"M\":\r\n                      svgColor = renderingOptimization.farDistanceThreshold.BLUE;\r\n                      break;\r\n                    case \"N\":\r\n                    case \"L\":\r\n                      svgColor = renderingOptimization.farDistanceThreshold.GREEN;\r\n                      break;\r\n                    case \"U\":\r\n                    case \"P\":\r\n                    case \"G\":\r\n                    case \"W\":\r\n                      svgColor = renderingOptimization.farDistanceThreshold.YELLOW;\r\n                      break;\r\n                    default:\r\n                      svgColor = renderingOptimization.farDistanceThreshold.YELLOW;\r\n                      break;\r\n                  }\r\n                  image = renderingOptimization.farDistanceThreshold.getSVG({\r\n                    x: oOffset.x,\r\n                    y: oOffset.y,\r\n                    radius: 3,\r\n                    color: svgColor\r\n                  });\r\n                  iconUrl = 'data:image/svg+xml,' + image;\r\n                  break;\r\n                case \"midDistanceZone\":\r\n                  strippedSymbolCode = oItem.data.symbolCode.slice(0, 10).concat(\"-----\");\r\n                  image = armyc2.c2sd.renderer.MilStdIconRenderer.Render(strippedSymbolCode, {SIZE: oModifiers.SIZE});\r\n                  iconUrl = image.toDataUrl();\r\n                  oOffset = image.getCenterPoint();\r\n                  oImageBounds = image.getImageBounds();\r\n                  break;\r\n              }\r\n            }\r\n            oMilStdIcon = new L.Icon({\r\n              iconUrl: iconUrl,\r\n              iconAnchor: new L.Point(oOffset.x, oOffset.y),\r\n              iconSize: new L.Point(oImageBounds.width, oImageBounds.height),\r\n              popupAnchor: new L.Point(oOffset.x, oOffset.y),\r\n              className: sClassName\r\n            });\r\n\r\n            return oMilStdIcon;\r\n          }\r\n          sModifiers = \"\";\r\n          for (sModifier in oModifiers) {\r\n            if (oModifiers.hasOwnProperty(sModifier)) {\r\n              oModifierArray.push(sModifier + \"=\" + oModifiers[sModifier]);\r\n            }\r\n          }\r\n          if (oModifierArray.length > 0) {\r\n            sModifiers = \"?\" + oModifierArray.join(\"&\");\r\n          }\r\n          if (!emp.map.engine.rendererUrl || emp.map.engine.rendererUrl === \"\") {\r\n            baseURL = location.protocol + \"//\" + location.host + \"/\";\r\n          } else {\r\n            baseURL = emp.map.engine.rendererUrl;\r\n          }\r\n          iconUrl = baseURL + \"/mil-sym-service/renderer/image/\" + oItem.data.symbolCode + sModifiers;\r\n          size = oModifiers.size || 32;\r\n          oMilStdIcon = new L.Icon({\r\n            iconUrl: iconUrl,\r\n            className: sClassName\r\n          });\r\n\r\n          return oMilStdIcon;\r\n        },\r\n        _updateSinglePointFeature: function(oItem, oModifiers, bUpdateIcon)\r\n        {\r\n            var oCoordinates = leafLet.utils.geoJson.convertCoordinatesToLatLng(oItem.data)[0];\r\n\r\n            if (bUpdateIcon)\r\n            {\r\n                var oIcon = this._getSinglePointIcon(oItem, oModifiers);\r\n                oItem.leafletObject.setLatLng(oCoordinates);\r\n                oItem.leafletObject.setIcon(oIcon);\r\n            }\r\n            else\r\n            {\r\n                oItem.leafletObject.setLatLng(oCoordinates);\r\n            }\r\n            oItem.leafletObject.update();\r\n\r\n            return oItem.leafletObject;\r\n        },\r\n        _createFeature: function(oOptions)\r\n        {\r\n            var oFeature = undefined;\r\n            var sSymbolCode = oOptions.data.symbolCode;\r\n            var oModifiers = leafLet.utils.milstd.convertModifiersTo2525(oOptions);\r\n            var i2525Version = oModifiers[leafLet.utils.milstd.Modifiers.STANDARD];\r\n            var isMultiPoint = armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sSymbolCode, i2525Version);\r\n            var sBasicSymbolCode = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(sSymbolCode);\r\n            var oSymbolDef = armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(sBasicSymbolCode, i2525Version);\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oOptions.data);\r\n\r\n            if (oSymbolDef && (oCoordList.length < oSymbolDef.minPoints))\r\n            {\r\n                // We can't draw it yet.\r\n                this.options.oMilStdModifiers = new leafLet.typeLibrary.MilStdModifiers(this, oModifiers);\r\n                this.options.properties.modifiers = this.options.oMilStdModifiers.toLongModifiers();\r\n                this.options.i2525Version = i2525Version;\r\n                this.options.sBasicSymbolCode = sBasicSymbolCode;\r\n                return undefined;\r\n            }\r\n\r\n            if (isMultiPoint)\r\n            {\r\n                oFeature = this._createMultiPointFeature(oOptions, oModifiers, i2525Version);\r\n                oOptions.bIsMultiPointTG = true;\r\n            }\r\n            else if (oOptions.data.coordinates.length > 0)\r\n            {\r\n                oFeature = this._createSinglePointFeature(oOptions, oModifiers);\r\n                oOptions.bIsMultiPointTG = false;\r\n            }\r\n\r\n            if (oFeature)\r\n            {\r\n                var oMapBoundry = this.getEngineInstanceInterface().leafletInstance.getBounds();\r\n                this._updateLeafletObject(oMapBoundry, oFeature, false);\r\n            }\r\n\r\n            this.options.oMilStdModifiers = new leafLet.typeLibrary.MilStdModifiers(this, oModifiers);\r\n            this.options.properties.modifiers = this.options.oMilStdModifiers.toLongModifiers();\r\n            this.options.i2525Version = i2525Version;\r\n            this.options.sBasicSymbolCode = sBasicSymbolCode;\r\n            return oFeature;\r\n        },\r\n        getCoordinateList: function()\r\n        {\r\n            return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getData());\r\n        },\r\n        setCoordinates: function(oLatLngList)\r\n        {\r\n            leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getData(), oLatLngList);\r\n        },\r\n        isMultiPointTG: function()\r\n        {\r\n            return this.options.bIsMultiPointTG;\r\n        },\r\n        getFeatureBounds: function()\r\n        {\r\n            var oEmpBoundary = leafLet.typeLibrary.Feature.prototype.getFeatureBounds.call(this);\r\n            \r\n            if (!oEmpBoundary || oEmpBoundary.isEmpty())\r\n            {\r\n                var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(this.options.data);\r\n\r\n                oEmpBoundary = new leafLet.typeLibrary.EmpBoundary(oCoordList);\r\n            }\r\n\r\n            return oEmpBoundary;\r\n        },\r\n        get2525Version: function()\r\n        {\r\n            return this.options.i2525Version;\r\n        },\r\n        render: function()\r\n        {\r\n            if (this.isVisible())\r\n            {\r\n                var oLeafletObject = this._createFeature(this.options);\r\n\r\n                this.setLeafletObject(oLeafletObject);\r\n            }\r\n        },\r\n        _updateMilStdFeature: function(args, oModifiers, bUpdateGraphic)\r\n        {\r\n            var oFeature = undefined;\r\n            var sSymbolCode = args.data.symbolCode;\r\n            var i2525Version = oModifiers[leafLet.utils.milstd.Modifiers.STANDARD];\r\n            var isMultiPoint = armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sSymbolCode, i2525Version);\r\n\r\n            if (isMultiPoint)\r\n            {\r\n                oFeature = this._createMultiPointFeature(args, oModifiers, i2525Version);\r\n                args.bIsMultiPointTG = true;\r\n            }\r\n            else\r\n            {\r\n                oFeature = this._updateSinglePointFeature(args, oModifiers, bUpdateGraphic);\r\n            }\r\n\r\n            if (oFeature)\r\n            {\r\n                var oMapBoundry = this.getEngineInstanceInterface().leafletInstance.getBounds();\r\n                this._updateLeafletObject(oMapBoundry, oFeature, false);\r\n            }\r\n\r\n            return oFeature;\r\n        },\r\n        updateCoordinates: function(oMapBounds)\r\n        {\r\n            if (this.isVisible() && !this.isMultiPointTG())\r\n            {\r\n                // We only update coordinates to the visible NON tactical graphics.\r\n                // TG will get re-rendered.\r\n                this._updateLeafletObject(oMapBounds, this.getLeafletObject(), false);\r\n            }\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oNewFeafure;\r\n            var sModifier;\r\n            var bUpdateGraphic = (oArgs.bUpdateGraphic === true);\r\n            var oMilStdModifiers = this.options.oMilStdModifiers;\r\n            var oMilStdUtil = leafLet.utils.milstd;\r\n            var oModifiers = oMilStdUtil.convertModifiersTo2525(oArgs);\r\n\r\n            if (!bUpdateGraphic) {\r\n                if ((oArgs.hasOwnProperty('name') && (oArgs['name'] !== this.getName()))) {\r\n                    bUpdateGraphic = true;\r\n                } else if (oArgs.data.symbolCode !== this.options.data.symbolCode) {\r\n                    // The symbol changed we need to regenerate the graphic.\r\n                    bUpdateGraphic = true;\r\n                } else {\r\n                    for (sModifier in oModifiers) {\r\n                        if (!oModifiers.hasOwnProperty(sModifier)) {\r\n                            continue;\r\n                        }\r\n                        if (oMilStdModifiers.oModifiers[sModifier] === undefined)\r\n                        {\r\n                            // There is a new modifiers.\r\n                            // We need to regenerate the graphic.\r\n                            bUpdateGraphic = true;\r\n                            break;\r\n                        }\r\n                        else if (!oMilStdUtil.areModifierValuesEqual(oMilStdModifiers.oModifiers[sModifier], oModifiers[sModifier]))\r\n                        {\r\n                            // The modifier changed.\r\n                            // We need to regenerate the graphic.\r\n                            bUpdateGraphic = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (!bUpdateGraphic)\r\n                    {\r\n                        for (sModifier in oMilStdModifiers.oModifiers)\r\n                        {\r\n                            if (!oMilStdModifiers.oModifiers.hasOwnProperty(sModifier)) {\r\n                                continue;\r\n                            }\r\n                            if ((sModifier !== 'CN') && (oModifiers[sModifier] === undefined))\r\n                            {\r\n                                // A modifier was removed.\r\n                                // We need to regenerate the graphic.\r\n                                bUpdateGraphic = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            oNewFeafure = this._updateMilStdFeature(oArgs, oModifiers, bUpdateGraphic);\r\n            this.options.oMilStdModifiers = new leafLet.typeLibrary.MilStdModifiers(this, oModifiers);\r\n            this.options.properties.modifiers = this.options.oMilStdModifiers.toLongModifiers();\r\n            this.options.bIsMultiPointTG = oArgs.bIsMultiPointTG;\r\n\r\n            return oNewFeafure;\r\n        },\r\n        updateIconSize: function()\r\n        {\r\n            var sSymbolCode = this.options.data.symbolCode;\r\n            var oModifiers = this.options.oMilStdModifiers.toModifiers();\r\n            var i2525Version = oModifiers[leafLet.utils.milstd.Modifiers.STANDARD];\r\n            var isMultiPoint = armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sSymbolCode, i2525Version);\r\n\r\n            if (!isMultiPoint)\r\n            {\r\n                this._updateSinglePointFeature(this.options, oModifiers, true);\r\n            }\r\n        },\r\n        resetEditMode: function()\r\n        {\r\n            this.options.isEditMode = false;\r\n            if (this.isSelected() && this.isMultiPointTG())\r\n            {\r\n                this.render();\r\n            }\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.MilStdFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.MilStdFeature());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.KMLFeature = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                sKMLName: undefined,\r\n                sKMLDesctiption: undefined\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        getPopupHeading: function(oLeafletObject)\r\n        {\r\n            var sText = this.options.name;\r\n            var sKMLName = '';\r\n            \r\n            if (oLeafletObject && oLeafletObject.options.hasOwnProperty('kmlName'))\r\n            {\r\n                sKMLName = oLeafletObject.options.kmlName;\r\n            }\r\n            \r\n            if ((typeof (sText) === 'string') && (sText.length > 0))\r\n            {\r\n                if ((typeof (sKMLName) === 'string') && (sKMLName.length > 0))\r\n                {\r\n                    if (sText !== sKMLName)\r\n                    {\r\n                        sText += \" (\" + sKMLName + \")\";\r\n                    }\r\n                }\r\n            }\r\n            else if ((typeof (sKMLName) === 'string') && (sKMLName.length > 0))\r\n            {\r\n                sText = sKMLName;\r\n            }\r\n            \r\n            return sText;\r\n        },\r\n        getPopupText: function(oLeafletObject)\r\n        {\r\n            var sPopupText = \"\";\r\n            var sKMLDescription = '';\r\n            \r\n            if (oLeafletObject && oLeafletObject.options.hasOwnProperty('kmlDescription'))\r\n            {\r\n                sKMLDescription = oLeafletObject.options.kmlDescription;\r\n            }\r\n\r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                var oLatLng = oLeafletObject.getLatLng().wrap();\r\n                sPopupText += \r\n                        \"<center><b>Lat</b>:&nbsp;\" + oLatLng.lat.toFixed(5) + \"<br/><b>Lon</b>:&nbsp;\" + oLatLng.lng.toFixed(5) +\r\n                        ((oLatLng.alt)? \"<br/><b>Alt</b>:&nbsp;\" + oLatLng.alt + this._getAltUnitsAndModeText(): \"\") + \"</center><br/>\";\r\n            }\r\n\r\n            if (!emp.util.isEmptyString(this._getPopupDescription()))\r\n            {\r\n                sPopupText += this._getPopupDescription();\r\n            }\r\n            else if (!emp.util.isEmptyString(sKMLDescription))\r\n            {\r\n                //sPopupText += \"<br/><center><b>Description</b></center>\" +\r\n                //    this.options.sKMLDesctiption;\r\n                sPopupText += sKMLDescription;\r\n            }\r\n            return sPopupText;\r\n        },\r\n        _getUrlViaProxy: function(sURL)\r\n        {\r\n            var data = \"mime=text/xml&url=\" + escape(sURL),\r\n                proxyUrl;\r\n            // Check for V2 environment\r\n            if (emp.hasOwnProperty(\"appSetup\")) {\r\n              proxyUrl = emp.appSetup.urlProxy;\r\n            } else {\r\n              proxyUrl = emp.util.config.getProxyUrl();\r\n            }\r\n            \r\n            return proxyUrl + \"?\" + data;\r\n        },\r\n        _setKMLParameters: function(oKmlDoc, oOptions)\r\n        {\r\n            if (oKmlDoc)\r\n            {\r\n                // We need the name and description if there was any in the KML in case there is\r\n                // none in the feature.\r\n                // However if the KML has more than one name and description,\r\n                // we take the first one we find.\r\n                emp.$.each(emp.$(oKmlDoc).find(\"name\"), function(i, oNameElem)\r\n                {\r\n                    if (oOptions.sKMLName === undefined)\r\n                    {\r\n                        oOptions.sKMLName = oNameElem.textContent;\r\n                    }\r\n                });\r\n                emp.$.each(emp.$(oKmlDoc).find(\"description\"), function(i, oDescElem)\r\n                {\r\n                    if (oOptions.sKMLDesctiption === undefined)\r\n                    {\r\n                        oOptions.sKMLDesctiption = oDescElem.textContent;\r\n                    }\r\n                });\r\n            }\r\n        },\r\n        _createFeatureFromString: function(oOptions)\r\n        {\r\n            var oFeature = new leafLet.typeLibrary.EmpKmlObject(oOptions.data, {\r\n                async: false,\r\n                kmlDoc: undefined,\r\n                oFeature: this,\r\n                oFeatureProperties: oOptions.properties,\r\n                sProxyUrl: (this.options.instanceInterface.bUseProxy? this.options.instanceInterface.getProxyURL(): undefined),\r\n                basePath: this.getEngineInstanceInterface().getBasePath()\r\n            });\r\n\r\n            if (oFeature === undefined)\r\n            {\r\n                throw new Error(\"KML returned no object.\");\r\n            }\r\n            else if ((oFeature instanceof L.LayerGroup) &&\r\n                    (oFeature.getLayers().length === 1))\r\n            {\r\n                var oChild = oFeature.getLayers()[0];\r\n\r\n                if ((oChild instanceof L.Polygon) ||\r\n                    (oChild instanceof L.Polyline) ||\r\n                    (oChild instanceof L.Marker))\r\n                {\r\n                    oOptions.bEditable = true;\r\n                }\r\n                else\r\n                {\r\n                    oOptions.bEditable = false;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                oOptions.bEditable = false;\r\n            }\r\n\r\n            this._setKMLParameters(oFeature.options.kmlDoc, oOptions);\r\n\r\n            return oFeature;\r\n        },\r\n        _createFeatureFromURL: function(oOptions)\r\n        {\r\n            var oFeature = new leafLet.typeLibrary.EmpKmlObject(oOptions.url, {\r\n                async: false,\r\n                kmlDoc: undefined,\r\n                oFeature: this,\r\n                oFeatureProperties: oOptions.properties,\r\n                sProxyUrl: (this.options.instanceInterface.bUseProxy? this.options.instanceInterface.getProxyURL(): undefined),\r\n                basePath: this.getEngineInstanceInterface().getBasePath()\r\n            });\r\n\r\n            if (oFeature === undefined)\r\n            {\r\n                throw new Error(\"KML returned no object.\");\r\n            }\r\n            else\r\n            {\r\n                oOptions.bEditable = false;\r\n                this._setKMLParameters(oFeature.options.kmlDoc, oOptions);\r\n            }\r\n\r\n            return oFeature;\r\n        },\r\n        _createFeature: function(args)\r\n        {\r\n            var oFeature = undefined;\r\n\r\n            if (args.url && (args.url !== \"\"))\r\n            {\r\n                oFeature = this._createFeatureFromURL(args);\r\n            }\r\n            else\r\n            {\r\n                oFeature = this._createFeatureFromString(args);\r\n            }\r\n\r\n            return oFeature;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            return this._createFeature(oArgs);\r\n        },\r\n/*\r\n        setLeafletObject: function(oObject)\r\n        {\r\n            leafLet.typeLibrary.Feature.prototype.setLeafletObject.call(this, oObject);\r\n            if (this.options.leafletObject)\r\n            {\r\n                if (this.isSelected())\r\n                {\r\n                    this._setSelected(this.options.leafletObject);\r\n                }\r\n            }\r\n        },\r\n        _setSelected: function(oLayer)\r\n        {\r\n            if (oLayer === undefined)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oLayer instanceof L.LayerGroup)\r\n            {\r\n                for (var Key in oLayer._layers)\r\n                {\r\n                    this._setSelected(oLayer._layers[Key]);\r\n                }\r\n            }\r\n            else if (oLayer instanceof L.Marker)\r\n            {\r\n                emp.$(oLayer._icon).addClass('icon-selected');\r\n            }\r\n        },\r\n*/\r\n        setFeatureStyleProperties: function(sType, oProperties)\r\n        {\r\n            var bDoUpdate = false;\r\n            var bMultiGeometry = false;\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var oFeatureProperties = this.getProperties();\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                if (oLeafletObject.getLayers().length === 1)\r\n                {\r\n                    oLeafletObject = oLeafletObject.getLayers()[0];\r\n                }\r\n                else\r\n                {\r\n                    bMultiGeometry = true;\r\n                }\r\n            }\r\n            \r\n            if ((sType === emp.typeLibrary.OverlayStyleType.POINT) &&\r\n                    (oLeafletObject instanceof L.Marker))\r\n            {\r\n                if (oProperties.hasOwnProperty('iconUrl'))\r\n                {\r\n                    oFeatureProperties.iconUrl = oProperties.iconUrl;\r\n                    bDoUpdate = true;\r\n                }\r\n            }\r\n            else if ((sType === emp.typeLibrary.OverlayStyleType.LINE) &&\r\n                    (oLeafletObject instanceof L.Polyline))\r\n            {\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    oFeatureProperties.lineColor = oProperties.lineColor;\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        oFeatureProperties.lineWidth = oProperties.lineWidth;\r\n                    }                    \r\n                    bDoUpdate = true;\r\n                }\r\n            }\r\n            else if ((sType === emp.typeLibrary.OverlayStyleType.POLYGON) &&\r\n                    (oLeafletObject instanceof L.Polygon))\r\n            {\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    oFeatureProperties.lineColor = oProperties.lineColor;\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        oFeatureProperties.lineWidth = oProperties.lineWidth;\r\n                    }\r\n                    \r\n                    bDoUpdate = true;\r\n                }\r\n\r\n                if (oProperties.hasOwnProperty('fillColor'))\r\n                {\r\n                    oFeatureProperties.fillColor = oProperties.fillColor;\r\n                    bDoUpdate = true;\r\n                }\r\n            }\r\n            else if ((sType === emp.typeLibrary.OverlayStyleType.MULTIGEOMETRY) &&\r\n                    bMultiGeometry)\r\n            {\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    oFeatureProperties.lineColor = oProperties.lineColor;\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        oFeatureProperties.lineWidth = oProperties.lineWidth;\r\n                    }\r\n                    \r\n                    bDoUpdate = true;\r\n                }\r\n\r\n                if (oProperties.hasOwnProperty('fillColor'))\r\n                {\r\n                    oFeatureProperties.fillColor = oProperties.fillColor;\r\n                    bDoUpdate = true;\r\n                }\r\n                \r\n                if (oProperties.hasOwnProperty('iconUrl'))\r\n                {\r\n                    oFeatureProperties.iconUrl = oProperties.iconUrl;\r\n                    bDoUpdate = true;\r\n                }\r\n            }\r\n\r\n            if (bDoUpdate)\r\n            {\r\n                this.updateFeature(this.options);\r\n            }\r\n        },\r\n        render: function()\r\n        {\r\n            this.updateFeature(this.options);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.KMLFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.KMLFeature());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.GeoJsonFeature = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n\r\n            if (this.options.leafletObject instanceof L.Marker)\r\n            {\r\n                var oLatLng = this.options.leafletObject.getLatLng();\r\n                if (oLatLng !== undefined)\r\n                {\r\n                    oLatLng = oLatLng.wrap();\r\n                    sPopupText += \r\n                            \"<center><b>Lat</b>:&nbsp;\" + oLatLng.lat.toFixed(5) +\r\n                            \"<br/><b>Lon</b>:&nbsp;\" + oLatLng.lng.toFixed(5) +\r\n                            ((oLatLng.alt)? \"<br/><b>Alt</b>:&nbsp;\" + oLatLng.alt + this._getAltUnitsAndModeText(): \"\") + \"</center><br/>\";\r\n                }\r\n            }\r\n\r\n            sPopupText += this._getPopupDescription();\r\n\r\n            return sPopupText;\r\n        },\r\n        _createGeoJSONPolygon: function(oGeoJSON, oProperties)\r\n        {\r\n            var bIsSelected = this.isSelected();\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oGeoJSON);\r\n\r\n            if ((oCoordList === undefined) || (oCoordList.length < 3))\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            if (bIsSelected)\r\n            {\r\n                oProperties['tempColor'] = oProperties['color'] || L.LEAFLET_DEFAULT_LINE_COLOR;\r\n                oProperties['tempWeight'] = oProperties['weigh'] || L.LEAFLET_DEFAULT_LINE_WEIGHT;\r\n\r\n                oProperties['color'] = '#' + this.options.instanceInterface.selectAttributes.color;\r\n                oProperties['weigh'] = this.options.instanceInterface.selectAttributes.width;\r\n            }\r\n\r\n            oProperties.oFeature = this;\r\n\r\n            return new L.Polygon(oCoordList, oProperties);\r\n        },\r\n        _createGeoJSONLine: function(oGeoJSON, oProperties)\r\n        {\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oGeoJSON);\r\n            var bIsSelected = this.isSelected();\r\n\r\n            if ((oCoordList === undefined) || (oCoordList.length < 2))\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            if (bIsSelected)\r\n            {\r\n                oProperties['tempColor'] = oProperties['color'] || L.LEAFLET_DEFAULT_LINE_COLOR;\r\n                oProperties['tempWeight'] = oProperties['weigh'] || L.LEAFLET_DEFAULT_LINE_WEIGHT;\r\n\r\n                oProperties['color'] = '#' + this.options.instanceInterface.selectAttributes.color;\r\n                oProperties['weigh'] = this.options.instanceInterface.selectAttributes.width;\r\n            }\r\n\r\n            oProperties.oFeature = this;\r\n\r\n            return new L.Polyline(oCoordList, oProperties);\r\n        },\r\n        _getDefaultIcon: function()\r\n        {\r\n            var oIcon;\r\n            var oDefaultIcon = emp.utilities.icon.getDefaultIcon(this.getEngineInstanceInterface().getBasePath());\r\n            var sURL = (this.options.instanceInterface.bUseProxy? \r\n                            this.getEngineInstanceInterface().getProxyURL() + \"?\" + \"mime=image/*&url=\" + escape(oDefaultIcon.iconUrl): \r\n                            oDefaultIcon.iconUrl);\r\n            \r\n            oIcon = new leafLet.typeLibrary.EmpIcon({\r\n                iconUrl: sURL,\r\n                iconAnchor: new L.Point(oDefaultIcon.offset.x, oDefaultIcon.offset.y),\r\n                iconAnchorType: {x: oDefaultIcon.offset.xUnits, y: oDefaultIcon.offset.yUnits},\r\n                basePath: this.getEngineInstanceInterface().getBasePath()\r\n            });\r\n            \r\n            return oIcon;\r\n        },\r\n        _createGeoJSONPoint: function(oGeoJSON, oProperties)\r\n        {\r\n            var bIsSelected = this.isSelected();\r\n            var oLatLon = leafLet.utils.geoJson.convertCoordinatesToLatLng(oGeoJSON)[0];\r\n\r\n            if (oLatLon === undefined)\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            if (oProperties.iconOptions)\r\n            {\r\n                if (bIsSelected)\r\n                {\r\n                    oProperties.iconOptions.className = 'icon-selected';\r\n                }\r\n                \r\n                oProperties.iconOptions.basePath = this.getEngineInstanceInterface().getBasePath();\r\n                oProperties.icon = new leafLet.typeLibrary.EmpIcon(oProperties.iconOptions);\r\n            }\r\n            \r\n            oProperties.oFeature = this;\r\n            \r\n            return new L.Marker(oLatLon, oProperties);\r\n        },\r\n        _createGeoJSONComplex: function(args, oGeoJSON)\r\n        {\r\n            var oThis = this;\r\n            var bIsSelected = this.isSelected();\r\n            \r\n            return new L.geoJson(oGeoJSON, {\r\n                style: function(oGeoJSONData)\r\n                {\r\n                    var oProperties = leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(), args.item.properties, oGeoJSONData.properties);\r\n            \r\n                    if (bIsSelected)\r\n                    {\r\n                        oProperties['tempColor'] = oProperties['color'];\r\n                        oProperties['tempWeight'] = oProperties['weigh'];\r\n                        \r\n                        oProperties['color'] = '#' + args.instanceInterface.selectAttributes.color;\r\n                        oProperties['weigh'] = args.instanceInterface.selectAttributes.width;\r\n                    }\r\n                    \r\n                    oProperties.oFeature = oThis;\r\n                    return oProperties;\r\n                },\r\n                coordsToLatLng: function(oCoord)\r\n                {\r\n                    return new L.LatLng(oCoord[1], oCoord[0]);\r\n                },\r\n                pointToLayer: function(oGeoJsonfeature, latlng)\r\n                {\r\n                    var oProperties = leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(), args.item.properties, oGeoJsonfeature.properties);\r\n\r\n                    if (oProperties.iconOptions)\r\n                    {\r\n                        if (bIsSelected)\r\n                        {\r\n                            oProperties.iconOptions.className = 'icon-selected';\r\n                        }\r\n                        oProperties.iconOptions.basPath = this.getEngineInstanceInterface().getBasePath();\r\n                        oProperties.icon = new leafLet.typeLibrary.EmpIcon(oProperties.iconOptions);\r\n                    }\r\n                    \r\n                    return new L.Marker(latlng, {\r\n                        icon: oProperties.icon,\r\n                        sSubItemID: oProperties.sSubItemID,\r\n                        oFeature: oThis\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        _createFeature: function(args)\r\n        {\r\n            var oFeature = undefined;\r\n            var oProperties = leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(), args.properties, args.data.properties);\r\n\r\n            oProperties.title = args.name;\r\n\r\n            switch (args.data.type.toLowerCase())\r\n            {\r\n                case 'point':\r\n                    oFeature = this._createGeoJSONPoint(args.data, oProperties);\r\n                    break;\r\n                case 'linestring':\r\n                    oFeature = this._createGeoJSONLine(args.data, oProperties);\r\n                    break;\r\n                case 'polygon':\r\n                    oFeature = this._createGeoJSONPolygon(args.data, oProperties);\r\n                    break;\r\n                case 'feature':\r\n                    if (!args.data.hasOwnProperty('geometry'))\r\n                    {\r\n                        throw new Error('GeoJSON Feature with no geometry.');\r\n                    }\r\n\r\n                    switch (args.data.geometry.type.toLowerCase())\r\n                    {\r\n                        case 'point':\r\n                            oFeature = this._createGeoJSONPoint(args.data.geometry, oProperties);\r\n                            break;\r\n                        case 'linestring':\r\n                            oFeature = this._createGeoJSONLine(args.data.geometry, oProperties);\r\n                            break;\r\n                        case 'polygon':\r\n                            oFeature = this._createGeoJSONPolygon(args.data.geometry, oProperties);\r\n                            break;\r\n                        default:\r\n                            oFeature = this._createGeoJSONComplex(args, args.data);\r\n                            break;\r\n                    }\r\n                    break;\r\n                default:\r\n                    oFeature = this._createGeoJSONComplex(args, args.data);\r\n                    break;\r\n            }\r\n\r\n            return oFeature;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        getGeometryType: function()\r\n        {\r\n            return leafLet.utils.geoJson.getGeometryType(this.getData());\r\n        },\r\n        render: function()\r\n        {\r\n            this.updateFeature(this.options);\r\n        },\r\n        setFeatureStyleProperties: function(sType, oProperties)\r\n        {\r\n            var bDoUpdate = false;\r\n            var oFeatureProperties = this.getProperties();\r\n            var sGeoJsonType = this.getGeometryType().toLowerCase();\r\n            \r\n            if ((sType === emp.typeLibrary.OverlayStyleType.POINT) &&\r\n                    (sGeoJsonType === 'point'))\r\n            {\r\n                if (oProperties.hasOwnProperty('iconUrl'))\r\n                {\r\n                    oFeatureProperties.iconUrl = oProperties.iconUrl;\r\n                    this.updateFeature(this.options);\r\n                }\r\n            }\r\n            else if ((sType === emp.typeLibrary.OverlayStyleType.LINE) &&\r\n                    (sGeoJsonType === 'linestring'))\r\n            {\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    oFeatureProperties.lineColor = oProperties.lineColor;\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        oFeatureProperties.lineWidth = oProperties.lineWidth;\r\n                    }                    \r\n                }\r\n            }\r\n            else if ((sType === emp.typeLibrary.OverlayStyleType.POLYGON) &&\r\n                    (sGeoJsonType === 'polygon'))\r\n            {\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    oFeatureProperties.lineColor = oProperties.lineColor;\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        oFeatureProperties.lineWidth = oProperties.lineWidth;\r\n                    }\r\n                    \r\n                    bDoUpdate = true;\r\n                }\r\n\r\n                if (oProperties.hasOwnProperty('fillColor'))\r\n                {\r\n                    oFeatureProperties.fillColor = oProperties.fillColor;\r\n                    bDoUpdate = true;\r\n                }\r\n                \r\n                if (bDoUpdate)\r\n                {\r\n                    this.updateFeature(this.options);\r\n                }\r\n            }\r\n            else if (\r\n                        (sType === emp.typeLibrary.OverlayStyleType.MULTIGEOMETRY) &&\r\n                        !(\r\n                            (sGeoJsonType === 'point') ||\r\n                            (sGeoJsonType === 'linestring') ||\r\n                            (sGeoJsonType === 'polygon')\r\n                        )\r\n                    )\r\n            {\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    oFeatureProperties.lineColor = oProperties.lineColor;\r\n                    if (oProperties.hasOwnProperty('lineWidth'))\r\n                    {\r\n                        oFeatureProperties.lineWidth = oProperties.lineWidth;\r\n                    }\r\n                    \r\n                    bDoUpdate = true;\r\n                }\r\n\r\n                if (oProperties.hasOwnProperty('fillColor'))\r\n                {\r\n                    oFeatureProperties.fillColor = oProperties.fillColor;\r\n                    bDoUpdate = true;\r\n                }\r\n                \r\n                if (oProperties.hasOwnProperty('iconUrl'))\r\n                {\r\n                    oFeatureProperties.iconUrl = oProperties.iconUrl;\r\n                    bDoUpdate = true;\r\n                }\r\n\r\n                if (bDoUpdate)\r\n                {\r\n                    this.updateFeature(this.options);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.GeoJsonFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoJsonFeature());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.AirspaceFeature = function(){\r\n    var publicInterface = {\r\n        initialize: function (args, iMinPoint, iMaxPoints) \r\n        {\r\n            var options = {\r\n                iMinPoints: iMinPoint,\r\n                iMaxPoints: iMaxPoints,\r\n                oAirspaceAttributeList: {}\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            \r\n            this.options.oAirspaceAttributeList = new leafLet.typeLibrary.airspace.AttributeList(args.item.properties);\r\n\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        getMinPoints: function()\r\n        {\r\n            return this.options.iMinPoints;\r\n        },\r\n        getMaxPoints: function()\r\n        {\r\n            return this.options.iMaxPoints;\r\n        },\r\n        getUnits: function()\r\n        {\r\n            return leafLet.utils.Units.METERS;\r\n        },\r\n        getAltitudeModeAbbr: function()\r\n        {\r\n            var oAttributes = this.getAttributes(0);\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n\r\n            return leafLet.utils.AltitudeModeAbbr(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ALTITUDE_MODE));\r\n        },\r\n        getAttributeList: function()\r\n        {\r\n            return this.options.oAirspaceAttributeList;\r\n        },\r\n        setAttributeList: function(oList)\r\n        {\r\n            this.options.oAirspaceAttributeList = oList;\r\n        },\r\n        getAttributes: function(iIndex)\r\n        {\r\n            return this.getAttributeList().get(iIndex);\r\n        },\r\n        getCoordinateList: function()\r\n        {\r\n            return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getData());\r\n        },\r\n        setCoordinates: function(oLatLngList)\r\n        {\r\n            leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getData(), oLatLngList);\r\n        },\r\n        render: function()\r\n        {\r\n            if (this.isVisible())\r\n            {\r\n                var oNewLeafletObject = this._createFeature(this.options);\r\n\r\n                if (oNewLeafletObject)\r\n                {\r\n                    this.setLeafletObject(oNewLeafletObject);\r\n                }\r\n            }\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            oArgs.oAirspaceAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            return this._createFeature(oArgs);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.AirspaceFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.AirspaceFeature());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.ImageFeature = function(){\r\n    var publicInterface = {\r\n        initialize: function (args)\r\n        {\r\n            var options = {\r\n                oLatLngList: this._convertBBox(args.item.params),\r\n                sImageURL: args.item.url\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        _convertBBox: function(oBBox)\r\n        {\r\n            //{\"left\": 40.0,\"right\": 45.0,\"top\": 40.0,\"bottom\": 35.0}\r\n            var oLatLngList = [];\r\n            \r\n            oLatLngList.push(new L.LatLng(oBBox.bottom, oBBox.left));\r\n            oLatLngList.push(new L.LatLng(oBBox.top, oBBox.right));\r\n            \r\n            return oLatLngList;\r\n        },\r\n        _createFeature: function(args)\r\n        {\r\n            var oLeafletObject;\r\n            \r\n            oLeafletObject = new L.ImageOverlay(args.sImageURL, args.oLatLngList);\r\n            \r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oLeafletObject;\r\n            var oOptions = {\r\n                sImageURL: oArgs.url,\r\n                oLatLngList: this._convertBBox(oArgs.params)\r\n            };\r\n            \r\n            oLeafletObject = this._createFeature(oOptions);\r\n            this.options.sImageURL = oOptions.url;\r\n            this.options.oLatLngList = oOptions.params;\r\n            \r\n            if (oArgs.hasOwnProperty('name'))\r\n            {\r\n                this.setName(oArgs.name);\r\n            }\r\n            \r\n            return oLeafletObject;\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            // Each feature class can override this function.\r\n            return \"<center><b>URL:&nbsp;\" + this.getURL + \"</b></center><br/>\" +\r\n                    this._getPopupDescription();\r\n        },\r\n        getFeatureBounds: function()\r\n        {\r\n            var oBounds = undefined;\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var oLatLngList = this.getParams();\r\n\r\n            if (oLeafletObject)\r\n            {\r\n                oBounds = new leafLet.typeLibrary.EmpBoundary(oLatLngList[0].wrap(), oLatLngList[1].wrap());\r\n            }\r\n\r\n            return oBounds;\r\n        },\r\n        getURL: function()\r\n        {\r\n            return this.options.sImageURL;\r\n        },\r\n        getParams: function()\r\n        {\r\n            return this.options.oLatLngList;\r\n        },\r\n        render: function()\r\n        {\r\n            if (this.isVisible())\r\n            {\r\n                var oNewLeafletObject = this._createFeature(this.options);\r\n\r\n                if (oNewLeafletObject)\r\n                {\r\n                    this.setLeafletObject(oNewLeafletObject);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.ImageFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.ImageFeature());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.AOIFeature = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                oOriginalData: emp.helpers.copyObject(args.item.data),\r\n                iBuffer: undefined,\r\n                sAOIType: undefined,\r\n                sSymbolCode: undefined,\r\n                oModifiers: {}\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        _createFeature: function(args)\r\n        {\r\n            var sDescription = args.properties.description || \"\";\r\n            var oGeoJson = args.data;\r\n\r\n            this.setAOIType(oGeoJson.properties.aoi.type);\r\n            this.setAOIBuffer(oGeoJson.properties.aoi.buffer);\r\n            this.setAOISymbolCode();\r\n            this.setModifiers();\r\n\r\n            return leafLet.utils.milstd.renderMPGraphic({\r\n                instanceInterface: this.getEngineInstanceInterface(),\r\n                isSelected: args.selected,\r\n                sID: args.coreId,\r\n                sName: args.name,\r\n                sDescription: sDescription,\r\n                sSymbolCode: this.getAOISymbolCode(),\r\n                oCoordData: args.data.geometry,\r\n                oModifiers: emp.helpers.copyObject(this.getModifiers()),\r\n                i2525Version: 0,\r\n                oFeature: this\r\n            });\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var eAOIType = emp.typeLibrary.AOIType;\r\n            var sText;\r\n            \r\n            sText = \"<center><b>AOI&nbsp;\";\r\n            \r\n            switch (this.getAOIType())\r\n            {\r\n                case eAOIType.POINT_RADIUS:\r\n                    sText += \"Point Radius\";\r\n                    break;\r\n                case eAOIType.LINE:\r\n                    sText += \"Line\";\r\n                    break;\r\n                case eAOIType.POLYGON:\r\n                    sText += \"Polygon\";\r\n                    break;\r\n                case eAOIType.BBOX:\r\n                    sText += \"Rectangle\";\r\n                    break;\r\n            }\r\n            sText += \"</b></center>\";\r\n            sText += \"<center><b>Buffer</b>:&nbsp;\" + this.getAOIBuffer() + \"</center><br/>\";\r\n            sText += this._getPopupDescription();\r\n\r\n            return sText;\r\n        },\r\n        getUnits: function()\r\n        {\r\n            return leafLet.utils.Units.METERS;\r\n        },\r\n        getAOIType: function()\r\n        {\r\n            return this.options.sAOIType;\r\n        },\r\n        setAOIType: function(sType)\r\n        {\r\n            this.options.sAOIType = sType;\r\n        },\r\n        getAOIBuffer: function()\r\n        {\r\n            return this.options.iBuffer;\r\n        },\r\n        setAOIBuffer: function(iBuffer)\r\n        {\r\n            this.options.iBuffer = iBuffer;\r\n        },\r\n        setAOIBufferProperty: function(iBuffer)\r\n        {\r\n            this.options.data.properties.aoi.buffer = iBuffer;\r\n        },\r\n        getAOISymbolCode: function()\r\n        {\r\n            return this.options.sSymbolCode;\r\n        },\r\n        setAOISymbolCode: function()\r\n        {\r\n            var eAOIType = emp.typeLibrary.AOIType;\r\n            \r\n            switch (this.getAOIType())\r\n            {\r\n                case eAOIType.POINT_RADIUS:\r\n                    this.options.sSymbolCode = \"BBS_POINT------\";\r\n                    break;\r\n                case eAOIType.LINE:\r\n                    this.options.sSymbolCode = \"BBS_LINE-------\";\r\n                    break;\r\n                case eAOIType.POLYGON:\r\n                    this.options.sSymbolCode = \"BBS_AREA-------\";\r\n                    break;\r\n                case eAOIType.BBOX:\r\n                    this.options.sSymbolCode = \"BBS_RECTANGLE--\";\r\n                    break;\r\n            }\r\n        },\r\n        getModifiers: function()\r\n        {\r\n            return this.options.oModifiers;\r\n        },\r\n        setModifiers: function()\r\n        {\r\n            var oGeoJson = this.getData();\r\n            var eMilStdModifiers =  leafLet.utils.milstd.Modifiers;\r\n            var oProperties = this.getProperties();\r\n            \r\n            this.options.oModifiers[eMilStdModifiers.UNIQUE_DESIGNATOR_1] = this.getName();\r\n            this.options.oModifiers[eMilStdModifiers.DISTANCE] = [this.getAOIBuffer()];\r\n            \r\n            if (oProperties)\r\n            {\r\n                if (oProperties.hasOwnProperty('fillColor'))\r\n                {\r\n                    this.options.oModifiers[\"fillColor\"] = oProperties.fillColor;\r\n                }\r\n                if (oProperties.hasOwnProperty('lineColor'))\r\n                {\r\n                    this.options.oModifiers[\"lineColor\"] = oProperties.lineColor;\r\n                }\r\n            }\r\n            \r\n            if (!this.options.oModifiers[\"fillColor\"])\r\n            {\r\n                if (oGeoJson && oGeoJson.properties.hasOwnProperty('fillColor'))\r\n                {\r\n                    this.options.oModifiers[\"fillColor\"] = oGeoJson.properties.fillColor;\r\n                }\r\n            }\r\n            \r\n            if (!this.options.oModifiers[\"lineColor\"])\r\n            {\r\n                if (oGeoJson && oGeoJson.properties.hasOwnProperty('lineColor'))\r\n                {\r\n                    this.options.oModifiers[\"lineColor\"] = oGeoJson.properties.lineColor;\r\n                }\r\n            }\r\n            \r\n            if (!this.options.oModifiers[\"fillColor\"])\r\n            {\r\n                // If fill color is still not set, set our default.\r\n                // I would prefer the default to be set by the renderer but it fails\r\n                // if one is not provided.\r\n                this.options.oModifiers[\"fillColor\"] = '99AAAAAA';\r\n            }\r\n        },\r\n        getGeometryType: function()\r\n        {\r\n            return leafLet.utils.geoJson.getGeometryType(this.getData());\r\n        },\r\n        render: function()\r\n        {\r\n            if (this.isVisible())\r\n            {\r\n                var oNewLeafletObject = this._createFeature(this.options);\r\n\r\n                this.setLeafletObject(oNewLeafletObject);\r\n            }\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.AOIFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.AOIFeature());\r\n","/* global leafLet, emp, NaN */\r\n\r\nleafLet.typeLibrary.MilStdModifiers = function(oFeature, args)\r\n{\r\n    var oMilStdFeature = oFeature;\r\n    var o2525Modifiers = leafLet.utils.milstd.Modifiers;\r\n    var oStringModifiers = leafLet.utils.milstd.longModifiers;\r\n    var oLongToShortModifierName = leafLet.utils.milstd.stringToModifiers;\r\n    var o2525ModifierToLong = leafLet.utils.milstd.o2525ModifierToLong;\r\n    \r\n    var publicInterface = {\r\n        oModifiers: {},\r\n        getAMValueCount: function()\r\n        {\r\n            if (this.oModifiers[o2525Modifiers.DISTANCE] === undefined)\r\n            {\r\n                this.oModifiers[o2525Modifiers.DISTANCE] = [];\r\n            }\r\n            \r\n            return this.oModifiers[o2525Modifiers.DISTANCE].length;\r\n        },\r\n        getAMValue: function(iIndex)\r\n        {\r\n            if (iIndex >= this.getAMValueCount())\r\n            {\r\n                return NaN;\r\n            }\r\n            \r\n            var dValue = this.oModifiers[o2525Modifiers.DISTANCE][iIndex];\r\n            \r\n            switch (oMilStdFeature.getUnits())\r\n            {\r\n                case leafLet.utils.Units.FEET:\r\n                    dValue = Math.round(dValue * leafLet.utils.METERS_PER_FEET);\r\n                    break;\r\n            }\r\n            return dValue;\r\n        },\r\n        setAMValue: function(iIndex, dValue)\r\n        {\r\n            switch (oMilStdFeature.getUnits())\r\n            {\r\n                case leafLet.utils.Units.FEET:\r\n                    dValue = Math.round(dValue * leafLet.utils.FEET_PER_METERS);\r\n                    break;\r\n            }\r\n\r\n            if (iIndex < this.getAMValueCount())\r\n            {\r\n                this.oModifiers[o2525Modifiers.DISTANCE][iIndex] = dValue;\r\n            }\r\n            else\r\n            {\r\n                this.oModifiers[o2525Modifiers.DISTANCE].push(dValue);\r\n            }\r\n        },\r\n        getANValueCount: function()\r\n        {\r\n            if (this.oModifiers[o2525Modifiers.AZIMUTH] === undefined)\r\n            {\r\n                this.oModifiers[o2525Modifiers.AZIMUTH] = [];\r\n            }\r\n            \r\n            return this.oModifiers[o2525Modifiers.AZIMUTH].length;\r\n        },\r\n        getANValue: function(iIndex)\r\n        {\r\n            if (iIndex >= this.getANValueCount())\r\n            {\r\n                return NaN;\r\n            }\r\n            \r\n            var dValue = this.oModifiers[o2525Modifiers.AZIMUTH][iIndex];\r\n            \r\n            switch (oMilStdFeature.getAzimuthUnits())\r\n            {\r\n                case leafLet.utils.AngleUnits.MILS:\r\n                    dValue = dValue * leafLet.utils.DEGREE_PER_MILS;\r\n                    break;\r\n            }\r\n            \r\n            return dValue;\r\n        },\r\n        setANValue: function(iIndex, dValue)\r\n        {\r\n            switch (oMilStdFeature.getAzimuthUnits())\r\n            {\r\n                case leafLet.utils.AngleUnits.MILS:\r\n                    dValue = dValue * leafLet.utils.MILS_PER_DEGREE;\r\n                    break;\r\n            }\r\n\r\n            if (iIndex < this.getANValueCount())\r\n            {\r\n                this.oModifiers[o2525Modifiers.AZIMUTH][iIndex] = dValue;\r\n            }\r\n            else\r\n            {\r\n                this.oModifiers[o2525Modifiers.AZIMUTH].push(dValue); \r\n            }\r\n        },\r\n        getXValueCount: function()\r\n        {\r\n            if (this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH] === undefined)\r\n            {\r\n                this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH] = [];\r\n            }\r\n            \r\n            return this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH].length;\r\n        },\r\n        getXValue: function(iIndex)\r\n        {\r\n            if (iIndex >= this.getXValueCount())\r\n            {\r\n                return NaN;\r\n            }\r\n            \r\n            var dValue = this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH][iIndex];\r\n            \r\n            switch (oMilStdFeature.getAltitudeUnits())\r\n            {\r\n                case leafLet.utils.Units.FEET:\r\n                    dValue = Math.round(dValue * leafLet.utils.FEET_PER_METERS);\r\n                    break;\r\n            }\r\n            \r\n            return dValue;\r\n        },\r\n        setXValue: function(iIndex, dValue)\r\n        {\r\n            switch (oMilStdFeature.getAltitudeUnits())\r\n            {\r\n                case leafLet.utils.Units.FEET:\r\n                    dValue = Math.round(dValue * leafLet.utils.METERS_PER_FEET);\r\n                    break;\r\n            }\r\n            \r\n            if (iIndex < this.getXValueCount())\r\n            {\r\n                this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH][iIndex] = dValue;\r\n            }\r\n            else\r\n            {\r\n                this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH].push(dValue); \r\n            }\r\n        },\r\n        toModifiers: function()\r\n        {\r\n            var oNewModifiers = {};\r\n            \r\n            for (var sModifier in this.oModifiers)\r\n            {\r\n                if (!this.oModifiers.hasOwnProperty(sModifier)) {\r\n                    continue;\r\n                }\r\n                if (this.oModifiers[sModifier] !== undefined)\r\n                {\r\n                    oNewModifiers[sModifier] = emp.helpers.copyObject(this.oModifiers[sModifier]);\r\n                }\r\n            }\r\n            \r\n            return oNewModifiers;\r\n        },\r\n        toLongModifiers: function()\r\n        {\r\n            var sLongModifier;\r\n            var oNewModifiers = {};\r\n            \r\n            for (var sModifier in this.oModifiers) {\r\n                if (!this.oModifiers.hasOwnProperty(sModifier)) {\r\n                    continue;\r\n                }\r\n                if (this.oModifiers[sModifier] !== undefined)\r\n                {\r\n                    sLongModifier = o2525ModifierToLong[sModifier];\r\n                    \r\n                    switch (sModifier)\r\n                    {\r\n                        case o2525Modifiers.STANDARD:\r\n                            oNewModifiers[sLongModifier] = emp.typeLibrary.featureMilStdVersionType.convertToString(this.oModifiers[sModifier]);\r\n                            break;\r\n                        default:\r\n                            oNewModifiers[sLongModifier] = emp.helpers.copyObject(this.oModifiers[sModifier]);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            return oNewModifiers;\r\n        }\r\n    };\r\n    \r\n    var sShortName;\r\n    \r\n    for (var sProp in args)\r\n    {\r\n        if (!args.hasOwnProperty(sProp)) {\r\n            continue;\r\n        }\r\n        sShortName = sProp;\r\n        switch (sProp)\r\n        {\r\n            case oStringModifiers.FILL_COLOR:\r\n            case oStringModifiers.LINE_COLOR:\r\n            case oStringModifiers.X_OFFSET:\r\n            case oStringModifiers.X_UNITS:\r\n            case oStringModifiers.Y_OFFSET:\r\n            case oStringModifiers.Y_UNITS:\r\n            case oStringModifiers.LINE_THICKNESS:\r\n                // These do not get added. They are used by the renderer.\r\n                break;\r\n            default:\r\n                if (oLongToShortModifierName[sProp] !== undefined)\r\n                {\r\n                    sShortName = oLongToShortModifierName[sProp];\r\n                }\r\n                \r\n                switch (sProp)\r\n                {\r\n                    case oStringModifiers.STANDARD:\r\n                        publicInterface.oModifiers[sShortName] = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(args[oStringModifiers.STANDARD]);\r\n                        break;\r\n                    default:\r\n                        publicInterface.oModifiers[sShortName] = args[sProp];\r\n                        break;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n/*\r\n    publicInterface.oModifiers[o2525Modifiers.QUANTITY] = args[o2525Modifiers.QUANTITY] || args[oStringModifiers.QUANTITY];\r\n    publicInterface.oModifiers[o2525Modifiers.REDUCED_OR_REINFORCED] = args[o2525Modifiers.REDUCED_OR_REINFORCED] || args[oStringModifiers.REDUCED_OR_REINFORCED];\r\n    publicInterface.oModifiers[o2525Modifiers.STAFF_COMMENTS] = args[o2525Modifiers.STAFF_COMMENTS] || args[oStringModifiers.STAFF_COMMENTS];\r\n    publicInterface.oModifiers[o2525Modifiers.ADDITIONAL_INFO_1] = args[o2525Modifiers.ADDITIONAL_INFO_1] || args[oStringModifiers.ADDITIONAL_INFO_1];\r\n    publicInterface.oModifiers[o2525Modifiers.ADDITIONAL_INFO_2] = args[o2525Modifiers.ADDITIONAL_INFO_2] || args[oStringModifiers.ADDITIONAL_INFO_2];\r\n    publicInterface.oModifiers[o2525Modifiers.ADDITIONAL_INFO_3] = args[o2525Modifiers.ADDITIONAL_INFO_3] || args[oStringModifiers.ADDITIONAL_INFO_3];\r\n    publicInterface.oModifiers[o2525Modifiers.EVALUATION_RATING] = args[o2525Modifiers.EVALUATION_RATING] || args[oStringModifiers.EVALUATION_RATING];\r\n    publicInterface.oModifiers[o2525Modifiers.COMBAT_EFFECTIVENESS] = args[o2525Modifiers.COMBAT_EFFECTIVENESS] || args[oStringModifiers.COMBAT_EFFECTIVENESS];\r\n    publicInterface.oModifiers[o2525Modifiers.SIGNATURE_EQUIPMENT] = args[o2525Modifiers.SIGNATURE_EQUIPMENT] || args[oStringModifiers.SIGNATURE_EQUIPMENT];\r\n    publicInterface.oModifiers[o2525Modifiers.HIGHER_FORMATION] = args[o2525Modifiers.HIGHER_FORMATION] || args[oStringModifiers.HIGHER_FORMATION];\r\n    publicInterface.oModifiers[o2525Modifiers.HOSTILE] = args[o2525Modifiers.HOSTILE] || args[oStringModifiers.HOSTILE];\r\n    publicInterface.oModifiers[o2525Modifiers.IFF_SIF] = args[o2525Modifiers.IFF_SIF] || args[oStringModifiers.IFF_SIF];\r\n    publicInterface.oModifiers[o2525Modifiers.DIRECTION_OF_MOVEMENT] = args[o2525Modifiers.DIRECTION_OF_MOVEMENT] || args[oStringModifiers.DIRECTION_OF_MOVEMENT];\r\n    publicInterface.oModifiers[o2525Modifiers.OFFSET_INDICATOR] = args[o2525Modifiers.OFFSET_INDICATOR] || args[oStringModifiers.OFFSET_INDICATOR];\r\n    publicInterface.oModifiers[o2525Modifiers.UNIQUE_DESIGNATOR_1] = args[o2525Modifiers.UNIQUE_DESIGNATOR_1] || args[oStringModifiers.UNIQUE_DESIGNATOR_1];\r\n    publicInterface.oModifiers[o2525Modifiers.UNIQUE_DESIGNATOR_2] = args[o2525Modifiers.UNIQUE_DESIGNATOR_2] || args[oStringModifiers.UNIQUE_DESIGNATOR_2];\r\n    publicInterface.oModifiers[o2525Modifiers.EQUIPMENT_TYPE] = args[o2525Modifiers.EQUIPMENT_TYPE] || args[oStringModifiers.EQUIPMENT_TYPE];\r\n    publicInterface.oModifiers[o2525Modifiers.DATE_TIME_GROUP] = args[o2525Modifiers.DATE_TIME_GROUP] || args[oStringModifiers.DATE_TIME_GROUP];\r\n    publicInterface.oModifiers[o2525Modifiers.DATE_TIME_GROUP_2] = args[o2525Modifiers.DATE_TIME_GROUP_2] || args[oStringModifiers.DATE_TIME_GROUP_2];\r\n    publicInterface.oModifiers[o2525Modifiers.ALTITUDE_DEPTH] = args[o2525Modifiers.ALTITUDE_DEPTH] || args[oStringModifiers.ALTITUDE_DEPTH];\r\n    publicInterface.oModifiers[o2525Modifiers.LOCATION] = args[o2525Modifiers.LOCATION] || args[oStringModifiers.LOCATION];\r\n    publicInterface.oModifiers[o2525Modifiers.SPEED] = args[o2525Modifiers.SPEED] || args[oStringModifiers.SPEED];\r\n    publicInterface.oModifiers[o2525Modifiers.SPECIAL_C2_HEADQUARTERS] = args[o2525Modifiers.SPECIAL_C2_HEADQUARTERS] || args[oStringModifiers.SPECIAL_C2_HEADQUARTERS];\r\n    publicInterface.oModifiers[o2525Modifiers.DISTANCE] = args[o2525Modifiers.DISTANCE] || args[oStringModifiers.DISTANCE];\r\n    publicInterface.oModifiers[o2525Modifiers.AZIMUTH] = args[o2525Modifiers.AZIMUTH] || args[oStringModifiers.AZIMUTH];\r\n    publicInterface.oModifiers[o2525Modifiers.STANDARD] = args[o2525Modifiers.STANDARD] || emp.typeLibrary.featureMilStdVersionType.convertToNumeric(args[oStringModifiers.STANDARD]);\r\n*/\r\n    return publicInterface;\r\n};\r\n","/* global L, leafLet, emp, cmapi */\r\n\r\nleafLet.internalPrivateClass.GeoTextFeature = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        getPopupText: function () {\r\n            var sPopupText = \"\";\r\n\r\n            if (this.options.leafletObject instanceof L.Marker) {\r\n                var oLatLng = this.options.leafletObject.getLatLng();\r\n                if (oLatLng !== undefined) {\r\n                    oLatLng = oLatLng.wrap();\r\n                    sPopupText +=\r\n                            \"<center><b>Lat</b>:&nbsp;\" + oLatLng.lat.toFixed(5) +\r\n                            \"<br/><b>Lon</b>:&nbsp;\" + oLatLng.lng.toFixed(5) +\r\n                            ((oLatLng.alt) ? \"<br/><b>Alt</b>:&nbsp;\" + oLatLng.alt + this._getAltUnitsAndModeText() : \"\") + \"</center><br/>\";\r\n                }\r\n            }\r\n\r\n            sPopupText += this._getPopupDescription();\r\n\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function (args) {\r\n            var oLeafletFeature = undefined;\r\n            var oProperties;\r\n            var sLabelText = ((args.name)? args.name: \" \");\r\n            var iXOffset = 0;\r\n            var iYOffset = 0;\r\n            var halfWidth;\r\n            var myIcon;\r\n            var oLatLon = leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0];\r\n            var iTextPixelDim;\r\n            var htmlFontStyle = 'normal';\r\n            var htmlFontWeight = 'normal';\r\n            var sCSSTextShadow = '';\r\n            var azimuth = ((args.properties && args.properties.azimuth) ? args.properties.azimuth: 0);\r\n            var labelStyle = ((args.properties && args.properties.labelStyle) ? args.properties.labelStyle: this.getEngineInstanceInterface().defaultLabelStyle);\r\n\r\n            if (oLatLon === undefined) {\r\n                return undefined;\r\n            }\r\n\r\n            if (this.isSelected()) {\r\n                labelStyle = this.getEngineInstanceInterface().selectLabelStyle;\r\n            }\r\n\r\n            if (labelStyle.typeface) {\r\n                switch (labelStyle.typeface.toUpperCase()) {\r\n                    case cmapi.enums.typeface.REGULAR:\r\n                        break;\r\n                    case cmapi.enums.typeface.BOLD:\r\n                        htmlFontWeight = 'bold';\r\n                        break;\r\n                    case cmapi.enums.typeface.ITALIC:\r\n                        htmlFontStyle = 'italic';\r\n                        ret = 'italic';\r\n                        break;\r\n                    case cmapi.enums.typeface.BOLDITALIC:\r\n                        htmlFontStyle = 'italic';\r\n                        htmlFontWeight = 'bold';\r\n                        break;\r\n                }\r\n            }\r\n\r\n            oProperties = leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(), args.properties);\r\n            iTextPixelDim = emp.helpers.getStringPixelDimensions(sLabelText,\r\n                labelStyle.family,\r\n                labelStyle.size + 'pt',\r\n                htmlFontWeight);\r\n\r\n            oProperties.title = args.name;\r\n\r\n            iYOffset = Math.floor(iTextPixelDim.height / 2);\r\n\r\n            if (labelStyle.justification) {\r\n                switch (labelStyle.justification.toUpperCase()) {\r\n                    case cmapi.enums.justification.CENTER:\r\n                        iXOffset = Math.floor(iTextPixelDim.width / 2);\r\n                        break;\r\n                    case cmapi.enums.justification.LEFT:\r\n                        iXOffset = 0;\r\n                        if (azimuth) {\r\n                            // We need to move the offset because the rotation always rotates at the center.\r\n                            halfWidth = Math.floor(iTextPixelDim.width / 2);\r\n                            iXOffset += Math.floor(halfWidth * (1 - Math.cos(azimuth.toRad())));\r\n                            iYOffset -= Math.floor(halfWidth * Math.sin(azimuth.toRad()));\r\n                        }\r\n                        break;\r\n                    case cmapi.enums.justification.RIGHT:\r\n                        iXOffset = iTextPixelDim.width;\r\n                        if (azimuth) {\r\n                            // We need to move the offset because the rotation always rotates at the center.\r\n                            halfWidth = Math.floor(iTextPixelDim.width / 2);\r\n                            iXOffset -= Math.floor(halfWidth * (1 - Math.cos(azimuth.toRad())));\r\n                            iYOffset += Math.floor(halfWidth * Math.sin(azimuth.toRad()));\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if (labelStyle.outlineColor) {\r\n                sCSSTextShadow = 'text-shadow: 4px 4px 2px rgb(' + labelStyle.outlineColor.red + ', ' + labelStyle.outlineColor.green + ', ' + labelStyle.outlineColor.blue + '); ';\r\n            }\r\n\r\n            myIcon = new L.DivIcon({\r\n                className: '',\r\n                html: \"<p \" +\r\n                        \"style='font-family:\" + labelStyle.family + \"; \" +\r\n                        \"font-size:\" + labelStyle.size + \"pt; \" +\r\n                        \"line-height: \" + iTextPixelDim.height + \"px; \" +\r\n                        \"white-space: nowrap; \" +\r\n                        \"font-style: \" + htmlFontStyle + '; ' +\r\n                        \"font-weight:\" + htmlFontWeight + \"; \" +\r\n                        \"color: rgb(\" + labelStyle.color.red + \", \" + labelStyle.color.green + \", \" + labelStyle.color.blue + \"); \" +\r\n                        sCSSTextShadow +\r\n                        \"background: transparent; \" +\r\n                        \"border: none; \" +\r\n                        \"-webkit-transform: rotate(\" + azimuth + \"deg); \" +\r\n                        \"-moz-transform: rotate(\" + azimuth + \"deg); \" +\r\n                        \"-o-transform: rotate(\" + azimuth + \"deg); \" +\r\n                        \"transform: rotate(\" + azimuth + \"deg);'>\" +\r\n                        sLabelText + \"</p>\",\r\n                iconSize: new L.Point(iTextPixelDim.width, iTextPixelDim.height),\r\n                iconAnchor: new L.Point(iXOffset, iYOffset)\r\n            });\r\n            oLeafletFeature =  new L.Marker(oLatLon, {\r\n                icon: myIcon,\r\n                oFeature: this\r\n            });\r\n\r\n            return oLeafletFeature;\r\n        },\r\n        _updateFeature: function (oArgs) {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        render: function () {\r\n            this.updateFeature(this.options);\r\n        },\r\n        setFeatureStyleProperties: function (sType, oProperties) {\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.GeoTextFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoTextFeature());\r\n","/* global L, leafLet, emp, cmapi */\r\n\r\nleafLet.internalPrivateClass.GeoRectangleFeature = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        _createFeature: function (args) {\r\n            var oLeafletFeature = undefined;\r\n            var distance;\r\n            var newLatLng;\r\n            var oLatLon = leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0];\r\n            var oLatLngList = [];\r\n            var angleOffset;\r\n            var azimuth = ((args.properties && args.properties.azimuth) ? args.properties.azimuth: 0);\r\n            var height = ((args.properties && args.properties.height) ? args.properties.height / 2: undefined);\r\n            var width = ((args.properties && args.properties.width) ? args.properties.width / 2: undefined);\r\n            var oProperties;\r\n\r\n            if ((oLatLon === undefined) || (height === undefined) || (width === undefined)) {\r\n                return undefined;\r\n            }\r\n\r\n            oProperties = this._getPolygonProperties(args);\r\n\r\n            distance = Math.sqrt((height * height) + (width * width));\r\n            // The width and height are reversed to get the angle from the vertical axis.\r\n            angleOffset = Math.atan2(width, height).toDeg();\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + 180.0 - angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + 180.0 + angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + 360.0 - angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            oLeafletFeature =  new L.polygon(oLatLngList, oProperties);\r\n\r\n            return oLeafletFeature;\r\n        },\r\n        _updateFeature: function (oArgs) {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        render: function () {\r\n            this.updateFeature(this.options);\r\n        },\r\n        setFeatureStyleProperties: function (sType, oProperties) {\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.GeoRectangleFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoRectangleFeature());\r\n","/* global L, leafLet, emp, cmapi */\r\n\r\nleafLet.internalPrivateClass.GeoSquareFeature = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        _createFeature: function (args) {\r\n            var oLeafletFeature = undefined;\r\n            var distance;\r\n            var newLatLng;\r\n            var oLatLon = leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0];\r\n            var oLatLngList = [];\r\n            var angleOffset;\r\n            var azimuth = ((args.properties && args.properties.azimuth) ? args.properties.azimuth: 0);\r\n            var width = ((args.properties && args.properties.width) ? args.properties.width / 2: undefined);\r\n            var oProperties;\r\n\r\n            if ((oLatLon === undefined) || (width === undefined)) {\r\n                return undefined;\r\n            }\r\n\r\n            oProperties = this._getPolygonProperties(args);\r\n\r\n            distance = Math.sqrt(2 * (width * width));\r\n\r\n            angleOffset = 45;\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + 180.0 - angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + 180.0 + angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            newLatLng = oLatLon.destinationPoint(azimuth + 360.0 - angleOffset, distance);\r\n            oLatLngList.push(newLatLng);\r\n\r\n            oLeafletFeature =  new L.polygon(oLatLngList, oProperties);\r\n\r\n            return oLeafletFeature;\r\n        },\r\n        _updateFeature: function (oArgs) {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        render: function () {\r\n            this.updateFeature(this.options);\r\n        },\r\n        setFeatureStyleProperties: function (sType, oProperties) {\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.GeoSquareFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoSquareFeature());\r\n","/* global L, leafLet, emp, cmapi */\r\n\r\nleafLet.internalPrivateClass.GeoCircleFeature = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        _createFeature: function (args) {\r\n            var oLeafletFeature = undefined;\r\n            var oLatLon = leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0];\r\n            var radius = ((args.properties && args.properties.radius) ? args.properties.radius: undefined);\r\n            var oProperties;\r\n\r\n            if ((oLatLon === undefined) || (radius === undefined)) {\r\n                return undefined;\r\n            }\r\n\r\n            oProperties = this._getPolygonProperties(args);\r\n\r\n            oLeafletFeature =  new L.circle(oLatLon, radius, oProperties);\r\n\r\n            return oLeafletFeature;\r\n        },\r\n        _updateFeature: function (oArgs) {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        render: function () {\r\n            this.updateFeature(this.options);\r\n        },\r\n        setFeatureStyleProperties: function (sType, oProperties) {\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.GeoCircleFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoCircleFeature());\r\n","/* global L, leafLet, emp, cmapi */\r\n\r\nleafLet.internalPrivateClass.GeoEllipseFeature = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            leafLet.typeLibrary.Feature.prototype.initialize.call(this, args);\r\n        },\r\n        _createFeature: function (args) {\r\n            var oLeafletFeature = undefined;\r\n            var oLatLon = leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0];\r\n            var semiMajor = ((args.properties && args.properties.semiMajor) ? args.properties.semiMajor: undefined);\r\n            var semiMinor = ((args.properties && args.properties.semiMinor) ? args.properties.semiMinor: undefined);\r\n            var oProperties;\r\n\r\n            if ((oLatLon === undefined) || (semiMajor === undefined) || (semiMinor === undefined)) {\r\n                return undefined;\r\n            }\r\n\r\n            oProperties = this._getPolygonProperties(args);\r\n\r\n            oLeafletFeature =  new leafLet.EllipseObject({\r\n                leafletMap: this.getEngineInstanceInterface().leafletInstance,\r\n                isSelected: this.isSelected(),\r\n                selectAttributes: this.getEngineInstanceInterface().selectAttributes,\r\n                oFeature: this,\r\n                properties: this._getPolygonProperties(args),\r\n                centerLatLng: oLatLon,\r\n                semiMinor: semiMinor,\r\n                semiMajor: semiMajor,\r\n                azimuth: ((args.properties && args.properties.azimuth) ? args.properties.azimuth: 0)\r\n            });\r\n\r\n            return oLeafletFeature;\r\n        },\r\n        _updateFeature: function (oArgs) {\r\n            return this._createFeature(oArgs);\r\n        },\r\n        render: function () {\r\n            this.updateFeature(this.options);\r\n        },\r\n        setFeatureStyleProperties: function (sType, oProperties) {\r\n        }\r\n    };\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.GeoEllipseFeature = leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoEllipseFeature());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.typeLibrary.AirspaceAttribute = {\r\n    AIRSPACE_FILL_COLOR: \"fillColor\",\r\n    AIRSPACE_LINE_COLOR: \"lineColor\",\r\n    AIRSPACE_LINE_WIDTH: \"lineWidth\",\r\n    AIRSPACE_LEFT_WIDTH: \"leftWidth\",\r\n    AIRSPACE_RIGHT_WIDTH: \"rightWidth\",\r\n    AIRSPACE_WIDTH: \"width\",\r\n    AIRSPACE_HEIGHT: \"height\",\r\n    AIRSPACE_ALTITUDE: \"altitude\",\r\n    AIRSPACE_MIN_ALTITUDE: \"minAlt\",\r\n    AIRSPACE_MAX_ALTITUDE: \"maxAlt\",\r\n    AIRSPACE_ALTITUDE_MODE: \"altitudeMode\",\r\n    AIRSPACE_INNER_RADIUS: \"innerRadius\",\r\n    AIRSPACE_RADIUS: \"radius\",\r\n    AIRSPACE_LEFT_AZIMUTH: \"leftAzimuth\",\r\n    AIRSPACE_RIGHT_AZIMUTH: \"rightAzimuth\",\r\n    AIRSPACE_ORBIT_TURN: \"turn\"\r\n};\r\n\r\nleafLet.internalPrivateClass.AirspaceAttributes = function(){\r\n    var publicInterface = {\r\n        initialize: function (oProperties, oAttributes) \r\n        {\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var options = {};\r\n            \r\n            for (var sAttr in oAttributes)\r\n            {\r\n                if (!oAttributes.hasOwnProperty(sAttr)) {\r\n                    continue;\r\n                }\r\n                if (sAttr === leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_ORBIT_TURN)\r\n                {\r\n                    options[sAttr] = oAttributes[sAttr].toLowerCase();\r\n                }\r\n                else\r\n                {\r\n                    options[sAttr] = oAttributes[sAttr];\r\n                }\r\n            }\r\n            \r\n            if (oProperties.hasOwnProperty(cAirspaceAttribute.AIRSPACE_FILL_COLOR))\r\n            {\r\n                options[cAirspaceAttribute.AIRSPACE_FILL_COLOR] = oProperties[cAirspaceAttribute.AIRSPACE_FILL_COLOR];\r\n            }\r\n            \r\n            if (oProperties.hasOwnProperty(cAirspaceAttribute.AIRSPACE_LINE_COLOR))\r\n            {\r\n                options[cAirspaceAttribute.AIRSPACE_LINE_COLOR] = oProperties[cAirspaceAttribute.AIRSPACE_LINE_COLOR];\r\n            }\r\n            \r\n            if (oProperties.hasOwnProperty(cAirspaceAttribute.AIRSPACE_LINE_WIDTH))\r\n            {\r\n                options[cAirspaceAttribute.AIRSPACE_LINE_WIDTH] = oProperties[cAirspaceAttribute.AIRSPACE_LINE_WIDTH];\r\n            }\r\n            \r\n            L.Util.setOptions(this, options);\r\n        },\r\n        getValue: function(sAttr)\r\n        {\r\n            return this.options[sAttr];\r\n        },\r\n        setValue: function(sAttr, Value)\r\n        {\r\n            this.options[sAttr] = Value;\r\n        },\r\n        getAttributes: function()\r\n        {\r\n            return this.options;\r\n        },\r\n        setRequiredAttributes: function(sAirspaceType)\r\n        {\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var cAirspaceType = emp.typeLibrary.airspaceSymbolCode;\r\n            \r\n            switch (sAirspaceType)\r\n            {\r\n                case cAirspaceType.SHAPE3D_CURTAIN:\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_CYLINDER:\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_RADIUS, 2000);\r\n                    }\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_ORBIT:\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_WIDTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_WIDTH, 2000);\r\n                    }\r\n                    if (this.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN) === undefined)\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN, emp.typeLibrary.orbitTurnType.CENTER);\r\n                    }\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_POLYARC:\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_RADIUS, 2000);\r\n                    }\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH, 315.0);\r\n                    }\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH, 45.0);\r\n                    }\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_POLYGON:\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_RADARC:\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_RADIUS, 2000);\r\n                    }\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS, 1000);\r\n                    }\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH, 315.0);\r\n                    }\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH, 45.0);\r\n                    }\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_ROUTE:\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_WIDTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_WIDTH, 5000);\r\n                    }\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_TRACK:\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH, 2500);\r\n                    }\r\n                    if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH)))\r\n                    {\r\n                        this.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH, 2500);\r\n                    }\r\n                    break;\r\n            }\r\n            \r\n            var dMinAlt = this.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE);\r\n            if (isNaN(dMinAlt))\r\n            {\r\n                dMinAlt = 0;\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE, dMinAlt);\r\n            }\r\n            if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)))\r\n            {\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE, dMinAlt + 5000);\r\n            }\r\n            else if (dMinAlt > this.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE))\r\n            {\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE, this.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE));\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE, dMinAlt);\r\n            }\r\n            \r\n            if (this.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR) === undefined)\r\n            {\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR, \"0xAAAAFFAA\");\r\n            }\r\n            \r\n            if (this.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR) === undefined)\r\n            {\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR, \"0xFF00AA00\");\r\n            }\r\n            \r\n            if (isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH)))\r\n            {\r\n                this.setValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH, 3);\r\n            }\r\n        },\r\n        getAirspaceAttributes: function()\r\n        {\r\n            var oAttr = {};\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            for (var sAttr in this.options)\r\n            {\r\n                if (!this.options.hasOwnProperty(sAttr)) {\r\n                    continue;\r\n                }\r\n                switch (sAttr)\r\n                {\r\n                    case cAirspaceAttribute.AIRSPACE_FILL_COLOR:\r\n                    case cAirspaceAttribute.AIRSPACE_LINE_COLOR:\r\n                    case cAirspaceAttribute.AIRSPACE_LINE_WIDTH:\r\n                        break;\r\n                    default:\r\n                        oAttr[sAttr] = this.options[sAttr];\r\n                        break;\r\n                }\r\n            }\r\n            \r\n            return oAttr;\r\n        },\r\n        duplicateAttribute: function()\r\n        {\r\n            return new leafLet.typeLibrary.airspace.Attributes({}, this.options);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Attributes = L.Class.extend(leafLet.internalPrivateClass.AirspaceAttributes());\r\n\r\nleafLet.internalPrivateClass.AirspaceAttributeList = function(){\r\n    var publicInterface = {\r\n        initialize: function (oProperties) \r\n        {\r\n            var oAttrList = oProperties.attributes;\r\n            var options = {\r\n                oAttributeList: []\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            \r\n            if (!(oAttrList instanceof Array))\r\n            {\r\n                if ((typeof (oAttrList) === 'object') && (oAttrList.length > 0))\r\n                {\r\n                    this.add(new leafLet.typeLibrary.airspace.Attributes(oProperties, oAttrList));\r\n                }\r\n                else\r\n                {\r\n                    this.add(new leafLet.typeLibrary.airspace.Attributes(oProperties, {}));\r\n                }\r\n            }\r\n            else\r\n            {\r\n                for (var iIndex = 0; iIndex < oAttrList.length; iIndex++)\r\n                {\r\n                    this.add(new leafLet.typeLibrary.airspace.Attributes(oProperties, oAttrList[iIndex]));\r\n                }\r\n            }\r\n        },\r\n        length: function()\r\n        {\r\n            return this.options.oAttributeList.length;\r\n        },\r\n        get: function(iIndex)\r\n        {\r\n            return this.options.oAttributeList[iIndex];\r\n        },\r\n        add: function(oAttr)\r\n        {\r\n            this.options.oAttributeList.push(oAttr);\r\n        },\r\n        insert: function(iIndex, oAttr)\r\n        {\r\n            this.options.oAttributeList.splice(iIndex, 0, oAttr);\r\n        },\r\n        remove: function(iIndex)\r\n        {\r\n            if (iIndex < this.options.oAttributeList.length)\r\n            {\r\n                this.options.oAttributeList.splice(iIndex, 1);\r\n            }\r\n        },\r\n        getAirspaceAttributeList: function()\r\n        {\r\n            var oAttrList = [];\r\n            \r\n            for (var iIndex = 0; iIndex < this.options.oAttributeList.length; iIndex++)\r\n            {\r\n                oAttrList.push(this.options.oAttributeList[iIndex].getAirspaceAttributes());\r\n            }\r\n            \r\n            return oAttrList;\r\n        },\r\n        getMinAltitude: function()\r\n        {\r\n            var dMin = Number.MAX_VALUE;\r\n            var oAttributeList = this.options.oAttributeList;\r\n            var cAttributeConst = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributes;\r\n            var dValue;\r\n            \r\n            for (var iIndex = 0; iIndex < oAttributeList.length; iIndex++)\r\n            {\r\n                oAttributes = oAttributeList[iIndex];\r\n                dValue = oAttributes.getValue(cAttributeConst.AIRSPACE_MIN_ALTITUDE);\r\n                \r\n                if ((typeof (dValue) === 'number') && (dValue < dMin))\r\n                {\r\n                    dMin = dValue;\r\n                }\r\n            }\r\n            \r\n            return Math.round(dMin);\r\n        },\r\n        getMaxAltitude: function()\r\n        {\r\n            var dMax = Number.MIN_VALUE;\r\n            var oAttributeList = this.options.oAttributeList;\r\n            var cAttributeConst = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributes;\r\n            var dValue;\r\n            \r\n            for (var iIndex = 0; iIndex < oAttributeList.length; iIndex++)\r\n            {\r\n                oAttributes = oAttributeList[iIndex];\r\n                dValue = oAttributes.getValue(cAttributeConst.AIRSPACE_MAX_ALTITUDE);\r\n                \r\n                if ((typeof (dValue) === 'number') && (dValue > dMax))\r\n                {\r\n                    dMax = dValue;\r\n                }\r\n            }\r\n            \r\n            return Math.round(dMax);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.AttributeList = L.Class.extend(leafLet.internalPrivateClass.AirspaceAttributeList());\r\n\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.CylinderAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 1, 1);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oAttributes = this.getAttributes(0);\r\n            var oLatLng = this.getCoordinateList()[0];\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            sPopupText = \"<center>\" + (oLatLng? \r\n                    \"<b>Lat</b>:&nbsp;\" + oLatLng.lat.toFixed(5) +\r\n                    \"<br/><b>Lon</b>:&nbsp;\" + oLatLng.lng.toFixed(5): \"\") + \r\n                    \"<br/><b>Radius</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS) + this.getUnits() +\r\n                    \"<br/><b>Min Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);;\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            var oLatLng = oLatLngList[0];\r\n            \r\n            if (oLatLng === undefined)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CYLINDER);\r\n            \r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var iWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n\r\n            var oOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: iWidth,\r\n                oFeature: this\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oOptions.tempColor = oOptions.color;\r\n                oOptions.tempWeight = oOptions.weight;\r\n                \r\n                oOptions.color = '#' + oSelectAttributes.color;\r\n                oOptions.weight = oSelectAttributes.width;\r\n            }\r\n            var oLeafletObject = new L.Circle(oLatLng, oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS), oOptions);\r\n\r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        getFeatureBounds: function()\r\n        {\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLatLng = this.getCoordinateList()[0];\r\n            var oAttributes = this.getAttributes(0);\r\n            var oNorthEast = new L.LatLng(oLatLng.lat, oLatLng.lng);\r\n            var oSouthWest = new L.LatLng(oLatLng.lat, oLatLng.lng);\r\n            var dDist = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS) * 2.0;\r\n\r\n            oNorthEast.moveCoordinate(45.0, dDist);\r\n            oSouthWest.moveCoordinate(225.0, dDist);\r\n\r\n            return new leafLet.typeLibrary.EmpBoundary(oSouthWest, oNorthEast);\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oLeafletObject = this.options.leafletObject;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oLatLng = oCoordList[0];\r\n            var oAttributes = oAttributeList.get(0);\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CYLINDER);\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var iWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n\r\n            var oOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: iWidth\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oOptions.tempColor = oOptions.color;\r\n                oOptions.tempWeight = oOptions.weight;\r\n                \r\n                oOptions.color = '#' + oSelectAttributes.color;\r\n                oOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            oLeafletObject.setLatLng(oLatLng);\r\n            oLeafletObject.setRadius(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS));\r\n            oLeafletObject.setStyle(oOptions);\r\n             \r\n            this.setAttributeList(oAttributeList);\r\n            this.setProperties(oArgs.properties);\r\n            this.setData(oArgs.data);\r\n            \r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Cylinder = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.CylinderAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.PolygonAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 3, Number.MAX_VALUE);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oAttributes = this.getAttributes(0);\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Min Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);;\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            \r\n            if (oLatLngList.length < this.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYGON);\r\n            \r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var iWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n            var oPolygonOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: iWidth,\r\n                oFeature: this\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n            \r\n            var oLeafletObject = new L.Polygon(oLatLngList, oPolygonOptions);\r\n            \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oAttributes;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            oAttributes = oAttributeList.get(0);\r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYGON);\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var iWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n            var oPolygonOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: iWidth\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n\r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            oLeafletObject.setLatLngs(oLatLngList);\r\n            oLeafletObject.setStyle(oPolygonOptions);\r\n            \r\n            this.setAttributeList(oAttributeList);\r\n            this.setProperties(oArgs.properties);\r\n            this.setData(oArgs.data);\r\n            \r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Polygon = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.PolygonAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.CurtainAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 2, Number.MAX_VALUE);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oAttributes = this.getAttributes(0);\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Min Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);;\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CURTAIN);\r\n            \r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var iWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n\r\n            var oOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                weight: iWidth,\r\n                oFeature: this\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oOptions.tempColor = oOptions.color;\r\n                oOptions.tempWeight = oOptions.weight;\r\n                \r\n                oOptions.color = '#' + oSelectAttributes.color;\r\n                oOptions.weight = oSelectAttributes.width;\r\n            }\r\n            \r\n            var oLeafletObject = new L.Polyline(oLatLngList, oOptions);\r\n            \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oLeafletObject = this.options.leafletObject;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oAttributes = oAttributeList.get(0);\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CURTAIN);\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var iWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n\r\n            var oOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                weight: iWidth\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oOptions.tempColor = oOptions.color;\r\n                oOptions.tempWeight = oOptions.weight;\r\n                \r\n                oOptions.color = '#' + oSelectAttributes.color;\r\n                oOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            oLeafletObject.setLatLngs(oCoordList);\r\n            oLeafletObject.setStyle(oOptions);\r\n             \r\n            this.setAttributeList(oAttributeList);\r\n            this.setProperties(oArgs.properties);\r\n            this.setData(oArgs.data);\r\n            \r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Curtain = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.CurtainAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.OrbitAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 2, 2);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oAttributes = this.getAttributes(0);\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Turn</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN) + \r\n                    \"<br/><b>Width</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_WIDTH) +  this.getUnits() +\r\n                    \"<br/><b>Min Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var sTurn;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);;\r\n            var oNewLatLngList = oLatLngList;\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            \r\n            if (oLatLngList.length < 2)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_ORBIT);\r\n            sTurn = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_ORBIT_TURN);\r\n            \r\n            if (sTurn !== emp.typeLibrary.orbitTurnType.CENTER)\r\n            {\r\n                var dDist = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH) / 2;\r\n                var dAnglePt1Pt2 = oLatLngList[0].bearingTo(oLatLngList[1]);\r\n                var dBearing;\r\n                oNewLatLngList = [];\r\n\r\n                switch (sTurn)\r\n                {\r\n                    case emp.typeLibrary.orbitTurnType.RIGHT:\r\n                        dBearing = (dAnglePt1Pt2 + 90.0) % 360;\r\n                        break;\r\n                    case emp.typeLibrary.orbitTurnType.LEFT:\r\n                        dBearing = (dAnglePt1Pt2 + 270.0) % 360;\r\n                        break;\r\n                }\r\n                oNewLatLngList.push(oLatLngList[0].destinationPoint(dBearing, dDist));\r\n                oNewLatLngList.push(oLatLngList[1].destinationPoint(dBearing, dDist));\r\n            }\r\n\r\n            var oLeafletObject = new leafLet.utils.OvalObject({\r\n                    leafletMap: this.options.instanceInterface.leafletInstance,\r\n                    width: oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH),\r\n                    attributes: oAttributes,\r\n                    isSelected: this.isSelected(),\r\n                    selectAttributes: this.getEngineInstanceInterface().selectAttributes,\r\n                    coordinates: oNewLatLngList,\r\n                    oFeature: this\r\n                });\r\n            \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n\r\n            oArgs.oAirspaceAttributeList = oAttributeList;\r\n            return this._createFeature(oArgs);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Orbit = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.OrbitAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.RouteAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 2, Number.MAX_VALUE);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText;\r\n            var oAttributeList = this.getAttributeList();\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Min Alt</b>:&nbsp;\" + oAttributeList.getMinAltitude() + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributeList.getMaxAltitude() + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var oOvalLeafletObject;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);;\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            var bIsSelected = this.isSelected();\r\n           \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_ROUTE);\r\n            \r\n            var oLeafletObject = new L.FeatureGroup();\r\n            \r\n            for (var iIndex = 1; iIndex < oLatLngList.length; iIndex++)\r\n            {\r\n                var oLegCoords = [oLatLngList[iIndex - 1], oLatLngList[iIndex]];\r\n                \r\n                oOvalLeafletObject = new leafLet.utils.OvalObject({\r\n                        leafletMap: this.options.instanceInterface.leafletInstance,\r\n                        width: oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH),\r\n                        attributes: oAttributes,\r\n                        isSelected: bIsSelected,\r\n                        selectAttributes: this.getEngineInstanceInterface().selectAttributes,\r\n                        coordinates: oLegCoords,\r\n                        oFeature: this\r\n                    });\r\n                oLeafletObject.addLayer(oOvalLeafletObject);\r\n            }\r\n            \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oAttributes = oAttributeList.get(0);\r\n            var oOvalLeafletObject;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var bIsSelected = this.isSelected();\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_ROUTE);\r\n            \r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            oLeafletObject.clearLayers();\r\n            \r\n            for (var iIndex = 1; iIndex < oLatLngList.length; iIndex++)\r\n            {\r\n                var oLegCoords = [oLatLngList[iIndex - 1], oLatLngList[iIndex]];\r\n                \r\n                oOvalLeafletObject = new leafLet.utils.OvalObject({\r\n                        leafletMap: this.options.instanceInterface.leafletInstance,\r\n                        width: oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH),\r\n                        attributes: oAttributes,\r\n                        isSelected: bIsSelected,\r\n                        selectAttributes: this.getEngineInstanceInterface().selectAttributes,\r\n                        coordinates: oLegCoords,\r\n                        oFeature: this\r\n                    });\r\n                oLeafletObject.addLayer(oOvalLeafletObject);\r\n            }\r\n            \r\n            this.setAttributeList(oAttributeList);\r\n            this.setData(oArgs.data);\r\n            this.setProperties(oArgs.properties);\r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Route = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.RouteAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.TrackAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 2, Number.MAX_VALUE);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText;\r\n            var oAttributeList = this.getAttributeList();\r\n            //var oAttributes = this.getAttributes(0);\r\n            //var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Min Alt</b>:&nbsp;\" + oAttributeList.getMinAltitude() + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributeList.getMaxAltitude() + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var oOvalLeafletObject;\r\n            var oAttributes;\r\n            var dLeftWidth;\r\n            var dRightWidth;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oAttributeList = oArgs.oAirspaceAttributeList;\r\n            var oLeafletObject = new L.FeatureGroup();\r\n            var bIsSelected = this.isSelected();\r\n\r\n            for (var iIndex = 1; iIndex < oLatLngList.length; iIndex++)\r\n            {\r\n                var oLegCoords = [oLatLngList[iIndex - 1], oLatLngList[iIndex]];\r\n                \r\n                if (iIndex > oAttributeList.length())\r\n                {\r\n                    // We need another attribute element.\r\n                    oAttributes = oAttributeList.get(iIndex - 1);\r\n                    oAttributes = new leafLet.typeLibrary.airspace.Attributes(this.getProperties(), oAttributes.getAttributes());\r\n                    oAttributeList.add(oAttributes);\r\n                }\r\n                \r\n                oAttributes = oAttributeList.get(iIndex - 1);\r\n                oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_TRACK);\r\n\r\n                dLeftWidth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_WIDTH);\r\n                dRightWidth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_WIDTH);\r\n                \r\n                if (dRightWidth !== dLeftWidth)\r\n                {\r\n                    // tracks have diff left and right width and if they are not\r\n                    // equal we need to offset the coordinates to account for it.\r\n                    var Bearing;\r\n                    var dDist = Math.abs(dRightWidth - dLeftWidth) / 2.0;\r\n                    var dBearingPt1Pt2 = oLatLngList[iIndex - 1].bearingTo(oLatLngList[iIndex]);\r\n                    \r\n                    if (dRightWidth > dLeftWidth)\r\n                    {\r\n                        Bearing = (dBearingPt1Pt2 + 90.0) % 360;\r\n                    }\r\n                    else\r\n                    {\r\n                        Bearing = (dBearingPt1Pt2 + 270.0) % 360;\r\n                    }\r\n                    \r\n                    oLegCoords = [oLatLngList[iIndex - 1].destinationPoint(Bearing, dDist), oLatLngList[iIndex].destinationPoint(Bearing, dDist)];\r\n                }\r\n                \r\n                oOvalLeafletObject = new leafLet.utils.OvalObject({\r\n                        leafletMap: this.options.instanceInterface.leafletInstance,\r\n                        width: dLeftWidth + dRightWidth,\r\n                        attributes: oAttributes,\r\n                        isSelected: bIsSelected,\r\n                        selectAttributes: this.getEngineInstanceInterface().selectAttributes,\r\n                        coordinates: oLegCoords,\r\n                        oFeature: this\r\n                    });\r\n                oLeafletObject.addLayer(oOvalLeafletObject);\r\n            }\r\n            \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oOvalLeafletObject;\r\n            var oAttributes;\r\n            var dLeftWidth;\r\n            var dRightWidth;\r\n            var oLatLngList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var bIsSelected = this.isSelected();\r\n            \r\n            oLeafletObject.clearLayers();\r\n            \r\n            for (var iIndex = 1; iIndex < oLatLngList.length; iIndex++)\r\n            {\r\n                var oLegCoords = [oLatLngList[iIndex - 1], oLatLngList[iIndex]];\r\n                \r\n                if (iIndex > oAttributeList.length())\r\n                {\r\n                    // We need another attribute element.\r\n                    oAttributes = oAttributeList.get(iIndex - 1);\r\n                    oAttributes = new leafLet.typeLibrary.airspace.Attributes(oArgs.properties, oAttributes.getAttributes());\r\n                    oAttributeList.add(oAttributes);\r\n                }\r\n                \r\n                oAttributes = oAttributeList.get(iIndex - 1);\r\n                oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_TRACK);\r\n\r\n                dLeftWidth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_WIDTH);\r\n                dRightWidth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_WIDTH);\r\n                \r\n                if (dRightWidth !== dLeftWidth)\r\n                {\r\n                    // tracks have diff left and right width and if they are not\r\n                    // equal we need to offset the coordinates to account for it.\r\n                    var Bearing;\r\n                    var dDist = Math.abs(dRightWidth - dLeftWidth) / 2.0;\r\n                    var dBearingPt1Pt2 = oLatLngList[iIndex - 1].bearingTo(oLatLngList[iIndex]);\r\n                    \r\n                    if (dRightWidth > dLeftWidth)\r\n                    {\r\n                        Bearing = (dBearingPt1Pt2 + 90.0) % 360;\r\n                    }\r\n                    else\r\n                    {\r\n                        Bearing = (dBearingPt1Pt2 + 270.0) % 360;\r\n                    }\r\n                    \r\n                    oLegCoords = [oLatLngList[iIndex - 1].destinationPoint(Bearing, dDist), oLatLngList[iIndex].destinationPoint(Bearing, dDist)];\r\n                }\r\n                \r\n                oOvalLeafletObject = new leafLet.utils.OvalObject({\r\n                        leafletMap: this.options.instanceInterface.leafletInstance,\r\n                        width: dLeftWidth + dRightWidth,\r\n                        attributes: oAttributes,\r\n                        isSelected: bIsSelected,\r\n                        selectAttributes: this.getEngineInstanceInterface().selectAttributes,\r\n                        coordinates: oLegCoords,\r\n                        oFeature: this\r\n                    });\r\n                oLeafletObject.addLayer(oOvalLeafletObject);\r\n            }\r\n             \r\n            this.setAttributeList(oAttributeList);\r\n            this.setProperties(oArgs.properties);\r\n            this.setData(oArgs.data);\r\n           \r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.Track = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.TrackAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.RadArcAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 1, 1);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oAttributes = this.getAttributes(0);\r\n            var oLatLng = this.getCoordinateList()[0];\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Lat</b>:&nbsp;\" + oLatLng.lat.toFixed(5) +\r\n                    \"<br/><b>Lon</b>:&nbsp;\" + oLatLng.lng.toFixed(5) +\r\n                    \"<br/><b>Left Azimuth</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH) + this.getAngleUnits() +\r\n                    \"<br/><b>Right Azimuth</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH) + this.getAngleUnits() +\r\n                    \"<br/><b>Outter Radius</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS) + this.getUnits() +\r\n                    \"<br/><b>Inner Radius</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS) + this.getUnits() +\r\n                    \"<br/><b>Min Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var oPartialCoordList;\r\n            var oLatLngList = [];\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLeafletObject;\r\n            var oCenterLatLng = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data)[0];\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            \r\n            if (oCenterLatLng === undefined)\r\n            {\r\n                return undefined;\r\n            }\r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_RADARC);\r\n            var dLeftAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n            var dRightAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n            var dInnerRadius = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS);\r\n            var dOutterRadius = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS);\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var oPolygonOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),\r\n                oFeature: this\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterfacee().selectAttributes;\r\n                \r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,\r\n                oCenterLatLng, dInnerRadius, dLeftAzimuth, dRightAzimuth, true);\r\n                \r\n            oLatLngList = oLatLngList.concat(oPartialCoordList);\r\n\r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,\r\n                oCenterLatLng, dOutterRadius, dRightAzimuth, dLeftAzimuth, false);\r\n                \r\n            oLatLngList = oLatLngList.concat(oPartialCoordList);\r\n//console.log(\"RadArc Points: \" + oLatLngList.length);\r\n\r\n            oLeafletObject = new L.Polygon(oLatLngList, oPolygonOptions);\r\n             \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oPartialCoordList;\r\n            var oLatLngList = [];\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributes = oAttributeList.get(0);\r\n            var oCenterLatLng = oCoordList[0];\r\n            \r\n            if (oCenterLatLng === undefined)\r\n            {\r\n                return undefined;\r\n            }\r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_RADARC);\r\n            var dLeftAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n            var dRightAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n            var dInnerRadius = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS);\r\n            var dOutterRadius = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS);\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var oPolygonOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH)\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterfacee().selectAttributes;\r\n                \r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,\r\n                oCenterLatLng, dInnerRadius, dLeftAzimuth, dRightAzimuth, true);\r\n                \r\n            oLatLngList = oLatLngList.concat(oPartialCoordList);\r\n\r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,\r\n                oCenterLatLng, dOutterRadius, dRightAzimuth, dLeftAzimuth, false);\r\n                \r\n            oLatLngList = oLatLngList.concat(oPartialCoordList);\r\n\r\n            oLeafletObject.setLatLngs(oLatLngList);\r\n            oLeafletObject.setStyle(oPolygonOptions);\r\n             \r\n            this.setAttributeList(oAttributeList);\r\n            this.setProperties(oArgs.properties);\r\n            this.setData(oArgs.data);\r\n            \r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.RadArc = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.RadArcAirspace());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.PolyArcAirspace = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n            leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this, args, 3, Number.MAX_VALUE);\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oAttributes = this.getAttributes(0);\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLatLng = this.getCoordinateList()[0];\r\n            \r\n            sPopupText = \"<center>\" +\r\n                    \"<b>Lat</b>:&nbsp;\" + oLatLng.lat.toFixed(5) +\r\n                    \"<br/><b>Lon</b>:&nbsp;\" + oLatLng.lng.toFixed(5) +\r\n                    \"<br/><b>Left Azimuth</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH) + this.getAngleUnits() +\r\n                    \"<br/><b>Right Azimuth</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH) + this.getAngleUnits() +\r\n                    \"<br/><b>Radius</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS) + this.getUnits() +\r\n                    \"<br/><b>Min Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"<br/><b>Max Alt</b>:&nbsp;\" + oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE) + this._getAltUnitsAndModeText() + \r\n                    \"</center><br/>\" +\r\n                    this._getPopupDescription();\r\n            return sPopupText;\r\n        },\r\n        _createFeature: function(oArgs)\r\n        {\r\n            var oPartialCoordList;\r\n            var oLatLngList = [];\r\n            var oCoord;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oLeafletObject;\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);;\r\n            var oAttributes = oArgs.oAirspaceAttributeList.get(0);\r\n            \r\n            if (oCoordList.length < this.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYARC);\r\n            var dLeftAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n            var dRightAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n            var dRadius = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS);\r\n            var oCenterLatLng = oCoordList[0];\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var oPolygonOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),\r\n                oFeature: this\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            //oCoord = oCenterLatLng.destinationPoint(dLeftAzimuth, dRadius);\r\n            //oLatLngList.push(oCoord);\r\n            \r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,\r\n                oCenterLatLng, dRadius, dLeftAzimuth, dRightAzimuth, true);\r\n                \r\n            oLatLngList = oLatLngList.concat(oPartialCoordList);\r\n\r\n            oCoord = oCenterLatLng.destinationPoint(dRightAzimuth, dRadius);\r\n            oLatLngList.push(oCoord);\r\n            \r\n            //for (var iIndex = oCoordList.length - 1; iIndex > 0 ; iIndex--)\r\n            for (var iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oLatLngList.push(oCoordList[iIndex]);\r\n            }\r\n            \r\n//console.log(\"PolyArc Points: \" + oLatLngList.length);\r\n\r\n            oLeafletObject = new L.Polygon(oLatLngList, oPolygonOptions);\r\n            \r\n            this.setAttributeList(oArgs.oAirspaceAttributeList);\r\n\r\n            return oLeafletObject;\r\n        },\r\n        _updateFeature: function(oArgs)\r\n        {\r\n            var oPartialCoordList;\r\n            var oLatLngList = [];\r\n            var oCoord;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributeList = new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var oCoordList = leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data);\r\n            var oAttributes = oAttributeList.get(0);\r\n\r\n\r\n            oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYARC);\r\n            var dLeftAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n            var dRightAzimuth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n            var dRadius = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS);\r\n            var oCenterLatLng = oCoordList[0];\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var oPolygonOptions = {\r\n                stroke: true,\r\n                color: oLineColor.sColor,\r\n                opacity: oLineColor.opacity,\r\n                fill: true,\r\n                fillColor: oFillColor.sColor,\r\n                fillOpacity: oFillColor.opacity,\r\n                weight: oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH)\r\n            };\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.getEngineInstanceInterface().selectAttributes;\r\n                \r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n            \r\n            if (oCoordList.length >= this.getMinPoints())\r\n            {\r\n                //oCoord = oCenterLatLng.destinationPoint(dLeftAzimuth, dRadius);\r\n                //oLatLngList.push(oCoord);\r\n\r\n                oPartialCoordList = leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,\r\n                    oCenterLatLng, dRadius, dLeftAzimuth, dRightAzimuth, true);\r\n\r\n                oLatLngList = oLatLngList.concat(oPartialCoordList);\r\n\r\n                oCoord = oCenterLatLng.destinationPoint(dRightAzimuth, dRadius);\r\n                oLatLngList.push(oCoord);\r\n\r\n                for (var iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    oLatLngList.push(oCoordList[iIndex]);\r\n                }\r\n\r\n                oLeafletObject.setLatLngs(oLatLngList);\r\n                oLeafletObject.setStyle(oPolygonOptions);\r\n            }\r\n             \r\n            this.setAttributeList(oAttributeList);\r\n            this.setProperties(oArgs.properties);\r\n            this.setData(oArgs.data);\r\n            \r\n            return oLeafletObject;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.typeLibrary.airspace.PolyArc = leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.PolyArcAirspace());\r\n","/* global leafLet, L, emp */\r\n\r\nleafLet.utils = leafLet.utils || {};\r\n\r\nleafLet.utils.Units = {\r\n    FEET: 'ft',\r\n    METERS: 'm'\r\n};\r\n\r\nleafLet.utils.AngleUnits = {\r\n    DEGREES: '&deg;',\r\n    MILS: 'mils'\r\n};\r\n\r\nleafLet.utils.METERS_PER_FEET = 0.3048;\r\nleafLet.utils.FEET_PER_METERS = 3.28084;\r\nleafLet.utils.MILS_PER_DEGREE = (6400.0 / 360.0);\r\nleafLet.utils.DEGREE_PER_MILS = (360.0 / 6400.0);\r\n\r\nleafLet.utils.AltitudeModeAbbr = function(sMode) {\r\n    var sText = \"\";\r\n\r\n    switch (sMode) {\r\n    case emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND:\r\n        sText = \"AGL\";\r\n        break;\r\n    case emp.typeLibrary.featureAltitudeModeType.ABSOLUTE:\r\n        sText = \"MSL\";\r\n        break;\r\n    }\r\n\r\n    return sText;\r\n};\r\n\r\n\r\nleafLet.utils.normilizeLongitude = function(dLon) {\r\n    if (dLon < -180) {\r\n        while (dLon < -180) {\r\n            dLon += 360;\r\n        }\r\n    } else if (dLon > 180) {\r\n        dLon = ((dLon + 180) % 360) - 180;\r\n    }\r\n\r\n    return dLon;\r\n};\r\n\r\nleafLet.utils.convertViewBound = function(oBounds, oData) {\r\n    var oView = oData || {};\r\n\r\n    oView.west = leafLet.utils.normilizeLongitude(oBounds.getWest());\r\n    oView.south = oBounds.getSouth();\r\n    oView.east = leafLet.utils.normilizeLongitude(oBounds.getEast());\r\n    oView.north = oBounds.getNorth();\r\n\r\n    return oView;\r\n};\r\n\r\nleafLet.utils.isInt = function(sStr) {\r\n    var y = parseInt(sStr, 10);\r\n    return !isNaN(y) && (sStr == y) && (sStr.toString() == y.toString());\r\n};\r\n\r\nleafLet.utils.anyCoordinateInBounds = function(oBounds, oCoordinates) {\r\n    var oCoord;\r\n    var bRet = false;\r\n    var oaCoordList = oCoordinates.coordinates;\r\n\r\n    switch (oCoordinates.type.toLowerCase()) {\r\n    case 'point':\r\n        oCoord = new L.LatLng(oaCoordList[1], oaCoordList[0]);\r\n        bRet = oBounds.contains(oCoord);\r\n        break;\r\n    case 'linestring':\r\n        for(var iIndex = 0; iIndex < oaCoordList.length; iIndex++) {\r\n            oCoord = new L.LatLng(oaCoordList[iIndex][1], oaCoordList[iIndex][0]);\r\n            bRet = oBounds.contains(oCoord);\r\n\r\n            if (bRet) {\r\n                break;\r\n            }\r\n        }\r\n        break;\r\n    case 'polygon':\r\n        oaCoordList = oaCoordList[0];\r\n        for(var iIndex = 0; iIndex < oaCoordList.length; iIndex++) {\r\n            oCoord = new L.LatLng(oaCoordList[iIndex][1], oaCoordList[iIndex][0]);\r\n            bRet = oBounds.contains(oCoord);\r\n\r\n            if (bRet) {\r\n                break;\r\n            }\r\n        }\r\n        break;\r\n    }\r\n\r\n    return bRet;\r\n};\r\n\r\nleafLet.utils.wrapLongitude = function(oMapBoundry, oLatLng) {\r\n    var oMapCenter = oMapBoundry.getCenter();\r\n    var oNewLatLng = oLatLng.wrap();\r\n\r\n    if (oMapBoundry) {\r\n        if (oMapCenter.lng > 0) {\r\n            // The map is on the right side\r\n            if (oMapBoundry.getEast() > 180) {\r\n                // The right side went beyond the date line.\r\n                var oNorthEastBoundry = oMapBoundry.getNorthEast().wrap();\r\n\r\n                if (oNewLatLng.lng <= oNorthEastBoundry.lng) {\r\n                    oNewLatLng.lng = oNewLatLng.lng + 360;\r\n                }\r\n            }\r\n        } else {\r\n            // The map is on the left side\r\n            if (oMapBoundry.getWest() < -180) {\r\n                // The left side went beyond the date line.\r\n                var oNorthWestBoundry = oMapBoundry.getNorthWest().wrap();\r\n\r\n                if (oNewLatLng.lng >= oNorthWestBoundry.lng) {\r\n                    oNewLatLng.lng = oNewLatLng.lng - 360;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return oNewLatLng;\r\n};\r\n\r\nleafLet.utils.wrapCoordinates = function(oMapBoundry, oLatLngList, bWrappedAlready) {\r\n    var iIndex;\r\n    var lng;\r\n    var tempLng;\r\n    var bLnginView;\r\n    var iCoorCnt = oLatLngList.length;\r\n    var bCoordWrapped = bWrappedAlready || false;\r\n    var oMapCenter = oMapBoundry.getCenter();\r\n    var diffWithWest;\r\n    var diffWithEast;\r\n    var empBoundary = new leafLet.typeLibrary.EmpBoundary(oMapBoundry);\r\n    var bIDLinView = empBoundary.containsIDL();\r\n    \r\n    //console.log(\"Start wrapCoordinte\");\r\n    \r\n    for (iIndex = 0; iIndex < iCoorCnt; iIndex++) {\r\n        oLatLngList[iIndex] = oLatLngList[iIndex].wrap();\r\n        lng = oLatLngList[iIndex].lng;\r\n        \r\n        bLnginView = empBoundary.containsCoordiante(oLatLngList[iIndex]);\r\n\r\n        if (bIDLinView) {\r\n            tempLng = (empBoundary.getWest() - empBoundary.getEast()) / 2.0;\r\n            tempLng += empBoundary.getEast();\r\n            if (oMapBoundry.getEast() > 180) {\r\n                // The IDL is on the right of the map.\r\n                if (lng < tempLng) {\r\n                    oLatLngList[iIndex].lng += 360;\r\n                }\r\n            } else {\r\n                // The IDL is on the left of the map.\r\n                if (lng > tempLng) {\r\n                    oLatLngList[iIndex].lng -= 360;\r\n                }\r\n            }\r\n        } else {\r\n            if (!bLnginView) {\r\n                // The coordinate is not in view. We need to calculate where to place the point.\r\n                // Find the half of the outside lng.\r\n                tempLng = (empBoundary.getWest() + 180.0);\r\n                tempLng += (180.0 - empBoundary.getEast());\r\n                tempLng = tempLng / 2.0;\r\n                \r\n                if ((empBoundary.getWest() - tempLng) >= -180) {\r\n                    tempLng = empBoundary.getWest() - tempLng;\r\n                    if (lng < tempLng) {\r\n                        oLatLngList[iIndex].lng += 360;\r\n                    }\r\n                } else {\r\n                    tempLng = empBoundary.getEast() + tempLng;\r\n                    if (lng > tempLng) {\r\n                        oLatLngList[iIndex].lng -= 360;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        //console.log(\"IDL:\" + bIDLinView + \" InBBox:\" + bLnginView + \" Moved:\" + (lng != oLatLngList[iIndex].lng) + \" lat/Lng:\" + oLatLngList[iIndex].lat + \"/\" + oLatLngList[iIndex].lng + ((lng != oLatLngList[iIndex].lng)? \"(\" + oLatLngList[iIndex].lat + \"/\" + lng + \")\": \"\"));\r\n    }\r\n\r\n    return bCoordWrapped;\r\n};\r\n\r\nleafLet.utils.dateLineInFeature = function(oLatLngList) {\r\n    var bDataLineInFeature = false;\r\n    var lng1, lng2;\r\n    var iCount = oLatLngList.length;\r\n    var iCountMinus1 = iCount - 1;\r\n\r\n    if (oLatLngList.length === 0) {\r\n        return false;\r\n    }\r\n\r\n    for (var iIndex = 0; iIndex < iCountMinus1; iIndex++) {\r\n        lng1 = oLatLngList[iIndex].lng + 180;\r\n        lng2 = oLatLngList[iIndex + 1].lng + 180;\r\n\r\n        if (((lng1 > 180) && (lng2 < 180)) ||\r\n                ((lng1 < 180) && (lng2 > 180))) {\r\n            bDataLineInFeature = true;\r\n            break;\r\n        }\r\n    }\r\n\r\n    return bDataLineInFeature;\r\n};\r\n\r\nleafLet.utils.convertToColorString = function(dOpacity, sColor) {\r\n    var sNewColor = sColor.replace(\"#\", \"0x\");\r\n    var iColor = (Math.round(dOpacity * 255) * 4096) + parseInt(sNewColor);\r\n\r\n    sNewColor = iColor.toString(16);\r\n\r\n    return sNewColor;\r\n};\r\n\r\nleafLet.utils.mergeProperties = function(oProperties1, oProperties2) {\r\n    var oProperties = emp.helpers.copyObject(oProperties1);\r\n\r\n    for (var sProp in oProperties2) {\r\n        if (!oProperties2.hasOwnProperty(sProp)) {\r\n            continue;\r\n        }\r\n        oProperties[sProp] = emp.helpers.copyObject(oProperties2[sProp]);\r\n    }\r\n\r\n    return oProperties;\r\n};\r\n\r\nleafLet.utils.metersToFeet = function(iMeters) {\r\n    return iMeters * 3.28084;\r\n};\r\n\r\nleafLet.utils.feetToMeters = function(iFeet) {\r\n    return iFeet * 0.3048;\r\n};\r\n\r\nleafLet.utils.convertColor = function(sColor) {\r\n    var dValue = 255;\r\n    var oRet = {\r\n        sColor: \"\",\r\n        opacity: 1.0\r\n    };\r\n\r\n    if (sColor.indexOf(\"0x\") === 0) {\r\n        sColor = sColor.substr(2);\r\n    }\r\n\r\n    if (sColor.length > 7) {\r\n        // There is an alpha value;\r\n        dValue = parseInt(\"0x\" + sColor.substr(0,2));\r\n        sColor = sColor.substr(2);\r\n    } else if (sColor.length > 6) {\r\n        // There is an alpha value;\r\n        dValue = parseInt(\"0x\" + sColor.substr(0,1));\r\n        sColor = sColor.substr(1);\r\n    }\r\n    oRet.opacity = dValue / 255;\r\n    oRet.sColor = \"#\" + sColor;\r\n\r\n    return oRet;\r\n};\r\n\r\nleafLet.utils.angleBetween = function(oVertice, oPt1, oPt2) {\r\n    var dAngleVPt1 = oVertice.bearingTo(oPt1);\r\n    var dAngleVPt2 = oVertice.bearingTo(oPt2);\r\n    var dAngle = dAngleVPt2 - dAngleVPt1;\r\n\r\n    //if (dAngle > 180.0)\r\n    //{\r\n    //    dAngle = 360.0 - dAngle;\r\n    //}\r\n\r\n    return dAngle;\r\n};\r\n\r\nleafLet.utils.getArcCoordinates = function(oMap, oCenter, dRadius, dStartAzimuth, dEndAzimuth, bClockwise) {\r\n    var oLatLngList = [];\r\n    var oNewPt;\r\n    var dNewAngleDelta;\r\n    var dAngleInc;\r\n    var oPt1 = oCenter.destinationPoint(dStartAzimuth, dRadius);\r\n    var oPt2 = oCenter.destinationPoint(dEndAzimuth, dRadius);\r\n    var oPoint1 = oMap.latLngToContainerPoint(oPt1);\r\n    var oPoint2 = oMap.latLngToContainerPoint(oPt2);\r\n    var dAngleVPt1Pt2 = Math.abs(dEndAzimuth - dStartAzimuth);\r\n    var dPointDist = Math.round(oPoint1.distanceTo(oPoint2));\r\n\r\n    if (bClockwise && (dEndAzimuth < dStartAzimuth)) {\r\n        dAngleVPt1Pt2 = 360 - dAngleVPt1Pt2;\r\n    } else if (!bClockwise && (dStartAzimuth < dEndAzimuth)) {\r\n        dAngleVPt1Pt2 = 360 - dAngleVPt1Pt2;\r\n    }\r\n\r\n    if (!bClockwise) {\r\n        dAngleVPt1Pt2 *= -1.0;\r\n    }\r\n\r\n    dAngleInc = dAngleVPt1Pt2 / dPointDist;\r\n\r\n    oLatLngList.push(oPt1);\r\n\r\n    // Now make the semi-circle arounf Pt2.\r\n    for (var iIndex = 0, dNewAngleDelta = dAngleInc;\r\n            iIndex < dPointDist;\r\n            iIndex++) {\r\n        oNewPt = oCenter.destinationPoint((dStartAzimuth + dNewAngleDelta + 360) % 360, dRadius);\r\n        oLatLngList.push(oNewPt);\r\n        dNewAngleDelta += dAngleInc;\r\n    }\r\n\r\n    oLatLngList.push(oPt2);\r\n\r\n    return oLatLngList;\r\n};\r\n\r\nleafLet.utils.geoColorToHexColorString = function(geoColor) {\r\n    var sColor;\r\n\r\n    sColor = ('00' + geoColor.red.toString(16)).substr(-2);\r\n    sColor += ('00' + geoColor.green.toString(16)).substr(-2);\r\n    sColor += ('00' + geoColor.blue.toString(16)).substr(-2);\r\n\r\n    return sColor;\r\n}\r\n","\r\n/* global leafLet, L, emp */\r\n\r\nleafLet.utils = leafLet.utils || {};\r\n\r\nleafLet.utils.geoJson = (function () {\r\n\r\n    var privateInterface = {\r\n    };\r\n\r\n    var publicInterface = {\r\n        convertCoordinatesToString: function (oGeoJson) {\r\n            var sStr = \"\";\r\n            if (!oGeoJson.hasOwnProperty('type')) {\r\n                throw new Error(\"GeoJSON object with no type property.\");\r\n            }\r\n\r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    sStr = oGeoJson.coordinates[0] + \",\" + oGeoJson.coordinates[1];\r\n\r\n                    if (oGeoJson.coordinates.length === 3) {\r\n                        sStr += \",\" + oGeoJson.coordinates[2];\r\n                    }\r\n                    break;\r\n                case 'linestring':\r\n                    for (var iIndex = 0; iIndex < oGeoJson.coordinates.length; iIndex++) {\r\n                        if (sStr.length > 0) {\r\n                            sStr += \" \";\r\n                        }\r\n                        sStr += oGeoJson.coordinates[iIndex][0] + \",\" + oGeoJson.coordinates[iIndex][1];\r\n\r\n                        if (oGeoJson.coordinates[iIndex].length === 3) {\r\n                            sStr += \",\" + oGeoJson.coordinates[iIndex][2];\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    // we get the coordinates of the outter polygon.\r\n                    for (var iIndex = 0; iIndex < oGeoJson.coordinates[0].length; iIndex++) {\r\n                        if (sStr.length > 0) {\r\n                            sStr += \" \";\r\n                        }\r\n                        sStr += oGeoJson.coordinates[0][iIndex][0] + \",\" + oGeoJson.coordinates[0][iIndex][1];\r\n\r\n                        if (oGeoJson.coordinates[0][iIndex].length === 3) {\r\n                            sStr += \",\" + oGeoJson.coordinates[0][iIndex][2];\r\n                        }\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Error(\"Invalid type for coordinate parsing.\");\r\n            }\r\n\r\n            return sStr;\r\n        },\r\n        convertCoordinateToLatLng: function (oCoord) {\r\n            var oCoordinates;\r\n\r\n            if (oCoord.length === 3) {\r\n                oCoordinates = new L.LatLng(oCoord[1], oCoord[0], oCoord[2]);\r\n            } else {\r\n                oCoordinates = new L.LatLng(oCoord[1], oCoord[0]);\r\n            }\r\n\r\n            return oCoordinates;\r\n        },\r\n        convertCoordinatesToLatLng: function (oGeoJson) {\r\n            var oCoordinates = [];\r\n            var oCoord;\r\n\r\n            if (!oGeoJson.hasOwnProperty('type')) {\r\n                throw new Error(\"GeoJSON object with no type property.\");\r\n            }\r\n\r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    if (oGeoJson.coordinates.length > 0) {\r\n                        oCoordinates.push(publicInterface.convertCoordinateToLatLng(oGeoJson.coordinates));\r\n                    }\r\n                    break;\r\n                case 'linestring':\r\n                    for (var iIndex = 0; iIndex < oGeoJson.coordinates.length; iIndex++) {\r\n                        oCoord = publicInterface.convertCoordinateToLatLng(oGeoJson.coordinates[iIndex]);\r\n                        oCoordinates.push(oCoord);\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    // we get the coordinates of the outter polygon.\r\n                    for (var iIndex = 0; iIndex < oGeoJson.coordinates[0].length; iIndex++) {\r\n                        oCoord = publicInterface.convertCoordinateToLatLng(oGeoJson.coordinates[0][iIndex]);\r\n                        oCoordinates.push(oCoord);\r\n                    }\r\n                    break;\r\n                case 'feature':\r\n                    switch (oGeoJson.geometry.type.toLowerCase()) {\r\n                        case 'point':\r\n                            if (oGeoJson.geometry.coordinates.length > 0) {\r\n                                oCoordinates.push(publicInterface.convertCoordinateToLatLng(oGeoJson.geometry.coordinates));\r\n                            }\r\n                            break;\r\n                        case 'linestring':\r\n                            for (var iIndex = 0; iIndex < oGeoJson.geometry.coordinates.length; iIndex++) {\r\n                                oCoord = publicInterface.convertCoordinateToLatLng(oGeoJson.geometry.coordinates[iIndex]);\r\n                                oCoordinates.push(oCoord);\r\n                            }\r\n                            break;\r\n                        case 'polygon':\r\n                            // we get the coordinates of the outter polygon.\r\n                            for (var iIndex = 0; iIndex < oGeoJson.geometry.coordinates[0].length; iIndex++) {\r\n                                oCoord = publicInterface.convertCoordinateToLatLng(oGeoJson.geometry.coordinates[0][iIndex]);\r\n                                oCoordinates.push(oCoord);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            throw new Error(\"Invalid type for coordinate parsing.\");\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Error(\"Invalid type for coordinate parsing.\");\r\n            }\r\n\r\n            return oCoordinates;\r\n        },\r\n        convertLatLngToGeoJson: function (oLatLng) {\r\n            var oGeoJsonCoord = [];\r\n\r\n            oGeoJsonCoord.push(oLatLng.lng);\r\n            oGeoJsonCoord.push(oLatLng.lat);\r\n\r\n            if (!isNaN(oLatLng.alt)) {\r\n                oGeoJsonCoord.push(oLatLng.alt);\r\n            }\r\n\r\n            return oGeoJsonCoord;\r\n        },\r\n        convertLatLngListToGeoJson: function (oGeoJson, oLatLngList) {\r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    oGeoJson.coordinates = publicInterface.convertLatLngToGeoJson(oLatLngList[0]);\r\n                    break;\r\n                case 'linestring':\r\n                    oGeoJson.coordinates = [];\r\n\r\n                    for (var iIndex = 0; iIndex < oLatLngList.length; iIndex++) {\r\n                        oGeoJson.coordinates.push(publicInterface.convertLatLngToGeoJson(oLatLngList[iIndex]));\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    oGeoJson.coordinates = [[]];\r\n\r\n                    for (var iIndex = 0; iIndex < oLatLngList.length; iIndex++) {\r\n                        oGeoJson.coordinates[0].push(publicInterface.convertLatLngToGeoJson(oLatLngList[iIndex]));\r\n                    }\r\n                    break;\r\n                case 'feature':\r\n                    publicInterface.convertLatLngListToGeoJson(oGeoJson.geometry, oLatLngList);\r\n                    break;\r\n            }\r\n        },\r\n        mergeGeoJSONProperties: function (instanceInterface, oFeatureProperties, oGeoJSONProperties) {\r\n            var oDefaultIcon = emp.utilities.icon.getDefaultIcon();\r\n            var oProperties = {};\r\n            var iXOffset = oDefaultIcon.offset.x;\r\n            var iYOffset = oDefaultIcon.offset.y;\r\n            var sXUnits = oDefaultIcon.offset.xUnits;\r\n            var sYUnits = oDefaultIcon.offset.yUnits;\r\n            var sDefaultIconUrl = oDefaultIcon.iconUrl;\r\n            var sURL = (instanceInterface.bUseProxy ?\r\n                    instanceInterface.getProxyURL() + \"?\" + \"mime=image/*&url=\" + escape(sDefaultIconUrl) : sDefaultIconUrl);\r\n\r\n            if (oGeoJSONProperties) {\r\n                if (oGeoJSONProperties.hasOwnProperty('id')) {\r\n                    oProperties.sSubItemID = oGeoJSONProperties.id;\r\n                }\r\n                if (oGeoJSONProperties.hasOwnProperty('lineColor')) {\r\n                    oProperties.color = '#' + oGeoJSONProperties.lineColor.substr(2);\r\n                    var dOpacity = parseInt(\"0x\" + oGeoJSONProperties.lineColor.substr(0, 2)) / 255.0;\r\n                    oProperties.opacity = dOpacity;\r\n                }\r\n                if (oGeoJSONProperties.hasOwnProperty('fillColor')) {\r\n                    oProperties.fillColor = '#' + oGeoJSONProperties.fillColor.substr(2);\r\n                    var dOpacity = parseInt(\"0x\" + oGeoJSONProperties.fillColor.substr(0, 2)) / 255.0;\r\n                    oProperties.fillOpacity = dOpacity;\r\n                }\r\n                if (oGeoJSONProperties.hasOwnProperty('lineWidth')) {\r\n                    oProperties.weigh = parseInt(oGeoJSONProperties.lineWidth);\r\n                }\r\n                if (oGeoJSONProperties.hasOwnProperty('iconUrl')) {\r\n                    sURL = (this.options.instanceInterface.bUseProxy ?\r\n                            this.options.instanceInterface.getProxyURL() + \"?\" + \"mime=image/*&url=\" + escape(oGeoJSONProperties.iconUrl) :\r\n                            oGeoJSONProperties.iconUrl);\r\n                }\r\n\r\n                if (oGeoJSONProperties.hasOwnProperty('iconXOffset')) {\r\n                    iXOffset = oGeoJSONProperties.iconXOffset;\r\n                }\r\n\r\n                if (oGeoJSONProperties.hasOwnProperty('iconYOffset')) {\r\n                    iYOffset = oGeoJSONProperties.iconYOffset;\r\n                }\r\n\r\n                if (oGeoJSONProperties.hasOwnProperty('xUnits')) {\r\n                    sXUnits = oGeoJSONProperties.xUnits;\r\n                }\r\n\r\n                if (oGeoJSONProperties.hasOwnProperty('yUnits')) {\r\n                    sYUnits = oGeoJSONProperties.yUnits;\r\n                }\r\n            }\r\n\r\n            if (oFeatureProperties) {\r\n                if (oFeatureProperties.hasOwnProperty('lineColor')) {\r\n                    oProperties.color = '#' + oFeatureProperties.lineColor.substr(2);\r\n                    var dOpacity = parseInt(\"0x\" + oFeatureProperties.lineColor.substr(0, 2)) / 255.0;\r\n                    oProperties.opacity = dOpacity;\r\n                }\r\n                if (oFeatureProperties.hasOwnProperty('fillColor')) {\r\n                    oProperties.fillColor = '#' + oFeatureProperties.fillColor.substr(2);\r\n                    var dOpacity = parseInt(\"0x\" + oFeatureProperties.fillColor.substr(0, 2)) / 255.0;\r\n                    oProperties.fillOpacity = dOpacity;\r\n                }\r\n                if (oFeatureProperties.hasOwnProperty('lineWidth')) {\r\n                    oProperties.weight = parseInt(oFeatureProperties.lineWidth);\r\n                }\r\n                if (oFeatureProperties.hasOwnProperty('iconUrl')) {\r\n                    sURL = (this.options.instanceInterface.bUseProxy ?\r\n                            this.options.instanceInterface.getProxyURL() + \"?\" + \"mime=image/*&url=\" + escape(oFeatureProperties.iconUrl) :\r\n                            oFeatureProperties.iconUrl);\r\n                }\r\n\r\n                if (oFeatureProperties.hasOwnProperty('iconXOffset')) {\r\n                    iXOffset = oFeatureProperties.iconXOffset;\r\n                }\r\n\r\n                if (oFeatureProperties.hasOwnProperty('iconYOffset')) {\r\n                    iYOffset = oFeatureProperties.iconYOffset;\r\n                }\r\n\r\n                if (oFeatureProperties.hasOwnProperty('xUnits')) {\r\n                    sXUnits = oFeatureProperties.xUnits;\r\n                }\r\n\r\n                if (oFeatureProperties.hasOwnProperty('yUnits')) {\r\n                    sYUnits = oFeatureProperties.yUnits;\r\n                }\r\n            }\r\n\r\n            oProperties.iconOptions = {\r\n                iconUrl: sURL,\r\n                iconAnchor: new L.Point(iXOffset, iYOffset),\r\n                iconAnchorType: {x: sXUnits, y: sYUnits}\r\n            };\r\n\r\n            return oProperties;\r\n        },\r\n        getGeometryType: function (oGeoJson) {\r\n            var sType;\r\n\r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    sType = 'Point';\r\n                    break;\r\n                case 'linestring':\r\n                    sType = 'LineString';\r\n                    break;\r\n                case 'polygon':\r\n                    sType = 'Polygon';\r\n                    break;\r\n                case 'feature':\r\n                    sType = publicInterface.getGeometryType(oGeoJson.geometry);\r\n                    break;\r\n                default:\r\n                    sType = oGeoJson.type;\r\n                    break;\r\n            }\r\n\r\n            return sType;\r\n        },\r\n        isAOI: function (oItem) {\r\n            var bRet = false;\r\n            var oGeoJson = oItem.data;\r\n\r\n            if (oGeoJson.hasOwnProperty('type') &&\r\n                    (oGeoJson.type.toLowerCase() === 'feature')) {\r\n                if (oGeoJson.hasOwnProperty('properties') &&\r\n                        oGeoJson.properties.hasOwnProperty('aoi')) {\r\n                    bRet = true;\r\n                }\r\n            }\r\n            return bRet;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n}());\r\n","/* global leafLet, L, emp, armyc2, sec */\r\n\r\nleafLet.utils = leafLet.utils || {};\r\n\r\nleafLet.utils.milstd = (function() {\r\n    var privateInterface = {\r\n        getAutoWidth: function(oMap) {\r\n            var oBounds = oMap.getBounds();\r\n            var dCenterLat = (oBounds.getNorth() - oBounds.getSouth()) / 2.0;\r\n            var oCenterWest = new L.LatLng(dCenterLat, leafLet.utils.normilizeLongitude(oBounds.getWest()));\r\n            var oCenterEast = new L.LatLng(dCenterLat, leafLet.utils.normilizeLongitude(oBounds.getEast()));\r\n            return Math.round(oCenterWest.distanceTo(oCenterEast) / 32.0);\r\n        },\r\n        checkModifier: function(sBasicSymbol, sModifier, oModifiers, i2525Version, oMap) {\r\n            var sBaseModifier;\r\n            var sDigit;\r\n            var iDigit;\r\n            var oTGModifiers = armyc2.c2sd.renderer.utilities.ModifiersTG;\r\n            var oBasicCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            sBaseModifier = sModifier;\r\n            sDigit = \"0\";\r\n\r\n            // See if the modifier has a digit or a # sign.\r\n            if (leafLet.utils.isInt(sBaseModifier.charAt(sBaseModifier.length - 1))\r\n            || (sBaseModifier.charAt(sBaseModifier.length - 1) === '#')) {\r\n                sDigit = sBaseModifier.substr(sBaseModifier.length - 1);\r\n                sBaseModifier = sBaseModifier.substr(0, sBaseModifier.length - 1);\r\n            }\r\n\r\n            iDigit = parseInt(sDigit, 10);\r\n            if (isNaN(iDigit)) {\r\n                iDigit = 0;\r\n            }\r\n\r\n            if (oModifiers[sBaseModifier] === undefined) {\r\n                // This modifier is not present.\r\n                switch (sBaseModifier) {\r\n                case oTGModifiers.T_UNIQUE_DESIGNATION_1:\r\n                    oModifiers[sModifier] = \"\";\r\n                    break;\r\n                case oTGModifiers.AM_DISTANCE:\r\n                    oModifiers[sBaseModifier] = [];\r\n                    break;\r\n                case oTGModifiers.AN_AZIMUTH:\r\n                    oModifiers[sBaseModifier] = [];\r\n                    break;\r\n                case oTGModifiers.S_OFFSET_INDICATOR:\r\n                    oModifiers[sModifier] = \"\";\r\n                    break;\r\n                case oTGModifiers.V_EQUIP_TYPE:\r\n                    oModifiers[sModifier] = \"\";\r\n                    break;\r\n                case oTGModifiers.W_DTG_1:\r\n                    oModifiers[sModifier] = \"\";\r\n                    break;\r\n                case oTGModifiers.H_ADDITIONAL_INFO_1:\r\n                    if ((sDigit === '2') && (i2525Version === 0)) {\r\n                        switch (sBasicSymbol) {\r\n                        case oBasicCodes.AIR_CORRIDOR:\r\n                        case oBasicCodes.MINIMUM_RISK_ROUTE:\r\n                        case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:\r\n                        case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:\r\n                        case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:\r\n                            if (oModifiers[oTGModifiers.AM_DISTANCE] === undefined) {\r\n                                oModifiers[sModifier] = privateInterface.getAutoWidth(oMap);\r\n                            } else if (oModifiers[oTGModifiers.AM_DISTANCE].length === 0) {\r\n                                oModifiers[oTGModifiers.AM_DISTANCE].push(privateInterface.getAutoWidth(oMap));\r\n                            }\r\n                            break;\r\n                        default:\r\n                            break;\r\n                        }\r\n                    } else {\r\n                        oModifiers[sModifier] = \"\";\r\n                    }\r\n                    break;\r\n                case oTGModifiers.X_ALTITUDE_DEPTH:\r\n                    oModifiers[sBaseModifier] = [];\r\n                    break;\r\n                }\r\n            } else {\r\n                // If we reach here the modifier has been provided, and if its an AM, AN, or X.\r\n                // We need to make sure that its an array.\r\n                switch (sBaseModifier) {\r\n                case oTGModifiers.AM_DISTANCE:\r\n                case oTGModifiers.AN_AZIMUTH:\r\n                case oTGModifiers.X_ALTITUDE_DEPTH:\r\n                    if (!(oModifiers[sBaseModifier] instanceof Array)) {\r\n                        if (oModifiers[sBaseModifier] === undefined) {\r\n                            oModifiers[sBaseModifier] = [];\r\n                        } else {\r\n                            var Value = oModifiers[sBaseModifier];\r\n                            oModifiers[sBaseModifier] = [Value];\r\n                            //oModifiers[sBaseModifier].splice(iDigit, 0, Value);\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (oModifiers[sBaseModifier] instanceof Array) {\r\n                switch (sBaseModifier) {\r\n                case oTGModifiers.AM_DISTANCE:\r\n                    var dValue;\r\n                    var dBaseValue;\r\n                    switch (sBasicSymbol) {\r\n                    case oBasicCodes.AIR_CORRIDOR:\r\n                    case oBasicCodes.MINIMUM_RISK_ROUTE:\r\n                    case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:\r\n                    case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:\r\n                    case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:\r\n                        if (oModifiers[oTGModifiers.AM_DISTANCE] === undefined) {\r\n                            oModifiers[sModifier] = privateInterface.getAutoWidth(oMap);\r\n                        } else if (oModifiers[oTGModifiers.AM_DISTANCE].length === 0) {\r\n                            oModifiers[oTGModifiers.AM_DISTANCE].push(privateInterface.getAutoWidth(oMap));\r\n                        }\r\n                        break;\r\n                    case oBasicCodes.CIRCULAR_RANGE_FAN:\r\n                    case oBasicCodes.SECTOR_RANGE_FAN:\r\n                    default:\r\n                        dBaseValue = 5000.0;\r\n                        if (sDigit.indexOf('#') !== -1) {\r\n                            if (oModifiers[sBaseModifier].length === 0) {\r\n                                oModifiers[sBaseModifier].push(dBaseValue);\r\n                            }\r\n                        } else if (oModifiers[sBaseModifier][iDigit] === undefined) {\r\n                            oModifiers[sBaseModifier].splice(iDigit, 0, dBaseValue * (iDigit + 1));\r\n                        }\r\n                        break;\r\n                    }\r\n                    break;\r\n                case oTGModifiers.AN_AZIMUTH:\r\n                    switch (sBasicSymbol) {\r\n                    case oBasicCodes.SECTOR_RANGE_FAN:\r\n                        if (sDigit.indexOf('#') !== -1) {\r\n                            for (var iIndex = 0; iIndex < 2; iIndex++) {\r\n                                if (iIndex >= oModifiers[sBaseModifier].length) {\r\n                                    // Only add the value if it does not contain one..\r\n                                    oModifiers[sBaseModifier].splice(iIndex, 0, (((iIndex % 2) === 0)? 315.0: 45));\r\n                                }\r\n                            }\r\n                        } else if (oModifiers[sBaseModifier][iDigit] === undefined) {\r\n                            oModifiers[sBaseModifier].splice(iDigit, 0, (((iDigit % 2) === 0)? 315.0: 45));\r\n                        }\r\n                        break;\r\n                    default:\r\n                        if (sDigit.indexOf('#') !== -1) {\r\n                            if (oModifiers[sBaseModifier].length === 0) {\r\n                                // Only add the value if it does not contain one..\r\n                                oModifiers[sBaseModifier].splice(0, 0, 0);\r\n                            }\r\n                        } else if (oModifiers[sBaseModifier][iDigit] === undefined) {\r\n                            oModifiers[sBaseModifier].splice(iDigit, 0, 0);\r\n                        }\r\n                        break;\r\n                    }\r\n                    break;\r\n                case oTGModifiers.X_ALTITUDE_DEPTH:\r\n                    break;\r\n                }\r\n            }\r\n        },\r\n        createMilStdEditor: function(oPrivateInterface, oTransaction, oFeature, oEmpItem,  sBasicSymbolCode, oSymbolDef, i2525Version) {\r\n            var oEditor = undefined;\r\n            var isMultiPoint = armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sBasicSymbolCode, i2525Version);\r\n            var oSymbolDefTable = armyc2.c2sd.renderer.utilities.SymbolDefTable;\r\n            var oParameters = {\r\n                transaction: oTransaction,\r\n                EmpDrawEditItem: oEmpItem,\r\n                feature: oFeature,\r\n                instanceInterface: oPrivateInterface,\r\n                basicSymbolCode: sBasicSymbolCode,\r\n                SymbolDef: oSymbolDef,\r\n                multiPoint: isMultiPoint\r\n            };\r\n\r\n            if (!isMultiPoint) {\r\n                oEditor = new leafLet.editor.MilStdSinglePoint(oParameters);\r\n            } else switch (oSymbolDef.drawCategory) {\r\n                /**\r\n                * A polyline, a line with n number of points.\r\n                * 0 control points\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_LINE:\r\n                /**\r\n                * A polyline with n points (entered in reverse order)\r\n                * 0 control points\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_ARROW:\r\n                    oEditor = new leafLet.editor.MilStdDCLine(oParameters);\r\n                    break;\r\n                /**\r\n                * An animated shape, uses the animate function to draw.\r\n                * 0 control points (every point shapes symbol)\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_AUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDCAutoShape(oParameters);\r\n                    break;\r\n                /**\r\n                * An enclosed polygon with n points\r\n                * 0 control points\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_POLYGON:\r\n                    oEditor = new leafLet.editor.MilStdDCPolygon(oParameters);\r\n                    break;\r\n                /**\r\n                * A graphic with n points whose last point defines the width of the graphic.\r\n                * 1 control point\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_ROUTE:\r\n                    oEditor = new leafLet.editor.MilStdDCRoute(oParameters);\r\n                    break;\r\n                /**\r\n                * A line defined only by 2 points, and cannot have more.\r\n                * 0 control points\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTLINE:\r\n                /**\r\n                * A polyline with 2 points (entered in reverse order).\r\n                * 0 control points\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTARROW:\r\n                    oEditor = new leafLet.editor.MilStdDC2PointLine(oParameters);\r\n                    break;\r\n                /**\r\n                * Shape is defined by a single point\r\n                * 0 control points\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_POINT:\r\n                    oEditor = new leafLet.editor.MilStdSinglePoint(oParameters);\r\n                    break;\r\n                /**\r\n                * An animated shape, uses the animate function to draw. Super Autoshape draw\r\n                * in 2 phases, usually one to define length, and one to define width.\r\n                * 0 control points (every point shapes symbol)\r\n                *\r\n                */\r\n                case oSymbolDefTable.DRAW_CATEGORY_SUPERAUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDCSuperAutoShape(oParameters);\r\n                    break;\r\n                /**\r\n                 * Circle that requires 1 AM modifier value.\r\n                 * See ModifiersTG.js for modifier descriptions and constant key strings.\r\n                 */\r\n                case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDCCircularAutoShape(oParameters);\r\n                    break;\r\n                /**\r\n                 * Rectangle that requires 2 AM modifier values and 1 AN value.\";\r\n                 * See ModifiersTG.js for modifier descriptions and constant key strings.\r\n                 */\r\n                case oSymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDCRectParamAutoShape(oParameters);\r\n                    break;\r\n                /**\r\n                 * Requires 2 AM values and 2 AN values per sector.\r\n                 * The first sector can have just one AM value although it is recommended\r\n                 * to always use 2 values for each sector.  X values are not required\r\n                 * as our rendering is only 2D for the Sector Range Fan symbol.\r\n                 * See ModifiersTG.js for modifier descriptions and constant key strings.\r\n                 */\r\n                case oSymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDCSectorParamAutoShape(oParameters);\r\n                    break;\r\n                /**\r\n                 *  Requires at least 1 distance/AM value\"\r\n                 *  See ModifiersTG.js for modifier descriptions and constant key strings.\r\n                 */\r\n                case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDCCircularRangeFan(oParameters);\r\n                    break;\r\n                /**\r\n                 * Requires 1 AM value.\r\n                 * See ModifiersTG.js for modifier descriptions and constant key strings.\r\n                 */\r\n                case oSymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:\r\n                    oEditor = new leafLet.editor.MilStdDC2PointRectAutoShape(oParameters);\r\n                    break;\r\n                /**\r\n                 * 3D airspace, not a milstd graphic.\r\n                 */\r\n                case oSymbolDefTable.DRAW_CATEGORY_3D_AIRSPACE:\r\n                    break;\r\n                }\r\n\r\n            return oEditor;\r\n        }\r\n    };\r\n\r\n    var publicInterface = {\r\n        areModifierValuesEqual: function(oValue1, oValue2) {\r\n            if ((oValue1 instanceof Array) !== (oValue2 instanceof Array)) {\r\n                // One is an array the other is not.\r\n                return false;\r\n            } else if (typeof oValue1 !== typeof oValue2) {\r\n                return false;\r\n            }\r\n\r\n            if (oValue1 instanceof Array) {\r\n                if (oValue1.length !== oValue2.length) {\r\n                    // They are diff sizes.\r\n                    return false;\r\n                }\r\n\r\n                for (var iIndex = 0; iIndex < oValue1.length; iIndex++) {\r\n                    if (oValue1[iIndex] !== oValue2[iIndex]) {\r\n                        // Diff value.\r\n                        return false;\r\n                    }\r\n                }\r\n            } else if (typeof oValue1 === 'object') {\r\n                var sValue1 = JSON.stringify(oValue1);\r\n                var sValue2 = JSON.stringify(oValue2);\r\n\r\n                if (sValue1 !== sValue2) {\r\n                    // Diff value.\r\n                    return false;\r\n                }\r\n            } else if (oValue1 !== oValue2) {\r\n                // Diff value.\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n        getRequiredModifiers: function(sBasicSymbol, i2525Version) {\r\n            var sReqModifiers = \"\";\r\n            var oSymbolDef = armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(sBasicSymbol, i2525Version);\r\n            var oSymDefTable = armyc2.c2sd.renderer.utilities.SymbolDefTable;\r\n            var oBasicCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oSymbolDef !== null) {\r\n                switch (oSymbolDef.drawCategory) {\r\n                case oSymDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:\r\n                    // Requires 1 AM.\r\n                    sReqModifiers = \"AM\";\r\n                    break;\r\n                case oSymDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:\r\n                    // Requires 2 AM, 1 AN\r\n                    sReqModifiers = \"AM.AM1.AN\";\r\n                    break;\r\n                case oSymDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:\r\n                    // Requires 1 or more AMs, (2 * (the # AM)) ANs\r\n                    sReqModifiers = \"AM#.AN#\";\r\n                    break;\r\n                case oSymDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:\r\n                    // Requires 1 - 3 AMs.\r\n                    sReqModifiers = \"AM.AM1.AM2\";\r\n                    break;\r\n                case oSymDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:\r\n                    // Requires 1 AM.\r\n                    sReqModifiers = \"AM\";\r\n                    break;\r\n                }\r\n\r\n                switch (sBasicSymbol) {\r\n                case oBasicCodes.AIR_CORRIDOR:\r\n                case oBasicCodes.MINIMUM_RISK_ROUTE:\r\n                case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:\r\n                case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:\r\n                case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:\r\n                    // Requires 1 AM.\r\n                    sReqModifiers = \"AM\";\r\n                    break;\r\n                default:\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return sReqModifiers;\r\n        },\r\n        applyRequiredModifiers: function(sSymbolCode, oModifier, i2525Version, oMap) {\r\n            var sBasicSymbolCode = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(sSymbolCode);\r\n            var sRequiredModifiers = publicInterface.getRequiredModifiers(sBasicSymbolCode, i2525Version);\r\n\r\n            if (sRequiredModifiers.length === 0) {\r\n                return;\r\n            }\r\n\r\n            var oRequiredModifiers = sRequiredModifiers.split(\".\");\r\n\r\n            for (var iIndex = 0; iIndex < oRequiredModifiers.length; iIndex++) {\r\n                if (oRequiredModifiers[iIndex].length === 0) {\r\n                    continue;\r\n                }\r\n                privateInterface.checkModifier(sBasicSymbolCode, oRequiredModifiers[iIndex], oModifier, i2525Version, oMap);\r\n            }\r\n        },\r\n        convertModifiersTo2525: function(args) {\r\n            var sColor;\r\n            var oModifiers = {};\r\n            var oProperties = args.properties || {};\r\n            var oPropModifiers = oProperties.modifiers || {};\r\n            var longModifiers = leafLet.utils.milstd.longModifiers;\r\n            var o2525Modifiers = leafLet.utils.milstd.Modifiers;\r\n\r\n            //var modifierOnList = function(sModifier)\r\n            //{\r\n            //    return ((args.instanceInterface.oLabelList.indexOf(sModifier) === -1)? false: true);\r\n            //};\r\n\r\n            if (!oPropModifiers.hasOwnProperty(longModifiers.STANDARD) && !oPropModifiers.hasOwnProperty(o2525Modifiers.STANDARD)) {\r\n                oPropModifiers[longModifiers.STANDARD] = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n            }\r\n\r\n            for (var sModifier in oPropModifiers) {\r\n                if (!oPropModifiers.hasOwnProperty(sModifier)) {\r\n                    continue;\r\n                }\r\n                var s2525Modifier = leafLet.utils.milstd.stringToModifiers[sModifier] || sModifier;\r\n                /*\r\n                                switch (s2525Modifier)\r\n                                {\r\n                                    case o2525Modifiers.STANDARD:\r\n                                    case o2525Modifiers.AZIMUTH:\r\n                                    case o2525Modifiers.DISTANCE:\r\n                                    case o2525Modifiers.ALTITUDE_DEPTH:\r\n                                        break;\r\n                                    default:\r\n                                        if (!modifierOnList(s2525Modifier))\r\n                                        {\r\n                                            // Its not on the list, jump over it.\r\n                                            continue;\r\n                                        }\r\n                                        break;\r\n                                }\r\n                */\r\n                if (s2525Modifier) {\r\n                    if ((s2525Modifier === o2525Modifiers.STANDARD) && (typeof (oPropModifiers[sModifier]) === 'string')) {\r\n                        //oModifiers[sModifier] = oPropModifiers[sModifier];\r\n                        oModifiers[s2525Modifier] = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oPropModifiers[sModifier]);\r\n                    } else {\r\n                        oModifiers[s2525Modifier] = emp.helpers.copyObject(oPropModifiers[sModifier]);\r\n                    }\r\n                } else {\r\n                    oModifiers[sModifier] = emp.helpers.copyObject(oPropModifiers[sModifier]);\r\n                }\r\n            }\r\n\r\n            if (!emp.util.isEmptyString(oProperties[longModifiers.LINE_COLOR])) {\r\n                sColor = oProperties[longModifiers.LINE_COLOR];\r\n                if (sColor.length > 5) {\r\n                    sColor = sColor.substr(sColor.length - 6, 6);\r\n                }\r\n                oModifiers[longModifiers.LINE_COLOR] = sColor;\r\n            }\r\n\r\n            if (!emp.util.isEmptyString(oProperties[longModifiers.FILL_COLOR])) {\r\n                sColor = oProperties[longModifiers.FILL_COLOR];\r\n                if (sColor.length > 5) {\r\n                    sColor = sColor.substr(sColor.length - 6, 6);\r\n                }\r\n                oModifiers[longModifiers.FILL_COLOR] = sColor;\r\n            }\r\n\r\n            return oModifiers;\r\n        },\r\n        createEditor: function(oPrivateInterface, oTransaction, oEmpItem, oFeature) {\r\n            var sSymbolCode;\r\n            var i2525Version;\r\n\r\n            if (oFeature) {\r\n                var oModifiers = oFeature.getMilStdModifiers();\r\n                sSymbolCode = oFeature.getData().symbolCode;\r\n                i2525Version = oModifiers[leafLet.utils.milstd.Modifiers.STANDARD];\r\n                i2525Version = i2525Version || 0;\r\n            } else {\r\n                // Its definitly a draw.\r\n                var oProperties = oEmpItem.properties;\r\n                var oModifiers = (oProperties? oProperties.modifiers: undefined);\r\n                var symStd = (oModifiers? oModifiers[leafLet.utils.milstd.longModifiers.STANDARD]: \"2525b\");\r\n                i2525Version = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(symStd);\r\n                sSymbolCode = oEmpItem.symbolCode;\r\n            }\r\n\r\n            var sBasicSymbolCode = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(sSymbolCode);\r\n            var oSymbolDef = armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(sBasicSymbolCode, i2525Version);\r\n\r\n            return privateInterface.createMilStdEditor(oPrivateInterface, oTransaction, oFeature, oEmpItem, sBasicSymbolCode, oSymbolDef, i2525Version);\r\n        },\r\n        renderMPGraphic: function(oArgs) {\r\n            //oArgs = {instanceInterface, isSelected, sID, sName, sDescription, sSymbolCode, oCoordData, oModifiers, i2525Version, empMapBounds}\r\n            var iOutputFormat = 2;\r\n            var oMap = oArgs.instanceInterface.getLeafletMap();\r\n            var mapBounds = oMap.getBounds();\r\n            var empMapBounds = oArgs.empMapBounds; // oMap.getBounds();\r\n            var oRenderer = sec.web.renderer.SECWebRenderer;\r\n            var sCoordinateStr = leafLet.utils.geoJson.convertCoordinatesToString(oArgs.oCoordData);\r\n            var iZoom = oMap.getZoom();\r\n            var dScale = oArgs.instanceInterface.getScale(iZoom);\r\n            var dMaxLabelScale = oArgs.instanceInterface.dMaxLabelScale;\r\n            var sBBox = null;\r\n            var oDimension = oMap.getSize();\r\n            var cModifiers = leafLet.utils.milstd.longModifiers;\r\n            var bIsSelected = oArgs.oFeature.isSelected();\r\n            var oSelectAttributes = oArgs.instanceInterface.selectAttributes;\r\n            var bIDLInView = empMapBounds.containsIDL();\r\n            var pointConverter = new leafLet.utils.renderer.PointConverter(oMap, oDimension.x, oDimension.y, mapBounds, empMapBounds);\r\n            \r\n            if ((mapBounds.getEast() - mapBounds.getWest()) < 180.0) {\r\n                sBBox = empMapBounds.getWest() + \",\" + empMapBounds.getSouth() + \",\" + empMapBounds.getEast() + \",\" + empMapBounds.getNorth();\r\n            }\r\n            //console.log(\"BBox: \" + sBBox);\r\n            //console.log(\"    map BBox: \" + mapBounds.getWest() + \",\" + mapBounds.getSouth() + \",\" + mapBounds.getEast() + \",\" + mapBounds.getNorth());\r\n            //console.log(\"  center lng: \" + oMap.getCenter().lng);\r\n            //console.log(\"      size x: \" + oDimension.x + \" y:\" + oDimension.y);\r\n\r\n            try {\r\n                var sGeoJsonData = oRenderer.RenderSymbol2D(oArgs.sID, oArgs.sName, oArgs.sDescription, oArgs.sSymbolCode, sCoordinateStr, oDimension.x, oDimension.y, sBBox, oArgs.oModifiers, iOutputFormat, oArgs.i2525Version, null, pointConverter);\r\n                var oGeoJson = JSON.parse(sGeoJsonData);\r\n/*\r\n                console.log(\"Call to RenderSymbol2D:\\n\" +\r\n                        \"Symbol Code: \" + oArgs.sSymbolCode + \"\\n\" +\r\n                        \"id: \" + oArgs.sID + \"\\n\" +\r\n                        \"name: \" + oArgs.sName + \"\\n\" +\r\n                        \"description: \" + oArgs.sDescription + \"\\n\" +\r\n                        \"coordinates: \" + sCoordinateStr + \"\\n\" +\r\n                        \"width: \" + oDimension.x + \"\\n\" +\r\n                        \"height: \" + oDimension.y + \"\\n\" +\r\n                        \"bbox: \" + sBBox + \"\\n\" +\r\n                        \"modifiers: \" + JSON.stringify(oArgs.oModifiers) + \"\\n\" +\r\n                        \"outFormat: \" + iOutputFormat + \"\\n\" +\r\n                        \"2525 version: \" + oArgs.i2525Version + \"\\n\" +\r\n                        \"geoJSON returned:\\n\" + sGeoJsonData + \"\\n\"\r\n                        );\r\n*/\r\n                var oLeaftletGeoJSON = new L.GeoJSON(oGeoJson, {\r\n                    style: function (oGeoJsonfeature) {\r\n                        var oStyle = {};\r\n\r\n                        switch (oGeoJsonfeature.geometry.type) {\r\n                        case 'Point':\r\n                            break;\r\n                        case 'LineString':\r\n                        case 'MultiLineString':\r\n                            oStyle.color = oGeoJsonfeature.properties.strokeColor;\r\n                            oStyle.opacity = oGeoJsonfeature.properties.lineOpacity;\r\n                            oStyle.weight = oGeoJsonfeature.properties.strokeWidth;\r\n\r\n                            if (bIsSelected) {\r\n                                oStyle.tempColor = oStyle.color;\r\n                                oStyle.tempWeight = oStyle.weight;\r\n                                oStyle.color = '#' + oSelectAttributes.color;\r\n                                oStyle.weight = oSelectAttributes.width;\r\n                            }\r\n                            break;\r\n                        case 'Polygon':\r\n                        case 'MultiPolygon':\r\n                            oStyle.color = oGeoJsonfeature.properties.strokeColor;\r\n                            oStyle.opacity = oGeoJsonfeature.properties.lineOpacity;\r\n                            oStyle.weight = oGeoJsonfeature.properties.strokeWidth;\r\n                            oStyle.fillColor = oGeoJsonfeature.properties.fillColor;\r\n                            oStyle.fillOpacity = oGeoJsonfeature.properties.fillOpacity;\r\n\r\n                            if (bIsSelected) {\r\n                                oStyle.tempColor = oStyle.color;\r\n                                oStyle.tempWeight = oStyle.weight;\r\n                                oStyle.color = '#' + oSelectAttributes.color;\r\n                                oStyle.weight = oSelectAttributes.width;\r\n                            }\r\n                            break;\r\n                        }\r\n                        oStyle.oFeature = oArgs.oFeature;\r\n                        return oStyle;\r\n                    },\r\n                    pointToLayer: function(oGeoJsonfeature, latlng) {\r\n                        var sLabelText = ((dScale <= dMaxLabelScale)? oGeoJsonfeature.properties.label: \" \");\r\n                        var iTextPixelDim = emp.helpers.getStringPixelDimensions(sLabelText,\r\n                                            oGeoJsonfeature.properties.fontFamily,\r\n                                            oGeoJsonfeature.properties.fontSize + \"pt\",\r\n                                            oGeoJsonfeature.properties.fontWeight);\r\n                        var iXOffset = 0;\r\n                        var iYOffset = 0;\r\n                        var myIcon;\r\n                        var sTextAlignment = 'center';\r\n                        //var sVerticalAlignment = 'baseline';\r\n\r\n                        if (oGeoJsonfeature.properties.hasOwnProperty('labelAlign')) {\r\n                            sTextAlignment = oGeoJsonfeature.properties.labelAlign.toLowerCase();\r\n                            switch (sTextAlignment) {\r\n                            case 'center':\r\n                                iXOffset = Math.floor(iTextPixelDim.width / 2);\r\n                                break;\r\n                            case 'left':\r\n                                iXOffset = 0;\r\n                                break;\r\n                            case 'right':\r\n                                iXOffset = iTextPixelDim.width;\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                        if (oGeoJsonfeature.properties.hasOwnProperty('labelBaseline')) {\r\n                            switch (oGeoJsonfeature.properties.labelBaseline) {\r\n                            case 'alphabetic': // baseline\r\n                                //sVerticalAlignment = 'baseline';\r\n                                iYOffset = Math.floor(iTextPixelDim.height * 0.75);\r\n                                break;\r\n                            case 'top': // Top\r\n                                //sVerticalAlignment = 'top';\r\n                                iYOffset = 0;\r\n                                break;\r\n                            case 'middle': // middle\r\n                                //sVerticalAlignment = 'middle';\r\n                                iYOffset = Math.floor(iTextPixelDim.height / 2);\r\n                                break;\r\n                            case 'bottom': // Bottom\r\n                                //sVerticalAlignment = 'bottom';\r\n                                iYOffset = iTextPixelDim.height;\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                        myIcon = new L.DivIcon({\r\n                            className: \"milstdMPtext\",\r\n                            html: \"<p \" +\r\n                            \"style='font-family:\" + oGeoJsonfeature.properties.fontFamily + \"; \" +\r\n                            \"font-size:\" + oGeoJsonfeature.properties.fontSize + \"pt; \" +\r\n                            \"line-height: 1.2; \" +\r\n                            \"white-space: nowrap; \" +\r\n                            \"font-weight:\" + oGeoJsonfeature.properties.fontWeight + \"; \" +\r\n                            \"color:\" + oGeoJsonfeature.properties.fontColor + \"; \" +\r\n//                                    \"text-align:\" + sTextAlignment + \";\" +\r\n//                                    \"vertical-align:\" + sVerticalAlignment + \";\" +\r\n                            \"-webkit-transform: rotate(\" + oGeoJsonfeature.properties.angle + \"deg); \" +\r\n                            \"-moz-transform: rotate(\" + oGeoJsonfeature.properties.angle + \"deg); \" +\r\n                            \"-o-transform: rotate(\" + oGeoJsonfeature.properties.angle + \"deg); \" +\r\n                            \"transform: rotate(\" + oGeoJsonfeature.properties.angle + \"deg);'>\" +\r\n                            sLabelText + \"</p>\",\r\n                            iconSize: new L.Point(iTextPixelDim.width, iTextPixelDim.height),\r\n                            iconAnchor: new L.Point(iXOffset, iYOffset)\r\n                        });\r\n                        return new L.Marker(latlng, {\r\n                            icon: myIcon,\r\n                            oFeature: oArgs.oFeature\r\n                        });\r\n                    },\r\n                    onEachFeature: function (feature, layer) {\r\n                        //filterCoordinates(layer);\r\n                    },\r\n                    coordsToLatLng: function(oCoord) {\r\n                        var latLng = new L.LatLng(oCoord[1], oCoord[0]);\r\n                        return latLng;\r\n                    }\r\n                });\r\n\r\n                if (oLeaftletGeoJSON instanceof L.LayerGroup) {\r\n                    if (oLeaftletGeoJSON.getLayers().length === 1) {\r\n                        // The object created is a group but it only has one\r\n                        // object in it.\r\n                        // Make that object the object returned.\r\n                        oLeaftletGeoJSON = oLeaftletGeoJSON.getLayers()[0];\r\n                    } else if (oLeaftletGeoJSON.getLayers().length === 0) {\r\n                        // This happens when the graphic bounding box intersects the map\r\n                        // but there is nonthing to draw in the graphics bounding\r\n                        // box portion that is visible.\r\n                        oLeaftletGeoJSON = undefined;\r\n                    }\r\n                }\r\n\r\n                if (oLeaftletGeoJSON instanceof L.LayerGroup) {\r\n                    var oNewChildren = [];\r\n\r\n                    // If the object is a group make sure we flaten\r\n                    // all sub groups.\r\n                    var FlantenGroup = function(oGroup) {\r\n                        var oChild;\r\n                        var oChildren = oGroup.getLayers();\r\n\r\n                        for (var iIndex = 0; iIndex < oChildren.length; iIndex++) {\r\n                            oChild = oChildren[iIndex];\r\n\r\n                            oGroup.removeLayer(oChild);\r\n                            if (oChild instanceof L.LayerGroup) {\r\n                                FlantenGroup(oChild);\r\n                            } else {\r\n                                oNewChildren.push(oChild);\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    while(oLeaftletGeoJSON.getLayers().length > 0) {\r\n                        var oChild = oLeaftletGeoJSON.getLayers()[0];\r\n\r\n                        oLeaftletGeoJSON.removeLayer(oChild);\r\n                        if (oChild instanceof L.LayerGroup) {\r\n                            FlantenGroup(oChild);\r\n                        } else {\r\n                            oNewChildren.push(oChild);\r\n                        }\r\n                    }\r\n\r\n                    for (var iIndex = 0; iIndex < oNewChildren.length; iIndex++) {\r\n                        oLeaftletGeoJSON.addLayer(oNewChildren[iIndex]);\r\n                    }\r\n                }\r\n            } catch (Ex) {\r\n                console.log(\"GeoJSON Error:\\n\" +\r\n                            \"Symbol Code: \" + oArgs.sSymbolCode + \"\\n\" +\r\n                            \"id: \" + oArgs.sID + \"\\n\" +\r\n                            \"name: \" + oArgs.sName + \"\\n\" +\r\n                            \"description: \" + oArgs.sDescription + \"\\n\" +\r\n                            \"coordinates: \" + sCoordinateStr + \"\\n\" +\r\n                            \"width: \" + oDimension.x + \"\\n\" +\r\n                            \"height: \" + oDimension.y + \"\\n\" +\r\n                            \"bbox: \" + sBBox + \"\\n\" +\r\n                            \"modifiers: \" + JSON.stringify(oArgs.oModifiers) + \"\\n\" +\r\n                            \"outFormat: \" + iOutputFormat + \"\\n\" +\r\n                            \"2525 version: \" + oArgs.i2525Version + \"\\n\" +\r\n                            \"geoJSON returned:\\n\" + sGeoJsonData + \"\\n\"\r\n                           );\r\n                throw Ex;\r\n            }\r\n\r\n            return oLeaftletGeoJSON;\r\n        },\r\n        createTGFromDraw: function(oEnginePrivateInterface, oLeafletMap, oSymbolDef, sBasicSymbolCode, oDrawItem) {\r\n            var oCoordList = [];\r\n            var oFeature = undefined;\r\n            var oSymbolDefTable = armyc2.c2sd.renderer.utilities.SymbolDefTable;\r\n            var oBasicCodes = leafLet.utils.milstd.basicSymbolCode;\r\n            var oMapBounds = oLeafletMap.getBounds();\r\n            var oMapSouthWest = oMapBounds.getSouthWest().wrap();\r\n            var oMapNorthEast = oMapBounds.getNorthEast().wrap();\r\n            var oMapCenter = oMapBounds.getCenter();\r\n            var oMapCenterWest = new L.LatLng(oMapCenter.lat, oMapSouthWest.lng, 0);\r\n            var oMapCenterEast = new L.LatLng(oMapCenter.lat, oMapNorthEast.lng, 0);\r\n            var oMapCenterNorth = new L.LatLng(oMapNorthEast.lat, oMapCenter.lng, 0);\r\n            var oMapCenterSouth = new L.LatLng(oMapSouthWest.lat, oMapCenter.lng, 0);\r\n            var dViewWidth = oMapCenterWest.distanceTo(oMapCenterEast);\r\n            var dViewHeight = oMapCenterSouth.distanceTo(oMapCenterNorth);\r\n            var dQtrWidth = Math.floor(dViewWidth / 4);\r\n            var d3rdHeight = Math.floor(dViewHeight / 3);\r\n            var iStdVersion = emp.typeLibrary.featureMilStdVersionType.convertToNumeric();\r\n            var dBrng;\r\n            var dBrngInc;\r\n            var oGeoJsonData = {\r\n                symbolCode: oDrawItem.symbolCode,\r\n                type: 'LineString',\r\n                coordinates: []\r\n            };\r\n            var oProperties = emp.helpers.copyObject(oDrawItem.properties);\r\n            var oModifiers = leafLet.utils.milstd.convertModifiersTo2525(oDrawItem);\r\n            var o2525Modifiers = leafLet.utils.milstd.Modifiers;\r\n            var iStdVersion = oModifiers[o2525Modifiers.STANDARD] || 0;\r\n\r\n            oProperties.modifiers = oModifiers;\r\n\r\n            switch (oSymbolDef.drawCategory) {\r\n            case oSymbolDefTable.DRAW_CATEGORY_LINE: // A polyline, a line with n number of points.\r\n            case oSymbolDefTable.DRAW_CATEGORY_ARROW: // A polyline, a line with n number of points.\r\n                oCoordList.push(oMapCenter.destinationPoint(270.0, dQtrWidth));\r\n                oCoordList.push(oMapCenter.destinationPoint(90.0, dQtrWidth));\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_AUTOSHAPE: // N points.\r\n                switch (sBasicSymbolCode) {\r\n                case oBasicCodes.TASK_ISOLATE:\r\n                case oBasicCodes.TASK_OCCUPY:\r\n                case oBasicCodes.TASK_RETIAN:\r\n                case oBasicCodes.TASK_SECURE:\r\n                case oBasicCodes.TASK_CORDON_SEARCH:\r\n                case oBasicCodes.TASK_CORDON_KNOCK:\r\n                    oCoordList.push(oMapCenter);\r\n                    oCoordList.push(oMapCenter.destinationPoint(45.0, d3rdHeight));\r\n                    break;\r\n                case oBasicCodes.MINIMUM_SAFE_DISTANCE_ZONES:\r\n                    oCoordList.push(oMapCenter);\r\n                    oCoordList.push(oMapCenter.destinationPoint(45.0, dQtrWidth / 2.0));\r\n                    oCoordList.push(oMapCenter.destinationPoint(45.0, dQtrWidth));\r\n                    oCoordList.push(oMapCenter.destinationPoint(45.0, dQtrWidth * 1.5));\r\n                    break;\r\n                default:\r\n                    dBrng = 240.0;\r\n                    dBrngInc = 360.0 / oSymbolDef.minPoints;\r\n                    oCoordList.push(oMapCenter.destinationPoint(dBrng, dQtrWidth));\r\n                    while (oCoordList.length < oSymbolDef.minPoints) {\r\n                        dBrng += dBrngInc;\r\n                        oCoordList.push(oMapCenter.destinationPoint(dBrng, dQtrWidth));\r\n                    }\r\n                    break;\r\n                }\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_POLYGON: // Polygon with N points.\r\n                dBrng = 240.0;\r\n                dBrngInc = 360.0 / oSymbolDef.minPoints;\r\n                oCoordList.push(oMapCenter.destinationPoint(dBrng, dQtrWidth));\r\n                while (oCoordList.length < oSymbolDef.minPoints) {\r\n                    dBrng += dBrngInc;\r\n                    oCoordList.push(oMapCenter.destinationPoint(dBrng, dQtrWidth));\r\n                }\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_ROUTE: // A graphic with n points whose last point defines the width of the graphic.\r\n                oCoordList.push(oMapCenter.destinationPoint(270.0, dQtrWidth));\r\n                oCoordList.push(oMapCenter.destinationPoint(90.0, dQtrWidth));\r\n                oCoordList.push(oMapCenter.destinationPoint(260.0, dQtrWidth * 0.9));\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTLINE: // A line defined only by 2 points, and cannot have more.\r\n            case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTARROW: // A polyline with 2 points (entered in reverse order).\r\n            case oSymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE: // 2 points.\r\n                oCoordList.push(oMapCenter.destinationPoint(270.0, dQtrWidth));\r\n                oCoordList.push(oMapCenter.destinationPoint(90.0, dQtrWidth));\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_POINT: // Shape is defined by a single point\r\n            case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE: // 1 point\r\n            case oSymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE: // 1 point.\r\n            case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE: // 1 point.\r\n                oCoordList.push(oMapCenter);\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE: // 1 point.\r\n                oCoordList.push(oMapCenter.destinationPoint(180.0, d3rdHeight));\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_SUPERAUTOSHAPE: // N Points.\r\n                switch (sBasicSymbolCode) {\r\n                case oBasicCodes.CCGM_OFFENCE_SUPPORT_BY_FIRE_POSITION:\r\n                    dBrng = 315.0;\r\n                    oCoordList.push(oMapCenter.destinationPoint(315.0,  dQtrWidth));\r\n                    oCoordList.push(oMapCenter.destinationPoint(225.0, dQtrWidth));\r\n                    oCoordList.push(oMapCenter.destinationPoint(45.0, dQtrWidth));\r\n                    oCoordList.push(oMapCenter.destinationPoint(135.0, dQtrWidth));\r\n                    break;\r\n                default:\r\n                    dBrng = 240.0;\r\n                    dBrngInc = 360.0 / oSymbolDef.minPoints;\r\n                    oCoordList.push(oMapCenter.destinationPoint(dBrng, dQtrWidth));\r\n                    while (oCoordList.length < oSymbolDef.minPoints) {\r\n                        dBrng += dBrngInc;\r\n                        oCoordList.push(oMapCenter.destinationPoint(dBrng, dQtrWidth));\r\n                    }\r\n                    break;\r\n                }\r\n                break;\r\n            }\r\n\r\n            if (oCoordList.length === 1) {\r\n                oGeoJsonData.type = 'Point';\r\n            }\r\n\r\n            leafLet.utils.geoJson.convertLatLngListToGeoJson(oGeoJsonData, oCoordList);\r\n\r\n            switch (oSymbolDef.drawCategory) {\r\n            case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:\r\n                // Requires 1 AM.\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [dQtrWidth];\r\n                } else if (!(oModifiers[o2525Modifiers.DISTANCE] instanceof Array)\r\n                           && oModifiers[o2525Modifiers.DISTANCE]) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [oModifiers[o2525Modifiers.DISTANCE]];\r\n                } else if (oModifiers[o2525Modifiers.DISTANCE].length === 0) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [dQtrWidth];\r\n                }\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:\r\n                // Requires 2 AM, 1 AN\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [];\r\n                } else if (!(oModifiers[o2525Modifiers.DISTANCE] instanceof Array)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [];\r\n                }\r\n\r\n                if (oModifiers[o2525Modifiers.DISTANCE].length === 0) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [dQtrWidth, Math.floor(dQtrWidth / 2)];\r\n                } else if (oModifiers[o2525Modifiers.DISTANCE].length < 2) {\r\n                    oModifiers[o2525Modifiers.DISTANCE].push(Math.floor(dQtrWidth / 2));\r\n                }\r\n\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.AZIMUTH)) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH] = [];\r\n                } else if (!(oModifiers[o2525Modifiers.AZIMUTH] instanceof Array)) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH] = [];\r\n                }\r\n\r\n                if (oModifiers[o2525Modifiers.AZIMUTH].length === 0) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH] = [0];\r\n                }\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:\r\n                // Requires 1 or more AMs, and 2 ANs per AM.\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                } else if (!(oModifiers[o2525Modifiers.DISTANCE] instanceof Array)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                }\r\n\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.AZIMUTH)) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH] = [];\r\n                } else if (!(oModifiers[o2525Modifiers.AZIMUTH] instanceof Array)) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH] = [];\r\n                }\r\n\r\n                if (oModifiers[o2525Modifiers.AZIMUTH].length === 0) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH].push(315.0);\r\n                }\r\n\r\n                if (oModifiers[o2525Modifiers.AZIMUTH].length < 2) {\r\n                    oModifiers[o2525Modifiers.AZIMUTH].push(45.0);\r\n                }\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:\r\n                // Requires 1 AMs.\r\n                /*\r\n                                    if (!oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE))\r\n                                    {\r\n                                        oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                                    }\r\n                                    else if (!(oModifiers[o2525Modifiers.DISTANCE] instanceof Array))\r\n                                    {\r\n                                        oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                                    }\r\n                                    else if (oModifiers[o2525Modifiers.DISTANCE].length < 1)\r\n                                    {\r\n                                        oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                                    }\r\n                */\r\n                break;\r\n            case oSymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:\r\n                // Requires 1 AM.\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                } else if (!(oModifiers[o2525Modifiers.DISTANCE] instanceof Array)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                } else if (oModifiers[o2525Modifiers.DISTANCE].length < 1) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [d3rdHeight];\r\n                }\r\n                break;\r\n            }\r\n\r\n            switch (sBasicSymbolCode) {\r\n            case oBasicCodes.AIR_CORRIDOR:\r\n            case oBasicCodes.MINIMUM_RISK_ROUTE:\r\n            case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:\r\n            case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:\r\n            case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:\r\n                // Requires 1 AM.\r\n                if (!oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [Math.floor(dQtrWidth / 2)];\r\n                } else if (!(oModifiers[o2525Modifiers.DISTANCE] instanceof Array)) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [Math.floor(dQtrWidth / 2)];\r\n                } else if (oModifiers[o2525Modifiers.DISTANCE].length < 1) {\r\n                    oModifiers[o2525Modifiers.DISTANCE] = [Math.floor(dQtrWidth / 2)];\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n            }\r\n\r\n            oFeature = new leafLet.typeLibrary.MilStdFeature({\r\n                item: {\r\n                    name: oDrawItem.name,\r\n                    coreId: oDrawItem.coreId,\r\n                    parentCoreId: oDrawItem.parentCoreId,\r\n                    visible: true,\r\n                    featureId: oDrawItem.featureId,\r\n                    overlayId: oDrawItem.overlayId,\r\n                    parentId: oDrawItem.parentId,\r\n                    format: emp.typeLibrary.featureFormatType.MILSTD,\r\n                    data: oGeoJsonData,\r\n                    properties: oProperties\r\n                },\r\n                instanceInterface: oEnginePrivateInterface\r\n            });\r\n\r\n            return oFeature;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n}());\r\n\r\nleafLet.utils.milstd.longModifiers = {\r\n    QUANTITY: \"quantity\",\r\n    REDUCED_OR_REINFORCED: \"reinforcedOrReduced\",\r\n    STAFF_COMMENTS: \"staffComments\",\r\n    ADDITIONAL_INFO_1: \"additionalInfo1\",\r\n    ADDITIONAL_INFO_2: \"additionalInfo2\",\r\n    ADDITIONAL_INFO_3: \"additionalInfo3\",\r\n    EVALUATION_RATING: \"evaluationRating\",\r\n    COMBAT_EFFECTIVENESS: \"combatEffectiveness\",\r\n    SIGNATURE_EQUIPMENT: \"signatureEquipment\",\r\n    HIGHER_FORMATION: \"higherFormation\",\r\n    HOSTILE: \"hostile\",\r\n    IFF_SIF: \"iffSif\",\r\n    DIRECTION_OF_MOVEMENT: \"directionOfMovement\",\r\n    OFFSET_INDICATOR: \"offsetIndicator\",\r\n    UNIQUE_DESIGNATOR_1: \"uniqueDesignation1\",\r\n    UNIQUE_DESIGNATOR_2: \"uniqueDesignation2\",\r\n    EQUIPMENT_TYPE: \"equipmentType\",\r\n    DATE_TIME_GROUP: \"dateTimeGroup1\",\r\n    DATE_TIME_GROUP_2: \"dateTimeGroup2\",\r\n    ALTITUDE_DEPTH: \"altitudeDepth\",\r\n    LOCATION: \"location\",\r\n    SPEED: \"speed\",\r\n    SPECIAL_C2_HEADQUARTERS: \"specialC2Headquarters\",\r\n    DISTANCE: \"distance\",\r\n    AZIMUTH: \"azimuth\",\r\n    FILL_COLOR: \"fillColor\",\r\n    LINE_COLOR: \"lineColor\",\r\n    X_OFFSET: \"xOffset\",\r\n    X_UNITS: \"xUnits\",\r\n    Y_OFFSET: \"yOffset\",\r\n    Y_UNITS: \"yUnits\",\r\n    SIZE: \"size\",\r\n    LINE_THICKNESS: \"lineThickness\",\r\n    HEADING: \"heading\",\r\n    STANDARD: \"standard\"\r\n};\r\n\r\nleafLet.utils.milstd.Modifiers = {\r\n    QUANTITY: \"C\",\r\n    REDUCED_OR_REINFORCED: \"F\",\r\n    STAFF_COMMENTS: \"G\",\r\n    ADDITIONAL_INFO_1: \"H\",\r\n    ADDITIONAL_INFO_2: \"H1\",\r\n    ADDITIONAL_INFO_3: \"H2\",\r\n    EVALUATION_RATING: \"J\",\r\n    COMBAT_EFFECTIVENESS: \"K\",\r\n    SIGNATURE_EQUIPMENT: \"L\",\r\n    HIGHER_FORMATION: \"M\",\r\n    HOSTILE: \"N\",\r\n    IFF_SIF: \"P\",\r\n    DIRECTION_OF_MOVEMENT: \"Q\",\r\n    OFFSET_INDICATOR: \"S\",\r\n    UNIQUE_DESIGNATOR_1: \"T\",\r\n    UNIQUE_DESIGNATOR_2: \"T1\",\r\n    EQUIPMENT_TYPE: \"V\",\r\n    DATE_TIME_GROUP: \"W\",\r\n    DATE_TIME_GROUP_2: \"W1\",\r\n    ALTITUDE_DEPTH: \"X\",\r\n    LOCATION: \"Y\",\r\n    SPEED: \"Z\",\r\n    SPECIAL_C2_HEADQUARTERS: \"AA\",\r\n    DISTANCE: \"AM\",\r\n    AZIMUTH: \"AN\",\r\n    STANDARD: \"SYMSTD\"\r\n};\r\n\r\nleafLet.utils.milstd.stringToModifiers = (function() {\r\n    var mapping = {};\r\n    var longModifiers = leafLet.utils.milstd.longModifiers;\r\n    var s2525Modifiers = leafLet.utils.milstd.Modifiers;\r\n\r\n    mapping[longModifiers.QUANTITY] = s2525Modifiers.QUANTITY;\r\n    mapping[longModifiers.REDUCED_OR_REINFORCED] = s2525Modifiers.REDUCED_OR_REINFORCED;\r\n    mapping[longModifiers.STAFF_COMMENTS] = s2525Modifiers.STAFF_COMMENTS;\r\n    mapping[longModifiers.ADDITIONAL_INFO_1] = s2525Modifiers.ADDITIONAL_INFO_1;\r\n    mapping[longModifiers.ADDITIONAL_INFO_2] = s2525Modifiers.ADDITIONAL_INFO_2;\r\n    mapping[longModifiers.ADDITIONAL_INFO_3] = s2525Modifiers.ADDITIONAL_INFO_3;\r\n    mapping[longModifiers.EVALUATION_RATING] = s2525Modifiers.EVALUATION_RATING;\r\n    mapping[longModifiers.COMBAT_EFFECTIVENESS] = s2525Modifiers.COMBAT_EFFECTIVENESS;\r\n    mapping[longModifiers.SIGNATURE_EQUIPMENT] = s2525Modifiers.SIGNATURE_EQUIPMENT;\r\n    mapping[longModifiers.HIGHER_FORMATION] = s2525Modifiers.HIGHER_FORMATION;\r\n    mapping[longModifiers.HOSTILE] = s2525Modifiers.HOSTILE;\r\n    mapping[longModifiers.IFF_SIF] = s2525Modifiers.IFF_SIF;\r\n    mapping[longModifiers.DIRECTION_OF_MOVEMENT] = s2525Modifiers.DIRECTION_OF_MOVEMENT;\r\n    mapping[longModifiers.OFFSET_INDICATOR] = s2525Modifiers.OFFSET_INDICATOR;\r\n    mapping[longModifiers.UNIQUE_DESIGNATOR_1] = s2525Modifiers.UNIQUE_DESIGNATOR_1;\r\n    mapping[longModifiers.UNIQUE_DESIGNATOR_2] = s2525Modifiers.UNIQUE_DESIGNATOR_2;\r\n    mapping[longModifiers.EQUIPMENT_TYPE] = s2525Modifiers.EQUIPMENT_TYPE;\r\n    mapping[longModifiers.DATE_TIME_GROUP] = s2525Modifiers.DATE_TIME_GROUP;\r\n    mapping[longModifiers.DATE_TIME_GROUP_2] = s2525Modifiers.DATE_TIME_GROUP_2;\r\n    mapping[longModifiers.ALTITUDE_DEPTH] = s2525Modifiers.ALTITUDE_DEPTH;\r\n    mapping[longModifiers.LOCATION] = s2525Modifiers.LOCATION;\r\n    mapping[longModifiers.SPEED] = s2525Modifiers.SPEED;\r\n    mapping[longModifiers.SPECIAL_C2_HEADQUARTERS] = s2525Modifiers.SPECIAL_C2_HEADQUARTERS;\r\n    mapping[longModifiers.DISTANCE] = s2525Modifiers.DISTANCE;\r\n    mapping[longModifiers.AZIMUTH] = s2525Modifiers.AZIMUTH;\r\n    mapping[longModifiers.FILL_COLOR] = longModifiers.FILL_COLOR;\r\n    mapping[longModifiers.LINE_COLOR] = longModifiers.LINE_COLOR;\r\n    mapping[longModifiers.X_OFFSET] = longModifiers.X_OFFSET;\r\n    mapping[longModifiers.X_UNITS] = longModifiers.X_UNITS;\r\n    mapping[longModifiers.Y_OFFSET] = longModifiers.Y_OFFSET;\r\n    mapping[longModifiers.Y_UNITS] = longModifiers.Y_UNITS;\r\n    mapping[longModifiers.SIZE] = longModifiers.SIZE;\r\n    mapping[longModifiers.LINE_THICKNESS] = longModifiers.LINE_THICKNESS;\r\n    mapping[longModifiers.HEADING] = s2525Modifiers.DIRECTION_OF_MOVEMENT;\r\n    mapping[longModifiers.STANDARD] = s2525Modifiers.STANDARD;\r\n\r\n    return mapping;\r\n}());\r\n\r\nleafLet.utils.milstd.o2525ModifierToLong = (function() {\r\n    var mapping = {};\r\n    var longModifiers = leafLet.utils.milstd.longModifiers;\r\n    var s2525Modifiers = leafLet.utils.milstd.Modifiers;\r\n\r\n    mapping[s2525Modifiers.QUANTITY] = longModifiers.QUANTITY;\r\n    mapping[s2525Modifiers.REDUCED_OR_REINFORCED] = longModifiers.REDUCED_OR_REINFORCED;\r\n    mapping[s2525Modifiers.STAFF_COMMENTS] = longModifiers.STAFF_COMMENTS;\r\n    mapping[s2525Modifiers.ADDITIONAL_INFO_1] = longModifiers.ADDITIONAL_INFO_1;\r\n    mapping[s2525Modifiers.ADDITIONAL_INFO_2] = longModifiers.ADDITIONAL_INFO_2;\r\n    mapping[s2525Modifiers.ADDITIONAL_INFO_3] = longModifiers.ADDITIONAL_INFO_3;\r\n    mapping[s2525Modifiers.EVALUATION_RATING] = longModifiers.EVALUATION_RATING;\r\n    mapping[s2525Modifiers.COMBAT_EFFECTIVENESS] = longModifiers.COMBAT_EFFECTIVENESS;\r\n    mapping[s2525Modifiers.SIGNATURE_EQUIPMENT] = longModifiers.SIGNATURE_EQUIPMENT;\r\n    mapping[s2525Modifiers.HIGHER_FORMATION] = longModifiers.HIGHER_FORMATION;\r\n    mapping[s2525Modifiers.HOSTILE] = longModifiers.HOSTILE;\r\n    mapping[s2525Modifiers.IFF_SIF] = longModifiers.IFF_SIF;\r\n    mapping[s2525Modifiers.DIRECTION_OF_MOVEMENT] = longModifiers.DIRECTION_OF_MOVEMENT;\r\n    mapping[s2525Modifiers.OFFSET_INDICATOR] = longModifiers.OFFSET_INDICATOR;\r\n    mapping[s2525Modifiers.UNIQUE_DESIGNATOR_1] = longModifiers.UNIQUE_DESIGNATOR_1;\r\n    mapping[s2525Modifiers.UNIQUE_DESIGNATOR_2] = longModifiers.UNIQUE_DESIGNATOR_2;\r\n    mapping[s2525Modifiers.EQUIPMENT_TYPE] = longModifiers.EQUIPMENT_TYPE;\r\n    mapping[s2525Modifiers.DATE_TIME_GROUP] = longModifiers.DATE_TIME_GROUP;\r\n    mapping[s2525Modifiers.DATE_TIME_GROUP_2] = longModifiers.DATE_TIME_GROUP_2;\r\n    mapping[s2525Modifiers.ALTITUDE_DEPTH] = longModifiers.ALTITUDE_DEPTH;\r\n    mapping[s2525Modifiers.LOCATION] = longModifiers.LOCATION;\r\n    mapping[s2525Modifiers.SPEED] = longModifiers.SPEED;\r\n    mapping[s2525Modifiers.SPECIAL_C2_HEADQUARTERS] = longModifiers.SPECIAL_C2_HEADQUARTERS;\r\n    mapping[s2525Modifiers.DISTANCE] = longModifiers.DISTANCE;\r\n    mapping[s2525Modifiers.AZIMUTH] = longModifiers.AZIMUTH;\r\n    mapping[longModifiers.FILL_COLOR] = longModifiers.FILL_COLOR;\r\n    mapping[longModifiers.LINE_COLOR] = longModifiers.LINE_COLOR;\r\n    mapping[longModifiers.X_OFFSET] = longModifiers.X_OFFSET;\r\n    mapping[longModifiers.X_UNITS] = longModifiers.X_UNITS;\r\n    mapping[longModifiers.Y_OFFSET] = longModifiers.Y_OFFSET;\r\n    mapping[longModifiers.Y_UNITS] = longModifiers.Y_UNITS;\r\n    mapping[longModifiers.SIZE] = longModifiers.SIZE;\r\n    mapping[longModifiers.LINE_THICKNESS] = longModifiers.LINE_THICKNESS;\r\n    mapping[s2525Modifiers.HEADING] = longModifiers.DIRECTION_OF_MOVEMENT;\r\n    mapping[s2525Modifiers.STANDARD] = longModifiers.STANDARD;\r\n\r\n    return mapping;\r\n}());\r\n\r\nleafLet.utils.milstd.basicSymbolCode = {\r\n    AIR_CORRIDOR: \"G*G*ALC---****X\",\r\n    STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE: \"G*G*ALS---****X\",\r\n    MINIMUM_RISK_ROUTE: \"G*G*ALM---****X\",\r\n    UBMANNED_AERIAL_VEHICLE_ROUTE: \"G*G*ALU---****X\",\r\n    LOW_LEVEL_TRANSIT_ROUTE: \"G*G*ALL---****X\",\r\n    AIRSPACE_COORDINATION_AREA_IRREGULAR: \"G*F*ACAI--****X\",\r\n    AIRSPACE_COORDINATION_AREA_RECTANGULAR: \"G*F*ACAR--****X\",\r\n    AIRSPACE_COORDINATION_AREA_CIRCULAR: \"G*F*ACAC--****X\",\r\n    RESTRICTED_OPERATIONS_ZONE: \"G*G*AAR---****X\",\r\n    HIGH_DENSITY_AIRSPACE_CONTROL_ZONE: \"G*G*AAH---****X\",\r\n    MISSILE_ENGAGEMENT_ZONE: \"G*G*AAM---****X\",\r\n    MISSILE_ENGAGEMENT_ZONE_LOW_ALTITUDE: \"G*G*AAML--****X\",\r\n    MISSILE_ENGAGEMENT_ZONE_HIGH_ALTITUDE: \"G*G*AAMH--****X\",\r\n\r\n    CIRCULAR_RANGE_FAN: \"G*F*AXC---****X\",\r\n    SECTOR_RANGE_FAN: \"G*F*AXS---****X\",\r\n\r\n    RECTANGULAR_TARGET: \"G*F*ATR---****X\",\r\n    CIRCULAR_TARGET: \"G*FPATC---****X\",\r\n\r\n    FORD_EASY: \"G*M*BCE---****X\",\r\n    FORD_DIFFICULT: \"G*M*BCD---****X\",\r\n\r\n    ROADBLOCK_COMPLETE_EXECUTED: \"G*M*ORC---****X\",\r\n    MINIMUM_SAFE_DISTANCE_ZONES: \"G*M*NM----****X\",\r\n\r\n    SEIZE: \"G*T*Z-----****X\",\r\n\r\n    AMBUSH: \"G*G*SLA---****X\",\r\n    BLOCK_TASK: \"G*T*B-----****X\",\r\n    TASK_ISOLATE: \"G*T*E-----****X\",\r\n    TASK_OCCUPY: \"G*T*O-----****X\",\r\n    TASK_RETIAN: \"G*T*Q-----****X\",\r\n    TASK_SECURE: \"G*T*S-----****X\",\r\n    TASK_CORDON_SEARCH: \"G*T*V-----****X\",\r\n    TASK_CORDON_KNOCK: \"G*T*2-----****X\",\r\n\r\n    CCGM_OFFENCE_SUPPORT_BY_FIRE_POSITION: \"G*G*OAS---****X\",\r\n\r\n    BRIDGE_OR_GAP: \"G*M*BCB---****X\",\r\n    ASSAULT_CROSSING_AREA: \"G*M*BCA---****X\",\r\n\r\n    // Only in 2525B\r\n    FORWARD_AREA_AIR_DEFENSE_ZONE: \"G*G*AAF---****X\",\r\n    // Same Symbol Code with diff name in 2525C\r\n    SHORT_RANGE_AIR_DEFENSE_ENGAGEMENT_ZONE: \"G*G*AAF---****X\",\r\n\r\n    // Only in 2525B\r\n    KILL_BOX_PURPLE_CIRCULAR: \"G*F*AKPC--****X\",\r\n    KILL_BOX_PURPLE_RECTANGULAR: \"G*F*AKPR--****X\",\r\n    KILL_BOX_PURPLE_IRREGULAR: \"G*F*AKPI--****X\"\r\n};\r\n\r\n\r\nemp.typeLibrary.featureMilStdVersionType.convertToString = function(iValue) {\r\n    var sRet = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n    switch (iValue) {\r\n    case 0:\r\n        sRet = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n        break;\r\n    case 1:\r\n        sRet = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C;\r\n        break;\r\n    }\r\n\r\n    return sRet;\r\n};\r\n","/* global leafLet, L, emp, armyc2, sec */\r\n\r\nleafLet.utils = leafLet.utils || {};\r\n\r\nleafLet.utils.kml = (function(){\r\n    var privateInterface = {\r\n    };\r\n\r\n    var publicInterface = {\r\n        convertCoordinatesToLatLng: function(sKML)\r\n        {\r\n            var oLatLngList = [];\r\n            var oKmlDoc = emp.$(emp.$.parseXML(sKML));\r\n            var sCoordStr;\r\n            var bIsPolygon = false;\r\n\r\n            emp.$.each(oKmlDoc.find(\"coordinates\"), function(i, oDescElem)\r\n            {\r\n                if (sCoordStr === undefined)\r\n                {\r\n                    sCoordStr = oDescElem.textContent;\r\n                }\r\n            });\r\n\r\n            emp.$.each(oKmlDoc.find(\"Polygon\"), function(i, oDescElem)\r\n            {\r\n                bIsPolygon = true;\r\n            });\r\n            \r\n            if (sCoordStr)\r\n            {\r\n                var aStrCoordList = sCoordStr.split(/\\s+/g);\r\n                var aCoord;\r\n                var dLng;\r\n                var dLat;\r\n                var dAlt;\r\n                \r\n                for (var iIndex = 0; iIndex < aStrCoordList.length; iIndex++)\r\n                {\r\n                    if (aStrCoordList[iIndex].length > 0)\r\n                    {\r\n                        aCoord = aStrCoordList[iIndex].split(',');\r\n                        if (aCoord.length > 1)\r\n                        {\r\n                            dLng = Number(aCoord[0]);\r\n                            dLat = Number(aCoord[1]);\r\n                            dAlt = undefined;\r\n                            if (aCoord.length > 2)\r\n                            {\r\n                                dAlt = Number(aCoord[2]);\r\n                            }\r\n                            oLatLngList.push(new L.LatLng(dLat, dLng, dAlt));\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                if (bIsPolygon && (oLatLngList.length > 1))\r\n                {\r\n                    // we need to remove the last one if there is more than one..\r\n                    oLatLngList.splice(oLatLngList.length - 1, 1);\r\n                }\r\n            }\r\n            \r\n            return oLatLngList;\r\n        },\r\n        convertLatLngListToKML: function(sKML, oLatLngList)\r\n        {\r\n            var bIsPolygon = false;\r\n            var oKmlDoc = emp.$.parseXML(sKML);\r\n            var $oKmlDoc = emp.$(oKmlDoc);\r\n            var sCoordStr = \"\";\r\n            \r\n            emp.$.each($oKmlDoc.find(\"Polygon\"), function(i, oDescElem)\r\n            {\r\n                bIsPolygon = true;\r\n            });\r\n\r\n            for (var iIndex = 0; iIndex < oLatLngList.length; iIndex++)\r\n            {\r\n                if (sCoordStr.length > 0)\r\n                {\r\n                    sCoordStr += \" \";\r\n                }\r\n                sCoordStr += oLatLngList[iIndex].lng + \",\";\r\n                sCoordStr += oLatLngList[iIndex].lat;\r\n                if (!isNaN(oLatLngList[iIndex].alt))\r\n                {\r\n                    sCoordStr += \",\" + oLatLngList[iIndex].alt;\r\n                }\r\n            }\r\n            \r\n            if (bIsPolygon)\r\n            {\r\n                // For polygon we need to repeat the first one last.\r\n                if (sCoordStr.length > 0)\r\n                {\r\n                    sCoordStr += \" \";\r\n                }\r\n                sCoordStr += oLatLngList[0].lng + \",\";\r\n                sCoordStr += oLatLngList[0].lat;\r\n                if (!isNaN(oLatLngList[0].alt))\r\n                {\r\n                    sCoordStr += \",\" + oLatLngList[0].alt;\r\n                }\r\n            }\r\n\r\n            var bDone = false;\r\n            emp.$.each($oKmlDoc.find(\"coordinates\"), function(i, oDescElem)\r\n            {\r\n                if (!bDone)\r\n                {\r\n                    oDescElem.textContent = sCoordStr;\r\n                    bDone = true;\r\n                }\r\n            });\r\n            function getXmlAsString(xmlDom){\r\n                return (typeof window.XMLSerializer !== \"undefined\") ? (new window.XMLSerializer()).serializeToString(xmlDom):\r\n                        xmlDom.xml;\r\n            }\r\n\r\n            return getXmlAsString(oKmlDoc); \r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n}());\r\n","\r\n/* global leafLet, L, emp, armyc2, sec */\r\n\r\nleafLet.utils = leafLet.utils || {};\r\n\r\nleafLet.utils.airspace = (function(){\r\n    var privateInterface = {\r\n    };\r\n\r\n    var publicInterface = {\r\n        createAirspace: function(args)\r\n        {\r\n            var oAirspace;\r\n            var cAirspaceType = emp.typeLibrary.airspaceSymbolCode;\r\n            \r\n            switch (args.item.data.symbolCode)\r\n            {\r\n                case cAirspaceType.SHAPE3D_CYLINDER:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.Cylinder(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_POLYGON:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.Polygon(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_CURTAIN:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.Curtain(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_ORBIT:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.Orbit(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_ROUTE:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.Route(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_TRACK:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.Track(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_RADARC:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.RadArc(args);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_POLYARC:\r\n                    oAirspace = new leafLet.typeLibrary.airspace.PolyArc(args);\r\n                    break;\r\n                default:\r\n                    throw new Error(\"Airspace of this type are not yet supported.\");\r\n            }\r\n            \r\n            return oAirspace;\r\n        },\r\n        createEditor: function(oInstanceInterface, oTransaction, oEmpItem, oAirspace)\r\n        {\r\n            var oEditor;\r\n            var cAirspaceType = emp.typeLibrary.airspaceSymbolCode;\r\n            var sSymbolCode = (oAirspace? oAirspace.getData().symbolCode: oEmpItem.symbolCode);\r\n            var oParameters = {\r\n                transaction: oTransaction,\r\n                EmpDrawEditItem: oEmpItem,\r\n                feature: oAirspace,\r\n                instanceInterface: oInstanceInterface\r\n            };\r\n\r\n            switch (sSymbolCode)\r\n            {\r\n                case cAirspaceType.SHAPE3D_CURTAIN:\r\n                    oEditor = new leafLet.editor.AirspaceCurtain(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_POLYGON:\r\n                    oEditor = new leafLet.editor.AirspacePolygon(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_CYLINDER:\r\n                    oEditor = new leafLet.editor.AirspaceCylinder(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_ORBIT:\r\n                    oEditor = new leafLet.editor.AirspaceOrbit(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_ROUTE:\r\n                    oEditor = new leafLet.editor.AirspaceRoute(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_TRACK:\r\n                    oEditor = new leafLet.editor.AirspaceTrack(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_RADARC:\r\n                    oEditor = new leafLet.editor.AirspaceRadArc(oParameters);\r\n                    break;\r\n                case cAirspaceType.SHAPE3D_POLYARC:\r\n                    oEditor = new leafLet.editor.AirspacePolyArc(oParameters);\r\n                    break;\r\n                default:\r\n                    throw new Error(\"Airspace Editor for this type is not yet implemented.\");\r\n            }\r\n            \r\n            return oEditor;\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n}());\r\n","/* global L, leafLet, emp, armyc2 */\r\n\r\nleafLet.internalPrivateClass.OvalObject = function(){\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var options = {\r\n                oMap: args.leafletMap,\r\n                width: args.width,\r\n                oAttributes: args.attributes,\r\n                oOvalCoordList: args.coordinates,\r\n                isSelected: args.isSelected,\r\n                selectAttributes: args.selectAttributes,\r\n                oCoordList: [],\r\n                oPolygonOptions: {},\r\n                oFeature: args.oFeature\r\n            };\r\n            \r\n            if (!(args.coordinates instanceof Array))\r\n            {\r\n                throw new Error(\"Invalid coordinates type. It must be a 2 element array of L.LatLng objects.\");\r\n            }\r\n            else if (args.coordinates.length !== 2)\r\n            {\r\n                throw new Error(\"Invalid number of elements. It must be a 2 element array of L.LatLng objects.\");\r\n            }\r\n            \r\n            L.Util.setOptions(this, options);\r\n                \r\n            this._generatePolygon();\r\n\r\n            L.Polygon.prototype.initialize.call(this, this.options.oCoordList, this.options.oPolygonOptions);\r\n        },\r\n        isSelected: function()\r\n        {\r\n            return this.options.isSelected;\r\n        },\r\n        _generatePolygon: function()\r\n        {\r\n            var oPartialCoordList;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oAttributes = this.options.oAttributes;\r\n            var dWidth = this.options.width;\r\n            var oMap = this.options.oMap;\r\n            var oPt1 = this.options.oOvalCoordList[0];\r\n            var oPt2 = this.options.oOvalCoordList[1];\r\n            var dBearingPt1Pt2 = oPt1.bearingTo(oPt2);\r\n            var dRadius = dWidth / 2.0;\r\n            var dLeftBearing = (dBearingPt1Pt2 + 270.0) % 360;\r\n            var dRightBearing = (dBearingPt1Pt2 + 90.0) % 360;\r\n            var oCoordList = this.options.oCoordList;\r\n            var oLineColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR));\r\n            var oFillColor = leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR));\r\n            var oPolygonOptions = this.options.oPolygonOptions;\r\n            \r\n            oPolygonOptions.stroke = true;\r\n            oPolygonOptions.color = oLineColor.sColor;\r\n            oPolygonOptions.opacity = oLineColor.opacity;\r\n            oPolygonOptions.fill = true;\r\n            oPolygonOptions.fillColor = oFillColor.sColor;\r\n            oPolygonOptions.fillOpacity = oFillColor.opacity;\r\n            oPolygonOptions.weight = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH);\r\n\r\n            if (this.isSelected())\r\n            {\r\n                var oSelectAttributes = this.options.selectAttributes;\r\n                \r\n                oPolygonOptions.tempColor = oPolygonOptions.color;\r\n                oPolygonOptions.tempWeight = oPolygonOptions.weight;\r\n                \r\n                oPolygonOptions.color = '#' + oSelectAttributes.color;\r\n                oPolygonOptions.weight = oSelectAttributes.width;\r\n            }\r\n\r\n            if (oCoordList.length > 0)\r\n            {\r\n                // Clear the coordinates.\r\n                oCoordList.splice(0, oCoordList.length);\r\n            }\r\n\r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(oMap, oPt1, dRadius, dLeftBearing, dRightBearing, false);\r\n            \r\n            for  (var iIndex = 0; iIndex < oPartialCoordList.length; iIndex++)\r\n            {\r\n                oCoordList.push(oPartialCoordList[iIndex]);\r\n            }\r\n\r\n            oPartialCoordList = leafLet.utils.getArcCoordinates(oMap, oPt2, dRadius, dRightBearing, dLeftBearing, false);\r\n                \r\n            for  (var iIndex = 0; iIndex < oPartialCoordList.length; iIndex++)\r\n            {\r\n                oCoordList.push(oPartialCoordList[iIndex]);\r\n            }\r\n\r\n//console.log(\"Oval points: \" + oCoordList.length);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.utils.OvalObject = L.Polygon.extend(leafLet.internalPrivateClass.OvalObject());\r\n","\r\n/* global leafLet, L, emp */\r\nleafLet.ControlPoint = {\r\n    Type: {\r\n        NEW_POSITION_CP: 'newCP',\r\n        POSITION_CP: 'positionCP',\r\n        ALTITUDE_CP: 'altitudeCP',\r\n        RADIUS_CP: 'radiusCP',\r\n        INNER_RADIUS_CP: 'innerRadiusCP',\r\n        WIDTH_CP: 'widthCP',\r\n        LEFT_WIDTH_CP: 'leftWidthCP',\r\n        RIGHT_WIDTH_CP: 'rightWidthCP',\r\n        RANGE_CP: 'rangeCP',\r\n        LENGTH_CP: 'lengthCP',\r\n        AZIMUTH_CP: 'azimuthCP',\r\n        LEFT_AZIMUTH_CP: 'leftAzimuthCP',\r\n        RIGHT_AZIMUTH_CP: 'rightAzimuthCP',\r\n        ATTITUDE_CP: 'attitudeCP',\r\n        SEGMENT_CP: 'segmentCP',\r\n        AOI_BUFFER: 'aoiBufferCP'\r\n    }\r\n};\r\n\r\nleafLet.internalPrivateClass.CPIcon = function()\r\n{\r\n    var publicInterface = {\r\n        statics:{\r\n            CP_ICON_DEF: {\r\n                newCP: {\r\n                    iRadius: 7,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#00FF00\",\r\n                    sFillColor: \"#55FF55\"\r\n                },\r\n                positionCP: {\r\n                    iRadius: 11,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#0000FF\",\r\n                    sFillColor: \"#5555FF\"\r\n                },\r\n                altitudeCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#FF0000\",\r\n                    sFillColor: \"#FF5555\"\r\n                },\r\n                radiusCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#555555\",\r\n                    sFillColor: \"#888888\"\r\n                },\r\n                innerRadiusCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#555555\",\r\n                    sFillColor: \"#888888\"\r\n                },\r\n                widthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#000000\",\r\n                    sFillColor: \"#555555\"\r\n                },\r\n                leftWidthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#000000\",\r\n                    sFillColor: \"#555555\"\r\n                },\r\n                rightWidthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#000000\",\r\n                    sFillColor: \"#555555\"\r\n                },\r\n                rangeCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#000000\",\r\n                    sFillColor: \"#555555\"\r\n                },\r\n                lengthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#000000\",\r\n                    sFillColor: \"#555555\"\r\n                },\r\n                azimuthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#AAAA00\",\r\n                    sFillColor: \"#AAAA55\"\r\n                },\r\n                leftAzimuthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#AAAA00\",\r\n                    sFillColor: \"#AAAA55\"\r\n                },\r\n                rightAzimuthCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#AAAA00\",\r\n                    sFillColor: \"#AAAA55\"\r\n                },\r\n                attitudeCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#AAAA00\",\r\n                    sFillColor: \"#AAAA55\"\r\n                },\r\n                segmentCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#AAAAFF\",\r\n                    sFillColor: \"#AAAAFF\"\r\n                },\r\n                aoiBufferCP: {\r\n                    iRadius: 10,\r\n                    iLineWidth: 1,\r\n                    dOpacity: 0.7,\r\n                    sStrokeColor: \"#000000\",\r\n                    sFillColor: \"#555555\"\r\n                }\r\n            }\r\n        },\r\n        initialize: function (oArgs)\r\n        {\r\n            var oIconDef = leafLet.editor.CPIcon.CP_ICON_DEF[oArgs.cpType];\r\n            var oImage = emp.helpers.createCircleCanvas(oIconDef);\r\n\r\n            var options = {\r\n                oIconDef: oIconDef,\r\n                iRadius: oIconDef.iRadius,\r\n                iIconWidth: oImage.width,\r\n                iIconHeight: oImage.height\r\n            };\r\n            L.Util.setOptions(this, options);\r\n\r\n\r\n            var options = {\r\n                iconUrl: oImage.toDataURL()\r\n//                iconSize: new L.Point(oImage.width, oImage.height)\r\n            };\r\n            \r\n            L.Icon.prototype.initialize.call(this, options);\r\n        },\r\n        _setIconStyles: function (img, name) {\r\n            var options = this.options,\r\n                size = L.point(options[name + 'Size']),\r\n                anchor;\r\n\r\n            if (name === 'shadow') {\r\n                anchor = L.point(options.shadowAnchor || options.iconAnchor);\r\n            } else {\r\n                anchor = L.point(options.iconAnchor);\r\n            }\r\n\r\n            if (!anchor && size) {\r\n                anchor = size.divideBy(2, true);\r\n            }\r\n\r\n            img.className = 'leaflet-marker-' + name + ' ' + options.className;\r\n\r\n            if (anchor) {\r\n                img.style.marginLeft = (-anchor.x) + 'px';\r\n                img.style.marginTop  = (-anchor.y) + 'px';\r\n            }\r\n\r\n            if (size) {\r\n                img.style.width  = size.x + 'px';\r\n                img.style.height = size.y + 'px';\r\n            }\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\nleafLet.editor.CPIcon = L.Icon.extend(leafLet.internalPrivateClass.CPIcon());\r\n\r\nleafLet.internalPrivateClass.ControlPoint = function()\r\n{\r\n    var publicInterface = {\r\n        statics:{\r\n            oCPIcons:{\r\n                newCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.NEW_POSITION_CP}),\r\n                positionCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.POSITION_CP}),\r\n                altitudeCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.ALTITUDE_CP}),\r\n                radiusCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.RADIUS_CP}),\r\n                innerRadiusCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.INNER_RADIUS_CP}),\r\n                widthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.WIDTH_CP}),\r\n                leftWidthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.LEFT_WIDTH_CP}),\r\n                rightWidthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.RIGHT_WIDTH_CP}),\r\n                rangeCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.RANGE_CP}),\r\n                lengthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.LENGTH_CP}),\r\n                azimuthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.AZIMUTH_CP}),\r\n                leftAzimuthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP}),\r\n                rightAzimuthCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP}),\r\n                attitudeCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.ATTITUDE_CP}),\r\n                segmentCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.SEGMENT_CP}),\r\n                aoiBufferCP: new leafLet.editor.CPIcon({cpType: leafLet.ControlPoint.Type.AOI_BUFFER})\r\n            }\r\n        },\r\n        initialize: function (oFeature, cpType, oPosition, iIndex, iSubIndex, iValue, oIcon) \r\n        {\r\n            var options = {\r\n                oFeature: oFeature,\r\n                oIcon: oIcon,\r\n                cpType: cpType,\r\n                cpIndex: iIndex,\r\n                cpSubIndex: iSubIndex,\r\n                cpValue: iValue,\r\n                cpPopup: undefined,\r\n                parent: undefined\r\n            };\r\n            L.Util.setOptions(this, options);\r\n            \r\n            options = {\r\n                icon: leafLet.editor.ControlPoint.oCPIcons[this.getType()],\r\n                zIndexOffset: 1000,\r\n                clickable: true\r\n            };\r\n            \r\n            L.CircleMarker.prototype.initialize.call(this, oPosition, options);\r\n            this._updateCoordinate();\r\n        },\r\n        _updateCoordinate: function()\r\n        {\r\n            var oMapBounds = this.getFeature().getLeafletMap().getBounds();\r\n            var oCoordList = [this.getPosition()];\r\n\r\n            if (leafLet.utils.wrapCoordinates(oMapBounds, oCoordList, false))\r\n            {\r\n                this.setLatLng(oCoordList[0]);\r\n            }\r\n        },\r\n        getFeature: function()\r\n        {\r\n            return this.options.oFeature;\r\n        },\r\n        getRadius: function()\r\n        {\r\n            return leafLet.editor.CPIcon.CP_ICON_DEF[this.getType()].iRadius;\r\n        },\r\n        setParent: function(oParent)\r\n        {\r\n            this.options.parent = oParent;\r\n        },\r\n        getType: function()\r\n        {\r\n            return this.options.cpType;\r\n        },\r\n        setType: function(cpType)\r\n        {\r\n            this.options.cpType = cpType;\r\n            this.setIcon(leafLet.editor.ControlPoint.oCPIcons[this.getType()]);\r\n        },\r\n        getIndex: function()\r\n        {\r\n            return this.options.cpIndex;\r\n        },\r\n        setIndex: function(iValue)\r\n        {\r\n            this.options.cpIndex = iValue;\r\n        },\r\n        getSubIndex: function()\r\n        {\r\n            return this.options.cpSubIndex;\r\n        },\r\n        setSubIndex: function(iValue)\r\n        {\r\n            this.options.cpSubIndex = iValue;\r\n        },\r\n        getPosition: function()\r\n        {\r\n            return this.getLatLng();\r\n        },\r\n        setCPPosition: function(oValue)\r\n        {\r\n            this.setLatLng(oValue);\r\n            this._updateCoordinate();\r\n            this.bringToFront();\r\n            if (this.options.cpPopup)\r\n            {\r\n                this.options.cpPopup.setContent(this.getPopupText());\r\n                this.options.cpPopup.setLatLng(this.getPosition());\r\n            }\r\n        },\r\n        getValue: function()\r\n        {\r\n            return this.options.cpValue;\r\n        },\r\n        setValue: function(Value)\r\n        {\r\n            this.options.cpValue = Value;\r\n        },\r\n        _getAngleValue: function()\r\n        {\r\n            var oFeature = this.options.oFeature;\r\n            var sValue;\r\n            \r\n            switch (oFeature.getAzimuthUnits())\r\n            {\r\n                case leafLet.utils.AngleUnits.MILS:\r\n                    sValue = (this.getValue() * leafLet.utils.MILS_PER_DEGREE).toFixed(1) + \" \" +\r\n                            leafLet.utils.AngleUnits.MILS;\r\n                    break;\r\n                case leafLet.utils.AngleUnits.DEGREES:\r\n                    sValue = this.getValue().toFixed(2) +\r\n                            leafLet.utils.AngleUnits.DEGREES;\r\n                    break;\r\n            }\r\n            \r\n            return sValue;\r\n        },\r\n        _getUnitValue: function()\r\n        {\r\n            var oFeature = this.options.oFeature;\r\n            var sValue;\r\n            \r\n            switch (oFeature.getUnits())\r\n            {\r\n                case leafLet.utils.Units.FEET:\r\n                    sValue = (this.getValue() * leafLet.utils.FEET_PER_METERS).toFixed(0) + \" \" +\r\n                            leafLet.utils.Units.FEET;\r\n                    break;\r\n                case leafLet.utils.Units.METERS:\r\n                    sValue = this.getValue().toFixed(0) + \" \" +\r\n                            leafLet.utils.Units.METERS;\r\n                    break;\r\n            }\r\n            \r\n            return sValue;\r\n        },\r\n        _getAltitudeValue: function(dValue)\r\n        {\r\n            var oFeature = this.options.oFeature;\r\n            var sAltMode = oFeature.getAltitudeModeAbbr();\r\n            var sValue;\r\n            \r\n            if (sAltMode.length > 0)\r\n            {\r\n                sAltMode = \" \" + sAltMode;\r\n            }\r\n            else\r\n            {\r\n                sAltMode = \"\";\r\n            }\r\n            \r\n            switch (oFeature.getAltitudeUnits())\r\n            {\r\n                case leafLet.utils.Units.FEET:\r\n                    sValue = (dValue * leafLet.utils.FEET_PER_METERS).toFixed(0) + \" \" +\r\n                            leafLet.utils.Units.FEET + sAltMode;\r\n                    break;\r\n                case leafLet.utils.Units.METERS:\r\n                    sValue = dValue.toFixed(0) + \" \" +\r\n                            leafLet.utils.Units.METERS + sAltMode;\r\n                    break;\r\n            }\r\n            \r\n            return sValue;\r\n        },\r\n        getPopupText: function()\r\n        {\r\n            var sPopupText = \"\";\r\n            var oLatLng = this.getPosition().wrap();\r\n            \r\n            switch (this.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    sPopupText = \"<center>Pt \" + (this.options.cpIndex + 1) + \"<br/>\" +\r\n                            \"Lat:\" + oLatLng.lat.toFixed(5) + \"<br/>Lon:\" + oLatLng.lng.toFixed(5);\r\n                    \r\n                    if (!isNaN(oLatLng.alt))\r\n                    {\r\n                        sPopupText += \"<br/>Alt:\" + this._getAltitudeValue(oLatLng.alt);\r\n                    }\r\n                    \r\n                    sPopupText += \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.ALTITUDE_CP:\r\n                    sPopupText = \"<center>Alt: \" + this._getAltitudeValue(this.getValue()) + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RADIUS_CP:\r\n                    sPopupText = \"<center>Radius: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.INNER_RADIUS_CP:\r\n                    sPopupText = \"<center>Inner Radius: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RANGE_CP:\r\n                    sPopupText = \"<center>Range: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.WIDTH_CP:\r\n                    sPopupText = \"<center>Width: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.LEFT_WIDTH_CP:\r\n                    sPopupText = \"<center>Left Width: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RIGHT_WIDTH_CP:\r\n                    sPopupText = \"<center>Right Width: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.LENGTH_CP:\r\n                    sPopupText = \"<center>Length: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.AZIMUTH_CP:\r\n                    sPopupText = \"<center>Azimuth: \" + this._getAngleValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP:\r\n                    sPopupText = \"<center>Left Azimuth: \" + this._getAngleValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP:\r\n                    sPopupText = \"<center>Right Azimuth: \" + this._getAngleValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.ATTITUDE_CP:\r\n                    sPopupText = \"<center>Attitude: \" + this._getAngleValue() + \"</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.SEGMENT_CP:\r\n                    sPopupText = \"<center>Segment P\" + (this.getIndex() + 1) + \"-P\" + (this.getSubIndex() + 1) + \"<br/>Move</center>\";\r\n                    break;\r\n                case leafLet.ControlPoint.Type.AOI_BUFFER:\r\n                    sPopupText = \"<center>Buffer: \" + this._getUnitValue() + \"</center>\";\r\n                    break;\r\n            }\r\n            \r\n            return sPopupText;\r\n        },\r\n        showPopup: function()\r\n        {\r\n            var sPopupText = this.getPopupText();\r\n            \r\n            if (this.options.cpPopup === undefined)\r\n            {\r\n                var oPopup = new L.Popup({\r\n                    closeButton: false,\r\n                    closeOnClick: false,\r\n                    autoPan: false,\r\n                    className: 'mdl-color-text--grey-900',\r\n                    offset: new L.Point(0, this.getRadius() * -1)\r\n                });\r\n\r\n                this.options.cpPopup = oPopup;\r\n            }\r\n            \r\n            this.options.cpPopup.setContent(sPopupText);\r\n            this.options.cpPopup.setLatLng(this.getPosition());\r\n            this.options.parent.addLayer(this.options.cpPopup);\r\n            //this.bindPopup(oPopup);\r\n            //this.openPopup();\r\n            this.bringToFront();\r\n        },\r\n        hidePopup: function()\r\n        {\r\n            //this.closePopup();\r\n            //this.unbindPopup();\r\n            this.options.parent.removeLayer(this.options.cpPopup);\r\n            //this.options.cpPopup = undefined;\r\n            this.bringToFront();\r\n        },\r\n        updatePopup: function()\r\n        {\r\n            if (this.options.cpPopup)\r\n            {\r\n                var sPopupText = this.getPopupText();\r\n                this.options.cpPopup.setContent(sPopupText);\r\n                this.options.cpPopup.setLatLng(this.getPosition());\r\n            }\r\n        },\r\n        bringToFront: function()\r\n        {\r\n//            this.setZIndexOffset(Number.MAX_VALUE);\r\n        },\r\n        setPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])\r\n            var iRadius = this.options.icon.options.oIconDef.iRadius;\r\n            var oOffsetPoint = new L.Point(point.x - iRadius, point.y - iRadius);\r\n\r\n            // jshint camelcase: false\r\n            el._leaflet_pos = point;\r\n\r\n            if (!disable3D && L.Browser.any3d) {\r\n                el.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(oOffsetPoint);\r\n            } else {\r\n                el.style.left = oOffsetPoint.x + 'px';\r\n                el.style.top = oOffsetPoint.y + 'px';\r\n            }\r\n        },\r\n        _setPos: function (pos) {\r\n            this.setPosition(this._icon, pos);\r\n\r\n            if (this._shadow) {\r\n                this.setPosition(this._shadow, pos);\r\n            }\r\n\r\n            this._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n            this._resetZIndex();\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.ControlPoint = L.Marker.extend(leafLet.internalPrivateClass.ControlPoint());\r\n","/* global leafLet, L, emp */\r\n\r\nleafLet.editor.StateType = {\r\n    IDLE: 'idle',\r\n    ADDING_CP: 'add',\r\n    DELETE_CP: 'delete',\r\n    DRAGGING_CP: 'dragging',\r\n    FEATURE_DRAG: 'featuredrag'\r\n};\r\n\r\nleafLet.internalPrivateClass.AbstractEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            L.FeatureGroup.prototype.initialize.call(this);\r\n            var oOptions = {\r\n                bDestroyFeature: false,\r\n                editorState: leafLet.editor.StateType.IDLE,\r\n                isDrawing: ((args.EmpDrawEditItem instanceof emp.typeLibrary.Draw)? true: false), // False if editing.\r\n                oTransaction: args.transaction,\r\n                oEmpDrawEditItem: args.EmpDrawEditItem,\r\n                oCurrentCP: undefined,\r\n                feature: args.feature,\r\n                properties: undefined,\r\n                //leafletObject: (args.feature? args.feature.getLeafletObject(): undefined),\r\n                leafletMap: args.instanceInterface.leafletInstance,\r\n                instanceInterface: args.instanceInterface,\r\n                oControlPointList: [],\r\n                featureStartLocation: undefined,\r\n                updateIndex: undefined,\r\n                oMarkerPopUp: undefined,\r\n                bCPDragged: false\r\n            };\r\n            L.Util.setOptions(this, oOptions);\r\n            this.options.leafletMap.addLayer(this);\r\n\r\n            if (args.feature)\r\n            {\r\n                this.options.properties = leafLet.utils.mergeProperties(this.options.feature.options.properties, this.options.oEmpDrawEditItem.properties);\r\n            }\r\n            else\r\n            {\r\n                this.options.properties = leafLet.utils.mergeProperties(this.options.oEmpDrawEditItem.properties, {});\r\n            }\r\n            if (this.isDrawMode())\r\n            {\r\n                this.preapareForDrawOperation();\r\n            }\r\n            else\r\n            {\r\n                this.preapareForEditOperation();\r\n                \r\n                if (this.getFeature().getParentCoreId() !== undefined)\r\n                {\r\n                    var oParent = this.getFeature().getParentObject();\r\n                    oParent.removeChildObject(this.getFeature());\r\n                }\r\n                \r\n                this.addLayer(this.getFeature());\r\n            }\r\n            \r\n            this.getFeature().setEditMode();\r\n            this.assembleControlPoints();\r\n            \r\n            this.options.leafletMap.on('click', this.onClickEvent, this);\r\n            this.options.leafletMap.on('mouseup', this.onFeatureMouseUpEvent, this);\r\n            //this.on('mousedown', this.onMouseDown, this);\r\n            //this.on('dblclick', this.onDblClick, this);\r\n\r\n            this.setLeafletObjectEvents();\r\n            \r\n            this._issueStartEvent();\r\n        },\r\n        destroy:function()\r\n        {\r\n            if (this.options.oMarkerPopUp)\r\n            {\r\n                this.removeLayer(this.options.oMarkerPopUp);\r\n            }\r\n            \r\n            this.removeLayer(this.getFeature());\r\n\r\n            this.removeLeafletObjectEvents();\r\n\r\n            if (this.options.bDestroyFeature)\r\n            {\r\n                this.options.feature.destroy();\r\n                this.options.feature = undefined;\r\n            }\r\n            this.options.leafletMap.off('click', this.onClickEvent, this);\r\n            this.options.leafletMap.off('mouseup', this.onFeatureMouseUpEvent, this);\r\n            this.options.leafletMap.off('mouseup', this.onCPMouseUpEvent, this);\r\n            this.clearAllEventListeners();\r\n            this.removeAllControlPoints();\r\n            this.options.leafletMap.removeLayer(this);\r\n            \r\n            if (this.getFeature())\r\n            {\r\n                if (this.getFeature().getParentCoreId() !== undefined)\r\n                {\r\n                    var oParent = this.getFeature().getParentObject();\r\n                    oParent.addChildObject(this.getFeature());\r\n                }\r\n            }\r\n        },\r\n        getEngineInstanceInterface: function()\r\n        {\r\n            return this.options.instanceInterface;\r\n        },\r\n        getMarkerObject: function()\r\n        {\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject)\r\n            {\r\n                if (oLeafletObject instanceof L.LayerGroup)\r\n                {\r\n                    oLeafletObject = oLeafletObject.getLayers()[0];\r\n                }\r\n\r\n                if (oLeafletObject instanceof L.Marker)\r\n                {\r\n                    return oLeafletObject;\r\n                }\r\n            }\r\n            \r\n            return undefined;\r\n        },\r\n        isMarker: function()\r\n        {\r\n            return (this.getMarkerObject()? true: false);\r\n        },\r\n        setMarkerEvents: function()\r\n        {\r\n            var oLeafletObject = this.getMarkerObject();\r\n            \r\n            if (oLeafletObject)\r\n            {\r\n                oLeafletObject.on('mousedown', this.onFeatureMouseDown, this);\r\n                //oLeafletObject.on('mouseup', this.onFeatureMouseUpEvent, this);\r\n            }\r\n        },\r\n        removeMarkerEvents: function()\r\n        {\r\n            var oLeafletObject = this.getMarkerObject();\r\n            \r\n            if (oLeafletObject)\r\n            {\r\n                oLeafletObject.off('mousedown', this.onFeatureMouseDown, this);\r\n                //oLeafletObject.off('mouseup', this.onFeatureMouseUpEvent, this);\r\n            }\r\n        },\r\n        setLeafletObjectEvents: function()\r\n        {\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject)\r\n            {\r\n                if (this.isMarker())\r\n                {\r\n                    this.setMarkerEvents();\r\n                }\r\n                else if (oLeafletObject instanceof L.LayerGroup)\r\n                {\r\n                    var oChildren = oLeafletObject.getLayers();\r\n                    \r\n                    for (var iIndex = 0; iIndex < oChildren.length; iIndex++)\r\n                    {\r\n                        oChildren[iIndex].on('mousedown', this.onFeatureMouseDown, this);\r\n                        //oChildren[iIndex].on('mouseup', this.onFeatureMouseUpEvent, this);\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    oLeafletObject.on('mousedown', this.onFeatureMouseDown, this);\r\n                    //oLeafletObject.on('mouseup', this.onFeatureMouseUpEvent, this);\r\n                }\r\n            }\r\n        },\r\n        removeLeafletObjectEvents: function()\r\n        {\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject)\r\n            {\r\n                if (this.isMarker())\r\n                {\r\n                    this.removeMarkerEvents();\r\n                }\r\n                else if (oLeafletObject instanceof L.LayerGroup)\r\n                {\r\n                    var oChildren = oLeafletObject.getLayers();\r\n                    \r\n                    for (var iIndex = 0; iIndex < oChildren.length; iIndex++)\r\n                    {\r\n                        oChildren[iIndex].off('mousedown', this.onFeatureMouseDown, this);\r\n                        //oChildren[iIndex].off('mouseup', this.onFeatureMouseUpEvent, this);\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    oLeafletObject.off('mousedown', this.onFeatureMouseDown, this);\r\n                    //oLeafletObject.off('mouseup', this.onFeatureMouseUpEvent, this);\r\n                }\r\n            }\r\n        },\r\n        getLeafletMap: function()\r\n        {\r\n            return this.options.leafletMap;\r\n        },\r\n        removeAllControlPoints: function()\r\n        {\r\n            var oControlPointList = this.options.oControlPointList;\r\n            \r\n            while (oControlPointList.length > 0)\r\n            {\r\n                this.removeCP(oControlPointList[0]);\r\n            }\r\n        },\r\n        _getAltitudeValue: function(dValue)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            \r\n            return dValue.toFixed(0) + \" \" + oFeature.getAltitudeUnits() + \" \" + oFeature.getAltitudeModeAbbr();\r\n        },\r\n        getMarkerPopupText: function()\r\n        {\r\n            var sPopupText;\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                var oCoordList = this.getCoordinateList();\r\n                var oLatLng = oCoordList[0];\r\n                \r\n                sPopupText = \"<center>Lat:\" + oLatLng.lat.toFixed(5) + \"<br/>Lon:\" + oLatLng.lng.toFixed(5);\r\n\r\n                if (!isNaN(oLatLng.alt))\r\n                {\r\n                    sPopupText += \"<br/>Alt:\" + this._getAltitudeValue(oLatLng.alt);\r\n                }\r\n\r\n                sPopupText += \"</center>\";\r\n            }\r\n            \r\n            return sPopupText;\r\n        },\r\n        setMarkerPopup: function()\r\n        {\r\n/*\r\n            var sPopupText;\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject)\r\n            {\r\n                sPopupText = this.getMarkerPopupText();\r\n\r\n                if (this.options.oMarkerPopUp)\r\n                {\r\n                    this.options.oMarkerPopUp.setContent(sPopupText);\r\n                    this.options.oMarkerPopUp.setLatLng(oLeafletObject.getLatLng());\r\n                    this.options.oMarkerPopUp.update();\r\n                }\r\n                else\r\n                {\r\n                    this.options.oMarkerPopUp = new L.Popup({\r\n                        closeButton: false,\r\n                        autoPan: false,\r\n                        className: 'mdl-color--grey-800 mdl-shadow--12dp',\r\n                        offset: new L.Point(0, (this.options.instanceInterface.iMilStdIconSize * -1))\r\n                    });\r\n                    this.options.oMarkerPopUp.setLatLng(oLeafletObject.getLatLng());\r\n                    this.addLayer(this.options.oMarkerPopUp);\r\n                }\r\n            }\r\n*/\r\n        },\r\n        getLeafletObject: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oFeature)\r\n            {\r\n                return oFeature.getLeafletObject();\r\n            }\r\n            return undefined;\r\n        },\r\n        setLeafletObject: function(oObject)\r\n        {\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oFeature)\r\n            {\r\n                this.removeLeafletObjectEvents();\r\n                oFeature.setLeafletObject(oObject);\r\n            }\r\n            \r\n            var oMarkerObject = this.getMarkerObject();\r\n            \r\n            if (oMarkerObject)\r\n            {\r\n                oMarkerObject.unbindPopup();\r\n            }\r\n            \r\n            this.setLeafletObjectEvents();\r\n            this.setMarkerPopup();\r\n            this.bringCPForward();\r\n        },\r\n        getFeature: function()\r\n        {\r\n            return this.options.feature;\r\n        },\r\n        setFeature: function(oFeature)\r\n        {\r\n            if (this.options.feature)\r\n            {\r\n                this.getFeature().clearAllEventListeners();\r\n                this.removeLayer(this.getFeature());\r\n                if (this.options.bDestroyFeature)\r\n                {\r\n                    this.getFeature().destroy();\r\n                }\r\n                this.options.feature = undefined;\r\n            }\r\n            \r\n            if (oFeature)\r\n            {\r\n                this.options.feature = oFeature;\r\n                this.addLayer(this.getFeature());\r\n                this.setLeafletObjectEvents();\r\n            }\r\n        },\r\n        getDrawEditItem: function()\r\n        {\r\n            return this.options.oEmpDrawEditItem;\r\n        },\r\n        isDrawMode: function()\r\n        {\r\n            return this.options.isDrawing;\r\n        },\r\n        preapareForDrawOperation: function()\r\n        {\r\n            // The subclass can implement this function.\r\n            // It is called once at the start of a draw operation, before the assembleControlPoints.\r\n        },\r\n        preapareForEditOperation: function()\r\n        {\r\n            // The subclass can implement this function.\r\n            // It is called once at the start of an edit operation,\r\n            // before the assembleControlPoints is called.\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            throw new Error(\"The editor has not implemented the assembleControlPoint method.\");\r\n        },\r\n        createEMPFeature: function()\r\n        {\r\n            var oEMPFeature;\r\n            var oFeature = this.getFeature();\r\n            \r\n            oEMPFeature = new emp.typeLibrary.Feature({\r\n                coreId: oFeature.getCoreId(),\r\n                overlayId: oFeature.getOverlayId(),\r\n                parentId: oFeature.getParentId(),\r\n                featureId: oFeature.getFeatureId(),\r\n                name: oFeature.getName(),\r\n                format: oFeature.getFormat(),\r\n                data: oFeature.getData(),\r\n                properties: oFeature.getProperties()\r\n            });\r\n            \r\n            return oEMPFeature;\r\n        },\r\n        getCenterPT: function(oPt1, oPt2)\r\n        {\r\n            var dDist = oPt1.distanceTo(oPt2);\r\n            var dBearing = oPt1.bearingTo(oPt2);\r\n            \r\n            return oPt1.destinationPoint(dBearing, dDist / 2.0);\r\n        },\r\n        getCP: function(iCPIndex)\r\n        {\r\n            var oCPList = this.options.oControlPointList;\r\n            \r\n            for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n            {\r\n                if (oCPList[iIndex].getIndex() === iCPIndex)\r\n                {\r\n                    return oCPList[iIndex];\r\n                }\r\n            }\r\n            \r\n            return undefined;\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            return undefined;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            return undefined;\r\n        },\r\n        doFeatureMove: function(dBearing, dDistance)\r\n        {\r\n            return false;\r\n        },\r\n        getState: function()\r\n        {\r\n            return this.options.editorState;\r\n        },\r\n        isIdle: function()\r\n        {\r\n            return (this.getState() === leafLet.editor.StateType.IDLE);\r\n        },\r\n        isAddingCP: function()\r\n        {\r\n            return (this.getState() === leafLet.editor.StateType.ADDING_CP);\r\n        },\r\n        isDeletingCP: function()\r\n        {\r\n            return (this.getState() === leafLet.editor.StateType.DELETE_CP);\r\n        },\r\n        isDraggingCP: function()\r\n        {\r\n            return (this.getState() === leafLet.editor.StateType.DRAGGING_CP);\r\n        },\r\n        isDraggingFeature: function()\r\n        {\r\n            return (this.getState() === leafLet.editor.StateType.FEATURE_DRAG);\r\n        },\r\n        _setState: function(eState) {\r\n            this.options.editorState = eState;\r\n        },\r\n        isCPAddEvent: function(oEvent)\r\n        {\r\n            // An add is a mouse Click\r\n            // with the left button with no Alt, shift nor ctrl keys press.\r\n            // And it can't occure on a control point.\r\n            if (this.isIdle() &&\r\n                (oEvent.originalEvent.button === 0) &&\r\n                !oEvent.originalEvent.altKey &&\r\n                !oEvent.originalEvent.ctrlKey &&\r\n                !oEvent.originalEvent.shiftkey)\r\n            {\r\n                if (oEvent.type === 'click')\r\n                {\r\n                    if (!(oEvent.target instanceof leafLet.editor.ControlPoint))\r\n                    {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        isCPDeleteEvent: function(oEvent)\r\n        {\r\n            // A  delete is a mouse DblClick\r\n            // with the left button with no Alt, shift nor ctrl keys press.\r\n            // But it must occure on a control point that is not new\r\n            if (this.isIdle() &&\r\n                    (oEvent.originalEvent.button === 0) &&\r\n                    !oEvent.originalEvent.altKey &&\r\n                    !oEvent.originalEvent.ctrlKey &&\r\n                    !oEvent.originalEvent.shiftkey)\r\n            {\r\n                if (oEvent.type === 'dblclick')\r\n                {\r\n                    if ((oEvent.target instanceof leafLet.editor.ControlPoint) &&\r\n                            (oEvent.target.getType() !== leafLet.ControlPoint.Type.NEW_POSITION_CP))\r\n                    {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        isCPDragStartEvent: function(oEvent)\r\n        {\r\n            // A CP drag starts with a mouse down\r\n            // with the left button with no Alt, shift nor ctrl keys press.\r\n            // But it must occure on a control point.\r\n            if (this.isIdle() &&\r\n                    (oEvent.originalEvent.button === 0) &&\r\n                    !oEvent.originalEvent.altKey &&\r\n                    !oEvent.originalEvent.ctrlKey &&\r\n                    !oEvent.originalEvent.shiftkey)\r\n            {\r\n                if (oEvent.type === 'mousedown')\r\n                {\r\n                    if (oEvent.target instanceof leafLet.editor.ControlPoint)\r\n                    {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        isFeatureDragStartEvent: function(oEvent)\r\n        {\r\n            // A CP drag starts with a mouse down\r\n            // with the left button with no Alt, shift nor ctrl keys press.\r\n            // But it must occure on a control point.\r\n            if (this.isIdle() &&\r\n                    (oEvent.originalEvent.button === 0) &&\r\n                    !oEvent.originalEvent.altKey &&\r\n                    !oEvent.originalEvent.ctrlKey &&\r\n                    !oEvent.originalEvent.shiftkey)\r\n            {\r\n                if (oEvent.type === 'mousedown')\r\n                {\r\n                    if (!(oEvent.target instanceof leafLet.editor.ControlPoint))// &&\r\n//                            ((oEvent.target === this.getLeafletObject()) ||\r\n//                            (oEvent.target instanceof L.Marker)))\r\n                    {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        onClickEvent: function(oEvent)\r\n        {\r\n//console.log(\"Got \" + oEvent.type);\r\n            if ((this.isCPAddEvent(oEvent)) &&\r\n                (oEvent.latlng instanceof L.LatLng) &&\r\n                !this.options.bCPDragged)\r\n            {\r\n                this._setState(leafLet.editor.StateType.ADDING_CP);\r\n\r\n                var oCP = this.doAddControlPoint(oEvent.latlng.wrap());\r\n                if (oCP)\r\n                {\r\n                    this.updateCPIndex(oCP.getIndex(), 1);\r\n                    this.addControlPoint(oCP);\r\n                    this._issueCPAddEvent(oCP.getIndex());\r\n                }\r\n                this._setState(leafLet.editor.StateType.IDLE);\r\n            }\r\n        },\r\n        onDblClick: function(oEvent)\r\n        {\r\n//console.log(\"Got \" + oEvent.type);\r\n            if (this.isCPDeleteEvent(oEvent) &&\r\n                    !this.options.bCPDragged) {\r\n                var oCP = oEvent.target;\r\n                \r\n                this._setState(leafLet.editor.StateType.DELETE_CP);\r\n                if (this.doDeleteControlPoint(oCP))\r\n                {\r\n                    // The editor indicated that the CP can be deleted.\r\n                    this.removeCP(oCP);\r\n                    this.updateCPIndex(oCP.getIndex(), -1);\r\n                    this._issueCPDeleteEvent(oCP.getIndex());\r\n                }\r\n                this._setState(leafLet.editor.StateType.IDLE);\r\n            }\r\n        },\r\n        onCPMouseUpEvent: function(oEvent)\r\n        {\r\n//console.log(\"Got CP \" + oEvent.type);\r\n            if (this.isDraggingCP())\r\n            {\r\n                var oCP = this.options.oCurrentCP;\r\n\r\n                if (typeof (oEvent.originalEvent.target.releaseCapture) === 'function')\r\n                {\r\n                    oEvent.originalEvent.target.releaseCapture();\r\n                }\r\n                this.getLeafletMap().off('mousemove', this.onCPMouseMoveEvent, this);\r\n                this.getLeafletMap().off('mouseup', this.onCPMouseUpEvent, this);\r\n                this.getLeafletMap().dragging.enable();\r\n                oCP.hidePopup();\r\n                this._setState(leafLet.editor.StateType.IDLE);\r\n                this.options.oCurrentCP = undefined;\r\n                this._issueCPUpdateEvent(this.options.updateIndex, emp.typeLibrary.UpdateEventType.UPDATE);\r\n                if (typeof (oEvent.originalEvent.stopPropagation) === 'function') {\r\n                    oEvent.originalEvent.stopPropagation();\r\n                }\r\n                if (typeof (oEvent.originalEvent.preventDefault) === 'function') {\r\n                    oEvent.originalEvent.preventDefault();\r\n                }\r\n            }\r\n        },\r\n        onCPMouseMoveEvent: function(oEvent)\r\n        {\r\n//console.log(\"Got CP \" + oEvent.type);\r\n            var aiIndex;\r\n            \r\n            if (this.isDraggingCP()) {\r\n                var oCP = this.options.oCurrentCP;\r\n                this.options.bCPDragged = true;\r\n                aiIndex = this.doControlPointMoved(oCP, oEvent);\r\n\r\n                if (aiIndex instanceof Array) {\r\n                    oCP.updatePopup();\r\n                }\r\n                this.options.updateIndex = aiIndex;\r\n            }\r\n        },\r\n        onCPMouseDown: function(oEvent)\r\n        {\r\n//console.log(\"Got CP \" + oEvent.type);\r\n            if (this.isCPDragStartEvent(oEvent)) {\r\n                this.options.bCPDragged = false;\r\n                var iIndex = this.options.oControlPointList.indexOf(oEvent.target);\r\n                \r\n                if (iIndex !== -1) {\r\n                    var oCP = this.options.oControlPointList[iIndex];\r\n\r\n                    oCP.showPopup();\r\n                    this._setState(leafLet.editor.StateType.DRAGGING_CP);\r\n                    this.options.oCurrentCP = oCP;\r\n                    this.getLeafletMap().dragging.disable();\r\n                    this.getLeafletMap().on('mousemove', this.onCPMouseMoveEvent, this);\r\n                    if (typeof (oEvent.originalEvent.target.setCapture) === 'function') {\r\n                        oEvent.originalEvent.target.setCapture();\r\n                    }\r\n                    this.getLeafletMap().on('mouseup', this.onCPMouseUpEvent, this);\r\n                }\r\n            }\r\n        },\r\n        onFeatureMouseUpEvent: function(oEvent)\r\n        {\r\n//console.log(\"Got Feature \" + oEvent.type);\r\n            if (this.isDraggingFeature())\r\n            {\r\n                var oCPList = this.options.oControlPointList;\r\n\r\n                for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n                {\r\n                    if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP)\r\n                    {\r\n                        oCPList[iIndex].hidePopup();\r\n                    }\r\n                }\r\n                \r\n                if (typeof (oEvent.originalEvent.target.releaseCapture) === 'function')\r\n                {\r\n                    oEvent.originalEvent.target.releaseCapture();\r\n                }\r\n                this.getLeafletMap().off('mousemove', this.onFeatureMouseMoveEvent, this);\r\n                this.getLeafletMap().dragging.enable();\r\n                this._setState(leafLet.editor.StateType.IDLE);\r\n                this._issueCPUpdateEvent(this.options.updateIndex, emp.typeLibrary.UpdateEventType.UPDATE);\r\n            }\r\n        },\r\n        onFeatureMouseMoveEvent: function(oEvent)\r\n        {\r\n//console.log(\"Got Feature \" + oEvent.type);\r\n            var aiIndex;\r\n            \r\n            if (this.isDraggingCP())\r\n            {\r\n                var oCP = this.options.oCurrentCP;\r\n                var oOrgLL = oEvent.latlng;\r\n                var oEventCoord = oOrgLL.wrap();\r\n                \r\n                oEvent.latlng = oEventCoord;\r\n                aiIndex = this.doControlPointMoved(oCP, oEvent);\r\n                oEvent.latlng = oOrgLL;\r\n\r\n                if (aiIndex instanceof Array)\r\n                {\r\n                    oCP.updatePopup();\r\n                }\r\n                this.options.updateIndex = aiIndex;\r\n            }\r\n            else if (this.isDraggingFeature())\r\n            {\r\n                var oEventCoord = oEvent.latlng.wrap();\r\n                var dBearing = this.options.featureStartLocation.bearingTo(oEventCoord);\r\n                var dDistance = this.options.featureStartLocation.distanceTo(oEventCoord);\r\n                \r\n                if (this.doFeatureMove(dBearing, dDistance))\r\n                {\r\n                    var oCPList = this.options.oControlPointList;\r\n                    \r\n                    aiIndex = [];\r\n                    for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n                    {\r\n                        if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP)\r\n                        {\r\n                            aiIndex.push(oCPList[iIndex].getIndex());\r\n                            oCPList[iIndex].updatePopup();\r\n                        }\r\n                    }\r\n                    this.options.featureStartLocation = oEvent.latlng;\r\n                    this.options.updateIndex = aiIndex;\r\n                }\r\n            }\r\n        },\r\n        onFeatureMouseDown: function(oEvent)\r\n        {\r\n//console.log(\"Got Feature \" + oEvent.type);\r\n            if (this.isFeatureDragStartEvent(oEvent))\r\n            {\r\n                var oCPList = this.options.oControlPointList;\r\n\r\n                for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n                {\r\n                    if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP)\r\n                    {\r\n                        oCPList[iIndex].showPopup();\r\n                    }\r\n                }\r\n                \r\n                this.options.featureStartLocation = oEvent.latlng;\r\n                this._setState(leafLet.editor.StateType.FEATURE_DRAG);\r\n\r\n                this.getLeafletMap().dragging.disable();\r\n                this.getLeafletMap().on('mousemove', this.onFeatureMouseMoveEvent, this);\r\n                if (typeof (oEvent.originalEvent.target.setCapture) === 'function')\r\n                {\r\n                    oEvent.originalEvent.target.setCapture();\r\n                }\r\n            }\r\n        },\r\n        setCPEvents: function(oCP)\r\n        {\r\n            oCP.on('dblclick', this.onDblClick, this);\r\n            oCP.on('mousedown', this.onCPMouseDown, this);\r\n            //oCP.on('mouseup', this.onCPMouseUpEvent, this);\r\n        },\r\n        removeCPEvents: function(oCP)\r\n        {\r\n            oCP.off('dblclick', this.onDblClick, this);\r\n            oCP.off('mousedown', this.onCPMouseDown, this);\r\n            //oCP.off('mouseup', this.onCPMouseUpEvent, this);\r\n        },\r\n        addControlPoint: function(oCP)\r\n        {\r\n            this.options.oControlPointList.push(oCP);\r\n            this.addLayer(oCP);\r\n            this.setCPEvents(oCP);\r\n            oCP.bringToFront();\r\n            oCP.setParent(this);\r\n        },\r\n        bringCPForward: function()\r\n        {\r\n            var oCPList = this.options.oControlPointList;\r\n            \r\n            this.bringToFront();\r\n            for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n            {\r\n                oCPList[iIndex].bringToFront();\r\n            }\r\n        },\r\n        removeCP: function(oCP)\r\n        {\r\n            var iIndex = this.options.oControlPointList.indexOf(oCP);\r\n\r\n            if (iIndex > -1)\r\n            {\r\n                this.removeCPEvents(oCP);\r\n                this.removeLayer(oCP);\r\n                this.options.oControlPointList.splice(iIndex, 1);\r\n            }\r\n        },\r\n        removeAllCPByType: function(type)\r\n        {\r\n            var oCPList = this.options.oControlPointList;\r\n            \r\n            for (var iIndex = 0; iIndex < oCPList.length;)\r\n            {\r\n                if (oCPList[iIndex].getType() === type)\r\n                {\r\n                    this.removeCP(oCPList[iIndex]);\r\n                }\r\n                else\r\n                {\r\n                    iIndex++;\r\n                }\r\n            }\r\n        },\r\n        getCoordinateList: function()\r\n        {\r\n            throw new Error(\"getCoordinateList function nor impletmented in editor.\");\r\n        },\r\n        updateCPIndex: function(iStartIndex, iDelta)\r\n        {\r\n            var oCPList = this.options.oControlPointList;\r\n\r\n            for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n            {\r\n                if ((oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP) &&\r\n                        (oCPList[iIndex].getIndex() >= iStartIndex))\r\n                {\r\n                    oCPList[iIndex].setIndex(oCPList[iIndex].getIndex() + iDelta);\r\n                }\r\n            }\r\n        },\r\n        convertToUpdateCoordinates: function(oCoordList)\r\n        {\r\n            var oUpdateCoordList = [];\r\n            \r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                if (!isNaN(oCoordList[iIndex].alt))\r\n                {\r\n                    oUpdateCoordList.push({\r\n                        lat: oCoordList[iIndex].lat,\r\n                        lon: oCoordList[iIndex].lng,\r\n                        alt: oCoordList[iIndex].alt\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    oUpdateCoordList.push({\r\n                        lat: oCoordList[iIndex].lat,\r\n                        lon: oCoordList[iIndex].lng\r\n                    });\r\n                }\r\n            }\r\n            \r\n            return oUpdateCoordList;\r\n        },\r\n        _issueStartEvent: function()\r\n        {\r\n            if (this.isDrawMode())\r\n            {\r\n                this.getEngineInstanceInterface().empMapInstance.eventing.DrawStart({transaction: this.options.oTransaction});\r\n            }\r\n            else\r\n            {\r\n                // Else it an edit.\r\n                this.getEngineInstanceInterface().empMapInstance.eventing.EditStart({transaction: this.options.oTransaction});\r\n            }\r\n            this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.START);\r\n            this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n        },\r\n        _issueCPUpdateEvent: function(oIndexArray, updateEventType)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oUpdateCoordList = this.convertToUpdateCoordinates(oCoordList);\r\n            \r\n            var oUpdateEvent = {\r\n                name: oFeature.getName(),\r\n                plotFeature: this.createEMPFeature(),\r\n                updates:{\r\n                    type: emp.typeLibrary.CoordinateUpdateType.UPDATE,\r\n                    indices: oIndexArray,\r\n                    coordinates: oUpdateCoordList\r\n                },\r\n                properties: oFeature.getProperties(),\r\n                updateEventType: updateEventType,\r\n                mapInstanceId: this.getEngineInstanceInterface().empMapInstance.mapInstanceId\r\n            };\r\n            \r\n            this.options.oEmpDrawEditItem.update(oUpdateEvent);\r\n        },\r\n        _issueCPAddEvent: function(iIndex)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oUpdateCoordList = this.convertToUpdateCoordinates(oCoordList);\r\n            \r\n            var oUpdateEvent = {\r\n                name: oFeature.getName(),\r\n                plotFeature: this.createEMPFeature(),\r\n                updates:{\r\n                    type: emp.typeLibrary.CoordinateUpdateType.ADD,\r\n                    indices: [iIndex],\r\n                    coordinates: oUpdateCoordList\r\n                },\r\n                properties: oFeature.getProperties(),\r\n                updateEventType: emp.typeLibrary.UpdateEventType.UPDATE,\r\n                mapInstanceId: this.getEngineInstanceInterface().empMapInstance.mapInstanceId\r\n            };\r\n            \r\n            this.options.oEmpDrawEditItem.update(oUpdateEvent);\r\n        },\r\n        _issueCPDeleteEvent: function(iIndex)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oUpdateCoordList = this.convertToUpdateCoordinates(oCoordList);\r\n            \r\n            var oUpdateEvent = {\r\n                name: oFeature.getName(),\r\n                plotFeature: this.createEMPFeature(),\r\n                updates:{\r\n                    type: emp.typeLibrary.CoordinateUpdateType.REMOVE,\r\n                    indices: [iIndex],\r\n                    coordinates: oUpdateCoordList\r\n                },\r\n                properties: oFeature.getProperties(),\r\n                updateEventType: emp.typeLibrary.UpdateEventType.UPDATE,\r\n                mapInstanceId: this.getEngineInstanceInterface().empMapInstance.mapInstanceId\r\n            };\r\n            \r\n            this.options.oEmpDrawEditItem.update(oUpdateEvent);\r\n        },\r\n        _issueEndEvent: function()\r\n        {\r\n            if (this.isDrawMode())\r\n            {\r\n                this.options.oEmpDrawEditItem.plotFeature = this.createEMPFeature();\r\n                this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.COMPLETE);\r\n                this.getEngineInstanceInterface().empMapInstance.eventing.DrawEnd({transaction: this.options.oTransaction});\r\n            }\r\n            else\r\n            {\r\n                // Else it an edit.\r\n                this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.COMPLETE);\r\n                // We need to update the feature.\r\n                this.getEngineInstanceInterface().empMapInstance.eventing.EditEnd({transaction: this.options.oTransaction});\r\n            }\r\n        },\r\n        _issueCancelEvent: function()\r\n        {\r\n            var oErrArray = [];\r\n\r\n            oErrArray.push({\r\n                coreId: this.options.oEmpDrawEditItem.coreId,\r\n                message: \"Operation canceled.\",\r\n                level: 0\r\n            });\r\n\r\n            if (this.isDrawMode())\r\n            {\r\n                this.getEngineInstanceInterface().empMapInstance.eventing.DrawEnd({\r\n                    transaction: this.options.oTransaction,\r\n                    failures: oErrArray\r\n                });\r\n            }\r\n            else\r\n            {\r\n                // Else it an edit.\r\n                this.getEngineInstanceInterface().empMapInstance.eventing.EditEnd({\r\n                    transaction: this.options.oTransaction,\r\n                    failures: oErrArray\r\n                });\r\n            }\r\n        },\r\n        endEdit: function()\r\n        {\r\n            this._issueEndEvent();\r\n            this.getFeature().resetEditMode();\r\n            this.removeLeafletObjectEvents();\r\n        },\r\n        cancelEdit: function()\r\n        {\r\n            this._issueCancelEvent();\r\n            this.getFeature().resetEditMode();\r\n            this.removeLeafletObjectEvents();\r\n        },\r\n        updateLeafletObject: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oMapBounds = this.getLeafletMap().getBounds();\r\n            \r\n            oFeature.updateCoordinates(oMapBounds);\r\n        },\r\n        render: function()\r\n        {\r\n            this.updateLeafletObject();\r\n            this.removeAllControlPoints();\r\n            this.assembleControlPoints();\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AbstractEditor = L.FeatureGroup.extend(leafLet.internalPrivateClass.AbstractEditor());\r\n","/* global leafLet, L, emp */\r\n\r\nleafLet.internalPrivateClass.GeoJsonEditor = function () {\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var oOptions = {\r\n                geoJsonType: (args.geoJsonType ? args.geoJsonType.toLowerCase() : undefined)\r\n            };\r\n            L.Util.setOptions(this, oOptions);\r\n\r\n            leafLet.editor.AbstractEditor.prototype.initialize.call(this, args);\r\n        },\r\n        preapareForDrawOperation: function () {\r\n            if (this.getFeature() === undefined) {\r\n                var oGeoJsonData = {\r\n                    type: 'Point',\r\n                    coordinates: []\r\n                };\r\n\r\n                switch (this.options.geoJsonType) {\r\n                    case 'point':\r\n                        oGeoJsonData = {\r\n                            type: 'Point',\r\n                            coordinates: []\r\n                        };\r\n                        break;\r\n                    case 'linestring':\r\n                        oGeoJsonData = {\r\n                            type: 'LineString',\r\n                            coordinates: []\r\n                        };\r\n                        break;\r\n                    case 'polygon':\r\n                        oGeoJsonData = {\r\n                            type: 'Polygon',\r\n                            coordinates: [[]]\r\n                        };\r\n                        break;\r\n                }\r\n\r\n                this.options.feature = new leafLet.typeLibrary.GeoJsonFeature({\r\n                    item: {\r\n                        name: this.options.oEmpDrawEditItem.name,\r\n                        coreId: this.options.oEmpDrawEditItem.coreId,\r\n                        parentCoreId: this.options.oEmpDrawEditItem.parentCoreId,\r\n                        visible: true,\r\n                        featureId: this.options.oEmpDrawEditItem.featureId,\r\n                        overlayId: this.options.oEmpDrawEditItem.overlayId,\r\n                        parentId: this.options.oEmpDrawEditItem.parentId,\r\n                        format: emp.typeLibrary.featureFormatType.GEOJSON,\r\n                        data: oGeoJsonData,\r\n                        properties: this.options.oEmpDrawEditItem.properties\r\n                    },\r\n                    instanceInterface: this.getEngineInstanceInterface()\r\n                });\r\n                this.addLayer(this.options.feature);\r\n                this.options.bDestroyFeature = true;\r\n            }\r\n        },\r\n        preapareForEditOperation: function () {\r\n        },\r\n        getCoordinateList: function () {\r\n            return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getFeature().getData());\r\n        },\r\n        setCoordinates: function (oLatLngList) {\r\n            leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getFeature().getData(), oLatLngList);\r\n        },\r\n        _addNewCP: function () {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0) {\r\n                return;\r\n            }\r\n\r\n            switch (oFeature.getGeometryType().toLowerCase()) {\r\n                case 'point':\r\n                    break;\r\n                case 'linestring':\r\n                    for (iIndex = 1; iIndex < oCoordList.length; iIndex++) {\r\n                        // Lets add the new CP.\r\n                        oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                        oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                                leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                                oNewCoord, iIndex, 0);\r\n                        this.addControlPoint(oCP);\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    if (oCoordList.length > 2) {\r\n                        for (iIndex = 1; iIndex < oCoordList.length; iIndex++) {\r\n                            // Lets add the new CP.\r\n                            oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                                    leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                                    oNewCoord, iIndex, 0, \"\");\r\n                            this.addControlPoint(oCP);\r\n                        }\r\n\r\n                        // Lets add the new CP.\r\n                        oNewCoord = oCoordList[0].midPointTo(oCoordList[oCoordList.length - 1]);\r\n                        oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                                leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                                oNewCoord, oCoordList.length, 0);\r\n                        this.addControlPoint(oCP);\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n        assembleControlPoints: function () {\r\n            var oCP;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0) {\r\n                return;\r\n            }\r\n\r\n            switch (this.getFeature().getGeometryType().toLowerCase()) {\r\n                case 'point':\r\n                    break;\r\n                case 'linestring':\r\n                case 'polygon':\r\n                    for (iIndex = 0; iIndex < oCoordList.length; iIndex++) {\r\n                        oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                                leafLet.ControlPoint.Type.POSITION_CP,\r\n                                oCoordList[iIndex], iIndex, 0);\r\n                        this.addControlPoint(oCP);\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            this._addNewCP();\r\n        },\r\n        _createLeafletObject: function () {\r\n            var oLeafletObject;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oProperties = leafLet.utils.geoJson.mergeGeoJSONProperties(this.options.instanceInterface, this.options.oEmpDrawEditItem.properties);\r\n\r\n            switch (this.getFeature().getGeometryType().toLowerCase()) {\r\n                case 'point':\r\n\r\n                    if (oCoordList.length > 0) {\r\n                        oProperties.iconOptions.basePath = this.getEngineInstanceInterface().getBasePath();\r\n                        oProperties.icon = new leafLet.typeLibrary.EmpIcon(oProperties.iconOptions);\r\n                        oLeafletObject = new L.Marker(oCoordList[0], oProperties);\r\n                        this.setCPEvents(oLeafletObject);\r\n                    }\r\n                    break;\r\n                case 'linestring':\r\n                    if (oCoordList.length > 1) {\r\n                        oLeafletObject = new L.Polyline(oCoordList, oProperties);\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    if (oCoordList.length > 2) {\r\n                        oLeafletObject = new L.Polygon(oCoordList, oProperties);\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (oLeafletObject) {\r\n                this.setLeafletObject(oLeafletObject);\r\n            }\r\n        },\r\n        updateLeafletObject: function () {\r\n            var oLeafletObject = this.getLeafletObject();\r\n\r\n            if (oLeafletObject === undefined) {\r\n                this._createLeafletObject();\r\n            } else {\r\n                var oCoordList = this.getCoordinateList();\r\n                switch (this.getFeature().getGeometryType().toLowerCase()) {\r\n                    case 'point':\r\n                        oLeafletObject.setLatLng(oCoordList[0]);\r\n                        break;\r\n                    case 'linestring':\r\n                    case 'polygon':\r\n                        oLeafletObject.setLatLngs(oCoordList);\r\n                        break;\r\n                }\r\n                leafLet.editor.AbstractEditor.prototype.updateLeafletObject.call(this);\r\n            }\r\n        },\r\n        doAddControlPoint: function (oLatLng) {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n\r\n            switch (this.getFeature().getGeometryType().toLowerCase()) {\r\n                case 'point':\r\n                    if (oCoordList.length > 0) {\r\n                        oCoordList[0].lat = oLatLng.lat;\r\n                        oCoordList[0].lng = oLatLng.lng;\r\n                    } else {\r\n                        oCoordList.push(oLatLng);\r\n                    }\r\n                    break;\r\n                case 'linestring':\r\n                    oCP = new leafLet.editor.ControlPoint(this.getFeature(),\r\n                            leafLet.ControlPoint.Type.POSITION_CP,\r\n                            oLatLng, oCoordList.length, 0);\r\n                    oCoordList.push(oLatLng);\r\n                    break;\r\n                case 'polygon':\r\n                    oCP = new leafLet.editor.ControlPoint(this.getFeature(),\r\n                            leafLet.ControlPoint.Type.POSITION_CP,\r\n                            oLatLng, oCoordList.length, 0);\r\n                    oCoordList.push(oLatLng);\r\n                    break;\r\n            }\r\n\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this._addNewCP();\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function (oCP) {\r\n            var bRet = false;\r\n            var oCoordList = this.getCoordinateList();\r\n            var iIndex = oCP.getIndex();\r\n\r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP) {\r\n                return false;\r\n            }\r\n\r\n            switch (this.getFeature().getGeometryType().toLowerCase()) {\r\n                case 'point':\r\n                    break;\r\n                case 'linestring':\r\n                    if (oCoordList.length > 2) {\r\n                        oCoordList.splice(iIndex, 1);\r\n                        bRet = true;\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    if (oCoordList.length > 3) {\r\n                        oCoordList.splice(iIndex, 1);\r\n                        bRet = true;\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (bRet) {\r\n                this.setCoordinates(oCoordList);\r\n                this.updateLeafletObject();\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n            return bRet;\r\n        },\r\n        doControlPointMoved: function (oCP, oEvent) {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n\r\n            switch (oCP.getType()) {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position od the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    break;\r\n            }\r\n            this.updateLeafletObject();\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this._addNewCP();\r\n            return [iIndex];\r\n        },\r\n        doFeatureMove: function (dBearing, dDistance) {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oCPList = this.options.oControlPointList;\r\n            var oCoord;\r\n            var iCoordIndex;\r\n\r\n            if (this.getFeature().getGeometryType().toLowerCase() === 'point') {\r\n                oCoordList[0].moveCoordinate(dBearing, dDistance);\r\n            } else {\r\n                for (var iIndex = 0; iIndex < oCPList.length; iIndex++) {\r\n                    iCoordIndex = oCPList[iIndex].getIndex();\r\n                    oCoord = oCPList[iIndex].getPosition();\r\n                    oCoord.moveCoordinate(dBearing, dDistance);\r\n                    oCPList[iIndex].setCPPosition(oCoord);\r\n                    if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP) {\r\n                        oCoordList[iCoordIndex] = oCoord;\r\n                    }\r\n                }\r\n            }\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n            return true;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.GeoJson = leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.GeoJsonEditor());\r\n","\r\n/* global leafLet, armyc2, L, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var oOptions = {\r\n                bMultiPoint: args.multiPoint,\r\n                sBasicSymbolCode: args.basicSymbolCode,\r\n                oSymbolDef: args.SymbolDef,\r\n                oMilStdModifiers: undefined,\r\n                oCurrentCoordianteList: []\r\n            };\r\n            L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.AbstractEditor.prototype.initialize.call(this, args);\r\n        },\r\n        isMultiPoint: function()\r\n        {\r\n            return this.options.bMultiPoint;\r\n        },\r\n        getBasicSymbolCode: function()\r\n        {\r\n            return this.options.sBasicSymbolCode;\r\n        },\r\n        getSymbolDef: function()\r\n        {\r\n            return this.options.oSymbolDef;\r\n        },\r\n        preapareForDrawOperation: function()\r\n        {\r\n            if (this.getFeature() === undefined)\r\n            {\r\n                var oFeature;\r\n                var oDrawItem = this.options.oEmpDrawEditItem;\r\n                \r\n                if (this.isMultiPoint())\r\n                {\r\n                    oFeature = leafLet.utils.milstd.createTGFromDraw(\r\n                            this.getEngineInstanceInterface(),\r\n                            this.getLeafletMap(),\r\n                            this.getSymbolDef(),\r\n                            this.getBasicSymbolCode(),\r\n                            oDrawItem\r\n                    );\r\n                }\r\n                else\r\n                {\r\n                    oFeature = new leafLet.typeLibrary.MilStdFeature({\r\n                        item: {\r\n                            name: oDrawItem.name,\r\n                            coreId: oDrawItem.coreId,\r\n                            parentCoreId: oDrawItem.parentCoreId,\r\n                            visible: true,\r\n                            featureId: oDrawItem.featureId,\r\n                            overlayId: oDrawItem.overlayId,\r\n                            parentId: oDrawItem.parentId,\r\n                            format: emp.typeLibrary.featureFormatType.MILSTD,\r\n                            data: {\r\n                                symbolCode: oDrawItem.symbolCode,\r\n                                type: 'Point',\r\n                                coordinates: []\r\n                            },\r\n                            properties: emp.helpers.copyObject(oDrawItem.properties)\r\n                        },\r\n                        instanceInterface: this.getEngineInstanceInterface()\r\n                    });\r\n                }\r\n                this.setFeature(oFeature);\r\n                this.options.bDestroyFeature = true;\r\n            }\r\n            this.preapareForEditOperation();\r\n        },\r\n        preapareForEditOperation: function()\r\n        {\r\n            var oRendererUtils = armyc2.c2sd.renderer.utilities;\r\n            var oFeature = this.getFeature();\r\n            var oData = oFeature.getData();\r\n            var sSymbolCode = oData.symbolCode;\r\n            \r\n            this.options.oMilStdModifiers = oFeature.options.oMilStdModifiers;\r\n            this.options.sBasicSymbolCode = oRendererUtils.SymbolUtilities.getBasicSymbolID(sSymbolCode);\r\n            this.options.bMultiPoint = oFeature.isMultiPointTG();\r\n            this.options.oSymbolDef = oRendererUtils.SymbolDefTable.getSymbolDef(this.options.sBasicSymbolCode, oFeature.get2525Version());\r\n        },\r\n        getCoordinateList: function()\r\n        {\r\n            return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getFeature().getData());\r\n        },\r\n        setCoordinates: function(oLatLngList)\r\n        {\r\n            leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getFeature().getData(), oLatLngList);\r\n        },\r\n        updateLeafletObject: function(oCList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oCoordList = oCList || this.getCoordinateList();\r\n                    \r\n            if (!this.isMultiPoint() || (oCoordList.length >= oSymbolDef.minPoints))\r\n            {\r\n                var oFeature = this.getFeature();\r\n                var oModifiers = oFeature.getMilStdModifiers();\r\n\r\n                oFeature.getProperties()['modifiers'] = oModifiers.toLongModifiers();\r\n                var oLeafletObject = oFeature._createFeature(oFeature.options);\r\n                this.setLeafletObject(oLeafletObject);\r\n                return true;\r\n            }\r\n            \r\n            return false;\r\n        },\r\n        doFeatureMove: function(dBearing, dDistance)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oCPList = this.options.oControlPointList;\r\n            var oCoord;\r\n            var iCoordIndex;\r\n                    \r\n            for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n            {\r\n                iCoordIndex = oCPList[iIndex].getIndex();\r\n                oCoord = oCPList[iIndex].getPosition();\r\n                oCoord.moveCoordinate(dBearing, dDistance);\r\n                oCPList[iIndex].setCPPosition(oCoord);\r\n                if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP)\r\n                {\r\n                    oCoordList[iCoordIndex] = oCoord;\r\n                }\r\n            }\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n\r\n            return true;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStd = leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.MilStdEditor());\r\n","/* global leafLet, L, emp */\r\n\r\nleafLet.internalPrivateClass.AOIEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var oOptions = {\r\n                geoJsonType: (args.geoJsonType? args.geoJsonType.toLowerCase(): undefined)\r\n            };\r\n            L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.GeoJson.prototype.initialize.call(this, args);\r\n        },\r\n        preapareForEditOperation: function()\r\n        {\r\n            var oCoordList;\r\n            var dNorth;\r\n            var dSouth;\r\n            var dWest;\r\n            var dEast;\r\n            var iIndex;\r\n            \r\n            switch(this.getFeature().getAOIType())\r\n            {\r\n                case emp.typeLibrary.AOIType.POINT_RADIUS:\r\n                    break;\r\n                case emp.typeLibrary.AOIType.LINE:\r\n                    break;\r\n                case emp.typeLibrary.AOIType.POLYGON:\r\n                    break;\r\n                case emp.typeLibrary.AOIType.BBOX:\r\n                    \r\n                    // force the BBox to be a rectangle aligned with logitude and lat.\r\n                    oCoordList = this.getCoordinateList();\r\n                    dNorth = -90.0;\r\n                    dSouth = 90.0;\r\n                    dWest = 180.0;\r\n                    dEast = -180.0;\r\n\r\n                    for (iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n                    {\r\n                        if (oCoordList[iIndex].lat > dNorth)\r\n                        {\r\n                            dNorth = oCoordList[iIndex].lat;\r\n                        }\r\n                        if (oCoordList[iIndex].lat < dSouth)\r\n                        {\r\n                            dSouth = oCoordList[iIndex].lat;\r\n                        }\r\n                        if (oCoordList[iIndex].lng < dWest)\r\n                        {\r\n                            dWest = oCoordList[iIndex].lng;\r\n                        }\r\n                        if (oCoordList[iIndex].lng > dEast)\r\n                        {\r\n                            dEast = oCoordList[iIndex].lng;\r\n                        }\r\n                    }\r\n\r\n                    oCoordList[0].lat = dNorth;\r\n                    oCoordList[0].lng = dWest;\r\n                    oCoordList[1].lat = dNorth;\r\n                    oCoordList[1].lng = dEast;\r\n                    oCoordList[2].lat = dSouth;\r\n                    oCoordList[2].lng = dEast;\r\n                    oCoordList[3].lat = dSouth;\r\n                    oCoordList[3].lng = dWest;\r\n                    this.setCoordinates(oCoordList);\r\n                    break;\r\n            }\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oBufferCoord;\r\n            var oMidPointCoord;\r\n            var dBrng = 90.0;\r\n            var iIndex;\r\n            var iMostEastCoord;\r\n            var oMostEastCoord;\r\n            var oNextCoord;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            switch(this.getFeature().getAOIType())\r\n            {\r\n                case emp.typeLibrary.AOIType.POINT_RADIUS:\r\n                    oBufferCoord = oCoordList[0].destinationPoint(dBrng, oFeature.getAOIBuffer());\r\n                    oMidPointCoord = oCoordList[0];\r\n                    break;\r\n                case emp.typeLibrary.AOIType.LINE:\r\n                    leafLet.editor.GeoJson.prototype._addNewCP.call(this);\r\n                    oMidPointCoord = oCoordList[0].midPointTo(oCoordList[1]);\r\n                    dBrng = oCoordList[0].bearingTo(oCoordList[1]);\r\n                    dBrng = (dBrng + 270) % 360;\r\n                    oBufferCoord = oMidPointCoord.destinationPoint(dBrng, oFeature.getAOIBuffer());\r\n                    break;\r\n                case emp.typeLibrary.AOIType.POLYGON:\r\n                    leafLet.editor.GeoJson.prototype._addNewCP.call(this);\r\n                    iMostEastCoord = 0;\r\n                    \r\n                    // Find the coordinate furthest to the east.\r\n                    for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                    {\r\n                        if (oCoordList[iIndex].lng > oCoordList[iMostEastCoord].lng)\r\n                        {\r\n                            iMostEastCoord = iIndex;\r\n                        }\r\n                    }\r\n                    // Get the coordinates of the furthest east and it's next point.\r\n                    oMostEastCoord = oCoordList[iMostEastCoord];\r\n                    oNextCoord = oCoordList[((iMostEastCoord + 1) % oCoordList.length)];\r\n                    \r\n                    // Now find the mid point between them\r\n                    oMidPointCoord = oMostEastCoord.midPointTo(oNextCoord);\r\n                    dBrng = oMostEastCoord.bearingTo(oNextCoord);\r\n                    \r\n                    // Now rotate the bearing.\r\n                    if (leafLet.utils.dateLineInFeature(oCoordList))\r\n                    {\r\n                        // Rotate +90.\r\n                        dBrng = (dBrng + 90) % 360;\r\n                    }\r\n                    else\r\n                    {\r\n                        // Rotate -90.\r\n                        dBrng = (dBrng + 270) % 360;\r\n                    }\r\n                    oBufferCoord = oMidPointCoord.destinationPoint(dBrng, oFeature.getAOIBuffer());\r\n                    break;\r\n                case emp.typeLibrary.AOIType.BBOX:\r\n                    oMidPointCoord = oCoordList[1].midPointTo(oCoordList[2]);\r\n                    dBrng = oCoordList[1].bearingTo(oCoordList[2]);\r\n                    dBrng = (dBrng + 270) % 360;\r\n                    oBufferCoord = oMidPointCoord.destinationPoint(dBrng, oFeature.getAOIBuffer());\r\n                    break;\r\n            }\r\n            //oCP = new leafLet.editor.ControlPoint(oFeature,\r\n            //        leafLet.ControlPoint.Type.AOI_BUFFER,\r\n            //        oBufferCoord, oMidPointCoord, dBrng, oFeature.getAOIBuffer());\r\n            //this.addControlPoint(oCP);\r\n        },\r\n        removeAllCPByType: function(type)\r\n        {\r\n            leafLet.editor.GeoJson.prototype.removeAllCPByType.call(this, type);\r\n            \r\n            if (type === leafLet.ControlPoint.Type.NEW_POSITION_CP)\r\n            {\r\n                leafLet.editor.GeoJson.prototype.removeAllCPByType.call(this, leafLet.ControlPoint.Type.AOI_BUFFER);\r\n            }\r\n        },\r\n        updateLeafletObject: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            \r\n            oFeature.render();\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n\r\n            switch(this.getFeature().getAOIType())\r\n            {\r\n                case emp.typeLibrary.AOIType.BBOX:\r\n                    // Can not add points to a BBox.\r\n                    break;\r\n                default:\r\n                    oCP = leafLet.editor.GeoJson.prototype.doAddControlPoint.call(this, oLatLng);\r\n                    break;\r\n            }\r\n            \r\n            return oCP;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var aRet;\r\n            var oRefCoord;\r\n            var dAngle;\r\n            var dMouseAngle;\r\n            var dDist;\r\n            var oNewCoord;\r\n            var iCoordIndex;\r\n            var oCoordList;\r\n            var oTempCP;\r\n            var oFeature = this.getFeature();\r\n            \r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.AOI_BUFFER:\r\n                    // For AOI buufer CPs the index stores the ref point the\r\n                    // the buffer CP is angled off of.\r\n                    oRefCoord = oCP.getIndex();\r\n                    \r\n                    // The bearing is stored in the sub index.\r\n                    dAngle = oCP.getSubIndex();\r\n                    // Get the bearing from the ref point to the mouse position.\r\n                    dMouseAngle = oRefCoord.bearingTo(oEvent.latlng);\r\n                    \r\n                    // Calculate the distance of the ref point to the mouse\r\n                    // projected it in the direction of dAngleFromRef.\r\n                    dDist = oRefCoord.distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n\r\n                    oNewCoord = oRefCoord.destinationPoint(dAngle, dDist);\r\n                    oCP.setCPPosition(oNewCoord);\r\n                    oCP.setValue(dDist);\r\n                    oFeature.setAOIBufferProperty(dDist);\r\n                    \r\n                    this.updateLeafletObject();\r\n                    \r\n                    aRet = [];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    switch(oFeature.getAOIType())\r\n                    {\r\n                        case emp.typeLibrary.AOIType.POINT_RADIUS:\r\n                            break;\r\n                        case emp.typeLibrary.AOIType.LINE:\r\n                        case emp.typeLibrary.AOIType.POLYGON:\r\n                            aRet = leafLet.editor.GeoJson.prototype.doControlPointMoved.call(this, oCP, oEvent);\r\n                            break;\r\n                        case emp.typeLibrary.AOIType.BBOX:\r\n                            oCoordList = this.getCoordinateList();\r\n                            iCoordIndex = oCP.getIndex();\r\n                            oCoordList[iCoordIndex] = oEvent.latlng;\r\n                            oCP.setCPPosition(oCoordList[iCoordIndex]);\r\n                            \r\n                            switch (iCoordIndex)\r\n                            {\r\n                                case 0:\r\n                                    // The Top left was moved.\r\n                                    // So we set the long of the bottom left,\r\n                                    // and the lat of the top right.\r\n                                    oCoordList[3].lng = oCoordList[0].lng;\r\n                                    oTempCP = this.getCP(3);\r\n                                    oTempCP.setCPPosition(oCoordList[3]);\r\n                                    \r\n                                    oCoordList[1].lat = oCoordList[0].lat;\r\n                                    oTempCP = this.getCP(1);\r\n                                    oTempCP.setCPPosition(oCoordList[1]);\r\n                                    \r\n                                    aRet = [0, 1, 3];\r\n                                    break;\r\n                                case 1:\r\n                                    // The Top right was moved.\r\n                                    // So we set the long of the bottom right,\r\n                                    // and the lat of the top left.\r\n                                    oCoordList[2].lng = oCoordList[1].lng;\r\n                                    oTempCP = this.getCP(2);\r\n                                    oTempCP.setCPPosition(oCoordList[2]);\r\n                                    \r\n                                    oCoordList[0].lat = oCoordList[1].lat;\r\n                                    oTempCP = this.getCP(0);\r\n                                    oTempCP.setCPPosition(oCoordList[0]);\r\n                                    \r\n                                    aRet = [0, 1, 2];\r\n                                    break;\r\n                                case 2:\r\n                                    // The bottom right was moved.\r\n                                    // So we set the long of the top right,\r\n                                    // and the lat of the bottom left.\r\n                                    oCoordList[1].lng = oCoordList[2].lng;\r\n                                    oTempCP = this.getCP(1);\r\n                                    oTempCP.setCPPosition(oCoordList[1]);\r\n                                    \r\n                                    oCoordList[3].lat = oCoordList[2].lat;\r\n                                    oTempCP = this.getCP(3);\r\n                                    oTempCP.setCPPosition(oCoordList[3]);\r\n                                    \r\n                                    aRet = [1, 2, 3];\r\n                                    break;\r\n                                case 3:\r\n                                    // The bottom left was moved.\r\n                                    // So we set the long of the top left,\r\n                                    // and the lat of the bottom right.\r\n                                    oCoordList[0].lng = oCoordList[3].lng;\r\n                                    oTempCP = this.getCP(0);\r\n                                    oTempCP.setCPPosition(oCoordList[0]);\r\n                                    \r\n                                    oCoordList[2].lat = oCoordList[3].lat;\r\n                                    oTempCP = this.getCP(2);\r\n                                    oTempCP.setCPPosition(oCoordList[2]);\r\n                                    \r\n                                    aRet = [0, 2, 3];\r\n                                    break;\r\n                            }\r\n                            this.setCoordinates(oCoordList);\r\n                            this.updateLeafletObject();\r\n                            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                            this._addNewCP();\r\n                            break;\r\n                    }\r\n                    break;\r\n                default:\r\n                    aRet = leafLet.editor.GeoJson.prototype.doControlPointMoved.call(this, oCP, oEvent);\r\n                    break;\r\n            }\r\n            return aRet;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var bRet = false;\r\n            \r\n            switch(this.getFeature().getAOIType())\r\n            {\r\n                case emp.typeLibrary.AOIType.BBOX:\r\n                    // Can not delete points from a BBox.\r\n                    break;\r\n                default:\r\n                    bRet = leafLet.editor.GeoJson.prototype.doDeleteControlPoint.call(this, oCP);\r\n                    break;\r\n            }\r\n            return bRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AOI = leafLet.editor.GeoJson.extend(leafLet.internalPrivateClass.AOIEditor());\r\n","\r\n/* global leafLet, armyc2, L, emp */\r\n\r\nleafLet.internalPrivateClass.KMLEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            var oOptions = {\r\n            };\r\n            L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.AbstractEditor.prototype.initialize.call(this, args);\r\n        },\r\n        getCoordinateList: function()\r\n        {\r\n            return leafLet.utils.kml.convertCoordinatesToLatLng(this.getFeature().getData());\r\n        },\r\n        setCoordinates: function(oLatLngList)\r\n        {\r\n            var sKML = leafLet.utils.kml.convertLatLngListToKML(this.getFeature().getData(), oLatLngList);\r\n            this.getFeature().setData(sKML);\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oLeafletObject = this.getLeafletObject();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Polygon)\r\n            {\r\n                if (oCoordList.length > 2)\r\n                {\r\n                    for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                    {\r\n                        // Lets add the new CP.\r\n                        oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                        oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                                leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                                oNewCoord, iIndex, 0, \"\");\r\n                        this.addControlPoint(oCP);\r\n                    }\r\n\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[0].midPointTo(oCoordList[oCoordList.length - 1]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, oCoordList.length, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n            else if (oLeafletObject instanceof L.Polyline)\r\n            {\r\n                if (oCoordList.length > 1)\r\n                {\r\n                    for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                    {\r\n                        // Lets add the new CP.\r\n                        oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                        oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                                leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                                oNewCoord, iIndex, 0);\r\n                        this.addControlPoint(oCP);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oLeafletObject = this.getLeafletObject();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                // Markers have no control points.\r\n            }\r\n            else if ((oLeafletObject instanceof L.Polygon) ||\r\n                (oLeafletObject instanceof L.Polyline))\r\n            {\r\n                for (iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.POSITION_CP,\r\n                            oCoordList[iIndex], iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                if (oCoordList.length > 0)\r\n                {\r\n                    return undefined;\r\n                }\r\n            }\r\n            else if (oLeafletObject instanceof L.Polygon)\r\n            {\r\n            }\r\n            else if (oLeafletObject instanceof L.Polyline)\r\n            {\r\n            }\r\n\r\n            if (!(oLeafletObject instanceof L.Marker))\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(this.getFeature(),\r\n                        leafLet.ControlPoint.Type.POSITION_CP,\r\n                        oLatLng, oCoordList.length, 0);\r\n            }\r\n\r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this._addNewCP();\r\n            \r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var bRet = false;\r\n            var oCoordList = this.getCoordinateList();\r\n            var iIndex = oCP.getIndex();\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n\r\n            if (oLeafletObject instanceof L.Polygon)\r\n            {\r\n                if (oCoordList.length > 3)\r\n                {\r\n                    oCoordList.splice(iIndex, 1);\r\n                    bRet = true;\r\n                }\r\n            }\r\n            else if (oLeafletObject instanceof L.Polyline)\r\n            {\r\n                if (oCoordList.length > 2)\r\n                {\r\n                    oCoordList.splice(iIndex, 1);\r\n                    bRet = true;\r\n                }\r\n            }\r\n            \r\n            if (bRet)\r\n            {\r\n                this.setCoordinates(oCoordList);\r\n                this.updateLeafletObject();\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n            return bRet;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var oRet = undefined;\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n                    \r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position od the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    oRet = [iIndex];\r\n                    break;\r\n            }\r\n            this.updateLeafletObject();\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this._addNewCP();\r\n            return oRet;\r\n        },\r\n        doFeatureMove: function(dBearing, dDistance)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oCPList = this.options.oControlPointList;\r\n            var oCoord;\r\n            var iCoordIndex;\r\n            var oLeafletObject = this.getLeafletObject();\r\n\r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                oCoord = oCoordList[0];\r\n                oCoord.moveCoordinate(dBearing, dDistance);\r\n            }\r\n            else\r\n            {\r\n                for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n                {\r\n                    iCoordIndex = oCPList[iIndex].getIndex();\r\n                    oCoord = oCPList[iIndex].getPosition();\r\n                    oCoord.moveCoordinate(dBearing, dDistance);\r\n                    oCPList[iIndex].setCPPosition(oCoord);\r\n                    if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP)\r\n                    {\r\n                        oCoordList[iCoordIndex] = oCoord;\r\n                    }\r\n                }\r\n            }\r\n                    \r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n            return true;\r\n        },\r\n        updateLeafletObject: function(oCoord)\r\n        {\r\n            var oCoordList = oCoord || this.getCoordinateList();\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var oMapBounds = this.getLeafletMap().getBounds();\r\n\r\n            leafLet.utils.wrapCoordinates(oMapBounds, oCoordList, false);\r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                oLeafletObject.setLatLng(oCoordList[0]);\r\n            }\r\n            else if ((oLeafletObject instanceof L.Polygon) ||\r\n                (oLeafletObject instanceof L.Polyline))\r\n            {\r\n                oLeafletObject.setLatLngs(oCoordList);\r\n            }\r\n        },\r\n        convertToUpdateCoordinates: function(oCoordList)\r\n        {\r\n            var oUpdateCoordList = leafLet.editor.AbstractEditor.prototype.convertToUpdateCoordinates.call(this, oCoordList);\r\n            var oLeafletObject = this.getLeafletObject();\r\n            \r\n            if (oLeafletObject instanceof L.LayerGroup)\r\n            {\r\n                oLeafletObject = oLeafletObject.getLayers()[0];\r\n            }\r\n            \r\n            if (oLeafletObject instanceof L.Polygon)\r\n            {\r\n                // For polygon we need to add the first one to the end.\r\n                if (!isNaN(oCoordList[0].alt))\r\n                {\r\n                    oUpdateCoordList.push({\r\n                        lat: oCoordList[0].lat,\r\n                        lon: oCoordList[0].lng,\r\n                        alt: oCoordList[0].alt\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    oUpdateCoordList.push({\r\n                        lat: oCoordList[0].lat,\r\n                        lon: oCoordList[0].lng\r\n                    });\r\n                }\r\n            }\r\n            \r\n            return oUpdateCoordList;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.KML = leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.KMLEditor());\r\n","\r\n/* global leafLet, armyc2, L, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args)\r\n        {\r\n            var oOptions = {\r\n            };\r\n            L.Util.setOptions(this, oOptions);\r\n\r\n            leafLet.editor.AbstractEditor.prototype.initialize.call(this, args);\r\n        },\r\n        preapareForDrawOperation: function()\r\n        {\r\n            if (this.getFeature() === undefined)\r\n            {\r\n                var oGeoJsonData;\r\n                var cAirspaceType = emp.typeLibrary.airspaceSymbolCode;\r\n\r\n                switch (this.options.oEmpDrawEditItem.symbolCode)\r\n                {\r\n                    case cAirspaceType.SHAPE3D_CYLINDER:\r\n                    case cAirspaceType.SHAPE3D_RADARC:\r\n                        oGeoJsonData = {\r\n                            symbolCode: this.options.oEmpDrawEditItem.symbolCode,\r\n                            type: 'Point',\r\n                            coordinates: []\r\n                        };\r\n                        break;\r\n                    //case cAirspaceType.SHAPE3D_POLYGON:\r\n                    //case cAirspaceType.SHAPE3D_ORBIT:\r\n                    //case cAirspaceType.SHAPE3D_ROUTE:\r\n                    //case cAirspaceType.SHAPE3D_TRACK:\r\n                    //case cAirspaceType.SHAPE3D_POLYARC:\r\n                    //case cAirspaceType.SHAPE3D_CURTAIN:\r\n                    default:\r\n                        oGeoJsonData = {\r\n                            symbolCode: this.options.oEmpDrawEditItem.symbolCode,\r\n                            type: 'LineString',\r\n                            coordinates: []\r\n                        };\r\n                        break;\r\n                }\r\n\r\n                this.options.feature = leafLet.utils.airspace.createAirspace({\r\n                    item: {\r\n                        name: this.options.oEmpDrawEditItem.name,\r\n                        coreId: this.options.oEmpDrawEditItem.coreId,\r\n                        parentCoreId: this.options.oEmpDrawEditItem.parentCoreId,\r\n                        visible: true,\r\n                        featureId: this.options.oEmpDrawEditItem.featureId,\r\n                        overlayId: this.options.oEmpDrawEditItem.overlayId,\r\n                        parentId: this.options.oEmpDrawEditItem.parentId,\r\n                        format: emp3.api.enums.FeatureTypeEnum.GEO_ACM,\r\n                        data: oGeoJsonData,\r\n                        properties: this.options.oEmpDrawEditItem.properties\r\n                    },\r\n                    instanceInterface: this.getEngineInstanceInterface()\r\n                });\r\n                this.addLayer(this.options.feature);\r\n                this.options.bDestroyFeature = true;\r\n            }\r\n            this.preapareForEditOperation();\r\n        },\r\n        preapareForEditOperation: function()\r\n        {\r\n        },\r\n        getCoordinateList: function()\r\n        {\r\n            return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getFeature().getData());\r\n        },\r\n        setCoordinates: function(oLatLngList)\r\n        {\r\n            leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getFeature().getData(), oLatLngList);\r\n        },\r\n        updateLeafletObject: function(oCList)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = oCList || this.getCoordinateList();\r\n\r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                var oLeafletObject;\r\n                var cAirspaceType = emp.typeLibrary.airspaceSymbolCode;\r\n                var oAttributeList = oFeature.getAttributeList();\r\n\r\n                oFeature.getProperties()['attributes'] = oAttributeList.getAirspaceAttributeList();\r\n\r\n                switch (this.options.oEmpDrawEditItem.symbolCode)\r\n                {\r\n                    case cAirspaceType.SHAPE3D_CURTAIN:\r\n                    case cAirspaceType.SHAPE3D_POLYGON:\r\n                        var oMapBounds = this.getLeafletMap().getBounds();\r\n\r\n                        leafLet.utils.wrapCoordinates(oMapBounds, oCoordList, false);\r\n                        oLeafletObject = this.getLeafletObject();\r\n                        oLeafletObject.setLatLngs(oCoordList);\r\n                        break;\r\n                    case cAirspaceType.SHAPE3D_CYLINDER:\r\n                    case cAirspaceType.SHAPE3D_ORBIT:\r\n                    case cAirspaceType.SHAPE3D_ROUTE:\r\n                    case cAirspaceType.SHAPE3D_TRACK:\r\n                    case cAirspaceType.SHAPE3D_RADARC:\r\n                    case cAirspaceType.SHAPE3D_POLYARC:\r\n                    default:\r\n                        oLeafletObject = oFeature._createFeature(oFeature.options);\r\n                        this.setLeafletObject(oLeafletObject);\r\n                        break;\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        doFeatureMove: function(dBearing, dDistance)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oCPList = this.options.oControlPointList;\r\n            var oCoord;\r\n            var iCoordIndex;\r\n\r\n            for (var iIndex = 0; iIndex < oCPList.length; iIndex++)\r\n            {\r\n                iCoordIndex = oCPList[iIndex].getIndex();\r\n                oCoord = oCPList[iIndex].getPosition();\r\n                oCoord.moveCoordinate(dBearing, dDistance);\r\n                oCPList[iIndex].setCPPosition(oCoord);\r\n                if (oCPList[iIndex].getType() === leafLet.ControlPoint.Type.POSITION_CP)\r\n                {\r\n                    oCoordList[iCoordIndex] = oCoord;\r\n                }\r\n            }\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n\r\n            return true;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.Airspace = leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.AirspaceEditor());\r\n","\r\n/* global L, leafLet */\r\n\r\nleafLet.internalPrivateClass.MilStdDCAutoShapeEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) {\r\n            var oCoordList;\r\n            var dDistC1, dDistC2, dDistC3;\r\n            var Temp;\r\n            var oBasicCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n            \r\n            switch (this.getBasicSymbolCode()) {\r\n                case oBasicCodes.MINIMUM_SAFE_DISTANCE_ZONES:\r\n                    // The distance between the center (pt0) and\r\n                    // Pt1 must be less than the distance to pt2 and this\r\n                    // less than the distance to pt3.\r\n                    oCoordList = this.getCoordinateList();\r\n                    dDistC1 = oCoordList[0].distanceTo(oCoordList[1]);\r\n                    dDistC2 = oCoordList[0].distanceTo(oCoordList[2]);\r\n                    dDistC3 = oCoordList[0].distanceTo(oCoordList[3]);\r\n                    if (dDistC1 > dDistC2) {\r\n                        Temp = oCoordList[1];\r\n                        oCoordList[1] = oCoordList[2];\r\n                        oCoordList[2] = Temp;\r\n                        Temp = dDistC2;\r\n                        dDistC2 = dDistC1;\r\n                        dDistC1 = Temp;\r\n                    }\r\n                    if (dDistC2 > dDistC3) {\r\n                        Temp = oCoordList[2];\r\n                        oCoordList[2] = oCoordList[3];\r\n                        oCoordList[3] = Temp;\r\n                        Temp = dDistC3;\r\n                        dDistC3 = dDistC2;\r\n                        dDistC2 = Temp;\r\n                    }\r\n                    if (dDistC1 > dDistC2) {\r\n                        Temp = oCoordList[1];\r\n                        oCoordList[1] = oCoordList[2];\r\n                        oCoordList[2] = Temp;\r\n                        Temp = dDistC2;\r\n                        dDistC2 = dDistC1;\r\n                        dDistC1 = Temp;\r\n                    }\r\n\r\n                    break;\r\n            }\r\n        },\r\n        assembleControlPoints: function() {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oSymbolDef = this.getSymbolDef();\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            this.updateLeafletObject(oCoordList);\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var oCPPt2, oCPt;\r\n            var dBearing;\r\n            var dDist;\r\n            var iIndex2;\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oRet = undefined;\r\n            var oBasicCodes = leafLet.utils.milstd.basicSymbolCode;\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points before and after it.\r\n                    oRet = [];\r\n                    \r\n                    switch (this.getBasicSymbolCode()) {\r\n                        case oBasicCodes.MINIMUM_SAFE_DISTANCE_ZONES:\r\n                            if (iIndex === 0) {\r\n                                // Its the center point.\r\n                                // We must move all points.\r\n                                dBearing = oCoordList[0].bearingTo(oEvent.latlng);\r\n                                dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                                for (iIndex2 = 0; iIndex2 < oCoordList.length; iIndex2++) {\r\n                                    oRet.push(iIndex2);\r\n                                    oCoordList[iIndex2].moveCoordinate(dBearing, dDist);\r\n                                    oCPt = this.getCP(iIndex2);\r\n                                    oCPt.setCPPosition(oCoordList[iIndex2]);\r\n                                }\r\n                            } else if (iIndex === 1) {\r\n                                // Its pt1. We need to make sure that it does not go beyond pt2.\r\n                                dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                                if (dDist < oCoordList[0].distanceTo(oCoordList[2])) {\r\n                                    oRet.push(iIndex);\r\n                                    oCoordList[iIndex] = oEvent.latlng;\r\n                                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                                }\r\n                            } else if (iIndex === 2) {\r\n                                // Its pt2. We need to make sure that it does not go beyond pt3 or\r\n                                // less the pt1.\r\n                                dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                                if ((dDist < oCoordList[0].distanceTo(oCoordList[3])) &&\r\n                                        (dDist > oCoordList[0].distanceTo(oCoordList[1]))) {\r\n                                    oRet.push(iIndex);\r\n                                    dBearing = oCoordList[0].bearingTo(oEvent.latlng);\r\n                                    oCoordList[iIndex] = oEvent.latlng;\r\n                                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                                }\r\n                            } else {\r\n                                // Its pt3. We need to make sure that it does not go less than pt2.\r\n                                dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                                if (dDist > oCoordList[0].distanceTo(oCoordList[2])) {\r\n                                    oRet.push(iIndex);\r\n                                    dBearing = oCoordList[0].bearingTo(oEvent.latlng);\r\n                                    oCoordList[iIndex] = oEvent.latlng;\r\n                                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                                }\r\n                            }\r\n                            break;\r\n                        default:\r\n                            oRet.push(iIndex);\r\n                            if ((iIndex === 0) && (oCoordList.length === 2))\r\n                            {\r\n                                // If Pt1 is moved we need to move Pt2 relative to Pt1.\r\n                                oCPPt2 = this.getCP(1);\r\n                                dBearing = oCoordList[0].bearingTo(oEvent.latlng);\r\n                                dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                                // Now move Pt1\r\n                                oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                                oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                                // And now move Pt2 relative to Pt1\r\n                                oCoordList[1].moveCoordinate(dBearing, dDist);\r\n                                oCPPt2.setCPPosition(oCoordList[1]);\r\n                                oRet.push(1);\r\n                            }\r\n                            else\r\n                            {\r\n                                oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                                oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                            }\r\n\r\n                            oCP.setCPPosition(oCoordList[iIndex]);\r\n                            break;\r\n                    }\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCAutoShape = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCAutoShapeEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdDCCircularAutoShapeEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        _addRadiusCP: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRange;\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                if (oModifiers.getAMValueCount() > 0)\r\n                {\r\n                    dRange = oModifiers.getAMValue(0);\r\n\r\n                    // Place the Range CP.\r\n                    oCPPosition = oCoordList[0].destinationPoint(90, dRange);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.RADIUS_CP,\r\n                        oCPPosition, 0, 90, dRange);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oCoordList[0], 0, 0);\r\n                \r\n            this.addControlPoint(oCP);\r\n            \r\n            this._addRadiusCP(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            //var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addRadiusCP(oCoordList);\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var dMouseAngle;\r\n            var dAngle;\r\n            var dNextRange = Number.MAX_VALUE;\r\n            var dDist;\r\n            var oCPPos;\r\n            var dPrevRange = 0;\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var iCPIndex = oCP.getIndex();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length < oSymbolDef.minPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[0].lat = oEvent.latlng.lat;\r\n                    oCoordList[0].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[0]);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this._addRadiusCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RADIUS_CP:\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    oModifiers.setAMValue(iCPIndex, dDist);\r\n                    oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dDist);\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCCircularAutoShape = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCCircularAutoShapeEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdDCCircularRangeFanEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        _addRangeCPs: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRange;\r\n            var iANIndex = 0;\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                for (var iIndex = 0; iIndex < oAMList.length; iIndex++)\r\n                {\r\n                    dRange = oAMList[iIndex];\r\n\r\n                    // Place the Range CP.\r\n                    oCPPosition = oCoordList[0].destinationPoint(0, dRange);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.RANGE_CP,\r\n                        oCPPosition, iIndex, 0, dRange);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oCoordList[0], 0, 0);\r\n                \r\n            this.addControlPoint(oCP);\r\n            \r\n            this._addRangeCPs(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                // With these we add new ranges.\r\n                var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n                var dDist = oCoordList[0].distanceTo(oLatLng);\r\n                var iIndex;\r\n                var iAMCnt = oModifiers.getAMValueCount();\r\n\r\n                if (iAMCnt === 3)\r\n                {\r\n                    return undefined;\r\n                }\r\n                \r\n                for (iIndex = 0; iIndex < iAMCnt; iIndex++)\r\n                {\r\n                    if (dDist < oModifiers.getAMValue(iIndex))\r\n                    {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                oAMList.splice(iIndex, 0, dDist);\r\n                \r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                this.updateLeafletObject(oCoordList);\r\n                this._addRangeCPs(oCoordList);\r\n                this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addRangeCPs(oCoordList);\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP) {\r\n/*\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n            var iIndex = oCP.getIndex();\r\n            \r\n            // We only delete range CPs and azimuth that create a minimum range.\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.RANGE_CP:\r\n                    if (oAMList.length > 1)\r\n                    {\r\n                        oAMList.splice(iIndex, 1);\r\n                        \r\n                        this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                        this.updateLeafletObject(oCoordList);\r\n                        this._addRangeCPs(oCoordList);\r\n                        this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    }\r\n                    break;\r\n            }\r\n            return false;\r\n*/\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var dMouseAngle;\r\n            var dAngle;\r\n            var dNextRange = Number.MAX_VALUE;\r\n            var dDist;\r\n            var oCPPos;\r\n            var dPrevRange = 0;\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var iCPIndex = oCP.getIndex();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length < oSymbolDef.minPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[0].lat = oEvent.latlng.lat;\r\n                    oCoordList[0].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[0]);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                    this._addRangeCPs(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RANGE_CP:\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    // Get the previous range\r\n                    if (iCPIndex > 0)\r\n                    {\r\n                        dPrevRange = oModifiers.getAMValue(iCPIndex - 1);\r\n                    }\r\n                    \r\n                    // Get the next range\r\n                    if ((iCPIndex + 1) < oModifiers.getAMValueCount())\r\n                    {\r\n                        dNextRange = oModifiers.getAMValue(iCPIndex + 1);\r\n                    }\r\n                    \r\n                    if ((dPrevRange < dDist) && (dDist < dNextRange))\r\n                    {\r\n                        oModifiers.setAMValue(iCPIndex, dDist);\r\n                        oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                        oCP.setCPPosition(oCPPos);\r\n                        oCP.setValue(dDist);\r\n                        \r\n                        this.setCoordinates(oCoordList);\r\n                        this.updateLeafletObject(oCoordList);\r\n                        this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    }\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCCircularRangeFan = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCCircularRangeFanEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdDCLineEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        preapareForDrawOperation: function()\r\n        {\r\n            if (this.getFeature() === undefined)\r\n            {\r\n                var oGeoJsonData = {\r\n                    symbolCode: this.options.oEmpDrawEditItem.symbolCode,\r\n                    type: 'LineString',\r\n                    coordinates: []\r\n                };\r\n\r\n                this.options.feature = new leafLet.typeLibrary.MilStdFeature({\r\n                    item: {\r\n                        name: this.options.oEmpDrawEditItem.name,\r\n                        coreId: this.options.oEmpDrawEditItem.coreId,\r\n                        parentCoreId: this.options.oEmpDrawEditItem.parentCoreId,\r\n                        privateInterface: this.options.instanceInterface,\r\n                        visible: true,\r\n                        featureId: this.options.oEmpDrawEditItem.featureId,\r\n                        overlayId: this.options.oEmpDrawEditItem.overlayId,\r\n                        parentId: this.options.oEmpDrawEditItem.parentId,\r\n                        format: emp.typeLibrary.featureFormatType.MILSTD,\r\n                        data: oGeoJsonData,\r\n                        properties: this.options.oEmpDrawEditItem.properties\r\n                    },\r\n                    instanceInterface: this.options.instanceInterface\r\n                });\r\n                this.addLayer(this.options.feature);\r\n                this.options.bDestroyFeature = true;\r\n            }\r\n            this.preapareForEditOperation();\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length > 2)\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            //var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length <= oSymbolDef.minPoints)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this.updateLeafletObject(oCoordList);\r\n            this._addNewCP();\r\n            \r\n            return true;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCLine = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCLineEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdDCPolygonEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        preapareForDrawOperation: function()\r\n        {\r\n            if (this.getFeature() === undefined)\r\n            {\r\n                var oGeoJsonData = {\r\n                    symbolCode: this.options.oEmpDrawEditItem.symbolCode,\r\n                    type: 'LineString',\r\n                    coordinates: []\r\n                };\r\n\r\n                this.options.feature = new leafLet.typeLibrary.MilStdFeature({\r\n                    item: {\r\n                        name: this.options.oEmpDrawEditItem.name,\r\n                        coreId: this.options.oEmpDrawEditItem.coreId,\r\n                        parentCoreId: this.options.oEmpDrawEditItem.parentCoreId,\r\n                        visible: true,\r\n                        featureId: this.options.oEmpDrawEditItem.featureId,\r\n                        overlayId: this.options.oEmpDrawEditItem.overlayId,\r\n                        parentId: this.options.oEmpDrawEditItem.parentId,\r\n                        format: emp.typeLibrary.featureFormatType.MILSTD,\r\n                        data: oGeoJsonData,\r\n                        properties: this.options.oEmpDrawEditItem.properties\r\n                    },\r\n                    instanceInterface: this.options.instanceInterface\r\n                });\r\n                this.addLayer(this.options.feature);\r\n                this.options.bDestroyFeature = true;\r\n            }\r\n            this.preapareForEditOperation();\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length > 2)\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n\r\n                // Lets add the new CP.\r\n                oNewCoord = oCoordList[0].midPointTo(oCoordList[oCoordList.length - 1]);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                        oNewCoord, oCoordList.length, 0);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length <= oSymbolDef.minPoints)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this.updateLeafletObject();\r\n            this._addNewCP();\r\n            \r\n            return true;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    return undefined;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCPolygon = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCPolygonEditor());\r\n","\r\n/* global L, leafLet */\r\n\r\nleafLet.internalPrivateClass.MilStdDCRectParamAutoShapeEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        _addWidthCP: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                var oWidthPoint;\r\n                var oFeature = this.getFeature();\r\n                var oModifiers = oFeature.getMilStdModifiers();\r\n                var dWidth = oModifiers.getAMValue(1);\r\n                var dAngle = (oModifiers.getANValue(0) + 0) % 360;\r\n\r\n                oWidthPoint = oCoordList[0].destinationPoint(dAngle, dWidth / 2.0);\r\n                \r\n                var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.WIDTH_CP,\r\n                    oWidthPoint, 0, 0, dWidth);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        _addLengthCP: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                var oLengthPoint;\r\n                var oFeature = this.getFeature();\r\n                var oModifiers = oFeature.getMilStdModifiers();\r\n                var dLength = oModifiers.getAMValue(0);\r\n                var dAngle = (oModifiers.getANValue(0) + 90) % 360;\r\n\r\n                oLengthPoint = oCoordList[0].destinationPoint(dAngle, dLength / 2.0);\r\n                \r\n                var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.LENGTH_CP,\r\n                    oLengthPoint, 0, 0, dLength);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        _addAttitudeCP: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                var oAttitudePoint;\r\n                var oFeature = this.getFeature();\r\n                var oModifiers = oFeature.getMilStdModifiers();\r\n                var dWidth = Math.round(oModifiers.getAMValue(0) / 2.0);\r\n                var dAngle = oModifiers.getANValue(0);\r\n                oAttitudePoint = oCoordList[0].destinationPoint((dAngle + 270) % 360, dWidth);\r\n                \r\n                var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.ATTITUDE_CP,\r\n                    oAttitudePoint, 0, 0, dAngle);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oCoordList[0], 0, 0);\r\n                \r\n            this.addControlPoint(oCP);\r\n            \r\n            this._addWidthCP(oCoordList);\r\n            this._addLengthCP(oCoordList);\r\n            this._addAttitudeCP(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addWidthCP(oCoordList);\r\n                this._addLengthCP(oCoordList);\r\n                this._addAttitudeCP(oCoordList);\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var oWidthPoint;\r\n            var dWidth;\r\n            var dAngle;\r\n            var dMouseAngle;\r\n            var oAttitudePoint;\r\n            var oLengthPoint;\r\n            var dLength;\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length < oSymbolDef.minPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[0].lat = oEvent.latlng.lat;\r\n                    oCoordList[0].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[0]);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LENGTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.ATTITUDE_CP);\r\n                    this._addWidthCP(oCoordList);\r\n                    this._addLengthCP(oCoordList);\r\n                    this._addAttitudeCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.WIDTH_CP:\r\n                    dAngle = (oModifiers.getANValue(0) + 0) % 360;\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dWidth = oCoordList[0].distanceTo(oEvent.latlng) * 2;\r\n                    dWidth = Math.abs(Math.round(dWidth * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    oWidthPoint = oCoordList[0].destinationPoint(dAngle, dWidth / 2.0);\r\n                    oModifiers.setAMValue(1, dWidth);\r\n                    oCP.setValue(dWidth);\r\n                    oCP.setCPPosition(oWidthPoint);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.LENGTH_CP:\r\n                    dAngle = (oModifiers.getANValue(0) + 90) % 360;\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dLength = oCoordList[0].distanceTo(oEvent.latlng) * 2;\r\n                    dLength = Math.abs(Math.round(dLength * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    oLengthPoint = oCoordList[0].destinationPoint(dAngle, dLength / 2.0);\r\n                    oModifiers.setAMValue(0, dLength);\r\n                    oCP.setValue(dLength);\r\n                    oCP.setCPPosition(oLengthPoint);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.ATTITUDE_CP);\r\n                    this._addAttitudeCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.ATTITUDE_CP:\r\n                    dLength = oModifiers.getAMValue(0) / 2.0;\r\n                    dAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    oAttitudePoint = oCoordList[0].destinationPoint(dAngle, dLength);\r\n                    dAngle = (dAngle + 90) % 360;\r\n                    oModifiers.setANValue(0, dAngle);\r\n                    oCP.setValue(dAngle);\r\n                    oCP.setCPPosition(oAttitudePoint);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LENGTH_CP);\r\n                    this._addWidthCP(oCoordList);\r\n                    this._addLengthCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCRectParamAutoShape = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCRectParamAutoShapeEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdDCRouteEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        preapareForDrawOperation: function()\r\n        {\r\n            if (this.getFeature() === undefined)\r\n            {\r\n                var oGeoJsonData = {\r\n                    symbolCode: this.options.oEmpDrawEditItem.symbolCode,\r\n                    type: 'LineString',\r\n                    coordinates: []\r\n                };\r\n\r\n                this.options.feature = new leafLet.typeLibrary.MilStdFeature({\r\n                    item: {\r\n                        name: this.options.oEmpDrawEditItem.name,\r\n                        coreId: this.options.oEmpDrawEditItem.coreId,\r\n                        parentCoreId: this.options.oEmpDrawEditItem.parentCoreId,\r\n                        visible: true,\r\n                        featureId: this.options.oEmpDrawEditItem.featureId,\r\n                        overlayId: this.options.oEmpDrawEditItem.overlayId,\r\n                        parentId: this.options.oEmpDrawEditItem.parentId,\r\n                        format: emp.typeLibrary.featureFormatType.MILSTD,\r\n                        data: oGeoJsonData,\r\n                        properties: this.options.oEmpDrawEditItem.properties\r\n                    },\r\n                    instanceInterface: this.options.instanceInterface\r\n                });\r\n                this.addLayer(this.options.feature);\r\n                this.options.bDestroyFeature = true;\r\n            }\r\n            this.preapareForEditOperation();\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length < 3)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            for (iIndex = 1; iIndex < oCoordList.length - 1; iIndex++)\r\n            {\r\n                // Lets add the new CP.\r\n                oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                        oNewCoord, iIndex, 0);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length < oSymbolDef.minPoints)\r\n            {\r\n                iIndex = oCoordList.length;\r\n                oCoordList.push(oLatLng);\r\n            }\r\n            else\r\n            {\r\n                // The last point must remain the last.\r\n                iIndex = oCoordList.length - 1;\r\n                oCoordList.splice(iIndex, 0, oLatLng);\r\n            }\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, iIndex, 0);\r\n                \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length <= oSymbolDef.minPoints)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (iIndex === oCoordList.length - 1)\r\n            {\r\n                // The last point can not be deleted.\r\n                return false;\r\n            }\r\n            \r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject(oCoordList);\r\n            this._addNewCP();\r\n            \r\n            return true;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    return undefined;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCRoute = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCRouteEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.MilStdDCSectorParamAutoShapeEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        _addRangeCPs: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n            var oANList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH];\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRange;\r\n            var iANIndex = 0;\r\n            var bMinimumRange = false;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            var dMidAzimuth;\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                if ((oAMList.length * 2) > oANList.length)\r\n                {\r\n                    // There is a minimum range.\r\n                    bMinimumRange = true;\r\n                }\r\n                \r\n                for (var iIndex = 0; (iIndex < oAMList.length) && (iANIndex < oANList.length); iIndex++)\r\n                {\r\n                    dRange = oAMList[iIndex];\r\n                    dLeftAzimuth = oANList[iANIndex];\r\n                    dRightAzimuth = oANList[iANIndex + 1];\r\n\r\n                    // Place the Range CP.\r\n                    dMidAzimuth = (dLeftAzimuth + dRightAzimuth) / 2.0;\r\n                    \r\n                    if (dLeftAzimuth > dRightAzimuth)\r\n                    {\r\n                        dMidAzimuth = (dMidAzimuth + 180) % 360;\r\n                    }\r\n                    \r\n                    oCPPosition = oCoordList[0].destinationPoint(dMidAzimuth, dRange);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.RANGE_CP,\r\n                        oCPPosition, iIndex, dMidAzimuth, dRange);\r\n                    this.addControlPoint(oCP);\r\n\r\n                    // See if there are azimuth CP in this range.\r\n                    if (!bMinimumRange || (iIndex !== 0))\r\n                    {\r\n                        // There are no azimuth CP in minimum range.\r\n                        iANIndex += 2;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _addAzimuthCPs: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n            var oANList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH];\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRange;\r\n            var dPrevRange = 0;\r\n            var dAzimuthCPDist;\r\n            var iANIndex = 0;\r\n            var bMinimumRange = false;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                if ((oAMList.length * 2) > oANList.length)\r\n                {\r\n                    // There is a minimum range.\r\n                    bMinimumRange = true;\r\n                }\r\n                \r\n                for (var iIndex = 0; (iIndex < oAMList.length) && (iANIndex < oANList.length); iIndex++)\r\n                {\r\n                    dRange = oAMList[iIndex];\r\n                    dLeftAzimuth = oANList[iANIndex];\r\n                    dRightAzimuth = oANList[iANIndex + 1];\r\n\r\n                    // See if there are azimuth CP in this range.\r\n                    if (bMinimumRange && (iIndex === 0))\r\n                    {\r\n                        // There are no azimuth CP in minimum range.\r\n                        dPrevRange = dRange;\r\n                        continue;\r\n                    }\r\n\r\n                    dAzimuthCPDist = ((dRange - dPrevRange) / 2.0) + dPrevRange;\r\n\r\n                    // Place The left Azimuth point.\r\n                    oCPPosition = oCoordList[0].destinationPoint(dLeftAzimuth, dAzimuthCPDist);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.AZIMUTH_CP,\r\n                        oCPPosition, iANIndex, dAzimuthCPDist, dLeftAzimuth);\r\n                    this.addControlPoint(oCP);\r\n\r\n\r\n                    // Place The right Azimuth point.\r\n                    oCPPosition = oCoordList[0].destinationPoint(dRightAzimuth, dAzimuthCPDist);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.AZIMUTH_CP,\r\n                        oCPPosition, iANIndex + 1, dAzimuthCPDist, dRightAzimuth);\r\n                    this.addControlPoint(oCP);\r\n                    \r\n                    iANIndex += 2;\r\n                    dPrevRange = dRange;\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oCoordList[0], 0, 0);\r\n                \r\n            this.addControlPoint(oCP);\r\n            \r\n            this._addRangeCPs(oCoordList);\r\n            this._addAzimuthCPs(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var iAzimuthIndex;\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                // With these we add new ranges.\r\n                var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n                var oANList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH];\r\n                var dDist = oCoordList[0].distanceTo(oLatLng);\r\n                var iIndex;\r\n                var iAMCnt = oModifiers.getAMValueCount();\r\n                var dLeftAzimuth;\r\n                var dRightAzimuth;\r\n                var bMinimumRange = false;\r\n\r\n                if ((oAMList.length * 2) > oANList.length)\r\n                {\r\n                    // There is a minimum range.\r\n                    bMinimumRange = true;\r\n                }\r\n\r\n                for (iIndex = 0; iIndex < iAMCnt; iIndex++)\r\n                {\r\n                    if (dDist < oModifiers.getAMValue(iIndex))\r\n                    {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                iAzimuthIndex = 0;\r\n\r\n                oAMList.splice(iIndex, 0, dDist);\r\n                dLeftAzimuth = oModifiers.getANValue(iAzimuthIndex);\r\n                dRightAzimuth = oModifiers.getANValue(iAzimuthIndex + 1);\r\n                \r\n                if ((iAzimuthIndex + 2) < oModifiers.getANValueCount())\r\n                {\r\n                    iAzimuthIndex += 2;\r\n                }\r\n                \r\n                oANList.splice(iAzimuthIndex, 0, dLeftAzimuth);\r\n                oANList.splice(iAzimuthIndex + 1, 0, dRightAzimuth);\r\n                \r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP);\r\n                this.updateLeafletObject(oCoordList);\r\n                this._addRangeCPs(oCoordList);\r\n                this._addAzimuthCPs(oCoordList);\r\n                this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addRangeCPs(oCoordList);\r\n                this._addAzimuthCPs(oCoordList);\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var oAMList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];\r\n            var oANList = oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH];\r\n            var iIndex = oCP.getIndex();\r\n            var bMinimumRange = false;\r\n            var iAzimuthIndex;\r\n            \r\n            if ((oAMList.length * 2) > oANList.length)\r\n            {\r\n                // There is a minimum range.\r\n                bMinimumRange = true;\r\n            }\r\n                \r\n            // We only delete range CPs and azimuth that create a minimum range.\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.RANGE_CP:\r\n                    if (oAMList.length > 1)\r\n                    {\r\n                        oAMList.splice(iIndex, 1);\r\n                        \r\n                        if (!bMinimumRange)\r\n                        {\r\n                            // Remove the azimuth for the range.\r\n                            iAzimuthIndex = iIndex * 2;\r\n                            oANList.splice(iAzimuthIndex, 1);\r\n                            oANList.splice(iAzimuthIndex, 1);\r\n                        }\r\n                        else if ((iIndex !== 0) && (oANList.length > 2))\r\n                        {\r\n                            iAzimuthIndex = (iIndex - 1) * 2;\r\n                            oANList.splice(iAzimuthIndex, 1);\r\n                            oANList.splice(iAzimuthIndex, 1);\r\n                        }\r\n                        \r\n                        this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                        this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP);\r\n                        this.updateLeafletObject(oCoordList);\r\n                        this._addRangeCPs(oCoordList);\r\n                        this._addAzimuthCPs(oCoordList);\r\n                        this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    }\r\n                    break;\r\n                case leafLet.ControlPoint.Type.AZIMUTH_CP:\r\n                    if ((oANList.length > 2) && !bMinimumRange)\r\n                    {\r\n                        // We can only delete the first two azimuth if there are more azimuth\r\n                        // and the feature does not have a minimum range.\r\n                        if (iIndex < 2)\r\n                        {\r\n                            oANList.splice(0, 1);\r\n                            oANList.splice(0, 1);\r\n                            this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                            this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP);\r\n                            this.updateLeafletObject(oCoordList);\r\n                            this._addRangeCPs(oCoordList);\r\n                            this._addAzimuthCPs(oCoordList);\r\n                            this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                        }\r\n                    }\r\n                    break;\r\n            }\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var dMouseAngle;\r\n            var dAngle;\r\n            var dNextRange = Number.MAX_VALUE;\r\n            var dDist;\r\n            var oCPPos;\r\n            var dPrevRange = 0;\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var oModifiers = oFeature.getMilStdModifiers();\r\n            var iCPIndex = oCP.getIndex();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length < oSymbolDef.minPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[0].lat = oEvent.latlng.lat;\r\n                    oCoordList[0].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[0]);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP);\r\n                    this._addRangeCPs(oCoordList);\r\n                    this._addAzimuthCPs(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RANGE_CP:\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    // Get the previous range\r\n                    if (iCPIndex > 0)\r\n                    {\r\n                        dPrevRange = oModifiers.getAMValue(iCPIndex - 1);\r\n                    }\r\n                    \r\n                    // Get the next range\r\n                    if ((iCPIndex + 1) < oModifiers.getAMValueCount())\r\n                    {\r\n                        dNextRange = oModifiers.getAMValue(iCPIndex + 1);\r\n                    }\r\n                    \r\n                    if ((dPrevRange < dDist) && (dDist < dNextRange))\r\n                    {\r\n                        oModifiers.setAMValue(iCPIndex, dDist);\r\n                        oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                        oCP.setCPPosition(oCPPos);\r\n                        oCP.setValue(dDist);\r\n                        \r\n                        this.setCoordinates(oCoordList);\r\n                        this.updateLeafletObject(oCoordList);\r\n                        this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP);\r\n                        this._addAzimuthCPs(oCoordList);\r\n                        oRet = [0];\r\n                    }\r\n                    break;\r\n                case leafLet.ControlPoint.Type.AZIMUTH_CP:\r\n                    dDist = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    oCPPos = oCoordList[0].destinationPoint(dMouseAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dMouseAngle);\r\n                    oModifiers.setANValue(iCPIndex, dMouseAngle);\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP);\r\n                    this._addRangeCPs(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCSectorParamAutoShape = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCSectorParamAutoShapeEditor());\r\n","\r\n/* global L, leafLet, armyc2, Infinity */\r\n\r\nleafLet.internalPrivateClass.MilStdDCSuperAutoShapeEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        _createWidthCP: function(oCoordList)\r\n        {\r\n            var oCP;\r\n            var oFeature = this.getFeature();\r\n            var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n            var dBearingPt1Pt2 = oCoordList[0].bearingTo(oCoordList[1]);\r\n            var dBearingWLine = (dBearingPt1Pt2 + 270.0) % 360;\r\n            var oIntPoint = oCoordList[0].intersectLines(dBearingPt1Pt2, oCoordList[2], dBearingWLine);\r\n\r\n            if (!oIntPoint)\r\n            {\r\n                dBearingWLine = (dBearingWLine + 180.0) % 360;\r\n                oIntPoint = oCoordList[0].intersectLines(dBearingPt1Pt2, oCoordList[2], dBearingWLine);\r\n            }\r\n            if (!oIntPoint)\r\n            {\r\n                dBearingPt1Pt2 = (dBearingPt1Pt2 + 180.0) % 360;\r\n                oIntPoint = oCoordList[0].intersectLines(dBearingPt1Pt2, oCoordList[2], dBearingWLine);\r\n            }\r\n            if (!oIntPoint)\r\n            {\r\n                dBearingWLine = (dBearingWLine + 180.0) % 360;\r\n                oIntPoint = oCoordList[0].intersectLines(dBearingPt1Pt2, oCoordList[2], dBearingWLine);\r\n            }\r\n            if (oIntPoint)\r\n            {\r\n                // oIntPoint should never be undefined.\r\n                var dWidth = Math.round(oCoordList[2].distanceTo(oIntPoint));\r\n\r\n                if (sBasicSymbolCode === oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED)\r\n                {\r\n                    dWidth *= 2;\r\n                }\r\n\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.WIDTH_CP,\r\n                    oCoordList[2], 2, 0, dWidth);\r\n            }\r\n            \r\n            return oCP;\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                if ((iIndex === 2) &&\r\n                    (\r\n                        (sBasicSymbolCode === oBasicSymbolCodes.FORD_EASY) ||\r\n                        (sBasicSymbolCode === oBasicSymbolCodes.FORD_DIFFICULT) ||\r\n                        (sBasicSymbolCode === oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED)\r\n                    ))\r\n                {\r\n                    oCP = this._createWidthCP(oCoordList);\r\n                }\r\n                else\r\n                {\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.POSITION_CP,\r\n                        oCoordList[iIndex], iIndex, 0);\r\n                }\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            if ((oCoordList.length === 3) &&\r\n                (\r\n                    (sBasicSymbolCode === oBasicSymbolCodes.FORD_EASY) ||\r\n                    (sBasicSymbolCode === oBasicSymbolCodes.FORD_DIFFICULT) ||\r\n                    (sBasicSymbolCode === oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED)\r\n                ))\r\n            {\r\n                oCP = this._createWidthCP(oCoordList);\r\n            }\r\n            else\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oLatLng, oCoordList.length - 1, 0);\r\n            }\r\n            \r\n            this.updateLeafletObject();\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var iIndex = oCP.getIndex();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n\r\n            if (oCoordList.length <= oSymbolDef.minPoints)\r\n            {\r\n                return false;\r\n            }\r\n\r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject(oCoordList);\r\n            \r\n            return true;\r\n        },\r\n        _moveFordCP: function(oCP, oEvent)\r\n        {\r\n            var oMidPoint;\r\n            var dDist;\r\n            var dBearingMidPt3;\r\n            var dNewBearingMidPt3;\r\n            var dBearingPt1Pt2;\r\n            var dNewBearingPt1Pt2;\r\n            var oCP3;\r\n            var Pt3Coord;\r\n            var oRet = undefined;\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n            \r\n            switch (iIndex)\r\n            {\r\n                case 0:\r\n                case 1:\r\n                    oRet = [iIndex];\r\n\r\n                    if (oCoordList.length > 2)\r\n                    {\r\n                        // Get the bearing between pt1 pt2, and the mid point.\r\n                        dBearingPt1Pt2 = oCoordList[0].bearingTo(oCoordList[1]);\r\n                        oMidPoint = this.getCenterPT(oCoordList[0], oCoordList[1]);\r\n                        // Get the distance from the mid point to pt3 (the arrow).\r\n                        dDist = oMidPoint.distanceTo(oCoordList[2]);\r\n                        if ((dDist < 20.0) || isNaN(dDist) || (dDist === Infinity)) {\r\n                            return [];\r\n                        }\r\n                        // Get the bearing from the mid point and pt3.\r\n                        dBearingMidPt3 = oMidPoint.bearingTo(oCoordList[2]);\r\n                        // Update the coordinates of th CP that was moved.\r\n                        oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                        oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                        oCP.setCPPosition(oCoordList[iIndex]);\r\n                        // Now get the new bearing of pt1 pt2. And the new mid point.\r\n                        dNewBearingPt1Pt2 = oCoordList[0].bearingTo(oCoordList[1]);\r\n                        oMidPoint = this.getCenterPT(oCoordList[0], oCoordList[1]);\r\n                        // Compute the new bearing of pt3. And get the coordinates.\r\n                        dNewBearingMidPt3 = dBearingMidPt3 + (dNewBearingPt1Pt2 - dBearingPt1Pt2);\r\n                        Pt3Coord = oMidPoint.destinationPoint(dNewBearingMidPt3, dDist);\r\n                        // Update the CP, the coordinates and the object.\r\n                        oCoordList[2].lat = Pt3Coord.lat;\r\n                        oCoordList[2].lng = Pt3Coord.lng;\r\n                        oCP3 = this.getCP(2);\r\n                        oCP3.setCPPosition(oCoordList[2]);\r\n                        oRet.push(2);\r\n                    }\r\n                    else\r\n                    {\r\n                        // Update the coordinates of th CP that was moved.\r\n                        oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                        oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                        oCP.setCPPosition(oCoordList[iIndex]);\r\n                    }\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    break;\r\n                case 2:\r\n                    // Get the mid point.\r\n                    oMidPoint = this.getCenterPT(oCoordList[0], oCoordList[1]);\r\n                    // Get the bearing from the mid point and pt3.\r\n                    dBearingMidPt3 = oMidPoint.bearingTo(oCoordList[2]);\r\n                    var dBearingMidMouse = oMidPoint.bearingTo(oEvent.latlng);\r\n                    // Get the distance from the mid point to the mouse.\r\n                    dDist = oMidPoint.distanceTo(oEvent.latlng);\r\n                    // Project the MP-Mouse line onto the Mid Pt Pt3 line;\r\n                    dDist = Math.round(dDist * (Math.cos((dBearingMidMouse - dBearingMidPt3).toRad())));\r\n                    // Calculate the new position of Pt3.\r\n                    Pt3Coord = oMidPoint.destinationPoint(dBearingMidPt3, dDist);\r\n\r\n                    oCoordList[iIndex].lat = Pt3Coord.lat;\r\n                    oCoordList[iIndex].lng = Pt3Coord.lng;\r\n\r\n                    if (sBasicSymbolCode === oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED)\r\n                    {\r\n                        dDist *= 2;\r\n                    }\r\n                    \r\n                    oCP.setValue(dDist);\r\n\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    oRet = [iIndex];\r\n                    break;\r\n            }\r\n\r\n            return oRet;\r\n        },\r\n        _moveBlockCP: function(oCP, oEvent)\r\n        {\r\n            var oMidPoint;\r\n            var dDist;\r\n            var dBearingMidPt3;\r\n            var dNewBearingMidPt3;\r\n            var dBearingPt1Pt2;\r\n            var dNewBearingPt1Pt2;\r\n            var oCP3;\r\n            var Pt3Coord;\r\n            var oRet = undefined;\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (iIndex)\r\n            {\r\n                case 0:\r\n                case 1:\r\n                    oRet = [iIndex];\r\n\r\n                    if (oCoordList.length > 2)\r\n                    {\r\n                        // Get the bearing between pt1 pt2, and the mid point.\r\n                        dBearingPt1Pt2 = oCoordList[0].bearingTo(oCoordList[1]);\r\n                        oMidPoint = this.getCenterPT(oCoordList[0], oCoordList[1]);\r\n                        // Get the distance from the mid point to pt3 (the arrow).\r\n                        dDist = oMidPoint.distanceTo(oCoordList[2]);\r\n                        \r\n                        if ((dDist < 20.0) || isNaN(dDist) || (dDist === Infinity)) {\r\n                            return [];\r\n                        }\r\n                        // Get the bearing from the mid point and pt3.\r\n                        dBearingMidPt3 = oMidPoint.bearingTo(oCoordList[2]);\r\n                        // Update the coordinates of th CP that was moved.\r\n                        oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                        oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                        oCP.setCPPosition(oCoordList[iIndex]);\r\n                        // Now get the new bearing of pt1 pt2. And the new mid point.\r\n                        dNewBearingPt1Pt2 = oCoordList[0].bearingTo(oCoordList[1]);\r\n                        oMidPoint = this.getCenterPT(oCoordList[0], oCoordList[1]);\r\n                        // Compute the new bearing of pt3. And get the coordinates.\r\n                        dNewBearingMidPt3 = dBearingMidPt3 + (dNewBearingPt1Pt2 - dBearingPt1Pt2);\r\n                        Pt3Coord = oMidPoint.destinationPoint(dNewBearingMidPt3, dDist);\r\n                        // Update the CP, the coordinates and the object.\r\n                        oCoordList[2].lat = Pt3Coord.lat;\r\n                        oCoordList[2].lng = Pt3Coord.lng;\r\n                        oCP3 = this.getCP(2);\r\n                        oCP3.setCPPosition(oCoordList[2]);\r\n                        oRet.push(2);\r\n                    }\r\n                    else\r\n                    {\r\n                        oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                        oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                        oCP.setCPPosition(oCoordList[iIndex]);\r\n                    }\r\n                    \r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    break;\r\n                case 2:\r\n                    // Get the bearing between Pt1 and Pt2.\r\n                    dBearingPt1Pt2 = oCoordList[0].bearingTo(oCoordList[1]);\r\n                    dBearingPt1Pt2 = ((dBearingPt1Pt2 > 180)? dBearingPt1Pt2 - 360: dBearingPt1Pt2);\r\n                    // Get the mid point.\r\n                    oMidPoint = this.getCenterPT(oCoordList[0], oCoordList[1]);\r\n                    // Get the bearing from the mid point and pt3.\r\n                    dBearingMidPt3 = oMidPoint.bearingTo(oCoordList[2]);\r\n                    dBearingMidPt3 = ((dBearingMidPt3 > 180)? dBearingMidPt3 - 360: dBearingMidPt3);\r\n                    \r\n                    // Set the bearing to  +90 or -90.\r\n                    if ((dBearingMidPt3 - dBearingPt1Pt2) >= 0.0)\r\n                    {\r\n                        dBearingMidPt3 = dBearingPt1Pt2 + 90.0;\r\n                    }\r\n                    else\r\n                    {\r\n                        dBearingMidPt3 = dBearingPt1Pt2 + 270;\r\n                    }\r\n                    dBearingMidPt3 = (dBearingMidPt3 + 360) % 360;\r\n                    \r\n                    var dBearingMidMouse = oMidPoint.bearingTo(oEvent.latlng);\r\n                    // Get the distance from the mid point to the mouse.\r\n                    dDist = oMidPoint.distanceTo(oEvent.latlng);\r\n                    // Project the MP-Mouse line onto the Mid Pt Pt3 line;\r\n                    dDist = dDist * (Math.cos((dBearingMidMouse - dBearingMidPt3).toRad()));\r\n                    // Calculate the new position of Pt3.\r\n                    Pt3Coord = oMidPoint.destinationPoint(dBearingMidPt3, dDist);\r\n\r\n                    oCoordList[iIndex].lat = Pt3Coord.lat;\r\n                    oCoordList[iIndex].lng = Pt3Coord.lng;\r\n                    \r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    oRet = [iIndex];\r\n                    break;\r\n            }\r\n\r\n            return oRet;\r\n        },\r\n        _moveAmbushCP: function(oCP, oEvent)\r\n        {\r\n            var oMidPoint;\r\n            var dDist;\r\n            var dBearingMidPt1;\r\n            var dNewBearingMidPt1;\r\n            var dBearingPt2Pt3;\r\n            var dNewBearingPt2Pt3;\r\n            var oCP1;\r\n            var Pt1Coord;\r\n            var oRet = undefined;\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (iIndex)\r\n            {\r\n                case 0:\r\n                    // Get the mid point.\r\n                    oMidPoint = this.getCenterPT(oCoordList[1], oCoordList[2]);\r\n                    // Get the bearing from the mid point and pt1.\r\n                    dBearingMidPt1 = oMidPoint.bearingTo(oCoordList[0]);\r\n                    var dBearingMidMouse = oMidPoint.bearingTo(oEvent.latlng);\r\n                    // Get the distance from the mid point to the mouse.\r\n                    dDist = oMidPoint.distanceTo(oEvent.latlng);\r\n                    // Project the MP-Mouse line onto the Mid Pt Pt1 line;\r\n                    dDist = dDist * (Math.cos((dBearingMidMouse - dBearingMidPt1).toRad()));\r\n                    // Calculate the new position of Pt1.\r\n                    Pt1Coord = oMidPoint.destinationPoint(dBearingMidPt1, dDist);\r\n\r\n                    oCoordList[iIndex].lat = Pt1Coord.lat;\r\n                    oCoordList[iIndex].lng = Pt1Coord.lng;\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    oRet = [iIndex];\r\n                    break;\r\n                case 1:\r\n                case 2:\r\n                    // Get the bearing between pt1 pt2, and the mid point.\r\n                    dBearingPt2Pt3 = oCoordList[1].bearingTo(oCoordList[2]);\r\n                    oMidPoint = this.getCenterPT(oCoordList[1], oCoordList[2]);\r\n                    // Get the distance from the mid point to pt1 (the arrow).\r\n                    dDist = oMidPoint.distanceTo(oCoordList[0]);\r\n                        \r\n                    if ((dDist < 20.0) || isNaN(dDist) || (dDist === Infinity)) {\r\n                        return [];\r\n                    }\r\n                    // Get the bearing from the mid point and pt13.\r\n                    dBearingMidPt1 = oMidPoint.bearingTo(oCoordList[0]);\r\n                    // Update the coordinates of th CP that was moved.\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    // Now get the new bearing of pt2 pt3. And the new mid point.\r\n                    dNewBearingPt2Pt3 = oCoordList[1].bearingTo(oCoordList[2]);\r\n                    oMidPoint = this.getCenterPT(oCoordList[1], oCoordList[2]);\r\n                    // Compute the new bearing of pt1. And get the coordinates.\r\n                    dNewBearingMidPt1 = dBearingMidPt1 + (dNewBearingPt2Pt3 - dBearingPt2Pt3);\r\n                    Pt1Coord = oMidPoint.destinationPoint(dNewBearingMidPt1, dDist);\r\n                    // Update the CP, the coordinates and the object.\r\n                    oCoordList[0].lat = Pt1Coord.lat;\r\n                    oCoordList[0].lng = Pt1Coord.lng;\r\n                    oCP1 = this.getCP(0);\r\n                    oCP1.setCPPosition(oCoordList[0]);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    oRet = [0, iIndex];\r\n                    break;\r\n            }\r\n\r\n            return oRet;\r\n        },\r\n        _moveSeizeCP: function(oCP, oEvent)\r\n        {\r\n            var oCPPt2;\r\n            var dBearing;\r\n            var dDist;\r\n            var oRet = undefined;\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            //var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n            var i2525Version = oFeature.get2525Version();\r\n            var oRendererSettings = armyc2.c2sd.renderer.utilities.RendererSettings;\r\n            \r\n            if (i2525Version === oRendererSettings.Symbology_2525Bch2_USAS_13_14)\r\n            {\r\n                oRet = this._moveCP(oCP, oEvent);\r\n            }\r\n            else if ((i2525Version === oRendererSettings.Symbology_2525C ) &&\r\n                    (oCoordList.length === 3))\r\n            {\r\n                oRet = this._moveCP(oCP, oEvent);\r\n            }\r\n            else if (oCoordList.length === 4)\r\n            {\r\n                switch (iIndex)\r\n                {\r\n                    case 0:\r\n                        oRet = [iIndex];\r\n                        // If Pt1 is moved we need to move Pt2 relative to Pt1.\r\n                        oCPPt2 = this.getCP(1);\r\n                        dBearing = oCoordList[0].bearingTo(oEvent.latlng);\r\n                        dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                        if ((dDist < 20.0) || isNaN(dDist) || (dDist === Infinity)) {\r\n                            return [];\r\n                        }\r\n                        // Now move Pt1\r\n                        oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                        oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                        // And now move Pt2 relative to Pt1\r\n                        oCoordList[1].moveCoordinate(dBearing, dDist);\r\n                        oCPPt2.setCPPosition(oCoordList[1]);\r\n                        oRet.push(1);\r\n                        \r\n                        var oCPPt3 = this.getCP(2);\r\n                        oCoordList[2].moveCoordinate(dBearing, dDist);\r\n                        oCPPt3.setCPPosition(oCoordList[2]);\r\n                        oRet.push(2);\r\n\r\n                        this.setCoordinates(oCoordList);\r\n                        oCP.setCPPosition(oCoordList[iIndex]);\r\n                        this.updateLeafletObject(oCoordList);\r\n                        break;\r\n                    case 1:\r\n                    case 2:\r\n                    case 3:\r\n                        oRet = this._moveCP(oCP, oEvent);\r\n                        break;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                oRet = this._moveCP(oCP, oEvent);\r\n            }\r\n            \r\n            return oRet;\r\n        },\r\n        _moveCP: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            // We need to update the position of the control point\r\n            oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n            oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n            this.setCoordinates(oCoordList);\r\n            oCP.setCPPosition(oCoordList[iIndex]);\r\n            this.updateLeafletObject(oCoordList);\r\n\r\n            return [iIndex];\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var oRet = undefined;\r\n            //var oCoordList = this.getCoordinateList();\r\n            //var oSymbolDef = this.getSymbolDef();\r\n            var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            switch (sBasicSymbolCode)\r\n            {\r\n                case oBasicSymbolCodes.AMBUSH:\r\n                    oRet = this._moveAmbushCP(oCP, oEvent);\r\n                    break;\r\n                case oBasicSymbolCodes.FORD_EASY:\r\n                case oBasicSymbolCodes.FORD_DIFFICULT:\r\n                case oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED:\r\n                    oRet = this._moveFordCP(oCP, oEvent);\r\n                    break;\r\n                case oBasicSymbolCodes.BLOCK_TASK:\r\n                    oRet = this._moveBlockCP(oCP, oEvent);\r\n                    break;\r\n                case oBasicSymbolCodes.SEIZE:\r\n                    oRet = this._moveSeizeCP(oCP, oEvent);\r\n                    break;\r\n                default:\r\n                    oRet = this._moveCP(oCP, oEvent);\r\n                    break;\r\n            }\r\n            return oRet;\r\n        },\r\n        doFeatureMove: function(dBearing, dDistance) {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oCPList = this.options.oControlPointList;\r\n            var oCoord;\r\n            var iCoordIndex;\r\n                    \r\n            for (var iIndex = 0; iIndex < oCPList.length; iIndex++) {\r\n                iCoordIndex = oCPList[iIndex].getIndex();\r\n                oCoord = oCPList[iIndex].getPosition();\r\n                oCoord.moveCoordinate(dBearing, dDistance);\r\n                oCPList[iIndex].setCPPosition(oCoord);\r\n                oCoordList[iCoordIndex] = oCoord;\r\n            }\r\n            this.setCoordinates(oCoordList);\r\n            this.updateLeafletObject();\r\n\r\n            return true;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDCSuperAutoShape = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCSuperAutoShapeEditor());\r\n","\r\n/* global L, leafLet */\r\n\r\nleafLet.internalPrivateClass.MilStdDC2PointLineEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            this.updateLeafletObject();\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDC2PointLine = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDC2PointLineEditor());\r\n","\r\n/* global L, leafLet */\r\n\r\nleafLet.internalPrivateClass.MilStdDC2PointRectAutoShapeEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        _addWidthCP: function(oCoordList)\r\n        {\r\n            var oSymbolDef = this.getSymbolDef();\r\n            \r\n            if (oCoordList.length >= oSymbolDef.minPoints)\r\n            {\r\n                var oWidthPoint;\r\n                var oFeature = this.getFeature();\r\n                var oModifiers = oFeature.getMilStdModifiers();\r\n                var dDist = oCoordList[0].distanceTo(oCoordList[1]) / 2.0;\r\n                var dAngle = oCoordList[0].bearingTo(oCoordList[1]);\r\n                var oMidPoint = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                var dWidth = oModifiers.getAMValue(0);\r\n\r\n                dAngle -= 90.0;\r\n                dAngle = (dAngle + 360) % 360;\r\n                oWidthPoint = oMidPoint.destinationPoint(dAngle, dWidth / 2.0);\r\n                \r\n                var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.WIDTH_CP,\r\n                    oWidthPoint, 0, 0, dWidth);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            this._addWidthCP(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oSymbolDef = this.getSymbolDef();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length >= oSymbolDef.maxPoints)\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                this._addWidthCP(oCoordList)\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addWidthCP(oCoordList);\r\n                    return [iIndex];\r\n                case leafLet.ControlPoint.Type.WIDTH_CP:\r\n                    var oWidthPoint;\r\n                    var oFeature = this.getFeature();\r\n                    var oModifiers = oFeature.getMilStdModifiers();\r\n                    var dDist = oCoordList[0].distanceTo(oCoordList[1]) / 2.0;\r\n                    var dAngle = oCoordList[0].bearingTo(oCoordList[1]);\r\n                    var oMidPoint = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                    var dWidth = Math.round(oMidPoint.distanceTo(oEvent.latlng));\r\n                    //var dDraggedAngle = oMidPoint.bearingTo(oEvent.latlng);\r\n\r\n                    dAngle -= 90.0;\r\n                    dAngle = (dAngle + 360) % 360;\r\n\r\n                    oWidthPoint = oMidPoint.destinationPoint(dAngle, dWidth);\r\n                    oModifiers.setAMValue(0, dWidth * 2.0);\r\n                    oCP.setCPPosition(oWidthPoint);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    return [];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdDC2PointRectAutoShape = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDC2PointRectAutoShapeEditor());\r\n","\r\n/* global L, leafLet */\r\n\r\nleafLet.internalPrivateClass.MilStdSinglePointEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.MilStd.prototype.initialize.call(this, args);\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oLeafletObject = this.getLeafletObject();\r\n\r\n            if (oLeafletObject instanceof L.Marker)\r\n            {\r\n                //oLeafletObject.unbindPopup();\r\n                this.setMarkerPopup();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n\r\n            if (oCoordList.length !== 0)\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            var oLeafletObject = oFeature._createFeature(oFeature.options);\r\n\r\n            this.setLeafletObject(oLeafletObject);\r\n\r\n            return undefined;\r\n        },\r\n        doFeatureMove: function(dBearing, dDistance)\r\n        {\r\n            var oLeafletObject = this.getLeafletObject();\r\n            var oCoordList = this.getCoordinateList();\r\n\r\n            oCoordList[0].moveCoordinate(dBearing, dDistance);\r\n            this.setCoordinates(oCoordList);\r\n            oLeafletObject.setLatLng(oCoordList[0]);\r\n            \r\n            this.setMarkerPopup();\r\n            return true;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.MilStdSinglePoint = leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdSinglePointEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceCurtainEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        _addSegmentCP: function()\r\n        {\r\n/*\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].pointAt3QtrDistanceTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.SEGMENT_CP,\r\n                            oNewCoord, iIndex - 1, iIndex);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n*/\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP);\r\n                this._addSegmentCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this._addNewCP();\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP);\r\n                    this._addSegmentCP();\r\n                }\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length <= oFeature.getMinPoints())\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP);\r\n            this.updateLeafletObject(oCoordList);\r\n            this._addNewCP();\r\n            this._addSegmentCP();\r\n            \r\n            return true;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    //this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addSegmentCP();\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addSegmentCP();\r\n                    return [iIndex];\r\n                case leafLet.ControlPoint.Type.SEGMENT_CP:\r\n                    var oCPCoord = oCP.getPosition();\r\n                    var dBearing = oCPCoord.bearingTo(oEvent.latlng);\r\n                    var dDist = oCPCoord.distanceTo(oEvent.latlng);\r\n                    var iSubIndex = oCP.getSubIndex();\r\n\r\n                    oCoordList[iIndex].moveCoordinate(dBearing, dDist);\r\n                    oCoordList[iSubIndex].moveCoordinate(dBearing, dDist);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addSegmentCP();\r\n                    return [iIndex, iSubIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspaceCurtain = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceCurtainEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspacePolygonEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n\r\n                // Lets add the new CP.\r\n                oNewCoord = oCoordList[0].midPointTo(oCoordList[oCoordList.length - 1]);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                        oNewCoord, oCoordList.length, 0);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this._addNewCP();\r\n                }\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length <= oFeature.getMinPoints())\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this.updateLeafletObject(oCoordList);\r\n            this._addNewCP();\r\n            \r\n            return true;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    //this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    //this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspacePolygon = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspacePolygonEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceCylinderEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addRadiusCP: function(oCoordList)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRange;\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                dRange = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n\r\n                // Place the Range CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(90, dRange);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.RADIUS_CP,\r\n                    oCPPosition, 0, 90, dRange);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oCoordList[0], 0, 0);\r\n                \r\n            this.addControlPoint(oCP);\r\n            \r\n            this._addRadiusCP(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            //var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oFeature.getMaxPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addRadiusCP(oCoordList);\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var dMouseAngle;\r\n            var dAngle;\r\n            var dDist;\r\n            var oCPPos;\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var iCPIndex = oCP.getIndex();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n\r\n            if (oCoordList.length < oFeature.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[0].lat = oEvent.latlng.lat;\r\n                    oCoordList[0].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[0]);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this._addRadiusCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RADIUS_CP:\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS, dDist);\r\n                    oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dDist);\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspaceCylinder = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceCylinderEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceOrbitEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addWidthCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var dWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_WIDTH);\r\n            var sTurn = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN);\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                var Pt1 = oCoordList[0];\r\n                var Pt2 = oCoordList[1];\r\n                var dBearing = Pt1.bearingTo(Pt2);\r\n                var dDist = Pt1.distanceTo(Pt2);\r\n\r\n                oNewCoord = Pt1.destinationPoint(dBearing, dDist / 2.0);\r\n                \r\n                switch (sTurn)\r\n                {\r\n                    case emp.typeLibrary.orbitTurnType.CENTER:\r\n                        oNewCoord.moveCoordinate((dBearing + 270.0) % 360, dWidth / 2.0);\r\n                        break;\r\n                    case emp.typeLibrary.orbitTurnType.RIGHT:\r\n                        oNewCoord.moveCoordinate((dBearing + 90.0) % 360, dWidth);\r\n                        break;\r\n                    case emp.typeLibrary.orbitTurnType.LEFT:\r\n                        oNewCoord.moveCoordinate((dBearing + 270.0) % 360, dWidth);\r\n                        break;\r\n                }\r\n                \r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.WIDTH_CP,\r\n                        oNewCoord, iIndex, 0, dWidth);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                this._addWidthCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length >= oFeature.getMaxPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this._addWidthCP();\r\n                }\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.WIDTH_CP:\r\n                    var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n                    var oFeature = this.getFeature();\r\n                    var oAttributes = oFeature.getAttributes(0);\r\n                    var dWidth;\r\n                    var sTurn = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN);\r\n                    var Pt1 = oCoordList[0];\r\n                    var Pt2 = oCoordList[1];\r\n                    var dBearing = Pt1.bearingTo(Pt2);\r\n                    var dDist = Pt1.distanceTo(Pt2);\r\n                    var oNewCoord = Pt1.destinationPoint(dBearing, dDist / 2.0);\r\n                    var oCPPos = oCP.getPosition();\r\n                    var dMouseBearing = oNewCoord.bearingTo(oEvent.latlng);\r\n                    \r\n                    dBearing = oNewCoord.bearingTo(oCPPos);\r\n                    dDist = oNewCoord.distanceTo(oEvent.latlng);\r\n                    \r\n                    var dDelatAngle = Math.abs(dMouseBearing - dBearing);\r\n                    dDist = Math.round(Math.abs(dDist * Math.cos(dDelatAngle.toRad())));\r\n\r\n                    switch (sTurn)\r\n                    {\r\n                        case emp.typeLibrary.orbitTurnType.CENTER:\r\n                            oNewCoord = oNewCoord.destinationPoint(dBearing, dDist);\r\n                            dWidth = dDist * 2.0;\r\n                            break;\r\n                        case emp.typeLibrary.orbitTurnType.RIGHT:\r\n                        case emp.typeLibrary.orbitTurnType.LEFT:\r\n                            oNewCoord = oNewCoord.destinationPoint(dBearing, dDist);\r\n                            dWidth = dDist;\r\n                            break;\r\n                    }\r\n                    \r\n                    oCP.setCPPosition(oNewCoord);\r\n                    oCP.setValue(dWidth);\r\n                    oAttributes.setValue(cAirspaceAttribute.AIRSPACE_WIDTH, dWidth);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    return [];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addWidthCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspaceOrbit = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceOrbitEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceRouteEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addWidthCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var dWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_WIDTH);\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                var Pt1 = oCoordList[0];\r\n                var Pt2 = oCoordList[1];\r\n                var dBearing = Pt1.bearingTo(Pt2);\r\n                var dDist = Pt1.distanceTo(Pt2);\r\n\r\n                oNewCoord = Pt1.destinationPoint(dBearing, dDist / 2.0);\r\n                oNewCoord.moveCoordinate((dBearing + 270.0) % 360, dWidth / 2.0);\r\n                \r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.WIDTH_CP,\r\n                        oNewCoord, iIndex, 0, dWidth);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addWidthCP();\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length >= oFeature.getMaxPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n                \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this._addWidthCP();\r\n                    this._addNewCP();\r\n                }\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var iIndex = oCP.getIndex();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                oCoordList.splice(iIndex, 1);\r\n                this.setCoordinates(oCoordList);\r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this._addWidthCP();\r\n                    this._addNewCP();\r\n                }\r\n                \r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.WIDTH_CP:\r\n                    var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n                    var oFeature = this.getFeature();\r\n                    var oAttributes = oFeature.getAttributes(0);\r\n                    var dWidth;\r\n                    var sTurn = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN);\r\n                    var Pt1 = oCoordList[0];\r\n                    var Pt2 = oCoordList[1];\r\n                    var dBearing = Pt1.bearingTo(Pt2);\r\n                    var dDist = Pt1.distanceTo(Pt2);\r\n                    var oNewCoord = Pt1.destinationPoint(dBearing, dDist / 2.0);\r\n                    var oCPPos = oCP.getPosition();\r\n                    var dMouseBearing = oNewCoord.bearingTo(oEvent.latlng);\r\n                    \r\n                    dBearing = oNewCoord.bearingTo(oCPPos);\r\n                    dDist = oNewCoord.distanceTo(oEvent.latlng);\r\n                    \r\n                    var dDelatAngle = Math.abs(dMouseBearing - dBearing);\r\n                    dDist = Math.round(Math.abs(dDist * Math.cos(dDelatAngle.toRad())));\r\n\r\n                    oNewCoord = oNewCoord.destinationPoint(dBearing, dDist);\r\n                    dWidth = dDist * 2.0;\r\n                    \r\n                    oCP.setCPPosition(oNewCoord);\r\n                    oCP.setValue(dWidth);\r\n                    oAttributes.setValue(cAirspaceAttribute.AIRSPACE_WIDTH, dWidth);\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    return [];\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    var iNewIndex = oCP.getIndex();\r\n\r\n                    this.updateCPIndex(iNewIndex, 1);\r\n                    oCoordList.splice(iNewIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addWidthCP();\r\n                    this._addNewCP();\r\n                    this._issueCPAddEvent(iNewIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addWidthCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspaceRoute = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceRouteEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceTrackEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addWidthCP: function()\r\n        {\r\n            var oCP;\r\n            var oMidCoord;\r\n            var iIndex;\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                var Pt1;\r\n                var Pt2;\r\n                var dBearing;\r\n                var dDist;\r\n                var oAttributes;\r\n                var dLeftWidth;\r\n                var dRightWidth;\r\n                var oNewCoord;\r\n\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    oAttributes = oFeature.getAttributes(iIndex - 1);\r\n                    dLeftWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH);\r\n                    dRightWidth = oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH);\r\n                    Pt1 = oCoordList[iIndex - 1];\r\n                    Pt2 = oCoordList[iIndex];\r\n                    dBearing = Pt1.bearingTo(Pt2);\r\n                    \r\n                    oMidCoord = Pt1.pointAt3QtrDistanceTo(Pt2);\r\n                    oNewCoord = oMidCoord.destinationPoint((dBearing + 270.0) % 360, dLeftWidth);\r\n\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.LEFT_WIDTH_CP,\r\n                            oNewCoord, iIndex - 1, iIndex, dLeftWidth);\r\n                    this.addControlPoint(oCP);\r\n\r\n                    oNewCoord = oMidCoord.destinationPoint((dBearing + 90.0) % 360, dRightWidth);\r\n\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.RIGHT_WIDTH_CP,\r\n                            oNewCoord, iIndex - 1, iIndex, dRightWidth);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP);\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP);\r\n                this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                this._addWidthCP();\r\n                this._addNewCP();\r\n            }\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oAttributeList = oFeature.getAttributeList();\r\n            var oAttributes;\r\n            var iIndex = oCoordList.length;\r\n            \r\n            if (oCoordList.length >= oFeature.getMaxPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n\r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, iIndex, 0);\r\n\r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                oAttributes = oAttributeList.get(iIndex - 1);\r\n\r\n                if (!oAttributes)\r\n                {\r\n                    if (iIndex === 1)\r\n                    {\r\n                        oAttributes = new leafLet.typeLibrary.airspace.Attributes(oFeature.getProperties(), {});\r\n                        oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_TRACK);\r\n                    }\r\n                    else\r\n                    {\r\n                        oAttributes = oAttributeList.get(iIndex - 2);\r\n                        oAttributes = oAttributes.duplicateAttribute();\r\n                    }\r\n                    \r\n                    oAttributeList.add(oAttributes);\r\n                }\r\n                \r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this._addWidthCP();\r\n                    this._addNewCP();\r\n                }\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var iIndex = oCP.getIndex();\r\n            var oAttributeList = oFeature.getAttributeList();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                oCoordList.splice(iIndex, 1);\r\n                this.setCoordinates(oCoordList);\r\n                \r\n                if (iIndex === oAttributeList.length() - 1)\r\n                {\r\n                    oAttributeList.remove(iIndex - 1);\r\n                }\r\n                else\r\n                {\r\n                    oAttributeList.remove(iIndex);\r\n                }\r\n\r\n                if (this.updateLeafletObject(oCoordList))\r\n                {\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this._addWidthCP();\r\n                    this._addNewCP();\r\n                }\r\n                \r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var oAttributes;\r\n            var oNewCoord;\r\n            var iIndex = oCP.getIndex();\r\n            var iIndex2 = oCP.getSubIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var cAirspaceAttribute = leafLet.typeLibrary.AirspaceAttribute;\r\n            var oFeature = this.getFeature();\r\n            var oAttributeList = oFeature.getAttributeList();\r\n            \r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.LEFT_WIDTH_CP:\r\n                case leafLet.ControlPoint.Type.RIGHT_WIDTH_CP:\r\n                    var dWidth;\r\n                    var Pt1 = oCoordList[iIndex];\r\n                    var Pt2 = oCoordList[iIndex2];\r\n                    var dBearing = Pt1.bearingTo(Pt2);\r\n                    var dDist;\r\n                    var oMidCoord = Pt1.pointAt3QtrDistanceTo(Pt2);\r\n                    var oCPPos = oCP.getPosition();\r\n                    var dMouseBearing = oMidCoord.bearingTo(oEvent.latlng);\r\n\r\n                    oAttributes = oFeature.getAttributes(iIndex);\r\n                    \r\n                    dBearing = oMidCoord.bearingTo(oCPPos);\r\n                    dDist = oMidCoord.distanceTo(oEvent.latlng);\r\n                    \r\n                    var dDelatAngle = Math.abs(dMouseBearing - dBearing);\r\n                    dDist = Math.round(Math.abs(dDist * Math.cos(dDelatAngle.toRad())));\r\n\r\n                    oNewCoord = oMidCoord.destinationPoint(dBearing, dDist);\r\n                    dWidth = dDist;\r\n                    \r\n                    oCP.setCPPosition(oNewCoord);\r\n                    oCP.setValue(dWidth);\r\n                    \r\n                    if (oCP.getType() === leafLet.ControlPoint.Type.LEFT_WIDTH_CP)\r\n                    {\r\n                        oAttributes.setValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH, dWidth);\r\n                    }\r\n                    else\r\n                    {\r\n                        oAttributes.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH, dWidth);\r\n                    }\r\n                    \r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    return [];\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP);\r\n\r\n                    this.updateCPIndex(iIndex, 1);\r\n                    oCoordList.splice(iIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    \r\n                    // We need to add a set of attributes for the new segment.\r\n                    oAttributes = oFeature.getAttributes(iIndex - 1);\r\n                    oAttributes = oAttributes.duplicateAttribute();\r\n                    oAttributeList.insert(iIndex, oAttributes);\r\n                    \r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addWidthCP();\r\n                    this._issueCPAddEvent(iIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    // and the new control points beore and after it..\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addWidthCP();\r\n                    return [iIndex];\r\n            }\r\n            return undefined;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspaceTrack = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceTrackEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspaceRadArcEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addRadiusCP: function(oCoordList)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dOutterRadius;\r\n            var dInnerRadius;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            var dMidAzimuth;\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                dOutterRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                dInnerRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS);\r\n                dLeftAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n                dRightAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n                \r\n                dMidAzimuth = (dRightAzimuth + dLeftAzimuth) / 2.0;\r\n                \r\n                if (dRightAzimuth < dLeftAzimuth)\r\n                {\r\n                    dMidAzimuth = (dMidAzimuth + 180) % 360;\r\n                }\r\n\r\n                // Place the outter CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dMidAzimuth, dOutterRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.RADIUS_CP,\r\n                    oCPPosition, 0, dMidAzimuth, dOutterRadius);\r\n                this.addControlPoint(oCP);\r\n\r\n                // Place the inner CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dMidAzimuth, dInnerRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.INNER_RADIUS_CP,\r\n                    oCPPosition, 0, dMidAzimuth, dInnerRadius);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        _addAzimuthCP: function(oCoordList)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dOutterRadius;\r\n            var dInnerRadius;\r\n            var dAvgRadius;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                dOutterRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                dInnerRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS);\r\n                dLeftAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n                dRightAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n                \r\n                dAvgRadius = (dOutterRadius + dInnerRadius) / 2.0;\r\n                \r\n                // Place the outter CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dLeftAzimuth, dAvgRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP,\r\n                    oCPPosition, 0, dAvgRadius, dLeftAzimuth);\r\n                this.addControlPoint(oCP);\r\n\r\n                // Place the inner CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dRightAzimuth, dAvgRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP,\r\n                    oCPPosition, 0, dAvgRadius, dRightAzimuth);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            \r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            var oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oCoordList[0], 0, 0);\r\n                \r\n            this.addControlPoint(oCP);\r\n            \r\n            this._addRadiusCP(oCoordList);\r\n            this._addAzimuthCP(oCoordList);\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            //var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oFeature.getMaxPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addRadiusCP(oCoordList);\r\n                this._addAzimuthCP(oCoordList);\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            return false;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var dMouseAngle;\r\n            var dAngle;\r\n            var dDist;\r\n            var oCPPos;\r\n            var dOutterRadius;\r\n            var dInnerRadius;\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var iCPIndex = oCP.getIndex();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n\r\n            if (oCoordList.length < oFeature.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[0].lat = oEvent.latlng.lat;\r\n                    oCoordList[0].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[0]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.INNER_RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addRadiusCP(oCoordList);\r\n                    this._addAzimuthCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RADIUS_CP:\r\n                    dInnerRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS);\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    if (dDist <= dInnerRadius)\r\n                    {\r\n                        // The outter radius can't be equal or smaller that the inner.\r\n                        break;\r\n                    }\r\n                    \r\n                    oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS, dDist);\r\n                    oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dDist);\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addAzimuthCP(oCoordList);\r\n                    this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.INNER_RADIUS_CP:\r\n                    dOutterRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    if (dDist >= dOutterRadius)\r\n                    {\r\n                        // The inner radius can't be equal or greaterr than the outter.\r\n                        break;\r\n                    }\r\n                    \r\n                    oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS, dDist);\r\n                    oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dDist);\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addAzimuthCP(oCoordList);\r\n                    this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP:\r\n                case leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP:\r\n                    dDist = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n\r\n                    oCPPos = oCoordList[0].destinationPoint(dMouseAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dMouseAngle);\r\n\r\n                    if (oCP.getType() === leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP)\r\n                    {\r\n                        oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH, dMouseAngle);\r\n                    }\r\n                    else\r\n                    {\r\n                        oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH, dMouseAngle);\r\n                    }\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.INNER_RADIUS_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addRadiusCP(oCoordList);\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspaceRadArc = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceRadArcEditor());\r\n","\r\n/* global L, leafLet, emp */\r\n\r\nleafLet.internalPrivateClass.AirspacePolyArcEditor = function()\r\n{\r\n    var publicInterface = {\r\n        initialize: function (args) \r\n        {\r\n            //var oOptions = {\r\n            //};\r\n            //L.Util.setOptions(this, oOptions);\r\n            \r\n            leafLet.editor.Airspace.prototype.initialize.call(this, args);\r\n        },\r\n        _addRadiusCP: function(oCoordList)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRadius;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            var dMidAzimuth;\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                dRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                dLeftAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n                dRightAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n                \r\n                dMidAzimuth = (dRightAzimuth + dLeftAzimuth) / 2.0;\r\n                \r\n                if (dRightAzimuth < dLeftAzimuth)\r\n                {\r\n                    dMidAzimuth = (dMidAzimuth + 180) % 360;\r\n                }\r\n\r\n                // Place the outter CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dMidAzimuth, dRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.RADIUS_CP,\r\n                    oCPPosition, 0, dMidAzimuth, dRadius);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        _addAzimuthCP: function(oCoordList)\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n            var oCP;\r\n            var oCPPosition;\r\n            var dRadius;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                dRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                dLeftAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n                dRightAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n                \r\n                // Place the left azimuth  CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dLeftAzimuth, dRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP,\r\n                    oCPPosition, 0, dRadius, dLeftAzimuth);\r\n                this.addControlPoint(oCP);\r\n\r\n                // Place the right azimuth CP.\r\n                oCPPosition = oCoordList[0].destinationPoint(dRightAzimuth, dRadius);\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP,\r\n                    oCPPosition, 0, dRadius, dRightAzimuth);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        _addNewCP: function()\r\n        {\r\n            var dRadius;\r\n            var dLeftAzimuth;\r\n            var dRightAzimuth;\r\n            var oCP;\r\n            var oNewCoord;\r\n            var iIndex;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n\r\n            if (oCoordList.length === 0)\r\n            {\r\n                return;\r\n            }\r\n            \r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                for (iIndex = 1; iIndex < oCoordList.length; iIndex++)\r\n                {\r\n                    // Lets add the new CP.\r\n                    if (iIndex === 1)\r\n                    {\r\n                        dRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                        dRightAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH);\r\n                        oNewCoord = oCoordList[0].destinationPoint(dRightAzimuth, dRadius);\r\n                        oNewCoord = oNewCoord.midPointTo(oCoordList[iIndex]);\r\n                    }\r\n                    else\r\n                    {\r\n                        oNewCoord = oCoordList[iIndex - 1].midPointTo(oCoordList[iIndex]);\r\n                    }\r\n                    \r\n                    oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                            leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                            oNewCoord, iIndex, 0);\r\n                    this.addControlPoint(oCP);\r\n                }\r\n\r\n                // Lets add the new CP.\r\n                dRadius = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS);\r\n                dLeftAzimuth = oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH);\r\n                oNewCoord = oCoordList[0].destinationPoint(dLeftAzimuth, dRadius);\r\n                oNewCoord = oNewCoord.midPointTo(oCoordList[oCoordList.length - 1]);\r\n\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                        leafLet.ControlPoint.Type.NEW_POSITION_CP,\r\n                        oNewCoord, oCoordList.length, 0);\r\n                this.addControlPoint(oCP);\r\n            }\r\n        },\r\n        assembleControlPoints: function()\r\n        {\r\n            var oFeature = this.getFeature();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oCP;\r\n            \r\n            if (oCoordList.length < oFeature.getMinPoints())\r\n            {\r\n                return;\r\n            }\r\n            \r\n            for (var iIndex = 0; iIndex < oCoordList.length; iIndex++)\r\n            {\r\n                oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                    leafLet.ControlPoint.Type.POSITION_CP,\r\n                    oCoordList[iIndex], iIndex, 0);\r\n\r\n                this.addControlPoint(oCP);\r\n            }\r\n            \r\n            this._addRadiusCP(oCoordList);\r\n            this._addAzimuthCP(oCoordList);\r\n            this._addNewCP();\r\n        },\r\n        doAddControlPoint: function(oLatLng)\r\n        {\r\n            var oCP;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            //var oModifiers = oFeature.getMilStdModifiers();\r\n            //var sBasicSymbolCode = this.options.sBasicSymbolCode;\r\n            //var oBasicSymbolCodes = leafLet.utils.milstd.basicSymbolCode;\r\n\r\n            if (oCoordList.length >= oFeature.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n            \r\n            oCoordList.push(oLatLng);\r\n            this.setCoordinates(oCoordList);\r\n            \r\n            oCP = new leafLet.editor.ControlPoint(oFeature,\r\n                leafLet.ControlPoint.Type.POSITION_CP,\r\n                oLatLng, oCoordList.length - 1, 0);\r\n            \r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n\r\n            if (this.updateLeafletObject(oCoordList))\r\n            {\r\n                this._addRadiusCP(oCoordList);\r\n                this._addAzimuthCP(oCoordList);\r\n                this._addNewCP();\r\n            }\r\n\r\n            return oCP;\r\n        },\r\n        doDeleteControlPoint: function(oCP)\r\n        {\r\n            var iIndex = oCP.getIndex();\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            \r\n            if (oCP.getType() !== leafLet.ControlPoint.Type.POSITION_CP)\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            if (oCoordList.length <= oFeature.getMinPoints())\r\n            {\r\n                return false;\r\n            }\r\n            \r\n            oCoordList.splice(iIndex, 1);\r\n            this.setCoordinates(oCoordList);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n            this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n            this.updateLeafletObject(oCoordList);\r\n            this._addNewCP();\r\n            this._addRadiusCP(oCoordList);\r\n            this._addAzimuthCP(oCoordList);\r\n            \r\n            return true;\r\n        },\r\n        doControlPointMoved: function(oCP, oEvent)\r\n        {\r\n            var dMouseAngle;\r\n            var dAngle;\r\n            var dDist;\r\n            var oCPPos;\r\n            var iIndex = oCP.getIndex();\r\n            var oRet = undefined;\r\n            var oCoordList = this.getCoordinateList();\r\n            var oFeature = this.getFeature();\r\n            var oAttributes = oFeature.getAttributes(0);\r\n\r\n            if (oCoordList.length < oFeature.getMinPoints())\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            switch (oCP.getType())\r\n            {\r\n                case leafLet.ControlPoint.Type.NEW_POSITION_CP:\r\n                    // We need to convert the new control point to a position control point\r\n                    // and add new control points before and after it.\r\n                    // We need to add the coordiante to our list in the correct position.\r\n                    this.updateCPIndex(iIndex, 1);\r\n                    oCoordList.splice(iIndex, 0, oEvent.latlng);\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oEvent.latlng);\r\n                    oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addRadiusCP(oCoordList);\r\n                    this._addAzimuthCP(oCoordList);\r\n                    this._issueCPAddEvent(iIndex);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.POSITION_CP:\r\n                    // We need to update the position of the control point\r\n                    oCoordList[iIndex].lat = oEvent.latlng.lat;\r\n                    oCoordList[iIndex].lng = oEvent.latlng.lng;\r\n                    this.setCoordinates(oCoordList);\r\n                    oCP.setCPPosition(oCoordList[iIndex]);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addRadiusCP(oCoordList);\r\n                    this._addAzimuthCP(oCoordList);\r\n                    oRet = [0];\r\n                    break;\r\n                case leafLet.ControlPoint.Type.RADIUS_CP:\r\n                    dAngle = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n                    dDist = oCoordList[0].distanceTo(oEvent.latlng);\r\n                    dDist = Math.abs(Math.round(dDist * Math.cos((dMouseAngle - dAngle).toRad())));\r\n                    \r\n                    oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS, dDist);\r\n                    oCPPos = oCoordList[0].destinationPoint(dAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dDist);\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addAzimuthCP(oCoordList);\r\n                    this._issueCPUpdateEvent([], emp.typeLibrary.UpdateEventType.UPDATE);\r\n                    break;\r\n                case leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP:\r\n                case leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP:\r\n                    dDist = oCP.getSubIndex();\r\n                    dMouseAngle = oCoordList[0].bearingTo(oEvent.latlng);\r\n\r\n                    oCPPos = oCoordList[0].destinationPoint(dMouseAngle, dDist);\r\n                    oCP.setCPPosition(oCPPos);\r\n                    oCP.setValue(dMouseAngle);\r\n\r\n                    if (oCP.getType() === leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP)\r\n                    {\r\n                        oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH, dMouseAngle);\r\n                    }\r\n                    else\r\n                    {\r\n                        oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH, dMouseAngle);\r\n                    }\r\n\r\n                    this.setCoordinates(oCoordList);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.INNER_RADIUS_CP);\r\n                    this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP);\r\n                    this.updateLeafletObject(oCoordList);\r\n                    this._addNewCP();\r\n                    this._addRadiusCP(oCoordList);\r\n                    break;\r\n            }\r\n            return oRet;\r\n        }\r\n   };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nleafLet.editor.AirspacePolyArc = leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspacePolyArcEditor());\r\n","/*globals emp, L */\r\n/* global L, leafLet, cmapi */\r\n\r\nvar emp = emp || {};\r\n\r\nemp.util.milstdColorFix = function (feature) {\r\n    var oProperties;\r\n    var oModifiers;\r\n\r\n    if (feature.hasOwnProperty('format') && (feature.format === emp.typeLibrary.featureFormatType.MILSTD)) {\r\n        oProperties = feature.properties;\r\n        if (oProperties && oProperties.hasOwnProperty('modifiers')) {\r\n            oModifiers = oProperties.modifiers;\r\n            if (oModifiers.hasOwnProperty('lineColor')) {\r\n                oProperties.lineColor = oModifiers.lineColor;\r\n            }\r\n            if (oModifiers.hasOwnProperty('lineWidth')) {\r\n                oProperties.lineWidth = oModifiers.lineWidth;\r\n            }\r\n            if (oModifiers.hasOwnProperty('fillColor')) {\r\n                oProperties.fillColor = oModifiers.fillColor;\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nemp.engineDefs = emp.engineDefs || {};\r\nemp.engineDefs.leafletMapEngine = function (args) {\r\n\r\n    // engineInterface is the public object returned to caller\r\n    var engineInterface = emp.map.createEngineTemplate();\r\n    var bounds;\r\n    var selectedGeoColor = new cmapi.IGeoColor({\r\n        red: 0xF0,\r\n        green: 0xF0,\r\n        blue: 0\r\n    });\r\n\r\n    var instanceInterface = {\r\n        bIsV2Core: (args.isV2Core === true) || false,\r\n        empMapInstance: args.mapInstance,\r\n        leafletInstance: undefined,\r\n        bUseProxy: args.useProxy,\r\n        useProxyForDefault: args.useProxyForDefault,\r\n        renderingOptimization: {\r\n          enabled: args.renderingOptimization,\r\n          midDistanceThreshold: args.midDistanceThreshold,\r\n          farDistanceThreshold: {\r\n            value: args.farDistanceThreshold,\r\n            RED: 'red',\r\n            BLUE: 'blue',\r\n            GREEN: 'green',\r\n            YELLOW: 'yellow',\r\n            getSVG: function (attributes) {\r\n              return '<svg preserveAspectRatio=\"none\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">' +\r\n                       '<circle cx=\"' + attributes.x + '\" cy=\"' + attributes.y + '\" r=\"' + attributes.radius + '\"' +\r\n                       ' fill=\"' + attributes.color + '\" stroke=\"' + attributes.color + '\" stroke-width=\"1\"/>' +\r\n                     '</svg>';\r\n            }\r\n          },\r\n          // This is set to undefined instead of null to account for the case when the map starts at a very low altitude\r\n          // and a mil symbol icon plot occurs without any other event first. If this is already 'null' the zoneChanged\r\n          // boolean in the refreshZone() will not change to true which is needed if the afformentioned plot mil std icon\r\n          // is to be put on the render list in the scheduler.\r\n          viewInZone: undefined,\r\n          zoneChanged: false,\r\n          renderList: {},\r\n          removeFromRenderList: function (key) {\r\n            delete this.renderList[key];\r\n          },\r\n          addToRenderList: function (key, value) {\r\n            return this.renderList[key] = value;\r\n          },\r\n          isOnRenderList: function (key) {\r\n            return this.renderList.hasOwnProperty(key);\r\n          },\r\n          isRenderListEmpty: function () {\r\n            return Object.keys(this.renderList).length === 0;\r\n          },\r\n          getRenderList: function () {\r\n            return this.renderList;\r\n          },\r\n          refreshZone: function () {\r\n            var view = instanceInterface.getView();\r\n\r\n            this.zoneChanged = false;\r\n            if (view.altitude >= this.farDistanceThreshold.value) {\r\n              // Mil-std single point icons are shown as an ellipses colored with the corresponding affiliation and\r\n              // labels are turned off.\r\n              if (this.viewInZone !== \"farDistanceZone\") {\r\n                this.zoneChanged = true;\r\n                this.viewInZone = \"farDistanceZone\";\r\n              }\r\n            } else if (view.altitude >= this.midDistanceThreshold) {\r\n              // Mil-std single point icons are displayed in normal fashion and labels are turned off.\r\n              if (this.viewInZone !== \"midDistanceZone\") {\r\n                this.zoneChanged = true;\r\n                this.viewInZone = \"midDistanceZone\";\r\n              }\r\n            } else {\r\n              // Mil-std single point icons are displayed in normal fashion and the current label setting state is used.\r\n              if (this.viewInZone !== null) {\r\n                this.zoneChanged = true;\r\n                this.viewInZone = null;\r\n              }\r\n            }\r\n          }\r\n        },\r\n        engineParameters: args,\r\n        selectAttributes: {\r\n            color: 'F0F000',\r\n            opacity: 1.0,\r\n            width: 5\r\n        },\r\n        selectLabelStyle: new cmapi.IGeoLabelStyle({\r\n            color: selectedGeoColor,\r\n            size: 12,\r\n            fontFamily: 'Arial'\r\n        }),\r\n        defaultLabelStyle: new cmapi.IGeoLabelStyle({\r\n            color: new cmapi.IGeoColor({\r\n                red: 0,\r\n                green: 0,\r\n                blue: 0\r\n            }),\r\n            fontFamily: 'Arial'\r\n        }),\r\n        defaultStrokeStyle: {\r\n            color: '000000',\r\n            opacity: 1.0,\r\n            width: 3\r\n        },\r\n        sContentCoreId: emp.helpers.id.newGUID(),\r\n        overlays: {},\r\n        tacticalGraphics: {},\r\n        dMaxLabelScale: 10000000,\r\n        rangeToScaleMultiplier: 10.0 / 3.0,\r\n        zoomScaleMap: [\r\n            500000000,\r\n            250000000,\r\n            150000000,\r\n            70000000,\r\n            35000000,\r\n            15000000,\r\n            10000000,\r\n            4000000,\r\n            2000000,\r\n            1000000,\r\n            500000,\r\n            250000,\r\n            150000,\r\n            70000,\r\n            35000,\r\n            15000,\r\n            8000,\r\n            4000,\r\n            2000,\r\n            1000,\r\n            500,\r\n            250,\r\n            125\r\n        ],\r\n        rootOverlayId: undefined,\r\n        rootOverlay: undefined,\r\n        mapEngObjectList: {},\r\n        bInDrawMode: false,\r\n        bInEditMode: false,\r\n        oSelectionManager: undefined,\r\n        oLabelList: [],\r\n        iMilStdIconSize: 24,\r\n        oLayerControl: undefined,\r\n        hTGRenderingTimer: undefined,\r\n        oGraphicsInViewingArea: [],\r\n        oCurrentEditor: undefined,\r\n        oEditTransaction: undefined,\r\n        oTransactionList: {},\r\n        oZoomControl: undefined,\r\n        getLeafletMap: function () {\r\n            return instanceInterface.leafletInstance;\r\n        },\r\n        getProxyURL: function () {\r\n            return instanceInterface.engineParameters.empProxyURL;\r\n        },\r\n        getBasePath: function () {\r\n            return instanceInterface.engineParameters.engineBasePath;\r\n        },\r\n        addEmpObject: function (oEmpObject) {\r\n            instanceInterface.mapEngObjectList[oEmpObject.getCoreId()] = oEmpObject;\r\n        },\r\n        removeEmpObject: function (oEmpObject) {\r\n            if (instanceInterface.mapEngObjectList[oEmpObject.getCoreId()] !== undefined) {\r\n                delete instanceInterface.mapEngObjectList[oEmpObject.getCoreId()];\r\n            }\r\n        },\r\n        storeTransaction: function (oTransaction) {\r\n            if (instanceInterface.oTransactionList[oTransaction.transactionId] === undefined) {\r\n                instanceInterface.oTransactionList[oTransaction.transactionId] = oTransaction;\r\n            }\r\n        },\r\n        findTransaction: function (oTranID) {\r\n            return instanceInterface.oTransactionList[oTranID];\r\n        },\r\n        findTransactionByIntent: function (sIntent) {\r\n            var sTranID;\r\n            var oTransaction;\r\n            var aRetList = [];\r\n            var aKeyList = emp.helpers.associativeArray.getKeys(instanceInterface.oTransactionList);\r\n\r\n            for (var iIndex = 0; iIndex < aKeyList.length; iIndex++) {\r\n                sTranID = aKeyList[iIndex];\r\n                oTransaction = instanceInterface.oTransactionList[sTranID];\r\n\r\n                if (oTransaction.intent === sIntent) {\r\n                    aRetList.push(oTransaction);\r\n                }\r\n            }\r\n\r\n            return aRetList;\r\n        },\r\n        removeTransaction: function (oTranID) {\r\n            if (instanceInterface.oTransactionList.hasOwnProperty(oTranID)) {\r\n                delete instanceInterface.oTransactionList[oTranID];\r\n            }\r\n        },\r\n        getEmpObject: function (sCoreId) {\r\n            if (!sCoreId) {\r\n                return rootOverlay;\r\n            }\r\n\r\n            return instanceInterface.mapEngObjectList[sCoreId];\r\n        },\r\n        handleFeatureClicked: function (oEvent) {\r\n            var oPointerData = instanceInterface.getView();\r\n            var button = oEvent.originalEvent.button;\r\n            var sSelectedID;\r\n\r\n            if ((button === 0) &&\r\n                    !oEvent.originalEvent.altKey &&\r\n                    !oEvent.originalEvent.shiftkey) {\r\n                if (emp.util.config.getAutoSelect()) {\r\n                    if (oEvent.target instanceof leafLet.typeLibrary.Feature) {\r\n                        // Its a feature selection click.\r\n\r\n                        if (oEvent.layer && oEvent.layer.options && oEvent.layer.options.sSubItemID) {\r\n                            sSelectedID = oEvent.layer.options.sSubItemID;\r\n                        }\r\n\r\n                        if (instanceInterface.oSelectionManager.isSelected(oEvent.target, sSelectedID)) {\r\n                            if (!oEvent.originalEvent.ctrlKey) {\r\n                                // Its a single selection.\r\n                                // We must deselected everything that is selected.\r\n                                instanceInterface.oSelectionManager.deselectAllFeatures();\r\n                            } else {\r\n                                instanceInterface.oSelectionManager.deselectFeature(oEvent.target, sSelectedID);\r\n                            }\r\n                        } else {\r\n                            if (!oEvent.originalEvent.ctrlKey) {\r\n                                // Its a single selection.\r\n                                // We must deselected everything that is selected.\r\n                                instanceInterface.oSelectionManager.deselectAllFeatures();\r\n                            }\r\n\r\n                            instanceInterface.oSelectionManager.selectFeature(oEvent.target, sSelectedID);\r\n                        }\r\n                        instanceInterface.oSelectionManager.generateEvent();\r\n                    }\r\n                }\r\n\r\n                if (!oEvent.originalEvent.ctrlKey) {\r\n                    if ((oEvent.target instanceof leafLet.typeLibrary.Feature) ||\r\n                            (oEvent.target instanceof L.MarkerCluster)) {\r\n                        oPointerData.popupInfo = {\r\n                            title: oEvent.target.getPopupHeading(oEvent.layer),\r\n                            content: oEvent.target.getPopupText(oEvent.layer)\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n\r\n            oPointerData.overlayId = oEvent.target.getOverlayId();\r\n            oPointerData.parentId = oEvent.target.getParentId();\r\n            oPointerData.featureId = oEvent.target.getFeatureId();\r\n            oPointerData.target = \"feature\";\r\n            instanceInterface.generatePointerEvent(oEvent, oPointerData);\r\n        },\r\n        // Translate a map scale into a zoom level\r\n        getLevel: function (scale) {\r\n            var len = instanceInterface.zoomScaleMap.length,\r\n                    i,\r\n                    level = 0;\r\n            if (scale > instanceInterface.zoomScaleMap[0]) {\r\n                level = 0;\r\n            } else if (scale < instanceInterface.zoomScaleMap[len - 1]) {\r\n                level = len - 1;\r\n            } else {\r\n                for (i = 0; i < len - 1; i++) {\r\n                    if (scale <= instanceInterface.zoomScaleMap[i] && scale > instanceInterface.zoomScaleMap[i + 1]) {\r\n                        level = i;\r\n                        break;\r\n                    } else if (scale < instanceInterface.zoomScaleMap[i] && scale >= instanceInterface.zoomScaleMap[i + 1]) {\r\n                        level = i + 1;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return level;\r\n        },\r\n        // Translate a zoom level into a map scale\r\n        getScale: function (level) {\r\n            var len = instanceInterface.zoomScaleMap.length,\r\n                    i,\r\n                    scale = instanceInterface.zoomScaleMap[0];\r\n            if (level < 0) {\r\n                scale = instanceInterface.zoomScaleMap[0];\r\n            } else if (level > len - 1) {\r\n                scale = instanceInterface.zoomScaleMap[len - 1];\r\n            } else {\r\n                scale = instanceInterface.zoomScaleMap[level];\r\n            }\r\n            return scale;\r\n        },\r\n        viewToLookAt: function(view) {\r\n            var lookAt = {};\r\n\r\n            if (view) {\r\n                lookAt.latitude = view.lat;\r\n                lookAt.longitude = view.lon;\r\n                lookAt.altitude = 0;\r\n                lookAt.tilt = 0;\r\n                lookAt.heading = 0;\r\n                lookAt.range = view.range;\r\n                lookAt.altitudeMode = view.altitudeMode || emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n            }\r\n\r\n            return lookAt;\r\n        },\r\n        getView: function (oData) {\r\n            var view = oData || {},\r\n                    bounds = instanceInterface.leafletInstance.getBounds(),\r\n                    center = instanceInterface.leafletInstance.getCenter().wrap(),\r\n                    level = instanceInterface.leafletInstance.getZoom();\r\n\r\n            leafLet.utils.convertViewBound(bounds, view);\r\n\r\n            view.lat = center.lat;\r\n            view.lon = center.lng;\r\n\r\n            view.bounds = {\r\n                north: view.north,\r\n                south: view.south,\r\n                east: view.east,\r\n                west: view.west\r\n            };\r\n            view.location = {\r\n                lon: view.lon,\r\n                lat: view.lat\r\n            };\r\n            view.mgrs = emp.geoLibrary.ddToMGRS(view.lat, view.lon);\r\n            // Translate the map zoom level to a map scale\r\n            view.scale = instanceInterface.getScale(level);\r\n            // Convert map scale to camera range\r\n            view.range = view.scale / instanceInterface.rangeToScaleMultiplier;\r\n            view.altitude = view.range;\r\n            view.roll = 0;\r\n            view.tilt = 0;\r\n            view.heading = 0;\r\n\r\n            view.altitude = view.range;\r\n            view.tilt = 0;\r\n            view.roll = 0;\r\n            view.heading = 0;\r\n\r\n            return view;\r\n        },\r\n        generatePointerEvent: function (oEvent, oData) {\r\n            var button = (oEvent.originalEvent ? oEvent.originalEvent.button : 0),\r\n                    pointer = oData || instanceInterface.getView(),\r\n                    level = instanceInterface.leafletInstance.getZoom(),\r\n                    oLL = oEvent.latlng.wrap();\r\n\r\n            pointer.lat = oLL.lat;\r\n            pointer.lon = oLL.lng;\r\n            pointer.elevation = oData.range;\r\n\r\n            switch (button) {\r\n                case 0:\r\n                    pointer.button = \"left\";\r\n                    break;\r\n                case 1:\r\n                    pointer.button = \"middle\";\r\n                    break;\r\n                case 2:\r\n                    pointer.button = \"right\";\r\n                    break;\r\n            }\r\n\r\n            switch (oEvent.type) {\r\n                case 'click':\r\n                case 'contextmenu':\r\n                    pointer.type = emp.typeLibrary.Pointer.EventType.SINGLE_CLICK;\r\n                    break;\r\n                case 'dblclick':\r\n                    pointer.type = emp.typeLibrary.Pointer.EventType.DBL_CLICK;\r\n                    break;\r\n                case 'mousedown':\r\n                    pointer.type = emp.typeLibrary.Pointer.EventType.MOUSEDOWN;\r\n                    break;\r\n                case 'mouseup':\r\n                    pointer.type = emp.typeLibrary.Pointer.EventType.MOUSEUP;\r\n                    break;\r\n                case 'mousemove':\r\n                    pointer.type = emp.typeLibrary.Pointer.EventType.MOVE;\r\n                    break;\r\n            }\r\n\r\n            if (oEvent.hasOwnProperty('containerPoint')) {\r\n                pointer.clientX = oEvent.containerPoint.x; // .originalEvent.clientX;\r\n                pointer.clientY = oEvent.containerPoint.y; // .originalEvent.clientY;\r\n            } else {\r\n                var oPoint = instanceInterface.leafletInstance.latLngToContainerPoint(oEvent.latlng);\r\n                pointer.clientX = oPoint.x;\r\n                pointer.clientY = oPoint.y;\r\n            }\r\n            pointer.screenX = oEvent.originalEvent.pageX; //screenX;\r\n            pointer.screenY = oEvent.originalEvent.pageY; //screenY;\r\n\r\n            if (!pointer.hasOwnProperty('target')) {\r\n                pointer.target = \"globe\";\r\n            }\r\n\r\n            pointer.altKey = oEvent.originalEvent.altKey;\r\n            pointer.ctrlKey = oEvent.originalEvent.ctrlKey;\r\n            pointer.shiftKey = oEvent.originalEvent.shiftkey;\r\n            pointer.keys = [];\r\n            if (pointer.altKey) {\r\n                pointer.keys.push(\"alt\");\r\n            }\r\n            if (pointer.ctrlKey) {\r\n                pointer.keys.push(\"ctrl\");\r\n            }\r\n            if (pointer.shiftKey) {\r\n                pointer.keys.push(\"shift\");\r\n            }\r\n            if (pointer.keys.length < 1) {\r\n                pointer.keys.push(\"none\");\r\n            }\r\n\r\n            instanceInterface.empMapInstance.eventing.Pointer(pointer);\r\n        },\r\n        addMapLayer: function (oMap) {\r\n            if (!instanceInterface.leafletInstance.hasLayer(oMap)) {\r\n                instanceInterface.leafletInstance.addLayer(oMap);\r\n            }\r\n        },\r\n        removeMapLayer: function (oMap) {\r\n            if (instanceInterface.leafletInstance.hasLayer(oMap)) {\r\n                instanceInterface.leafletInstance.removeLayer(oMap);\r\n            }\r\n        },\r\n        scheduleRendering: function () {\r\n          var sCoreID,\r\n              i,\r\n              renderList;\r\n\r\n          if (instanceInterface.hTGRenderingTimer) {\r\n            clearTimeout(instanceInterface.hTGRenderingTimer);\r\n            instanceInterface.hTGRenderingTimer = undefined;\r\n          }\r\n\r\n          instanceInterface.oGraphicsInViewingArea = [];\r\n          var oMapBounds = instanceInterface.leafletInstance.getBounds();\r\n          var oEmpMapBounds = new leafLet.typeLibrary.EmpBoundary(oMapBounds.getSouthWest(), oMapBounds.getNorthEast());\r\n          var oFeatureBounds = undefined;\r\n\r\n          for (sCoreID in instanceInterface.mapEngObjectList) {\r\n            if (!instanceInterface.mapEngObjectList.hasOwnProperty(sCoreID)) {\r\n              continue;\r\n            }\r\n            var oEmpObject = instanceInterface.mapEngObjectList[sCoreID];\r\n            if (oEmpObject.getObjectType() === leafLet.typeLibrary.objectType.FEATURE) {\r\n              // Put it on the list only if it's visible\r\n              if (oEmpObject.isVisible()) {\r\n                try {\r\n                  oFeatureBounds = oEmpObject.getFeatureBounds();\r\n                  if (oEmpObject.isMilStd()) {\r\n                    if (oEmpObject.isMultiPointTG()) {\r\n                      // EMP feature object is a TG. Put it on the list only if it's within the bounds.\r\n                      if (oFeatureBounds && oFeatureBounds.intersects(oEmpMapBounds)) {\r\n                        instanceInterface.oGraphicsInViewingArea.push(oEmpObject);\r\n                      }\r\n                    } else {\r\n                      // EMP feature object is a single point icon. Check to see if the view has entered a new zone. If\r\n                      // it has we want to add the feature to the list. If it hasn't then there is no need to redraw and\r\n                      // all that needs to occur is a potential update of the positions.\r\n                      if (instanceInterface.renderingOptimization.zoneChanged &&\r\n                         !instanceInterface.renderingOptimization.isOnRenderList(sCoreID)) {\r\n                          instanceInterface.renderingOptimization.addToRenderList(sCoreID, oEmpObject);\r\n                          instanceInterface.oGraphicsInViewingArea.push(oEmpObject);\r\n                      } else {\r\n                        oEmpObject.updateCoordinates(oMapBounds);\r\n                      }\r\n                    }\r\n                  } else if (oEmpObject.isAirspace() || oEmpObject.isAOI() || oEmpObject.isGeoEllipse()) {\r\n                    // Put it on the list only if it's within the bounds.\r\n                    if (oFeatureBounds && oFeatureBounds.intersects(oEmpMapBounds)) {\r\n                      instanceInterface.oGraphicsInViewingArea.push(oEmpObject);\r\n                    }\r\n                  } else {\r\n                    oEmpObject.updateCoordinates(oMapBounds);\r\n                  }\r\n                } catch (Ex) {\r\n                }\r\n              }\r\n            }\r\n          }\r\n          // Need to check the renderList hash to see if there are any pending items available to re-render.\r\n          // This condition and course of actions must occur because an event which causes a re-render scheduling can\r\n          // generate after the onZoomEnd event and potentially cause the previous rendering execution to abort.\r\n          if (!instanceInterface.renderingOptimization.zoneChanged &&\r\n              !instanceInterface.renderingOptimization.isRenderListEmpty()) {\r\n            renderList = instanceInterface.renderingOptimization.getRenderList();\r\n            for (i in renderList) {\r\n              instanceInterface.oGraphicsInViewingArea.push(renderList[i]);\r\n            }\r\n          }\r\n          if (instanceInterface.oGraphicsInViewingArea.length > 0) {\r\n            instanceInterface.hTGRenderingTimer = setTimeout(instanceInterface.RerenderingTimerHdlr, 500);\r\n          }\r\n        },\r\n        RerenderingTimerHdlr: function () {\r\n          var iIndex = 0,\r\n              currentGraphic,\r\n              removedGraphicId;\r\n\r\n          while (instanceInterface.oGraphicsInViewingArea.length > 0) {\r\n            if (iIndex === 100) {\r\n              instanceInterface.hTGRenderingTimer = setTimeout(instanceInterface.RerenderingTimerHdlr, 100);\r\n              return;\r\n            }\r\n\r\n            if (instanceInterface.oGraphicsInViewingArea[0].isInEditMode()) {\r\n              instanceInterface.oCurrentEditor.render();\r\n            } else {\r\n              instanceInterface.oGraphicsInViewingArea[0].render();\r\n            }\r\n            currentGraphic = instanceInterface.oGraphicsInViewingArea.splice(0, 1);\r\n            removedGraphicId = currentGraphic[0].options.featureId;\r\n            if (instanceInterface.renderingOptimization.isOnRenderList(removedGraphicId)) {\r\n              instanceInterface.renderingOptimization.removeFromRenderList(removedGraphicId);\r\n            }\r\n            iIndex++;\r\n          }\r\n        },\r\n        processViewSetTrans: function () {\r\n            var oTrans;\r\n            var aViewSetTransList = instanceInterface.findTransactionByIntent(emp.intents.control.VIEW_SET);\r\n\r\n            for (var iIndex = 0; iIndex < aViewSetTransList.length; iIndex++) {\r\n                oTrans = aViewSetTransList[iIndex];\r\n                instanceInterface.getView(oTrans.items[0]);\r\n                instanceInterface.removeTransaction(oTrans.transactionId);\r\n                oTrans.run();\r\n            }\r\n        },\r\n        mapResizeFn: function () {\r\n            instanceInterface.getLeafletMap()._onResize();\r\n        },\r\n        isV2Core: function () {\r\n            return instanceInterface.bIsV2Core;\r\n        },\r\n        setLookAt: function(lookAt) {\r\n            var range;\r\n            var tilt;\r\n            var oMap = instanceInterface.getLeafletMap();\r\n            var level = oMap.getZoom();\r\n\r\n            if (lookAt) {\r\n                // We project the range on to the vertical so the camera is at the correct altitude but looking down.\r\n                range = lookAt.altitude + (lookAt.range * Math.cos(lookAt.tilt));\r\n\r\n                if (range < instanceInterface.zoomScaleMap[instanceInterface.zoomScaleMap.length - 1]) {\r\n                    range = instanceInterface.zoomScaleMap[instanceInterface.zoomScaleMap.length - 1];\r\n                }\r\n\r\n                // Leaflet is a 2D map, so we do not need to deal with the altitude.\r\n\r\n                try {\r\n                    oMap.setView(new L.LatLng(lookAt.latitude, lookAt.longitude), level, {animate: false});\r\n                    if (range && !isNaN(range)) {\r\n                        level = instanceInterface.getLevel(range * instanceInterface.rangeToScaleMultiplier);\r\n                        oMap.setZoom(level, {animate: false});\r\n                    }\r\n\r\n                    return true;\r\n                } catch (err) {\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    };\r\n\r\n    engineInterface.initialize.succeed = function () {\r\n        var oLayerList = [];\r\n        var oLayerEntry;\r\n        var oControl;\r\n        var oLeafletContent;\r\n        var sCoreId = instanceInterface.sContentCoreId;\r\n        var myElement = document.getElementById(instanceInterface.engineParameters.container);\r\n\r\n        window.addResizeListener(myElement, instanceInterface.mapResizeFn);\r\n\r\n        if (bounds !== undefined) {\r\n            instanceInterface.leafletInstance.fitBounds(bounds);\r\n        }\r\n\r\n        instanceInterface.oSelectionManager = new leafLet.SelectionManager({\r\n            mapInstance: instanceInterface.empMapInstance\r\n        });\r\n        instanceInterface.rootOverlayId = emp.helpers.id.newGUID();\r\n        instanceInterface.mapEngObjectList = {};\r\n\r\n        oLeafletContent = new emp.typeLibrary.Static({\r\n            name: 'Leaflet Content',\r\n            featureId: sCoreId,\r\n            overlayId: emp.storage.getRootGuid(instanceInterface.empMapInstance.mapInstanceId),\r\n            visible: true,\r\n            coreId: sCoreId,\r\n            coreParent: emp.storage.getRootGuid(instanceInterface.empMapInstance.mapInstanceId)\r\n        });\r\n        oLayerList.push(oLeafletContent);\r\n\r\n        oControl = new L.Control.Scale({\r\n            position: 'bottomright',\r\n            maxWidth: 200,\r\n            imperial: false,\r\n            metric: true,\r\n            objectType: leafLet.typeLibrary.objectType.LL_CONTROL,\r\n            coreId: emp.helpers.id.newGUID()\r\n        });\r\n\r\n        oLayerEntry = new emp.typeLibrary.Static({\r\n            name: 'Scale Bar',\r\n            featureId: oControl.getCoreId(),\r\n            overlayId: sCoreId,\r\n            visible: true,\r\n            coreId: oControl.getCoreId(),\r\n            coreParent: sCoreId\r\n        });\r\n        oLayerList.push(oLayerEntry);\r\n\r\n        instanceInterface.addEmpObject(oControl);\r\n        instanceInterface.leafletInstance.addControl(oControl);\r\n\r\n        oControl = new L.Control.Zoom({\r\n            position: 'topright',\r\n            objectType: leafLet.typeLibrary.objectType.LL_CONTROL,\r\n            coreId: emp.helpers.id.newGUID()\r\n        });\r\n\r\n        instanceInterface.oZoomControl = oControl;\r\n\r\n        oLayerEntry = new emp.typeLibrary.Static({\r\n            name: 'Zoom Buttons',\r\n            featureId: oControl.getCoreId(),\r\n            overlayId: sCoreId,\r\n            visible: true,\r\n            coreId: oControl.getCoreId(),\r\n            coreParent: sCoreId\r\n        });\r\n        oLayerList.push(oLayerEntry);\r\n\r\n        instanceInterface.addEmpObject(oControl);\r\n        instanceInterface.leafletInstance.addControl(oControl);\r\n\r\n        if (instanceInterface.engineParameters.tileLayer.path\r\n                && !emp.helpers.isEmptyString(instanceInterface.engineParameters.tileLayer.path)) {\r\n            var oMainMap;\r\n\r\n            if (instanceInterface.engineParameters.tileLayer.path.indexOf(\"{x}\") !== -1) {\r\n                // The initial map must be a Tile Server and not a WMS server.\r\n                instanceInterface.engineParameters.tileLayer.properties.instanceInterface = instanceInterface;\r\n                oMainMap = L.tileLayer(instanceInterface.engineParameters.tileLayer.path,\r\n                        instanceInterface.engineParameters.tileLayer.properties);\r\n\r\n                oLayerEntry = new emp.typeLibrary.Static({\r\n                    name: 'Default Map',\r\n                    featureId: oMainMap.getCoreId(),\r\n                    overlayId: sCoreId,\r\n                    visible: true,\r\n                    coreId: oMainMap.getCoreId(),\r\n                    coreParent: sCoreId\r\n                });\r\n                oLayerList.push(oLayerEntry);\r\n\r\n                instanceInterface.addEmpObject(oMainMap);\r\n                instanceInterface.addMapLayer(oMainMap);\r\n            }\r\n        }\r\n\r\n        if (oLayerList.length > 0) {\r\n            instanceInterface.empMapInstance.eventing.StaticContent(oLayerList);\r\n        }\r\n\r\n        instanceInterface.rootOverlay = new leafLet.typeLibrary.Overlay({\r\n            item: {\r\n                coreId: instanceInterface.rootOverlayId,\r\n                name: \"root Overlay\",\r\n                visible: true,\r\n                properties: {}\r\n            },\r\n            instanceInterface: instanceInterface\r\n        });\r\n\r\n        instanceInterface.addEmpObject(instanceInterface.rootOverlay);\r\n        instanceInterface.leafletInstance.addLayer(instanceInterface.rootOverlay);\r\n\r\n        setupEventListeners();\r\n        /*\r\n         instanceInterface.oLabelList.push(\"V\");\r\n         instanceInterface.oLabelList.push(\"L\");\r\n         instanceInterface.oLabelList.push(\"S\");\r\n         instanceInterface.oLabelList.push(\"AA\");\r\n         instanceInterface.oLabelList.push(\"AB\");\r\n         instanceInterface.oLabelList.push(\"AC\");\r\n         instanceInterface.oLabelList.push(\"H\");\r\n         instanceInterface.oLabelList.push(\"M\");\r\n         instanceInterface.oLabelList.push(\"T\");\r\n         instanceInterface.oLabelList.push(\"T1\");\r\n         instanceInterface.oLabelList.push(\"CN\");\r\n         instanceInterface.oLabelList.push(\"C\");\r\n         instanceInterface.oLabelList.push(\"F\");\r\n         instanceInterface.oLabelList.push(\"G\");\r\n         instanceInterface.oLabelList.push(\"H1\");\r\n         instanceInterface.oLabelList.push(\"H2\");\r\n         instanceInterface.oLabelList.push(\"J\");\r\n         instanceInterface.oLabelList.push(\"K\");\r\n         instanceInterface.oLabelList.push(\"N\");\r\n         instanceInterface.oLabelList.push(\"P\");\r\n         instanceInterface.oLabelList.push(\"W\");\r\n         instanceInterface.oLabelList.push(\"W1\");\r\n         instanceInterface.oLabelList.push(\"X\");\r\n         instanceInterface.oLabelList.push(\"Y\");\r\n         instanceInterface.oLabelList.push(\"Z\");\r\n         */\r\n        instanceInterface.iMilStdIconSize = 24;\r\n\r\n        checkMapWidth();\r\n        if (instanceInterface.renderingOptimization.enabled) {\r\n            instanceInterface.renderingOptimization.refreshZone();\r\n        }\r\n        //notify application that the map is ready to recieve data\r\n        instanceInterface.empMapInstance.eventing.StatusChange({status: emp.map.states.READY});\r\n    };\r\n\r\n    engineInterface.initialize.fail = function (args) {\r\n        instanceInterface.empMapInstance.eventing.StatusChange({\r\n            status: emp.map.states.MAP_INSTANCE_INIT_FAILED\r\n        });\r\n    };\r\n\r\n    function checkMapWidth() {\r\n        var oMapBounds;\r\n        var center;\r\n        var angularWidth;\r\n        var iZoom;\r\n\r\n        oMapBounds = instanceInterface.leafletInstance.getBounds();\r\n        center = instanceInterface.leafletInstance.getCenter();\r\n        angularWidth = Math.abs(oMapBounds.getEast() - oMapBounds.getWest());\r\n\r\n        //console.log(\"Deg Wide : \" + angularWidth);\r\n        // We must make sure we don't zoom out beyond 180 deg width. The render has problems rendering\r\n        // graphics when the BBox is wider than 180.\r\n        if (angularWidth >= 180.0) {\r\n            iZoom = instanceInterface.leafletInstance.getZoom() + 1;\r\n            instanceInterface.leafletInstance.setView(center, iZoom, {animate: false});\r\n        }\r\n    };\r\n\r\n    function checkMapCenter() {\r\n        // Leaflet allows the map to be moved out of view north or south.\r\n        // This code is here to stop this from happening.\r\n        var oMapBounds,\r\n                oNorthWest,\r\n                oTopLeft,\r\n                oSouthEast,\r\n                oBottomRight,\r\n                $Container,\r\n                iContainerHeight;\r\n\r\n        oMapBounds = instanceInterface.leafletInstance.getBounds();\r\n\r\n        oNorthWest = new L.LatLng(oMapBounds.getNorth(), oMapBounds.getWest());\r\n        oTopLeft = instanceInterface.leafletInstance.latLngToContainerPoint(oNorthWest);\r\n\r\n        if (oTopLeft.y > 10) {\r\n            //console.log(\"TopLeft X:\" + oTopLeft.x + \" Y:\" + oTopLeft.y);\r\n            oTopLeft.x = 0;\r\n            instanceInterface.leafletInstance.panBy(oTopLeft, {animate: false});\r\n        } else {\r\n            $Container = $(instanceInterface.leafletInstance.getContainer());\r\n            iContainerHeight = $Container.height();\r\n            oSouthEast = new L.LatLng(oMapBounds.getSouth(), oMapBounds.getEast());\r\n            oBottomRight = instanceInterface.leafletInstance.latLngToContainerPoint(oSouthEast);\r\n\r\n            if (oBottomRight.y < iContainerHeight) {\r\n                //console.log(\"BottomRight X:\" + oBottomRight.x + \" Y:\" + oBottomRight.y);\r\n                oBottomRight.x = 0;\r\n                oBottomRight.y = oBottomRight.y - iContainerHeight;\r\n                instanceInterface.leafletInstance.panBy(oBottomRight, {animate: false});\r\n            }\r\n        }\r\n    };\r\n\r\n    function setupEventListeners() {\r\n        function onMouseMove(e) {\r\n            var eventData = {};\r\n            eventData.lat = e.latlng.lat;\r\n            eventData.lon = leafLet.utils.normilizeLongitude(e.latlng.lng);\r\n            eventData.mgrs = emp.geoLibrary.ddToMGRS(eventData.lat, eventData.lon);\r\n            eventData.type = emp.typeLibrary.Pointer.EventType.MOVE;\r\n            instanceInterface.empMapInstance.eventing.Pointer(eventData);\r\n        }\r\n\r\n        function onMoveEnd(e) {\r\n          var center,\r\n              mapBounds;\r\n\r\n          checkMapCenter();\r\n          center = instanceInterface.leafletInstance.getCenter();\r\n          if ((center.lng < -180.0) || (center.lng > 180.0)) {\r\n            instanceInterface.leafletInstance.setView(center.wrap());\r\n            return;\r\n          }\r\n          if (instanceInterface.renderingOptimization.enabled) {\r\n            instanceInterface.renderingOptimization.refreshZone();\r\n          }\r\n          var view = instanceInterface.getView();\r\n          var lookAt = instanceInterface.viewToLookAt(view);\r\n          instanceInterface.scheduleRendering(view);\r\n          instanceInterface.empMapInstance.eventing.ViewChange(view, lookAt);\r\n          instanceInterface.processViewSetTrans();\r\n        }\r\n\r\n        function onMapClick(e) {\r\n            var button = e.originalEvent.button;\r\n\r\n            if ((button !== 0) ||\r\n                    e.originalEvent.altKey ||\r\n                    !e.originalEvent.ctrlKey ||\r\n                    e.originalEvent.shiftKey) {\r\n                instanceInterface.oSelectionManager.deselectAllFeatures();\r\n                instanceInterface.oSelectionManager.generateEvent();\r\n            }\r\n\r\n            instanceInterface.generatePointerEvent(e, instanceInterface.getView());\r\n            e.originalEvent.preventDefault();\r\n        }\r\n\r\n        function onZoomEnd(oEvent) {\r\n          checkMapWidth();\r\n          //var view = instanceInterface.getView();\r\n          // lookAt = instanceInterface.viewToLookAt(view);\r\n\r\n          //instanceInterface.empMapInstance.eventing.ViewChange(view, lookAt);\r\n          //instanceInterface.processViewSetTrans();\r\n        }\r\n\r\n        function onViewReset(e) {\r\n          //checkMapWidth();\r\n          //instanceInterface.scheduleRendering();\r\n        }\r\n\r\n        function onMouseUpDown(e) {\r\n            instanceInterface.generatePointerEvent(e, instanceInterface.getView());\r\n            e.originalEvent.preventDefault();\r\n        }\r\n\r\n        instanceInterface.leafletInstance.on('mousemove', onMouseMove);\r\n        instanceInterface.leafletInstance.on('moveend', onMoveEnd);\r\n        instanceInterface.leafletInstance.on('mousedown', onMouseUpDown);\r\n        instanceInterface.leafletInstance.on('mouseup', onMouseUpDown);\r\n        instanceInterface.leafletInstance.on('contextmenu', onMapClick);\r\n        instanceInterface.leafletInstance.on('click', onMapClick);\r\n        instanceInterface.leafletInstance.on('viewreset', onViewReset);\r\n        instanceInterface.leafletInstance.on('zoomend', onZoomEnd);\r\n    }\r\n    /*\r\n     // The plugin to do the screen capture requires that leaflet be\r\n     // set L_PREFER_CANVAS = true; which causes all L.Path\r\n     // derived types to fail to generate events.\r\n     // Therefore the current version will not support screenshots.\r\n\r\n     engineInterface.capture.screenshot = function (transaction) {\r\n\r\n     transaction.pause();\r\n     //var box2d = map.getBounds();\r\n\r\n     function doImage(err, canvas) {\r\n\r\n     transaction.items[0].dataUrl = canvas.toDataURL();\r\n     transaction.run();\r\n\r\n     }\r\n     leafletImage(instanceInterface.leafletInstance, doImage);\r\n     };\r\n     */\r\n\r\n    //engineInterface.status = {};\r\n    engineInterface.status.get = function (transaction) {\r\n        var status = new emp.typeLibrary.Status({\r\n            intent: transaction.intent,\r\n            status: getStatus()\r\n        });\r\n        //console.log(\"get status\");\r\n        transaction.items[0] = status;\r\n\r\n        return true;\r\n    };\r\n\r\n    engineInterface.status.reset = function () {\r\n        //console.log(\"reset status\");\r\n    };\r\n\r\n    engineInterface.state.destroy = function () {\r\n        var oEmpObject;\r\n        var myElement = document.getElementById(instanceInterface.engineParameters.container);\r\n\r\n        window.removeResizeListener(myElement, instanceInterface.mapResizeFn);\r\n\r\n        var sKeys = emp.helpers.associativeArray.getKeys(instanceInterface.mapEngObjectList);\r\n\r\n        for (var iIndex = 0; iIndex < sKeys.length; iIndex++) {\r\n            oEmpObject = instanceInterface.mapEngObjectList[sKeys[iIndex]];\r\n            if (oEmpObject) {\r\n                switch (oEmpObject.getObjectType()) {\r\n                    case leafLet.typeLibrary.objectType.LL_CONTROL:\r\n                        if (oEmpObject._map) {\r\n                            instanceInterface.getLeafletMap().removeControl(oEmpObject);\r\n                        }\r\n                        break;\r\n                    case leafLet.typeLibrary.objectType.LL_DEFAULT_MAP:\r\n                        instanceInterface.removeMapLayer(oEmpObject);\r\n                        break;\r\n                    default:\r\n                        oEmpObject.destroy();\r\n                        break;\r\n                }\r\n                instanceInterface.removeEmpObject(oEmpObject);\r\n            }\r\n        }\r\n\r\n        instanceInterface.leafletInstance.remove();\r\n        instanceInterface.leafletInstance = undefined;\r\n        instanceInterface.oSelectionManager.destroy();\r\n        instanceInterface.oSelectionManager = undefined;\r\n        instanceInterface.oLabelList = [];\r\n        instanceInterface.oLayerControl = undefined;\r\n        instanceInterface.oGraphicsInViewingArea = [];\r\n        instanceInterface.mapEngObjectList = undefined;\r\n        instanceInterface.rootOverlayId = undefined;\r\n        instanceInterface.rootOverlay = undefined;\r\n    };\r\n\r\n    engineInterface.visibility.set = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n\r\n            if (item.coreId === instanceInterface.sContentCoreId) {\r\n                // The leaflet content does not really exist.\r\n                continue;\r\n            }\r\n            try {\r\n                var oObject = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                if (oObject !== undefined) {\r\n                    switch (oObject.getObjectType()) {\r\n                        case leafLet.typeLibrary.objectType.LL_CONTROL:\r\n                            if (item.visible) {\r\n                                if (!oObject._map) {\r\n                                    instanceInterface.getLeafletMap().addControl(oObject);\r\n                                }\r\n                            } else {\r\n                                if (oObject._map) {\r\n                                    instanceInterface.getLeafletMap().removeControl(oObject);\r\n                                }\r\n                            }\r\n                            break;\r\n                        case leafLet.typeLibrary.objectType.LL_DEFAULT_MAP:\r\n                            if (item.visible) {\r\n                                instanceInterface.addMapLayer(oObject);\r\n                            } else {\r\n                                instanceInterface.removeMapLayer(oObject);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            oObject.setVisibility(item);\r\n                            break;\r\n                    }\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"Object \" + item.coreId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                    continue;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.overlay.add = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n\r\n            try {\r\n                var oNewOverlay = new leafLet.typeLibrary.Overlay({\r\n                    item: item,\r\n                    instanceInterface: instanceInterface\r\n                });\r\n\r\n                if (oNewOverlay.getParentCoreId() === undefined) {\r\n                    // The parent is the root overlay.\r\n                    instanceInterface.rootOverlay.addChildObject(oNewOverlay);\r\n                } else if (instanceInterface.mapEngObjectList.hasOwnProperty(oNewOverlay.getParentCoreId())) {\r\n                    // The parent exists.\r\n                    var oParentOverlay = instanceInterface.mapEngObjectList[oNewOverlay.getParentCoreId()];\r\n\r\n                    oParentOverlay.addChildObject(oNewOverlay);\r\n                } else {\r\n                    // A map engine does not have to create a parent overlay if it does not exists.\r\n                    // The parent does not exists.\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"Parent overlay \" + item.parentId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                    continue;\r\n                }\r\n\r\n                instanceInterface.addEmpObject(oNewOverlay);\r\n\r\n                if (oNewOverlay.isClusterActive()) {\r\n                    oNewOverlay.activateCluster();\r\n                } else if (oNewOverlay.hasClusterDef()) {\r\n                    oNewOverlay.clusterActivate();\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.overlay.remove = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n            try {\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    // The overlay exists.\r\n                    var oParentOverlay;\r\n                    var oOverlay = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    if (item.parentCoreId === undefined) {\r\n                        // The parent is the root.\r\n                        oParentOverlay = instanceInterface.rootOverlay;\r\n                    } else {\r\n                        oParentOverlay = instanceInterface.mapEngObjectList[item.parentCoreId];\r\n                    }\r\n\r\n                    oParentOverlay.removeChildObject(oOverlay);\r\n                    oOverlay.destroy();\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"Overlay \" + item.overlayId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.overlay.update = function (transaction) {\r\n        var oaItems = transaction.items;\r\n        var oOverlay;\r\n        var oItem;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            oItem = oaItems[iIndex];\r\n            try {\r\n                oOverlay = instanceInterface.getEmpObject(oItem.coreId);\r\n\r\n                if (oOverlay) {\r\n                    // The overlay exists.\r\n                    if (oItem.hasOwnProperty('parentId') &&\r\n                            (oItem.parentId !== oOverlay.getParentId())) {\r\n                        // Its being re-parented.\r\n                        var oParentOverlay = oOverlay.getParentObject();\r\n                        var oNewParent;\r\n\r\n                        if (!oParentOverlay) {\r\n                            transaction.fail(new emp.typeLibrary.Error({\r\n                                coreId: oItem.coreId,\r\n                                level: emp.typeLibrary.Error.level.MAJOR,\r\n                                message: \"Current Parent Overlay \" + oOverlay.getParentId() + \" not found.\"\r\n                            }));\r\n                            iIndex--;\r\n                            continue;\r\n                        }\r\n\r\n                        if (oItem.parentId) {\r\n                            oNewParent = instanceInterface.getEmpObject(oItem.parentId);\r\n                        } else {\r\n                            // If parentId is present but equal null\r\n                            // its being moved to the root.\r\n                            oNewParent = instanceInterface.rootOverlay;\r\n                        }\r\n\r\n                        if (!oNewParent) {\r\n                            transaction.fail(new emp.typeLibrary.Error({\r\n                                coreId: oItem.coreId,\r\n                                level: emp.typeLibrary.Error.level.MAJOR,\r\n                                message: \"New Parent Overlay \" + oItem.parentId + \" not found.\"\r\n                            }));\r\n                            iIndex--;\r\n                            continue;\r\n                        }\r\n\r\n                        oParentOverlay.removeChildObject(oOverlay);\r\n                        oNewParent.addChildObject(oOverlay);\r\n                    }\r\n\r\n                    if (oItem.hasOwnProperty('name') &&\r\n                            (oItem.name !== oOverlay.getName())) {\r\n                        oOverlay.setName(oItem.name);\r\n                    }\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: oItem.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"Overlay \" + oItem.overlayId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: oItem.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.overlay.clear = function (transaction) {\r\n        var i,\r\n                len = transaction.items.length,\r\n                items = transaction.items,\r\n                item,\r\n                overlay;\r\n\r\n        for (i = 0; i < len; i++) {\r\n            try {\r\n                item = items[i];\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    overlay = instanceInterface.mapEngObjectList[item.coreId];\r\n                    overlay.clearChildren();\r\n                }\r\n            } catch (err) {\r\n                transaction.fail([new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        message: \"An error occured while attempting to clear an overlay with the id \" + item.coreId + \" : \",\r\n                        level: emp.typeLibrary.Error.level.MINOR,\r\n                        jsError: err\r\n                    })]);\r\n                i--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.overlay.style = function (transaction) {\r\n        var oaItems = transaction.items;\r\n        var oOverlay;\r\n        var oItem;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            oItem = oaItems[iIndex];\r\n            try {\r\n                oOverlay = instanceInterface.getEmpObject(oItem.coreId);\r\n\r\n                if (oOverlay) {\r\n                    oOverlay.setStyle(oItem.type, oItem.properties);\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: oItem.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"Overlay \" + oItem.overlayId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: oItem.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.overlay.cluster.set = function (transaction) {\r\n        var oOverlay;\r\n        var oItem = transaction.items[0];\r\n\r\n        if (oItem === undefined) {\r\n            transaction.fail([{\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Set transaction with no data.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay = instanceInterface.mapEngObjectList[oItem.getCoreId()];\r\n\r\n        if (!oOverlay) {\r\n            transaction.fail([{\r\n                    coreId: oItem.getCoreId(),\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Set transaction overlay not found.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay.clusterSet(oItem);\r\n    };\r\n\r\n    engineInterface.overlay.cluster.activate = function (transaction) {\r\n        var oOverlay;\r\n        var oItem = transaction.items[0];\r\n\r\n        if (oItem === undefined) {\r\n            transaction.fail([{\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Activate transaction with no data.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay = instanceInterface.mapEngObjectList[oItem.getCoreId()];\r\n\r\n        if (!oOverlay) {\r\n            transaction.fail([{\r\n                    coreId: oItem.getCoreId(),\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Activate transaction overlay not found.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay.clusterActivate();\r\n    };\r\n\r\n    engineInterface.overlay.cluster.deactivate = function (transaction) {\r\n        var oOverlay;\r\n        var oItem = transaction.items[0];\r\n\r\n        if (oItem === undefined) {\r\n            transaction.fail([{\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Deactivate transaction with no data.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay = instanceInterface.mapEngObjectList[oItem.getCoreId()];\r\n\r\n        if (!oOverlay) {\r\n            transaction.fail([{\r\n                    coreId: oItem.getCoreId(),\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Deactivate transaction overlay not found.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay.clusterDeactivate();\r\n    };\r\n\r\n    engineInterface.overlay.cluster.remove = function (transaction) {\r\n        var oOverlay;\r\n        var oItem = transaction.items[0];\r\n\r\n        if (oItem === undefined) {\r\n            transaction.fail([{\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Remove transaction with no data.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay = instanceInterface.mapEngObjectList[oItem.getCoreId()];\r\n\r\n        if (!oOverlay) {\r\n            transaction.fail([{\r\n                    coreId: oItem.getCoreId(),\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay Cluster Remove transaction overlay not found.\"\r\n                }]);\r\n            return;\r\n        }\r\n\r\n        oOverlay.clusterRemove();\r\n    };\r\n\r\n    engineInterface.view.set = function (transaction) {\r\n        var item = transaction.items[0],\r\n                oMap = instanceInterface.getLeafletMap(),\r\n                level = oMap.getZoom(),\r\n                bZoom = ((item.zoom === true) ? true : ((typeof (item.zoom) === 'number') && (item.zoom > 0)) ? true : false);\r\n\r\n        try {\r\n            if (item.location) {\r\n                oMap.setView(new L.LatLng(item.location.lat, item.location.lon), level, {animate: false});\r\n                if (item.range && !isNaN(item.range)) {\r\n                    level = instanceInterface.getLevel(item.range * instanceInterface.rangeToScaleMultiplier);\r\n                    oMap.setZoom(level, {animate: false});\r\n                }\r\n            } else if (item.bounds) {\r\n                var southWest = L.latLng(item.bounds.south, item.bounds.west),\r\n                        northEast = L.latLng(item.bounds.north, item.bounds.east),\r\n                        bounds = L.latLngBounds(southWest, northEast);\r\n\r\n                oMap.fitBounds(bounds);\r\n                if (item.range && !isNaN(item.range)) {\r\n                    level = instanceInterface.getLevel(item.range * instanceInterface.rangeToScaleMultiplier);\r\n                    oMap.setZoom(level, {animate: false});\r\n                }\r\n            } else if (item.featureId || item.overlayId) {\r\n                //result = goToLocationById(item);\r\n                var oEmpObject = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                if (oEmpObject !== undefined) {\r\n                    if (oEmpObject.getObjectType() === leafLet.typeLibrary.objectType.OVERLAY) {\r\n                        // We need to check to see if it has features in it.\r\n                        if (!oEmpObject.hasFeatures()) {\r\n                            transaction.fail(new emp.typeLibrary.Error({\r\n                                coreId: item.coreId,\r\n                                level: emp.typeLibrary.Error.level.MINOR,\r\n                                message: \"Overlay \" + oEmpObject.options.name + \" is empty.\"\r\n                            }));\r\n                            return;\r\n                        }\r\n                    }\r\n                    var oEmpBounds = oEmpObject.getFeatureBounds();\r\n\r\n                    if (oEmpBounds) {\r\n                        if (bZoom) {\r\n                            if (oEmpBounds.getCenterWidth() < 16093) {\r\n                                oEmpBounds.setCenterWidth(16093);\r\n                            }\r\n                            oMap.fitBounds(new L.LatLngBounds(oEmpBounds.getSouthWest(), oEmpBounds.getNorthEast()), {animate: false});\r\n                        } else {\r\n                            var oCenter = oEmpBounds.getCenter();\r\n                            oMap.setView(new L.LatLng(oCenter.lat, oCenter.lng), level, {animate: false});\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n//            else if (item.range || (item.zoom !== false)) {\r\n            else if (item.range) {\r\n                level = instanceInterface.getLevel(item.range * instanceInterface.rangeToScaleMultiplier);\r\n                oMap.setZoom(level, {animate: false});\r\n            }\r\n\r\n            instanceInterface.getView(transaction.items[0]);\r\n        } catch (err) {\r\n            transaction.fail([new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    message: \"An error occured while attempting to set the map view: \",\r\n                    level: emp.typeLibrary.Error.level.MINOR,\r\n                    jsError: err\r\n                })]);\r\n        }\r\n    };\r\n\r\n    engineInterface.view.get = function (transaction) {\r\n        var failList = [];\r\n\r\n        try {\r\n            instanceInterface.getView(transaction.items[0]);\r\n        } catch (err) {\r\n            failList.push(new emp.typeLibrary.Error({\r\n                coreId: transaction.items[0].coreId,\r\n                message: \"An error occurred while getting the maps view: \",\r\n                level: emp.typeLibrary.Error.level.MINOR,\r\n                jsError: err\r\n            }));\r\n            transaction.fail(failList);\r\n        }\r\n        return true;\r\n    };\r\n\r\n    engineInterface.feature.add = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n\r\n            try {\r\n                var oNewFeature;\r\n\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    // Its an update\r\n                    oNewFeature = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    oNewFeature.updateFeature(item);\r\n\r\n                    if (oNewFeature.isInEditMode()) {\r\n                        instanceInterface.oCurrentEditor.render();\r\n                    }\r\n                } else {\r\n                    switch (item.format) {\r\n                        case emp.typeLibrary.featureFormatType.MILSTD:\r\n                            if (instanceInterface.isV2Core()) {\r\n                                emp.util.milstdColorFix(item);\r\n                            }\r\n                            oNewFeature = new leafLet.typeLibrary.MilStdFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.KML:\r\n                            oNewFeature = new leafLet.typeLibrary.KMLFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.GEOJSON:\r\n                        case emp.typeLibrary.featureFormatType.GEO_POINT:\r\n                        case emp.typeLibrary.featureFormatType.GEO_PATH:\r\n                        case emp.typeLibrary.featureFormatType.GEO_POLYGON:\r\n                            if (leafLet.utils.geoJson.isAOI(item)) {\r\n                                oNewFeature = new leafLet.typeLibrary.AOIFeature({\r\n                                    item: item,\r\n                                    instanceInterface: instanceInterface\r\n                                });\r\n                            } else {\r\n                                oNewFeature = new leafLet.typeLibrary.GeoJsonFeature({\r\n                                    item: item,\r\n                                    instanceInterface: instanceInterface\r\n                                });\r\n                            }\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.AIRSPACE:\r\n                            oNewFeature = leafLet.utils.airspace.createAirspace({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.IMAGE:\r\n                            oNewFeature = new leafLet.typeLibrary.ImageFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.GEO_TEXT:\r\n                            oNewFeature = new leafLet.typeLibrary.GeoTextFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.GEO_RECTANGLE:\r\n                            oNewFeature = new leafLet.typeLibrary.GeoRectangleFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.GEO_SQUARE:\r\n                            oNewFeature = new leafLet.typeLibrary.GeoSquareFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.GEO_CIRCLE:\r\n                            oNewFeature = new leafLet.typeLibrary.GeoCircleFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.featureFormatType.GEO_ELLIPSE:\r\n                            oNewFeature = new leafLet.typeLibrary.GeoEllipseFeature({\r\n                                item: item,\r\n                                instanceInterface: instanceInterface\r\n                            });\r\n                            break;\r\n                        default:\r\n                            throw new Error(item.format + \" features are not yet supported.\");\r\n                            //break;\r\n                    }\r\n\r\n                    if (instanceInterface.mapEngObjectList.hasOwnProperty(oNewFeature.getParentCoreId())) {\r\n                        // The parent exists.\r\n                        var oParentOverlay = instanceInterface.mapEngObjectList[oNewFeature.getParentCoreId()];\r\n\r\n                        oParentOverlay.addChildObject(oNewFeature);\r\n                    } else {\r\n                        // A map engine no longer has to create the parent overlay if it does not exists.\r\n                        // The parent does not exists.\r\n                        transaction.fail(new emp.typeLibrary.Error({\r\n                            coreId: item.coreId,\r\n                            level: emp.typeLibrary.Error.level.MAJOR,\r\n                            message: \"Parent \" + item.parentId + \" does not exists.\"\r\n                        }));\r\n                        iIndex--;\r\n                        continue;\r\n                    }\r\n\r\n                    instanceInterface.addEmpObject(oNewFeature);\r\n\r\n                    if (item.zoom && !instanceInterface.bInDrawMode && !instanceInterface.bInEditMode) {\r\n                        var oEmpBounds = oNewFeature.getFeatureBounds();\r\n\r\n                        if (oEmpBounds.getCenterWidth() < 16093) {\r\n                            oEmpBounds.setCenterWidth(16093);\r\n                        }\r\n                        instanceInterface.leafletInstance.fitBounds(new L.LatLngBounds(oEmpBounds.getSouthWest(), oEmpBounds.getNorthEast()));\r\n                    }\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.feature.remove = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n            try {\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    // The feature exists.\r\n                    var oParentOverlay;\r\n                    var oFeature = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    if (oFeature.isInEditMode()) {\r\n                        instanceInterface.oCurrentEditor.cancelEdit();\r\n                        instanceInterface.oCurrentEditor.destroy();\r\n                        instanceInterface.bInEditMode = false;\r\n                        instanceInterface.oCurrentEditor = undefined;\r\n                        instanceInterface.oEditTransaction.run();\r\n                        instanceInterface.oEditTransaction = undefined;\r\n                    }\r\n\r\n                    if (item.parentCoreId === undefined) {\r\n                        // The parent is the root.\r\n                        oParentOverlay = instanceInterface.rootOverlay;\r\n                    } else {\r\n                        oParentOverlay = instanceInterface.mapEngObjectList[item.parentCoreId];\r\n                    }\r\n\r\n                    if (oParentOverlay) {\r\n                        oParentOverlay.removeChildObject(oFeature);\r\n                        oFeature.destroy();\r\n                    } else {\r\n                        transaction.fail(new emp.typeLibrary.Error({\r\n                            coreId: item.coreId,\r\n                            level: emp.typeLibrary.Error.level.MAJOR,\r\n                            message: \"Parent of feature \" + item.featureId + \" was not found.\"\r\n                        }));\r\n                        iIndex--;\r\n                    }\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"Feature \" + item.featureId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.feature.update = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n\r\n            try {\r\n                var oFeature;\r\n\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    // Its an update\r\n                    oFeature = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    if (item.name) {\r\n                        // The Name is changing.\r\n                        oFeature.updateFeature(item);\r\n\r\n                        if (oFeature.isInEditMode()) {\r\n                            instanceInterface.oCurrentEditor.render();\r\n                        }\r\n                    }\r\n\r\n                    if (item.destCoreParent !== undefined) {\r\n                        // Its being re-parented.\r\n                        var oOldParent = instanceInterface.mapEngObjectList[item.parentCoreId];\r\n                        var oNewParent = instanceInterface.mapEngObjectList[item.destCoreParent];\r\n\r\n                        oOldParent.removeChildObject(oFeature);\r\n                        oNewParent.addChildObject(oFeature);\r\n                    }\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"feature \" + item.featureId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                    continue;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.draw.begin = function (transaction) {\r\n        var oDrawItem = transaction.items[0];\r\n        var oOriginalFeature = oDrawItem.originFeature;\r\n        var oFeature;\r\n\r\n        if (oOriginalFeature) {\r\n            oFeature = instanceInterface.mapEngObjectList[oOriginalFeature.coreId];\r\n        }\r\n\r\n        switch (oDrawItem.type.toLowerCase()) {\r\n            case \"point\":\r\n            //case emp.typeLibrary.featureFormatType.GEO_POINT:\r\n                instanceInterface.oCurrentEditor = new leafLet.editor.GeoJson({\r\n                    geoJsonType: 'Point',\r\n                    transaction: transaction,\r\n                    EmpDrawEditItem: oDrawItem,\r\n                    feature: oFeature,\r\n                    instanceInterface: instanceInterface\r\n                });\r\n                break;\r\n            case \"line\":\r\n            case emp.typeLibrary.featureFormatType.GEO_PATH:\r\n                instanceInterface.oCurrentEditor = new leafLet.editor.GeoJson({\r\n                    geoJsonType: 'LineString',\r\n                    transaction: transaction,\r\n                    EmpDrawEditItem: oDrawItem,\r\n                    feature: oFeature,\r\n                    instanceInterface: instanceInterface\r\n                });\r\n                break;\r\n            case \"polygon\":\r\n            //case emp.typeLibrary.featureFormatType.GEO_POLYGON:\r\n                instanceInterface.oCurrentEditor = new leafLet.editor.GeoJson({\r\n                    geoJsonType: 'Polygon',\r\n                    transaction: transaction,\r\n                    EmpDrawEditItem: oDrawItem,\r\n                    feature: oFeature,\r\n                    instanceInterface: instanceInterface\r\n                });\r\n                break;\r\n            case \"airspace\":\r\n                instanceInterface.oCurrentEditor = leafLet.utils.airspace.createEditor(instanceInterface,\r\n                        transaction, oDrawItem, oFeature);\r\n                break;\r\n            case \"milstd\":\r\n                instanceInterface.oCurrentEditor = leafLet.utils.milstd.createEditor(instanceInterface,\r\n                        transaction, oDrawItem, oFeature);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if (instanceInterface.oCurrentEditor) {\r\n            transaction.pause();\r\n            instanceInterface.bInDrawMode = true;\r\n            instanceInterface.oEditTransaction = transaction;\r\n        }\r\n    };\r\n\r\n    engineInterface.draw.end = function (transaction) {\r\n        if (instanceInterface.oEditTransaction.transactionId === transaction.items[0].transactionId) {\r\n            instanceInterface.oCurrentEditor.endEdit();\r\n            instanceInterface.oCurrentEditor.destroy();\r\n            instanceInterface.bInDrawMode = false;\r\n            instanceInterface.oCurrentEditor = undefined;\r\n            instanceInterface.oEditTransaction.run();\r\n            instanceInterface.oEditTransaction = undefined;\r\n        }\r\n    };\r\n\r\n    engineInterface.draw.cancel = function (transaction) {\r\n        if (instanceInterface.oEditTransaction.transactionId === transaction.items[0].transactionId) {\r\n            instanceInterface.oCurrentEditor.cancelEdit();\r\n            instanceInterface.oCurrentEditor.destroy();\r\n            instanceInterface.bInDrawMode = false;\r\n            instanceInterface.oCurrentEditor = undefined;\r\n            instanceInterface.oEditTransaction.run();\r\n            instanceInterface.oEditTransaction = undefined;\r\n        }\r\n    };\r\n\r\n    engineInterface.edit.begin = function (transaction) {\r\n        var oEditItem = transaction.items[0];\r\n        var oFeature;\r\n\r\n        oFeature = instanceInterface.mapEngObjectList[oEditItem.coreId];\r\n\r\n        if (oFeature === undefined) {\r\n            transaction.fail([{\r\n                    coreId: oEditItem.coreId,\r\n                    message: \"Feature not found.\",\r\n                    level: emp.typeLibrary.Error.level.MAJOR\r\n                }]);\r\n        } else if (!oFeature.isEditable()) {\r\n            transaction.fail([{\r\n                    coreId: oEditItem.coreId,\r\n                    message: \"This feature can not be edited.\",\r\n                    level: emp.typeLibrary.Error.level.MAJOR\r\n                }]);\r\n        } else {\r\n            switch (oFeature.getFormat()) {\r\n                case emp.typeLibrary.featureFormatType.GEOJSON:\r\n                case emp.typeLibrary.featureFormatType.GEO_POINT:\r\n                case emp.typeLibrary.featureFormatType.GEO_PATH:\r\n                case emp.typeLibrary.featureFormatType.GEO_POLYGON:\r\n                    if (emp.helpers.isAOI(oFeature.options)) {\r\n                        instanceInterface.oCurrentEditor = new leafLet.editor.AOI({\r\n                            transaction: transaction,\r\n                            EmpDrawEditItem: oEditItem,\r\n                            feature: oFeature,\r\n                            instanceInterface: instanceInterface\r\n                        });\r\n                    } else {\r\n                        instanceInterface.oCurrentEditor = new leafLet.editor.GeoJson({\r\n                            transaction: transaction,\r\n                            EmpDrawEditItem: oEditItem,\r\n                            feature: oFeature,\r\n                            instanceInterface: instanceInterface\r\n                        });\r\n                    }\r\n                    break;\r\n                case emp.typeLibrary.featureFormatType.KML:\r\n                    instanceInterface.oCurrentEditor = new leafLet.editor.KML({\r\n                        transaction: transaction,\r\n                        EmpDrawEditItem: oEditItem,\r\n                        feature: oFeature,\r\n                        instanceInterface: instanceInterface\r\n                    });\r\n                    break;\r\n                case emp.typeLibrary.featureFormatType.MILSTD:\r\n                    instanceInterface.oCurrentEditor = leafLet.utils.milstd.createEditor(instanceInterface,\r\n                            transaction, oEditItem, oFeature);\r\n                    break;\r\n                case emp.typeLibrary.featureFormatType.AIRSPACE:\r\n                    instanceInterface.oCurrentEditor = leafLet.utils.airspace.createEditor(instanceInterface,\r\n                            transaction, oEditItem, oFeature);\r\n                    break;\r\n/*\r\n                case emp.typeLibrary.featureFormatType.GEO_POINT:\r\n                    instanceInterface.oCurrentEditor = new leafLet.editor.GeoPoint({\r\n                        transaction: transaction,\r\n                        EmpDrawEditItem: oEditItem,\r\n                        feature: oFeature,\r\n                        instanceInterface: instanceInterface\r\n                    });\r\n                    break;\r\n*/\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (instanceInterface.oCurrentEditor) {\r\n            transaction.pause();\r\n            instanceInterface.bInEditMode = true;\r\n            instanceInterface.oEditTransaction = transaction;\r\n            instanceInterface.oSelectionManager.deselectAllFeatures();\r\n            instanceInterface.oSelectionManager.selectFeature(oFeature);\r\n            instanceInterface.oSelectionManager.generateEvent();\r\n        }\r\n    };\r\n\r\n    engineInterface.edit.end = function (transaction) {\r\n        if (instanceInterface.oEditTransaction.transactionId === transaction.items[0].transactionId) {\r\n            instanceInterface.oCurrentEditor.endEdit();\r\n            instanceInterface.oCurrentEditor.destroy();\r\n            instanceInterface.bInEditMode = false;\r\n            instanceInterface.oCurrentEditor = undefined;\r\n            instanceInterface.oEditTransaction.run();\r\n            instanceInterface.oEditTransaction = undefined;\r\n        }\r\n    };\r\n\r\n    engineInterface.edit.cancel = function (transaction) {\r\n        if (instanceInterface.oEditTransaction.transactionId === transaction.items[0].transactionId) {\r\n            instanceInterface.oCurrentEditor.cancelEdit();\r\n            instanceInterface.oCurrentEditor.destroy();\r\n            instanceInterface.bInEditMode = false;\r\n            instanceInterface.oCurrentEditor = undefined;\r\n            instanceInterface.oEditTransaction.run();\r\n            instanceInterface.oEditTransaction = undefined;\r\n        }\r\n    };\r\n\r\n    engineInterface.selection.set = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n\r\n            try {\r\n                var oFeature;\r\n\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    oFeature = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    if (item.select) {\r\n                        instanceInterface.oSelectionManager.selectFeature(oFeature, item.selectedId);\r\n                    } else {\r\n                        instanceInterface.oSelectionManager.deselectFeature(oFeature, item.selectedId);\r\n                    }\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"feature \" + item.featureId + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                    continue;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n        instanceInterface.oSelectionManager.resetEventData();\r\n    };\r\n    engineInterface.navigation = engineInterface.navigation || {};\r\n    engineInterface.navigation.enable = function (transaction) {\r\n        var enabled;\r\n        if (transaction && transaction.items) {\r\n            enabled = transaction.items[0];\r\n\r\n            if (enabled.lock && instanceInterface.oZoomControl._map) {\r\n                instanceInterface.leafletInstance.dragging.disable();\r\n                instanceInterface.leafletInstance.scrollWheelZoom.disable();\r\n                instanceInterface.oZoomControl.removeFrom(instanceInterface.leafletInstance);\r\n            } else if (!enabled.lock && (instanceInterface.oZoomControl._map === null)){\r\n                instanceInterface.oZoomControl.addTo(instanceInterface.leafletInstance);\r\n                instanceInterface.leafletInstance.scrollWheelZoom.enable();\r\n                // Default to enabling mouse navigation to avoid an error state where user cannot interact with the map\r\n                instanceInterface.leafletInstance.dragging.enable();\r\n            }\r\n        }\r\n        transaction.run();\r\n    };\r\n\r\n    engineInterface.settings.mil2525.icon.size.set = function (transaction) {\r\n        var oEmpObject;\r\n        var sCoreId;\r\n\r\n        instanceInterface.iMilStdIconSize = transaction.items[0];\r\n\r\n        try {\r\n            for (sCoreId in instanceInterface.mapEngObjectList) {\r\n                if (!instanceInterface.mapEngObjectList.hasOwnProperty(sCoreId)) {\r\n                    continue;\r\n                }\r\n                oEmpObject = instanceInterface.mapEngObjectList[sCoreId];\r\n\r\n                if ((oEmpObject.getObjectType() === leafLet.typeLibrary.objectType.FEATURE) &&\r\n                        (oEmpObject.getFormat() === emp.typeLibrary.featureFormatType.MILSTD) &&\r\n                        !oEmpObject.isMultiPointTG()) {\r\n                    oEmpObject.updateIconSize();\r\n                }\r\n            }\r\n        } catch (Ex) {\r\n            new emp.typeLibrary.Error({\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: Ex.name + \": \" + Ex.message,\r\n                jsError: Ex\r\n            });\r\n        }\r\n    };\r\n\r\n    engineInterface.settings.mil2525.icon.labels.set = function (transaction) {\r\n        var oEmpObject;\r\n        var sCoreId;\r\n\r\n        try {\r\n            var sTemp = JSON.stringify(transaction.items[0]);\r\n            instanceInterface.oLabelList = JSON.parse(sTemp);\r\n\r\n            for (sCoreId in instanceInterface.mapEngObjectList) {\r\n                if (!instanceInterface.mapEngObjectList.hasOwnProperty(sCoreId)) {\r\n                    continue;\r\n                }\r\n                oEmpObject = instanceInterface.mapEngObjectList[sCoreId];\r\n\r\n                if ((oEmpObject instanceof leafLet.typeLibrary.MilStdFeature) && !oEmpObject.isMultiPointTG()) {\r\n                    oEmpObject.updateFeature({bUpdateGraphic: true});\r\n                }\r\n            }\r\n        } catch (Ex) {\r\n            new emp.typeLibrary.Error({\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: Ex.name + \": \" + Ex.message,\r\n                jsError: Ex\r\n            });\r\n        }\r\n    };\r\n\r\n    engineInterface.wms.add = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n\r\n            try {\r\n                var oNewWMS;\r\n\r\n                if (instanceInterface.isV2Core()) {\r\n                    item.useProxy = emp.util.config.getUseProxySetting();\r\n                }\r\n\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    // Its an update\r\n                    oNewWMS = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    oNewWMS.updateWMS(item);\r\n                } else {\r\n                    oNewWMS = new leafLet.typeLibrary.WMS({\r\n                        item: item,\r\n                        instanceInterface: instanceInterface\r\n                    });\r\n\r\n                    if (instanceInterface.mapEngObjectList.hasOwnProperty(oNewWMS.getParentCoreId())) {\r\n                        // The parent exists.\r\n                        var oParentOverlay = instanceInterface.mapEngObjectList[oNewWMS.getParentCoreId()];\r\n\r\n                        oParentOverlay.addChildObject(oNewWMS);\r\n                    } else {\r\n                        // The parent does not exists.\r\n                        item.createParent();\r\n                        if (instanceInterface.mapEngObjectList.hasOwnProperty(oNewWMS.getParentCoreId())) {\r\n                            // The parent exists.\r\n                            var oParentOverlay = instanceInterface.mapEngObjectList[oNewWMS.getParentCoreId()];\r\n\r\n                            oParentOverlay.addChildObject(oNewWMS);\r\n                        } else {\r\n                            transaction.fail(new emp.typeLibrary.Error({\r\n                                coreId: item.coreId,\r\n                                level: emp.typeLibrary.Error.level.MAJOR,\r\n                                message: \"Parent \" + oNewWMS.getParentCoreId() + \" does not exists.\"\r\n                            }));\r\n                            iIndex--;\r\n                            continue;\r\n                        }\r\n                    }\r\n\r\n                    instanceInterface.addEmpObject(oNewWMS);\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.wms.remove = function (transaction) {\r\n        var oaItems = transaction.items;\r\n\r\n        for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n            var item = oaItems[iIndex];\r\n            try {\r\n                if (instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)) {\r\n                    // The feature exists.\r\n                    var oParentOverlay;\r\n                    var oFeature = instanceInterface.mapEngObjectList[item.coreId];\r\n\r\n                    if (item.parentCoreId === undefined) {\r\n                        // The parent is the root.\r\n                        oParentOverlay = instanceInterface.rootOverlay;\r\n                    } else {\r\n                        oParentOverlay = instanceInterface.mapEngObjectList[item.parentCoreId];\r\n                    }\r\n\r\n                    oParentOverlay.removeChildObject(oFeature);\r\n                    oFeature.destroy();\r\n                } else {\r\n                    transaction.fail(new emp.typeLibrary.Error({\r\n                        coreId: item.coreId,\r\n                        level: emp.typeLibrary.Error.level.MAJOR,\r\n                        message: \"WMS \" + item.id + \" does not exists.\"\r\n                    }));\r\n                    iIndex--;\r\n                }\r\n            } catch (Ex) {\r\n                transaction.fail(new emp.typeLibrary.Error({\r\n                    coreId: item.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: Ex.name + \": \" + Ex.message,\r\n                    jsError: Ex\r\n                }));\r\n                iIndex--;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.view.getLatLonFromXY = function (transaction) {\r\n        var item;\r\n        var oLatLng;\r\n        var oPoint;\r\n\r\n        for (var i = 0; i < transaction.items.length; i += 1) {\r\n            item = transaction.items[i];\r\n\r\n            oPoint = new L.Point(item.x, item.y);\r\n            oLatLng = instanceInterface.leafletInstance.containerPointToLatLng(oPoint);\r\n\r\n            if (oLatLng) {\r\n                item.lat = oLatLng.lat;\r\n                item.lon = oLatLng.lng;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.view.getXYFromLatLon = function (transaction) {\r\n        var item;\r\n        var oLatLng;\r\n        var oPoint;\r\n\r\n        for (var i = 0; i < transaction.items.length; i += 1) {\r\n            item = transaction.items[i];\r\n\r\n            oLatLng = new L.LatLng(item.lat, item.lon);\r\n\r\n            oPoint = instanceInterface.leafletInstance.latLngToContainerPoint(oLatLng);\r\n\r\n            if (oPoint) {\r\n                item.x = oPoint.x;\r\n                item.y = oPoint.y;\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.lookAt.set = function(transaction) {\r\n        var iIndex;\r\n\r\n        for (iIndex = 0; iIndex < transaction.items.length; iIndex += 1) {\r\n            if (instanceInterface.setLookAt(transaction.items[iIndex])) {\r\n                iIndex++;\r\n            } else {\r\n                transaction.fail([{\r\n                    coreId: transaction.items[iIndex].coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Fail to set LookAt.\"\r\n                }]);\r\n            }\r\n        }\r\n    };\r\n\r\n    engineInterface.map.config = function (transaction) {\r\n      var iIndex,\r\n          prop,\r\n          previousRenderSettings = {\r\n            enabled: instanceInterface.renderingOptimization.enabled,\r\n            midDistanceThreshold: instanceInterface.renderingOptimization.midDistanceThreshold,\r\n            farDistanceThreshold: instanceInterface.renderingOptimization.farDistanceThreshold.value\r\n          },\r\n          newConfig;\r\n\r\n      for (iIndex = 0; iIndex < transaction.items.length; iIndex += 1) {\r\n        newConfig = transaction.items[0];\r\n        try {\r\n          for (prop in newConfig) {\r\n            switch (prop) {\r\n              case \"renderingOptimization\":\r\n                if (typeof newConfig[prop] !== 'boolean') {\r\n                  throw new Error(\"'renderingOptimization' property must be of Boolean type.\");\r\n                }\r\n                instanceInterface.renderingOptimization.enabled = newConfig[prop];\r\n                break;\r\n              case \"midDistanceThreshold\":\r\n                if (typeof newConfig[prop] !== 'number') {\r\n                  throw new Error(\"'midDistanceThreshold' property must be of Number type.\");\r\n                }\r\n                instanceInterface.renderingOptimization.midDistanceThreshold = newConfig[prop];\r\n                break;\r\n              case \"farDistanceThreshold\":\r\n                if (typeof newConfig[prop] !== 'number') {\r\n                  throw new Error(\"'farDistanceThreshold' property must be of Number type.\");\r\n                }\r\n                instanceInterface.renderingOptimization.farDistanceThreshold.value = newConfig[prop];\r\n                break;\r\n              case \"brightness\":\r\n                break;\r\n            }\r\n          }\r\n          if (previousRenderSettings.enabled) {\r\n            // In both of these cases a change has occured from the previous state of the configuration attributes which\r\n            // must trigger a re-render of the graphics. If previous attributes haven't changed then no re-render should\r\n            // occur.\r\n            if (!instanceInterface.renderingOptimization.enabled) {\r\n              instanceInterface.renderingOptimization.viewInZone = undefined;\r\n              instanceInterface.renderingOptimization.zoneChanged = true;\r\n              instanceInterface.scheduleRendering();\r\n              instanceInterface.renderingOptimization.zoneChanged = false;\r\n            } else if (previousRenderSettings.midDistanceThreshold !== instanceInterface.renderingOptimization.midDistanceThreshold ||\r\n                       previousRenderSettings.farDistanceThreshold !== instanceInterface.renderingOptimization.farDistanceThreshold.value) {\r\n              instanceInterface.renderingOptimization.refreshZone();\r\n              instanceInterface.scheduleRendering();\r\n              instanceInterface.renderingOptimization.zoneChanged = false;\r\n            }\r\n          } else {\r\n            // If the previous enabled state is false and set to true a re-render must occur. Although the far and mid\r\n            // distance threshold values can change, a re-render is only necessary when the enabled property is set to\r\n            // true.\r\n            if (instanceInterface.renderingOptimization.enabled) {\r\n              instanceInterface.renderingOptimization.refreshZone();\r\n              instanceInterface.scheduleRendering();\r\n              instanceInterface.renderingOptimization.zoneChanged = false;\r\n            }\r\n          }\r\n          transaction.run();\r\n        } catch (e) {\r\n          transaction.fail(new emp.typeLibrary.Error({\r\n            coreId: item.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: Ex.name + \": \" + Ex.message,\r\n            jsError: Ex\r\n          }));\r\n          iIndex--;\r\n        }\r\n      }\r\n    };\r\n\r\n    engineInterface.implementation.displayName = \"Leaflet Map Engine\";\r\n    engineInterface.implementation.version = \"34.0\";\r\n\r\n    var sGenericHelpText =\r\n            \"<table style='width:100%;padding-top: 10px; border:1px solid #4a4a4a;' >\" +\r\n            \"<thead>\" +\r\n            \"<tr style='border:1px solid #4a4a4a;'>\" +\r\n            \"<th style='border:1px solid #4a4a4a; padding:5px; collapse:collapse;width:40%'>Action</th>\" +\r\n            \"<th style='border:1px solid #4a4a4a; padding:5px; collapse:collapse;width:25%'>Ctrl Point</th>\" +\r\n            \"<th style='border:1px solid #4a4a4a; padding:5px; collapse:collapse;width:35%'>Mouse/ Key</th>\" +\r\n            \"</tr>\" +\r\n            \"</thead>\" +\r\n            \"<tbody>\" +\r\n            \"<tr style='border:0px;'>\" +\r\n            \"<td colspan='3' style='padding: 0px;'>\" +\r\n            \"<div style='overflow:auto; width:100%;'>\" +\r\n            \"<table style='border:1px solid #4a4a4a; collapse:collapse;width:100%;' >\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; width:40%' >Drag laterally to alter the Lat/Long of vertex</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; width:25%;color:blue;vertical-align:middle;text-align:center'>Blue</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; width:35%'>Mouse left button drag</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Drag to alter width</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; color:lightgrey;vertical-align:middle;text-align:center'>Grey</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Drag to alter radius</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; color:grey;vertical-align:middle;text-align:center'>Dark Grey</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Drag to alter angle</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; color:yellow;vertical-align:middle;text-align:center;vertical-align:middle;text-align:center'>Yellow</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Drag laterally to alter shape's side Lat/Long</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; color:cyan;vertical-align:middle;text-align:center'>Cyan</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Add new vertex</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; vertical-align:middle;text-align:center'></td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>left click at location</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Remove selected vertex</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; color:blue;vertical-align:middle;text-align:center'>blue</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>Double left click</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; ' >Drag laterally to alter shape's position</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '></td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag on feature</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px;' >Complete the edit session</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px;vertical-align:middle;text-align:center'></td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px;'>Click the Finish button</td>\" +\r\n            \"</tr>\" +\r\n            \"<tr>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px;' >Cancel the edit session</td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px;vertical-align:middle;text-align:center'></td>\" +\r\n            \"<td style='border:1px solid #4a4a4a;padding:5px;'>Click the Cancel button</td>\" +\r\n            \"</tr>\" +\r\n            \"</table>\" +\r\n            \"</div>\" +\r\n            \"</td>\" +\r\n            \"</tr>\" +\r\n            \"</tbody>\" +\r\n            \"</table>\";\r\n\r\n    engineInterface.implementation.help.edit = sGenericHelpText;\r\n\r\n    engineInterface.implementation.help.draw = sGenericHelpText;\r\n\r\n    engineInterface.capabilities.projection.flat = false;\r\n    engineInterface.capabilities.mapType.type2D = true;\r\n    //engineInterface.capabilities.mapType.type2_5D = false;\r\n    //engineInterface.capabilities.mapType.type3D = false;\r\n    engineInterface.capabilities.formats.GEOJSON_BASIC.plot = true;\r\n    engineInterface.capabilities.formats.GEOJSON_BASIC.draw = true;\r\n    engineInterface.capabilities.formats.GEOJSON_BASIC.edit = true;\r\n    engineInterface.capabilities.formats.GEOJSON_FULL.plot = true;\r\n    //engineInterface.capabilities.formats.GEOJSON_FULL.draw = false;\r\n    //engineInterface.capabilities.formats.GEOJSON_FULL.edit = false;\r\n    engineInterface.capabilities.formats.WMS.version_1_1 = true;\r\n    engineInterface.capabilities.formats.WMS.version_1_3 = true;\r\n    //engineInterface.capabilities.formats.WMS.elevationData = false;\r\n\r\n    engineInterface.capabilities.formats.KML_BASIC.plot = true;\r\n    //engineInterface.capabilities.formats.KML_BASIC.draw = false;\r\n    engineInterface.capabilities.formats.KML_BASIC.edit = true;\r\n\r\n    engineInterface.capabilities.formats.KML_COMPLEX.plot = true;\r\n    //engineInterface.capabilities.formats.KML_COMPLEX.draw = false;\r\n    //engineInterface.capabilities.formats.KML_COMPLEX.edit = false;\r\n\r\n    engineInterface.capabilities.formats.IMAGE.plot = true;\r\n    //engineInterface.capabilities.formats.IMAGE.edit = false;\r\n\r\n    engineInterface.capabilities.formats.MILSTD.version2525B.plot = true;\r\n    engineInterface.capabilities.formats.MILSTD.version2525B.draw = true;\r\n    engineInterface.capabilities.formats.MILSTD.version2525B.edit = true;\r\n\r\n    engineInterface.capabilities.formats.MILSTD.version2525C.plot = true;\r\n    engineInterface.capabilities.formats.MILSTD.version2525C.draw = true;\r\n    engineInterface.capabilities.formats.MILSTD.version2525C.edit = true;\r\n\r\n    engineInterface.capabilities.formats.AIRSPACE.plot = true;\r\n    engineInterface.capabilities.formats.AIRSPACE.draw = true;\r\n    engineInterface.capabilities.formats.AIRSPACE.edit = true;\r\n\r\n    engineInterface.capabilities.formats.AOI.plot = true;\r\n    engineInterface.capabilities.formats.AOI.draw = false;\r\n    engineInterface.capabilities.formats.AOI.edit = true;\r\n\r\n    engineInterface.capabilities.formats.ArcGIS = false;\r\n    engineInterface.capabilities.overlayClustering = true;\r\n\r\n    engineInterface.capabilities.settings.milstd.iconSize = true;\r\n    engineInterface.capabilities.settings.milstd.labelOption = true;\r\n\r\n    engineInterface.capabilities.settings.iconSize = false;\r\n    // return the engineInterface object as a new engineTemplate instance\r\n\r\n    try {\r\n        var center;\r\n        var level = 0;\r\n        var southWest = L.latLng(-90.0, -180.0);\r\n        var northEast = L.latLng(90.0, 180.0);\r\n        var maxBounds = L.latLngBounds(southWest, northEast);\r\n\r\n        if (args.initialExtent !== undefined) {\r\n            if (args.initialExtent.hasOwnProperty('centerLat')) {\r\n                center = new L.LatLng(args.initialExtent.centerLat, args.initialExtent.centerLon);\r\n\r\n                if (args.initialExtent.hasOwnProperty('range')) {\r\n                    level = instanceInterface.getLevel(args.initialExtent.range * instanceInterface.rangeToScaleMultiplier);\r\n                } else if (args.initialExtent.hasOwnProperty('scale')) {\r\n                    level = instanceInterface.getLevel(args.initialExtent.scale);\r\n                }\r\n            } else {\r\n                center = new L.LatLng(0, 0);\r\n                var southWest = L.latLng(args.initialExtent.south, args.initialExtent.west),\r\n                        northEast = L.latLng(args.initialExtent.north, args.initialExtent.east);\r\n\r\n                bounds = L.latLngBounds(southWest, northEast);\r\n            }\r\n        } else {\r\n            center = new L.LatLng(0, 0);\r\n        }\r\n        // L is the global ref to Leaflet\r\n        instanceInterface.leafletInstance = L.map(args.container, {\r\n            worldCopyJump: false,\r\n            zoomControl: false,\r\n            //zoomAnimation: false,\r\n            minZoom: 1,\r\n            center: center,\r\n            zoom: level,\r\n            //maxBounds : maxBounds,\r\n            boxZoom: false,\r\n            trackResize: false,\r\n            attributionControl: false,\r\n            doubleClickZoom: false,\r\n            scrollWheelZoom: true\r\n        });\r\n\r\n        if ((instanceInterface.leafletInstance === undefined) || (instanceInterface.leafletInstance === null)) {\r\n            throw \"Leaflet creation failed.\";\r\n        }\r\n\r\n        instanceInterface.leafletInstance.whenReady(function () {\r\n            setTimeout(engineInterface.initialize.succeed, 100);\r\n        });\r\n        //emp.map.engineDirect = {name: \"leaflet\", ref: instanceInterface.leafletInstance};\r\n        $('.leaflet-container').css('cursor', 'pointer');\r\n    } catch (err) {\r\n        setTimeout(engineInterface.initialize.fail, 0);\r\n    }\r\n    return engineInterface;\r\n};\r\n"]}