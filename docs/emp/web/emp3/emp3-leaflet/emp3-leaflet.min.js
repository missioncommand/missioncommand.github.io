/*! emp3-web-sdk 2.6.0 20-06-2017 */

!function(window,document,undefined){function expose(){var oldL=window.L;L.noConflict=function(){return window.L=oldL,this},window.L=L}var L={version:"1.0.3+ed36a04"};"object"==typeof module&&"object"==typeof module.exports?module.exports=L:"function"==typeof define&&define.amd&&define(L),"undefined"!=typeof window&&expose(),L.Util={extend:function(dest){var i,j,len,src;for(j=1,len=arguments.length;j<len;j++){src=arguments[j];for(i in src)dest[i]=src[i]}return dest},create:Object.create||function(){function F(){}return function(proto){return F.prototype=proto,new F}}(),bind:function(fn,obj){var slice=Array.prototype.slice;if(fn.bind)return fn.bind.apply(fn,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.length?args.concat(slice.call(arguments)):arguments)}},stamp:function(obj){return obj._leaflet_id=obj._leaflet_id||++L.Util.lastId,obj._leaflet_id},lastId:0,throttle:function(fn,time,context){var lock,args,wrapperFn,later;return later=function(){lock=!1,args&&(wrapperFn.apply(context,args),args=!1)},wrapperFn=function(){lock?args=arguments:(fn.apply(context,arguments),setTimeout(later,time),lock=!0)}},wrapNum:function(x,range,includeMax){var max=range[1],min=range[0],d=max-min;return x===max&&includeMax?x:((x-min)%d+d)%d+min},falseFn:function(){return!1},formatNum:function(num,digits){var pow=Math.pow(10,digits||5);return Math.round(num*pow)/pow},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},splitWords:function(str){return L.Util.trim(str).split(/\s+/)},setOptions:function(obj,options){obj.hasOwnProperty("options")||(obj.options=obj.options?L.Util.create(obj.options):{});for(var i in options)obj.options[i]=options[i];return obj.options},getParamString:function(obj,existingUrl,uppercase){var params=[];for(var i in obj)params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+"="+encodeURIComponent(obj[i]));return(existingUrl&&existingUrl.indexOf("?")!==-1?"&":"?")+params.join("&")},template:function(str,data){return str.replace(L.Util.templateRe,function(str,key){var value=data[key];if(value===undefined)throw new Error("No value provided for variable "+str);return"function"==typeof value&&(value=value(data)),value})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},indexOf:function(array,el){for(var i=0;i<array.length;i++)if(array[i]===el)return i;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function getPrefixed(name){return window["webkit"+name]||window["moz"+name]||window["ms"+name]}function timeoutDefer(fn){var time=+new Date,timeToCall=Math.max(0,16-(time-lastTime));return lastTime=time+timeToCall,window.setTimeout(fn,timeToCall)}var lastTime=0,requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(id){window.clearTimeout(id)};L.Util.requestAnimFrame=function(fn,context,immediate){return immediate&&requestFn===timeoutDefer?void fn.call(context):requestFn.call(window,L.bind(fn,context))},L.Util.cancelAnimFrame=function(id){id&&cancelFn.call(window,id)}}(),L.extend=L.Util.extend,L.bind=L.Util.bind,L.stamp=L.Util.stamp,L.setOptions=L.Util.setOptions,L.Class=function(){},L.Class.extend=function(props){var NewClass=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},parentProto=NewClass.__super__=this.prototype,proto=L.Util.create(parentProto);proto.constructor=NewClass,NewClass.prototype=proto;for(var i in this)this.hasOwnProperty(i)&&"prototype"!==i&&(NewClass[i]=this[i]);return props.statics&&(L.extend(NewClass,props.statics),delete props.statics),props.includes&&(L.Util.extend.apply(null,[proto].concat(props.includes)),delete props.includes),proto.options&&(props.options=L.Util.extend(L.Util.create(proto.options),props.options)),L.extend(proto,props),proto._initHooks=[],proto.callInitHooks=function(){if(!this._initHooksCalled){parentProto.callInitHooks&&parentProto.callInitHooks.call(this),this._initHooksCalled=!0;for(var i=0,len=proto._initHooks.length;i<len;i++)proto._initHooks[i].call(this)}},NewClass},L.Class.include=function(props){return L.extend(this.prototype,props),this},L.Class.mergeOptions=function(options){return L.extend(this.prototype.options,options),this},L.Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1),init="function"==typeof fn?fn:function(){this[fn].apply(this,args)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(init),this},L.Evented=L.Class.extend({on:function(types,fn,context){if("object"==typeof types)for(var type in types)this._on(type,types[type],fn);else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++)this._on(types[i],fn,context)}return this},off:function(types,fn,context){if(types)if("object"==typeof types)for(var type in types)this._off(type,types[type],fn);else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++)this._off(types[i],fn,context)}else delete this._events;return this},_on:function(type,fn,context){this._events=this._events||{};var typeListeners=this._events[type];typeListeners||(typeListeners=[],this._events[type]=typeListeners),context===this&&(context=undefined);for(var newListener={fn:fn,ctx:context},listeners=typeListeners,i=0,len=listeners.length;i<len;i++)if(listeners[i].fn===fn&&listeners[i].ctx===context)return;listeners.push(newListener)},_off:function(type,fn,context){var listeners,i,len;if(this._events&&(listeners=this._events[type])){if(!fn){for(i=0,len=listeners.length;i<len;i++)listeners[i].fn=L.Util.falseFn;return void delete this._events[type]}if(context===this&&(context=undefined),listeners)for(i=0,len=listeners.length;i<len;i++){var l=listeners[i];if(l.ctx===context&&l.fn===fn)return l.fn=L.Util.falseFn,this._firingCount&&(this._events[type]=listeners=listeners.slice()),void listeners.splice(i,1)}}},fire:function(type,data,propagate){if(!this.listens(type,propagate))return this;var event=L.Util.extend({},data,{type:type,target:this});if(this._events){var listeners=this._events[type];if(listeners){this._firingCount=this._firingCount+1||1;for(var i=0,len=listeners.length;i<len;i++){var l=listeners[i];l.fn.call(l.ctx||this,event)}this._firingCount--}}return propagate&&this._propagateEvent(event),this},listens:function(type,propagate){var listeners=this._events&&this._events[type];if(listeners&&listeners.length)return!0;if(propagate)for(var id in this._eventParents)if(this._eventParents[id].listens(type,propagate))return!0;return!1},once:function(types,fn,context){if("object"==typeof types){for(var type in types)this.once(type,types[type],fn);return this}var handler=L.bind(function(){this.off(types,fn,context).off(types,handler,context)},this);return this.on(types,fn,context).on(types,handler,context)},addEventParent:function(obj){return this._eventParents=this._eventParents||{},this._eventParents[L.stamp(obj)]=obj,this},removeEventParent:function(obj){return this._eventParents&&delete this._eventParents[L.stamp(obj)],this},_propagateEvent:function(e){for(var id in this._eventParents)this._eventParents[id].fire(e.type,L.extend({layer:e.target},e),!0)}});var proto=L.Evented.prototype;proto.addEventListener=proto.on,proto.removeEventListener=proto.clearAllEventListeners=proto.off,proto.addOneTimeEventListener=proto.once,proto.fireEvent=proto.fire,proto.hasEventListeners=proto.listens,L.Mixin={Events:proto},function(){var ua=navigator.userAgent.toLowerCase(),doc=document.documentElement,ie="ActiveXObject"in window,webkit=ua.indexOf("webkit")!==-1,phantomjs=ua.indexOf("phantom")!==-1,android23=ua.search("android [23]")!==-1,chrome=ua.indexOf("chrome")!==-1,gecko=ua.indexOf("gecko")!==-1&&!webkit&&!window.opera&&!ie,win=0===navigator.platform.indexOf("Win"),mobile="undefined"!=typeof orientation||ua.indexOf("mobile")!==-1,msPointer=!window.PointerEvent&&window.MSPointerEvent,pointer=window.PointerEvent||msPointer,ie3d=ie&&"transition"in doc.style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in doc.style,opera12="OTransition"in doc.style,touch=!window.L_NO_TOUCH&&(pointer||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);L.Browser={ie:ie,ielt9:ie&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:webkit,gecko:gecko,android:ua.indexOf("android")!==-1,android23:android23,chrome:chrome,safari:!chrome&&ua.indexOf("safari")!==-1,win:win,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera12:opera12,any3d:!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d)&&!opera12&&!phantomjs,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&window.opera,mobileGecko:mobile&&gecko,touch:!!touch,msPointer:!!msPointer,pointer:!!pointer,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1}}(),L.Point=function(x,y,round){this.x=round?Math.round(x):x,this.y=round?Math.round(y):y},L.Point.prototype={clone:function(){return new L.Point(this.x,this.y)},add:function(point){return this.clone()._add(L.point(point))},_add:function(point){return this.x+=point.x,this.y+=point.y,this},subtract:function(point){return this.clone()._subtract(L.point(point))},_subtract:function(point){return this.x-=point.x,this.y-=point.y,this},divideBy:function(num){return this.clone()._divideBy(num)},_divideBy:function(num){return this.x/=num,this.y/=num,this},multiplyBy:function(num){return this.clone()._multiplyBy(num)},_multiplyBy:function(num){return this.x*=num,this.y*=num,this},scaleBy:function(point){return new L.Point(this.x*point.x,this.y*point.y)},unscaleBy:function(point){return new L.Point(this.x/point.x,this.y/point.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(point){point=L.point(point);var x=point.x-this.x,y=point.y-this.y;return Math.sqrt(x*x+y*y)},equals:function(point){return point=L.point(point),point.x===this.x&&point.y===this.y},contains:function(point){return point=L.point(point),Math.abs(point.x)<=Math.abs(this.x)&&Math.abs(point.y)<=Math.abs(this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}},L.point=function(x,y,round){return x instanceof L.Point?x:L.Util.isArray(x)?new L.Point(x[0],x[1]):x===undefined||null===x?x:"object"==typeof x&&"x"in x&&"y"in x?new L.Point(x.x,x.y):new L.Point(x,y,round)},L.Bounds=function(a,b){if(a)for(var points=b?[a,b]:a,i=0,len=points.length;i<len;i++)this.extend(points[i])},L.Bounds.prototype={extend:function(point){return point=L.point(point),this.min||this.max?(this.min.x=Math.min(point.x,this.min.x),this.max.x=Math.max(point.x,this.max.x),this.min.y=Math.min(point.y,this.min.y),this.max.y=Math.max(point.y,this.max.y)):(this.min=point.clone(),this.max=point.clone()),this},getCenter:function(round){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,round)},getBottomLeft:function(){return new L.Point(this.min.x,this.max.y)},getTopRight:function(){return new L.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(obj){var min,max;return obj="number"==typeof obj[0]||obj instanceof L.Point?L.point(obj):L.bounds(obj),obj instanceof L.Bounds?(min=obj.min,max=obj.max):min=max=obj,min.x>=this.min.x&&max.x<=this.max.x&&min.y>=this.min.y&&max.y<=this.max.y},intersects:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xIntersects=max2.x>=min.x&&min2.x<=max.x,yIntersects=max2.y>=min.y&&min2.y<=max.y;return xIntersects&&yIntersects},overlaps:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xOverlaps=max2.x>min.x&&min2.x<max.x,yOverlaps=max2.y>min.y&&min2.y<max.y;return xOverlaps&&yOverlaps},isValid:function(){return!(!this.min||!this.max)}},L.bounds=function(a,b){return!a||a instanceof L.Bounds?a:new L.Bounds(a,b)},L.Transformation=function(a,b,c,d){this._a=a,this._b=b,this._c=c,this._d=d},L.Transformation.prototype={transform:function(point,scale){return this._transform(point.clone(),scale)},_transform:function(point,scale){return scale=scale||1,point.x=scale*(this._a*point.x+this._b),point.y=scale*(this._c*point.y+this._d),point},untransform:function(point,scale){return scale=scale||1,new L.Point((point.x/scale-this._b)/this._a,(point.y/scale-this._d)/this._c)}},L.DomUtil={get:function(id){return"string"==typeof id?document.getElementById(id):id},getStyle:function(el,style){var value=el.style[style]||el.currentStyle&&el.currentStyle[style];if((!value||"auto"===value)&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);value=css?css[style]:null}return"auto"===value?null:value},create:function(tagName,className,container){var el=document.createElement(tagName);return el.className=className||"",container&&container.appendChild(el),el},remove:function(el){var parent=el.parentNode;parent&&parent.removeChild(el)},empty:function(el){for(;el.firstChild;)el.removeChild(el.firstChild)},toFront:function(el){el.parentNode.appendChild(el)},toBack:function(el){var parent=el.parentNode;parent.insertBefore(el,parent.firstChild)},hasClass:function(el,name){if(el.classList!==undefined)return el.classList.contains(name);var className=L.DomUtil.getClass(el);return className.length>0&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(className)},addClass:function(el,name){if(el.classList!==undefined)for(var classes=L.Util.splitWords(name),i=0,len=classes.length;i<len;i++)el.classList.add(classes[i]);else if(!L.DomUtil.hasClass(el,name)){var className=L.DomUtil.getClass(el);L.DomUtil.setClass(el,(className?className+" ":"")+name)}},removeClass:function(el,name){el.classList!==undefined?el.classList.remove(name):L.DomUtil.setClass(el,L.Util.trim((" "+L.DomUtil.getClass(el)+" ").replace(" "+name+" "," ")))},setClass:function(el,name){el.className.baseVal===undefined?el.className=name:el.className.baseVal=name},getClass:function(el){return el.className.baseVal===undefined?el.className:el.className.baseVal},setOpacity:function(el,value){"opacity"in el.style?el.style.opacity=value:"filter"in el.style&&L.DomUtil._setOpacityIE(el,value)},_setOpacityIE:function(el,value){var filter=!1,filterName="DXImageTransform.Microsoft.Alpha";try{filter=el.filters.item(filterName)}catch(e){if(1===value)return}value=Math.round(100*value),filter?(filter.Enabled=100!==value,filter.Opacity=value):el.style.filter+=" progid:"+filterName+"(opacity="+value+")"},testProp:function(props){for(var style=document.documentElement.style,i=0;i<props.length;i++)if(props[i]in style)return props[i];return!1},setTransform:function(el,offset,scale){var pos=offset||new L.Point(0,0);el.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+pos.x+"px,"+pos.y+"px)":"translate3d("+pos.x+"px,"+pos.y+"px,0)")+(scale?" scale("+scale+")":"")},setPosition:function(el,point){el._leaflet_pos=point,L.Browser.any3d?L.DomUtil.setTransform(el,point):(el.style.left=point.x+"px",el.style.top=point.y+"px")},getPosition:function(el){return el._leaflet_pos||new L.Point(0,0)}},function(){L.DomUtil.TRANSFORM=L.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var transition=L.DomUtil.TRANSITION=L.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(L.DomUtil.TRANSITION_END="webkitTransition"===transition||"OTransition"===transition?transition+"End":"transitionend","onselectstart"in document)L.DomUtil.disableTextSelection=function(){L.DomEvent.on(window,"selectstart",L.DomEvent.preventDefault)},L.DomUtil.enableTextSelection=function(){L.DomEvent.off(window,"selectstart",L.DomEvent.preventDefault)};else{var userSelectProperty=L.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);L.DomUtil.disableTextSelection=function(){if(userSelectProperty){var style=document.documentElement.style;this._userSelect=style[userSelectProperty],style[userSelectProperty]="none"}},L.DomUtil.enableTextSelection=function(){userSelectProperty&&(document.documentElement.style[userSelectProperty]=this._userSelect,delete this._userSelect)}}L.DomUtil.disableImageDrag=function(){L.DomEvent.on(window,"dragstart",L.DomEvent.preventDefault)},L.DomUtil.enableImageDrag=function(){L.DomEvent.off(window,"dragstart",L.DomEvent.preventDefault)},L.DomUtil.preventOutline=function(element){for(;element.tabIndex===-1;)element=element.parentNode;element&&element.style&&(L.DomUtil.restoreOutline(),this._outlineElement=element,this._outlineStyle=element.style.outline,element.style.outline="none",L.DomEvent.on(window,"keydown",L.DomUtil.restoreOutline,this))},L.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,L.DomEvent.off(window,"keydown",L.DomUtil.restoreOutline,this))}}(),L.LatLng=function(lat,lng,alt){if(isNaN(lat)||isNaN(lng))throw new Error("Invalid LatLng object: ("+lat+", "+lng+")");this.lat=+lat,this.lng=+lng,alt!==undefined&&(this.alt=+alt)},L.LatLng.prototype={equals:function(obj,maxMargin){if(!obj)return!1;obj=L.latLng(obj);var margin=Math.max(Math.abs(this.lat-obj.lat),Math.abs(this.lng-obj.lng));return margin<=(maxMargin===undefined?1e-9:maxMargin)},toString:function(precision){return"LatLng("+L.Util.formatNum(this.lat,precision)+", "+L.Util.formatNum(this.lng,precision)+")"},distanceTo:function(other){return L.CRS.Earth.distance(this,L.latLng(other))},wrap:function(){return L.CRS.Earth.wrapLatLng(this)},toBounds:function(sizeInMeters){var latAccuracy=180*sizeInMeters/40075017,lngAccuracy=latAccuracy/Math.cos(Math.PI/180*this.lat);return L.latLngBounds([this.lat-latAccuracy,this.lng-lngAccuracy],[this.lat+latAccuracy,this.lng+lngAccuracy])},clone:function(){return new L.LatLng(this.lat,this.lng,this.alt)}},L.latLng=function(a,b,c){return a instanceof L.LatLng?a:L.Util.isArray(a)&&"object"!=typeof a[0]?3===a.length?new L.LatLng(a[0],a[1],a[2]):2===a.length?new L.LatLng(a[0],a[1]):null:a===undefined||null===a?a:"object"==typeof a&&"lat"in a?new L.LatLng(a.lat,"lng"in a?a.lng:a.lon,a.alt):b===undefined?null:new L.LatLng(a,b,c)},L.LatLngBounds=function(corner1,corner2){if(corner1)for(var latlngs=corner2?[corner1,corner2]:corner1,i=0,len=latlngs.length;i<len;i++)this.extend(latlngs[i])},L.LatLngBounds.prototype={extend:function(obj){var sw2,ne2,sw=this._southWest,ne=this._northEast;if(obj instanceof L.LatLng)sw2=obj,ne2=obj;else{if(!(obj instanceof L.LatLngBounds))return obj?this.extend(L.latLng(obj)||L.latLngBounds(obj)):this;if(sw2=obj._southWest,ne2=obj._northEast,!sw2||!ne2)return this}return sw||ne?(sw.lat=Math.min(sw2.lat,sw.lat),sw.lng=Math.min(sw2.lng,sw.lng),ne.lat=Math.max(ne2.lat,ne.lat),ne.lng=Math.max(ne2.lng,ne.lng)):(this._southWest=new L.LatLng(sw2.lat,sw2.lng),this._northEast=new L.LatLng(ne2.lat,ne2.lng)),this},pad:function(bufferRatio){var sw=this._southWest,ne=this._northEast,heightBuffer=Math.abs(sw.lat-ne.lat)*bufferRatio,widthBuffer=Math.abs(sw.lng-ne.lng)*bufferRatio;return new L.LatLngBounds(new L.LatLng(sw.lat-heightBuffer,sw.lng-widthBuffer),new L.LatLng(ne.lat+heightBuffer,ne.lng+widthBuffer))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new L.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new L.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(obj){obj="number"==typeof obj[0]||obj instanceof L.LatLng||"lat"in obj?L.latLng(obj):L.latLngBounds(obj);var sw2,ne2,sw=this._southWest,ne=this._northEast;return obj instanceof L.LatLngBounds?(sw2=obj.getSouthWest(),ne2=obj.getNorthEast()):sw2=ne2=obj,sw2.lat>=sw.lat&&ne2.lat<=ne.lat&&sw2.lng>=sw.lng&&ne2.lng<=ne.lng},intersects:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latIntersects=ne2.lat>=sw.lat&&sw2.lat<=ne.lat,lngIntersects=ne2.lng>=sw.lng&&sw2.lng<=ne.lng;return latIntersects&&lngIntersects},overlaps:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latOverlaps=ne2.lat>sw.lat&&sw2.lat<ne.lat,lngOverlaps=ne2.lng>sw.lng&&sw2.lng<ne.lng;return latOverlaps&&lngOverlaps},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(bounds){return!!bounds&&(bounds=L.latLngBounds(bounds),this._southWest.equals(bounds.getSouthWest())&&this._northEast.equals(bounds.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},L.latLngBounds=function(a,b){return a instanceof L.LatLngBounds?a:new L.LatLngBounds(a,b)},L.Projection={},L.Projection.LonLat={project:function(latlng){return new L.Point(latlng.lng,latlng.lat)},unproject:function(point){return new L.LatLng(point.y,point.x)},bounds:L.bounds([-180,-90],[180,90])},L.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(latlng){var d=Math.PI/180,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),sin=Math.sin(lat*d);return new L.Point(this.R*latlng.lng*d,this.R*Math.log((1+sin)/(1-sin))/2)},unproject:function(point){var d=180/Math.PI;return new L.LatLng((2*Math.atan(Math.exp(point.y/this.R))-Math.PI/2)*d,point.x*d/this.R)},bounds:function(){var d=6378137*Math.PI;return L.bounds([-d,-d],[d,d])}()},L.CRS={latLngToPoint:function(latlng,zoom){var projectedPoint=this.projection.project(latlng),scale=this.scale(zoom);return this.transformation._transform(projectedPoint,scale)},pointToLatLng:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);return this.projection.unproject(untransformedPoint)},project:function(latlng){return this.projection.project(latlng)},unproject:function(point){return this.projection.unproject(point)},scale:function(zoom){return 256*Math.pow(2,zoom)},zoom:function(scale){return Math.log(scale/256)/Math.LN2},getProjectedBounds:function(zoom){if(this.infinite)return null;var b=this.projection.bounds,s=this.scale(zoom),min=this.transformation.transform(b.min,s),max=this.transformation.transform(b.max,s);return L.bounds(min,max)},infinite:!1,wrapLatLng:function(latlng){var lng=this.wrapLng?L.Util.wrapNum(latlng.lng,this.wrapLng,!0):latlng.lng,lat=this.wrapLat?L.Util.wrapNum(latlng.lat,this.wrapLat,!0):latlng.lat,alt=latlng.alt;return L.latLng(lat,lng,alt)},wrapLatLngBounds:function(bounds){var center=bounds.getCenter(),newCenter=this.wrapLatLng(center),latShift=center.lat-newCenter.lat,lngShift=center.lng-newCenter.lng;if(0===latShift&&0===lngShift)return bounds;var sw=bounds.getSouthWest(),ne=bounds.getNorthEast(),newSw=L.latLng({lat:sw.lat-latShift,lng:sw.lng-lngShift}),newNe=L.latLng({lat:ne.lat-latShift,lng:ne.lng-lngShift});return new L.LatLngBounds(newSw,newNe)}},L.CRS.Simple=L.extend({},L.CRS,{projection:L.Projection.LonLat,transformation:new L.Transformation(1,0,(-1),0),scale:function(zoom){return Math.pow(2,zoom)},zoom:function(scale){return Math.log(scale)/Math.LN2},distance:function(latlng1,latlng2){var dx=latlng2.lng-latlng1.lng,dy=latlng2.lat-latlng1.lat;return Math.sqrt(dx*dx+dy*dy)},infinite:!0}),L.CRS.Earth=L.extend({},L.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(latlng1,latlng2){var rad=Math.PI/180,lat1=latlng1.lat*rad,lat2=latlng2.lat*rad,a=Math.sin(lat1)*Math.sin(lat2)+Math.cos(lat1)*Math.cos(lat2)*Math.cos((latlng2.lng-latlng1.lng)*rad);return this.R*Math.acos(Math.min(a,1))}}),L.CRS.EPSG3857=L.extend({},L.CRS.Earth,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:function(){var scale=.5/(Math.PI*L.Projection.SphericalMercator.R);return new L.Transformation(scale,.5,(-scale),.5)}()}),L.CRS.EPSG900913=L.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"}),L.CRS.EPSG4326=L.extend({},L.CRS.Earth,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/180,1,-1/180,.5)}),L.Map=L.Evented.extend({options:{crs:L.CRS.EPSG3857,center:undefined,zoom:undefined,minZoom:undefined,maxZoom:undefined,layers:[],maxBounds:undefined,renderer:undefined,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(id,options){options=L.setOptions(this,options),this._initContainer(id),this._initLayout(),this._onResize=L.bind(this._onResize,this),this._initEvents(),options.maxBounds&&this.setMaxBounds(options.maxBounds),options.zoom!==undefined&&(this._zoom=this._limitZoom(options.zoom)),options.center&&options.zoom!==undefined&&this.setView(L.latLng(options.center),options.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=L.DomUtil.TRANSITION&&L.Browser.any3d&&!L.Browser.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),L.DomEvent.on(this._proxy,L.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(center,zoom,options){if(zoom=zoom===undefined?this._zoom:this._limitZoom(zoom),center=this._limitCenter(L.latLng(center),zoom,this.options.maxBounds),options=options||{},this._stop(),this._loaded&&!options.reset&&options!==!0){options.animate!==undefined&&(options.zoom=L.extend({animate:options.animate},options.zoom),options.pan=L.extend({animate:options.animate,duration:options.duration},options.pan));var moved=this._zoom!==zoom?this._tryAnimatedZoom&&this._tryAnimatedZoom(center,zoom,options.zoom):this._tryAnimatedPan(center,options.pan);if(moved)return clearTimeout(this._sizeTimer),this}return this._resetView(center,zoom),this},setZoom:function(zoom,options){return this._loaded?this.setView(this.getCenter(),zoom,{zoom:options}):(this._zoom=zoom,this)},zoomIn:function(delta,options){return delta=delta||(L.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+delta,options)},zoomOut:function(delta,options){return delta=delta||(L.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-delta,options)},setZoomAround:function(latlng,zoom,options){var scale=this.getZoomScale(zoom),viewHalf=this.getSize().divideBy(2),containerPoint=latlng instanceof L.Point?latlng:this.latLngToContainerPoint(latlng),centerOffset=containerPoint.subtract(viewHalf).multiplyBy(1-1/scale),newCenter=this.containerPointToLatLng(viewHalf.add(centerOffset));return this.setView(newCenter,zoom,{zoom:options})},_getBoundsCenterZoom:function(bounds,options){options=options||{},bounds=bounds.getBounds?bounds.getBounds():L.latLngBounds(bounds);var paddingTL=L.point(options.paddingTopLeft||options.padding||[0,0]),paddingBR=L.point(options.paddingBottomRight||options.padding||[0,0]),zoom=this.getBoundsZoom(bounds,!1,paddingTL.add(paddingBR));zoom="number"==typeof options.maxZoom?Math.min(options.maxZoom,zoom):zoom;var paddingOffset=paddingBR.subtract(paddingTL).divideBy(2),swPoint=this.project(bounds.getSouthWest(),zoom),nePoint=this.project(bounds.getNorthEast(),zoom),center=this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset),zoom);return{center:center,zoom:zoom}},fitBounds:function(bounds,options){if(bounds=L.latLngBounds(bounds),!bounds.isValid())throw new Error("Bounds are not valid.");var target=this._getBoundsCenterZoom(bounds,options);return this.setView(target.center,target.zoom,options)},fitWorld:function(options){return this.fitBounds([[-90,-180],[90,180]],options)},panTo:function(center,options){return this.setView(center,this._zoom,{pan:options})},panBy:function(offset,options){if(offset=L.point(offset).round(),options=options||{},!offset.x&&!offset.y)return this.fire("moveend");if(options.animate!==!0&&!this.getSize().contains(offset))return this._resetView(this.unproject(this.project(this.getCenter()).add(offset)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new L.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),options.noMoveStart||this.fire("movestart"),options.animate!==!1){L.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var newPos=this._getMapPanePos().subtract(offset).round();this._panAnim.run(this._mapPane,newPos,options.duration||.25,options.easeLinearity)}else this._rawPanBy(offset),this.fire("move").fire("moveend");return this},flyTo:function(targetCenter,targetZoom,options){function r(i){var s1=i?-1:1,s2=i?w1:w0,t1=w1*w1-w0*w0+s1*rho2*rho2*u1*u1,b1=2*s2*rho2*u1,b=t1/b1,sq=Math.sqrt(b*b+1)-b,log=sq<1e-9?-18:Math.log(sq);return log}function sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function cosh(n){return(Math.exp(n)+Math.exp(-n))/2}function tanh(n){return sinh(n)/cosh(n)}function w(s){return w0*(cosh(r0)/cosh(r0+rho*s))}function u(s){return w0*(cosh(r0)*tanh(r0+rho*s)-sinh(r0))/rho2}function easeOut(t){return 1-Math.pow(1-t,1.5)}function frame(){var t=(Date.now()-start)/duration,s=easeOut(t)*S;t<=1?(this._flyToFrame=L.Util.requestAnimFrame(frame,this),this._move(this.unproject(from.add(to.subtract(from).multiplyBy(u(s)/u1)),startZoom),this.getScaleZoom(w0/w(s),startZoom),{flyTo:!0})):this._move(targetCenter,targetZoom)._moveEnd(!0)}if(options=options||{},options.animate===!1||!L.Browser.any3d)return this.setView(targetCenter,targetZoom,options);this._stop();var from=this.project(this.getCenter()),to=this.project(targetCenter),size=this.getSize(),startZoom=this._zoom;targetCenter=L.latLng(targetCenter),targetZoom=targetZoom===undefined?startZoom:targetZoom;var w0=Math.max(size.x,size.y),w1=w0*this.getZoomScale(startZoom,targetZoom),u1=to.distanceTo(from)||1,rho=1.42,rho2=rho*rho,r0=r(0),start=Date.now(),S=(r(1)-r0)/rho,duration=options.duration?1e3*options.duration:1e3*S*.8;return this._moveStart(!0),frame.call(this),this},flyToBounds:function(bounds,options){var target=this._getBoundsCenterZoom(bounds,options);return this.flyTo(target.center,target.zoom,options)},setMaxBounds:function(bounds){return bounds=L.latLngBounds(bounds),bounds.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=bounds,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(zoom){return this.options.minZoom=zoom,this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(zoom):this},setMaxZoom:function(zoom){return this.options.maxZoom=zoom,this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(zoom):this},panInsideBounds:function(bounds,options){this._enforcingBounds=!0;var center=this.getCenter(),newCenter=this._limitCenter(center,this._zoom,L.latLngBounds(bounds));return center.equals(newCenter)||this.panTo(newCenter,options),this._enforcingBounds=!1,this},invalidateSize:function(options){if(!this._loaded)return this;options=L.extend({animate:!1,pan:!0},options===!0?{animate:!0}:options);var oldSize=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var newSize=this.getSize(),oldCenter=oldSize.divideBy(2).round(),newCenter=newSize.divideBy(2).round(),offset=oldCenter.subtract(newCenter);
return offset.x||offset.y?(options.animate&&options.pan?this.panBy(offset):(options.pan&&this._rawPanBy(offset),this.fire("move"),options.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(L.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:oldSize,newSize:newSize})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(options){if(options=this._locateOptions=L.extend({timeout:1e4,watch:!1},options),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var onResponse=L.bind(this._handleGeolocationResponse,this),onError=L.bind(this._handleGeolocationError,this);return options.watch?this._locationWatchId=navigator.geolocation.watchPosition(onResponse,onError,options):navigator.geolocation.getCurrentPosition(onResponse,onError,options),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(error){var c=error.code,message=error.message||(1===c?"permission denied":2===c?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:c,message:"Geolocation error: "+message+"."})},_handleGeolocationResponse:function(pos){var lat=pos.coords.latitude,lng=pos.coords.longitude,latlng=new L.LatLng(lat,lng),bounds=latlng.toBounds(pos.coords.accuracy),options=this._locateOptions;if(options.setView){var zoom=this.getBoundsZoom(bounds);this.setView(latlng,options.maxZoom?Math.min(zoom,options.maxZoom):zoom)}var data={latlng:latlng,bounds:bounds,timestamp:pos.timestamp};for(var i in pos.coords)"number"==typeof pos.coords[i]&&(data[i]=pos.coords[i]);this.fire("locationfound",data)},addHandler:function(name,HandlerClass){if(!HandlerClass)return this;var handler=this[name]=new HandlerClass(this);return this._handlers.push(handler),this.options[name]&&handler.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=undefined,this._containerId=undefined}L.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload");for(var i in this._layers)this._layers[i].remove();return this},createPane:function(name,container){var className="leaflet-pane"+(name?" leaflet-"+name.replace("Pane","")+"-pane":""),pane=L.DomUtil.create("div",className,container||this._mapPane);return name&&(this._panes[name]=pane),pane},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var bounds=this.getPixelBounds(),sw=this.unproject(bounds.getBottomLeft()),ne=this.unproject(bounds.getTopRight());return new L.LatLngBounds(sw,ne)},getMinZoom:function(){return this.options.minZoom===undefined?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===undefined?this._layersMaxZoom===undefined?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(bounds,inside,padding){bounds=L.latLngBounds(bounds),padding=L.point(padding||[0,0]);var zoom=this.getZoom()||0,min=this.getMinZoom(),max=this.getMaxZoom(),nw=bounds.getNorthWest(),se=bounds.getSouthEast(),size=this.getSize().subtract(padding),boundsSize=L.bounds(this.project(se,zoom),this.project(nw,zoom)).getSize(),snap=L.Browser.any3d?this.options.zoomSnap:1,scale=Math.min(size.x/boundsSize.x,size.y/boundsSize.y);return zoom=this.getScaleZoom(scale,zoom),snap&&(zoom=Math.round(zoom/(snap/100))*(snap/100),zoom=inside?Math.ceil(zoom/snap)*snap:Math.floor(zoom/snap)*snap),Math.max(min,Math.min(max,zoom))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new L.Point(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(center,zoom){var topLeftPoint=this._getTopLeftPoint(center,zoom);return new L.Bounds(topLeftPoint,topLeftPoint.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(zoom){return this.options.crs.getProjectedBounds(zoom===undefined?this.getZoom():zoom)},getPane:function(pane){return"string"==typeof pane?this._panes[pane]:pane},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(toZoom,fromZoom){var crs=this.options.crs;return fromZoom=fromZoom===undefined?this._zoom:fromZoom,crs.scale(toZoom)/crs.scale(fromZoom)},getScaleZoom:function(scale,fromZoom){var crs=this.options.crs;fromZoom=fromZoom===undefined?this._zoom:fromZoom;var zoom=crs.zoom(scale*crs.scale(fromZoom));return isNaN(zoom)?1/0:zoom},project:function(latlng,zoom){return zoom=zoom===undefined?this._zoom:zoom,this.options.crs.latLngToPoint(L.latLng(latlng),zoom)},unproject:function(point,zoom){return zoom=zoom===undefined?this._zoom:zoom,this.options.crs.pointToLatLng(L.point(point),zoom)},layerPointToLatLng:function(point){var projectedPoint=L.point(point).add(this.getPixelOrigin());return this.unproject(projectedPoint)},latLngToLayerPoint:function(latlng){var projectedPoint=this.project(L.latLng(latlng))._round();return projectedPoint._subtract(this.getPixelOrigin())},wrapLatLng:function(latlng){return this.options.crs.wrapLatLng(L.latLng(latlng))},wrapLatLngBounds:function(latlng){return this.options.crs.wrapLatLngBounds(L.latLngBounds(latlng))},distance:function(latlng1,latlng2){return this.options.crs.distance(L.latLng(latlng1),L.latLng(latlng2))},containerPointToLayerPoint:function(point){return L.point(point).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(point){return L.point(point).add(this._getMapPanePos())},containerPointToLatLng:function(point){var layerPoint=this.containerPointToLayerPoint(L.point(point));return this.layerPointToLatLng(layerPoint)},latLngToContainerPoint:function(latlng){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)))},mouseEventToContainerPoint:function(e){return L.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(id){var container=this._container=L.DomUtil.get(id);if(!container)throw new Error("Map container not found.");if(container._leaflet_id)throw new Error("Map container is already initialized.");L.DomEvent.addListener(container,"scroll",this._onScroll,this),this._containerId=L.Util.stamp(container)},_initLayout:function(){var container=this._container;this._fadeAnimated=this.options.fadeAnimation&&L.Browser.any3d,L.DomUtil.addClass(container,"leaflet-container"+(L.Browser.touch?" leaflet-touch":"")+(L.Browser.retina?" leaflet-retina":"")+(L.Browser.ielt9?" leaflet-oldie":"")+(L.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var position=L.DomUtil.getStyle(container,"position");"absolute"!==position&&"relative"!==position&&"fixed"!==position&&(container.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var panes=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),L.DomUtil.setPosition(this._mapPane,new L.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(L.DomUtil.addClass(panes.markerPane,"leaflet-zoom-hide"),L.DomUtil.addClass(panes.shadowPane,"leaflet-zoom-hide"))},_resetView:function(center,zoom){L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));var loading=!this._loaded;this._loaded=!0,zoom=this._limitZoom(zoom),this.fire("viewprereset");var zoomChanged=this._zoom!==zoom;this._moveStart(zoomChanged)._move(center,zoom)._moveEnd(zoomChanged),this.fire("viewreset"),loading&&this.fire("load")},_moveStart:function(zoomChanged){return zoomChanged&&this.fire("zoomstart"),this.fire("movestart")},_move:function(center,zoom,data){zoom===undefined&&(zoom=this._zoom);var zoomChanged=this._zoom!==zoom;return this._zoom=zoom,this._lastCenter=center,this._pixelOrigin=this._getNewPixelOrigin(center),(zoomChanged||data&&data.pinch)&&this.fire("zoom",data),this.fire("move",data)},_moveEnd:function(zoomChanged){return zoomChanged&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return L.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(offset){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(offset))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(remove){if(L.DomEvent){this._targets={},this._targets[L.stamp(this._container)]=this;var onOff=remove?"off":"on";L.DomEvent[onOff](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&L.DomEvent[onOff](window,"resize",this._onResize,this),L.Browser.any3d&&this.options.transform3DLimit&&this[onOff]("moveend",this._onMoveEnd)}},_onResize:function(){L.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=L.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var pos=this._getMapPanePos();Math.max(Math.abs(pos.x),Math.abs(pos.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,type){for(var target,targets=[],isHover="mouseout"===type||"mouseover"===type,src=e.target||e.srcElement,dragging=!1;src;){if(target=this._targets[L.stamp(src)],target&&("click"===type||"preclick"===type)&&!e._simulated&&this._draggableMoved(target)){dragging=!0;break}if(target&&target.listens(type,!0)){if(isHover&&!L.DomEvent._isExternalTarget(src,e))break;if(targets.push(target),isHover)break}if(src===this._container)break;src=src.parentNode}return targets.length||dragging||isHover||!L.DomEvent._isExternalTarget(src,e)||(targets=[this]),targets},_handleDOMEvent:function(e){if(this._loaded&&!L.DomEvent._skipped(e)){var type="keypress"===e.type&&13===e.keyCode?"click":e.type;"mousedown"===type&&L.DomUtil.preventOutline(e.target||e.srcElement),this._fireDOMEvent(e,type)}},_fireDOMEvent:function(e,type,targets){if("click"===e.type){var synth=L.Util.extend({},e);synth.type="preclick",this._fireDOMEvent(synth,synth.type,targets)}if(!e._stopped&&(targets=(targets||[]).concat(this._findEventTargets(e,type)),targets.length)){var target=targets[0];"contextmenu"===type&&target.listens(type,!0)&&L.DomEvent.preventDefault(e);var data={originalEvent:e};if("keypress"!==e.type){var isMarker=target instanceof L.Marker;data.containerPoint=isMarker?this.latLngToContainerPoint(target.getLatLng()):this.mouseEventToContainerPoint(e),data.layerPoint=this.containerPointToLayerPoint(data.containerPoint),data.latlng=isMarker?target.getLatLng():this.layerPointToLatLng(data.layerPoint)}for(var i=0;i<targets.length;i++)if(targets[i].fire(type,data,!0),data.originalEvent._stopped||targets[i].options.nonBubblingEvents&&L.Util.indexOf(targets[i].options.nonBubblingEvents,type)!==-1)return}},_draggableMoved:function(obj){return obj=obj.dragging&&obj.dragging.enabled()?obj:this,obj.dragging&&obj.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var i=0,len=this._handlers.length;i<len;i++)this._handlers[i].disable()},whenReady:function(callback,context){return this._loaded?callback.call(context||this,{target:this}):this.on("load",callback,context),this},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane)||new L.Point(0,0)},_moved:function(){var pos=this._getMapPanePos();return pos&&!pos.equals([0,0])},_getTopLeftPoint:function(center,zoom){var pixelOrigin=center&&zoom!==undefined?this._getNewPixelOrigin(center,zoom):this.getPixelOrigin();return pixelOrigin.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(center,zoom){var viewHalf=this.getSize()._divideBy(2);return this.project(center,zoom)._subtract(viewHalf)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(latlng,zoom,center){var topLeft=this._getNewPixelOrigin(center,zoom);return this.project(latlng,zoom)._subtract(topLeft)},_latLngBoundsToNewLayerBounds:function(latLngBounds,zoom,center){var topLeft=this._getNewPixelOrigin(center,zoom);return L.bounds([this.project(latLngBounds.getSouthWest(),zoom)._subtract(topLeft),this.project(latLngBounds.getNorthWest(),zoom)._subtract(topLeft),this.project(latLngBounds.getSouthEast(),zoom)._subtract(topLeft),this.project(latLngBounds.getNorthEast(),zoom)._subtract(topLeft)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(latlng){return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint())},_limitCenter:function(center,zoom,bounds){if(!bounds)return center;var centerPoint=this.project(center,zoom),viewHalf=this.getSize().divideBy(2),viewBounds=new L.Bounds(centerPoint.subtract(viewHalf),centerPoint.add(viewHalf)),offset=this._getBoundsOffset(viewBounds,bounds,zoom);return offset.round().equals([0,0])?center:this.unproject(centerPoint.add(offset),zoom)},_limitOffset:function(offset,bounds){if(!bounds)return offset;var viewBounds=this.getPixelBounds(),newBounds=new L.Bounds(viewBounds.min.add(offset),viewBounds.max.add(offset));return offset.add(this._getBoundsOffset(newBounds,bounds))},_getBoundsOffset:function(pxBounds,maxBounds,zoom){var projectedMaxBounds=L.bounds(this.project(maxBounds.getNorthEast(),zoom),this.project(maxBounds.getSouthWest(),zoom)),minOffset=projectedMaxBounds.min.subtract(pxBounds.min),maxOffset=projectedMaxBounds.max.subtract(pxBounds.max),dx=this._rebound(minOffset.x,-maxOffset.x),dy=this._rebound(minOffset.y,-maxOffset.y);return new L.Point(dx,dy)},_rebound:function(left,right){return left+right>0?Math.round(left-right)/2:Math.max(0,Math.ceil(left))-Math.max(0,Math.floor(right))},_limitZoom:function(zoom){var min=this.getMinZoom(),max=this.getMaxZoom(),snap=L.Browser.any3d?this.options.zoomSnap:1;return snap&&(zoom=Math.round(zoom/snap)*snap),Math.max(min,Math.min(max,zoom))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(center,options){var offset=this._getCenterOffset(center)._floor();return!((options&&options.animate)!==!0&&!this.getSize().contains(offset))&&(this.panBy(offset,options),!0)},_createAnimProxy:function(){var proxy=this._proxy=L.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(proxy),this.on("zoomanim",function(e){var prop=L.DomUtil.TRANSFORM,transform=proxy.style[prop];L.DomUtil.setTransform(proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),transform===proxy.style[prop]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var c=this.getCenter(),z=this.getZoom();L.DomUtil.setTransform(proxy,this.project(c,z),this.getZoomScale(z,1))},this)},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(center,zoom,options){if(this._animatingZoom)return!0;if(options=options||{},!this._zoomAnimated||options.animate===!1||this._nothingToAnimate()||Math.abs(zoom-this._zoom)>this.options.zoomAnimationThreshold)return!1;var scale=this.getZoomScale(zoom),offset=this._getCenterOffset(center)._divideBy(1-1/scale);return!(options.animate!==!0&&!this.getSize().contains(offset))&&(L.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(center,zoom,!0)},this),!0)},_animateZoom:function(center,zoom,startAnim,noUpdate){startAnim&&(this._animatingZoom=!0,this._animateToCenter=center,this._animateToZoom=zoom,L.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:center,zoom:zoom,noUpdate:noUpdate}),setTimeout(L.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(L.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),L.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}),L.map=function(id,options){return new L.Map(id,options)},L.Layer=L.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[],attribution:null},addTo:function(map){return map.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(obj){return obj&&obj.removeLayer(this),this},getPane:function(name){return this._map.getPane(name?this.options[name]||name:this.options.pane)},addInteractiveTarget:function(targetEl){return this._map._targets[L.stamp(targetEl)]=this,this},removeInteractiveTarget:function(targetEl){return delete this._map._targets[L.stamp(targetEl)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var map=e.target;if(map.hasLayer(this)){if(this._map=map,this._zoomAnimated=map._zoomAnimated,this.getEvents){var events=this.getEvents();map.on(events,this),this.once("remove",function(){map.off(events,this)},this)}this.onAdd(map),this.getAttribution&&map.attributionControl&&map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),map.fire("layeradd",{layer:this})}}}),L.Map.include({addLayer:function(layer){var id=L.stamp(layer);return this._layers[id]?this:(this._layers[id]=layer,layer._mapToAdd=this,layer.beforeAdd&&layer.beforeAdd(this),this.whenReady(layer._layerAdd,layer),this)},removeLayer:function(layer){var id=L.stamp(layer);return this._layers[id]?(this._loaded&&layer.onRemove(this),layer.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(layer.getAttribution()),delete this._layers[id],this._loaded&&(this.fire("layerremove",{layer:layer}),layer.fire("remove")),layer._map=layer._mapToAdd=null,this):this},hasLayer:function(layer){return!!layer&&L.stamp(layer)in this._layers},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},_addLayers:function(layers){layers=layers?L.Util.isArray(layers)?layers:[layers]:[];for(var i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},_addZoomLimit:function(layer){!isNaN(layer.options.maxZoom)&&isNaN(layer.options.minZoom)||(this._zoomBoundLayers[L.stamp(layer)]=layer,this._updateZoomLevels())},_removeZoomLimit:function(layer){var id=L.stamp(layer);this._zoomBoundLayers[id]&&(delete this._zoomBoundLayers[id],this._updateZoomLevels())},_updateZoomLevels:function(){var minZoom=1/0,maxZoom=-(1/0),oldZoomSpan=this._getZoomSpan();for(var i in this._zoomBoundLayers){var options=this._zoomBoundLayers[i].options;minZoom=options.minZoom===undefined?minZoom:Math.min(minZoom,options.minZoom),maxZoom=options.maxZoom===undefined?maxZoom:Math.max(maxZoom,options.maxZoom)}this._layersMaxZoom=maxZoom===-(1/0)?undefined:maxZoom,this._layersMinZoom=minZoom===1/0?undefined:minZoom,oldZoomSpan!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===undefined&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===undefined&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var eventsKey="_leaflet_events";L.DomEvent={on:function(obj,types,fn,context){if("object"==typeof types)for(var type in types)this._on(obj,type,types[type],fn);else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++)this._on(obj,types[i],fn,context)}return this},off:function(obj,types,fn,context){if("object"==typeof types)for(var type in types)this._off(obj,type,types[type],fn);else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++)this._off(obj,types[i],fn,context)}return this},_on:function(obj,type,fn,context){var id=type+L.stamp(fn)+(context?"_"+L.stamp(context):"");if(obj[eventsKey]&&obj[eventsKey][id])return this;var handler=function(e){return fn.call(context||obj,e||window.event)},originalHandler=handler;return L.Browser.pointer&&0===type.indexOf("touch")?this.addPointerListener(obj,type,handler,id):!L.Browser.touch||"dblclick"!==type||!this.addDoubleTapListener||L.Browser.pointer&&L.Browser.chrome?"addEventListener"in obj?"mousewheel"===type?obj.addEventListener("onwheel"in obj?"wheel":"mousewheel",handler,!1):"mouseenter"===type||"mouseleave"===type?(handler=function(e){e=e||window.event,L.DomEvent._isExternalTarget(obj,e)&&originalHandler(e)},obj.addEventListener("mouseenter"===type?"mouseover":"mouseout",handler,!1)):("click"===type&&L.Browser.android&&(handler=function(e){return L.DomEvent._filterClick(e,originalHandler)}),obj.addEventListener(type,handler,!1)):"attachEvent"in obj&&obj.attachEvent("on"+type,handler):this.addDoubleTapListener(obj,handler,id),obj[eventsKey]=obj[eventsKey]||{},obj[eventsKey][id]=handler,this},_off:function(obj,type,fn,context){var id=type+L.stamp(fn)+(context?"_"+L.stamp(context):""),handler=obj[eventsKey]&&obj[eventsKey][id];return handler?(L.Browser.pointer&&0===type.indexOf("touch")?this.removePointerListener(obj,type,id):L.Browser.touch&&"dblclick"===type&&this.removeDoubleTapListener?this.removeDoubleTapListener(obj,id):"removeEventListener"in obj?"mousewheel"===type?obj.removeEventListener("onwheel"in obj?"wheel":"mousewheel",handler,!1):obj.removeEventListener("mouseenter"===type?"mouseover":"mouseleave"===type?"mouseout":type,handler,!1):"detachEvent"in obj&&obj.detachEvent("on"+type,handler),obj[eventsKey][id]=null,this):this},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,L.DomEvent._skipped(e),this},disableScrollPropagation:function(el){return L.DomEvent.on(el,"mousewheel",L.DomEvent.stopPropagation)},disableClickPropagation:function(el){var stop=L.DomEvent.stopPropagation;return L.DomEvent.on(el,L.Draggable.START.join(" "),stop),L.DomEvent.on(el,{click:L.DomEvent._fakeStop,dblclick:stop})},preventDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},stop:function(e){return L.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,container){if(!container)return new L.Point(e.clientX,e.clientY);var rect=container.getBoundingClientRect();return new L.Point(e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop)},_wheelPxFactor:L.Browser.win&&L.Browser.chrome?2:L.Browser.gecko?window.devicePixelRatio:1,getWheelDelta:function(e){return L.Browser.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/L.DomEvent._wheelPxFactor:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(e){L.DomEvent._skipEvents[e.type]=!0},_skipped:function(e){var skipped=this._skipEvents[e.type];return this._skipEvents[e.type]=!1,skipped},_isExternalTarget:function(el,e){var related=e.relatedTarget;if(!related)return!0;try{for(;related&&related!==el;)related=related.parentNode}catch(err){return!1}return related!==el},_filterClick:function(e,handler){var timeStamp=e.timeStamp||e.originalEvent&&e.originalEvent.timeStamp,elapsed=L.DomEvent._lastClick&&timeStamp-L.DomEvent._lastClick;return elapsed&&elapsed>100&&elapsed<500||e.target._simulatedClick&&!e._simulated?void L.DomEvent.stop(e):(L.DomEvent._lastClick=timeStamp,void handler(e))}},L.DomEvent.addListener=L.DomEvent.on,L.DomEvent.removeListener=L.DomEvent.off,L.PosAnimation=L.Evented.extend({run:function(el,newPos,duration,easeLinearity){this.stop(),this._el=el,this._inProgress=!0,this._duration=duration||.25,this._easeOutPower=1/Math.max(easeLinearity||.5,.2),this._startPos=L.DomUtil.getPosition(el),this._offset=newPos.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(round){var elapsed=+new Date-this._startTime,duration=1e3*this._duration;elapsed<duration?this._runFrame(this._easeOut(elapsed/duration),round):(this._runFrame(1),this._complete())},_runFrame:function(progress,round){var pos=this._startPos.add(this._offset.multiplyBy(progress));round&&pos._round(),L.DomUtil.setPosition(this._el,pos),this.fire("step")},_complete:function(){L.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),L.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:L.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(latlng){var d=Math.PI/180,r=this.R,y=latlng.lat*d,tmp=this.R_MINOR/r,e=Math.sqrt(1-tmp*tmp),con=e*Math.sin(y),ts=Math.tan(Math.PI/4-y/2)/Math.pow((1-con)/(1+con),e/2);return y=-r*Math.log(Math.max(ts,1e-10)),new L.Point(latlng.lng*d*r,y)},unproject:function(point){for(var con,d=180/Math.PI,r=this.R,tmp=this.R_MINOR/r,e=Math.sqrt(1-tmp*tmp),ts=Math.exp(-point.y/r),phi=Math.PI/2-2*Math.atan(ts),i=0,dphi=.1;i<15&&Math.abs(dphi)>1e-7;i++)con=e*Math.sin(phi),con=Math.pow((1-con)/(1+con),e/2),dphi=Math.PI/2-2*Math.atan(ts*con)-phi,phi+=dphi;return new L.LatLng(phi*d,point.x*d/r)}},L.CRS.EPSG3395=L.extend({},L.CRS.Earth,{code:"EPSG:3395",projection:L.Projection.Mercator,transformation:function(){var scale=.5/(Math.PI*L.Projection.Mercator.R);return new L.Transformation(scale,.5,(-scale),.5)}()}),L.GridLayer=L.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:L.Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:undefined,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(options){L.setOptions(this,options)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(map){map._addZoomLimit(this)},onRemove:function(map){this._removeAllTiles(),L.DomUtil.remove(this._container),map._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&&(L.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(L.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(opacity){return this.options.opacity=opacity,this._updateOpacity(),this},setZIndex:function(zIndex){return this.options.zIndex=zIndex,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var events={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=L.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),events.move=this._onMove),this._zoomAnimated&&(events.zoomanim=this._animateZoom),events},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof L.Point?s:new L.Point(s,s)},_updateZIndex:function(){this._container&&this.options.zIndex!==undefined&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(compare){for(var zIndex,layers=this.getPane().children,edgeZIndex=-compare(-(1/0),1/0),i=0,len=layers.length;i<len;i++)zIndex=layers[i].style.zIndex,layers[i]!==this._container&&zIndex&&(edgeZIndex=compare(edgeZIndex,+zIndex));isFinite(edgeZIndex)&&(this.options.zIndex=edgeZIndex+compare(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!L.Browser.ielt9){L.DomUtil.setOpacity(this._container,this.options.opacity);var now=+new Date,nextFrame=!1,willPrune=!1;for(var key in this._tiles){var tile=this._tiles[key];if(tile.current&&tile.loaded){var fade=Math.min(1,(now-tile.loaded)/200);L.DomUtil.setOpacity(tile.el,fade),fade<1?nextFrame=!0:(tile.active&&(willPrune=!0),tile.active=!0)}}willPrune&&!this._noPrune&&this._pruneTiles(),nextFrame&&(L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var zoom=this._tileZoom,maxZoom=this.options.maxZoom;if(zoom===undefined)return undefined;for(var z in this._levels)this._levels[z].el.children.length||z===zoom?this._levels[z].el.style.zIndex=maxZoom-Math.abs(zoom-z):(L.DomUtil.remove(this._levels[z].el),this._removeTilesAtZoom(z),delete this._levels[z]);var level=this._levels[zoom],map=this._map;return level||(level=this._levels[zoom]={},level.el=L.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),level.el.style.zIndex=maxZoom,level.origin=map.project(map.unproject(map.getPixelOrigin()),zoom).round(),level.zoom=zoom,this._setZoomTransform(level,map.getCenter(),map.getZoom()),L.Util.falseFn(level.el.offsetWidth)),this._level=level,level},_pruneTiles:function(){if(this._map){var key,tile,zoom=this._map.getZoom();if(zoom>this.options.maxZoom||zoom<this.options.minZoom)return void this._removeAllTiles();for(key in this._tiles)tile=this._tiles[key],tile.retain=tile.current;for(key in this._tiles)if(tile=this._tiles[key],tile.current&&!tile.active){var coords=tile.coords;this._retainParent(coords.x,coords.y,coords.z,coords.z-5)||this._retainChildren(coords.x,coords.y,coords.z,coords.z+2)}for(key in this._tiles)this._tiles[key].retain||this._removeTile(key)}},_removeTilesAtZoom:function(zoom){for(var key in this._tiles)this._tiles[key].coords.z===zoom&&this._removeTile(key)},_removeAllTiles:function(){for(var key in this._tiles)this._removeTile(key)},_invalidateAll:function(){for(var z in this._levels)L.DomUtil.remove(this._levels[z].el),delete this._levels[z];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(x,y,z,minZoom){var x2=Math.floor(x/2),y2=Math.floor(y/2),z2=z-1,coords2=new L.Point((+x2),(+y2));coords2.z=+z2;var key=this._tileCoordsToKey(coords2),tile=this._tiles[key];return tile&&tile.active?(tile.retain=!0,!0):(tile&&tile.loaded&&(tile.retain=!0),z2>minZoom&&this._retainParent(x2,y2,z2,minZoom))},_retainChildren:function(x,y,z,maxZoom){for(var i=2*x;i<2*x+2;i++)for(var j=2*y;j<2*y+2;j++){var coords=new L.Point(i,j);coords.z=z+1;var key=this._tileCoordsToKey(coords),tile=this._tiles[key];tile&&tile.active?tile.retain=!0:(tile&&tile.loaded&&(tile.retain=!0),z+1<maxZoom&&this._retainChildren(i,j,z+1,maxZoom))}},_resetView:function(e){
var animating=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),animating,animating)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_setView:function(center,zoom,noPrune,noUpdate){var tileZoom=Math.round(zoom);(this.options.maxZoom!==undefined&&tileZoom>this.options.maxZoom||this.options.minZoom!==undefined&&tileZoom<this.options.minZoom)&&(tileZoom=undefined);var tileZoomChanged=this.options.updateWhenZooming&&tileZoom!==this._tileZoom;noUpdate&&!tileZoomChanged||(this._tileZoom=tileZoom,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),tileZoom!==undefined&&this._update(center),noPrune||this._pruneTiles(),this._noPrune=!!noPrune),this._setZoomTransforms(center,zoom)},_setZoomTransforms:function(center,zoom){for(var i in this._levels)this._setZoomTransform(this._levels[i],center,zoom)},_setZoomTransform:function(level,center,zoom){var scale=this._map.getZoomScale(zoom,level.zoom),translate=level.origin.multiplyBy(scale).subtract(this._map._getNewPixelOrigin(center,zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(level.el,translate,scale):L.DomUtil.setPosition(level.el,translate)},_resetGrid:function(){var map=this._map,crs=map.options.crs,tileSize=this._tileSize=this.getTileSize(),tileZoom=this._tileZoom,bounds=this._map.getPixelWorldBounds(this._tileZoom);bounds&&(this._globalTileRange=this._pxBoundsToTileRange(bounds)),this._wrapX=crs.wrapLng&&!this.options.noWrap&&[Math.floor(map.project([0,crs.wrapLng[0]],tileZoom).x/tileSize.x),Math.ceil(map.project([0,crs.wrapLng[1]],tileZoom).x/tileSize.y)],this._wrapY=crs.wrapLat&&!this.options.noWrap&&[Math.floor(map.project([crs.wrapLat[0],0],tileZoom).y/tileSize.x),Math.ceil(map.project([crs.wrapLat[1],0],tileZoom).y/tileSize.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(center){var map=this._map,mapZoom=map._animatingZoom?Math.max(map._animateToZoom,map.getZoom()):map.getZoom(),scale=map.getZoomScale(mapZoom,this._tileZoom),pixelCenter=map.project(center,this._tileZoom).floor(),halfSize=map.getSize().divideBy(2*scale);return new L.Bounds(pixelCenter.subtract(halfSize),pixelCenter.add(halfSize))},_update:function(center){var map=this._map;if(map){var zoom=map.getZoom();if(center===undefined&&(center=map.getCenter()),this._tileZoom!==undefined){var pixelBounds=this._getTiledPixelBounds(center),tileRange=this._pxBoundsToTileRange(pixelBounds),tileCenter=tileRange.getCenter(),queue=[],margin=this.options.keepBuffer,noPruneRange=new L.Bounds(tileRange.getBottomLeft().subtract([margin,-margin]),tileRange.getTopRight().add([margin,-margin]));for(var key in this._tiles){var c=this._tiles[key].coords;c.z===this._tileZoom&&noPruneRange.contains(L.point(c.x,c.y))||(this._tiles[key].current=!1)}if(Math.abs(zoom-this._tileZoom)>1)return void this._setView(center,zoom);for(var j=tileRange.min.y;j<=tileRange.max.y;j++)for(var i=tileRange.min.x;i<=tileRange.max.x;i++){var coords=new L.Point(i,j);if(coords.z=this._tileZoom,this._isValidTile(coords)){var tile=this._tiles[this._tileCoordsToKey(coords)];tile?tile.current=!0:queue.push(coords)}}if(queue.sort(function(a,b){return a.distanceTo(tileCenter)-b.distanceTo(tileCenter)}),0!==queue.length){this._loading||(this._loading=!0,this.fire("loading"));var fragment=document.createDocumentFragment();for(i=0;i<queue.length;i++)this._addTile(queue[i],fragment);this._level.el.appendChild(fragment)}}}},_isValidTile:function(coords){var crs=this._map.options.crs;if(!crs.infinite){var bounds=this._globalTileRange;if(!crs.wrapLng&&(coords.x<bounds.min.x||coords.x>bounds.max.x)||!crs.wrapLat&&(coords.y<bounds.min.y||coords.y>bounds.max.y))return!1}if(!this.options.bounds)return!0;var tileBounds=this._tileCoordsToBounds(coords);return L.latLngBounds(this.options.bounds).overlaps(tileBounds)},_keyToBounds:function(key){return this._tileCoordsToBounds(this._keyToTileCoords(key))},_tileCoordsToBounds:function(coords){var map=this._map,tileSize=this.getTileSize(),nwPoint=coords.scaleBy(tileSize),sePoint=nwPoint.add(tileSize),nw=map.unproject(nwPoint,coords.z),se=map.unproject(sePoint,coords.z),bounds=new L.LatLngBounds(nw,se);return this.options.noWrap||map.wrapLatLngBounds(bounds),bounds},_tileCoordsToKey:function(coords){return coords.x+":"+coords.y+":"+coords.z},_keyToTileCoords:function(key){var k=key.split(":"),coords=new L.Point((+k[0]),(+k[1]));return coords.z=+k[2],coords},_removeTile:function(key){var tile=this._tiles[key];tile&&(L.DomUtil.remove(tile.el),delete this._tiles[key],this.fire("tileunload",{tile:tile.el,coords:this._keyToTileCoords(key)}))},_initTile:function(tile){L.DomUtil.addClass(tile,"leaflet-tile");var tileSize=this.getTileSize();tile.style.width=tileSize.x+"px",tile.style.height=tileSize.y+"px",tile.onselectstart=L.Util.falseFn,tile.onmousemove=L.Util.falseFn,L.Browser.ielt9&&this.options.opacity<1&&L.DomUtil.setOpacity(tile,this.options.opacity),L.Browser.android&&!L.Browser.android23&&(tile.style.WebkitBackfaceVisibility="hidden")},_addTile:function(coords,container){var tilePos=this._getTilePos(coords),key=this._tileCoordsToKey(coords),tile=this.createTile(this._wrapCoords(coords),L.bind(this._tileReady,this,coords));this._initTile(tile),this.createTile.length<2&&L.Util.requestAnimFrame(L.bind(this._tileReady,this,coords,null,tile)),L.DomUtil.setPosition(tile,tilePos),this._tiles[key]={el:tile,coords:coords,current:!0},container.appendChild(tile),this.fire("tileloadstart",{tile:tile,coords:coords})},_tileReady:function(coords,err,tile){if(this._map){err&&this.fire("tileerror",{error:err,tile:tile,coords:coords});var key=this._tileCoordsToKey(coords);tile=this._tiles[key],tile&&(tile.loaded=+new Date,this._map._fadeAnimated?(L.DomUtil.setOpacity(tile.el,0),L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)):(tile.active=!0,this._pruneTiles()),err||(L.DomUtil.addClass(tile.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:tile.el,coords:coords})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),L.Browser.ielt9||!this._map._fadeAnimated?L.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(L.bind(this._pruneTiles,this),250)))}},_getTilePos:function(coords){return coords.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(coords){var newCoords=new L.Point(this._wrapX?L.Util.wrapNum(coords.x,this._wrapX):coords.x,this._wrapY?L.Util.wrapNum(coords.y,this._wrapY):coords.y);return newCoords.z=coords.z,newCoords},_pxBoundsToTileRange:function(bounds){var tileSize=this.getTileSize();return new L.Bounds(bounds.min.unscaleBy(tileSize).floor(),bounds.max.unscaleBy(tileSize).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var key in this._tiles)if(!this._tiles[key].loaded)return!1;return!0}}),L.gridLayer=function(options){return new L.GridLayer(options)},L.TileLayer=L.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(url,options){this._url=url,options=L.setOptions(this,options),options.detectRetina&&L.Browser.retina&&options.maxZoom>0&&(options.tileSize=Math.floor(options.tileSize/2),options.zoomReverse?(options.zoomOffset--,options.minZoom++):(options.zoomOffset++,options.maxZoom--),options.minZoom=Math.max(0,options.minZoom)),"string"==typeof options.subdomains&&(options.subdomains=options.subdomains.split("")),L.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(url,noRedraw){return this._url=url,noRedraw||this.redraw(),this},createTile:function(coords,done){var tile=document.createElement("img");return L.DomEvent.on(tile,"load",L.bind(this._tileOnLoad,this,done,tile)),L.DomEvent.on(tile,"error",L.bind(this._tileOnError,this,done,tile)),this.options.crossOrigin&&(tile.crossOrigin=""),tile.alt="",tile.setAttribute("role","presentation"),tile.src=this.getTileUrl(coords),tile},getTileUrl:function(coords){var data={r:L.Browser.retina?"@2x":"",s:this._getSubdomain(coords),x:coords.x,y:coords.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var invertedY=this._globalTileRange.max.y-coords.y;this.options.tms&&(data.y=invertedY),data["-y"]=invertedY}return L.Util.template(this._url,L.extend(data,this.options))},_tileOnLoad:function(done,tile){L.Browser.ielt9?setTimeout(L.bind(done,this,null,tile),0):done(null,tile)},_tileOnError:function(done,tile,e){var errorUrl=this.options.errorTileUrl;errorUrl&&tile.src!==errorUrl&&(tile.src=errorUrl),done(e,tile)},getTileSize:function(){var map=this._map,tileSize=L.GridLayer.prototype.getTileSize.call(this),zoom=this._tileZoom+this.options.zoomOffset,minNativeZoom=this.options.minNativeZoom,maxNativeZoom=this.options.maxNativeZoom;return null!==minNativeZoom&&zoom<minNativeZoom?tileSize.divideBy(map.getZoomScale(minNativeZoom,zoom)).round():null!==maxNativeZoom&&zoom>maxNativeZoom?tileSize.divideBy(map.getZoomScale(maxNativeZoom,zoom)).round():tileSize},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var zoom=this._tileZoom,maxZoom=this.options.maxZoom,zoomReverse=this.options.zoomReverse,zoomOffset=this.options.zoomOffset,minNativeZoom=this.options.minNativeZoom,maxNativeZoom=this.options.maxNativeZoom;return zoomReverse&&(zoom=maxZoom-zoom),zoom+=zoomOffset,null!==minNativeZoom&&zoom<minNativeZoom?minNativeZoom:null!==maxNativeZoom&&zoom>maxNativeZoom?maxNativeZoom:zoom},_getSubdomain:function(tilePoint){var index=Math.abs(tilePoint.x+tilePoint.y)%this.options.subdomains.length;return this.options.subdomains[index]},_abortLoading:function(){var i,tile;for(i in this._tiles)this._tiles[i].coords.z!==this._tileZoom&&(tile=this._tiles[i].el,tile.onload=L.Util.falseFn,tile.onerror=L.Util.falseFn,tile.complete||(tile.src=L.Util.emptyImageUrl,L.DomUtil.remove(tile)))}}),L.tileLayer=function(url,options){return new L.TileLayer(url,options)},L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(url,options){this._url=url;var wmsParams=L.extend({},this.defaultWmsParams);for(var i in options)i in this.options||(wmsParams[i]=options[i]);options=L.setOptions(this,options),wmsParams.width=wmsParams.height=options.tileSize*(options.detectRetina&&L.Browser.retina?2:1),this.wmsParams=wmsParams},onAdd:function(map){this._crs=this.options.crs||map.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var projectionKey=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[projectionKey]=this._crs.code,L.TileLayer.prototype.onAdd.call(this,map)},getTileUrl:function(coords){var tileBounds=this._tileCoordsToBounds(coords),nw=this._crs.project(tileBounds.getNorthWest()),se=this._crs.project(tileBounds.getSouthEast()),bbox=(this._wmsVersion>=1.3&&this._crs===L.CRS.EPSG4326?[se.y,nw.x,nw.y,se.x]:[nw.x,se.y,se.x,nw.y]).join(","),url=L.TileLayer.prototype.getTileUrl.call(this,coords);return url+L.Util.getParamString(this.wmsParams,url,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+bbox},setParams:function(params,noRedraw){return L.extend(this.wmsParams,params),noRedraw||this.redraw(),this}}),L.tileLayer.wms=function(url,options){return new L.TileLayer.WMS(url,options)},L.ImageOverlay=L.Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1},initialize:function(url,bounds,options){this._url=url,this._bounds=L.latLngBounds(bounds),L.setOptions(this,options)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(opacity){return this.options.opacity=opacity,this._image&&this._updateOpacity(),this},setStyle:function(styleOpts){return styleOpts.opacity&&this.setOpacity(styleOpts.opacity),this},bringToFront:function(){return this._map&&L.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&L.DomUtil.toBack(this._image),this},setUrl:function(url){return this._url=url,this._image&&(this._image.src=url),this},setBounds:function(bounds){return this._bounds=bounds,this._map&&this._reset(),this},getEvents:function(){var events={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(events.zoomanim=this._animateZoom),events},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var img=this._image=L.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));img.onselectstart=L.Util.falseFn,img.onmousemove=L.Util.falseFn,img.onload=L.bind(this.fire,this,"load"),this.options.crossOrigin&&(img.crossOrigin=""),img.src=this._url,img.alt=this.options.alt},_animateZoom:function(e){var scale=this._map.getZoomScale(e.zoom),offset=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;L.DomUtil.setTransform(this._image,offset,scale)},_reset:function(){var image=this._image,bounds=new L.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),size=bounds.getSize();L.DomUtil.setPosition(image,bounds.min),image.style.width=size.x+"px",image.style.height=size.y+"px"},_updateOpacity:function(){L.DomUtil.setOpacity(this._image,this.options.opacity)}}),L.imageOverlay=function(url,bounds,options){return new L.ImageOverlay(url,bounds,options)},L.Icon=L.Class.extend({initialize:function(options){L.setOptions(this,options)},createIcon:function(oldIcon){return this._createIcon("icon",oldIcon)},createShadow:function(oldIcon){return this._createIcon("shadow",oldIcon)},_createIcon:function(name,oldIcon){var src=this._getIconUrl(name);if(!src){if("icon"===name)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var img=this._createImg(src,oldIcon&&"IMG"===oldIcon.tagName?oldIcon:null);return this._setIconStyles(img,name),img},_setIconStyles:function(img,name){var options=this.options,sizeOption=options[name+"Size"];"number"==typeof sizeOption&&(sizeOption=[sizeOption,sizeOption]);var size=L.point(sizeOption),anchor=L.point("shadow"===name&&options.shadowAnchor||options.iconAnchor||size&&size.divideBy(2,!0));img.className="leaflet-marker-"+name+" "+(options.className||""),anchor&&(img.style.marginLeft=-anchor.x+"px",img.style.marginTop=-anchor.y+"px"),size&&(img.style.width=size.x+"px",img.style.height=size.y+"px")},_createImg:function(src,el){return el=el||document.createElement("img"),el.src=src,el},_getIconUrl:function(name){return L.Browser.retina&&this.options[name+"RetinaUrl"]||this.options[name+"Url"]}}),L.icon=function(options){return new L.Icon(options)},L.Icon.Default=L.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(name){return L.Icon.Default.imagePath||(L.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||L.Icon.Default.imagePath)+L.Icon.prototype._getIconUrl.call(this,name)},_detectIconPath:function(){var el=L.DomUtil.create("div","leaflet-default-icon-path",document.body),path=L.DomUtil.getStyle(el,"background-image")||L.DomUtil.getStyle(el,"backgroundImage");return document.body.removeChild(el),0===path.indexOf("url")?path.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}}),L.Marker=L.Layer.extend({options:{icon:new L.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(latlng,options){L.setOptions(this,options),this._latlng=L.latLng(latlng)},onAdd:function(map){this._zoomAnimated=this._zoomAnimated&&map.options.markerZoomAnimation,this._zoomAnimated&&map.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(map){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&&map.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(latlng){var oldLatLng=this._latlng;return this._latlng=L.latLng(latlng),this.update(),this.fire("move",{oldLatLng:oldLatLng,latlng:this._latlng})},setZIndexOffset:function(offset){return this.options.zIndexOffset=offset,this.update()},setIcon:function(icon){return this.options.icon=icon,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var pos=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(pos)}return this},_initIcon:function(){var options=this.options,classToAdd="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),icon=options.icon.createIcon(this._icon),addIcon=!1;icon!==this._icon&&(this._icon&&this._removeIcon(),addIcon=!0,options.title&&(icon.title=options.title),options.alt&&(icon.alt=options.alt)),L.DomUtil.addClass(icon,classToAdd),options.keyboard&&(icon.tabIndex="0"),this._icon=icon,options.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var newShadow=options.icon.createShadow(this._shadow),addShadow=!1;newShadow!==this._shadow&&(this._removeShadow(),addShadow=!0),newShadow&&(L.DomUtil.addClass(newShadow,classToAdd),newShadow.alt=""),this._shadow=newShadow,options.opacity<1&&this._updateOpacity(),addIcon&&this.getPane().appendChild(this._icon),this._initInteraction(),newShadow&&addShadow&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),L.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&L.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(pos){L.DomUtil.setPosition(this._icon,pos),this._shadow&&L.DomUtil.setPosition(this._shadow,pos),this._zIndex=pos.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(offset){this._icon.style.zIndex=this._zIndex+offset},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center).round();this._setPos(pos)},_initInteraction:function(){if(this.options.interactive&&(L.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),L.Handler.MarkerDrag)){var draggable=this.options.draggable;this.dragging&&(draggable=this.dragging.enabled(),this.dragging.disable()),this.dragging=new L.Handler.MarkerDrag(this),draggable&&this.dragging.enable()}},setOpacity:function(opacity){return this.options.opacity=opacity,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var opacity=this.options.opacity;L.DomUtil.setOpacity(this._icon,opacity),this._shadow&&L.DomUtil.setOpacity(this._shadow,opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),L.marker=function(latlng,options){return new L.Marker(latlng,options)},L.DivIcon=L.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(oldIcon){var div=oldIcon&&"DIV"===oldIcon.tagName?oldIcon:document.createElement("div"),options=this.options;if(div.innerHTML=options.html!==!1?options.html:"",options.bgPos){var bgPos=L.point(options.bgPos);div.style.backgroundPosition=-bgPos.x+"px "+-bgPos.y+"px"}return this._setIconStyles(div,"icon"),div},createShadow:function(){return null}}),L.divIcon=function(options){return new L.DivIcon(options)},L.DivOverlay=L.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(options,source){L.setOptions(this,options),this._source=source},onAdd:function(map){this._zoomAnimated=map._zoomAnimated,this._container||this._initLayout(),map._fadeAnimated&&L.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),map._fadeAnimated&&L.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(map){map._fadeAnimated?(L.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(L.bind(L.DomUtil.remove,L.DomUtil,this._container),200)):L.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(latlng){return this._latlng=L.latLng(latlng),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(content){return this._content=content,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var events={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(events.zoomanim=this._animateZoom),events},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&L.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&&L.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var node=this._contentNode,content="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof content)node.innerHTML=content;else{for(;node.hasChildNodes();)node.removeChild(node.firstChild);node.appendChild(content)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var pos=this._map.latLngToLayerPoint(this._latlng),offset=L.point(this.options.offset),anchor=this._getAnchor();this._zoomAnimated?L.DomUtil.setPosition(this._container,pos.add(anchor)):offset=offset.add(pos).add(anchor);var bottom=this._containerBottom=-offset.y,left=this._containerLeft=-Math.round(this._containerWidth/2)+offset.x;this._container.style.bottom=bottom+"px",this._container.style.left=left+"px"}},_getAnchor:function(){return[0,0]}}),L.Popup=L.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(map){return map.openPopup(this),this},onAdd:function(map){L.DivOverlay.prototype.onAdd.call(this,map),map.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof L.Path||this._source.on("preclick",L.DomEvent.stopPropagation))},onRemove:function(map){L.DivOverlay.prototype.onRemove.call(this,map),map.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof L.Path||this._source.off("preclick",L.DomEvent.stopPropagation))},getEvents:function(){var events=L.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(events.preclick=this._close),this.options.keepInView&&(events.moveend=this._adjustPan),events},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var prefix="leaflet-popup",container=this._container=L.DomUtil.create("div",prefix+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var closeButton=this._closeButton=L.DomUtil.create("a",prefix+"-close-button",container);closeButton.href="#close",closeButton.innerHTML="&#215;",L.DomEvent.on(closeButton,"click",this._onCloseButtonClick,this)}var wrapper=this._wrapper=L.DomUtil.create("div",prefix+"-content-wrapper",container);this._contentNode=L.DomUtil.create("div",prefix+"-content",wrapper),L.DomEvent.disableClickPropagation(wrapper).disableScrollPropagation(this._contentNode).on(wrapper,"contextmenu",L.DomEvent.stopPropagation),this._tipContainer=L.DomUtil.create("div",prefix+"-tip-container",container),this._tip=L.DomUtil.create("div",prefix+"-tip",this._tipContainer)},_updateLayout:function(){var container=this._contentNode,style=container.style;style.width="",style.whiteSpace="nowrap";var width=container.offsetWidth;width=Math.min(width,this.options.maxWidth),width=Math.max(width,this.options.minWidth),style.width=width+1+"px",style.whiteSpace="",style.height="";var height=container.offsetHeight,maxHeight=this.options.maxHeight,scrolledClass="leaflet-popup-scrolled";maxHeight&&height>maxHeight?(style.height=maxHeight+"px",L.DomUtil.addClass(container,scrolledClass)):L.DomUtil.removeClass(container,scrolledClass),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var pos=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),anchor=this._getAnchor();L.DomUtil.setPosition(this._container,pos.add(anchor))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var map=this._map,marginBottom=parseInt(L.DomUtil.getStyle(this._container,"marginBottom"),10)||0,containerHeight=this._container.offsetHeight+marginBottom,containerWidth=this._containerWidth,layerPos=new L.Point(this._containerLeft,-containerHeight-this._containerBottom);layerPos._add(L.DomUtil.getPosition(this._container));var containerPos=map.layerPointToContainerPoint(layerPos),padding=L.point(this.options.autoPanPadding),paddingTL=L.point(this.options.autoPanPaddingTopLeft||padding),paddingBR=L.point(this.options.autoPanPaddingBottomRight||padding),size=map.getSize(),dx=0,dy=0;containerPos.x+containerWidth+paddingBR.x>size.x&&(dx=containerPos.x+containerWidth-size.x+paddingBR.x),containerPos.x-dx-paddingTL.x<0&&(dx=containerPos.x-paddingTL.x),containerPos.y+containerHeight+paddingBR.y>size.y&&(dy=containerPos.y+containerHeight-size.y+paddingBR.y),containerPos.y-dy-paddingTL.y<0&&(dy=containerPos.y-paddingTL.y),(dx||dy)&&map.fire("autopanstart").panBy([dx,dy])}},_onCloseButtonClick:function(e){this._close(),L.DomEvent.stop(e)},_getAnchor:function(){return L.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),L.popup=function(options,source){return new L.Popup(options,source)},L.Map.mergeOptions({closePopupOnClick:!0}),L.Map.include({openPopup:function(popup,latlng,options){return popup instanceof L.Popup||(popup=new L.Popup(options).setContent(popup)),latlng&&popup.setLatLng(latlng),this.hasLayer(popup)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=popup,this.addLayer(popup))},closePopup:function(popup){return popup&&popup!==this._popup||(popup=this._popup,this._popup=null),popup&&this.removeLayer(popup),this}}),L.Layer.include({bindPopup:function(content,options){return content instanceof L.Popup?(L.setOptions(content,options),this._popup=content,content._source=this):(this._popup&&!options||(this._popup=new L.Popup(options,this)),this._popup.setContent(content)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(layer,latlng){if(layer instanceof L.Layer||(latlng=layer,layer=this),layer instanceof L.FeatureGroup)for(var id in this._layers){layer=this._layers[id];break}return latlng||(latlng=layer.getCenter?layer.getCenter():layer.getLatLng()),this._popup&&this._map&&(this._popup._source=layer,this._popup.update(),this._map.openPopup(this._popup,latlng)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(target){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(target)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(content){return this._popup&&this._popup.setContent(content),this},getPopup:function(){return this._popup},_openPopup:function(e){var layer=e.layer||e.target;if(this._popup&&this._map)return L.DomEvent.stop(e),layer instanceof L.Path?void this.openPopup(e.layer||e.target,e.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===layer?this.closePopup():this.openPopup(layer,e.latlng))},_movePopup:function(e){this._popup.setLatLng(e.latlng)}}),L.Tooltip=L.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(map){L.DivOverlay.prototype.onAdd.call(this,map),this.setOpacity(this.options.opacity),map.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(map){L.DivOverlay.prototype.onRemove.call(this,map),map.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var events=L.DivOverlay.prototype.getEvents.call(this);return L.Browser.touch&&!this.options.permanent&&(events.preclick=this._close),events},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var prefix="leaflet-tooltip",className=prefix+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=L.DomUtil.create("div",className)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(pos){var map=this._map,container=this._container,centerPoint=map.latLngToContainerPoint(map.getCenter()),tooltipPoint=map.layerPointToContainerPoint(pos),direction=this.options.direction,tooltipWidth=container.offsetWidth,tooltipHeight=container.offsetHeight,offset=L.point(this.options.offset),anchor=this._getAnchor();"top"===direction?pos=pos.add(L.point(-tooltipWidth/2+offset.x,-tooltipHeight+offset.y+anchor.y,!0)):"bottom"===direction?pos=pos.subtract(L.point(tooltipWidth/2-offset.x,-offset.y,!0)):"center"===direction?pos=pos.subtract(L.point(tooltipWidth/2+offset.x,tooltipHeight/2-anchor.y+offset.y,!0)):"right"===direction||"auto"===direction&&tooltipPoint.x<centerPoint.x?(direction="right",pos=pos.add(L.point(offset.x+anchor.x,anchor.y-tooltipHeight/2+offset.y,!0))):(direction="left",pos=pos.subtract(L.point(tooltipWidth+anchor.x-offset.x,tooltipHeight/2-anchor.y-offset.y,!0))),L.DomUtil.removeClass(container,"leaflet-tooltip-right"),L.DomUtil.removeClass(container,"leaflet-tooltip-left"),L.DomUtil.removeClass(container,"leaflet-tooltip-top"),L.DomUtil.removeClass(container,"leaflet-tooltip-bottom"),L.DomUtil.addClass(container,"leaflet-tooltip-"+direction),L.DomUtil.setPosition(container,pos)},_updatePosition:function(){var pos=this._map.latLngToLayerPoint(this._latlng);this._setPosition(pos)},setOpacity:function(opacity){this.options.opacity=opacity,this._container&&L.DomUtil.setOpacity(this._container,opacity)},_animateZoom:function(e){var pos=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(pos)},_getAnchor:function(){return L.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),L.tooltip=function(options,source){return new L.Tooltip(options,source)},L.Map.include({openTooltip:function(tooltip,latlng,options){return tooltip instanceof L.Tooltip||(tooltip=new L.Tooltip(options).setContent(tooltip)),
latlng&&tooltip.setLatLng(latlng),this.hasLayer(tooltip)?this:this.addLayer(tooltip)},closeTooltip:function(tooltip){return tooltip&&this.removeLayer(tooltip),this}}),L.Layer.include({bindTooltip:function(content,options){return content instanceof L.Tooltip?(L.setOptions(content,options),this._tooltip=content,content._source=this):(this._tooltip&&!options||(this._tooltip=L.tooltip(options,this)),this._tooltip.setContent(content)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(remove){if(remove||!this._tooltipHandlersAdded){var onOff=remove?"off":"on",events={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?events.add=this._openTooltip:(events.mouseover=this._openTooltip,events.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(events.mousemove=this._moveTooltip),L.Browser.touch&&(events.click=this._openTooltip)),this[onOff](events),this._tooltipHandlersAdded=!remove}},openTooltip:function(layer,latlng){if(layer instanceof L.Layer||(latlng=layer,layer=this),layer instanceof L.FeatureGroup)for(var id in this._layers){layer=this._layers[id];break}return latlng||(latlng=layer.getCenter?layer.getCenter():layer.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=layer,this._tooltip.update(),this._map.openTooltip(this._tooltip,latlng),this._tooltip.options.interactive&&this._tooltip._container&&(L.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(L.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(target){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(target)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(content){return this._tooltip&&this._tooltip.setContent(content),this},getTooltip:function(){return this._tooltip},_openTooltip:function(e){var layer=e.layer||e.target;this._tooltip&&this._map&&this.openTooltip(layer,this._tooltip.options.sticky?e.latlng:undefined)},_moveTooltip:function(e){var containerPoint,layerPoint,latlng=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(containerPoint=this._map.mouseEventToContainerPoint(e.originalEvent),layerPoint=this._map.containerPointToLayerPoint(containerPoint),latlng=this._map.layerPointToLatLng(layerPoint)),this._tooltip.setLatLng(latlng)}}),L.LayerGroup=L.Layer.extend({initialize:function(layers){this._layers={};var i,len;if(layers)for(i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},addLayer:function(layer){var id=this.getLayerId(layer);return this._layers[id]=layer,this._map&&this._map.addLayer(layer),this},removeLayer:function(layer){var id=layer in this._layers?layer:this.getLayerId(layer);return this._map&&this._layers[id]&&this._map.removeLayer(this._layers[id]),delete this._layers[id],this},hasLayer:function(layer){return!!layer&&(layer in this._layers||this.getLayerId(layer)in this._layers)},clearLayers:function(){for(var i in this._layers)this.removeLayer(this._layers[i]);return this},invoke:function(methodName){var i,layer,args=Array.prototype.slice.call(arguments,1);for(i in this._layers)layer=this._layers[i],layer[methodName]&&layer[methodName].apply(layer,args);return this},onAdd:function(map){for(var i in this._layers)map.addLayer(this._layers[i])},onRemove:function(map){for(var i in this._layers)map.removeLayer(this._layers[i])},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},getLayer:function(id){return this._layers[id]},getLayers:function(){var layers=[];for(var i in this._layers)layers.push(this._layers[i]);return layers},setZIndex:function(zIndex){return this.invoke("setZIndex",zIndex)},getLayerId:function(layer){return L.stamp(layer)}}),L.layerGroup=function(layers){return new L.LayerGroup(layers)},L.FeatureGroup=L.LayerGroup.extend({addLayer:function(layer){return this.hasLayer(layer)?this:(layer.addEventParent(this),L.LayerGroup.prototype.addLayer.call(this,layer),this.fire("layeradd",{layer:layer}))},removeLayer:function(layer){return this.hasLayer(layer)?(layer in this._layers&&(layer=this._layers[layer]),layer.removeEventParent(this),L.LayerGroup.prototype.removeLayer.call(this,layer),this.fire("layerremove",{layer:layer})):this},setStyle:function(style){return this.invoke("setStyle",style)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var bounds=new L.LatLngBounds;for(var id in this._layers){var layer=this._layers[id];bounds.extend(layer.getBounds?layer.getBounds():layer.getLatLng())}return bounds}}),L.featureGroup=function(layers){return new L.FeatureGroup(layers)},L.Renderer=L.Layer.extend({options:{padding:.1},initialize:function(options){L.setOptions(this,options),L.stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&L.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){L.DomUtil.remove(this._container),this.off("update",this._updatePaths,this)},getEvents:function(){var events={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(events.zoomanim=this._onAnimZoom),events},_onAnimZoom:function(ev){this._updateTransform(ev.center,ev.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(center,zoom){var scale=this._map.getZoomScale(zoom,this._zoom),position=L.DomUtil.getPosition(this._container),viewHalf=this._map.getSize().multiplyBy(.5+this.options.padding),currentCenterPoint=this._map.project(this._center,zoom),destCenterPoint=this._map.project(center,zoom),centerOffset=destCenterPoint.subtract(currentCenterPoint),topLeftOffset=viewHalf.multiplyBy(-scale).add(position).add(viewHalf).subtract(centerOffset);L.Browser.any3d?L.DomUtil.setTransform(this._container,topLeftOffset,scale):L.DomUtil.setPosition(this._container,topLeftOffset)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var id in this._layers)this._layers[id]._reset()},_onZoomEnd:function(){for(var id in this._layers)this._layers[id]._project()},_updatePaths:function(){for(var id in this._layers)this._layers[id]._update()},_update:function(){var p=this.options.padding,size=this._map.getSize(),min=this._map.containerPointToLayerPoint(size.multiplyBy(-p)).round();this._bounds=new L.Bounds(min,min.add(size.multiplyBy(1+2*p)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),L.Map.include({getRenderer:function(layer){var renderer=layer.options.renderer||this._getPaneRenderer(layer.options.pane)||this.options.renderer||this._renderer;return renderer||(renderer=this._renderer=this.options.preferCanvas&&L.canvas()||L.svg()),this.hasLayer(renderer)||this.addLayer(renderer),renderer},_getPaneRenderer:function(name){if("overlayPane"===name||name===undefined)return!1;var renderer=this._paneRenderers[name];return renderer===undefined&&(renderer=L.SVG&&L.svg({pane:name})||L.Canvas&&L.canvas({pane:name}),this._paneRenderers[name]=renderer),renderer}}),L.Path=L.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(map){this._renderer=map.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(style){return L.setOptions(this,style),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(L.Browser.touch?10:0)}}),L.LineUtil={simplify:function(points,tolerance){if(!tolerance||!points.length)return points.slice();var sqTolerance=tolerance*tolerance;return points=this._reducePoints(points,sqTolerance),points=this._simplifyDP(points,sqTolerance)},pointToSegmentDistance:function(p,p1,p2){return Math.sqrt(this._sqClosestPointOnSegment(p,p1,p2,!0))},closestPointOnSegment:function(p,p1,p2){return this._sqClosestPointOnSegment(p,p1,p2)},_simplifyDP:function(points,sqTolerance){var len=points.length,ArrayConstructor=typeof Uint8Array!=undefined+""?Uint8Array:Array,markers=new ArrayConstructor(len);markers[0]=markers[len-1]=1,this._simplifyDPStep(points,markers,sqTolerance,0,len-1);var i,newPoints=[];for(i=0;i<len;i++)markers[i]&&newPoints.push(points[i]);return newPoints},_simplifyDPStep:function(points,markers,sqTolerance,first,last){var index,i,sqDist,maxSqDist=0;for(i=first+1;i<=last-1;i++)sqDist=this._sqClosestPointOnSegment(points[i],points[first],points[last],!0),sqDist>maxSqDist&&(index=i,maxSqDist=sqDist);maxSqDist>sqTolerance&&(markers[index]=1,this._simplifyDPStep(points,markers,sqTolerance,first,index),this._simplifyDPStep(points,markers,sqTolerance,index,last))},_reducePoints:function(points,sqTolerance){for(var reducedPoints=[points[0]],i=1,prev=0,len=points.length;i<len;i++)this._sqDist(points[i],points[prev])>sqTolerance&&(reducedPoints.push(points[i]),prev=i);return prev<len-1&&reducedPoints.push(points[len-1]),reducedPoints},clipSegment:function(a,b,bounds,useLastCode,round){var codeOut,p,newCode,codeA=useLastCode?this._lastCode:this._getBitCode(a,bounds),codeB=this._getBitCode(b,bounds);for(this._lastCode=codeB;;){if(!(codeA|codeB))return[a,b];if(codeA&codeB)return!1;codeOut=codeA||codeB,p=this._getEdgeIntersection(a,b,codeOut,bounds,round),newCode=this._getBitCode(p,bounds),codeOut===codeA?(a=p,codeA=newCode):(b=p,codeB=newCode)}},_getEdgeIntersection:function(a,b,code,bounds,round){var x,y,dx=b.x-a.x,dy=b.y-a.y,min=bounds.min,max=bounds.max;return 8&code?(x=a.x+dx*(max.y-a.y)/dy,y=max.y):4&code?(x=a.x+dx*(min.y-a.y)/dy,y=min.y):2&code?(x=max.x,y=a.y+dy*(max.x-a.x)/dx):1&code&&(x=min.x,y=a.y+dy*(min.x-a.x)/dx),new L.Point(x,y,round)},_getBitCode:function(p,bounds){var code=0;return p.x<bounds.min.x?code|=1:p.x>bounds.max.x&&(code|=2),p.y<bounds.min.y?code|=4:p.y>bounds.max.y&&(code|=8),code},_sqDist:function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},_sqClosestPointOnSegment:function(p,p1,p2,sqDist){var t,x=p1.x,y=p1.y,dx=p2.x-x,dy=p2.y-y,dot=dx*dx+dy*dy;return dot>0&&(t=((p.x-x)*dx+(p.y-y)*dy)/dot,t>1?(x=p2.x,y=p2.y):t>0&&(x+=dx*t,y+=dy*t)),dx=p.x-x,dy=p.y-y,sqDist?dx*dx+dy*dy:new L.Point(x,y)}},L.Polyline=L.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(latlngs,options){L.setOptions(this,options),this._setLatLngs(latlngs)},getLatLngs:function(){return this._latlngs},setLatLngs:function(latlngs){return this._setLatLngs(latlngs),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(p){for(var p1,p2,minDistance=1/0,minPoint=null,closest=L.LineUtil._sqClosestPointOnSegment,j=0,jLen=this._parts.length;j<jLen;j++)for(var points=this._parts[j],i=1,len=points.length;i<len;i++){p1=points[i-1],p2=points[i];var sqDist=closest(p,p1,p2,!0);sqDist<minDistance&&(minDistance=sqDist,minPoint=closest(p,p1,p2))}return minPoint&&(minPoint.distance=Math.sqrt(minDistance)),minPoint},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var i,halfDist,segDist,dist,p1,p2,ratio,points=this._rings[0],len=points.length;if(!len)return null;for(i=0,halfDist=0;i<len-1;i++)halfDist+=points[i].distanceTo(points[i+1])/2;if(0===halfDist)return this._map.layerPointToLatLng(points[0]);for(i=0,dist=0;i<len-1;i++)if(p1=points[i],p2=points[i+1],segDist=p1.distanceTo(p2),dist+=segDist,dist>halfDist)return ratio=(dist-halfDist)/segDist,this._map.layerPointToLatLng([p2.x-ratio*(p2.x-p1.x),p2.y-ratio*(p2.y-p1.y)])},getBounds:function(){return this._bounds},addLatLng:function(latlng,latlngs){return latlngs=latlngs||this._defaultShape(),latlng=L.latLng(latlng),latlngs.push(latlng),this._bounds.extend(latlng),this.redraw()},_setLatLngs:function(latlngs){this._bounds=new L.LatLngBounds,this._latlngs=this._convertLatLngs(latlngs)},_defaultShape:function(){return L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(latlngs){for(var result=[],flat=L.Polyline._flat(latlngs),i=0,len=latlngs.length;i<len;i++)flat?(result[i]=L.latLng(latlngs[i]),this._bounds.extend(result[i])):result[i]=this._convertLatLngs(latlngs[i]);return result},_project:function(){var pxBounds=new L.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,pxBounds);var w=this._clickTolerance(),p=new L.Point(w,w);this._bounds.isValid()&&pxBounds.isValid()&&(pxBounds.min._subtract(p),pxBounds.max._add(p),this._pxBounds=pxBounds)},_projectLatlngs:function(latlngs,result,projectedBounds){var i,ring,flat=latlngs[0]instanceof L.LatLng,len=latlngs.length;if(flat){for(ring=[],i=0;i<len;i++)ring[i]=this._map.latLngToLayerPoint(latlngs[i]),projectedBounds.extend(ring[i]);result.push(ring)}else for(i=0;i<len;i++)this._projectLatlngs(latlngs[i],result,projectedBounds)},_clipPoints:function(){var bounds=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(bounds)){if(this.options.noClip)return void(this._parts=this._rings);var i,j,k,len,len2,segment,points,parts=this._parts;for(i=0,k=0,len=this._rings.length;i<len;i++)for(points=this._rings[i],j=0,len2=points.length;j<len2-1;j++)segment=L.LineUtil.clipSegment(points[j],points[j+1],bounds,j,!0),segment&&(parts[k]=parts[k]||[],parts[k].push(segment[0]),segment[1]===points[j+1]&&j!==len2-2||(parts[k].push(segment[1]),k++))}},_simplifyPoints:function(){for(var parts=this._parts,tolerance=this.options.smoothFactor,i=0,len=parts.length;i<len;i++)parts[i]=L.LineUtil.simplify(parts[i],tolerance)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),L.polyline=function(latlngs,options){return new L.Polyline(latlngs,options)},L.Polyline._flat=function(latlngs){return!L.Util.isArray(latlngs[0])||"object"!=typeof latlngs[0][0]&&"undefined"!=typeof latlngs[0][0]},L.PolyUtil={},L.PolyUtil.clipPolygon=function(points,bounds,round){var clippedPoints,i,j,k,a,b,len,edge,p,edges=[1,4,2,8],lu=L.LineUtil;for(i=0,len=points.length;i<len;i++)points[i]._code=lu._getBitCode(points[i],bounds);for(k=0;k<4;k++){for(edge=edges[k],clippedPoints=[],i=0,len=points.length,j=len-1;i<len;j=i++)a=points[i],b=points[j],a._code&edge?b._code&edge||(p=lu._getEdgeIntersection(b,a,edge,bounds,round),p._code=lu._getBitCode(p,bounds),clippedPoints.push(p)):(b._code&edge&&(p=lu._getEdgeIntersection(b,a,edge,bounds,round),p._code=lu._getBitCode(p,bounds),clippedPoints.push(p)),clippedPoints.push(a));points=clippedPoints}return points},L.Polygon=L.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var i,j,p1,p2,f,area,x,y,center,points=this._rings[0],len=points.length;if(!len)return null;for(area=x=y=0,i=0,j=len-1;i<len;j=i++)p1=points[i],p2=points[j],f=p1.y*p2.x-p2.y*p1.x,x+=(p1.x+p2.x)*f,y+=(p1.y+p2.y)*f,area+=3*f;return center=0===area?points[0]:[x/area,y/area],this._map.layerPointToLatLng(center)},_convertLatLngs:function(latlngs){var result=L.Polyline.prototype._convertLatLngs.call(this,latlngs),len=result.length;return len>=2&&result[0]instanceof L.LatLng&&result[0].equals(result[len-1])&&result.pop(),result},_setLatLngs:function(latlngs){L.Polyline.prototype._setLatLngs.call(this,latlngs),L.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return L.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var bounds=this._renderer._bounds,w=this.options.weight,p=new L.Point(w,w);if(bounds=new L.Bounds(bounds.min.subtract(p),bounds.max.add(p)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(bounds)){if(this.options.noClip)return void(this._parts=this._rings);for(var clipped,i=0,len=this._rings.length;i<len;i++)clipped=L.PolyUtil.clipPolygon(this._rings[i],bounds,!0),clipped.length&&this._parts.push(clipped)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),L.polygon=function(latlngs,options){return new L.Polygon(latlngs,options)},L.Rectangle=L.Polygon.extend({initialize:function(latLngBounds,options){L.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(latLngBounds),options)},setBounds:function(latLngBounds){return this.setLatLngs(this._boundsToLatLngs(latLngBounds))},_boundsToLatLngs:function(latLngBounds){return latLngBounds=L.latLngBounds(latLngBounds),[latLngBounds.getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()]}}),L.rectangle=function(latLngBounds,options){return new L.Rectangle(latLngBounds,options)},L.CircleMarker=L.Path.extend({options:{fill:!0,radius:10},initialize:function(latlng,options){L.setOptions(this,options),this._latlng=L.latLng(latlng),this._radius=this.options.radius},setLatLng:function(latlng){return this._latlng=L.latLng(latlng),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(radius){return this.options.radius=this._radius=radius,this.redraw()},getRadius:function(){return this._radius},setStyle:function(options){var radius=options&&options.radius||this._radius;return L.Path.prototype.setStyle.call(this,options),this.setRadius(radius),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,r2=this._radiusY||r,w=this._clickTolerance(),p=[r+w,r2+w];this._pxBounds=new L.Bounds(this._point.subtract(p),this._point.add(p))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),L.circleMarker=function(latlng,options){return new L.CircleMarker(latlng,options)},L.Circle=L.CircleMarker.extend({initialize:function(latlng,options,legacyOptions){if("number"==typeof options&&(options=L.extend({},legacyOptions,{radius:options})),L.setOptions(this,options),this._latlng=L.latLng(latlng),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(radius){return this._mRadius=radius,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var half=[this._radius,this._radiusY||this._radius];return new L.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(half)),this._map.layerPointToLatLng(this._point.add(half)))},setStyle:L.Path.prototype.setStyle,_project:function(){var lng=this._latlng.lng,lat=this._latlng.lat,map=this._map,crs=map.options.crs;if(crs.distance===L.CRS.Earth.distance){var d=Math.PI/180,latR=this._mRadius/L.CRS.Earth.R/d,top=map.project([lat+latR,lng]),bottom=map.project([lat-latR,lng]),p=top.add(bottom).divideBy(2),lat2=map.unproject(p).lat,lngR=Math.acos((Math.cos(latR*d)-Math.sin(lat*d)*Math.sin(lat2*d))/(Math.cos(lat*d)*Math.cos(lat2*d)))/d;(isNaN(lngR)||0===lngR)&&(lngR=latR/Math.cos(Math.PI/180*lat)),this._point=p.subtract(map.getPixelOrigin()),this._radius=isNaN(lngR)?0:Math.max(Math.round(p.x-map.project([lat2,lng-lngR]).x),1),this._radiusY=Math.max(Math.round(p.y-top.y),1)}else{var latlng2=crs.unproject(crs.project(this._latlng).subtract([this._mRadius,0]));this._point=map.latLngToLayerPoint(this._latlng),this._radius=this._point.x-map.latLngToLayerPoint(latlng2).x}this._updateBounds()}}),L.circle=function(latlng,options,legacyOptions){return new L.Circle(latlng,options,legacyOptions)},L.SVG=L.Renderer.extend({getEvents:function(){var events=L.Renderer.prototype.getEvents.call(this);return events.zoomstart=this._onZoomStart,events},_initContainer:function(){this._container=L.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=L.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){L.Renderer.prototype._update.call(this);var b=this._bounds,size=b.getSize(),container=this._container;this._svgSize&&this._svgSize.equals(size)||(this._svgSize=size,container.setAttribute("width",size.x),container.setAttribute("height",size.y)),L.DomUtil.setPosition(container,b.min),container.setAttribute("viewBox",[b.min.x,b.min.y,size.x,size.y].join(" ")),this.fire("update")}},_initPath:function(layer){var path=layer._path=L.SVG.create("path");layer.options.className&&L.DomUtil.addClass(path,layer.options.className),layer.options.interactive&&L.DomUtil.addClass(path,"leaflet-interactive"),this._updateStyle(layer),this._layers[L.stamp(layer)]=layer},_addPath:function(layer){this._rootGroup.appendChild(layer._path),layer.addInteractiveTarget(layer._path)},_removePath:function(layer){L.DomUtil.remove(layer._path),layer.removeInteractiveTarget(layer._path),delete this._layers[L.stamp(layer)]},_updatePath:function(layer){layer._project(),layer._update()},_updateStyle:function(layer){var path=layer._path,options=layer.options;path&&(options.stroke?(path.setAttribute("stroke",options.color),path.setAttribute("stroke-opacity",options.opacity),path.setAttribute("stroke-width",options.weight),path.setAttribute("stroke-linecap",options.lineCap),path.setAttribute("stroke-linejoin",options.lineJoin),options.dashArray?path.setAttribute("stroke-dasharray",options.dashArray):path.removeAttribute("stroke-dasharray"),options.dashOffset?path.setAttribute("stroke-dashoffset",options.dashOffset):path.removeAttribute("stroke-dashoffset")):path.setAttribute("stroke","none"),options.fill?(path.setAttribute("fill",options.fillColor||options.color),path.setAttribute("fill-opacity",options.fillOpacity),path.setAttribute("fill-rule",options.fillRule||"evenodd")):path.setAttribute("fill","none"))},_updatePoly:function(layer,closed){this._setPath(layer,L.SVG.pointsToPath(layer._parts,closed))},_updateCircle:function(layer){var p=layer._point,r=layer._radius,r2=layer._radiusY||r,arc="a"+r+","+r2+" 0 1,0 ",d=layer._empty()?"M0 0":"M"+(p.x-r)+","+p.y+arc+2*r+",0 "+arc+2*-r+",0 ";this._setPath(layer,d)},_setPath:function(layer,path){layer._path.setAttribute("d",path)},_bringToFront:function(layer){L.DomUtil.toFront(layer._path)},_bringToBack:function(layer){L.DomUtil.toBack(layer._path)}}),L.extend(L.SVG,{create:function(name){return document.createElementNS("http://www.w3.org/2000/svg",name)},pointsToPath:function(rings,closed){var i,j,len,len2,points,p,str="";for(i=0,len=rings.length;i<len;i++){for(points=rings[i],j=0,len2=points.length;j<len2;j++)p=points[j],str+=(j?"L":"M")+p.x+" "+p.y;str+=closed?L.Browser.svg?"z":"x":""}return str||"M0 0"}}),L.Browser.svg=!(!document.createElementNS||!L.SVG.create("svg").createSVGRect),L.svg=function(options){return L.Browser.svg||L.Browser.vml?new L.SVG(options):null},L.Browser.vml=!L.Browser.svg&&function(){try{var div=document.createElement("div");div.innerHTML='<v:shape adj="1"/>';var shape=div.firstChild;return shape.style.behavior="url(#default#VML)",shape&&"object"==typeof shape.adj}catch(e){return!1}}(),L.SVG.include(L.Browser.vml?{_initContainer:function(){this._container=L.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(L.Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(layer){var container=layer._container=L.SVG.create("shape");L.DomUtil.addClass(container,"leaflet-vml-shape "+(this.options.className||"")),container.coordsize="1 1",layer._path=L.SVG.create("path"),container.appendChild(layer._path),this._updateStyle(layer),this._layers[L.stamp(layer)]=layer},_addPath:function(layer){var container=layer._container;this._container.appendChild(container),layer.options.interactive&&layer.addInteractiveTarget(container)},_removePath:function(layer){var container=layer._container;L.DomUtil.remove(container),layer.removeInteractiveTarget(container),delete this._layers[L.stamp(layer)]},_updateStyle:function(layer){var stroke=layer._stroke,fill=layer._fill,options=layer.options,container=layer._container;container.stroked=!!options.stroke,container.filled=!!options.fill,options.stroke?(stroke||(stroke=layer._stroke=L.SVG.create("stroke")),container.appendChild(stroke),stroke.weight=options.weight+"px",stroke.color=options.color,stroke.opacity=options.opacity,options.dashArray?stroke.dashStyle=L.Util.isArray(options.dashArray)?options.dashArray.join(" "):options.dashArray.replace(/( *, *)/g," "):stroke.dashStyle="",stroke.endcap=options.lineCap.replace("butt","flat"),stroke.joinstyle=options.lineJoin):stroke&&(container.removeChild(stroke),layer._stroke=null),options.fill?(fill||(fill=layer._fill=L.SVG.create("fill")),container.appendChild(fill),fill.color=options.fillColor||options.color,fill.opacity=options.fillOpacity):fill&&(container.removeChild(fill),layer._fill=null)},_updateCircle:function(layer){var p=layer._point.round(),r=Math.round(layer._radius),r2=Math.round(layer._radiusY||r);this._setPath(layer,layer._empty()?"M0 0":"AL "+p.x+","+p.y+" "+r+","+r2+" 0,23592600")},_setPath:function(layer,path){layer._path.v=path},_bringToFront:function(layer){L.DomUtil.toFront(layer._container)},_bringToBack:function(layer){L.DomUtil.toBack(layer._container)}}:{}),L.Browser.vml&&(L.SVG.create=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(name){return document.createElement("<lvml:"+name+' class="lvml">')}}catch(e){return function(name){return document.createElement("<"+name+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),L.Canvas=L.Renderer.extend({getEvents:function(){var events=L.Renderer.prototype.getEvents.call(this);return events.viewprereset=this._onViewPreReset,events},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){L.Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var container=this._container=document.createElement("canvas");L.DomEvent.on(container,"mousemove",L.Util.throttle(this._onMouseMove,32,this),this).on(container,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(container,"mouseout",this._handleMouseOut,this),this._ctx=container.getContext("2d")},_updatePaths:function(){if(!this._postponeUpdatePaths){var layer;this._redrawBounds=null;for(var id in this._layers)layer=this._layers[id],layer._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},L.Renderer.prototype._update.call(this);var b=this._bounds,container=this._container,size=b.getSize(),m=L.Browser.retina?2:1;L.DomUtil.setPosition(container,b.min),container.width=m*size.x,container.height=m*size.y,container.style.width=size.x+"px",container.style.height=size.y+"px",L.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-b.min.x,-b.min.y),this.fire("update")}},_reset:function(){L.Renderer.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(layer){this._updateDashArray(layer),this._layers[L.stamp(layer)]=layer;var order=layer._order={layer:layer,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=order),this._drawLast=order,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(layer){this._requestRedraw(layer)},_removePath:function(layer){var order=layer._order,next=order.next,prev=order.prev;next?next.prev=prev:this._drawLast=prev,prev?prev.next=next:this._drawFirst=next,delete layer._order,delete this._layers[L.stamp(layer)],this._requestRedraw(layer)},_updatePath:function(layer){this._extendRedrawBounds(layer),layer._project(),layer._update(),this._requestRedraw(layer)},_updateStyle:function(layer){this._updateDashArray(layer),this._requestRedraw(layer)},_updateDashArray:function(layer){if(layer.options.dashArray){var i,parts=layer.options.dashArray.split(","),dashArray=[];for(i=0;i<parts.length;i++)dashArray.push(Number(parts[i]));layer.options._dashArray=dashArray}},_requestRedraw:function(layer){this._map&&(this._extendRedrawBounds(layer),this._redrawRequest=this._redrawRequest||L.Util.requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(layer){var padding=(layer.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new L.Bounds,this._redrawBounds.extend(layer._pxBounds.min.subtract([padding,padding])),this._redrawBounds.extend(layer._pxBounds.max.add([padding,padding]))},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var bounds=this._redrawBounds;if(bounds){var size=bounds.getSize();this._ctx.clearRect(bounds.min.x,bounds.min.y,size.x,size.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var layer,bounds=this._redrawBounds;if(this._ctx.save(),bounds){var size=bounds.getSize();this._ctx.beginPath(),this._ctx.rect(bounds.min.x,bounds.min.y,size.x,size.y),this._ctx.clip()}this._drawing=!0;for(var order=this._drawFirst;order;order=order.next)layer=order.layer,(!bounds||layer._pxBounds&&layer._pxBounds.intersects(bounds))&&layer._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(layer,closed){if(this._drawing){var i,j,len2,p,parts=layer._parts,len=parts.length,ctx=this._ctx;if(len){for(this._drawnLayers[layer._leaflet_id]=layer,ctx.beginPath(),ctx.setLineDash&&ctx.setLineDash(layer.options&&layer.options._dashArray||[]),i=0;i<len;i++){for(j=0,len2=parts[i].length;j<len2;j++)p=parts[i][j],ctx[j?"lineTo":"moveTo"](p.x,p.y);closed&&ctx.closePath()}this._fillStroke(ctx,layer)}}},_updateCircle:function(layer){if(this._drawing&&!layer._empty()){var p=layer._point,ctx=this._ctx,r=layer._radius,s=(layer._radiusY||r)/r;this._drawnLayers[layer._leaflet_id]=layer,1!==s&&(ctx.save(),ctx.scale(1,s)),ctx.beginPath(),ctx.arc(p.x,p.y/s,r,0,2*Math.PI,!1),1!==s&&ctx.restore(),this._fillStroke(ctx,layer)}},_fillStroke:function(ctx,layer){var options=layer.options;options.fill&&(ctx.globalAlpha=options.fillOpacity,ctx.fillStyle=options.fillColor||options.color,ctx.fill(options.fillRule||"evenodd")),options.stroke&&0!==options.weight&&(ctx.globalAlpha=options.opacity,ctx.lineWidth=options.weight,ctx.strokeStyle=options.color,ctx.lineCap=options.lineCap,ctx.lineJoin=options.lineJoin,ctx.stroke())},_onClick:function(e){for(var layer,clickedLayer,point=this._map.mouseEventToLayerPoint(e),order=this._drawFirst;order;order=order.next)layer=order.layer,layer.options.interactive&&layer._containsPoint(point)&&!this._map._draggableMoved(layer)&&(clickedLayer=layer);clickedLayer&&(L.DomEvent._fakeStop(e),this._fireEvent([clickedLayer],e))},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var point=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,point)}},_handleMouseOut:function(e){
var layer=this._hoveredLayer;layer&&(L.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([layer],e,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(e,point){for(var layer,candidateHoveredLayer,order=this._drawFirst;order;order=order.next)layer=order.layer,layer.options.interactive&&layer._containsPoint(point)&&(candidateHoveredLayer=layer);candidateHoveredLayer!==this._hoveredLayer&&(this._handleMouseOut(e),candidateHoveredLayer&&(L.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([candidateHoveredLayer],e,"mouseover"),this._hoveredLayer=candidateHoveredLayer)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],e)},_fireEvent:function(layers,e,type){this._map._fireDOMEvent(e,type||e.type,layers)},_bringToFront:function(layer){var order=layer._order,next=order.next,prev=order.prev;next&&(next.prev=prev,prev?prev.next=next:next&&(this._drawFirst=next),order.prev=this._drawLast,this._drawLast.next=order,order.next=null,this._drawLast=order,this._requestRedraw(layer))},_bringToBack:function(layer){var order=layer._order,next=order.next,prev=order.prev;prev&&(prev.next=next,next?next.prev=prev:prev&&(this._drawLast=prev),order.prev=null,order.next=this._drawFirst,this._drawFirst.prev=order,this._drawFirst=order,this._requestRedraw(layer))}}),L.Browser.canvas=function(){return!!document.createElement("canvas").getContext}(),L.canvas=function(options){return L.Browser.canvas?new L.Canvas(options):null},L.Polyline.prototype._containsPoint=function(p,closed){var i,j,k,len,len2,part,w=this._clickTolerance();if(!this._pxBounds.contains(p))return!1;for(i=0,len=this._parts.length;i<len;i++)for(part=this._parts[i],j=0,len2=part.length,k=len2-1;j<len2;k=j++)if((closed||0!==j)&&L.LineUtil.pointToSegmentDistance(p,part[k],part[j])<=w)return!0;return!1},L.Polygon.prototype._containsPoint=function(p){var part,p1,p2,i,j,k,len,len2,inside=!1;if(!this._pxBounds.contains(p))return!1;for(i=0,len=this._parts.length;i<len;i++)for(part=this._parts[i],j=0,len2=part.length,k=len2-1;j<len2;k=j++)p1=part[j],p2=part[k],p1.y>p.y!=p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x&&(inside=!inside);return inside||L.Polyline.prototype._containsPoint.call(this,p,!0)},L.CircleMarker.prototype._containsPoint=function(p){return p.distanceTo(this._point)<=this._radius+this._clickTolerance()},L.GeoJSON=L.FeatureGroup.extend({initialize:function(geojson,options){L.setOptions(this,options),this._layers={},geojson&&this.addData(geojson)},addData:function(geojson){var i,len,feature,features=L.Util.isArray(geojson)?geojson:geojson.features;if(features){for(i=0,len=features.length;i<len;i++)feature=features[i],(feature.geometries||feature.geometry||feature.features||feature.coordinates)&&this.addData(feature);return this}var options=this.options;if(options.filter&&!options.filter(geojson))return this;var layer=L.GeoJSON.geometryToLayer(geojson,options);return layer?(layer.feature=L.GeoJSON.asFeature(geojson),layer.defaultOptions=layer.options,this.resetStyle(layer),options.onEachFeature&&options.onEachFeature(geojson,layer),this.addLayer(layer)):this},resetStyle:function(layer){return layer.options=L.Util.extend({},layer.defaultOptions),this._setLayerStyle(layer,this.options.style),this},setStyle:function(style){return this.eachLayer(function(layer){this._setLayerStyle(layer,style)},this)},_setLayerStyle:function(layer,style){"function"==typeof style&&(style=style(layer.feature)),layer.setStyle&&layer.setStyle(style)}}),L.extend(L.GeoJSON,{geometryToLayer:function(geojson,options){var latlng,latlngs,i,len,geometry="Feature"===geojson.type?geojson.geometry:geojson,coords=geometry?geometry.coordinates:null,layers=[],pointToLayer=options&&options.pointToLayer,coordsToLatLng=options&&options.coordsToLatLng||this.coordsToLatLng;if(!coords&&!geometry)return null;switch(geometry.type){case"Point":return latlng=coordsToLatLng(coords),pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);case"MultiPoint":for(i=0,len=coords.length;i<len;i++)latlng=coordsToLatLng(coords[i]),layers.push(pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng));return new L.FeatureGroup(layers);case"LineString":case"MultiLineString":return latlngs=this.coordsToLatLngs(coords,"LineString"===geometry.type?0:1,coordsToLatLng),new L.Polyline(latlngs,options);case"Polygon":case"MultiPolygon":return latlngs=this.coordsToLatLngs(coords,"Polygon"===geometry.type?1:2,coordsToLatLng),new L.Polygon(latlngs,options);case"GeometryCollection":for(i=0,len=geometry.geometries.length;i<len;i++){var layer=this.geometryToLayer({geometry:geometry.geometries[i],type:"Feature",properties:geojson.properties},options);layer&&layers.push(layer)}return new L.FeatureGroup(layers);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(coords){return new L.LatLng(coords[1],coords[0],coords[2])},coordsToLatLngs:function(coords,levelsDeep,coordsToLatLng){for(var latlng,latlngs=[],i=0,len=coords.length;i<len;i++)latlng=levelsDeep?this.coordsToLatLngs(coords[i],levelsDeep-1,coordsToLatLng):(coordsToLatLng||this.coordsToLatLng)(coords[i]),latlngs.push(latlng);return latlngs},latLngToCoords:function(latlng){return latlng.alt!==undefined?[latlng.lng,latlng.lat,latlng.alt]:[latlng.lng,latlng.lat]},latLngsToCoords:function(latlngs,levelsDeep,closed){for(var coords=[],i=0,len=latlngs.length;i<len;i++)coords.push(levelsDeep?L.GeoJSON.latLngsToCoords(latlngs[i],levelsDeep-1,closed):L.GeoJSON.latLngToCoords(latlngs[i]));return!levelsDeep&&closed&&coords.push(coords[0]),coords},getFeature:function(layer,newGeometry){return layer.feature?L.extend({},layer.feature,{geometry:newGeometry}):L.GeoJSON.asFeature(newGeometry)},asFeature:function(geojson){return"Feature"===geojson.type||"FeatureCollection"===geojson.type?geojson:{type:"Feature",properties:{},geometry:geojson}}});var PointToGeoJSON={toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:"Point",coordinates:L.GeoJSON.latLngToCoords(this.getLatLng())})}};L.Marker.include(PointToGeoJSON),L.Circle.include(PointToGeoJSON),L.CircleMarker.include(PointToGeoJSON),L.Polyline.prototype.toGeoJSON=function(){var multi=!L.Polyline._flat(this._latlngs),coords=L.GeoJSON.latLngsToCoords(this._latlngs,multi?1:0);return L.GeoJSON.getFeature(this,{type:(multi?"Multi":"")+"LineString",coordinates:coords})},L.Polygon.prototype.toGeoJSON=function(){var holes=!L.Polyline._flat(this._latlngs),multi=holes&&!L.Polyline._flat(this._latlngs[0]),coords=L.GeoJSON.latLngsToCoords(this._latlngs,multi?2:holes?1:0,!0);return holes||(coords=[coords]),L.GeoJSON.getFeature(this,{type:(multi?"Multi":"")+"Polygon",coordinates:coords})},L.LayerGroup.include({toMultiPoint:function(){var coords=[];return this.eachLayer(function(layer){coords.push(layer.toGeoJSON().geometry.coordinates)}),L.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:coords})},toGeoJSON:function(){var type=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===type)return this.toMultiPoint();var isGeometryCollection="GeometryCollection"===type,jsons=[];return this.eachLayer(function(layer){if(layer.toGeoJSON){var json=layer.toGeoJSON();jsons.push(isGeometryCollection?json.geometry:L.GeoJSON.asFeature(json))}}),isGeometryCollection?L.GeoJSON.getFeature(this,{geometries:jsons,type:"GeometryCollection"}):{type:"FeatureCollection",features:jsons}}}),L.geoJSON=function(geojson,options){return new L.GeoJSON(geojson,options)},L.geoJson=L.geoJSON,L.Draggable=L.Evented.extend({options:{clickTolerance:3},statics:{START:L.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(element,dragStartTarget,preventOutline){this._element=element,this._dragStartTarget=dragStartTarget||element,this._preventOutline=preventOutline},enable:function(){this._enabled||(L.DomEvent.on(this._dragStartTarget,L.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(L.Draggable._dragging===this&&this.finishDrag(),L.DomEvent.off(this._dragStartTarget,L.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(!e._simulated&&this._enabled&&(this._moved=!1,!L.DomUtil.hasClass(this._element,"leaflet-zoom-anim")&&!(L.Draggable._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||(L.Draggable._dragging=this,this._preventOutline&&L.DomUtil.preventOutline(this._element),L.DomUtil.disableImageDrag(),L.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var first=e.touches?e.touches[0]:e;this._startPoint=new L.Point(first.clientX,first.clientY),L.DomEvent.on(document,L.Draggable.MOVE[e.type],this._onMove,this).on(document,L.Draggable.END[e.type],this._onUp,this)}},_onMove:function(e){if(!e._simulated&&this._enabled){if(e.touches&&e.touches.length>1)return void(this._moved=!0);var first=e.touches&&1===e.touches.length?e.touches[0]:e,newPoint=new L.Point(first.clientX,first.clientY),offset=newPoint.subtract(this._startPoint);(offset.x||offset.y)&&(Math.abs(offset.x)+Math.abs(offset.y)<this.options.clickTolerance||(L.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=L.DomUtil.getPosition(this._element).subtract(offset),L.DomUtil.addClass(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),L.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(offset),this._moving=!0,L.Util.cancelAnimFrame(this._animRequest),this._lastEvent=e,this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),L.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",e)},_onUp:function(e){!e._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){L.DomUtil.removeClass(document.body,"leaflet-dragging"),this._lastTarget&&(L.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var i in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[i],this._onMove,this).off(document,L.Draggable.END[i],this._onUp,this);L.DomUtil.enableImageDrag(),L.DomUtil.enableTextSelection(),this._moved&&this._moving&&(L.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,L.Draggable._dragging=!1}}),L.Handler=L.Class.extend({initialize:function(map){this._map=map},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),L.Map.mergeOptions({dragging:!0,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new L.Draggable(map._mapPane,map._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),map.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),map.on("zoomend",this._onZoomEnd,this),map.whenReady(this._onZoomEnd,this))}L.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){L.DomUtil.removeClass(this._map._container,"leaflet-grab"),L.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var map=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var bounds=L.latLngBounds(this._map.options.maxBounds);this._offsetLimit=L.bounds(this._map.latLngToContainerPoint(bounds.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(bounds.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;map.fire("movestart").fire("dragstart"),map.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var time=this._lastTime=+new Date,pos=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(pos),this._times.push(time),time-this._times[0]>50&&(this._positions.shift(),this._times.shift())}this._map.fire("move",e).fire("drag",e)},_onZoomEnd:function(){var pxCenter=this._map.getSize().divideBy(2),pxWorldCenter=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=pxWorldCenter.subtract(pxCenter).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(value,threshold){return value-(value-threshold)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var offset=this._draggable._newPos.subtract(this._draggable._startPos),limit=this._offsetLimit;offset.x<limit.min.x&&(offset.x=this._viscousLimit(offset.x,limit.min.x)),offset.y<limit.min.y&&(offset.y=this._viscousLimit(offset.y,limit.min.y)),offset.x>limit.max.x&&(offset.x=this._viscousLimit(offset.x,limit.max.x)),offset.y>limit.max.y&&(offset.y=this._viscousLimit(offset.y,limit.max.y)),this._draggable._newPos=this._draggable._startPos.add(offset)}},_onPreDragWrap:function(){var worldWidth=this._worldWidth,halfWidth=Math.round(worldWidth/2),dx=this._initialWorldOffset,x=this._draggable._newPos.x,newX1=(x-halfWidth+dx)%worldWidth+halfWidth-dx,newX2=(x+halfWidth+dx)%worldWidth-halfWidth-dx,newX=Math.abs(newX1+dx)<Math.abs(newX2+dx)?newX1:newX2;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=newX},_onDragEnd:function(e){var map=this._map,options=map.options,noInertia=!options.inertia||this._times.length<2;if(map.fire("dragend",e),noInertia)map.fire("moveend");else{var direction=this._lastPos.subtract(this._positions[0]),duration=(this._lastTime-this._times[0])/1e3,ease=options.easeLinearity,speedVector=direction.multiplyBy(ease/duration),speed=speedVector.distanceTo([0,0]),limitedSpeed=Math.min(options.inertiaMaxSpeed,speed),limitedSpeedVector=speedVector.multiplyBy(limitedSpeed/speed),decelerationDuration=limitedSpeed/(options.inertiaDeceleration*ease),offset=limitedSpeedVector.multiplyBy(-decelerationDuration/2).round();offset.x||offset.y?(offset=map._limitOffset(offset,map.options.maxBounds),L.Util.requestAnimFrame(function(){map.panBy(offset,{duration:decelerationDuration,easeLinearity:ease,noMoveStart:!0,animate:!0})})):map.fire("moveend")}}}),L.Map.addInitHook("addHandler","dragging",L.Map.Drag),L.Map.mergeOptions({doubleClickZoom:!0}),L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var map=this._map,oldZoom=map.getZoom(),delta=map.options.zoomDelta,zoom=e.originalEvent.shiftKey?oldZoom-delta:oldZoom+delta;"center"===map.options.doubleClickZoom?map.setZoom(zoom):map.setZoomAround(e.containerPoint,zoom)}}),L.Map.addInitHook("addHandler","doubleClickZoom",L.Map.DoubleClickZoom),L.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){L.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var delta=L.DomEvent.getWheelDelta(e),debounce=this._map.options.wheelDebounceTime;this._delta+=delta,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var left=Math.max(debounce-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(L.bind(this._performZoom,this),left),L.DomEvent.stop(e)},_performZoom:function(){var map=this._map,zoom=map.getZoom(),snap=this._map.options.zoomSnap||0;map._stop();var d2=this._delta/(4*this._map.options.wheelPxPerZoomLevel),d3=4*Math.log(2/(1+Math.exp(-Math.abs(d2))))/Math.LN2,d4=snap?Math.ceil(d3/snap)*snap:d3,delta=map._limitZoom(zoom+(this._delta>0?d4:-d4))-zoom;this._delta=0,this._startTime=null,delta&&("center"===map.options.scrollWheelZoom?map.setZoom(zoom+delta):map.setZoomAround(this._lastMousePos,zoom+delta))}}),L.Map.addInitHook("addHandler","scrollWheelZoom",L.Map.ScrollWheelZoom),L.extend(L.DomEvent,{_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",_touchend:L.Browser.msPointer?"MSPointerUp":L.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(obj,handler,id){function onTouchStart(e){var count;if(L.Browser.pointer){if(!L.Browser.edge||"mouse"===e.pointerType)return;count=L.DomEvent._pointersCount}else count=e.touches.length;if(!(count>1)){var now=Date.now(),delta=now-(last||now);touch=e.touches?e.touches[0]:e,doubleTap=delta>0&&delta<=delay,last=now}}function onTouchEnd(e){if(doubleTap&&!touch.cancelBubble){if(L.Browser.pointer){if(!L.Browser.edge||"mouse"===e.pointerType)return;var prop,i,newTouch={};for(i in touch)prop=touch[i],newTouch[i]=prop&&prop.bind?prop.bind(touch):prop;touch=newTouch}touch.type="dblclick",handler(touch),last=null}}var last,touch,doubleTap=!1,delay=250,pre="_leaflet_",touchstart=this._touchstart,touchend=this._touchend;return obj[pre+touchstart+id]=onTouchStart,obj[pre+touchend+id]=onTouchEnd,obj[pre+"dblclick"+id]=handler,obj.addEventListener(touchstart,onTouchStart,!1),obj.addEventListener(touchend,onTouchEnd,!1),obj.addEventListener("dblclick",handler,!1),this},removeDoubleTapListener:function(obj,id){var pre="_leaflet_",touchstart=obj[pre+this._touchstart+id],touchend=obj[pre+this._touchend+id],dblclick=obj[pre+"dblclick"+id];return obj.removeEventListener(this._touchstart,touchstart,!1),obj.removeEventListener(this._touchend,touchend,!1),L.Browser.edge||obj.removeEventListener("dblclick",dblclick,!1),this}}),L.extend(L.DomEvent,{POINTER_DOWN:L.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:L.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:L.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:L.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(obj,type,handler,id){return"touchstart"===type?this._addPointerStart(obj,handler,id):"touchmove"===type?this._addPointerMove(obj,handler,id):"touchend"===type&&this._addPointerEnd(obj,handler,id),this},removePointerListener:function(obj,type,id){var handler=obj["_leaflet_"+type+id];return"touchstart"===type?obj.removeEventListener(this.POINTER_DOWN,handler,!1):"touchmove"===type?obj.removeEventListener(this.POINTER_MOVE,handler,!1):"touchend"===type&&(obj.removeEventListener(this.POINTER_UP,handler,!1),obj.removeEventListener(this.POINTER_CANCEL,handler,!1)),this},_addPointerStart:function(obj,handler,id){var onDown=L.bind(function(e){if("mouse"!==e.pointerType&&e.MSPOINTER_TYPE_MOUSE&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE){if(!(this.TAG_WHITE_LIST.indexOf(e.target.tagName)<0))return;L.DomEvent.preventDefault(e)}this._handlePointer(e,handler)},this);if(obj["_leaflet_touchstart"+id]=onDown,obj.addEventListener(this.POINTER_DOWN,onDown,!1),!this._pointerDocListener){var pointerUp=L.bind(this._globalPointerUp,this);document.documentElement.addEventListener(this.POINTER_DOWN,L.bind(this._globalPointerDown,this),!0),document.documentElement.addEventListener(this.POINTER_MOVE,L.bind(this._globalPointerMove,this),!0),document.documentElement.addEventListener(this.POINTER_UP,pointerUp,!0),document.documentElement.addEventListener(this.POINTER_CANCEL,pointerUp,!0),this._pointerDocListener=!0}},_globalPointerDown:function(e){this._pointers[e.pointerId]=e,this._pointersCount++},_globalPointerMove:function(e){this._pointers[e.pointerId]&&(this._pointers[e.pointerId]=e)},_globalPointerUp:function(e){delete this._pointers[e.pointerId],this._pointersCount--},_handlePointer:function(e,handler){e.touches=[];for(var i in this._pointers)e.touches.push(this._pointers[i]);e.changedTouches=[e],handler(e)},_addPointerMove:function(obj,handler,id){var onMove=L.bind(function(e){(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||0!==e.buttons)&&this._handlePointer(e,handler)},this);obj["_leaflet_touchmove"+id]=onMove,obj.addEventListener(this.POINTER_MOVE,onMove,!1)},_addPointerEnd:function(obj,handler,id){var onUp=L.bind(function(e){this._handlePointer(e,handler)},this);obj["_leaflet_touchend"+id]=onUp,obj.addEventListener(this.POINTER_UP,onUp,!1),obj.addEventListener(this.POINTER_CANCEL,onUp,!1)}}),L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23,bounceAtZoomLimits:!0}),L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){L.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var map=this._map;if(e.touches&&2===e.touches.length&&!map._animatingZoom&&!this._zooming){var p1=map.mouseEventToContainerPoint(e.touches[0]),p2=map.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=map.getSize()._divideBy(2),this._startLatLng=map.containerPointToLatLng(this._centerPoint),"center"!==map.options.touchZoom&&(this._pinchStartLatLng=map.containerPointToLatLng(p1.add(p2)._divideBy(2))),this._startDist=p1.distanceTo(p2),this._startZoom=map.getZoom(),this._moved=!1,this._zooming=!0,map._stop(),L.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this),L.DomEvent.preventDefault(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var map=this._map,p1=map.mouseEventToContainerPoint(e.touches[0]),p2=map.mouseEventToContainerPoint(e.touches[1]),scale=p1.distanceTo(p2)/this._startDist;if(this._zoom=map.getScaleZoom(scale,this._startZoom),!map.options.bounceAtZoomLimits&&(this._zoom<map.getMinZoom()&&scale<1||this._zoom>map.getMaxZoom()&&scale>1)&&(this._zoom=map._limitZoom(this._zoom)),"center"===map.options.touchZoom){if(this._center=this._startLatLng,1===scale)return}else{var delta=p1._add(p2)._divideBy(2)._subtract(this._centerPoint);if(1===scale&&0===delta.x&&0===delta.y)return;this._center=map.unproject(map.project(this._pinchStartLatLng,this._zoom).subtract(delta),this._zoom)}this._moved||(map._moveStart(!0),this._moved=!0),L.Util.cancelAnimFrame(this._animRequest);var moveFn=L.bind(map._move,map,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=L.Util.requestAnimFrame(moveFn,this,!0),L.DomEvent.preventDefault(e)}},_onTouchEnd:function(){return this._moved&&this._zooming?(this._zooming=!1,L.Util.cancelAnimFrame(this._animRequest),L.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}}),L.Map.addInitHook("addHandler","touchZoom",L.Map.TouchZoom),L.Map.mergeOptions({tap:!0,tapTolerance:15}),L.Map.Tap=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(e.touches){if(L.DomEvent.preventDefault(e),this._fireClick=!0,e.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var first=e.touches[0],el=first.target;this._startPos=this._newPos=new L.Point(first.clientX,first.clientY),el.tagName&&"a"===el.tagName.toLowerCase()&&L.DomUtil.addClass(el,"leaflet-active"),this._holdTimeout=setTimeout(L.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",first))},this),1e3),this._simulateEvent("mousedown",first),L.DomEvent.on(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(e){if(clearTimeout(this._holdTimeout),L.DomEvent.off(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&e&&e.changedTouches){var first=e.changedTouches[0],el=first.target;el&&el.tagName&&"a"===el.tagName.toLowerCase()&&L.DomUtil.removeClass(el,"leaflet-active"),this._simulateEvent("mouseup",first),this._isTapValid()&&this._simulateEvent("click",first)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var first=e.touches[0];this._newPos=new L.Point(first.clientX,first.clientY),this._simulateEvent("mousemove",first)},_simulateEvent:function(type,e){var simulatedEvent=document.createEvent("MouseEvents");simulatedEvent._simulated=!0,e.target._simulatedClick=!0,simulatedEvent.initMouseEvent(type,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(simulatedEvent)}}),L.Browser.touch&&!L.Browser.pointer&&L.Map.addInitHook("addHandler","tap",L.Map.Tap),L.Map.mergeOptions({boxZoom:!0}),L.Map.BoxZoom=L.Handler.extend({initialize:function(map){this._map=map,this._container=map._container,this._pane=map._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){L.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(e){return!(!e.shiftKey||1!==e.which&&1!==e.button)&&(this._resetState(),L.DomUtil.disableTextSelection(),L.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(e),void L.DomEvent.on(document,{contextmenu:L.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=L.DomUtil.create("div","leaflet-zoom-box",this._container),L.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var bounds=new L.Bounds(this._point,this._startPoint),size=bounds.getSize();L.DomUtil.setPosition(this._box,bounds.min),this._box.style.width=size.x+"px",this._box.style.height=size.y+"px"},_finish:function(){this._moved&&(L.DomUtil.remove(this._box),L.DomUtil.removeClass(this._container,"leaflet-crosshair")),L.DomUtil.enableTextSelection(),L.DomUtil.enableImageDrag(),L.DomEvent.off(document,{contextmenu:L.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){setTimeout(L.bind(this._resetState,this),0);var bounds=new L.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(bounds).fire("boxzoomend",{boxZoomBounds:bounds})}},_onKeyDown:function(e){27===e.keyCode&&this._finish()}}),L.Map.addInitHook("addHandler","boxZoom",L.Map.BoxZoom),L.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),L.Map.Keyboard=L.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(map){this._map=map,this._setPanDelta(map.options.keyboardPanDelta),this._setZoomDelta(map.options.zoomDelta)},addHooks:function(){var container=this._map._container;container.tabIndex<=0&&(container.tabIndex="0"),L.DomEvent.on(container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),L.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var body=document.body,docEl=document.documentElement,top=body.scrollTop||docEl.scrollTop,left=body.scrollLeft||docEl.scrollLeft;this._map._container.focus(),window.scrollTo(left,top)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(panDelta){var i,len,keys=this._panKeys={},codes=this.keyCodes;for(i=0,len=codes.left.length;i<len;i++)keys[codes.left[i]]=[-1*panDelta,0];for(i=0,len=codes.right.length;i<len;i++)keys[codes.right[i]]=[panDelta,0];for(i=0,len=codes.down.length;i<len;i++)keys[codes.down[i]]=[0,panDelta];for(i=0,len=codes.up.length;i<len;i++)keys[codes.up[i]]=[0,-1*panDelta]},_setZoomDelta:function(zoomDelta){var i,len,keys=this._zoomKeys={},codes=this.keyCodes;for(i=0,len=codes.zoomIn.length;i<len;i++)keys[codes.zoomIn[i]]=zoomDelta;for(i=0,len=codes.zoomOut.length;i<len;i++)keys[codes.zoomOut[i]]=-zoomDelta},_addHooks:function(){L.DomEvent.on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){L.DomEvent.off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var offset,key=e.keyCode,map=this._map;if(key in this._panKeys){if(map._panAnim&&map._panAnim._inProgress)return;offset=this._panKeys[key],e.shiftKey&&(offset=L.point(offset).multiplyBy(3)),map.panBy(offset),map.options.maxBounds&&map.panInsideBounds(map.options.maxBounds)}else if(key in this._zoomKeys)map.setZoom(map.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[key]);else{if(27!==key)return;map.closePopup()}L.DomEvent.stop(e)}}}),L.Map.addInitHook("addHandler","keyboard",L.Map.Keyboard),L.Handler.MarkerDrag=L.Handler.extend({initialize:function(marker){this._marker=marker},addHooks:function(){var icon=this._marker._icon;this._draggable||(this._draggable=new L.Draggable(icon,icon,(!0))),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),L.DomUtil.addClass(icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&L.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(e){var marker=this._marker,shadow=marker._shadow,iconPos=L.DomUtil.getPosition(marker._icon),latlng=marker._map.layerPointToLatLng(iconPos);shadow&&L.DomUtil.setPosition(shadow,iconPos),marker._latlng=latlng,e.latlng=latlng,e.oldLatLng=this._oldLatLng,marker.fire("move",e).fire("drag",e)},_onDragEnd:function(e){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),L.Control=L.Class.extend({options:{position:"topright"},initialize:function(options){L.setOptions(this,options)},getPosition:function(){return this.options.position},setPosition:function(position){var map=this._map;return map&&map.removeControl(this),this.options.position=position,map&&map.addControl(this),this},getContainer:function(){return this._container},addTo:function(map){this.remove(),this._map=map;var container=this._container=this.onAdd(map),pos=this.getPosition(),corner=map._controlCorners[pos];return L.DomUtil.addClass(container,"leaflet-control"),pos.indexOf("bottom")!==-1?corner.insertBefore(container,corner.firstChild):corner.appendChild(container),
this},remove:function(){return this._map?(L.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),L.control=function(options){return new L.Control(options)},L.Map.include({addControl:function(control){return control.addTo(this),this},removeControl:function(control){return control.remove(),this},_initControlPos:function(){function createCorner(vSide,hSide){var className=l+vSide+" "+l+hSide;corners[vSide+hSide]=L.DomUtil.create("div",className,container)}var corners=this._controlCorners={},l="leaflet-",container=this._controlContainer=L.DomUtil.create("div",l+"control-container",this._container);createCorner("top","left"),createCorner("top","right"),createCorner("bottom","left"),createCorner("bottom","right")},_clearControlPos:function(){L.DomUtil.remove(this._controlContainer)}}),L.Control.Zoom=L.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(map){var zoomName="leaflet-control-zoom",container=L.DomUtil.create("div",zoomName+" leaflet-bar"),options=this.options;return this._zoomInButton=this._createButton(options.zoomInText,options.zoomInTitle,zoomName+"-in",container,this._zoomIn),this._zoomOutButton=this._createButton(options.zoomOutText,options.zoomOutTitle,zoomName+"-out",container,this._zoomOut),this._updateDisabled(),map.on("zoomend zoomlevelschange",this._updateDisabled,this),container},onRemove:function(map){map.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(html,title,className,container,fn){var link=L.DomUtil.create("a",className,container);return link.innerHTML=html,link.href="#",link.title=title,link.setAttribute("role","button"),link.setAttribute("aria-label",title),L.DomEvent.on(link,"mousedown dblclick",L.DomEvent.stopPropagation).on(link,"click",L.DomEvent.stop).on(link,"click",fn,this).on(link,"click",this._refocusOnMap,this),link},_updateDisabled:function(){var map=this._map,className="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,className),L.DomUtil.removeClass(this._zoomOutButton,className),(this._disabled||map._zoom===map.getMinZoom())&&L.DomUtil.addClass(this._zoomOutButton,className),(this._disabled||map._zoom===map.getMaxZoom())&&L.DomUtil.addClass(this._zoomInButton,className)}}),L.Map.mergeOptions({zoomControl:!0}),L.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new L.Control.Zoom,this.addControl(this.zoomControl))}),L.control.zoom=function(options){return new L.Control.Zoom(options)},L.Control.Attribution=L.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(options){L.setOptions(this,options),this._attributions={}},onAdd:function(map){map.attributionControl=this,this._container=L.DomUtil.create("div","leaflet-control-attribution"),L.DomEvent&&L.DomEvent.disableClickPropagation(this._container);for(var i in map._layers)map._layers[i].getAttribution&&this.addAttribution(map._layers[i].getAttribution());return this._update(),this._container},setPrefix:function(prefix){return this.options.prefix=prefix,this._update(),this},addAttribution:function(text){return text?(this._attributions[text]||(this._attributions[text]=0),this._attributions[text]++,this._update(),this):this},removeAttribution:function(text){return text?(this._attributions[text]&&(this._attributions[text]--,this._update()),this):this},_update:function(){if(this._map){var attribs=[];for(var i in this._attributions)this._attributions[i]&&attribs.push(i);var prefixAndAttribs=[];this.options.prefix&&prefixAndAttribs.push(this.options.prefix),attribs.length&&prefixAndAttribs.push(attribs.join(", ")),this._container.innerHTML=prefixAndAttribs.join(" | ")}}}),L.Map.mergeOptions({attributionControl:!0}),L.Map.addInitHook(function(){this.options.attributionControl&&(new L.Control.Attribution).addTo(this)}),L.control.attribution=function(options){return new L.Control.Attribution(options)},L.Control.Scale=L.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(map){var className="leaflet-control-scale",container=L.DomUtil.create("div",className),options=this.options;return this._addScales(options,className+"-line",container),map.on(options.updateWhenIdle?"moveend":"move",this._update,this),map.whenReady(this._update,this),container},onRemove:function(map){map.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(options,className,container){options.metric&&(this._mScale=L.DomUtil.create("div",className,container)),options.imperial&&(this._iScale=L.DomUtil.create("div",className,container))},_update:function(){var map=this._map,y=map.getSize().y/2,maxMeters=map.distance(map.containerPointToLatLng([0,y]),map.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(maxMeters)},_updateScales:function(maxMeters){this.options.metric&&maxMeters&&this._updateMetric(maxMeters),this.options.imperial&&maxMeters&&this._updateImperial(maxMeters)},_updateMetric:function(maxMeters){var meters=this._getRoundNum(maxMeters),label=meters<1e3?meters+" m":meters/1e3+" km";this._updateScale(this._mScale,label,meters/maxMeters)},_updateImperial:function(maxMeters){var maxMiles,miles,feet,maxFeet=3.2808399*maxMeters;maxFeet>5280?(maxMiles=maxFeet/5280,miles=this._getRoundNum(maxMiles),this._updateScale(this._iScale,miles+" mi",miles/maxMiles)):(feet=this._getRoundNum(maxFeet),this._updateScale(this._iScale,feet+" ft",feet/maxFeet))},_updateScale:function(scale,text,ratio){scale.style.width=Math.round(this.options.maxWidth*ratio)+"px",scale.innerHTML=text},_getRoundNum:function(num){var pow10=Math.pow(10,(Math.floor(num)+"").length-1),d=num/pow10;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,pow10*d}}),L.control.scale=function(options){return new L.Control.Scale(options)},L.Control.Layers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(layerA,layerB,nameA,nameB){return nameA<nameB?-1:nameB<nameA?1:0}},initialize:function(baseLayers,overlays,options){L.setOptions(this,options),this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var i in baseLayers)this._addLayer(baseLayers[i],i);for(i in overlays)this._addLayer(overlays[i],i,!0)},onAdd:function(map){return this._initLayout(),this._update(),this._map=map,map.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(layer,name){return this._addLayer(layer,name),this._map?this._update():this},addOverlay:function(layer,name){return this._addLayer(layer,name,!0),this._map?this._update():this},removeLayer:function(layer){layer.off("add remove",this._onLayerChange,this);var obj=this._getLayer(L.stamp(layer));return obj&&this._layers.splice(this._layers.indexOf(obj),1),this._map?this._update():this},expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var acceptableHeight=this._map.getSize().y-(this._container.offsetTop+50);return acceptableHeight<this._form.clientHeight?(L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=acceptableHeight+"px"):L.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className),collapsed=this.options.collapsed;container.setAttribute("aria-haspopup",!0),L.DomEvent.disableClickPropagation(container),L.Browser.touch||L.DomEvent.disableScrollPropagation(container);var form=this._form=L.DomUtil.create("form",className+"-list");collapsed&&(this._map.on("click",this.collapse,this),L.Browser.android||L.DomEvent.on(container,{mouseenter:this.expand,mouseleave:this.collapse},this));var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#",link.title="Layers",L.Browser.touch?L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this.expand,this):L.DomEvent.on(link,"focus",this.expand,this),L.DomEvent.on(form,"click",function(){setTimeout(L.bind(this._onInputClick,this),0)},this),collapsed||this.expand(),this._baseLayersList=L.DomUtil.create("div",className+"-base",form),this._separator=L.DomUtil.create("div",className+"-separator",form),this._overlaysList=L.DomUtil.create("div",className+"-overlays",form),container.appendChild(form)},_getLayer:function(id){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&L.stamp(this._layers[i].layer)===id)return this._layers[i]},_addLayer:function(layer,name,overlay){layer.on("add remove",this._onLayerChange,this),this._layers.push({layer:layer,name:name,overlay:overlay}),this.options.sortLayers&&this._layers.sort(L.bind(function(a,b){return this.options.sortFunction(a.layer,b.layer,a.name,b.name)},this)),this.options.autoZIndex&&layer.setZIndex&&(this._lastZIndex++,layer.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;L.DomUtil.empty(this._baseLayersList),L.DomUtil.empty(this._overlaysList);var baseLayersPresent,overlaysPresent,i,obj,baseLayersCount=0;for(i=0;i<this._layers.length;i++)obj=this._layers[i],this._addItem(obj),overlaysPresent=overlaysPresent||obj.overlay,baseLayersPresent=baseLayersPresent||!obj.overlay,baseLayersCount+=obj.overlay?0:1;return this.options.hideSingleBase&&(baseLayersPresent=baseLayersPresent&&baseLayersCount>1,this._baseLayersList.style.display=baseLayersPresent?"":"none"),this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var obj=this._getLayer(L.stamp(e.target)),type=obj.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;type&&this._map.fire(type,obj)},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"'+(checked?' checked="checked"':"")+"/>",radioFragment=document.createElement("div");return radioFragment.innerHTML=radioHtml,radioFragment.firstChild},_addItem:function(obj){var input,label=document.createElement("label"),checked=this._map.hasLayer(obj.layer);obj.overlay?(input=document.createElement("input"),input.type="checkbox",input.className="leaflet-control-layers-selector",input.defaultChecked=checked):input=this._createRadioElement("leaflet-base-layers",checked),input.layerId=L.stamp(obj.layer),L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");name.innerHTML=" "+obj.name;var holder=document.createElement("div");label.appendChild(holder),holder.appendChild(input),holder.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;return container.appendChild(label),this._checkDisabledLayers(),label},_onInputClick:function(){var input,layer,hasLayer,inputs=this._form.getElementsByTagName("input"),addedLayers=[],removedLayers=[];this._handlingClick=!0;for(var i=inputs.length-1;i>=0;i--)input=inputs[i],layer=this._getLayer(input.layerId).layer,hasLayer=this._map.hasLayer(layer),input.checked&&!hasLayer?addedLayers.push(layer):!input.checked&&hasLayer&&removedLayers.push(layer);for(i=0;i<removedLayers.length;i++)this._map.removeLayer(removedLayers[i]);for(i=0;i<addedLayers.length;i++)this._map.addLayer(addedLayers[i]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var input,layer,inputs=this._form.getElementsByTagName("input"),zoom=this._map.getZoom(),i=inputs.length-1;i>=0;i--)input=inputs[i],layer=this._getLayer(input.layerId).layer,input.disabled=layer.options.minZoom!==undefined&&zoom<layer.options.minZoom||layer.options.maxZoom!==undefined&&zoom>layer.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),L.control.layers=function(baseLayers,overlays,options){return new L.Control.Layers(baseLayers,overlays,options)}}(window,document),L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(kml,options){L.Util.setOptions(this,options),this._kml=kml,this._layers={},kml&&this.addKML(kml,options,this.options.async)},loadXML:function(url,cb,options,async){void 0===async&&(async=this.options.async),void 0===options&&(options=this.options);var req=new window.XMLHttpRequest;req.open("GET",url,async);try{req.overrideMimeType("text/xml")}catch(e){}req.onreadystatechange=function(){4===req.readyState&&200===req.status&&cb(req.responseXML,options)},req.send(null)},addKML:function(url,options,async){var _this=this,cb=function(gpx,options){_this._addKML(gpx,options)};this.loadXML(url,cb,options,async)},_addKML:function(xml,options){var layers=this.parseKML(xml);if(layers&&layers.length){for(var i=0;i<layers.length;i++)this.fire("addlayer",{layer:layers[i]}),this.addLayer(layers[i]);this.latLngs=this.getLatLngs(xml),this.fire("loaded")}},latLngs:[]}),L.KML=L.KML.extend({parseKML:function(xml){var style=this.parseStyle(xml);this.parseStyleMap(xml,style);for(var l,el=xml.getElementsByTagName("Folder"),layers=[],i=0;i<el.length;i++)this._check_folder(el[i])&&(l=this.parseFolder(el[i],style),l&&layers.push(l));el=xml.getElementsByTagName("Placemark");for(var j=0;j<el.length;j++)this._check_folder(el[j])&&(l=this.parsePlacemark(el[j],xml,style),l&&layers.push(l));el=xml.getElementsByTagName("GroundOverlay");for(var k=0;k<el.length;k++)l=this.parseGroundOverlay(el[k]),l&&layers.push(l);return layers},_check_folder:function(e,folder){for(e=e.parentElement;e&&"Folder"!==e.tagName;)e=e.parentElement;return!e||e===folder},parseStyle:function(xml){function _parse(xml){for(var options={},i=0;i<xml.childNodes.length;i++){var e=xml.childNodes[i],key=e.tagName;if(attributes[key])if("hotSpot"===key)for(var j=0;j<e.attributes.length;j++)options[e.attributes[j].name]=e.attributes[j].nodeValue;else{var value=e.childNodes[0].nodeValue;"color"===key?(options.opacity=parseInt(value.substring(0,2),16)/255,options.color="#"+value.substring(6,8)+value.substring(4,6)+value.substring(2,4)):"width"===key?options.weight=value:"Icon"===key?(ioptions=_parse(e),ioptions.href&&(options.href=ioptions.href)):"href"===key&&(options.href=value)}}return options}for(var style={},sl=xml.getElementsByTagName("Style"),attributes={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},i=0;i<sl.length;i++){var el,e=sl[i],options={},poptions={},ioptions={};el=e.getElementsByTagName("LineStyle"),el&&el[0]&&(options=_parse(el[0])),el=e.getElementsByTagName("PolyStyle"),el&&el[0]&&(poptions=_parse(el[0])),poptions.color&&(options.fillColor=poptions.color),poptions.opacity&&(options.fillOpacity=poptions.opacity),el=e.getElementsByTagName("IconStyle"),el&&el[0]&&(ioptions=_parse(el[0])),ioptions.href&&(options.icon=new L.KMLIcon({iconUrl:ioptions.href,shadowUrl:null,iconAnchorRef:{x:ioptions.x,y:ioptions.y},iconAnchorType:{x:ioptions.xunits,y:ioptions.yunits}})),style["#"+e.getAttribute("id")]=options}return style},parseStyleMap:function(xml,existingStyles){for(var sl=xml.getElementsByTagName("StyleMap"),i=0;i<sl.length;i++){var el,smKey,smStyleUrl,e=sl[i];el=e.getElementsByTagName("key"),el&&el[0]&&(smKey=el[0].textContent),el=e.getElementsByTagName("styleUrl"),el&&el[0]&&(smStyleUrl=el[0].textContent),"normal"===smKey&&(existingStyles["#"+e.getAttribute("id")]=existingStyles[smStyleUrl])}},parseFolder:function(xml,style){var el,l,layers=[];el=xml.getElementsByTagName("Folder");for(var i=0;i<el.length;i++)this._check_folder(el[i],xml)&&(l=this.parseFolder(el[i],style),l&&layers.push(l));el=xml.getElementsByTagName("Placemark");for(var j=0;j<el.length;j++)this._check_folder(el[j],xml)&&(l=this.parsePlacemark(el[j],xml,style),l&&layers.push(l));el=xml.getElementsByTagName("GroundOverlay");for(var k=0;k<el.length;k++)this._check_folder(el[k],xml)&&(l=this.parseGroundOverlay(el[k]),l&&layers.push(l));if(layers.length)return 1===layers.length?layers[0]:new L.FeatureGroup(layers)},parsePlacemark:function(place,xml,style){var h,i,j,el,options={},multi=["MultiGeometry","gx:MultiTrack"];for(h in multi)if(multi.hasOwnProperty(h))for(el=place.getElementsByTagName(multi[h]),i=0;i<el.length;i++)return this.parsePlacemark(el[i],xml,style);for(el=place.getElementsByTagName("styleUrl"),i=0;i<el.length;i++){var url=el[i].childNodes[0].nodeValue;for(var a in style[url])style[url].hasOwnProperty(a)&&(options[a]=style[url][a])}var layers=[],parse=["LineString","Polygon","Point","gx:Track"];for(j in parse)if(parse.hasOwnProperty(j)){var tag=parse[j];for(el=place.getElementsByTagName(tag),i=0;i<el.length;i++){var l=this["parse"+tag.replace(/gx:/,"")](el[i],xml,options);l&&layers.push(l)}}if(layers.length){var layer=layers[0];layers.length>1&&(layer=new L.FeatureGroup(layers));var name,descr="";for(el=place.getElementsByTagName("name"),el.length&&el[0].childNodes.length&&(name=el[0].childNodes[0].nodeValue),el=place.getElementsByTagName("description"),i=0;i<el.length;i++)for(j=0;j<el[i].childNodes.length;j++)descr+=el[i].childNodes[j].nodeValue;return name&&layer.bindPopup("<h2>"+name+"</h2>"+descr),layer}},parseCoords:function(xml){var el=xml.getElementsByTagName("coordinates");return this._read_coords(el[0])},parseLineString:function(line,xml,options){var coords=this.parseCoords(line);if(coords.length)return new L.Polyline(coords,options)},parseTrack:function(line,xml,options){for(var el=xml.getElementsByTagName("gx:coord"),coords=[],j=0;j<el.length;j++)coords=coords.concat(this._read_gxcoords(el[j]));if(coords.length)return new L.Polyline(coords,options)},parsePoint:function(line,xml,options){var el=line.getElementsByTagName("coordinates");if(el.length){var ll=el[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(ll[1],ll[0]),options)}},parsePolygon:function(line,xml,options){var el,i,coords,polys=[],inner=[];for(el=line.getElementsByTagName("outerBoundaryIs"),i=0;i<el.length;i++)coords=this.parseCoords(el[i]),coords&&polys.push(coords);for(el=line.getElementsByTagName("innerBoundaryIs"),i=0;i<el.length;i++)coords=this.parseCoords(el[i]),coords&&inner.push(coords);if(polys.length)return options.fillColor&&(options.fill=!0),1===polys.length?new L.Polygon(polys.concat(inner),options):new L.MultiPolygon(polys,options)},getLatLngs:function(xml){for(var el=xml.getElementsByTagName("coordinates"),coords=[],j=0;j<el.length;j++)coords=coords.concat(this._read_coords(el[j]));return coords},_read_coords:function(el){var i,text="",coords=[];for(i=0;i<el.childNodes.length;i++)text+=el.childNodes[i].nodeValue;for(text=text.split(/[\s\n]+/),i=0;i<text.length;i++){var ll=text[i].split(",");ll.length<2||coords.push(new L.LatLng(ll[1],ll[0]))}return coords},_read_gxcoords:function(el){var text="",coords=[];return text=el.firstChild.nodeValue.split(" "),coords.push(new L.LatLng(text[1],text[0])),coords},parseGroundOverlay:function(xml){function _parse(xml){for(var options={},ioptions={},i=0;i<xml.childNodes.length;i++){var e=xml.childNodes[i],key=e.tagName;if(attributes[key]){var value=e.childNodes[0].nodeValue;"Icon"===key?(ioptions=_parse(e),ioptions.href&&(options.href=ioptions.href)):"href"===key?options.href=value:"color"===key&&(options.opacity=parseInt(value.substring(0,2),16)/255,options.color="#"+value.substring(6,8)+value.substring(4,6)+value.substring(2,4))}}return options}var latlonbox=xml.getElementsByTagName("LatLonBox")[0],bounds=new L.LatLngBounds([latlonbox.getElementsByTagName("south")[0].childNodes[0].nodeValue,latlonbox.getElementsByTagName("west")[0].childNodes[0].nodeValue],[latlonbox.getElementsByTagName("north")[0].childNodes[0].nodeValue,latlonbox.getElementsByTagName("east")[0].childNodes[0].nodeValue]),attributes={Icon:!0,href:!0,color:!0},options={};if(options=_parse(xml),void 0!==latlonbox.getElementsByTagName("rotation")[0]){var rotation=latlonbox.getElementsByTagName("rotation")[0].childNodes[0].nodeValue;options.rotation=parseFloat(rotation)}return new L.RotatedImageOverlay(options.href,bounds,{opacity:options.opacity,angle:options.rotation})}}),L.KMLIcon=L.Icon.extend({createIcon:function(){var img=this._createIcon("icon");return img.onload=function(){var i=img;this.style.width=i.width+"px",this.style.height=i.height+"px","UNITS_FRACTION"!==this.anchorType.x&&"fraction"!==this.anchorType.x||(img.style.marginLeft=-this.anchor.x*i.width+"px"),"UNITS_FRACTION"!==this.anchorType.y&&"fraction"!==this.anchorType.x||(img.style.marginTop=-(1-this.anchor.y)*i.height+"px"),this.style.display=""},img},_setIconStyles:function(img,name){L.Icon.prototype._setIconStyles.apply(this,[img,name]),img.anchor=this.options.iconAnchorRef,img.anchorType=this.options.iconAnchorType}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}}),L.RotatedImageOverlay=L.ImageOverlay.extend({options:{angle:0},_reset:function(){L.ImageOverlay.prototype._reset.call(this),this._rotate()},_animateZoom:function(e){L.ImageOverlay.prototype._animateZoom.call(this,e),this._rotate()},_rotate:function(){if(L.DomUtil.TRANSFORM)this._image.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var rad=this.options.angle*(Math.PI/180),costheta=Math.cos(rad),sintheta=Math.sin(rad);this._image.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+costheta+", M12="+-sintheta+", M21="+sintheta+", M22="+costheta+")"}},getBounds:function(){return this._bounds}}),function(window,document,undefined){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222"},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(options){L.Util.setOptions(this,options),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[]},addLayer:function(layer){if(layer instanceof L.LayerGroup){var array=[];for(var i in layer._layers)array.push(layer._layers[i]);return this.addLayers(array)}if(!layer.getLatLng)return this._nonPointGroup.addLayer(layer),this;if(!this._map)return this._needsClustering.push(layer),this;if(this.hasLayer(layer))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(layer,this._maxZoom);var visibleLayer=layer,currentZoom=this._map.getZoom();if(layer.__parent)for(;visibleLayer.__parent._zoom>=currentZoom;)visibleLayer=visibleLayer.__parent;return this._currentShownBounds.contains(visibleLayer.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(layer,visibleLayer):this._animationAddLayerNonAnimated(layer,visibleLayer)),this},removeLayer:function(layer){if(layer instanceof L.LayerGroup){var array=[];for(var i in layer._layers)array.push(layer._layers[i]);return this.removeLayers(array)}return layer.getLatLng?this._map?layer.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(layer)),this._removeLayer(layer,!0),this._featureGroup.hasLayer(layer)&&(this._featureGroup.removeLayer(layer),layer.clusterShow&&layer.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,layer)&&this.hasLayer(layer)&&this._needsRemoving.push(layer),this):(this._nonPointGroup.removeLayer(layer),this)},addLayers:function(layersArray){var newMarkers,i,l,m,fg=this._featureGroup,npg=this._nonPointGroup,chunked=this.options.chunkedLoading,chunkInterval=this.options.chunkInterval,chunkProgress=this.options.chunkProgress;if(this._map){var offset=0,started=(new Date).getTime(),process=L.bind(function(){for(var start=(new Date).getTime();offset<layersArray.length;offset++){if(chunked&&offset%200===0){var elapsed=(new Date).getTime()-start;if(elapsed>chunkInterval)break}if(m=layersArray[offset],m.getLatLng){if(!this.hasLayer(m)&&(this._addLayer(m,this._maxZoom),m.__parent&&2===m.__parent.getChildCount())){var markers=m.__parent.getAllChildMarkers(),otherMarker=markers[0]===m?markers[1]:markers[0];fg.removeLayer(otherMarker)}}else npg.addLayer(m)}chunkProgress&&chunkProgress(offset,layersArray.length,(new Date).getTime()-started),offset===layersArray.length?(this._featureGroup.eachLayer(function(c){c instanceof L.MarkerCluster&&c._iconNeedsUpdate&&c._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(process,this.options.chunkDelay)},this);process()}else{for(newMarkers=[],i=0,l=layersArray.length;i<l;i++)m=layersArray[i],m.getLatLng?this.hasLayer(m)||newMarkers.push(m):npg.addLayer(m);this._needsClustering=this._needsClustering.concat(newMarkers)}return this},removeLayers:function(layersArray){var i,l,m,fg=this._featureGroup,npg=this._nonPointGroup;if(this._unspiderfy&&this._unspiderfy(),!this._map){for(i=0,l=layersArray.length;i<l;i++)m=layersArray[i],this._arraySplice(this._needsClustering,m),npg.removeLayer(m);return this}for(i=0,l=layersArray.length;i<l;i++)m=layersArray[i],m.__parent?(this._removeLayer(m,!0,!0),fg.hasLayer(m)&&(fg.removeLayer(m),m.clusterShow&&m.clusterShow())):npg.removeLayer(m);return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),fg.eachLayer(function(c){c instanceof L.MarkerCluster&&c._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(marker){delete marker.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var bounds=new L.LatLngBounds;this._topClusterLevel&&bounds.extend(this._topClusterLevel._bounds);for(var i=this._needsClustering.length-1;i>=0;i--)bounds.extend(this._needsClustering[i].getLatLng());return bounds.extend(this._nonPointGroup.getBounds()),bounds},eachLayer:function(method,context){var i,markers=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(markers),i=markers.length-1;i>=0;i--)method.call(context,markers[i]);this._nonPointGroup.eachLayer(method,context)},getLayers:function(){var layers=[];return this.eachLayer(function(l){layers.push(l)}),layers},getLayer:function(id){var result=null;return this.eachLayer(function(l){L.stamp(l)===id&&(result=l)}),result},hasLayer:function(layer){if(!layer)return!1;var i,anArray=this._needsClustering;for(i=anArray.length-1;i>=0;i--)if(anArray[i]===layer)return!0;for(anArray=this._needsRemoving,i=anArray.length-1;i>=0;i--)if(anArray[i]===layer)return!1;return!(!layer.__parent||layer.__parent._group!==this)||this._nonPointGroup.hasLayer(layer)},zoomToShowLayer:function(layer,callback){var showMarker=function(){if((layer._icon||layer.__parent._icon)&&!this._inZoomAnimation)if(this._map.off("moveend",showMarker,this),this.off("animationend",showMarker,this),layer._icon)callback();else if(layer.__parent._icon){var afterSpiderfy=function(){this.off("spiderfied",afterSpiderfy,this),callback()};this.on("spiderfied",afterSpiderfy,this),layer.__parent.spiderfy()}};if(layer._icon&&this._map.getBounds().contains(layer.getLatLng()))callback();else if(layer.__parent._zoom<this._map.getZoom())this._map.on("moveend",showMarker,this),this._map.panTo(layer.getLatLng());else{var moveStart=function(){this._map.off("movestart",moveStart,this),moveStart=null};this._map.on("movestart",moveStart,this),this._map.on("moveend",showMarker,this),this.on("animationend",showMarker,this),layer.__parent.zoomToBounds(),moveStart&&showMarker.call(this)}},onAdd:function(map){this._map=map;var i,l,layer;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.onAdd(map),this._nonPointGroup.onAdd(map),this._gridClusters||this._generateInitialClusters(),i=0,l=this._needsRemoving.length;i<l;i++)layer=this._needsRemoving[i],this._removeLayer(layer,!0);this._needsRemoving=[],this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),l=this._needsClustering,this._needsClustering=[],this.addLayers(l)},onRemove:function(map){map.off("zoomend",this._zoomEnd,this),map.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(map),this._nonPointGroup.onRemove(map),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(marker){for(var vMarker=marker;vMarker&&!vMarker._icon;)vMarker=vMarker.__parent;return vMarker||null},_arraySplice:function(anArray,obj){for(var i=anArray.length-1;i>=0;i--)if(anArray[i]===obj)return anArray.splice(i,1),!0},_removeLayer:function(marker,removeFromDistanceGrid,dontUpdateMap){var gridClusters=this._gridClusters,gridUnclustered=this._gridUnclustered,fg=this._featureGroup,map=this._map;if(removeFromDistanceGrid)for(var z=this._maxZoom;z>=0&&gridUnclustered[z].removeObject(marker,map.project(marker.getLatLng(),z));z--);var otherMarker,cluster=marker.__parent,markers=cluster._markers;for(this._arraySplice(markers,marker);cluster&&(cluster._childCount--,!(cluster._zoom<0));)removeFromDistanceGrid&&cluster._childCount<=1?(otherMarker=cluster._markers[0]===marker?cluster._markers[1]:cluster._markers[0],gridClusters[cluster._zoom].removeObject(cluster,map.project(cluster._cLatLng,cluster._zoom)),gridUnclustered[cluster._zoom].addObject(otherMarker,map.project(otherMarker.getLatLng(),cluster._zoom)),this._arraySplice(cluster.__parent._childClusters,cluster),cluster.__parent._markers.push(otherMarker),otherMarker.__parent=cluster.__parent,cluster._icon&&(fg.removeLayer(cluster),dontUpdateMap||fg.addLayer(otherMarker))):(cluster._recalculateBounds(),dontUpdateMap&&cluster._icon||cluster._updateIcon()),cluster=cluster.__parent;delete marker.__parent},_isOrIsParent:function(el,oel){for(;oel;){if(el===oel)return!0;oel=oel.parentNode}return!1},_propagateEvent:function(e){if(e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;e.type="cluster"+e.type}this.fire(e.type,e)},_defaultIconCreateFunction:function(cluster){var childCount=cluster.getChildCount(),c=" marker-cluster-";return c+=childCount<10?"small":childCount<100?"medium":"large",new L.DivIcon({html:"<div><span>"+childCount+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var map=this._map,spiderfyOnMaxZoom=this.options.spiderfyOnMaxZoom,showCoverageOnHover=this.options.showCoverageOnHover,zoomToBoundsOnClick=this.options.zoomToBoundsOnClick;
(spiderfyOnMaxZoom||zoomToBoundsOnClick)&&this.on("clusterclick",this._zoomOrSpiderfy,this),showCoverageOnHover&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),map.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(e){var map=this._map;e.layer._bounds._northEast.equals(e.layer._bounds._southWest)?this.options.spiderfyOnMaxZoom&&e.layer.spiderfy():map.getMaxZoom()===map.getZoom()?this.options.spiderfyOnMaxZoom&&e.layer.spiderfy():this.options.zoomToBoundsOnClick&&e.layer.zoomToBounds(),e.originalEvent&&13===e.originalEvent.keyCode&&map._container.focus()},_showCoverage:function(e){var map=this._map;this._inZoomAnimation||(this._shownPolygon&&map.removeLayer(this._shownPolygon),e.layer.getChildCount()>2&&e.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(e.layer.getConvexHull(),this.options.polygonOptions),map.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var spiderfyOnMaxZoom=this.options.spiderfyOnMaxZoom,showCoverageOnHover=this.options.showCoverageOnHover,zoomToBoundsOnClick=this.options.zoomToBoundsOnClick,map=this._map;(spiderfyOnMaxZoom||zoomToBoundsOnClick)&&this.off("clusterclick",this._zoomOrSpiderfy,this),showCoverageOnHover&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),map.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var newBounds=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,newBounds),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,newBounds),this._currentShownBounds=newBounds}},_generateInitialClusters:function(){var maxZoom=this._map.getMaxZoom(),radius=this.options.maxClusterRadius,radiusFn=radius;"function"!=typeof radius&&(radiusFn=function(){return radius}),this.options.disableClusteringAtZoom&&(maxZoom=this.options.disableClusteringAtZoom-1),this._maxZoom=maxZoom,this._gridClusters={},this._gridUnclustered={};for(var zoom=maxZoom;zoom>=0;zoom--)this._gridClusters[zoom]=new L.DistanceGrid(radiusFn(zoom)),this._gridUnclustered[zoom]=new L.DistanceGrid(radiusFn(zoom));this._topClusterLevel=new L.MarkerCluster(this,(-1))},_addLayer:function(layer,zoom){var markerPoint,z,gridClusters=this._gridClusters,gridUnclustered=this._gridUnclustered;for(this.options.singleMarkerMode&&(layer.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[layer]}}));zoom>=0;zoom--){markerPoint=this._map.project(layer.getLatLng(),zoom);var closest=gridClusters[zoom].getNearObject(markerPoint);if(closest)return closest._addChild(layer),void(layer.__parent=closest);if(closest=gridUnclustered[zoom].getNearObject(markerPoint)){var parent=closest.__parent;parent&&this._removeLayer(closest,!1);var newCluster=new L.MarkerCluster(this,zoom,closest,layer);gridClusters[zoom].addObject(newCluster,this._map.project(newCluster._cLatLng,zoom)),closest.__parent=newCluster,layer.__parent=newCluster;var lastParent=newCluster;for(z=zoom-1;z>parent._zoom;z--)lastParent=new L.MarkerCluster(this,z,lastParent),gridClusters[z].addObject(lastParent,this._map.project(closest.getLatLng(),z));for(parent._addChild(lastParent),z=zoom;z>=0&&gridUnclustered[z].removeObject(closest,this._map.project(closest.getLatLng(),z));z--);return}gridUnclustered[zoom].addObject(layer,markerPoint)}this._topClusterLevel._addChild(layer),layer.__parent=this._topClusterLevel},_enqueue:function(fn){this._queue.push(fn),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var i=0;i<this._queue.length;i++)this._queue[i].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this._map.getBounds();var map=this._map,bounds=map.getBounds(),sw=bounds._southWest,ne=bounds._northEast,latDiff=L.Browser.mobile?0:Math.abs(sw.lat-ne.lat),lngDiff=L.Browser.mobile?0:Math.abs(sw.lng-ne.lng);return new L.LatLngBounds(new L.LatLng(sw.lat-latDiff,sw.lng-lngDiff,(!0)),new L.LatLng(ne.lat+latDiff,ne.lng+lngDiff,(!0)))},_animationAddLayerNonAnimated:function(layer,newCluster){if(newCluster===layer)this._featureGroup.addLayer(layer);else if(2===newCluster._childCount){newCluster._addToMap();var markers=newCluster.getAllChildMarkers();this._featureGroup.removeLayer(markers[0]),this._featureGroup.removeLayer(markers[1])}else newCluster._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(previousZoomLevel,newZoomLevel){var i,bounds=this._getExpandedVisibleBounds(),fg=this._featureGroup;this._topClusterLevel._recursively(bounds,previousZoomLevel,0,function(c){var m,startPos=c._latlng,markers=c._markers;for(bounds.contains(startPos)||(startPos=null),c._isSingleParent()&&previousZoomLevel+1===newZoomLevel?(fg.removeLayer(c),c._recursivelyAddChildrenToMap(null,newZoomLevel,bounds)):(c.clusterHide(),c._recursivelyAddChildrenToMap(startPos,newZoomLevel,bounds)),i=markers.length-1;i>=0;i--)m=markers[i],bounds.contains(m._latlng)||fg.removeLayer(m)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(bounds,newZoomLevel),fg.eachLayer(function(n){n instanceof L.MarkerCluster||!n._icon||n.clusterShow()}),this._topClusterLevel._recursively(bounds,previousZoomLevel,newZoomLevel,function(c){c._recursivelyRestoreChildPositions(newZoomLevel)}),this._enqueue(function(){this._topClusterLevel._recursively(bounds,previousZoomLevel,0,function(c){fg.removeLayer(c),c.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(previousZoomLevel,newZoomLevel){this._animationZoomOutSingle(this._topClusterLevel,previousZoomLevel-1,newZoomLevel),this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(cluster,previousZoomLevel,newZoomLevel){var bounds=this._getExpandedVisibleBounds();cluster._recursivelyAnimateChildrenInAndAddSelfToMap(bounds,previousZoomLevel+1,newZoomLevel);var me=this;this._forceLayout(),cluster._recursivelyBecomeVisible(bounds,newZoomLevel),this._enqueue(function(){if(1===cluster._childCount){var m=cluster._markers[0];m.setLatLng(m.getLatLng()),m.clusterShow&&m.clusterShow()}else cluster._recursively(bounds,newZoomLevel,0,function(c){c._recursivelyRemoveChildrenFromMap(bounds,previousZoomLevel+1)});me._animationEnd()})},_animationAddLayer:function(layer,newCluster){var me=this,fg=this._featureGroup;fg.addLayer(layer),newCluster!==layer&&(newCluster._childCount>2?(newCluster._updateIcon(),this._forceLayout(),this._animationStart(),layer._setPos(this._map.latLngToLayerPoint(newCluster.getLatLng())),layer.clusterHide(),this._enqueue(function(){fg.removeLayer(layer),layer.clusterShow(),me._animationEnd()})):(this._forceLayout(),me._animationStart(),me._animationZoomOutSingle(newCluster,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(previousZoomLevel,newZoomLevel){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel),this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(previousZoomLevel,newZoomLevel){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel),this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(layer,newCluster){this._animationAddLayerNonAnimated(layer,newCluster)}}),L.markerClusterGroup=function(options){return new L.MarkerClusterGroup(options)},L.MarkerCluster=L.Marker.extend({initialize:function(group,zoom,a,b){L.Marker.prototype.initialize.call(this,a?a._cLatLng||a.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=group,this._zoom=zoom,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,a&&this._addChild(a),b&&this._addChild(b)},getAllChildMarkers:function(storageArray){storageArray=storageArray||[];for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i].getAllChildMarkers(storageArray);for(var j=this._markers.length-1;j>=0;j--)storageArray.push(this._markers[j]);return storageArray},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var i,childClusters=this._childClusters.slice(),map=this._group._map,boundsZoom=map.getBoundsZoom(this._bounds),zoom=this._zoom+1,mapZoom=map.getZoom();childClusters.length>0&&boundsZoom>zoom;){zoom++;var newClusters=[];for(i=0;i<childClusters.length;i++)newClusters=newClusters.concat(childClusters[i]._childClusters);childClusters=newClusters}boundsZoom>zoom?this._group._map.setView(this._latlng,zoom):boundsZoom<=mapZoom?this._group._map.setView(this._latlng,mapZoom+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var bounds=new L.LatLngBounds;return bounds.extend(this._bounds),bounds},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(new1,isNotificationFromChild){this._iconNeedsUpdate=!0,this._expandBounds(new1),new1 instanceof L.MarkerCluster?(isNotificationFromChild||(this._childClusters.push(new1),new1.__parent=this),this._childCount+=new1._childCount):(isNotificationFromChild||this._markers.push(new1),this._childCount++),this.__parent&&this.__parent._addChild(new1,!0)},_expandBounds:function(marker){var addedCount,addedLatLng=marker._wLatLng||marker._latlng;marker instanceof L.MarkerCluster?(this._bounds.extend(marker._bounds),addedCount=marker._childCount):(this._bounds.extend(addedLatLng),addedCount=1),this._cLatLng||(this._cLatLng=marker._cLatLng||addedLatLng);var totalCount=this._childCount+addedCount;this._wLatLng?(this._wLatLng.lat=(addedLatLng.lat*addedCount+this._wLatLng.lat*this._childCount)/totalCount,this._wLatLng.lng=(addedLatLng.lng*addedCount+this._wLatLng.lng*this._childCount)/totalCount):this._latlng=this._wLatLng=new L.LatLng(addedLatLng.lat,addedLatLng.lng)},_addToMap:function(startPos){startPos&&(this._backupLatlng=this._latlng,this.setLatLng(startPos)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(bounds,center,maxZoom){this._recursively(bounds,0,maxZoom-1,function(c){var i,m,markers=c._markers;for(i=markers.length-1;i>=0;i--)m=markers[i],m._icon&&(m._setPos(center),m.clusterHide())},function(c){var j,cm,childClusters=c._childClusters;for(j=childClusters.length-1;j>=0;j--)cm=childClusters[j],cm._icon&&(cm._setPos(center),cm.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(bounds,previousZoomLevel,newZoomLevel){this._recursively(bounds,newZoomLevel,0,function(c){c._recursivelyAnimateChildrenIn(bounds,c._group._map.latLngToLayerPoint(c.getLatLng()).round(),previousZoomLevel),c._isSingleParent()&&previousZoomLevel-1===newZoomLevel?(c.clusterShow(),c._recursivelyRemoveChildrenFromMap(bounds,previousZoomLevel)):c.clusterHide(),c._addToMap()})},_recursivelyBecomeVisible:function(bounds,zoomLevel){this._recursively(bounds,0,zoomLevel,null,function(c){c.clusterShow()})},_recursivelyAddChildrenToMap:function(startPos,zoomLevel,bounds){this._recursively(bounds,-1,zoomLevel,function(c){if(zoomLevel!==c._zoom)for(var i=c._markers.length-1;i>=0;i--){var nm=c._markers[i];bounds.contains(nm._latlng)&&(startPos&&(nm._backupLatlng=nm.getLatLng(),nm.setLatLng(startPos),nm.clusterHide&&nm.clusterHide()),c._group._featureGroup.addLayer(nm))}},function(c){c._addToMap(startPos)})},_recursivelyRestoreChildPositions:function(zoomLevel){for(var i=this._markers.length-1;i>=0;i--){var nm=this._markers[i];nm._backupLatlng&&(nm.setLatLng(nm._backupLatlng),delete nm._backupLatlng)}if(zoomLevel-1===this._zoom)for(var j=this._childClusters.length-1;j>=0;j--)this._childClusters[j]._restorePosition();else for(var k=this._childClusters.length-1;k>=0;k--)this._childClusters[k]._recursivelyRestoreChildPositions(zoomLevel)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(previousBounds,zoomLevel,exceptBounds){var m,i;this._recursively(previousBounds,-1,zoomLevel-1,function(c){for(i=c._markers.length-1;i>=0;i--)m=c._markers[i],exceptBounds&&exceptBounds.contains(m._latlng)||(c._group._featureGroup.removeLayer(m),m.clusterShow&&m.clusterShow())},function(c){for(i=c._childClusters.length-1;i>=0;i--)m=c._childClusters[i],exceptBounds&&exceptBounds.contains(m._latlng)||(c._group._featureGroup.removeLayer(m),m.clusterShow&&m.clusterShow())})},_recursively:function(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel){var i,c,childClusters=this._childClusters,zoom=this._zoom;if(zoomLevelToStart>zoom)for(i=childClusters.length-1;i>=0;i--)c=childClusters[i],boundsToApplyTo.intersects(c._bounds)&&c._recursively(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel);else if(runAtEveryLevel&&runAtEveryLevel(this),runAtBottomLevel&&this._zoom===zoomLevelToStop&&runAtBottomLevel(this),zoomLevelToStop>zoom)for(i=childClusters.length-1;i>=0;i--)c=childClusters[i],boundsToApplyTo.intersects(c._bounds)&&c._recursively(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel)},_recalculateBounds:function(){var i,markers=this._markers,childClusters=this._childClusters;for(this._bounds=new L.LatLngBounds,delete this._wLatLng,i=markers.length-1;i>=0;i--)this._expandBounds(markers[i]);for(i=childClusters.length-1;i>=0;i--)this._expandBounds(childClusters[i])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var ret=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,ret}}),L.DistanceGrid=function(cellSize){this._cellSize=cellSize,this._sqCellSize=cellSize*cellSize,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(obj,point){var x=this._getCoord(point.x),y=this._getCoord(point.y),grid=this._grid,row=grid[y]=grid[y]||{},cell=row[x]=row[x]||[],stamp=L.Util.stamp(obj);this._objectPoint[stamp]=point,cell.push(obj)},updateObject:function(obj,point){this.removeObject(obj),this.addObject(obj,point)},removeObject:function(obj,point){var i,len,x=this._getCoord(point.x),y=this._getCoord(point.y),grid=this._grid,row=grid[y]=grid[y]||{},cell=row[x]=row[x]||[];for(delete this._objectPoint[L.Util.stamp(obj)],i=0,len=cell.length;i<len;i++)if(cell[i]===obj)return cell.splice(i,1),1===len&&delete row[x],!0},eachObject:function(fn,context){var i,j,k,len,row,cell,removed,grid=this._grid;for(i in grid){row=grid[i];for(j in row)for(cell=row[j],k=0,len=cell.length;k<len;k++)removed=fn.call(context,cell[k]),removed&&(k--,len--)}},getNearObject:function(point){var i,j,k,row,cell,len,obj,dist,x=this._getCoord(point.x),y=this._getCoord(point.y),objectPoint=this._objectPoint,closestDistSq=this._sqCellSize,closest=null;for(i=y-1;i<=y+1;i++)if(row=this._grid[i])for(j=x-1;j<=x+1;j++)if(cell=row[j])for(k=0,len=cell.length;k<len;k++)obj=cell[k],dist=this._sqDist(objectPoint[L.Util.stamp(obj)],point),dist<closestDistSq&&(closestDistSq=dist,closest=obj);return closest},_getCoord:function(x){return Math.floor(x/this._cellSize)},_sqDist:function(p,p2){var dx=p2.x-p.x,dy=p2.y-p.y;return dx*dx+dy*dy}},function(){L.QuickHull={getDistant:function(cpt,bl){var vY=bl[1].lat-bl[0].lat,vX=bl[0].lng-bl[1].lng;return vX*(cpt.lat-bl[0].lat)+vY*(cpt.lng-bl[0].lng)},findMostDistantPointFromBaseLine:function(baseLine,latLngs){var i,pt,d,maxD=0,maxPt=null,newPoints=[];for(i=latLngs.length-1;i>=0;i--)pt=latLngs[i],d=this.getDistant(pt,baseLine),d>0&&(newPoints.push(pt),d>maxD&&(maxD=d,maxPt=pt));return{maxPoint:maxPt,newPoints:newPoints}},buildConvexHull:function(baseLine,latLngs){var convexHullBaseLines=[],t=this.findMostDistantPointFromBaseLine(baseLine,latLngs);return t.maxPoint?(convexHullBaseLines=convexHullBaseLines.concat(this.buildConvexHull([baseLine[0],t.maxPoint],t.newPoints)),convexHullBaseLines=convexHullBaseLines.concat(this.buildConvexHull([t.maxPoint,baseLine[1]],t.newPoints))):[baseLine[0]]},getConvexHull:function(latLngs){var i,maxLat=!1,minLat=!1,maxPt=null,minPt=null;for(i=latLngs.length-1;i>=0;i--){var pt=latLngs[i];(maxLat===!1||pt.lat>=maxLat)&&(maxPt=pt,maxLat=pt.lat),(minLat===!1||pt.lat<minLat)&&(minPt=pt,minLat=pt.lat)}var ch=[].concat(this.buildConvexHull([minPt,maxPt],latLngs),this.buildConvexHull([maxPt,minPt],latLngs));return ch}}}(),L.MarkerCluster.include({getConvexHull:function(){var p,i,childMarkers=this.getAllChildMarkers(),points=[];for(i=childMarkers.length-1;i>=0;i--)p=childMarkers[i].getLatLng(),points.push(p);return L.QuickHull.getConvexHull(points)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var positions,childMarkers=this.getAllChildMarkers(),group=this._group,map=group._map,center=map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,childMarkers.length>=this._circleSpiralSwitchover?positions=this._generatePointsSpiral(childMarkers.length,center):(center.y+=10,positions=this._generatePointsCircle(childMarkers.length,center)),this._animationSpiderfy(childMarkers,positions)}},unspiderfy:function(zoomDetails){this._group._inZoomAnimation||(this._animationUnspiderfy(zoomDetails),this._group._spiderfied=null)},_generatePointsCircle:function(count,centerPt){var i,angle,circumference=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+count),legLength=circumference/this._2PI,angleStep=this._2PI/count,res=[];for(res.length=count,i=count-1;i>=0;i--)angle=this._circleStartAngle+i*angleStep,res[i]=new L.Point(centerPt.x+legLength*Math.cos(angle),centerPt.y+legLength*Math.sin(angle))._round();return res},_generatePointsSpiral:function(count,centerPt){var i,legLength=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,separation=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,lengthFactor=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,angle=0,res=[];for(res.length=count,i=count-1;i>=0;i--)angle+=separation/legLength+5e-4*i,res[i]=new L.Point(centerPt.x+legLength*Math.cos(angle),centerPt.y+legLength*Math.sin(angle))._round(),legLength+=this._2PI*lengthFactor/angle;return res},_noanimationUnspiderfy:function(){var m,i,group=this._group,map=group._map,fg=group._featureGroup,childMarkers=this.getAllChildMarkers();for(this.setOpacity(1),i=childMarkers.length-1;i>=0;i--)m=childMarkers[i],fg.removeLayer(m),m._preSpiderfyLatlng&&(m.setLatLng(m._preSpiderfyLatlng),delete m._preSpiderfyLatlng),m.setZIndexOffset&&m.setZIndexOffset(0),m._spiderLeg&&(map.removeLayer(m._spiderLeg),delete m._spiderLeg);group._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return document.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(childMarkers,positions){var i,m,leg,newPos,me=this,group=this._group,map=group._map,fg=group._featureGroup,thisLayerPos=map.latLngToLayerPoint(this._latlng);for(i=childMarkers.length-1;i>=0;i--)m=childMarkers[i],m.setOpacity?(m.setZIndexOffset(1e6),m.clusterHide(),fg.addLayer(m),m._setPos(thisLayerPos)):fg.addLayer(m);group._forceLayout(),group._animationStart();var initialLegOpacity=L.Path.SVG?0:.3,xmlns=L.Path.SVG_NS;for(i=childMarkers.length-1;i>=0;i--){newPos=map.layerPointToLatLng(positions[i]),m=childMarkers[i],m._preSpiderfyLatlng=m._latlng,m.setLatLng(newPos),m.setOpacity&&m.clusterShow();var legOptions=this._group.options.spiderLegPolylineOptions;if(legOptions.opacity===undefined&&(legOptions.opacity=initialLegOpacity),leg=new L.Polyline([me._latlng,newPos],legOptions),map.addLayer(leg),m._spiderLeg=leg,L.Path.SVG&&this.SVG_ANIMATION){var length=leg._path.getTotalLength();leg._path.setAttribute("stroke-dasharray",length+","+length);var anim=document.createElementNS(xmlns,"animate");anim.setAttribute("attributeName","stroke-dashoffset"),anim.setAttribute("begin","indefinite"),anim.setAttribute("from",length),anim.setAttribute("to",0),anim.setAttribute("dur",.25),leg._path.appendChild(anim),anim.beginElement(),anim=document.createElementNS(xmlns,"animate"),anim.setAttribute("attributeName","stroke-opacity"),anim.setAttribute("attributeName","stroke-opacity"),anim.setAttribute("begin","indefinite"),anim.setAttribute("from",0),anim.setAttribute("to",.5),anim.setAttribute("dur",.25),leg._path.appendChild(anim),anim.beginElement()}}if(me.setOpacity(.3),L.Path.SVG)for(this._group._forceLayout(),i=childMarkers.length-1;i>=0;i--)m=childMarkers[i]._spiderLeg,m.options.opacity=.5,m._path.setAttribute("stroke-opacity",.5);setTimeout(function(){group._animationEnd(),group.fire("spiderfied")},200)},_animationUnspiderfy:function(zoomDetails){var m,i,a,group=this._group,map=group._map,fg=group._featureGroup,thisLayerPos=zoomDetails?map._latLngToNewLayerPoint(this._latlng,zoomDetails.zoom,zoomDetails.center):map.latLngToLayerPoint(this._latlng),childMarkers=this.getAllChildMarkers(),svg=L.Path.SVG&&this.SVG_ANIMATION;for(group._animationStart(),this.setOpacity(1),i=childMarkers.length-1;i>=0;i--)m=childMarkers[i],m._preSpiderfyLatlng&&(m.setLatLng(m._preSpiderfyLatlng),delete m._preSpiderfyLatlng,m.setOpacity?(m._setPos(thisLayerPos),m.clusterHide()):fg.removeLayer(m),svg&&(a=m._spiderLeg._path.childNodes[0],a.setAttribute("to",a.getAttribute("from")),a.setAttribute("from",0),a.beginElement(),a=m._spiderLeg._path.childNodes[1],a.setAttribute("from",.5),a.setAttribute("to",0),a.setAttribute("stroke-opacity",0),a.beginElement(),m._spiderLeg._path.setAttribute("stroke-opacity",0)));setTimeout(function(){var stillThereChildCount=0;for(i=childMarkers.length-1;i>=0;i--)m=childMarkers[i],m._spiderLeg&&stillThereChildCount++;for(i=childMarkers.length-1;i>=0;i--)m=childMarkers[i],m._spiderLeg&&(m.setOpacity&&(m.clusterShow(),m.setZIndexOffset(0)),stillThereChildCount>1&&fg.removeLayer(m),map.removeLayer(m._spiderLeg),delete m._spiderLeg);group._animationEnd()},200)}}:{_animationSpiderfy:function(childMarkers,positions){var i,m,leg,newPos,group=this._group,map=group._map,fg=group._featureGroup;for(i=childMarkers.length-1;i>=0;i--){newPos=map.layerPointToLatLng(positions[i]),m=childMarkers[i],m._preSpiderfyLatlng=m._latlng,m.setLatLng(newPos),m.setZIndexOffset&&m.setZIndexOffset(1e6),fg.addLayer(m);var legOptions=this._group.options.spiderLegPolylineOptions;leg=new L.Polyline([this._latlng,newPos],legOptions),map.addLayer(leg),m._spiderLeg=leg}this.setOpacity(.3),group.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(zoomDetails){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(zoomDetails))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(zoomDetails){this._spiderfied&&this._spiderfied.unspiderfy(zoomDetails)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(layer){layer._spiderLeg&&(this._featureGroup.removeLayer(layer),layer.setOpacity(1),layer.setZIndexOffset(0),this._map.removeLayer(layer._spiderLeg),delete layer._spiderLeg)}})}(window,document),emp.typeLibrary.utils=emp.typeLibrary.utils||{},emp.typeLibrary.utils.icon={offsetUnit:{FRACTION:"fraction",PIXEL:"pixels",INSETPIXELS:"insetpixels"},calculateOffset:function(iIconSize,sOffset,sOffsetType){var iOffsetValue,dFraction,iOffset=0;switch(sOffsetType.toLowerCase()){case emp.typeLibrary.utils.icon.offsetUnit.FRACTION:dFraction=parseFloat(sOffset),iOffset=Math.floor(iIconSize*dFraction);break;case emp.typeLibrary.utils.icon.offsetUnit.PIXEL:iOffsetValue=parseInt(sOffset),iOffset=iOffsetValue;break;case emp.typeLibrary.utils.icon.offsetUnit.INSETPIXELS:iOffsetValue=parseInt(sOffset),iOffset=iIconSize-iOffsetValue}return iOffset}},void 0===window.leafLet&&(leafLet={}),leafLet.typeLibrary={},leafLet.editor={},leafLet.typeLibrary.airspace={},leafLet.internalPrivateClass={},leafLet.typeLibrary.objectType={OVERLAY:"overlay",FEATURE:"feature",WMS:"wms",LL_CONTROL:"leafletControl",LL_DEFAULT_MAP:"leafletDefaultMap"},leafLet.typeLibrary.featureType=leafLet.typeLibrary.featureType||{},leafLet.typeLibrary.featureType.AOI="aoi",L.LEAFLET_DEFAULT_LINE_COLOR="#0033ff",L.LEAFLET_DEFAULT_LINE_WEIGHT=5,L.LatLng.fromEmpLatLon=function(oEmpLatLon){return new L.LatLng(oEmpLatLon._lat,oEmpLatLon._lon)},L.LatLng.prototype.toEmpLatLon=function(){return new LatLon(this.lat,this.lng)},L.LatLng.prototype.bearingTo=function(oCoord){var oThis=this.toEmpLatLon(),oThat=oCoord.toEmpLatLon();return oThis.bearingTo(oThat)},L.LatLng.prototype.destinationPoint=function(brng,dist){var oThis=this.toEmpLatLon(),oThat=oThis.destinationPoint(brng,dist/1e3);return new L.LatLng(oThat._lat,oThat._lon,this.alt)},L.LatLng.prototype.moveCoordinate=function(brng,dist){var oThis=this.toEmpLatLon(),oThat=oThis.destinationPoint(brng,dist/1e3);this.lat=oThat._lat,this.lng=oThat._lon},L.LatLng.prototype.intersectLines=function(dBrng1,oCoord2,dBrng2){var oThis=this.toEmpLatLon(),oThat=oCoord2.toEmpLatLon(),oResult=void 0;try{oResult=LatLon.intersection(oThis,dBrng1,oThat,dBrng2)}catch(error){}return oResult?new L.LatLng(oResult._lat,oResult._lon):oResult},L.LatLng.prototype.midPointTo=function(oCoord){var dBrng=this.bearingTo(oCoord),dDist=this.distanceTo(oCoord)/2;return this.destinationPoint(dBrng,dDist)},L.LatLng.prototype.pointAtFractionOfDistanceTo=function(oCoord,dFraction){var dBrng=this.bearingTo(oCoord),dDist=this.distanceTo(oCoord)*dFraction;return this.destinationPoint(dBrng,dDist)},L.LatLng.prototype.pointAt3QtrDistanceTo=function(oCoord){var dBrng=this.bearingTo(oCoord),dDist=.75*this.distanceTo(oCoord);return this.destinationPoint(dBrng,dDist)},leafLet.internalPrivateClass.EmpIcon=function(){var publicInterface={createIcon:function(oldIcon){var oThis=this,img=this._createIcon("icon");return this.options.oIconImag=img,this._applyAnchorRef(),img.onload=function(){var i=img;this.style.width=i.width+"px",this.style.height=i.height+"px",this.style.display=""},img.onerror=function(){var oDefaultIcon=emp.utilities.icon.getDefaultIcon(oThis.options.basePath);oThis.options.iconSize=new L.Point(oDefaultIcon.size.width,oDefaultIcon.size.height),oThis.options.iconAnchorRef={x:oDefaultIcon.offset.x,y:oDefaultIcon.offset.y},oThis.options.iconAnchorType={x:oDefaultIcon.offset.xUnits,y:oDefaultIcon.offset.yUnits},img.src=oDefaultIcon.iconUrl},img},_applyAnchorRef:function(){var oIconUtils=emp.utilities.icon,oImg=this.options.oIconImag;if(this.options.iconAnchor){var oOffset=this.options.iconAnchor,oUnits=this.options.iconAnchorType,sXUnits="pixels",sYUnits="pixels";oUnits&&"string"==typeof oUnits.x&&(sXUnits=oUnits.x),oUnits&&"string"==typeof oUnits.y&&(sYUnits=oUnits.y),oImg.style.marginLeft=oIconUtils.calculateXOffset(oImg.width,oOffset.x,sXUnits)+"px",oImg.style.marginTop=oIconUtils.calculateYOffset(oImg.height,oOffset.y,sYUnits,oIconUtils.referencePoint.TOP_LEFT)+"px"}else{var oDefaultIcon=emp.utilities.icon.getDefaultIcon(this.options.basePath),iXOffset=oIconUtils.calculateXOffset(oDefaultIcon.offset.width,oDefaultIcon.offset.x.toString(),oDefaultIcon.offset.xUnits),iYOffset=oIconUtils.calculateYOffset(oDefaultIcon.offset.height,oDefaultIcon.offset.y.toString(),oDefaultIcon.offset.yUnits,oIconUtils.referencePoint.TOP_LEFT);oImg.style.marginLeft=iXOffset+"px",oImg.style.marginTop=iYOffset+"px"}}};return publicInterface},leafLet.typeLibrary.EmpIcon=L.Icon.extend(leafLet.internalPrivateClass.EmpIcon()),L.Icon.Default=L.Icon.Default.extend({options:{iconSize:[25,41],iconAnchor:[12,41]},_getIconUrl:function(name){if("shadow"!==name){var oDefaultIcon=emp.utilities.icon.getDefaultIcon(this.options.basePath),iXOffset=emp.utilities.icon.calculateXOffset(oDefaultIcon.offset.width,oDefaultIcon.offset.x,oDefaultIcon.offset.xUnits),iYOffset=emp.utilities.icon.calculateYOffset(oDefaultIcon.offset.height,oDefaultIcon.offset.y,oDefaultIcon.offset.yUnits,emp.utilities.icon.referencePoint.BOTTOM_LEFT);return this.options.iconSize=new L.Point(oDefaultIcon.size.width,oDefaultIcon.size.height),this.options.iconAnchor=new L.Point(iXOffset,iYOffset),oDefaultIcon.iconUrl}}}),L.Marker=L.Marker.extend({options:{nonBubblingEvents:["dblclick","mouseover","mouseout","contextmenu"]},_setPos:function(pos){var oImg,sTemp;L.DomUtil.setPosition(this._icon,pos),this._shadow&&L.DomUtil.setPosition(this._shadow,pos),this._zIndex=pos.y+this.options.zIndexOffset,this._resetZIndex(),oImg=this._icon,sTemp=oImg.style[L.DomUtil.TRANSFORM],sTemp=emp.helpers.isEmptyString(oImg.style[L.DomUtil.TRANSFORM])?"":oImg.style[L.DomUtil.TRANSFORM],emp.helpers.isEmptyString(this.options.icon.options.heading)||(sTemp+=" rotate("+this.options.icon.options.heading+"deg)"),emp.helpers.isEmptyString(this.options.icon.options.scale)||(sTemp+=" scale("+this.options.icon.options.scale+","+this.options.icon.options.scale+")"),oImg.style[L.DomUtil.TRANSFORM]=sTemp},empSelect:function(){var labelStyle=this.options.oFeature.getEngineInstanceInterface().selectLabelStyle;this.options.oFeature&&this.options.oFeature.getFormat()===emp.typeLibrary.featureFormatType.MILSTD&&this.options.oFeature.isMultiPointTG()||(this.options.icon instanceof L.DivIcon?labelStyle&&emp.$(this._icon).find("p").css("color","rgb("+labelStyle.color.red+", "+labelStyle.color.green+", "+labelStyle.color.blue+")"):this.options.icon instanceof L.Icon&&emp.$(this._icon).addClass("icon-selected"));
},empDeselect:function(){var labelStyle=this.options.oFeature.getLabelStyle();this.options.oFeature&&this.options.oFeature.getFormat()===emp.typeLibrary.featureFormatType.MILSTD&&this.options.oFeature.isMultiPointTG()||(this.options.icon instanceof L.DivIcon?labelStyle&&emp.$(this._icon).find("p").css("color","rgb("+labelStyle.color.red+", "+labelStyle.color.green+", "+labelStyle.color.blue+")"):this.options.icon instanceof L.Icon&&emp.$(this._icon).removeClass("icon-selected"))}}),L.Polyline=L.Polyline.extend({empSelect:function(){var oSelectAttributes=this.options.oFeature.options.instanceInterface.selectAttributes;this.options.tempColor=this.options.color,this.options.tempWeight=this.options.weight,this.setStyle({color:"#"+oSelectAttributes.color,weight:oSelectAttributes.width})},empDeselect:function(){var oStyle={};this.options.hasOwnProperty("tempColor")&&!emp.util.isEmptyString(this.options.tempColor)&&(oStyle.color=this.options.tempColor,null===oStyle.color&&(oStyle.stroke=!1),delete this.options.tempColor),this.options.hasOwnProperty("tempWeight")&&!isNaN(this.options.tempWeight)&&(oStyle.weight=this.options.tempWeight,delete this.options.tempWeight),(oStyle.hasOwnProperty("color")||oStyle.hasOwnProperty("weight"))&&this.setStyle(oStyle)}}),L.Polygon=L.Polygon.extend({empSelect:function(){var oSelectAttributes=this.options.oFeature.options.instanceInterface.selectAttributes;this.options.tempColor=this.options.color,this.options.tempWeight=this.options.weight,this.setStyle({color:"#"+oSelectAttributes.color,weight:oSelectAttributes.width})},empDeselect:function(){this.setStyle({color:this.options.tempColor,weight:this.options.tempWeight})}}),L.Circle=L.Circle.extend({empSelect:function(){var oSelectAttributes=this.options.oFeature.options.instanceInterface.selectAttributes;this.options.tempColor=this.options.color,this.options.tempWeight=this.options.weight,this.setStyle({color:"#"+oSelectAttributes.color,weight:oSelectAttributes.width})},empDeselect:function(){this.setStyle({color:this.options.tempColor,weight:this.options.tempWeight})}}),L.TileLayer=L.TileLayer.extend({getTileUrl:function(tilePoint){var sURL=L.Util.template(this._url,L.extend({s:this._getSubdomain(tilePoint),z:tilePoint.z,x:tilePoint.x,y:tilePoint.y},this.options));return this.options.isDefaultMap?this.options.instanceInterface.useProxyForDefault&&(sURL=emp.util.config.getProxyUrl()+"?mime=image/*&url="+encodeURIComponent(sURL)):this.options.useProxy&&(sURL=emp.util.config.getProxyUrl()+"?mime=image/*&url="+encodeURIComponent(sURL)),sURL}}),L.TileLayer.WMS=L.TileLayer.WMS.extend({getTileUrl:function(coords){var sURL,tileBounds=this._tileCoordsToBounds(coords),nw=this._crs.project(tileBounds.getNorthWest()),se=this._crs.project(tileBounds.getSouthEast()),bbox=(this._wmsVersion>=1.3&&this._crs===L.CRS.EPSG4326?[se.y,nw.x,nw.y,se.x]:[nw.x,se.y,se.x,nw.y]).join(","),url=L.TileLayer.prototype.getTileUrl.call(this,coords);return sURL=url+L.Util.getParamString(this.wmsParams,url,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+bbox,this.options.useProxy&&(sURL=emp.util.config.getProxyUrl()+"?mime=image/*&url="+encodeURIComponent(sURL)),sURL}}),L.Control.Zoom=L.Control.Zoom.extend({getCoreId:function(){return this.options.coreId},getObjectType:function(){return this.options.objectType}}),L.Control.Scale=L.Control.Scale.extend({getCoreId:function(){return this.options.coreId},getObjectType:function(){return this.options.objectType}}),L.TileLayer=L.TileLayer.extend({getCoreId:function(){return this.options.coreId},getObjectType:function(){return this.options.objectType}}),leafLet.internalPrivateClass.EmpKMLIcon=function(){var publicInterface={createIcon:function(oldIcon){var oThis=this,img=this._createIcon("icon",oldIcon);return this.options.oIconImag=img,img.onload=function(){oThis.options.oMarker.update()},img.onerror=function(){var oDefaultIcon=emp.utilities.icon.getDefaultIcon(oThis.options.basePath);oThis.options.iconSize=new L.Point(oDefaultIcon.size.width,oDefaultIcon.size.height),oThis.options.iconAnchorRef={x:oDefaultIcon.offset.x,y:oDefaultIcon.offset.y},oThis.options.iconAnchorType={x:oDefaultIcon.offset.xUnits,y:oDefaultIcon.offset.yUnits},img.src=oDefaultIcon.iconUrl},img},_getRealScale:function(){var dKMLScale=1,dScale=1;return emp.helpers.isEmptyString(this.options.scale)||(dKMLScale=parseFloat(this.options.scale)),this.options.oIconImag.naturalWidth>this.options.oIconImag.naturalHeight&&this.options.oIconImag.naturalWidth>32?dScale=32/this.options.oIconImag.naturalWidth:this.options.oIconImag.naturalHeight>this.options.oIconImag.naturalWidth&&this.options.oIconImag.naturalHeight>32?dScale=32/this.options.oIconImag.naturalHeight:this.options.oIconImag.naturalHeight===this.options.oIconImag.naturalWidth&&this.options.oIconImag.naturalHeight>32&&(dScale=32/this.options.oIconImag.naturalHeight),dKMLScale*dScale},_calculatXOffset:function(iIconWidth,sOffset,sOffsetType,dScale){var iOffset=0;switch(sOffsetType.toLowerCase()){case"fraction":var dFraction=parseFloat(sOffset);iOffset=Math.floor(iIconWidth*dFraction*-1);break;case"pixels":var iOffsetValue=parseInt(sOffset);iOffset=iOffsetValue*-1;break;case"insetpixels":var iOffsetValue=parseInt(sOffset);iOffset=(iIconWidth-iOffsetValue)*-1}return Math.floor(iOffset*dScale)},_calculatYOffset:function(iIconHeight,sOffset,sOffsetType,dScale){var iOffset=0;switch(sOffsetType.toLowerCase()){case"fraction":var dFraction=parseFloat(sOffset);iOffset=Math.floor(iIconHeight*dFraction)-iIconHeight;break;case"pixels":var iOffsetValue=parseInt(sOffset);iOffset=iOffsetValue-iIconHeight;break;case"insetpixels":var iOffsetValue=parseInt(sOffset);iOffset=iOffsetValue*-1}return Math.floor(iOffset*dScale)},_applyAnchorRef:function(){var marginLeft,marginTop,iIconWidth,iIconHeight,dAngle,dTempX,dTempY,fHeading,iCenterX,iCenterY,oImg=this.options.oIconImag,dScale=this._getRealScale();if(this.options.iconAnchorRef){var oOffset=this.options.iconAnchorRef,oUnits=this.options.iconAnchorType,sXUnits="fraction",sYUnits="fraction";oUnits&&"string"==typeof oUnits.x&&(sXUnits=oUnits.x),oUnits&&"string"==typeof oUnits.y&&(sYUnits=oUnits.y),marginLeft=this._calculatXOffset(oImg.naturalWidth,oOffset.x,sXUnits,dScale),marginTop=this._calculatYOffset(oImg.naturalHeight,oOffset.y,sYUnits,dScale),iIconWidth=Math.floor(oImg.naturalWidth*dScale),iIconHeight=Math.floor(oImg.naturalHeight*dScale)}else{var oIconUtils=emp.typeLibrary.utils.icon,oDefaultIcon=oIconUtils.getDefaultIcon(this.options.basePath),iXOffset=oIconUtils.calculateXOffset(oDefaultIcon.size.width,oDefaultIcon.offset.x,oDefaultIcon.offset.xUnits),iYOffset=oIconUtils.calculateYOffset(oDefaultIcon.size.height,oDefaultIcon.offset.y,oDefaultIcon.offset.yUnits,emp.utilities.icon.referencePoin.BOTTOM_LEFT);marginLeft=iXOffset,marginTop=iYOffset,iIconWidth=Math.floor(oDefaultIcon.size.width*dScale),iIconHeight=Math.floor(oDefaultIcon.size.height*dScale)}if(!emp.helpers.isEmptyString(this.options.heading)){fHeading=parseFloat(this.options.heading),iCenterX=marginLeft+iIconWidth/2,iCenterY=marginTop+iIconHeight/2,dTempX=0-iCenterX,dTempY=0-iCenterY,dAngle=fHeading*Math.PI/180;var dSin=Math.sin(dAngle),dCos=Math.cos(dAngle),dNewX=Math.round(dTempX*dCos-dTempY*dSin),dNewY=Math.round(dTempX*dSin+dTempY*dCos);dTempX=dNewX+iCenterX,dTempY=dNewY+iCenterY,marginLeft-=dTempX,marginTop-=dTempY}return oImg.style.marginLeft=Math.ceil(marginLeft)+"px",oImg.style.marginTop=Math.ceil(marginTop)+"px",oImg.style.width=iIconWidth+"px",oImg.style.height=iIconHeight+"px",Math.floor(1e3*dScale)/1e3}};return publicInterface},leafLet.typeLibrary.EmpKMLIcon=L.KMLIcon.extend(leafLet.internalPrivateClass.EmpKMLIcon()),leafLet.internalPrivateClass.EmpKMLMarker=function(){var publicInterface={initialize:function(latlng,options){options.draggable=!1,options.icon.options.oMarker=this,L.Marker.prototype.initialize.call(this,latlng,options)},setLatLng:function(latlng){if(this._latlng=L.latLng(latlng),this._icon){var pos=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(pos)}return this.fire("move",{latlng:this._latlng})},update:function(){if(this._icon){var pos=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(pos)}return this},_setPos:function(pos){var oImg,sTemp;this.options.icon._applyAnchorRef();L.Marker.prototype._setPos.call(this,pos),oImg=this._icon,sTemp=emp.helpers.isEmptyString(oImg.style[L.DomUtil.TRANSFORM])?"":oImg.style[L.DomUtil.TRANSFORM],emp.helpers.isEmptyString(this.options.icon.options.heading)||(sTemp+=" rotate("+this.options.icon.options.heading+"deg)"),oImg.style[L.DomUtil.TRANSFORM]=sTemp}};return publicInterface},leafLet.typeLibrary.EmpKMLMarker=L.Marker.extend(leafLet.internalPrivateClass.EmpKMLMarker()),leafLet.internalPrivateClass.KMLPluginExtension=function(){var publicInterface={initialize:function(kml,options){if(L.Util.setOptions(this,options),this._kml=kml,this._layers={},kml){if("string"!=typeof kml)throw new Error("KML or URL must be a string.");emp.helpers.isUrl(kml)?this.addKML(kml,options,this.options.async):this._addKML(emp.$.parseXML(kml),options)}},getIconUrl:function(sKmlUrl){var sURL=sKmlUrl;return this.options.oFeatureProperties.hasOwnProperty("iconUrl")&&(sURL=this.options.oFeatureProperties.iconUrl),emp.util.config.getUseProxySetting()&&(sURL=emp.util.config.getProxyUrl()+"?mime=image/*&url="+escape(sURL)),sURL},_addKML:function(xml,options){this.options.kmlDoc=xml;var layers=this.parseKML(xml);if(layers&&layers.length){for(var i=0;i<layers.length;i++)this.fire("addlayer",{layer:layers[i]}),this.addLayer(layers[i]);this.latLngs=this.getLatLngs(xml),this.fire("loaded")}},parseStyle:function(xml){function _parse(xml){for(var options={},i=0;i<xml.childNodes.length;i++){var e=xml.childNodes[i],key=e.tagName;if(attributes[key])if("hotSpot"===key)for(var j=0;j<e.attributes.length;j++)options[e.attributes[j].name]=e.attributes[j].nodeValue;else{var value=e.childNodes[0].nodeValue;"color"===key?(options.opacity=parseInt(value.substring(0,2),16)/255,options.color="#"+value.substring(6,8)+value.substring(4,6)+value.substring(2,4)):"width"===key?options.weight=value:"Icon"===key?(ioptions=_parse(e),ioptions.href&&(options.href=ioptions.href)):"href"===key?options.href=value:"scale"===key?options.scale=value:"heading"===key&&(options.heading=value)}}return options}for(var style={},sl=xml.getElementsByTagName("Style"),attributes={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0,scale:!0,heading:!0},i=0;i<sl.length;i++){var el,e=sl[i],options={},poptions={},ioptions={};if(el=e.getElementsByTagName("LineStyle"),el&&el[0]&&(options=_parse(el[0])),el=e.getElementsByTagName("PolyStyle"),el&&el[0]&&(poptions=_parse(el[0])),poptions.color&&(options.fillColor=poptions.color),poptions.opacity&&(options.fillOpacity=poptions.opacity),el=e.getElementsByTagName("IconStyle"),el&&el[0]&&(ioptions=_parse(el[0])),ioptions.href){var oIconOptions={iconUrl:this.getIconUrl(ioptions.href),shadowUrl:null,iconAnchorRef:{x:ioptions.x,y:ioptions.y},iconAnchorType:{x:ioptions.xunits,y:ioptions.yunits}};emp.helpers.isEmptyString(ioptions.scale)||(oIconOptions.scale=ioptions.scale),emp.helpers.isEmptyString(ioptions.heading)||(oIconOptions.heading=ioptions.heading),oIconOptions.basePath=this.options.basePath,options.icon=new leafLet.typeLibrary.EmpKMLIcon(oIconOptions)}style["#"+e.getAttribute("id")]=options}return style},parsePlacemark:function(place,xml,style){var h,i,j,el,options={},multi=["MultiGeometry","gx:MultiTrack"];for(h in multi)if(multi.hasOwnProperty(h))for(el=place.getElementsByTagName(multi[h]),i=0;i<el.length;i++)return this.parsePlacemark(el[i],xml,style);if(el=place.getElementsByTagName("Style"),el&&el.length>0)for(i=0;i<el.length;i++){var sIndex="#"+el[i].getAttribute("id");for(var a in style[sIndex])style[sIndex].hasOwnProperty(a)&&(options[a]=style[sIndex][a])}else for(el=place.getElementsByTagName("styleUrl"),i=0;i<el.length;i++){var url=el[i].childNodes[0].nodeValue;for(var a in style[url])style[url].hasOwnProperty(a)&&(options[a]=style[url][a])}var layers=[],parse=["LineString","Polygon","Point","gx:Track"];for(j in parse)if(parse.hasOwnProperty(j)){var tag=parse[j];for(el=place.getElementsByTagName(tag),i=0;i<el.length;i++){var l=this["parse"+tag.replace(/gx:/,"")](el[i],xml,options);l&&layers.push(l)}}if(layers.length){var layer=layers[0];layers.length>1&&(layer=new L.FeatureGroup(layers));var sID,name,descr="";for(place.id&&(sID=place.id),el=place.getElementsByTagName("name"),el.length&&el[0].childNodes.length&&(name=el[0].childNodes[0].nodeValue),el=place.getElementsByTagName("description"),i=0;i<el.length;i++)for(j=0;j<el[i].childNodes.length;j++)descr+=el[i].childNodes[j].nodeValue;return"string"==typeof name&&name.length>0&&(layer.options.kmlName=name),"string"==typeof descr&&descr.length>0&&(layer.options.kmlDescription=descr),"string"==typeof sID&&sID.length>0&&(layer.options.sSubItemID=sID),layer}},_read_coords:function(el){var i,text="",coords=[];for(i=0;i<el.childNodes.length;i++)text+=el.childNodes[i].nodeValue;for(text=text.split(/[\s\n]+/),i=0;i<text.length;i++){var ll=text[i].split(",");ll.length<2||coords.push(new L.LatLng(ll[1],ll[0],ll[2]))}return coords},_read_gxcoords:function(el){var text="",coords=[];return text=el.firstChild.nodeValue.split(" "),coords.push(new L.LatLng(text[1],text[0],text[2])),coords},getOptions:function(sType,oOptions){var oColor,oProperties=this.options.oFeatureProperties;if("point"===sType){var sURL,iXOffset,iYOffset,sXUnits,sYUnits;if(oProperties.hasOwnProperty("iconUrl")&&(sURL=this.getIconUrl(oProperties.iconUrl)),oProperties.hasOwnProperty("iconXOffset")&&(iXOffset=oProperties.iconXOffset,oProperties.hasOwnProperty("xUnits")&&(sXUnits=oProperties.xUnits)),oProperties.hasOwnProperty("iconYOffset")&&(iYOffset=oProperties.iconYOffset,oProperties.hasOwnProperty("yUnits")&&(sYUnits=oProperties.yUnits)),iXOffset||(iXOffset=oOptions.icon&&oOptions.icon.options.iconAnchorRef?oOptions.icon.options.iconAnchorRef.x:0),sXUnits||(sXUnits=oOptions.icon&&oOptions.icon.options.iconAnchorType?oOptions.icon.options.iconAnchorType.x:"fraction"),iYOffset||(iYOffset=oOptions.icon&&oOptions.icon.options.iconAnchorRef?oOptions.icon.options.iconAnchorRef.y:0),sYUnits||(sYUnits=oOptions.icon&&oOptions.icon.options.iconAnchorType?oOptions.icon.options.iconAnchorType.y:"fraction"),oOptions.icon)"string"==typeof sURL&&sURL.length>0&&(oOptions.icon.options.iconUrl=sURL),oOptions.icon.options.iconAnchorRef={x:iXOffset,y:iYOffset},oOptions.icon.options.iconAnchorType={x:sXUnits,y:sYUnits},this.options.oFeature.isSelected()?oOptions.icon.options.className="icon-selected":oOptions.icon.options.className="";else{if(!sURL){var oDefaultIcon=emp.utilities.icon.getDefaultIcon(this.options.basePath);sURL=oDefaultIcon.iconUrl,iYOffset=oDefaultIcon.offset.y,iXOffset=oDefaultIcon.offset.x,sXUnits=oDefaultIcon.offset.xUnits,sYUnits=oDefaultIcon.offset.yUnits}this.options.oFeature.isSelected()?oOptions.icon=new leafLet.typeLibrary.EmpKMLIcon({iconUrl:sURL,shadowUrl:null,iconAnchorRef:{x:iXOffset,y:iYOffset},iconAnchorType:{x:sXUnits,y:sYUnits},className:"icon-selected",basePath:this.options.basePath}):oOptions.icon=new leafLet.typeLibrary.EmpKMLIcon({iconUrl:sURL,shadowUrl:null,iconAnchorRef:{x:iXOffset,y:iYOffset},iconAnchorType:{x:sXUnits,y:sYUnits},basePath:this.options.basePath})}}return this.options.oFeature.isSelected()?(oOptions.color="#"+this.options.oFeature.options.instanceInterface.selectAttributes.color,oOptions.weight=this.options.oFeature.options.instanceInterface.selectAttributes.width,"line"!==sType&&"polygon"!==sType||(oProperties.hasOwnProperty("lineColor")?oOptions.tempColor=leafLet.utils.convertColor(oProperties.lineColor).sColor:oOptions.tempColor=L.LEAFLET_DEFAULT_LINE_COLOR,oProperties.hasOwnProperty("lineWidth")?"string"==typeof oProperties.lineWidth?oOptions.tempWeight=parseInt(oProperties.lineWidth):oOptions.tempWeight=oProperties.lineWidth:oOptions.tempWeight=L.LEAFLET_DEFAULT_LINE_WEIGHT)):!oProperties.hasOwnProperty("lineColor")||"line"!==sType&&"polygon"!==sType||(oColor=leafLet.utils.convertColor(oProperties.lineColor),oOptions.color=oColor.sColor,oOptions.opacity=oColor.opacity,oProperties.hasOwnProperty("lineWidth")&&("string"==typeof oProperties.lineWidth?oOptions.weight=parseInt(oProperties.lineWidth):oOptions.weight=oProperties.lineWidth)),oProperties.hasOwnProperty("fillColor")&&"polygon"===sType&&(oColor=leafLet.utils.convertColor(oProperties.fillColor),oOptions.fill=!0,oOptions.fillColor=oColor.sColor,oOptions.fillOpacity=oColor.opacity),oOptions.oFeature=this.options.oFeature,oOptions},parsePoint:function(line,xml,options){var el=line.getElementsByTagName("coordinates");if(el.length){var ll=el[0].childNodes[0].nodeValue.split(",");return new leafLet.typeLibrary.EmpKMLMarker(new L.LatLng(ll[1],ll[0],ll[2]),this.getOptions("point",options))}},parseLineString:function(line,xml,options){var coords=this.parseCoords(line);if(coords.length)return new L.Polyline(coords,this.getOptions("line",options))},parseTrack:function(line,xml,options){for(var el=xml.getElementsByTagName("gx:coord"),coords=[],j=0;j<el.length;j++)coords=coords.concat(this._read_gxcoords(el[j]));if(coords.length)return new L.Polyline(coords,this.getOptions("line",options))},parsePolygon:function(line,xml,options){var el,i,coords,polys=[],inner=[];for(el=line.getElementsByTagName("outerBoundaryIs"),i=0;i<el.length;i++)coords=this.parseCoords(el[i]),coords&&polys.push(coords);for(el=line.getElementsByTagName("innerBoundaryIs"),i=0;i<el.length;i++)coords=this.parseCoords(el[i]),coords&&inner.push(coords);if(polys.length)return options.fillColor&&(options.fill=!0),1===polys.length?new L.Polygon(polys.concat(inner),this.getOptions("polygon",options)):new L.MultiPolygon(polys,this.getOptions("polygon",options))}};return publicInterface},leafLet.typeLibrary.EmpKmlObject=L.KML.extend(leafLet.internalPrivateClass.KMLPluginExtension()),L.MarkerCluster.mergeOptions({titleText:"",popupText:"",overlay:void 0}),L.MarkerCluster.include({setPopupHeading:function(sText){this.options.titleText=sText},getPopupHeading:function(){return this.options.titleText},setPopupText:function(sText){this.options.popupText=sText},getPopupText:function(){return this.options.popupText},setOverlay:function(oOverlay){this.options.overlay=oOverlay},getOverlayId:function(){var sID=void 0;return this.options.overlay instanceof leafLet.typeLibrary.Overlay&&(sID=this.options.overlay.getOverlayId()),sID},getParentId:function(){var sID=void 0;return this.options.overlay instanceof leafLet.typeLibrary.Overlay&&(sID=this.options.overlay.getParentId()),sID},getFeatureId:function(){}}),leafLet.internalPrivateClass.EllipseObject=function(){var publicInterface={initialize:function(args){var options={oMap:args.leafletMap,semiMajor:args.semiMajor,semiMinor:args.semiMinor,azimuth:args.azimuth,centerLatLng:args.centerLatLng,isSelected:args.isSelected,selectAttributes:args.selectAttributes,oCoordList:[],properties:args.properties,oFeature:args.oFeature};L.Util.setOptions(this,options),this._generatePolygon(),L.Polygon.prototype.initialize.call(this,this.options.oCoordList,this.options.properties)},isSelected:function(){return this.options.isSelected},_generatePolygon:function(){var x,y,tempLatLng,angle,angleTan,angleTan2,xyPoint,newPoint,q1PointList=[],q2PointList=[],q3PointList=[],q4PointList=[],coordList=this.options.oCoordList,leafletMap=this.options.oMap,centerPoint=leafletMap.latLngToLayerPoint(this.options.centerLatLng),northCoord=this.options.centerLatLng.destinationPoint(0,this.options.semiMinor),eastCoord=this.options.centerLatLng.destinationPoint(90,this.options.semiMajor),northPoint=leafletMap.latLngToLayerPoint(northCoord),eastPoint=leafletMap.latLngToLayerPoint(eastCoord),semiMajorPx=centerPoint.distanceTo(eastPoint),semiMinorPx=centerPoint.distanceTo(northPoint),nPtePtDist=northPoint.distanceTo(eastPoint),semiMajorPx2=semiMajorPx*semiMajorPx,semiMinorPx2=semiMinorPx*semiMinorPx,majorMinor=semiMajorPx*semiMinorPx,azimuth=this.options.azimuth,cosAzimuth=Math.cos(azimuth.toRad()),sinAzimuth=Math.sin(azimuth.toRad()),deltaRadian=(90/nPtePtDist).toRad(),maxRadian=Math.PI/2;for(x=semiMajorPx,y=0,xyPoint=new L.point(x*cosAzimuth-y*sinAzimuth,y*cosAzimuth+x*sinAzimuth,(!0)),newPoint=centerPoint.add(xyPoint),q1PointList.push(newPoint),xyPoint=new L.point(x*cosAzimuth*-1-y*sinAzimuth*-1,y*cosAzimuth*-1+x*sinAzimuth*-1,(!0)),newPoint=centerPoint.add(xyPoint),q4PointList.push(newPoint),angle=deltaRadian;angle<maxRadian;angle+=deltaRadian)angleTan=Math.tan(angle),angleTan2=angleTan*angleTan,x=majorMinor/Math.sqrt(semiMinorPx2+semiMajorPx2*angleTan2),y=x*angleTan,xyPoint=new L.point(x*cosAzimuth-y*sinAzimuth,y*cosAzimuth+x*sinAzimuth,(!0)),newPoint=centerPoint.add(xyPoint),q1PointList.push(newPoint),xyPoint=new L.point(x*cosAzimuth*-1-y*sinAzimuth,y*cosAzimuth+x*sinAzimuth*-1,(!0)),newPoint=centerPoint.add(xyPoint),q2PointList.push(newPoint),xyPoint=new L.point(x*cosAzimuth-y*sinAzimuth*-1,y*cosAzimuth*-1+x*sinAzimuth,(!0)),newPoint=centerPoint.add(xyPoint),q3PointList.push(newPoint),xyPoint=new L.point(x*cosAzimuth*-1-y*sinAzimuth*-1,y*cosAzimuth*-1+x*sinAzimuth*-1,(!0)),newPoint=centerPoint.add(xyPoint),q4PointList.push(newPoint);for(x=0;x<q1PointList.length;x++)tempLatLng=leafletMap.layerPointToLatLng(q1PointList[x]),tempLatLng&&coordList.push(tempLatLng);for(x=q2PointList.length-1;x>=0;x--)tempLatLng=leafletMap.layerPointToLatLng(q2PointList[x]),tempLatLng&&coordList.push(tempLatLng);for(x=0;x<q4PointList.length;x++)tempLatLng=leafletMap.layerPointToLatLng(q4PointList[x]),tempLatLng&&coordList.push(tempLatLng);for(x=q3PointList.length-1;x>=0;x--)tempLatLng=leafletMap.layerPointToLatLng(q3PointList[x]),tempLatLng&&coordList.push(tempLatLng)}};return publicInterface},leafLet.EllipseObject=L.Polygon.extend(leafLet.internalPrivateClass.EllipseObject()),leafLet.internalPrivateClass.SelectionManager=function(args){var publicInterface={initialize:function(args){var options={eventData:[],featureSelectedList:{},mapInstance:args.mapInstance};L.Util.setOptions(this,options)},destroy:function(){var iIndex,oKeyList=emp.helpers.associativeArray.getKeys(this.options.featureSelectedList);for(iIndex=0;iIndex<oKeyList.length;iIndex++)delete this.options.featureSelectedList[oKeyList[iIndex]];this.options.eventData=[]},getKey:function(oFeature,sSubFeatureID){var sKey=oFeature.getCoreId();return emp.helpers.isEmptyString(sSubFeatureID)||(sKey+="-"+sSubFeatureID),sKey},_createSelectionObject:function(oFeature,sSubFeatureID){var sKey=this.getKey(oFeature,sSubFeatureID),oSelectedListObject={sKey:sKey,oFeature:oFeature,oSelectionData:{coreId:oFeature.getCoreId(),overlayId:oFeature.getOverlayId(),parentId:oFeature.getParentId(),featureId:oFeature.getFeatureId(),select:!0}};return"string"==typeof sSubFeatureID&&sSubFeatureID.length>0&&(oSelectedListObject.oSelectionData.selectedId=sSubFeatureID),oSelectedListObject},deselectAllFeatures:function(){var iIndex,oFeatureSelection,oKeyList=emp.helpers.associativeArray.getKeys(this.options.featureSelectedList);for(iIndex=0;iIndex<oKeyList.length;iIndex++)oFeatureSelection=this.options.featureSelectedList[oKeyList[iIndex]],oFeatureSelection.oFeature.isInEditMode()||(oFeatureSelection.oSelectionData.select=!1,this.options.eventData.push(oFeatureSelection.oSelectionData),delete this.options.featureSelectedList[oKeyList[iIndex]],this.applyHighlight2LeafletObject(oFeatureSelection.oFeature,oFeatureSelection.oSelectionData.selectedId,!1))},_removeFeatureFromSelectedList:function(oFeature,sSubFeatureID){var sKey=this.getKey(oFeature,sSubFeatureID);void 0!==this.options.featureSelectedList[sKey]&&delete this.options.featureSelectedList[sKey]},_addFeatureToSelectedList:function(oSelectedListObject){void 0===this.options.featureSelectedList[oSelectedListObject.sKey]&&(this.options.featureSelectedList[oSelectedListObject.sKey]=oSelectedListObject)},isSelected:function(oFeature,sSubFeatureID){var bSelected=!1,sKey=this.getKey(oFeature);return void 0!==this.options.featureSelectedList[sKey]||(emp.helpers.isEmptyString(sSubFeatureID)||(sKey=this.getKey(oFeature,sSubFeatureID),bSelected=void 0!==this.options.featureSelectedList[sKey]),bSelected)},selectFeature:function(oFeature,sSubFeatureID){var oSelectedListObject=this._createSelectionObject(oFeature,sSubFeatureID);this.applyHighlight2LeafletObject(oFeature,sSubFeatureID,!0),this._addFeatureToSelectedList(oSelectedListObject),this.options.eventData.push(oSelectedListObject.oSelectionData)},deselectFeature:function(oFeature,sSubFeatureID){var sKey=this.getKey(oFeature,sSubFeatureID),oSelectedListObject=this.options.featureSelectedList[sKey];emp.helpers.isEmptyString(sSubFeatureID)?this._removeFeaturesEntries(oFeature):oSelectedListObject&&(this._removeFeatureFromSelectedList(oFeature,sSubFeatureID),this.applyHighlight2LeafletObject(oFeature,sSubFeatureID,!1),oSelectedListObject.oSelectionData.select=!1,this.options.eventData.push(oSelectedListObject.oSelectionData))},generateEvent:function(){this.options.eventData.length>0&&this.options.mapInstance.eventing.SelectionChange(this.options.eventData),this.resetEventData()},resetEventData:function(){this.options.eventData.length>0&&(this.options.eventData=[])},_applyHighlight:function(oLeafletObj,oFeature,sSubFeatureID,bSelected){var iIndex;if(oLeafletObj instanceof L.LayerGroup){var oItemList=oLeafletObj.getLayers();for(iIndex=0;iIndex<oItemList.length;iIndex++)this._applyHighlight(oItemList[iIndex],oFeature,sSubFeatureID,bSelected)}else"function"==typeof oLeafletObj.empSelect&&(emp.helpers.isEmptyString(sSubFeatureID)?bSelected&&!this.isSelected(oFeature,sSubFeatureID)?oLeafletObj.empSelect():bSelected||this.isSelected(oFeature,sSubFeatureID)||oLeafletObj.empDeselect():oLeafletObj&&oLeafletObj.options&&!emp.helpers.isEmptyString(oLeafletObj.options.sSubItemID)&&oLeafletObj.options.sSubItemID===sSubFeatureID&&(bSelected&&!this.isSelected(oFeature,sSubFeatureID)?oLeafletObj.empSelect():bSelected||this.isSelected(oFeature,sSubFeatureID)||oLeafletObj.empDeselect()))},applyHighlight2LeafletObject:function(oFeature,sSubFeatureID,bSelected){var oLeafletObj=oFeature.getLeafletObject();this._applyHighlight(oLeafletObj,oFeature,sSubFeatureID,bSelected)},_removeFeaturesEntries:function(oFeature){var oFeatureSelection,sCoreID=oFeature.getCoreId(),oKeyList=emp.helpers.associativeArray.getKeys(this.options.featureSelectedList);for(var iIndex in oKeyList)oFeatureSelection=this.options.featureSelectedList[oKeyList[iIndex]],oFeatureSelection.oSelectionData.coreId===sCoreID&&(oFeatureSelection.oSelectionData.select=!1,this.options.eventData.push(oFeatureSelection.oSelectionData),delete this.options.featureSelectedList[oKeyList[iIndex]],this.applyHighlight2LeafletObject(oFeatureSelection.oFeature,oFeatureSelection.oSelectionData.selectedId,!1))},removeFeature:function(oFeature){this._removeFeaturesEntries(oFeature),this.generateEvent()}};return publicInterface},leafLet.SelectionManager=L.Class.extend(leafLet.internalPrivateClass.SelectionManager()),leafLet.internalPrivateClass.empObject=function(){var publicInterface={initialize:function(args){L.FeatureGroup.prototype.initialize.call(this);var options={objectType:args.item.globalType,name:args.item.name,description:args.item.description,coreId:args.item.coreId||emp.helpers.id.newGUID(),parentCoreId:args.item.parentCoreId,parentId:args.item.parentId,instanceInterface:args.instanceInterface,oClusteredParent:void 0,objectChildren:{}};L.Util.setOptions(this,options)},destroy:function(){var oParent=this.getParentObject();this.clearChildren(),oParent&&oParent.removeChildObject(this),this.getEngineInstanceInterface().removeEmpObject(this)},clearChildren:function(){var aKeys=emp.helpers.associativeArray.getKeys(this.options.objectChildren);for(var sKey in aKeys){if(this.options.objectChildren[aKeys[sKey]].options.objectType===leafLet.typeLibrary.objectType.FEATURE&&this.options.objectChildren[aKeys[sKey]].isInEditMode()){var instanceInterface=this.getEngineInstanceInterface();instanceInterface.oCurrentEditor.cancelEdit(),instanceInterface.oCurrentEditor.destroy(),instanceInterface.bInEditMode=!1,instanceInterface.bInDrawMode=!1,instanceInterface.oCurrentEditor=void 0,instanceInterface.oEditTransaction.run(),instanceInterface.oEditTransaction=void 0}this.options.objectChildren[aKeys[sKey]].destroy(),this.removeChildObjectById(aKeys[sKey])}this.clearLayers()},getRootOverlay:function(){return this.getEngineInstanceInterface().rootOverlay},getEngineInstanceInterface:function(){return this.options.instanceInterface},getLeafletMap:function(){return this.getEngineInstanceInterface().leafletInstance},getEngObject:function(sCoreId){return this.getEngineInstanceInterface().mapEngObjectList[sCoreId]},getCoreId:function(){return this.options.coreId},getParentCoreId:function(){return this.options.parentCoreId},getOverlayId:function(){},getFeatureId:function(){},getParentId:function(){return this.options.parentId},getName:function(){return this.options.name},getDescription:function(){return this.options.description},setName:function(sValue){this.options.name=sValue},getObjectType:function(){return this.options.objectType},getChild:function(sCoreId){return this.options.objectChildren[sCoreId]},getChildList:function(){return this.options.objectChildren},getChildKeyList:function(){return emp.helpers.associativeArray.getKeys(this.options.objectChildren)},getParentObject:function(){var oParent=this.getEngObject(this.getParentCoreId());return oParent||(oParent=this.getRootOverlay()),oParent},getClusteredOverlay:function(){var oParent,oOverlay=void 0;switch(this.getObjectType()){case leafLet.typeLibrary.objectType.FEATURE:case leafLet.typeLibrary.objectType.WMS:oParent=this.getEngObject(this.getParentCoreId()),oParent&&(oOverlay=oParent.getClusteredOverlay());break;case leafLet.typeLibrary.objectType.OVERLAY:this.isCurrentlyClustered()?oOverlay=this:(oParent=this.getEngObject(this.getParentCoreId()),oParent&&(oOverlay=oParent.getClusteredOverlay()))}return oOverlay},deactivateParentCluster:function(){var oParent=this.getParentObject();oParent&&(this.options.oClusteredParent=oParent.getClusteredOverlay(),this.options.oClusteredParent&&this.options.oClusteredParent.clusterDeactivate())},activateParentCluster:function(){this.options.oClusteredParent&&(this.options.oClusteredParent.clusterActivate(),this.options.oClusteredParent=void 0)},addChildObject:function(oChild){if(void 0===this.options.objectChildren[oChild.getCoreId()]){this.options.objectChildren[oChild.getCoreId()]=oChild,this.addLayer(oChild);var oClusteredOverlay=this.getClusteredOverlay();oClusteredOverlay&&oClusteredOverlay.getClusterObject().addLayer(oChild)}},removeChildObject:function(oFeature){this.removeChildObjectById(oFeature.getCoreId())},removeChildObjectById:function(sCoreId){var oChild=this.getChild(sCoreId);if(void 0!==oChild){this.hasLayer(oChild)&&this.removeLayer(oChild),delete this.options.objectChildren[sCoreId];var oClusteredOverlay=this.getClusteredOverlay();oClusteredOverlay&&oClusteredOverlay.getClusterObject().removeLayer(oChild)}},hasChildren:function(){return!emp.helpers.associativeArray.isEmpty(this.options.objectChildren)}};return publicInterface},leafLet.typeLibrary.empObject=L.FeatureGroup.extend(leafLet.internalPrivateClass.empObject()),leafLet.internalPrivateClass.DisplayableObject=function(){var publicInterface={initialize:function(args){var options={visible:args.item.visible,leafletObject:void 0};L.Util.setOptions(this,options),leafLet.typeLibrary.empObject.prototype.initialize.call(this,args)},destroy:function(){var oLeafletObject=this.getLeafletObject();void 0!==oLeafletObject&&("function"==typeof oLeafletObject.closePopup&&oLeafletObject.closePopup(),this.hasLayer(oLeafletObject)&&this.removeLayer(oLeafletObject),this.options.leafletObject=void 0),leafLet.typeLibrary.empObject.prototype.destroy.call(this)},getLeafletObject:function(){return this.options.leafletObject;
},isVisible:function(){return this.options.visible},setVisibility:function(oItem){if(this.options.visible=oItem.visible,void 0!==this.getLeafletObject())if(oItem.visible&&!this.hasLayer(this.getLeafletObject())){var oMapBounds=this.getLeafletMap().getBounds();this._updateLeafletObject(oMapBounds,this.getLeafletObject(),!1),this.addLayer(this.getLeafletObject())}else!oItem.visible&&this.hasLayer(this.getLeafletObject())&&this.removeLayer(this.getLeafletObject())},setStyle:function(sType,oProperties){var oChild,aKeyList=this.getChildKeyList();this.getObjectType()===leafLet.typeLibrary.objectType.FEATURE&&this.setFeatureStyle(sType,oProperties);for(var iIndex=0;iIndex<aKeyList.length;iIndex++)switch(oChild=this.getChild(aKeyList[iIndex]),oChild.getObjectType()){case leafLet.typeLibrary.objectType.FEATURE:case leafLet.typeLibrary.objectType.OVERLAY:oChild.setStyle(sType,oProperties);break;case leafLet.typeLibrary.objectType.WMS:}}};return publicInterface},leafLet.typeLibrary.DisplayableObject=leafLet.typeLibrary.empObject.extend(leafLet.internalPrivateClass.DisplayableObject()),leafLet.internalPrivateClass.EmpClusterGroup=function(){var publicInterface={initialize:function(args){var options={oOverlay:args.overlay,instanceInterface:args.instanceInterface};L.Util.setOptions(this,options);var oClusterDef=args.overlay.getClusterDef(),oThis=this;L.MarkerClusterGroup.prototype.initialize.call(this,{maxClusterRadius:oClusterDef.getDistance(),zoomToBoundsOnClick:!1,iconCreateFunction:function(oCluster){return oThis._iconCreateFunction(oCluster)}})},getOverlay:function(){return this.options.oOverlay},_ParamReplacementCB:function(oCluster,sParam){var sRet="",oOverlay=this.getOverlay(),oClusterDef=oOverlay.getClusterDef();switch(sParam.toLowerCase()){case"count":sRet=oCluster.getChildCount().toString();break;case"name":sRet=oOverlay.getName()||"";break;case"description":sRet=oOverlay.getDescription()||"";break;case"featurenames":for(var oFeatureList=oCluster.getAllChildMarkers(),iIndex=0;iIndex<oFeatureList.length;iIndex++)"function"==typeof oFeatureList[iIndex].getName&&(sRet+=oFeatureList[iIndex].getName(),sRet+="<br/>");break;case"maxclusterradius":sRet=oClusterDef.getDistance()+"m";break;case"styletype":var oClusterStyle=oClusterDef.getClusterStyle();oClusterStyle.getIconStyle()?sRet="Icon Style":oClusterStyle.getPointStyle()&&(sRet="Point Style")}return sRet},_setClusterHeadingText:function(oCluster){var oThis=this,sPopupText="",oOverlay=this.getOverlay(),oClusterDef=oOverlay.getClusterDef(),oClusterStyle=oClusterDef.getClusterStyle(),sTitle=emp.helpers.getReplacementString(oClusterStyle.getTitle(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)});sTitle.length>0&&(sPopupText+=sTitle),oCluster.setPopupHeading(sPopupText)},_setClusterPopupText:function(oCluster){var oThis=this,sPopupText="",oOverlay=this.getOverlay(),oClusterDef=oOverlay.getClusterDef(),oClusterStyle=oClusterDef.getClusterStyle(),sSummary=emp.helpers.getReplacementString(oClusterStyle.getSummary(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)}),sDescription=emp.helpers.getReplacementString(oClusterStyle.getDescription(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)});sSummary.length>0&&(sPopupText+=sSummary+"<br/>"),sDescription.length>0&&(sPopupText+=sDescription+"<br/>"),oCluster.setPopupText(sPopupText)},_iconCreateFunction:function(oCluster){var oClusterIcon,oThis=this,oOverlay=this.getOverlay(),oClusterDef=oOverlay.getClusterDef(),oClusterStyle=oClusterDef.getClusterStyle(),oIconStyle=oClusterStyle.getIconStyle(),oPointStyle=oClusterStyle.getPointStyle();if(oCluster.options.overlay=oOverlay,oIconStyle){var sStr=emp.helpers.getReplacementString(oClusterStyle.getLabel(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)}),sURL=emp.helpers.getReplacementString(oIconStyle.getURL(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)});oClusterIcon=sStr&&sStr.length>0?new L.DivIcon({className:"iconStyleDiv",html:"<table><tbody><tr><td><img class='iconStyleDivIcon' src='"+sURL+"'></td><td class='iconStyleDivLabel'>"+sStr+"</td></tr></tbody></table>"}):new L.Icon({url:sURL})}else if(oPointStyle){var sStr=emp.helpers.getReplacementString(oClusterStyle.getLabel(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)}),sLabel=sStr.replace(" ","\n"),oImage=oPointStyle.createIcon(sLabel),iRadius=oPointStyle.getRadius();oClusterIcon=new L.Icon({iconUrl:oImage.toDataURL(),iconAnchor:new L.Point(iRadius,iRadius),iconSize:new L.Point(oImage.width,oImage.height),popupAnchor:new L.Point(iRadius,0)})}else{var sStr=emp.helpers.getReplacementString(oClusterStyle.getLabel(),function(sParam){return oThis._ParamReplacementCB(oCluster,sParam)}),sLabel=sStr.replace(" ","\n"),iRadius=25,oImage=emp.helpers.createCircleCanvas({iRadius:iRadius,dOpacity:1,sStrokeColor:"darkBlue",sFillColor:"lightblue",sTextColor:"black",sText:sLabel});oClusterIcon=new L.Icon({iconUrl:oImage.toDataURL(),iconAnchor:new L.Point(iRadius/2,iRadius/2),iconSize:new L.Point(oImage.width,oImage.height),popupAnchor:new L.Point(iRadius,0)})}return this._setClusterPopupText(oCluster),this._setClusterHeadingText(oCluster),oCluster.on("click",function(oEvent){oThis.getEngineInstanceInterface()&&oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent)},this),oCluster.on("contextmenu",function(oEvent){oThis.getEngineInstanceInterface()&&oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent)},this),oClusterIcon},addLayer:function(layer){if(layer instanceof leafLet.typeLibrary.Feature){var oChild,oKeyList=layer.getChildKeyList();if((layer.getFormat()!==emp.typeLibrary.featureFormatType.MILSTD||!layer.isMultiPointTG())&&layer.getLeafletObject()){var oThis=this,oLeafletObject=layer.getLeafletObject();layer.removeLayer(oLeafletObject),this.addLayer(oLeafletObject),oLeafletObject.on("click",function(oEvent){oThis.getEngineInstanceInterface()&&(oEvent.target=layer,oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent))},this),oLeafletObject.on("contextmenu",function(oEvent){oThis.getEngineInstanceInterface()&&(oEvent.target=layer,oThis.getEngineInstanceInterface().handleFeatureClicked(oEvent))},this)}if(layer.hasChildren())for(var iIndex=0;iIndex<oKeyList.length;iIndex++)oChild=layer.getChild(oKeyList[iIndex]),this.addLayer(oChild);return this}if(layer instanceof L.LayerGroup){for(var i in layer._layers)this.addLayer(layer._layers[i]);return this}if(!layer.getLatLng)return this._nonPointGroup.addLayer(layer),this;if(!this._map)return this._needsClustering.push(layer),this;if(this.hasLayer(layer))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(layer,this._maxZoom);var visibleLayer=layer,currentZoom=this._map.getZoom();if(layer.__parent)for(;visibleLayer.__parent._zoom>=currentZoom;)visibleLayer=visibleLayer.__parent;return this._currentShownBounds.contains(visibleLayer.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(layer,visibleLayer):this._animationAddLayerNonAnimated(layer,visibleLayer)),this},removeLayer:function(layer){if(layer instanceof leafLet.typeLibrary.Feature){var oChild,oKeyList=layer.getChildKeyList();if((layer.getFormat()!==emp.typeLibrary.featureFormatType.MILSTD||!layer.isMultiPointTG())&&layer.getLeafletObject()){var oLeafletObject=layer.getLeafletObject();this.removeLayer(oLeafletObject),layer.addLayer(oLeafletObject),oLeafletObject.off("click",function(oEvent){},this),oLeafletObject.off("contextmenu",function(oEvent){},this)}if(layer.hasChildren())for(var iIndex=0;iIndex<oKeyList.length;iIndex++)oChild=layer.getChild(oKeyList[iIndex]),this.removeLayer(oChild);return this}if(layer instanceof L.LayerGroup){for(var i in layer._layers)this.removeLayer(layer._layers[i]);return this}return layer.getLatLng?this._map?layer.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(layer)),this._removeLayer(layer,!0),this._featureGroup.hasLayer(layer)&&(this._featureGroup.removeLayer(layer),layer.clusterShow&&layer.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,layer)&&this.hasLayer(layer)&&this._needsRemoving.push(layer),this):(this._nonPointGroup.removeLayer(layer),this)}};return publicInterface},leafLet.typeLibrary.EmpClusterGroup=L.MarkerClusterGroup.extend(leafLet.internalPrivateClass.EmpClusterGroup()),leafLet.internalPrivateClass.Overlay=function(){var publicInterface={initialize:function(args){var options={overlayId:args.item.overlayId,oProperties:args.item.properties,oClusterDef:args.item.properties.cluster?new emp.typeLibrary.Overlay.Cluster(args.item.properties.cluster):void 0,bClusterActive:args.item.properties.bClusterActive===!0||!1,oLeafletClusterObject:void 0};L.Util.setOptions(this,options),leafLet.typeLibrary.DisplayableObject.prototype.initialize.call(this,args)},destroy:function(){this.hasClusterDef()&&this.clusterRemove(),leafLet.typeLibrary.DisplayableObject.prototype.destroy.call(this)},getOverlayId:function(){return this.options.overlayId},getDescription:function(){return this.options.oProperties.hasOwnProperty("description")?this.options.oProperties.description:""},hasFeatures:function(){for(var sCoreId in this.options.objectChildren)if(this.options.objectChildren.hasOwnProperty(sCoreId)){var oChild=this.options.objectChildren[sCoreId];switch(oChild.getObjectType()){case leafLet.typeLibrary.objectType.FEATURE:return!0}if(oChild.hasFeatures())return!0}return!1},getFeatureBounds:function(){var oChildBounds,oBounds=void 0,oChildList=this.getChildList();if(this.hasChildren())for(var sKeys=emp.helpers.associativeArray.getKeys(oChildList),iIndex=0;iIndex<sKeys.length;iIndex++)oChildBounds=oChildList[sKeys[iIndex]].getFeatureBounds(),oChildBounds&&(oBounds?(oBounds.addCoordinate(oChildBounds.getSouthWest()),oBounds.addCoordinate(oChildBounds.getNorthEast())):oBounds=new leafLet.typeLibrary.EmpBoundary(oChildBounds.getSouthWest(),oChildBounds.getNorthEast()));return oBounds},_setClusterDef:function(oClusterDef){if(!(oClusterDef instanceof emp.typeLibrary.Overlay.Cluster))throw new Error("Invalid overlay cluster object.");this.options.oClusterDef=new emp.typeLibrary.Overlay.Cluster(oClusterDef)},getClusterObject:function(){return this.options.oLeafletClusterObject},setName:function(sValue){leafLet.typeLibrary.DisplayableObject.prototype.setName.call(this,sValue),this.isCurrentlyClustered()&&(this.clusterDeactivate(),this.clusterActivate())},isCurrentlyClustered:function(){return this.hasClusterDef()&&this.isClusterActive()},hasClusterDef:function(){return this.options.oClusterDef instanceof emp.typeLibrary.Overlay.Cluster},getClusterDef:function(){return this.options.oClusterDef},isClusterActive:function(){return this.options.bClusterActive},activateCluster:function(){this.options.bClusterActive=!1,this.clusterActivate()},clusterSet:function(oClusterDef){this.hasClusterDef()&&this.clusterRemove(),this._setClusterDef(oClusterDef),this.clusterActivate()},_doClusterActivate:function(){var oChild,oKeyList=this.getChildKeyList();this.options.oLeafletClusterObject=new leafLet.typeLibrary.EmpClusterGroup({overlay:this,instanceInterface:this.getEngineInstanceInterface()}),this.getLeafletMap().addLayer(this.getClusterObject());for(var iIndex=0;iIndex<oKeyList.length;iIndex++)oChild=this.getChild(oKeyList[iIndex]),oChild instanceof leafLet.typeLibrary.Overlay&&oChild.isCurrentlyClustered()||this.getClusterObject().addLayer(oChild)},clusterActivate:function(){this.hasClusterDef()&&!this.isClusterActive()&&(this.deactivateParentCluster(),this._doClusterActivate(),this.options.bClusterActive=!0,this.activateParentCluster())},clusterDeactivate:function(){if(this.hasClusterDef()&&this.isClusterActive()){var oChild,oKeyList=this.getChildKeyList();this.deactivateParentCluster();for(var iIndex=0;iIndex<oKeyList.length;iIndex++)oChild=this.getChild(oKeyList[iIndex]),oChild instanceof leafLet.typeLibrary.Overlay&&oChild.isCurrentlyClustered()||this.getClusterObject().removeLayer(oChild);this.getLeafletMap().removeLayer(this.getClusterObject()),this.options.oLeafletClusterObject=void 0,this.options.bClusterActive=!1,this.activateParentCluster()}},clusterRemove:function(){this.hasClusterDef()&&(this.clusterDeactivate(),this.options.oClusterDef=void 0,this.options.bClusterActive=!1)}};return publicInterface},leafLet.typeLibrary.Overlay=leafLet.typeLibrary.DisplayableObject.extend(leafLet.internalPrivateClass.Overlay()),leafLet.internalPrivateClass.Feature=function(){var publicInterface={initialize:function(args){var options={objectType:leafLet.typeLibrary.objectType.FEATURE,featureId:args.item.featureId,overlayId:args.item.overlayId,parentId:args.item.parentId,format:args.item.format,url:args.item.url,data:args.item.data?emp.helpers.copyObject(args.item.data):void 0,properties:args.item.properties?emp.helpers.copyObject(args.item.properties):{},azimuth:args.item.properties&&args.item.properties.azimuth?args.item.properties.azimuth:0,labelStyle:args.item.properties&&args.item.properties.labelStyle?args.item.properties.labelStyle:args.instanceInterface.defaultLabelStyle,selected:!1,bEditable:!0,isEditMode:!1,originalStyle:{}};L.Util.setOptions(this,options),leafLet.typeLibrary.DisplayableObject.prototype.initialize.call(this,args),this.setLeafletObject(this._createFeature(this.options)),this.on("click",function(oEvent){oEvent.target.getEngineInstanceInterface()&&oEvent.target.getEngineInstanceInterface().handleFeatureClicked(oEvent)},this),this.on("mousedown",function(oEvent){oEvent.target.getEngineInstanceInterface()&&oEvent.target.getEngineInstanceInterface().handleFeatureClicked(oEvent)},this),this.on("mouseup",function(oEvent){oEvent.target.getEngineInstanceInterface()&&oEvent.target.getEngineInstanceInterface().handleFeatureClicked(oEvent)},this),this.on("contextmenu",function(oEvent){oEvent.target.getEngineInstanceInterface()&&oEvent.target.getEngineInstanceInterface().handleFeatureClicked(oEvent)},this)},destroy:function(){this.getEngineInstanceInterface().oSelectionManager.removeFeature(this),leafLet.typeLibrary.DisplayableObject.prototype.destroy.call(this)},getAzimuth:function(){return this.options.azimuth},getLabelStyle:function(){return this.options.labelStyle},isInEditMode:function(){return this.options.isEditMode},setEditMode:function(){this.options.isEditMode=!0,this.isSelected()&&this.render()},resetEditMode:function(){this.options.isEditMode=!1,this.isSelected()&&this.render()},setLeafletObject:function(oObject){if(this.options.leafletObject&&this.options.leafletObject!==oObject&&this.removeLayer(this.options.leafletObject),this.isVisible()&&oObject){var oMapBounds=this.getLeafletMap().getBounds();this._updateLeafletObject(oMapBounds,oObject,!1),oObject&&this.options.leafletObject!==oObject&&this.addLayer(oObject)}this.options.leafletObject=oObject},getOverlayId:function(){return this.options.overlayId},getFeatureId:function(){return this.options.featureId},getParentId:function(){return this.options.parentId},getData:function(){return this.options.data},setData:function(oData){this.options.data=oData},getProperties:function(){return this.options.properties},setProperties:function(oProp){this.options.properties=oProp},getFormat:function(){return this.options.format},isEditable:function(){return this.options.bEditable},isSelected:function(sSubItemID){var oSelectionManager=this.getEngineInstanceInterface().oSelectionManager;return oSelectionManager.isSelected(this,sSubItemID)},isMilStd:function(){return this.options.format===emp.typeLibrary.featureFormatType.MILSTD},isGeoJson:function(){return this.options.format===emp.typeLibrary.featureFormatType.GEOJSON},isKML:function(){return this.options.format===emp.typeLibrary.featureFormatType.KML},isAirspace:function(){return this.options.format===emp.typeLibrary.featureFormatType.AIRSPACE},isImage:function(){return this.options.format===emp.typeLibrary.featureFormatType.IMAGE},isAOI:function(){return this instanceof leafLet.typeLibrary.AOIFeature},isGeoEllipse:function(){return this instanceof leafLet.typeLibrary.GeoEllipseFeature},getFeatureBounds:function(){var oBounds=void 0,oLeafletObject=this.getLeafletObject();if(oLeafletObject)if("function"==typeof oLeafletObject.getBounds)oBounds=new leafLet.typeLibrary.EmpBoundary(oLeafletObject.getBounds());else{if(!(oLeafletObject instanceof L.Marker))throw new Error("Unable to get bounds of leaflet type.");oBounds=new leafLet.typeLibrary.EmpBoundary(oLeafletObject.getLatLng().wrap(),oLeafletObject.getLatLng().wrap())}return oBounds},_createFeature:function(args){throw new Error("Class for feature of type "+args.format+" has not implemented a _createFeature function.")},getAngleUnits:function(){return leafLet.utils.AngleUnits.DEGREES},getAzimuthUnits:function(){return leafLet.utils.AngleUnits.DEGREES},getAltitudeUnits:function(){var sText=leafLet.utils.Units.FEET;switch(this.options.format){case emp.typeLibrary.featureFormatType.GEOJSON:case emp.typeLibrary.featureFormatType.AIRSPACE:sText=leafLet.utils.Units.METERS;break;case emp.typeLibrary.featureFormatType.MILSTD:sText=0===this.options.oMilStdModifiers.SYMSTD?leafLet.utils.Units.FEET:leafLet.utils.Units.METERS;break;case emp.typeLibrary.featureFormatType.KML:case emp.typeLibrary.featureFormatType.IMAGE:break;default:sText=leafLet.utils.Units.METERS}return sText},getUnits:function(){return leafLet.utils.Units.FEET},getAltitudeModeAbbr:function(){return leafLet.utils.AltitudeModeAbbr(this.options.properties.altitudeMode)},_getAltUnitsAndModeText:function(){var sText=this.getAltitudeUnits(),aAltMode=this.getAltitudeModeAbbr();return 0===sText.length?"":(aAltMode.length>0&&(sText+=" "+aAltMode),sText)},_getPopupDescription:function(){var sDescription=this.options.properties.description;return sDescription&&""!==sDescription||(sDescription=""),sDescription},getPopupHeading:function(){return this.options.name&&"string"==typeof this.options.name&&""!==this.options.name?this.options.name:""},getPopupText:function(){return this._getPopupDescription()},updateFeature:function(args){var oNewLeafletObject,oArgs={},oCoreFeature=args||{};if(args.hasOwnProperty("bUpdateGraphic")&&(oArgs.bUpdateGraphic=args.bUpdateGraphic),oCoreFeature.hasOwnProperty("format")&&oCoreFeature.format!==this.options.format)throw new Error("A "+this.options.format+" feature can not be updated to a "+oCoreFeature.format+".");oCoreFeature.hasOwnProperty("name")&&oCoreFeature.name!==this.options.name?oArgs.name=oCoreFeature.name:oArgs.name=this.options.name,oCoreFeature.hasOwnProperty("url")&&oCoreFeature.url!==this.options.url?oArgs.url=oCoreFeature.url:oArgs.url=this.options.url,oCoreFeature.hasOwnProperty("data")?oArgs.data=emp.helpers.copyObject(oCoreFeature.data):oArgs.data=this.options.data,oCoreFeature.hasOwnProperty("properties")?(oArgs.properties=emp.helpers.copyObject(oCoreFeature.properties),oArgs.properties.lineColor!==this.getProperties().lineColor?oArgs.bUpdateGraphic=!0:oArgs.properties.fillColor!==this.getProperties().fillColor&&(oArgs.bUpdateGraphic=!0)):oArgs.properties=this.options.properties,oArgs.leafletObject=this.options.leafletObject,oArgs.bEditable=this.options.bEditable,oNewLeafletObject=this._updateFeature(oArgs),this.setLeafletObject(oNewLeafletObject),this.options.url=oArgs.url,this.options.data=oArgs.data,this.options.properties=oArgs.properties,this.options.bEditable=oArgs.bEditable,oCoreFeature.hasOwnProperty("name")&&oCoreFeature.name!==this.options.name&&this.setName(oArgs.name)},setSelection:function(bValue){bValue!==this.options.selected&&(this.options.selected=bValue,this.isInEditMode()||this.render())},render:function(){},_updateLeafletObject:function(oMapBounds,oLeafletObject,bWrappedAlready,iLevel){var oLatLngList,iList,bCoordWrapped=bWrappedAlready,iCurrentLevel=iLevel||0;if(!oLeafletObject)return bCoordWrapped;if(oLeafletObject instanceof L.Marker||oLeafletObject instanceof L.Popup)oLeafletObject.getLatLng()&&(oLatLngList=[oLeafletObject.getLatLng()],bCoordWrapped=leafLet.utils.wrapCoordinates(oMapBounds,oLatLngList,bCoordWrapped),oLeafletObject.setLatLng(oLatLngList[0]));else if(oLeafletObject instanceof L.Polygon){if(oLatLngList=oLeafletObject.getLatLngs(),oLatLngList.length>0)for(iList=0;iList<oLatLngList.length;iList+=1)bCoordWrapped=bCoordWrapped||leafLet.utils.wrapCoordinates(oMapBounds,oLatLngList[iList],bCoordWrapped);bCoordWrapped&&oLeafletObject.setLatLngs(oLatLngList)}else if(oLeafletObject instanceof L.Polyline){if(oLatLngList=oLeafletObject.getLatLngs(),oLatLngList.length>0)if(L.Util.isArray(oLatLngList[0])&&oLatLngList[0].length>0)for(iList=0;iList<oLatLngList.length;iList+=1)bCoordWrapped=bCoordWrapped||leafLet.utils.wrapCoordinates(oMapBounds,oLatLngList[iList],bCoordWrapped);else bCoordWrapped=bCoordWrapped||leafLet.utils.wrapCoordinates(oMapBounds,oLatLngList,bCoordWrapped);bCoordWrapped&&oLeafletObject.setLatLngs(oLatLngList)}else if(oLeafletObject instanceof L.LayerGroup)for(var oItemList=oLeafletObject.getLayers(),bHasNotWrapped=!bCoordWrapped,iIndex=0;iIndex<oItemList.length;iIndex++)if(bCoordWrapped=this._updateLeafletObject(oMapBounds,oItemList[iIndex],bCoordWrapped,iCurrentLevel+1),bCoordWrapped&&bHasNotWrapped){if(bHasNotWrapped=!1,0!==iCurrentLevel)break;iIndex=-1}return bCoordWrapped},updateCoordinates:function(oMapBounds){this.isVisible()&&this._updateLeafletObject(oMapBounds,this.getLeafletObject(),!1)},getLineStyle:function(sEMPStyle){var sLeaftletStyle;switch(sEMPStyle){case emp.typeLibrary.OutlineStyleType.DOT:sLeaftletStyle="1, 5";break;case emp.typeLibrary.OutlineStyleType.DASH:sLeaftletStyle="10, 5";break;case emp.typeLibrary.OutlineStyleType.DASH_DOT:sLeaftletStyle="10, 5, 1, 5";break;case emp.typeLibrary.OutlineStyleType.LONG_DASH:sLeaftletStyle="20, 5";break;case emp.typeLibrary.OutlineStyleType.LONG_DASH_DOT:sLeaftletStyle="20, 5, 1, 5";break;case emp.typeLibrary.OutlineStyleType.SOLID:}return sLeaftletStyle},setFeatureStyle:function(sType,oProperties){switch(this.getFormat()){case emp.typeLibrary.featureFormatType.KML:case emp.typeLibrary.featureFormatType.GEOJSON:this.setFeatureStyleProperties(sType,oProperties)}},_propagateEvent:function(e){e.target instanceof leafLet.typeLibrary.Feature||(e=L.extend({layer:e.target,target:this},e),this.fire(e.type,e))},_getPolygonProperties:function(args){var argsProperties=leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(),args.properties),oProperties={smoothFactor:1,noClip:!1,oFeature:this},strokeColor=argsProperties.color?argsProperties.color:void 0,fillColor=argsProperties.fillColor?argsProperties.fillColor:void 0;return void 0===strokeColor&&void 0===fillColor&&(strokeColor="#"+this.getEngineInstanceInterface().defaultStrokeStyle.color),strokeColor?(oProperties.stroke=!0,oProperties.color=strokeColor,oProperties.opacity=argsProperties.opacity?argsProperties.opacity:this.getEngineInstanceInterface().defaultStrokeStyle.opacity,oProperties.weight=argsProperties.weight?argsProperties.weight:this.getEngineInstanceInterface().defaultStrokeStyle.width):(oProperties.stroke=!1,oProperties.color=null),this.isSelected()&&(oProperties.tempColor=oProperties.color,oProperties.tempWeight=oProperties.weight,oProperties.color="#"+this.getEngineInstanceInterface().selectAttributes.color,oProperties.weight=this.getEngineInstanceInterface().selectAttributes.width,oProperties.stroke=!0),fillColor?(oProperties.fill=!0,oProperties.fillColor=fillColor,oProperties.fillOpacity=argsProperties.fillOpacity?argsProperties.fillOpacity:.8):oProperties.fill=!1,oProperties}};return publicInterface},leafLet.typeLibrary.Feature=leafLet.typeLibrary.DisplayableObject.extend(leafLet.internalPrivateClass.Feature()),leafLet.internalPrivateClass.WMS=function(){var publicInterface={initialize:function(args){leafLet.typeLibrary.DisplayableObject.prototype.initialize.call(this,args);var options={id:args.item.id,overlayId:args.item.overlayId,transparent:args.item.params.transparent,format:args.item.params.format,version:args.item.params.version,activeLayer:args.item.activeLayers?emp.helpers.copyObject(args.item.activeLayers):[],url:args.item.url,useProxy:args.item.useProxy};L.Util.setOptions(this,options),this.options.leafletObject=this.createWMS(this.options),this.options.leafletObject.wmsParams.hasOwnProperty("useProxy")&&delete this.options.leafletObject.wmsParams.useProxy,void 0!==this.options.leafletObject&&this.options.visible&&this.options.activeLayer.length>0&&this.getEngineInstanceInterface().addMapLayer(this.options.leafletObject)},destroy:function(){void 0!==this.options.leafletObject&&(this.getEngineInstanceInterface().removeMapLayer(this.options.leafletObject),this.options.leafletObject=void 0),leafLet.typeLibrary.DisplayableObject.prototype.destroy.call(this)},getOverlayId:function(){return this.options.overlayId},getId:function(){return this.options.id},createWMS:function(args){var oWMS=void 0;return oWMS=new L.TileLayer.WMS(args.url,{layers:args.activeLayer.join(","),format:args.format,transparent:args.transparent,version:args.version,useProxy:args.useProxy})},updateWMS:function(args){var options={id:args.id,overlayId:args.overlayId,transparent:args.params.transparent,format:args.params.format,version:args.params.version,activeLayer:args.activeLayers?emp.helpers.copyObject(args.activeLayers):[],url:args.url,useProxy:args.useProxy},oWMS=this.createWMS(options);this.hasLayer(this.options.leafletObject)&&this.getEngineInstanceInterface().removeMapLayer(this.options.leafletObject),this.options.leafletObject=oWMS,this.options.visible&&this.getEngineInstanceInterface().addMapLayer(this.options.leafletObject)},setVisibility:function(oItem){this.options.activeLayer=oItem.activeLayers?emp.helpers.copyObject(oItem.activeLayers):[],void 0!==this.options.leafletObject&&(oItem.visible?(this.options.visible=!0,this.options.leafletObject.setParams({layers:this.options.activeLayer.join(",")}),this.getEngineInstanceInterface().addMapLayer(this.options.leafletObject)):oItem.visible||0!==this.options.activeLayer.length?this.options.leafletObject.setParams({layers:this.options.activeLayer.join(",")}):(this.options.visible=!1,this.getEngineInstanceInterface().removeMapLayer(this.options.leafletObject)))}};return publicInterface},leafLet.typeLibrary.WMS=leafLet.typeLibrary.DisplayableObject.extend(leafLet.internalPrivateClass.WMS()),leafLet.typeLibrary.EmpBoundary=function(oSouthWest,oNorthEast){var degNorth=void 0,degSouth=void 0,degWest=void 0,degEast=void 0;this.initialize=function(oSW,oNE){var index;if(void 0===oSW)throw new Error("Invalid oSouthWest parameters.");if(void 0===oNE)if(oSW instanceof L.LatLngBounds){if(!oSW.getSouthWest()||!oSW.getNorthEast())throw new Error("Invalid type oSouthWest.");oNE=oSW.getNorthEast(),oSW=oSW.getSouthWest()}else{if(oSW instanceof Array){if(oSW.length<2)throw new Error("Invalid type oSouthWest.");for(index=0;index<oSW.length;index++)publicInterface.addCoordinate(oSW[index]);return}if(!(oSW instanceof L.LatLng))throw new Error("Invalid type oSouthWest.");oNE=oSW}oNE=oNE.wrap(),oSW=oSW.wrap(),degNorth=oNE.lat,degEast=oNE.lng,degSouth=oSW.lat,degWest=oSW.lng};var publicInterface={addCoordinate:function(oCoord){var oCoordinate=oCoord.wrap();if(degNorth){oCoordinate.lat>degNorth?degNorth=oCoordinate.lat:oCoordinate.lat<degSouth&&(degSouth=oCoordinate.lat);var degSE2Coord=emp.geoLibrary.GetAzimuth({x:degEast,y:degSouth},{x:oCoordinate.lng,y:oCoordinate.lat});if(degWest<=degEast)if(degSE2Coord>=0)degEast=oCoordinate.lng;else{var degSW2Coord=emp.geoLibrary.GetAzimuth({x:degWest,y:degSouth},{x:oCoordinate.lng,y:oCoordinate.lat});degSW2Coord<0&&(degWest=oCoordinate.lng)}else if(degSE2Coord<=0)degEast=oCoordinate.lng;else{var degSW2Coord=emp.geoLibrary.GetAzimuth({x:degWest,y:degSouth},{x:oCoordinate.lng,y:oCoordinate.lat});degSW2Coord>0&&(degWest=oCoordinate.lng)}}else degNorth=oCoordinate.lat,degSouth=oCoordinate.lat,degWest=oCoordinate.lng,degEast=oCoordinate.lng},getNorth:function(){return degNorth},getSouth:function(){return degSouth},getWest:function(){return degWest},getEast:function(){return degEast},getCenter:function(){var lat=(degNorth+degSouth)/2,lng=(degEast+degWest)/2;return degWest>degEast&&(lng>0?lng-=180:lng+=180),new L.LatLng(lat,lng)},getCenterWest:function(){var dCenterLat=(degNorth+degSouth)/2;return new L.LatLng(dCenterLat,degWest)},getCenterEast:function(){var dCenterLat=(degNorth+degSouth)/2;return new L.LatLng(dCenterLat,degEast)},getSouthWest:function(){return new L.LatLng(degSouth,degWest)},getNorthEast:function(){return new L.LatLng(degNorth,degEast)},getSouthEast:function(){return new L.LatLng(degSouth,degEast)},getNorthWest:function(){return new L.LatLng(degNorth,degWest)},containsCoordiante:function(oCoordinate){if(!degNorth)return!1;if(oCoordinate.lat>degNorth)return!1;if(oCoordinate.lat<degSouth)return!1;if(this.containsIDL()){if(degEast<oCoordinate.lng&&oCoordinate.lng<degWest)return!1}else if(degEast<oCoordinate.lng||oCoordinate.lng<degWest)return!1;return!0},contained:function(oBoundary){if(!degNorth||!oBoundary.getNorth())return!1;if(oBoundary.getNorth()>degNorth)return!1;if(oBoundary.getSouth()<degSouth)return!1;var degSE2Coord=emp.geoLibrary.GetAzimuth({x:degEast,y:degSouth},{x:oBoundary.getEast(),y:oBoundary.getNorth()});if(degWest<degEast){if(degSE2Coord>0)return!1;var degSW2Coord=emp.geoLibrary.GetAzimuth({x:degWest,y:degSouth},{x:oCoordinate.lng,y:oCoordinate.lat});if(degSW2Coord<0)return!1}else{if(degSE2Coord<0)return!1;var degSW2Coord=emp.geoLibrary.GetAzimuth({x:degWest,y:degSouth},{x:oCoordinate.lng,y:oCoordinate.lat});if(degSW2Coord>0)return!1}return!0},intersects:function(oBoundary){if(!degNorth||!oBoundary.getNorth())return!1;if(oBoundary.getNorth()<degSouth||oBoundary.getSouth()>degNorth)return!1;if(this.containsIDL()){var bounds=new leafLet.typeLibrary.EmpBoundary(this.getSouthWest(),new L.LatLng(degNorth,180));if(!oBoundary.intersects(bounds))return bounds=new leafLet.typeLibrary.EmpBoundary(new L.LatLng(degSouth,(-180)),this.getNorthEast()),oBoundary.intersects(bounds)}else if(oBoundary.containsIDL()){var bounds=new leafLet.typeLibrary.EmpBoundary(oBoundary.getSouthWest(),new L.LatLng(oBoundary.getNorth(),180));if(!this.intersects(bounds))return bounds=new leafLet.typeLibrary.EmpBoundary(new L.LatLng(oBoundary.getSouth(),(-180)),oBoundary.getNorthEast()),this.intersects(bounds)}else{var oSouthWest=this.getSouthWest(),oBNorthEast=oBoundary.getNorthEast(),dBrng=oSouthWest.bearingTo(oBNorthEast);if(dBrng<0||dBrng>90)return!1;var oSouthEast=this.getSouthEast(),oBNorthWest=oBoundary.getNorthWest();if(dBrng=oSouthEast.bearingTo(oBNorthWest),dBrng<270)return!1}return!0},isEmpty:function(){return!(degNorth&&degSouth&&degWest&&degEast)},getCenterWidth:function(){var oCenterWest=this.getCenterWest(),oCenterEast=this.getCenterEast();return oCenterWest.distanceTo(oCenterEast)},setCenterWidth:function(dWidth){var oCenter=this.getCenter(),oNewWestCoord=oCenter.destinationPoint(-90,dWidth/2),oNewEastCoord=oCenter.destinationPoint(90,dWidth/2);degWest=oNewWestCoord.lng,degEast=oNewEastCoord.lng},containsIDL:function(){return degWest>degEast}};return this.initialize(oSouthWest,oNorthEast),publicInterface},leafLet.internalPrivateClass.MilStdFeature=function(){var publicInterface={initialize:function(args){var options={oMilStdModifiers:{},sBasicSymbolCode:void 0,i2525Version:0,bIsMultiPointTG:!1};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},getMilStdModifiers:function(){return this.options.oMilStdModifiers},getBasicSymbolCode:function(){return this.options.sBasicSymbolCode},getAzimuthUnits:function(){var sUnits=leafLet.utils.AngleUnits.DEGREES,RendererSettings=armyc2.c2sd.renderer.utilities.RendererSettings,oBasicSymbolCode=leafLet.utils.milstd.basicSymbolCode;switch(this.getBasicSymbolCode()){case oBasicSymbolCode.RECTANGULAR_TARGET:switch(this.get2525Version()){case RendererSettings.Symbology_2525Bch2_USAS_13_14:sUnits=leafLet.utils.AngleUnits.MILS;break;case RendererSettings.Symbology_2525C:
sUnits=leafLet.utils.AngleUnits.DEGREES}}return sUnits},getAltitudeUnits:function(){var sRet=leafLet.utils.Units.FEET;return sRet},getUnits:function(){var retValue=leafLet.utils.Units.METERS,oBasicSymbolCode=(armyc2.c2sd.renderer.utilities.RendererSettings,leafLet.utils.milstd.basicSymbolCode);switch(this.getBasicSymbolCode()){case oBasicSymbolCode.RECTANGULAR_TARGET:}return retValue},getPopupHeading:function(){var sText=this.getName();if(!sText||"string"!=typeof sText||""===sText){var cMilStdModifiers=leafLet.utils.milstd.Modifiers,oModifiers=this.getMilStdModifiers();sText=oModifiers.hasOwnProperty(cMilStdModifiers.UNIQUE_DESIGNATOR_1)?oModifiers[cMilStdModifiers.UNIQUE_DESIGNATOR_1]:""}return sText},getPopupText:function(){var sPopupText="";if(this.options.leafletObject instanceof L.Marker){var oCoordList=this.getCoordinateList();sPopupText="<b>Symbol Code</b>:&nbsp;"+this.options.data.symbolCode+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<b>Lat</b>:&nbsp;"+oCoordList[0].lat.toFixed(5)+"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<b>Lon</b>:&nbsp;"+oCoordList[0].lng.toFixed(5)+(isNaN(oCoordList[0].alt)?"":"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<b>Alt</b>:&nbsp;"+oCoordList[0].alt+this._getAltUnitsAndModeText())+"<br/><br/>"+this._getPopupDescription()}else sPopupText="<b>Symbol Code</b>:&nbsp;"+this.options.data.symbolCode+"<br/><br/>"+this._getPopupDescription();return sPopupText},_createMultiPointFeature:function(args,oModifier,i2525Version){var leafletObject,sDescription=args.properties.description||"",oMapBounds=this.getEngineInstanceInterface().leafletInstance.getBounds(),oEmpMapBounds=new leafLet.typeLibrary.EmpBoundary(oMapBounds.getSouthWest(),oMapBounds.getNorthEast());return leafLet.utils.milstd.applyRequiredModifiers(args.data.symbolCode,oModifier,i2525Version,this.getEngineInstanceInterface().getLeafletMap()),leafletObject=leafLet.utils.milstd.renderMPGraphic({instanceInterface:this.getEngineInstanceInterface(),isSelected:args.selected,sID:args.coreId,sName:args.name,sDescription:sDescription,sSymbolCode:args.data.symbolCode,oCoordData:args.data,oModifiers:oModifier,i2525Version:i2525Version,oFeature:this,empMapBounds:oEmpMapBounds})},_createSinglePointFeature:function(oItem,oModifiers){var oFeature,oCoordinates=leafLet.utils.geoJson.convertCoordinatesToLatLng(oItem.data)[0],oMilStdIcon=this._getSinglePointIcon(oItem,oModifiers);return oFeature=new L.Marker(oCoordinates,{icon:oMilStdIcon,oFeature:this})},_modifierOnList:function(sModifier){return this.getEngineInstanceInterface().oLabelList.indexOf(sModifier)!==-1},_getSinglePointIcon:function(oItem,oMainModifiers){var sModifier,image,oMilStdIcon,oOffset,iconUrl,iconAnchor,iconSize,popupAnchor,oImageBounds,renderingOptimization,baseURL,sModifiers,svgColor,oModifierArray=[],oModifiers={},msa=armyc2.c2sd.renderer.utilities.MilStdAttributes;(!oMainModifiers.hasOwnProperty("T")||oMainModifiers.hasOwnProperty("T")&&oMainModifiers.T!==oItem.name)&&(oMainModifiers.CN=oItem.name);for(sModifier in oMainModifiers)if(oMainModifiers.hasOwnProperty(sModifier))switch(sModifier){case leafLet.utils.milstd.longModifiers.FILL_COLOR:L.Browser.canvas?oModifiers[msa.FillColor]="#"+oMainModifiers[sModifier]:oModifiers.fillcolor=oMainModifiers[sModifier];break;case leafLet.utils.milstd.longModifiers.LINE_COLOR:L.Browser.canvas?oModifiers[msa.LineColor]="#"+oMainModifiers[sModifier]:oModifiers.linecolor=oMainModifiers[sModifier];break;case leafLet.utils.milstd.Modifiers.STANDARD:oModifiers[sModifier]=oMainModifiers[sModifier];break;default:this._modifierOnList(sModifier)&&(oModifiers[sModifier]=oMainModifiers[sModifier])}if(oMainModifiers.SIZE=this.getEngineInstanceInterface().iMilStdIconSize,this.isSelected(),L.Browser.canvas){if(image=armyc2.c2sd.renderer.MilStdIconRenderer.Render(oItem.data.symbolCode,oMainModifiers),iconUrl=image.toDataUrl(),oOffset=image.getCenterPoint(),iconAnchor=new L.Point(oOffset.x,oOffset.y),popupAnchor=new L.Point(oOffset.x,oOffset.y),oImageBounds=image.getImageBounds(),iconSize=new L.Point(oImageBounds.width,oImageBounds.height),renderingOptimization=this.getEngineInstanceInterface().renderingOptimization,renderingOptimization.viewInZone)switch(renderingOptimization.viewInZone){case"farDistanceZone":switch(oItem.data.symbolCode.charAt(1)){case"H":case"S":case"J":case"K":svgColor=renderingOptimization.farDistanceThreshold.RED;break;case"F":case"D":case"A":case"M":svgColor=renderingOptimization.farDistanceThreshold.BLUE;break;case"N":case"L":svgColor=renderingOptimization.farDistanceThreshold.GREEN;break;case"U":case"P":case"G":case"W":svgColor=renderingOptimization.farDistanceThreshold.YELLOW;break;default:svgColor=renderingOptimization.farDistanceThreshold.YELLOW}image=renderingOptimization.farDistanceThreshold.getSVG({x:6,y:6,radius:5,color:svgColor}),iconUrl="data:image/svg+xml,"+image,iconAnchor=new L.Point(4,5),iconSize=new L.Point(12,12),popupAnchor=new L.Point(4,5);break;case"midDistanceZone":image=armyc2.c2sd.renderer.MilStdIconRenderer.Render(oItem.data.symbolCode,{SIZE:oMainModifiers.SIZE}),iconUrl=image.toDataUrl(),oOffset=image.getCenterPoint(),iconAnchor=new L.Point(oOffset.x,oOffset.y),popupAnchor=new L.Point(oOffset.x,oOffset.y),oImageBounds=image.getImageBounds(),iconSize=new L.Point(oImageBounds.width,oImageBounds.height)}return oMilStdIcon=new L.Icon({iconUrl:iconUrl,iconAnchor:iconAnchor,iconSize:iconSize,popupAnchor:popupAnchor})}sModifiers="";for(sModifier in oModifiers)oModifiers.hasOwnProperty(sModifier)&&oModifierArray.push(sModifier+"="+oModifiers[sModifier]);return oModifierArray.length>0&&(sModifiers="?"+oModifierArray.join("&")),baseURL=emp.map.engine.rendererUrl&&""!==emp.map.engine.rendererUrl?emp.map.engine.rendererUrl:location.protocol+"//"+location.host+"/",iconUrl=baseURL+"/mil-sym-service/renderer/image/"+oItem.data.symbolCode+sModifiers,size=oModifiers.size||32,oMilStdIcon=new L.Icon({iconUrl:iconUrl,className:sClassName})},_updateSinglePointFeature:function(oItem,oModifiers,bUpdateIcon){var oCoordinates=leafLet.utils.geoJson.convertCoordinatesToLatLng(oItem.data)[0];if(bUpdateIcon){var oIcon=this._getSinglePointIcon(oItem,oModifiers);oItem.leafletObject.setLatLng(oCoordinates),oItem.leafletObject.setIcon(oIcon)}else oItem.leafletObject.setLatLng(oCoordinates);return oItem.leafletObject.update(),oItem.leafletObject},_createFeature:function(oOptions){var oFeature=void 0,sSymbolCode=oOptions.data.symbolCode,oModifiers=leafLet.utils.milstd.convertModifiersTo2525(oOptions),i2525Version=oModifiers[leafLet.utils.milstd.Modifiers.STANDARD],isMultiPoint=armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sSymbolCode,i2525Version),sBasicSymbolCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(sSymbolCode),oSymbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(sBasicSymbolCode,i2525Version),oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oOptions.data);if(oSymbolDef&&oCoordList.length<oSymbolDef.minPoints)return this.options.oMilStdModifiers=new leafLet.typeLibrary.MilStdModifiers(this,oModifiers),this.options.properties.modifiers=this.options.oMilStdModifiers.toLongModifiers(),this.options.i2525Version=i2525Version,void(this.options.sBasicSymbolCode=sBasicSymbolCode);if(isMultiPoint?(oFeature=this._createMultiPointFeature(oOptions,oModifiers,i2525Version),oOptions.bIsMultiPointTG=!0):oOptions.data.coordinates.length>0&&(oFeature=this._createSinglePointFeature(oOptions,oModifiers),oOptions.bIsMultiPointTG=!1),oFeature){var oMapBoundry=this.getEngineInstanceInterface().leafletInstance.getBounds();this._updateLeafletObject(oMapBoundry,oFeature,!1)}return this.options.oMilStdModifiers=new leafLet.typeLibrary.MilStdModifiers(this,oModifiers),this.options.properties.modifiers=this.options.oMilStdModifiers.toLongModifiers(),this.options.i2525Version=i2525Version,this.options.sBasicSymbolCode=sBasicSymbolCode,oFeature},getCoordinateList:function(){return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getData())},setCoordinates:function(oLatLngList){leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getData(),oLatLngList)},isMultiPointTG:function(){return this.options.bIsMultiPointTG},getFeatureBounds:function(){var oEmpBoundary=leafLet.typeLibrary.Feature.prototype.getFeatureBounds.call(this);if(!oEmpBoundary||oEmpBoundary.isEmpty()){var oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(this.options.data);oEmpBoundary=new leafLet.typeLibrary.EmpBoundary(oCoordList)}return oEmpBoundary},get2525Version:function(){return this.options.i2525Version},render:function(){if(this.isVisible()){var oLeafletObject=this._createFeature(this.options);this.setLeafletObject(oLeafletObject)}},_updateMilStdFeature:function(args,oModifiers,bUpdateGraphic){var oFeature=void 0,sSymbolCode=args.data.symbolCode,i2525Version=oModifiers[leafLet.utils.milstd.Modifiers.STANDARD],isMultiPoint=armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sSymbolCode,i2525Version);if(isMultiPoint?(oFeature=this._createMultiPointFeature(args,oModifiers,i2525Version),args.bIsMultiPointTG=!0):oFeature=this._updateSinglePointFeature(args,oModifiers,bUpdateGraphic),oFeature){var oMapBoundry=this.getEngineInstanceInterface().leafletInstance.getBounds();this._updateLeafletObject(oMapBoundry,oFeature,!1)}return oFeature},updateCoordinates:function(oMapBounds){this.isVisible()&&!this.isMultiPointTG()&&this._updateLeafletObject(oMapBounds,this.getLeafletObject(),!1)},_updateFeature:function(oArgs){var oNewFeafure,sModifier,bUpdateGraphic=oArgs.bUpdateGraphic===!0,oMilStdModifiers=this.options.oMilStdModifiers,oMilStdUtil=leafLet.utils.milstd,oModifiers=oMilStdUtil.convertModifiersTo2525(oArgs);if(!bUpdateGraphic)if(oArgs.hasOwnProperty("name")&&oArgs.name!==this.getName())bUpdateGraphic=!0;else if(oArgs.data.symbolCode!==this.options.data.symbolCode)bUpdateGraphic=!0;else{for(sModifier in oModifiers)if(oModifiers.hasOwnProperty(sModifier)){if(void 0===oMilStdModifiers.oModifiers[sModifier]){bUpdateGraphic=!0;break}if(!oMilStdUtil.areModifierValuesEqual(oMilStdModifiers.oModifiers[sModifier],oModifiers[sModifier])){bUpdateGraphic=!0;break}}if(!bUpdateGraphic)for(sModifier in oMilStdModifiers.oModifiers)if(oMilStdModifiers.oModifiers.hasOwnProperty(sModifier)&&"CN"!==sModifier&&void 0===oModifiers[sModifier]){bUpdateGraphic=!0;break}}return oNewFeafure=this._updateMilStdFeature(oArgs,oModifiers,bUpdateGraphic),this.options.oMilStdModifiers=new leafLet.typeLibrary.MilStdModifiers(this,oModifiers),this.options.properties.modifiers=this.options.oMilStdModifiers.toLongModifiers(),this.options.bIsMultiPointTG=oArgs.bIsMultiPointTG,oNewFeafure},updateIconSize:function(){var sSymbolCode=this.options.data.symbolCode,oModifiers=this.options.oMilStdModifiers.toModifiers(),i2525Version=oModifiers[leafLet.utils.milstd.Modifiers.STANDARD],isMultiPoint=armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sSymbolCode,i2525Version);isMultiPoint||this._updateSinglePointFeature(this.options,oModifiers,!0)},resetEditMode:function(){this.options.isEditMode=!1,this.isSelected()&&this.isMultiPointTG()&&this.render()}};return publicInterface},leafLet.typeLibrary.MilStdFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.MilStdFeature()),leafLet.internalPrivateClass.KMLFeature=function(){var publicInterface={initialize:function(args){var options={sKMLName:void 0,sKMLDesctiption:void 0};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},getPopupHeading:function(oLeafletObject){var sText=this.options.name,sKMLName="";return oLeafletObject&&oLeafletObject.options.hasOwnProperty("kmlName")&&(sKMLName=oLeafletObject.options.kmlName),"string"==typeof sText&&sText.length>0?"string"==typeof sKMLName&&sKMLName.length>0&&sText!==sKMLName&&(sText+=" ("+sKMLName+")"):"string"==typeof sKMLName&&sKMLName.length>0&&(sText=sKMLName),sText},getPopupText:function(oLeafletObject){var sPopupText="",sKMLDescription="";if(oLeafletObject&&oLeafletObject.options.hasOwnProperty("kmlDescription")&&(sKMLDescription=oLeafletObject.options.kmlDescription),oLeafletObject instanceof L.Marker){var oLatLng=oLeafletObject.getLatLng().wrap();sPopupText+="<center><b>Lat</b>:&nbsp;"+oLatLng.lat.toFixed(5)+"<br/><b>Lon</b>:&nbsp;"+oLatLng.lng.toFixed(5)+(oLatLng.alt?"<br/><b>Alt</b>:&nbsp;"+oLatLng.alt+this._getAltUnitsAndModeText():"")+"</center><br/>"}return emp.util.isEmptyString(this._getPopupDescription())?emp.util.isEmptyString(sKMLDescription)||(sPopupText+=sKMLDescription):sPopupText+=this._getPopupDescription(),sPopupText},_getUrlViaProxy:function(sURL){var proxyUrl,data="mime=text/xml&url="+escape(sURL);return proxyUrl=emp.hasOwnProperty("appSetup")?emp.appSetup.urlProxy:emp.util.config.getProxyUrl(),proxyUrl+"?"+data},_setKMLParameters:function(oKmlDoc,oOptions){oKmlDoc&&(emp.$.each(emp.$(oKmlDoc).find("name"),function(i,oNameElem){void 0===oOptions.sKMLName&&(oOptions.sKMLName=oNameElem.textContent)}),emp.$.each(emp.$(oKmlDoc).find("description"),function(i,oDescElem){void 0===oOptions.sKMLDesctiption&&(oOptions.sKMLDesctiption=oDescElem.textContent)}))},_createFeatureFromString:function(oOptions){var oFeature=new leafLet.typeLibrary.EmpKmlObject(oOptions.data,{async:!1,kmlDoc:void 0,oFeature:this,oFeatureProperties:oOptions.properties,sProxyUrl:this.options.instanceInterface.bUseProxy?this.options.instanceInterface.getProxyURL():void 0,basePath:this.getEngineInstanceInterface().getBasePath()});if(void 0===oFeature)throw new Error("KML returned no object.");if(oFeature instanceof L.LayerGroup&&1===oFeature.getLayers().length){var oChild=oFeature.getLayers()[0];oChild instanceof L.Polygon||oChild instanceof L.Polyline||oChild instanceof L.Marker?oOptions.bEditable=!0:oOptions.bEditable=!1}else oOptions.bEditable=!1;return this._setKMLParameters(oFeature.options.kmlDoc,oOptions),oFeature},_createFeatureFromURL:function(oOptions){var oFeature=new leafLet.typeLibrary.EmpKmlObject(oOptions.url,{async:!1,kmlDoc:void 0,oFeature:this,oFeatureProperties:oOptions.properties,sProxyUrl:this.options.instanceInterface.bUseProxy?this.options.instanceInterface.getProxyURL():void 0,basePath:this.getEngineInstanceInterface().getBasePath()});if(void 0===oFeature)throw new Error("KML returned no object.");return oOptions.bEditable=!1,this._setKMLParameters(oFeature.options.kmlDoc,oOptions),oFeature},_createFeature:function(args){var oFeature=void 0;return oFeature=args.url&&""!==args.url?this._createFeatureFromURL(args):this._createFeatureFromString(args)},_updateFeature:function(oArgs){return this._createFeature(oArgs)},setFeatureStyleProperties:function(sType,oProperties){var bDoUpdate=!1,bMultiGeometry=!1,oLeafletObject=this.getLeafletObject(),oFeatureProperties=this.getProperties();oLeafletObject instanceof L.LayerGroup&&(1===oLeafletObject.getLayers().length?oLeafletObject=oLeafletObject.getLayers()[0]:bMultiGeometry=!0),sType===emp.typeLibrary.OverlayStyleType.POINT&&oLeafletObject instanceof L.Marker?oProperties.hasOwnProperty("iconUrl")&&(oFeatureProperties.iconUrl=oProperties.iconUrl,bDoUpdate=!0):sType===emp.typeLibrary.OverlayStyleType.LINE&&oLeafletObject instanceof L.Polyline?oProperties.hasOwnProperty("lineColor")&&(oFeatureProperties.lineColor=oProperties.lineColor,oProperties.hasOwnProperty("lineWidth")&&(oFeatureProperties.lineWidth=oProperties.lineWidth),bDoUpdate=!0):sType===emp.typeLibrary.OverlayStyleType.POLYGON&&oLeafletObject instanceof L.Polygon?(oProperties.hasOwnProperty("lineColor")&&(oFeatureProperties.lineColor=oProperties.lineColor,oProperties.hasOwnProperty("lineWidth")&&(oFeatureProperties.lineWidth=oProperties.lineWidth),bDoUpdate=!0),oProperties.hasOwnProperty("fillColor")&&(oFeatureProperties.fillColor=oProperties.fillColor,bDoUpdate=!0)):sType===emp.typeLibrary.OverlayStyleType.MULTIGEOMETRY&&bMultiGeometry&&(oProperties.hasOwnProperty("lineColor")&&(oFeatureProperties.lineColor=oProperties.lineColor,oProperties.hasOwnProperty("lineWidth")&&(oFeatureProperties.lineWidth=oProperties.lineWidth),bDoUpdate=!0),oProperties.hasOwnProperty("fillColor")&&(oFeatureProperties.fillColor=oProperties.fillColor,bDoUpdate=!0),oProperties.hasOwnProperty("iconUrl")&&(oFeatureProperties.iconUrl=oProperties.iconUrl,bDoUpdate=!0)),bDoUpdate&&this.updateFeature(this.options)},render:function(){this.updateFeature(this.options)}};return publicInterface},leafLet.typeLibrary.KMLFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.KMLFeature()),leafLet.internalPrivateClass.GeoJsonFeature=function(){var publicInterface={initialize:function(args){leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},getPopupText:function(){var sPopupText="";if(this.options.leafletObject instanceof L.Marker){var oLatLng=this.options.leafletObject.getLatLng();void 0!==oLatLng&&(oLatLng=oLatLng.wrap(),sPopupText+="<center><b>Lat</b>:&nbsp;"+oLatLng.lat.toFixed(5)+"<br/><b>Lon</b>:&nbsp;"+oLatLng.lng.toFixed(5)+(oLatLng.alt?"<br/><b>Alt</b>:&nbsp;"+oLatLng.alt+this._getAltUnitsAndModeText():"")+"</center><br/>")}return sPopupText+=this._getPopupDescription()},_createGeoJSONPolygon:function(oGeoJSON,oProperties){var bIsSelected=this.isSelected(),oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oGeoJSON);if(!(void 0===oCoordList||oCoordList.length<3))return bIsSelected&&(oProperties.tempColor=oProperties.color||L.LEAFLET_DEFAULT_LINE_COLOR,oProperties.tempWeight=oProperties.weigh||L.LEAFLET_DEFAULT_LINE_WEIGHT,oProperties.color="#"+this.options.instanceInterface.selectAttributes.color,oProperties.weigh=this.options.instanceInterface.selectAttributes.width),oProperties.oFeature=this,new L.Polygon(oCoordList,oProperties)},_createGeoJSONLine:function(oGeoJSON,oProperties){var oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oGeoJSON),bIsSelected=this.isSelected();if(!(void 0===oCoordList||oCoordList.length<2))return bIsSelected&&(oProperties.tempColor=oProperties.color||L.LEAFLET_DEFAULT_LINE_COLOR,oProperties.tempWeight=oProperties.weigh||L.LEAFLET_DEFAULT_LINE_WEIGHT,oProperties.color="#"+this.options.instanceInterface.selectAttributes.color,oProperties.weigh=this.options.instanceInterface.selectAttributes.width),oProperties.oFeature=this,new L.Polyline(oCoordList,oProperties)},_getDefaultIcon:function(){var oIcon,oDefaultIcon=emp.utilities.icon.getDefaultIcon(this.getEngineInstanceInterface().getBasePath()),sURL=this.options.instanceInterface.bUseProxy?this.getEngineInstanceInterface().getProxyURL()+"?mime=image/*&url="+escape(oDefaultIcon.iconUrl):oDefaultIcon.iconUrl;return oIcon=new leafLet.typeLibrary.EmpIcon({iconUrl:sURL,iconAnchor:new L.Point(oDefaultIcon.offset.x,oDefaultIcon.offset.y),iconAnchorType:{x:oDefaultIcon.offset.xUnits,y:oDefaultIcon.offset.yUnits},basePath:this.getEngineInstanceInterface().getBasePath()})},_createGeoJSONPoint:function(oGeoJSON,oProperties){var bIsSelected=this.isSelected(),oLatLon=leafLet.utils.geoJson.convertCoordinatesToLatLng(oGeoJSON)[0];if(void 0!==oLatLon)return oProperties.iconOptions&&(bIsSelected&&(oProperties.iconOptions.className="icon-selected"),oProperties.iconOptions.basePath=this.getEngineInstanceInterface().getBasePath(),oProperties.icon=new leafLet.typeLibrary.EmpIcon(oProperties.iconOptions)),oProperties.oFeature=this,new L.Marker(oLatLon,oProperties)},_createGeoJSONComplex:function(args,oGeoJSON){var oThis=this,bIsSelected=this.isSelected();return new L.geoJson(oGeoJSON,{style:function(oGeoJSONData){var oProperties=leafLet.utils.geoJson.mergeGeoJSONProperties(oThis.getEngineInstanceInterface(),args.properties,oGeoJSONData.properties);return bIsSelected&&(oProperties.tempColor=oProperties.color,oProperties.tempWeight=oProperties.weigh,oProperties.color="#"+args.instanceInterface.selectAttributes.color,oProperties.weigh=args.instanceInterface.selectAttributes.width),oProperties.oFeature=oThis,oProperties},coordsToLatLng:function(oCoord){return new L.LatLng(oCoord[1],oCoord[0])},pointToLayer:function(oGeoJsonfeature,latlng){var oProperties=leafLet.utils.geoJson.mergeGeoJSONProperties(oThis.getEngineInstanceInterface(),args.properties,oGeoJsonfeature.properties);return oProperties.iconOptions&&(bIsSelected&&(oProperties.iconOptions.className="icon-selected"),oProperties.iconOptions.basPath=this.getEngineInstanceInterface().getBasePath(),oProperties.icon=new leafLet.typeLibrary.EmpIcon(oProperties.iconOptions)),new L.Marker(latlng,{icon:oProperties.icon,sSubItemID:oProperties.sSubItemID,oFeature:oThis})}})},_createFeature:function(args){var oFeature=void 0,oProperties=leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(),args.properties,args.data.properties);switch(oProperties.title=args.name,args.data.type.toLowerCase()){case"point":oFeature=this._createGeoJSONPoint(args.data,oProperties);break;case"linestring":oFeature=this._createGeoJSONLine(args.data,oProperties);break;case"polygon":oFeature=this._createGeoJSONPolygon(args.data,oProperties);break;case"feature":if(!args.data.hasOwnProperty("geometry"))throw new Error("GeoJSON Feature with no geometry.");switch(args.data.geometry.type.toLowerCase()){case"point":oFeature=this._createGeoJSONPoint(args.data.geometry,oProperties);break;case"linestring":oFeature=this._createGeoJSONLine(args.data.geometry,oProperties);break;case"polygon":oFeature=this._createGeoJSONPolygon(args.data.geometry,oProperties);break;default:oFeature=this._createGeoJSONComplex(args,args.data)}break;default:oFeature=this._createGeoJSONComplex(args,args.data)}return oFeature},_updateFeature:function(oArgs){return this._createFeature(oArgs)},getGeometryType:function(){return leafLet.utils.geoJson.getGeometryType(this.getData())},render:function(){this.updateFeature(this.options)},setFeatureStyleProperties:function(sType,oProperties){var bDoUpdate=!1,oFeatureProperties=this.getProperties(),sGeoJsonType=this.getGeometryType().toLowerCase();sType===emp.typeLibrary.OverlayStyleType.POINT&&"point"===sGeoJsonType?oProperties.hasOwnProperty("iconUrl")&&(oFeatureProperties.iconUrl=oProperties.iconUrl,this.updateFeature(this.options)):sType===emp.typeLibrary.OverlayStyleType.LINE&&"linestring"===sGeoJsonType?oProperties.hasOwnProperty("lineColor")&&(oFeatureProperties.lineColor=oProperties.lineColor,oProperties.hasOwnProperty("lineWidth")&&(oFeatureProperties.lineWidth=oProperties.lineWidth)):sType===emp.typeLibrary.OverlayStyleType.POLYGON&&"polygon"===sGeoJsonType?(oProperties.hasOwnProperty("lineColor")&&(oFeatureProperties.lineColor=oProperties.lineColor,oProperties.hasOwnProperty("lineWidth")&&(oFeatureProperties.lineWidth=oProperties.lineWidth),bDoUpdate=!0),oProperties.hasOwnProperty("fillColor")&&(oFeatureProperties.fillColor=oProperties.fillColor,bDoUpdate=!0),bDoUpdate&&this.updateFeature(this.options)):sType===emp.typeLibrary.OverlayStyleType.MULTIGEOMETRY&&"point"!==sGeoJsonType&&"linestring"!==sGeoJsonType&&"polygon"!==sGeoJsonType&&(oProperties.hasOwnProperty("lineColor")&&(oFeatureProperties.lineColor=oProperties.lineColor,oProperties.hasOwnProperty("lineWidth")&&(oFeatureProperties.lineWidth=oProperties.lineWidth),bDoUpdate=!0),oProperties.hasOwnProperty("fillColor")&&(oFeatureProperties.fillColor=oProperties.fillColor,bDoUpdate=!0),oProperties.hasOwnProperty("iconUrl")&&(oFeatureProperties.iconUrl=oProperties.iconUrl,bDoUpdate=!0),bDoUpdate&&this.updateFeature(this.options))}};return publicInterface},leafLet.typeLibrary.GeoJsonFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoJsonFeature()),leafLet.internalPrivateClass.AirspaceFeature=function(){var publicInterface={initialize:function(args,iMinPoint,iMaxPoints){var options={iMinPoints:iMinPoint,iMaxPoints:iMaxPoints,oAirspaceAttributeList:{}};L.Util.setOptions(this,options),this.options.oAirspaceAttributeList=new leafLet.typeLibrary.airspace.AttributeList(args.item.properties),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},getMinPoints:function(){return this.options.iMinPoints},getMaxPoints:function(){return this.options.iMaxPoints},getUnits:function(){return leafLet.utils.Units.METERS},getAltitudeModeAbbr:function(){var oAttributes=this.getAttributes(0),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;return leafLet.utils.AltitudeModeAbbr(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ALTITUDE_MODE))},getAttributeList:function(){return this.options.oAirspaceAttributeList},setAttributeList:function(oList){this.options.oAirspaceAttributeList=oList},getAttributes:function(iIndex){return this.getAttributeList().get(iIndex)},getCoordinateList:function(){return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getData())},setCoordinates:function(oLatLngList){leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getData(),oLatLngList)},render:function(){if(this.isVisible()){var oNewLeafletObject=this._createFeature(this.options);oNewLeafletObject&&this.setLeafletObject(oNewLeafletObject)}},_updateFeature:function(oArgs){return oArgs.oAirspaceAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),this._createFeature(oArgs)}};return publicInterface},leafLet.typeLibrary.AirspaceFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.AirspaceFeature()),leafLet.internalPrivateClass.ImageFeature=function(){var publicInterface={initialize:function(args){var options={oLatLngList:this._convertBBox(args.item.params),sImageURL:args.item.url};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},_convertBBox:function(oBBox){var oLatLngList=[];return oLatLngList.push(new L.LatLng(oBBox.bottom,oBBox.left)),oLatLngList.push(new L.LatLng(oBBox.top,oBBox.right)),oLatLngList},_createFeature:function(args){var oLeafletObject;return oLeafletObject=new L.ImageOverlay(args.sImageURL,args.oLatLngList)},_updateFeature:function(oArgs){var oLeafletObject,oOptions={sImageURL:oArgs.url,oLatLngList:this._convertBBox(oArgs.params)};return oLeafletObject=this._createFeature(oOptions),this.options.sImageURL=oOptions.url,this.options.oLatLngList=oOptions.params,oArgs.hasOwnProperty("name")&&this.setName(oArgs.name),oLeafletObject},getPopupText:function(){return"<center><b>URL:&nbsp;"+this.getURL+"</b></center><br/>"+this._getPopupDescription()},getFeatureBounds:function(){var oBounds=void 0,oLeafletObject=this.getLeafletObject(),oLatLngList=this.getParams();return oLeafletObject&&(oBounds=new leafLet.typeLibrary.EmpBoundary(oLatLngList[0].wrap(),oLatLngList[1].wrap())),oBounds},getURL:function(){return this.options.sImageURL},getParams:function(){return this.options.oLatLngList},render:function(){if(this.isVisible()){var oNewLeafletObject=this._createFeature(this.options);oNewLeafletObject&&this.setLeafletObject(oNewLeafletObject)}}};return publicInterface},leafLet.typeLibrary.ImageFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.ImageFeature()),leafLet.internalPrivateClass.AOIFeature=function(){var publicInterface={initialize:function(args){var options={oOriginalData:emp.helpers.copyObject(args.item.data),iBuffer:void 0,sAOIType:void 0,sSymbolCode:void 0,oModifiers:{}};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},_createFeature:function(args){var sDescription=args.properties.description||"",oGeoJson=args.data;return this.setAOIType(oGeoJson.properties.aoi.type),this.setAOIBuffer(oGeoJson.properties.aoi.buffer),this.setAOISymbolCode(),this.setModifiers(),leafLet.utils.milstd.renderMPGraphic({instanceInterface:this.getEngineInstanceInterface(),isSelected:args.selected,sID:args.coreId,sName:args.name,sDescription:sDescription,sSymbolCode:this.getAOISymbolCode(),oCoordData:args.data.geometry,oModifiers:emp.helpers.copyObject(this.getModifiers()),i2525Version:0,oFeature:this})},_updateFeature:function(oArgs){return this._createFeature(oArgs)},getPopupText:function(){var sText,eAOIType=emp.typeLibrary.AOIType;switch(sText="<center><b>AOI&nbsp;",this.getAOIType()){case eAOIType.POINT_RADIUS:sText+="Point Radius";break;case eAOIType.LINE:sText+="Line";break;case eAOIType.POLYGON:sText+="Polygon";break;case eAOIType.BBOX:sText+="Rectangle"}return sText+="</b></center>",sText+="<center><b>Buffer</b>:&nbsp;"+this.getAOIBuffer()+"</center><br/>",sText+=this._getPopupDescription()},getUnits:function(){return leafLet.utils.Units.METERS},getAOIType:function(){return this.options.sAOIType},setAOIType:function(sType){this.options.sAOIType=sType},getAOIBuffer:function(){return this.options.iBuffer},setAOIBuffer:function(iBuffer){this.options.iBuffer=iBuffer},setAOIBufferProperty:function(iBuffer){this.options.data.properties.aoi.buffer=iBuffer},getAOISymbolCode:function(){return this.options.sSymbolCode},setAOISymbolCode:function(){var eAOIType=emp.typeLibrary.AOIType;switch(this.getAOIType()){case eAOIType.POINT_RADIUS:this.options.sSymbolCode="BBS_POINT------";break;case eAOIType.LINE:this.options.sSymbolCode="BBS_LINE-------";break;case eAOIType.POLYGON:this.options.sSymbolCode="BBS_AREA-------";break;case eAOIType.BBOX:this.options.sSymbolCode="BBS_RECTANGLE--"}},getModifiers:function(){return this.options.oModifiers},setModifiers:function(){var oGeoJson=this.getData(),eMilStdModifiers=leafLet.utils.milstd.Modifiers,oProperties=this.getProperties();this.options.oModifiers[eMilStdModifiers.UNIQUE_DESIGNATOR_1]=this.getName(),this.options.oModifiers[eMilStdModifiers.DISTANCE]=[this.getAOIBuffer()],oProperties&&(oProperties.hasOwnProperty("fillColor")&&(this.options.oModifiers.fillColor=oProperties.fillColor),oProperties.hasOwnProperty("lineColor")&&(this.options.oModifiers.lineColor=oProperties.lineColor)),this.options.oModifiers.fillColor||oGeoJson&&oGeoJson.properties.hasOwnProperty("fillColor")&&(this.options.oModifiers.fillColor=oGeoJson.properties.fillColor),this.options.oModifiers.lineColor||oGeoJson&&oGeoJson.properties.hasOwnProperty("lineColor")&&(this.options.oModifiers.lineColor=oGeoJson.properties.lineColor),this.options.oModifiers.fillColor||(this.options.oModifiers.fillColor="99AAAAAA")},getGeometryType:function(){return leafLet.utils.geoJson.getGeometryType(this.getData())},render:function(){if(this.isVisible()){var oNewLeafletObject=this._createFeature(this.options);this.setLeafletObject(oNewLeafletObject)}}};return publicInterface},leafLet.typeLibrary.AOIFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.AOIFeature()),leafLet.typeLibrary.MilStdModifiers=function(oFeature,args){var sShortName,oMilStdFeature=oFeature,o2525Modifiers=leafLet.utils.milstd.Modifiers,oStringModifiers=leafLet.utils.milstd.longModifiers,oLongToShortModifierName=leafLet.utils.milstd.stringToModifiers,o2525ModifierToLong=leafLet.utils.milstd.o2525ModifierToLong,publicInterface={oModifiers:{},getAMValueCount:function(){return void 0===this.oModifiers[o2525Modifiers.DISTANCE]&&(this.oModifiers[o2525Modifiers.DISTANCE]=[]),this.oModifiers[o2525Modifiers.DISTANCE].length},getAMValue:function(iIndex){if(iIndex>=this.getAMValueCount())return NaN;var dValue=this.oModifiers[o2525Modifiers.DISTANCE][iIndex];switch(oMilStdFeature.getUnits()){case leafLet.utils.Units.FEET:dValue=Math.round(dValue*leafLet.utils.METERS_PER_FEET)}return dValue},setAMValue:function(iIndex,dValue){switch(oMilStdFeature.getUnits()){case leafLet.utils.Units.FEET:dValue=Math.round(dValue*leafLet.utils.FEET_PER_METERS)}iIndex<this.getAMValueCount()?this.oModifiers[o2525Modifiers.DISTANCE][iIndex]=dValue:this.oModifiers[o2525Modifiers.DISTANCE].push(dValue)},getANValueCount:function(){return void 0===this.oModifiers[o2525Modifiers.AZIMUTH]&&(this.oModifiers[o2525Modifiers.AZIMUTH]=[]),this.oModifiers[o2525Modifiers.AZIMUTH].length},getANValue:function(iIndex){if(iIndex>=this.getANValueCount())return NaN;var dValue=this.oModifiers[o2525Modifiers.AZIMUTH][iIndex];switch(oMilStdFeature.getAzimuthUnits()){case leafLet.utils.AngleUnits.MILS:dValue*=leafLet.utils.DEGREE_PER_MILS}return dValue},setANValue:function(iIndex,dValue){switch(oMilStdFeature.getAzimuthUnits()){case leafLet.utils.AngleUnits.MILS:
dValue*=leafLet.utils.MILS_PER_DEGREE}iIndex<this.getANValueCount()?this.oModifiers[o2525Modifiers.AZIMUTH][iIndex]=dValue:this.oModifiers[o2525Modifiers.AZIMUTH].push(dValue)},getXValueCount:function(){return void 0===this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH]&&(this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH]=[]),this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH].length},getXValue:function(iIndex){if(iIndex>=this.getXValueCount())return NaN;var dValue=this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH][iIndex];switch(oMilStdFeature.getAltitudeUnits()){case leafLet.utils.Units.FEET:dValue=Math.round(dValue*leafLet.utils.FEET_PER_METERS)}return dValue},setXValue:function(iIndex,dValue){switch(oMilStdFeature.getAltitudeUnits()){case leafLet.utils.Units.FEET:dValue=Math.round(dValue*leafLet.utils.METERS_PER_FEET)}iIndex<this.getXValueCount()?this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH][iIndex]=dValue:this.oModifiers[o2525Modifiers.ALTITUDE_DEPTH].push(dValue)},toModifiers:function(){var oNewModifiers={};for(var sModifier in this.oModifiers)this.oModifiers.hasOwnProperty(sModifier)&&void 0!==this.oModifiers[sModifier]&&(oNewModifiers[sModifier]=emp.helpers.copyObject(this.oModifiers[sModifier]));return oNewModifiers},toLongModifiers:function(){var sLongModifier,oNewModifiers={};for(var sModifier in this.oModifiers)if(this.oModifiers.hasOwnProperty(sModifier)&&void 0!==this.oModifiers[sModifier])switch(sLongModifier=o2525ModifierToLong[sModifier],sModifier){case o2525Modifiers.STANDARD:oNewModifiers[sLongModifier]=emp.typeLibrary.featureMilStdVersionType.convertToString(this.oModifiers[sModifier]);break;default:oNewModifiers[sLongModifier]=emp.helpers.copyObject(this.oModifiers[sModifier])}return oNewModifiers}};for(var sProp in args)if(args.hasOwnProperty(sProp))switch(sShortName=sProp,sProp){case oStringModifiers.FILL_COLOR:case oStringModifiers.LINE_COLOR:case oStringModifiers.X_OFFSET:case oStringModifiers.X_UNITS:case oStringModifiers.Y_OFFSET:case oStringModifiers.Y_UNITS:case oStringModifiers.LINE_THICKNESS:break;default:switch(void 0!==oLongToShortModifierName[sProp]&&(sShortName=oLongToShortModifierName[sProp]),sProp){case oStringModifiers.STANDARD:publicInterface.oModifiers[sShortName]=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(args[oStringModifiers.STANDARD]);break;default:publicInterface.oModifiers[sShortName]=args[sProp]}}return publicInterface},leafLet.internalPrivateClass.GeoTextFeature=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},getPopupText:function(){var sPopupText="";if(this.options.leafletObject instanceof L.Marker){var oLatLng=this.options.leafletObject.getLatLng();void 0!==oLatLng&&(oLatLng=oLatLng.wrap(),sPopupText+="<center><b>Lat</b>:&nbsp;"+oLatLng.lat.toFixed(5)+"<br/><b>Lon</b>:&nbsp;"+oLatLng.lng.toFixed(5)+(oLatLng.alt?"<br/><b>Alt</b>:&nbsp;"+oLatLng.alt+this._getAltUnitsAndModeText():"")+"</center><br/>")}return sPopupText+=this._getPopupDescription()},_createFeature:function(args){var oProperties,halfWidth,myIcon,iTextPixelDim,oLeafletFeature=void 0,sLabelText=args.name?args.name:" ",iXOffset=0,iYOffset=0,oLatLon=leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0],htmlFontStyle="normal",htmlFontWeight="normal",sCSSTextShadow="",azimuth=args.properties&&args.properties.azimuth?args.properties.azimuth:0,labelStyle=args.properties&&args.properties.labelStyle?args.properties.labelStyle:this.getEngineInstanceInterface().defaultLabelStyle;if(void 0!==oLatLon){if(this.isSelected()&&(labelStyle=this.getEngineInstanceInterface().selectLabelStyle),labelStyle.typeface)switch(labelStyle.typeface.toUpperCase()){case cmapi.enums.typeface.REGULAR:break;case cmapi.enums.typeface.BOLD:htmlFontWeight="bold";break;case cmapi.enums.typeface.ITALIC:htmlFontStyle="italic",ret="italic";break;case cmapi.enums.typeface.BOLDITALIC:htmlFontStyle="italic",htmlFontWeight="bold"}if(oProperties=leafLet.utils.geoJson.mergeGeoJSONProperties(this.getEngineInstanceInterface(),args.properties),iTextPixelDim=emp.helpers.getStringPixelDimensions(sLabelText,labelStyle.family,labelStyle.size+"pt",htmlFontWeight),oProperties.title=args.name,iYOffset=Math.floor(iTextPixelDim.height/2),labelStyle.justification)switch(labelStyle.justification.toUpperCase()){case cmapi.enums.justification.CENTER:iXOffset=Math.floor(iTextPixelDim.width/2);break;case cmapi.enums.justification.LEFT:iXOffset=0,azimuth&&(halfWidth=Math.floor(iTextPixelDim.width/2),iXOffset+=Math.floor(halfWidth*(1-Math.cos(azimuth.toRad()))),iYOffset-=Math.floor(halfWidth*Math.sin(azimuth.toRad())));break;case cmapi.enums.justification.RIGHT:iXOffset=iTextPixelDim.width,azimuth&&(halfWidth=Math.floor(iTextPixelDim.width/2),iXOffset-=Math.floor(halfWidth*(1-Math.cos(azimuth.toRad()))),iYOffset+=Math.floor(halfWidth*Math.sin(azimuth.toRad())))}return labelStyle.outlineColor&&(sCSSTextShadow="text-shadow: 4px 4px 2px rgb("+labelStyle.outlineColor.red+", "+labelStyle.outlineColor.green+", "+labelStyle.outlineColor.blue+"); "),myIcon=new L.DivIcon({className:"",html:"<p style='font-family:"+labelStyle.family+"; font-size:"+labelStyle.size+"pt; line-height: "+iTextPixelDim.height+"px; white-space: nowrap; font-style: "+htmlFontStyle+"; font-weight:"+htmlFontWeight+"; color: rgb("+labelStyle.color.red+", "+labelStyle.color.green+", "+labelStyle.color.blue+"); "+sCSSTextShadow+"background: transparent; border: none; -webkit-transform: rotate("+azimuth+"deg); -moz-transform: rotate("+azimuth+"deg); -o-transform: rotate("+azimuth+"deg); transform: rotate("+azimuth+"deg);'>"+sLabelText+"</p>",iconSize:new L.Point(iTextPixelDim.width,iTextPixelDim.height),iconAnchor:new L.Point(iXOffset,iYOffset)}),oLeafletFeature=new L.Marker(oLatLon,{icon:myIcon,oFeature:this})}},_updateFeature:function(oArgs){return this._createFeature(oArgs)},render:function(){this.updateFeature(this.options)},setFeatureStyleProperties:function(sType,oProperties){}};return publicInterface},leafLet.typeLibrary.GeoTextFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoTextFeature()),leafLet.internalPrivateClass.GeoRectangleFeature=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},_createFeature:function(args){var distance,newLatLng,angleOffset,oProperties,oLeafletFeature=void 0,oLatLon=leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0],oLatLngList=[],azimuth=args.properties&&args.properties.azimuth?args.properties.azimuth:0,height=args.properties&&args.properties.height?args.properties.height/2:void 0,width=args.properties&&args.properties.width?args.properties.width/2:void 0;if(void 0!==oLatLon&&void 0!==height&&void 0!==width)return oProperties=this._getPolygonProperties(args),distance=Math.sqrt(height*height+width*width),angleOffset=Math.atan2(width,height).toDeg(),newLatLng=oLatLon.destinationPoint(azimuth+angleOffset,distance),oLatLngList.push(newLatLng),newLatLng=oLatLon.destinationPoint(azimuth+180-angleOffset,distance),oLatLngList.push(newLatLng),newLatLng=oLatLon.destinationPoint(azimuth+180+angleOffset,distance),oLatLngList.push(newLatLng),newLatLng=oLatLon.destinationPoint(azimuth+360-angleOffset,distance),oLatLngList.push(newLatLng),oLeafletFeature=new L.polygon(oLatLngList,oProperties)},_updateFeature:function(oArgs){return this._createFeature(oArgs)},render:function(){this.updateFeature(this.options)},setFeatureStyleProperties:function(sType,oProperties){}};return publicInterface},leafLet.typeLibrary.GeoRectangleFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoRectangleFeature()),leafLet.internalPrivateClass.GeoSquareFeature=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},_createFeature:function(args){var distance,newLatLng,angleOffset,oProperties,oLeafletFeature=void 0,oLatLon=leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0],oLatLngList=[],azimuth=args.properties&&args.properties.azimuth?args.properties.azimuth:0,width=args.properties&&args.properties.width?args.properties.width/2:void 0;if(void 0!==oLatLon&&void 0!==width)return oProperties=this._getPolygonProperties(args),distance=Math.sqrt(2*(width*width)),angleOffset=45,newLatLng=oLatLon.destinationPoint(azimuth+angleOffset,distance),oLatLngList.push(newLatLng),newLatLng=oLatLon.destinationPoint(azimuth+180-angleOffset,distance),oLatLngList.push(newLatLng),newLatLng=oLatLon.destinationPoint(azimuth+180+angleOffset,distance),oLatLngList.push(newLatLng),newLatLng=oLatLon.destinationPoint(azimuth+360-angleOffset,distance),oLatLngList.push(newLatLng),oLeafletFeature=new L.polygon(oLatLngList,oProperties)},_updateFeature:function(oArgs){return this._createFeature(oArgs)},render:function(){this.updateFeature(this.options)},setFeatureStyleProperties:function(sType,oProperties){}};return publicInterface},leafLet.typeLibrary.GeoSquareFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoSquareFeature()),leafLet.internalPrivateClass.GeoCircleFeature=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},_createFeature:function(args){var oProperties,oLeafletFeature=void 0,oLatLon=leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0],radius=args.properties&&args.properties.radius?args.properties.radius:void 0;if(void 0!==oLatLon&&void 0!==radius)return oProperties=this._getPolygonProperties(args),oLeafletFeature=new L.circle(oLatLon,radius,oProperties)},_updateFeature:function(oArgs){return this._createFeature(oArgs)},render:function(){this.updateFeature(this.options)},setFeatureStyleProperties:function(sType,oProperties){}};return publicInterface},leafLet.typeLibrary.GeoCircleFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoCircleFeature()),leafLet.internalPrivateClass.GeoEllipseFeature=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.Feature.prototype.initialize.call(this,args)},_createFeature:function(args){var oProperties,oLeafletFeature=void 0,oLatLon=leafLet.utils.geoJson.convertCoordinatesToLatLng(args.data)[0],semiMajor=args.properties&&args.properties.semiMajor?args.properties.semiMajor:void 0,semiMinor=args.properties&&args.properties.semiMinor?args.properties.semiMinor:void 0;if(void 0!==oLatLon&&void 0!==semiMajor&&void 0!==semiMinor)return oProperties=this._getPolygonProperties(args),oLeafletFeature=new leafLet.EllipseObject({leafletMap:this.getEngineInstanceInterface().leafletInstance,isSelected:this.isSelected(),selectAttributes:this.getEngineInstanceInterface().selectAttributes,oFeature:this,properties:this._getPolygonProperties(args),centerLatLng:oLatLon,semiMinor:semiMinor,semiMajor:semiMajor,azimuth:args.properties&&args.properties.azimuth?args.properties.azimuth:0})},_updateFeature:function(oArgs){return this._createFeature(oArgs)},render:function(){this.updateFeature(this.options)},setFeatureStyleProperties:function(sType,oProperties){}};return publicInterface},leafLet.typeLibrary.GeoEllipseFeature=leafLet.typeLibrary.Feature.extend(leafLet.internalPrivateClass.GeoEllipseFeature()),leafLet.typeLibrary.AirspaceAttribute={AIRSPACE_FILL_COLOR:"fillColor",AIRSPACE_LINE_COLOR:"lineColor",AIRSPACE_LINE_WIDTH:"lineWidth",AIRSPACE_LEFT_WIDTH:"leftWidth",AIRSPACE_RIGHT_WIDTH:"rightWidth",AIRSPACE_WIDTH:"width",AIRSPACE_HEIGHT:"height",AIRSPACE_ALTITUDE:"altitude",AIRSPACE_MIN_ALTITUDE:"minAlt",AIRSPACE_MAX_ALTITUDE:"maxAlt",AIRSPACE_ALTITUDE_MODE:"altitudeMode",AIRSPACE_INNER_RADIUS:"innerRadius",AIRSPACE_RADIUS:"radius",AIRSPACE_LEFT_AZIMUTH:"leftAzimuth",AIRSPACE_RIGHT_AZIMUTH:"rightAzimuth",AIRSPACE_ORBIT_TURN:"turn"},leafLet.internalPrivateClass.AirspaceAttributes=function(){var publicInterface={initialize:function(oProperties,oAttributes){var cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,options={};for(var sAttr in oAttributes)oAttributes.hasOwnProperty(sAttr)&&(sAttr===leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_ORBIT_TURN?options[sAttr]=oAttributes[sAttr].toLowerCase():options[sAttr]=oAttributes[sAttr]);oProperties.hasOwnProperty(cAirspaceAttribute.AIRSPACE_FILL_COLOR)&&(options[cAirspaceAttribute.AIRSPACE_FILL_COLOR]=oProperties[cAirspaceAttribute.AIRSPACE_FILL_COLOR]),oProperties.hasOwnProperty(cAirspaceAttribute.AIRSPACE_LINE_COLOR)&&(options[cAirspaceAttribute.AIRSPACE_LINE_COLOR]=oProperties[cAirspaceAttribute.AIRSPACE_LINE_COLOR]),oProperties.hasOwnProperty(cAirspaceAttribute.AIRSPACE_LINE_WIDTH)&&(options[cAirspaceAttribute.AIRSPACE_LINE_WIDTH]=oProperties[cAirspaceAttribute.AIRSPACE_LINE_WIDTH]),L.Util.setOptions(this,options)},getValue:function(sAttr){return this.options[sAttr]},setValue:function(sAttr,Value){this.options[sAttr]=Value},getAttributes:function(){return this.options},setRequiredAttributes:function(sAirspaceType){var cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,cAirspaceType=emp.typeLibrary.airspaceSymbolCode;switch(sAirspaceType){case cAirspaceType.SHAPE3D_CURTAIN:break;case cAirspaceType.SHAPE3D_CYLINDER:isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RADIUS))&&this.setValue(cAirspaceAttribute.AIRSPACE_RADIUS,2e3);break;case cAirspaceType.SHAPE3D_ORBIT:isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_WIDTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_WIDTH,2e3),void 0===this.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN)&&this.setValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN,emp.typeLibrary.orbitTurnType.CENTER);break;case cAirspaceType.SHAPE3D_POLYARC:isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RADIUS))&&this.setValue(cAirspaceAttribute.AIRSPACE_RADIUS,2e3),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH,315),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH,45);break;case cAirspaceType.SHAPE3D_POLYGON:break;case cAirspaceType.SHAPE3D_RADARC:isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RADIUS))&&this.setValue(cAirspaceAttribute.AIRSPACE_RADIUS,2e3),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS))&&this.setValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS,1e3),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH,315),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH,45);break;case cAirspaceType.SHAPE3D_ROUTE:isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_WIDTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_WIDTH,5e3);break;case cAirspaceType.SHAPE3D_TRACK:isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH,2500),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH,2500)}var dMinAlt=this.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE);isNaN(dMinAlt)&&(dMinAlt=0,this.setValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE,dMinAlt)),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE))?this.setValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE,dMinAlt+5e3):dMinAlt>this.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)&&(this.setValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE,this.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)),this.setValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE,dMinAlt)),void 0===this.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)&&this.setValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR,"0xAAAAFFAA"),void 0===this.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)&&this.setValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR,"0xFF00AA00"),isNaN(this.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH))&&this.setValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH,3)},getAirspaceAttributes:function(){var oAttr={},cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;for(var sAttr in this.options)if(this.options.hasOwnProperty(sAttr))switch(sAttr){case cAirspaceAttribute.AIRSPACE_FILL_COLOR:case cAirspaceAttribute.AIRSPACE_LINE_COLOR:case cAirspaceAttribute.AIRSPACE_LINE_WIDTH:break;default:oAttr[sAttr]=this.options[sAttr]}return oAttr},duplicateAttribute:function(){return new leafLet.typeLibrary.airspace.Attributes({},this.options)}};return publicInterface},leafLet.typeLibrary.airspace.Attributes=L.Class.extend(leafLet.internalPrivateClass.AirspaceAttributes()),leafLet.internalPrivateClass.AirspaceAttributeList=function(){var publicInterface={initialize:function(oProperties){var oAttrList=oProperties.attributes,options={oAttributeList:[]};if(L.Util.setOptions(this,options),oAttrList instanceof Array)for(var iIndex=0;iIndex<oAttrList.length;iIndex++)this.add(new leafLet.typeLibrary.airspace.Attributes(oProperties,oAttrList[iIndex]));else"object"==typeof oAttrList&&oAttrList.length>0?this.add(new leafLet.typeLibrary.airspace.Attributes(oProperties,oAttrList)):this.add(new leafLet.typeLibrary.airspace.Attributes(oProperties,{}))},length:function(){return this.options.oAttributeList.length},get:function(iIndex){return this.options.oAttributeList[iIndex]},add:function(oAttr){this.options.oAttributeList.push(oAttr)},insert:function(iIndex,oAttr){this.options.oAttributeList.splice(iIndex,0,oAttr)},remove:function(iIndex){iIndex<this.options.oAttributeList.length&&this.options.oAttributeList.splice(iIndex,1)},getAirspaceAttributeList:function(){for(var oAttrList=[],iIndex=0;iIndex<this.options.oAttributeList.length;iIndex++)oAttrList.push(this.options.oAttributeList[iIndex].getAirspaceAttributes());return oAttrList},getMinAltitude:function(){for(var oAttributes,dValue,dMin=Number.MAX_VALUE,oAttributeList=this.options.oAttributeList,cAttributeConst=leafLet.typeLibrary.AirspaceAttribute,iIndex=0;iIndex<oAttributeList.length;iIndex++)oAttributes=oAttributeList[iIndex],dValue=oAttributes.getValue(cAttributeConst.AIRSPACE_MIN_ALTITUDE),"number"==typeof dValue&&dValue<dMin&&(dMin=dValue);return Math.round(dMin)},getMaxAltitude:function(){for(var oAttributes,dValue,dMax=Number.MIN_VALUE,oAttributeList=this.options.oAttributeList,cAttributeConst=leafLet.typeLibrary.AirspaceAttribute,iIndex=0;iIndex<oAttributeList.length;iIndex++)oAttributes=oAttributeList[iIndex],dValue=oAttributes.getValue(cAttributeConst.AIRSPACE_MAX_ALTITUDE),"number"==typeof dValue&&dValue>dMax&&(dMax=dValue);return Math.round(dMax)}};return publicInterface},leafLet.typeLibrary.airspace.AttributeList=L.Class.extend(leafLet.internalPrivateClass.AirspaceAttributeList()),leafLet.internalPrivateClass.CylinderAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,1,1)},getPopupText:function(){var sPopupText="",oAttributes=this.getAttributes(0),oLatLng=this.getCoordinateList()[0],cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;return sPopupText="<center>"+(oLatLng?"<b>Lat</b>:&nbsp;"+oLatLng.lat.toFixed(5)+"<br/><b>Lon</b>:&nbsp;"+oLatLng.lng.toFixed(5):"")+"<br/><b>Radius</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)+this.getUnits()+"<br/><b>Min Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE)+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oArgs.oAirspaceAttributeList.get(0),oLatLng=oLatLngList[0];if(void 0!==oLatLng){oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CYLINDER);var oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),iWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:iWidth,oFeature:this};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oOptions.tempColor=oOptions.color,oOptions.tempWeight=oOptions.weight,oOptions.color="#"+oSelectAttributes.color,oOptions.weight=oSelectAttributes.width}var oLeafletObject=new L.Circle(oLatLng,oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS),oOptions);return this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject}},getFeatureBounds:function(){var cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oLatLng=this.getCoordinateList()[0],oAttributes=this.getAttributes(0),oNorthEast=new L.LatLng(oLatLng.lat,oLatLng.lng),oSouthWest=new L.LatLng(oLatLng.lat,oLatLng.lng),dDist=2*oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS);return oNorthEast.moveCoordinate(45,dDist),oSouthWest.moveCoordinate(225,dDist),new leafLet.typeLibrary.EmpBoundary(oSouthWest,oNorthEast)},_updateFeature:function(oArgs){var oLeafletObject=this.options.leafletObject,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oLatLng=oCoordList[0],oAttributes=oAttributeList.get(0);oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CYLINDER);var oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),iWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:iWidth};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oOptions.tempColor=oOptions.color,oOptions.tempWeight=oOptions.weight,oOptions.color="#"+oSelectAttributes.color,oOptions.weight=oSelectAttributes.width}return oLeafletObject.setLatLng(oLatLng),oLeafletObject.setRadius(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)),oLeafletObject.setStyle(oOptions),this.setAttributeList(oAttributeList),this.setProperties(oArgs.properties),this.setData(oArgs.data),oLeafletObject}};return publicInterface},leafLet.typeLibrary.airspace.Cylinder=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.CylinderAirspace()),leafLet.internalPrivateClass.PolygonAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,3,Number.MAX_VALUE)},getPopupText:function(){var sPopupText="",oAttributes=this.getAttributes(0),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;return sPopupText="<center><b>Min Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE)+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oArgs.oAirspaceAttributeList.get(0);if(!(oLatLngList.length<this.getMinPoints())){oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYGON);var oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),iWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oPolygonOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:iWidth,oFeature:this};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}var oLeafletObject=new L.Polygon(oLatLngList,oPolygonOptions);return this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject}},_updateFeature:function(oArgs){var oAttributes,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oLeafletObject=this.getLeafletObject(),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;oAttributes=oAttributeList.get(0),oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYGON);var oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),iWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oPolygonOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:iWidth};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}return oLeafletObject.setLatLngs(oLatLngList),oLeafletObject.setStyle(oPolygonOptions),this.setAttributeList(oAttributeList),this.setProperties(oArgs.properties),this.setData(oArgs.data),oLeafletObject}};return publicInterface},leafLet.typeLibrary.airspace.Polygon=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.PolygonAirspace()),leafLet.internalPrivateClass.CurtainAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,2,Number.MAX_VALUE)},getPopupText:function(){var sPopupText="",oAttributes=this.getAttributes(0),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;return sPopupText="<center><b>Min Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE)+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oArgs.oAirspaceAttributeList.get(0);oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CURTAIN);var oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),iWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,weight:iWidth,oFeature:this};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oOptions.tempColor=oOptions.color,oOptions.tempWeight=oOptions.weight,oOptions.color="#"+oSelectAttributes.color,oOptions.weight=oSelectAttributes.width}var oLeafletObject=new L.Polyline(oLatLngList,oOptions);return this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject},_updateFeature:function(oArgs){var oLeafletObject=this.options.leafletObject,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oAttributeList.get(0);oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_CURTAIN);var oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),iWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,weight:iWidth};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oOptions.tempColor=oOptions.color,oOptions.tempWeight=oOptions.weight,oOptions.color="#"+oSelectAttributes.color,oOptions.weight=oSelectAttributes.width}return oLeafletObject.setLatLngs(oCoordList),oLeafletObject.setStyle(oOptions),this.setAttributeList(oAttributeList),this.setProperties(oArgs.properties),this.setData(oArgs.data),oLeafletObject}};return publicInterface},leafLet.typeLibrary.airspace.Curtain=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.CurtainAirspace()),leafLet.internalPrivateClass.OrbitAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,2,2)},getPopupText:function(){var sPopupText="",oAttributes=this.getAttributes(0),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;return sPopupText="<center><b>Turn</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN)+"<br/><b>Width</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_WIDTH)+this.getUnits()+"<br/><b>Min Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE)+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var sTurn,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oNewLatLngList=oLatLngList,oAttributes=oArgs.oAirspaceAttributeList.get(0);if(!(oLatLngList.length<2)){if(oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_ORBIT),sTurn=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_ORBIT_TURN),sTurn!==emp.typeLibrary.orbitTurnType.CENTER){var dBearing,dDist=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH)/2,dAnglePt1Pt2=oLatLngList[0].bearingTo(oLatLngList[1]);switch(oNewLatLngList=[],sTurn){case emp.typeLibrary.orbitTurnType.RIGHT:dBearing=(dAnglePt1Pt2+90)%360;break;case emp.typeLibrary.orbitTurnType.LEFT:dBearing=(dAnglePt1Pt2+270)%360}oNewLatLngList.push(oLatLngList[0].destinationPoint(dBearing,dDist)),oNewLatLngList.push(oLatLngList[1].destinationPoint(dBearing,dDist))}var oLeafletObject=new leafLet.utils.OvalObject({leafletMap:this.options.instanceInterface.leafletInstance,width:oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH),attributes:oAttributes,isSelected:this.isSelected(),selectAttributes:this.getEngineInstanceInterface().selectAttributes,coordinates:oNewLatLngList,oFeature:this});return this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject}},_updateFeature:function(oArgs){var oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties);return oArgs.oAirspaceAttributeList=oAttributeList,this._createFeature(oArgs)}};return publicInterface},leafLet.typeLibrary.airspace.Orbit=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.OrbitAirspace()),leafLet.internalPrivateClass.RouteAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,2,Number.MAX_VALUE);
},getPopupText:function(){var sPopupText,oAttributeList=this.getAttributeList();return sPopupText="<center><b>Min Alt</b>:&nbsp;"+oAttributeList.getMinAltitude()+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributeList.getMaxAltitude()+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var oOvalLeafletObject,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oArgs.oAirspaceAttributeList.get(0),bIsSelected=this.isSelected();oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_ROUTE);for(var oLeafletObject=new L.FeatureGroup,iIndex=1;iIndex<oLatLngList.length;iIndex++){var oLegCoords=[oLatLngList[iIndex-1],oLatLngList[iIndex]];oOvalLeafletObject=new leafLet.utils.OvalObject({leafletMap:this.options.instanceInterface.leafletInstance,width:oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH),attributes:oAttributes,isSelected:bIsSelected,selectAttributes:this.getEngineInstanceInterface().selectAttributes,coordinates:oLegCoords,oFeature:this}),oLeafletObject.addLayer(oOvalLeafletObject)}return this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject},_updateFeature:function(oArgs){var oOvalLeafletObject,oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oAttributes=oAttributeList.get(0),oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),bIsSelected=this.isSelected();oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_ROUTE);var oLeafletObject=this.getLeafletObject();oLeafletObject.clearLayers();for(var iIndex=1;iIndex<oLatLngList.length;iIndex++){var oLegCoords=[oLatLngList[iIndex-1],oLatLngList[iIndex]];oOvalLeafletObject=new leafLet.utils.OvalObject({leafletMap:this.options.instanceInterface.leafletInstance,width:oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_WIDTH),attributes:oAttributes,isSelected:bIsSelected,selectAttributes:this.getEngineInstanceInterface().selectAttributes,coordinates:oLegCoords,oFeature:this}),oLeafletObject.addLayer(oOvalLeafletObject)}return this.setAttributeList(oAttributeList),this.setData(oArgs.data),this.setProperties(oArgs.properties),oLeafletObject}};return publicInterface},leafLet.typeLibrary.airspace.Route=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.RouteAirspace()),leafLet.internalPrivateClass.TrackAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,2,Number.MAX_VALUE)},getPopupText:function(){var sPopupText,oAttributeList=this.getAttributeList();return sPopupText="<center><b>Min Alt</b>:&nbsp;"+oAttributeList.getMinAltitude()+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributeList.getMaxAltitude()+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){for(var oOvalLeafletObject,oAttributes,dLeftWidth,dRightWidth,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributeList=oArgs.oAirspaceAttributeList,oLeafletObject=new L.FeatureGroup,bIsSelected=this.isSelected(),iIndex=1;iIndex<oLatLngList.length;iIndex++){var oLegCoords=[oLatLngList[iIndex-1],oLatLngList[iIndex]];if(iIndex>oAttributeList.length()&&(oAttributes=oAttributeList.get(iIndex-1),oAttributes=new leafLet.typeLibrary.airspace.Attributes(this.getProperties(),oAttributes.getAttributes()),oAttributeList.add(oAttributes)),oAttributes=oAttributeList.get(iIndex-1),oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_TRACK),dLeftWidth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_WIDTH),dRightWidth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_WIDTH),dRightWidth!==dLeftWidth){var Bearing,dDist=Math.abs(dRightWidth-dLeftWidth)/2,dBearingPt1Pt2=oLatLngList[iIndex-1].bearingTo(oLatLngList[iIndex]);Bearing=dRightWidth>dLeftWidth?(dBearingPt1Pt2+90)%360:(dBearingPt1Pt2+270)%360,oLegCoords=[oLatLngList[iIndex-1].destinationPoint(Bearing,dDist),oLatLngList[iIndex].destinationPoint(Bearing,dDist)]}oOvalLeafletObject=new leafLet.utils.OvalObject({leafletMap:this.options.instanceInterface.leafletInstance,width:dLeftWidth+dRightWidth,attributes:oAttributes,isSelected:bIsSelected,selectAttributes:this.getEngineInstanceInterface().selectAttributes,coordinates:oLegCoords,oFeature:this}),oLeafletObject.addLayer(oOvalLeafletObject)}return this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject},_updateFeature:function(oArgs){var oOvalLeafletObject,oAttributes,dLeftWidth,dRightWidth,oLatLngList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oLeafletObject=this.getLeafletObject(),bIsSelected=this.isSelected();oLeafletObject.clearLayers();for(var iIndex=1;iIndex<oLatLngList.length;iIndex++){var oLegCoords=[oLatLngList[iIndex-1],oLatLngList[iIndex]];if(iIndex>oAttributeList.length()&&(oAttributes=oAttributeList.get(iIndex-1),oAttributes=new leafLet.typeLibrary.airspace.Attributes(oArgs.properties,oAttributes.getAttributes()),oAttributeList.add(oAttributes)),oAttributes=oAttributeList.get(iIndex-1),oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_TRACK),dLeftWidth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_WIDTH),dRightWidth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_WIDTH),dRightWidth!==dLeftWidth){var Bearing,dDist=Math.abs(dRightWidth-dLeftWidth)/2,dBearingPt1Pt2=oLatLngList[iIndex-1].bearingTo(oLatLngList[iIndex]);Bearing=dRightWidth>dLeftWidth?(dBearingPt1Pt2+90)%360:(dBearingPt1Pt2+270)%360,oLegCoords=[oLatLngList[iIndex-1].destinationPoint(Bearing,dDist),oLatLngList[iIndex].destinationPoint(Bearing,dDist)]}oOvalLeafletObject=new leafLet.utils.OvalObject({leafletMap:this.options.instanceInterface.leafletInstance,width:dLeftWidth+dRightWidth,attributes:oAttributes,isSelected:bIsSelected,selectAttributes:this.getEngineInstanceInterface().selectAttributes,coordinates:oLegCoords,oFeature:this}),oLeafletObject.addLayer(oOvalLeafletObject)}return this.setAttributeList(oAttributeList),this.setProperties(oArgs.properties),this.setData(oArgs.data),oLeafletObject}};return publicInterface},leafLet.typeLibrary.airspace.Track=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.TrackAirspace()),leafLet.internalPrivateClass.RadArcAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,1,1)},getPopupText:function(){var sPopupText="",oAttributes=this.getAttributes(0),oLatLng=this.getCoordinateList()[0],cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute;return sPopupText="<center><b>Lat</b>:&nbsp;"+oLatLng.lat.toFixed(5)+"<br/><b>Lon</b>:&nbsp;"+oLatLng.lng.toFixed(5)+"<br/><b>Left Azimuth</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH)+this.getAngleUnits()+"<br/><b>Right Azimuth</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH)+this.getAngleUnits()+"<br/><b>Outter Radius</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)+this.getUnits()+"<br/><b>Inner Radius</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS)+this.getUnits()+"<br/><b>Min Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE)+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var oPartialCoordList,oLeafletObject,oLatLngList=[],cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oCenterLatLng=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data)[0],oAttributes=oArgs.oAirspaceAttributeList.get(0);if(void 0!==oCenterLatLng){oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_RADARC);var dLeftAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dInnerRadius=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS),dOutterRadius=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS),oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),oPolygonOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oFeature:this};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterfacee().selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}return oPartialCoordList=leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,oCenterLatLng,dInnerRadius,dLeftAzimuth,dRightAzimuth,!0),oLatLngList=oLatLngList.concat(oPartialCoordList),oPartialCoordList=leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,oCenterLatLng,dOutterRadius,dRightAzimuth,dLeftAzimuth,!1),oLatLngList=oLatLngList.concat(oPartialCoordList),oLeafletObject=new L.Polygon(oLatLngList,oPolygonOptions),this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject}},_updateFeature:function(oArgs){var oPartialCoordList,oLatLngList=[],oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oLeafletObject=this.getLeafletObject(),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oAttributes=oAttributeList.get(0),oCenterLatLng=oCoordList[0];if(void 0!==oCenterLatLng){oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_RADARC);var dLeftAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dInnerRadius=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_INNER_RADIUS),dOutterRadius=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS),oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),oPolygonOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH)};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterfacee().selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}return oPartialCoordList=leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,oCenterLatLng,dInnerRadius,dLeftAzimuth,dRightAzimuth,!0),oLatLngList=oLatLngList.concat(oPartialCoordList),oPartialCoordList=leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,oCenterLatLng,dOutterRadius,dRightAzimuth,dLeftAzimuth,!1),oLatLngList=oLatLngList.concat(oPartialCoordList),oLeafletObject.setLatLngs(oLatLngList),oLeafletObject.setStyle(oPolygonOptions),this.setAttributeList(oAttributeList),this.setProperties(oArgs.properties),this.setData(oArgs.data),oLeafletObject}}};return publicInterface},leafLet.typeLibrary.airspace.RadArc=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.RadArcAirspace()),leafLet.internalPrivateClass.PolyArcAirspace=function(){var publicInterface={initialize:function(args){var options={};L.Util.setOptions(this,options),leafLet.typeLibrary.AirspaceFeature.prototype.initialize.call(this,args,3,Number.MAX_VALUE)},getPopupText:function(){var sPopupText="",oAttributes=this.getAttributes(0),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oLatLng=this.getCoordinateList()[0];return sPopupText="<center><b>Lat</b>:&nbsp;"+oLatLng.lat.toFixed(5)+"<br/><b>Lon</b>:&nbsp;"+oLatLng.lng.toFixed(5)+"<br/><b>Left Azimuth</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH)+this.getAngleUnits()+"<br/><b>Right Azimuth</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH)+this.getAngleUnits()+"<br/><b>Radius</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS)+this.getUnits()+"<br/><b>Min Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MIN_ALTITUDE)+this._getAltUnitsAndModeText()+"<br/><b>Max Alt</b>:&nbsp;"+oAttributes.getValue(cAirspaceAttribute.AIRSPACE_MAX_ALTITUDE)+this._getAltUnitsAndModeText()+"</center><br/>"+this._getPopupDescription()},_createFeature:function(oArgs){var oPartialCoordList,oCoord,oLeafletObject,oLatLngList=[],cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oArgs.oAirspaceAttributeList.get(0);if(!(oCoordList.length<this.getMinPoints())){oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYARC);var dLeftAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dRadius=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS),oCenterLatLng=oCoordList[0],oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),oPolygonOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),oFeature:this};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}oPartialCoordList=leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,oCenterLatLng,dRadius,dLeftAzimuth,dRightAzimuth,!0),oLatLngList=oLatLngList.concat(oPartialCoordList),oCoord=oCenterLatLng.destinationPoint(dRightAzimuth,dRadius),oLatLngList.push(oCoord);for(var iIndex=1;iIndex<oCoordList.length;iIndex++)oLatLngList.push(oCoordList[iIndex]);return oLeafletObject=new L.Polygon(oLatLngList,oPolygonOptions),this.setAttributeList(oArgs.oAirspaceAttributeList),oLeafletObject}},_updateFeature:function(oArgs){var oPartialCoordList,oCoord,oLatLngList=[],cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oAttributeList=new leafLet.typeLibrary.airspace.AttributeList(oArgs.properties),oLeafletObject=this.getLeafletObject(),oCoordList=leafLet.utils.geoJson.convertCoordinatesToLatLng(oArgs.data),oAttributes=oAttributeList.get(0);oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_POLYARC);var dLeftAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dRadius=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RADIUS),oCenterLatLng=oCoordList[0],oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),oPolygonOptions={stroke:!0,color:oLineColor.sColor,opacity:oLineColor.opacity,fill:!0,fillColor:oFillColor.sColor,fillOpacity:oFillColor.opacity,weight:oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH)};if(this.isSelected()){var oSelectAttributes=this.getEngineInstanceInterface().selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}if(oCoordList.length>=this.getMinPoints()){oPartialCoordList=leafLet.utils.getArcCoordinates(this.options.instanceInterface.leafletInstance,oCenterLatLng,dRadius,dLeftAzimuth,dRightAzimuth,!0),oLatLngList=oLatLngList.concat(oPartialCoordList),oCoord=oCenterLatLng.destinationPoint(dRightAzimuth,dRadius),oLatLngList.push(oCoord);for(var iIndex=1;iIndex<oCoordList.length;iIndex++)oLatLngList.push(oCoordList[iIndex]);oLeafletObject.setLatLngs(oLatLngList),oLeafletObject.setStyle(oPolygonOptions)}return this.setAttributeList(oAttributeList),this.setProperties(oArgs.properties),this.setData(oArgs.data),oLeafletObject}};return publicInterface},leafLet.typeLibrary.airspace.PolyArc=leafLet.typeLibrary.AirspaceFeature.extend(leafLet.internalPrivateClass.PolyArcAirspace()),leafLet.utils=leafLet.utils||{},leafLet.utils.Units={FEET:"ft",METERS:"m"},leafLet.utils.AngleUnits={DEGREES:"&deg;",MILS:"mils"},leafLet.utils.METERS_PER_FEET=.3048,leafLet.utils.FEET_PER_METERS=3.28084,leafLet.utils.MILS_PER_DEGREE=6400/360,leafLet.utils.DEGREE_PER_MILS=.05625,leafLet.utils.AltitudeModeAbbr=function(sMode){var sText="";switch(sMode){case emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND:sText="AGL";break;case emp.typeLibrary.featureAltitudeModeType.ABSOLUTE:sText="MSL"}return sText},leafLet.utils.normilizeLongitude=function(dLon){if(dLon<-180)for(;dLon<-180;)dLon+=360;else dLon>180&&(dLon=(dLon+180)%360-180);return dLon},leafLet.utils.convertViewBound=function(oBounds,oData){var oView=oData||{};return oView.west=leafLet.utils.normilizeLongitude(oBounds.getWest()),oView.south=oBounds.getSouth(),oView.east=leafLet.utils.normilizeLongitude(oBounds.getEast()),oView.north=oBounds.getNorth(),oView},leafLet.utils.isInt=function(sStr){var y=parseInt(sStr,10);return!isNaN(y)&&sStr==y&&sStr.toString()==y.toString()},leafLet.utils.anyCoordinateInBounds=function(oBounds,oCoordinates){var oCoord,bRet=!1,oaCoordList=oCoordinates.coordinates;switch(oCoordinates.type.toLowerCase()){case"point":oCoord=new L.LatLng(oaCoordList[1],oaCoordList[0]),bRet=oBounds.contains(oCoord);break;case"linestring":for(var iIndex=0;iIndex<oaCoordList.length&&(oCoord=new L.LatLng(oaCoordList[iIndex][1],oaCoordList[iIndex][0]),!(bRet=oBounds.contains(oCoord)));iIndex++);break;case"polygon":oaCoordList=oaCoordList[0];for(var iIndex=0;iIndex<oaCoordList.length&&(oCoord=new L.LatLng(oaCoordList[iIndex][1],oaCoordList[iIndex][0]),!(bRet=oBounds.contains(oCoord)));iIndex++);}return bRet},leafLet.utils.wrapLongitude=function(oMapBoundry,oLatLng){var oMapCenter=oMapBoundry.getCenter(),oNewLatLng=oLatLng.wrap();if(oMapBoundry)if(oMapCenter.lng>0){if(oMapBoundry.getEast()>180){var oNorthEastBoundry=oMapBoundry.getNorthEast().wrap();oNewLatLng.lng<=oNorthEastBoundry.lng&&(oNewLatLng.lng=oNewLatLng.lng+360)}}else if(oMapBoundry.getWest()<-180){var oNorthWestBoundry=oMapBoundry.getNorthWest().wrap();oNewLatLng.lng>=oNorthWestBoundry.lng&&(oNewLatLng.lng=oNewLatLng.lng-360)}return oNewLatLng},leafLet.utils.wrapCoordinates=function(oMapBoundry,oLatLngList,bWrappedAlready){var iIndex,lng,tempLng,bLnginView,iCoorCnt=oLatLngList.length,bCoordWrapped=bWrappedAlready||!1,empBoundary=new leafLet.typeLibrary.EmpBoundary(oMapBoundry),bIDLinView=empBoundary.containsIDL();for(iIndex=0;iIndex<iCoorCnt;iIndex++)oLatLngList[iIndex]=oLatLngList[iIndex].wrap(),lng=oLatLngList[iIndex].lng,bLnginView=empBoundary.containsCoordiante(oLatLngList[iIndex]),bIDLinView?(tempLng=(empBoundary.getWest()-empBoundary.getEast())/2,tempLng+=empBoundary.getEast(),oMapBoundry.getEast()>180?lng<tempLng&&(oLatLngList[iIndex].lng+=360):lng>tempLng&&(oLatLngList[iIndex].lng-=360)):bLnginView||(tempLng=empBoundary.getWest()+180,tempLng+=180-empBoundary.getEast(),tempLng/=2,empBoundary.getWest()-tempLng>=-180?(tempLng=empBoundary.getWest()-tempLng,lng<tempLng&&(oLatLngList[iIndex].lng+=360)):(tempLng=empBoundary.getEast()+tempLng,lng>tempLng&&(oLatLngList[iIndex].lng-=360)));return bCoordWrapped},leafLet.utils.dateLineInFeature=function(oLatLngList){var lng1,lng2,bDataLineInFeature=!1,iCount=oLatLngList.length,iCountMinus1=iCount-1;if(0===oLatLngList.length)return!1;for(var iIndex=0;iIndex<iCountMinus1;iIndex++)if(lng1=oLatLngList[iIndex].lng+180,lng2=oLatLngList[iIndex+1].lng+180,lng1>180&&lng2<180||lng1<180&&lng2>180){bDataLineInFeature=!0;break}return bDataLineInFeature},leafLet.utils.convertToColorString=function(dOpacity,sColor){var sNewColor=sColor.replace("#","0x"),iColor=4096*Math.round(255*dOpacity)+parseInt(sNewColor);return sNewColor=iColor.toString(16)},leafLet.utils.mergeProperties=function(oProperties1,oProperties2){var oProperties=emp.helpers.copyObject(oProperties1);for(var sProp in oProperties2)oProperties2.hasOwnProperty(sProp)&&(oProperties[sProp]=emp.helpers.copyObject(oProperties2[sProp]));return oProperties},leafLet.utils.metersToFeet=function(iMeters){return 3.28084*iMeters},leafLet.utils.feetToMeters=function(iFeet){return.3048*iFeet},leafLet.utils.convertColor=function(sColor){var dValue=255,oRet={sColor:"",opacity:1};return 0===sColor.indexOf("0x")&&(sColor=sColor.substr(2)),sColor.length>7?(dValue=parseInt("0x"+sColor.substr(0,2)),sColor=sColor.substr(2)):sColor.length>6&&(dValue=parseInt("0x"+sColor.substr(0,1)),sColor=sColor.substr(1)),oRet.opacity=dValue/255,oRet.sColor="#"+sColor,oRet},leafLet.utils.angleBetween=function(oVertice,oPt1,oPt2){var dAngleVPt1=oVertice.bearingTo(oPt1),dAngleVPt2=oVertice.bearingTo(oPt2),dAngle=dAngleVPt2-dAngleVPt1;return dAngle},leafLet.utils.getArcCoordinates=function(oMap,oCenter,dRadius,dStartAzimuth,dEndAzimuth,bClockwise){var oNewPt,dNewAngleDelta,dAngleInc,oLatLngList=[],oPt1=oCenter.destinationPoint(dStartAzimuth,dRadius),oPt2=oCenter.destinationPoint(dEndAzimuth,dRadius),oPoint1=oMap.latLngToContainerPoint(oPt1),oPoint2=oMap.latLngToContainerPoint(oPt2),dAngleVPt1Pt2=Math.abs(dEndAzimuth-dStartAzimuth),dPointDist=Math.round(oPoint1.distanceTo(oPoint2));bClockwise&&dEndAzimuth<dStartAzimuth?dAngleVPt1Pt2=360-dAngleVPt1Pt2:!bClockwise&&dStartAzimuth<dEndAzimuth&&(dAngleVPt1Pt2=360-dAngleVPt1Pt2),bClockwise||(dAngleVPt1Pt2*=-1),dAngleInc=dAngleVPt1Pt2/dPointDist,oLatLngList.push(oPt1);for(var iIndex=0,dNewAngleDelta=dAngleInc;iIndex<dPointDist;iIndex++)oNewPt=oCenter.destinationPoint((dStartAzimuth+dNewAngleDelta+360)%360,dRadius),oLatLngList.push(oNewPt),dNewAngleDelta+=dAngleInc;return oLatLngList.push(oPt2),oLatLngList},leafLet.utils.geoColorToHexColorString=function(geoColor){var sColor;return sColor=("00"+geoColor.red.toString(16)).substr(-2),sColor+=("00"+geoColor.green.toString(16)).substr(-2),sColor+=("00"+geoColor.blue.toString(16)).substr(-2)},leafLet.utils=leafLet.utils||{},leafLet.utils.geoJson=function(){var publicInterface={convertCoordinatesToString:function(oGeoJson){var sStr="";if(!oGeoJson.hasOwnProperty("type"))throw new Error("GeoJSON object with no type property.");switch(oGeoJson.type.toLowerCase()){case"point":sStr=oGeoJson.coordinates[0]+","+oGeoJson.coordinates[1],3===oGeoJson.coordinates.length&&(sStr+=","+oGeoJson.coordinates[2]);break;case"linestring":for(var iIndex=0;iIndex<oGeoJson.coordinates.length;iIndex++)sStr.length>0&&(sStr+=" "),sStr+=oGeoJson.coordinates[iIndex][0]+","+oGeoJson.coordinates[iIndex][1],3===oGeoJson.coordinates[iIndex].length&&(sStr+=","+oGeoJson.coordinates[iIndex][2]);break;case"polygon":for(var iIndex=0;iIndex<oGeoJson.coordinates[0].length;iIndex++)sStr.length>0&&(sStr+=" "),sStr+=oGeoJson.coordinates[0][iIndex][0]+","+oGeoJson.coordinates[0][iIndex][1],3===oGeoJson.coordinates[0][iIndex].length&&(sStr+=","+oGeoJson.coordinates[0][iIndex][2]);break;default:throw new Error("Invalid type for coordinate parsing.")}return sStr},convertCoordinateToLatLng:function(oCoord){var oCoordinates;return oCoordinates=3===oCoord.length?new L.LatLng(oCoord[1],oCoord[0],oCoord[2]):new L.LatLng(oCoord[1],oCoord[0])},convertCoordinatesToLatLng:function(oGeoJson){var oCoord,oCoordinates=[];if(!oGeoJson.hasOwnProperty("type"))throw new Error("GeoJSON object with no type property.");switch(oGeoJson.type.toLowerCase()){case"point":oGeoJson.coordinates.length>0&&oCoordinates.push(publicInterface.convertCoordinateToLatLng(oGeoJson.coordinates));break;case"linestring":for(var iIndex=0;iIndex<oGeoJson.coordinates.length;iIndex++)oCoord=publicInterface.convertCoordinateToLatLng(oGeoJson.coordinates[iIndex]),oCoordinates.push(oCoord);break;case"polygon":for(var iIndex=0;iIndex<oGeoJson.coordinates[0].length;iIndex++)oCoord=publicInterface.convertCoordinateToLatLng(oGeoJson.coordinates[0][iIndex]),oCoordinates.push(oCoord);break;case"feature":switch(oGeoJson.geometry.type.toLowerCase()){case"point":oGeoJson.geometry.coordinates.length>0&&oCoordinates.push(publicInterface.convertCoordinateToLatLng(oGeoJson.geometry.coordinates));break;case"linestring":for(var iIndex=0;iIndex<oGeoJson.geometry.coordinates.length;iIndex++)oCoord=publicInterface.convertCoordinateToLatLng(oGeoJson.geometry.coordinates[iIndex]),oCoordinates.push(oCoord);break;case"polygon":for(var iIndex=0;iIndex<oGeoJson.geometry.coordinates[0].length;iIndex++)oCoord=publicInterface.convertCoordinateToLatLng(oGeoJson.geometry.coordinates[0][iIndex]),oCoordinates.push(oCoord);break;default:throw new Error("Invalid type for coordinate parsing.")}break;default:throw new Error("Invalid type for coordinate parsing.")}return oCoordinates},convertLatLngToGeoJson:function(oLatLng){var oGeoJsonCoord=[];return oGeoJsonCoord.push(oLatLng.lng),oGeoJsonCoord.push(oLatLng.lat),isNaN(oLatLng.alt)||oGeoJsonCoord.push(oLatLng.alt),oGeoJsonCoord},convertLatLngListToGeoJson:function(oGeoJson,oLatLngList){switch(oGeoJson.type.toLowerCase()){case"point":oGeoJson.coordinates=publicInterface.convertLatLngToGeoJson(oLatLngList[0]);break;case"linestring":oGeoJson.coordinates=[];for(var iIndex=0;iIndex<oLatLngList.length;iIndex++)oGeoJson.coordinates.push(publicInterface.convertLatLngToGeoJson(oLatLngList[iIndex]));break;case"polygon":oGeoJson.coordinates=[[]];for(var iIndex=0;iIndex<oLatLngList.length;iIndex++)oGeoJson.coordinates[0].push(publicInterface.convertLatLngToGeoJson(oLatLngList[iIndex]));break;case"feature":publicInterface.convertLatLngListToGeoJson(oGeoJson.geometry,oLatLngList)}},mergeGeoJSONProperties:function(instanceInterface,oFeatureProperties,oGeoJSONProperties){var oDefaultIcon=emp.utilities.icon.getDefaultIcon(),oProperties={},iXOffset=oDefaultIcon.offset.x,iYOffset=oDefaultIcon.offset.y,sXUnits=oDefaultIcon.offset.xUnits,sYUnits=oDefaultIcon.offset.yUnits,sDefaultIconUrl=oDefaultIcon.iconUrl,sURL=instanceInterface.bUseProxy?instanceInterface.getProxyURL()+"?mime=image/*&url="+escape(sDefaultIconUrl):sDefaultIconUrl;if(oGeoJSONProperties){if(oGeoJSONProperties.hasOwnProperty("id")&&(oProperties.sSubItemID=oGeoJSONProperties.id),oGeoJSONProperties.hasOwnProperty("lineColor")){oProperties.color="#"+oGeoJSONProperties.lineColor.substr(2);var dOpacity=parseInt("0x"+oGeoJSONProperties.lineColor.substr(0,2))/255;oProperties.opacity=dOpacity}if(oGeoJSONProperties.hasOwnProperty("fillColor")){oProperties.fillColor="#"+oGeoJSONProperties.fillColor.substr(2);var dOpacity=parseInt("0x"+oGeoJSONProperties.fillColor.substr(0,2))/255;oProperties.fillOpacity=dOpacity}oGeoJSONProperties.hasOwnProperty("lineWidth")&&(oProperties.weigh=parseInt(oGeoJSONProperties.lineWidth)),oGeoJSONProperties.hasOwnProperty("iconUrl")&&(sURL=instanceInterface.bUseProxy?instanceInterface.getProxyURL()+"?mime=image/*&url="+escape(oGeoJSONProperties.iconUrl):oGeoJSONProperties.iconUrl),oGeoJSONProperties.hasOwnProperty("iconXOffset")&&(iXOffset=oGeoJSONProperties.iconXOffset),oGeoJSONProperties.hasOwnProperty("iconYOffset")&&(iYOffset=oGeoJSONProperties.iconYOffset),oGeoJSONProperties.hasOwnProperty("xUnits")&&(sXUnits=oGeoJSONProperties.xUnits),oGeoJSONProperties.hasOwnProperty("yUnits")&&(sYUnits=oGeoJSONProperties.yUnits)}if(oFeatureProperties){if(oFeatureProperties.hasOwnProperty("lineColor")){oProperties.color="#"+oFeatureProperties.lineColor.substr(2);var dOpacity=parseInt("0x"+oFeatureProperties.lineColor.substr(0,2))/255;oProperties.opacity=dOpacity}if(oFeatureProperties.hasOwnProperty("fillColor")){oProperties.fillColor="#"+oFeatureProperties.fillColor.substr(2);var dOpacity=parseInt("0x"+oFeatureProperties.fillColor.substr(0,2))/255;oProperties.fillOpacity=dOpacity}oFeatureProperties.hasOwnProperty("lineWidth")&&(oProperties.weight=parseInt(oFeatureProperties.lineWidth)),oFeatureProperties.hasOwnProperty("iconUrl")&&(sURL=instanceInterface.bUseProxy?instanceInterface.getProxyURL()+"?mime=image/*&url="+escape(oFeatureProperties.iconUrl):oFeatureProperties.iconUrl),oFeatureProperties.hasOwnProperty("iconXOffset")&&(iXOffset=oFeatureProperties.iconXOffset),oFeatureProperties.hasOwnProperty("iconYOffset")&&(iYOffset=oFeatureProperties.iconYOffset),oFeatureProperties.hasOwnProperty("xUnits")&&(sXUnits=oFeatureProperties.xUnits),oFeatureProperties.hasOwnProperty("yUnits")&&(sYUnits=oFeatureProperties.yUnits)}return oProperties.iconOptions={iconUrl:sURL,iconAnchor:new L.Point(iXOffset,iYOffset),iconAnchorType:{x:sXUnits,y:sYUnits}},oProperties},getGeometryType:function(oGeoJson){var sType;switch(oGeoJson.type.toLowerCase()){case"point":sType="Point";break;case"linestring":sType="LineString";break;case"polygon":sType="Polygon";break;case"feature":sType=publicInterface.getGeometryType(oGeoJson.geometry);break;default:sType=oGeoJson.type}return sType},isAOI:function(oItem){var bRet=!1,oGeoJson=oItem.data;return oGeoJson.hasOwnProperty("type")&&"feature"===oGeoJson.type.toLowerCase()&&oGeoJson.hasOwnProperty("properties")&&oGeoJson.properties.hasOwnProperty("aoi")&&(bRet=!0),bRet}};return publicInterface}(),leafLet.utils=leafLet.utils||{},leafLet.utils.milstd=function(){var privateInterface={getAutoWidth:function(oMap){var oBounds=oMap.getBounds(),dCenterLat=(oBounds.getNorth()-oBounds.getSouth())/2,oCenterWest=new L.LatLng(dCenterLat,leafLet.utils.normilizeLongitude(oBounds.getWest())),oCenterEast=new L.LatLng(dCenterLat,leafLet.utils.normilizeLongitude(oBounds.getEast()));return Math.round(oCenterWest.distanceTo(oCenterEast)/32)},checkModifier:function(sBasicSymbol,sModifier,oModifiers,i2525Version,oMap){var sBaseModifier,sDigit,iDigit,oTGModifiers=armyc2.c2sd.renderer.utilities.ModifiersTG,oBasicCodes=leafLet.utils.milstd.basicSymbolCode;if(sBaseModifier=sModifier,sDigit="0",(leafLet.utils.isInt(sBaseModifier.charAt(sBaseModifier.length-1))||"#"===sBaseModifier.charAt(sBaseModifier.length-1))&&(sDigit=sBaseModifier.substr(sBaseModifier.length-1),sBaseModifier=sBaseModifier.substr(0,sBaseModifier.length-1)),iDigit=parseInt(sDigit,10),isNaN(iDigit)&&(iDigit=0),void 0===oModifiers[sBaseModifier])switch(sBaseModifier){case oTGModifiers.T_UNIQUE_DESIGNATION_1:oModifiers[sModifier]="";break;case oTGModifiers.AM_DISTANCE:oModifiers[sBaseModifier]=[];break;case oTGModifiers.AN_AZIMUTH:oModifiers[sBaseModifier]=[];break;case oTGModifiers.S_OFFSET_INDICATOR:oModifiers[sModifier]="";break;case oTGModifiers.V_EQUIP_TYPE:oModifiers[sModifier]="";break;case oTGModifiers.W_DTG_1:oModifiers[sModifier]="";break;case oTGModifiers.H_ADDITIONAL_INFO_1:if("2"===sDigit&&0===i2525Version)switch(sBasicSymbol){case oBasicCodes.AIR_CORRIDOR:case oBasicCodes.MINIMUM_RISK_ROUTE:case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:void 0===oModifiers[oTGModifiers.AM_DISTANCE]?oModifiers[sModifier]=privateInterface.getAutoWidth(oMap):0===oModifiers[oTGModifiers.AM_DISTANCE].length&&oModifiers[oTGModifiers.AM_DISTANCE].push(privateInterface.getAutoWidth(oMap));
}else oModifiers[sModifier]="";break;case oTGModifiers.X_ALTITUDE_DEPTH:oModifiers[sBaseModifier]=[]}else switch(sBaseModifier){case oTGModifiers.AM_DISTANCE:case oTGModifiers.AN_AZIMUTH:case oTGModifiers.X_ALTITUDE_DEPTH:if(!(oModifiers[sBaseModifier]instanceof Array))if(void 0===oModifiers[sBaseModifier])oModifiers[sBaseModifier]=[];else{var Value=oModifiers[sBaseModifier];oModifiers[sBaseModifier]=[Value]}}if(oModifiers[sBaseModifier]instanceof Array)switch(sBaseModifier){case oTGModifiers.AM_DISTANCE:var dBaseValue;switch(sBasicSymbol){case oBasicCodes.AIR_CORRIDOR:case oBasicCodes.MINIMUM_RISK_ROUTE:case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:void 0===oModifiers[oTGModifiers.AM_DISTANCE]?oModifiers[sModifier]=privateInterface.getAutoWidth(oMap):0===oModifiers[oTGModifiers.AM_DISTANCE].length&&oModifiers[oTGModifiers.AM_DISTANCE].push(privateInterface.getAutoWidth(oMap));break;case oBasicCodes.CIRCULAR_RANGE_FAN:case oBasicCodes.SECTOR_RANGE_FAN:default:dBaseValue=5e3,sDigit.indexOf("#")!==-1?0===oModifiers[sBaseModifier].length&&oModifiers[sBaseModifier].push(dBaseValue):void 0===oModifiers[sBaseModifier][iDigit]&&oModifiers[sBaseModifier].splice(iDigit,0,dBaseValue*(iDigit+1))}break;case oTGModifiers.AN_AZIMUTH:switch(sBasicSymbol){case oBasicCodes.SECTOR_RANGE_FAN:if(sDigit.indexOf("#")!==-1)for(var iIndex=0;iIndex<2;iIndex++)iIndex>=oModifiers[sBaseModifier].length&&oModifiers[sBaseModifier].splice(iIndex,0,iIndex%2===0?315:45);else void 0===oModifiers[sBaseModifier][iDigit]&&oModifiers[sBaseModifier].splice(iDigit,0,iDigit%2===0?315:45);break;default:sDigit.indexOf("#")!==-1?0===oModifiers[sBaseModifier].length&&oModifiers[sBaseModifier].splice(0,0,0):void 0===oModifiers[sBaseModifier][iDigit]&&oModifiers[sBaseModifier].splice(iDigit,0,0)}break;case oTGModifiers.X_ALTITUDE_DEPTH:}},createMilStdEditor:function(oPrivateInterface,oTransaction,oFeature,oEmpItem,sBasicSymbolCode,oSymbolDef,i2525Version){var oEditor=void 0,isMultiPoint=armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(sBasicSymbolCode,i2525Version),oSymbolDefTable=armyc2.c2sd.renderer.utilities.SymbolDefTable,oParameters={transaction:oTransaction,EmpDrawEditItem:oEmpItem,feature:oFeature,instanceInterface:oPrivateInterface,basicSymbolCode:sBasicSymbolCode,SymbolDef:oSymbolDef,multiPoint:isMultiPoint};if(isMultiPoint)switch(oSymbolDef.drawCategory){case oSymbolDefTable.DRAW_CATEGORY_LINE:case oSymbolDefTable.DRAW_CATEGORY_ARROW:oEditor=new leafLet.editor.MilStdDCLine(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_AUTOSHAPE:oEditor=new leafLet.editor.MilStdDCAutoShape(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_POLYGON:oEditor=new leafLet.editor.MilStdDCPolygon(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_ROUTE:oEditor=new leafLet.editor.MilStdDCRoute(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTLINE:case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTARROW:oEditor=new leafLet.editor.MilStdDC2PointLine(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_POINT:oEditor=new leafLet.editor.MilStdSinglePoint(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_SUPERAUTOSHAPE:oEditor=new leafLet.editor.MilStdDCSuperAutoShape(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:oEditor=new leafLet.editor.MilStdDCCircularAutoShape(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:oEditor=new leafLet.editor.MilStdDCRectParamAutoShape(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:oEditor=new leafLet.editor.MilStdDCSectorParamAutoShape(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:oEditor=new leafLet.editor.MilStdDCCircularRangeFan(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:oEditor=new leafLet.editor.MilStdDC2PointRectAutoShape(oParameters);break;case oSymbolDefTable.DRAW_CATEGORY_3D_AIRSPACE:}else oEditor=new leafLet.editor.MilStdSinglePoint(oParameters);return oEditor}},publicInterface={areModifierValuesEqual:function(oValue1,oValue2){if(oValue1 instanceof Array!=oValue2 instanceof Array)return!1;if(typeof oValue1!=typeof oValue2)return!1;if(oValue1 instanceof Array){if(oValue1.length!==oValue2.length)return!1;for(var iIndex=0;iIndex<oValue1.length;iIndex++)if(oValue1[iIndex]!==oValue2[iIndex])return!1}else if("object"==typeof oValue1){var sValue1=JSON.stringify(oValue1),sValue2=JSON.stringify(oValue2);if(sValue1!==sValue2)return!1}else if(oValue1!==oValue2)return!1;return!0},getRequiredModifiers:function(sBasicSymbol,i2525Version){var sReqModifiers="",oSymbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(sBasicSymbol,i2525Version),oSymDefTable=armyc2.c2sd.renderer.utilities.SymbolDefTable,oBasicCodes=leafLet.utils.milstd.basicSymbolCode;if(null!==oSymbolDef){switch(oSymbolDef.drawCategory){case oSymDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:sReqModifiers="AM";break;case oSymDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:sReqModifiers="AM.AM1.AN";break;case oSymDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:sReqModifiers="AM#.AN#";break;case oSymDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:sReqModifiers="AM.AM1.AM2";break;case oSymDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:sReqModifiers="AM"}switch(sBasicSymbol){case oBasicCodes.AIR_CORRIDOR:case oBasicCodes.MINIMUM_RISK_ROUTE:case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:sReqModifiers="AM"}}return sReqModifiers},applyRequiredModifiers:function(sSymbolCode,oModifier,i2525Version,oMap){var sBasicSymbolCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(sSymbolCode),sRequiredModifiers=publicInterface.getRequiredModifiers(sBasicSymbolCode,i2525Version);if(0!==sRequiredModifiers.length)for(var oRequiredModifiers=sRequiredModifiers.split("."),iIndex=0;iIndex<oRequiredModifiers.length;iIndex++)0!==oRequiredModifiers[iIndex].length&&privateInterface.checkModifier(sBasicSymbolCode,oRequiredModifiers[iIndex],oModifier,i2525Version,oMap)},convertModifiersTo2525:function(args){var sColor,oModifiers={},oProperties=args.properties||{},oPropModifiers=oProperties.modifiers||{},longModifiers=leafLet.utils.milstd.longModifiers,o2525Modifiers=leafLet.utils.milstd.Modifiers;oPropModifiers.hasOwnProperty(longModifiers.STANDARD)||oPropModifiers.hasOwnProperty(o2525Modifiers.STANDARD)||(oPropModifiers[longModifiers.STANDARD]=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B);for(var sModifier in oPropModifiers)if(oPropModifiers.hasOwnProperty(sModifier)){var s2525Modifier=leafLet.utils.milstd.stringToModifiers[sModifier]||sModifier;s2525Modifier?s2525Modifier===o2525Modifiers.STANDARD&&"string"==typeof oPropModifiers[sModifier]?oModifiers[s2525Modifier]=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oPropModifiers[sModifier]):oModifiers[s2525Modifier]=emp.helpers.copyObject(oPropModifiers[sModifier]):oModifiers[sModifier]=emp.helpers.copyObject(oPropModifiers[sModifier])}return emp.util.isEmptyString(oProperties[longModifiers.LINE_COLOR])||(sColor=oProperties[longModifiers.LINE_COLOR],sColor.length>5&&(sColor=sColor.substr(sColor.length-6,6)),oModifiers[longModifiers.LINE_COLOR]=sColor),emp.util.isEmptyString(oProperties[longModifiers.FILL_COLOR])||(sColor=oProperties[longModifiers.FILL_COLOR],sColor.length>5&&(sColor=sColor.substr(sColor.length-6,6)),oModifiers[longModifiers.FILL_COLOR]=sColor),oModifiers},createEditor:function(oPrivateInterface,oTransaction,oEmpItem,oFeature){var sSymbolCode,i2525Version;if(oFeature){var oModifiers=oFeature.getMilStdModifiers();sSymbolCode=oFeature.getData().symbolCode,i2525Version=oModifiers[leafLet.utils.milstd.Modifiers.STANDARD],i2525Version=i2525Version||0}else{var oProperties=oEmpItem.properties,oModifiers=oProperties?oProperties.modifiers:void 0,symStd=oModifiers?oModifiers[leafLet.utils.milstd.longModifiers.STANDARD]:"2525b";i2525Version=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(symStd),sSymbolCode=oEmpItem.symbolCode}var sBasicSymbolCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(sSymbolCode),oSymbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(sBasicSymbolCode,i2525Version);return privateInterface.createMilStdEditor(oPrivateInterface,oTransaction,oFeature,oEmpItem,sBasicSymbolCode,oSymbolDef,i2525Version)},renderMPGraphic:function(oArgs){var iOutputFormat=2,oMap=oArgs.instanceInterface.getLeafletMap(),mapBounds=oMap.getBounds(),empMapBounds=oArgs.empMapBounds,oRenderer=sec.web.renderer.SECWebRenderer,sCoordinateStr=leafLet.utils.geoJson.convertCoordinatesToString(oArgs.oCoordData),iZoom=oMap.getZoom(),dScale=oArgs.instanceInterface.getScale(iZoom),dMaxLabelScale=oArgs.instanceInterface.dMaxLabelScale,sBBox=null,oDimension=oMap.getSize(),bIsSelected=(leafLet.utils.milstd.longModifiers,oArgs.oFeature.isSelected()),oSelectAttributes=oArgs.instanceInterface.selectAttributes,pointConverter=(empMapBounds.containsIDL(),new leafLet.utils.renderer.PointConverter(oMap,oDimension.x,oDimension.y,mapBounds,empMapBounds));mapBounds.getEast()-mapBounds.getWest()<180&&(sBBox=empMapBounds.getWest()+","+empMapBounds.getSouth()+","+empMapBounds.getEast()+","+empMapBounds.getNorth());try{var sGeoJsonData=oRenderer.RenderSymbol2D(oArgs.sID,oArgs.sName,oArgs.sDescription,oArgs.sSymbolCode,sCoordinateStr,oDimension.x,oDimension.y,sBBox,oArgs.oModifiers,iOutputFormat,oArgs.i2525Version,void 0,pointConverter),oGeoJson=JSON.parse(sGeoJsonData),oLeaftletGeoJSON=new L.GeoJSON(oGeoJson,{style:function(oGeoJsonfeature){var oStyle={};switch(oGeoJsonfeature.geometry.type){case"Point":break;case"LineString":case"MultiLineString":oStyle.color=oGeoJsonfeature.properties.strokeColor,oStyle.opacity=oGeoJsonfeature.properties.lineOpacity,oStyle.weight=oGeoJsonfeature.properties.strokeWidth,bIsSelected&&(oStyle.tempColor=oStyle.color,oStyle.tempWeight=oStyle.weight,oStyle.color="#"+oSelectAttributes.color,oStyle.weight=oSelectAttributes.width);break;case"Polygon":case"MultiPolygon":oStyle.color=oGeoJsonfeature.properties.strokeColor,oStyle.opacity=oGeoJsonfeature.properties.lineOpacity,oStyle.weight=oGeoJsonfeature.properties.strokeWidth,oStyle.fillColor=oGeoJsonfeature.properties.fillColor,oStyle.fillOpacity=oGeoJsonfeature.properties.fillOpacity,bIsSelected&&(oStyle.tempColor=oStyle.color,oStyle.tempWeight=oStyle.weight,oStyle.color="#"+oSelectAttributes.color,oStyle.weight=oSelectAttributes.width)}return oStyle.oFeature=oArgs.oFeature,oStyle},pointToLayer:function(oGeoJsonfeature,latlng){var myIcon,sLabelText=dScale<=dMaxLabelScale?oGeoJsonfeature.properties.label:" ",iTextPixelDim=emp.helpers.getStringPixelDimensions(sLabelText,oGeoJsonfeature.properties.fontFamily,oGeoJsonfeature.properties.fontSize+"pt",oGeoJsonfeature.properties.fontWeight),iXOffset=0,iYOffset=0,sTextAlignment="center";if(oGeoJsonfeature.properties.hasOwnProperty("labelAlign"))switch(sTextAlignment=oGeoJsonfeature.properties.labelAlign.toLowerCase()){case"center":iXOffset=Math.floor(iTextPixelDim.width/2);break;case"left":iXOffset=0;break;case"right":iXOffset=iTextPixelDim.width}if(oGeoJsonfeature.properties.hasOwnProperty("labelBaseline"))switch(oGeoJsonfeature.properties.labelBaseline){case"alphabetic":iYOffset=Math.floor(.75*iTextPixelDim.height);break;case"top":iYOffset=0;break;case"middle":iYOffset=Math.floor(iTextPixelDim.height/2);break;case"bottom":iYOffset=iTextPixelDim.height}return myIcon=new L.DivIcon({className:"milstdMPtext",html:"<p style='font-family:"+oGeoJsonfeature.properties.fontFamily+"; font-size:"+oGeoJsonfeature.properties.fontSize+"pt; line-height: 1.2; white-space: nowrap; font-weight:"+oGeoJsonfeature.properties.fontWeight+"; color:"+oGeoJsonfeature.properties.fontColor+"; -webkit-transform: rotate("+oGeoJsonfeature.properties.angle+"deg); -moz-transform: rotate("+oGeoJsonfeature.properties.angle+"deg); -o-transform: rotate("+oGeoJsonfeature.properties.angle+"deg); transform: rotate("+oGeoJsonfeature.properties.angle+"deg);'>"+sLabelText+"</p>",iconSize:new L.Point(iTextPixelDim.width,iTextPixelDim.height),iconAnchor:new L.Point(iXOffset,iYOffset)}),new L.Marker(latlng,{icon:myIcon,oFeature:oArgs.oFeature})},onEachFeature:function(feature,layer){},coordsToLatLng:function(oCoord){var latLng=new L.LatLng(oCoord[1],oCoord[0]);return latLng}});if(oLeaftletGeoJSON instanceof L.LayerGroup&&(1===oLeaftletGeoJSON.getLayers().length?oLeaftletGeoJSON=oLeaftletGeoJSON.getLayers()[0]:0===oLeaftletGeoJSON.getLayers().length&&(oLeaftletGeoJSON=void 0)),oLeaftletGeoJSON instanceof L.LayerGroup){for(var oNewChildren=[],FlantenGroup=function(oGroup){for(var oChild,oChildren=oGroup.getLayers(),iIndex=0;iIndex<oChildren.length;iIndex++)oChild=oChildren[iIndex],oGroup.removeLayer(oChild),oChild instanceof L.LayerGroup?FlantenGroup(oChild):oNewChildren.push(oChild)};oLeaftletGeoJSON.getLayers().length>0;){var oChild=oLeaftletGeoJSON.getLayers()[0];oLeaftletGeoJSON.removeLayer(oChild),oChild instanceof L.LayerGroup?FlantenGroup(oChild):oNewChildren.push(oChild)}for(var iIndex=0;iIndex<oNewChildren.length;iIndex++)oLeaftletGeoJSON.addLayer(oNewChildren[iIndex])}}catch(Ex){throw console.log("GeoJSON Error:\nSymbol Code: "+oArgs.sSymbolCode+"\nid: "+oArgs.sID+"\nname: "+oArgs.sName+"\ndescription: "+oArgs.sDescription+"\ncoordinates: "+sCoordinateStr+"\nwidth: "+oDimension.x+"\nheight: "+oDimension.y+"\nbbox: "+sBBox+"\nmodifiers: "+JSON.stringify(oArgs.oModifiers)+"\noutFormat: "+iOutputFormat+"\n2525 version: "+oArgs.i2525Version+"\ngeoJSON returned:\n"+sGeoJsonData+"\n"),Ex}return oLeaftletGeoJSON},createTGFromDraw:function(oEnginePrivateInterface,oLeafletMap,oSymbolDef,sBasicSymbolCode,oDrawItem){var dBrng,dBrngInc,oCoordList=[],oFeature=void 0,oSymbolDefTable=armyc2.c2sd.renderer.utilities.SymbolDefTable,oBasicCodes=leafLet.utils.milstd.basicSymbolCode,oMapBounds=oLeafletMap.getBounds(),oMapSouthWest=oMapBounds.getSouthWest().wrap(),oMapNorthEast=oMapBounds.getNorthEast().wrap(),oMapCenter=oMapBounds.getCenter(),oMapCenterWest=new L.LatLng(oMapCenter.lat,oMapSouthWest.lng,0),oMapCenterEast=new L.LatLng(oMapCenter.lat,oMapNorthEast.lng,0),oMapCenterNorth=new L.LatLng(oMapNorthEast.lat,oMapCenter.lng,0),oMapCenterSouth=new L.LatLng(oMapSouthWest.lat,oMapCenter.lng,0),dViewWidth=oMapCenterWest.distanceTo(oMapCenterEast),dViewHeight=oMapCenterSouth.distanceTo(oMapCenterNorth),dQtrWidth=Math.floor(dViewWidth/4),d3rdHeight=Math.floor(dViewHeight/3),oGeoJsonData=(emp.typeLibrary.featureMilStdVersionType.convertToNumeric(),{symbolCode:oDrawItem.symbolCode,type:"LineString",coordinates:[]}),oProperties=emp.helpers.copyObject(oDrawItem.properties),oModifiers=leafLet.utils.milstd.convertModifiersTo2525(oDrawItem),o2525Modifiers=leafLet.utils.milstd.Modifiers;oModifiers[o2525Modifiers.STANDARD]||0;switch(oProperties.modifiers=oModifiers,oSymbolDef.drawCategory){case oSymbolDefTable.DRAW_CATEGORY_LINE:case oSymbolDefTable.DRAW_CATEGORY_ARROW:oCoordList.push(oMapCenter.destinationPoint(270,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(90,dQtrWidth));break;case oSymbolDefTable.DRAW_CATEGORY_AUTOSHAPE:switch(sBasicSymbolCode){case oBasicCodes.TASK_ISOLATE:case oBasicCodes.TASK_OCCUPY:case oBasicCodes.TASK_RETIAN:case oBasicCodes.TASK_SECURE:case oBasicCodes.TASK_CORDON_SEARCH:case oBasicCodes.TASK_CORDON_KNOCK:oCoordList.push(oMapCenter),oCoordList.push(oMapCenter.destinationPoint(45,d3rdHeight));break;case oBasicCodes.MINIMUM_SAFE_DISTANCE_ZONES:oCoordList.push(oMapCenter),oCoordList.push(oMapCenter.destinationPoint(45,dQtrWidth/2)),oCoordList.push(oMapCenter.destinationPoint(45,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(45,1.5*dQtrWidth));break;default:for(dBrng=240,dBrngInc=360/oSymbolDef.minPoints,oCoordList.push(oMapCenter.destinationPoint(dBrng,dQtrWidth));oCoordList.length<oSymbolDef.minPoints;)dBrng+=dBrngInc,oCoordList.push(oMapCenter.destinationPoint(dBrng,dQtrWidth))}break;case oSymbolDefTable.DRAW_CATEGORY_POLYGON:for(dBrng=240,dBrngInc=360/oSymbolDef.minPoints,oCoordList.push(oMapCenter.destinationPoint(dBrng,dQtrWidth));oCoordList.length<oSymbolDef.minPoints;)dBrng+=dBrngInc,oCoordList.push(oMapCenter.destinationPoint(dBrng,dQtrWidth));break;case oSymbolDefTable.DRAW_CATEGORY_ROUTE:oCoordList.push(oMapCenter.destinationPoint(270,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(90,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(260,.9*dQtrWidth));break;case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTLINE:case oSymbolDefTable.DRAW_CATEGORY_TWOPOINTARROW:case oSymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:oCoordList.push(oMapCenter.destinationPoint(270,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(90,dQtrWidth));break;case oSymbolDefTable.DRAW_CATEGORY_POINT:case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:case oSymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:oCoordList.push(oMapCenter);break;case oSymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:oCoordList.push(oMapCenter.destinationPoint(180,d3rdHeight));break;case oSymbolDefTable.DRAW_CATEGORY_SUPERAUTOSHAPE:switch(sBasicSymbolCode){case oBasicCodes.CCGM_OFFENCE_SUPPORT_BY_FIRE_POSITION:dBrng=315,oCoordList.push(oMapCenter.destinationPoint(315,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(225,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(45,dQtrWidth)),oCoordList.push(oMapCenter.destinationPoint(135,dQtrWidth));break;default:for(dBrng=240,dBrngInc=360/oSymbolDef.minPoints,oCoordList.push(oMapCenter.destinationPoint(dBrng,dQtrWidth));oCoordList.length<oSymbolDef.minPoints;)dBrng+=dBrngInc,oCoordList.push(oMapCenter.destinationPoint(dBrng,dQtrWidth))}}switch(1===oCoordList.length&&(oGeoJsonData.type="Point"),leafLet.utils.geoJson.convertLatLngListToGeoJson(oGeoJsonData,oCoordList),oSymbolDef.drawCategory){case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)?oModifiers[o2525Modifiers.DISTANCE]instanceof Array||!oModifiers[o2525Modifiers.DISTANCE]?0===oModifiers[o2525Modifiers.DISTANCE].length&&(oModifiers[o2525Modifiers.DISTANCE]=[dQtrWidth]):oModifiers[o2525Modifiers.DISTANCE]=[oModifiers[o2525Modifiers.DISTANCE]]:oModifiers[o2525Modifiers.DISTANCE]=[dQtrWidth];break;case oSymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)?oModifiers[o2525Modifiers.DISTANCE]instanceof Array||(oModifiers[o2525Modifiers.DISTANCE]=[]):oModifiers[o2525Modifiers.DISTANCE]=[],0===oModifiers[o2525Modifiers.DISTANCE].length?oModifiers[o2525Modifiers.DISTANCE]=[dQtrWidth,Math.floor(dQtrWidth/2)]:oModifiers[o2525Modifiers.DISTANCE].length<2&&oModifiers[o2525Modifiers.DISTANCE].push(Math.floor(dQtrWidth/2)),oModifiers.hasOwnProperty(o2525Modifiers.AZIMUTH)?oModifiers[o2525Modifiers.AZIMUTH]instanceof Array||(oModifiers[o2525Modifiers.AZIMUTH]=[]):oModifiers[o2525Modifiers.AZIMUTH]=[],0===oModifiers[o2525Modifiers.AZIMUTH].length&&(oModifiers[o2525Modifiers.AZIMUTH]=[0]);break;case oSymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)?oModifiers[o2525Modifiers.DISTANCE]instanceof Array||(oModifiers[o2525Modifiers.DISTANCE]=[d3rdHeight]):oModifiers[o2525Modifiers.DISTANCE]=[d3rdHeight],oModifiers.hasOwnProperty(o2525Modifiers.AZIMUTH)?oModifiers[o2525Modifiers.AZIMUTH]instanceof Array||(oModifiers[o2525Modifiers.AZIMUTH]=[]):oModifiers[o2525Modifiers.AZIMUTH]=[],0===oModifiers[o2525Modifiers.AZIMUTH].length&&oModifiers[o2525Modifiers.AZIMUTH].push(315),oModifiers[o2525Modifiers.AZIMUTH].length<2&&oModifiers[o2525Modifiers.AZIMUTH].push(45);break;case oSymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:break;case oSymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)&&oModifiers[o2525Modifiers.DISTANCE]instanceof Array?oModifiers[o2525Modifiers.DISTANCE].length<1&&(oModifiers[o2525Modifiers.DISTANCE]=[d3rdHeight]):oModifiers[o2525Modifiers.DISTANCE]=[d3rdHeight]}switch(sBasicSymbolCode){case oBasicCodes.AIR_CORRIDOR:case oBasicCodes.MINIMUM_RISK_ROUTE:case oBasicCodes.STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:case oBasicCodes.UBMANNED_AERIAL_VEHICLE_ROUTE:case oBasicCodes.LOW_LEVEL_TRANSIT_ROUTE:oModifiers.hasOwnProperty(o2525Modifiers.DISTANCE)&&oModifiers[o2525Modifiers.DISTANCE]instanceof Array?oModifiers[o2525Modifiers.DISTANCE].length<1&&(oModifiers[o2525Modifiers.DISTANCE]=[Math.floor(dQtrWidth/2)]):oModifiers[o2525Modifiers.DISTANCE]=[Math.floor(dQtrWidth/2)]}return oFeature=new leafLet.typeLibrary.MilStdFeature({item:{name:oDrawItem.name,coreId:oDrawItem.coreId,parentCoreId:oDrawItem.parentCoreId,visible:!0,featureId:oDrawItem.featureId,overlayId:oDrawItem.overlayId,parentId:oDrawItem.parentId,format:emp.typeLibrary.featureFormatType.MILSTD,data:oGeoJsonData,properties:oProperties},instanceInterface:oEnginePrivateInterface})}};return publicInterface}(),leafLet.utils.milstd.longModifiers={QUANTITY:"quantity",REDUCED_OR_REINFORCED:"reinforcedOrReduced",STAFF_COMMENTS:"staffComments",ADDITIONAL_INFO_1:"additionalInfo1",ADDITIONAL_INFO_2:"additionalInfo2",ADDITIONAL_INFO_3:"additionalInfo3",EVALUATION_RATING:"evaluationRating",COMBAT_EFFECTIVENESS:"combatEffectiveness",SIGNATURE_EQUIPMENT:"signatureEquipment",HIGHER_FORMATION:"higherFormation",HOSTILE:"hostile",IFF_SIF:"iffSif",DIRECTION_OF_MOVEMENT:"directionOfMovement",OFFSET_INDICATOR:"offsetIndicator",UNIQUE_DESIGNATOR_1:"uniqueDesignation1",UNIQUE_DESIGNATOR_2:"uniqueDesignation2",EQUIPMENT_TYPE:"equipmentType",DATE_TIME_GROUP:"dateTimeGroup1",DATE_TIME_GROUP_2:"dateTimeGroup2",ALTITUDE_DEPTH:"altitudeDepth",LOCATION:"location",SPEED:"speed",SPECIAL_C2_HEADQUARTERS:"specialC2Headquarters",DISTANCE:"distance",AZIMUTH:"azimuth",FILL_COLOR:"fillColor",LINE_COLOR:"lineColor",X_OFFSET:"xOffset",X_UNITS:"xUnits",Y_OFFSET:"yOffset",Y_UNITS:"yUnits",SIZE:"size",LINE_THICKNESS:"lineThickness",HEADING:"heading",STANDARD:"standard"},leafLet.utils.milstd.Modifiers={QUANTITY:"C",REDUCED_OR_REINFORCED:"F",STAFF_COMMENTS:"G",ADDITIONAL_INFO_1:"H",ADDITIONAL_INFO_2:"H1",ADDITIONAL_INFO_3:"H2",EVALUATION_RATING:"J",COMBAT_EFFECTIVENESS:"K",SIGNATURE_EQUIPMENT:"L",HIGHER_FORMATION:"M",HOSTILE:"N",IFF_SIF:"P",DIRECTION_OF_MOVEMENT:"Q",OFFSET_INDICATOR:"S",UNIQUE_DESIGNATOR_1:"T",UNIQUE_DESIGNATOR_2:"T1",EQUIPMENT_TYPE:"V",DATE_TIME_GROUP:"W",DATE_TIME_GROUP_2:"W1",ALTITUDE_DEPTH:"X",LOCATION:"Y",SPEED:"Z",SPECIAL_C2_HEADQUARTERS:"AA",DISTANCE:"AM",AZIMUTH:"AN",STANDARD:"SYMSTD"},leafLet.utils.milstd.stringToModifiers=function(){var mapping={},longModifiers=leafLet.utils.milstd.longModifiers,s2525Modifiers=leafLet.utils.milstd.Modifiers;return mapping[longModifiers.QUANTITY]=s2525Modifiers.QUANTITY,mapping[longModifiers.REDUCED_OR_REINFORCED]=s2525Modifiers.REDUCED_OR_REINFORCED,mapping[longModifiers.STAFF_COMMENTS]=s2525Modifiers.STAFF_COMMENTS,mapping[longModifiers.ADDITIONAL_INFO_1]=s2525Modifiers.ADDITIONAL_INFO_1,mapping[longModifiers.ADDITIONAL_INFO_2]=s2525Modifiers.ADDITIONAL_INFO_2,mapping[longModifiers.ADDITIONAL_INFO_3]=s2525Modifiers.ADDITIONAL_INFO_3,mapping[longModifiers.EVALUATION_RATING]=s2525Modifiers.EVALUATION_RATING,mapping[longModifiers.COMBAT_EFFECTIVENESS]=s2525Modifiers.COMBAT_EFFECTIVENESS,mapping[longModifiers.SIGNATURE_EQUIPMENT]=s2525Modifiers.SIGNATURE_EQUIPMENT,mapping[longModifiers.HIGHER_FORMATION]=s2525Modifiers.HIGHER_FORMATION,mapping[longModifiers.HOSTILE]=s2525Modifiers.HOSTILE,mapping[longModifiers.IFF_SIF]=s2525Modifiers.IFF_SIF,mapping[longModifiers.DIRECTION_OF_MOVEMENT]=s2525Modifiers.DIRECTION_OF_MOVEMENT,mapping[longModifiers.OFFSET_INDICATOR]=s2525Modifiers.OFFSET_INDICATOR,mapping[longModifiers.UNIQUE_DESIGNATOR_1]=s2525Modifiers.UNIQUE_DESIGNATOR_1,mapping[longModifiers.UNIQUE_DESIGNATOR_2]=s2525Modifiers.UNIQUE_DESIGNATOR_2,mapping[longModifiers.EQUIPMENT_TYPE]=s2525Modifiers.EQUIPMENT_TYPE,mapping[longModifiers.DATE_TIME_GROUP]=s2525Modifiers.DATE_TIME_GROUP,mapping[longModifiers.DATE_TIME_GROUP_2]=s2525Modifiers.DATE_TIME_GROUP_2,mapping[longModifiers.ALTITUDE_DEPTH]=s2525Modifiers.ALTITUDE_DEPTH,mapping[longModifiers.LOCATION]=s2525Modifiers.LOCATION,mapping[longModifiers.SPEED]=s2525Modifiers.SPEED,mapping[longModifiers.SPECIAL_C2_HEADQUARTERS]=s2525Modifiers.SPECIAL_C2_HEADQUARTERS,mapping[longModifiers.DISTANCE]=s2525Modifiers.DISTANCE,mapping[longModifiers.AZIMUTH]=s2525Modifiers.AZIMUTH,mapping[longModifiers.FILL_COLOR]=longModifiers.FILL_COLOR,mapping[longModifiers.LINE_COLOR]=longModifiers.LINE_COLOR,mapping[longModifiers.X_OFFSET]=longModifiers.X_OFFSET,mapping[longModifiers.X_UNITS]=longModifiers.X_UNITS,mapping[longModifiers.Y_OFFSET]=longModifiers.Y_OFFSET,mapping[longModifiers.Y_UNITS]=longModifiers.Y_UNITS,mapping[longModifiers.SIZE]=longModifiers.SIZE,mapping[longModifiers.LINE_THICKNESS]=longModifiers.LINE_THICKNESS,mapping[longModifiers.STANDARD]=s2525Modifiers.STANDARD,mapping}(),leafLet.utils.milstd.o2525ModifierToLong=function(){var mapping={},longModifiers=leafLet.utils.milstd.longModifiers,s2525Modifiers=leafLet.utils.milstd.Modifiers;return mapping[s2525Modifiers.QUANTITY]=longModifiers.QUANTITY,mapping[s2525Modifiers.REDUCED_OR_REINFORCED]=longModifiers.REDUCED_OR_REINFORCED,mapping[s2525Modifiers.STAFF_COMMENTS]=longModifiers.STAFF_COMMENTS,mapping[s2525Modifiers.ADDITIONAL_INFO_1]=longModifiers.ADDITIONAL_INFO_1,mapping[s2525Modifiers.ADDITIONAL_INFO_2]=longModifiers.ADDITIONAL_INFO_2,mapping[s2525Modifiers.ADDITIONAL_INFO_3]=longModifiers.ADDITIONAL_INFO_3,mapping[s2525Modifiers.EVALUATION_RATING]=longModifiers.EVALUATION_RATING,mapping[s2525Modifiers.COMBAT_EFFECTIVENESS]=longModifiers.COMBAT_EFFECTIVENESS,mapping[s2525Modifiers.SIGNATURE_EQUIPMENT]=longModifiers.SIGNATURE_EQUIPMENT,mapping[s2525Modifiers.HIGHER_FORMATION]=longModifiers.HIGHER_FORMATION,mapping[s2525Modifiers.HOSTILE]=longModifiers.HOSTILE,mapping[s2525Modifiers.IFF_SIF]=longModifiers.IFF_SIF,mapping[s2525Modifiers.DIRECTION_OF_MOVEMENT]=longModifiers.DIRECTION_OF_MOVEMENT,mapping[s2525Modifiers.OFFSET_INDICATOR]=longModifiers.OFFSET_INDICATOR,mapping[s2525Modifiers.UNIQUE_DESIGNATOR_1]=longModifiers.UNIQUE_DESIGNATOR_1,mapping[s2525Modifiers.UNIQUE_DESIGNATOR_2]=longModifiers.UNIQUE_DESIGNATOR_2,mapping[s2525Modifiers.EQUIPMENT_TYPE]=longModifiers.EQUIPMENT_TYPE,mapping[s2525Modifiers.DATE_TIME_GROUP]=longModifiers.DATE_TIME_GROUP,mapping[s2525Modifiers.DATE_TIME_GROUP_2]=longModifiers.DATE_TIME_GROUP_2,mapping[s2525Modifiers.ALTITUDE_DEPTH]=longModifiers.ALTITUDE_DEPTH,mapping[s2525Modifiers.LOCATION]=longModifiers.LOCATION,mapping[s2525Modifiers.SPEED]=longModifiers.SPEED,mapping[s2525Modifiers.SPECIAL_C2_HEADQUARTERS]=longModifiers.SPECIAL_C2_HEADQUARTERS,mapping[s2525Modifiers.DISTANCE]=longModifiers.DISTANCE,mapping[s2525Modifiers.AZIMUTH]=longModifiers.AZIMUTH,mapping[longModifiers.FILL_COLOR]=longModifiers.FILL_COLOR,mapping[longModifiers.LINE_COLOR]=longModifiers.LINE_COLOR,mapping[longModifiers.X_OFFSET]=longModifiers.X_OFFSET,mapping[longModifiers.X_UNITS]=longModifiers.X_UNITS,mapping[longModifiers.Y_OFFSET]=longModifiers.Y_OFFSET,mapping[longModifiers.Y_UNITS]=longModifiers.Y_UNITS,mapping[longModifiers.SIZE]=longModifiers.SIZE,mapping[longModifiers.LINE_THICKNESS]=longModifiers.LINE_THICKNESS,mapping[s2525Modifiers.STANDARD]=longModifiers.STANDARD,mapping}(),leafLet.utils.milstd.basicSymbolCode={AIR_CORRIDOR:"G*G*ALC---****X",STANDARD_ARMY_AIRCRAFT_FLIGHT_ROUTE:"G*G*ALS---****X",MINIMUM_RISK_ROUTE:"G*G*ALM---****X",UBMANNED_AERIAL_VEHICLE_ROUTE:"G*G*ALU---****X",LOW_LEVEL_TRANSIT_ROUTE:"G*G*ALL---****X",AIRSPACE_COORDINATION_AREA_IRREGULAR:"G*F*ACAI--****X",AIRSPACE_COORDINATION_AREA_RECTANGULAR:"G*F*ACAR--****X",AIRSPACE_COORDINATION_AREA_CIRCULAR:"G*F*ACAC--****X",RESTRICTED_OPERATIONS_ZONE:"G*G*AAR---****X",HIGH_DENSITY_AIRSPACE_CONTROL_ZONE:"G*G*AAH---****X",MISSILE_ENGAGEMENT_ZONE:"G*G*AAM---****X",MISSILE_ENGAGEMENT_ZONE_LOW_ALTITUDE:"G*G*AAML--****X",MISSILE_ENGAGEMENT_ZONE_HIGH_ALTITUDE:"G*G*AAMH--****X",CIRCULAR_RANGE_FAN:"G*F*AXC---****X",SECTOR_RANGE_FAN:"G*F*AXS---****X",RECTANGULAR_TARGET:"G*F*ATR---****X",CIRCULAR_TARGET:"G*FPATC---****X",FORD_EASY:"G*M*BCE---****X",FORD_DIFFICULT:"G*M*BCD---****X",ROADBLOCK_COMPLETE_EXECUTED:"G*M*ORC---****X",MINIMUM_SAFE_DISTANCE_ZONES:"G*M*NM----****X",SEIZE:"G*T*Z-----****X",AMBUSH:"G*G*SLA---****X",BLOCK_TASK:"G*T*B-----****X",TASK_ISOLATE:"G*T*E-----****X",TASK_OCCUPY:"G*T*O-----****X",TASK_RETIAN:"G*T*Q-----****X",TASK_SECURE:"G*T*S-----****X",TASK_CORDON_SEARCH:"G*T*V-----****X",TASK_CORDON_KNOCK:"G*T*2-----****X",CCGM_OFFENCE_SUPPORT_BY_FIRE_POSITION:"G*G*OAS---****X",BRIDGE_OR_GAP:"G*M*BCB---****X",ASSAULT_CROSSING_AREA:"G*M*BCA---****X",FORWARD_AREA_AIR_DEFENSE_ZONE:"G*G*AAF---****X",SHORT_RANGE_AIR_DEFENSE_ENGAGEMENT_ZONE:"G*G*AAF---****X",KILL_BOX_PURPLE_CIRCULAR:"G*F*AKPC--****X",KILL_BOX_PURPLE_RECTANGULAR:"G*F*AKPR--****X",KILL_BOX_PURPLE_IRREGULAR:"G*F*AKPI--****X"},emp.typeLibrary.featureMilStdVersionType.convertToString=function(iValue){var sRet=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;switch(iValue){case 0:sRet=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;break;case 1:sRet=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C}return sRet},leafLet.utils=leafLet.utils||{},leafLet.utils.kml=function(){var publicInterface={convertCoordinatesToLatLng:function(sKML){var sCoordStr,oLatLngList=[],oKmlDoc=emp.$(emp.$.parseXML(sKML)),bIsPolygon=!1;if(emp.$.each(oKmlDoc.find("coordinates"),function(i,oDescElem){void 0===sCoordStr&&(sCoordStr=oDescElem.textContent)}),emp.$.each(oKmlDoc.find("Polygon"),function(i,oDescElem){bIsPolygon=!0}),sCoordStr){for(var aCoord,dLng,dLat,dAlt,aStrCoordList=sCoordStr.split(/\s+/g),iIndex=0;iIndex<aStrCoordList.length;iIndex++)aStrCoordList[iIndex].length>0&&(aCoord=aStrCoordList[iIndex].split(","),aCoord.length>1&&(dLng=Number(aCoord[0]),dLat=Number(aCoord[1]),dAlt=void 0,aCoord.length>2&&(dAlt=Number(aCoord[2])),oLatLngList.push(new L.LatLng(dLat,dLng,dAlt))));bIsPolygon&&oLatLngList.length>1&&oLatLngList.splice(oLatLngList.length-1,1)}return oLatLngList},convertLatLngListToKML:function(sKML,oLatLngList){function getXmlAsString(xmlDom){return"undefined"!=typeof window.XMLSerializer?(new window.XMLSerializer).serializeToString(xmlDom):xmlDom.xml}var bIsPolygon=!1,oKmlDoc=emp.$.parseXML(sKML),$oKmlDoc=emp.$(oKmlDoc),sCoordStr="";emp.$.each($oKmlDoc.find("Polygon"),function(i,oDescElem){bIsPolygon=!0});for(var iIndex=0;iIndex<oLatLngList.length;iIndex++)sCoordStr.length>0&&(sCoordStr+=" "),sCoordStr+=oLatLngList[iIndex].lng+",",sCoordStr+=oLatLngList[iIndex].lat,isNaN(oLatLngList[iIndex].alt)||(sCoordStr+=","+oLatLngList[iIndex].alt);bIsPolygon&&(sCoordStr.length>0&&(sCoordStr+=" "),sCoordStr+=oLatLngList[0].lng+",",sCoordStr+=oLatLngList[0].lat,isNaN(oLatLngList[0].alt)||(sCoordStr+=","+oLatLngList[0].alt));var bDone=!1;return emp.$.each($oKmlDoc.find("coordinates"),function(i,oDescElem){bDone||(oDescElem.textContent=sCoordStr,bDone=!0)}),getXmlAsString(oKmlDoc)}};return publicInterface}(),leafLet.utils=leafLet.utils||{},leafLet.utils.airspace=function(){var publicInterface={createAirspace:function(args){var oAirspace,cAirspaceType=emp.typeLibrary.airspaceSymbolCode;switch(args.item.data.symbolCode){case cAirspaceType.SHAPE3D_CYLINDER:oAirspace=new leafLet.typeLibrary.airspace.Cylinder(args);break;case cAirspaceType.SHAPE3D_POLYGON:oAirspace=new leafLet.typeLibrary.airspace.Polygon(args);break;case cAirspaceType.SHAPE3D_CURTAIN:oAirspace=new leafLet.typeLibrary.airspace.Curtain(args);break;case cAirspaceType.SHAPE3D_ORBIT:oAirspace=new leafLet.typeLibrary.airspace.Orbit(args);break;case cAirspaceType.SHAPE3D_ROUTE:
oAirspace=new leafLet.typeLibrary.airspace.Route(args);break;case cAirspaceType.SHAPE3D_TRACK:oAirspace=new leafLet.typeLibrary.airspace.Track(args);break;case cAirspaceType.SHAPE3D_RADARC:oAirspace=new leafLet.typeLibrary.airspace.RadArc(args);break;case cAirspaceType.SHAPE3D_POLYARC:oAirspace=new leafLet.typeLibrary.airspace.PolyArc(args);break;default:throw new Error("Airspace of this type are not yet supported.")}return oAirspace},createEditor:function(oInstanceInterface,oTransaction,oEmpItem,oAirspace){var oEditor,cAirspaceType=emp.typeLibrary.airspaceSymbolCode,sSymbolCode=oAirspace?oAirspace.getData().symbolCode:oEmpItem.symbolCode,oParameters={transaction:oTransaction,EmpDrawEditItem:oEmpItem,feature:oAirspace,instanceInterface:oInstanceInterface};switch(sSymbolCode){case cAirspaceType.SHAPE3D_CURTAIN:oEditor=new leafLet.editor.AirspaceCurtain(oParameters);break;case cAirspaceType.SHAPE3D_POLYGON:oEditor=new leafLet.editor.AirspacePolygon(oParameters);break;case cAirspaceType.SHAPE3D_CYLINDER:oEditor=new leafLet.editor.AirspaceCylinder(oParameters);break;case cAirspaceType.SHAPE3D_ORBIT:oEditor=new leafLet.editor.AirspaceOrbit(oParameters);break;case cAirspaceType.SHAPE3D_ROUTE:oEditor=new leafLet.editor.AirspaceRoute(oParameters);break;case cAirspaceType.SHAPE3D_TRACK:oEditor=new leafLet.editor.AirspaceTrack(oParameters);break;case cAirspaceType.SHAPE3D_RADARC:oEditor=new leafLet.editor.AirspaceRadArc(oParameters);break;case cAirspaceType.SHAPE3D_POLYARC:oEditor=new leafLet.editor.AirspacePolyArc(oParameters);break;default:throw new Error("Airspace Editor for this type is not yet implemented.")}return oEditor}};return publicInterface}(),leafLet.internalPrivateClass.OvalObject=function(){var publicInterface={initialize:function(args){var options={oMap:args.leafletMap,width:args.width,oAttributes:args.attributes,oOvalCoordList:args.coordinates,isSelected:args.isSelected,selectAttributes:args.selectAttributes,oCoordList:[],oPolygonOptions:{},oFeature:args.oFeature};if(!(args.coordinates instanceof Array))throw new Error("Invalid coordinates type. It must be a 2 element array of L.LatLng objects.");if(2!==args.coordinates.length)throw new Error("Invalid number of elements. It must be a 2 element array of L.LatLng objects.");L.Util.setOptions(this,options),this._generatePolygon(),L.Polygon.prototype.initialize.call(this,this.options.oCoordList,this.options.oPolygonOptions)},isSelected:function(){return this.options.isSelected},_generatePolygon:function(){var oPartialCoordList,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oAttributes=this.options.oAttributes,dWidth=this.options.width,oMap=this.options.oMap,oPt1=this.options.oOvalCoordList[0],oPt2=this.options.oOvalCoordList[1],dBearingPt1Pt2=oPt1.bearingTo(oPt2),dRadius=dWidth/2,dLeftBearing=(dBearingPt1Pt2+270)%360,dRightBearing=(dBearingPt1Pt2+90)%360,oCoordList=this.options.oCoordList,oLineColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_COLOR)),oFillColor=leafLet.utils.convertColor(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_FILL_COLOR)),oPolygonOptions=this.options.oPolygonOptions;if(oPolygonOptions.stroke=!0,oPolygonOptions.color=oLineColor.sColor,oPolygonOptions.opacity=oLineColor.opacity,oPolygonOptions.fill=!0,oPolygonOptions.fillColor=oFillColor.sColor,oPolygonOptions.fillOpacity=oFillColor.opacity,oPolygonOptions.weight=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LINE_WIDTH),this.isSelected()){var oSelectAttributes=this.options.selectAttributes;oPolygonOptions.tempColor=oPolygonOptions.color,oPolygonOptions.tempWeight=oPolygonOptions.weight,oPolygonOptions.color="#"+oSelectAttributes.color,oPolygonOptions.weight=oSelectAttributes.width}oCoordList.length>0&&oCoordList.splice(0,oCoordList.length),oPartialCoordList=leafLet.utils.getArcCoordinates(oMap,oPt1,dRadius,dLeftBearing,dRightBearing,!1);for(var iIndex=0;iIndex<oPartialCoordList.length;iIndex++)oCoordList.push(oPartialCoordList[iIndex]);oPartialCoordList=leafLet.utils.getArcCoordinates(oMap,oPt2,dRadius,dRightBearing,dLeftBearing,!1);for(var iIndex=0;iIndex<oPartialCoordList.length;iIndex++)oCoordList.push(oPartialCoordList[iIndex])}};return publicInterface},leafLet.utils.OvalObject=L.Polygon.extend(leafLet.internalPrivateClass.OvalObject()),leafLet.utils=leafLet.utils||{},leafLet.utils.renderer=leafLet.utils.renderer||{},leafLet.utils.renderer.PointConverter=function(leafletMap,pixelWidth,pixelHeight,mapBounds,empMapBounds){var privateInterface={pixelWidth:0,pixelHeight:0,mapBounds:void 0,empMapBounds:void 0,normalize:!0,leafletMap:void 0,containeIDL:!1,rendererPointConverter:function(leafletMap,pixelWidth,pixelHeight,mapBounds,empMapBounds){privateInterface.leafletMap=leafletMap,privateInterface.pixelWidth=Number(pixelWidth),privateInterface.pixelHeight=Number(pixelHeight),privateInterface.mapBounds=leafletMap.getBounds(),privateInterface.empMapBounds=new leafLet.typeLibrary.EmpBoundary(privateInterface.mapBounds),privateInterface.containeIDL=empMapBounds.containsIDL()}},publicInterface={set_normalize:function(value){privateInterface.normalize=value},PixelsToGeo:function(pixel){var leafletPoint=new L.Point(pixel.getX(),pixel.getY()),point2D=new armyc2.c2sd.graphics2d.Point2D,latlng=privateInterface.leafletMap.containerPointToLatLng(leafletPoint).wrap();return point2D.setLocation(latlng.lng,latlng.lat),point2D},GeoToPixels:function(coord){var point,inBoundingBox,tempLng,coordLatLng=new L.LatLng(coord.y,coord.x),leafletLatLng=coordLatLng.wrap(),point2D=(new L.Point(0,0),new armyc2.c2sd.graphics2d.Point2D);return privateInterface.containeIDL?(tempLng=(privateInterface.empMapBounds.getWest()-privateInterface.empMapBounds.getEast())/2,tempLng+=privateInterface.empMapBounds.getEast(),privateInterface.mapBounds.getEast()>180?leafletLatLng.lng<tempLng&&(leafletLatLng.lng+=360):leafletLatLng.lng>tempLng&&(leafletLatLng.lng-=360)):(inBoundingBox=privateInterface.empMapBounds.containsCoordiante(leafletLatLng),inBoundingBox||(tempLng=privateInterface.empMapBounds.getWest()+180,tempLng+=180-privateInterface.empMapBounds.getEast(),tempLng/=2,privateInterface.empMapBounds.getWest()-tempLng>=-180?(tempLng=privateInterface.empMapBounds.getWest()-tempLng,leafletLatLng.lng<tempLng&&(leafletLatLng.lng+=360)):(tempLng=privateInterface.empMapBounds.getEast()+tempLng,leafletLatLng.lng>tempLng&&(leafletLatLng.lng-=360)))),point=privateInterface.leafletMap.latLngToContainerPoint(leafletLatLng),point2D.setLocation(point.x,point.y),point2D}};return privateInterface.rendererPointConverter(leafletMap,pixelWidth,pixelHeight,mapBounds,empMapBounds),publicInterface},leafLet.ControlPoint={Type:{NEW_POSITION_CP:"newCP",POSITION_CP:"positionCP",ALTITUDE_CP:"altitudeCP",RADIUS_CP:"radiusCP",INNER_RADIUS_CP:"innerRadiusCP",WIDTH_CP:"widthCP",LEFT_WIDTH_CP:"leftWidthCP",RIGHT_WIDTH_CP:"rightWidthCP",RANGE_CP:"rangeCP",LENGTH_CP:"lengthCP",AZIMUTH_CP:"azimuthCP",LEFT_AZIMUTH_CP:"leftAzimuthCP",RIGHT_AZIMUTH_CP:"rightAzimuthCP",ATTITUDE_CP:"attitudeCP",SEGMENT_CP:"segmentCP",AOI_BUFFER:"aoiBufferCP"}},leafLet.internalPrivateClass.CPIcon=function(){var publicInterface={statics:{CP_ICON_DEF:{newCP:{iRadius:7,iLineWidth:1,dOpacity:.7,sStrokeColor:"#00FF00",sFillColor:"#55FF55"},positionCP:{iRadius:11,iLineWidth:1,dOpacity:.7,sStrokeColor:"#0000FF",sFillColor:"#5555FF"},altitudeCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#FF0000",sFillColor:"#FF5555"},radiusCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#555555",sFillColor:"#888888"},innerRadiusCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#555555",sFillColor:"#888888"},widthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#000000",sFillColor:"#555555"},leftWidthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#000000",sFillColor:"#555555"},rightWidthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#000000",sFillColor:"#555555"},rangeCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#000000",sFillColor:"#555555"},lengthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#000000",sFillColor:"#555555"},azimuthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#AAAA00",sFillColor:"#AAAA55"},leftAzimuthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#AAAA00",sFillColor:"#AAAA55"},rightAzimuthCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#AAAA00",sFillColor:"#AAAA55"},attitudeCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#AAAA00",sFillColor:"#AAAA55"},segmentCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#AAAAFF",sFillColor:"#AAAAFF"},aoiBufferCP:{iRadius:10,iLineWidth:1,dOpacity:.7,sStrokeColor:"#000000",sFillColor:"#555555"}}},initialize:function(oArgs){var oIconDef=leafLet.editor.CPIcon.CP_ICON_DEF[oArgs.cpType],oImage=emp.helpers.createCircleCanvas(oIconDef),options={oIconDef:oIconDef,iRadius:oIconDef.iRadius,iIconWidth:oImage.width,iIconHeight:oImage.height};L.Util.setOptions(this,options);var options={iconUrl:oImage.toDataURL()};L.Icon.prototype.initialize.call(this,options)},_setIconStyles:function(img,name){var anchor,options=this.options,size=L.point(options[name+"Size"]);anchor="shadow"===name?L.point(options.shadowAnchor||options.iconAnchor):L.point(options.iconAnchor),!anchor&&size&&(anchor=size.divideBy(2,!0)),img.className="leaflet-marker-"+name+" "+options.className,anchor&&(img.style.marginLeft=-anchor.x+"px",img.style.marginTop=-anchor.y+"px"),size&&(img.style.width=size.x+"px",img.style.height=size.y+"px")}};return publicInterface},leafLet.editor.CPIcon=L.Icon.extend(leafLet.internalPrivateClass.CPIcon()),leafLet.internalPrivateClass.ControlPoint=function(){var publicInterface={statics:{oCPIcons:{newCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.NEW_POSITION_CP}),positionCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.POSITION_CP}),altitudeCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.ALTITUDE_CP}),radiusCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.RADIUS_CP}),innerRadiusCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.INNER_RADIUS_CP}),widthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.WIDTH_CP}),leftWidthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.LEFT_WIDTH_CP}),rightWidthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.RIGHT_WIDTH_CP}),rangeCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.RANGE_CP}),lengthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.LENGTH_CP}),azimuthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.AZIMUTH_CP}),leftAzimuthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP}),rightAzimuthCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP}),attitudeCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.ATTITUDE_CP}),segmentCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.SEGMENT_CP}),aoiBufferCP:new leafLet.editor.CPIcon({cpType:leafLet.ControlPoint.Type.AOI_BUFFER})}},initialize:function(oFeature,cpType,oPosition,iIndex,iSubIndex,iValue,oIcon){var options={oFeature:oFeature,oIcon:oIcon,cpType:cpType,cpIndex:iIndex,cpSubIndex:iSubIndex,cpValue:iValue,cpPopup:void 0,parent:void 0};L.Util.setOptions(this,options),options={icon:leafLet.editor.ControlPoint.oCPIcons[this.getType()],zIndexOffset:1e3,clickable:!0},L.CircleMarker.prototype.initialize.call(this,oPosition,options),this._updateCoordinate()},_updateCoordinate:function(){var oMapBounds=this.getFeature().getLeafletMap().getBounds(),oCoordList=[this.getPosition()];leafLet.utils.wrapCoordinates(oMapBounds,oCoordList,!1)&&this.setLatLng(oCoordList[0])},getFeature:function(){return this.options.oFeature},getRadius:function(){return leafLet.editor.CPIcon.CP_ICON_DEF[this.getType()].iRadius},setParent:function(oParent){this.options.parent=oParent},getType:function(){return this.options.cpType},setType:function(cpType){this.options.cpType=cpType,this.setIcon(leafLet.editor.ControlPoint.oCPIcons[this.getType()])},getIndex:function(){return this.options.cpIndex},setIndex:function(iValue){this.options.cpIndex=iValue},getSubIndex:function(){return this.options.cpSubIndex},setSubIndex:function(iValue){this.options.cpSubIndex=iValue},getPosition:function(){return this.getLatLng()},setCPPosition:function(oValue){this.setLatLng(oValue),this._updateCoordinate(),this.bringToFront(),this.options.cpPopup&&(this.options.cpPopup.setContent(this.getPopupText()),this.options.cpPopup.setLatLng(this.getPosition()))},getValue:function(){return this.options.cpValue},setValue:function(Value){this.options.cpValue=Value},_getAngleValue:function(){var sValue,oFeature=this.options.oFeature;switch(oFeature.getAzimuthUnits()){case leafLet.utils.AngleUnits.MILS:sValue=(this.getValue()*leafLet.utils.MILS_PER_DEGREE).toFixed(1)+" "+leafLet.utils.AngleUnits.MILS;break;case leafLet.utils.AngleUnits.DEGREES:sValue=this.getValue().toFixed(2)+leafLet.utils.AngleUnits.DEGREES}return sValue},_getUnitValue:function(){var sValue,oFeature=this.options.oFeature;switch(oFeature.getUnits()){case leafLet.utils.Units.FEET:sValue=(this.getValue()*leafLet.utils.FEET_PER_METERS).toFixed(0)+" "+leafLet.utils.Units.FEET;break;case leafLet.utils.Units.METERS:sValue=this.getValue().toFixed(0)+" "+leafLet.utils.Units.METERS}return sValue},_getAltitudeValue:function(dValue){var sValue,oFeature=this.options.oFeature,sAltMode=oFeature.getAltitudeModeAbbr();switch(sAltMode=sAltMode.length>0?" "+sAltMode:"",oFeature.getAltitudeUnits()){case leafLet.utils.Units.FEET:sValue=(dValue*leafLet.utils.FEET_PER_METERS).toFixed(0)+" "+leafLet.utils.Units.FEET+sAltMode;break;case leafLet.utils.Units.METERS:sValue=dValue.toFixed(0)+" "+leafLet.utils.Units.METERS+sAltMode}return sValue},getPopupText:function(){var sPopupText="",oLatLng=this.getPosition().wrap();switch(this.getType()){case leafLet.ControlPoint.Type.POSITION_CP:sPopupText="<center>Pt "+(this.options.cpIndex+1)+"<br/>Lat:"+oLatLng.lat.toFixed(5)+"<br/>Lon:"+oLatLng.lng.toFixed(5),isNaN(oLatLng.alt)||(sPopupText+="<br/>Alt:"+this._getAltitudeValue(oLatLng.alt)),sPopupText+="</center>";break;case leafLet.ControlPoint.Type.ALTITUDE_CP:sPopupText="<center>Alt: "+this._getAltitudeValue(this.getValue())+"</center>";break;case leafLet.ControlPoint.Type.RADIUS_CP:sPopupText="<center>Radius: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.INNER_RADIUS_CP:sPopupText="<center>Inner Radius: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.RANGE_CP:sPopupText="<center>Range: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.WIDTH_CP:sPopupText="<center>Width: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.LEFT_WIDTH_CP:sPopupText="<center>Left Width: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.RIGHT_WIDTH_CP:sPopupText="<center>Right Width: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.LENGTH_CP:sPopupText="<center>Length: "+this._getUnitValue()+"</center>";break;case leafLet.ControlPoint.Type.AZIMUTH_CP:sPopupText="<center>Azimuth: "+this._getAngleValue()+"</center>";break;case leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP:sPopupText="<center>Left Azimuth: "+this._getAngleValue()+"</center>";break;case leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP:sPopupText="<center>Right Azimuth: "+this._getAngleValue()+"</center>";break;case leafLet.ControlPoint.Type.ATTITUDE_CP:sPopupText="<center>Attitude: "+this._getAngleValue()+"</center>";break;case leafLet.ControlPoint.Type.SEGMENT_CP:sPopupText="<center>Segment P"+(this.getIndex()+1)+"-P"+(this.getSubIndex()+1)+"<br/>Move</center>";break;case leafLet.ControlPoint.Type.AOI_BUFFER:sPopupText="<center>Buffer: "+this._getUnitValue()+"</center>"}return sPopupText},showPopup:function(){var sPopupText=this.getPopupText();if(void 0===this.options.cpPopup){var oPopup=new L.Popup({closeButton:!1,closeOnClick:!1,autoPan:!1,className:"mdl-color-text--grey-900",offset:new L.Point(0,this.getRadius()*-1)});this.options.cpPopup=oPopup}this.options.cpPopup.setContent(sPopupText),this.options.cpPopup.setLatLng(this.getPosition()),this.options.parent.addLayer(this.options.cpPopup),this.bringToFront()},hidePopup:function(){this.options.parent.removeLayer(this.options.cpPopup),this.bringToFront()},updatePopup:function(){if(this.options.cpPopup){var sPopupText=this.getPopupText();this.options.cpPopup.setContent(sPopupText),this.options.cpPopup.setLatLng(this.getPosition())}},bringToFront:function(){},setPosition:function(el,point,disable3D){var iRadius=this.options.icon.options.oIconDef.iRadius,oOffsetPoint=new L.Point(point.x-iRadius,point.y-iRadius);el._leaflet_pos=point,!disable3D&&L.Browser.any3d?el.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(oOffsetPoint):(el.style.left=oOffsetPoint.x+"px",el.style.top=oOffsetPoint.y+"px")},_setPos:function(pos){this.setPosition(this._icon,pos),this._shadow&&this.setPosition(this._shadow,pos),this._zIndex=pos.y+this.options.zIndexOffset,this._resetZIndex()}};return publicInterface},leafLet.editor.ControlPoint=L.Marker.extend(leafLet.internalPrivateClass.ControlPoint()),leafLet.editor.StateType={IDLE:"idle",ADDING_CP:"add",DELETE_CP:"delete",DRAGGING_CP:"dragging",FEATURE_DRAG:"featuredrag"},leafLet.internalPrivateClass.AbstractEditor=function(){var publicInterface={initialize:function(args){L.FeatureGroup.prototype.initialize.call(this);var oOptions={bDestroyFeature:!1,editorState:leafLet.editor.StateType.IDLE,isDrawing:args.EmpDrawEditItem instanceof emp.typeLibrary.Draw,oTransaction:args.transaction,oEmpDrawEditItem:args.EmpDrawEditItem,oCurrentCP:void 0,feature:args.feature,properties:void 0,leafletMap:args.instanceInterface.leafletInstance,instanceInterface:args.instanceInterface,oControlPointList:[],featureStartLocation:void 0,updateIndex:void 0,oMarkerPopUp:void 0,bCPDragged:!1};if(L.Util.setOptions(this,oOptions),this.options.leafletMap.addLayer(this),args.feature?this.options.properties=leafLet.utils.mergeProperties(this.options.feature.options.properties,this.options.oEmpDrawEditItem.properties):this.options.properties=leafLet.utils.mergeProperties(this.options.oEmpDrawEditItem.properties,{}),this.isDrawMode())this.preapareForDrawOperation();else{if(this.preapareForEditOperation(),void 0!==this.getFeature().getParentCoreId()){var oParent=this.getFeature().getParentObject();oParent.removeChildObject(this.getFeature())}this.addLayer(this.getFeature())}this.getFeature().setEditMode(),this.assembleControlPoints(),this.options.leafletMap.on("click",this.onClickEvent,this),this.options.leafletMap.on("mouseup",this.onFeatureMouseUpEvent,this),this.setLeafletObjectEvents(),this._issueStartEvent()},destroy:function(){if(this.options.oMarkerPopUp&&this.removeLayer(this.options.oMarkerPopUp),this.removeLayer(this.getFeature()),this.removeLeafletObjectEvents(),this.options.bDestroyFeature&&(this.options.feature.destroy(),this.options.feature=void 0),this.options.leafletMap.off("click",this.onClickEvent,this),this.options.leafletMap.off("mouseup",this.onFeatureMouseUpEvent,this),this.options.leafletMap.off("mouseup",this.onCPMouseUpEvent,this),this.clearAllEventListeners(),this.removeAllControlPoints(),this.options.leafletMap.removeLayer(this),this.getFeature()&&void 0!==this.getFeature().getParentCoreId()){var oParent=this.getFeature().getParentObject();oParent.addChildObject(this.getFeature())}},getEngineInstanceInterface:function(){return this.options.instanceInterface},getMarkerObject:function(){var oLeafletObject=this.getLeafletObject();if(oLeafletObject&&(oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Marker))return oLeafletObject},isMarker:function(){return!!this.getMarkerObject()},setMarkerEvents:function(){var oLeafletObject=this.getMarkerObject();oLeafletObject&&oLeafletObject.on("mousedown",this.onFeatureMouseDown,this)},removeMarkerEvents:function(){var oLeafletObject=this.getMarkerObject();oLeafletObject&&oLeafletObject.off("mousedown",this.onFeatureMouseDown,this)},setLeafletObjectEvents:function(){var oLeafletObject=this.getLeafletObject();if(oLeafletObject)if(this.isMarker())this.setMarkerEvents();else if(oLeafletObject instanceof L.LayerGroup)for(var oChildren=oLeafletObject.getLayers(),iIndex=0;iIndex<oChildren.length;iIndex++)oChildren[iIndex].on("mousedown",this.onFeatureMouseDown,this);else oLeafletObject.on("mousedown",this.onFeatureMouseDown,this)},removeLeafletObjectEvents:function(){var oLeafletObject=this.getLeafletObject();if(oLeafletObject)if(this.isMarker())this.removeMarkerEvents();else if(oLeafletObject instanceof L.LayerGroup)for(var oChildren=oLeafletObject.getLayers(),iIndex=0;iIndex<oChildren.length;iIndex++)oChildren[iIndex].off("mousedown",this.onFeatureMouseDown,this);else oLeafletObject.off("mousedown",this.onFeatureMouseDown,this)},getLeafletMap:function(){return this.options.leafletMap},removeAllControlPoints:function(){for(var oControlPointList=this.options.oControlPointList;oControlPointList.length>0;)this.removeCP(oControlPointList[0])},_getAltitudeValue:function(dValue){var oFeature=this.getFeature();return dValue.toFixed(0)+" "+oFeature.getAltitudeUnits()+" "+oFeature.getAltitudeModeAbbr()},getMarkerPopupText:function(){var sPopupText,oLeafletObject=this.getLeafletObject();if(oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Marker){var oCoordList=this.getCoordinateList(),oLatLng=oCoordList[0];sPopupText="<center>Lat:"+oLatLng.lat.toFixed(5)+"<br/>Lon:"+oLatLng.lng.toFixed(5),isNaN(oLatLng.alt)||(sPopupText+="<br/>Alt:"+this._getAltitudeValue(oLatLng.alt)),sPopupText+="</center>"}return sPopupText},setMarkerPopup:function(){},getLeafletObject:function(){var oFeature=this.getFeature();if(oFeature)return oFeature.getLeafletObject()},setLeafletObject:function(oObject){var oFeature=this.getFeature();oFeature&&(this.removeLeafletObjectEvents(),oFeature.setLeafletObject(oObject));var oMarkerObject=this.getMarkerObject();oMarkerObject&&oMarkerObject.unbindPopup(),this.setLeafletObjectEvents(),this.setMarkerPopup(),this.bringCPForward()},getFeature:function(){return this.options.feature},setFeature:function(oFeature){this.options.feature&&(this.getFeature().clearAllEventListeners(),this.removeLayer(this.getFeature()),this.options.bDestroyFeature&&this.getFeature().destroy(),this.options.feature=void 0),oFeature&&(this.options.feature=oFeature,this.addLayer(this.getFeature()),this.setLeafletObjectEvents())},getDrawEditItem:function(){return this.options.oEmpDrawEditItem},isDrawMode:function(){return this.options.isDrawing},preapareForDrawOperation:function(){},preapareForEditOperation:function(){},assembleControlPoints:function(){throw new Error("The editor has not implemented the assembleControlPoint method.")},createEMPFeature:function(){var oEMPFeature,oFeature=this.getFeature();return oEMPFeature=new emp.typeLibrary.Feature({coreId:oFeature.getCoreId(),overlayId:oFeature.getOverlayId(),parentId:oFeature.getParentId(),featureId:oFeature.getFeatureId(),name:oFeature.getName(),format:oFeature.getFormat(),data:oFeature.getData(),properties:oFeature.getProperties()})},getCenterPT:function(oPt1,oPt2){var dDist=oPt1.distanceTo(oPt2),dBearing=oPt1.bearingTo(oPt2);return oPt1.destinationPoint(dBearing,dDist/2)},getCP:function(iCPIndex){for(var oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)if(oCPList[iIndex].getIndex()===iCPIndex)return oCPList[iIndex]},doAddControlPoint:function(oLatLng){},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){},doFeatureMove:function(dBearing,dDistance){return!1},getState:function(){return this.options.editorState},isIdle:function(){return this.getState()===leafLet.editor.StateType.IDLE},isAddingCP:function(){return this.getState()===leafLet.editor.StateType.ADDING_CP},isDeletingCP:function(){return this.getState()===leafLet.editor.StateType.DELETE_CP},isDraggingCP:function(){return this.getState()===leafLet.editor.StateType.DRAGGING_CP},isDraggingFeature:function(){return this.getState()===leafLet.editor.StateType.FEATURE_DRAG},_setState:function(eState){this.options.editorState=eState},isCPAddEvent:function(oEvent){return!(!this.isIdle()||0!==oEvent.originalEvent.button||oEvent.originalEvent.altKey||oEvent.originalEvent.ctrlKey||oEvent.originalEvent.shiftkey||"click"!==oEvent.type||oEvent.target instanceof leafLet.editor.ControlPoint)},isCPDeleteEvent:function(oEvent){return!(!this.isIdle()||0!==oEvent.originalEvent.button||oEvent.originalEvent.altKey||oEvent.originalEvent.ctrlKey||oEvent.originalEvent.shiftkey||"dblclick"!==oEvent.type||!(oEvent.target instanceof leafLet.editor.ControlPoint)||oEvent.target.getType()===leafLet.ControlPoint.Type.NEW_POSITION_CP)},isCPDragStartEvent:function(oEvent){return!(!this.isIdle()||0!==oEvent.originalEvent.button||oEvent.originalEvent.altKey||oEvent.originalEvent.ctrlKey||oEvent.originalEvent.shiftkey||"mousedown"!==oEvent.type||!(oEvent.target instanceof leafLet.editor.ControlPoint))},isFeatureDragStartEvent:function(oEvent){return!(!this.isIdle()||0!==oEvent.originalEvent.button||oEvent.originalEvent.altKey||oEvent.originalEvent.ctrlKey||oEvent.originalEvent.shiftkey||"mousedown"!==oEvent.type||oEvent.target instanceof leafLet.editor.ControlPoint)},onClickEvent:function(oEvent){if(this.isCPAddEvent(oEvent)&&oEvent.latlng instanceof L.LatLng&&!this.options.bCPDragged){this._setState(leafLet.editor.StateType.ADDING_CP);var oCP=this.doAddControlPoint(oEvent.latlng.wrap());oCP&&(this.updateCPIndex(oCP.getIndex(),1),this.addControlPoint(oCP),this._issueCPAddEvent(oCP.getIndex())),this._setState(leafLet.editor.StateType.IDLE)}},onDblClick:function(oEvent){if(this.isCPDeleteEvent(oEvent)&&!this.options.bCPDragged){var oCP=oEvent.target;this._setState(leafLet.editor.StateType.DELETE_CP),this.doDeleteControlPoint(oCP)&&(this.removeCP(oCP),this.updateCPIndex(oCP.getIndex(),-1),this._issueCPDeleteEvent(oCP.getIndex())),this._setState(leafLet.editor.StateType.IDLE)}},onCPMouseUpEvent:function(oEvent){if(this.isDraggingCP()){var oCP=this.options.oCurrentCP;"function"==typeof oEvent.originalEvent.target.releaseCapture&&oEvent.originalEvent.target.releaseCapture(),this.getLeafletMap().off("mousemove",this.onCPMouseMoveEvent,this),this.getLeafletMap().off("mouseup",this.onCPMouseUpEvent,this),this.getLeafletMap().dragging.enable(),oCP.hidePopup(),this._setState(leafLet.editor.StateType.IDLE),this.options.oCurrentCP=void 0,this._issueCPUpdateEvent(this.options.updateIndex,emp.typeLibrary.UpdateEventType.UPDATE),"function"==typeof oEvent.originalEvent.stopPropagation&&oEvent.originalEvent.stopPropagation(),"function"==typeof oEvent.originalEvent.preventDefault&&oEvent.originalEvent.preventDefault()}},onCPMouseMoveEvent:function(oEvent){var aiIndex;if(this.isDraggingCP()){var oCP=this.options.oCurrentCP;this.options.bCPDragged=!0,aiIndex=this.doControlPointMoved(oCP,oEvent),aiIndex instanceof Array&&oCP.updatePopup(),this.options.updateIndex=aiIndex}},onCPMouseDown:function(oEvent){if(this.isCPDragStartEvent(oEvent)){this.options.bCPDragged=!1;var iIndex=this.options.oControlPointList.indexOf(oEvent.target);if(iIndex!==-1){var oCP=this.options.oControlPointList[iIndex];oCP.showPopup(),this._setState(leafLet.editor.StateType.DRAGGING_CP),this.options.oCurrentCP=oCP,this.getLeafletMap().dragging.disable(),this.getLeafletMap().on("mousemove",this.onCPMouseMoveEvent,this),"function"==typeof oEvent.originalEvent.target.setCapture&&oEvent.originalEvent.target.setCapture(),this.getLeafletMap().on("mouseup",this.onCPMouseUpEvent,this)}}},onFeatureMouseUpEvent:function(oEvent){if(this.isDraggingFeature()){for(var oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&oCPList[iIndex].hidePopup();"function"==typeof oEvent.originalEvent.target.releaseCapture&&oEvent.originalEvent.target.releaseCapture(),this.getLeafletMap().off("mousemove",this.onFeatureMouseMoveEvent,this),this.getLeafletMap().dragging.enable(),this._setState(leafLet.editor.StateType.IDLE),this._issueCPUpdateEvent(this.options.updateIndex,emp.typeLibrary.UpdateEventType.UPDATE)}},onFeatureMouseMoveEvent:function(oEvent){var aiIndex;if(this.isDraggingCP()){var oCP=this.options.oCurrentCP,oOrgLL=oEvent.latlng,oEventCoord=oOrgLL.wrap();oEvent.latlng=oEventCoord,aiIndex=this.doControlPointMoved(oCP,oEvent),oEvent.latlng=oOrgLL,aiIndex instanceof Array&&oCP.updatePopup(),this.options.updateIndex=aiIndex}else if(this.isDraggingFeature()){var oEventCoord=oEvent.latlng.wrap(),dBearing=this.options.featureStartLocation.bearingTo(oEventCoord),dDistance=this.options.featureStartLocation.distanceTo(oEventCoord);if(this.doFeatureMove(dBearing,dDistance)){var oCPList=this.options.oControlPointList;aiIndex=[];for(var iIndex=0;iIndex<oCPList.length;iIndex++)oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&(aiIndex.push(oCPList[iIndex].getIndex()),oCPList[iIndex].updatePopup());this.options.featureStartLocation=oEvent.latlng,this.options.updateIndex=aiIndex}}},onFeatureMouseDown:function(oEvent){if(this.isFeatureDragStartEvent(oEvent)){for(var oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&oCPList[iIndex].showPopup();this.options.featureStartLocation=oEvent.latlng,this._setState(leafLet.editor.StateType.FEATURE_DRAG),this.getLeafletMap().dragging.disable(),this.getLeafletMap().on("mousemove",this.onFeatureMouseMoveEvent,this),"function"==typeof oEvent.originalEvent.target.setCapture&&oEvent.originalEvent.target.setCapture()}},setCPEvents:function(oCP){oCP.on("dblclick",this.onDblClick,this),oCP.on("mousedown",this.onCPMouseDown,this)},removeCPEvents:function(oCP){oCP.off("dblclick",this.onDblClick,this),oCP.off("mousedown",this.onCPMouseDown,this)},addControlPoint:function(oCP){this.options.oControlPointList.push(oCP),this.addLayer(oCP),this.setCPEvents(oCP),oCP.bringToFront(),oCP.setParent(this)},bringCPForward:function(){var oCPList=this.options.oControlPointList;this.bringToFront();for(var iIndex=0;iIndex<oCPList.length;iIndex++)oCPList[iIndex].bringToFront()},removeCP:function(oCP){var iIndex=this.options.oControlPointList.indexOf(oCP);iIndex>-1&&(this.removeCPEvents(oCP),this.removeLayer(oCP),this.options.oControlPointList.splice(iIndex,1))},removeAllCPByType:function(type){for(var oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;)oCPList[iIndex].getType()===type?this.removeCP(oCPList[iIndex]):iIndex++},getCoordinateList:function(){throw new Error("getCoordinateList function nor impletmented in editor.")},updateCPIndex:function(iStartIndex,iDelta){for(var oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&oCPList[iIndex].getIndex()>=iStartIndex&&oCPList[iIndex].setIndex(oCPList[iIndex].getIndex()+iDelta)},convertToUpdateCoordinates:function(oCoordList){for(var oUpdateCoordList=[],iIndex=0;iIndex<oCoordList.length;iIndex++)isNaN(oCoordList[iIndex].alt)?oUpdateCoordList.push({lat:oCoordList[iIndex].lat,lon:oCoordList[iIndex].lng}):oUpdateCoordList.push({lat:oCoordList[iIndex].lat,lon:oCoordList[iIndex].lng,alt:oCoordList[iIndex].alt});return oUpdateCoordList},_issueStartEvent:function(){this.isDrawMode()?this.getEngineInstanceInterface().empMapInstance.eventing.DrawStart({transaction:this.options.oTransaction}):this.getEngineInstanceInterface().empMapInstance.eventing.EditStart({transaction:this.options.oTransaction}),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.START),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE)},_issueCPUpdateEvent:function(oIndexArray,updateEventType){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList(),oUpdateCoordList=this.convertToUpdateCoordinates(oCoordList),oUpdateEvent={
name:oFeature.getName(),plotFeature:this.createEMPFeature(),updates:{type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:oIndexArray,coordinates:oUpdateCoordList},properties:oFeature.getProperties(),updateEventType:updateEventType,mapInstanceId:this.getEngineInstanceInterface().empMapInstance.mapInstanceId};this.options.oEmpDrawEditItem.update(oUpdateEvent)},_issueCPAddEvent:function(iIndex){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList(),oUpdateCoordList=this.convertToUpdateCoordinates(oCoordList),oUpdateEvent={name:oFeature.getName(),plotFeature:this.createEMPFeature(),updates:{type:emp.typeLibrary.CoordinateUpdateType.ADD,indices:[iIndex],coordinates:oUpdateCoordList},properties:oFeature.getProperties(),updateEventType:emp.typeLibrary.UpdateEventType.UPDATE,mapInstanceId:this.getEngineInstanceInterface().empMapInstance.mapInstanceId};this.options.oEmpDrawEditItem.update(oUpdateEvent)},_issueCPDeleteEvent:function(iIndex){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList(),oUpdateCoordList=this.convertToUpdateCoordinates(oCoordList),oUpdateEvent={name:oFeature.getName(),plotFeature:this.createEMPFeature(),updates:{type:emp.typeLibrary.CoordinateUpdateType.REMOVE,indices:[iIndex],coordinates:oUpdateCoordList},properties:oFeature.getProperties(),updateEventType:emp.typeLibrary.UpdateEventType.UPDATE,mapInstanceId:this.getEngineInstanceInterface().empMapInstance.mapInstanceId};this.options.oEmpDrawEditItem.update(oUpdateEvent)},_issueEndEvent:function(){this.isDrawMode()?(this.options.oEmpDrawEditItem.plotFeature=this.createEMPFeature(),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.COMPLETE),this.getEngineInstanceInterface().empMapInstance.eventing.DrawEnd({transaction:this.options.oTransaction})):(this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.COMPLETE),this.getEngineInstanceInterface().empMapInstance.eventing.EditEnd({transaction:this.options.oTransaction}))},_issueCancelEvent:function(){var oErrArray=[];oErrArray.push({coreId:this.options.oEmpDrawEditItem.coreId,message:"Operation canceled.",level:0}),this.isDrawMode()?this.getEngineInstanceInterface().empMapInstance.eventing.DrawEnd({transaction:this.options.oTransaction,failures:oErrArray}):this.getEngineInstanceInterface().empMapInstance.eventing.EditEnd({transaction:this.options.oTransaction,failures:oErrArray})},endEdit:function(){this._issueEndEvent(),this.getFeature().resetEditMode(),this.removeLeafletObjectEvents()},cancelEdit:function(){this._issueCancelEvent(),this.getFeature().resetEditMode(),this.removeLeafletObjectEvents()},updateLeafletObject:function(){var oFeature=this.getFeature(),oMapBounds=this.getLeafletMap().getBounds();oFeature.updateCoordinates(oMapBounds)},render:function(){this.updateLeafletObject(),this.removeAllControlPoints(),this.assembleControlPoints()}};return publicInterface},leafLet.editor.AbstractEditor=L.FeatureGroup.extend(leafLet.internalPrivateClass.AbstractEditor()),leafLet.internalPrivateClass.GeoJsonEditor=function(){var publicInterface={initialize:function(args){var oOptions={geoJsonType:args.geoJsonType?args.geoJsonType.toLowerCase():void 0};L.Util.setOptions(this,oOptions),leafLet.editor.AbstractEditor.prototype.initialize.call(this,args)},preapareForDrawOperation:function(){if(void 0===this.getFeature()){var oGeoJsonData={type:"Point",coordinates:[]};switch(this.options.geoJsonType){case"point":oGeoJsonData={type:"Point",coordinates:[]};break;case"linestring":oGeoJsonData={type:"LineString",coordinates:[]};break;case"polygon":oGeoJsonData={type:"Polygon",coordinates:[[]]}}this.options.feature=new leafLet.typeLibrary.GeoJsonFeature({item:{name:this.options.oEmpDrawEditItem.name,coreId:this.options.oEmpDrawEditItem.coreId,parentCoreId:this.options.oEmpDrawEditItem.parentCoreId,visible:!0,featureId:this.options.oEmpDrawEditItem.featureId,overlayId:this.options.oEmpDrawEditItem.overlayId,parentId:this.options.oEmpDrawEditItem.parentId,format:emp.typeLibrary.featureFormatType.GEOJSON,data:oGeoJsonData,properties:this.options.oEmpDrawEditItem.properties},instanceInterface:this.getEngineInstanceInterface()}),this.addLayer(this.options.feature),this.options.bDestroyFeature=!0}},preapareForEditOperation:function(){},getCoordinateList:function(){return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getFeature().getData())},setCoordinates:function(oLatLngList){leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getFeature().getData(),oLatLngList)},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length)switch(oFeature.getGeometryType().toLowerCase()){case"point":break;case"linestring":for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP);break;case"polygon":if(oCoordList.length>2){for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0,""),this.addControlPoint(oCP);oNewCoord=oCoordList[0].midPointTo(oCoordList[oCoordList.length-1]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,oCoordList.length,0),this.addControlPoint(oCP)}}},assembleControlPoints:function(){var oCP,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){switch(this.getFeature().getGeometryType().toLowerCase()){case"point":break;case"linestring":case"polygon":for(iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP)}this._addNewCP()}},_createLeafletObject:function(){var oLeafletObject,oCoordList=this.getCoordinateList(),oProperties=leafLet.utils.geoJson.mergeGeoJSONProperties(this.options.instanceInterface,this.options.oEmpDrawEditItem.properties);switch(this.getFeature().getGeometryType().toLowerCase()){case"point":oCoordList.length>0&&(oProperties.iconOptions.basePath=this.getEngineInstanceInterface().getBasePath(),oProperties.icon=new leafLet.typeLibrary.EmpIcon(oProperties.iconOptions),oLeafletObject=new L.Marker(oCoordList[0],oProperties),this.setCPEvents(oLeafletObject));break;case"linestring":oCoordList.length>1&&(oLeafletObject=new L.Polyline(oCoordList,oProperties));break;case"polygon":oCoordList.length>2&&(oLeafletObject=new L.Polygon(oCoordList,oProperties))}oLeafletObject&&this.setLeafletObject(oLeafletObject)},updateLeafletObject:function(){var oLeafletObject=this.getLeafletObject();if(void 0===oLeafletObject)this._createLeafletObject();else{var oCoordList=this.getCoordinateList();switch(this.getFeature().getGeometryType().toLowerCase()){case"point":oLeafletObject.setLatLng(oCoordList[0]);break;case"linestring":case"polygon":oLeafletObject.setLatLngs(oCoordList)}leafLet.editor.AbstractEditor.prototype.updateLeafletObject.call(this)}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList();switch(this.getFeature().getGeometryType().toLowerCase()){case"point":oCoordList.length>0?(oCoordList[0].lat=oLatLng.lat,oCoordList[0].lng=oLatLng.lng):oCoordList.push(oLatLng);break;case"linestring":oCP=new leafLet.editor.ControlPoint(this.getFeature(),leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length,0),oCoordList.push(oLatLng);break;case"polygon":oCP=new leafLet.editor.ControlPoint(this.getFeature(),leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length,0),oCoordList.push(oLatLng)}return this.setCoordinates(oCoordList),this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP(),oCP},doDeleteControlPoint:function(oCP){var bRet=!1,oCoordList=this.getCoordinateList(),iIndex=oCP.getIndex();if(oCP.getType()!==leafLet.ControlPoint.Type.POSITION_CP)return!1;switch(this.getFeature().getGeometryType().toLowerCase()){case"point":break;case"linestring":oCoordList.length>2&&(oCoordList.splice(iIndex,1),bRet=!0);break;case"polygon":oCoordList.length>3&&(oCoordList.splice(iIndex,1),bRet=!0)}return bRet&&(this.setCoordinates(oCoordList),this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()),bRet},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP);break;case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex])}return this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP(),[iIndex]},doFeatureMove:function(dBearing,dDistance){var oCoord,iCoordIndex,oCoordList=this.getCoordinateList(),oCPList=this.options.oControlPointList;if("point"===this.getFeature().getGeometryType().toLowerCase())oCoordList[0].moveCoordinate(dBearing,dDistance);else for(var iIndex=0;iIndex<oCPList.length;iIndex++)iCoordIndex=oCPList[iIndex].getIndex(),oCoord=oCPList[iIndex].getPosition(),oCoord.moveCoordinate(dBearing,dDistance),oCPList[iIndex].setCPPosition(oCoord),oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&(oCoordList[iCoordIndex]=oCoord);return this.setCoordinates(oCoordList),this.updateLeafletObject(),!0}};return publicInterface},leafLet.editor.GeoJson=leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.GeoJsonEditor()),leafLet.internalPrivateClass.MilStdEditor=function(){var publicInterface={initialize:function(args){var oOptions={bMultiPoint:args.multiPoint,sBasicSymbolCode:args.basicSymbolCode,oSymbolDef:args.SymbolDef,oMilStdModifiers:void 0,oCurrentCoordianteList:[]};L.Util.setOptions(this,oOptions),leafLet.editor.AbstractEditor.prototype.initialize.call(this,args)},isMultiPoint:function(){return this.options.bMultiPoint},getBasicSymbolCode:function(){return this.options.sBasicSymbolCode},getSymbolDef:function(){return this.options.oSymbolDef},preapareForDrawOperation:function(){if(void 0===this.getFeature()){var oFeature,oDrawItem=this.options.oEmpDrawEditItem;oFeature=this.isMultiPoint()?leafLet.utils.milstd.createTGFromDraw(this.getEngineInstanceInterface(),this.getLeafletMap(),this.getSymbolDef(),this.getBasicSymbolCode(),oDrawItem):new leafLet.typeLibrary.MilStdFeature({item:{name:oDrawItem.name,coreId:oDrawItem.coreId,parentCoreId:oDrawItem.parentCoreId,visible:!0,featureId:oDrawItem.featureId,overlayId:oDrawItem.overlayId,parentId:oDrawItem.parentId,format:emp.typeLibrary.featureFormatType.MILSTD,data:{symbolCode:oDrawItem.symbolCode,type:"Point",coordinates:[]},properties:emp.helpers.copyObject(oDrawItem.properties)},instanceInterface:this.getEngineInstanceInterface()}),this.setFeature(oFeature),this.options.bDestroyFeature=!0}this.preapareForEditOperation()},preapareForEditOperation:function(){var oRendererUtils=armyc2.c2sd.renderer.utilities,oFeature=this.getFeature(),oData=oFeature.getData(),sSymbolCode=oData.symbolCode;this.options.oMilStdModifiers=oFeature.options.oMilStdModifiers,this.options.sBasicSymbolCode=oRendererUtils.SymbolUtilities.getBasicSymbolID(sSymbolCode),this.options.bMultiPoint=oFeature.isMultiPointTG(),this.options.oSymbolDef=oRendererUtils.SymbolDefTable.getSymbolDef(this.options.sBasicSymbolCode,oFeature.get2525Version())},getCoordinateList:function(){return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getFeature().getData())},setCoordinates:function(oLatLngList){leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getFeature().getData(),oLatLngList)},updateLeafletObject:function(oCList){var oSymbolDef=this.getSymbolDef(),oCoordList=oCList||this.getCoordinateList();if(!this.isMultiPoint()||oCoordList.length>=oSymbolDef.minPoints){var oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers();oFeature.getProperties().modifiers=oModifiers.toLongModifiers();var oLeafletObject=oFeature._createFeature(oFeature.options);return this.setLeafletObject(oLeafletObject),!0}return!1},doFeatureMove:function(dBearing,dDistance){for(var oCoord,iCoordIndex,oCoordList=this.getCoordinateList(),oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)iCoordIndex=oCPList[iIndex].getIndex(),oCoord=oCPList[iIndex].getPosition(),oCoord.moveCoordinate(dBearing,dDistance),oCPList[iIndex].setCPPosition(oCoord),oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&(oCoordList[iCoordIndex]=oCoord);return this.setCoordinates(oCoordList),this.updateLeafletObject(),!0}};return publicInterface},leafLet.editor.MilStd=leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.MilStdEditor()),leafLet.internalPrivateClass.AOIEditor=function(){var publicInterface={initialize:function(args){var oOptions={geoJsonType:args.geoJsonType?args.geoJsonType.toLowerCase():void 0};L.Util.setOptions(this,oOptions),leafLet.editor.GeoJson.prototype.initialize.call(this,args)},preapareForEditOperation:function(){var oCoordList,dNorth,dSouth,dWest,dEast,iIndex;switch(this.getFeature().getAOIType()){case emp.typeLibrary.AOIType.POINT_RADIUS:break;case emp.typeLibrary.AOIType.LINE:break;case emp.typeLibrary.AOIType.POLYGON:break;case emp.typeLibrary.AOIType.BBOX:for(oCoordList=this.getCoordinateList(),dNorth=-90,dSouth=90,dWest=180,dEast=-180,iIndex=0;iIndex<oCoordList.length;iIndex++)oCoordList[iIndex].lat>dNorth&&(dNorth=oCoordList[iIndex].lat),oCoordList[iIndex].lat<dSouth&&(dSouth=oCoordList[iIndex].lat),oCoordList[iIndex].lng<dWest&&(dWest=oCoordList[iIndex].lng),oCoordList[iIndex].lng>dEast&&(dEast=oCoordList[iIndex].lng);oCoordList[0].lat=dNorth,oCoordList[0].lng=dWest,oCoordList[1].lat=dNorth,oCoordList[1].lng=dEast,oCoordList[2].lat=dSouth,oCoordList[2].lng=dEast,oCoordList[3].lat=dSouth,oCoordList[3].lng=dWest,this.setCoordinates(oCoordList)}},_addNewCP:function(){var oBufferCoord,oMidPointCoord,iIndex,iMostEastCoord,oMostEastCoord,oNextCoord,dBrng=90,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length)switch(this.getFeature().getAOIType()){case emp.typeLibrary.AOIType.POINT_RADIUS:oBufferCoord=oCoordList[0].destinationPoint(dBrng,oFeature.getAOIBuffer()),oMidPointCoord=oCoordList[0];break;case emp.typeLibrary.AOIType.LINE:leafLet.editor.GeoJson.prototype._addNewCP.call(this),oMidPointCoord=oCoordList[0].midPointTo(oCoordList[1]),dBrng=oCoordList[0].bearingTo(oCoordList[1]),dBrng=(dBrng+270)%360,oBufferCoord=oMidPointCoord.destinationPoint(dBrng,oFeature.getAOIBuffer());break;case emp.typeLibrary.AOIType.POLYGON:for(leafLet.editor.GeoJson.prototype._addNewCP.call(this),iMostEastCoord=0,iIndex=1;iIndex<oCoordList.length;iIndex++)oCoordList[iIndex].lng>oCoordList[iMostEastCoord].lng&&(iMostEastCoord=iIndex);oMostEastCoord=oCoordList[iMostEastCoord],oNextCoord=oCoordList[(iMostEastCoord+1)%oCoordList.length],oMidPointCoord=oMostEastCoord.midPointTo(oNextCoord),dBrng=oMostEastCoord.bearingTo(oNextCoord),dBrng=leafLet.utils.dateLineInFeature(oCoordList)?(dBrng+90)%360:(dBrng+270)%360,oBufferCoord=oMidPointCoord.destinationPoint(dBrng,oFeature.getAOIBuffer());break;case emp.typeLibrary.AOIType.BBOX:oMidPointCoord=oCoordList[1].midPointTo(oCoordList[2]),dBrng=oCoordList[1].bearingTo(oCoordList[2]),dBrng=(dBrng+270)%360,oBufferCoord=oMidPointCoord.destinationPoint(dBrng,oFeature.getAOIBuffer())}},removeAllCPByType:function(type){leafLet.editor.GeoJson.prototype.removeAllCPByType.call(this,type),type===leafLet.ControlPoint.Type.NEW_POSITION_CP&&leafLet.editor.GeoJson.prototype.removeAllCPByType.call(this,leafLet.ControlPoint.Type.AOI_BUFFER)},updateLeafletObject:function(){var oFeature=this.getFeature();oFeature.render()},doAddControlPoint:function(oLatLng){var oCP;switch(this.getFeature().getAOIType()){case emp.typeLibrary.AOIType.BBOX:break;default:oCP=leafLet.editor.GeoJson.prototype.doAddControlPoint.call(this,oLatLng)}return oCP},doControlPointMoved:function(oCP,oEvent){var aRet,oRefCoord,dAngle,dMouseAngle,dDist,oNewCoord,iCoordIndex,oCoordList,oTempCP,oFeature=this.getFeature();switch(oCP.getType()){case leafLet.ControlPoint.Type.AOI_BUFFER:oRefCoord=oCP.getIndex(),dAngle=oCP.getSubIndex(),dMouseAngle=oRefCoord.bearingTo(oEvent.latlng),dDist=oRefCoord.distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),oNewCoord=oRefCoord.destinationPoint(dAngle,dDist),oCP.setCPPosition(oNewCoord),oCP.setValue(dDist),oFeature.setAOIBufferProperty(dDist),this.updateLeafletObject(),aRet=[];break;case leafLet.ControlPoint.Type.POSITION_CP:switch(oFeature.getAOIType()){case emp.typeLibrary.AOIType.POINT_RADIUS:break;case emp.typeLibrary.AOIType.LINE:case emp.typeLibrary.AOIType.POLYGON:aRet=leafLet.editor.GeoJson.prototype.doControlPointMoved.call(this,oCP,oEvent);break;case emp.typeLibrary.AOIType.BBOX:switch(oCoordList=this.getCoordinateList(),iCoordIndex=oCP.getIndex(),oCoordList[iCoordIndex]=oEvent.latlng,oCP.setCPPosition(oCoordList[iCoordIndex]),iCoordIndex){case 0:oCoordList[3].lng=oCoordList[0].lng,oTempCP=this.getCP(3),oTempCP.setCPPosition(oCoordList[3]),oCoordList[1].lat=oCoordList[0].lat,oTempCP=this.getCP(1),oTempCP.setCPPosition(oCoordList[1]),aRet=[0,1,3];break;case 1:oCoordList[2].lng=oCoordList[1].lng,oTempCP=this.getCP(2),oTempCP.setCPPosition(oCoordList[2]),oCoordList[0].lat=oCoordList[1].lat,oTempCP=this.getCP(0),oTempCP.setCPPosition(oCoordList[0]),aRet=[0,1,2];break;case 2:oCoordList[1].lng=oCoordList[2].lng,oTempCP=this.getCP(1),oTempCP.setCPPosition(oCoordList[1]),oCoordList[3].lat=oCoordList[2].lat,oTempCP=this.getCP(3),oTempCP.setCPPosition(oCoordList[3]),aRet=[1,2,3];break;case 3:oCoordList[0].lng=oCoordList[3].lng,oTempCP=this.getCP(0),oTempCP.setCPPosition(oCoordList[0]),oCoordList[2].lat=oCoordList[3].lat,oTempCP=this.getCP(2),oTempCP.setCPPosition(oCoordList[2]),aRet=[0,2,3]}this.setCoordinates(oCoordList),this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()}break;default:aRet=leafLet.editor.GeoJson.prototype.doControlPointMoved.call(this,oCP,oEvent)}return aRet},doDeleteControlPoint:function(oCP){var bRet=!1;switch(this.getFeature().getAOIType()){case emp.typeLibrary.AOIType.BBOX:break;default:bRet=leafLet.editor.GeoJson.prototype.doDeleteControlPoint.call(this,oCP)}return bRet}};return publicInterface},leafLet.editor.AOI=leafLet.editor.GeoJson.extend(leafLet.internalPrivateClass.AOIEditor()),leafLet.internalPrivateClass.KMLEditor=function(){var publicInterface={initialize:function(args){var oOptions={};L.Util.setOptions(this,oOptions),leafLet.editor.AbstractEditor.prototype.initialize.call(this,args)},getCoordinateList:function(){return leafLet.utils.kml.convertCoordinatesToLatLng(this.getFeature().getData())},setCoordinates:function(oLatLngList){var sKML=leafLet.utils.kml.convertLatLngListToKML(this.getFeature().getData(),oLatLngList);this.getFeature().setData(sKML)},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oLeafletObject=this.getLeafletObject();if(0!==oCoordList.length)if(oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Polygon){if(oCoordList.length>2){for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0,""),this.addControlPoint(oCP);oNewCoord=oCoordList[0].midPointTo(oCoordList[oCoordList.length-1]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,oCoordList.length,0),this.addControlPoint(oCP)}}else if(oLeafletObject instanceof L.Polyline&&oCoordList.length>1)for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP)},assembleControlPoints:function(){var oCP,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oLeafletObject=this.getLeafletObject();if(0!==oCoordList.length)if(oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Marker);else if(oLeafletObject instanceof L.Polygon||oLeafletObject instanceof L.Polyline){for(iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);this._addNewCP()}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oLeafletObject=this.getLeafletObject();if(oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Marker){if(oCoordList.length>0)return}else oLeafletObject instanceof L.Polygon||oLeafletObject instanceof L.Polyline;return oLeafletObject instanceof L.Marker||(oCP=new leafLet.editor.ControlPoint(this.getFeature(),leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length,0)),oCoordList.push(oLatLng),this.setCoordinates(oCoordList),this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP(),oCP},doDeleteControlPoint:function(oCP){var bRet=!1,oCoordList=this.getCoordinateList(),iIndex=oCP.getIndex(),oLeafletObject=this.getLeafletObject();return oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Polygon?oCoordList.length>3&&(oCoordList.splice(iIndex,1),bRet=!0):oLeafletObject instanceof L.Polyline&&oCoordList.length>2&&(oCoordList.splice(iIndex,1),bRet=!0),bRet&&(this.setCoordinates(oCoordList),this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()),bRet},doControlPointMoved:function(oCP,oEvent){var oRet=void 0,iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this._issueCPAddEvent(iNewIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),oRet=[iIndex]}return this.updateLeafletObject(),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP(),oRet},doFeatureMove:function(dBearing,dDistance){var oCoord,iCoordIndex,oCoordList=this.getCoordinateList(),oCPList=this.options.oControlPointList,oLeafletObject=this.getLeafletObject();if(oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Marker)oCoord=oCoordList[0],oCoord.moveCoordinate(dBearing,dDistance);else for(var iIndex=0;iIndex<oCPList.length;iIndex++)iCoordIndex=oCPList[iIndex].getIndex(),oCoord=oCPList[iIndex].getPosition(),oCoord.moveCoordinate(dBearing,dDistance),oCPList[iIndex].setCPPosition(oCoord),oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&(oCoordList[iCoordIndex]=oCoord);return this.setCoordinates(oCoordList),this.updateLeafletObject(),!0},updateLeafletObject:function(oCoord){var oCoordList=oCoord||this.getCoordinateList(),oLeafletObject=this.getLeafletObject(),oMapBounds=this.getLeafletMap().getBounds();leafLet.utils.wrapCoordinates(oMapBounds,oCoordList,!1),oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Marker?oLeafletObject.setLatLng(oCoordList[0]):(oLeafletObject instanceof L.Polygon||oLeafletObject instanceof L.Polyline)&&oLeafletObject.setLatLngs(oCoordList)},convertToUpdateCoordinates:function(oCoordList){var oUpdateCoordList=leafLet.editor.AbstractEditor.prototype.convertToUpdateCoordinates.call(this,oCoordList),oLeafletObject=this.getLeafletObject();return oLeafletObject instanceof L.LayerGroup&&(oLeafletObject=oLeafletObject.getLayers()[0]),oLeafletObject instanceof L.Polygon&&(isNaN(oCoordList[0].alt)?oUpdateCoordList.push({lat:oCoordList[0].lat,lon:oCoordList[0].lng}):oUpdateCoordList.push({lat:oCoordList[0].lat,lon:oCoordList[0].lng,alt:oCoordList[0].alt})),oUpdateCoordList}};return publicInterface},leafLet.editor.KML=leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.KMLEditor()),leafLet.internalPrivateClass.AirspaceEditor=function(){var publicInterface={initialize:function(args){var oOptions={};L.Util.setOptions(this,oOptions),leafLet.editor.AbstractEditor.prototype.initialize.call(this,args)},preapareForDrawOperation:function(){if(void 0===this.getFeature()){var oGeoJsonData,cAirspaceType=emp.typeLibrary.airspaceSymbolCode;switch(this.options.oEmpDrawEditItem.symbolCode){case cAirspaceType.SHAPE3D_CYLINDER:case cAirspaceType.SHAPE3D_RADARC:oGeoJsonData={symbolCode:this.options.oEmpDrawEditItem.symbolCode,type:"Point",coordinates:[]};break;default:oGeoJsonData={symbolCode:this.options.oEmpDrawEditItem.symbolCode,type:"LineString",coordinates:[]}}this.options.feature=leafLet.utils.airspace.createAirspace({item:{name:this.options.oEmpDrawEditItem.name,coreId:this.options.oEmpDrawEditItem.coreId,parentCoreId:this.options.oEmpDrawEditItem.parentCoreId,visible:!0,featureId:this.options.oEmpDrawEditItem.featureId,overlayId:this.options.oEmpDrawEditItem.overlayId,parentId:this.options.oEmpDrawEditItem.parentId,format:emp3.api.enums.FeatureTypeEnum.GEO_ACM,data:oGeoJsonData,properties:this.options.oEmpDrawEditItem.properties},instanceInterface:this.getEngineInstanceInterface()}),this.addLayer(this.options.feature),this.options.bDestroyFeature=!0}this.preapareForEditOperation()},preapareForEditOperation:function(){},getCoordinateList:function(){return leafLet.utils.geoJson.convertCoordinatesToLatLng(this.getFeature().getData())},setCoordinates:function(oLatLngList){leafLet.utils.geoJson.convertLatLngListToGeoJson(this.getFeature().getData(),oLatLngList)},updateLeafletObject:function(oCList){var oFeature=this.getFeature(),oCoordList=oCList||this.getCoordinateList();if(oCoordList.length>=oFeature.getMinPoints()){var oLeafletObject,cAirspaceType=emp.typeLibrary.airspaceSymbolCode,oAttributeList=oFeature.getAttributeList();switch(oFeature.getProperties().attributes=oAttributeList.getAirspaceAttributeList(),this.options.oEmpDrawEditItem.symbolCode){case cAirspaceType.SHAPE3D_CURTAIN:case cAirspaceType.SHAPE3D_POLYGON:var oMapBounds=this.getLeafletMap().getBounds();leafLet.utils.wrapCoordinates(oMapBounds,oCoordList,!1),oLeafletObject=this.getLeafletObject(),oLeafletObject.setLatLngs(oCoordList);break;case cAirspaceType.SHAPE3D_CYLINDER:case cAirspaceType.SHAPE3D_ORBIT:case cAirspaceType.SHAPE3D_ROUTE:case cAirspaceType.SHAPE3D_TRACK:case cAirspaceType.SHAPE3D_RADARC:case cAirspaceType.SHAPE3D_POLYARC:default:oLeafletObject=oFeature._createFeature(oFeature.options),this.setLeafletObject(oLeafletObject)}return!0}return!1},doFeatureMove:function(dBearing,dDistance){for(var oCoord,iCoordIndex,oCoordList=this.getCoordinateList(),oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)iCoordIndex=oCPList[iIndex].getIndex(),oCoord=oCPList[iIndex].getPosition(),oCoord.moveCoordinate(dBearing,dDistance),oCPList[iIndex].setCPPosition(oCoord),oCPList[iIndex].getType()===leafLet.ControlPoint.Type.POSITION_CP&&(oCoordList[iCoordIndex]=oCoord);return this.setCoordinates(oCoordList),this.updateLeafletObject(),!0}};return publicInterface},leafLet.editor.Airspace=leafLet.editor.AbstractEditor.extend(leafLet.internalPrivateClass.AirspaceEditor()),leafLet.internalPrivateClass.MilStdDCAutoShapeEditor=function(){var publicInterface={initialize:function(args){var oCoordList,dDistC1,dDistC2,dDistC3,Temp,oBasicCodes=leafLet.utils.milstd.basicSymbolCode;switch(leafLet.editor.MilStd.prototype.initialize.call(this,args),this.getBasicSymbolCode()){case oBasicCodes.MINIMUM_SAFE_DISTANCE_ZONES:oCoordList=this.getCoordinateList(),dDistC1=oCoordList[0].distanceTo(oCoordList[1]),dDistC2=oCoordList[0].distanceTo(oCoordList[2]),dDistC3=oCoordList[0].distanceTo(oCoordList[3]),dDistC1>dDistC2&&(Temp=oCoordList[1],oCoordList[1]=oCoordList[2],oCoordList[2]=Temp,Temp=dDistC2,dDistC2=dDistC1,dDistC1=Temp),dDistC2>dDistC3&&(Temp=oCoordList[2],oCoordList[2]=oCoordList[3],oCoordList[3]=Temp,Temp=dDistC3,dDistC3=dDistC2,dDistC2=Temp),dDistC1>dDistC2&&(Temp=oCoordList[1],oCoordList[1]=oCoordList[2],oCoordList[2]=Temp,Temp=dDistC2,dDistC2=dDistC1,dDistC1=Temp)}},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length)for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP)},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oSymbolDef=this.getSymbolDef();if(!(oCoordList.length>=oSymbolDef.maxPoints)){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return this.updateLeafletObject(oCoordList),oCP}},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var oCPPt2,oCPt,dBearing,dDist,iIndex2,iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oRet=void 0,oBasicCodes=leafLet.utils.milstd.basicSymbolCode;switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:switch(oRet=[],this.getBasicSymbolCode()){case oBasicCodes.MINIMUM_SAFE_DISTANCE_ZONES:if(0===iIndex)for(dBearing=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),iIndex2=0;iIndex2<oCoordList.length;iIndex2++)oRet.push(iIndex2),oCoordList[iIndex2].moveCoordinate(dBearing,dDist),oCPt=this.getCP(iIndex2),oCPt.setCPPosition(oCoordList[iIndex2]);else 1===iIndex?(dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist<oCoordList[0].distanceTo(oCoordList[2])&&(oRet.push(iIndex),oCoordList[iIndex]=oEvent.latlng,oCP.setCPPosition(oCoordList[iIndex]))):2===iIndex?(dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist<oCoordList[0].distanceTo(oCoordList[3])&&dDist>oCoordList[0].distanceTo(oCoordList[1])&&(oRet.push(iIndex),dBearing=oCoordList[0].bearingTo(oEvent.latlng),oCoordList[iIndex]=oEvent.latlng,oCP.setCPPosition(oCoordList[iIndex]))):(dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist>oCoordList[0].distanceTo(oCoordList[2])&&(oRet.push(iIndex),dBearing=oCoordList[0].bearingTo(oEvent.latlng),oCoordList[iIndex]=oEvent.latlng,oCP.setCPPosition(oCoordList[iIndex])));break;default:oRet.push(iIndex),0===iIndex&&2===oCoordList.length?(oCPPt2=this.getCP(1),dBearing=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCoordList[1].moveCoordinate(dBearing,dDist),oCPPt2.setCPPosition(oCoordList[1]),oRet.push(1)):(oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng),oCP.setCPPosition(oCoordList[iIndex])}this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList)}return oRet}};return publicInterface},leafLet.editor.MilStdDCAutoShape=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCAutoShapeEditor()),leafLet.internalPrivateClass.MilStdDCCircularAutoShapeEditor=function(){
var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},_addRadiusCP:function(oCoordList){var oCP,oCPPosition,dRange,oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers();oCoordList.length>=oSymbolDef.minPoints&&oModifiers.getAMValueCount()>0&&(dRange=oModifiers.getAMValue(0),oCPPosition=oCoordList[0].destinationPoint(90,dRange),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RADIUS_CP,oCPPosition,0,90,dRange),this.addControlPoint(oCP))},assembleControlPoints:function(){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[0],0,0);this.addControlPoint(oCP),this._addRadiusCP(oCoordList)}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(!(oCoordList.length>=oSymbolDef.maxPoints))return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.updateLeafletObject(oCoordList)&&this._addRadiusCP(oCoordList),oCP},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var dMouseAngle,dAngle,dDist,oCPPos,oRet=(Number.MAX_VALUE,void 0),oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),iCPIndex=oCP.getIndex();if(!(oCoordList.length<oSymbolDef.minPoints)){switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[0].lat=oEvent.latlng.lat,oCoordList[0].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[0]),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this._addRadiusCP(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.RADIUS_CP:dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),oModifiers.setAMValue(iCPIndex,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE)}return oRet}}};return publicInterface},leafLet.editor.MilStdDCCircularAutoShape=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCCircularAutoShapeEditor()),leafLet.internalPrivateClass.MilStdDCCircularRangeFanEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},_addRangeCPs:function(oCoordList){var oCP,oCPPosition,dRange,oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),oAMList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE];if(oCoordList.length>=oSymbolDef.minPoints)for(var iIndex=0;iIndex<oAMList.length;iIndex++)dRange=oAMList[iIndex],oCPPosition=oCoordList[0].destinationPoint(0,dRange),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RANGE_CP,oCPPosition,iIndex,0,dRange),this.addControlPoint(oCP)},assembleControlPoints:function(){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[0],0,0);this.addControlPoint(oCP),this._addRangeCPs(oCoordList)}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers();if(oCoordList.length>=oSymbolDef.maxPoints){var iIndex,oAMList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE],dDist=oCoordList[0].distanceTo(oLatLng),iAMCnt=oModifiers.getAMValueCount();if(3===iAMCnt)return;for(iIndex=0;iIndex<iAMCnt&&!(dDist<oModifiers.getAMValue(iIndex));iIndex++);return oAMList.splice(iIndex,0,dDist),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this.updateLeafletObject(oCoordList),this._addRangeCPs(oCoordList),void this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE)}return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.updateLeafletObject(oCoordList)&&this._addRangeCPs(oCoordList),oCP},doDeleteControlPoint:function(oCP){},doControlPointMoved:function(oCP,oEvent){var dMouseAngle,dAngle,dDist,oCPPos,dNextRange=Number.MAX_VALUE,dPrevRange=0,oRet=void 0,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),iCPIndex=oCP.getIndex();if(!(oCoordList.length<oSymbolDef.minPoints)){switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[0].lat=oEvent.latlng.lat,oCoordList[0].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[0]),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this._addRangeCPs(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.RANGE_CP:dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),iCPIndex>0&&(dPrevRange=oModifiers.getAMValue(iCPIndex-1)),iCPIndex+1<oModifiers.getAMValueCount()&&(dNextRange=oModifiers.getAMValue(iCPIndex+1)),dPrevRange<dDist&&dDist<dNextRange&&(oModifiers.setAMValue(iCPIndex,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE))}return oRet}}};return publicInterface},leafLet.editor.MilStdDCCircularRangeFan=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCCircularRangeFanEditor()),leafLet.internalPrivateClass.MilStdDCLineEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},preapareForDrawOperation:function(){if(void 0===this.getFeature()){var oGeoJsonData={symbolCode:this.options.oEmpDrawEditItem.symbolCode,type:"LineString",coordinates:[]};this.options.feature=new leafLet.typeLibrary.MilStdFeature({item:{name:this.options.oEmpDrawEditItem.name,coreId:this.options.oEmpDrawEditItem.coreId,parentCoreId:this.options.oEmpDrawEditItem.parentCoreId,privateInterface:this.options.instanceInterface,visible:!0,featureId:this.options.oEmpDrawEditItem.featureId,overlayId:this.options.oEmpDrawEditItem.overlayId,parentId:this.options.oEmpDrawEditItem.parentId,format:emp.typeLibrary.featureFormatType.MILSTD,data:oGeoJsonData,properties:this.options.oEmpDrawEditItem.properties},instanceInterface:this.options.instanceInterface}),this.addLayer(this.options.feature),this.options.bDestroyFeature=!0}this.preapareForEditOperation()},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>2)for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP)},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oSymbolDef.minPoints&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP())}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature();oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()),oCP},doDeleteControlPoint:function(oCP){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oSymbolDef.minPoints)&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),!0))},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._issueCPAddEvent(iNewIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),[iIndex]}}};return publicInterface},leafLet.editor.MilStdDCLine=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCLineEditor()),leafLet.internalPrivateClass.MilStdDCPolygonEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},preapareForDrawOperation:function(){if(void 0===this.getFeature()){var oGeoJsonData={symbolCode:this.options.oEmpDrawEditItem.symbolCode,type:"LineString",coordinates:[]};this.options.feature=new leafLet.typeLibrary.MilStdFeature({item:{name:this.options.oEmpDrawEditItem.name,coreId:this.options.oEmpDrawEditItem.coreId,parentCoreId:this.options.oEmpDrawEditItem.parentCoreId,visible:!0,featureId:this.options.oEmpDrawEditItem.featureId,overlayId:this.options.oEmpDrawEditItem.overlayId,parentId:this.options.oEmpDrawEditItem.parentId,format:emp.typeLibrary.featureFormatType.MILSTD,data:oGeoJsonData,properties:this.options.oEmpDrawEditItem.properties},instanceInterface:this.options.instanceInterface}),this.addLayer(this.options.feature),this.options.bDestroyFeature=!0}this.preapareForEditOperation()},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>2){for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP);oNewCoord=oCoordList[0].midPointTo(oCoordList[oCoordList.length-1]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,oCoordList.length,0),this.addControlPoint(oCP)}},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oSymbolDef.minPoints&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP())}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature();oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()),oCP},doDeleteControlPoint:function(oCP){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oSymbolDef.minPoints)&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(),this._addNewCP(),!0))},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();return this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),void this._issueCPAddEvent(iNewIndex);case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),[iIndex]}}};return publicInterface},leafLet.editor.MilStdDCPolygon=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCPolygonEditor()),leafLet.internalPrivateClass.MilStdDCRectParamAutoShapeEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},_addWidthCP:function(oCoordList){var oSymbolDef=this.getSymbolDef();if(oCoordList.length>=oSymbolDef.minPoints){var oWidthPoint,oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),dWidth=oModifiers.getAMValue(1),dAngle=(oModifiers.getANValue(0)+0)%360;oWidthPoint=oCoordList[0].destinationPoint(dAngle,dWidth/2);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.WIDTH_CP,oWidthPoint,0,0,dWidth);this.addControlPoint(oCP)}},_addLengthCP:function(oCoordList){var oSymbolDef=this.getSymbolDef();if(oCoordList.length>=oSymbolDef.minPoints){var oLengthPoint,oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),dLength=oModifiers.getAMValue(0),dAngle=(oModifiers.getANValue(0)+90)%360;oLengthPoint=oCoordList[0].destinationPoint(dAngle,dLength/2);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.LENGTH_CP,oLengthPoint,0,0,dLength);this.addControlPoint(oCP)}},_addAttitudeCP:function(oCoordList){var oSymbolDef=this.getSymbolDef();if(oCoordList.length>=oSymbolDef.minPoints){var oAttitudePoint,oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),dWidth=Math.round(oModifiers.getAMValue(0)/2),dAngle=oModifiers.getANValue(0);oAttitudePoint=oCoordList[0].destinationPoint((dAngle+270)%360,dWidth);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.ATTITUDE_CP,oAttitudePoint,0,0,dAngle);this.addControlPoint(oCP)}},assembleControlPoints:function(){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[0],0,0);this.addControlPoint(oCP),this._addWidthCP(oCoordList),this._addLengthCP(oCoordList),this._addAttitudeCP(oCoordList)}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(!(oCoordList.length>=oSymbolDef.maxPoints))return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.updateLeafletObject(oCoordList)&&(this._addWidthCP(oCoordList),this._addLengthCP(oCoordList),this._addAttitudeCP(oCoordList)),oCP},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var oWidthPoint,dWidth,dAngle,dMouseAngle,oAttitudePoint,oLengthPoint,dLength,oRet=void 0,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers();if(!(oCoordList.length<oSymbolDef.minPoints)){switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[0].lat=oEvent.latlng.lat,oCoordList[0].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[0]),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LENGTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.ATTITUDE_CP),this._addWidthCP(oCoordList),this._addLengthCP(oCoordList),this._addAttitudeCP(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.WIDTH_CP:dAngle=(oModifiers.getANValue(0)+0)%360,dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dWidth=2*oCoordList[0].distanceTo(oEvent.latlng),dWidth=Math.abs(Math.round(dWidth*Math.cos((dMouseAngle-dAngle).toRad()))),oWidthPoint=oCoordList[0].destinationPoint(dAngle,dWidth/2),oModifiers.setAMValue(1,dWidth),oCP.setValue(dWidth),oCP.setCPPosition(oWidthPoint),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.LENGTH_CP:dAngle=(oModifiers.getANValue(0)+90)%360,dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dLength=2*oCoordList[0].distanceTo(oEvent.latlng),dLength=Math.abs(Math.round(dLength*Math.cos((dMouseAngle-dAngle).toRad()))),oLengthPoint=oCoordList[0].destinationPoint(dAngle,dLength/2),oModifiers.setAMValue(0,dLength),oCP.setValue(dLength),oCP.setCPPosition(oLengthPoint),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.ATTITUDE_CP),this._addAttitudeCP(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.ATTITUDE_CP:dLength=oModifiers.getAMValue(0)/2,dAngle=oCoordList[0].bearingTo(oEvent.latlng),oAttitudePoint=oCoordList[0].destinationPoint(dAngle,dLength),dAngle=(dAngle+90)%360,oModifiers.setANValue(0,dAngle),oCP.setValue(dAngle),oCP.setCPPosition(oAttitudePoint),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LENGTH_CP),this._addWidthCP(oCoordList),this._addLengthCP(oCoordList),oRet=[0]}return oRet}}};return publicInterface},leafLet.editor.MilStdDCRectParamAutoShape=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCRectParamAutoShapeEditor()),leafLet.internalPrivateClass.MilStdDCRouteEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},preapareForDrawOperation:function(){if(void 0===this.getFeature()){var oGeoJsonData={symbolCode:this.options.oEmpDrawEditItem.symbolCode,type:"LineString",coordinates:[]};this.options.feature=new leafLet.typeLibrary.MilStdFeature({item:{name:this.options.oEmpDrawEditItem.name,coreId:this.options.oEmpDrawEditItem.coreId,parentCoreId:this.options.oEmpDrawEditItem.parentCoreId,visible:!0,featureId:this.options.oEmpDrawEditItem.featureId,overlayId:this.options.oEmpDrawEditItem.overlayId,parentId:this.options.oEmpDrawEditItem.parentId,format:emp.typeLibrary.featureFormatType.MILSTD,data:oGeoJsonData,properties:this.options.oEmpDrawEditItem.properties},instanceInterface:this.options.instanceInterface}),this.addLayer(this.options.feature),this.options.bDestroyFeature=!0}this.preapareForEditOperation()},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length<3))for(iIndex=1;iIndex<oCoordList.length-1;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP)},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oSymbolDef.minPoints&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP())}},doAddControlPoint:function(oLatLng){var iIndex,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();oCoordList.length<oSymbolDef.minPoints?(iIndex=oCoordList.length,oCoordList.push(oLatLng)):(iIndex=oCoordList.length-1,oCoordList.splice(iIndex,0,oLatLng)),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,iIndex,0);return this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()),oCP},doDeleteControlPoint:function(oCP){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oSymbolDef.minPoints)&&(iIndex!==oCoordList.length-1&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this._addNewCP(),!0)))},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();return this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),void this._issueCPAddEvent(iNewIndex);case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),[iIndex]}}};return publicInterface},leafLet.editor.MilStdDCRoute=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCRouteEditor()),leafLet.internalPrivateClass.MilStdDCSectorParamAutoShapeEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},_addRangeCPs:function(oCoordList){var oCP,oCPPosition,dRange,dLeftAzimuth,dRightAzimuth,dMidAzimuth,oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),oAMList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE],oANList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH],iANIndex=0,bMinimumRange=!1;if(oCoordList.length>=oSymbolDef.minPoints){2*oAMList.length>oANList.length&&(bMinimumRange=!0);for(var iIndex=0;iIndex<oAMList.length&&iANIndex<oANList.length;iIndex++)dRange=oAMList[iIndex],dLeftAzimuth=oANList[iANIndex],dRightAzimuth=oANList[iANIndex+1],dMidAzimuth=(dLeftAzimuth+dRightAzimuth)/2,dLeftAzimuth>dRightAzimuth&&(dMidAzimuth=(dMidAzimuth+180)%360),oCPPosition=oCoordList[0].destinationPoint(dMidAzimuth,dRange),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RANGE_CP,oCPPosition,iIndex,dMidAzimuth,dRange),this.addControlPoint(oCP),bMinimumRange&&0===iIndex||(iANIndex+=2)}},_addAzimuthCPs:function(oCoordList){var oCP,oCPPosition,dRange,dAzimuthCPDist,dLeftAzimuth,dRightAzimuth,oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),oAMList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE],oANList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH],dPrevRange=0,iANIndex=0,bMinimumRange=!1;if(oCoordList.length>=oSymbolDef.minPoints){2*oAMList.length>oANList.length&&(bMinimumRange=!0);for(var iIndex=0;iIndex<oAMList.length&&iANIndex<oANList.length;iIndex++)dRange=oAMList[iIndex],dLeftAzimuth=oANList[iANIndex],dRightAzimuth=oANList[iANIndex+1],bMinimumRange&&0===iIndex?dPrevRange=dRange:(dAzimuthCPDist=(dRange-dPrevRange)/2+dPrevRange,oCPPosition=oCoordList[0].destinationPoint(dLeftAzimuth,dAzimuthCPDist),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.AZIMUTH_CP,oCPPosition,iANIndex,dAzimuthCPDist,dLeftAzimuth),this.addControlPoint(oCP),oCPPosition=oCoordList[0].destinationPoint(dRightAzimuth,dAzimuthCPDist),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.AZIMUTH_CP,oCPPosition,iANIndex+1,dAzimuthCPDist,dRightAzimuth),this.addControlPoint(oCP),iANIndex+=2,dPrevRange=dRange)}},assembleControlPoints:function(){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[0],0,0);this.addControlPoint(oCP),this._addRangeCPs(oCoordList),this._addAzimuthCPs(oCoordList)}},doAddControlPoint:function(oLatLng){var iAzimuthIndex,oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers();if(oCoordList.length>=oSymbolDef.maxPoints){var iIndex,dLeftAzimuth,dRightAzimuth,oAMList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE],oANList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH],dDist=oCoordList[0].distanceTo(oLatLng),iAMCnt=oModifiers.getAMValueCount(),bMinimumRange=!1;for(2*oAMList.length>oANList.length&&(bMinimumRange=!0),iIndex=0;iIndex<iAMCnt&&!(dDist<oModifiers.getAMValue(iIndex));iIndex++);return iAzimuthIndex=0,oAMList.splice(iIndex,0,dDist),dLeftAzimuth=oModifiers.getANValue(iAzimuthIndex),dRightAzimuth=oModifiers.getANValue(iAzimuthIndex+1),iAzimuthIndex+2<oModifiers.getANValueCount()&&(iAzimuthIndex+=2),oANList.splice(iAzimuthIndex,0,dLeftAzimuth),oANList.splice(iAzimuthIndex+1,0,dRightAzimuth),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addRangeCPs(oCoordList),this._addAzimuthCPs(oCoordList),void this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE)}return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.updateLeafletObject(oCoordList)&&(this._addRangeCPs(oCoordList),this._addAzimuthCPs(oCoordList)),oCP},doDeleteControlPoint:function(oCP){var iAzimuthIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),oAMList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.DISTANCE],oANList=oModifiers.oModifiers[leafLet.utils.milstd.Modifiers.AZIMUTH],iIndex=oCP.getIndex(),bMinimumRange=!1;switch(2*oAMList.length>oANList.length&&(bMinimumRange=!0),oCP.getType()){case leafLet.ControlPoint.Type.RANGE_CP:oAMList.length>1&&(oAMList.splice(iIndex,1),bMinimumRange?0!==iIndex&&oANList.length>2&&(iAzimuthIndex=2*(iIndex-1),oANList.splice(iAzimuthIndex,1),oANList.splice(iAzimuthIndex,1)):(iAzimuthIndex=2*iIndex,oANList.splice(iAzimuthIndex,1),oANList.splice(iAzimuthIndex,1)),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addRangeCPs(oCoordList),this._addAzimuthCPs(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE));break;case leafLet.ControlPoint.Type.AZIMUTH_CP:oANList.length>2&&!bMinimumRange&&iIndex<2&&(oANList.splice(0,1),oANList.splice(0,1),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addRangeCPs(oCoordList),this._addAzimuthCPs(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE))}return!1},doControlPointMoved:function(oCP,oEvent){var dMouseAngle,dAngle,dDist,oCPPos,dNextRange=Number.MAX_VALUE,dPrevRange=0,oRet=void 0,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),iCPIndex=oCP.getIndex();if(!(oCoordList.length<oSymbolDef.minPoints)){switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[0].lat=oEvent.latlng.lat,oCoordList[0].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[0]),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP),this._addRangeCPs(oCoordList),this._addAzimuthCPs(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.RANGE_CP:dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),iCPIndex>0&&(dPrevRange=oModifiers.getAMValue(iCPIndex-1)),iCPIndex+1<oModifiers.getAMValueCount()&&(dNextRange=oModifiers.getAMValue(iCPIndex+1)),dPrevRange<dDist&&dDist<dNextRange&&(oModifiers.setAMValue(iCPIndex,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.AZIMUTH_CP),this._addAzimuthCPs(oCoordList),oRet=[0]);break;case leafLet.ControlPoint.Type.AZIMUTH_CP:dDist=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),oCPPos=oCoordList[0].destinationPoint(dMouseAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dMouseAngle),oModifiers.setANValue(iCPIndex,dMouseAngle),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RANGE_CP),this._addRangeCPs(oCoordList),oRet=[0]}return oRet}}};return publicInterface},leafLet.editor.MilStdDCSectorParamAutoShape=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCSectorParamAutoShapeEditor()),leafLet.internalPrivateClass.MilStdDCSuperAutoShapeEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},_createWidthCP:function(oCoordList){var oCP,oFeature=this.getFeature(),sBasicSymbolCode=this.options.sBasicSymbolCode,oBasicSymbolCodes=leafLet.utils.milstd.basicSymbolCode,dBearingPt1Pt2=oCoordList[0].bearingTo(oCoordList[1]),dBearingWLine=(dBearingPt1Pt2+270)%360,oIntPoint=oCoordList[0].intersectLines(dBearingPt1Pt2,oCoordList[2],dBearingWLine);if(oIntPoint||(dBearingWLine=(dBearingWLine+180)%360,oIntPoint=oCoordList[0].intersectLines(dBearingPt1Pt2,oCoordList[2],dBearingWLine)),oIntPoint||(dBearingPt1Pt2=(dBearingPt1Pt2+180)%360,oIntPoint=oCoordList[0].intersectLines(dBearingPt1Pt2,oCoordList[2],dBearingWLine)),oIntPoint||(dBearingWLine=(dBearingWLine+180)%360,oIntPoint=oCoordList[0].intersectLines(dBearingPt1Pt2,oCoordList[2],dBearingWLine)),oIntPoint){var dWidth=Math.round(oCoordList[2].distanceTo(oIntPoint));sBasicSymbolCode===oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED&&(dWidth*=2),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.WIDTH_CP,oCoordList[2],2,0,dWidth)}return oCP},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),sBasicSymbolCode=this.options.sBasicSymbolCode,oBasicSymbolCodes=leafLet.utils.milstd.basicSymbolCode;
if(0!==oCoordList.length)for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=2!==iIndex||sBasicSymbolCode!==oBasicSymbolCodes.FORD_EASY&&sBasicSymbolCode!==oBasicSymbolCodes.FORD_DIFFICULT&&sBasicSymbolCode!==oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED?new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0):this._createWidthCP(oCoordList),this.addControlPoint(oCP)},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature(),sBasicSymbolCode=this.options.sBasicSymbolCode,oBasicSymbolCodes=leafLet.utils.milstd.basicSymbolCode;if(!(oCoordList.length>=oSymbolDef.maxPoints))return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=3!==oCoordList.length||sBasicSymbolCode!==oBasicSymbolCodes.FORD_EASY&&sBasicSymbolCode!==oBasicSymbolCodes.FORD_DIFFICULT&&sBasicSymbolCode!==oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED?new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0):this._createWidthCP(oCoordList),this.updateLeafletObject(),oCP},doDeleteControlPoint:function(oCP){var oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),iIndex=oCP.getIndex();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oSymbolDef.minPoints)&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),!0))},_moveFordCP:function(oCP,oEvent){var oMidPoint,dDist,dBearingMidPt3,dNewBearingMidPt3,dBearingPt1Pt2,dNewBearingPt1Pt2,oCP3,Pt3Coord,oRet=void 0,iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),sBasicSymbolCode=this.options.sBasicSymbolCode,oBasicSymbolCodes=leafLet.utils.milstd.basicSymbolCode;switch(iIndex){case 0:case 1:if(oRet=[iIndex],oCoordList.length>2){if(dBearingPt1Pt2=oCoordList[0].bearingTo(oCoordList[1]),oMidPoint=this.getCenterPT(oCoordList[0],oCoordList[1]),dDist=oMidPoint.distanceTo(oCoordList[2]),dDist<20||isNaN(dDist)||dDist===1/0)return[];dBearingMidPt3=oMidPoint.bearingTo(oCoordList[2]),oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCP.setCPPosition(oCoordList[iIndex]),dNewBearingPt1Pt2=oCoordList[0].bearingTo(oCoordList[1]),oMidPoint=this.getCenterPT(oCoordList[0],oCoordList[1]),dNewBearingMidPt3=dBearingMidPt3+(dNewBearingPt1Pt2-dBearingPt1Pt2),Pt3Coord=oMidPoint.destinationPoint(dNewBearingMidPt3,dDist),oCoordList[2].lat=Pt3Coord.lat,oCoordList[2].lng=Pt3Coord.lng,oCP3=this.getCP(2),oCP3.setCPPosition(oCoordList[2]),oRet.push(2)}else oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCP.setCPPosition(oCoordList[iIndex]);this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList);break;case 2:oMidPoint=this.getCenterPT(oCoordList[0],oCoordList[1]),dBearingMidPt3=oMidPoint.bearingTo(oCoordList[2]);var dBearingMidMouse=oMidPoint.bearingTo(oEvent.latlng);dDist=oMidPoint.distanceTo(oEvent.latlng),dDist=Math.round(dDist*Math.cos((dBearingMidMouse-dBearingMidPt3).toRad())),Pt3Coord=oMidPoint.destinationPoint(dBearingMidPt3,dDist),oCoordList[iIndex].lat=Pt3Coord.lat,oCoordList[iIndex].lng=Pt3Coord.lng,sBasicSymbolCode===oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED&&(dDist*=2),oCP.setValue(dDist),oCP.setCPPosition(oCoordList[iIndex]),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),oRet=[iIndex]}return oRet},_moveBlockCP:function(oCP,oEvent){var oMidPoint,dDist,dBearingMidPt3,dNewBearingMidPt3,dBearingPt1Pt2,dNewBearingPt1Pt2,oCP3,Pt3Coord,oRet=void 0,iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(iIndex){case 0:case 1:if(oRet=[iIndex],oCoordList.length>2){if(dBearingPt1Pt2=oCoordList[0].bearingTo(oCoordList[1]),oMidPoint=this.getCenterPT(oCoordList[0],oCoordList[1]),dDist=oMidPoint.distanceTo(oCoordList[2]),dDist<20||isNaN(dDist)||dDist===1/0)return[];dBearingMidPt3=oMidPoint.bearingTo(oCoordList[2]),oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCP.setCPPosition(oCoordList[iIndex]),dNewBearingPt1Pt2=oCoordList[0].bearingTo(oCoordList[1]),oMidPoint=this.getCenterPT(oCoordList[0],oCoordList[1]),dNewBearingMidPt3=dBearingMidPt3+(dNewBearingPt1Pt2-dBearingPt1Pt2),Pt3Coord=oMidPoint.destinationPoint(dNewBearingMidPt3,dDist),oCoordList[2].lat=Pt3Coord.lat,oCoordList[2].lng=Pt3Coord.lng,oCP3=this.getCP(2),oCP3.setCPPosition(oCoordList[2]),oRet.push(2)}else oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCP.setCPPosition(oCoordList[iIndex]);this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList);break;case 2:dBearingPt1Pt2=oCoordList[0].bearingTo(oCoordList[1]),dBearingPt1Pt2=dBearingPt1Pt2>180?dBearingPt1Pt2-360:dBearingPt1Pt2,oMidPoint=this.getCenterPT(oCoordList[0],oCoordList[1]),dBearingMidPt3=oMidPoint.bearingTo(oCoordList[2]),dBearingMidPt3=dBearingMidPt3>180?dBearingMidPt3-360:dBearingMidPt3,dBearingMidPt3=dBearingMidPt3-dBearingPt1Pt2>=0?dBearingPt1Pt2+90:dBearingPt1Pt2+270,dBearingMidPt3=(dBearingMidPt3+360)%360;var dBearingMidMouse=oMidPoint.bearingTo(oEvent.latlng);dDist=oMidPoint.distanceTo(oEvent.latlng),dDist*=Math.cos((dBearingMidMouse-dBearingMidPt3).toRad()),Pt3Coord=oMidPoint.destinationPoint(dBearingMidPt3,dDist),oCoordList[iIndex].lat=Pt3Coord.lat,oCoordList[iIndex].lng=Pt3Coord.lng,oCP.setCPPosition(oCoordList[iIndex]),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),oRet=[iIndex]}return oRet},_moveAmbushCP:function(oCP,oEvent){var oMidPoint,dDist,dBearingMidPt1,dNewBearingMidPt1,dBearingPt2Pt3,dNewBearingPt2Pt3,oCP1,Pt1Coord,oRet=void 0,iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(iIndex){case 0:oMidPoint=this.getCenterPT(oCoordList[1],oCoordList[2]),dBearingMidPt1=oMidPoint.bearingTo(oCoordList[0]);var dBearingMidMouse=oMidPoint.bearingTo(oEvent.latlng);dDist=oMidPoint.distanceTo(oEvent.latlng),dDist*=Math.cos((dBearingMidMouse-dBearingMidPt1).toRad()),Pt1Coord=oMidPoint.destinationPoint(dBearingMidPt1,dDist),oCoordList[iIndex].lat=Pt1Coord.lat,oCoordList[iIndex].lng=Pt1Coord.lng,oCP.setCPPosition(oCoordList[iIndex]),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),oRet=[iIndex];break;case 1:case 2:if(dBearingPt2Pt3=oCoordList[1].bearingTo(oCoordList[2]),oMidPoint=this.getCenterPT(oCoordList[1],oCoordList[2]),dDist=oMidPoint.distanceTo(oCoordList[0]),dDist<20||isNaN(dDist)||dDist===1/0)return[];dBearingMidPt1=oMidPoint.bearingTo(oCoordList[0]),oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCP.setCPPosition(oCoordList[iIndex]),dNewBearingPt2Pt3=oCoordList[1].bearingTo(oCoordList[2]),oMidPoint=this.getCenterPT(oCoordList[1],oCoordList[2]),dNewBearingMidPt1=dBearingMidPt1+(dNewBearingPt2Pt3-dBearingPt2Pt3),Pt1Coord=oMidPoint.destinationPoint(dNewBearingMidPt1,dDist),oCoordList[0].lat=Pt1Coord.lat,oCoordList[0].lng=Pt1Coord.lng,oCP1=this.getCP(0),oCP1.setCPPosition(oCoordList[0]),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),oRet=[0,iIndex]}return oRet},_moveSeizeCP:function(oCP,oEvent){var oCPPt2,dBearing,dDist,oRet=void 0,iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),i2525Version=oFeature.get2525Version(),oRendererSettings=armyc2.c2sd.renderer.utilities.RendererSettings;if(i2525Version===oRendererSettings.Symbology_2525Bch2_USAS_13_14)oRet=this._moveCP(oCP,oEvent);else if(i2525Version===oRendererSettings.Symbology_2525C&&3===oCoordList.length)oRet=this._moveCP(oCP,oEvent);else if(4===oCoordList.length)switch(iIndex){case 0:if(oRet=[iIndex],oCPPt2=this.getCP(1),dBearing=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist<20||isNaN(dDist)||dDist===1/0)return[];oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,oCoordList[1].moveCoordinate(dBearing,dDist),oCPPt2.setCPPosition(oCoordList[1]),oRet.push(1);var oCPPt3=this.getCP(2);oCoordList[2].moveCoordinate(dBearing,dDist),oCPPt3.setCPPosition(oCoordList[2]),oRet.push(2),this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.updateLeafletObject(oCoordList);break;case 1:case 2:case 3:oRet=this._moveCP(oCP,oEvent)}else oRet=this._moveCP(oCP,oEvent);return oRet},_moveCP:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.updateLeafletObject(oCoordList),[iIndex]},doControlPointMoved:function(oCP,oEvent){var oRet=void 0,sBasicSymbolCode=this.options.sBasicSymbolCode,oBasicSymbolCodes=leafLet.utils.milstd.basicSymbolCode;switch(sBasicSymbolCode){case oBasicSymbolCodes.AMBUSH:oRet=this._moveAmbushCP(oCP,oEvent);break;case oBasicSymbolCodes.FORD_EASY:case oBasicSymbolCodes.FORD_DIFFICULT:case oBasicSymbolCodes.ROADBLOCK_COMPLETE_EXECUTED:oRet=this._moveFordCP(oCP,oEvent);break;case oBasicSymbolCodes.BLOCK_TASK:oRet=this._moveBlockCP(oCP,oEvent);break;case oBasicSymbolCodes.SEIZE:oRet=this._moveSeizeCP(oCP,oEvent);break;default:oRet=this._moveCP(oCP,oEvent)}return oRet},doFeatureMove:function(dBearing,dDistance){for(var oCoord,iCoordIndex,oCoordList=this.getCoordinateList(),oCPList=this.options.oControlPointList,iIndex=0;iIndex<oCPList.length;iIndex++)iCoordIndex=oCPList[iIndex].getIndex(),oCoord=oCPList[iIndex].getPosition(),oCoord.moveCoordinate(dBearing,dDistance),oCPList[iIndex].setCPPosition(oCoord),oCoordList[iCoordIndex]=oCoord;return this.setCoordinates(oCoordList),this.updateLeafletObject(),!0}};return publicInterface},leafLet.editor.MilStdDCSuperAutoShape=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDCSuperAutoShapeEditor()),leafLet.internalPrivateClass.MilStdDC2PointLineEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length)for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP)},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(!(oCoordList.length>=oSymbolDef.maxPoints)){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return this.updateLeafletObject(),oCP}},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.updateLeafletObject(oCoordList),[iIndex]}}};return publicInterface},leafLet.editor.MilStdDC2PointLine=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDC2PointLineEditor()),leafLet.internalPrivateClass.MilStdDC2PointRectAutoShapeEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},_addWidthCP:function(oCoordList){var oSymbolDef=this.getSymbolDef();if(oCoordList.length>=oSymbolDef.minPoints){var oWidthPoint,oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),dDist=oCoordList[0].distanceTo(oCoordList[1])/2,dAngle=oCoordList[0].bearingTo(oCoordList[1]),oMidPoint=oCoordList[0].destinationPoint(dAngle,dDist),dWidth=oModifiers.getAMValue(0);dAngle-=90,dAngle=(dAngle+360)%360,oWidthPoint=oMidPoint.destinationPoint(dAngle,dWidth/2);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.WIDTH_CP,oWidthPoint,0,0,dWidth);this.addControlPoint(oCP)}},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);this._addWidthCP(oCoordList)}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oSymbolDef=this.getSymbolDef(),oFeature=this.getFeature();if(!(oCoordList.length>=oSymbolDef.maxPoints)){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this._addWidthCP(oCoordList)),oCP}},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.updateLeafletObject(oCoordList),this._addWidthCP(oCoordList),[iIndex];case leafLet.ControlPoint.Type.WIDTH_CP:var oWidthPoint,oFeature=this.getFeature(),oModifiers=oFeature.getMilStdModifiers(),dDist=oCoordList[0].distanceTo(oCoordList[1])/2,dAngle=oCoordList[0].bearingTo(oCoordList[1]),oMidPoint=oCoordList[0].destinationPoint(dAngle,dDist),dWidth=Math.round(oMidPoint.distanceTo(oEvent.latlng));return dAngle-=90,dAngle=(dAngle+360)%360,oWidthPoint=oMidPoint.destinationPoint(dAngle,dWidth),oModifiers.setAMValue(0,2*dWidth),oCP.setCPPosition(oWidthPoint),this.updateLeafletObject(oCoordList),[]}}};return publicInterface},leafLet.editor.MilStdDC2PointRectAutoShape=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdDC2PointRectAutoShapeEditor()),leafLet.internalPrivateClass.MilStdSinglePointEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.MilStd.prototype.initialize.call(this,args)},assembleControlPoints:function(){var oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oLeafletObject=this.getLeafletObject();oLeafletObject instanceof L.Marker&&this.setMarkerPopup()}},doAddControlPoint:function(oLatLng){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0===oCoordList.length){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oLeafletObject=oFeature._createFeature(oFeature.options);this.setLeafletObject(oLeafletObject)}},doFeatureMove:function(dBearing,dDistance){var oLeafletObject=this.getLeafletObject(),oCoordList=this.getCoordinateList();return oCoordList[0].moveCoordinate(dBearing,dDistance),this.setCoordinates(oCoordList),oLeafletObject.setLatLng(oCoordList[0]),this.setMarkerPopup(),!0}};return publicInterface},leafLet.editor.MilStdSinglePoint=leafLet.editor.MilStd.extend(leafLet.internalPrivateClass.MilStdSinglePointEditor()),leafLet.internalPrivateClass.AirspaceCurtainEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints())for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP)},_addSegmentCP:function(){},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oFeature.getMinPoints()&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP(),this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP),this._addSegmentCP())}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature();oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return oCoordList.length>=oFeature.getMinPoints()&&this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP(),this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP),this._addSegmentCP()),oCP},doDeleteControlPoint:function(oCP){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oFeature=this.getFeature();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oFeature.getMinPoints())&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addSegmentCP(),!0))},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addSegmentCP(),this._issueCPAddEvent(iNewIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addSegmentCP(),[iIndex];case leafLet.ControlPoint.Type.SEGMENT_CP:var oCPCoord=oCP.getPosition(),dBearing=oCPCoord.bearingTo(oEvent.latlng),dDist=oCPCoord.distanceTo(oEvent.latlng),iSubIndex=oCP.getSubIndex();return oCoordList[iIndex].moveCoordinate(dBearing,dDist),oCoordList[iSubIndex].moveCoordinate(dBearing,dDist),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.SEGMENT_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addSegmentCP(),[iIndex,iSubIndex]}}};return publicInterface},leafLet.editor.AirspaceCurtain=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceCurtainEditor()),leafLet.internalPrivateClass.AirspacePolygonEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints()){for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP);oNewCoord=oCoordList[0].midPointTo(oCoordList[oCoordList.length-1]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,oCoordList.length,0),this.addControlPoint(oCP)}},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oFeature.getMinPoints()&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP())}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length>=oFeature.getMinPoints())){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return oCoordList.length>=oFeature.getMinPoints()&&this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addNewCP()),oCP}},doDeleteControlPoint:function(oCP){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oFeature=this.getFeature();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oFeature.getMinPoints())&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),!0))},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._issueCPAddEvent(iNewIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),[iIndex]}}};return publicInterface},leafLet.editor.AirspacePolygon=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspacePolygonEditor()),leafLet.internalPrivateClass.AirspaceCylinderEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addRadiusCP:function(oCoordList){var oCP,oCPPosition,dRange,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);oCoordList.length>=oFeature.getMinPoints()&&(dRange=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),oCPPosition=oCoordList[0].destinationPoint(90,dRange),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RADIUS_CP,oCPPosition,0,90,dRange),this.addControlPoint(oCP))},assembleControlPoints:function(){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[0],0,0);this.addControlPoint(oCP),this._addRadiusCP(oCoordList)}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length>=oFeature.getMaxPoints()))return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.updateLeafletObject(oCoordList)&&this._addRadiusCP(oCoordList),oCP},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var dMouseAngle,dAngle,dDist,oCPPos,oRet=void 0,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributes=(oCP.getIndex(),oFeature.getAttributes(0));if(!(oCoordList.length<oFeature.getMinPoints())){switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[0].lat=oEvent.latlng.lat,oCoordList[0].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[0]),this.updateLeafletObject(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this._addRadiusCP(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.RADIUS_CP:dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE)}return oRet}}};return publicInterface},leafLet.editor.AirspaceCylinder=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceCylinderEditor()),leafLet.internalPrivateClass.AirspaceOrbitEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addWidthCP:function(){var oCP,oNewCoord,iIndex,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0),dWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_WIDTH),sTurn=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN);if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints()){var Pt1=oCoordList[0],Pt2=oCoordList[1],dBearing=Pt1.bearingTo(Pt2),dDist=Pt1.distanceTo(Pt2);switch(oNewCoord=Pt1.destinationPoint(dBearing,dDist/2),sTurn){case emp.typeLibrary.orbitTurnType.CENTER:oNewCoord.moveCoordinate((dBearing+270)%360,dWidth/2);break;case emp.typeLibrary.orbitTurnType.RIGHT:oNewCoord.moveCoordinate((dBearing+90)%360,dWidth);break;case emp.typeLibrary.orbitTurnType.LEFT:oNewCoord.moveCoordinate((dBearing+270)%360,dWidth)}oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.WIDTH_CP,oNewCoord,iIndex,0,dWidth),this.addControlPoint(oCP)}},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oFeature.getMinPoints()&&(this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this._addWidthCP())}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length>=oFeature.getMaxPoints())){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return oCoordList.length>=oFeature.getMinPoints()&&this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this._addWidthCP()),oCP}},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.WIDTH_CP:var dWidth,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0),sTurn=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN),Pt1=oCoordList[0],Pt2=oCoordList[1],dBearing=Pt1.bearingTo(Pt2),dDist=Pt1.distanceTo(Pt2),oNewCoord=Pt1.destinationPoint(dBearing,dDist/2),oCPPos=oCP.getPosition(),dMouseBearing=oNewCoord.bearingTo(oEvent.latlng);dBearing=oNewCoord.bearingTo(oCPPos),dDist=oNewCoord.distanceTo(oEvent.latlng);var dDelatAngle=Math.abs(dMouseBearing-dBearing);switch(dDist=Math.round(Math.abs(dDist*Math.cos(dDelatAngle.toRad()))),sTurn){case emp.typeLibrary.orbitTurnType.CENTER:oNewCoord=oNewCoord.destinationPoint(dBearing,dDist),dWidth=2*dDist;break;case emp.typeLibrary.orbitTurnType.RIGHT:case emp.typeLibrary.orbitTurnType.LEFT:oNewCoord=oNewCoord.destinationPoint(dBearing,dDist),dWidth=dDist}return oCP.setCPPosition(oNewCoord),oCP.setValue(dWidth),oAttributes.setValue(cAirspaceAttribute.AIRSPACE_WIDTH,dWidth),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList),[];case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.updateLeafletObject(oCoordList),this._addWidthCP(),[iIndex]}}};return publicInterface},leafLet.editor.AirspaceOrbit=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceOrbitEditor()),leafLet.internalPrivateClass.AirspaceRouteEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addWidthCP:function(){var oCP,oNewCoord,iIndex,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0),dWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_WIDTH);if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints()){var Pt1=oCoordList[0],Pt2=oCoordList[1],dBearing=Pt1.bearingTo(Pt2),dDist=Pt1.distanceTo(Pt2);oNewCoord=Pt1.destinationPoint(dBearing,dDist/2),oNewCoord.moveCoordinate((dBearing+270)%360,dWidth/2),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.WIDTH_CP,oNewCoord,iIndex,0,dWidth),this.addControlPoint(oCP)}},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints())for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP)},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oFeature.getMinPoints()&&(this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addWidthCP(),this._addNewCP())}},doAddControlPoint:function(oLatLng){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length>=oFeature.getMaxPoints())){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0);return oCoordList.length>=oFeature.getMinPoints()&&this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addWidthCP(),this._addNewCP()),oCP}},doDeleteControlPoint:function(oCP){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),iIndex=oCP.getIndex();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(oCoordList.length>=oFeature.getMinPoints()&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addWidthCP(),this._addNewCP()),!0))},doControlPointMoved:function(oCP,oEvent){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList();switch(oCP.getType()){case leafLet.ControlPoint.Type.WIDTH_CP:var dWidth,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0),Pt1=(oAttributes.getValue(cAirspaceAttribute.AIRSPACE_ORBIT_TURN),
oCoordList[0]),Pt2=oCoordList[1],dBearing=Pt1.bearingTo(Pt2),dDist=Pt1.distanceTo(Pt2),oNewCoord=Pt1.destinationPoint(dBearing,dDist/2),oCPPos=oCP.getPosition(),dMouseBearing=oNewCoord.bearingTo(oEvent.latlng);dBearing=oNewCoord.bearingTo(oCPPos),dDist=oNewCoord.distanceTo(oEvent.latlng);var dDelatAngle=Math.abs(dMouseBearing-dBearing);return dDist=Math.round(Math.abs(dDist*Math.cos(dDelatAngle.toRad()))),oNewCoord=oNewCoord.destinationPoint(dBearing,dDist),dWidth=2*dDist,oCP.setCPPosition(oNewCoord),oCP.setValue(dWidth),oAttributes.setValue(cAirspaceAttribute.AIRSPACE_WIDTH,dWidth),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),[];case leafLet.ControlPoint.Type.NEW_POSITION_CP:var iNewIndex=oCP.getIndex();this.updateCPIndex(iNewIndex,1),oCoordList.splice(iNewIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.updateLeafletObject(oCoordList),this._addWidthCP(),this._addNewCP(),this._issueCPAddEvent(iNewIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addWidthCP(),[iIndex]}}};return publicInterface},leafLet.editor.AirspaceRoute=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceRouteEditor()),leafLet.internalPrivateClass.AirspaceTrackEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addWidthCP:function(){var oCP,oMidCoord,iIndex,cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints()){var Pt1,Pt2,dBearing,oAttributes,dLeftWidth,dRightWidth,oNewCoord;for(iIndex=1;iIndex<oCoordList.length;iIndex++)oAttributes=oFeature.getAttributes(iIndex-1),dLeftWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH),dRightWidth=oAttributes.getValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH),Pt1=oCoordList[iIndex-1],Pt2=oCoordList[iIndex],dBearing=Pt1.bearingTo(Pt2),oMidCoord=Pt1.pointAt3QtrDistanceTo(Pt2),oNewCoord=oMidCoord.destinationPoint((dBearing+270)%360,dLeftWidth),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.LEFT_WIDTH_CP,oNewCoord,iIndex-1,iIndex,dLeftWidth),this.addControlPoint(oCP),oNewCoord=oMidCoord.destinationPoint((dBearing+90)%360,dRightWidth),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RIGHT_WIDTH_CP,oNewCoord,iIndex-1,iIndex,dRightWidth),this.addControlPoint(oCP)}},_addNewCP:function(){var oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints())for(iIndex=1;iIndex<oCoordList.length;iIndex++)oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP)},assembleControlPoints:function(){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(0!==oCoordList.length){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);oCoordList.length>=oFeature.getMinPoints()&&(this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addWidthCP(),this._addNewCP())}},doAddControlPoint:function(oLatLng){var oAttributes,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributeList=oFeature.getAttributeList(),iIndex=oCoordList.length;if(!(oCoordList.length>=oFeature.getMaxPoints())){oCoordList.push(oLatLng),this.setCoordinates(oCoordList);var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,iIndex,0);return oCoordList.length>=oFeature.getMinPoints()&&(oAttributes=oAttributeList.get(iIndex-1),oAttributes||(1===iIndex?(oAttributes=new leafLet.typeLibrary.airspace.Attributes(oFeature.getProperties(),{}),oAttributes.setRequiredAttributes(emp.typeLibrary.airspaceSymbolCode.SHAPE3D_TRACK)):(oAttributes=oAttributeList.get(iIndex-2),oAttributes=oAttributes.duplicateAttribute()),oAttributeList.add(oAttributes)),this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addWidthCP(),this._addNewCP())),oCP}},doDeleteControlPoint:function(oCP){var oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),iIndex=oCP.getIndex(),oAttributeList=oFeature.getAttributeList();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(oCoordList.length>=oFeature.getMinPoints()&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),iIndex===oAttributeList.length()-1?oAttributeList.remove(iIndex-1):oAttributeList.remove(iIndex),this.updateLeafletObject(oCoordList)&&(this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this._addWidthCP(),this._addNewCP()),!0))},doControlPointMoved:function(oCP,oEvent){var oAttributes,oNewCoord,iIndex=oCP.getIndex(),iIndex2=oCP.getSubIndex(),oCoordList=this.getCoordinateList(),cAirspaceAttribute=leafLet.typeLibrary.AirspaceAttribute,oFeature=this.getFeature(),oAttributeList=oFeature.getAttributeList();switch(oCP.getType()){case leafLet.ControlPoint.Type.LEFT_WIDTH_CP:case leafLet.ControlPoint.Type.RIGHT_WIDTH_CP:var dWidth,dDist,Pt1=oCoordList[iIndex],Pt2=oCoordList[iIndex2],dBearing=Pt1.bearingTo(Pt2),oMidCoord=Pt1.pointAt3QtrDistanceTo(Pt2),oCPPos=oCP.getPosition(),dMouseBearing=oMidCoord.bearingTo(oEvent.latlng);oAttributes=oFeature.getAttributes(iIndex),dBearing=oMidCoord.bearingTo(oCPPos),dDist=oMidCoord.distanceTo(oEvent.latlng);var dDelatAngle=Math.abs(dMouseBearing-dBearing);return dDist=Math.round(Math.abs(dDist*Math.cos(dDelatAngle.toRad()))),oNewCoord=oMidCoord.destinationPoint(dBearing,dDist),dWidth=dDist,oCP.setCPPosition(oNewCoord),oCP.setValue(dWidth),oCP.getType()===leafLet.ControlPoint.Type.LEFT_WIDTH_CP?oAttributes.setValue(cAirspaceAttribute.AIRSPACE_LEFT_WIDTH,dWidth):oAttributes.setValue(cAirspaceAttribute.AIRSPACE_RIGHT_WIDTH,dWidth),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),[];case leafLet.ControlPoint.Type.NEW_POSITION_CP:this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP),this.updateCPIndex(iIndex,1),oCoordList.splice(iIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),oAttributes=oFeature.getAttributes(iIndex-1),oAttributes=oAttributes.duplicateAttribute(),oAttributeList.insert(iIndex,oAttributes),this.updateLeafletObject(oCoordList),this._addWidthCP(),this._issueCPAddEvent(iIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:return oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_WIDTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addWidthCP(),[iIndex]}}};return publicInterface},leafLet.editor.AirspaceTrack=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceTrackEditor()),leafLet.internalPrivateClass.AirspaceRadArcEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addRadiusCP:function(oCoordList){var oCP,oCPPosition,dOutterRadius,dInnerRadius,dLeftAzimuth,dRightAzimuth,dMidAzimuth,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);oCoordList.length>=oFeature.getMinPoints()&&(dOutterRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dInnerRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS),dLeftAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dMidAzimuth=(dRightAzimuth+dLeftAzimuth)/2,dRightAzimuth<dLeftAzimuth&&(dMidAzimuth=(dMidAzimuth+180)%360),oCPPosition=oCoordList[0].destinationPoint(dMidAzimuth,dOutterRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RADIUS_CP,oCPPosition,0,dMidAzimuth,dOutterRadius),this.addControlPoint(oCP),oCPPosition=oCoordList[0].destinationPoint(dMidAzimuth,dInnerRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.INNER_RADIUS_CP,oCPPosition,0,dMidAzimuth,dInnerRadius),this.addControlPoint(oCP))},_addAzimuthCP:function(oCoordList){var oCP,oCPPosition,dOutterRadius,dInnerRadius,dAvgRadius,dLeftAzimuth,dRightAzimuth,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);oCoordList.length>=oFeature.getMinPoints()&&(dOutterRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dInnerRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS),dLeftAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dAvgRadius=(dOutterRadius+dInnerRadius)/2,oCPPosition=oCoordList[0].destinationPoint(dLeftAzimuth,dAvgRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP,oCPPosition,0,dAvgRadius,dLeftAzimuth),this.addControlPoint(oCP),oCPPosition=oCoordList[0].destinationPoint(dRightAzimuth,dAvgRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP,oCPPosition,0,dAvgRadius,dRightAzimuth),this.addControlPoint(oCP))},assembleControlPoints:function(){var oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(0!==oCoordList.length){var oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[0],0,0);this.addControlPoint(oCP),this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList)}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length>=oFeature.getMaxPoints()))return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.updateLeafletObject(oCoordList)&&(this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList)),oCP},doDeleteControlPoint:function(oCP){return!1},doControlPointMoved:function(oCP,oEvent){var dMouseAngle,dAngle,dDist,oCPPos,dOutterRadius,dInnerRadius,oRet=void 0,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributes=(oCP.getIndex(),oFeature.getAttributes(0));if(!(oCoordList.length<oFeature.getMinPoints())){switch(oCP.getType()){case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[0].lat=oEvent.latlng.lat,oCoordList[0].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[0]),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.INNER_RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.RADIUS_CP:if(dInnerRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS),dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),dDist<=dInnerRadius)break;oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addAzimuthCP(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE);break;case leafLet.ControlPoint.Type.INNER_RADIUS_CP:if(dOutterRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),dDist>=dOutterRadius)break;oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_INNER_RADIUS,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addAzimuthCP(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE);break;case leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP:case leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP:dDist=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),oCPPos=oCoordList[0].destinationPoint(dMouseAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dMouseAngle),oCP.getType()===leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP?oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH,dMouseAngle):oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH,dMouseAngle),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.INNER_RADIUS_CP),this.updateLeafletObject(oCoordList),this._addRadiusCP(oCoordList)}return oRet}}};return publicInterface},leafLet.editor.AirspaceRadArc=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspaceRadArcEditor()),leafLet.internalPrivateClass.AirspacePolyArcEditor=function(){var publicInterface={initialize:function(args){leafLet.editor.Airspace.prototype.initialize.call(this,args)},_addRadiusCP:function(oCoordList){var oCP,oCPPosition,dRadius,dLeftAzimuth,dRightAzimuth,dMidAzimuth,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);oCoordList.length>=oFeature.getMinPoints()&&(dRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dLeftAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),dMidAzimuth=(dRightAzimuth+dLeftAzimuth)/2,dRightAzimuth<dLeftAzimuth&&(dMidAzimuth=(dMidAzimuth+180)%360),oCPPosition=oCoordList[0].destinationPoint(dMidAzimuth,dRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RADIUS_CP,oCPPosition,0,dMidAzimuth,dRadius),this.addControlPoint(oCP))},_addAzimuthCP:function(oCoordList){var oCP,oCPPosition,dRadius,dLeftAzimuth,dRightAzimuth,oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);oCoordList.length>=oFeature.getMinPoints()&&(dRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dLeftAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),dRightAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),oCPPosition=oCoordList[0].destinationPoint(dLeftAzimuth,dRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP,oCPPosition,0,dRadius,dLeftAzimuth),this.addControlPoint(oCP),oCPPosition=oCoordList[0].destinationPoint(dRightAzimuth,dRadius),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP,oCPPosition,0,dRadius,dRightAzimuth),this.addControlPoint(oCP))},_addNewCP:function(){var dRadius,dLeftAzimuth,dRightAzimuth,oCP,oNewCoord,iIndex,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);if(0!==oCoordList.length&&oCoordList.length>=oFeature.getMinPoints()){for(iIndex=1;iIndex<oCoordList.length;iIndex++)1===iIndex?(dRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dRightAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH),oNewCoord=oCoordList[0].destinationPoint(dRightAzimuth,dRadius),oNewCoord=oNewCoord.midPointTo(oCoordList[iIndex])):oNewCoord=oCoordList[iIndex-1].midPointTo(oCoordList[iIndex]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,iIndex,0),this.addControlPoint(oCP);dRadius=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS),dLeftAzimuth=oAttributes.getValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH),oNewCoord=oCoordList[0].destinationPoint(dLeftAzimuth,dRadius),oNewCoord=oNewCoord.midPointTo(oCoordList[oCoordList.length-1]),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.NEW_POSITION_CP,oNewCoord,oCoordList.length,0),this.addControlPoint(oCP)}},assembleControlPoints:function(){var oCP,oFeature=this.getFeature(),oCoordList=this.getCoordinateList();if(!(oCoordList.length<oFeature.getMinPoints())){for(var iIndex=0;iIndex<oCoordList.length;iIndex++)oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oCoordList[iIndex],iIndex,0),this.addControlPoint(oCP);this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList),this._addNewCP()}},doAddControlPoint:function(oLatLng){var oCP,oCoordList=this.getCoordinateList(),oFeature=this.getFeature();if(!(oCoordList.length>=oFeature.getMinPoints()))return oCoordList.push(oLatLng),this.setCoordinates(oCoordList),oCP=new leafLet.editor.ControlPoint(oFeature,leafLet.ControlPoint.Type.POSITION_CP,oLatLng,oCoordList.length-1,0),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.updateLeafletObject(oCoordList)&&(this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList),this._addNewCP()),oCP},doDeleteControlPoint:function(oCP){var iIndex=oCP.getIndex(),oCoordList=this.getCoordinateList(),oFeature=this.getFeature();return oCP.getType()===leafLet.ControlPoint.Type.POSITION_CP&&(!(oCoordList.length<=oFeature.getMinPoints())&&(oCoordList.splice(iIndex,1),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList),!0))},doControlPointMoved:function(oCP,oEvent){var dMouseAngle,dAngle,dDist,oCPPos,iIndex=oCP.getIndex(),oRet=void 0,oCoordList=this.getCoordinateList(),oFeature=this.getFeature(),oAttributes=oFeature.getAttributes(0);if(!(oCoordList.length<oFeature.getMinPoints())){switch(oCP.getType()){case leafLet.ControlPoint.Type.NEW_POSITION_CP:this.updateCPIndex(iIndex,1),oCoordList.splice(iIndex,0,oEvent.latlng),this.setCoordinates(oCoordList),oCP.setCPPosition(oEvent.latlng),oCP.setType(leafLet.ControlPoint.Type.POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList),this._issueCPAddEvent(iIndex);break;case leafLet.ControlPoint.Type.POSITION_CP:oCoordList[iIndex].lat=oEvent.latlng.lat,oCoordList[iIndex].lng=oEvent.latlng.lng,this.setCoordinates(oCoordList),oCP.setCPPosition(oCoordList[iIndex]),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addRadiusCP(oCoordList),this._addAzimuthCP(oCoordList),oRet=[0];break;case leafLet.ControlPoint.Type.RADIUS_CP:dAngle=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),dDist=oCoordList[0].distanceTo(oEvent.latlng),dDist=Math.abs(Math.round(dDist*Math.cos((dMouseAngle-dAngle).toRad()))),oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RADIUS,dDist),oCPPos=oCoordList[0].destinationPoint(dAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dDist),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addAzimuthCP(oCoordList),this._issueCPUpdateEvent([],emp.typeLibrary.UpdateEventType.UPDATE);break;case leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP:case leafLet.ControlPoint.Type.RIGHT_AZIMUTH_CP:dDist=oCP.getSubIndex(),dMouseAngle=oCoordList[0].bearingTo(oEvent.latlng),oCPPos=oCoordList[0].destinationPoint(dMouseAngle,dDist),oCP.setCPPosition(oCPPos),oCP.setValue(dMouseAngle),oCP.getType()===leafLet.ControlPoint.Type.LEFT_AZIMUTH_CP?oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_LEFT_AZIMUTH,dMouseAngle):oAttributes.setValue(leafLet.typeLibrary.AirspaceAttribute.AIRSPACE_RIGHT_AZIMUTH,dMouseAngle),this.setCoordinates(oCoordList),this.removeAllCPByType(leafLet.ControlPoint.Type.RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.INNER_RADIUS_CP),this.removeAllCPByType(leafLet.ControlPoint.Type.NEW_POSITION_CP),this.updateLeafletObject(oCoordList),this._addNewCP(),this._addRadiusCP(oCoordList)}return oRet}}};return publicInterface},leafLet.editor.AirspacePolyArc=leafLet.editor.Airspace.extend(leafLet.internalPrivateClass.AirspacePolyArcEditor());var emp=emp||{};emp.util.milstdColorFix=function(feature){var oProperties,oModifiers;feature.hasOwnProperty("format")&&feature.format===emp.typeLibrary.featureFormatType.MILSTD&&(oProperties=feature.properties,oProperties&&oProperties.hasOwnProperty("modifiers")&&(oModifiers=oProperties.modifiers,oModifiers.hasOwnProperty("lineColor")&&(oProperties.lineColor=oModifiers.lineColor),oModifiers.hasOwnProperty("lineWidth")&&(oProperties.lineWidth=oModifiers.lineWidth),oModifiers.hasOwnProperty("fillColor")&&(oProperties.fillColor=oModifiers.fillColor)))},emp.engineDefs=emp.engineDefs||{},emp.engineDefs.leafletMapEngine=function(args){function checkMapWidth(){var oMapBounds,center,angularWidth,iZoom;oMapBounds=instanceInterface.leafletInstance.getBounds(),center=instanceInterface.leafletInstance.getCenter(),angularWidth=Math.abs(oMapBounds.getEast()-oMapBounds.getWest()),angularWidth>=180&&(iZoom=instanceInterface.leafletInstance.getZoom()+1,instanceInterface.leafletInstance.setView(center,iZoom,{animate:!1}))}function checkMapCenter(){var oMapBounds,oNorthWest,oTopLeft,oSouthEast,oBottomRight,$Container,iContainerHeight;oMapBounds=instanceInterface.leafletInstance.getBounds(),oNorthWest=new L.LatLng(oMapBounds.getNorth(),oMapBounds.getWest()),oTopLeft=instanceInterface.leafletInstance.latLngToContainerPoint(oNorthWest),oTopLeft.y>10?(oTopLeft.x=0,instanceInterface.leafletInstance.panBy(oTopLeft,{animate:!1})):($Container=$(instanceInterface.leafletInstance.getContainer()),iContainerHeight=$Container.height(),oSouthEast=new L.LatLng(oMapBounds.getSouth(),oMapBounds.getEast()),oBottomRight=instanceInterface.leafletInstance.latLngToContainerPoint(oSouthEast),oBottomRight.y<iContainerHeight&&(oBottomRight.x=0,oBottomRight.y=oBottomRight.y-iContainerHeight,instanceInterface.leafletInstance.panBy(oBottomRight,{animate:!1})))}function setupEventListeners(){function onMouseMove(event){var offsetX,offsetY,originalEvent=event.originalEvent,element=originalEvent.srcElement||originalEvent.currentTarget,elementBounds=element.getBoundingClientRect(),smartLockBuffer=.05,step=parseFloat((instanceInterface.getView().altitude/L.CRS.Earth.R).toFixed(25)),smartLockAutoPan=function(){var geographicMapCenter=instanceInterface.leafletInstance.getCenter(),panToLat=geographicMapCenter.lat,panToLng=geographicMapCenter.lng,horizontalOffset=0,verticalOffset=0;instanceInterface.smartLockPanning.up?(panToLat=geographicMapCenter.lat+step,verticalOffset=panToLat-geographicMapCenter.lat):instanceInterface.smartLockPanning.down&&(panToLat=geographicMapCenter.lat+-step,verticalOffset=panToLat-geographicMapCenter.lat+.02*step),instanceInterface.smartLockPanning.left?(panToLng=geographicMapCenter.lng+-step,horizontalOffset=panToLng-geographicMapCenter.lng):instanceInterface.smartLockPanning.right&&(panToLng=geographicMapCenter.lng+step,horizontalOffset=panToLng-geographicMapCenter.lng-.2*step),0===horizontalOffset&&0===verticalOffset||(event.latlng.lng=event.latlng.lng+horizontalOffset,event.latlng.lat=event.latlng.lat+verticalOffset,instanceInterface.leafletInstance.panTo(L.latLng(panToLat,panToLng)),instanceInterface.generatePointerEvent(event,instanceInterface.getView()),clearTimeout(timeout),timeout=setTimeout(smartLockAutoPan,225))};switch(event.latlng.lng=leafLet.utils.normilizeLongitude(event.latlng.lng),event.mgrs=emp.geoLibrary.ddToMGRS(event.latlng.lat,event.latlng.lng),instanceInterface.smartLockPanning.left=!1,instanceInterface.smartLockPanning.right=!1,instanceInterface.smartLockPanning.up=!1,instanceInterface.smartLockPanning.down=!1,instanceInterface.generatePointerEvent(event,instanceInterface.getView()),instanceInterface.getLockState()){case emp3.api.enums.MapMotionLockEnum.SMART_MOTION:offsetX=originalEvent.clientX-elementBounds.left,offsetY=originalEvent.clientY-elementBounds.top,instanceInterface.smartLockPanning.left=offsetX<elementBounds.width*smartLockBuffer,instanceInterface.smartLockPanning.right=offsetX>elementBounds.width-elementBounds.width*smartLockBuffer,instanceInterface.smartLockPanning.up=offsetY<elementBounds.height*smartLockBuffer,instanceInterface.smartLockPanning.down=offsetY>elementBounds.height-elementBounds.height*smartLockBuffer,smartLockAutoPan()}}function onMoveEnd(event){var center,view,lookAt,lockState=instanceInterface.getLockState();if(lockState!==emp3.api.enums.MapMotionLockEnum.NO_MOTION){if(checkMapCenter(),center=instanceInterface.leafletInstance.getCenter(),center.lng<-180||center.lng>180)return void instanceInterface.leafletInstance.setView(center.wrap());instanceInterface.renderingOptimization.enabled&&instanceInterface.renderingOptimization.refreshZone(),view=instanceInterface.getView(),lookAt=instanceInterface.viewToLookAt(view),instanceInterface.scheduleRendering(view),instanceInterface.empMapInstance.eventing.ViewChange(view,lookAt),instanceInterface.processViewSetTrans()}}function onMapClick(event){var button=event.originalEvent.button;(0!==button||event.originalEvent.altKey||!event.originalEvent.ctrlKey||event.originalEvent.shiftKey)&&(instanceInterface.oSelectionManager.deselectAllFeatures(),instanceInterface.oSelectionManager.generateEvent()),instanceInterface.generatePointerEvent(event,instanceInterface.getView()),event.originalEvent.preventDefault()}function onZoomEnd(event){checkMapWidth()}function onMouseUpDown(event){instanceInterface.generatePointerEvent(event,instanceInterface.getView()),event.originalEvent.preventDefault()}var timeout;instanceInterface.leafletInstance.on("mousemove",onMouseMove),instanceInterface.leafletInstance.on("moveend",onMoveEnd),instanceInterface.leafletInstance.on("mousedown",onMouseUpDown),instanceInterface.leafletInstance.on("mouseup",onMouseUpDown),instanceInterface.leafletInstance.on("contextmenu",onMapClick),instanceInterface.leafletInstance.on("click",onMapClick),instanceInterface.leafletInstance.on("zoomend",onZoomEnd)}var bounds,engineInterface=emp.map.createEngineTemplate(),selectedGeoColor=new cmapi.IGeoColor({red:240,green:240,blue:0}),instanceInterface={bIsV2Core:args.isV2Core===!0||!1,empMapInstance:args.mapInstance,leafletInstance:void 0,bUseProxy:args.useProxy,useProxyForDefault:args.useProxyForDefault,renderingOptimization:{enabled:args.renderingOptimization,midDistanceThreshold:args.midDistanceThreshold,farDistanceThreshold:{value:args.farDistanceThreshold,RED:"red",BLUE:"blue",GREEN:"green",YELLOW:"yellow",getSVG:function(attributes){return'<svg preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" version="1.1"><circle cx="'+attributes.x+'" cy="'+attributes.y+'" r="'+attributes.radius+'" fill="'+attributes.color+'" stroke="'+attributes.color+'" stroke-width="1"/></svg>'}},viewInZone:void 0,zoneChanged:!1,renderList:{},removeFromRenderList:function(key){delete this.renderList[key]},addToRenderList:function(key,value){return this.renderList[key]=value},isOnRenderList:function(key){return this.renderList.hasOwnProperty(key)},isRenderListEmpty:function(){return 0===Object.keys(this.renderList).length},getRenderList:function(){return this.renderList},refreshZone:function(){var view=instanceInterface.getView();this.zoneChanged=!1,view.altitude>=this.farDistanceThreshold.value?"farDistanceZone"!==this.viewInZone&&(this.zoneChanged=!0,this.viewInZone="farDistanceZone"):view.altitude>=this.midDistanceThreshold?"midDistanceZone"!==this.viewInZone&&(this.zoneChanged=!0,this.viewInZone="midDistanceZone"):null!==this.viewInZone&&(this.zoneChanged=!0,this.viewInZone=null)}},engineParameters:args,selectAttributes:{color:"F0F000",opacity:1,width:5},selectLabelStyle:new cmapi.IGeoLabelStyle({color:selectedGeoColor,size:12,fontFamily:"Arial"}),defaultLabelStyle:new cmapi.IGeoLabelStyle({color:new cmapi.IGeoColor({red:0,green:0,blue:0}),fontFamily:"Arial"}),defaultStrokeStyle:{color:"000000",opacity:1,width:3},sContentCoreId:emp.helpers.id.newGUID(),overlays:{},tacticalGraphics:{},dMaxLabelScale:1e7,rangeToScaleMultiplier:10/3,zoomScaleMap:[5e8,25e7,15e7,7e7,35e6,15e6,1e7,4e6,2e6,1e6,5e5,25e4,15e4,7e4,35e3,15e3,8e3,4e3,2e3,1e3,500,250,125],rootOverlayId:void 0,rootOverlay:void 0,mapEngObjectList:{},bInDrawMode:!1,bInEditMode:!1,oSelectionManager:void 0,oLabelList:[],iMilStdIconSize:24,oLayerControl:void 0,hTGRenderingTimer:void 0,oGraphicsInViewingArea:[],oCurrentEditor:void 0,oEditTransaction:void 0,oTransactionList:{},lockState:void 0,smartLockPanning:{up:!1,down:!1,left:!1,right:!1},setLockState:function(lockState){instanceInterface.lockState=lockState},getLockState:function(){return instanceInterface.lockState},getLeafletMap:function(){return instanceInterface.leafletInstance},getProxyURL:function(){return instanceInterface.engineParameters.empProxyURL;
},getBasePath:function(){return instanceInterface.engineParameters.engineBasePath},addEmpObject:function(oEmpObject){instanceInterface.mapEngObjectList[oEmpObject.getCoreId()]=oEmpObject},removeEmpObject:function(oEmpObject){void 0!==instanceInterface.mapEngObjectList[oEmpObject.getCoreId()]&&delete instanceInterface.mapEngObjectList[oEmpObject.getCoreId()]},storeTransaction:function(oTransaction){void 0===instanceInterface.oTransactionList[oTransaction.transactionId]&&(instanceInterface.oTransactionList[oTransaction.transactionId]=oTransaction)},findTransaction:function(oTranID){return instanceInterface.oTransactionList[oTranID]},findTransactionByIntent:function(sIntent){for(var sTranID,oTransaction,aRetList=[],aKeyList=emp.helpers.associativeArray.getKeys(instanceInterface.oTransactionList),iIndex=0;iIndex<aKeyList.length;iIndex++)sTranID=aKeyList[iIndex],oTransaction=instanceInterface.oTransactionList[sTranID],oTransaction.intent===sIntent&&aRetList.push(oTransaction);return aRetList},removeTransaction:function(oTranID){instanceInterface.oTransactionList.hasOwnProperty(oTranID)&&delete instanceInterface.oTransactionList[oTranID]},getEmpObject:function(sCoreId){return sCoreId?instanceInterface.mapEngObjectList[sCoreId]:rootOverlay},handleFeatureClicked:function(oEvent){var sSelectedID,oPointerData=instanceInterface.getView(),button=oEvent.originalEvent.button;0!==button||oEvent.originalEvent.altKey||oEvent.originalEvent.shiftkey||(emp.util.config.getAutoSelect()&&oEvent.target instanceof leafLet.typeLibrary.Feature&&(oEvent.layer&&oEvent.layer.options&&oEvent.layer.options.sSubItemID&&(sSelectedID=oEvent.layer.options.sSubItemID),instanceInterface.oSelectionManager.isSelected(oEvent.target,sSelectedID)?oEvent.originalEvent.ctrlKey?instanceInterface.oSelectionManager.deselectFeature(oEvent.target,sSelectedID):instanceInterface.oSelectionManager.deselectAllFeatures():(oEvent.originalEvent.ctrlKey||instanceInterface.oSelectionManager.deselectAllFeatures(),instanceInterface.oSelectionManager.selectFeature(oEvent.target,sSelectedID)),instanceInterface.oSelectionManager.generateEvent()),oEvent.originalEvent.ctrlKey||(oEvent.target instanceof leafLet.typeLibrary.Feature||oEvent.target instanceof L.MarkerCluster)&&(oPointerData.popupInfo={title:oEvent.target.getPopupHeading(oEvent.layer),content:oEvent.target.getPopupText(oEvent.layer)})),oPointerData.overlayId=oEvent.target.getOverlayId(),oPointerData.parentId=oEvent.target.getParentId(),oPointerData.featureId=oEvent.target.getFeatureId(),oPointerData.target="feature",instanceInterface.generatePointerEvent(oEvent,oPointerData)},getLevel:function(scale){var i,len=instanceInterface.zoomScaleMap.length,level=0;if(scale>instanceInterface.zoomScaleMap[0])level=0;else if(scale<instanceInterface.zoomScaleMap[len-1])level=len-1;else for(i=0;i<len-1;i++){if(scale<=instanceInterface.zoomScaleMap[i]&&scale>instanceInterface.zoomScaleMap[i+1]){level=i;break}if(scale<instanceInterface.zoomScaleMap[i]&&scale>=instanceInterface.zoomScaleMap[i+1]){level=i+1;break}}return level},getScale:function(level){var len=instanceInterface.zoomScaleMap.length,scale=instanceInterface.zoomScaleMap[0];return scale=level<0?instanceInterface.zoomScaleMap[0]:level>len-1?instanceInterface.zoomScaleMap[len-1]:instanceInterface.zoomScaleMap[level]},viewToLookAt:function(view){var lookAt={};return view&&(lookAt.latitude=view.lat,lookAt.longitude=view.lon,lookAt.altitude=0,lookAt.tilt=0,lookAt.heading=0,lookAt.range=view.range,lookAt.altitudeMode=view.altitudeMode||emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND),lookAt},getView:function(oData){var view=oData||{},bounds=instanceInterface.leafletInstance.getBounds(),center=instanceInterface.leafletInstance.getCenter().wrap(),level=instanceInterface.leafletInstance.getZoom();return leafLet.utils.convertViewBound(bounds,view),view.lat=center.lat,view.lon=center.lng,view.bounds={north:view.north,south:view.south,east:view.east,west:view.west},view.location={lon:view.lon,lat:view.lat},view.mgrs=emp.geoLibrary.ddToMGRS(view.lat,view.lon),view.scale=instanceInterface.getScale(level),view.range=view.scale/instanceInterface.rangeToScaleMultiplier,view.altitude=view.range,view.roll=0,view.tilt=0,view.heading=0,view.altitude=view.range,view.tilt=0,view.roll=0,view.heading=0,view},lastMouseDown:!1,lastMouseUp:!1,generatePointerEvent:function(oEvent,oData){var button=oEvent.originalEvent?oEvent.originalEvent.button:0,pointer=oData||instanceInterface.getView(),oLL=oEvent.latlng.wrap();switch(pointer.lat=oLL.lat,pointer.lon=oLL.lng,pointer.elevation=oData.range,button){case 0:pointer.button="left";break;case 1:pointer.button="middle";break;case 2:pointer.button="right"}switch(oEvent.type){case"click":case"contextmenu":pointer.type=emp.typeLibrary.Pointer.EventType.SINGLE_CLICK;break;case"dblclick":pointer.type=emp.typeLibrary.Pointer.EventType.DBL_CLICK;break;case"mousedown":if(this.lastMouseDown)return;this.lastMouseDown=!0,this.lastMouseUp=!1,pointer.type=emp.typeLibrary.Pointer.EventType.MOUSEDOWN;break;case"mouseup":if(this.lastMouseUp)return;this.lastMouseDown=!1,this.lastMouseUp=!0,pointer.type=emp.typeLibrary.Pointer.EventType.MOUSEUP;break;case"mousemove":pointer.type=emp.typeLibrary.Pointer.EventType.MOVE}if(oEvent.hasOwnProperty("containerPoint"))pointer.clientX=oEvent.containerPoint.x,pointer.clientY=oEvent.containerPoint.y;else{var oPoint=instanceInterface.leafletInstance.latLngToContainerPoint(oEvent.latlng);pointer.clientX=oPoint.x,pointer.clientY=oPoint.y}pointer.screenX=oEvent.originalEvent.pageX,pointer.screenY=oEvent.originalEvent.pageY,pointer.hasOwnProperty("target")||(pointer.target="globe"),pointer.altKey=oEvent.originalEvent.altKey,pointer.ctrlKey=oEvent.originalEvent.ctrlKey,pointer.shiftKey=oEvent.originalEvent.shiftkey,pointer.keys=[],pointer.altKey&&pointer.keys.push("alt"),pointer.ctrlKey&&pointer.keys.push("ctrl"),pointer.shiftKey&&pointer.keys.push("shift"),pointer.keys.length<1&&pointer.keys.push("none"),instanceInterface.empMapInstance.eventing.Pointer(pointer)},addMapLayer:function(oMap){instanceInterface.leafletInstance.hasLayer(oMap)||instanceInterface.leafletInstance.addLayer(oMap)},removeMapLayer:function(oMap){instanceInterface.leafletInstance.hasLayer(oMap)&&instanceInterface.leafletInstance.removeLayer(oMap)},scheduleRendering:function(){var sCoreID,i,renderList;instanceInterface.hTGRenderingTimer&&(clearTimeout(instanceInterface.hTGRenderingTimer),instanceInterface.hTGRenderingTimer=void 0),instanceInterface.oGraphicsInViewingArea=[];var oMapBounds=instanceInterface.leafletInstance.getBounds(),oEmpMapBounds=new leafLet.typeLibrary.EmpBoundary(oMapBounds.getSouthWest(),oMapBounds.getNorthEast()),oFeatureBounds=void 0;for(sCoreID in instanceInterface.mapEngObjectList)if(instanceInterface.mapEngObjectList.hasOwnProperty(sCoreID)){var oEmpObject=instanceInterface.mapEngObjectList[sCoreID];if(oEmpObject.getObjectType()===leafLet.typeLibrary.objectType.FEATURE&&oEmpObject.isVisible())try{oFeatureBounds=oEmpObject.getFeatureBounds(),oEmpObject.isMilStd()?oEmpObject.isMultiPointTG()?oFeatureBounds&&oFeatureBounds.intersects(oEmpMapBounds)&&instanceInterface.oGraphicsInViewingArea.push(oEmpObject):instanceInterface.renderingOptimization.zoneChanged&&!instanceInterface.renderingOptimization.isOnRenderList(sCoreID)?(instanceInterface.renderingOptimization.addToRenderList(sCoreID,oEmpObject),instanceInterface.oGraphicsInViewingArea.push(oEmpObject)):oEmpObject.updateCoordinates(oMapBounds):oEmpObject.isAirspace()||oEmpObject.isAOI()||oEmpObject.isGeoEllipse()?oFeatureBounds&&oFeatureBounds.intersects(oEmpMapBounds)&&instanceInterface.oGraphicsInViewingArea.push(oEmpObject):oEmpObject.updateCoordinates(oMapBounds)}catch(Ex){}}if(!instanceInterface.renderingOptimization.zoneChanged&&!instanceInterface.renderingOptimization.isRenderListEmpty()){renderList=instanceInterface.renderingOptimization.getRenderList();for(i in renderList)instanceInterface.oGraphicsInViewingArea.push(renderList[i])}instanceInterface.oGraphicsInViewingArea.length>0&&(instanceInterface.hTGRenderingTimer=setTimeout(instanceInterface.RerenderingTimerHdlr,500))},RerenderingTimerHdlr:function(){for(var currentGraphic,removedGraphicId,iIndex=0;instanceInterface.oGraphicsInViewingArea.length>0;){if(100===iIndex)return void(instanceInterface.hTGRenderingTimer=setTimeout(instanceInterface.RerenderingTimerHdlr,100));instanceInterface.oGraphicsInViewingArea[0].isInEditMode()?instanceInterface.oCurrentEditor.render():instanceInterface.oGraphicsInViewingArea[0].render(),currentGraphic=instanceInterface.oGraphicsInViewingArea.splice(0,1),removedGraphicId=currentGraphic[0].options.featureId,instanceInterface.renderingOptimization.isOnRenderList(removedGraphicId)&&instanceInterface.renderingOptimization.removeFromRenderList(removedGraphicId),iIndex++}},processViewSetTrans:function(){for(var oTrans,aViewSetTransList=instanceInterface.findTransactionByIntent(emp.intents.control.VIEW_SET),iIndex=0;iIndex<aViewSetTransList.length;iIndex++)oTrans=aViewSetTransList[iIndex],instanceInterface.getView(oTrans.items[0]),instanceInterface.removeTransaction(oTrans.transactionId),oTrans.run()},mapResizeFn:function(){instanceInterface.getLeafletMap()._onResize()},isV2Core:function(){return instanceInterface.bIsV2Core},setLookAt:function(lookAt){var range,oMap=instanceInterface.getLeafletMap(),level=oMap.getZoom();if(lookAt){range=lookAt.altitude+lookAt.range*Math.cos(lookAt.tilt),range<instanceInterface.zoomScaleMap[instanceInterface.zoomScaleMap.length-1]&&(range=instanceInterface.zoomScaleMap[instanceInterface.zoomScaleMap.length-1]);try{return oMap.setView(new L.LatLng(lookAt.latitude,lookAt.longitude),level,{animate:!1}),range&&!isNaN(range)&&(level=instanceInterface.getLevel(range*instanceInterface.rangeToScaleMultiplier),oMap.setZoom(level,{animate:!1})),!0}catch(err){}}return!1}};engineInterface.initialize.succeed=function(){var oLayerEntry,oControl,oLeafletContent,oLayerList=[],sCoreId=instanceInterface.sContentCoreId,myElement=document.getElementById(instanceInterface.engineParameters.container);if(window.addResizeListener(myElement,instanceInterface.mapResizeFn),void 0!==bounds&&instanceInterface.leafletInstance.fitBounds(bounds),instanceInterface.oSelectionManager=new leafLet.SelectionManager({mapInstance:instanceInterface.empMapInstance}),instanceInterface.rootOverlayId=emp.helpers.id.newGUID(),instanceInterface.mapEngObjectList={},oLeafletContent=new emp.typeLibrary.Static({name:"Leaflet Content",featureId:sCoreId,overlayId:emp.storage.getRootGuid(instanceInterface.empMapInstance.mapInstanceId),visible:!0,coreId:sCoreId,coreParent:emp.storage.getRootGuid(instanceInterface.empMapInstance.mapInstanceId)}),oLayerList.push(oLeafletContent),oControl=new L.Control.Scale({position:"bottomright",maxWidth:200,imperial:!1,metric:!0,objectType:leafLet.typeLibrary.objectType.LL_CONTROL,coreId:emp.helpers.id.newGUID()}),oLayerEntry=new emp.typeLibrary.Static({name:"Scale Bar",featureId:oControl.getCoreId(),overlayId:sCoreId,visible:!0,coreId:oControl.getCoreId(),coreParent:sCoreId}),oLayerList.push(oLayerEntry),instanceInterface.addEmpObject(oControl),instanceInterface.leafletInstance.addControl(oControl),instanceInterface.engineParameters.tileLayer.path&&!emp.helpers.isEmptyString(instanceInterface.engineParameters.tileLayer.path)){var oMainMap;instanceInterface.engineParameters.tileLayer.path.indexOf("{x}")!==-1&&(instanceInterface.engineParameters.tileLayer.properties.instanceInterface=instanceInterface,oMainMap=L.tileLayer(instanceInterface.engineParameters.tileLayer.path,instanceInterface.engineParameters.tileLayer.properties),oLayerEntry=new emp.typeLibrary.Static({name:"Default Map",featureId:oMainMap.getCoreId(),overlayId:sCoreId,visible:!0,coreId:oMainMap.getCoreId(),coreParent:sCoreId}),oLayerList.push(oLayerEntry),instanceInterface.addEmpObject(oMainMap),instanceInterface.addMapLayer(oMainMap))}oLayerList.length>0&&instanceInterface.empMapInstance.eventing.StaticContent(oLayerList),instanceInterface.rootOverlay=new leafLet.typeLibrary.Overlay({item:{coreId:instanceInterface.rootOverlayId,name:"root Overlay",visible:!0,properties:{}},instanceInterface:instanceInterface}),instanceInterface.addEmpObject(instanceInterface.rootOverlay),instanceInterface.leafletInstance.addLayer(instanceInterface.rootOverlay),setupEventListeners(),instanceInterface.iMilStdIconSize=24,checkMapWidth(),instanceInterface.renderingOptimization.enabled&&instanceInterface.renderingOptimization.refreshZone(),instanceInterface.setLockState(emp3.api.enums.MapMotionLockEnum.UNLOCKED),instanceInterface.empMapInstance.eventing.StatusChange({status:emp.map.states.READY})},engineInterface.initialize.fail=function(args){instanceInterface.empMapInstance.eventing.StatusChange({status:emp.map.states.MAP_INSTANCE_INIT_FAILED})},engineInterface.status.get=function(transaction){var status=new emp.typeLibrary.Status({intent:transaction.intent,status:getStatus()});return transaction.items[0]=status,!0},engineInterface.status.reset=function(){},engineInterface.state.destroy=function(){var oEmpObject,myElement=document.getElementById(instanceInterface.engineParameters.container);window.removeResizeListener(myElement,instanceInterface.mapResizeFn);for(var sKeys=emp.helpers.associativeArray.getKeys(instanceInterface.mapEngObjectList),iIndex=0;iIndex<sKeys.length;iIndex++)if(oEmpObject=instanceInterface.mapEngObjectList[sKeys[iIndex]]){switch(oEmpObject.getObjectType()){case leafLet.typeLibrary.objectType.LL_CONTROL:oEmpObject._map&&instanceInterface.getLeafletMap().removeControl(oEmpObject);break;case leafLet.typeLibrary.objectType.LL_DEFAULT_MAP:instanceInterface.removeMapLayer(oEmpObject);break;default:oEmpObject.destroy()}instanceInterface.removeEmpObject(oEmpObject)}instanceInterface.leafletInstance.remove(),instanceInterface.leafletInstance=void 0,instanceInterface.oSelectionManager.destroy(),instanceInterface.oSelectionManager=void 0,instanceInterface.oLabelList=[],instanceInterface.oLayerControl=void 0,instanceInterface.oGraphicsInViewingArea=[],instanceInterface.mapEngObjectList=void 0,instanceInterface.rootOverlayId=void 0,instanceInterface.rootOverlay=void 0},engineInterface.visibility.set=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];if(item.coreId!==instanceInterface.sContentCoreId)try{var oObject=instanceInterface.mapEngObjectList[item.coreId];if(void 0===oObject){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Object "+item.coreId+" does not exists."})),iIndex--;continue}switch(oObject.getObjectType()){case leafLet.typeLibrary.objectType.LL_CONTROL:item.visible?oObject._map||instanceInterface.getLeafletMap().addControl(oObject):oObject._map&&instanceInterface.getLeafletMap().removeControl(oObject);break;case leafLet.typeLibrary.objectType.LL_DEFAULT_MAP:item.visible?instanceInterface.addMapLayer(oObject):instanceInterface.removeMapLayer(oObject);break;default:oObject.setVisibility(item)}}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.overlay.add=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{var oNewOverlay=new leafLet.typeLibrary.Overlay({item:item,instanceInterface:instanceInterface});if(void 0===oNewOverlay.getParentCoreId())instanceInterface.rootOverlay.addChildObject(oNewOverlay);else{if(!instanceInterface.mapEngObjectList.hasOwnProperty(oNewOverlay.getParentCoreId())){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent overlay "+item.parentId+" does not exists."})),iIndex--;continue}var oParentOverlay=instanceInterface.mapEngObjectList[oNewOverlay.getParentCoreId()];oParentOverlay.addChildObject(oNewOverlay)}instanceInterface.addEmpObject(oNewOverlay),oNewOverlay.isClusterActive()?oNewOverlay.activateCluster():oNewOverlay.hasClusterDef()&&oNewOverlay.clusterActivate()}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.overlay.remove=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{if(instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)){var oParentOverlay,oOverlay=instanceInterface.mapEngObjectList[item.coreId];oParentOverlay=void 0===item.parentCoreId?instanceInterface.rootOverlay:instanceInterface.mapEngObjectList[item.parentCoreId],oParentOverlay.removeChildObject(oOverlay),oOverlay.destroy()}else transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay "+item.overlayId+" does not exists."})),iIndex--}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.overlay.update=function(transaction){for(var oOverlay,oItem,oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){oItem=oaItems[iIndex];try{if(oOverlay=instanceInterface.getEmpObject(oItem.coreId)){if(oItem.hasOwnProperty("parentId")&&oItem.parentId!==oOverlay.getParentId()){var oNewParent,oParentOverlay=oOverlay.getParentObject();if(!oParentOverlay){transaction.fail(new emp.typeLibrary.Error({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Current Parent Overlay "+oOverlay.getParentId()+" not found."})),iIndex--;continue}if(oNewParent=oItem.parentId?instanceInterface.getEmpObject(oItem.parentId):instanceInterface.rootOverlay,!oNewParent){transaction.fail(new emp.typeLibrary.Error({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"New Parent Overlay "+oItem.parentId+" not found."})),iIndex--;continue}oParentOverlay.removeChildObject(oOverlay),oNewParent.addChildObject(oOverlay)}oItem.hasOwnProperty("name")&&oItem.name!==oOverlay.getName()&&oOverlay.setName(oItem.name)}else transaction.fail(new emp.typeLibrary.Error({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay "+oItem.overlayId+" does not exists."})),iIndex--}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.overlay.clear=function(transaction){var i,item,overlay,len=transaction.items.length,items=transaction.items;for(i=0;i<len;i++)try{item=items[i],instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)&&(overlay=instanceInterface.mapEngObjectList[item.coreId],overlay.clearChildren())}catch(err){transaction.fail([new emp.typeLibrary.Error({coreId:item.coreId,message:"An error occurred while attempting to clear an overlay with the id "+item.coreId+" : ",level:emp.typeLibrary.Error.level.MINOR,jsError:err})]),i--}},engineInterface.overlay.style=function(transaction){for(var oOverlay,oItem,oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){oItem=oaItems[iIndex];try{oOverlay=instanceInterface.getEmpObject(oItem.coreId),oOverlay?oOverlay.setStyle(oItem.type,oItem.properties):(transaction.fail(new emp.typeLibrary.Error({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay "+oItem.overlayId+" does not exists."})),iIndex--)}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.overlay.cluster.set=function(transaction){var oOverlay,oItem=transaction.items[0];return void 0===oItem?void transaction.fail([{level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Set transaction with no data."}]):(oOverlay=instanceInterface.mapEngObjectList[oItem.getCoreId()])?void oOverlay.clusterSet(oItem):void transaction.fail([{coreId:oItem.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Set transaction overlay not found."}])},engineInterface.overlay.cluster.activate=function(transaction){var oOverlay,oItem=transaction.items[0];return void 0===oItem?void transaction.fail([{level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Activate transaction with no data."}]):(oOverlay=instanceInterface.mapEngObjectList[oItem.getCoreId()])?void oOverlay.clusterActivate():void transaction.fail([{coreId:oItem.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Activate transaction overlay not found."}])},engineInterface.overlay.cluster.deactivate=function(transaction){var oOverlay,oItem=transaction.items[0];return void 0===oItem?void transaction.fail([{level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Deactivate transaction with no data."}]):(oOverlay=instanceInterface.mapEngObjectList[oItem.getCoreId()])?void oOverlay.clusterDeactivate():void transaction.fail([{coreId:oItem.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Deactivate transaction overlay not found."}])},engineInterface.overlay.cluster.remove=function(transaction){var oOverlay,oItem=transaction.items[0];return void 0===oItem?void transaction.fail([{level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Remove transaction with no data."}]):(oOverlay=instanceInterface.mapEngObjectList[oItem.getCoreId()])?void oOverlay.clusterRemove():void transaction.fail([{coreId:oItem.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay Cluster Remove transaction overlay not found."}])},engineInterface.view.set=function(transaction){var southWest,northEast,bounds,oEmpObject,oEmpBounds,oCenter,item=transaction.items[0],oMap=instanceInterface.getLeafletMap(),level=oMap.getZoom(),bZoom=item.zoom===!0||"number"==typeof item.zoom&&item.zoom>0,meters=16093;try{if(instanceInterface.getLockState()===emp3.api.enums.MapMotionLockEnum.NO_MOTION)throw new Error("The current lock state is set to 'NO_MOTION'.");if(item.location)oMap.setView(new L.LatLng(item.location.lat,item.location.lon),level,{animate:!1}),item.range&&!isNaN(item.range)&&(level=instanceInterface.getLevel(item.range*instanceInterface.rangeToScaleMultiplier),oMap.setZoom(level,{animate:!1}));else if(item.bounds)southWest=L.latLng(item.bounds.south,item.bounds.west),northEast=L.latLng(item.bounds.north,item.bounds.east),bounds=L.latLngBounds(southWest,northEast),oMap.fitBounds(bounds),item.range&&!isNaN(item.range)&&(level=instanceInterface.getLevel(item.range*instanceInterface.rangeToScaleMultiplier),oMap.setZoom(level,{animate:!1}));else if(item.featureId||item.overlayId){if(oEmpObject=instanceInterface.mapEngObjectList[item.coreId],void 0!==oEmpObject){if(oEmpObject.getObjectType()===leafLet.typeLibrary.objectType.OVERLAY&&!oEmpObject.hasFeatures())return void transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MINOR,message:"Overlay "+oEmpObject.options.name+" is empty."}));oEmpBounds=oEmpObject.getFeatureBounds(),oEmpBounds&&(bZoom?(oEmpBounds.getCenterWidth()<meters&&oEmpBounds.setCenterWidth(meters),oMap.fitBounds(new L.LatLngBounds(oEmpBounds.getSouthWest(),oEmpBounds.getNorthEast()),{animate:!1})):(oCenter=oEmpBounds.getCenter(),oMap.setView(new L.LatLng(oCenter.lat,oCenter.lng),level,{animate:!1})))}}else item.range&&(level=instanceInterface.getLevel(item.range*instanceInterface.rangeToScaleMultiplier),oMap.setZoom(level,{animate:!1}));instanceInterface.getView(transaction.items[0])}catch(err){transaction.fail([new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,message:"An error occurred while attempting to set the map view: ",level:emp.typeLibrary.Error.level.MINOR,jsError:err})])}},engineInterface.view.get=function(transaction){var failList=[];try{instanceInterface.getView(transaction.items[0])}catch(err){failList.push(new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,message:"An error occurred while getting the maps view: ",level:emp.typeLibrary.Error.level.MINOR,jsError:err})),transaction.fail(failList)}return!0},engineInterface.feature.add=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{var oNewFeature;if(instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId))oNewFeature=instanceInterface.mapEngObjectList[item.coreId],oNewFeature.updateFeature(item),oNewFeature.isInEditMode()&&instanceInterface.oCurrentEditor.render();else{switch(item.format){case emp.typeLibrary.featureFormatType.MILSTD:instanceInterface.isV2Core()&&emp.util.milstdColorFix(item),oNewFeature=new leafLet.typeLibrary.MilStdFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.KML:oNewFeature=new leafLet.typeLibrary.KMLFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.GEOJSON:case emp.typeLibrary.featureFormatType.GEO_POINT:case emp.typeLibrary.featureFormatType.GEO_PATH:case emp.typeLibrary.featureFormatType.GEO_POLYGON:oNewFeature=leafLet.utils.geoJson.isAOI(item)?new leafLet.typeLibrary.AOIFeature({item:item,instanceInterface:instanceInterface}):new leafLet.typeLibrary.GeoJsonFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.AIRSPACE:oNewFeature=leafLet.utils.airspace.createAirspace({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.IMAGE:oNewFeature=new leafLet.typeLibrary.ImageFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.GEO_TEXT:oNewFeature=new leafLet.typeLibrary.GeoTextFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.GEO_RECTANGLE:oNewFeature=new leafLet.typeLibrary.GeoRectangleFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.GEO_SQUARE:oNewFeature=new leafLet.typeLibrary.GeoSquareFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.GEO_CIRCLE:oNewFeature=new leafLet.typeLibrary.GeoCircleFeature({item:item,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.GEO_ELLIPSE:oNewFeature=new leafLet.typeLibrary.GeoEllipseFeature({item:item,instanceInterface:instanceInterface});break;default:throw new Error(item.format+" features are not yet supported.")}if(!instanceInterface.mapEngObjectList.hasOwnProperty(oNewFeature.getParentCoreId())){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent "+item.parentId+" does not exists."})),iIndex--;continue}var oParentOverlay=instanceInterface.mapEngObjectList[oNewFeature.getParentCoreId()];if(oParentOverlay.addChildObject(oNewFeature),instanceInterface.addEmpObject(oNewFeature),item.zoom&&!instanceInterface.bInDrawMode&&!instanceInterface.bInEditMode){var oEmpBounds=oNewFeature.getFeatureBounds();oEmpBounds.getCenterWidth()<16093&&oEmpBounds.setCenterWidth(16093),instanceInterface.leafletInstance.fitBounds(new L.LatLngBounds(oEmpBounds.getSouthWest(),oEmpBounds.getNorthEast()))}}}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.feature.remove=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{if(instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)){var oParentOverlay,oFeature=instanceInterface.mapEngObjectList[item.coreId];oFeature.isInEditMode()&&(instanceInterface.oCurrentEditor.cancelEdit(),instanceInterface.oCurrentEditor.destroy(),instanceInterface.bInEditMode=!1,instanceInterface.oCurrentEditor=void 0,instanceInterface.oEditTransaction.run(),instanceInterface.oEditTransaction=void 0),oParentOverlay=void 0===item.parentCoreId?instanceInterface.rootOverlay:instanceInterface.mapEngObjectList[item.parentCoreId],oParentOverlay?(oParentOverlay.removeChildObject(oFeature),oFeature.destroy()):(transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent of feature "+item.featureId+" was not found."})),iIndex--)}else transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature "+item.featureId+" does not exists."})),iIndex--}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.feature.update=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{var oFeature;if(!instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"feature "+item.featureId+" does not exists."})),iIndex--;continue}if(oFeature=instanceInterface.mapEngObjectList[item.coreId],item.name&&(oFeature.updateFeature(item),oFeature.isInEditMode()&&instanceInterface.oCurrentEditor.render()),void 0!==item.destCoreParent){var oOldParent=instanceInterface.mapEngObjectList[item.parentCoreId],oNewParent=instanceInterface.mapEngObjectList[item.destCoreParent];oOldParent.removeChildObject(oFeature),oNewParent.addChildObject(oFeature)}}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.draw.begin=function(transaction){var oFeature,oDrawItem=transaction.items[0],oOriginalFeature=oDrawItem.originFeature;switch(oOriginalFeature&&(oFeature=instanceInterface.mapEngObjectList[oOriginalFeature.coreId]),oDrawItem.type.toLowerCase()){case"point":instanceInterface.oCurrentEditor=new leafLet.editor.GeoJson({geoJsonType:"Point",transaction:transaction,EmpDrawEditItem:oDrawItem,feature:oFeature,instanceInterface:instanceInterface});break;case"line":case emp.typeLibrary.featureFormatType.GEO_PATH:instanceInterface.oCurrentEditor=new leafLet.editor.GeoJson({geoJsonType:"LineString",transaction:transaction,EmpDrawEditItem:oDrawItem,feature:oFeature,instanceInterface:instanceInterface});break;case"polygon":instanceInterface.oCurrentEditor=new leafLet.editor.GeoJson({geoJsonType:"Polygon",transaction:transaction,EmpDrawEditItem:oDrawItem,feature:oFeature,instanceInterface:instanceInterface});break;case"airspace":instanceInterface.oCurrentEditor=leafLet.utils.airspace.createEditor(instanceInterface,transaction,oDrawItem,oFeature);break;case"milstd":instanceInterface.oCurrentEditor=leafLet.utils.milstd.createEditor(instanceInterface,transaction,oDrawItem,oFeature)}instanceInterface.oCurrentEditor&&(transaction.pause(),instanceInterface.bInDrawMode=!0,instanceInterface.oEditTransaction=transaction)},engineInterface.draw.end=function(transaction){instanceInterface.oEditTransaction.transactionId===transaction.items[0].transactionId&&(instanceInterface.oCurrentEditor.endEdit(),instanceInterface.oCurrentEditor.destroy(),instanceInterface.bInDrawMode=!1,instanceInterface.oCurrentEditor=void 0,instanceInterface.oEditTransaction.run(),instanceInterface.oEditTransaction=void 0)},engineInterface.draw.cancel=function(transaction){instanceInterface.oEditTransaction.transactionId===transaction.items[0].transactionId&&(instanceInterface.oCurrentEditor.cancelEdit(),instanceInterface.oCurrentEditor.destroy(),instanceInterface.bInDrawMode=!1,instanceInterface.oCurrentEditor=void 0,instanceInterface.oEditTransaction.run(),instanceInterface.oEditTransaction=void 0)},engineInterface.edit.begin=function(transaction){
var oFeature,oEditItem=transaction.items[0];if(oFeature=instanceInterface.mapEngObjectList[oEditItem.coreId],void 0===oFeature)transaction.fail([{coreId:oEditItem.coreId,message:"Feature not found.",level:emp.typeLibrary.Error.level.MAJOR}]);else if(oFeature.isEditable())switch(oFeature.getFormat()){case emp.typeLibrary.featureFormatType.GEOJSON:case emp.typeLibrary.featureFormatType.GEO_POINT:case emp.typeLibrary.featureFormatType.GEO_PATH:case emp.typeLibrary.featureFormatType.GEO_POLYGON:emp.helpers.isAOI(oFeature.options)?instanceInterface.oCurrentEditor=new leafLet.editor.AOI({transaction:transaction,EmpDrawEditItem:oEditItem,feature:oFeature,instanceInterface:instanceInterface}):instanceInterface.oCurrentEditor=new leafLet.editor.GeoJson({transaction:transaction,EmpDrawEditItem:oEditItem,feature:oFeature,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.KML:instanceInterface.oCurrentEditor=new leafLet.editor.KML({transaction:transaction,EmpDrawEditItem:oEditItem,feature:oFeature,instanceInterface:instanceInterface});break;case emp.typeLibrary.featureFormatType.MILSTD:instanceInterface.oCurrentEditor=leafLet.utils.milstd.createEditor(instanceInterface,transaction,oEditItem,oFeature);break;case emp.typeLibrary.featureFormatType.AIRSPACE:instanceInterface.oCurrentEditor=leafLet.utils.airspace.createEditor(instanceInterface,transaction,oEditItem,oFeature)}else transaction.fail([{coreId:oEditItem.coreId,message:"This feature can not be edited.",level:emp.typeLibrary.Error.level.MAJOR}]);instanceInterface.oCurrentEditor&&(transaction.pause(),instanceInterface.bInEditMode=!0,instanceInterface.oEditTransaction=transaction,instanceInterface.oSelectionManager.deselectAllFeatures(),instanceInterface.oSelectionManager.selectFeature(oFeature),instanceInterface.oSelectionManager.generateEvent())},engineInterface.edit.end=function(transaction){instanceInterface.oEditTransaction.transactionId===transaction.items[0].transactionId&&(instanceInterface.oCurrentEditor.endEdit(),instanceInterface.oCurrentEditor.destroy(),instanceInterface.bInEditMode=!1,instanceInterface.oCurrentEditor=void 0,instanceInterface.oEditTransaction.run(),instanceInterface.oEditTransaction=void 0)},engineInterface.edit.cancel=function(transaction){instanceInterface.oEditTransaction.transactionId===transaction.items[0].transactionId&&(instanceInterface.oCurrentEditor.cancelEdit(),instanceInterface.oCurrentEditor.destroy(),instanceInterface.bInEditMode=!1,instanceInterface.oCurrentEditor=void 0,instanceInterface.oEditTransaction.run(),instanceInterface.oEditTransaction=void 0)},engineInterface.selection.set=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{var oFeature;if(!instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"feature "+item.featureId+" does not exists."})),iIndex--;continue}oFeature=instanceInterface.mapEngObjectList[item.coreId],item.select?instanceInterface.oSelectionManager.selectFeature(oFeature,item.selectedId):instanceInterface.oSelectionManager.deselectFeature(oFeature,item.selectedId)}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}instanceInterface.oSelectionManager.resetEventData()},engineInterface.navigation.enable=function(transaction){var enabled;try{if(transaction&&transaction.items){if(enabled=transaction.items[0],enabled.lock!==instanceInterface.getLockState())switch(instanceInterface.setLockState(enabled.lock),instanceInterface.getLockState()){case emp3.api.enums.MapMotionLockEnum.NO_MOTION:instanceInterface.leafletInstance.dragging.disable(),instanceInterface.leafletInstance.doubleClickZoom.disable(),instanceInterface.leafletInstance.scrollWheelZoom.disable(),instanceInterface.leafletInstance.keyboard.disable(),instanceInterface.leafletInstance.zoomControl&&instanceInterface.leafletInstance.zoomControl.remove(instanceInterface.leafletInstance);break;case emp3.api.enums.MapMotionLockEnum.NO_PAN:instanceInterface.leafletInstance.dragging.disable(),instanceInterface.leafletInstance.doubleClickZoom.enable(),instanceInterface.leafletInstance.scrollWheelZoom.enable(),instanceInterface.leafletInstance.keyboard.disable(),instanceInterface.leafletInstance.zoomControl&&instanceInterface.leafletInstance.zoomControl.addTo(instanceInterface.leafletInstance);break;case emp3.api.enums.MapMotionLockEnum.NO_ZOOM:instanceInterface.leafletInstance.dragging.enable(),instanceInterface.leafletInstance.doubleClickZoom.disable(),instanceInterface.leafletInstance.scrollWheelZoom.disable(),instanceInterface.leafletInstance.keyboard.enable(),instanceInterface.leafletInstance.zoomControl&&instanceInterface.leafletInstance.zoomControl.remove(instanceInterface.leafletInstance);break;case emp3.api.enums.MapMotionLockEnum.NO_ZOOM_NO_PAN:instanceInterface.leafletInstance.dragging.disable(),instanceInterface.leafletInstance.doubleClickZoom.disable(),instanceInterface.leafletInstance.scrollWheelZoom.disable(),instanceInterface.leafletInstance.keyboard.disable(),instanceInterface.leafletInstance.zoomControl&&instanceInterface.leafletInstance.zoomControl.remove(instanceInterface.leafletInstance);break;case emp3.api.enums.MapMotionLockEnum.SMART_MOTION:instanceInterface.leafletInstance.dragging.disable(),instanceInterface.leafletInstance.doubleClickZoom.disable(),instanceInterface.leafletInstance.scrollWheelZoom.disable(),instanceInterface.leafletInstance.keyboard.disable(),instanceInterface.leafletInstance.zoomControl&&instanceInterface.leafletInstance.zoomControl.remove(instanceInterface.leafletInstance);break;case emp3.api.enums.MapMotionLockEnum.UNLOCKED:instanceInterface.leafletInstance.dragging.enable(),instanceInterface.leafletInstance.doubleClickZoom.enable(),instanceInterface.leafletInstance.scrollWheelZoom.enable(),instanceInterface.leafletInstance.keyboard.enable(),instanceInterface.leafletInstance.zoomControl&&instanceInterface.leafletInstance.zoomControl.addTo(instanceInterface.leafletInstance);break;default:throw new Error("MapMotionLockEnum is not valid.")}transaction.run()}}catch(Ex){new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})}},engineInterface.settings.mil2525.icon.size.set=function(transaction){var oEmpObject,sCoreId;instanceInterface.iMilStdIconSize=transaction.items[0];try{for(sCoreId in instanceInterface.mapEngObjectList)instanceInterface.mapEngObjectList.hasOwnProperty(sCoreId)&&(oEmpObject=instanceInterface.mapEngObjectList[sCoreId],oEmpObject.getObjectType()!==leafLet.typeLibrary.objectType.FEATURE||oEmpObject.getFormat()!==emp.typeLibrary.featureFormatType.MILSTD||oEmpObject.isMultiPointTG()||oEmpObject.updateIconSize())}catch(Ex){new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})}},engineInterface.settings.mil2525.icon.labels.set=function(transaction){var oEmpObject,sCoreId;try{var sTemp=JSON.stringify(transaction.items[0]);instanceInterface.oLabelList=JSON.parse(sTemp);for(sCoreId in instanceInterface.mapEngObjectList)instanceInterface.mapEngObjectList.hasOwnProperty(sCoreId)&&(oEmpObject=instanceInterface.mapEngObjectList[sCoreId],oEmpObject instanceof leafLet.typeLibrary.MilStdFeature&&!oEmpObject.isMultiPointTG()&&oEmpObject.updateFeature({bUpdateGraphic:!0}))}catch(Ex){new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})}},engineInterface.wms.add=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{var oNewWMS;if(instanceInterface.isV2Core()&&(item.useProxy=emp.util.config.getUseProxySetting()),instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId))oNewWMS=instanceInterface.mapEngObjectList[item.coreId],oNewWMS.updateWMS(item);else{if(oNewWMS=new leafLet.typeLibrary.WMS({item:item,instanceInterface:instanceInterface}),instanceInterface.mapEngObjectList.hasOwnProperty(oNewWMS.getParentCoreId())){var oParentOverlay=instanceInterface.mapEngObjectList[oNewWMS.getParentCoreId()];oParentOverlay.addChildObject(oNewWMS)}else{if(item.createParent(),!instanceInterface.mapEngObjectList.hasOwnProperty(oNewWMS.getParentCoreId())){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent "+oNewWMS.getParentCoreId()+" does not exists."})),iIndex--;continue}var oParentOverlay=instanceInterface.mapEngObjectList[oNewWMS.getParentCoreId()];oParentOverlay.addChildObject(oNewWMS)}instanceInterface.addEmpObject(oNewWMS)}}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.wms.remove=function(transaction){for(var oaItems=transaction.items,iIndex=0;iIndex<oaItems.length;iIndex++){var item=oaItems[iIndex];try{if(instanceInterface.mapEngObjectList.hasOwnProperty(item.coreId)){var oParentOverlay,oFeature=instanceInterface.mapEngObjectList[item.coreId];oParentOverlay=void 0===item.parentCoreId?instanceInterface.rootOverlay:instanceInterface.mapEngObjectList[item.parentCoreId],oParentOverlay.removeChildObject(oFeature),oFeature.destroy()}else transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"WMS "+item.id+" does not exists."})),iIndex--}catch(Ex){transaction.fail(new emp.typeLibrary.Error({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:Ex.name+": "+Ex.message,jsError:Ex})),iIndex--}}},engineInterface.view.getLatLonFromXY=function(transaction){for(var item,oLatLng,oPoint,i=0;i<transaction.items.length;i+=1)item=transaction.items[i],oPoint=new L.Point(item.x,item.y),oLatLng=instanceInterface.leafletInstance.containerPointToLatLng(oPoint),oLatLng&&(item.lat=oLatLng.lat,item.lon=oLatLng.lng)},engineInterface.view.getXYFromLatLon=function(transaction){for(var item,oLatLng,oPoint,i=0;i<transaction.items.length;i+=1)item=transaction.items[i],oLatLng=new L.LatLng(item.lat,item.lon),oPoint=instanceInterface.leafletInstance.latLngToContainerPoint(oLatLng),oPoint&&(item.x=oPoint.x,item.y=oPoint.y)},engineInterface.lookAt.set=function(transaction){var iIndex;try{if(instanceInterface.getLockState()===emp3.api.enums.MapMotionLockEnum.NO_MOTION)throw new Error('The current lock state is set to "NO_MOTION".');for(iIndex=0;iIndex<transaction.items.length;iIndex+=1)instanceInterface.setLookAt(transaction.items[iIndex])?iIndex++:transaction.fail([{coreId:transaction.items[iIndex].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Fail to set LookAt."}])}catch(err){transaction.fail([new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,message:"An error occurred while attempting to set the lookAt object: ",level:emp.typeLibrary.Error.level.MAJOR,jsError:err})])}},engineInterface.map.config=function(transaction){var iIndex,prop,newConfig,previousRenderSettings={enabled:instanceInterface.renderingOptimization.enabled,midDistanceThreshold:instanceInterface.renderingOptimization.midDistanceThreshold,farDistanceThreshold:instanceInterface.renderingOptimization.farDistanceThreshold.value};for(iIndex=0;iIndex<transaction.items.length;iIndex+=1){newConfig=transaction.items[0];try{for(prop in newConfig)switch(prop){case"renderingOptimization":if("boolean"!=typeof newConfig[prop])throw new Error("'renderingOptimization' property must be of Boolean type.");instanceInterface.renderingOptimization.enabled=newConfig[prop];break;case"midDistanceThreshold":if("number"!=typeof newConfig[prop])throw new Error("'midDistanceThreshold' property must be of Number type.");instanceInterface.renderingOptimization.midDistanceThreshold=newConfig[prop];break;case"farDistanceThreshold":if("number"!=typeof newConfig[prop])throw new Error("'farDistanceThreshold' property must be of Number type.");instanceInterface.renderingOptimization.farDistanceThreshold.value=newConfig[prop];break;case"brightness":}previousRenderSettings.enabled?instanceInterface.renderingOptimization.enabled?previousRenderSettings.midDistanceThreshold===instanceInterface.renderingOptimization.midDistanceThreshold&&previousRenderSettings.farDistanceThreshold===instanceInterface.renderingOptimization.farDistanceThreshold.value||(instanceInterface.renderingOptimization.refreshZone(),instanceInterface.scheduleRendering(),instanceInterface.renderingOptimization.zoneChanged=!1):(instanceInterface.renderingOptimization.viewInZone=void 0,instanceInterface.renderingOptimization.zoneChanged=!0,instanceInterface.scheduleRendering(),instanceInterface.renderingOptimization.zoneChanged=!1):instanceInterface.renderingOptimization.enabled&&(instanceInterface.renderingOptimization.refreshZone(),instanceInterface.scheduleRendering(),instanceInterface.renderingOptimization.zoneChanged=!1),transaction.run()}catch(e){transaction.fail(new emp.typeLibrary.Error({coreId:newConfig.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:e.name+": "+e.message,jsError:e})),iIndex--}}},engineInterface.implementation.displayName="Leaflet Map Engine",engineInterface.implementation.version="34.0";var sGenericHelpText="<table style='width:100%;padding-top: 10px; border:1px solid #4a4a4a;' ><thead><tr style='border:1px solid #4a4a4a;'><th style='border:1px solid #4a4a4a; padding:5px; collapse:collapse;width:40%'>Action</th><th style='border:1px solid #4a4a4a; padding:5px; collapse:collapse;width:25%'>Ctrl Point</th><th style='border:1px solid #4a4a4a; padding:5px; collapse:collapse;width:35%'>Mouse/ Key</th></tr></thead><tbody><tr style='border:0px;'><td colspan='3' style='padding: 0px;'><div style='overflow:auto; width:100%;'><table style='border:1px solid #4a4a4a; collapse:collapse;width:100%;' ><tr><td style='border:1px solid #4a4a4a;padding:5px; width:40%' >Drag laterally to alter the Lat/Long of vertex</td><td style='border:1px solid #4a4a4a;padding:5px; width:25%;color:blue;vertical-align:middle;text-align:center'>Blue</td><td style='border:1px solid #4a4a4a;padding:5px; width:35%'>Mouse left button drag</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Drag to alter width</td><td style='border:1px solid #4a4a4a;padding:5px; color:lightgrey;vertical-align:middle;text-align:center'>Grey</td><td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Drag to alter radius</td><td style='border:1px solid #4a4a4a;padding:5px; color:grey;vertical-align:middle;text-align:center'>Dark Grey</td><td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Drag to alter angle</td><td style='border:1px solid #4a4a4a;padding:5px; color:yellow;vertical-align:middle;text-align:center;vertical-align:middle;text-align:center'>Yellow</td><td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Drag laterally to alter shape's side Lat/Long</td><td style='border:1px solid #4a4a4a;padding:5px; color:cyan;vertical-align:middle;text-align:center'>Cyan</td><td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Add new vertex</td><td style='border:1px solid #4a4a4a;padding:5px; vertical-align:middle;text-align:center'></td><td style='border:1px solid #4a4a4a;padding:5px; '>left click at location</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Remove selected vertex</td><td style='border:1px solid #4a4a4a;padding:5px; color:blue;vertical-align:middle;text-align:center'>blue</td><td style='border:1px solid #4a4a4a;padding:5px; '>Double left click</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px; ' >Drag laterally to alter shape's position</td><td style='border:1px solid #4a4a4a;padding:5px; '></td><td style='border:1px solid #4a4a4a;padding:5px; '>Mouse left button drag on feature</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px;' >Complete the edit session</td><td style='border:1px solid #4a4a4a;padding:5px;vertical-align:middle;text-align:center'></td><td style='border:1px solid #4a4a4a;padding:5px;'>Click the Finish button</td></tr><tr><td style='border:1px solid #4a4a4a;padding:5px;' >Cancel the edit session</td><td style='border:1px solid #4a4a4a;padding:5px;vertical-align:middle;text-align:center'></td><td style='border:1px solid #4a4a4a;padding:5px;'>Click the Cancel button</td></tr></table></div></td></tr></tbody></table>";engineInterface.implementation.help.edit=sGenericHelpText,engineInterface.implementation.help.draw=sGenericHelpText,engineInterface.capabilities.projection.flat=!1,engineInterface.capabilities.mapType.type2D=!0,engineInterface.capabilities.formats.GEOJSON_BASIC.plot=!0,engineInterface.capabilities.formats.GEOJSON_BASIC.draw=!0,engineInterface.capabilities.formats.GEOJSON_BASIC.edit=!0,engineInterface.capabilities.formats.GEOJSON_FULL.plot=!0,engineInterface.capabilities.formats.WMS.version_1_1=!0,engineInterface.capabilities.formats.WMS.version_1_3=!0,engineInterface.capabilities.formats.KML_BASIC.plot=!0,engineInterface.capabilities.formats.KML_BASIC.edit=!0,engineInterface.capabilities.formats.KML_COMPLEX.plot=!0,engineInterface.capabilities.formats.IMAGE.plot=!0,engineInterface.capabilities.formats.MILSTD.version2525B.plot=!0,engineInterface.capabilities.formats.MILSTD.version2525B.draw=!0,engineInterface.capabilities.formats.MILSTD.version2525B.edit=!0,engineInterface.capabilities.formats.MILSTD.version2525C.plot=!0,engineInterface.capabilities.formats.MILSTD.version2525C.draw=!0,engineInterface.capabilities.formats.MILSTD.version2525C.edit=!0,engineInterface.capabilities.formats.AIRSPACE.plot=!0,engineInterface.capabilities.formats.AIRSPACE.draw=!0,engineInterface.capabilities.formats.AIRSPACE.edit=!0,engineInterface.capabilities.formats.AOI.plot=!0,engineInterface.capabilities.formats.AOI.draw=!1,engineInterface.capabilities.formats.AOI.edit=!0,engineInterface.capabilities.formats.ArcGIS=!1,engineInterface.capabilities.overlayClustering=!0,engineInterface.capabilities.settings.milstd.iconSize=!0,engineInterface.capabilities.settings.milstd.labelOption=!0,engineInterface.capabilities.settings.iconSize=!1;try{var center,level=0,southWest=L.latLng(-90,-180),northEast=L.latLng(90,180);L.latLngBounds(southWest,northEast);if(void 0!==args.initialExtent)if(args.initialExtent.hasOwnProperty("centerLat"))center=new L.LatLng(args.initialExtent.centerLat,args.initialExtent.centerLon),args.initialExtent.hasOwnProperty("range")?level=instanceInterface.getLevel(args.initialExtent.range*instanceInterface.rangeToScaleMultiplier):args.initialExtent.hasOwnProperty("scale")&&(level=instanceInterface.getLevel(args.initialExtent.scale));else{center=new L.LatLng(0,0);var southWest=L.latLng(args.initialExtent.south,args.initialExtent.west),northEast=L.latLng(args.initialExtent.north,args.initialExtent.east);bounds=L.latLngBounds(southWest,northEast)}else center=new L.LatLng(0,0);if(instanceInterface.leafletInstance=L.map(args.container,{worldCopyJump:!1,zoomControl:!0,minZoom:1,center:center,zoom:level,boxZoom:!1,trackResize:!1,attributionControl:!1,doubleClickZoom:!1,scrollWheelZoom:!0}),void 0===instanceInterface.leafletInstance||null===instanceInterface.leafletInstance)throw"Leaflet creation failed.";instanceInterface.leafletInstance.zoomControl.setPosition("topright"),instanceInterface.leafletInstance.whenReady(function(){setTimeout(engineInterface.initialize.succeed,100)}),$(".leaflet-container").css("cursor","pointer")}catch(err){setTimeout(engineInterface.initialize.fail,0)}return engineInterface};
//# sourceMappingURL=emp3-leaflet.min.js.map