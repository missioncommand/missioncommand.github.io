/*! emp3-web-sdk 2.2.0 17-03-2017 */

function LatLon(lat,lon,rad){"undefined"==typeof rad&&(rad=6371),this._lat="number"==typeof lat?lat:"string"==typeof lat&&""!==lat.trim()?+lat:NaN,this._lon="number"==typeof lon?lon:"string"==typeof lon&&""!==lon.trim()?+lon:NaN,this._radius="number"==typeof rad?rad:"string"==typeof rad&&""!==trim(lon)?+rad:NaN}function LatLon(lat,lon,rad){"undefined"==typeof rad&&(rad=6371),this._lat="number"==typeof lat?lat:"string"==typeof lat&&""!==lat.trim()?+lat:NaN,this._lon="number"==typeof lon?lon:"string"==typeof lon&&""!==lon.trim()?+lon:NaN,this._radius="number"==typeof rad?rad:"string"==typeof rad&&""!==trim(lon)?+rad:NaN}function convertGeoJsonToCoordinateString(geojson){var i,coordString="";if(geojson&&geojson.type&&geojson.coordinates)switch(geojson.type.toLowerCase()){case"point":geojson.coordinates.length>=2&&(coordString=geojson.coordinates[0]+","+geojson.coordinates[1],geojson.coordinates.length>=3&&(coordString+=geojson.coordinates[2]));break;case"linestring":for(i=0;i<geojson.coordinates.length;i+=1)geojson.coordinates[i].length>=2&&(coordString+=geojson.coordinates[i][0]+","+geojson.coordinates[i][1],geojson.coordinates[i].length>=3&&(coordString+=geojson.coordinates[i][2]),coordString+=" ");break;case"polygon":if(geojson.coordinates.length>=1)for(i=0;i<geojson.coordinates[0].length;i+=1)geojson.coordinates[0][i].length>=2&&(coordString+=geojson.coordinates[0][i][0]+","+geojson.coordinates[0][i][1],geojson.coordinates[i].length>=3&&(coordString+=geojson.coordinates[0][i][2]),coordString+=" ")}return coordString}function convertCoordinateStringToGeoJson(coordinates){var coordinateArray,geoJsonCoordinateArray,geojsontype,splitcoordinates,point,k,j,geojsonObject;if(coordinates=coordinates.replace(/^\s|\s$/g,""),coordinateArray=coordinates.split(" "),geoJsonCoordinateArray=[],coordinateArray.length>1){for(geojsontype="LineString",k=0;k<coordinateArray.length;k+=1)if(""!==coordinateArray[k]){for(splitcoordinates=coordinateArray[k].split(","),point=[],j=0;j<splitcoordinates.length;j+=1)point.push(splitcoordinates[j]);geoJsonCoordinateArray.push(point)}}else for(geojsontype="Point",splitcoordinates=coordinateArray[0].split(","),k=0;k<splitcoordinates.length;k+=1)geoJsonCoordinateArray.push(splitcoordinates[k]);return geojsonObject={type:geojsontype,coordinates:geoJsonCoordinateArray}}function convertLocationArrayToString(locations){var i,coordString="",len=locations.length;for(i=0;i<len;i+=1)locations[i].lat&&locations[i].lon&&(coordString+=locations[i].lon+","+locations[i].lat,locations[i].alt&&(coordString+=","+locations[i].alt),i<locations.length-1&&(coordString+=" "));return coordString}function sizeof(object){var key,index,objects=[object],size=0,len=objects.length;for(index=0;index<len;index++)switch(typeof objects[index]){case"boolean":size+=4;break;case"number":size+=8;break;case"string":size+=2*objects[index].length;break;case"object":if("[object Array]"!=Object.prototype.toString.call(objects[index]))for(key in objects[index])size+=2*key.length;for(key in objects[index]){for(var processed=!1,search=0;search<objects.length;search++)if(objects[search]===objects[index][key]){processed=!0;break}processed||objects.push(objects[index][key])}}return size}function MapFeaturePlotMessage(message,callInfo,transactionId){message=message||{};var payload,i,length,convertedFeature,feature,featureCount,multiPayload=[];for(message.features?featureCount=message.features.length:message.feature&&(featureCount=1,message.features=[message.feature]),featureCount>1?emp3.api.Message.call(this,emp3.api.enums.channel.plotFeatureBatch,transactionId):emp3.api.Message.call(this,emp3.api.enums.channel.plotFeature,transactionId),i=0;i<featureCount;i++){switch(feature=message.features[i],feature.featureType){case emp3.api.enums.FeatureTypeEnum.KML:convertedFeature=emp3.api.convertFeatureToKML(feature);break;default:convertedFeature=emp3.api.convertFeatureToGeoJSON(feature)}payload={overlayId:message.overlayId,featureId:feature.geoId,visible:message.visible,parentId:message.parentId,format:feature.featureType,feature:convertedFeature,name:feature.name,readOnly:feature.readOnly,properties:emp3.api.getProperties(feature)},payload.properties.modifiers=payload.properties.modifiers||{},payload.properties.modifiers.standard=feature.symbolStandard,multiPayload.push(payload)}length=multiPayload.length,length>1?this.payload={messageId:transactionId,features:multiPayload}:(this.payload=multiPayload[0],this.payload.messageId=transactionId)}function MapFeaturePlotUrlMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.plotUrl,transactionId);var payload;switch(payload={format:message.mapService.format,featureId:message.mapService.geoId,overlayId:emp.constant.parentIds.MAP_LAYER_PARENT,name:message.mapService.name,description:message.mapService.description,messageId:transactionId,url:message.mapService.url,useProxy:message.mapService.useProxy},message.mapService.format){case"wms":payload.params={layers:message.mapService.layers,format:message.mapService.tileFormat,version:message.mapService.version};break;case"wmts":payload.params={layer:message.mapService.layer,format:message.mapService.tileFormat,version:message.mapService.version,style:message.mapService.style,sampleDimensions:message.mapService.sampleDimensions};break;case"kmlLayer":payload.kmlString=message.mapService.kmlString}this.payload=payload}function MapFeatureUnplotMessage(message,callInfo,transactionId){var i,payload,featureCount=0,features=[];for(message=message||{},message.features&&(featureCount=message.features.length),emp3.api.Message.call(this,emp3.api.enums.channel.unplotFeatureBatch,transactionId),i=0;i<featureCount;i+=1)payload={featureId:message.features[i].geoId},message.overlayId&&(payload.overlayId=message.overlayId),void 0!==message.overlayId?payload.overlayId=message.overlayId:message.parentId&&(payload.parentId=message.parentId),features.push(payload);this.payload={features:features,messageId:transactionId}}function MapFeatureDrawMessage(message,callInfo,transactionId){if(emp3.api.Message.call(this,emp3.api.enums.channel.draw,transactionId),message=message||{},!message.feature)throw new Error("Missing argument: feature");this.feature=message.feature;var properties=emp3.api.getProperties(this.feature),coordinates=emp3.api.convertCMAPIPositionsToGeoJson(this.feature.positions,this.feature.featureType);this.payload={featureId:this.feature.geoId,name:this.feature.name,type:this.feature.featureType,symbolCode:this.feature.symbolCode,properties:properties,coordinates:coordinates,messageId:transactionId},this.mapId=callInfo.mapId}function MapFeatureUpdateMessage(message,callInfo,transactionId){switch(emp3.api.Message.call(this,emp3.api.enums.channel.updateFeature,transactionId),callInfo.method){case"Feature.move":this.payload={featureId:message.features[0].geoId,overlayId:message.oldOverlayId,newOverlayId:message.newOverlayId,parentId:message.oldParentId,newParentId:message.newParentId,messageId:transactionId};break;default:this.payload={features:Array.isArray(message.features)?message.features:[],messageId:transactionId}}}function MapFeatureSelected(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.featureSelectedBatch,transactionId);var features=[];Array.isArray(message.features)?emp.util.each(message.features,function(feature){features.push({featureId:feature.geoId})}):message.features instanceof emp3.api.Feature&&(features=[message.features.geoId]),this.payload={features:features,messageId:transactionId}}function MapFeatureDeselected(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.featureDeselectedBatch,transactionId);var toDeselect,features=[];toDeselect="Map.clearSelected"===callInfo.method?emp3.api.MessageHandler.getInstance().getSelected(message.mapId):message.features,emp.util.each(toDeselect,function(feature){features.push({featureId:feature.geoId})}),this.payload={features:features,messageId:transactionId}}function MapOverlayCreateMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.createOverlay,transactionId),this.payload=[],emp.util.each(message.overlays,function(overlay){this.payload.push({name:overlay.name,overlayId:overlay.geoId,parentId:message.parentId,messageId:transactionId})}.bind(this))}function MapOverlayUpdateMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.updateOverlay,transactionId),this.payload={overlayId:message.overlay.geoId,name:message.overlay.name,properties:message.overlay.properties,messageId:transactionId}}function MapOverlayRemoveMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.removeOverlay,transactionId),this.payload=[],emp.util.each(message.overlays,function(overlay){this.payload.push({overlayId:overlay.geoId,parentId:message.parentId,messageId:transactionId})}.bind(this))}function MapOverlayShowMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.showOverlay,transactionId),this.payload=[],emp.util.each(message.overlays,function(overlay){this.payload.push({overlayId:overlay,parentId:message.parent||emp.constant.parentIds.ALL_PARENTS,recurse:message.recurse||!1,messageId:transactionId})}.bind(this))}function MapOverlayHideMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.hideOverlay,transactionId),this.payload=[],emp.util.each(message.overlays,function(overlay){this.payload.push({overlayId:overlay,parentId:message.parent||emp.constant.parentIds.ALL_PARENTS,recurse:message.recurse||!1,messageId:transactionId})}.bind(this))}function ConfigMessage(message,callInfo,transactionId){message=message||{},emp3.api.Message.call(this,emp3.api.enums.channel.config,transactionId);var payload={};switch(callInfo.method){case"Map.setMidDistanceThreshold":payload.midDistanceThreshold=message.midDistanceThreshold;break;case"Map.setFarDistanceThreshold":payload.farDistanceThreshold=message.farDistanceThreshold;break;case"Map.setIconSize":payload.iconSize=message.iconSize;break;case"Map.setMilStdLabels":payload.milStdLabels=message.milStdLabels;break;case"Map.setSelectionStyle":payload.selectionScale=message.scale,payload.selectionColor=message.color;break;case"Map.setFreehandStyle":payload.freehandStrokeStyle=message.freehandStrokeStyle;break;case"Map.setBackgroundBrightness":payload.brightness=message.brightness}payload.messageId=transactionId,this.payload=payload}function FreehandStartMessage(message,callInfo,transactionId){message=message||{},emp3.api.Message.call(this,emp3.api.enums.channel.freehandDrawStart,transactionId),this.payload={messageId:transactionId,strokeStyle:message.strokeStyle}}function FreehandStopMessage(message,callInfo,transactionId){emp3.api.Message.call(this,emp3.api.enums.channel.freehandDrawExit,transactionId),this.payload={messageId:transactionId}}function PlotFeatureTransactionCompleteBroker(){}function CreateUnplotFeatureTransactionCompleteBroker(){}function HandleMapGetBroker(){}function processSuccessCallbacks(args,callbacks){try{callbacks.onSuccess(args)}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}function processErrorCallbacks(args,callbacks){try{callbacks.onError(args)}catch(e){console.error("onError function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}function getOverlaysFromTransactionComplete(transactionOverlaySuccess,map){var overlay,childOverlays,i,overlays=[],len=transactionOverlaySuccess.length;for(i=0;i<len;i+=1)overlay=new emp3.api.Overlay({geoId:transactionOverlaySuccess[i].overlayId,name:transactionOverlaySuccess[i].name,properties:transactionOverlaySuccess[i].properties}),overlay.visible=transactionOverlaySuccess[i].visible,overlay.parentId=transactionOverlaySuccess[i].parentId,overlays.push(overlay),overlay.map=map,transactionOverlaySuccess[i].children&&(childOverlays=getOverlaysFromTransactionComplete(transactionOverlaySuccess[i].children,map)),void 0!==childOverlays&&null!==childOverlays&&(overlays=overlays.concat(childOverlays),childOverlays=null);return overlays}function OverlayTransactionCompleteBroker(){}function CreateOverlayTransactionCompleteBroker(){}function RemoveOverlayTransactionCompleteBroker(){}function HandleFeaturePlotUrlBroker(){}!function(global){function recursiveCompare(A,B){if(A===B)return!0;if("object"==typeof A&&"object"==typeof B){if(Array.isArray(A)!=Array.isArray(B))return!1;if(Array.isArray(A)){if(A.length!=B.length)return!1;for(var i=0;i<A.length;i++)if(!recursiveCompare(A[i],B[i]))return!1}else{for(var key in A)if(void 0===B[key]&&void 0!==A[key])return!1;for(var key in B)if(void 0===A[key]&&void 0!==B[key])return!1;for(var key in A)if(!recursiveCompare(A[key],B[key]))return!1}return!0}return!1}function parseURI(url){var m=String(url).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return m?{href:m[0]||"",protocol:m[1]||"",authority:m[2]||"",host:m[3]||"",hostname:m[4]||"",port:m[5]||"",pathname:m[6]||"",search:m[7]||"",hash:m[8]||""}:null}function resolveUrl(base,href){function removeDotSegments(input){var output=[];return input.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(p){"/.."===p?output.pop():output.push(p)}),output.join("").replace(/^\//,"/"===input.charAt(0)?"/":"")}return href=parseURI(href||""),base=parseURI(base||""),href&&base?(href.protocol||base.protocol)+(href.protocol||href.authority?href.authority:base.authority)+removeDotSegments(href.protocol||href.authority||"/"===href.pathname.charAt(0)?href.pathname:href.pathname?(base.authority&&!base.pathname?"/":"")+base.pathname.slice(0,base.pathname.lastIndexOf("/")+1)+href.pathname:base.pathname)+(href.protocol||href.authority||href.pathname?href.search:href.search||base.search)+href.hash:null}function normSchema(schema,baseUri){if(void 0==baseUri?baseUri=schema.id:"string"==typeof schema.id&&(baseUri=resolveUrl(baseUri,schema.id),schema.id=baseUri),"object"==typeof schema)if(Array.isArray(schema))for(var i=0;i<schema.length;i++)normSchema(schema[i],baseUri);else if("string"==typeof schema.$ref)schema.$ref=resolveUrl(baseUri,schema.$ref);else for(var key in schema)"enum"!=key&&normSchema(schema[key],baseUri)}function ValidationError(code,message,dataPath,schemaPath,subErrors){if(void 0==code)throw new Error("No code supplied for error: "+message);this.code=code,this.message=message,this.dataPath=dataPath?dataPath:"",this.schemaPath=schemaPath?schemaPath:"",this.subErrors=subErrors?subErrors:null}function searchForTrustedSchemas(map,schema,url){if("string"==typeof schema.id&&schema.id.substring(0,url.length)==url){var remainder=schema.id.substring(url.length);(url.length>0&&"/"==url.charAt(url.length-1)||"#"==remainder.charAt(0)||"?"==remainder.charAt(0))&&void 0==map[schema.id]&&(map[schema.id]=schema)}if("object"==typeof schema)for(var key in schema)"enum"!=key&&"object"==typeof schema[key]&&searchForTrustedSchemas(map,schema[key],url);return map}var ValidatorContext=function(parent,collectMultiple){this.missing=[],this.schemas=parent?Object.create(parent.schemas):{},this.collectMultiple=collectMultiple,this.errors=[],this.handleError=collectMultiple?this.collectError:this.returnError};ValidatorContext.prototype.returnError=function(error){return error},ValidatorContext.prototype.collectError=function(error){return error&&this.errors.push(error),null},ValidatorContext.prototype.prefixErrors=function(startIndex,dataPath,schemaPath){for(var i=startIndex;i<this.errors.length;i++)this.errors[i]=this.errors[i].prefixWith(dataPath,schemaPath);return this},ValidatorContext.prototype.getSchema=function(url){if(void 0!=this.schemas[url]){var schema=this.schemas[url];return schema}var baseUrl=url,fragment="";if(url.indexOf("#")!=-1&&(fragment=url.substring(url.indexOf("#")+1),baseUrl=url.substring(0,url.indexOf("#"))),void 0!=this.schemas[baseUrl]){var schema=this.schemas[baseUrl],pointerPath=decodeURIComponent(fragment);if(""==pointerPath)return schema;if("/"!=pointerPath.charAt(0))return;for(var parts=pointerPath.split("/").slice(1),i=0;i<parts.length;i++){var component=parts[i].replace("~1","/").replace("~0","~");if(void 0==schema[component]){schema=void 0;break}schema=schema[component]}if(void 0!=schema)return schema}void 0==this.missing[baseUrl]&&(this.missing.push(baseUrl),this.missing[baseUrl]=baseUrl)},ValidatorContext.prototype.addSchema=function(url,schema){var map={};map[url]=schema,normSchema(schema,url),searchForTrustedSchemas(map,schema,url);for(var key in map)this.schemas[key]=map[key];return map},ValidatorContext.prototype.validateAll=function(data,schema,dataPathParts,schemaPathParts){if(void 0!=schema.$ref&&(schema=this.getSchema(schema.$ref),!schema))return null;var errorCount=this.errors.length,error=this.validateBasic(data,schema)||this.validateNumeric(data,schema)||this.validateString(data,schema)||this.validateArray(data,schema)||this.validateObject(data,schema)||this.validateCombinations(data,schema)||null;if(error||errorCount!=this.errors.length)for(;dataPathParts&&dataPathParts.length||schemaPathParts&&schemaPathParts.length;){var dataPart=dataPathParts&&dataPathParts.length?""+dataPathParts.pop():null,schemaPart=schemaPathParts&&schemaPathParts.length?""+schemaPathParts.pop():null;error&&(error=error.prefixWith(dataPart,schemaPart)),this.prefixErrors(errorCount,dataPart,schemaPart)}return this.handleError(error)},ValidatorContext.prototype.validateBasic=function(data,schema){var error;return(error=this.validateType(data,schema))?error.prefixWith(null,"type"):(error=this.validateEnum(data,schema))?error.prefixWith(null,"type"):null},ValidatorContext.prototype.validateType=function(data,schema){if(void 0==schema.type)return null;var dataType=typeof data;null==data?dataType="null":Array.isArray(data)&&(dataType="array");var allowedTypes=schema.type;"object"!=typeof allowedTypes&&(allowedTypes=[allowedTypes]);for(var i=0;i<allowedTypes.length;i++){var type=allowedTypes[i];if(type==dataType||"integer"==type&&"number"==dataType&&data%1==0)return null}return new ValidationError(ErrorCodes.INVALID_TYPE,"invalid data type: "+dataType)},ValidatorContext.prototype.validateEnum=function(data,schema){if(void 0==schema.enum)return null;for(var i=0;i<schema.enum.length;i++){var enumVal=schema.enum[i];if(recursiveCompare(data,enumVal))return null}return new ValidationError(ErrorCodes.ENUM_MISMATCH,"No enum match for: "+JSON.stringify(data))},ValidatorContext.prototype.validateNumeric=function(data,schema){return this.validateMultipleOf(data,schema)||this.validateMinMax(data,schema)||null},ValidatorContext.prototype.validateMultipleOf=function(data,schema){var multipleOf=schema.multipleOf||schema.divisibleBy;return void 0==multipleOf?null:"number"==typeof data&&data%multipleOf!=0?new ValidationError(ErrorCodes.NUMBER_MULTIPLE_OF,"Value "+data+" is not a multiple of "+multipleOf):null},ValidatorContext.prototype.validateMinMax=function(data,schema){if("number"!=typeof data)return null;if(void 0!=schema.minimum){if(data<schema.minimum)return new ValidationError(ErrorCodes.NUMBER_MINIMUM,"Value "+data+" is less than minimum "+schema.minimum).prefixWith(null,"minimum");if(schema.exclusiveMinimum&&data==schema.minimum)return new ValidationError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE,"Value "+data+" is equal to exclusive minimum "+schema.minimum).prefixWith(null,"exclusiveMinimum")}if(void 0!=schema.maximum){if(data>schema.maximum)return new ValidationError(ErrorCodes.NUMBER_MAXIMUM,"Value "+data+" is greater than maximum "+schema.maximum).prefixWith(null,"maximum");if(schema.exclusiveMaximum&&data==schema.maximum)return new ValidationError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE,"Value "+data+" is equal to exclusive maximum "+schema.maximum).prefixWith(null,"exclusiveMaximum")}return null},ValidatorContext.prototype.validateString=function(data,schema){return this.validateStringLength(data,schema)||this.validateStringPattern(data,schema)||null},ValidatorContext.prototype.validateStringLength=function(data,schema){return"string"!=typeof data?null:void 0!=schema.minLength&&data.length<schema.minLength?new ValidationError(ErrorCodes.STRING_LENGTH_SHORT,"String is too short ("+data.length+" chars), minimum "+schema.minLength).prefixWith(null,"minLength"):void 0!=schema.maxLength&&data.length>schema.maxLength?new ValidationError(ErrorCodes.STRING_LENGTH_LONG,"String is too long ("+data.length+" chars), maximum "+schema.maxLength).prefixWith(null,"maxLength"):null},ValidatorContext.prototype.validateStringPattern=function(data,schema){if("string"!=typeof data||void 0==schema.pattern)return null;var regexp=new RegExp(schema.pattern);return regexp.test(data)?null:new ValidationError(ErrorCodes.STRING_PATTERN,"String does not match pattern").prefixWith(null,"pattern")},ValidatorContext.prototype.validateArray=function(data,schema){return Array.isArray(data)?this.validateArrayLength(data,schema)||this.validateArrayUniqueItems(data,schema)||this.validateArrayItems(data,schema)||null:null},ValidatorContext.prototype.validateArrayLength=function(data,schema){if(void 0!=schema.minItems&&data.length<schema.minItems){var error=new ValidationError(ErrorCodes.ARRAY_LENGTH_SHORT,"Array is too short ("+data.length+"), minimum "+schema.minItems).prefixWith(null,"minItems");if(this.handleError(error))return error}if(void 0!=schema.maxItems&&data.length>schema.maxItems){var error=new ValidationError(ErrorCodes.ARRAY_LENGTH_LONG,"Array is too long ("+data.length+" chars), maximum "+schema.maxItems).prefixWith(null,"maxItems");if(this.handleError(error))return error}return null},ValidatorContext.prototype.validateArrayUniqueItems=function(data,schema){if(schema.uniqueItems)for(var i=0;i<data.length;i++)for(var j=i+1;j<data.length;j++)if(recursiveCompare(data[i],data[j])){var error=new ValidationError(ErrorCodes.ARRAY_UNIQUE,"Array items are not unique (indices "+i+" and "+j+")").prefixWith(null,"uniqueItems");if(this.handleError(error))return error}return null},ValidatorContext.prototype.validateArrayItems=function(data,schema){if(void 0==schema.items)return null;var error;if(Array.isArray(schema.items)){for(var i=0;i<data.length;i++)if(i<schema.items.length){if(error=this.validateAll(data[i],schema.items[i],[i],["items",i]))return error}else if(void 0!=schema.additionalItems)if("boolean"==typeof schema.additionalItems){if(!schema.additionalItems&&(error=new ValidationError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS,"Additional items not allowed").prefixWith(""+i,"additionalItems"),this.handleError(error)))return error}else if(error=this.validateAll(data[i],schema.additionalItems,[i],["additionalItems"]))return error}else for(var i=0;i<data.length;i++)if(error=this.validateAll(data[i],schema.items,[i],["items"]))return error;return null},ValidatorContext.prototype.validateObject=function(data,schema){return"object"!=typeof data||null==data||Array.isArray(data)?null:this.validateObjectMinMaxProperties(data,schema)||this.validateObjectRequiredProperties(data,schema)||this.validateObjectProperties(data,schema)||this.validateObjectDependencies(data,schema)||null},ValidatorContext.prototype.validateObjectMinMaxProperties=function(data,schema){var keys=Object.keys(data);if(void 0!=schema.minProperties&&keys.length<schema.minProperties){var error=new ValidationError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM,"Too few properties defined ("+keys.length+"), minimum "+schema.minProperties).prefixWith(null,"minProperties");if(this.handleError(error))return error}if(void 0!=schema.maxProperties&&keys.length>schema.maxProperties){var error=new ValidationError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM,"Too many properties defined ("+keys.length+"), maximum "+schema.maxProperties).prefixWith(null,"maxProperties");if(this.handleError(error))return error}return null},ValidatorContext.prototype.validateObjectRequiredProperties=function(data,schema){if(void 0!=schema.required)for(var i=0;i<schema.required.length;i++){var key=schema.required[i];if(void 0===data[key]){var error=new ValidationError(ErrorCodes.OBJECT_REQUIRED,"Missing required property: "+key).prefixWith(null,""+i).prefixWith(null,"required");if(this.handleError(error))return error}}return null},ValidatorContext.prototype.validateObjectProperties=function(data,schema){var error;for(var key in data){var foundMatch=!1;if(void 0!=schema.properties&&void 0!=schema.properties[key]&&(foundMatch=!0,error=this.validateAll(data[key],schema.properties[key],[key],["properties",key])))return error;if(void 0!=schema.patternProperties)for(var patternKey in schema.patternProperties){var regexp=new RegExp(patternKey);if(regexp.test(key)&&(foundMatch=!0,error=this.validateAll(data[key],schema.patternProperties[patternKey],[key],["patternProperties",patternKey])))return error}if(!foundMatch&&void 0!=schema.additionalProperties)if("boolean"==typeof schema.additionalProperties){if(!schema.additionalProperties&&(error=new ValidationError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES,"Additional properties not allowed").prefixWith(key,"additionalProperties"),this.handleError(error)))return error}else if(error=this.validateAll(data[key],schema.additionalProperties,[key],["additionalProperties"]))return error}return null},ValidatorContext.prototype.validateObjectDependencies=function(data,schema){var error;if(void 0!=schema.dependencies)for(var depKey in schema.dependencies)if(void 0!==data[depKey]){var dep=schema.dependencies[depKey];if("string"==typeof dep){if(void 0===data[dep]&&(error=new ValidationError(ErrorCodes.OBJECT_DEPENDENCY_KEY,"Dependency failed - key must exist: "+dep).prefixWith(null,depKey).prefixWith(null,"dependencies"),this.handleError(error)))return error}else if(Array.isArray(dep))for(var i=0;i<dep.length;i++){var requiredKey=dep[i];if(void 0===data[requiredKey]&&(error=new ValidationError(ErrorCodes.OBJECT_DEPENDENCY_KEY,"Dependency failed - key must exist: "+requiredKey).prefixWith(null,""+i).prefixWith(null,depKey).prefixWith(null,"dependencies"),this.handleError(error)))return error}else if(error=this.validateAll(data,dep,[],["dependencies",depKey]))return error}return null},ValidatorContext.prototype.validateCombinations=function(data,schema){return this.validateAllOf(data,schema)||this.validateAnyOf(data,schema)||this.validateOneOf(data,schema)||this.validateNot(data,schema)||null},ValidatorContext.prototype.validateAllOf=function(data,schema){if(void 0==schema.allOf)return null;for(var error,i=0;i<schema.allOf.length;i++){var subSchema=schema.allOf[i];if(error=this.validateAll(data,subSchema,[],["allOf",i]))return error}return null},ValidatorContext.prototype.validateAnyOf=function(data,schema){if(void 0==schema.anyOf)return null;for(var errors=[],startErrorCount=this.errors.length,i=0;i<schema.anyOf.length;i++){var subSchema=schema.anyOf[i],errorCount=this.errors.length,error=this.validateAll(data,subSchema,[],["anyOf",i]);if(null==error&&errorCount==this.errors.length)return this.errors=this.errors.slice(0,startErrorCount),null;error&&errors.push(error.prefixWith(null,""+i).prefixWith(null,"anyOf"))}return errors=errors.concat(this.errors.slice(startErrorCount)),this.errors=this.errors.slice(0,startErrorCount),new ValidationError(ErrorCodes.ANY_OF_MISSING,'Data does not match any schemas from "anyOf"',"","/anyOf",errors)},ValidatorContext.prototype.validateOneOf=function(data,schema){if(void 0==schema.oneOf)return null;for(var validIndex=null,errors=[],startErrorCount=this.errors.length,i=0;i<schema.oneOf.length;i++){var subSchema=schema.oneOf[i],errorCount=this.errors.length,error=this.validateAll(data,subSchema,[],["oneOf",i]);if(null==error&&errorCount==this.errors.length){if(null!=validIndex)return this.errors=this.errors.slice(0,startErrorCount),new ValidationError(ErrorCodes.ONE_OF_MULTIPLE,'Data is valid against more than one schema from "oneOf": indices '+validIndex+" and "+i,"","/oneOf");validIndex=i}else error&&errors.push(error.prefixWith(null,""+i).prefixWith(null,"oneOf"))}return null==validIndex?(errors=errors.concat(this.errors.slice(startErrorCount)),this.errors=this.errors.slice(0,startErrorCount),new ValidationError(ErrorCodes.ONE_OF_MISSING,'Data does not match any schemas from "oneOf"',"","/oneOf",errors)):(this.errors=this.errors.slice(0,startErrorCount),null)},ValidatorContext.prototype.validateNot=function(data,schema){if(void 0==schema.not)return null;var oldErrorCount=this.errors.length,error=this.validateAll(data,schema.not),notErrors=this.errors.slice(oldErrorCount);return this.errors=this.errors.slice(0,oldErrorCount),null==error&&0==notErrors.length?new ValidationError(ErrorCodes.NOT_PASSED,'Data matches schema from "not"',"","/not"):null};var ErrorCodes={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403};ValidationError.prototype={prefixWith:function(dataPrefix,schemaPrefix){if(null!=dataPrefix&&(dataPrefix=dataPrefix.replace("~","~0").replace("/","~1"),this.dataPath="/"+dataPrefix+this.dataPath),null!=schemaPrefix&&(schemaPrefix=schemaPrefix.replace("~","~0").replace("/","~1"),this.schemaPath="/"+schemaPrefix+this.schemaPath),null!=this.subErrors)for(var i=0;i<this.subErrors.length;i++)this.subErrors[i].prefixWith(dataPrefix,schemaPrefix);return this}};var globalContext=new ValidatorContext,publicApi={validate:function(data,schema){var context=new ValidatorContext(globalContext);"string"==typeof schema&&(schema={$ref:schema});var error=(context.addSchema("",schema),context.validateAll(data,schema));return this.error=error,this.missing=context.missing,this.valid=null==error,this.valid},validateResult:function(){var result={};return this.validate.apply(result,arguments),result},validateMultiple:function(data,schema){var context=new ValidatorContext(globalContext,(!0));"string"==typeof schema&&(schema={$ref:schema}),context.addSchema("",schema),context.validateAll(data,schema);var result={};return result.errors=context.errors,result.missing=context.missing,result.valid=0==result.errors.length,result},addSchema:function(url,schema){return globalContext.addSchema(url,schema)},getSchema:function(url){return globalContext.getSchema(url)},missing:[],error:null,normSchema:normSchema,resolveUrl:resolveUrl,errorCodes:ErrorCodes};global.tv4=publicApi}("undefined"!=typeof module&&module.exports?exports:this);var emp=window.emp||{};emp.version="3.0.0 Beta 1",emp.validate=!0,emp.core={sources:{CONDUCTOR:"conductor",CONFIG:"config",ERROR:"error",EVENTING:"eventing",INTENT:"intent",MAP:"map",QUEUE:"queue",STORAGE:"storage",LIBRARY:"library",HOST:"EMP",EMP:"EMP",CORE:"core"}},emp.settings=emp.settings||{iconSize:1.2,labelSize:.9,iconSizeOption:24};var emp=window.emp||{};emp.util=emp.util||{},emp.util.isEmptyString=function(str){var isEmpty=!1;return void 0!==str&&null!==str&&"string"==typeof str&&""!==str&&"undefined"!==str&&"null"!==str&&str.replace(/\s/g,"").length||(isEmpty=!0),isEmpty},emp.util.getBooleanValue=function(value,bDefault){var ret;if("boolean"!=typeof bDefault)throw"Invalid boolean default value.";return"boolean"==typeof value?ret=value:"string"==typeof value?(value=value.toLowerCase(),ret="true"===value||"false"!==value&&bDefault):ret=bDefault,ret},emp.util.isAirspaceSymbol=function(sSymbolCode){return sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_CAKE||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_ROUTE||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_CYLINDER||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_ORBIT||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_POLYGON||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_RADARC||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_POLYARC||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_TRACK||sSymbolCode===emp.constant.airspaceSymbolCode.SHAPE3D_CURTAIN;
},emp.util.getParameterByName=function(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},emp.util.validateEnvironment=function(environment){switch(environment){case"starfish":environment=emp.environment.starfish;break;case"owf":environment=emp.environment.owf;break;case"iwc":environment=emp.environment.iwc;break;default:environment=emp.environment.browser}return environment},emp.util.convertColorToHexColor=function(color){var red,green,blue,alpha;return red=color.red.toString(16),1===red.length&&(red="0"+red),green=color.green.toString(16),1===green.length&&(green="0"+green),blue=color.blue.toString(16),1===blue.length&&(blue="0"+blue),alpha=Math.round(255*color.alpha).toString(16),1===alpha.length&&(alpha="0"+alpha),(alpha+red+green+blue).toUpperCase()},emp.util.convertHexToColor=function(hex){var alpha,red,blue,green,color={};return 8===hex.length?(alpha=hex.substr(0,2),red=hex.substr(2,2),green=hex.substr(4,2),blue=hex.substr(6,2),color.red=parseInt(red,16),color.blue=parseInt(blue,16),color.green=parseInt(green,16),color.alpha=parseInt(alpha,16)/255,color):void 0},emp.util.parseXML=function(xmlStr){return(new window.DOMParser).parseFromString(xmlStr,"text/xml")},emp.util.each=function(collection,func){if(collection)if((collection instanceof HTMLCollection||collection instanceof NodeList)&&(collection=Array.prototype.slice.call(collection)),Array.isArray(collection))Array.prototype.forEach.call(collection,function(el,i){func(el,i)});else if(collection instanceof NamedNodeMap){var i,len=collection.length;for(i=0;i<len;i++)func(collection[i],i)}},emp.util.enums={},emp.util.enums.DOMNodeTypes={Element:1,Attr:2,Text:3,CDATASection:4,EntityReference:5,Entity:6,ProcessingInstruction:7,Comment:8,Document:9,DocumentType:10,DocumentFragment:11,Notation:12};var emp=window.emp||{};emp.util=emp.util||{},void 0===emp.util.config&&(emp.util.config=function(){var empV3Config,publicInterface={setConfigObject:function(){empV3Config={},empV3Config.hasOwnProperty("urlProxy")||(empV3Config.urlProxy=emp3.api.global.configuration.urlProxy)},getConfigObject:function(){return void 0===empV3Config&&this.setConfigObject(),this.setAutoSelect(!0),empV3Config},getConfigParameter:function(sParameter){var oConfigObject=this.getConfigObject();if(oConfigObject.hasOwnProperty(sParameter))return oConfigObject[sParameter]},getProxyUrl:function(){return this.getConfigParameter("urlProxy")},getUseProxySetting:function(){return!1},getAutoSelect:function(){return this.getConfigParameter("autoSelect")},setAutoSelect:function(flag){empV3Config.hasOwnProperty("autoSelect")&&"boolean"==typeof empV3Config.autoSelect?empV3Config.autoSelect=empV3Config.autoSelect:empV3Config.autoSelect=flag},setCurrentEngineConfiguration:function(engineConfig){empV3Config.previousMapEngineId=empV3Config.currentMapEngineId,empV3Config.currentMapEngineId=engineConfig.mapEngineId,empV3Config.currentEngineConfiguration=engineConfig},getCurrentEngineConfiguration:function(){return this.getConfigParameter("currentEngineConfiguration")},getCurrentMapEngineId:function(){return this.getConfigParameter("currentMapEngineId")},getPreviousMapEngineId:function(){return this.getConfigParameter("previousMapEngineId")}};return publicInterface}());var emp=window.emp||{};emp.constant=emp.constant||{},emp.constant.parentIds={ALL_PARENTS:"ALL_PARENTS",MAP_ROOT:"MAP_ROOT",MAP_LAYER_PARENT:"MAP_LAYER_PARENT"},emp.constant.mapEngineId={LEAFLET:"leafletMapEngine",CESIUM:"cesiumMapEngine",WORLD_WIND:"worldWindMapEngine"},emp.constant.featureFormatType={KML:"kml",GEOJSON:"geojson",WKT:"wkt",WMS:"wms",WFS:"wfs",IMAGE:"image",MILSTD:"milstd",AIRSPACE:"airspace",GEO_ACM:"airspace",GEO_CIRCLE:"circle",GEO_ELLIPSE:"ellipse",GEO_MIL_SYMBOL:"milstd",GEO_PATH:"path",GEO_POINT:"point",GEO_POLYGON:"polygon",GEO_RECTANGLE:"rectangle",GEO_SQUARE:"square",GEO_TEXT:"text"},emp.constant.featureMilStdVersionType={MILSTD_2525B:"2525B",MILSTD_2525C:"2525C",convertToNumeric:function(sVersion){var iVersion=0;return emp.helpers.isEmptyString(sVersion)?iVersion=0:sVersion.toUpperCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C&&(iVersion=1),iVersion}},emp.constant.featureAltitudeModeType={CLAMP_TO_GROUND:"clampToGround",RELATIVE_TO_GROUND:"relativeToGround",ABSOLUTE:"absolute"},emp.constant.orbitTurnType={CENTER:"center",RIGHT:"right",LEFT:"left"},emp.constant.primitives={BBS_CIRCLE:"BBS_CIRCLE",BBS_ELLIPSE:"BBS_ELLIPSE",BBS_PATH:"BBS_PATH",BBS_POINT:"BBS_POINT",BBS_POLYGON:"BBS_POLYGON",BBS_RECTANGLE:"BBS_RECTANGLE",BBS_SQUARE:"BBS_SQUARE",BBS_TEXT:"BBS_TEXT"},emp.constant.airspaceSymbolCode={SHAPE3D_CAKE:"CAKE-----------",SHAPE3D_ROUTE:"ROUTE----------",SHAPE3D_CYLINDER:"CYLINDER-------",SHAPE3D_ORBIT:"ORBIT----------",SHAPE3D_POLYGON:"POLYGON--------",SHAPE3D_RADARC:"RADARC---------",SHAPE3D_POLYARC:"POLYARC--------",SHAPE3D_TRACK:"TRACK----------",SHAPE3D_CURTAIN:"CURTAIN--------"},emp.constant.AOIType={POINT_RADIUS:"point-radius",LINE:"line",POLYGON:"polygon",BBOX:"bbox"},emp.constant.OutlineStyleType={DOT:"dot",DASH:"dash",DASH_DOT:"dashdot",LONG_DASH:"longdash",LONG_DASH_DOT:"longdashdot",SOLID:"solid"},function(){function resizeListener(e){var win=e.target||e.srcElement;win.__resizeRAF__&&cancelFrame(win.__resizeRAF__),win.__resizeRAF__=requestFrame(function(){var trigger=win.__resizeTrigger__;trigger.__resizeListeners__.forEach(function(fn){fn.call(trigger,e)})})}function objectLoad(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",resizeListener)}var attachEvent=document.attachEvent,isIE=navigator.userAgent.match(/Trident/),requestFrame=function(){var raf=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(fn){return window.setTimeout(fn,20)};return function(fn){return raf(fn)}}(),cancelFrame=function(){var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(id){return cancel(id)}}();window.addResizeListener=function(element,fn){if(!element.__resizeListeners__)if(element.__resizeListeners__=[],attachEvent)element.__resizeTrigger__=element,element.attachEvent("onresize",resizeListener);else{"static"==getComputedStyle(element).position&&(element.style.position="relative");var obj=element.__resizeTrigger__=document.createElement("object");obj.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),obj.__resizeElement__=element,obj.onload=objectLoad,obj.type="text/html",isIE&&element.appendChild(obj),obj.data="about:blank",isIE||element.appendChild(obj)}element.__resizeListeners__.push(fn)},window.removeResizeListener=function(element,fn){element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn),1),element.__resizeListeners__.length||(attachEvent?element.detachEvent("onresize",resizeListener):(element.__resizeTrigger__.contentDocument.defaultView.removeEventListener("resize",resizeListener),element.__resizeTrigger__=!element.removeChild(element.__resizeTrigger__)))}}(),emp.classLibrary=emp.classLibrary||{},emp.classLibrary.Util={extend:function(dest){var i,j,len,src,sources=Array.prototype.slice.call(arguments,1);for(j=0,len=sources.length;j<len;j++){src=sources[j]||{};for(i in src)src.hasOwnProperty(i)&&(dest[i]=src[i])}return dest},bind:function(fn,obj){var args=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return fn.apply(obj,args||arguments)}},invokeEach:function(obj,method,context){var i,args;if("object"==typeof obj){args=Array.prototype.slice.call(arguments,3);for(i in obj)method.apply(context,[i,obj[i]].concat(args));return!0}return!1},limitExecByInterval:function(fn,time,context){var lock,execOnUnlock;return function wrapperFn(){var args=arguments;return lock?void(execOnUnlock=!0):(lock=!0,setTimeout(function(){lock=!1,execOnUnlock&&(wrapperFn.apply(context,args),execOnUnlock=!1)},time),void fn.apply(context,args))}},falseFn:function(){return!1},formatNum:function(num,digits){var pow=Math.pow(10,digits||5);return Math.round(num*pow)/pow},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},splitWords:function(str){return emp.classLibrary.Util.trim(str).split(/\s+/)},setOptions:function(obj,options){return obj.options=emp.classLibrary.Util.extend({},obj.options,options),obj.options},getParamString:function(obj,existingUrl,uppercase){var params=[];for(var i in obj)params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+"="+encodeURIComponent(obj[i]));return(existingUrl&&existingUrl.indexOf("?")!==-1?"&":"?")+params.join("&")},template:function(str,data){return str.replace(/\{ *([\w_]+) *\}/g,function(str,key){var value=data[key];if(void 0===value)throw new Error("No value provided for variable "+str);return"function"==typeof value&&(value=value(data)),value})},isArray:Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)}},emp.classLibrary.Class=function(){},emp.classLibrary.Class.extend=function(props){var NewClass=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},F=function(){};F.prototype=this.prototype;var proto=new F;proto.constructor=NewClass,NewClass.prototype=proto;for(var i in this)this.hasOwnProperty(i)&&"prototype"!==i&&(NewClass[i]=this[i]);props.statics&&(emp.classLibrary.Util.extend(NewClass,props.statics),delete props.statics),props.includes&&(emp.classLibrary.Util.extend.apply(null,[proto].concat(props.includes)),delete props.includes),props.options&&proto.options&&(props.options=emp.classLibrary.Util.extend({},proto.options,props.options)),emp.classLibrary.Util.extend(proto,props),proto._initHooks=[];var parent=this;return NewClass.__super__=parent.prototype,proto.callInitHooks=function(){if(!this._initHooksCalled){parent.prototype.callInitHooks&&parent.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var i=0,len=proto._initHooks.length;i<len;i++)proto._initHooks[i].call(this)}},NewClass},emp.classLibrary.Class.include=function(props){emp.classLibrary.Util.extend(this.prototype,props)},emp.classLibrary.Class.mergeOptions=function(options){emp.classLibrary.Util.extend(this.prototype.options,options)},emp.classLibrary.Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1),init="function"==typeof fn?fn:function(){this[fn].apply(this,args)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(init)},emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(lat,lon,alt){var latitude,longitude,altitude,oLatLon,oOptions;if(lat instanceof LatLon)latitude=lat._lat,longitude=lat._lon;else{if("number"!=typeof lat||isNaN(lat)){if(emp.util.isEmptyString(lat))throw new Error("Invalid Latitude value: ("+lat+")");latitude=parseFloat(lat)}else latitude=lat;if("number"!=typeof lon||isNaN(lon)){if(emp.util.isEmptyString(lon))throw new Error("Invalid Longitude value: ("+lon+")");longitude=parseFloat(lon)}else longitude=lon}oLatLon=new LatLon(latitude,longitude),"number"!=typeof alt||isNaN(alt)?emp.util.isEmptyString(alt)||(altitude=parseFloat(alt)):altitude=alt,oOptions={oLatLon:oLatLon,altitude:altitude},emp.classLibrary.Util.setOptions(this,oOptions)},getLatitude:function(){return this.options.oLatLon._lat},getLongitude:function(){return this.options.oLatLon._lon},getAltitude:function(){return this.options.altitude},getLatLon:function(){return this.options.oLatLon},distanceTo:function(point,precision){return point instanceof emp.classLibrary.Coordinate?this.options.oLatLon.distanceTo(point.getLatLon(),precision):this.options.oLatLon.distanceTo(point,precision)},bearingTo:function(point){return point instanceof emp.classLibrary.Coordinate?this.options.oLatLon.bearingTo(point.getLatLon()):this.options.oLatLon.bearingTo(point)},finalBearingTo:function(point){return point instanceof emp.classLibrary.Coordinate?this.options.oLatLon.finalBearingTo(point.getLatLon()):this.options.oLatLon.finalBearingTo(point)},midpointTo:function(point){var latLon;return latLon=point instanceof emp.classLibrary.Coordinate?this.options.oLatLon.finalBearingTo(point.getLatLon()):this.options.oLatLon.finalBearingTo(point),new emp.classLibrary.Coordinate(latLon._lat,latLon._lon)},destinationPoint:function(brng,dist){var latLon=this.options.oLatLon.destinationPoint(brng,dist);return new emp.classLibrary.Coordinate(latLon._lat,latLon._lon)},rhumbDistanceTo:function(point){return point instanceof emp.classLibrary.Coordinate?this.options.oLatLon.rhumbDistanceTo(point.getLatLon()):this.options.oLatLon.rhumbDistanceTo(point)},rhumbBearingTo:function(point){return point instanceof emp.classLibrary.Coordinate?this.options.oLatLon.rhumbBearingTo(point.getLatLon()):this.options.oLatLon.rhumbBearingTo(point)},rhumbDestinationPoint:function(brng,dist){var latLon=this.options.oLatLon.rhumbDestinationPoint(brng,dist);return new emp.classLibrary.Coordinate(latLon._lat,latLon._lon)},toString:function(){var sStr="";sStr+=isNaN(this.options.oLatLon._lat)?"-":this.options.oLatLon._lat,sStr+=",",sStr+=isNaN(this.options.oLatLon._lon)?"-":this.options.oLatLon._lon,isNaN(this.options.altitude)||(sStr+=","+this.options.altitude)}};return publicInterface},emp.classLibrary.Coordinate=emp.classLibrary.Class.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(oSW,oNE){var oSouthWest,oNorthEast,options,oLatLngList;if(options={degNorth:void 0,degSouth:void 0,degWest:void 0,degEast:void 0},emp.classLibrary.Util.setOptions(this,options),void 0===oSW)oLatLngList=[];else if(void 0===oNE)if(oSW instanceof emp.classLibrary.MapExtent)oSouthWest=oSW.getSouthWest(),oNorthEast=oSW.getNorthEast(),oLatLngList=oSouthWest&&oNorthEast?[oSouthWest,oNorthEast]:[];else if(oSW instanceof Array)oLatLngList=oSW;else{if(!(oSW instanceof LatLon))throw new Error("Invalid type oSouthWest.");oLatLngList=[oSW]}else oLatLngList=[oSW,oNE];for(var iIndex=0;iIndex<oLatLngList.length;iIndex++)this.addCoordinate(oLatLngList[iIndex])},destroy:function(){},addCoordinate:function(oCoord){var degSE2Coord,degSW2Coord,oCoordinate=oCoord;oCoord instanceof emp.classLibrary.Coordinate&&(oCoordinate=oCoord.getLatLon()),void 0===this.options.degNorth?(this.options.degNorth=oCoordinate._lat,this.options.degSouth=oCoordinate._lat,this.options.degWest=oCoordinate._lon,this.options.degEast=oCoordinate._lon):(oCoordinate._lat>this.options.degNorth?this.options.degNorth=oCoordinate._lat:oCoordinate._lat<this.options.degSouth&&(this.options.degSouth=oCoordinate._lat),degSE2Coord=emp.geoLibrary.GetAzimuth({x:this.options.degEast,y:this.options.degSouth},{x:oCoordinate._lon,y:oCoordinate._lat}),degSE2Coord>0?this.options.degEast=oCoordinate._lon:(degSW2Coord=emp.geoLibrary.GetAzimuth({x:this.options.degWest,y:this.options.degSouth},{x:oCoordinate._lon,y:oCoordinate._lat}),degSW2Coord<0&&(this.options.degWest=oCoordinate._lon)))},getNorth:function(){return this.options.degNorth},getSouth:function(){return this.options.degSouth},getWest:function(){return this.options.degWest},getEast:function(){return this.options.degEast},getCenter:function(){var oSW=new LatLon(this.options.degSouth,this.options.degWest),oNE=new LatLon(this.options.degNorth,this.options.degEast),oCenter=oSW.midpointTo(oNE);return new LatLon(oCenter._lat,oCenter._lon)},getCenterWest:function(){var dCenterLat=(this.options.degNorth+this.options.degSouth)/2;return new LatLon(dCenterLat,this.options.degWest)},getCenterEast:function(){var dCenterLat=(this.options.degNorth+this.options.degSouth)/2;return new LatLon(dCenterLat,this.options.degEast)},getSouthWest:function(){return new LatLon(this.options.degSouth,this.options.degWest)},getNorthEast:function(){return new LatLon(this.options.degNorth,this.options.degEast)},getSouthEast:function(){return new LatLon(this.options.degSouth,this.options.degEast)},getNorthWest:function(){return new LatLon(this.options.degNorth,this.options.degWest)},containsCoordiante:function(oCoordinate){var degSE2Coord,degSW2Coord;return!!this.options.degNorth&&(!(oCoordinate._lat>this.options.degNorth)&&(!(oCoordinate._lat<this.options.degSouth)&&(degSE2Coord=emp.geoLibrary.GetAzimuth({x:this.options.degEast,y:this.options.degSouth},{x:oCoordinate._lon,y:oCoordinate._lat}),!(degSE2Coord>0)&&(degSW2Coord=emp.geoLibrary.GetAzimuth({x:this.options.degWest,y:this.options.degSouth},{x:oCoordinate._lon,y:oCoordinate._lat}),!(degSW2Coord<0)))))},contained:function(oMapExtent){var degSE2Coord,degSW2Coord;return!(!this.options.degNorth||!oMapExtent.getNorth())&&(!(oMapExtent.getNorth()>this.options.degNorth)&&(!(oMapExtent.getSouth()<this.degSouth)&&(degSE2Coord=emp.geoLibrary.GetAzimuth({x:this.options.degEast,y:this.options.degSouth},{x:oMapExtent.getEast(),y:oMapExtent.getNorth()}),!(degSE2Coord>0)&&(degSW2Coord=emp.geoLibrary.GetAzimuth({x:this.options.degWest,y:this.options.degSouth},{x:oMapExtent.getWest(),y:oMapExtent.getNorth()}),!(degSW2Coord<0)))))},intersects:function(oMapExtent){var oSouthWest,oBNorthEast,dBrng,oSouthEast,oBNorthWest;if(!(oMapExtent instanceof emp.classLibrary.MapExtent))throw new Error("Invalid parameters type.");return!(!this.options.degNorth||!oMapExtent.getNorth())&&(!(oMapExtent.getNorth()<this.options.degSouth&&oMapExtent.getSouth()>this.options.degNorth)&&(oSouthWest=this.getSouthWest(),oBNorthEast=oMapExtent.getNorthEast(),dBrng=oSouthWest.bearingTo(oBNorthEast),!(dBrng<0||dBrng>90)&&(oSouthEast=this.getSouthEast(),oBNorthWest=oMapExtent.getNorthWest(),dBrng=oSouthEast.bearingTo(oBNorthWest),!(dBrng<270))))},isEmpty:function(){return void 0===this.options.degNorth||void 0===this.options.degSouth||void 0===this.options.degWest||void 0===this.options.degEast},getCenterWidth:function(){var oCenterWest=this.getCenterWest(),oCenterEast=this.getCenterEast();return oCenterWest.distanceTo(oCenterEast)},setCenterWidth:function(dWidth){var oCenter=this.getCenter(),oNewWestCoord=oCenter.destinationPoint(270,dWidth/2),oNewEastCoord=oCenter.destinationPoint(90,dWidth/2);this.degWest=oNewWestCoord._lon,this.degEast=oNewEastCoord._lon},reset:function(){this.options.degNorth=void 0,this.options.degSouth=void 0,this.options.degWest=void 0,this.options.degEast=void 0}};return publicInterface},emp.classLibrary.MapExtent=emp.classLibrary.Class.extend(emp.classLibrary.privateClass()),emp=emp||{},emp.util=emp.util||{},emp.util.geoJson=function(){var publicInterface={toString:function(oGeoJson){var iIndex,sStr="";if(!oGeoJson.hasOwnProperty("type"))throw new Error("GeoJSON object with no type property.");switch(oGeoJson.type.toLowerCase()){case"point":sStr=oGeoJson.coordinates[0]+","+oGeoJson.coordinates[1],3===oGeoJson.coordinates.length&&(sStr+=","+oGeoJson.coordinates[2]);break;case"linestring":for(iIndex=0;iIndex<oGeoJson.coordinates.length;iIndex++)sStr.length>0&&(sStr+=" "),sStr+=oGeoJson.coordinates[iIndex][0]+","+oGeoJson.coordinates[iIndex][1],3===oGeoJson.coordinates[iIndex].length&&(sStr+=","+oGeoJson.coordinates[iIndex][2]);break;case"polygon":for(iIndex=0;iIndex<oGeoJson.coordinates[0].length;iIndex++)sStr.length>0&&(sStr+=" "),sStr+=oGeoJson.coordinates[0][iIndex][0]+","+oGeoJson.coordinates[0][iIndex][1],3===oGeoJson.coordinates[0][iIndex].length&&(sStr+=","+oGeoJson.coordinates[0][iIndex][2]);break;default:throw new Error("Invalid type for coordinate parsing.")}return sStr},toCoordinate:function(oCoord){var oCoordinates;return oCoordinates=3===oCoord.length?new emp.classLibrary.Coordinate(oCoord[1],oCoord[0],oCoord[2]):new emp.classLibrary.Coordinate(oCoord[1],oCoord[0])},toCoordinateArray:function(oGeoJson){var oCoord,iIndex,oCoordinates=[];if(!oGeoJson.hasOwnProperty("type"))throw new Error("GeoJSON object with no type property.");switch(oGeoJson.type.toLowerCase()){case"point":oGeoJson.coordinates.length>0&&oCoordinates.push(publicInterface.toCoordinate(oGeoJson.coordinates));break;case"linestring":for(iIndex=0;iIndex<oGeoJson.coordinates.length;iIndex++)oCoord=publicInterface.toCoordinate(oGeoJson.coordinates[iIndex]),oCoordinates.push(oCoord);break;case"polygon":for(iIndex=0;iIndex<oGeoJson.coordinates[0].length;iIndex++)oCoord=publicInterface.toCoordinate(oGeoJson.coordinates[0][iIndex]),oCoordinates.push(oCoord);break;case"feature":switch(oGeoJson.geometry.type.toLowerCase()){case"point":oGeoJson.geometry.coordinates.length>0&&oCoordinates.push(publicInterface.toCoordinate(oGeoJson.geometry.coordinates));break;case"linestring":for(iIndex=0;iIndex<oGeoJson.geometry.coordinates.length;iIndex++)oCoord=publicInterface.toCoordinate(oGeoJson.geometry.coordinates[iIndex]),oCoordinates.push(oCoord);break;case"polygon":for(iIndex=0;iIndex<oGeoJson.geometry.coordinates[0].length;iIndex++)oCoord=publicInterface.toCoordinate(oGeoJson.geometry.coordinates[0][iIndex]),oCoordinates.push(oCoord);break;default:throw new Error("Invalid type for coordinate parsing.")}break;default:throw new Error("Invalid type for coordinate parsing.")}return oCoordinates},convertCoordinateToGeoJson:function(oEmpCoordinate){var oGeoJsonCoord=[];return oGeoJsonCoord.push(oEmpCoordinate.getLongitude()),oGeoJsonCoord.push(oEmpCoordinate.getLatitude()),isNaN(oEmpCoordinate.getAltitude())||oGeoJsonCoord.push(oEmpCoordinate.getAltitude()),oGeoJsonCoord},convertCoordinateArrayToGeoJson:function(oGeoJson,oEmpCoordinateArray){var iIndex;switch(oGeoJson.type.toLowerCase()){case"point":oGeoJson.coordinates=publicInterface.convertCoordinateToGeoJson(oEmpCoordinateArray[0]);break;case"linestring":for(oGeoJson.coordinates=[],iIndex=0;iIndex<oEmpCoordinateArray.length;iIndex++)oGeoJson.coordinates.push(publicInterface.convertCoordinateToGeoJson(oEmpCoordinateArray[iIndex]));break;case"polygon":for(oGeoJson.coordinates=[[]],iIndex=0;iIndex<oEmpCoordinateArray.length;iIndex++)oGeoJson.coordinates[0].push(publicInterface.convertCoordinateToGeoJson(oEmpCoordinateArray[iIndex]));break;case"feature":publicInterface.convertCoordinateArrayToGeoJson(oGeoJson.geometry,oEmpCoordinateArray)}}};return publicInterface}(),emp=emp||{},emp.util=emp.util||{},emp.util.kml=function(){var publicInterface={toCoordinateArray:function(sKML){var aCoord,dLng,dLat,dAlt,iIndex,oaCoordList=[],oKmlDoc=emp.util.parseXML(sKML),bIsPolygon=!1,processCoordString=function(sCoordStr){var aStrCoordList;if(!emp.util.isEmptyString(sCoordStr)){for(aStrCoordList=sCoordStr.split(/\s+/g),iIndex=0;iIndex<aStrCoordList.length;iIndex++)aStrCoordList[iIndex].length>0&&(aCoord=aStrCoordList[iIndex].split(","),aCoord.length>1&&(dLng=Number(aCoord[0]),dLat=Number(aCoord[1]),dAlt=void 0,aCoord.length>2&&(dAlt=Number(aCoord[2])),oaCoordList.push(new emp.classLibrary.Coordinate(dLat,dLng,dAlt))));bIsPolygon&&oaCoordList.length>1&&oaCoordList.splice(oaCoordList.length-1,1)}};return emp.util.each(oKmlDoc.getElementsByTagName("Polygon"),function(){bIsPolygon=!0}),emp.util.each(oKmlDoc.getElementsByTagName("coordinates"),function(oDescElem){processCoordString(oDescElem.childNodes[0].nodeValue)}),oaCoordList},toKMLfromCoordinateArray:function(sKML,oaCoordArray){function getXmlAsString(xmlDom){return"undefined"!=typeof window.XMLSerializer?(new window.XMLSerializer).serializeToString(xmlDom):xmlDom.xml}var bIsPolygon=!1,oKmlDoc=emp.util.parseXML(sKML),sCoordStr="";emp.util.each(oKmlDoc.getElementsByTagName("Polygon"),function(){bIsPolygon=!0});for(var iIndex=0;iIndex<oaCoordArray.length;iIndex++)sCoordStr.length>0&&(sCoordStr+=" "),sCoordStr+=oaCoordArray[iIndex].getLongitude()+",",sCoordStr+=oaCoordArray[iIndex].getLatitude(),isNaN(oaCoordArray[iIndex].getAltitude())||(sCoordStr+=","+oaCoordArray[iIndex].getAltitude());bIsPolygon&&(sCoordStr.length>0&&(sCoordStr+=" "),sCoordStr+=oaCoordArray[0].getLongitude()+",",sCoordStr+=oaCoordArray[0].getLatitude(),isNaN(oaCoordArray[0].getAltitude())||(sCoordStr+=","+oaCoordArray[0].getAltitude()));var bDone=!1;return emp.util.each(oKmlDoc.getElementsByTagName("coordinates"),function(oDescElem){bDone||(oDescElem.childNodes[0].nodeValue=sCoordStr,bDone=!0)}),getXmlAsString(oKmlDoc)}};return publicInterface}();var emp=window.emp||{};emp.helpers={},emp.helpers.copyObject=function(oFrom){if(oFrom instanceof Array||"object"==typeof oFrom){var sStr=JSON.stringify(oFrom);return JSON.parse(sStr)}return oFrom},emp.helpers.id={},emp.helpers.id.get={},emp.helpers.id.get.coreId=function(args){var sOverlayId=args.overlayId,sFeatureId=args.featureId||args.id,oStorageEntry=emp.storage.get.byIds({overlayId:sOverlayId,featureId:sFeatureId});if(oStorageEntry)return oStorageEntry.coreId},emp.helpers.id.get.coreParent=function(args){if(void 0!==args&&null!==args&&void 0!==args.coreId&&null!==args.coreId){var oStorageItem=emp.storage.get.id({id:args.coreId});if(oStorageItem)return oStorageItem.coreParent}},emp.helpers.id.get.setId=function(sId){if(void 0!==sId&&null!==sId&&""!==sId)return sId},emp.helpers.id.get.isId=function(sId){return void 0!==sId&&(null!==sId&&""!==sId)},emp.helpers.id.newGUID=function(){var lut=emp.helpers.id.newGUID.lut,d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return lut[255&d0]+lut[d0>>8&255]+lut[d0>>16&255]+lut[d0>>24&255]+"-"+lut[255&d1]+lut[d1>>8&255]+lut[d1>>16&15|64]+lut[d1>>24&255]+"-"+lut[63&d2|128]+lut[d2>>8&255]+lut[d2>>16&255]+lut[d2>>24&255]+"-"+lut[255&d3]+lut[d3>>8&255]+lut[d3>>16&255]+lut[d3>>24&255]},emp.helpers.id.newGUID.lut=function(){for(var lut=[],i=0;i<256;i++)lut[i]=(i<16?"0":"")+i.toString(16);return lut}(),emp.helpers.isAirspaceSymbol=emp.util.isAirspaceSymbol,emp.helpers.coordinatesToString=function(oData){var iIndex,iPolygonIndex,sCoord="";switch(oData.type){case"Point":sCoord=oData.coordinates[0]+","+oData.coordinates[1],oData.coordinates.length>2&&(sCoord+=","+oData.coordinates[2]);break;case"LineString":for(iIndex=0;iIndex<oData.coordinates.length;iIndex++)sCoord.length>0&&(sCoord+=" "),sCoord+=oData.coordinates[iIndex][0]+","+oData.coordinates[iIndex][1],oData.coordinates[iIndex].length>2&&(sCoord+=","+oData.coordinates[iIndex][2]);break;case"Polygon":for(iPolygonIndex=0;iPolygonIndex<oData.coordinates.length;iPolygonIndex++){for(iIndex=0;iIndex<oData.coordinates[iPolygonIndex].length;iIndex++)sCoord.length>0&&(sCoord+=" "),sCoord+=oData.coordinates[iPolygonIndex][iIndex][0]+","+oData.coordinates[iPolygonIndex][iIndex][1],oData.coordinates[iPolygonIndex][iIndex].length>2&&(sCoord+=","+oData.coordinates[iPolygonIndex][iIndex][2]);break}}return sCoord},emp.helpers.isAOI=function(oItem){var bRet=!1,oGeoJson=oItem.data;return oGeoJson.hasOwnProperty("type")&&"feature"===oGeoJson.type.toLowerCase()&&oGeoJson.hasOwnProperty("properties")&&oGeoJson.properties.hasOwnProperty("aoi")&&(bRet=!0),bRet},emp.helpers.canMapEngineEditFeature=function(mapInstanceId,oEmpFeature){var oProperties,bRet=!1,mapInstance=emp.instanceManager.getInstance(mapInstanceId);try{switch(oEmpFeature.getFormat()){case emp.typeLibrary.featureFormatType.KML:(mapInstance.engine.capabilities.formats.KML_BASIC.edit||mapInstance.engine.capabilities.formats.KML_COMPLEX.edit)&&(bRet=!0);break;case emp.typeLibrary.featureFormatType.GEOJSON:oEmpFeature.isAOI()?mapInstance.engine.capabilities.formats.AOI.edit&&(bRet=!0):(mapInstance.engine.capabilities.formats.GEOJSON_BASIC.edit||mapInstance.engine.capabilities.formats.GEOJSON_FULL.edit)&&(bRet=!0);break;case emp.typeLibrary.featureFormatType.WMS:break;case emp.typeLibrary.featureFormatType.IMAGE:mapInstance.engine.capabilities.formats.IMAGE.edit&&(bRet=!0);break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:oProperties=oEmpFeature.getProperties(),oProperties&&oProperties.hasOwnProperty("radius")&&(bRet=!0);break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:oProperties=oEmpFeature.getProperties(),oProperties&&oProperties.hasOwnProperty("semiMajor")&&oProperties.hasOwnProperty("semiMinor")&&(bRet=!0);break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:oProperties=oEmpFeature.getProperties(),oProperties&&oProperties.hasOwnProperty("width")&&oProperties.hasOwnProperty("height")&&(bRet=!0);break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:oProperties=oEmpFeature.getProperties(),oProperties&&oProperties.hasOwnProperty("width")&&(bRet=!0);break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:bRet=!0;break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:if(oProperties=oEmpFeature.getProperties(),oProperties&&oProperties.standard)switch(oProperties.standard.toUpperCase()){case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B:mapInstance.engine.capabilities.formats.MILSTD.version2525B.edit&&(bRet=!0);break;case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C:mapInstance.engine.capabilities.formats.MILSTD.version2525C.edit&&(bRet=!0)}else(mapInstance.engine.capabilities.formats.MILSTD.version2525B.edit||mapInstance.engine.capabilities.formats.MILSTD.version2525C.edit)&&(bRet=!0);if(bRet){if(!oProperties.hasOwnProperty("modifiers"))break;var symbolId=oEmpFeature.getSymbolCode().substring(4,10),oModifiers=oProperties.modifiers;if(!sec.web.renderer.utilities.JavaRendererUtilities.is3dSymbol(oEmpFeature.getSymbolCode(),oModifiers))break;if(!oModifiers.hasOwnProperty("altitudeDepth"))break;if(!(oModifiers.altitudeDepth instanceof Array))break;if(oModifiers.altitudeDepth.length<2)break;if("ALC---"===symbolId||"ALM---"===symbolId||"ALS---"===symbolId||"ALU---"===symbolId||"ALL---"===symbolId){if(!oModifiers.hasOwnProperty("distance"))break;var iCoordinateCnt=oEmpFeature.getData().coordinates.length-1;if(oModifiers.altitudeDepth.length<2*iCoordinateCnt)break;if(oModifiers.distance.length<iCoordinateCnt)break;mapInstance.engine.capabilities.formats.AIRSPACE.edit||(bRet=!1)}else if("ACAC--"===symbolId||"AKPC--"===symbolId||"ACAR--"===symbolId||"AKPR--"===symbolId){if(!oModifiers.hasOwnProperty("distance"))break;if(oModifiers.distance.length<1)break;mapInstance.engine.capabilities.formats.AIRSPACE.edit||(bRet=!1)}else mapInstance.engine.capabilities.formats.AIRSPACE.edit||(bRet=!1)}break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:mapInstance.engine.capabilities.formats.AIRSPACE.edit&&(bRet=!0)}}catch(e){bRet=!0}return bRet},emp.helpers.canMapEnginePlotFeature=function(mapInstanceId,oEmpFeature){var oProperties,bRet=!1,mapInstance=emp.instanceManager.getInstance(mapInstanceId);try{switch(oEmpFeature.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:break;case emp.typeLibrary.types.FEATURE:switch(oEmpFeature.getFormat()){case emp.typeLibrary.featureFormatType.KML:(mapInstance.engine.capabilities.formats.KML_BASIC.plot||mapInstance.engine.capabilities.formats.KML_COMPLEX.plot)&&(bRet=!0);break;case emp.typeLibrary.featureFormatType.GEOJSON:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:oEmpFeature.isAOI()?mapInstance.engine.capabilities.formats.AOI.plot&&(bRet=!0):(mapInstance.engine.capabilities.formats.GEOJSON_BASIC.plot||mapInstance.engine.capabilities.formats.GEOJSON_FULL.plot)&&(bRet=!0);break;case emp.typeLibrary.featureFormatType.IMAGE:mapInstance.engine.capabilities.formats.IMAGE.plot&&(bRet=!0);break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:if(oProperties=oEmpFeature.getProperties(),oProperties&&oProperties.standard)switch(oProperties.standard.toUpperCase()){case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B:
mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot&&(bRet=!0);break;case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C:mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot&&(bRet=!0)}else(mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot||mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot)&&(bRet=!0);if(bRet){if(!oProperties.hasOwnProperty("modifiers"))break;var symbolId=oEmpFeature.getSymbolCode().substring(4,10),oModifiers=oProperties.modifiers;if(!sec.web.renderer.utilities.JavaRendererUtilities.is3dSymbol(oEmpFeature.getSymbolCode(),oModifiers))break;if(!oModifiers.hasOwnProperty("altitudeDepth"))break;if(!(oModifiers.altitudeDepth instanceof Array))break;if(oModifiers.altitudeDepth.length<2)break;if("ALC---"===symbolId||"ALM---"===symbolId||"ALS---"===symbolId||"ALU---"===symbolId||"ALL---"===symbolId){if(!oModifiers.hasOwnProperty("distance"))break;var iCoordinateCnt=oEmpFeature.getData().coordinates.length-1;if(oModifiers.altitudeDepth.length<2*iCoordinateCnt)break;if(oModifiers.distance.length<iCoordinateCnt)break;mapInstance.engine.capabilities.formats.AIRSPACE.plot||(bRet=!1)}else if("ACAC--"===symbolId||"AKPC--"===symbolId||"ACAR--"===symbolId||"AKPR--"===symbolId){if(!oModifiers.hasOwnProperty("distance"))break;if(oModifiers.distance.length<1)break;mapInstance.engine.capabilities.formats.AIRSPACE.plot||(bRet=!1)}else mapInstance.engine.capabilities.formats.AIRSPACE.plot||(bRet=!1)}break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:mapInstance.engine.capabilities.formats.AIRSPACE.plot&&(bRet=!0)}break;case emp.typeLibrary.types.WMS:(mapInstance.engine.capabilities.formats.WMS.version_1_1&&"1.1"===oEmpFeature.getVersion().substr(0,3)||mapInstance.engine.capabilities.formats.WMS.version_1_3&&"1.3"===oEmpFeature.getVersion().substr(0,3))&&(bRet=!0);break;case emp.typeLibrary.types.WMTS:mapInstance.engine.capabilities.formats.WMTS&&(bRet=!0);break;case emp.typeLibrary.types.KML:mapInstance.engine.capabilities.formats.KML_LAYER&&(bRet=!0)}}catch(e){bRet=!0}return bRet},emp.helpers.findIndexOf=function(oArray,fieldName,fieldValue){for(var iIndex=0;iIndex<oArray.length;iIndex++)if(oArray[iIndex].hasOwnProperty(fieldName)&&oArray[iIndex][fieldName]===fieldValue)return iIndex;return-1},emp.helpers.associativeArray={},emp.helpers.associativeArray.size=function(aArray){var key,size=0;for(key in aArray)aArray.hasOwnProperty(key)&&size++;return size},emp.helpers.associativeArray.isEmpty=function(aArray){var key;for(key in aArray)if(aArray.hasOwnProperty(key))return!1;return!0},emp.helpers.associativeArray.getKeys=function(aArray){var key,aKeys=[];for(key in aArray)aArray.hasOwnProperty(key)&&aKeys.push(key);return aKeys},emp.helpers.relToAbs=function(url){if(/^(https?:|file:|ftps?:|mailto:|javascript:|data:image\/[^;]{2,9})/i.test(url))return url;var base_url=location.href.match(/^(.+)\/?(?:#.+)?$/)[0]+"/";if("//"===url.substring(0,2))return location.protocol+url;if("/"===url.charAt(0))return location.protocol+"//"+location.host+url;if("./"===url.substring(0,2))url="."+url;else{if(/^\s*$/.test(url))return"";url="../"+url}for(url=base_url+url;/\/\.\.\//.test(url);)url=url.replace(/[^\/]+\/+\.\.\//i,"");return url=url.replace(/\.$/,"").replace(/\/\./g,"").replace(/"/g,"%22").replace(/'/g,"%27").replace(/</g,"%3C").replace(/>/g,"%3E")},emp.helpers.getReplacementString=function(sStr,fnCallback){var sParam,sValue,iParamEnd,oRegExp,sStrCopy=sStr,bContinue=!0,iParamStart=0;if("function"!=typeof fnCallback)throw new Error("fnCallback parameter is not a function.");if("string"!=typeof sStr)throw new Error("sStr parameter is not a string.");for(;bContinue;)if(iParamStart=sStrCopy.indexOf("${"),iParamStart!==-1)if(iParamEnd=sStrCopy.indexOf("}"),iParamEnd!==-1)if(sParam=sStrCopy.substring(iParamStart+2,iParamEnd),0===sParam.length)oRegExp=new RegExp("\\$\\{\\}","g"),sStrCopy=sStrCopy.replace(oRegExp,"[REPLACEMENT PARAMETER NOT PROVIDED]");else{if(sValue=fnCallback(sParam),"string"!=typeof sValue)throw new Error("replacement value returned for "+sParam+" is not a string.");oRegExp=new RegExp("\\$\\{"+sParam+"\\}","g"),sStrCopy=sStrCopy.replace(oRegExp,sValue)}else bContinue=!1;else bContinue=!1;return sStrCopy},emp.helpers.createCircleCanvas=function(oArgs){function wrapText(context,text,x,y,lineHeight,iMaxWidth){for(var iTextHeight=0,iCharIndex=0,sCurrLine="",oLines=[],sTxt=text.replace("<br/>","\n");sTxt.length>0&&"\n"===sTxt.charAt(0);)sTxt=sTxt.substr(1);for(;sTxt.length>0&&!(iTextHeight>iMaxWidth);)"\n"===sTxt.charAt(iCharIndex)?(oLines.push(sCurrLine),sCurrLine="",iTextHeight+=lineHeight,sTxt=sTxt.substr(1)):(sCurrLine+=sTxt.charAt(iCharIndex),context.measureText(sCurrLine).width>iMaxWidth?(sCurrLine=sCurrLine.substr(0,sCurrLine.length-1),oLines.push(sCurrLine),sCurrLine="",iTextHeight+=lineHeight):sTxt=sTxt.substr(1));if(sCurrLine.length>0&&oLines.push(sCurrLine),oLines.length>1){var yOffset=Math.floor(oLines.length/2*lineHeight);y-=yOffset}for(var iIndex=0;iIndex<oLines.length;iIndex++)context.fillText(oLines[iIndex],x,y),y+=lineHeight}var oCtx,iRadius=oArgs.iRadius,dOpacity=oArgs.dOpacity,sStrokeColor=oArgs.sStrokeColor,sFillColor=oArgs.sFillColor,sGradientColor=oArgs.sGradientColor,sTextColor=oArgs.sTextColor,sText=oArgs.sText,iLineWidth=oArgs.iLineWidth||1,iWidth=2*iRadius,iHeight=iWidth,iX=iRadius,iY=iRadius,oCanvas=document.createElement("canvas");if("number"!=typeof iRadius)throw new Error("Invalid radius.");if("number"!=typeof dOpacity)throw new Error("Invalid opacity.");if(sGradientColor&&!sFillColor)throw new Error("If a gradient color is provided a fill color must be provided.");if(sGradientColor&&"string"!=typeof sGradientColor)throw new Error("Invalid gradient color. It must be a string.");if(sStrokeColor&&"string"!=typeof sStrokeColor)throw new Error("Invalid stroke color. It must be a string.");if(sFillColor&&"string"!=typeof sFillColor)throw new Error("Invalid fill color. It must be a string.");if(sTextColor&&"string"!=typeof sTextColor)throw new Error("Invalid text color. It must be a string.");if(sTextColor||(sTextColor="black"),oCanvas.width=iWidth,oCanvas.height=iHeight,oCtx=oCanvas.getContext("2d"),oCtx.beginPath(),oCtx.globalAlpha=dOpacity,sGradientColor){var oGradient=oCtx.createRadialGradient(iRadius,iRadius,Math.round(.7*iRadius),iRadius,iRadius,iRadius);oGradient.addColorStop(0,sFillColor),oGradient.addColorStop(1,sGradientColor),oCtx.fillStyle=oGradient}else sFillColor&&(oCtx.fillStyle=sFillColor);if(sFillColor&&(oCtx.arc(iX,iY,iRadius,0,2*Math.PI),oCtx.fill()),sStrokeColor&&(oCtx.lineWidth=iLineWidth,oCtx.strokeStyle=sStrokeColor,oCtx.arc(iX,iY,iRadius-iLineWidth,0,2*Math.PI),oCtx.stroke()),"string"==typeof sText&&sText.length>0){oCtx.globalAlpha=1,oCtx.font="12px Arial",oCtx.textAlign="center",oCtx.fillStyle=sTextColor;var lineHeight=12;wrapText(oCtx,sText,iRadius,iRadius+lineHeight/2,lineHeight,iWidth)}return oCanvas},emp.helpers.isUrl=function(s){var regexp=/^(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return regexp.test(s)},emp.helpers.oHiddenSpan=null,emp.helpers.getStringPixelDimensions=function(sText,sFontFamily,sFontSize,sFontWeight){var iWidth=0,iHeight=0;if(null===emp.helpers.oHiddenSpan){var style="position: absolute; visibility: hidden; white-space: nowrap; top: -100px; font-family: "+sFontFamily+"; font-size: "+sFontSize+"; font-weight: "+sFontWeight+";",textMeasuringSpan=document.createElement("span");textMeasuringSpan.id="empTextMeasuringSpan",textMeasuringSpan.setAttribute("style",style),document.body.insertBefore(textMeasuringSpan,null),emp.helpers.oHiddenSpan=document.getElementById("empTextMeasuringSpan")}else emp.helpers.oHiddenSpan.style.fontFamily=sFontFamily,emp.helpers.oHiddenSpan.style.fontSize=sFontSize,emp.helpers.oHiddenSpan.style.fontWeight=sFontWeight;return null!==emp.helpers.oHiddenSpan&&(emp.helpers.oHiddenSpan.innerHTML=sText,iWidth=emp.helpers.oHiddenSpan.width,iHeight=emp.helpers.oHiddenSpan.height),{width:iWidth,height:iHeight}},emp.helpers.getAffiliationColor=function(sSymbolCode){var sColor="000000",sAffiliation=sSymbolCode.charAt(1);switch(sAffiliation.toUpperCase()){case"P":case"U":case"G":case"W":sColor="FFFF00";break;case"F":case"A":case"D":case"M":sColor="00FFFF";break;case"N":case"L":sColor="00FF00";break;case"H":case"S":case"J":case"K":sColor="FF0000"}return sColor},emp.helpers.get3DMilStdAffiliationColor=function(sSymbolCode){var sColor="000000",sAffiliation=sSymbolCode.charAt(1);switch(sAffiliation.toUpperCase()){case"P":case"U":case"G":case"W":sColor="FFFF00";break;case"F":case"A":case"D":case"M":sColor="000000";break;case"N":case"L":sColor="00FF00";break;case"H":case"S":case"J":case"K":sColor="FF0000"}return sColor},emp.helpers.isEmptyString=function(str){var isEmpty=!1;return void 0!==str&&null!==str&&"string"==typeof str&&""!==str&&"undefined"!==str&&"null"!==str&&str.replace(/\s/g,"").length||(isEmpty=!0),isEmpty},emp.helpers.GeoJsonHasAltitude=function(){var coordinateHasAltitude=function(oGeoJsonCoord){var bRet=!1;return Array.isArray(oGeoJsonCoord)&&oGeoJsonCoord.length>2&&(bRet=!0),bRet},coordinateArrayHasAltitude=function(oGeoJsonCoord){var iIndex,bRet=!1;if(Array.isArray(oGeoJsonCoord))for(iIndex=0;iIndex<oGeoJsonCoord.length&&!(bRet=coordinateHasAltitude(oGeoJsonCoord[iIndex]));iIndex++);return bRet},polygonCoordinateHasAltitude=function(oGeoJsonCoord){var iIndex,bRet=!1;if(Array.isArray(oGeoJsonCoord))for(iIndex=0;iIndex<oGeoJsonCoord.length&&!(bRet=coordinateArrayHasAltitude(oGeoJsonCoord[iIndex]));iIndex++);return bRet},multiPolygonCoordinateHasAltitude=function(oGeoJsonCoord){var iIndex,bRet=!1;if(Array.isArray(oGeoJsonCoord))for(iIndex=0;iIndex<oGeoJsonCoord.length&&!(bRet=polygonCoordinateHasAltitude(oGeoJsonCoord[iIndex]));iIndex++);return bRet},publicInterface=function(oGeoJsonData){var iIndex,bRet=!1;if(oGeoJsonData.hasOwnProperty("type"))switch(oGeoJsonData.type.toLowerCase()){case"point":bRet=coordinateHasAltitude(oGeoJsonData.coordinates);break;case"multipoint":case"linestring":bRet=coordinateArrayHasAltitude(oGeoJsonData.coordinates);break;case"multilinestring":case"polygon":bRet=polygonCoordinateHasAltitude(oGeoJsonData.coordinates);break;case"multipolygon":bRet=multiPolygonCoordinateHasAltitude(oGeoJsonData.coordinates);break;case"feature":bRet=emp.helpers.GeoJsonHasAltitude(oGeoJsonData.geometry);break;case"featurecollection":if(Array.isArray(oGeoJsonData.features))for(iIndex=0;iIndex<oGeoJsonData.features.length&&!(bRet=emp.helpers.GeoJsonHasAltitude(oGeoJsonData.features[iIndex]));iIndex++);break;case"geometrycollection":if(Array.isArray(oGeoJsonData.geometries))for(iIndex=0;iIndex<oGeoJsonData.geometries.length&&!(bRet=emp.helpers.GeoJsonHasAltitude(oGeoJsonData.geometries[iIndex]));iIndex++);}else emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"emp.helpers.GeoJsonHasAltitude: GeoJson with no type property. ("+oGeoJsonData+")"});return bRet};return publicInterface}(),emp.helpers.isCompoundGeoJson=function(){var publicInterface=function(oGeoJsonData){var bRet=!1;if(oGeoJsonData.hasOwnProperty("type"))switch(oGeoJsonData.type.toLowerCase()){case"point":case"linestring":case"polygon":break;case"multipoint":case"multilinestring":case"multipolygon":bRet=!0;break;case"feature":bRet=emp.helpers.isCompoundGeoJson(oGeoJsonData.geometry);break;case"featurecollection":Array.isArray(oGeoJsonData.features)&&(bRet=1!==oGeoJsonData.features.length||emp.helpers.isCompoundGeoJson(oGeoJsonData.features[0]));break;case"geometrycollection":Array.isArray(oGeoJsonData.geometries)&&(bRet=1!==oGeoJsonData.geometries.length||emp.helpers.isCompoundGeoJson(oGeoJsonData.geometries[0]))}else emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"emp.helpers.isCompoundGeoJson: GeoJson with no type property. ("+oGeoJsonData+")"});return bRet};return publicInterface}(),emp.helpers.isCompoundKML=function(){var publicInterface=function(sKMLData){var bRet=!1;try{var xmlDoc=emp.util.parseXML(sKMLData),coordNodes=xmlDoc.getElementsByTagName("coordinates");1!==coordNodes.length&&(bRet=!0)}catch(Ex){bRet=!0}return bRet};return publicInterface}();var emp=window.emp||{};emp.utilities=emp.utilities||{},emp.utilities.Hash=function(){var i;for(this.length=0,this.items=[],i=0;i<arguments.length;i+=2)"undefined"!=typeof arguments[i+1]&&(this.items[arguments[i]]=arguments[i+1],this.length+=1);this.removeItem=function(in_key){var tmp_previous;return"undefined"!=typeof this.items[in_key]&&(this.length-=1,tmp_previous=this.items[in_key],delete this.items[in_key]),tmp_previous},this.getItem=function(in_key){return this.items[in_key]},this.setItem=function(in_key,in_value){var tmp_previous;return"undefined"!=typeof in_value&&("undefined"==typeof this.items[in_key]?this.length+=1:tmp_previous=this.items[in_key],this.items[in_key]=in_value),tmp_previous},this.hasItem=function(in_key){return"undefined"!=typeof this.items[in_key]},this.clear=function(){var j;for(j in this.items)this.items.hasOwnProperty(j)&&delete this.items[j];this.length=0}},emp.utilities.getDefaultIcon=function(basePath){var icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==";return emp.helpers.isEmptyString(basePath)&&(basePath="../"),{iconUrl:icon,offset:{x:.5,y:1,xUnits:"fraction",yUnits:"fraction",width:25,height:41}}},emp.utilities.icon=function(){var publicInterface={referencePoint:{TOP_LEFT:"topleft",BOTTOM_LEFT:"bottomleft"},getDefaultIcon:function(basePath){var oDefaultIcon=emp.utilities.getDefaultIcon(basePath),yOffset=oDefaultIcon.offset.y,yUnits=oDefaultIcon.offset.yUnits;return"pixels"===yUnits?yOffset=oDefaultIcon.offset.height-yOffset:"fraction"===yUnits?yOffset=1-yOffset:"insetPixels"===yUnits&&(yOffset=oDefaultIcon.offset.height-yOffset),{iconUrl:oDefaultIcon.iconUrl,offset:{x:oDefaultIcon.offset.x,y:yOffset,xUnits:oDefaultIcon.offset.xUnits,yUnits:oDefaultIcon.offset.yUnits},size:{width:oDefaultIcon.offset.width,height:oDefaultIcon.offset.height}}},getDefaultIconURL:function(basePath){return emp.utilities.getDefaultIcon(basePath)},calculateXOffset:function(iIconWidth,nOffset,sOffsetType){var iOffset=0;switch(sOffsetType.toLowerCase()){case"fraction":iOffset=Math.floor(iIconWidth*nOffset*-1);break;case"pixels":iOffset=nOffset*-1;break;case"insetpixels":iOffset=(iIconWidth-nOffset)*-1}return iOffset},calculateYOffset:function(iIconHeight,nOffset,sOffsetType,cRefPoint){var iOffset=0;if(cRefPoint===emp.utilities.icon.referencePoint.TOP_LEFT)switch(sOffsetType.toLowerCase()){case"fraction":nOffset=1-nOffset;break;case"pixels":nOffset=iIconHeight-nOffset;break;case"insetpixels":nOffset=iIconHeight-nOffset}switch(sOffsetType.toLowerCase()){case"fraction":iOffset=Math.floor(iIconHeight*nOffset*-1);break;case"pixels":iOffset=nOffset*-1;break;case"insetpixels":iOffset=(iIconHeight-nOffset)*-1}return iOffset},getDefaultIconOffset:function(cRefPoint){var oDefaultIcon=emp.utilities.icon.getDefaultIcon("../");return{xOffset:emp.utilities.icon.calculateXOffset(oDefaultIcon.size.width,oDefaultIcon.offset.x,oDefaultIcon.offset.xUnits),yOffset:emp.utilities.icon.calculateYOffset(oDefaultIcon.size.height,oDefaultIcon.offset.y,oDefaultIcon.offset.yUnits,cRefPoint)}}};return publicInterface}(),emp.geoLibrary={METERS_PER_DEG:111319.49079327357,Point:function(x,y){return{x:x,y:y}},metersPerPixel:function(scale){var inchPerMeter=39.3700787,pixelsPerInch=96,step1=scale/pixelsPerInch;return step1/inchPerMeter},ddToMGRS:function(latDD,longDD){var lat,lng,NS="N",EW="E";return latDD<0&&(latDD=Math.abs(latDD),NS="S"),longDD<0&&(longDD=Math.abs(longDD),EW="W"),lat=emp.geoLibrary.ddToDMS(latDD),lng=emp.geoLibrary.ddToDMS(longDD),emp.geoLibrary.dmsToMGRS(lat.deg,lat.minute,lat.sec,lng.deg,lng.minute,lng.sec,NS,EW)},ddToDMS:function(decDeg){var sec,deg=Math.abs(decDeg),DMS={};return DMS.deg=Math.abs(Math.floor(deg)),DMS.minute=Math.floor(60*Math.abs(deg-DMS.deg)),sec=60*(60*(deg-DMS.deg)-DMS.minute),DMS.sec=sec,DMS},deg2rad:function(deg){var conv_factor=2*Math.PI/360;return deg*conv_factor},dmsToMGRS:function(latDegrees,latMinutes,latSeconds,longDegrees,longMinutes,longSeconds,NS,EW){var West,North,East,IEast,INorth,EastStr,NorthStr,Long,K,L,SINK,COSK,TANK,TANK2,COSK2,COSK3,K3,K4,Merid,MeridWest,L0,J3,J4,J5,J6,M,Temp,V,R,H2,P,P2,P4,J7,J8,J9,GR100km,GRremainder,LongZone,GR,Letters,Pos,LatZone,N100km,E100km,Deg2Rad=Math.PI/180,Area="UTM2",F0=.9996,A1=6378137*F0,B1=6356752.3142*F0,K0=0,N0=0,E0=5e5,N1=(A1-B1)/(A1+B1),N2=N1*N1,N3=N2*N1,E2=(A1*A1-B1*B1)/(A1*A1),Deg=latDegrees,Min=latMinutes,Sec=latSeconds,Lat=Math.abs(Deg)+Math.abs(Min)/60+Math.abs(Sec)/3600,South="S"===NS.toUpperCase()&&Lat>0;for(South&&(Lat=-Lat),Deg=longDegrees,Min=longMinutes,Sec=longSeconds,West="W"===EW.toUpperCase(),Long=1*Math.abs(Deg)+Math.abs(Min)/60+Math.abs(Sec)/3600,West&&(Long=-Long),K=Lat*Deg2Rad,L=Long*Deg2Rad,SINK=Math.sin(K),COSK=Math.cos(K),TANK=SINK/COSK,TANK2=TANK*TANK,COSK2=COSK*COSK,COSK3=COSK2*COSK,K3=K-K0,K4=K+K0,Merid=6*Math.floor(Long/6)+3,Lat>=72&&Long>=0&&(Long<9?Merid=3:Long<21?Merid=15:Long<33?Merid=27:Long<42&&(Merid=39)),Lat>=56&&Lat<64&&Long>=3&&Long<12&&(Merid=9),MeridWest=Merid<0,L0=Merid*Deg2Rad,J3=K3*(1+N1+1.25*(N2+N3)),J4=Math.sin(K3)*Math.cos(K4)*(3*(N1+N2+.875*N3)),J5=Math.sin(2*K3)*Math.cos(2*K4)*(1.875*(N2+N3)),J6=Math.sin(3*K3)*Math.cos(3*K4)*35/24*N3,M=(J3-J4+J5-J6)*B1,Temp=1-E2*SINK*SINK,V=A1/Math.sqrt(Temp),R=V*(1-E2)/Temp,H2=V/R-1,P=L-L0,P2=P*P,P4=P2*P2,J3=M+N0,J4=V/2*SINK*COSK,J5=V/24*SINK*COSK3*(5-TANK2+9*H2),J6=V/720*SINK*COSK3*COSK2*(61-58*TANK2+TANK2*TANK2),North=J3+P2*J4+P4*J5+P4*P2*J6,"UTM1"!==Area&&"UTM2"!==Area||!South||(North+=1e7),J7=V*COSK,J8=V/6*COSK3*(V/R-TANK2),J9=V/120*COSK3*COSK2,J9*=5-18*TANK2+TANK2*TANK2+14*H2-58*TANK2*H2,East=E0+P*J7+P2*P*J8+P4*P*J9,IEast=Math.round(East),INorth=Math.round(North),EastStr="",EastStr+=Math.abs(IEast),NorthStr="",NorthStr+=Math.abs(INorth);EastStr.length<7;)EastStr="0"+EastStr;for(;NorthStr.length<7;)NorthStr="0"+NorthStr;if(GR100km=EastStr.substring(1,2)+NorthStr.substring(1,2),GRremainder=EastStr.substring(2,7)+" "+NorthStr.substring(2,7),"UTM1"===Area||"UTM2"===Area){if(LongZone=(Merid-3)/6+31,LongZone%1!==0)GR=null;else if(IEast<1e5||Lat<-80||IEast>899999||Lat>=84)GR=null;else{for(Letters="ABCDEFGHJKLMNPQRSTUVWXYZ",Pos=Math.round(Lat/8-.5)+10+2,LatZone=Letters.substring(Pos,Pos+1),LatZone>"X"&&(LatZone="X"),Pos=Math.round(Math.abs(INorth)/1e5-.5);Pos>19;)Pos-=20;for(LongZone%2===0&&(Pos+=5,Pos>19&&(Pos-=20)),N100km=Letters.substring(Pos,Pos+1),Pos=GR100km/10-1,P=LongZone;P>3;)P-=3;Pos+=8*(P-1),E100km=Letters.substring(Pos,Pos+1),GR=LongZone+LatZone+" "+E100km+N100km+" "+GRremainder}return GR}return"Did not convert correctly"},ValidLongZone:function(ZoneCell){return!(ZoneCell<1||ZoneCell>60)},UTMCMfromLongZone:function(ZoneCell){return this.ValidLongZone(ZoneCell)?6*(ZoneCell-1)-180+3:-181},truncateDecimal:function(value){var baseValue,decValue,precision=5,returnValue=value,valString=value.toString(),dotIndex=valString.indexOf("."),isNegative=valString.indexOf("-");return dotIndex!==-1&&dotIndex+precision<=valString.length&&(baseValue=parseFloat(valString.substr(0,dotIndex)),decValue=parseFloat(valString.substr(dotIndex,precision+1)),baseValue<0||isNegative!==-1?(.99999===decValue&&(baseValue-=1,decValue=0),returnValue=baseValue-decValue):(.99999===decValue&&(baseValue+=1,decValue=0),returnValue=baseValue+decValue)),returnValue},TM2LL:function(LatLong,EastCell,NorthCell,Merid){var F0,A1,B1,K0,L0,N0,N1,N2,N3,E0,E2,N,E,NRel,K,K3,K4,J3,J4,J5,J6,M,Finished,SINK,COSK,TANK,TANK2,Temp,V,R,H2,V3,Y1,Y12,K9,J7,J8,J9,L,Area=4,Deg2Rad=.017453292519943278,MGRS_Old=Area<0;if(MGRS_Old&&(Area=-Area),4!==Area)return-181;for(F0=.9996,A1=6378137*F0,B1=6356752.3142*F0,K0=0,L0=Merid*Deg2Rad,N0=0,E0=5e5,N1=(A1-B1)/(A1+B1),N2=N1*N1,N3=N2*N1,E2=(A1*A1-B1*B1)/(A1*A1),N=NorthCell,E=EastCell,NRel=N-N0,K=NRel/A1+K0;!Finished;)K3=K-K0,K4=K+K0,J3=K3*(1+N1+1.25*(N2+N3)),J4=Math.sin(K3)*Math.cos(K4)*(3*(N1+N2+.875*N3)),J5=Math.sin(2*K3)*Math.cos(2*K4)*(1.875*(N2+N3)),J6=Math.sin(3*K3)*Math.cos(3*K4)*35/24*N3,M=(J3-J4+J5-J6)*B1,Finished=Math.abs(NRel-M)<.001,Finished||(K+=(NRel-M)/A1);return SINK=Math.sin(K),COSK=Math.cos(K),TANK=SINK/COSK,TANK2=TANK*TANK,Temp=1-E2*SINK*SINK,V=A1/Math.sqrt(Temp),R=V*(1-E2)/Temp,H2=V/R-1,V3=V*V*V,Y1=E-E0,Y12=Y1*Y1,J3=TANK/(2*R*V),J4=TANK/(24*R*V3)*(5+3*TANK2+H2-9*TANK2*H2),J5=TANK/(720*R*Math.pow(V,5))*(61+90*TANK*TANK+45*Math.pow(TANK,4)),K9=K-Y12*J3+Y12*Y12*J4-Math.pow(Y1,6)*J5,J6=1/(COSK*V),J7=1/(6*COSK*V3)*(V/R+2*TANK2),J8=1/(120*COSK*Math.pow(V,5))*(5+28*TANK*TANK+24*Math.pow(TANK,4)),J9=1/(5040*COSK*Math.pow(V,7)),J9*=61+662*TANK*TANK+1320*Math.pow(TANK,4)+720*Math.pow(TANK,6),L=L0+Y1*J6-Y1*Y12*J7+Math.pow(Y1,5)*J8-Math.pow(Y1,7)*J9,K=K9,"LATITUDE"===LatLong.toUpperCase()?this.truncateDecimal(K/Deg2Rad):"LONGITUDE"===LatLong.toUpperCase()?this.truncateDecimal(L/Deg2Rad):-181},mgrsToDD:function(LatLong,GRCell){var isEven,S,i,LongZoneNumber,Posn,MGRS_Old,GRLength,LatZoneNumber,GRX,LatZoneLetter,Long100Letter,Lat100Letter,LongZoneMerid,Long100Number,LatZoneDeg,Lat100Number,ApproxLatZoneKm,LatKm,Neg,Diff,PrevDiff,GRY,Ndigits,X,Y,nn,HalfDigits,Mult,hj,Merid,Area=4,noSpace=GRCell.split(" ");if(GRCell=noSpace.join(""),isEven=!1,GRCell.length>=6&&!isEven){if(GRLength=GRCell.length,GRLength>2){for(S="",i=0;i<GRLength;i+=1)" "!==GRCell.substr(i,1)&&(S+=GRCell.substr(i,1));GRCell=S}if(GRLength=GRCell.length,GRLength<3)return-181;if(GRCell=GRCell.toUpperCase(),MGRS_Old=Area<0,MGRS_Old&&(Area=-Area),4===Area){if(isNaN(parseFloat(GRCell.substr(0,2)))?(Posn=1,LongZoneNumber=parseFloat(GRCell.substr(0,1))):(Posn=2,LongZoneNumber=parseFloat(GRCell.substr(0,2))),LatZoneLetter=GRCell.substr(Posn,1),Posn+=1,Long100Letter=GRCell.substr(Posn,1),Posn+=1,Lat100Letter=GRCell.substr(Posn,1),Posn+=1,LongZoneMerid=6*(LongZoneNumber-1)-180+3,Long100Number=Long100Letter.charCodeAt(0)-64,Long100Number<1||Long100Number>26||9===Long100Number||15===Long100Number)return-181;if(Long100Number>8&&(Long100Number-=9,Long100Number>5&&(Long100Number-=1,Long100Number>8&&(Long100Number-=8))),GRX=1e5*Long100Number,LatZoneNumber=LatZoneLetter.charCodeAt(0)-66,LatZoneNumber<1||LatZoneNumber>22||7===LatZoneNumber||13===LatZoneNumber)return-181;if(LatZoneNumber>6&&(LatZoneNumber-=1,LatZoneNumber>11&&(LatZoneNumber-=1)),LatZoneDeg=8*(LatZoneNumber-1)-80,Lat100Number=Lat100Letter.charCodeAt(0)-64,Lat100Number<1||Lat100Number>22||9===Lat100Number||15===Lat100Number)return-181;for(Lat100Number>8&&(Lat100Number-=1,Lat100Number>13&&(Lat100Number-=1)),LongZoneNumber%2===0&&(Lat100Number>5?Lat100Number-=5:Lat100Number+=15),ApproxLatZoneKm=110*LatZoneDeg,LatKm=100*(Lat100Number-1),Neg=ApproxLatZoneKm<0,Neg&&(LatKm=2e3-LatKm,ApproxLatZoneKm=-ApproxLatZoneKm),Neg&&(ApproxLatZoneKm-=880),Diff=0,PrevDiff=1;Diff<PrevDiff;)PrevDiff=Math.abs(LatKm-ApproxLatZoneKm),LatKm+=2e3,Diff=Math.abs(LatKm-ApproxLatZoneKm);switch(LatKm-=2e3,"X"===LatZoneLetter&&LatKm<100*Math.floor(ApproxLatZoneKm/100)&&(LatKm+=2e3),Neg&&(LatKm=-LatKm),MGRS_Old&&(LatKm-=1e3),GRY=1e3*LatKm,Ndigits=GRCell.length-(Posn+1),X=0,Y=0,Ndigits){case 0:case 1:switch(nn=parseInt(GRCell.substr(Posn,1),10)){case 1:Y=5e4;break;case 2:case 3:X=5e4,Y=5e4;break;case 4:X=5e4;break;default:return-181}break;default:for(HalfDigits=Ndigits/2,X=parseInt(GRCell.substr(Posn,HalfDigits+1),10),Y=parseInt(GRCell.substr(Posn+HalfDigits+1,HalfDigits+1),10),Mult=1e5,hj=0;hj<HalfDigits;hj+=1)Mult/=10;X*=Mult,Y*=Mult}return isNaN(X)||isNaN(Y)||isNaN(LongZoneNumber)?-181:(GRX+=X,GRY+=Y,Merid=this.UTMCMfromLongZone(LongZoneNumber),this.TM2LL(LatLong,GRX,GRY,Merid))}return-181}return-181},getMetersPerDegAtLat:function(lat){var m1,m2,m3,m4,p1,p2,p3,latlen,longlen;return lat=emp.geoLibrary.deg2rad(lat),m1=111132.92,m2=-559.82,m3=1.175,m4=-.0023,p1=111412.84,p2=-93.5,p3=.118,latlen=m1+m2*Math.cos(2*lat)+m3*Math.cos(4*lat)+m4*Math.cos(6*lat),longlen=p1*Math.cos(lat)+p2*Math.cos(3*lat)+p3*Math.cos(5*lat)},getPointFromDistanceBearing:function(startLat,startLon,distance,bearing){bearing=bearing*Math.PI/180;var R=6371,lat2=Math.asin(Math.sin(startLat)*Math.cos(distance/R)+Math.cos(startLat)*Math.sin(distance/R)*Math.cos(bearing)),lon2=startLon+Math.atan2(Math.sin(bearing)*Math.sin(distance/R)*Math.cos(startLat),Math.cos(distance/R)-Math.sin(startLat)*Math.sin(lat2));return{lat:lat2,lon:lon2}},getMidPoint:function(lat1,lon1,lat2,lon2){var lat3=(lat1+lat2)/2,f1=Math.tan(Math.PI/4+lat1/2),f2=Math.tan(Math.PI/4+lat2/2),f3=Math.tan(Math.PI/4+lat3/2),lon3=((lon2-lon1)*Math.log(f3)+lon1*Math.log(f2)-lon2*Math.log(f1))/Math.log(f2/f1);return lon3},measureDistance:function(latitude1,longitude1,latitude2,longitude2,unitOfMeasure){var rad,distance=-1;switch(unitOfMeasure.toLowerCase()){case"kilometers":rad=6378.137;break;case"meters":rad=6378137;break;case"miles":rad=3963.1;break;case"feet":rad=20925524.9;break;case"yards":rad=6975174.98;break;case"nautical":rad=3443.9;break;case"nautical miles":rad=3443.9;break;default:return-1}return latitude1*=Math.PI/180,latitude2*=Math.PI/180,longitude1*=Math.PI/180,longitude2*=Math.PI/180,distance=Math.acos(Math.cos(latitude1)*Math.cos(longitude1)*Math.cos(latitude2)*Math.cos(longitude2)+Math.cos(latitude1)*Math.sin(longitude1)*Math.cos(latitude2)*Math.sin(longitude2)+Math.sin(latitude1)*Math.sin(latitude2))*rad},coordinateArrayToString:function(coordinates){var i,len=coordinates.length,coordString="";for(i=0;i<len;i+=1)i>0&&(coordString+=" "),coordString+=coordinates[i][0].toString()+","+coordinates[i][1].toString(),coordString+=3===coordinates[i].length?","+coordinates[i][2].toString():",0";return coordString},coordinateStringToArray:function(coordinates){var pairs,len,i,values,alt,coordArr=[];if(coordinates.length>0)for(pairs=coordinates.split(" "),len=pairs.length,i=0;i<len;i+=1)values=pairs[i].split(","),alt=0,3===values.length&&(alt=parseInt(values[2],10)),coordArr.push({lat:parseFloat(values[1]),lon:parseFloat(values[0]),alt:alt});return coordArr},validateLatLon:function(lat,lon){var valid=!1;return isNaN(lat)||isNaN(lon)||lat<=90&&lat>=-90&&lon<=180&&lon>=-180&&(valid=!0),valid},DegToRad:function(deg){return deg/180*Math.PI},RadToDeg:function(rad){return rad/Math.PI*180},GetAzimuth:function(c1,c2){var theta=0;try{var lat1=this.DegToRad(c1.y),lon1=this.DegToRad(c1.x),lat2=this.DegToRad(c2.y),lon2=this.DegToRad(c2.x),y=Math.sin(lon2-lon1);y*=Math.cos(lat2);var x=Math.cos(lat1);x*=Math.sin(lat2);var z=Math.sin(lat1);z*=Math.cos(lat2),z*=Math.cos(lon2-lon1),x-=z,theta=Math.atan2(y,x),theta=this.RadToDeg(theta)}catch(error){}return theta},geodesic_coordinate:function(start,distance,azimuth){var pt=this.Point(),sm_a=6378137;try{var a=0,b=0,c=0,d=0,e=0,f=0,g=0,h=0,k=0,l=0,m=0,n=0,p=0;a=this.DegToRad(start.y),b=Math.cos(a),c=this.DegToRad(azimuth),d=Math.sin(a),e=Math.cos(distance/sm_a),f=Math.sin(distance/sm_a),g=Math.cos(c);var lat=this.RadToDeg(Math.asin(d*e+b*f*g));h=Math.sin(c),k=Math.sin(h),l=Math.cos(a),m=this.DegToRad(lat),n=Math.sin(m),p=Math.atan2(h*f*b,e-d*n);var lon=start.x+this.RadToDeg(p);pt=this.Point(),pt.x=lon,pt.y=lat}catch(error){}return pt},IntersectLines:function(p1,brng1,p2,brng2){var ptResult=null;try{var lat1=this.DegToRad(p1.y),lon1=this.DegToRad(p1.x),lat2=this.DegToRad(p2.y),lon2=this.DegToRad(p2.x),brng13=this.DegToRad(brng1),brng23=this.DegToRad(brng2),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2)));if(0===dist12)return null;var brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1)));isNaN(brngA)&&(brngA=0);var brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),brng12=0,brng21=0;Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB);var alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI;if(0===Math.sin(alpha1)&&0===Math.sin(alpha2))return null;if(Math.sin(alpha1)*Math.sin(alpha2)<0)return null;var alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13;lon3=(lon3+Math.PI)%(2*Math.PI)-Math.PI,ptResult=this.Point(this.RadToDeg(lon3),this.RadToDeg(lat3))}catch(error){}return ptResult},doesBoundingBoxIntersect:function(bbox1,bbox2){var bbox1a,bbox1b,bbox2a,bbox2b;return bbox1.left>bbox1.right?(bbox1a=new emp.geoLibrary.BoundingBox,bbox1a.left=bbox1.left,bbox1a.right=180,bbox1a.top=bbox1.top,bbox1a.bottom=bbox1.bottom,bbox1b=new emp.geoLibrary.BoundingBox,bbox1b.left=-180,bbox1b.right=bbox1.right,bbox1b.top=bbox1.top,bbox1b.bottom=bbox1.bottom,bbox2.left>bbox2.right?(bbox2a=new emp.geoLibrary.BoundingBox,bbox2a.left=bbox2.left,bbox2a.right=180,bbox2a.top=bbox2.top,bbox2a.bottom=bbox2.bottom,bbox2b=new emp.geoLibrary.BoundingBox,bbox2b.left=-180,bbox2b.right=bbox2.right,bbox2b.top=bbox2.top,bbox2b.bottom=bbox2.bottom,this.checkBboxOverlap(bbox1a,bbox2a)===!0||this.checkBboxOverlap(bbox2a,bbox1a)===!0||this.checkBboxOverlap(bbox1b,bbox2b)===!0||this.checkBboxOverlap(bbox2b,bbox1b)===!0):(bbox2a=new emp.geoLibrary.BoundingBox,bbox2a.left=bbox2.left,bbox2a.right=180,bbox2a.top=bbox2.top,bbox2a.bottom=bbox2.bottom,bbox2b=new emp.geoLibrary.BoundingBox,bbox2b.left=-180,bbox2b.right=bbox2.right,bbox2b.top=bbox2.top,
bbox2b.bottom=bbox2.bottom,this.checkBboxOverlap(bbox1,bbox2a)===!0||this.checkBboxOverlap(bbox2a,bbox1)===!0||this.checkBboxOverlap(bbox1,bbox2b)===!0||this.checkBboxOverlap(bbox2b,bbox1)===!0)):bbox2.left>bbox2.right?this.checkBboxOverlap(bbox1a,bbox2)===!0||this.checkBboxOverlap(bbox2,bbox1a)===!0||this.checkBboxOverlap(bbox1b,bbox2)===!0||this.checkBboxOverlap(bbox2,bbox1b)===!0:this.checkBboxOverlap(bbox1,bbox2)===!0||this.checkBboxOverlap(bbox2,bbox1)===!0},pointInBbox:function(bbox,x,y){return!!((bbox||void 0!==bbox.left||void 0!==bbox.right||void 0!==bbox.top||void 0!==bbox.bototm)&&x>=bbox.left&&x<=bbox.right&&y>=bbox.bottom&&y<=bbox.top)},checkBboxOverlap:function(bbox1,bbox2){if(bbox1&&bbox2){if(this.pointInBbox(bbox1,bbox2.left,bbox2.top))return!0;if(this.pointInBbox(bbox1,bbox2.right,bbox2.top))return!0;if(this.pointInBbox(bbox1,bbox2.left,bbox2.bottom))return!0;if(this.pointInBbox(bbox1,bbox2.right,bbox2.bottom))return!0}return!1},checkBboxIntersects:function(bbox1,bbox2){var tw=bbox1.right-bbox1.left,th=bbox1.top-bbox1.bottom,rw=bbox2.right-bbox2.left,rh=bbox2.top-bbox2.bottom;if(rw<=0||rh<=0||tw<=0||th<=0)return!1;var tx=bbox1.left,ty=bbox1.top,rx=bbox2.left,ry=bbox2.top;return rw+=rx,rh+=ry,tw+=tx,th+=ty,(rw<rx||rw>tx)&&(rh>ry||rh<ty)&&(tw<tx||tw>rx)&&(th>ty||th<ry)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(bbox,x,y){var out=0;return bbox.width<=0?out|=this.OUT_LEFT|this.OUT_RIGHT:x<bbox.left?out|=this.OUT_LEFT:x>bbox.right&&(out|=this.OUT_RIGHT),bbox.height<=0?out|=this.OUT_TOP|this.OUT_BOTTOM:y>bbox.top?out|=this.OUT_TOP:y<bbox.bottom&&(out|=this.OUT_BOTTOM),out},checkLineIntersectsBox:function(bbox,x1,y1,x2,y2){var out1,out2;if(0===(out2=this.outcode(bbox,x2,y2)))return!0;for(;0!==(out1=this.outcode(bbox,x1,y1));){if(0!==(out1&out2))return!1;if(0!==(out1&(this.OUT_LEFT|this.OUT_RIGHT))){var x=bbox.left;0!==(out1&this.OUT_RIGHT)&&(x=bbox.right),y1+=(x-x1)*(y2-y1)/(x2-x1),x1=x}else{var y=bbox.top;0!==(out1&this.OUT_BOTTOM)&&(y=bbox.bottom),x1+=(y-y1)*(x2-x1)/(y2-y1),y1=y}}return!0},BoundingBox:function(pointString){var len,points,p1,p2,point,i;if(pointString)for(points=pointString.split(" "),len=points.length,i=0;i<len;i++)if(point=points[i].split(","),p1=parseFloat(point[0]),p2=parseFloat(point[1]),point.length>=2&&(null===this.left?this.left=p1:p1<this.left&&(this.left=p1),null===this.right?this.right=p1:p1>this.right&&(this.right=p1),null===this.top?this.top=p2:p2>this.top&&(this.top=p2),null===this.bottom?this.bottom=p2:point[1]<this.bottom&&(this.bottom=p2),this.right-this.left>180)){var savedvalue=this.left;this.left=this.right,this.right=savedvalue}},getBox:function(points){var left,right,top,bottom,len,p1,p2,point,i;for(len=points.length,i=0;i<len;i++)if(point=points[i],p1=point.lon,p2=point.lat,null===left?left=p1:p1<left&&(left=p1),null===right?right=p1:p1>right&&(right=p1),null===top?top=p2:p2>top&&(top=p2),null===bottom?bottom=p2:p2<bottom&&(bottom=p2),right-left>180){var savedvalue=left;left=right,right=savedvalue}return[{lat:bottom,lon:left},{lat:top,lon:left},{lat:top,lon:right},{lat:bottom,lon:right}]},getBoxIDL:function(points){var left,right,top,bottom,len,p1,p2,point,i,temp;for(len=points.length,i=0;i<len;i++)point=points[i],p1=point.lon+180,p2=point.lat+90,null===left?left=p1:p1<left&&(left=p1),null===right?right=p1:p1>right&&(right=p1),null===top?top=p2:p2>top&&(top=p2),null===bottom?bottom=p2:p2<bottom&&(bottom=p2);return right-left>180&&(temp=left,left=right,right=temp),[{lat:bottom-90,lon:left-180},{lat:top-90,lon:left-180},{lat:top-90,lon:right-180},{lat:bottom-90,lon:right-180}]},latLongToUtm:function(numLat,numLong){var numLongOrigin,numN,numT,numC,numAA,numM,numLongOriginRad,intZoneNumber,numUTMEasting=0,numUTMNorthing=0,strZone="",numA=6378137,numEccSquared=.00669438,numK0=.9996,numLongTemp=numLong+180-360*Math.floor((numLong+180)/360)-180,numLatRad=numLat*(Math.PI/180),numLongRad=numLongTemp*(Math.PI/180);intZoneNumber=Math.floor((numLongTemp+180)/6)+1,numLat>=56&&numLat<64&&numLongTemp>=3&&numLongTemp<12&&(intZoneNumber=32),numLat>=772&&numLat<84&&(numLongTemp>=0&&numLongTemp<9?intZoneNumber=31:numLongTemp>=9&&numLongTemp<21?intZoneNumber=33:numLongTemp>=21&&numLongTemp<33?intZoneNumber=35:numLongTemp>=33&&numLongTemp<42&&(intZoneNumber=37)),numLongOrigin=6*(intZoneNumber-1)-180+3,numLongOriginRad=numLongOrigin*(Math.PI/180),strZone=intZoneNumber.toString()+this.utmLetterDesignator(numLat);var eccPrimeSquared=numEccSquared/(1-numEccSquared);numN=numA/Math.sqrt(1-numEccSquared*Math.sin(numLatRad)*Math.sin(numLatRad)),numT=Math.tan(numLatRad)*Math.tan(numLatRad),numC=eccPrimeSquared*Math.cos(numLatRad)*Math.cos(numLatRad),numAA=Math.cos(numLatRad)*(numLongRad-numLongOriginRad),numM=numA*((1-numEccSquared/4-3*numEccSquared*numEccSquared/64-5*numEccSquared*numEccSquared*numEccSquared/256)*numLatRad-(3*numEccSquared/8+3*numEccSquared*numEccSquared/32+45*numEccSquared*numEccSquared*numEccSquared/1024)*Math.sin(2*numLatRad)+(15*numEccSquared*numEccSquared/256+45*numEccSquared*numEccSquared*numEccSquared/1024)*Math.sin(4*numLatRad)-35*numEccSquared*numEccSquared*numEccSquared/3072*Math.sin(6*numLatRad)),numUTMEasting=Number(numK0*numN*(numAA+(1-numT+numC)*numAA*numAA*numAA/6+(5-18*numT+numT*numT+72*numC-58*eccPrimeSquared)*numAA*numAA*numAA*numAA*numAA/120)+5e5),numUTMNorthing=Number(numK0*(numM+numN*Math.tan(numLatRad)*(numAA*numAA/2+(5-numT+9*numC+4*numC*numC)*numAA*numAA*numAA*numAA/24+(61-58*numT+numT*numT+600*numC-330*eccPrimeSquared)*numAA*numAA*numAA*numAA*numAA*numAA/720))),numLat<0&&(numUTMNorthing+=1e7);var utmValue=strZone+","+Math.round(numUTMEasting).toString()+","+Math.round(numUTMNorthing).toString();return utmValue},utmLetterDesignator:function(numLat){var strLetterDesignator="Z";return strLetterDesignator=84>=numLat&&numLat>=72?"X":72>numLat&&numLat>=64?"W":64>numLat&&numLat>=56?"V":56>numLat&&numLat>=48?"U":48>numLat&&numLat>=40?"T":40>numLat&&numLat>=32?"S":32>numLat&&numLat>=24?"R":24>numLat&&numLat>=16?"Q":16>numLat&&numLat>=8?"P":8>numLat&&numLat>=0?"N":0>numLat&&numLat>=-8?"M":-8>numLat&&numLat>=-16?"L":-16>numLat&&numLat>=-24?"K":-24>numLat&&numLat>=-32?"J":-32>numLat&&numLat>=-40?"H":-40>numLat&&numLat>=-48?"G":-48>numLat&&numLat>=-56?"F":-56>numLat&&numLat>=-64?"E":-64>numLat&&numLat>=-72?"D":-72>numLat&&numLat>=-89?"C":"Z"},utmToLatLong:function(numZone,numEasting,numNorthing,blNorthernHemisphere){void 0!==blNorthernHemisphere&&null!==blNorthernHemisphere||(blNorthernHemisphere=!0),blNorthernHemisphere||(numNorthing=1e7-numNorthing);var numA=6378137,numE=.081819191,numE1sq=.006739497,numK0=.9996,numArc=numNorthing/numK0,numMu=numArc/(numA*(1-Math.pow(numE,2)/4-3*Math.pow(numE,4)/64-5*Math.pow(numE,6)/256)),numEi=(1-Math.pow(1-numE*numE,.5))/(1+Math.pow(1-numE*numE,.5)),numCa=3*numEi/2-27*Math.pow(numEi,3)/32,numCb=21*Math.pow(numEi,2)/16-55*Math.pow(numEi,4)/32,numCc=151*Math.pow(numEi,3)/96,numCd=1097*Math.pow(numEi,4)/512,numPhi1=numMu+numCa*Math.sin(2*numMu)+numCb*Math.sin(4*numMu)+numCc*Math.sin(6*numMu)+numCd*Math.sin(8*numMu),numN0=numA/Math.pow(1-Math.pow(numE*Math.sin(numPhi1),2),.5),numR0=numA*(1-numE*numE)/Math.pow(1-Math.pow(numE*Math.sin(numPhi1),2),1.5),numFact1=numN0*Math.tan(numPhi1)/numR0,num_a1=5e5-numEasting,numDd0=num_a1/(numN0*numK0),numFact2=numDd0*numDd0/2,numT0=Math.pow(Math.tan(numPhi1),2),numQ0=numE1sq*Math.pow(Math.cos(numPhi1),2),numFact3=(5+3*numT0+10*numQ0-4*numQ0*numQ0-9*numE1sq)*Math.pow(numDd0,4)/24,numFact4=(61+90*numT0+298*numQ0+45*numT0*numT0-252*numE1sq-3*numQ0*numQ0)*Math.pow(numDd0,6)/720,numLof1=num_a1/(numN0*numK0),numLof2=(1+2*numT0+numQ0)*Math.pow(numDd0,3)/6,numLof3=(5-2*numQ0+28*numT0-3*Math.pow(numQ0,2)+8*numE1sq+24*Math.pow(numT0,2))*Math.pow(numDd0,5)/120,num_a2=(numLof1-numLof2+numLof3)/Math.cos(numPhi1),num_a3=180*num_a2/Math.PI,numLatitude=180*(numPhi1-numFact1*(numFact2+numFact3+numFact4))/Math.PI;blNorthernHemisphere||(numLatitude=-numLatitude);var numLongitude=(numZone>0&&6*numZone-183||3)-num_a3;return numLatitude.toString()+","+numLongitude.toString()}},LatLon.prototype.distanceTo=function(point,precision){"undefined"==typeof precision&&(precision=4);var R=this._radius,lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=point._lat.toRad(),lon2=point._lon.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d.toPrecisionFixed(precision)},LatLon.prototype.bearingTo=function(point){var lat1=this._lat.toRad(),lat2=point._lat.toRad(),dLon=(point._lon-this._lon).toRad(),y=Math.sin(dLon)*Math.cos(lat2),x=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon),brng=Math.atan2(y,x);return(brng.toDeg()+360)%360},LatLon.prototype.finalBearingTo=function(point){var lat1=point._lat.toRad(),lat2=this._lat.toRad(),dLon=(this._lon-point._lon).toRad(),y=Math.sin(dLon)*Math.cos(lat2),x=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon),brng=Math.atan2(y,x);return(brng.toDeg()+180)%360},LatLon.prototype.midpointTo=function(point){var lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=point._lat.toRad(),dLon=(point._lon-this._lon).toRad(),Bx=Math.cos(lat2)*Math.cos(dLon),By=Math.cos(lat2)*Math.sin(dLon),lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+Bx)*(Math.cos(lat1)+Bx)+By*By)),lon3=lon1+Math.atan2(By,Math.cos(lat1)+Bx);return lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())},LatLon.prototype.destinationPoint=function(brng,dist){dist="number"==typeof dist?dist:"string"==typeof dist&&""!==dist.trim()?+dist:NaN,dist/=this._radius,brng=brng.toRad();var lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=Math.asin(Math.sin(lat1)*Math.cos(dist)+Math.cos(lat1)*Math.sin(dist)*Math.cos(brng)),lon2=lon1+Math.atan2(Math.sin(brng)*Math.sin(dist)*Math.cos(lat1),Math.cos(dist)-Math.sin(lat1)*Math.sin(lat2));return lon2=(lon2+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat2.toDeg(),lon2.toDeg())},LatLon.intersection=function(p1,brng1,p2,brng2){brng1="number"==typeof brng1?brng1:"string"==typeof brng1&&""!==trim(brng1)?+brng1:NaN,brng2="number"==typeof brng2?brng2:"string"==typeof brng2&&""!==trim(brng2)?+brng2:NaN;var brng12,brng21,dist13,alpha1,alpha2,alpha3,lat3,lon3,dLon13,lat1=p1._lat.toRad(),lon1=p1._lon.toRad(),lat2=p2._lat.toRad(),lon2=p2._lon.toRad(),brng13=brng1.toRad(),brng23=brng2.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2)));if(0===dist12)return null;var brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1)));isNaN(brngA)&&(brngA=0);var brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2)));return Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB),alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI,0===Math.sin(alpha1)&&0===Math.sin(alpha2)?null:Math.sin(alpha1)*Math.sin(alpha2)<0?null:(alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13,lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg()))},LatLon.prototype.rhumbDistanceTo=function(point){var R=this._radius,lat1=this._lat.toRad(),lat2=point._lat.toRad(),dLat=(point._lat-this._lat).toRad(),dLon=Math.abs(point._lon-this._lon).toRad(),dPhi=Math.log(Math.tan(lat2/2+Math.PI/4)/Math.tan(lat1/2+Math.PI/4)),q=isNaN(dLat/dPhi)||0===dPhi?Math.cos(lat1):dLat/dPhi;dLon>Math.PI&&(dLon=2*Math.PI-dLon);var dist=Math.sqrt(dLat*dLat+q*q*dLon*dLon)*R;return dist.toPrecisionFixed(4)},LatLon.prototype.rhumbBearingTo=function(point){var lat1=this._lat.toRad(),lat2=point._lat.toRad(),dLon=(point._lon-this._lon).toRad(),dPhi=Math.log(Math.tan(lat2/2+Math.PI/4)/Math.tan(lat1/2+Math.PI/4));Math.abs(dLon)>Math.PI&&(dLon=dLon>0?-(2*Math.PI-dLon):2*Math.PI+dLon);var brng=Math.atan2(dLon,dPhi);return(brng.toDeg()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(brng,dist){var lon2,R=this._radius,d=parseFloat(dist)/R,lat1=this._lat.toRad(),lon1=this._lon.toRad();brng=brng.toRad();var lat2=lat1+d*Math.cos(brng),dLat=lat2-lat1,dPhi=Math.log(Math.tan(lat2/2+Math.PI/4)/Math.tan(lat1/2+Math.PI/4)),q=isNaN(dLat/dPhi)||0===dPhi?Math.cos(lat1):dLat/dPhi,dLon=d*Math.sin(brng)/q;return Math.abs(lat2)>Math.PI/2&&(lat2=lat2>0?Math.PI-lat2:-(Math.PI-lat2)),lon2=(lon1+dLon+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat2.toDeg(),lon2.toDeg())},LatLon.prototype.lat=function(format,dp){return"undefined"==typeof format?this._lat:Geo.toLat(this._lat,format,dp)},LatLon.prototype.lon=function(format,dp){return"undefined"==typeof format?this._lon:Geo.toLon(this._lon,format,dp)},LatLon.prototype.toString=function(format,dp){return"undefined"==typeof format&&(format="dms"),isNaN(this._lat)||isNaN(this._lon)?"-,-":Geo.toLat(this._lat,format,dp)+", "+Geo.toLon(this._lon,format,dp)},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),"undefined"==typeof Number.prototype.toPrecisionFixed&&(Number.prototype.toPrecisionFixed=function(precision){if(isNaN(this))return"NaN";var l,n,numb=this<0?-this:this,sign=this<0?"-":"";if(0===numb){for(n="0.";precision--;)n+="0";return n}var scale=Math.ceil(Math.log(numb)*Math.LOG10E);if(n=String(Math.round(numb*Math.pow(10,precision-scale))),scale>0){for(l=scale-n.length;l-- >0;)n+="0";scale<n.length&&(n=n.slice(0,scale)+"."+n.slice(scale))}else{for(;scale++<0;)n="0"+n;n="0."+n}return sign+n}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),emp.geojsonParser=function(){function adjustColor(color){var alpha="CC",red="",green="",blue="",adjustedColor="CC000000";return void 0!==color&&null!==color&&(8===color.length?(alpha=color.substr(0,2),red=color.substr(2,2),green=color.substr(4,2),blue=color.substr(6,2),adjustedColor=alpha+blue+green+red):6===color.length&&(red=color.substr(0,2),green=color.substr(2,2),blue=color.substr(4,2),adjustedColor=alpha+blue+green+red)),adjustedColor}function getPointKml(coordinates){var lat,lon,altitude,kml,result;return coordinates.length>=2?(lat=coordinates[1],lon=coordinates[0],3===coordinates.length&&(altitude=coordinates[2]),kml="<Point><coordinates>"+lon+","+lat+(void 0!==altitude?","+altitude:"")+"</coordinates></Point>",result={success:!0,message:"",data:kml}):result={success:!1,message:"geojson does not have a valid coordinate."},result}function addGeoJsonPoint(geojson,name,id,overlayId,modifiers,zoom){var coordinates,iconUrl,xOffset,yOffset,xUnits,yUnits,fillColor,kml,obj,result,description,style,iconObj;if(modifiers=modifiers||{},style=emp.geojsonParser.getStyle(geojson),modifiers.iconUrl&&(modifiers.iconUrl=modifiers.iconUrl.replace("&","&amp;")),iconUrl=modifiers.iconUrl||style.iconUrl,iconUrl?(xOffset=modifiers.iconXOffset||0,yOffset=modifiers.iconYOffset||0,xUnits=modifiers.xUnits||"pixels",yUnits=modifiers.yUnits||"pixels"):(iconObj=emp.utilities.getDefaultIcon(),iconUrl=iconObj.iconUrl,xOffset=iconObj.offset.x,yOffset=1-iconObj.offset.y,xUnits=iconObj.offset.xUnits,yUnits=iconObj.offset.yUnits),fillColor=modifiers.fillColor||style.fillColor||"FF000000",name=style.name||name||"",style.description?description=style.description:modifiers.description&&(description=modifiers.description),fillColor=adjustColor(fillColor),void 0!==geojson.coordinates||null!==geojson.coordinates){if(coordinates=geojson.coordinates,kml="<Placemark><name><![CDATA["+name+"]]></name>",description&&(kml+="<description><![CDATA["+description+"]]></description>"),kml+='<Style id="user-icon"><IconStyle><scale>1.0</scale><Icon><href>'+iconUrl+'</href></Icon><hotSpot x="'+xOffset+'" y="'+yOffset+'" xunits="'+xUnits+'" yunits="'+yUnits+'"/></IconStyle></Style>',result=getPointKml(coordinates),result.success)return kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},{success:!0,message:"",data:obj}}else result={success:!1,message:"geojson does not have a valid coordinate."};return result}function getLineStringKml(coordinates){var i,latlon,lat,lon,endChar,altitude,kml,coordinateString="",result=null;for(i=0;i<coordinates.length;i+=1){if(!(coordinates.length>=2)){result={success:!1,message:"geojson does not have enough coordinates to make a line."};break}if(latlon=coordinates[i],void 0===latlon||null===latlon){result={success:!1,message:"geojson does not have a valid coordinate.  Point is null."};break}if(!(latlon.length>=2)){result={success:!1,message:"geojson does not have a valid coordinate."};break}lat=latlon[1],lon=latlon[0],3===latlon.length?(altitude=latlon[2],coordinateString=coordinateString+lon+","+lat+","+altitude,endChar=i!==coordinates.length-1?" ":"",coordinateString+=endChar):(coordinateString=coordinateString+lon+","+lat,endChar=i!==coordinates.length-1?" ":"",coordinateString+=endChar)}return null===result&&(kml="<LineString><tessellate>1</tessellate><coordinates>"+coordinateString+"</coordinates></LineString>",result={success:!0,message:"",data:kml}),result}function addGeoJsonLineString(geojson,name,id,overlayId,modifiers,zoom){var coordinates,kml,lineColor,lineThickness,obj,description,style,result="";return style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},lineColor=modifiers.lineColor||style.lineColor||"FF000000",lineThickness=modifiers.lineThickness||3,lineColor=adjustColor(lineColor),name=style.name||name||"",style.description?description=style.description:modifiers.description&&(description=modifiers.description),void 0!==geojson.coordinates||null!==geojson.coordinates?(coordinates=geojson.coordinates,void 0!==coordinates&&null!==coordinates?(kml="<Placemark><name><![CDATA["+name+"]]></name>",description&&(kml+="<description><![CDATA["+description+"]]></description>"),kml+='<Style id="user-line"><LineStyle><color>'+lineColor+"</color><width>"+lineThickness+"</width></LineStyle></Style>",result=getLineStringKml(coordinates),void 0!==result&&result.success!==!1&&(kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj})):result={success:!1,message:"geojson does not have a valid coordinates.  Coordinates are null. "}):result={success:!1,message:"geojson does not have a valid coordinate"},result}function getPolygonKml(polygon){var latlon,lat,lon,endChar,coordinates,numRings,coordIdx,ringIdx,coordinateString="",kml="<Polygon><tessellate>1</tessellate>";if(coordinates=polygon[0],numRings=polygon.length,numRings>0){if(coordinates.length<=3)return polygon[0][3]=polygon[0][0],getPolygonKml(polygon);for(coordIdx=0;coordIdx<coordinates.length;coordIdx+=1){if(latlon=coordinates[coordIdx],void 0===latlon||null===latlon)return{success:!1,message:"geojson does not have a valid coordinate.  Point is null."};if(!(latlon.length>=2))return{success:!1,message:"geojson does not have a valid coordinate."};lat=latlon[1],lon=latlon[0],3===latlon.length?(coordinateString=coordinateString+lon+","+lat+","+latlon[2],endChar=coordIdx!==coordinates.length-1?" ":"",coordinateString+=endChar):(coordinateString=coordinateString+lon+","+lat,endChar=coordIdx!==coordinates.length-1?" ":"",coordinateString+=endChar)}var firstCoordinate=coordinates[0],lastCoordinate=coordinates[coordinates.length-1];if(3===firstCoordinate.length&&3===lastCoordinate.length?firstCoordinate[0]===lastCoordinate[0]&&firstCoordinate[1]===lastCoordinate[1]&&firstCoordinate[2]===lastCoordinate[2]||(coordinateString=coordinateString+" "+firstCoordinate[0]+","+firstCoordinate[1]+","+firstCoordinate[2]):2===firstCoordinate.length&&2===lastCoordinate.length?firstCoordinate[0]===lastCoordinate[0]&&firstCoordinate[1]===lastCoordinate[1]||(coordinateString=coordinateString+" "+firstCoordinate[0]+","+firstCoordinate[1]):coordinateString=firstCoordinate.length>2?coordinateString+" "+firstCoordinate[0]+","+firstCoordinate[1]+","+firstCoordinate[2]:coordinateString+" "+firstCoordinate[0]+","+firstCoordinate[1],kml+="<outerBoundaryIs><LinearRing><coordinates>"+coordinateString+"</coordinates></LinearRing></outerBoundaryIs>",numRings>1)for(ringIdx=1;ringIdx<numRings;ringIdx+=1){if(coordinates=polygon[ringIdx],coordinateString="",coordinates.length<3)return{success:!1,message:"geojson does not have enough coordinates to build a polygon."};for(coordIdx=0;coordIdx<coordinates.length;coordIdx+=1){if(latlon=coordinates[coordIdx],void 0===latlon||null===latlon)return{success:!1,message:"geojson does not have a valid coordinate.  Point is null."};if(!(latlon.length>=2))return{success:!1,message:"geojson does not have a valid coordinate."};lat=latlon[1],lon=latlon[0],3===latlon.length?(coordinateString=coordinateString+lon+","+lat+","+latlon[2],endChar=coordIdx!==coordinates.length-1?" ":"",coordinateString+=endChar):(coordinateString=coordinateString+lon+","+lat,endChar=coordIdx!==coordinates.length-1?" ":"",coordinateString+=endChar)}kml+="<innerBoundaryIs><LinearRing><coordinates>"+coordinateString+"</coordinates></LinearRing></innerBoundaryIs>"}return kml+="</Polygon>",{success:!0,message:"",data:kml}}return{success:!1,message:"geojson does not have enough coordinates to build a polygon."}}function addGeoJsonPolygon(geojson,name,id,overlayId,modifiers,zoom){var coordinates,fillColor,lineColor,lineThickness,kml,obj,description,style,result="";return style=emp.geojsonParser.getStyle(geojson),(void 0!==geojson.coordinates||null!==geojson.coordinates)&&geojson.coordinates.length>0?(modifiers=modifiers||{},fillColor=style.fillColor||modifiers.fillColor||"88FFFFFF",lineColor=style.lineColor||modifiers.lineColor||"FF000000",lineThickness=modifiers.lineThickness||3,lineColor=adjustColor(lineColor),fillColor=adjustColor(fillColor),style.description?description=style.description:modifiers.description&&(description=modifiers.description),name=style.name||name||"",coordinates=geojson.coordinates,void 0!==coordinates&&null!==coordinates?(result=getPolygonKml(coordinates),void 0!==result&&result.success!==!1&&(kml="<Placemark><name><![CDATA["+name+"]]></name>",description&&(kml+="<description><![CDATA["+description+"]]></description>"),kml+='<Style id="user-polygon"><LineStyle><color>'+lineColor+"</color><width>"+lineThickness+"</width></LineStyle><PolyStyle><color>"+fillColor+"</color></PolyStyle></Style>",kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj})):result={success:!1,message:"geojson does not have a valid coordinates.  Coordinates are null. "}):result={success:!1,message:"geojson does not have a valid coordinate"},result}function getMultiPointKml(coordinates){var kml,point,lat,lon,result,coordinateString,i,altitude,overallResult=null;for(kml="<MultiGeometry>",i=0;i<coordinates.length;i+=1)point=coordinates[i],null!==point&&point.length>=2?(lat=point[1],lon=point[0],3===point.length?(altitude=point[2],coordinateString=lon+","+lat+","+altitude):coordinateString=lon+","+lat,kml+="<Point><coordinates>"+coordinateString+"</coordinates></Point>"):result={success:!1,message:"A portion of this geojson does not have a valid coordinate."},null===overallResult&&void 0!==result&&result.success===!1&&(overallResult=result);return kml+="</MultiGeometry>",null===overallResult&&(overallResult={success:!0,message:"",data:kml}),overallResult}function addGeoJsonMultiPoint(geojson,name,id,overlayId,modifiers,zoom){var iconUrl,coordinates,kml,fillColor,xOffset,yOffset,xUnits,yUnits,result,obj,iconObj,description,style;return void 0!==geojson.coordinates||null!==geojson.coordinates?(coordinates=geojson.coordinates,style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},fillColor=style.fillColor||modifiers.fillColor||"FFFFFFFF",name=style.name||name||"",iconUrl=modifiers.iconUrl||style.iconUrl,iconUrl?(xOffset=modifiers.iconXOffset||0,yOffset=modifiers.iconYOffset||0,xUnits=modifiers.xUnits||"pixels",yUnits=modifiers.yUnits||"pixels"):(iconObj=emp.utilities.getDefaultIcon(),iconUrl=iconObj.iconUrl,xOffset=iconObj.offset.x,yOffset=1-iconObj.offset.y,xUnits=iconObj.offset.xUnits,yUnits=iconObj.offset.yUnits),style.description?description=style.description:modifiers.description&&(description=modifiers.description),fillColor=adjustColor(fillColor),void 0!==coordinates&&null!==coordinates?(fillColor=adjustColor(fillColor),kml="<Placemark><name><![CDATA["+name+"]]></name>",description&&(kml+="<description><![CDATA["+description+"]]></description>"),kml+='<Style id="s_clr-pushpin"><IconStyle><color>'+fillColor+"</color><scale>1.0</scale><Icon><href>"+iconUrl+'</href></Icon><hotSpot x="'+xOffset+'" y="'+yOffset+'" xunits="'+xUnits+'" yunits="'+yUnits+'"/></IconStyle></Style>',result=getMultiPointKml(coordinates),result.success&&(kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj})):result={success:!1,message:"geojson does not have any coordinates."}):result={success:!1,message:"geojson does not have a valid coordinate"},result}function getMultiLineStringKml(lines){var kml,i,j,result,coordinates,point,altitude,endChar,lat,lon,coordinateString="",overallResult=null;for(kml="<MultiGeometry>",i=0;i<lines.length;i+=1){if(result={},coordinates=lines[i],coordinateString="",null!==coordinates){for(j=0;j<coordinates.length;j+=1)point=coordinates[j],null!==point?(lat=point[1],lon=point[0],point.length>=2?3===point.length?(altitude=point[2],coordinateString=coordinateString+lon+","+lat+","+altitude,endChar=j!==coordinates.length-1?" ":"",coordinateString+=endChar):(coordinateString=coordinateString+lon+","+lat,endChar=j!==coordinates.length-1?" ":"",coordinateString+=endChar):result={success:!1,message:"A portion of this geojson does not have a valid coordinate."}):result={success:!1,message:"A portion of this geojson does not have a valid coordinate."},null===overallResult&&void 0!==result&&result.success===!1&&(overallResult=result);void 0!==result&&result.success!==!1&&(kml+="<LineString><tessellate>1</tessellate><coordinates>"+coordinateString+"</coordinates></LineString>")}else result={success:!1,message:"geojson does not have any coordinates."};null===overallResult&&void 0!==result&&result.success===!1&&(overallResult=result)}return kml+="</MultiGeometry>",null===overallResult&&(overallResult={success:!0,message:"",data:kml}),overallResult}function addGeoJsonMultiLineString(geojson,name,id,overlayId,modifiers,zoom){var result,lines,kml,lineColor,obj,description,style;return void 0!==geojson.coordinates||null!==geojson.coordinates?(style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},lineColor=style.lineColor||modifiers.lineColor||"FF000000",lines=geojson.coordinates,lineColor=adjustColor(lineColor),name=style.name||name||"",style.description?description=style.description:modifiers.description&&(description=modifiers.description),null!==lines?(kml="<Placemark><name><![CDATA["+name+"]]></name><description><![CDATA["+description+']]></description><Style id="bufferLineStyle"><LineStyle><color>'+lineColor+"</color><width>4</width></LineStyle></Style>",result=getMultiLineStringKml(lines),result.success&&(kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj})):result={success:!1,message:"There are no lines within this MultiLineString."}):result={success:!1,message:"This MultiLineString geojson does not have an coordinates"},result}function getMultiPolygonKml(polygons){var i,result,kml="<MultiGeometry>",len=polygons.length;for(i=0;i<len;i+=1){if(result=getPolygonKml(polygons[i]),!result.success)return result;kml+=result.data}return kml+="</MultiGeometry>",{success:!0,message:"",data:kml}}function addGeoJsonMultiPolygon(geojson,name,id,overlayId,description,modifiers,zoom){var result,polygons,fillColor,lineColor,lineThickness,kml,obj,style;return(void 0!==geojson.coordinates||null!==geojson.coordinates)&&geojson.coordinates.length>0?(style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},fillColor=style.fillColor||modifiers.fillColor||"88000000",lineColor=style.lineColor||modifiers.lineColor||"FF000000",lineThickness=modifiers.lineThickness||3,style.description?description=style.description:modifiers.description&&(description=modifiers.description),name=style.name||name||"",kml="<Placemark>",kml+="<name><![CDATA["+name+"]]></name>",kml+="<description><![CDATA["+description+"]]></description>",kml+="<Style id='bufferLineStyle'>",kml+="<LineStyle>",kml+="<color>"+lineColor+"</color>",kml+="<width>"+lineThickness+"</width>",kml+="</LineStyle>",kml+="<PolyStyle>",kml+="<color>"+fillColor+"</color>",kml+="</PolyStyle>",kml+="</Style>",polygons=geojson.coordinates,result=getMultiPolygonKml(polygons),result.success&&(kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj})):result={success:!1,message:"geojson does not have a valid coordinate"},result}function getGeomtryCollectionKml(type,coordinates){var result,kml;if(null!==type)switch(type.toLowerCase()){case"point":result=getPointKml(coordinates),result.success&&(kml=result.data);break;case"linestring":result=getLineStringKml(coordinates),result.success&&(kml=result.data);break;case"polygon":result=getPolygonKml(coordinates),result.success&&(kml=result.data);break;case"multipoint":result=getMultiPointKml(coordinates),result.success&&(kml=result.data);break;case"multilinestring":result=getMultiLineStringKml(coordinates),result.success&&(kml=result.data);break;case"multipolygon":result=getMultiPolygonKml(coordinates),result.success&&(kml=result.data);break;case"geometrycollection":kml="<MultiGeometry>",result=getGeomtryCollectionKml(coordinates),result.success&&(kml+=result.data),kml+="</MultiGeometry>";break;default:result={success:!1,message:"Unssupported GeoJson type. Skipping Geometry."}}else result={success:!1,message:"Undefined type in GeometryCollection. Skipping Geometry."};return result}function addGeoJsonFeature(geojson,name,id,overlayId,modifiers,zoom){var geometry,properties,coloredRow,result,kml,coordinates,fillColor,lineColor,lineThickness,iconUrl,xOffset,yOffset,xUnits,yUnits,obj,iconObj,propertyName,description,style;if(style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},fillColor=style.fillColor||modifiers.fillColor||"88000000",lineColor=style.lineColor||modifiers.lineColor||"FF000000",lineThickness=modifiers.lineThickness||3,iconUrl=modifiers.iconUrl||style.iconUrl,iconUrl?(xOffset=modifiers.iconXOffset||0,yOffset=modifiers.iconYOffset||0,xUnits=modifiers.xUnits||"pixels",yUnits=modifiers.yUnits||"pixels"):(iconObj=emp.utilities.getDefaultIcon(),iconUrl=iconObj.iconUrl,xOffset=iconObj.offset.x,yOffset=1-iconObj.offset.y,xUnits=iconObj.offset.xUnits,yUnits=iconObj.offset.yUnits),lineColor=geEngine.utils.adjustColor(lineColor),fillColor=geEngine.utils.adjustColor(fillColor),style.description?description=style.description:modifiers.description&&(description=modifiers.description),
name=style.name||name||"",void 0!==geojson&&null!==geojson){if(geometry=geojson.geometry,properties=geojson.properties,modifiers.popupContentHTML)description=modifiers.popupContentHTML;else if(null!==properties){description?description+='<br/><table border="1" cellpadding="2" cellspacing="0" width=100%>':description='<br/><table border="1" cellpadding="2" cellspacing="0" width=100%>',coloredRow=!1;for(propertyName in properties)properties.hasOwnProperty(propertyName)&&(description=description+"<tr "+(coloredRow?' bgcolor="#F0F0F0">':">"),description+="<td>",description+="<b>",description+=propertyName,description+="</b>",description+="</td>",description+="<td>",description+=properties[propertyName],description+="</td>",description+="</tr>",coloredRow=!coloredRow);description+="</table>"}switch(coordinates=geometry.coordinates,geometry.type.toLowerCase()){case"point":result=getPointKml(coordinates);break;case"linestring":result=getLineStringKml(coordinates);break;case"polygon":result=getPolygonKml(coordinates);break;case"multipoint":result=getMultiPointKml(coordinates);break;case"multilinestring":result=getMultiLineStringKml(coordinates);break;case"multipolygon":result=getMultiPolygonKml(coordinates);break;case"geometrycollection":result=getGeomtryCollectionKml(coordinates);break;default:result={success:!1,message:"Unsupported GeoJson type. Skipping Geometry."}}result.success&&(kml="<Placemark><name><![CDATA["+name+"]]></name><description><![CDATA["+description+']]></description><Style id="geomcollection"><LineStyle><color>'+lineColor+"</color><width>"+lineThickness+"</width></LineStyle><PolyStyle><color>"+fillColor+"</color></PolyStyle><IconStyle><scale>1.0</scale><Icon><href>"+iconUrl+'</href></Icon><hotSpot x="'+xOffset+'" y="'+yOffset+'" xunits="'+xUnits+'" yunits="'+yUnits+'"/></IconStyle></Style>',kml+=result.data,kml+="</Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj})}else result={success:!1,message:"GeoJson is either null or not of the correct type."};return result}function addGeoJsonFeatureCollection(geojson,name,id,overlayId,modifiers,zoom){var result,len,feature,features,i,obj,kml,lineColor,lineThickness,fillColor,iconUrl,iconObj,xOffset,yOffset,xUnits,yUnits,style;if(null!==geojson&&"FeatureCollection"===geojson.type)if(style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},fillColor=style.fillColor||modifiers.fillColor||"88000000",lineColor=style.lineColor||modifiers.lineColor||"FF000000",lineThickness=modifiers.lineThickness||3,iconUrl=modifiers.iconUrl||style.iconUrl,iconUrl?(xOffset=modifiers.iconXOffset||0,yOffset=modifiers.iconYOffset||0,xUnits=modifiers.xUnits||"pixels",yUnits=modifiers.yUnits||"pixels"):(iconObj=emp.utilities.getDefaultIcon(),iconUrl=iconObj.iconUrl,xOffset=iconObj.offset.x,yOffset=1-iconObj.offset.y,xUnits=iconObj.offset.xUnits,yUnits=iconObj.offset.yUnits),lineColor=adjustColor(lineColor),fillColor=adjustColor(fillColor),name=style.name||name||"",features=geojson.features,null!==features){for(kml="<Folder><name><![CDATA["+name+"]]></name><Style id='geomcollection'><LineStyle><color>"+lineColor+"</color><width>"+lineThickness+"</width></LineStyle><PolyStyle><color>"+fillColor+"</color></PolyStyle><IconStyle><scale>1.0</scale><Icon><href>"+iconUrl+"</href></Icon><hotSpot x='"+xOffset+"' y='"+yOffset+"' xunits='"+xUnits+"' yunits='"+yUnits+"'/></IconStyle></Style>",len=features.length,i=0;i<len;i+=1)result={},feature=features[i],0!==Object.keys(feature.properties).length&&(modifiers=feature.properties),result=addGeoJsonFeature(feature,name,id,overlayId,modifiers,zoom),result.success&&(kml+=result.data.kml);kml+="</Folder>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj}}else result="FeatureCollection contains no features.";else result="GeoJson is either null or not of the correct type.";return result}function addGeoJsonGeometryCollection(geojson,name,id,overlayId,modifiers,zoom){var len,i,geometry,type,kml,lineColor,fillColor,iconUrl,iconObj,xOffset,yOffset,xUnits,yUnits,coordinates,result,obj,description,style;if(null!==geojson&&"GeometryCollection"===geojson.type&&void 0!==geojson.geometries&&null!==geojson.geometries){for(style=emp.geojsonParser.getStyle(geojson),modifiers=modifiers||{},fillColor=style.fillColor||modifiers.fillColor||"88000000",lineColor=style.lineColor||modifiers.lineColor||"FF000000",iconUrl=modifiers.iconUrl||style.iconUrl,iconUrl?(xOffset=modifiers.iconXOffset||0,yOffset=modifiers.iconYOffset||0,xUnits=modifiers.xUnits||"pixels",yUnits=modifiers.yUnits||"pixels"):(iconObj=emp.utilities.getDefaultIcon(),iconUrl=iconObj.iconUrl,xOffset=iconObj.offset.x,yOffset=1-iconObj.offset.y,xUnits=iconObj.offset.xUnits,yUnits=iconObj.offset.yUnits),lineColor=geEngine.utils.adjustColor(lineColor),fillColor=geEngine.utils.adjustColor(fillColor),style.description?description=style.description:modifiers.description&&(description=modifiers.description),name=style.name||name||"",len=geojson.geometries.length,kml="<Placemark><name><![CDATA["+name+"]]></name><description><![CDATA["+description+']]></description><Style id="geomcollection"><LineStyle><color>'+lineColor+"</color><width>3</width></LineStyle><PolyStyle><color>"+fillColor+"</color></PolyStyle><IconStyle><scale>1.0</scale><Icon><href>"+iconUrl+'</href></Icon><hotSpot x="'+xOffset+'" y="'+yOffset+'" xunits="'+xUnits+'" yunits="'+yUnits+'"/></IconStyle></Style><MultiGeometry>',i=0;i<len;i+=1)geometry=geojson.geometries[i],type=geometry.type,coordinates=geojson.geometries[i].coordinates,result=getGeomtryCollectionKml(type,coordinates),result.success&&(kml+=result.data);kml+="</MultiGeometry></Placemark>",obj={kml:kml,name:name,id:id,overlayId:overlayId,data:geojson,format:"geojson",properties:modifiers,zoom:zoom},result={success:!0,message:"",data:obj}}else result={success:!1,message:"GeoJson is either null or not of the correct type."};return result}return{geojsonToKmlBatch:function(batch){var result,type,i,length,geojson,name,featureId,parentId,modifiers,zoom,overallResult=null,newBatch=[];for(length=batch.length,i=0;i<length;i+=1)try{if(name=batch[i].name||"",featureId=batch[i].featureId,parentId=batch[i].parentId||"",modifiers=batch[i].modifiers||{},zoom=batch[i].zoom||!1,geojson=batch[i].data,void 0!==geojson.type||null!==geojson.type){switch(type=geojson.type,type.toLowerCase()){case"point":result=addGeoJsonPoint(geojson,name,featureId,parentId,modifiers,zoom);break;case"linestring":result=addGeoJsonLineString(geojson,name,featureId,parentId,modifiers,zoom);break;case"polygon":result=addGeoJsonPolygon(geojson,name,featureId,parentId,modifiers,zoom);break;case"multipoint":result=addGeoJsonMultiPoint(geojson,name,featureId,parentId,modifiers,zoom);break;case"multilinestring":result=addGeoJsonMultiLineString(geojson,name,featureId,parentId,modifiers,zoom);break;case"multipolygon":result=addGeoJsonMultiPolygon(geojson,name,featureId,parentId,modifiers,zoom);break;case"geometrycollection":result=addGeoJsonGeometryCollection(geojson,name,featureId,parentId,modifiers,zoom);break;case"feature":result=addGeoJsonFeature(geojson,name,featureId,parentId,modifiers,zoom);break;case"featurecollection":result=addGeoJsonFeatureCollection(geojson,name,featureId,parentId,modifiers,zoom);break;default:result={success:!1,message:"Unsupported GeoJson type"}}result.success===!0?newBatch.push(result.data):null===overallResult&&(overallResult=result)}else result={success:!1,message:"Incorrectly formatted GeoJson"},null===overallResult&&(overallResult=result)}catch(err){result={success:!1,message:err.message},null===overallResult&&(overallResult=result)}return null===overallResult&&(overallResult={success:!0,message:"",data:newBatch}),overallResult},geojsonToKml:function(geojson,name,id,overlayId,modifiers){var result,batch=[],obj={};try{obj={data:geojson,format:"geojson",name:name,id:id,overlayId:overlayId,properties:modifiers},batch.push(obj),result=this.geojsonToKmlBatch(batch)}catch(err){result={success:!1,message:err.message}}return result},getStyle:function(geojson){var argb,style={};return geojson.properties&&(geojson.properties.style&&(geojson.properties.style.lineStyle&&geojson.properties.style.lineStyle.color&&void 0!==geojson.properties.style.lineStyle.color.r&&void 0!==geojson.properties.style.lineStyle.color.g&&void 0!==geojson.properties.style.lineStyle.color.b&&void 0!==geojson.properties.style.lineStyle.color.a&&(argb=armyc2.c2sd.renderer.utilities.Color.rgbToHexString(geojson.properties.style.lineStyle.color.r,geojson.properties.style.lineStyle.color.g,geojson.properties.style.lineStyle.color.b,geojson.properties.style.lineStyle.color.a).replace("#",""),style.lineColor=argb),geojson.properties.style.polyStyle&&geojson.properties.style.polyStyle.color&&void 0!==geojson.properties.style.polyStyle.color.r&&void 0!==geojson.properties.style.polyStyle.color.g&&void 0!==geojson.properties.style.polyStyle.color.b&&void 0!==geojson.properties.style.polyStyle.color.a&&(argb=armyc2.c2sd.renderer.utilities.Color.rgbToHexString(geojson.properties.style.polyStyle.color.r,geojson.properties.style.polyStyle.color.g,geojson.properties.style.polyStyle.color.b,geojson.properties.style.polyStyle.color.a).replace("#",""),style.fillColor=argb),geojson.properties.style.iconStyle&&geojson.properties.style.iconStyle.url&&(style.url=geojson.properties.style.iconStyle.url)),geojson.properties.name&&(style.name=geojson.properties.name),geojson.properties.id&&(style.id=geojson.properties.id),geojson.properties.description&&(style.description=geojson.properties.description),geojson.properties.timePrimitive&&(geojson.properties.timePrimitive.timeSpan&&geojson.properties.timePrimitive.timeSpan.begin&&geojson.properties.timePrimitive.timeSpan.end,geojson.properties.timePrimitive.timestamp)),style}}}(),emp.errorHandler=function(){function enumerateError(error){var ecopy={name:error.name,message:error.message};return error.fileName&&(ecopy.file=error.fileName),error.lineNumber&&(ecopy.line=error.lineNumber),error.columnNumber&&(ecopy.column=error.columnNumber),error.stack&&(ecopy.stack=error.stack),ecopy}var debugLevel=3,logJSONArray=[];!function(){for(var method,placeholder=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],len=methods.length,console=window.console=window.console||{};len--;)method=methods[len],console[method]||(console[method]=placeholder)}();var publicInterface={log:function(args){var environment,jsError={},success=!0,msgLog={},jsErrorStr="";if("undefined"==typeof args.level?args.level=emp.typeLibrary.Error.level.MAJOR:args.level!==emp.typeLibrary.Error.level.CATASTROPHIC&&args.level!==emp.typeLibrary.Error.level.MAJOR&&args.level!==emp.typeLibrary.Error.level.MINOR&&args.level!==emp.typeLibrary.Error.level.INFO&&(args.level=emp.typeLibrary.Error.level.MAJOR),emp.util.isEmptyString(args.message)&&(args.message="No Message Provided"),args.hasOwnProperty("jsError")){jsError=enumerateError(args.jsError),msgLog.jsError=jsError;try{jsErrorStr=JSON.stringify(jsError)}catch(e){jsErrorStr="Unable to parse script error",console.error(e)}}switch("{}"===jsErrorStr&&(jsErrorStr=""),msgLog.jsErrorStr=jsErrorStr,msgLog.message=args.message,jsErrorStr=jsErrorStr.replace(/\\n/g,"\n"),jsErrorStr=jsErrorStr.replace(/,/g,",\n"),jsErrorStr=jsErrorStr.replace('"stack":','"stack":\n'),args.level){case emp.typeLibrary.Error.level.CATASTROPHIC:msgLog.level="CATASTROPHIC",console.error(args.message+"\n"+jsErrorStr);break;case emp.typeLibrary.Error.level.MAJOR:msgLog.level="MAJOR",console.error(args.message+"\n"+jsErrorStr);break;case emp.typeLibrary.Error.level.MINOR:console.warn(args.message+"\n"+jsErrorStr),msgLog.level="MINOR";break;case emp.typeLibrary.Error.level.INFO:console.log(args.message+"\n"+jsErrorStr),msgLog.level="INFO"}logJSONArray.unshift(msgLog),logJSONArray.length>100&&(console.log("Log JSON Array has reached its max length. The oldest error has been removed."),logJSONArray.pop());try{environment=emp.environment.get(),void 0!==environment&&null!==environment&&environment.hasOwnProperty("pubSub")&&environment.pubSub.publish({message:{message:args.message,error:jsError},channel:"emp.error"})}catch(e){console.error(e),success=!1}return success},set:function(args){debugLevel=args},get:function(){return debugLevel},getMessages:function(){return logJSONArray},clearLog:function(){logJSONArray=[]},exportLog:function(){function dataUrl(txtData){return"data:x-application/text,"+escape(txtData)}var jsonOutputStr=JSON.stringify(logJSONArray);window.open(dataUrl(jsonOutputStr),!0,"height=1,width=1")}};return publicInterface}();var emp=window.emp||{};emp.transactionQueue=function(){function outstandingTimerFunc(){oOutstandingTransaction&&(emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MINOR,message:"A "+oOutstandingTransaction.intent+" transaction with "+(oOutstandingTransaction.items.length+oOutstandingTransaction.failures.length)+" items has timed out. (timeout: "+outstandingTimeout/1e3+" sec)"}),oOutstandingTransaction=null,outstandingTimer=null)}function runQueue(){var transaction,oInstanceData,nextQueue,iListSize=oMapInstanceIdList.length;if(iListSize>0&&null===oOutstandingTransaction)for(nextQueue=findQueueWithOldestTransaction();nextQueue;){if(oInstanceData=oMapInstanceData[nextQueue],oInstanceData&&oInstanceData.running===!0&&oInstanceData.transQueue.length>0){switch(transaction=oInstanceData.transQueue.shift(),delete transHash[transaction.transactionId],transaction.intent){case emp.intents.control.DRAW_BEGIN:case emp.intents.control.EDIT_BEGIN:case emp.intents.control.WMS_ADD:break;default:oOutstandingTransaction=transaction,outstandingTimer=setTimeout(outstandingTimerFunc,outstandingTimeout)}transaction.intent===emp.intents.control.VIEW_SET&&(oInstanceData.bViewSetProcessed=!0),transaction.run()}nextQueue=findQueueWithOldestTransaction()}setTimeout(runQueue,50)}function findQueueWithOldestTransaction(){var mapInstanceId,lowestTime,queueId,transaction,instanceData;for(mapInstanceId in oMapInstanceData)instanceData=oMapInstanceData[mapInstanceId],instanceData&&instanceData.running&&instanceData.transQueue.length>0&&(transaction=instanceData.transQueue[0],transaction&&(!lowestTime||transaction.creationTime<lowestTime)&&(lowestTime=transaction.creationTime,queueId=mapInstanceId));return queueId}function cancelTransaction(transactionId){var oInstanceData,i,len,transaction=transHash[transactionId],success=!1;if(transaction){for(oInstanceData=oMapInstanceData[transaction.mapInstanceId],len=oInstanceData.transQueue.length,i=0;i<len;i++)if(oInstanceData.transQueue[i].transactionId===transactionId){oInstanceData.transQueue.splice(i,1),delete transHash[transactionId];break}}else if(transaction=publicInterface.processHash[transactionId]){var o;transaction.intent===emp.intents.control.DRAW_BEGIN?(o=new emp.typeLibrary.Transaction({transactionId:emp.helpers.id.newGUID(),mapInstanceId:transaction.mapInstanceId,intent:emp.intents.control.DRAW_CANCEL,source:transaction.source,originChannel:transaction.originChannel,items:[transaction.items[0]]}),o.run(),success=!0):transaction.intent===emp.intents.control.EDIT_BEGIN?(o=new emp.typeLibrary.Transaction({transactionId:emp.helpers.id.newGUID(),intent:emp.intents.control.EDIT_CANCEL,mapInstanceId:transaction.mapInstanceId,source:transaction.source,originChannel:transaction.originChannel,items:[transaction.items[0]]}),o.run(),success=!0):emp.typeLibrary.Error({message:"The "+transaction.intent+" transaction with the id '"+transactionId+"' was found, and could not be cancelled."})}else emp.typeLibrary.Error({message:"No transaction with the id '"+transactionId+"' could be found.  The transaction could not be cancelled."});return success}function endTransaction(transactionId){var oInstanceData,len,transaction=transHash[transactionId],success=!1;if(transaction){oInstanceData=oMapInstanceData[transaction.mapInstanceId],len=oInstanceData.transQueue.length;for(var i=0;i<len;i++)if(oInstanceData.transQueue[i].transactionId===transactionId){oInstanceData.transQueue.splice(i,1),delete transHash[transactionId];break}}else if(transaction=publicInterface.processHash[transactionId]){var o;transaction.intent===emp.intents.control.DRAW_BEGIN?(o=new emp.typeLibrary.Transaction({transactionId:emp.helpers.id.newGUID(),intent:emp.intents.control.DRAW_END,mapInstanceId:transaction.mapInstanceId,source:transaction.source,originChannel:transaction.originChannel,items:[transaction.items[0]]}),o.run(),success=!0):transaction.intent===emp.intents.control.EDIT_BEGIN?(o=new emp.typeLibrary.Transaction({transactionId:emp.helpers.id.newGUID(),intent:emp.intents.control.EDIT_END,mapInstanceId:transaction.mapInstanceId,source:transaction.source,originChannel:transaction.originChannel,items:[transaction.items[0]]}),o.run(),success=!0):emp.typeLibrary.Error({message:"The "+transaction.intent+" transaction with the id '"+transactionId+"' was found, but can not be completed."})}else emp.typeLibrary.Error({message:"No transaction with the id '"+transactionId+"' could not be found.  The transaction could not be completed."});return success}function dispatch(event){var len,i,instanceId=event.transaction.mapInstanceId,callbacks=listeners.getItem(event.type+instanceId),success={success:!1,message:"An unanticipated error has occurred in emp.transactionQueue.dispatch"};try{if(null!==callbacks&&void 0!==callbacks)for(callbacks=callbacks.concat([]),len=callbacks.length,i=0;i<len;i+=1)if(null!==callbacks[i])try{callbacks[i](event.transaction)}catch(err){emp.errorHandler.log(emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.INFO,jsError:err,message:"An error occurred in emp.transactionQueue.dispatch while attempting to invoke a callback function"}))}}catch(err2){success={success:!1,message:err2.toString()}}return success}var outstandingTimer,mapInstanceData=function(args){return{mapInstanceId:args.mapInstanceId,transQueue:[],running:!1,pauseCnt:1,bViewSetProcessed:!1}},transHash={},outstandingTimeout=5e3,listeners=new emp.utilities.Hash,oOutstandingTransaction=null,oMapInstanceData={},oMapInstanceIdList=[],publicInterface={isTransactionOutStanding:function(mapInstanceId){var sTransID;for(sTransID in publicInterface.processHash)if(publicInterface.processHash.hasOwnProperty(sTransID)&&publicInterface.processHash[sTransID].mapInstanceId===mapInstanceId)return!0;return!1},add:function(transaction){var oInstanceData=oMapInstanceData[transaction.mapInstanceId];transaction.state="queued",oInstanceData.transQueue.push(transaction),transHash[transaction.transactionId]=transaction},print:function(){var mapInstanceId,oInstanceData,transactionQueueString,i;for(mapInstanceId in oMapInstanceData){for(oInstanceData=oMapInstanceData[mapInstanceId],console.log("================ Map Instance: "+mapInstanceId+" =================="),transactionQueueString="",i=0;i<oInstanceData.transQueue.length;i+=1)console.log(i+": "+oInstanceData.transQueue[i].intent+"\n");console.log(transactionQueueString)}},end:function(transactionId){return endTransaction(transactionId)},cancel:function(transactionId){return cancelTransaction(transactionId)},_complete:function(transaction){transaction.returnDuplicatesToItems(),transaction.intent!==emp.intents.control.POINTER&&transaction.intent!==emp.intents.control.STATIC_CONTENT&&dispatch({type:emp.intents.control.TRANSACTION_COMPLETE,transaction:transaction}),dispatch({type:transaction.intent,transaction:transaction}),null!==oOutstandingTransaction&&transaction.transactionId===oOutstandingTransaction.transactionId&&(outstandingTimer&&(clearTimeout(outstandingTimer),outstandingTimer=null),oOutstandingTransaction=null)},_progress:function(transaction){transaction.intent!==emp.intents.control.POINTER&&dispatch({type:emp.intents.control.TRANSACTION_PROGRESS,transaction:transaction}),dispatch({type:transaction.intent,transaction:transaction})},_custom:function(transaction){transaction.returnDuplicatesToItems(),dispatch({type:transaction.intent,transaction:transaction}),null!==oOutstandingTransaction&&transaction.transactionId===oOutstandingTransaction.transactionId&&(oOutstandingTransaction=null,outstandingTimer&&(clearTimeout(outstandingTimer),outstandingTimer=null))},pause:function(mapInstanceId){var oInstanceData=oMapInstanceData[mapInstanceId];oInstanceData&&(oInstanceData.running=!1,oInstanceData.pauseCnt++)},run:function(mapInstanceId){var oInstanceData=oMapInstanceData[mapInstanceId];oInstanceData&&(oInstanceData.pauseCnt--,oInstanceData.pauseCnt<=0&&(oInstanceData.running=!0,oInstanceData.pauseCnt=0))},processHash:{},listener:{add:function(listenerInfo){var listener;if(listenerInfo.mapInstanceId||(listenerInfo.mapInstanceId=""),listener=listeners.getItem(listenerInfo.type+listenerInfo.mapInstanceId),null!==listener&&void 0!==listener)listener.push(listenerInfo.callback);else{var callbacks=[];callbacks.push(listenerInfo.callback),listeners.setItem(listenerInfo.type+listenerInfo.mapInstanceId,callbacks)}},remove:function(listenerInfo){var callbackArray,len,i,listener;if(listenerInfo.mapInstanceId||(listenerInfo.mapInstanceId=""),listener=listeners.getItem(listenerInfo.type+listenerInfo.mapInstanceId),null!==listener&&void 0!==listener)for(callbackArray=listeners.getItem(listenerInfo.type+listenerInfo.mapInstanceId),len=callbackArray.length,i=0;i<len;i+=1)if(callbackArray[i]===listenerInfo.callback)return callbackArray.splice(i,1),!0;return!1}},newMapInstance:function(args){void 0===oMapInstanceData[args.mapInstanceId]&&(oMapInstanceData[args.mapInstanceId]=mapInstanceData(args),oMapInstanceIdList.push(args.mapInstanceId))},removeMapInstance:function(mapInstanceId){var iIndex,oTrans,oInstanceData=oMapInstanceData[mapInstanceId];if(void 0!==oInstanceData){for(outstandingTimer&&oOutstandingTransaction&&oOutstandingTransaction.mapInstanceId===mapInstanceId&&(clearTimeout(outstandingTimer),this.processHash.hasOwnProperty(oOutstandingTransaction.transactionId)&&delete this.processHash[oOutstandingTransaction.transactionId],oOutstandingTransaction=null);oInstanceData.transQueue.length>0;)oTrans=oInstanceData.transQueue[0],oInstanceData.transQueue.splice(0,1),transHash.hasOwnProperty(oTrans.transactionId)&&delete transHash[oTrans.transactionId];delete oMapInstanceData[mapInstanceId],iIndex=oMapInstanceIdList.indexOf(mapInstanceId),iIndex!==-1&&oMapInstanceIdList.splice(iIndex,1)}},purgeMapQueue:function(sMapInstanceId){var oTrans,oInstanceData=oMapInstanceData[sMapInstanceId];if(void 0!==oInstanceData)for(outstandingTimer&&oOutstandingTransaction&&oOutstandingTransaction.mapInstanceId===sMapInstanceId&&(clearTimeout(outstandingTimer),this.processHash.hasOwnProperty(oOutstandingTransaction.transactionId)&&delete this.processHash[oOutstandingTransaction.transactionId],oOutstandingTransaction=null);oInstanceData.transQueue.length>0;)oTrans=oInstanceData.transQueue.splice(0,1)[0],oTrans.run(),transHash.hasOwnProperty(oTrans.transactionId)&&delete transHash[oTrans.transactionId]},dumpMapQueue:function(sMapInstanceId){var oTrans,oInstanceData=oMapInstanceData[sMapInstanceId];if(void 0!==oInstanceData)for(outstandingTimer&&oOutstandingTransaction&&oOutstandingTransaction.mapInstanceId===sMapInstanceId&&(clearTimeout(outstandingTimer),this.processHash.hasOwnProperty(oOutstandingTransaction.transactionId)&&delete this.processHash[oOutstandingTransaction.transactionId],oOutstandingTransaction=null);oInstanceData.transQueue.length>0;)oTrans=oInstanceData.transQueue.splice(0,1)[0],transHash.hasOwnProperty(oTrans.transactionId)&&delete transHash[oTrans.transactionId]},getMapQueueSize:function(sMapInstanceId){var oInstanceData=oMapInstanceData[sMapInstanceId];return void 0!==oInstanceData?oInstanceData.transQueue.length:emp.helpers.associativeArray.size(transHash)}};return runQueue(),publicInterface}(),emp.editingManager=function(args){var editTransaction,feature,activeEditor,updateData,originalFeature,mapInstance=args.mapInstance,publicInterface={edit:function(transaction){var standard,symbolCode,basicCode,symbolDef,unitDef,drawCategory,symbol=!1;transaction.pause(),editTransaction=transaction,mapInstance.eventing.EditStart({transaction:editTransaction,featureId:editTransaction.items[0].featureId,overlayId:editTransaction.items[0].overlayId,parentId:editTransaction.items[0].parentId}),editTransaction.items[0].update({name:editTransaction.items[0].name,updates:{},properties:editTransaction.items[0].properties,updateEventType:emp.typeLibrary.UpdateEventType.START,mapInstanceId:mapInstance.mapInstanceId}),feature=emp.storage.get.id({id:editTransaction.items[0].originFeature.coreId}),feature&&(feature=feature.getObjectData(mapInstance.mapInstanceId,emp.storage.getRootGuid(mapInstance.mapInstanceId)),feature=emp.helpers.copyObject(feature),originalFeature=emp.helpers.copyObject(feature),originalFeature.coreParent=void 0,originalFeature.overlayId=emp.constant.parentIds.ALL_PARENTS,feature.coreParent=void 0,feature.overlayId=emp.constant.parentIds.ALL_PARENTS),feature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(symbol=!0,symbolCode=feature.data.symbolCode,feature.properties&&feature.properties.modifiers&&(standard=feature.properties.modifiers.standard||1),basicCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(symbolCode,standard),armyc2.c2sd.renderer.utilities.SymbolDefTable.hasSymbolDef(basicCode,standard)?(symbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicCode,standard),symbolDef&&(drawCategory=symbolDef.drawCategory)):(unitDef=armyc2.c2sd.renderer.utilities.UnitDefTable.getUnitDef(basicCode,standard),unitDef&&(drawCategory=unitDef.drawCategory))),activeEditor=feature.format===emp3.api.enums.FeatureTypeEnum.GEO_POINT||symbol&&drawCategory===armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_POINT?new emp.editors.Point({feature:feature,mapInstance:args.mapInstance}):feature.format===emp3.api.enums.FeatureTypeEnum.GEO_PATH||symbol&&drawCategory===armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_LINE?new emp.editors.Path({feature:feature,mapInstance:args.mapInstance}):feature.format===emp3.api.enums.FeatureTypeEnum.GEO_POLYGON?new emp.editors.Polygon({feature:feature,mapInstance:args.mapInstance}):symbol&&drawCategory===armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_POLYGON?new emp.editors.MilStdPolygon({feature:feature,mapInstance:args.mapInstance}):new emp.editors.EditorBase({feature:feature,mapInstance:args.mapInstance}),activeEditor.addControlPoints()},cancel:function(){var transaction,initFailList=[];initFailList.push(new emp.typeLibrary.Error({coreId:editTransaction.items[0].coreId,message:"The editing was cancelled.",level:emp.typeLibrary.Error.level.INFO})),editTransaction.items[0].originFeature=originalFeature,mapInstance.eventing.EditEnd({transaction:editTransaction,failures:initFailList}),activeEditor.removeControlPoints(),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:mapInstance.mapInstanceId,transactionId:null,sender:mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[originalFeature]}),transaction.run(),editTransaction.run(),editTransaction=void 0,feature=void 0,activeEditor=void 0,updateData=void 0,originalFeature=void 0},complete:function(){var item,transaction;editTransaction.items[0].updatedFeature=activeEditor.featureCopy,mapInstance.eventing.EditEnd({transaction:editTransaction}),activeEditor.removeControlPoints(),item=activeEditor.featureCopy,transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:mapInstance.mapInstanceId,transactionId:null,sender:mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[item]}),editTransaction.items[0].update({name:feature.name,updates:updateData.coordinateUpdate,properties:updateData.properties,updateEventType:emp.typeLibrary.UpdateEventType.COMPLETE,mapInstanceId:mapInstance.mapInstanceId}),transaction.run(),editTransaction.run(),editTransaction=void 0,feature=void 0,activeEditor=void 0,updateData=void 0,originalFeature=void 0},editMouseDown:function(featureId){var mapLock,lockMapTransaction;(originalFeature&&featureId===originalFeature.featureId||activeEditor.isControlPoint(featureId))&&(mapLock=new emp.typeLibrary.Lock({lock:emp3.api.enums.MapMotionLockEnum.NO_MOTION}),lockMapTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:mapInstance.mapInstanceId,source:mapInstance.mapInstanceId,messageOriginator:mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_VIEW_LOCK,items:[mapLock]}),lockMapTransaction.run())},editDragStart:function(featureId,pointer){var transaction,lockMapTransaction,mapLock,updateData;originalFeature&&featureId===originalFeature.featureId&&activeEditor.isFeature(featureId)?(transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstance.mapInstanceId,intent:emp.intents.control.POINTER,originChannel:"cmapi2.map.view.drag",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[pointer]}),transaction.run()):activeEditor.isControlPoint(featureId)?(updateData=activeEditor.startMoveControlPoint(featureId,pointer),updateData&&editTransaction.items[0].update({name:feature.name,updates:updateData.coordinateUpdate,properties:updateData.properties,updateEventType:emp.typeLibrary.UpdateEventType.UPDATE,mapInstanceId:mapInstance.mapInstanceId})):(mapLock=new emp.typeLibrary.Lock({lock:emp3.api.enums.MapMotionLockEnum.SMART_MOTION}),lockMapTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:mapInstance.mapInstanceId,source:mapInstance.mapInstanceId,messageOriginator:mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_VIEW_LOCK,items:[mapLock]}),lockMapTransaction.run())},editDragMove:function(featureId,startX,startY,pointer){originalFeature&&featureId===originalFeature.featureId&&activeEditor.isFeature(featureId)?(updateData=activeEditor.moveFeature(startX,startY,pointer),updateData&&editTransaction.items[0].update({name:feature.name,updates:updateData.coordinateUpdate,properties:updateData.properties,updateEventType:emp.typeLibrary.UpdateEventType.UPDATE,mapInstanceId:mapInstance.mapInstanceId})):activeEditor.isControlPoint(featureId)&&(updateData=activeEditor.moveControlPoint(featureId,pointer),updateData&&editTransaction.items[0].update({name:feature.name,updates:updateData.coordinateUpdate,properties:updateData.properties,updateEventType:emp.typeLibrary.UpdateEventType.UPDATE,mapInstanceId:mapInstance.mapInstanceId}))},editDragComplete:function(featureId,startX,startY,pointer){var transaction,lockMapTransaction,mapLock;originalFeature&&featureId===originalFeature.featureId&&activeEditor.isFeature(featureId)?updateData=activeEditor.moveFeature(startX,startY,pointer):activeEditor.isControlPoint(featureId)&&(updateData=activeEditor.endMoveControlPoint(featureId,pointer)),transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstance.mapInstanceId,intent:emp.intents.control.POINTER,originChannel:"cmapi2.map.view.dragComplete",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[pointer]}),transaction.run(),updateData&&editTransaction.items[0].update({name:feature.name,updates:updateData.coordinateUpdate,properties:updateData.properties,updateEventType:emp.typeLibrary.UpdateEventType.UPDATE,mapInstanceId:mapInstance.mapInstanceId
}),mapLock=new emp.typeLibrary.Lock({lock:emp3.api.enums.MapMotionLockEnum.UNLOCKED}),lockMapTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:mapInstance.mapInstanceId,source:mapInstance.mapInstanceId,messageOriginator:mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_VIEW_LOCK,items:[mapLock]}),lockMapTransaction.run()}};return publicInterface},emp.typeLibrary={},emp.typeLibrary.types={DRAW:"draw",EDIT:"edit",ERROR:"error",FEATURE:"feature",MENU:"menu",OVERLAY:"overlay",POINTER:"pointer",SELECTION:"selection",SELECTION_BOX:"selectionBox",STATIC:"static",STATUS:"status",TRANSACTION:"transaction",VIEW:"view",LOOKAT:"lookAt",WMS:"wms",WMTS:"wmts",KML:"kmllayer",OVERLAY_CLUSTER:"overlayCluster"},emp.typeLibrary.UpdateEventType={UPDATE:"update",COMPLETE:"complete",START:"start"},emp.typeLibrary.CoordinateUpdateType={UPDATE:"update",REMOVE:"remove",ADD:"add"},emp.typeLibrary.featureFormatType=emp.constant.featureFormatType,emp.typeLibrary.featureMilStdVersionType=emp.constant.featureMilStdVersionType,emp.typeLibrary.featureAltitudeModeType=emp.constant.featureAltitudeModeType,emp.typeLibrary.orbitTurnType=emp.constant.orbitTurnType,emp.typeLibrary.BoundingBoxType=function(args){this.east=args.east,this.north=args.north,this.west=args.west,this.south=args.south},emp.typeLibrary.airspaceSymbolCode=emp.constant.airspaceSymbolCode,emp.typeLibrary.parentRelationship=function(args){this.parent=args.parent,this.visible=args.visible,this.visibilitySetting=args.visibilitySetting},emp.typeLibrary.AOIType=emp.constant.AOIType,emp.typeLibrary.OutlineStyleType=emp.constant.OutlineStyleType,emp.typeLibrary.utils=emp.typeLibrary.utils||{},emp.typeLibrary.utils.milstd=emp.typeLibrary.utils.milstd||{},emp.typeLibrary.utils.milstd.AOI=emp.typeLibrary.utils.milstd.AOI||{},emp.typeLibrary.utils.milstd.AOI.isAOI=function(oItem){var bRet=!1,oGeoJson=oItem.data;return oGeoJson.hasOwnProperty("type")&&"feature"===oGeoJson.type.toLowerCase()&&oGeoJson.hasOwnProperty("properties")&&oGeoJson.properties.hasOwnProperty("aoi")&&(bRet=!0),bRet},emp.typeLibrary.utils.milstd.AOI.getAOISymbolCode=function(aoiType){var result,eAOIType=emp.typeLibrary.AOIType;switch(aoiType){case eAOIType.POINT_RADIUS:result="BBS_POINT------";break;case eAOIType.LINE:result="BBS_LINE-------";break;case eAOIType.POLYGON:result="BBS_AREA-------";break;case eAOIType.BBOX:result="BBS_RECTANGLE--"}return result},emp.typeLibrary.utils.milstd.AOI.getModifiers=function(oItem){var oGeoJson=emp.helpers.copyObject(oItem.data),oProperties=oGeoJson.properties,newModifiers=emp.helpers.copyObject(oItem.properties.modifiers)||{};return newModifiers.T=oItem.name,newModifiers.AM=oItem.data.properties.aoi.buffer,oProperties&&(oProperties.hasOwnProperty("fillColor")&&(newModifiers.fillColor=oProperties.fillColor),oProperties.hasOwnProperty("lineColor")&&(newModifiers.lineColor=oProperties.lineColor)),newModifiers.fillColor||oGeoJson&&oGeoJson.properties.hasOwnProperty("fillColor")&&(newModifiers.fillColor=oGeoJson.properties.fillColor),newModifiers.lineColor||oGeoJson&&oGeoJson.properties.hasOwnProperty("lineColor")&&(newModifiers.lineColor=oGeoJson.properties.lineColor),newModifiers.fillColor||(newModifiers.fillColor="99AAAAAA"),newModifiers},emp.typeLibrary.utils.milstd.Modifiers={C_QUANTITY:armyc2.c2sd.renderer.utilities.ModifiersTG.C_QUANTITY,H_ADDITIONAL_INFO_1:armyc2.c2sd.renderer.utilities.ModifiersTG.H_ADDITIONAL_INFO_1,H1_ADDITIONAL_INFO_2:armyc2.c2sd.renderer.utilities.ModifiersTG.H1_ADDITIONAL_INFO_2,H2_ADDITIONAL_INFO_3:armyc2.c2sd.renderer.utilities.ModifiersTG.H2_ADDITIONAL_INFO_3,N_HOSTILE:armyc2.c2sd.renderer.utilities.ModifiersTG.N_HOSTILE,Q_DIRECTION_OF_MOVEMENT:armyc2.c2sd.renderer.utilities.ModifiersTG.Q_DIRECTION_OF_MOVEMENT,S_OFFSET_INDICATOR:armyc2.c2sd.renderer.utilities.ModifiersTG.S_OFFSET_INDICATOR,T_UNIQUE_DESIGNATION_1:armyc2.c2sd.renderer.utilities.ModifiersTG.T_UNIQUE_DESIGNATION_1,T1_UNIQUE_DESIGNATION_2:armyc2.c2sd.renderer.utilities.ModifiersTG.T1_UNIQUE_DESIGNATION_2,V_EQUIP_TYPE:armyc2.c2sd.renderer.utilities.ModifiersTG.V_EQUIP_TYPE,W_DTG_1:armyc2.c2sd.renderer.utilities.ModifiersTG.W_DTG_1,W1_DTG_2:armyc2.c2sd.renderer.utilities.ModifiersTG.W1_DTG_2,X_ALTITUDE_DEPTH:armyc2.c2sd.renderer.utilities.ModifiersTG.X_ALTITUDE_DEPTH,Y_LOCATION:armyc2.c2sd.renderer.utilities.ModifiersTG.Y_LOCATION,AM_DISTANCE:armyc2.c2sd.renderer.utilities.ModifiersTG.AM_DISTANCE,AN_AZIMUTH:armyc2.c2sd.renderer.utilities.ModifiersTG.AN_AZIMUTH,F_REDUCED_OR_REINFORCED:"F",G_STAFF_COMMENTS:"G",J_EVALUATION_RATING:"J",K_COMBAT_EFFECTIVENESS:"K",L_SIGNATURE_EQUIPMENT:"L",M_HIGHER_FORMATION:"M",P_IFF_SIF:"P",Z_SPEED:"Z",AA_SPECIAL_C2_HEADQUARTERS:"AA",STANDARD:"SYMSTD"},emp.typeLibrary.utils.milstd.StringModifiers={C_QUANTITY:"quantity",F_REDUCED_OR_REINFORCED:"reinforcedOrReduced",G_STAFF_COMMENTS:"staffComments",H_ADDITIONAL_INFO_1:"additionalInfo1",H1_ADDITIONAL_INFO_2:"additionalInfo2",H2_ADDITIONAL_INFO_3:"additionalInfo3",J_EVALUATION_RATING:"evaluationRating",K_COMBAT_EFFECTIVENESS:"combatEffectiveness",L_SIGNATURE_EQUIPMENT:"signatureEquipment",M_HIGHER_FORMATION:"higherFormation",N_HOSTILE:"hostile",P_IFF_SIF:"iffSif",Q_DIRECTION_OF_MOVEMENT:"directionOfMovement",S_OFFSET_INDICATOR:"offsetIndicator",T_UNIQUE_DESIGNATION_1:"uniqueDesignation1",T1_UNIQUE_DESIGNATION_2:"uniqueDesignation2",V_EQUIP_TYPE:"equipmentType",W_DTG_1:"dateTimeGroup1",W1_DTG_2:"dateTimeGroup2",X_ALTITUDE_DEPTH:"altitudeDepth",Y_LOCATION:"location",Z_SPEED:"speed",AA_SPECIAL_C2_HEADQUARTERS:"specialC2Headquarters",AM_DISTANCE:"distance",AN_AZIMUTH:"azimuth",FILL_COLOR:"fillColor",LINE_COLOR:"lineColor",X_OFFSET:"xOffset",X_UNITS:"xUnits",Y_OFFSET:"yOffset",Y_UNITS:"yUnits",SIZE:"size",LINE_THICKNESS:"lineThickness",HEADING:"heading",STANDARD:"standard"},emp.typeLibrary.utils.milstd.String2Modifier=function(){var mapping={},longModifiers=emp.typeLibrary.utils.milstd.StringModifiers,s2525Modifiers=emp.typeLibrary.utils.milstd.Modifiers;return mapping[longModifiers.C_QUANTITY]=s2525Modifiers.C_QUANTITY,mapping[longModifiers.F_REDUCED_OR_REINFORCED]=s2525Modifiers.F_REDUCED_OR_REINFORCED,mapping[longModifiers.G_STAFF_COMMENTS]=s2525Modifiers.G_STAFF_COMMENTS,mapping[longModifiers.H_ADDITIONAL_INFO_1]=s2525Modifiers.H_ADDITIONAL_INFO_1,mapping[longModifiers.H1_ADDITIONAL_INFO_2]=s2525Modifiers.H1_ADDITIONAL_INFO_2,mapping[longModifiers.H2_ADDITIONAL_INFO_3]=s2525Modifiers.H2_ADDITIONAL_INFO_3,mapping[longModifiers.J_EVALUATION_RATING]=s2525Modifiers.J_EVALUATION_RATING,mapping[longModifiers.K_COMBAT_EFFECTIVENESS]=s2525Modifiers.K_COMBAT_EFFECTIVENESS,mapping[longModifiers.L_SIGNATURE_EQUIPMENT]=s2525Modifiers.L_SIGNATURE_EQUIPMENT,mapping[longModifiers.M_HIGHER_FORMATION]=s2525Modifiers.M_HIGHER_FORMATION,mapping[longModifiers.N_HOSTILE]=s2525Modifiers.N_HOSTILE,mapping[longModifiers.P_IFF_SIF]=s2525Modifiers.P_IFF_SIF,mapping[longModifiers.Q_DIRECTION_OF_MOVEMENT]=s2525Modifiers.Q_DIRECTION_OF_MOVEMENT,mapping[longModifiers.S_OFFSET_INDICATOR]=s2525Modifiers.S_OFFSET_INDICATOR,mapping[longModifiers.T_UNIQUE_DESIGNATION_1]=s2525Modifiers.T_UNIQUE_DESIGNATION_1,mapping[longModifiers.T1_UNIQUE_DESIGNATION_2]=s2525Modifiers.T1_UNIQUE_DESIGNATION_2,mapping[longModifiers.V_EQUIP_TYPE]=s2525Modifiers.V_EQUIP_TYPE,mapping[longModifiers.W_DTG_1]=s2525Modifiers.W_DTG_1,mapping[longModifiers.W1_DTG_2]=s2525Modifiers.W1_DTG_2,mapping[longModifiers.X_ALTITUDE_DEPTH]=s2525Modifiers.X_ALTITUDE_DEPTH,mapping[longModifiers.Y_LOCATION]=s2525Modifiers.Y_LOCATION,mapping[longModifiers.Z_SPEED]=s2525Modifiers.Z_SPEED,mapping[longModifiers.AA_SPECIAL_C2_HEADQUARTERS]=s2525Modifiers.AA_SPECIAL_C2_HEADQUARTERS,mapping[longModifiers.AM_DISTANCE]=s2525Modifiers.AM_DISTANCE,mapping[longModifiers.AN_AZIMUTH]=s2525Modifiers.AN_AZIMUTH,mapping[longModifiers.HEADING]=s2525Modifiers.Q_DIRECTION_OF_MOVEMENT,mapping}(),emp.typeLibrary.utils.milstd.Modifier2String=function(){var mapping={},longModifiers=emp.typeLibrary.utils.milstd.StringModifiers,s2525Modifiers=emp.typeLibrary.utils.milstd.Modifiers;return mapping[s2525Modifiers.C_QUANTITY]=longModifiers.C_QUANTITY,mapping[s2525Modifiers.F_REDUCED_OR_REINFORCED]=longModifiers.F_REDUCED_OR_REINFORCED,mapping[s2525Modifiers.G_STAFF_COMMENTS]=longModifiers.G_STAFF_COMMENTS,mapping[s2525Modifiers.H_ADDITIONAL_INFO_1]=longModifiers.H_ADDITIONAL_INFO_1,mapping[s2525Modifiers.H1_ADDITIONAL_INFO_2]=longModifiers.H1_ADDITIONAL_INFO_2,mapping[s2525Modifiers.H2_ADDITIONAL_INFO_3]=longModifiers.H2_ADDITIONAL_INFO_3,mapping[s2525Modifiers.J_EVALUATION_RATING]=longModifiers.J_EVALUATION_RATING,mapping[s2525Modifiers.K_COMBAT_EFFECTIVENESS]=longModifiers.K_COMBAT_EFFECTIVENESS,mapping[s2525Modifiers.L_SIGNATURE_EQUIPMENT]=longModifiers.L_SIGNATURE_EQUIPMENT,mapping[s2525Modifiers.M_HIGHER_FORMATION]=longModifiers.M_HIGHER_FORMATION,mapping[s2525Modifiers.N_HOSTILE]=longModifiers.N_HOSTILE,mapping[s2525Modifiers.P_IFF_SIF]=longModifiers.P_IFF_SIF,mapping[s2525Modifiers.Q_DIRECTION_OF_MOVEMENT]=longModifiers.Q_DIRECTION_OF_MOVEMENT,mapping[s2525Modifiers.S_OFFSET_INDICATOR]=longModifiers.S_OFFSET_INDICATOR,mapping[s2525Modifiers.T_UNIQUE_DESIGNATION_1]=longModifiers.T_UNIQUE_DESIGNATION_1,mapping[s2525Modifiers.T1_UNIQUE_DESIGNATION_2]=longModifiers.T1_UNIQUE_DESIGNATION_2,mapping[s2525Modifiers.V_EQUIP_TYPE]=longModifiers.V_EQUIP_TYPE,mapping[s2525Modifiers.W_DTG_1]=longModifiers.W_DTG_1,mapping[s2525Modifiers.W1_DTG_2]=longModifiers.W1_DTG_2,mapping[s2525Modifiers.X_ALTITUDE_DEPTH]=longModifiers.X_ALTITUDE_DEPTH,mapping[s2525Modifiers.Y_LOCATION]=longModifiers.Y_LOCATION,mapping[s2525Modifiers.Z_SPEED]=longModifiers.Z_SPEED,mapping[s2525Modifiers.AA_SPECIAL_C2_HEADQUARTERS]=longModifiers.AA_SPECIAL_C2_HEADQUARTERS,mapping[s2525Modifiers.AM_DISTANCE]=longModifiers.AM_DISTANCE,mapping[s2525Modifiers.AN_AZIMUTH]=longModifiers.AN_AZIMUTH,mapping[s2525Modifiers.HEADING]=longModifiers.Q_DIRECTION_OF_MOVEMENT,mapping}(),emp.typeLibrary.utils.milstd.convertModifiers2Strings=function(oModifiers){var aStringModifiers={};for(var sModifier in oModifiers)emp.typeLibrary.utils.milstd.Modifier2String.hasOwnProperty(sModifier)&&(aStringModifiers[emp.typeLibrary.utils.milstd.Modifier2String[sModifier]]=oModifiers[sModifier]);return aStringModifiers},emp.typeLibrary.utils.milstd.convertStrings2Modifiers=function(oStringModifiers){var oModifiers={};for(var sModifier in oStringModifiers)emp.typeLibrary.utils.milstd.String2Modifier.hasOwnProperty(sModifier)&&(oModifiers[emp.typeLibrary.utils.milstd.String2Modifier[sModifier]]=oStringModifiers[sModifier]);return oModifiers},emp.typeLibrary.featureMilStdVersionType.convertToString=function(iValue){var sRet=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;switch(iValue){case 0:sRet=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;break;case 1:sRet=emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C}return sRet},emp.typeLibrary.LatLonCoordinates=function(args){this.lat=args.lat,this.lon=args.lon,"number"==typeof args.alt&&(this.alt=args.alt)},emp.typeLibrary.CoordinateUpdate=function(args){this.type=args.type,this.indices=args.indices,this.coordinates=args.coordinates,this.geojsonCoordToLatLonCoordinates=function(oGeoJsonCoord){var oLLCoord;return oLLCoord=oGeoJsonCoord.length>2?new emp.typeLibrary.LatLonCoordinates({lat:oGeoJsonCoord[1],lon:oGeoJsonCoord[0],alt:oGeoJsonCoord[2]}):new emp.typeLibrary.LatLonCoordinates({lat:oGeoJsonCoord[1],lon:oGeoJsonCoord[0]})},this.convertFromGeoJson=function(oGeoJsonData){var oCoordList=[];if(!oGeoJsonData.hasOwnProperty("type"))throw new Error("Argument object with no type property.");if(!(oGeoJsonData.hasOwnProperty("coordinates")&&oGeoJsonData.coordinates instanceof Array))throw new Error("Argument object with no or invalid coordinates property.");var iIndex;switch(oGeoJsonData.type.toLowerCase()){case"point":oGeoJsonData.coordinates.length>0&&oCoordList.push(this.geojsonCoordToLatLonCoordinates(oGeoJsonData.coordinates));break;case"linestring":for(iIndex=0;iIndex<oGeoJsonData.coordinates.length;iIndex++)oCoordList.push(this.geojsonCoordToLatLonCoordinates(oGeoJsonData.coordinates[iIndex]));break;case"polygon":if(0===oGeoJsonData.coordinates.length||!(oGeoJsonData.coordinates[0]instanceof Array))throw new Error("Argument object with an invalid polygon coordinates property.");for(iIndex=0;iIndex<oGeoJsonData.coordinates[0].length;iIndex++)oCoordList.push(this.geojsonCoordToLatLonCoordinates(oGeoJsonData.coordinates[0][iIndex]))}this.coordinates=oCoordList}},emp.typeLibrary.Convert=function(args){this.x=args.x,this.y=args.y,this.lat=args.lat,this.lon=args.lon,this.invalid=!1},emp.typeLibrary.base={validate:function(){if(emp.validate===!0){var message,i,valid=tv4.validateMultiple(this,this.schema);if(!valid.valid){for(message="An emp.typeLibrary "+this.globalType+" Object has failed to validate: ",message+=" ",i=0;i<valid.errors.length;i++)message+="\n "+valid.errors[i].message+" "+valid.errors[i].schemaPath+" "+valid.errors[i].dataPath;return emp.typeLibrary.Error({sender:this.sender,message:message,transactionId:this.transactionId,coreId:this.coreId,level:emp.typeLibrary.Error.level.INFO}),this.valid=!1,!1}return this.valid=!0,!0}},getVisibilityCount:function(){var iCount=0;if(this.isMultiParentRequired()){var oRelationship;for(var sCoreId in this.parentNodes)oRelationship=this.parentNodes[sCoreId],oRelationship.visible&&iCount++}else iCount=this.visible?1:0;return iCount},isVisibilityAffected:function(sParentCoreId,bVisible){var bSend=!1;if(this.isMultiParentRequired()){var iPrevVisibilityCount=this.getVisibilityCount();this.parentNodes.hasOwnProperty(sParentCoreId)&&(1===iPrevVisibilityCount&&!bVisible&&this.parentNodes[sParentCoreId].visible?bSend=!0:0===iPrevVisibilityCount&&bVisible&&this.parentNodes[sParentCoreId].visibilitySetting?bSend=!0:!bVisible&&this.parentNodes[sParentCoreId].visible?this.parentNodes[sParentCoreId].visible=bVisible:bVisible&&!this.parentNodes[sParentCoreId].visible&&this.parentNodes[sParentCoreId].visibilitySetting&&(this.parentNodes[sParentCoreId].visible=bVisible),bSend&&(this.parentNodes[sParentCoreId].visible=bVisible))}else this.visible!==bVisible&&(bVisible?this.visibilitySetting&&(bSend=!0):bSend=!0);return bSend&&(this.visible=bVisible),bSend},addAffectedChildren:function(oTransaction,bVisible){var oChild,oDupChild,oaItems=oTransaction.items,bAffected=!1;for(var sChildCoreId in this.nodes)if(oChild=this.nodes[sChildCoreId],bAffected=oChild.isVisibilityAffected(this.coreId,bVisible)){if(oTransaction.isOnItemsList(oChild))continue;switch(oDupChild=oChild.createDuplicate(),oDupChild.coreParent=this.coreId,oaItems.push(oDupChild),oChild.globalType){case emp.typeLibrary.types.OVERLAY:this.isMultiParentRequired()&&oTransaction.duplicate(oChild.coreId)}oChild.addAffectedChildren(oTransaction,bVisible)}else bVisible&&oChild.getVisibilityWithParent(this.coreId)&&oChild.addAffectedChildren(oTransaction,bVisible)},visibility:function(oTransaction,sParentCoreId,bVisible,bGoDeep){var oItem,oaItems=oTransaction.items;switch(this.globalType){case emp.typeLibrary.types.OVERLAY:case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.STATIC:break;default:return void emp.errorHandler.log(emp.typeLibrary.Error({level:1,message:"Visibility called on incompatible object",jsError:"",coreId:this.coreId}))}if("boolean"==typeof bVisible)if(this.setVisibilityWithParent(sParentCoreId,bVisible)){switch(oItem=this.createDuplicate(),oItem.coreParent=sParentCoreId,oaItems.push(oItem),this.globalType){case emp.typeLibrary.types.OVERLAY:this.isMultiParentRequired()&&this.coreParent!==emp.storage.getRootGuid(oTransaction.mapInstanceId)&&oTransaction.duplicate(oItem.coreId)}bGoDeep&&this.addAffectedChildren(oTransaction,bVisible)}else oItem=this.createDuplicate(),oItem.coreParent=sParentCoreId,oaItems.push(oItem),oTransaction.duplicate(oItem.coreId)},locate:function(args){var transaction,payload;return args=args||{},args.component=args.component||"",payload={coreId:this.coreId,overlayId:this.overlayId,parentId:this.parentId,featureId:this.featureId||this.id,zoom:!0,visible:!0},transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,source:emp.core.sources.CORE,items:function(){var r=[];return r.push(new emp.typeLibrary.View(payload)),r}}),"de"!==args.component?transaction:void transaction.run()},getRootCoreId:function(){var oRootCoreId=emp.storage.getRootGuid();return this.isMultiParentRequired()&&(oRootCoreId=void 0!==this.parentNodes[oRootCoreId]?this.coreId:this.multiParentRootId),oRootCoreId},getRootParent:function(){if(this.isMultiParentRequired()){var oRootCoreId=this.getRootCoreId();return emp.storage.get.id({id:oRootCoreId})}},hasChildren:function(){return!emp.helpers.associativeArray.isEmpty(this.nodes)},hasParents:function(){return!emp.helpers.associativeArray.isEmpty(this.parentNodes)},removeFromAllParent:function(){var oParent;if(this.isMultiParentRequired()){var oMultiParentRoot,aParentCoreIdList=this.getParentCoreIds();oMultiParentRoot=this.getRootParent();for(var iIndex=0;iIndex<aParentCoreIdList.length;iIndex++)oParent=this.parentNodes[aParentCoreIdList[iIndex]].parent,oParent.removeChild(this);oMultiParentRoot&&this.coreId!==oMultiParentRoot.coreId&&oMultiParentRoot.childNodes.hasOwnProperty(this.coreId)&&delete oMultiParentRoot.childNodes[this.coreId]}else oParent=emp.storage.get.id({id:this.coreParent}),void 0!==oParent&&oParent.removeChild(this)},isUnderParent:function(sCoreId){var oParent,bRet=!1;if(this.coreId===sCoreId)bRet=!0;else if(this.isMultiParentRequired()){var oRelationship;for(var sParentCoreId in this.parentNodes)if(oRelationship=this.parentNodes[sParentCoreId],oRelationship.parent.isUnderParent(sCoreId)){bRet=!0;break}}else oParent=emp.storage.get.id({id:this.coreParent}),oParent&&(bRet=oParent.isUnderParent(sCoreId));return bRet},removeChild:function(oChild){if(this.nodes.hasOwnProperty(oChild.coreId)){if(oChild.removeFromOverlayFeatureList(this),this.isMultiParentRequired()||this.coreId===emp.storage.getRootGuid()&&oChild.isMultiParentRequired()){var oMultiParentRoot;oMultiParentRoot=this.coreId===emp.storage.getRootGuid()?oChild.getRootParent():this.getRootParent(),oChild.parentNodes[this.coreId]&&delete oChild.parentNodes[this.coreId],!oChild.hasParents()&&oChild.globalType===emp.typeLibrary.types.FEATURE&&oMultiParentRoot&&oChild.coreId!==oMultiParentRoot.coreId&&oMultiParentRoot.childNodes.hasOwnProperty(this.coreId)&&delete oMultiParentRoot.childNodes[this.coreId]}delete this.nodes[oChild.coreId]}},removeFromOverlayFeatureList:function(oParent){if(this.globalType===emp.typeLibrary.types.FEATURE||this.globalType===emp.typeLibrary.types.WMS){var oCurrentParent;if(oParent.globalType===emp.typeLibrary.types.OVERLAY)oParent.removeFromFeatureList(this),this.removeAllChildrenFromOverlayFeatureList(oParent);else if(this.isMultiParentRequired())for(var sParentCoreId in oParent.parentNodes)oCurrentParent=oParent.parentNodes[sParentCoreId].parent,this.removeFromOverlayFeatureList(oCurrentParent);else oCurrentParent=emp.storage.get.id({id:oParent.coreParent}),this.removeFromOverlayFeatureList(oCurrentParent),this.removeAllChildrenFromOverlayFeatureList(oCurrentParent)}},removeAllChildrenFromOverlayFeatureList:function(oOverlay){if(this.globalType===emp.typeLibrary.types.FEATURE||this.globalType===emp.typeLibrary.types.WMS){var oChild;for(var sCoreId in this.nodes)oChild=this.nodes[sCoreId],oChild.removeAllChildrenFromOverlayFeatureList(oOverlay),oOverlay.removeFromFeatureList(oChild)}},addAllChildrenToOverlayFeatureList:function(oOverlay){if(this.globalType===emp.typeLibrary.types.FEATURE||this.globalType===emp.typeLibrary.types.WMS){var oChild;for(var sCoreId in this.nodes)oChild=this.nodes[sCoreId],oOverlay.isOnFeatureList(oChild)||(oOverlay.addToFeatureList(oChild),oChild.addAllChildrenToOverlayFeatureList(oOverlay))}},addToOverlayFeatureList:function(oParent){if(this.globalType===emp.typeLibrary.types.FEATURE||this.globalType===emp.typeLibrary.types.WMS){var oCurrentParent;if(oParent.globalType===emp.typeLibrary.types.OVERLAY)oParent.addToFeatureList(this),this.addAllChildrenToOverlayFeatureList(oParent);else if(this.isMultiParentRequired())for(var sParentCoreId in oParent.parentNodes)oCurrentParent=oParent.parentNodes[sParentCoreId].parent,oCurrentParent.globalType!==emp.typeLibrary.types.OVERLAY?this.addToOverlayFeatureList(oCurrentParent):(oCurrentParent.addToFeatureList(this),this.addAllChildrenToOverlayFeatureList(oCurrentParent));else oCurrentParent=emp.storage.findOverlay(oParent.overlayId),oCurrentParent.addToFeatureList(this),this.addAllChildrenToOverlayFeatureList(oCurrentParent)}},addParent:function(oParent,bVisible,bVisibleSetting){if(this.isMultiParentRequired()){if(!this.parentNodes.hasOwnProperty(oParent.coreId)){var oMultiParentRoot=oParent.getRootParent(),oRelationship=new emp.typeLibrary.parentRelationship({parent:oParent,visible:!!oParent.visible&&bVisible,visibilitySetting:bVisibleSetting});this.parentNodes[oParent.coreId]=oRelationship,oParent.addChild(this,bVisible,bVisibleSetting),this.globalType===emp.typeLibrary.types.FEATURE&&(oMultiParentRoot.childNodes.hasOwnProperty(this.coreId)||(oMultiParentRoot.childNodes[this.coreId]=this,this.parentCoreId=oMultiParentRoot.coreId)),this.multiParentRootId=oMultiParentRoot?oMultiParentRoot.coreId:void 0}}else this.coreParent=oParent.coreId,this.parentCoreId=oParent.coreId,this.visible=!!oParent.visible&&bVisible,this.visibilitySetting=bVisibleSetting,oParent.addChild(this,bVisible,bVisibleSetting)},addChild:function(oChild,bVisible,bVisibleSetting){this.nodes.hasOwnProperty(oChild.coreId)||(this.nodes[oChild.coreId]=oChild,oChild.addToOverlayFeatureList(this),oChild.addParent(this,bVisible,bVisibleSetting))},getChildrenCoreIds:function(){return emp.helpers.associativeArray.getKeys(this.nodes)},getParentCoreIds:function(){return emp.helpers.associativeArray.getKeys(this.parentNodes)},childrenCount:function(){return emp.helpers.associativeArray.size(this.nodes)},parentCount:function(){return emp.helpers.associativeArray.size(this.parentNodes)},getChild:function(sCoreId){return this.nodes[sCoreId]},getParent:function(sCoreId){if(this.parentNodes[sCoreId])return this.parentNodes[sCoreId].parent},isMultiParentRequired:function(){return!(!this.hasOwnProperty("properties")||!this.properties.hasOwnProperty("multiParentRequired"))&&this.properties.multiParentRequired===!0},hasChildNodes:function(){return!emp.helpers.associativeArray.isEmpty(this.childNodes)},getChildNodesCoreIds:function(){return emp.helpers.associativeArray.getKeys(this.childNodes)},getVisibilitySettingWithParent:function(sParentCodeId){var sParentID=sParentCodeId?sParentCodeId:emp.storage.getRootGuid();return this.isMultiParentRequired()?!!this.parentNodes.hasOwnProperty(sParentID)&&this.parentNodes[sParentID].visibilitySetting:this.visibilitySetting},getVisibilityWithParent:function(sParentCodeId){var sParentID=sParentCodeId?sParentCodeId:emp.storage.getRootGuid();return this.isMultiParentRequired()?!!this.parentNodes.hasOwnProperty(sParentID)&&this.parentNodes[sParentID].visible:this.visible},setVisibilityWithParent:function(sParentCodeId,bSetting){var sParentID=sParentCodeId?sParentCodeId:emp.storage.getRootGuid(),bSend=!1;if(this.isMultiParentRequired()){var iPrevVisibilityCount=this.getVisibilityCount();this.parentNodes.hasOwnProperty(sParentID)&&(this.parentNodes[sParentID].visible=bSetting,this.parentNodes[sParentID].visibilitySetting=bSetting);var iCurrentVisibilityCount=this.getVisibilityCount();bSetting&&0===iPrevVisibilityCount&&1===iCurrentVisibilityCount?bSend=!0:bSetting||1!==iPrevVisibilityCount||0!==iCurrentVisibilityCount||(bSend=!0)}else this.visible!==bSetting&&(bSend=!0);return bSend&&(this.visible=bSetting,this.visibilitySetting=bSetting),bSend},isVisible:function(){var oParent,bRet=!1;if(this.isMultiParentRequired()){for(var sCoreId in this.parentNodes)if(this.parentNodes[sCoreId].visible){if(sCoreId===emp.storage.getRootGuid())return!0;if(oParent=this.parentNodes[sCoreId].parent,oParent.isVisible())return!0}}else if(this.visible){if(this.coreParent===emp.storage.getRootGuid())return!0;if(oParent=emp.storage.get.id({id:this.coreParent}))return oParent.isVisible()}return bRet}},emp.typeLibrary.Transaction=function(args){this.creationTime=Date.now(),this.coreId=emp.helpers.id.newGUID(),this.sendTransactionComplete=function(args){return args.sendTransactionComplete===!0||args.sendTransactionComplete!==!1&&!!args.transactionId}(args),this.transactionId=args.transactionId||emp.helpers.id.newGUID(),this.messageId=args.messageId,this.mapInstanceId=args.mapInstanceId||"",this.globalType=emp.typeLibrary.types.TRANSACTION,this.sender=args.sender,this.originChannel=args.originChannel,this.originination=args.origination,this.source=args.source||emp.core.sources.CORE,this.intent=args.intent,this.intentParams=args.intentParams,this.options=args.options,this.type="transaction",this.throttled=!1,this.complete=!0,"function"==typeof args.items?this.items=args.items():this.items=args.items,this.successes=[],this.fail=function(args){var i,x,removedItem;for(Array.isArray(args)||(args=[args]),this.hasOwnProperty("failures")||(this.failures=[]),i=0;i<args.length;i+=1)for(x=0;x<this.items.length;x+=1)if(this.items[x].coreId===args[i].coreId){switch(removedItem=this.items.splice(x,1),this.intent){case emp.intents.control.WMS_ADD:args[i].id=removedItem[0].id,args[i].overlayId=removedItem[0].overlayId;break;case emp.intents.control.MENU_CONTEXT_CREATE:args[i].menuId=removedItem[0].menuId;break;case emp.intents.control.VISIBILITY_GET:args[i].targetId=removedItem[0].coreId,args[i].parentId=removedItem[0].parentId;break;default:args[i].overlayId=removedItem[0].overlayId,args[i].featureId=removedItem[0].featureId,args[i].parentId=removedItem[0].parentId}this.failures.push(args[i]);break}},this.failures=[],this.failInvalidItems=function(){var i,type="undefined",coreId="undefined",message="";if(void 0!==this.items&&null!==this.items)for(i=0;i<this.items.length;i++)this.items[i]&&this.items[i].valid===!1&&(this.items[i].hasOwnProperty("coreId")&&(coreId=this.items[i].coreId),this.items[i].hasOwnProperty("globalType")&&(type=this.items[i].globalType),message="The item with a core ID of "+coreId+" of type "+type+" is not valid and has been moved to the failure list on the transaction with an id of "+this.transactionId,this.fail([emp.typeLibrary.Error({coreId:this.items[i].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:message})]))},this.queue=function(){this.state="queued",emp.transactionQueue.add(this)},this.sequenceNumber=0,this.lastNumber=1,this.closeNumber=0,this.state="init",this.inTask=!1,this.runner=function(){var i,e,control=emp.intents.getSequence(this);if(this.inTask=!0,"paused"===this.state)return this.inTask=!1,!1;do for(i=this.sequenceNumber;i<control.forward.length;i+=1)if(this.items.length<1)this.state="run";else if(this.lastNumber!==i){this.lastNumber=i;try{control.forward[i](this)}catch(err){for(emp.typeLibrary.Error({coreId:this.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Intent "+this.intent+" function "+i+" generated an exception. All items are placed on the fail list.",jsError:err});this.items.length>0;)this.fail({coreId:this.items[0].coreId});this.state="running"}if(this.sequenceNumber=i,"paused"===this.state)return this.sequenceNumber=this.sequenceNumber+1,this.inTask=!1,!1}while(this.getNextItemSet());if("paused"===this.state)return this.sequenceNumber++,this.inTask=!1,!1;for(e=this.closeNumber;e<control.exit.length;e+=1)try{control.exit[e](this)}catch(err){for(emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"Intent "+this.intent+" exit function "+i+" generated an exception. All items are placed on the fail list.",jsError:err});this.items.length>0;)this.fail({coreId:this.items[0].coreId})}emp.transactionQueue.processHash.hasOwnProperty(this.transactionId)&&delete emp.transactionQueue.processHash[this.transactionId],this.inTask=!1},this.pause=function(){this.state="paused"},this.run=function(){emp.transactionQueue.processHash.hasOwnProperty(this.transactionId)||(emp.transactionQueue.processHash[this.transactionId]=this,this.prepItemsForExecution(),this.failInvalidItems(),this.checkTransactionSplicing()),this.inTask===!0?this.state="running":this.inTask===!1&&(this.state="running",this.runner())},this.checkTransactionSplicing=function(){switch(this.intent){case emp.intents.control.FEATURE_ADD:case emp.intents.control.FEATURE_REMOVE:case emp.intents.control.VISIBILITY_SET:case emp.intents.control.SELECTION_SET:case emp.intents.control.WMS_ADD:case emp.intents.control.WMS_REMOVE:case emp.intents.control.OVERLAY_ADD:case emp.intents.control.OVERLAY_REMOVE:case emp.intents.control.OVERLAY_UPDATE:if(this.items&&this.items.length>1){var sTempStr=JSON.stringify(this);sTempStr.length>2e6&&(this.pendingItems=this.items,this.items=[],this.getNextItemSet())}}},this.getNextItemSet=function(){if(this.pendingItems&&this.pendingItems.length>0){for(var sTempStr,iCumSize=0;this.items.length>0;)this.duplicate(this.items[0].coreId);for(var iNextChunkSize,oItem,iItemCnt=0;this.pendingItems.length>0&&iItemCnt<500&&(oItem=this.pendingItems[0],sTempStr=JSON.stringify(oItem),iNextChunkSize=sTempStr.length,!(iCumSize+iNextChunkSize>2e6&&this.items.length>0));)iCumSize+=iNextChunkSize,this.items.push(oItem),this.pendingItems.splice(0,1),iItemCnt++;return this.sequenceNumber=0,this.lastNumber=1,!0}return!1},this.originalMessage=args.originalMessage,this.messageOriginator=args.messageOriginator,this.originalMessageType=args.originalMessageType,this.duplicateItems=[],this.duplicate=function(sCoreId){var iIndex,removedItem;for(iIndex=0;iIndex<this.items.length;iIndex++)if(this.items[iIndex].coreId===sCoreId)return removedItem=this.items.splice(iIndex,1),void this.duplicateItems.push(removedItem[0])},this.returnDuplicatesToItems=function(){var iIndex;for(iIndex=0;iIndex<this.duplicateItems.length;iIndex++)this.items.push(this.duplicateItems[iIndex]);this.duplicateItems=[]},this.prepItemsForExecution=function(){var iIndex,item,len=this.items.length;for(iIndex=0;iIndex<len;iIndex++)item=this.items[iIndex],void 0!==item&&null!==item&&item.hasOwnProperty("prepForExecution")&&"function"==typeof item.prepForExecution&&item.prepForExecution()},this.isOnItemsList=function(oItem){var iIndex;for(iIndex=0;iIndex<this.items.length;iIndex++)if(this.items[iIndex].coreId===oItem.coreId)return!0;for(iIndex=0;iIndex<this.duplicateItems.length;iIndex++)if(this.duplicateItems[iIndex].coreId===oItem.coreId)return!0;return!1},this.pushToItemsList=function(oItem){this.isOnItemsList(oItem)||this.items.push(oItem)}},emp.typeLibrary.Overlay=function(args){this.intent=args.intent||"false",this.transactionId=args.transactionId,this.globalType=emp.typeLibrary.types.OVERLAY,this.tName=args.name,this.sender=args.sender||emp.helpers.id.newGUID(),this.name=function(args){if(void 0!==args.tName&&null!==args.tName)return args.tName;if("overlay.update"!==args.intent){var r="Overlay "+args.sender;return r}}(this),this.description=args.description||"No Description",this.type="overlay",this.disabled=!1,this.overlayId=args.overlayId||args.sender,this.coreId=this.overlayId,this.parentId=emp.helpers.id.get.setId(args.parentId),this.coreParent=args.coreParent||this.parentId,this.visible=args.visible!==!1,this.properties=args.properties||{},this.properties.hasOwnProperty("readOnly")?this.properties.readOnly=this.properties.readOnly!==!1:this.properties.readOnly=args.readOnly===!0||!1,this.hidden=args.hidden||!1,this.schema={title:"EMP-Overlay Schema",type:"object",properties:{overlayId:{type:"string"},name:{type:["string","null"]},parentId:{type:["string","null"]},iconUrl:{type:"string"},description:{type:"string"},permissions:{type:"boolean"},visible:{type:"boolean"},properties:{type:"object"},transactionId:{type:["string","null"]
}},required:["overlayId"]},this.validate(),this.createParent=function(){var transaction,payload;payload={name:"Overlay "+this.sender,overlayId:this.parentId},transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_ADD,originChannel:"map.overlay.create",sender:this.sender,transactionType:"overlay",type:"transaction",items:function(){var r=[];return r.push(new emp.typeLibrary.Overlay(payload)),r}}),transaction.run()},this.getObjectData=function(){return{overlayId:this.overlayId,parentId:this.parentId,name:this.name,description:this.description,disabled:this.disabled,readOnly:this.readOnly,visible:this.visible,iconUrl:this.iconUrl,properties:emp.helpers.copyObject(this.properties)}},this.createDuplicate=function(){var oNewOverlay,stringFeature=JSON.stringify(this),objectFeature=JSON.parse(stringFeature);return oNewOverlay=new emp.typeLibrary.Overlay(objectFeature)},this.prepForExecution=function(){}},emp.typeLibrary.Overlay.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.OverlayStyle=function(args){this.coreId=args.overlayId,this.overlayId=args.overlayId,this.type=args.type||"all",this.properties=args.properties,this.iconUrl=args.iconUrl,this.schema={title:"EMP-Overlay-Style Schema",type:"object",properties:{overlayId:{type:"string"},type:{type:"string",enum:["point","line","polygon","multigeometry","all"]},properties:{type:["object","null"]}},required:["overlayId"]},this.validate()},emp.typeLibrary.OverlayStyle.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.OverlayStyleType={POINT:"point",LINE:"line",POLYGON:"polygon",MULTIGEOMETRY:"multigeometry"},emp.typeLibrary.Overlay.Cluster=function(args){this.coreId=void 0,this.oClusterStyle=void 0,args instanceof emp.typeLibrary.Overlay.Cluster?(this.overlayId=args.getOverlayId(),this.iThreshold=args.getThreshold(),this.iDistance=args.getDistance(),this.oClusterStyle=args.getClusterStyle(),this.oClusterStyle&&(this.oClusterStyle=new emp.typeLibrary.Overlay.Cluster.Style(this.oClusterStyle))):(this.overlayId=args.overlayId,this.iThreshold=args.threshold||2,this.iDistance=args.distance||50,args.clusterStyle&&(this.oClusterStyle=new emp.typeLibrary.Overlay.Cluster.Style(args.clusterStyle))),this.globalType=emp.typeLibrary.types.OVERLAY_CLUSTER,this.getCoreId=function(){return this.coreId},this.getOverlayId=function(){return this.overlayId},this.getThreshold=function(){return this.iThreshold},this.getDistance=function(){return this.iDistance},this.getClusterStyle=function(){return this.oClusterStyle},this.prepForExecution=function(){var oOveraly=emp.storage.findOverlay(this.overlayId);oOveraly&&(this.coreId=oOveraly.coreId)}},emp.typeLibrary.Overlay.Cluster.Style=function(oCS){this.oPointStyle=void 0,this.oIconStyle=void 0,oCS instanceof emp.typeLibrary.Overlay.Cluster.Style?(this.sLabel=oCS.getLabel(),this.sTitle=oCS.getTitle(),this.sSummary=oCS.getSummary(),this.sDescription=oCS.getDescription(),this.oPointStyle=oCS.getPointStyle(),this.oIconStyle=oCS.getIconStyle(),this.oPointStyle&&(this.oPointStyle=new emp.typeLibrary.Overlay.Cluster.Style.PointStyle(this.oPointStyle)),this.oIconStyle&&(this.oIconStyle=new emp.typeLibrary.Overlay.Cluster.Style.IconStyle(this.oIconStyle))):(this.sLabel=oCS.label,this.sTitle=oCS.title,this.sSummary=oCS.summary,this.sDescription=oCS.description,this.oPointStyle=void 0,this.oIconStyle=void 0,oCS.pointStyle&&(this.oPointStyle=new emp.typeLibrary.Overlay.Cluster.Style.PointStyle(oCS.pointStyle)),oCS.iconStyle&&(this.oIconStyle=new emp.typeLibrary.Overlay.Cluster.Style.IconStyle(oCS.iconStyle))),this.getLabel=function(){return this.sLabel},this.getTitle=function(){return this.sTitle},this.getSummary=function(){return this.sSummary},this.getDescription=function(){return this.sDescription},this.getPointStyle=function(){return this.oPointStyle},this.getIconStyle=function(){return this.oIconStyle}},emp.typeLibrary.Overlay.Cluster.Style.PointStyle=function(oPS){oPS instanceof emp.typeLibrary.Overlay.Cluster.Style.PointStyle?(this.iRadius=oPS.getRadius(),this.oColor=oPS.getColor(),this.oColor&&(this.oColor=new emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color(this.oColor))):(this.iRadius=oPS.radius||6,this.oColor=void 0,oPS.color&&(this.oColor=new emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color(oPS.color))),this.getColor=function(){return this.oColor},this.getRadius=function(){return this.iRadius},this.createIcon=function(sText){var iRadius=this.getRadius(),oColor="#"+this.oColor.getHexColor();return emp.helpers.createCircleCanvas({iRadius:iRadius,dOpacity:this.oColor.getAlpha(),sFillColor:oColor,sTextColor:"black",sText:sText})}},emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color=function(oColor){oColor instanceof emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color?(this.iRed=oColor.getRed(),this.iGreen=oColor.getGreen(),this.iBlue=oColor.getBlue(),this.dAlpha=oColor.getAlpha()):(this.iRed=0,this.iGreen=0,this.iBlue=0,this.dAlpha=1,"number"==typeof oColor.r?this.iRed=Math.round(Math.abs(oColor.r))%256:"string"==typeof oColor.r&&(this.iRed=Math.round(Math.abs(parseInt(oColor.r)))%256),"number"==typeof oColor.g?this.iGreen=Math.round(Math.abs(oColor.g))%256:"string"==typeof oColor.g&&(this.iGreen=Math.round(Math.abs(parseInt(oColor.g)))%256),"number"==typeof oColor.b?this.iBlue=Math.round(Math.abs(oColor.b))%256:"string"==typeof oColor.b&&(this.iBlue=Math.round(Math.abs(parseInt(oColor.b)))%256),"number"==typeof oColor.a?this.dAlpha=Math.round(10*Math.abs(oColor.a))/10:"string"==typeof oColor.a&&(this.dAlpha=Math.round(10*Math.abs(parseFloat(oColor.a)))/10)),this.getRed=function(){return this.iRed},this.getGreen=function(){return this.iGreen},this.getBlue=function(){return this.iBlue},this.getAlpha=function(){return this.dAlpha},this.getHexColor=function(){var sColor="",sByte=this.iRed.toString(16);return 1===sByte.length&&(sByte="0"+sByte),sColor+=sByte,sByte=this.iGreen.toString(16),1===sByte.length&&(sByte="0"+sByte),sColor+=sByte,sByte=this.iBlue.toString(16),1===sByte.length&&(sByte="0"+sByte),sColor+=sByte},this.getFullHexColor=function(){var sColor=this.getHexColor(),sByte=Math.round(255*this.dAlpha).toString(16);return 1===sByte.length&&(sByte="0"+sByte),sColor=sByte+sColor}},emp.typeLibrary.Overlay.Cluster.Style.IconStyle=function(oIS){oIS instanceof emp.typeLibrary.Overlay.Cluster.Style.IconStyle?this.sUrl=oIS.getURL():this.sUrl=oIS.url,this.getURL=function(){return this.sUrl}},emp.typeLibrary.Feature=function(args){if(this.intentParams=args.intentParams,this.featureId=emp.helpers.id.get.setId(args.featureId),this.overlayId=emp.helpers.id.get.setId(args.overlayId)||args.sender,this.parentId=emp.helpers.id.get.setId(args.parentId),this.destOverlayId=emp.helpers.id.get.setId(args.newOverlayId),this.destParentId=emp.helpers.id.get.setId(args.newParentId),this.format="feature.update"!==this.intent?args.format||"kml":null,this.globalType=emp.typeLibrary.types.FEATURE,this.data={},args.data?this.data=emp.helpers.copyObject(args.data):args.feature&&(this.data=emp.helpers.copyObject(args.feature)),this.zoom=args.zoom||!1,this.menuId=args.menuId||"",this.url=args.url,this.params=args.params||{},this.visible=args.visible!==!1,this.visibilitySetting=args.visibilitySetting||this.visible,this.description=args.description?unescape(args.description):"",this.selected=args.selected||!1,this.symbolCode=this.data.symbolCode,this.color="993366ff",this.coordinates=this.data.coordinates,this.properties=args.properties?emp.helpers.copyObject(args.properties):{},this.properties.modifiers&&(this.properties.modifiers=function(args){return JSON.parse("string"==typeof args.properties.modifiers?unescape(args.properties.modifiers):JSON.stringify(args.properties.modifiers))}(this)),this.properties.hasOwnProperty("disabled")?this.properties.disabled=this.properties.disabled===!0:this.properties.disabled=!1,this.disabled=this.properties.disabled,this.properties.readOnly!==!0&&this.properties.readOnly!==!1&&(this.readOnly===!0||this.readOnly===!1?this.properties.readOnly=this.readOnly:this.properties.readOnly=!1),this.properties.hasOwnProperty("iconUrl")&&(this.properties.iconUrl=this.properties.iconUrl.trim(),this.properties.iconUrl=emp.helpers.relToAbs(this.properties.iconUrl)),this.readOnly=this.properties.readOnly,this.complete=args.complete,this.updateEventType=args.updateEventType,this.updates=args.updates,void 0!==this.overlayId&&null!==this.overlayId&&void 0!==this.parentId&&null!==this.parentId){var tempCoreParentId=this.overlayId+"."+this.parentId,tempParent=emp.storage.get.id({id:tempCoreParentId});tempParent&&(this.disabled=tempParent&&void 0!==tempParent.disabled&&null!==tempParent.disabled?this.disabled||tempParent.disabled:this.disabled)}this.name=args.name,this.schema={title:"EMP-Feature Schema",type:"object",properties:{featureId:{type:"string"},name:{type:["string","null"]},data:{type:["object","string"]},format:{type:["string","null"],enum:[null,"geojson","kml","image",emp3.api.enums.FeatureTypeEnum.GEO_POINT,emp3.api.enums.FeatureTypeEnum.GEO_PATH,emp3.api.enums.FeatureTypeEnum.GEO_POLYGON,emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL,emp3.api.enums.FeatureTypeEnum.GEO_ACM,emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE,emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE,emp3.api.enums.FeatureTypeEnum.GEO_SQUARE,emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE,emp3.api.enums.FeatureTypeEnum.GEO_TEXT]},overlayId:{type:"string"},zoom:{type:"boolean"},properties:{type:["object","null"],properties:{altitudeMode:{type:["string","null"],enum:[null,emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND,emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND,emp.typeLibrary.featureAltitudeModeType.ABSOLUTE]}}},menuId:{type:"string"},params:{type:"object"},visible:{type:"boolean"},disable:{type:"boolean"}},required:["featureId","data","format","overlayId"]},void 0!==this.url&null!==this.url&&""!==this.url&&(this.schema.properties.url={},this.schema.properties.url.type="string",this.schema.required=["featureId","url","format","overlayId"],this.schema.properties.format.enum=["kml","geojson","image","arc"]),this.createParent=function(){var transaction,payload;void 0!==this.parentId&&null!==this.parentId||(payload={name:"Overlay "+this.overlayId,overlayId:this.overlayId},transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_ADD,originChannel:"map.overlay.create",sender:this.sender,items:function(){var r=[];return r.push(new emp.typeLibrary.Overlay(payload)),r}}),transaction.run())},this.createDestinationParent=function(){var transaction,payload;payload={name:"Overlay "+this.destOverlayId,overlayId:this.destOverlayId,parentId:""},transaction=new emp.typeLibrary.Transaction({length:1,intent:"overlay.add",transactionId:this.transactionId+".parent",originChannel:"map.overlay.create",sender:this.sender,transactionType:"overlay",type:"transaction",items:function(){var r=[];return r.push(new emp.typeLibrary.Overlay(payload)),r}}),transaction.run()},this.coreId=args.coreId,this.coreParent=args.coreParent,this.parentCoreId=args.parentCoreId,this.destCoreId=void 0,this.destCoreParent=void 0,this.currentlyInEditMode=!1,this.setEditMode=function(bValue){this.currentlyInEditMode=bValue},this.isInEditMode=function(){return this.currentlyInEditMode},this.getFeatureStructure=function(){return{overlayId:this.overlayId,parentId:this.parentId,featureId:this.featureId,name:this.name,description:this.description,format:this.format,data:emp.helpers.copyObject(this.data),menuId:this.menuId,url:this.url,params:this.params,visible:this.visible,readOnly:this.properties.readOnly,properties:emp.helpers.copyObject(this.properties)}},this.getObjectData=function(){return this.getFeatureStructure()},this.copyFromFeature=function(oFromFeature){oFromFeature.hasOwnProperty("name")&&(this.name=oFromFeature.name),oFromFeature.hasOwnProperty("data")&&(this.symbolCode=void 0,this.coordinates={},this.data=emp.helpers.copyObject(oFromFeature.data),this.data.hasOwnProperty("symbolCode")&&(this.symbolCode=oFromFeature.data.symbolCode),this.data.hasOwnProperty("coordinates")&&(this.coordinates=oFromFeature.data.coordinates)),oFromFeature.hasOwnProperty("properties")&&(this.properties=emp.helpers.copyObject(oFromFeature.properties)),oFromFeature.hasOwnProperty("menuId")&&""!==oFromFeature.menuId&&(this.menuId=oFromFeature.menuId),oFromFeature.hasOwnProperty("url")&&(this.url=oFromFeature.url),oFromFeature.hasOwnProperty("description")&&(this.description=oFromFeature.description),oFromFeature.hasOwnProperty("disabled")&&(this.disabled=oFromFeature.disabled),oFromFeature.hasOwnProperty("readOnly")&&(this.readOnly=oFromFeature.readOnly,this.properties.readOnly=oFromFeature.readOnly)},this.createDuplicate=function(){var oNewFeature,sCoreId=this.coreId,sCoreParent=this.coreParent,sParentCoreId=this.parentCoreId,oNodes=this.nodes,oParentNodes=this.parentNodes,oChildNodes=this.childNodes;this.nodes={},this.parentNodes={},this.childNodes={};var stringFeature=JSON.stringify(this),objectFeature=JSON.parse(stringFeature);return this.nodes=oNodes,this.parentNodes=oParentNodes,this.childNodes=oChildNodes,oNewFeature=new emp.typeLibrary.Feature(objectFeature),oNewFeature.coreId=sCoreId,oNewFeature.coreParent=sCoreParent,oNewFeature.parentCoreId=sParentCoreId,oNewFeature},this.applyUpdate=function(args){if(this.destOverlayId=void 0,this.destParentId=void 0,args.hasOwnProperty("newOverlayId")&&(this.destOverlayId=args.newOverlayId),args.hasOwnProperty("newParentId")&&(this.destParentId=args.newParentId),this.destOverlayId||this.destParentId){var oParent;oParent=this.destParentId?emp.storage.findFeature(this.destOverlayId,this.destParentId):emp.storage.findOverlay(this.destOverlayId),this.destCoreParent=oParent?oParent.coreId:void 0}if(this.copyFromFeature(args),this.destCoreParent&&null!==this.destCoreParent&&void 0!==this.destCoreParent){var tempParent=emp.storage.get.id({id:this.destCoreParent});tempParent&&(this.disabled=tempParent&&void 0!==tempParent.disabled&&null!==tempParent.disabled?this.disabled||tempParent.disabled:this.disabled)}},this.prepForExecution=function(){if(this.coreId=this.featureId,void 0===this.coreParent)if(this.parentId){var oParent=emp.storage.findFeature(this.overlayId,this.parentId);void 0===oParent?this.coreParent=void 0:this.coreParent=oParent.getCoreId()}else this.coreParent=this.overlayId;if(void 0===this.parentCoreId){var oParentOverlay=emp.storage.findOverlay(this.overlayId);oParentOverlay&&(this.parentCoreId=oParentOverlay.getRootCoreId())}}},emp.typeLibrary.Feature.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Feature.prototype.generateData=function(args){function getXmlString(xmlObj){var output="";return emp.util.each(xmlObj.childNodes,function(node){node.nodeType!==emp.util.enums.DOMNodeTypes.Text&&(output+="<"+node.nodeName,emp.util.each(node.attributes,function(attrib){output+=" "+attrib.name+"=",output+='"'+attrib.value+'"'}),output+=">"),output+=node.childNodes.length>0?getXmlString(node):node.nodeValue,node.nodeType!==emp.util.enums.DOMNodeTypes.Text&&(output+="</"+node.nodeName+">")}),output}function buildGeoJsonPoint(oNewCoordinates){var geoJsonCoords;return geoJsonCoords=void 0===oNewCoordinates[0].alt||null===oNewCoordinates[0].alt?[oNewCoordinates[0].lon,oNewCoordinates[0].lat]:[oNewCoordinates[0].lon,oNewCoordinates[0].lat,oNewCoordinates[0].alt],{type:"Point",coordinates:geoJsonCoords}}function buildGeoJsonLineString(oNewCoordinates){for(var geoJsonCoords=[],iLength=oNewCoordinates.length,iIndex=0;iIndex<iLength;iIndex++)void 0===oNewCoordinates[iIndex].alt||null===oNewCoordinates[iIndex].alt?geoJsonCoords.push([oNewCoordinates[iIndex].lon,oNewCoordinates[iIndex].lat]):geoJsonCoords.push([oNewCoordinates[iIndex].lon,oNewCoordinates[iIndex].lat,oNewCoordinates[iIndex].alt]);return{type:"LineString",coordinates:geoJsonCoords}}function buildGeoJsonPolygon(oNewCoordinates){for(var geoJsonCoords=[],iLength=oNewCoordinates.length,iIndex=0;iIndex<iLength;iIndex++)void 0===oNewCoordinates[iIndex].alt||null===oNewCoordinates[iIndex].alt?geoJsonCoords.push([oNewCoordinates[iIndex].lon,oNewCoordinates[iIndex].lat]):geoJsonCoords.push([oNewCoordinates[iIndex].lon,oNewCoordinates[iIndex].lat,oNewCoordinates[iIndex].alt]);return{type:"Polygon",coordinates:[geoJsonCoords]}}function buildGeoJsonFeature(oFeatureData,oNewCoordinates){var oGeometryData,oData=emp.helpers.copyObject(oFeatureData);switch(oData.geometry.type.toLowerCase()){case"point":oGeometryData=buildGeoJsonPoint(oNewCoordinates);break;case"linestring":oGeometryData=buildGeoJsonLineString(oNewCoordinates);break;case"polygon":oGeometryData=buildGeoJsonPolygon(oNewCoordinates);break;default:oGeometryData=oData.geometry}return oData.geometry=oGeometryData,oData}var len,i,geoJsonCoords=[],data={},format=args.feature.format||"geojson";switch(format){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:if(len=args.updates.coordinates.length,i=0,geoJsonCoords=[],1===len)geoJsonCoords=void 0===args.updates.coordinates[0].alt||null===args.updates.coordinates[0].alt?[args.updates.coordinates[0].lon,args.updates.coordinates[0].lat]:[args.updates.coordinates[0].lon,args.updates.coordinates[0].lat,args.updates.coordinates[0].alt],data={type:"Point",coordinates:geoJsonCoords};else{for(i=0;i<len;i++)void 0===args.updates.coordinates[i].alt||null===args.updates.coordinates[i].alt?geoJsonCoords.push([args.updates.coordinates[i].lon,args.updates.coordinates[i].lat]):geoJsonCoords.push([args.updates.coordinates[i].lon,args.updates.coordinates[i].lat,args.updates.coordinates[i].alt]);data={type:"LineString",coordinates:geoJsonCoords}}data.symbolCode=args.feature.symbolCode;break;case emp.typeLibrary.featureFormatType.KML:var coords=args.updates.coordinates,coordString="";len=coords.length;var kmlString="";for(i=0;i<len;i++)coordString+=coords[i].lon+","+coords[i].lat,coords[i].hasOwnProperty("alt")&&(coordString+=","+coords[i].alt),i<len-1&&(coordString+=" ");var kmlDoc=emp.util.parseXML(args.feature.data);emp.util.each(kmlDoc.getElementsByTagName("coordinates"),function(coord){coord.childNodes[0].nodeValue=coordString}),kmlString=getXmlString(kmlDoc),data=kmlString;break;case emp.typeLibrary.featureFormatType.GEOJSON:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:switch(len=args.updates.coordinates.length,args.feature.data.type.toLowerCase()){case"point":geoJsonCoords=void 0===args.updates.coordinates[0].alt||null===args.updates.coordinates[0].alt?[args.updates.coordinates[0].lon,args.updates.coordinates[0].lat]:[args.updates.coordinates[0].lon,args.updates.coordinates[0].lat,args.updates.coordinates[0].alt],data={type:"Point",coordinates:geoJsonCoords};break;case"linestring":for(i=0;i<len;i++)void 0===args.updates.coordinates[i].alt||null===args.updates.coordinates[i].alt?geoJsonCoords.push([args.updates.coordinates[i].lon,args.updates.coordinates[i].lat]):geoJsonCoords.push([args.updates.coordinates[i].lon,args.updates.coordinates[i].lat,args.updates.coordinates[i].alt]);data={type:"LineString",coordinates:geoJsonCoords};break;case"polygon":for(i=0;i<len;i++)void 0===args.updates.coordinates[i].alt||null===args.updates.coordinates[i].alt?geoJsonCoords.push([args.updates.coordinates[i].lon,args.updates.coordinates[i].lat]):geoJsonCoords.push([args.updates.coordinates[i].lon,args.updates.coordinates[i].lat,args.updates.coordinates[i].alt]);data={type:"Polygon",coordinates:[geoJsonCoords]};break;case"feature":data=buildGeoJsonFeature(args.feature.data,args.updates.coordinates)}break;default:data=args.feature.data}return data},emp.typeLibrary.Static=function(args){this.name=args.name,this.overlayId=args.overlayId,this.parentId=args.parentId,this.featureId=args.featureId,this.globalType=emp.typeLibrary.types.STATIC,this.visible=args.visible,this.properties={readOnly:!0},this.disabled=!1,this.coreId=function(args){return emp.helpers.isEmptyString(args.coreId)?args.featureId:args.coreId}(args),this.coreParent=function(args){if(!emp.helpers.isEmptyString(args.coreParent))return args.coreParent}(args),this.prepForExecution=function(){}},emp.typeLibrary.Static.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Status=function(args){this.coreId=emp.helpers.id.newGUID(),this.globalType=emp.typeLibrary.types.STATUS,this.intent=args.intent,this.transactionId=args.transactionId,this.sender=args.sender,this.requester=args.sender,this.intentParams=args.intentParams,this.overlay=args.overlay,this.feature=args.feature,this.layer=args.layer,this.status=args.status,this.formats=args.formats,this.about=args.about,this.types=args.types,this.filter=args.filter,this.select=args.select,this.version=args.version,this.coordinateSystem=args.coordinateSystem,this.displayedCoordinateSystem=args.displayedCoordinateSystem,this.widgetName=args.widgetName,this.universalName=args.universalName,this.instanceName=args.instanceName,this.extensions=args.extensions,this.type=args.type,this.recursive=args.recursive||!1,this.schema={title:"EMP-Status Schema",type:"object",properties:{overlay:{type:["array","null"],items:{type:"string"}},feature:{type:["array","null"],items:{type:"string"}},transactionId:{type:["string","null"]},coordinateSystem:{type:["string","null"]},format:{type:["array","null"]},about:{type:["string","null"]},filter:{type:["array","null"]},types:{type:["array","null"],items:{type:"string"}},select:{type:["array","null"]},recursive:{type:["boolean","null"]}}},this.validate()},emp.typeLibrary.Status.prototype.validate=emp.typeLibrary.base.validate;var emp=window.emp||{};emp.typeLibrary=emp.typeLibrary||{},emp.typeLibrary.Lock=function(args){this.lock=args.lock},emp.typeLibrary.LookAt=function(args){this.globalType=emp.typeLibrary.types.VIEW,this.transactionId=args.transactionId,this.sender=args.sender,this.requester=args.sender,this.channel=args.channel,this.overlayId=args.overlayId,this.range=args.range?args.range:1e5,this.latitude=args.latitude?args.latitude:0,this.longitude=args.longitude?args.longitude:0,this.altitude=args.altitude?args.altitude:0,this.tilt=args.tilt?args.tilt:0,this.heading=args.heading?args.heading:0,this.animate=!!args.animate&&args.animate,this.altitudeMode=args.altitudeMode?args.altitudeMode:emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND,this.coreId=args.coreId},emp.typeLibrary.LookAt.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.View=function(args){this.globalType=emp.typeLibrary.types.VIEW,this.transactionId=args.transactionId,this.sender=args.sender,this.requester=args.sender,this.channel=args.channel,this.overlayId=args.overlayId,this.featureId=args.featureId,this.parentId=args.parentId,this.featureId&&!this.overlayId&&(this.overlayId=args.sender),this.altitudeMode=args.altitudeMode||emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND,this.range="number"==typeof args.range?args.range:"number"==typeof args.zoom?args.zoom:void 0,this.altitude="number"==typeof args.altitude?args.altitude:"number"==typeof args.zoom?args.zoom:void 0,this.scale=args.scale,this.zoom=args.zoom||!1,this.tilt=args.tilt,this.roll=args.roll,this.heading=args.heading,this.animate=args.animate,this.location=args.location||args.center,this.bounds=args.bounds,void 0!==this.bounds&&null!==this.bounds&&void 0!==args.bounds.southWest&&null!==args.bounds.southWest&&void 0!==args.bounds.northEast&&null!==args.bounds.northEast&&(this.bounds.west=args.bounds.southWest.lon,this.bounds.east=args.bounds.northEast.lon,this.bounds.south=args.bounds.southWest.lat,this.bounds.north=args.bounds.northEast.lat),this.types=args.types,this.screenshot=args.screenshot,this.coreId=args.coreId,this.prepForExecution=function(){if(void 0===this.coreId||null===this.coreId)if(void 0!==this.featureId&&null!==this.featureId){var oFeature=emp.storage.findFeature(this.overlayId,this.featureId);void 0!==oFeature?this.coreId=oFeature.getCoreId():this.coreId=emp.helpers.id.newGUID()}else if(void 0!==this.overlayId&&null!==this.overlayId){var oOverlay=emp.storage.findOverlay(args.overlayId);void 0!==oOverlay?this.coreId=oOverlay.getCoreId():this.coreId=emp.helpers.id.newGUID()}else this.coreId=emp.helpers.id.newGUID()}},emp.typeLibrary.View.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Menu=function(args){switch(this.intent=args.intent,this.coreId=emp.helpers.id.newGUID(),args.menu?(this.label=args.menu.label||"",this.menuId=args.menu.menuId||"",this.tooltip=args.menu.tooltip||"",this.items=args.menu.items||[],this.menuType=args.menu.menuType||null):(this.items=args.menuItems||args.items,this.menuId=args.menuId,this.properties=args.properties,this.type=args.type,this.menuType=args.menuType||null,this.transactionId=args.transactionId,this.active=args.active,this.label=args.label,this.itemId=args.itemId),this.schema={title:"EMP-Menu Schema",type:"object",properties:{label:{type:["string","null"]},menuId:{type:["string","null"]},tooltip:{type:["string","null"]},items:{type:["array","null"]},type:{type:["string","null"]},menuType:{type:["string","null"],enum:[null,emp.typeLibrary.Menu.Type.MAP_GLOBAL,emp.typeLibrary.Menu.Type.OVERLAY_GLOBAL,emp.typeLibrary.Menu.Type.FEATURE_GLOBAL,emp.typeLibrary.Menu.Type.OBJECT_INSTANCE,emp.typeLibrary.Menu.Type.SUBMENU]},properties:{type:["object","null"],properties:{iconUrl:{type:"string"},type:{type:"string"},lineColor:{type:"string"},lineWidth:{type:"string"},fillColor:{type:"string"}}},active:{type:["boolean","null"]},itemLabel:{type:["string","null"]},transactionId:{type:["string","null"]}}},this.intent){case"menu.draw.create":this.schema.required=[];break;case"menu.draw.remove":break;case"menu.draw.feature":break;case"menu.context.create":this.schema.required=["menuId","items"],this.schema.properties.menuId.type="string";break;case"menu.context.remove":this.schema.required=["menuId"],this.schema.properties.menuId.type="string";break;case"menu.context.active":this.schema.required=["menuId","itemLabel","active"];break;case"menu.context.clicked":this.schema.required=["menuId","itemId","active"]}this.validate()},emp.typeLibrary.Menu.Type={MAP_GLOBAL:"mapglobal",OVERLAY_GLOBAL:"overlayglobal",FEATURE_GLOBAL:"featureglobal",OBJECT_INSTANCE:"objectinstance",SUBMENU:"submenu"},emp.typeLibrary.Menu.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Pointer=function(args){this.globalType=emp.typeLibrary.types.POINTER,this.coreId=function(args){var oStorageItem,oTemp;if(args.coreId){if(oStorageItem=emp.storage.get.id({id:args.coreId}))return oTemp=oStorageItem.getObjectData(null,null),args.overlayId=oTemp.overlayId,args.featureId=oTemp.featureId||oTemp.id,args.parentId=oTemp.parentId,oStorageItem.getCoreId()}else args.overlayId&&args.featureId&&(oStorageItem=emp.storage.findFeature(args.overlayId,args.featureId));return void 0===oStorageItem?emp.helpers.id.newGUID():oStorageItem.getCoreId()}(args),this.lat=args.lat,this.lon=args.lon,this.type=args.type,this.mgrs=args.mgrs,this.popupInfo=args.popupInfo||{title:"",content:""},this.button=args.button,this.keys=args.keys&&args.keys instanceof Array&&args.keys.length>0?args.keys:["none"],this.clientX=args.clientX||null,this.clientY=args.clientY||null,this.screenX=args.screenX||null,this.screenY=args.screenY||null,this.elevation=args.elevation||null,this.featureId=args.featureId,this.overlayId=args.overlayId,this.parentId=args.parentId,this.target=args.target||"globe",this.menuId=args.menuId,this.menuItemId=args.menuItemId,this.scale=args.scale||null,this.range=args.range||null,this.bounds=args.bounds||null,this.schema={title:"map-pointer-event-schema",type:"object",properties:{type:{type:["string","null"]},lat:{type:["number","null"],minimum:-90,maximum:90},lon:{type:["number","null"],minimum:-180,maximum:180},elevation:{type:["number","null"]},mgrs:{type:["string","null"]},button:{type:["string","null"],anyOf:[{format:"left"},{format:"middle"},{format:"right"}]},keys:{type:["array","null"],items:{enum:["alt","ctrl","shift","none","null"]}},clientX:{type:["number","null"]},clientY:{type:["number","null"]},screenX:{type:["number","null"]},screenY:{type:["number","null"]},target:{type:"string",enum:["globe","feature","overlay","point","water","land","sky","space"]},height:{type:["number","null"],minimum:0},width:{type:["number","null"],minimum:0},zoom:{type:["number","null"],minimum:0},scale:{type:["number","null"],minimum:0},bounds:{type:["object","null"],east:{type:["number","null"],minimum:-180,maximum:180},north:{type:["number","null"],minimum:-90,maximum:90},west:{type:["number","null"],minimum:-180,maximum:180},south:{type:["number","null"],minimum:-90,maximum:90}}}},this.validate()},emp.typeLibrary.Pointer.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Pointer.EventType={MOVE:"move",MOUSEUP:"mouseUp",MOUSEDOWN:"mouseDown",SINGLE_CLICK:"single",DBL_CLICK:"double",DRAG:"drag",DRAG_COMPLETE:"dragComplete"},emp.typeLibrary.Pointer.ButtonType={LEFT_BUTTON:"left",MIDDLE_BUTTON:"middle",RIGHT_BUTTON:"right"},emp.typeLibrary.Pointer.KeyType={ALT_KEY:"alt",CTRL_KEY:"ctrl",SHIFT_KEY:"shift",NO_KEY:"none"},emp.typeLibrary.Draw=function(args){if(this.transactionId=args.transactionId,this.globalType=emp.typeLibrary.types.DRAW,this.intent=args.intent,this.featureId=args.featureId,this.name=args.name,this.menuId=args.menuId,this.type=args.type,this.properties=args.properties||{},this.symbolCode=args.symbolCode,this.coordinates=args.coordinates,this.data=args.data||{},this.updates=args.updates,this.source=args.source,this.sender=args.sender,this.autoPopulate=args.autoPopulate,void 0===this.properties.altitudeMode||null===this.properties.altitudeMode)switch(this.type){case"point":case"line":case"polygon":case"path":case"rectangle":case"square":case"circle":case"ellipse":case"text":this.properties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;break;case"milstd":var iStdVersion=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(this.properties.standard);this.properties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND,armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(this.symbolCode,iStdVersion)||(this.properties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND);break;case"airspace":this.properties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND}this.schema={title:"EMP-Draw Schema",type:"object",properties:{featureId:{type:"string"},name:{type:["string","null"]},type:{type:"string"},properties:{type:["object","null"]},transactionId:{type:["string","null"]}},required:["featureId","type"]},this.validate(),this.update=function(args){var o,feature,t=this,sTranID=emp.helpers.id.newGUID(),format="geojson";this.updates=args.updates,emp.api.checkApiSource(this.source)===!0&&(args.properties&&args.properties.v3&&args.properties.v3&&(format=this.type),feature=new emp.typeLibrary.Feature({featureId:t.featureId,name:args.name||t.name,updates:args.updates,properties:args.properties,complete:args.updateEventType===emp.typeLibrary.UpdateEventType.COMPLETE,updateEventType:args.updateEventType,format:format,data:t.data}),feature.transactionId=t.transactionId,void 0!==t.v1Type&&(feature.v1Type=t.v1Type),args.plotFeature&&args.plotFeature.format&&(feature.format=args.plotFeature.format),args.plotFeature&&args.plotFeature.data&&(feature.data=args.plotFeature.data),feature.type=this.type,null!==feature.data.coordinates&&void 0!==feature.data.coordinates||(feature.data.coordinates=[]),o=new emp.typeLibrary.Transaction({transactionId:sTranID,sender:"USER",intent:emp.intents.control.DRAW_UPDATE,mapInstanceId:args.mapInstanceId,intentParams:"",items:[feature]}),o.run())},this.end=function(){},
this.coreId=emp.helpers.id.newGUID();var format="geojson";this.properties&&this.properties.v3&&this.properties.v3&&(format=this.type),this.plotFeature=new emp.typeLibrary.Feature({intent:emp.intents.control.FEATURE_ADD,source:emp.core.sources.MAP,featureId:this.featureId,name:this.name,sender:this.sender,properties:this.properties,format:format,originChannel:"map.feature.plot"}),this.originFeature=void 0,this.prepForExecution=function(){var oFeature=emp.storage.findFeature(this.overlayId,this.featureId);void 0!==oFeature&&(this.originFeature=oFeature.getObjectData(null,null),this.coreId=oFeature.getCoreId())},this.cancel=function(args){if(void 0!==this.originFeature){var oToAPITrans=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_OUTBOUND_PLOT,mapInstanceId:args.mapInstanceId,source:emp.core.sources.MAP,items:[this.originFeature]}),oToMapTran=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_FEATURE_ADD,mapInstanceId:args.mapInstanceId,source:emp.core.sources.MAP,sender:this.sender,items:[this.originFeature]});setTimeout(function(){oToMapTran.run(),oToAPITrans.run()},0)}}},emp.typeLibrary.Draw.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Draw.Types={POINT:"point",LINE:"line",POLYGON:"polygon",PATH:"path",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle",SQUARE:"square",TEXT:"text",MILSTD:"milstd",AIRSPACE:"airspace"},emp.typeLibrary.Edit=function(args){this.transactionId=args.transactionId,this.globalType=emp.typeLibrary.types.EDIT,this.intent=args.intent,this.featureId=args.featureId,this.overlayId=args.overlayId,this.parentId=args.parentId,this.updates=args.updates,this.name=args.name,this.type=args.type,this.sender=args.sender,this.complete=args.complete||!1,this.symbolCode=args.symbolCode,this.properties=args.properties||{},this.data=this.data||{},this.data.symbolCode=this.data.symbolCode||{},this.update=function(args){var o,data,v1Type,t=this,storageEntry=emp.storage.get.id({id:this.originFeature.coreId}),feature=storageEntry.getObjectData(args.mapInstanceId,emp.storage.getRootGuid(args.mapInstanceId));if(feature.overlayId=this.overlayId,feature.parentId=this.parentId,v1Type=storageEntry.v1Type,args.properties)for(var sProp in args.properties)args.properties.hasOwnProperty(sProp)&&"readOnly"!==sProp&&(feature.properties[sProp]=emp.helpers.copyObject(args.properties[sProp]));if(!args.hasOwnProperty("updateEventType")||args.updateEventType!==emp.typeLibrary.UpdateEventType.START){data=feature.generateData({feature:feature,updates:args.updates}),feature.data=data,args.hasOwnProperty("plotFeature")&&feature.format===emp.typeLibrary.featureFormatType.GEOJSON&&"feature"===feature.data.type.toLowerCase()&&feature.data.hasOwnProperty("properties")&&feature.data.properties.hasOwnProperty("aoi")&&args.plotFeature.data.hasOwnProperty("properties")&&args.plotFeature.data.properties.hasOwnProperty("aoi")&&(feature.data.properties.aoi=args.plotFeature.data.properties.aoi),feature.coordinates="";for(var i=0;i<args.updates.coordinates.length;i++)feature.coordinates+=args.updates.coordinates[i].lon.toString()+","+args.updates.coordinates[i].lat.toString(),args.updates.coordinates[i].hasOwnProperty("alt")&&(feature.coordinates+=","+args.updates.coordinates[i].alt.toString()),feature.coordinates+=" ";feature.coordinates=feature.coordinates.trim()}args.complete!==!0&&args.updateEventType!==emp.typeLibrary.UpdateEventType.COMPLETE||(feature.complete=!0,args.complete=!0),feature.updateEventType=args.updateEventType,feature.updates=args.updates,feature.transactionId=t.transactionId,void 0!==v1Type&&(feature.v1Type=t.originFeature.v1Type),o=new emp.typeLibrary.Transaction({sender:"USER",intent:emp.intents.control.EDIT_UPDATE,mapInstanceId:args.mapInstanceId,intentParams:"",items:[feature]}),o.run(),this.updatedFeature=feature},this.schema={title:"EMP-Edit Schema",type:"object",properties:{featureId:{type:"string"},overlayId:{type:["string","null"]},parentId:{type:["string","null"]},transactionId:{type:["string","null"]}},required:[]},this.coreId=args.coreId,this.originFeature,this.end=function(args){var feature=this.updatedFeature,storageEntry=emp.storage.findFeature(null,feature.featureId),parent=storageEntry.getParentByIndex(0);switch(parent.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:feature.overlayId=parent.getOverlayId();break;case emp.typeLibrary.types.FEATURE:for(feature.parentId=parent.getFeatureId();parent.getCoreObjectType()!==emp.typeLibrary.types.OVERLAY;)parent=parent.getParentByIndex(0);feature.overlayId=parent.getOverlayId()}var e=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_OUTBOUND_PLOT,mapInstanceId:args.mapInstanceId,source:emp.core.sources.MAP,items:[feature]});e.run()},this.cancel=function(args){var outBoundTrans=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_OUTBOUND_PLOT,mapInstanceId:args.mapInstanceId,source:emp.core.sources.MAP,items:[this.originFeature]}),newTrans=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_FEATURE_ADD,mapInstanceId:args.mapInstanceId,source:emp.core.sources.MAP,sender:this.sender,items:[this.originFeature]});setTimeout(function(){newTrans.run(),outBoundTrans.run()},0)},this.prepForExecution=function(){var feature;if(emp.helpers.isEmptyString(this.coreId)){if(feature=emp.storage.findFeature(this.overlayId,this.featureId),void 0===feature)return void(this.coreId=emp.helpers.id.newGUID());this.coreId=feature.getCoreId()}}},emp.typeLibrary.Edit.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Selection=function(args){this.coreId=args.coreId,this.type=args.type,this.globalType=emp.typeLibrary.types.SELECTION,this.overlayId=args.overlayId,this.featureId=args.featureId,this.parentId=args.parentId,this.selectedId=args.selectedId,this.selectedName=args.selectedName,this.select=args.select,this.transactionId=args.transactionId,this.sender=args.sender,this.originChannel=args.originChannel,this.schema={title:"EMP-Selection Schema",type:"object",properties:{featureId:{type:["string","null"]},overlayId:{type:["string","null"]},parentId:{type:["string","null"]},selectedId:{type:["string","null"]},selectedName:{type:["string","null"]},transactionId:{type:["string","null"]}}},this.validate(),this.prepForExecution=function(){var oStorageItem;if(void 0!==this.coreId){if(oStorageItem=emp.storage.get.id({id:this.coreId}))switch(oStorageItem.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:this.featureId=oStorageItem.getFeatureId();break;case emp.typeLibrary.types.WMS:this.featureId=oStorageItem.getId()}}else this.overlayId&&this.featureId&&(oStorageItem=emp.storage.findFeature(this.overlayId,this.featureId));void 0===oStorageItem?this.coreId=emp.helpers.id.newGUID():this.coreId=oStorageItem.getCoreId()}},emp.typeLibrary.Selection.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Selection._NOSELECT="...EMP_CORE-NO-SELECT",emp.typeLibrary.SelectionBox=function(args){this.globalType=emp.typeLibrary.types.SELECTION_BOX,this.bounds=args.bounds||null,this.button=args.button,this.keys=args.keys&&args.keys instanceof Array&&args.keys.length>0?args.keys:["none"],this.scale=args.scale||null,this.zoom=args.zoom||null,this.schema={title:"map-selection-box-event-schema",type:"object",properties:{bounds:{type:["object","null"],east:{type:["number","null"],minimum:-180,maximum:180},north:{type:["number","null"],minimum:-90,maximum:90},west:{type:["number","null"],minimum:-180,maximum:180},south:{type:["number","null"],minimum:-90,maximum:90}},button:{type:["string","null"],anyOf:[{format:"left"},{format:"middle"},{format:"right"}]},keys:{type:["array","null"],items:{enum:["alt","ctrl","shift","none","null"]}},scale:{type:["number","null"],minimum:0},zoom:{type:["number","null"],minimum:0}}},this.validate(),this.coreId=emp.helpers.id.newGUID()},emp.typeLibrary.SelectionBox.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.Error=function(args){var returnValue;return returnValue={date:new Date,message:args.message||"",level:args.level||0,coreId:args.coreId||"",jsError:args.jsError||{}},emp.errorHandler.log(returnValue),returnValue},emp.typeLibrary.Error.level={INFO:0,MINOR:1,MAJOR:2,CATASTROPHIC:3},emp.typeLibrary.WMS=function(args){this.nodes={},this.parentNodes={},this.globalType=emp.typeLibrary.types.WMS,this.disabled=!1,this.name=args.name||"",this.transactionId=args.transactionId,this.messageId=args.messageId,this.params=args.params||{},this.params.hasOwnProperty("transparent")?"boolean"!=typeof this.params.transparent&&("string"==typeof this.params.transparent&&"FALSE"===this.params.transparent.toUpperCase()?this.params.transparent=!1:this.params.transparent=!0):this.params.transparent=!0,this.params.hasOwnProperty("format")?"string"!=typeof this.params.format&&(this.params.format="image/png"):this.params.format=escape("image/png"),this.params.hasOwnProperty("version")?"string"!=typeof this.params.version&&(this.params.version="1.3.0"):this.params.version="1.3.0",this.id=args.id,this.url=args.url,this.useProxy=emp.util.getBooleanValue(args.useProxy,emp.util.config.getUseProxySetting()),this.overlayId=emp.helpers.id.get.setId(args.overlayId)||emp.constant.parentIds.MAP_LAYER_PARENT,this.layers=args.layers||[],this.activeLayers=args.activeLayers||function(args){var aTemp=[];if(void 0===args.layers||null===args.layers)return aTemp;for(var iIndex=0;iIndex<args.layers.length;iIndex++)aTemp.push(args.layers[iIndex]);return aTemp}(this),this.layers=args.layers,this.layerHierarchy=args.layerHierarchy,this.version=this.params.version||"",this.capabilities=args.capabilities||"",this.transparent=this.params.transparent||!1,this.format=this.params.format||"image/png",this.visible=args.visible,this.visibilitySetting=args.visibilitySetting||this.visible,this.type="wms",this.intent=args.intent||"wms.add",this.loadSuccess=null,this.loadFail=null,this.visibleLayers=args.visibleLayers||[],this.source=args.source,this.onCapabilitiesLoad=function(args){args.scope.capabilities=args.xmlCapabilities,args.scope.layerHierarchy=args.hierarchy,args.scope.loadSuccess()},this.getParentFolderOfLayer=function(layerName){var findFoldersOfLayer=function(sLayerName,oFolder){var oFolderFound,iIndex=emp.helpers.findIndexOf(oFolder.layers,"name",sLayerName);if(iIndex>-1)return oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null;for(iIndex=0;iIndex<oFolder.folders.length;iIndex++)if(oFolderFound=findFoldersOfLayer(sLayerName,oFolder.folders[iIndex]),void 0!==oFolderFound)return null===oFolderFound?oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null:oFolderFound},oFolder=findFoldersOfLayer(layerName,this.layerHierarchy);return null===oFolder&&(oFolder=void 0),oFolder},this.getParentFolderOfFolder=function(folderTitle){var findParentOfFolder=function(sTitle,oFolder){var oFolderFound,iIndex=emp.helpers.findIndexOf(oFolder.folders,"title",sTitle);if(iIndex>-1)return oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null;for(iIndex=0;iIndex<oFolder.folders.length;iIndex++)if(oFolderFound=findParentOfFolder(sTitle,oFolder.folders[iIndex]),void 0!==oFolderFound)return null===oFolderFound?oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null:oFolderFound},oFolder=findParentOfFolder(folderTitle,this.layerHierarchy);return null===oFolder&&(oFolder=void 0),oFolder},this.onCapabilitiesFail=function(args){args.scope.loadFail(args)},this.createParent=function(){var transaction,payload;payload={name:"[Unnamed Overlay(CORE)]",overlayId:this.overlayId,parentId:""},transaction=new emp.typeLibrary.Transaction({length:1,intent:emp.intents.control.OVERLAY_ADD,transactionId:this.transactionId+".parent",originChannel:"map.overlay.create",sender:this.sender,transactionType:"overlay",type:"transaction",items:function(){var r=[];return r.push(new emp.typeLibrary.Overlay(payload)),r}}),transaction.run()},this.coreId=function(args){return void 0!==args.coreId&&null!==args.coreId?args.coreId:args.id}(args),this.coreParent=args.coreParent||function(args){return emp.helpers.id.get.isId(args.overlayId)?args.overlayId:emp.hasOwnProperty("storage")?emp.storage.getRootGuid():void 0}(this),this.parentCoreId=args.parentCoreId||this.coreParent,this.locate=function(args){var transaction,payload;return args=args||{},args.component=args.component||"",payload=args.bounds?{channel:"map.view.center.bounds",bounds:args.bounds,zoom:!0,visible:!0}:{channel:"map.view.center.bounds",featureId:this.id,overlayId:this.overlayId,zoom:!0,visible:!0},transaction=new emp.typeLibrary.Transaction({intent:"view.set",transactionId:emp.helpers.id.newGUID(),sender:"core",originChannel:"map.view.center.bounds",originSchema:"map.view.center.bounds",transactionType:"view",items:function(){var r=[];return r.push(new emp.typeLibrary.View(payload)),r}}),"de"!==args.component?transaction:void transaction.run()},this.visibility=function(oTransaction,sParentCoreId,bVisibility){var oItem;this.visible=bVisibility,this.visibilitySetting=bVisibility,oItem=this.createDuplicate(),oTransaction.items.push(oItem)},this.getAllLayer=function(){var oaLayers=[],getLayers=function(oLayerList){for(var oaLayerList=[],iIndex=0;iIndex<oLayerList.length;iIndex++)oaLayerList.push(oLayerList[iIndex].name);return oaLayerList},getLayersFromFolders=function(oFolders){for(var oaLayerList=[],iIndex=0;iIndex<oFolders.length;iIndex++)oaLayerList=oaLayerList.concat(getLayersFromFolders(oFolders[iIndex].folders)),oaLayerList=oaLayerList.concat(getLayers(oFolders[iIndex].layers));return oaLayerList},oaTemp=getLayersFromFolders(this.layerHierarchy.folders);return oaLayers=oaLayers.concat(oaTemp),oaTemp=getLayers(this.layerHierarchy.layers),oaLayers=oaLayers.concat(oaTemp)},this.getAllNamedFolders=function(){var getNamedFolders=function(oFolders){for(var oaFolderList=[],iIndex=0;iIndex<oFolders.length;iIndex++)(oFolders[iIndex].layers.length>0||oFolders[iIndex].folders.length>0)&&(oFolders[iIndex].title&&oaFolderList.push(oFolders[iIndex].title),oaFolderList=oaFolderList.concat(getNamedFolders(oFolders[iIndex].folders)));return oaFolderList};return getNamedFolders(this.layerHierarchy.folders)},this.oaFoldersSelected=[],this.oaLayersSelected=[],this.selectFolder=function(sFolderName){this.oaFoldersSelected.indexOf(sFolderName)===-1&&this.oaFoldersSelected.push(sFolderName)},this.isFolderSelected=function(sFolderName){return this.oaFoldersSelected.indexOf(sFolderName)!==-1},this.unselectFolder=function(sFolderName){var iIndex=this.oaFoldersSelected.indexOf(sFolderName);iIndex!==-1&&this.oaFoldersSelected.splice(iIndex,1)},this.selectAllFolders=function(){this.oaFoldersSelected=this.getAllNamedFolders()},this.unselectAllFolders=function(){this.oaFoldersSelected.length>0&&this.oaFoldersSelected.splice(0,this.oaFoldersSelected.length)},this.selectLayer=function(sLayerName){this.oaLayersSelected.indexOf(sLayerName)===-1&&this.oaLayersSelected.push(sLayerName)},this.isLayerSelected=function(sLayerName){return this.oaLayersSelected.indexOf(sLayerName)!==-1},this.unselectLayer=function(sLayerName){var iIndex=this.oaLayersSelected.indexOf(sLayerName);iIndex!==-1&&this.oaLayersSelected.splice(iIndex,1)},this.selectAllLayers=function(){this.oaLayersSelected=this.getAllLayer(),this.activeLayers=this.oaLayersSelected},this.unselectAllLayers=function(){this.oaLayersSelected.length>0&&this.oaLayersSelected.splice(0,this.oaLayersSelected.length)},this.getObjectData=function(){var oObj={id:this.id,overlayId:this.overlayId,name:this.name,url:this.url,format:this.format};return oObj.params=emp.helpers.copyObject(this.params),this.layers.length>0&&(oObj.params.layers=this.layers.toString()),oObj},this.createDuplicate=function(){var oNewWMS,oNodes=this.nodes,oParentNodes=this.parentNodes,oChildNodes=this.childNodes;this.nodes={},this.parentNodes={},this.childNodes={};var stringFeature=JSON.stringify(this),objectFeature=JSON.parse(stringFeature);this.nodes=oNodes,this.parentNodes=oParentNodes,this.childNodes=oChildNodes,oNewWMS=new emp.typeLibrary.WMS(objectFeature),oNewWMS.activeLayers=[];for(var iIndex=0;iIndex<this.activeLayers.length;iIndex++)oNewWMS.activeLayers.push(this.activeLayers[iIndex]);return oNewWMS},this.prepForExecution=function(){},this.schema={title:"EMP-WMS Schema",type:"object",properties:{id:{type:"string"},name:{type:["string","null"]},overlayId:{type:"string"},url:{type:"string"},params:{type:"object"},visible:{type:"boolean"},disable:{type:"boolean"}},required:["id","url"]}},emp.typeLibrary.WMS.prototype.validate=emp.typeLibrary.base.validate,emp.typeLibrary.WMTS=function(args){this.name=args.name||"",this.transactionId=args.transactionId,this.messageId=args.messageId,this.params=args.params||{},this.params.hasOwnProperty("format")?"string"!=typeof this.params.format&&(this.params.format="image/png"):this.params.format=escape("image/png"),this.params.hasOwnProperty("version")?"string"!=typeof this.params.version&&(this.params.version="1.0.0"):this.params.version="1.0.0",this.id=args.id,this.overlayId=emp.helpers.id.get.setId(args.overlayId)||emp.constant.parentIds.MAP_LAYER_PARENT,this.coreId=function(args){return void 0!==args.coreId&&null!==args.coreId?args.coreId:args.id}(args),this.coreParent=args.coreParent||function(args){return emp.helpers.id.get.isId(args.overlayId)?args.overlayId:emp.hasOwnProperty("storage")?emp.storage.getRootGuid():void 0}(this),this.parentCoreId=args.parentCoreId||this.coreParent,this.url=args.url,this.useProxy=args.useProxy,this.version=this.params.version||"",this.format=this.params.format||"image/png",this.layer=this.params.layer,this.style=this.params.style,this.sampleDimensions=this.params.sampleDimensions,this.visible=args.visible,this.type="wmts",this.intent=args.intent||"wmts.add",this.source=args.source},emp.typeLibrary.KmlLayer=function(args){this.name=args.name||"",this.transactionId=args.transactionId,this.messageId=args.messageId,this.id=args.id,this.overlayId=emp.helpers.id.get.setId(args.overlayId)||emp.constant.parentIds.MAP_LAYER_PARENT,this.coreId=function(args){return void 0!==args.coreId&&null!==args.coreId?args.coreId:args.id}(args),this.coreParent=args.coreParent||function(args){return emp.helpers.id.get.isId(args.overlayId)?args.overlayId:emp.hasOwnProperty("storage")?emp.storage.getRootGuid():void 0}(this),this.parentCoreId=args.parentCoreId||this.coreParent,this.url=args.url,this.useProxy=args.useProxy,this.version=args.version||"2.2",this.kmlData=args.kmlData||args.kmlData,this.visible=args.visible,this.type="kml",this.intent=args.intent||"kmllayer.add",this.source=args.source},emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){var options={parentStorageEntry:args.parentStorageEntry,childStorageEntry:args.childStorageEntry,visibilitySetting:{},visibleUnderParent:{}};emp.classLibrary.Util.setOptions(this,options)},destroy:function(){},getParent:function(){return this.options.parentStorageEntry},getChild:function(){return this.options.childStorageEntry},getParentCoreId:function(){return this.options.parentStorageEntry.getCoreId()},getChildCoreId:function(){return this.options.childStorageEntry.getCoreId()},getVisibilitySettingOnMap:function(mapInstanceId){return"boolean"==typeof this.options.visibilitySetting[mapInstanceId]&&this.options.visibilitySetting[mapInstanceId]},getVisibleUnderParentOnMap:function(mapInstanceId){return"boolean"==typeof this.options.visibleUnderParent[mapInstanceId]&&this.options.visibleUnderParent[mapInstanceId]},getVisibilityWithParent:function(mapInstanceId){return this.getVisibilitySettingOnMap(mapInstanceId)&&this.getVisibleUnderParentOnMap(mapInstanceId)},isOnMap:function(mapInstanceId){return this.options.visibilitySetting.hasOwnProperty(mapInstanceId)},setVisibilitySettingOnMap:function(mapInstanceId,bVisibility){this.options.visibilitySetting[mapInstanceId]=bVisibility},setVisibleUnderParentOnMap:function(mapInstanceId,bVisibility){this.options.visibleUnderParent[mapInstanceId]=bVisibility},removeMapInstance:function(mapInstanceId){this.options.visibilitySetting.hasOwnProperty(mapInstanceId)&&(delete this.options.visibilitySetting[mapInstanceId],delete this.options.visibleUnderParent[mapInstanceId])},getMapInstanceList:function(){return emp.helpers.associativeArray.getKeys(this.options.visibilitySetting)}};return publicInterface},emp.classLibrary.ObjectRelationship=emp.classLibrary.Class.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){return{initialize:function(args){var options={coreObjectType:args.coreObjectType||args.globalType,coreId:args.coreId||emp.helpers.id.newGUID()};emp.classLibrary.Util.setOptions(this,options)},destroy:function(){},getCoreObjectType:function(){return this.options.coreObjectType},getCoreId:function(){return this.options.coreId},prepForExecution:function(){}}},emp.classLibrary.EmpObject=emp.classLibrary.Class.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){var options={name:args.name,description:args.description,disabled:args.disabled===!0||!1,visibleOnMap:{},parentObjects:{},childObjects:{},properties:args.properties?emp.helpers.copyObject(args.properties):{}};emp.classLibrary.Util.setOptions(this,options),this.options.properties.hasOwnProperty("readOnly")?this.options.properties.readOnly=this.options.properties.readOnly===!0:this.options.properties.readOnly=!1,emp.classLibrary.EmpObject.prototype.initialize.call(this,args)},destroy:function(){},getProperties:function(){return this.options.properties},setProperties:function(oValue){this.options.properties=oValue},setPropertyValue:function(sProperty,Value){this.options.properties[sProperty]=Value},setReadOnly:function(bValue){this.options.properties.readOnly=bValue===!0},isReadOnly:function(){return this.options.properties.readOnly},isDisabled:function(){return this.options.disabled},setDisabled:function(bValue){this.options.disabled=bValue===!0},removeFromMap:function(mapInstanceId){this.options.visibleOnMap.hasOwnProperty(mapInstanceId)&&(delete this.options.visibleOnMap[mapInstanceId],this.removeObjectFromMapRoot(mapInstanceId))},getMapInstanceList:function(){return emp.helpers.associativeArray.getKeys(this.options.visibleOnMap)},getParentRelationshipList:function(){return this.options.parentObjects},getChildrenList:function(){return this.options.childObjects},getParentRelationship:function(parentCoreId){return this.options.parentObjects[parentCoreId]},getName:function(){return this.options.name},setName:function(sName){emp.helpers.isEmptyString(sName)||(this.options.name=sName)},getDescription:function(){return this.options.description},setDescription:function(sDesc){emp.helpers.isEmptyString(sDesc)||(this.options.description=sDesc)},getObjectData:function(){return{}},isVisibleOnMap:function(mapInstanceId){return"boolean"==typeof this.options.visibleOnMap[mapInstanceId]&&this.options.visibleOnMap[mapInstanceId]},setVisibleOnMap:function(mapInstanceId,bVisible){this.options.visibleOnMap[mapInstanceId]=bVisible},isOnMap:function(mapInstanceId){return this.options.visibleOnMap.hasOwnProperty(mapInstanceId)},getVisibilityCount:function(mapInstanceId){var oRelationship,sCoreId,iCount=0;for(sCoreId in this.options.parentObjects)this.options.parentObjects.hasOwnProperty(sCoreId)&&(oRelationship=this.options.parentObjects[sCoreId],oRelationship.getVisibilityWithParent(mapInstanceId)&&iCount++);return iCount},isVisibilityAffected:function(mapInstanceId,sParentCoreId,bVisible){var oRelationship,bSend=!1,iPrevVisibilityCount=this.getVisibilityCount(mapInstanceId);return this.options.parentObjects.hasOwnProperty(sParentCoreId)?(oRelationship=this.options.parentObjects[sParentCoreId],1===iPrevVisibilityCount&&!bVisible&&oRelationship.getVisibleUnderParentOnMap(mapInstanceId)?bSend=!0:0===iPrevVisibilityCount&&bVisible&&oRelationship.getVisibilitySettingOnMap(mapInstanceId)?bSend=!0:!bVisible&&oRelationship.getVisibleUnderParentOnMap(mapInstanceId)?oRelationship.setVisibleUnderParentOnMap(mapInstanceId,bVisible):bVisible&&!oRelationship.getVisibleUnderParentOnMap(mapInstanceId)&&oRelationship.getVisibilitySettingOnMap(mapInstanceId)&&oRelationship.setVisibleUnderParentOnMap(mapInstanceId,bVisible),bSend&&(oRelationship.setVisibleUnderParentOnMap(mapInstanceId,bVisible),this.setVisibleOnMap(mapInstanceId,bVisible)),bSend):bSend},addAffectedChildren:function(oTransaction,bVisible){var sChildCoreId,oChild,oDupChild,mapInstanceId=oTransaction.mapInstanceId,oaItems=oTransaction.items,bAffected=!1;for(sChildCoreId in this.options.childObjects)if(this.options.childObjects.hasOwnProperty(sChildCoreId)&&(oChild=this.options.childObjects[sChildCoreId],!oTransaction.isOnItemsList({coreId:oChild.getCoreId()})))if(bAffected=oChild.isVisibilityAffected(mapInstanceId,this.getCoreId(),bVisible)){switch(oDupChild=oChild.getObjectData(mapInstanceId,this.getCoreId()),oDupChild.coreParent=this.getCoreId(),oDupChild.parentCoreId=mapInstanceId,oaItems.push(oDupChild),oChild.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:oTransaction.duplicate(oChild.getCoreId());break;case emp.typeLibrary.types.WMS:bVisible||(oDupChild.activeLayers=[])}oChild.addAffectedChildren(oTransaction,bVisible)}else bVisible&&oChild.getVisibilityWithParent(this.getCoreId())&&oChild.addAffectedChildren(oTransaction,bVisible)},visibility:function(oTransaction,sParentCoreId,bVisible,bGoDeep){var oItem,mapInstanceId=oTransaction.mapInstanceId,oaItems=oTransaction.items;switch(this.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.STATIC:case emp.typeLibrary.types.WMS:break;default:return void emp.errorHandler.log(emp.typeLibrary.Error({level:1,message:"Visibility called on incompatible object",jsError:"",coreId:this.getCoreId()}))}if("boolean"==typeof bVisible)if(this.setVisibilityWithParent(mapInstanceId,sParentCoreId,bVisible)){switch(oItem=this.getObjectData(mapInstanceId,sParentCoreId),oItem.visible=bVisible,oaItems.push(oItem),this.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:oTransaction.duplicate(this.getCoreId());break;case emp.typeLibrary.types.STATIC:oItem.parentCoreId=sParentCoreId}bGoDeep&&this.addAffectedChildren(oTransaction,bVisible)}else{switch(oItem=this.getObjectData(mapInstanceId,sParentCoreId),oItem.visible=bVisible,this.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:case emp.typeLibrary.types.STATIC:oItem.parentCoreId=sParentCoreId;break;default:oItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId)}oaItems.push(oItem),oTransaction.duplicate(this.getCoreId())}},locate:function(args){var transaction,oMapExtent,payload,sCoreId,oChild;switch(this.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.OVERLAY:break;default:return}switch(args=args||{},args.component=args.component||"",payload={zoom:!0,visible:!0},this.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:this.childrenCount()>0&&(oMapExtent=this.getMapExtent()),oMapExtent&&!oMapExtent.isEmpty()?payload.bounds={west:oMapExtent.getWest(),east:oMapExtent.getEast(),south:oMapExtent.getSouth(),north:oMapExtent.getNorth()}:(payload.featureId=this.getFeatureId(),payload.coreId=this.getCoreId());break;case emp.typeLibrary.types.OVERLAY:switch(this.childrenCount()){case 0:return;case 1:return sCoreId=this.getChildrenCoreIds()[0],oChild=this.getChild(sCoreId),oChild.locate(args);default:oMapExtent=this.getMapExtent()}if(!oMapExtent||oMapExtent.isEmpty())return;payload.bounds={west:oMapExtent.getWest(),east:oMapExtent.getEast(),south:oMapExtent.getSouth(),north:oMapExtent.getNorth()}}return transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,source:emp.core.sources.CORE,items:[new emp.typeLibrary.View(payload)]}),"de"!==args.component?transaction:void transaction.run()},getRootCoreId:function(mapInstanceId){return mapInstanceId},getRootParent:function(mapInstanceId){var oRootCoreId=this.getRootCoreId(mapInstanceId);return emp.storage.get.id({id:oRootCoreId})},hasChildren:function(){return!emp.helpers.associativeArray.isEmpty(this.options.childObjects)},hasParents:function(){return!emp.helpers.associativeArray.isEmpty(this.options.parentObjects)},removeFromAllParent:function(){var iIndex,oParent,aParentCoreIdList=this.getParentCoreIds();for(iIndex=0;iIndex<aParentCoreIdList.length;iIndex++)oParent=this.getParent(aParentCoreIdList[iIndex]),oParent.removeChild(this)},isDescendantOf:function(sCoreId){var oRelationship,sParentCoreId,bRet=!1;if(this.getCoreId()===sCoreId)bRet=!0;else for(sParentCoreId in this.options.parentObjects)if(this.options.parentObjects.hasOwnProperty(sParentCoreId)&&(oRelationship=this.options.parentObjects[sParentCoreId],oRelationship.getParent().isDescendantOf(sCoreId))){bRet=!0;break}return bRet},isChildOf:function(coreId){return this.options.parentObjects.hasOwnProperty(coreId)},isParentOf:function(coreId){return this.options.childObjects.hasOwnProperty(coreId)},getParentMapInstanceList:function(){var aMapList,iIndex,parentCoreId,oRelationship,aRetList=[],oParentRelationshipList=this.getParentRelationshipList();for(parentCoreId in oParentRelationshipList)if(oParentRelationshipList.hasOwnProperty(parentCoreId))for(oRelationship=oParentRelationshipList[parentCoreId],aMapList=oRelationship.getMapInstanceList(),iIndex=0;iIndex<aMapList.length;iIndex++)aRetList.indexOf(aMapList[iIndex])===-1&&aRetList.push(aMapList[iIndex]);if(0===aRetList.length){var mapInstanceId=emp.storage.isRoot(this.getCoreId());mapInstanceId&&aRetList.push(mapInstanceId)}return aRetList},removeMapInstanceFromRelationship:function(oParent,mapInstanceId){var oChild,sCoreId,aParentMapList,oRelationship=this.getParentRelationship(oParent.getCoreId());if(oRelationship&&oRelationship.removeMapInstance(mapInstanceId),aParentMapList=this.getParentMapInstanceList(),aParentMapList.indexOf(mapInstanceId)===-1&&(this.removeFromMap(mapInstanceId),this.hasChildren()))for(sCoreId in this.options.childObjects)this.options.childObjects.hasOwnProperty(sCoreId)&&(oChild=this.options.childObjects[sCoreId],oChild.removeMapInstanceFromRelationship(this,mapInstanceId))},deleteParentEntry:function(parentCoreId){var oChild,sCoreId,iIndex,aPrevMapList,aNewMapList;if(this.isChildOf(parentCoreId)&&(aPrevMapList=this.getParentMapInstanceList(),delete this.options.parentObjects[parentCoreId],aNewMapList=this.getParentMapInstanceList(),aPrevMapList.length!==aNewMapList.length))for(iIndex=0;iIndex<aPrevMapList.length;iIndex++)if(aNewMapList.indexOf(aPrevMapList[iIndex])===-1){this.removeFromMap(aPrevMapList[iIndex]);for(sCoreId in this.options.childObjects)this.options.childObjects.hasOwnProperty(sCoreId)&&(oChild=this.options.childObjects[sCoreId],oChild.removeMapInstanceFromRelationship(this,aPrevMapList[iIndex]))}},deleteChildEntry:function(childCoreId){this.isParentOf(childCoreId)&&delete this.options.childObjects[childCoreId]},removeChild:function(oChild){this.isParentOf(oChild.getCoreId())&&(oChild.deleteParentEntry(this.getCoreId()),this.deleteChildEntry(oChild.getCoreId()))},removeObjectFromMapRoot:function(mapInstanceId){var rootCoreId,oRootOverlay;switch(this.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.WMS:if(rootCoreId=emp.storage.getRootGuid(mapInstanceId),oRootOverlay=emp.storage.findOverlay(rootCoreId),void 0===oRootOverlay)return void new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"removeObjectFromMapRoot: Root overlay for map instance not found."});oRootOverlay.removeFromFeatureList(this)}},addObjectToMapRoot:function(mapInstanceId){var rootCoreId,oRootOverlay;switch(this.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.WMS:if(rootCoreId=emp.storage.getRootGuid(mapInstanceId),oRootOverlay=emp.storage.findOverlay(rootCoreId),void 0===oRootOverlay)return void new emp.typeLibrary.Error({
level:emp.typeLibrary.Error.level.MAJOR,message:"addObjectToMapRoot: Root overlay for map instance not found."});oRootOverlay.addToFeatureList(this)}},addMapInstanceToRelationship:function(oParent,mapInstanceId,bParentVisible,bVisibleSetting){var oChild,sCoreId,oRelationship=this.options.parentObjects[oParent.getCoreId()];if(oRelationship&&(this.options.visibleOnMap[mapInstanceId]=bParentVisible&&bVisibleSetting,oRelationship.setVisibilitySettingOnMap(mapInstanceId,bVisibleSetting),oRelationship.setVisibleUnderParentOnMap(mapInstanceId,bParentVisible),this.addObjectToMapRoot(mapInstanceId)),this.hasChildren())for(sCoreId in this.options.childObjects)this.options.childObjects.hasOwnProperty(sCoreId)&&(oChild=this.options.childObjects[sCoreId],oChild.addMapInstanceToRelationship(this,mapInstanceId,bParentVisible,bVisibleSetting))},addParent:function(oParent,bVisibleSetting){var oRelationship,oMapList,iIndex,bParentVisible,oChild,sCoreId;if(!this.isChildOf(oParent.getCoreId())){for(oRelationship=new emp.classLibrary.ObjectRelationship({parentStorageEntry:oParent,childStorageEntry:this}),oMapList=oParent.getMapInstanceList(),iIndex=0;iIndex<oMapList.length;iIndex++){bParentVisible=oParent.isVisibleOnMap(oMapList[iIndex]),this.setVisibleOnMap(oMapList[iIndex],bParentVisible&&bVisibleSetting),oRelationship.setVisibilitySettingOnMap(oMapList[iIndex],bVisibleSetting),oRelationship.setVisibleUnderParentOnMap(oMapList[iIndex],bParentVisible),this.addObjectToMapRoot(oMapList[iIndex]);for(sCoreId in this.options.childObjects)this.options.childObjects.hasOwnProperty(sCoreId)&&(oChild=this.options.childObjects[sCoreId],oChild.addMapInstanceToRelationship(this,oMapList[iIndex],bParentVisible,bVisibleSetting))}this.options.parentObjects[oParent.getCoreId()]=oRelationship,oParent.addChild(this,bVisibleSetting)}},addChild:function(oChild,bVisibleSetting){this.isParentOf(oChild.getCoreId())||(this.options.childObjects[oChild.getCoreId()]=oChild,oChild.addParent(this,bVisibleSetting))},getAllFeatureChildren:function(oRetAssoArray){var sCoreId,oAssoArray=oRetAssoArray||{};for(sCoreId in this.options.childObjects)this.options.childObjects.hasOwnProperty(sCoreId)&&(this.options.childObjects[sCoreId].getCoreObjectType()!==emp.typeLibrary.types.OVERLAY&&(oAssoArray[sCoreId]=this.options.childObjects[sCoreId]),this.options.childObjects[sCoreId].getAllFeatureChildren(oAssoArray));return oAssoArray},getChildrenCoreIds:function(){return emp.helpers.associativeArray.getKeys(this.options.childObjects)},getParentCoreIds:function(){return emp.helpers.associativeArray.getKeys(this.options.parentObjects)},getParentCoreIdsOnMap:function(sMapInstanceId){var sParentCoreId,oRelationship,aParentCoreIds=[];for(sParentCoreId in this.options.parentObjects)this.options.parentObjects.hasOwnProperty(sParentCoreId)&&(oRelationship=this.options.parentObjects[sParentCoreId],oRelationship.isOnMap(sMapInstanceId)&&aParentCoreIds.push(sParentCoreId));return aParentCoreIds},mapCount:function(){return emp.helpers.associativeArray.size(this.options.visibleOnMap)},childrenCount:function(){return emp.helpers.associativeArray.size(this.options.childObjects)},parentCount:function(){return emp.helpers.associativeArray.size(this.options.parentObjects)},getChild:function(sCoreId){return this.options.childObjects[sCoreId]},getParent:function(sCoreId){if(this.options.parentObjects.hasOwnProperty(sCoreId))return this.options.parentObjects[sCoreId].getParent()},getParentByIndex:function(iIndex){var aCoreIds=this.getParentCoreIds();if(aCoreIds.length>iIndex)return this.getParent(aCoreIds[iIndex])},getVisibilitySettingWithParent:function(mapInstanceId,sParentCodeId){var sParentID=sParentCodeId?sParentCodeId:emp.storage.getRootGuid(mapInstanceId);return!!this.isChildOf(sParentID)&&this.getParentRelationship(sParentID).getVisibilitySettingOnMap(mapInstanceId)},getVisibilityWithParent:function(mapInstanceId,sParentCodeId){var sParentID=sParentCodeId?sParentCodeId:emp.storage.getRootGuid(mapInstanceId);return!!this.isChildOf(sParentID)&&this.getParentRelationship(sParentID).getVisibleUnderParentOnMap(mapInstanceId)},setVisibilityWithParent:function(mapInstanceId,sParentCodeId,bSetting){var iCurrentVisibilityCount,oRelationship,sParentID=sParentCodeId?sParentCodeId:emp.storage.getRootGuid(mapInstanceId),bSend=!1,iPrevVisibilityCount=this.getVisibilityCount(mapInstanceId);return this.isChildOf(sParentID)&&(oRelationship=this.getParentRelationship(sParentID),oRelationship.setVisibleUnderParentOnMap(mapInstanceId,bSetting),oRelationship.setVisibilitySettingOnMap(mapInstanceId,bSetting)),iCurrentVisibilityCount=this.getVisibilityCount(mapInstanceId),bSetting&&0===iPrevVisibilityCount&&1===iCurrentVisibilityCount?bSend=!0:bSetting||1!==iPrevVisibilityCount||0!==iCurrentVisibilityCount||(bSend=!0),bSend&&this.setVisibleOnMap(mapInstanceId,bSetting),bSend},isVisible:function(mapInstanceId){var sCoreId,oParent,oParentRelationshipList=this.getParentRelationshipList(),bRet=!1;if(this.getCoreId()===emp.storage.getRootGuid(mapInstanceId))return!0;for(sCoreId in oParentRelationshipList)if(oParentRelationshipList.hasOwnProperty(sCoreId)&&oParentRelationshipList[sCoreId].getVisibleUnderParentOnMap(mapInstanceId)){if(sCoreId===emp.storage.getRootGuid(mapInstanceId))return!0;if(oParent=oParentRelationshipList[sCoreId].getParent(),oParent.isVisible())return!0}return bRet},getMapExtent:function(oMapExtent){var sCoreId,oChild,mapExtent=oMapExtent,oChildList=this.getChildrenList();mapExtent instanceof emp.classLibrary.MapExtent||(mapExtent=new emp.classLibrary.MapExtent);for(sCoreId in oChildList)if(oChildList.hasOwnProperty(sCoreId))switch(oChild=oChildList[sCoreId],oChild.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.OVERLAY:oChild.getMapExtent(mapExtent)}return mapExtent},compareValues:function(Value1,Value2){var bRet=!1;return Value2 instanceof RegExp?"string"==typeof Value1&&(bRet=Value2.test(Value1)):bRet=Value1===Value2,bRet},compareProperty:function(mapInstanceId,sProperty,Value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":bRet=this.compareValues(this.getName(),Value);break;case"description":bRet=this.compareValues(this.getDescription(),Value);break;case"readonly":bRet=this.compareValues(this.isReadOnly(),Value);break;case"visible":bRet=this.isVisibleOnMap(mapInstanceId)===Value}return bRet}};return publicInterface},emp.classLibrary.EmpRenderableObject=emp.classLibrary.EmpObject.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){var options={overlayId:emp.helpers.id.get.setId(args.overlayId),parentId:emp.helpers.id.get.setId(args.parentId),menuId:emp.helpers.id.get.setId(args.menuId)||"",hidden:args.hidden||!1,featureList:{},cluster:void 0};emp.classLibrary.Util.setOptions(this,options),args.coreObjectType=emp.typeLibrary.types.OVERLAY,emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this,args),this.options.properties.hasOwnProperty("cluster")&&(this.options.cluster=new emp.typeLibrary.Overlay.Cluster(this.options.properties.cluster),this.options.properties.hasOwnProperty("clusterActive")?this.options.properties.clusterActive=this.options.properties.clusterActive!==!1:this.options.properties.clusterActive=!1)},destroy:function(){},getOverlayId:function(){return this.options.overlayId},getParentId:function(){return this.options.parentId},getMenuId:function(){return this.options.menuId},setMenuId:function(sValue){this.options.menuId=emp.helpers.isEmptyString(sValue)?"":sValue},isOnFeatureList:function(oFeature){return this.options.featureList.hasOwnProperty(oFeature.getCoreId())},addToFeatureList:function(oFeature){this.isOnFeatureList(oFeature)||(this.options.featureList[oFeature.getCoreId()]=oFeature)},removeFromFeatureList:function(oFeature){this.isOnFeatureList(oFeature)&&delete this.options.featureList[oFeature.getCoreId()]},getFeatureList:function(){return this.options.featureList},getObjectData:function(mapInstanceId,parentCoreId){return new emp.typeLibrary.Overlay({coreId:this.getCoreId(),coreParent:parentCoreId,overlayId:this.getOverlayId(),parentId:parentCoreId,name:this.getName(),description:this.getDescription(),readOnly:this.isReadOnly(),globalType:emp.typeLibrary.types.OVERLAY,properties:emp.helpers.copyObject(this.options.properties),visible:this.isVisibleOnMap(mapInstanceId)})},updateOverlay:function(oNewOverlayData){var sProperty,oProperties=oNewOverlayData.properties||{};this.setName(oNewOverlayData.name),this.setDescription(oNewOverlayData.description);for(sProperty in oProperties)if(oProperties.hasOwnProperty(sProperty))switch(sProperty.toLowerCase()){case"readonly":this.options.properties[sProperty]=oProperties[sProperty]===!0;break;case"cluster":case"clusteractive":break;default:this.options.properties[sProperty]=oProperties[sProperty]}},compareProperty:function(mapInstanceId,sProperty,Value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":case"description":case"readonly":case"visible":bRet=emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value);break;case"menuid":bRet=this.compareValues(this.getMenuId(),Value);break;case"overlayid":bRet=this.compareValues(this.getOverlayId(),Value)}return bRet}};return publicInterface},emp.classLibrary.EmpOverlay=emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){var options={overlayId:emp.helpers.id.get.setId(args.overlayId),parentId:emp.helpers.id.get.setId(args.parentId),featureId:emp.helpers.id.get.setId(args.featureId)};emp.classLibrary.Util.setOptions(this,options),emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this,args)},destroy:function(){},getOverlayId:function(){return this.options.overlayId},getParentId:function(){return this.options.parentId},getFeatureId:function(){return this.options.featureId},getObjectData:function(mapInstanceId,parentCoreId){return new emp.typeLibrary.Static({coreId:this.getCoreId(),coreParent:parentCoreId,parentCoreId:parentCoreId,name:this.getName(),overlayId:this.getOverlayId(),parentId:this.getParentId(),featureId:this.getFeatureId(),visible:this.isVisibleOnMap(mapInstanceId)})}};return publicInterface},emp.classLibrary.EmpStaticContent=emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){return{initialize:function(args){var options={featureId:args.featureId,menuId:emp.helpers.id.get.setId(args.menuId)||"",format:args.format,data:args.data,url:args.url,params:args.params||{},inEditMode:!1,mapExtent:new emp.classLibrary.MapExtent};emp.classLibrary.Util.setOptions(this,options),args.coreObjectType=emp.typeLibrary.types.FEATURE,emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this,args),this.setMapExtent(),this.verifyAltitudeMode(),this.verifyMilStd(),this.verifyReadOnly()},destroy:function(){},getFeatureId:function(){return this.options.featureId},getFormat:function(){return this.options.format},getData:function(){return this.options.data},setData:function(sData){this.options.data=sData,this.setMapExtent()},getMenuId:function(){return this.options.menuId},setMenuId:function(sMenuId){this.options.menuId=sMenuId},getURL:function(){return this.options.url},setURL:function(sValue){this.options.url=sValue},getParams:function(){return this.options.params},setParams:function(sValue){this.options.params=sValue},getObjectData:function(mapInstanceId,coreParentId){var oParent=this.getParentByIndex(0),oParams={coreId:this.getCoreId(),coreParent:coreParentId,parentCoreId:emp.storage.getRootGuid(mapInstanceId),format:this.getFormat(),name:this.getName(),menuId:this.getMenuId(),description:this.getDescription(),featureId:this.getFeatureId(),data:emp.helpers.copyObject(this.getData()),properties:emp.helpers.copyObject(this.getProperties()),url:this.options.url,params:this.getParams(),visible:this.isVisibleOnMap(mapInstanceId)};if(oParent)switch(oParent.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:for(oParams.parentId=oParent.getFeatureId();oParent.getCoreObjectType()!==emp.typeLibrary.types.OVERLAY;)oParent=oParent.getParentByIndex(0);oParams.overlayId=oParent.getOverlayId();break;case emp.typeLibrary.types.OVERLAY:oParams.overlayId=oParent.getOverlayId()}return new emp.typeLibrary.Feature(oParams)},verifyAltitudeMode:function(){var basicSymbolID,oProperties=this.getProperties();if(emp.util.isEmptyString(oProperties.altitudeMode))switch(this.getFormat()){case emp.typeLibrary.featureFormatType.KML:break;case emp.typeLibrary.featureFormatType.GEOJSON:oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;break;case emp.typeLibrary.featureFormatType.WMS:case emp.typeLibrary.featureFormatType.IMAGE:oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;break;case emp.typeLibrary.featureFormatType.MILSTD:switch(oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND,basicSymbolID=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(this.getData().symbolCode),basicSymbolID=basicSymbolID.slice(0,3)){case"S*P":case"I*P":oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.ABSOLUTE;break;case"S*A":case"I*A":oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND}break;case emp.typeLibrary.featureFormatType.AIRSPACE:oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND;break;default:oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND}},verifyMilStd:function(){var oProperties=this.getProperties();if(this.getFormat()===emp.typeLibrary.featureFormatType.MILSTD){var bStdVersionNotFound=!0,iStdVersion=0;if(oProperties.hasOwnProperty("modifiers")&&oProperties.modifiers.hasOwnProperty("standard")&&(iStdVersion=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oProperties.modifiers.standard),bStdVersionNotFound=!1),bStdVersionNotFound&&oProperties.hasOwnProperty("standard")&&(iStdVersion=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oProperties.standard)),armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(this.getData().symbolCode,iStdVersion)&&sec.web.renderer.utilities.JavaRendererUtilities.is3dSymbol(this.getData().symbolCode,oProperties.modifiers)){if(oProperties.altitudeMode===emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND&&(oProperties.altitudeMode=emp.typeLibrary.featureAltitudeModeType.ABSOLUTE),!oProperties.hasOwnProperty("fillColor")){var sNewFillColor=emp.helpers.get3DMilStdAffiliationColor(this.getData().symbolCode);if(oProperties.hasOwnProperty("fillOpacity")&&!isNaN(oProperties.fillOpacity)){var sOpacity=Math.floor(255*oProperties.fillOpacity).toString(16);sOpacity.length<=1&&(sOpacity="0"+sOpacity),oProperties.fillColor=sOpacity+sNewFillColor}else oProperties.fillColor="40"+sNewFillColor}if(!oProperties.hasOwnProperty("lineColor")){var sLineColor=emp.helpers.get3DMilStdAffiliationColor(this.getData().symbolCode);oProperties.hasOwnProperty("lineOpacity")&&!isNaN(oProperties.lineOpacity)?(sOpacity=Math.floor(255*oProperties.lineOpacity).toString(16),sOpacity.length<=1&&(sOpacity="0"+sOpacity),oProperties.lineColor=sOpacity+sLineColor):oProperties.lineColor="FF"+sLineColor}}}},verifyReadOnly:function(){var oData;if(!this.isReadOnly())if(!emp.util.isEmptyString(this.options.url)&&this.options.url.length>0)this.setReadOnly(!0);else switch(this.getFormat()){case emp.typeLibrary.featureFormatType.KML:emp.helpers.isCompoundKML(this.getData())&&this.setReadOnly(!0);break;case emp.typeLibrary.featureFormatType.GEOJSON:oData=this.getData(),void 0!==oData&&oData.hasOwnProperty("type")&&emp.helpers.isCompoundGeoJson(oData)&&this.setReadOnly(!0);break;case emp.typeLibrary.featureFormatType.WMS:case emp.typeLibrary.featureFormatType.IMAGE:this.setReadOnly(!0);break;case emp.typeLibrary.featureFormatType.MILSTD:case emp.typeLibrary.featureFormatType.AIRSPACE:}},getMilStdVersion:function(){var oProperties=this.getProperties();return oProperties.hasOwnProperty("modifiers")&&oProperties.modifiers.hasOwnProperty("standard")&&oProperties.modifiers.standard.toUpperCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C?emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C:emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B},getSymbolCode:function(){if(this.getFormat()===emp.typeLibrary.featureFormatType.MILSTD)return this.getData().symbolCode},isInEditMode:function(){return this.options.inEditMode},setEditMode:function(bValue){this.options.inEditMode=bValue===!0},canMapEnginePlot:function(mapInstanceId){return emp.helpers.canMapEnginePlotFeature(mapInstanceId,this)},canMapEngineEdit:function(mapInstanceId){return emp.helpers.canMapEngineEditFeature(mapInstanceId,this)},isAOI:function(){var bRet=!1,oGeoJson=this.getData();return this.getFormat()!==emp.typeLibrary.featureFormatType.GEOJSON?bRet:(oGeoJson.hasOwnProperty("type")&&"feature"===oGeoJson.type.toLowerCase()&&oGeoJson.hasOwnProperty("properties")&&oGeoJson.properties.hasOwnProperty("aoi")&&(bRet=!0),bRet)},updateFeature:function(oUpdateFeature){emp.util.isEmptyString(oUpdateFeature.name)||this.setName(oUpdateFeature.name),emp.util.isEmptyString(oUpdateFeature.description)||this.setDescription(oUpdateFeature.description),null!==oUpdateFeature.data&&void 0!==oUpdateFeature.data&&this.setData(emp.helpers.copyObject(oUpdateFeature.data)),emp.helpers.isEmptyString(oUpdateFeature.menuId)||this.setMenuId(oUpdateFeature.menuId),oUpdateFeature.properties&&this.setProperties(emp.helpers.copyObject(oUpdateFeature.properties)),this.verifyAltitudeMode(),this.verifyMilStd(),this.verifyReadOnly()},getCoordinateList:function(){var oCoordList,oParams;try{switch(this.getFormat()){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:case emp.constant.featureFormatType.AIRSPACE:case emp.constant.featureFormatType.GEOJSON:case emp.constant.featureFormatType.MILSTD:oCoordList=emp.util.geoJson.toCoordinateArray(this.getData());break;case emp.constant.featureFormatType.KML:oCoordList=emp.util.kml.toCoordinateArray(this.getData());break;case emp.constant.featureFormatType.IMAGE:oParams=this.getParams(),oCoordList=[],oCoordList.push(new emp.classLibrary.Coordinate(oParams.top,oParams.left)),oCoordList.push(new emp.classLibrary.Coordinate(oParams.bottom,oParams.right))}}catch(Err){oCoordList=[]}return oCoordList},compareProperty:function(mapInstanceId,sProperty,Value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":case"description":case"readonly":case"visible":bRet=emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value);break;case"menuid":bRet=this.compareValues(this.getMenuId(),Value);break;case"format":bRet=this.compareValues(this.getFormat(),Value);break;case"featureid":bRet=this.compareValues(this.getFeatureId(),Value);break;case"url":bRet=this.compareValues(this.getURL(),Value)}return bRet},getMapExtent:function(oMapExtent){var oFeatureExtent=this.options.mapExtent,mapExtent=emp.classLibrary.EmpRenderableObject.prototype.getMapExtent.call(this,oMapExtent);return oFeatureExtent&&!oFeatureExtent.isEmpty()&&(mapExtent.addCoordinate(oFeatureExtent.getNorthEast()),mapExtent.addCoordinate(oFeatureExtent.getSouthWest())),mapExtent},setMapExtent:function(){var iIndex,oCoordinateArray=this.getCoordinateList();if(this.options.mapExtent.reset(),oCoordinateArray&&oCoordinateArray.length>0)for(iIndex=0;iIndex<oCoordinateArray.length;iIndex++)this.options.mapExtent.addCoordinate(oCoordinateArray[iIndex])}}},emp.classLibrary.EmpFeature=emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){var options={id:args.id,url:args.url,useProxy:args.useProxy,params:args.params,source:args.source};emp.classLibrary.Util.setOptions(this,options),emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this,args)},compareProperty:function(mapInstanceId,sProperty,value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":case"description":case"readonly":case"visible":bRet=emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this,mapInstanceId,sProperty,value);break;case"url":bRet=this.compareValues(this.options.url,value);break;case"useProxy":bRet=this.compareValues(this.options.useProxy,value);break;case"id":bRet=this.compareValues(this.options.id,value);break;case"params":bRet=this.compareValues(this.options.params,value)}return bRet},canMapEnginePlot:function(mapInstanceId){return emp.helpers.canMapEnginePlotFeature(mapInstanceId,this)},getVersion:function(){return this.options.version}};return publicInterface},emp.classLibrary.EmpMapService=emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){var options={id:args.id,url:args.url,useProxy:args.useProxy,transparent:!0,format:"image/png",version:"1.3.0",layers:args.layers||[],activeLayers:{},layerHierarchy:args.layerHierarchy,capabilities:args.capabilities||"",visibleLayers:args.visibleLayers||[],source:args.source,oaFoldersSelected:{},oaLayersSelected:{}};args.hasOwnProperty("params")&&(args.params.hasOwnProperty("transparent")&&("boolean"==typeof args.params.transparent?options.transparent=args.params.transparent:"string"==typeof args.params.transparent&&(options.transparent="FALSE"!==this.params.transparent.toUpperCase())),args.params.hasOwnProperty("format")&&"string"==typeof args.params.format&&(options.format=args.params.format),args.params.hasOwnProperty("version")&&"string"==typeof args.params.version&&(options.version=args.params.version)),emp.classLibrary.Util.setOptions(this,options),emp.helpers.isEmptyString(args.name)&&(args.name="WMS: "+args.url),args.coreObjectType=emp.typeLibrary.types.WMS,emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this,args)},destroy:function(){},getId:function(){return this.options.id},getVersion:function(){return this.options.version},setVisibleOnMap:function(mapInstanceId,bVisible){var iIndex,parentFolder,visibleLayerList,bNewMapInstance=!1;if(emp.classLibrary.EmpRenderableObject.prototype.setVisibleOnMap.call(this,mapInstanceId,bVisible),this.options.activeLayers.hasOwnProperty(mapInstanceId)||(this.options.activeLayers[mapInstanceId]=[],bNewMapInstance=!0),this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)||(this.options.oaFoldersSelected[mapInstanceId]=[]),this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)||(this.options.oaLayersSelected[mapInstanceId]=[]),bNewMapInstance&&bVisible)if(this.options.layers.length>0)this.setActiveLayers(mapInstanceId,this.getLayers());else if(this.options.visibleLayers.length>0)for(visibleLayerList=this.options.visibleLayers,this.clearActiveLayers(mapInstanceId),iIndex=0;iIndex<visibleLayerList.length;iIndex++)for(this.add2ActiveLayers(mapInstanceId,visibleLayerList[iIndex]),this.selectLayer(mapInstanceId,visibleLayerList[iIndex]),parentFolder=this.getParentFolderOfLayer(visibleLayerList[iIndex]);void 0!==parentFolder;)this.selectFolder(mapInstanceId,parentFolder.title),parentFolder=this.getParentFolderOfFolder(parentFolder.title);else this.options.source===emp.core.sources.CONFIG},removeFromMap:function(mapInstanceId){this.options.activeLayers.hasOwnProperty(mapInstanceId)&&delete this.options.activeLayers[mapInstanceId],this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)&&delete this.options.oaFoldersSelected[mapInstanceId],this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)&&delete this.options.oaLayersSelected[mapInstanceId],emp.classLibrary.EmpRenderableObject.prototype.removeFromMap.call(this,mapInstanceId)},hasVisibleLayers:function(){return this.options.visibleLayers.length>0},getVisibleLayers:function(){return this.options.visibleLayers},hasLayers:function(){return this.options.layers.length>0},getLayers:function(){return this.options.layers},getActiveLayers:function(mapInstanceId){return this.options.activeLayers[mapInstanceId]},add2ActiveLayers:function(mapInstanceId,sLayer){this.options.activeLayers.hasOwnProperty(mapInstanceId)&&this.options.activeLayers[mapInstanceId].push(sLayer)},setActiveLayers:function(mapInstanceId,oaLayers){var iIndex;for(this.clearActiveLayers(mapInstanceId),iIndex=0;iIndex<oaLayers.length;iIndex++)this.add2ActiveLayers(mapInstanceId,oaLayers[iIndex])},clearActiveLayers:function(mapInstanceId){this.options.activeLayers[mapInstanceId]instanceof Array&&this.options.activeLayers[mapInstanceId].length>0&&this.options.activeLayers[mapInstanceId].splice(0,this.options.activeLayers[mapInstanceId].length)},getLayerHierarchy:function(){return this.options.layerHierarchy},getParentFolderOfLayer:function(layerName){var findFoldersOfLayer=function(sLayerName,oFolder){var oFolderFound,iIndex=emp.helpers.findIndexOf(oFolder.layers,"name",sLayerName);if(iIndex>-1)return oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null;for(iIndex=0;iIndex<oFolder.folders.length;iIndex++)if(oFolderFound=findFoldersOfLayer(sLayerName,oFolder.folders[iIndex]),void 0!==oFolderFound)return null===oFolderFound?oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null:oFolderFound},oFolder=findFoldersOfLayer(layerName,this.options.layerHierarchy);return null===oFolder&&(oFolder=void 0),oFolder},getParentFolderOfFolder:function(folderTitle){var findParentOfFolder=function(sTitle,oFolder){var oFolderFound,iIndex=emp.helpers.findIndexOf(oFolder.folders,"title",sTitle);if(iIndex>-1)return oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null;for(iIndex=0;iIndex<oFolder.folders.length;iIndex++)if(oFolderFound=findParentOfFolder(sTitle,oFolder.folders[iIndex]),void 0!==oFolderFound)return null===oFolderFound?oFolder.hasOwnProperty("title")&&null!==oFolder.title&&""!==oFolder.title?oFolder:null:oFolderFound},oFolder=findParentOfFolder(folderTitle,this.options.layerHierarchy);return null===oFolder&&(oFolder=void 0),oFolder},locate:function(args){var transaction,payload;return args=args||{},args.component=args.component||"",payload=args.bounds?{bounds:args.bounds,zoom:!0,visible:!0}:{featureId:this.id,overlayId:this.overlayId,zoom:!0,visible:!0},transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,items:[new emp.typeLibrary.View(payload)]}),"de"!==args.component?transaction:void transaction.run()},getAllLayer:function(){var oaLayers=[],getLayers=function(oLayerList){for(var oaLayerList=[],iIndex=0;iIndex<oLayerList.length;iIndex++)oaLayerList.push(oLayerList[iIndex].name);return oaLayerList},getLayersFromFolders=function(oFolders){for(var oaLayerList=[],iIndex=0;iIndex<oFolders.length;iIndex++)oaLayerList=oaLayerList.concat(getLayersFromFolders(oFolders[iIndex].folders)),oaLayerList=oaLayerList.concat(getLayers(oFolders[iIndex].layers));return oaLayerList},oaTemp=getLayersFromFolders(this.options.layerHierarchy.folders);return oaLayers=oaLayers.concat(oaTemp),oaTemp=getLayers(this.options.layerHierarchy.layers),oaLayers=oaLayers.concat(oaTemp)},getAllNamedFolders:function(){var getNamedFolders=function(oFolders){for(var oaFolderList=[],iIndex=0;iIndex<oFolders.length;iIndex++)(oFolders[iIndex].layers.length>0||oFolders[iIndex].folders.length>0)&&(oFolders[iIndex].title&&oaFolderList.push(oFolders[iIndex].title),oaFolderList=oaFolderList.concat(getNamedFolders(oFolders[iIndex].folders)));return oaFolderList};return getNamedFolders(this.options.layerHierarchy.folders)},selectFolder:function(mapInstanceId,sFolderName){this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)&&this.options.oaFoldersSelected[mapInstanceId].indexOf(sFolderName)===-1&&this.options.oaFoldersSelected[mapInstanceId].push(sFolderName)},isFolderSelected:function(mapInstanceId,sFolderName){return!!this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)&&this.options.oaFoldersSelected[mapInstanceId].indexOf(sFolderName)!==-1},unselectFolder:function(mapInstanceId,sFolderName){if(this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)){var iIndex=this.options.oaFoldersSelected[mapInstanceId].indexOf(sFolderName);iIndex!==-1&&this.options.oaFoldersSelected[mapInstanceId].splice(iIndex,1)}},selectAllFolders:function(mapInstanceId){this.options.oaFoldersSelected[mapInstanceId]=this.getAllNamedFolders()},unselectAllFolders:function(mapInstanceId){this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)&&this.options.oaFoldersSelected[mapInstanceId].length>0&&this.options.oaFoldersSelected[mapInstanceId].splice(0,this.oaFoldersSelected[mapInstanceId].length)},selectLayer:function(mapInstanceId,sLayerName){this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)&&this.options.oaLayersSelected[mapInstanceId].indexOf(sLayerName)===-1&&this.options.oaLayersSelected[mapInstanceId].push(sLayerName)},isLayerSelected:function(mapInstanceId,sLayerName){return!!this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)&&this.options.oaLayersSelected[mapInstanceId].indexOf(sLayerName)!==-1},unselectLayer:function(mapInstanceId,sLayerName){if(this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)){var iIndex=this.options.oaLayersSelected[mapInstanceId].indexOf(sLayerName);iIndex!==-1&&this.options.oaLayersSelected[mapInstanceId].splice(iIndex,1)}},selectAllLayers:function(mapInstanceId){this.options.oaLayersSelected[mapInstanceId]=this.getAllLayer(),this.clearActiveLayers(mapInstanceId),this.options.activeLayers[mapInstanceId]=emp.helpers.copyObject(this.options.oaLayersSelected[mapInstanceId])},unselectAllLayers:function(mapInstanceId){this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)&&this.options.oaLayersSelected[mapInstanceId].length>0&&this.options.oaLayersSelected[mapInstanceId].splice(0,this.options.oaLayersSelected[mapInstanceId].length)},getObjectData:function(mapInstanceId,coreParentId){var oParent=this.getParentByIndex(0),oObj={coreId:this.getCoreId(),coreParent:coreParentId,parentCoreId:emp.storage.getRootGuid(mapInstanceId),id:this.options.id,overlayId:oParent?oParent.getOverlayId():void 0,name:this.options.name,url:this.options.url,useProxy:this.options.useProxy,params:{transparent:this.options.transparent,format:this.options.format,version:this.options.version},activeLayers:emp.helpers.copyObject(this.options.activeLayers[mapInstanceId]),capabilities:emp.helpers.copyObject(this.options.capabilities),visible:this.isVisibleOnMap(mapInstanceId)};return this.options.layers.length>0&&(oObj.layers=emp.helpers.copyObject(this.options.layers)),new emp.typeLibrary.WMS(oObj)},update:function(args){args.hasOwnProperty("params")&&(args.params.hasOwnProperty("transparent")&&("boolean"==typeof args.params.transparent?this.options.transparent=args.params.transparent:"string"==typeof args.params.transparent&&(this.options.transparent="FALSE"!==this.params.transparent.toUpperCase())),args.params.hasOwnProperty("format")&&"string"==typeof args.params.format&&(this.options.format=args.params.format),args.params.hasOwnProperty("version")&&"string"==typeof args.params.version&&(this.options.version=args.params.version)),args.hasOwnProperty("url")&&(this.options.url=args.url),args.hasOwnProperty("name")&&this.setName(args.name),emp.helpers.isEmptyString(this.getName())&&this.setName("WMS: "+this.options.url),
void 0!==args.layers&&null!==args.layers?(this.options.layers=emp.helpers.copyObject(args.layers),this.options.activeLayers=emp.helpers.copyObject(args.layers)):args.hasOwnProperty("activeLayers")&&(this.options.activeLayers=emp.helpers.copyObject(args.activeLayers))},compareProperty:function(mapInstanceId,sProperty,Value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":case"description":case"readonly":case"visible":bRet=emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value);break;case"featureid":bRet=this.compareValues(this.getId(),Value);break;case"format":bRet=this.compareValues(this.options.format,Value);break;case"transparent":bRet=this.compareValues(this.options.transparent,Value);break;case"version":bRet=this.compareValues(this.options.version,Value);break;case"url":bRet=this.compareValues(this.options.url,Value)}return bRet},canMapEnginePlot:function(mapInstanceId){return emp.helpers.canMapEnginePlotFeature(mapInstanceId,this)}};return publicInterface},emp.classLibrary.EmpWMS=emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){emp.helpers.isEmptyString(args.name)&&(args.name="WMTS: "+args.url);var options={format:args.format||"image/png",version:args.version||"1.0.0",layer:args.layer,style:args.style||"default",sampleDimensions:args.sampleDimensions};args.coreObjectType=emp.typeLibrary.types.WMTS,emp.classLibrary.Util.setOptions(this,options),emp.classLibrary.EmpMapService.prototype.initialize.call(this,args)},getObjectData:function(mapInstanceId,coreParentId){var oParent=this.getParentByIndex(0),oObj={coreId:this.getCoreId(),coreParent:coreParentId,parentCoreId:emp.storage.getRootGuid(mapInstanceId),id:this.options.id,overlayId:oParent?oParent.getOverlayId():void 0,name:this.options.name,url:this.options.url,useProxy:this.options.useProxy,format:this.options.params.format,version:this.options.params.version,layer:this.options.params.layer,style:this.options.params.style,visible:this.isVisibleOnMap(mapInstanceId)};return this.options.sampleDimensions&&(oObj.sampleDimensions=emp.helpers.copyObject(this.options.sampleDimensions)),new emp.typeLibrary.WMTS(oObj)},compareProperty:function(mapInstanceId,sProperty,Value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":case"description":case"readonly":case"visible":bRet=emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value);break;case"url":case"useProxy":case"id":case"params":bRet=emp.classLibrary.EmpMapService.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value)}return bRet}};return publicInterface},emp.classLibrary.EmpWMTS=emp.classLibrary.EmpMapService.extend(emp.classLibrary.privateClass()),emp.classLibrary.privateClass=function(){var publicInterface={initialize:function(args){emp.helpers.isEmptyString(args.name)&&(args.name="KML: "+args.url);var options={version:args.version||"2.2",kmlData:args.kmlData};args.coreObjectType=emp.typeLibrary.types.KML,emp.classLibrary.Util.setOptions(this,options),emp.classLibrary.EmpMapService.prototype.initialize.call(this,args)},getObjectData:function(mapInstanceId,coreParentId){var oParent=this.getParentByIndex(0),oObj={coreId:this.getCoreId(),coreParent:coreParentId,parentCoreId:emp.storage.getRootGuid(mapInstanceId),id:this.options.id,overlayId:oParent?oParent.getOverlayId():void 0,name:this.options.name,url:this.options.url,useProxy:this.options.useProxy,version:this.options.version,kmlData:this.options.kmlData,visible:this.isVisibleOnMap(mapInstanceId)};return new emp.typeLibrary.KmlLayer(oObj)},compareProperty:function(mapInstanceId,sProperty,Value){var bRet=!1;if(!emp.util.isEmptyString(sProperty))switch(sProperty.toLowerCase()){case"name":case"description":case"readonly":case"visible":bRet=emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value);break;case"url":case"useProxy":case"id":bRet=emp.classLibrary.EmpMapService.prototype.compareProperty.call(this,mapInstanceId,sProperty,Value);break;case"kmlData":bRet=this.compareValues(this.options.kmlData,Value)}return bRet}};return publicInterface},emp.classLibrary.EmpKmlLayer=emp.classLibrary.EmpMapService.extend(emp.classLibrary.privateClass());var emp=window.emp||{};emp.map=function(args){function checkResourceType(resource){var type="js";return".css"===resource.substr(resource.length-4,4).toLowerCase()&&(type="css"),type}function loadCSS(args){var fileref=document.createElement("link");fileref.setAttribute("rel","stylesheet"),fileref.setAttribute("type","text/css"),fileref.setAttribute("href",args.url),document.getElementsByTagName("head")[0].appendChild(fileref)}function isScriptLoaded(sURL){var iIndex,sAbsUrl=emp.helpers.relToAbs(sURL),script=document.querySelectorAll("script");for(iIndex=0;iIndex<script.length;iIndex+=1)if(script[iIndex].src===sAbsUrl)return!0;return!1}function loadScript(args){var script=document.createElement("script");script.type="text/javascript",script.src=args.url,isScriptLoaded(script.src)?setTimeout(function(){args.callback()},0):(script.readyState?script.onreadystatechange=function(){"loaded"!==script.readyState&&"complete"!==script.readyState||(script.onreadystatechange=null,args.callback())}:script.onload=function(){args.callback()},document.getElementsByTagName("head")[0].appendChild(script))}function getStartupExtent(){var initialExtent;return defaultExtent&&(defaultExtent.hasOwnProperty("centerLat")&&"number"==typeof defaultExtent.centerLat&&defaultExtent.hasOwnProperty("centerLon")&&"number"==typeof defaultExtent.centerLon&&(defaultExtent.hasOwnProperty("range")&&"number"==typeof defaultExtent.range||defaultExtent.hasOwnProperty("scale")&&"number"==typeof defaultExtent.scale)?(initialExtent={centerLat:defaultExtent.centerLat,centerLon:defaultExtent.centerLon},defaultExtent.hasOwnProperty("range")&&"number"==typeof defaultExtent.range?initialExtent.range=defaultExtent.range:initialExtent.scale=defaultExtent.scale):defaultExtent.hasOwnProperty("north")&&"number"==typeof defaultExtent.north&&defaultExtent.hasOwnProperty("south")&&"number"==typeof defaultExtent.south&&defaultExtent.hasOwnProperty("east")&&"number"==typeof defaultExtent.east&&defaultExtent.hasOwnProperty("west")&&"number"==typeof defaultExtent.west&&(initialExtent={north:defaultExtent.north,south:defaultExtent.south,east:defaultExtent.east,west:defaultExtent.west})),initialExtent}function loadNextResource(){var currentEngineConfiguration=engineConfig.getCurrentEngineConfiguration();if(completed+=1,completed<resourceLen){document.getElementById(mapInstanceId+"_loadingStatus").innerHTML=completed+" of "+resourceLen+" Loaded...";var resource=currentEngineConfiguration.engineBasePath+resources.shift();if(resource){var type=checkResourceType(resource);"css"===type?(loadCSS({url:resource}),loadNextResource()):loadScript({url:resource,callback:loadNextResource})}}else{document.getElementById(mapInstanceId+"_loadingStatus").innerHTML="All resources have loaded";var initialExtent=getStartupExtent();loadComplete({configProperties:currentEngineConfiguration.properties,mapInstance:publicInterface,extent:initialExtent}),document.getElementById(mapInstanceId+"_loadingPanel").style.visibility="hidden"}}function loadResource(args){var type=checkResourceType(args.url);"css"===type?(loadCSS({url:args.url}),args.callback()):loadScript({url:args.url,callback:args.callback})}function manifestSuccess(){var oResources,currentEngineConfiguration=engineConfig.getCurrentEngineConfiguration(),currentMapEngineId=engineConfig.getCurrentMapEngineId(),oMapRegistration=emp.instanceManager.getMapEngineRegistration(currentMapEngineId);if(oMapRegistration)if(oResources=oMapRegistration.fnInitialize({engine:currentEngineConfiguration}),publicInterface.engineId=currentMapEngineId,oResources){oMapRegistration.fnCreateInstance=oResources.fnCreateInstance,resources=oResources.resourceList,resourceLen=resources.length,loadComplete=oResources.fnCreateInstance;var resource=resources.shift();loadResource({url:currentEngineConfiguration.engineBasePath+resource,callback:loadNextResource})}else new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"Map engine did NOT return resources from its initialize function."});else new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"Map engine registration not found."})}function handlerStatusChange(oTransaction){switch(oTransaction.items[0].status){case emp.map.states.INITIALIZING:break;case emp.map.states.READY:bReloadInProgress?(publicInterface.eventing.voice.silence(!0),setMapView()):bLoadInProgress&&(bLoadInProgress=!1,emp.transactionQueue.run(oTransaction.mapInstanceId));break;case emp.map.states.MAP_INSTANCE_INIT_FAILED:bLoadInProgress=!1}}function handleTCDrawEditBegin(oTransaction){if(!bReloadInProgress&&sDrawEditTransactionID===oTransaction.transactionId)switch(oTransaction.intent){case emp.intents.control.DRAW_BEGIN:case emp.intents.control.EDIT_BEGIN:switch(publicInterface.status.get()){case emp.map.states.DRAW:case emp.map.states.EDIT:sDrawEditIntent=void 0,oDrawEditOperation=void 0,sDrawEditTransactionID=void 0,new publicInterface.eventing.StatusChange({status:emp.map.states.READY})}}}function handleDrawEditStart(oStartEventTransaction){var oTransaction=oStartEventTransaction.items[0];switch(sDrawEditIntent=oTransaction.intent,oTransaction.items.length>0&&(oDrawEditOperation=oTransaction.items[0]),sDrawEditTransactionID=oTransaction.transactionId,sDrawEditIntent){case emp.intents.control.DRAW_BEGIN:new publicInterface.eventing.StatusChange({status:emp.map.states.DRAW});break;case emp.intents.control.EDIT_BEGIN:new publicInterface.eventing.StatusChange({status:emp.map.states.EDIT})}}function mapSwapSetViewcomplete(oTransaction){oTransaction&&sMapSwapSetViewTransactionId&&oTransaction.transactionId===sMapSwapSetViewTransactionId&&(sMapSwapSetViewTransactionId=void 0,emp.transactionQueue.listener.remove({type:emp.intents.control.VIEW_SET,mapInstanceId:mapInstanceId,callback:mapSwapSetViewcomplete}),emp.storage.reload(mapInstanceId))}function setMapView(){publicInterface.eventing.voice.silence(!1),sMapSwapSetViewTransactionId=emp.helpers.id.newGUID(),emp.transactionQueue.listener.add({type:emp.intents.control.VIEW_SET,mapInstanceId:mapInstanceId,callback:mapSwapSetViewcomplete});var oView=new emp.typeLibrary.View({transactionId:sMapSwapSetViewTransactionId,center:oViewCenter,range:dViewRange}),oTransaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,transactionId:sMapSwapSetViewTransactionId,sender:"CORE",intent:emp.intents.control.VIEW_SET,items:[oView]});oTransaction.run()}function storageReloadComplete(oTrans){var oTransaction=new emp.typeLibrary.Transaction({mapInstanceId:oTrans.mapInstanceId,intent:emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,source:emp.core.sources.STORAGE,items:[]});oTransaction.run(),emp.transactionQueue.run(oTrans.mapInstanceId),bReloadInProgress=!1}function processEngineSwapRequest(mapInstanceId){if(bDoReload=!1,emp.instanceManager.isMapEngineLoading())return void setTimeout(function(){processEngineSwapRequest(mapInstanceId)},100);if(emp.transactionQueue.isTransactionOutStanding(mapInstanceId))return void setTimeout(function(){processEngineSwapRequest(mapInstanceId)},100);new publicInterface.eventing.StatusChange({status:emp.map.states.MAP_SWAP_IN_PROGRESS}),emp.transactionQueue.pause(mapInstanceId),bReloadInProgress=!0;var oTransaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.MAP_ENGINE_SWAP_START,source:emp.core.sources.STORAGE,items:[]});oTransaction.run();try{publicInterface.engine.hasOwnProperty("state")&&publicInterface.engine.state.destroy(),emp.storage.prepForMapSwap(mapInstanceId)}catch(err){emp.typeLibrary.Error({jsError:err,message:"An exception occurred while calling engine.state.destroy before performing a map swap",level:emp.typeLibrary.Error.level.MINOR}),emp.transactionQueue.run(mapInstanceId)}publicInterface.engine=null,loadMapEngine()}function verifyManifestLoaded(){var previousMapEngineId,previousMapEngineConfiguration,currentEngineConfiguration,currentMapEngineId=engineConfig.getCurrentMapEngineId(),oMapRegistration=emp.instanceManager.getMapEngineRegistration(currentMapEngineId);if(oMapRegistration)publicInterface.engineId=currentMapEngineId;else if(currentEngineConfiguration=engineConfig.getCurrentEngineConfiguration(),publicInterface.engines.isMapSwapInProgress()){previousMapEngineId=engineConfig.getPreviousMapEngineId(),previousMapEngineConfiguration=emp.instanceManager.getMapEngineRegistration(previousMapEngineId).engineConfiguration,window.console.error("Map manifest failed to load with config. Attempting to reload previous map.",currentEngineConfiguration),document.getElementById(mapInstanceId+"_loadSpinner").style.visibility="hidden",document.getElementById(mapInstanceId+"_loadingMessage").style.visibility="visible",document.getElementById(mapInstanceId+"_loadingMessage").innerHTML="<h3 style='color:coral'>Swap Failed</h3>",document.getElementById(mapInstanceId+"_loadingStatus").innerHTML="<div>The selected map's manifest file failed to load. Attempting to reload previous map.</div><div><span font-size:0.75em>See console for details...</span></div>";var oTransaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,source:emp.core.sources.STORAGE,items:[]});oTransaction.run(),emp.transactionQueue.run(mapInstanceId),bReloadInProgress=!1,publicInterface.engine={},setTimeout(function(){previousSwapFailed=!0,publicInterface.engines.load(previousMapEngineConfiguration)},5e3)}else window.console.error("Map manifest failed to load with config",currentEngineConfiguration),document.getElementById(mapInstanceId+"_loadSpinner").style.visibility="hidden",document.getElementById(mapInstanceId+"_loadingMessage").innerHTML="<h3 style='color:coral'>Map Load Failed</h3>",document.getElementById(mapInstanceId+"_loadingStatus").innerHTML='<div>The selected map\'s manifest file failed to load.</div><div>Contact your administrator</div><div><span style="font-size:0.75em">See console for details...</span></div>'}function loadMapEngine(){var currentMapEngineId=engineConfig.getCurrentMapEngineId(),currentEngineConfiguration=engineConfig.getCurrentEngineConfiguration();bReloadInProgress||(bLoadInProgress=!0),previousSwapFailed&&(document.getElementById(mapInstanceId+"_loadingMessage").innerHTML="Loading Map",document.getElementById(mapInstanceId+"_loadingSpinner").style.visiblity="visible",previousSwapFailed=!1),document.getElementById(mapInstanceId+"_loadingStatus").innerHTML="Fetching map resources...";for(var mapNode=document.getElementById(mapInstanceId+"_map");mapNode.firstChild;)mapNode.removeChild(mapNode.firstChild);var date=new Date,id=mapInstanceId+"_"+date.getTime();container=id;var d=document.createElement("div");d.id=id,d.style.width="100%",d.style.height="100%",document.getElementById(mapInstanceId+"_map").appendChild(d),setTimeout(function(){var oMapRegistration=emp.instanceManager.getMapEngineRegistration(currentMapEngineId);try{if(oMapRegistration){var initialExtent=getStartupExtent();document.getElementById(mapInstanceId+"_loadingStatus").innerHTML="All resources have loaded!",oMapRegistration.fnCreateInstance({configProperties:currentEngineConfiguration.properties,mapInstance:publicInterface,extent:initialExtent}),publicInterface.engineId=currentMapEngineId,document.getElementById(mapInstanceId+"_loadingPanel").style.visibility="hidden"}else completed=0,loadComplete=null,loadScript({url:currentEngineConfiguration.manifestUrl,callback:manifestSuccess}),setTimeout(verifyManifestLoaded,1e4)}catch(err){emp.instanceManager.mapInstanceStartupFailed(mapInstanceId)}},0),bReloadInProgress&&(document.getElementById(mapInstanceId+"_loadingPanel").style.visiblity="visible")}function handleDrawEditEnded(){}function handleDrawEditCanceled(oTransaction){if(bDoReload)setTimeout(function(){processEngineSwapRequest(oTransaction.mapInstanceId)},1e3);else if(bExecuteRemove){var oRTran=oRemoveTransaction;setTimeout(function(){oRTran.run()},50),oRemoveTransaction=void 0,bExecuteRemove=!1}else null!==oEditDrawTransaction&&(oEditDrawTransaction.run(),oEditDrawTransaction=null)}function removeListeners(mapInstanceId){emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_CHANGE,mapInstanceId:mapInstanceId,callback:handlerStatusChange}),emp.transactionQueue.listener.remove({type:emp.intents.control.DRAW_BEGIN,mapInstanceId:mapInstanceId,callback:handleTCDrawEditBegin}),emp.transactionQueue.listener.remove({type:emp.intents.control.EDIT_BEGIN,mapInstanceId:mapInstanceId,callback:handleTCDrawEditBegin}),emp.transactionQueue.listener.remove({type:emp.intents.control.DRAW_START,mapInstanceId:mapInstanceId,callback:handleDrawEditStart}),emp.transactionQueue.listener.remove({type:emp.intents.control.EDIT_START,mapInstanceId:mapInstanceId,callback:handleDrawEditStart}),emp.transactionQueue.listener.remove({type:emp.intents.control.DRAW_ENDED,mapInstanceId:mapInstanceId,callback:handleDrawEditEnded}),emp.transactionQueue.listener.remove({type:emp.intents.control.EDIT_ENDED,mapInstanceId:mapInstanceId,callback:handleDrawEditEnded}),emp.transactionQueue.listener.remove({type:emp.intents.control.DRAW_CANCEL,mapInstanceId:mapInstanceId,callback:handleDrawEditCanceled}),emp.transactionQueue.listener.remove({type:emp.intents.control.EDIT_CANCEL,mapInstanceId:mapInstanceId,callback:handleDrawEditCanceled}),emp.transactionQueue.listener.remove({type:emp.intents.control.STORAGE_RELOAD_COMPLETE,mapInstanceId:mapInstanceId,callback:storageReloadComplete})}var loadComplete,previousSwapFailed,sDrawEditIntent,oDrawEditOperation,sDrawEditTransactionID,sManifestFile,oRemoveTransaction,currentStatus,sDefaultLayerOverlayID,container,sMapSwapSetViewTransactionId,editingManager,freehandLineColorOverride,freehandLineWidthOverride,activeEngine=null,oViewBounds={north:0,south:0,east:0,west:0},oViewCenter={lat:0,lon:0},dViewRange=5e6,resources=[],resourceLen=0,completed=0,bLoadInProgress=!1,bReloadInProgress=!1,bDoReload=!1,bExecuteRemove=!1,engineConfig=emp.util.config,oEditDrawTransaction=null,engDirectDefault={name:"undefined",ref:null},mapInstanceId=args.mapInstanceId,defaultExtent=args.extent,freehandMode=!1,freehandModeDrawStart=!1,freehandLineColor="FFFFFF00",freehandLineWidth=8,freehandFeature=new emp.typeLibrary.Feature({featureId:"freehandX",coreId:"freehandX",name:"",format:emp3.api.enums.FeatureTypeEnum.GEO_PATH,data:{type:"LineString",coordinates:[]},readOnly:!0,properties:{lineColor:freehandLineColor,lineWidth:freehandLineWidth}}),publicInterface={engineId:"",mapInstanceId:mapInstanceId,freehandStart:function(args){var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:mapInstanceId,transactionId:"",sender:"",source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.FREEHAND_START,originalMessage:{},messageOriginator:"",originalMessageType:cmapi.channel.names.FREEHAND_START,items:[{lock:emp3.api.enums.MapMotionLockEnum.SMART_MOTION}]});this.engine.navigation.enable(transaction),freehandMode=!0,args.freehandStrokeStyle&&(args.freehandStrokeStyle.strokeColor&&(freehandLineColorOverride=emp.util.convertColorToHexColor(args.freehandStrokeStyle.strokeColor)),args.freehandStrokeStyle.strokeWidth&&(freehandLineWidthOverride=args.freehandStrokeStyle.strokeWidth))},freehandStop:function(){var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:mapInstanceId,transactionId:"",sender:"",source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.FREEHAND_STOP,originalMessage:{},messageOriginator:"",originalMessageType:cmapi.channel.names.FREEHAND_STOP,items:[{lock:emp3.api.enums.MapMotionLockEnum.UNLOCKED}]});this.engine.navigation.enable(transaction),freehandMode=!1,freehandLineColorOverride=void 0,freehandLineWidthOverride=void 0},setFreehandStrokeStyle:function(strokeStyle){strokeStyle.strokeColor&&(freehandLineColor=emp.util.convertColorToHexColor(strokeStyle.strokeColor)),strokeStyle.strokeWidth&&(freehandLineWidth=strokeStyle.strokeWidth)},eventing:{mapDrag:!1,mapDragStart:null,voice:{silent:!1,silence:function(args){this.silent=args}},SelectionChange:function(args){var i,len,transaction,features=[],success=!1;try{if(args.length<1)features.push(new emp.typeLibrary.Selection({type:"empty"}));else for(len=args.length,i=0;i<len;i+=1)features.push(new emp.typeLibrary.Selection(args[i]));transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.SELECTION_CHANGE,intentParams:"selected",originChannel:"map.feature.selected",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:features}),transaction.run(),success=!0}catch(e){success=!1,emp.typeLibrary.Error({message:"A SelectionChange event created by the map engine threw an error",jsError:e,level:0})}return success},ViewChange:function(viewArgs,lookAtArgs,mapViewEventEnum){if(!bReloadInProgress){var view=new emp.typeLibrary.View(viewArgs);view.animate=mapViewEventEnum===emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION?1:0;var lookAt=new emp.typeLibrary.LookAt(lookAtArgs);lookAt.animate=mapViewEventEnum===emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION?1:0,oViewCenter.lat=view.location.lat,oViewCenter.lon=view.location.lon,dViewRange=view.range,oViewBounds.north=view.bounds.north,oViewBounds.south=view.bounds.south,oViewBounds.east=view.bounds.east,oViewBounds.west=view.bounds.west;var transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,originChannel:"map.status.view",intent:emp.intents.control.VIEW_CHANGE,source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[view,lookAt]});transaction.run()}},Pointer:function(args){var transaction,fTransaction,dragPointer,pointer=new emp.typeLibrary.Pointer(args),intent=emp.intents.control.POINTER,mapInstance=emp.instanceManager.getInstance(mapInstanceId),editingManager=mapInstance.editingManager.get();if(freehandMode)args.type===emp.typeLibrary.Pointer.EventType.MOUSEDOWN?(freehandModeDrawStart=!0,freehandFeature.data.coordinates.push([pointer.lon,pointer.lat]),freehandFeature.overlayId=mapInstanceId,freehandFeature.parentCoreId=mapInstanceId,freehandLineColorOverride?freehandFeature.properties.lineColor=freehandLineColorOverride:freehandFeature.properties.lineColor=freehandLineColor,freehandLineWidthOverride?freehandFeature.properties.lineWidth=freehandLineWidthOverride:freehandFeature.properties.lineWidth=freehandLineWidth,transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.FREEHAND_LINE_DRAW_START,originChannel:"cmapi2.map.freehand",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[freehandFeature]}),transaction.run()):args.type===emp.typeLibrary.Pointer.EventType.MOUSEUP?(freehandModeDrawStart=!1,freehandFeature.data.coordinates.push([pointer.lon,pointer.lat]),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_REMOVE,mapInstanceId:mapInstanceId,originChannel:cmapi.channel.names.FEATURE_REMOVE,source:emp.core.sources.MAP,items:[freehandFeature]}),mapInstance&&mapInstance.engine&&mapInstance.engine.feature.remove(transaction),transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.FREEHAND_LINE_DRAW_END,originChannel:"cmapi2.map.freehand",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[freehandFeature]}),transaction.run(),freehandFeature.data.coordinates=[]):args.type===emp.typeLibrary.Pointer.EventType.MOVE&&freehandModeDrawStart&&(freehandFeature.data.coordinates.push([pointer.lon,pointer.lat]),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.core.sources.MAP,items:[freehandFeature]}),mapInstance&&mapInstance.engine&&mapInstance.engine.feature.add(transaction),transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.FREEHAND_LINE_DRAW_UPDATE,originChannel:"cmapi2.map.freehand",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[freehandFeature]}),transaction.run());else{if(!args.type)return;args.type===emp.typeLibrary.Pointer.EventType.MOUSEDOWN?mapInstance.status.get()===emp.map.states.EDIT?(this.mapDragStart={featureId:pointer.featureId,startX:pointer.clientX,startY:pointer.clientY},editingManager.editMouseDown(pointer.featureId)):this.mapDragStart={}:args.type===emp.typeLibrary.Pointer.EventType.MOVE?this.mapDragStart&&this.mapDrag!==!0?this.mapDragStart.featureId&&mapInstance.status.get()===emp.map.states.EDIT?(this.mapDrag=!0,args.featureId=this.mapDragStart.featureId,args.target="feature",args.type=emp.typeLibrary.Pointer.EventType.DRAG,dragPointer=new emp.typeLibrary.Pointer(args),editingManager.editDragStart(this.mapDragStart.featureId,dragPointer)):(this.mapDrag=!0,args.type=emp.typeLibrary.Pointer.EventType.DRAG,args.coreId=void 0,args.featureId=void 0,args.target="globe",dragPointer=new emp.typeLibrary.Pointer(args),fTransaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:intent,originChannel:"cmapi2.map.view.drag",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[dragPointer]}),fTransaction.run()):this.mapDragStart&&this.mapDrag===!0&&this.mapDragStart.featureId&&mapInstance.status.get()===emp.map.states.EDIT&&this.mapDrag===!0&&mapInstance.editingManager.get().editDragMove(this.mapDragStart.featureId,this.mapDragStart.startX,this.mapDragStart.startY,pointer):args.type===emp.typeLibrary.Pointer.EventType.MOUSEUP&&this.mapDrag&&(this.mapDragStart.featureId?(args.type=emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE,args.target="feature",args.featureId=this.mapDragStart.featureId,dragPointer=new emp.typeLibrary.Pointer(args),mapInstance.editingManager.get().editDragComplete(this.mapDragStart.featureId,this.mapDragStart.startX,this.mapDragStart.startY,dragPointer),this.mapDragStart=null,this.mapDrag=!1):(args.type=emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE,args.coreId=void 0,args.featureId=void 0,args.target="globe",dragPointer=new emp.typeLibrary.Pointer(args),fTransaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:intent,originChannel:"cmapi2.map.view.dragComplete",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[dragPointer]}),fTransaction.run(),this.mapDragStart=null,this.mapDrag=!1)),args.type!==emp.typeLibrary.Pointer.EventType.SINGLE_CLICK&&args.type!==emp.typeLibrary.Pointer.EventType.DBL_CLICK||(intent=emp.intents.control.CLICK,"feature"===pointer.target.toLowerCase()&&(fTransaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.FEATURE_CLICK,originChannel:"map.feature.clicked",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[pointer]}),fTransaction.run())),transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:intent,originChannel:"map.view.clicked",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[pointer]}),transaction.run()}},SelectionBox:function(args){var transaction,viewArea=new emp.typeLibrary.SelectionBox(args);transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,source:"CORE-EVENTING",intent:emp.intents.control.SELECTION_BOX,originChannel:"map.view.area.selected",sender:"EMP_MAP_CORE",transactionId:emp.helpers.id.newGUID(),items:[viewArea]}),transaction.run()},StaticContent:function(args){var transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.STATIC_CONTENT,transactionId:emp.helpers.id.newGUID(),source:emp.core.sources.MAP,items:args});transaction.run()},Error:function(args){var error=emp.typeLibrary.Error(args),transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.ERROR,transactionId:emp.helpers.id.newGUID(),source:emp.core.sources.MAP,items:[error]});transaction.run()},StatusChange:function(args){var newStatus=new emp.typeLibrary.Status(args),transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.STATUS_CHANGE,intentParams:"initialization",originChannel:"map.status.request",source:emp.core.sources.MAP,transactionId:emp.helpers.id.newGUID(),items:[newStatus]});void 0!==newStatus.status&&null!==newStatus.status&&publicInterface.status.set(newStatus.status),transaction.run()},DrawStart:function(args){args.hasOwnProperty("failures")&&args.transaction.fail(args.failures),publicInterface.eventing.voice.silent&&(args.transaction.success=[]);var transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.DRAW_START,transactionId:emp.helpers.id.newGUID(),source:emp.core.sources.MAP,items:[args.transaction]});transaction.run()},DrawEnd:function(args){var oDraw=args.transaction.items[0];args.hasOwnProperty("failures")?(args.transaction.fail([{coreId:oDraw.coreId,level:emp.typeLibrary.Error.level.INFO,message:"Operation Canceled."}]),void 0!==oDraw&&(args.transaction.duplicateItems.push(oDraw),oDraw.cancel({mapInstanceId:mapInstanceId}))):void 0!==oDraw&&oDraw.end({mapInstanceId:mapInstanceId,source:args.transaction.source}),publicInterface.eventing.voice.silent&&(args.transaction.success=[]);var transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.DRAW_ENDED,source:emp.core.sources.MAP,items:[args.transaction]});transaction.run()},EditStart:function(args){args.hasOwnProperty("failures")&&args.transaction.fail(args.failures),publicInterface.eventing.voice.silent&&(args.transaction.success=[]);var transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.EDIT_START,transactionId:emp.helpers.id.newGUID(),source:emp.core.sources.MAP,items:[args.transaction]});transaction.run()},EditEnd:function(args){var oEdit=args.transaction.items[0];args.hasOwnProperty("failures")&&args.transaction.fail([{coreId:oEdit.coreId,level:emp.typeLibrary.Error.level.INFO,message:"Operation Canceled."}]),publicInterface.eventing.voice.silent&&(args.transaction.success=[]),args.hasOwnProperty("failures")?(args.transaction.duplicateItems.push(oEdit),oEdit.cancel({mapInstanceId:mapInstanceId})):oEdit.end({mapInstanceId:mapInstanceId});var transaction=new emp.typeLibrary.Transaction({mapInstanceId:mapInstanceId,intent:emp.intents.control.EDIT_ENDED,source:emp.core.sources.MAP,items:[args.transaction]});transaction.run()}},status:{get:function(){return currentStatus.status},set:function(args){currentStatus.status=args},getViewBounds:function(){return oViewBounds},getViewCenter:function(){return oViewCenter},getViewRange:function(){return dViewRange},getMapLockStatus:function(){return currentStatus.mapLockStatus},setMapLockStatus:function(status){currentStatus.mapLockStatus=status},validateState:function(oTransaction){var bConfirmResponse,bSuccess=!0,sErrorMsg="",confirmationMessage="";if(oTransaction.intent===emp.intents.control.DRAW_BEGIN)switch(publicInterface.status.get()){case emp.map.states.EDIT:confirmationMessage='A new draw command has started while in edit mode. Click "OK" to cancel the current edit operation and begin drawing a new feature.  Click "Cancel" to ignore the new draw command and continue editing the current feature.';break;case emp.map.states.DRAW:confirmationMessage='A new draw command has started while in draw mode. Click "OK" to cancel the current draw operation and begin drawing a new feature.  Click "Cancel" to ignore the new draw command and continue drawing the current feature.';
}else if(oTransaction.intent===emp.intents.control.EDIT_BEGIN)switch(publicInterface.status.get()){case emp.map.states.EDIT:confirmationMessage='A new edit command has started while in edit mode. Click "OK" to cancel the current edit operation and begin editing a different feature.  Click "Cancel" to ignore the new edit command and continue editing the current feature.';break;case emp.map.states.DRAW:confirmationMessage='A new edit command has started while in draw mode. Click "OK" to cancel the current draw operation and begin editing a different feature.  Click "Cancel" to ignore the new edit command and continue drawing the current feature.'}if(""!==confirmationMessage&&(bConfirmResponse=confirm(confirmationMessage),bConfirmResponse?(oEditDrawTransaction=oTransaction,oTransaction.pause(),setTimeout(publicInterface.engines.drawEditCancel(),100)):(bSuccess=!1,sErrorMsg="Draw or Edit command cancelled by user due to an existing draw or edit already in progress.")),!bSuccess)for(;oTransaction.items.length>0;)oTransaction.fail([{coreId:oTransaction.items[0].coreId,level:emp.typeLibrary.Error.level.MINOR,message:sErrorMsg}]);return!0},cancelDrawEditForOverlayRemove:function(oTransaction){var oOverlay,oParent,sParentKey,iIndex,bExecuteCancel=!1;switch(publicInterface.status.get()){case emp.map.states.EDIT:case emp.map.states.DRAW:for(sParentKey=emp.helpers.id.get.coreParent(oDrawEditOperation);!bExecuteCancel&&sParentKey!==emp.storage.getRootGuid(this.mapInstanceId);){for(iIndex=0;iIndex<oTransaction.items.length;iIndex++)if(oOverlay=oTransaction.items[iIndex],sParentKey===oOverlay.coreId){bExecuteCancel=!0;break}if(!bExecuteCancel){if(oParent=emp.storage._storage.get({coreId:sParentKey}),!oParent)break;sParentKey=oParent.coreParent}}bExecuteCancel?(oTransaction.pause(),oRemoveTransaction=oTransaction,bExecuteRemove=!0,setTimeout(publicInterface.engines.drawEditCancel(),100)):bExecuteRemove=!1}return!0},cancelDrawEditForFeatureRemove:function(oTransaction){var sDrawEditKey,bExecuteCancel=!1,iIndex=0;switch(publicInterface.status.get()){case emp.map.states.EDIT:case emp.map.states.DRAW:for(sDrawEditKey=oDrawEditOperation.coreId,iIndex=0;iIndex<oTransaction.items.length;iIndex++)if(oTransaction.items[iIndex].coreId===sDrawEditKey){bExecuteCancel=!0;break}bExecuteCancel?(oTransaction.pause(),oRemoveTransaction=oTransaction,bExecuteRemove=!0,setTimeout(publicInterface.engines.drawEditCancel,50)):bExecuteRemove=!1}return!0}},configuration:{formats:[],burstSoftLimit:200},engines:{isMapSwapInProgress:function(){return bReloadInProgress},isInitialLoadInProgress:function(){return bLoadInProgress},validateOverlayRemoval:function(oTransaction){var oOverlay,iIndex;for(iIndex=0;iIndex<oTransaction.items.length;iIndex++)oOverlay=oTransaction.items[iIndex],oOverlay.overlayId===publicInterface.engines.getDefaultLayerOverlayID(oTransaction.mapInstanceId)?oTransaction.fail(emp.typeLibrary.Error({coreId:oOverlay.coreId,level:emp.typeLibrary.Error.level.MINOR,message:"The default layer overlay can not be removed."})):oOverlay.overlayId===emp.wms.manager.getWmsOverlayId(oTransaction.mapInstanceId)&&oTransaction.fail(emp.typeLibrary.Error({coreId:oOverlay.coreId,level:emp.typeLibrary.Error.level.MINOR,message:"The WMS Service overlay can not be removed."}))},validateOverlayClear:function(oTransaction){var oOverlay,iIndex;for(iIndex=0;iIndex<oTransaction.items.length;iIndex++)oOverlay=oTransaction.items[iIndex],oOverlay.overlayId===publicInterface.engines.getDefaultLayerOverlayID(oTransaction.mapInstanceId)?oTransaction.fail(emp.typeLibrary.Error({coreId:oOverlay.coreId,level:emp.typeLibrary.Error.level.MINOR,message:"The default layer overlay can not be cleared."})):oOverlay.overlayId===emp.wms.manager.getWmsOverlayId(oTransaction.mapInstanceId)&&oTransaction.fail(emp.typeLibrary.Error({coreId:oOverlay.coreId,level:emp.typeLibrary.Error.level.MINOR,message:"The WMS Service overlay can not be cleared."}))},getDefaultLayerOverlayID:function(){return sDefaultLayerOverlayID},drawEditCancel:function(){emp.transactionQueue.cancel(sDrawEditTransactionID)},drawEditComplete:function(){emp.transactionQueue.end(sDrawEditTransactionID)},load:function(args){var bProceedWithSwap,sTempText="";if(!args.hasOwnProperty("mapEngineId")||emp.helpers.isEmptyString(args.mapEngineId)||!args.hasOwnProperty("engineBasePath")||emp.helpers.isEmptyString(args.engineBasePath))throw new Error("Required engine configuration properties missing.");if(args.manifestName=args.manifestName||"manifest.js",args.properties=args.properties||{},args.engineBasePath="/"!==args.engineBasePath.substr(args.engineBasePath.length-1)?args.engineBasePath+"/":args.engineBasePath,args.manifestUrl=args.engineBasePath+args.manifestName,engineConfig.setCurrentEngineConfiguration(args),null!==publicInterface.engine){if(publicInterface.status.get()===emp.map.states.DRAW?sTempText="Draw":publicInterface.status.get()===emp.map.states.EDIT&&(sTempText="Edit"),publicInterface.status.get()===emp.map.states.DRAW||publicInterface.status.get()===emp.map.states.EDIT)return bProceedWithSwap=confirm("Swapping map engines at this time will cancel the "+sTempText+" operation.\nDo you want to cancel the operation and swap the map engines?"),void(bProceedWithSwap&&(bDoReload=!0,publicInterface.engines.drawEditCancel()));processEngineSwapRequest(mapInstanceId),publicInterface.engineDirect=engDirectDefault}else publicInterface.engineDirect=engDirectDefault,loadMapEngine()},loadResources:function(manifest){var sManifestURL=emp.helpers.relToAbs(sManifestFile),oMapRegistration=emp.instanceManager.getMapEngineRegistration(sManifestURL);oMapRegistration&&(oMapRegistration.fnCreateInstance=manifest.fnCreateInstance,publicInterface.engineName=oMapRegistration.name),resources=manifest.resourceList,resourceLen=resources.length,loadComplete=manifest.fnCreateInstance;var resource=resources.shift();loadResource({url:resource,callback:loadNextResource})},set:function(engine){activeEngine=engine,activeEngine.init()}},editingManager:{get:function(){return editingManager}},container:{get:function(){return container}},engineDirect:engDirectDefault,engine:activeEngine,init:function(){var oRootOverlay;editingManager=new emp.editingManager({mapInstance:this}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_CHANGE,mapInstanceId:this.mapInstanceId,callback:handlerStatusChange}),emp.transactionQueue.listener.add({type:emp.intents.control.DRAW_BEGIN,mapInstanceId:this.mapInstanceId,callback:handleTCDrawEditBegin}),emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_BEGIN,mapInstanceId:this.mapInstanceId,callback:handleTCDrawEditBegin}),emp.transactionQueue.listener.add({type:emp.intents.control.DRAW_START,mapInstanceId:this.mapInstanceId,callback:handleDrawEditStart}),emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_START,mapInstanceId:this.mapInstanceId,callback:handleDrawEditStart}),emp.transactionQueue.listener.add({type:emp.intents.control.DRAW_ENDED,mapInstanceId:this.mapInstanceId,callback:handleDrawEditEnded}),emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_ENDED,mapInstanceId:this.mapInstanceId,callback:handleDrawEditEnded}),emp.transactionQueue.listener.add({type:emp.intents.control.DRAW_CANCEL,mapInstanceId:this.mapInstanceId,callback:handleDrawEditCanceled}),emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_CANCEL,mapInstanceId:this.mapInstanceId,callback:handleDrawEditCanceled}),emp.transactionQueue.listener.add({type:emp.intents.control.STORAGE_RELOAD_COMPLETE,mapInstanceId:this.mapInstanceId,callback:storageReloadComplete}),oRootOverlay=emp.storage.findObject(emp.storage.getRootGuid(this.mapInstanceId)),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_OVERLAY_ADD,mapInstanceId:this.mapInstanceId,items:[oRootOverlay.getObjectData(this.mapInstanceId,void 0)]}),oTransaction.queue(),sDefaultLayerOverlayID=emp.helpers.id.newGUID();var oDefaultLayerOverlay=new emp.typeLibrary.Overlay({overlayId:sDefaultLayerOverlayID,name:"Layers",description:"This overlay groups all KML, GEOJSON, Image feature urls plotted with no overlay defined.",permissions:!0,hidden:!0}),oTransaction=new emp.typeLibrary.Transaction({mapInstanceId:this.mapInstanceId,intent:emp.intents.control.OVERLAY_ADD,source:emp.core.sources.CORE,items:[oDefaultLayerOverlay]});oTransaction.queue()},discardInstance:function(){removeListeners(this.mapInstanceId),publicInterface.engine&&(publicInterface.engine.state.destroy(),delete publicInterface.engine,publicInterface.engine=void 0)}};return currentStatus={status:emp.map.states.IDLE},publicInterface},emp.map.states={INITIALIZING:"init",READY:"ready",ERROR:"error",IDLE:"idle",EDIT:"edit",DRAW:"draw",FREEHAND:"freehand",TEARDOWN:"teardown",MAP_SWAP_IN_PROGRESS:"mapswapinprogress",SHUTDOWN_IN_PROGRESS:"shutdowninprogress",MAP_INSTANCE_INIT_FAILED:"mapInstanceInitFailed"},emp.map.cursor={ENABLED:"enabled",DISABLED:"disabled"};var emp=window.emp||{};emp.map=emp.map||{},emp.map.createEngineTemplate=function(){var ENGINE_INTERFACE_CN="MAP_CORE_ENGINE_INTERFACE",engineInterface={};return engineInterface.implementation={},engineInterface.implementation.displayName="Map Engine",engineInterface.implementation.version="1.0",engineInterface.implementation.help={},engineInterface.implementation.help.edit="This map engine does not provide a help screen at this time.",engineInterface.implementation.help.draw="This map engine does not provide a help screen at this time.",engineInterface.capabilities={},engineInterface.capabilities.mapType={},engineInterface.capabilities.projection={},engineInterface.capabilities.projection.flat=!1,engineInterface.capabilities.mapType.type2D=!1,engineInterface.capabilities.mapType.type2_5D=!1,engineInterface.capabilities.mapType.type3D=!1,engineInterface.capabilities.formats={},engineInterface.capabilities.formats.GEOJSON_BASIC={},engineInterface.capabilities.formats.GEOJSON_BASIC.plot=!1,engineInterface.capabilities.formats.GEOJSON_BASIC.draw=!1,engineInterface.capabilities.formats.GEOJSON_BASIC.edit=!1,engineInterface.capabilities.formats.GEOJSON_FULL={},engineInterface.capabilities.formats.GEOJSON_FULL.plot=!1,engineInterface.capabilities.formats.GEOJSON_FULL.draw=!1,engineInterface.capabilities.formats.GEOJSON_FULL.edit=!1,engineInterface.capabilities.formats.WMS={},engineInterface.capabilities.formats.WMS.version_1_1=!1,engineInterface.capabilities.formats.WMS.version_1_3=!1,engineInterface.capabilities.formats.WMS.elevationData=!1,engineInterface.capabilities.formats.WMTS={},engineInterface.capabilities.formats.WMTS.version_1_0_0=!1,engineInterface.capabilities.formats.KML_LAYER={},engineInterface.capabilities.formats.KML_BASIC={},engineInterface.capabilities.formats.KML_BASIC.plot=!1,engineInterface.capabilities.formats.KML_BASIC.draw=!1,engineInterface.capabilities.formats.KML_BASIC.edit=!1,engineInterface.capabilities.formats.KML_COMPLEX={},engineInterface.capabilities.formats.KML_COMPLEX.plot=!1,engineInterface.capabilities.formats.KML_COMPLEX.draw=!1,engineInterface.capabilities.formats.KML_COMPLEX.edit=!1,engineInterface.capabilities.formats.IMAGE={},engineInterface.capabilities.formats.IMAGE.plot=!1,engineInterface.capabilities.formats.IMAGE.edit=!1,engineInterface.capabilities.formats.MILSTD={},engineInterface.capabilities.formats.MILSTD.version2525B={},engineInterface.capabilities.formats.MILSTD.version2525B.plot=!1,engineInterface.capabilities.formats.MILSTD.version2525B.draw=!1,engineInterface.capabilities.formats.MILSTD.version2525B.edit=!1,engineInterface.capabilities.formats.MILSTD.version2525C={},engineInterface.capabilities.formats.MILSTD.version2525C.plot=!1,engineInterface.capabilities.formats.MILSTD.version2525C.draw=!1,engineInterface.capabilities.formats.MILSTD.version2525C.edit=!1,engineInterface.capabilities.formats.AIRSPACE={},engineInterface.capabilities.formats.AIRSPACE.plot=!1,engineInterface.capabilities.formats.AIRSPACE.draw=!1,engineInterface.capabilities.formats.AIRSPACE.edit=!1,engineInterface.capabilities.formats.AOI={},engineInterface.capabilities.formats.AOI.plot=!1,engineInterface.capabilities.formats.AOI.draw=!1,engineInterface.capabilities.formats.AOI.edit=!1,engineInterface.capabilities.formats.ArcGIS=!1,engineInterface.capabilities.overlayClustering=!1,engineInterface.capabilities.settings={},engineInterface.capabilities.settings.milstd={},engineInterface.capabilities.settings.milstd.iconSize=!1,engineInterface.capabilities.settings.milstd.labelOption=!1,engineInterface.capabilities.settings.iconSize=!1,engineInterface.requirements={},engineInterface.requirements.wmsCapabilities=!1,engineInterface.initialize={},engineInterface.initialize.succeed=function(args){new emp.map.eventing.Error({coreId:ENGINE_INTERFACE_CN,level:2,message:"Error: The fail method has not been overridden and is not supported by this map engine instance"})},engineInterface.initialize.fail=function(args){new emp.map.eventing.Error({coreId:ENGINE_INTERFACE_CN,level:2,message:"Error: The fail method has not been overridden and is not supported by this map engine instance"})},engineInterface.map={},engineInterface.map.config=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.cursor={},engineInterface.cursor.mode={},engineInterface.cursor.mode.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.cursor.mode.get=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.capture={},engineInterface.capture.screenshot=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.status={},engineInterface.status.get=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.state={},engineInterface.state.reset=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.state.destroy=function(){new emp.map.eventing.Error({coreId:ENGINE_INTERFACE_CN,level:2,message:"Error: The state.destroy method has not been overridden and is not supported by this map engine instance.  This may lead to issues during map swapping."})},engineInterface.visibility={},engineInterface.visibility.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.overlay={},engineInterface.overlay.add=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.overlay.remove=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.overlay.update=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.overlay.clear=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.overlay.cluster={},engineInterface.overlay.cluster.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"The engineInterface.overlay.cluster.set function is not supported by the map implementation."}])},engineInterface.overlay.cluster.deactivate=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"The engineInterface.overlay.cluster.deactivate function is not supported by the map implementation."}])},engineInterface.overlay.cluster.activate=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"The engineInterface.overlay.cluster.activate function is not supported by the map implementation."}])},engineInterface.overlay.cluster.remove=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"The engineInterface.overlay.cluster.remove function is not supported by the map implementation."}])},engineInterface.overlay.visibility={},engineInterface.overlay.visibility.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.overlay.style=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.navigation={},engineInterface.navigation.enable=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.view={},engineInterface.view.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.view.getXYFromLatLon=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.view.getLatLonFromXY=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.view.get=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.lookAt={},engineInterface.lookAt.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.feature={},engineInterface.feature.add=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.feature.remove=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.feature.update=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.feature.visibility={},engineInterface.feature.visibility.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.settings={},engineInterface.settings.mil2525={},engineInterface.settings.mil2525.icon={},engineInterface.settings.mil2525.icon.size={},engineInterface.settings.mil2525.icon.size.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.settings.mil2525.icon.labels={},engineInterface.settings.mil2525.icon.labels.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.wms={},engineInterface.wms.add=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.wms.remove=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.wmts={},engineInterface.wmts.add=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.wmts.remove=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.kmllayer={},engineInterface.kmllayer.add=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.kmllayer.remove=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.wms.visibility={},engineInterface.wms.visibility.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.draw={},engineInterface.draw.begin=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.draw.end=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.draw.cancel=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.edit={},engineInterface.edit.begin=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.edit.end=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.edit.cancel=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.selection={},engineInterface.selection.set=function(transaction){for(;transaction.items.length>0;)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface.projection={},engineInterface.projection.enable={},engineInterface.projection.enable.flat=function(transaction){var iIndex;for(iIndex=0;iIndex<transaction.items.length;iIndex++)transaction.fail([{coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"This function is not supported by the map implementation."}])},engineInterface},emp.environment=function(){function dispatchReady(){isReady=!0;var i,len;for(len=readyCallbacks.length,i=0;i<len;i++)try{readyCallbacks[i]()}catch(Error){emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"Environment ready callback function generated and exception. ",jsError:Error})}readyCallbacks=[]}function checkReady(){readyCount++,readyCount>=environmentList.length&&dispatchReady()}function checkShutdown(){readyCount--,readyCount<=0&&dispatchShutdown()}function dispatchShutdown(){var i,len=shutdownCallbacks.length;for(i=0;i<len;i++)try{shutdownCallbacks[i]()}catch(Error){emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,meesage:"Environment shutdown callback function generated and exception. ",jsError:Error})}shutdownCallbacks=[]}function subscribeAll(args){var i,len=environmentList.length;for(i=0;i<len;i++)environmentList[i].pubSub.subscribe(args)}function publishAll(args){var i,len=environmentList.length;for(i=0;i<len;i++)args.channel===cmapi.channel.names.MAP_VIEW_MOUSEMOVE&&environmentList[i]!==emp.environment.browser||environmentList[i].pubSub.publish(args)}var environmentList=[],isReady=!1,readyCallbacks=[],shutdownCallbacks=[],proxyEnvironment=null,readyCount=0,publicInterface={set:function(args){var i,env;for(environmentList=args.environments,i=0;i<environmentList.length;i++)env=environmentList[i],"string"!=typeof env&&env.hasOwnProperty&&env.hasOwnProperty("init")&&environmentList[i].init({initcallback:checkReady,shutdowncallback:checkShutdown,mapInstanceId:args.mapInstanceId,messageId:args.messageId,iwcHost:args.iwcHost})},get:function(){return null===proxyEnvironment&&(proxyEnvironment=emp.createEnvironmentTemplate(),proxyEnvironment.pubSub.publish=publishAll,proxyEnvironment.pubSub.subscribe=subscribeAll),proxyEnvironment},setCallbacks:function(readyCB,shutdownCB){if(readyCB&&"function"!=typeof readyCB)throw emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"Ready callback parameter is not a function."});if(shutdownCB&&"function"!=typeof shutdownCB)throw emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"Shutdown callback parameter is not a function."});isReady===!0?readyCB():readyCallbacks.push(readyCB),shutdownCB&&shutdownCallbacks.push(shutdownCB)}};return publicInterface}(),emp.createEnvironmentTemplate=function(){var environmentInterface={init:function(args){return emp.typeLibrary.Error({message:"The init method has not been implemented by this environment"}),!1},destroy:function(){return emp.typeLibrary.Error({message:"The destroy method has not been implemented by this environment"}),!1},pubSub:{publish:function(args){return emp.typeLibrary.Error({message:"pubSub.publish has not been implemented by this environment"}),!1},subscribe:function(args){return emp.typeLibrary.Error({message:"pubSub.subscribe has not been implemented by this environment"}),!1},unsubscribe:function(args){return emp.typeLibrary.Error({message:"pubSub.unsubscribe has not been implemented by this environment"}),!1}},prefs:{get:function(args){return emp.typeLibrary.Error({message:"prefs.get has not been implemented by this environment"}),null},set:function(args){return emp.typeLibrary.Error({message:"prefs.set has not been implemented by this environment"}),!1}},getInstanceId:function(){emp.typeLibrary.Error({message:"getInstanceId has not been implemented by this environment"})},name:"Unnamed Environment",version:"1.0.0",properties:{},sender:{id:"not-set"},launchTool:function(args){emp.typeLibrary.Error({message:"launchTool has not been implemented by this environment"}),"function"==typeof args.onError&&args.onError({message:"launchTool is not implemented by this environment."})},getToolInfo:function(args){emp.typeLibrary.Error({message:"getToolInfo has not been implemented by this environment"}),"function"==typeof args.onError&&args.onError({message:"getToolInfo is not implemented by this environment."})}};return environmentInterface},emp.contextMenuStorageManager=function(){var oContextMenuStorage={globalMenus:{},mapInstanceMenus:void 0},getMapMenuStorage=function(){return oContextMenuStorage.mapInstanceMenus},getMenuListfn=function(mapInstanceId,eType){var mapMenuStorage,oMenuCollection=void 0;switch(eType){case emp.typeLibrary.Menu.Type.MAP_GLOBAL:mapMenuStorage=getMapMenuStorage(mapInstanceId),mapMenuStorage&&(oMenuCollection=mapMenuStorage.mapMenus);break;case emp.typeLibrary.Menu.Type.OVERLAY_GLOBAL:mapMenuStorage=getMapMenuStorage(mapInstanceId),mapMenuStorage&&(oMenuCollection=mapMenuStorage.mapOverlayMenus);break;case emp.typeLibrary.Menu.Type.FEATURE_GLOBAL:mapMenuStorage=getMapMenuStorage(mapInstanceId),mapMenuStorage&&(oMenuCollection=mapMenuStorage.mapFeatureMenus);break;case emp.typeLibrary.Menu.Type.OBJECT_INSTANCE:case emp.typeLibrary.Menu.Type.SUBMENU:oMenuCollection=oContextMenuStorage.globalMenus}return oMenuCollection},publicInterface={newMapInstance:function(){return void 0===oContextMenuStorage.mapInstanceMenus&&(oContextMenuStorage.mapInstanceMenus={mapMenus:{},mapFeatureMenus:{},mapOverlayMenus:{}}),oContextMenuStorage.mapInstanceMenus},removeMapInstance:function(){},add:function(oTransaction){var iItemIndex,oItem,oItems=oTransaction.items,oMenuCollection={},mapInstanceId=oTransaction.mapInstanceId;if(oTransaction.items&&"map.menu.create"===oTransaction.originChannel)for(iItemIndex=0;iItemIndex<oItems.length;)oItem=oItems[iItemIndex],oMenuCollection=getMenuListfn(mapInstanceId,oItem.menuType),oMenuCollection?oMenuCollection[oItem.menuId]?oTransaction.fail([{coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"A menu with the same ID already exists."}]):(oMenuCollection[oItem.menuId]=new emp.ui.menu.context.model.menu(oItem),iItemIndex++):oTransaction.fail([{coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid menu type."}])},remove:function(oTransaction){var oItem,iIndex,sMenuId,oMapInstanceMenus,oItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId;if(oTransaction.items&&"map.menu.remove"===oTransaction.originChannel)for(iIndex=0;iIndex<oItems.length;)oItem=oItems[iIndex],sMenuId=oItem.menuId,oContextMenuStorage.globalMenus.hasOwnProperty(sMenuId)?(delete oContextMenuStorage.globalMenus[sMenuId],iIndex++):(oMapInstanceMenus=getMapMenuStorage(mapInstanceId),oMapInstanceMenus?oMapInstanceMenus.mapMenus.hasOwnProperty(sMenuId)?(delete oMapInstanceMenus.mapMenus[sMenuId],
iIndex++):oMapInstanceMenus.mapOverlayMenus.hasOwnProperty(sMenuId)?(delete oMapInstanceMenus.mapOverlayMenus[sMenuId],iIndex++):oMapInstanceMenus.mapFeatureMenus.hasOwnProperty(sMenuId)?(delete oMapInstanceMenus.mapFeatureMenus[sMenuId],iIndex++):oTransaction.fail([{coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Menu not found in map instance."}]):oTransaction.fail([{coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Map instance not found, menu not deleted."}]))},active:function(oTransaction){var iIndex,iMenuItemIndex,oItem,sMenuItemId,aMenuItems,oMapInstanceMenus,bVisibility=!1,oItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,findMenuItem=function(oMenuCollection,sMenuItemId){var iIndex,aMenuIdList,oMenu;if(!emp.helpers.associativeArray.isEmpty(oMenuCollection))for(aMenuIdList=emp.helpers.associativeArray.getKeys(oMenuCollection),iIndex=0;iIndex<aMenuIdList.length;iIndex++)oMenu=oMenuCollection[aMenuIdList[iIndex]],oMenu.items.hasOwnProperty(sMenuItemId)&&aMenuItems.push(oMenu.items[sMenuItemId])};for(oMapInstanceMenus=getMapMenuStorage(mapInstanceId),iIndex=0;iIndex<oItems.length;)if(aMenuItems=[],oItem=oItems[iIndex],sMenuItemId=oItem.menuItemId,bVisibility=oItem.visible,findMenuItem(oContextMenuStorage.globalMenus,sMenuItemId),findMenuItem(oMapInstanceMenus.mapMenus,sMenuItemId),findMenuItem(oMapInstanceMenus.mapOverlayMenus,sMenuItemId),findMenuItem(oMapInstanceMenus.mapFeatureMenus,sMenuItemId),0===aMenuItems.length)oTransaction.fail([{coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Menu item not found."}]);else{for(iMenuItemIndex=0;iMenuItemIndex<aMenuItems.length;iMenuItemIndex++)aMenuItems[iMenuItemIndex].visible=bVisibility;iIndex++}},getFeatureMenuIdList:function(mapInstanceId,oFeature){var rObject={feature:[],overlay:[],parent:[]};return emp.helpers.isEmptyString(oFeature.getMenuId())||rObject.feature.push(oFeature.getMenuId()),rObject},getMenuList:function(mapInstanceId,eType){return getMenuListfn(mapInstanceId,eType)}};return publicInterface}(),emp.storage=function(){var instances,removeMapInstanceFromStorage=function(oInstanceData){var oRootStorageEntry=emp.storage._storage.store[oInstanceData.rootGUID];oRootStorageEntry&&(emp.storage.removeParentFromChildren(oRootStorageEntry),emp.storage.deleteObject(oRootStorageEntry))},publicInterface={init:function(){instances={}},_storage:{store:{},get:function(args){if(args.coreId)return this.store[args.coreId]},set:function(empObject){empObject.getCoreId()&&(this.store[empObject.getCoreId()]=empObject)}},getRootGuid:function(instanceId){if(instances.hasOwnProperty(instanceId))return instances[instanceId].rootGUID},isRoot:function(coreId){for(var instance in instances)if(instances.hasOwnProperty(instance)&&instances[instance].rootGUID===coreId)return instance;return!1},newMapInstance:function(args){var oRootOverlay=new emp.typeLibrary.Overlay({name:"Root Overlay for Map "+args.mapInstanceId,overlayId:args.mapInstanceId});if(oRootOverlay=new emp.classLibrary.EmpOverlay(oRootOverlay),oRootOverlay.setVisibleOnMap(args.mapInstanceId,!0),instances.hasOwnProperty(args.mapInstanceId))return void new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"Storage map instance exists. ("+args.mapInstanceId+")"});var oInstanceData={mapInstanceId:args.mapInstanceId,rootGUID:oRootOverlay.getCoreId()};instances[args.mapInstanceId]=oInstanceData,emp.storage._storage.store[oRootOverlay.getCoreId()]=oRootOverlay,emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_UPDATE,mapInstanceId:args.mapInstanceId,callback:emp.storage.feature.editUpdate}),emp.transactionQueue.listener.add({type:emp.intents.control.OVERLAY_CLUSTER_SET,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterSet}),emp.transactionQueue.listener.add({type:emp.intents.control.OVERLAY_CLUSTER_ACTIVATE,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterActivate}),emp.transactionQueue.listener.add({type:emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterDeactivate}),emp.transactionQueue.listener.add({type:emp.intents.control.OVERLAY_CLUSTER_REMOVE,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterRemove})},removeMapInstance:function(args){var oInstanceData;instances.hasOwnProperty(args.mapInstanceId)&&(oInstanceData=instances[args.mapInstanceId],removeMapInstanceFromStorage(oInstanceData),emp.transactionQueue.listener.remove({type:emp.intents.control.EDIT_UPDATE,mapInstanceId:args.mapInstanceId,callback:emp.storage.feature.editUpdate}),emp.transactionQueue.listener.remove({type:emp.intents.control.OVERLAY_CLUSTER_SET,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterSet}),emp.transactionQueue.listener.remove({type:emp.intents.control.OVERLAY_CLUSTER_ACTIVATE,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterActivate}),emp.transactionQueue.listener.remove({type:emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterDeactivate}),emp.transactionQueue.listener.remove({type:emp.intents.control.OVERLAY_CLUSTER_REMOVE,mapInstanceId:args.mapInstanceId,callback:emp.storage.overlay.clusterRemove}),emp.contextMenuStorageManager.removeMapInstance(args.mapInstanceId),delete instances[args.mapInstanceId],emp.storage.selection.removeSelectedList(args.mapInstanceId))},readOnlyPermission:function(mapInstanceId,oStorageItem){var mapRootGUID=this.getRootGuid(mapInstanceId),recurseUp=function(oStorageItem,bContinueRecursion){var oParent,sCoreId,oParentList=oStorageItem.getParentRelationshipList();if(oStorageItem.getCoreId()!==mapRootGUID)for(sCoreId in oParentList)if(oParentList.hasOwnProperty(sCoreId)){if(oParent=oParentList[sCoreId].getParent(),!oParent.isReadOnly())return!1;if(oParent.hasParents()&&bContinueRecursion)return recurseUp(oParent,!1)}return!1};switch(oStorageItem.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:if(oStorageItem.hasParents())return recurseUp(oStorageItem,!1);break;case emp.typeLibrary.types.FEATURE:if(oStorageItem.hasParents())return recurseUp(oStorageItem,!1)}return!1}};return publicInterface}(),emp.storage.getPrimaryCount=function(){var c=0;for(var k in emp.storage._storage.store)emp.storage._storage.store.hasOwnProperty(k)&&++c;return c-1},emp.storage.removeFromParent=function(sCoreId){var oItem=emp.storage._storage.store[sCoreId];void 0!==oItem&&oItem.removeFromAllParent()},emp.storage.addToParent=function(sCoreId){var oParentNode,oItem=emp.storage._storage.store[sCoreId];void 0!==oItem&&(oParentNode=emp.storage._storage.store[oItem.coreParent],void 0!==oParentNode&&oParentNode.addChild(oItem,oItem.visibilitySetting))},emp.storage.removeChild=function(coreId){var item=emp.storage._storage.store[coreId];if(void 0!==item){if(item.hasChildren())for(var coreIdList=item.getChildrenCoreIds(),numChildren=coreIdList.length,i=0;i<numChildren;i++)emp.storage.removeChild(coreIdList[i]);item.removeFromAllParent(),delete emp.storage._storage.store[coreId]}},emp.storage.feature={},emp.storage.feature.add=function(transaction){var empFeature,parent,item,parentCount,i,j,mapList,prevMapList,items=transaction.items,transactions={};for(i=0;i<items.length;i++){if(item=items[i],prevMapList=[],empFeature=emp.storage.findFeature(item.overlayId,item.featureId)){if(prevMapList=empFeature.getParentMapInstanceList(),!emp.storage.feature.updateItem(transactions,transaction,empFeature,item))continue}else empFeature=new emp.classLibrary.EmpFeature(item),emp.storage.storeObject(empFeature);if(emp.helpers.isEmptyString(item.coreParent))for(parentCount=empFeature.parentCount(),mapList=empFeature.getParentMapInstanceList(),j=0;j<parentCount;j++)parent=empFeature.getParentByIndex(j),emp.storage.processRequest(transactions,prevMapList,mapList,parent,empFeature,item.zoom);else{if(parent=emp.storage.get.id({id:item.coreParent}),void 0===parent){transaction.fail({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to create parent overlay of "+item.name+"."});continue}parent.isParentOf(empFeature.getCoreId())||parent.addChild(empFeature,item.visible),mapList=empFeature.getParentMapInstanceList(),emp.storage.processRequest(transactions,prevMapList,mapList,parent,empFeature,item.zoom)}}emp.storage.executeTransactions(transactions)},emp.storage.feature._setChildrenOverlay=function(oFeature,sOverlayId){for(var oChildItem,store=emp.storage._storage.store,oListCopy=oFeature.getChildrenCoreIds(),iIndex=0;iIndex<oListCopy.length;iIndex++)oChildItem=store[oListCopy[iIndex]],oChildItem&&(emp.storage.feature._setChildrenOverlay(oChildItem,sOverlayId),oChildItem.overlayId=sOverlayId)},emp.storage.feature.updateItem=function(oTransactions,oTransaction,oStorageEntry,oNewItem){var oParent,aParentMapList,iMapIndex,oNewParent,sBasicSC1,sBasicSC2;if(oNewItem.hasOwnProperty("format")&&oNewItem.format!==oStorageEntry.getFormat())return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature "+oStorageEntry.getName()+" can not be updated from a "+oStorageEntry.getFormat()+" to a "+oNewItem.format+"."}),!1;if(oStorageEntry.isInEditMode()&&oNewItem.hasOwnProperty("data")&&oStorageEntry.getFormat()===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(sBasicSC1=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(oStorageEntry.getSymbolCode()),sBasicSC2=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(oNewItem.data.symbolCode),sBasicSC1!==sBasicSC2))return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature "+oStorageEntry.getName()+" can not be updated from one symbol type to another while being edited."}),!1;if(emp.helpers.isEmptyString(oNewItem.parentId)){if(!emp.helpers.isEmptyString(oNewItem.overlayId))switch(oNewItem.overlayId){case emp.constant.parentIds.ALL_PARENTS:break;case emp.constant.parentIds.MAP_ROOT:break;default:if(oParent=emp.storage.findOverlay(oNewItem.overlayId),void 0===oParent){if(oNewItem.hasOwnProperty("destOverlayId")||oNewItem.hasOwnProperty("destParentId"))return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find parent overlay of feature "+oStorageEntry.getName()+". Feature move failed."}),!1;if(emp.storage.overlay.createOverlay(oTransaction.mapInstanceId,oNewItem.overlayId,oTransaction.sender),oParent=emp.storage.findOverlay(oNewItem.overlayId),!oParent)return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to create new parent overlay of feature "+oStorageEntry.getName()+"."}),!1}}}else switch(oNewItem.parentId){case emp.constant.parentIds.ALL_PARENTS:case emp.constant.parentIds.MAP_ROOT:break;default:if(oParent=emp.storage.findFeature(oNewItem.overlayId,oNewItem.parentId),void 0===oParent)return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find parent feature of feature "+oStorageEntry.getName()+"."}),!1}if(oNewItem.destOverlayId||oNewItem.destParentId){if(!oParent)return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid parent of feature "+oStorageEntry.getName()+"."}),!1;if(emp.helpers.isEmptyString(oNewItem.destParentId)){if(!emp.helpers.isEmptyString(oNewItem.destOverlayId)&&(oNewParent=emp.storage.findOverlay(oNewItem.destOverlayId),void 0===oNewParent))return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find new parent overlay of feature "+oStorageEntry.getName()+"."}),!1}else if(oNewParent=emp.storage.findFeature(oNewItem.destOverlayId,oNewItem.destParentId),void 0===oNewParent)return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find new parent feature of feature "+oStorageEntry.getName()+"."}),!1;for(oParent.removeChild(oStorageEntry),aParentMapList=oParent.getParentMapInstanceList(),iMapIndex=0;iMapIndex<aParentMapList.length;iMapIndex++)emp.storage.addToObjectRemoveTransaction(oTransactions,aParentMapList[iMapIndex],oParent,oStorageEntry);oParent=oNewParent}return oParent&&!oParent.isParentOf(oStorageEntry.getCoreId())&&oParent.addChild(oStorageEntry,!0),oStorageEntry.updateFeature(oNewItem),!0},emp.storage.feature.update=function(oTransaction){var oEmpFeature,oItem,iIndex,aMapList,aPrevMapList,oParent,oTransactions={};for(iIndex=0;iIndex<oTransaction.items.length;)aMapList=[],aPrevMapList=[],oItem=oTransaction.items[iIndex],oEmpFeature=emp.storage.findFeature(oItem.overlayId,oItem.featureId),void 0!==oEmpFeature?(aPrevMapList=oEmpFeature.getParentMapInstanceList(),emp.storage.feature.updateItem(oTransactions,oTransaction,oEmpFeature,oItem)&&(aMapList=oEmpFeature.getParentMapInstanceList(),oParent=emp.storage.findObject(oItem.coreParent),void 0!==oParent?(emp.storage.processRequest(oTransactions,aPrevMapList,aMapList,oParent,oEmpFeature),iIndex++):oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent not found. Update canceled."}))):oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature no found. Update canceled."});emp.storage.executeTransactions(oTransactions)},emp.storage.executeTransactions=function(oTransactions){var mapInstanceId;if(oTransactions.hasOwnProperty("oFeatureRemoveFromMapTransactions"))for(mapInstanceId in oTransactions.oFeatureRemoveFromMapTransactions)oTransactions.oFeatureRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oFeatureRemoveFromMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oWMSRemoveFromMapTransactions"))for(mapInstanceId in oTransactions.oWMSRemoveFromMapTransactions)oTransactions.oWMSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oWMSRemoveFromMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oWMTSRemoveFromMapTransactions"))for(mapInstanceId in oTransactions.oWMTSRemoveFromMapTransactions)oTransactions.oWMTSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oWMTSRemoveFromMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oKmlLayerRemoveFromMapTransactions"))for(mapInstanceId in oTransactions.oKmlLayerRemoveFromMapTransactions)oTransactions.oKmlLayerRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oKmlLayerRemoveFromMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oObjectRemoveTransaction"))for(mapInstanceId in oTransactions.oObjectRemoveTransaction)oTransactions.oObjectRemoveTransaction.hasOwnProperty(mapInstanceId)&&oTransactions.oObjectRemoveTransaction[mapInstanceId].run();if(oTransactions.hasOwnProperty("oObjectAddTransaction"))for(mapInstanceId in oTransactions.oObjectAddTransaction)oTransactions.oObjectAddTransaction.hasOwnProperty(mapInstanceId)&&oTransactions.oObjectAddTransaction[mapInstanceId].run();if(oTransactions.hasOwnProperty("oFeatureAddToMapTransactions"))for(mapInstanceId in oTransactions.oFeatureAddToMapTransactions)oTransactions.oFeatureAddToMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oFeatureAddToMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oWMSAddToMapTransactions"))for(mapInstanceId in oTransactions.oWMSAddToMapTransactions)oTransactions.oWMSAddToMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oWMSAddToMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oWMTSAddToMapTransactions"))for(mapInstanceId in oTransactions.oWMTSAddToMapTransactions)oTransactions.oWMTSAddToMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oWMTSAddToMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oKmlLayerAddToMapTransactions"))for(mapInstanceId in oTransactions.oKmlLayerAddToMapTransactions)oTransactions.oKmlLayerAddToMapTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.oKmlLayerAddToMapTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("featureUpdateTransactions"))for(mapInstanceId in oTransactions.featureUpdateTransactions)oTransactions.featureUpdateTransactions.hasOwnProperty(mapInstanceId)&&oTransactions.featureUpdateTransactions[mapInstanceId].run();if(oTransactions.hasOwnProperty("oObjectUpdatedTransaction"))for(mapInstanceId in oTransactions.oObjectUpdatedTransaction)oTransactions.oObjectUpdatedTransaction.hasOwnProperty(mapInstanceId)&&oTransactions.oObjectUpdatedTransaction[mapInstanceId].run()},emp.storage.feature.remove=function(transaction){var storageEntry,mapList,previousMapList,i,item,parent,items=transaction.items,transactions={};for(i=0;i<items.length;i++)if(item=items[i],storageEntry=emp.storage.get.id({id:item.coreId}),void 0!==storageEntry){if(emp.helpers.isEmptyString(item.parentId)){if(parent=emp.storage.findOverlay(item.overlayId),void 0===parent){transaction.fail({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find parent overlay of feature "+storageEntry.getName()+"."});continue}}else if(parent=emp.storage.findFeature(item.overlayId,item.parentId),void 0===parent){transaction.fail({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find parent feature of feature "+storageEntry.getName()+"."});continue}parent.isParentOf(storageEntry.getCoreId())?(previousMapList=storageEntry.getParentMapInstanceList(),1===storageEntry.parentCount()&&emp.storage.removeParentFromChildren(storageEntry),parent.removeChild(storageEntry),mapList=storageEntry.getParentMapInstanceList(),emp.storage.processRequest(transactions,previousMapList,mapList,parent,storageEntry),emp.storage.deleteObject(storageEntry)):transaction.fail({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:parent.getName()+" is not a parent of feature "+storageEntry.getName()+"."})}else transaction.fail({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature remove: feature "+item.coreId+" not found."});emp.storage.executeTransactions(transactions)},emp.storage.feature.editUpdate=function(oTransaction){var oStorageItem,oEditItem=oTransaction.items[0],store=emp.storage._storage.store;(oEditItem.complete||oEditItem.updateEventType===emp.typeLibrary.UpdateEventType.COMPLETE)&&(oStorageItem=store[oEditItem.coreId],oStorageItem?oStorageItem.updateFeature(oEditItem):new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MAJOR,message:"Edited features not found in storage."}))},emp.storage.removeItems=function(transaction){var item,i,store=emp.storage._storage.store,items=transaction.items;for(i=0;i<items.length;i+=1)if(item=store[items[i].coreId],void 0!==item){if(item.hasChildren()){var coreIdList=item.getChildrenCoreIds();for(i=0;i<coreIdList.length;i++)emp.storage.removeChild(coreIdList[i])}item.removeFromAllParent(),delete store[item.coreId]}},emp.storage.overlay={},emp.storage.overlay.createOverlay=function(mapInstanceId,overlayId,sender){var oTempTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_ADD,mapInstanceId:mapInstanceId,originChannel:"map.overlay.create",items:[new emp.typeLibrary.Overlay({name:"Overlay "+sender,overlayId:overlayId})]});oTempTransaction.run()},emp.storage.overlay.add=function(oTransaction){var bVisibleSetting,oEmpOverlay,oParentOverlay,oItem,iIndex,aMapList,aPrevMapList,oaItems=oTransaction.items,oTransactions={};for(iIndex=0;iIndex<oaItems.length;){if(oItem=oaItems[iIndex],bVisibleSetting=oItem.visible,aPrevMapList=[],oEmpOverlay=emp.storage.findOverlay(oItem.overlayId),oParentOverlay=emp.storage.findObject(oItem.coreParent),void 0!==oEmpOverlay){if(aPrevMapList=oEmpOverlay.getParentMapInstanceList(),!emp.storage.overlay.updateItem(oTransactions,oTransaction,oEmpOverlay,oItem,!1))continue}else oEmpOverlay=new emp.classLibrary.EmpOverlay(oItem),emp.storage.storeObject(oEmpOverlay);oParentOverlay.isParentOf(oEmpOverlay.getCoreId())||oParentOverlay.addChild(oEmpOverlay,bVisibleSetting),aMapList=oEmpOverlay.getParentMapInstanceList(),emp.storage.processRequest(oTransactions,aPrevMapList,aMapList,oParentOverlay,oEmpOverlay),iIndex++}emp.storage.executeTransactions(oTransactions)},emp.storage.overlay.clear=function(oTransaction){for(var oOverlay,oChild,iIndex,iMapIndex,aMapList,aPrevMapList,oTransactionList={oObjectUpdatedTransaction:{},oObjectRemoveTransaction:{},oFeatureRemoveFromMapTransactions:{},oWMSRemoveFromMapTransactions:{}},i=0;i<oTransaction.items.length;i+=1)if(oOverlay=emp.storage.findOverlay(oTransaction.items[i].overlayId),void 0!==oOverlay){var aChildrenCoreIdList=oOverlay.getChildrenCoreIds();for(iIndex=0;iIndex<aChildrenCoreIdList.length;iIndex++)if(oChild=emp.storage.findObject(aChildrenCoreIdList[iIndex])){for(aPrevMapList=oChild.getParentMapInstanceList(),oOverlay.removeChild(oChild),aMapList=oChild.getParentMapInstanceList(),iMapIndex=0;iMapIndex<aPrevMapList.length;iMapIndex++)aMapList.indexOf(aPrevMapList[iMapIndex])===-1&&(emp.storage.processChildrenRemoves(oTransactionList,aPrevMapList[iMapIndex],oChild),emp.storage.addToRemoveTransaction(oTransactionList,aPrevMapList[iMapIndex],oOverlay,oChild));0===oChild.parentCount()&&emp.storage.deleteObject(oChild)}}emp.storage.executeTransactions(oTransactionList)},emp.storage.overlay.updateItem=function(oTransactions,oTransaction,oStorageEntry,oNewItem,bFromUpdate){var oParent,oOldParent,aMapList,iMapIndex,oParentValid,sPropertyField,mapInstanceId=oTransaction.mapInstanceId;if(!emp.helpers.isEmptyString(oNewItem.parentId)){switch(oNewItem.parentId){case emp.constant.parentIds.ALL_PARENTS:return oTransaction.fail({coreId:oStorageEntry.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid parent Id for overlay "+oStorageEntry.getName()+"."}),!1;case emp.constant.parentIds.MAP_ROOT:oParent=emp.storage.findOverlay(emp.storage.getRootGuid(mapInstanceId));break;default:oParent=emp.storage.findOverlay(oNewItem.parentId)}if(!oParent)return oTransaction.fail({coreId:oStorageEntry.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"New parent overlay for overlay "+oStorageEntry.getName()+" was not found."}),!1;if(bFromUpdate){if(oStorageEntry.parentCount()>1)return oTransaction.fail({coreId:oStorageEntry.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay "+oStorageEntry.getName()+" has more than 1 parent. Move of a multi-parent overlay is not supported."}),!1;if(oOldParent=oStorageEntry.getParentByIndex(0),!oOldParent)return oTransaction.fail({coreId:oStorageEntry.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find current parent of overlay "+oStorageEntry.getName()+"."}),!1;if(oParentValid=emp.storage.overlay.validateParent(oStorageEntry.getCoreId(),oParent.getCoreId()),oParentValid!==!0)return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:oParentValid.errorMsg}),!1;if(oOldParent.getOverlayId()!==oNewItem.parentId)for(oOldParent.removeChild(oStorageEntry),aMapList=oOldParent.getMapInstanceList(),iMapIndex=0;iMapIndex<aMapList.length;iMapIndex++)emp.storage.addToObjectUpdateTransaction(oTransactions,aMapList[iMapIndex],oOldParent.getCoreId(),oStorageEntry.getCoreId())}if(!oParent.isParentOf(oStorageEntry.getCoreId())){if(!bFromUpdate&&(oParentValid=emp.storage.overlay.validateParent(oStorageEntry.getCoreId(),oParent.getCoreId()),oParentValid!==!0))return oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:oParentValid.errorMsg}),!1;oParent.addChild(oStorageEntry,oNewItem.visible!==!1)}}if(emp.helpers.isEmptyString(oNewItem.name)||oStorageEntry.getName()===oNewItem.name||oStorageEntry.setName(oNewItem.name),oNewItem.hasOwnProperty("disabled")&&oStorageEntry.setDisabled(oNewItem.disabled),oNewItem.hasOwnProperty("properties")&&"object"==typeof oNewItem.properties)for(sPropertyField in oNewItem.properties)oNewItem.properties.hasOwnProperty(sPropertyField)&&oStorageEntry.setPropertyValue(sPropertyField,oNewItem.properties[sPropertyField]);return emp.helpers.isEmptyString(oNewItem.menuId)||oStorageEntry.setMenuId(oNewItem.menuId),!0},emp.storage.addToObjectAddTransaction=function(oTransactionList,mapInstanceId,oParent,oStorageEntry){var oDupItem;oTransactionList.hasOwnProperty("oObjectAddTransaction")||(oTransactionList.oObjectAddTransaction={}),oTransactionList.oObjectAddTransaction.hasOwnProperty(mapInstanceId)||(oTransactionList.oObjectAddTransaction[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.STORAGE_OBJECT_ADDED,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oStorageEntry.getObjectData(mapInstanceId,oParent.getCoreId()),oTransactionList.oObjectAddTransaction[mapInstanceId].items.push(oDupItem)},emp.storage.addToObjectRemoveTransaction=function(oTransactionList,mapInstanceId,oParent,oStorageEntry){var oDupItem;oTransactionList.hasOwnProperty("oObjectRemoveTransaction")||(oTransactionList.oObjectRemoveTransaction={}),oTransactionList.oObjectRemoveTransaction.hasOwnProperty(mapInstanceId)||(oTransactionList.oObjectRemoveTransaction[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.STORAGE_OBJECT_REMOVED,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oStorageEntry.getObjectData(mapInstanceId,oParent.getCoreId()),oTransactionList.oObjectRemoveTransaction[mapInstanceId].items.push(oDupItem)},emp.storage.addToObjectUpdateTransaction=function(oTransactionList,mapInstanceId,parentCoreId,childCoreId){oTransactionList.hasOwnProperty("oObjectUpdatedTransaction")||(oTransactionList.oObjectUpdatedTransaction={}),oTransactionList.oObjectUpdatedTransaction.hasOwnProperty(mapInstanceId)||(oTransactionList.oObjectUpdatedTransaction[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.STORAGE_OBJECT_CHILD_REMOVED,mapInstanceId:mapInstanceId,items:[]})),oTransactionList.oObjectUpdatedTransaction[mapInstanceId].items.push({parentCoreId:parentCoreId,childCoreId:childCoreId})},emp.storage.addToUpdateTransaction=function(transactionList,mapInstanceId,parent,child){var dupItem;switch(child.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:transactionList.hasOwnProperty("featureUpdateTransactions")||(transactionList.featureUpdateTransactions={}),transactionList.featureUpdateTransactions.hasOwnProperty(mapInstanceId)||(transactionList.featureUpdateTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_FEATURE_UPDATE,mapInstanceId:mapInstanceId,items:[]})),dupItem=child.getObjectData(mapInstanceId,parent.getCoreId()),dupItem.visible=child.isVisibleOnMap(mapInstanceId),transactionList.featureUpdateTransactions[mapInstanceId].items.push(dupItem)}},emp.storage.addToAddTransaction=function(oTransactionList,mapInstanceId,oParent,oChild,bZoom){var oDupItem,sErrorMsg;switch(oChild.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:oChild.canMapEnginePlot(mapInstanceId)?(oTransactionList.hasOwnProperty("oFeatureAddToMapTransactions")||(oTransactionList.oFeatureAddToMapTransactions={}),oTransactionList.oFeatureAddToMapTransactions.hasOwnProperty(mapInstanceId)||(oTransactionList.oFeatureAddToMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_FEATURE_ADD,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.zoom=bZoom===!0,oDupItem.visible=oChild.isVisibleOnMap(mapInstanceId),oTransactionList.oFeatureAddToMapTransactions[mapInstanceId].items.push(oDupItem)):(sErrorMsg=emp.instanceManager.getInstance(mapInstanceId).engineName,sErrorMsg+=" can't plot a "+oChild.getFormat()+" feature ("+oChild.getName()+").",new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.INFO,message:sErrorMsg}));break;case emp.typeLibrary.types.WMS:oChild.canMapEnginePlot(mapInstanceId)?(oTransactionList.hasOwnProperty("oWMSAddToMapTransactions")||(oTransactionList.oWMSAddToMapTransactions={}),oTransactionList.oWMSAddToMapTransactions.hasOwnProperty(mapInstanceId)||(oTransactionList.oWMSAddToMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_WMS_ADD,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId),oTransactionList.oWMSAddToMapTransactions[mapInstanceId].items.push(oDupItem)):(sErrorMsg=emp.instanceManager.getInstance(mapInstanceId).engineName,sErrorMsg+=" can't plot a WMS version "+oChild.getVersion()+" map ("+oChild.getName()+").",new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.INFO,message:sErrorMsg}));break;case emp.typeLibrary.types.KML:oChild.canMapEnginePlot(mapInstanceId)?(oTransactionList.hasOwnProperty("oKmlLayerAddToMapTransactions")||(oTransactionList.oKmlLayerAddToMapTransactions={}),oTransactionList.oKmlLayerAddToMapTransactions.hasOwnProperty(mapInstanceId)||(oTransactionList.oKmlLayerAddToMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_KML_LAYER_ADD,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId),oTransactionList.oKmlLayerAddToMapTransactions[mapInstanceId].items.push(oDupItem)):(sErrorMsg=emp.instanceManager.getInstance(mapInstanceId).engine.implementation.displayName,sErrorMsg+=" can't plot a KML "+oChild.getVersion()+" link on map ("+oChild.getName()+").",new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.INFO,message:sErrorMsg}));break;case emp.typeLibrary.types.WMTS:oChild.canMapEnginePlot(mapInstanceId)?(oTransactionList.hasOwnProperty("oWMTSAddToMapTransactions")||(oTransactionList.oWMTSAddToMapTransactions={}),oTransactionList.oWMTSAddToMapTransactions.hasOwnProperty(mapInstanceId)||(oTransactionList.oWMTSAddToMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_WMTS_ADD,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId),oTransactionList.oWMTSAddToMapTransactions[mapInstanceId].items.push(oDupItem)):(sErrorMsg=emp.instanceManager.getInstance(mapInstanceId).engine.implementation.displayName,sErrorMsg+=" can't plot a WMTS version "+oChild.getVersion()+" map ("+oChild.getName()+").",new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.INFO,message:sErrorMsg}));break;case emp.typeLibrary.types.OVERLAY:oTransactionList.hasOwnProperty("oObjectAddTransaction")||(oTransactionList.oObjectAddTransaction={}),oTransactionList.oObjectAddTransaction.hasOwnProperty(mapInstanceId)||(oTransactionList.oObjectAddTransaction[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.STORAGE_OBJECT_ADDED,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oTransactionList.oObjectAddTransaction[mapInstanceId].items.push(oDupItem)}},emp.storage.addToRemoveTransaction=function(transactionList,mapInstanceId,oParent,oChild){var oDupItem;switch(oChild.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:transactionList.hasOwnProperty("oFeatureRemoveFromMapTransactions")||(transactionList.oFeatureRemoveFromMapTransactions={}),transactionList.oFeatureRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)||(transactionList.oFeatureRemoveFromMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_FEATURE_REMOVE,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),transactionList.oFeatureRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);break;case emp.typeLibrary.types.WMS:transactionList.hasOwnProperty("oWMSRemoveFromMapTransactions")||(transactionList.oWMSRemoveFromMapTransactions={}),transactionList.oWMSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)||(transactionList.oWMSRemoveFromMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({
intent:emp.intents.control.MI_WMS_REMOVE,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId),transactionList.oWMSRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);break;case emp.typeLibrary.types.WMTS:transactionList.hasOwnProperty("oWMTSRemoveFromMapTransactions")||(transactionList.oWMTSRemoveFromMapTransactions={}),transactionList.oWMTSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)||(transactionList.oWMTSRemoveFromMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_WMTS_REMOVE,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId),transactionList.oWMTSRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);break;case emp.typeLibrary.types.KML:transactionList.hasOwnProperty("oKmlLayerRemoveFromMapTransactions")||(transactionList.oKmlLayerRemoveFromMapTransactions={}),transactionList.oKmlLayerRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)||(transactionList.oKmlLayerRemoveFromMapTransactions[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_MAP_LAYER_REMOVE,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),oDupItem.parentCoreId=emp.storage.getRootGuid(mapInstanceId),transactionList.oKmlLayerRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);break;case emp.typeLibrary.types.OVERLAY:transactionList.hasOwnProperty("oObjectRemoveTransaction")||(transactionList.oObjectRemoveTransaction={}),transactionList.oObjectRemoveTransaction.hasOwnProperty(mapInstanceId)||(transactionList.oObjectRemoveTransaction[mapInstanceId]=new emp.typeLibrary.Transaction({intent:emp.intents.control.STORAGE_OBJECT_REMOVED,mapInstanceId:mapInstanceId,items:[]})),oDupItem=oChild.getObjectData(mapInstanceId,oParent.getCoreId()),transactionList.oObjectRemoveTransaction[mapInstanceId].items.push(oDupItem)}},emp.storage.processChildrenRemoves=function(oTransactions,mapInstanceId,oStorageEntry){var iIndex,oChild,aChildrenCoreIdList=oStorageEntry.getChildrenCoreIds(),iChildrenCount=aChildrenCoreIdList.length;for(iIndex=0;iIndex<iChildrenCount;iIndex++)oChild=emp.storage.findObject(aChildrenCoreIdList[iIndex]),0===oChild.parentCount()&&oStorageEntry.removeChild(oChild.getCoreId()),oChild.isOnMap(mapInstanceId)||(oChild.hasChildren()&&emp.storage.processChildrenRemoves(oTransactions,mapInstanceId,oChild),emp.storage.addToRemoveTransaction(oTransactions,mapInstanceId,oStorageEntry,oChild))},emp.storage.processChildrenAdds=function(oTransactions,mapInstanceId,oStorageEntry){var sCoreId,oChild,oChildFeatures;oChildFeatures=oStorageEntry.getChildrenList();for(sCoreId in oChildFeatures)oChildFeatures.hasOwnProperty(sCoreId)&&(oChild=oChildFeatures[sCoreId],oChild.isOnMap(mapInstanceId)&&(emp.storage.addToAddTransaction(oTransactions,mapInstanceId,oStorageEntry,oChild),oChild.hasChildren()&&emp.storage.processChildrenAdds(oTransactions,mapInstanceId,oChild)))},emp.storage.processRequest=function(transactions,prevMapList,mapList,parent,storageEntry,zoom){var i,iTempIndex,parentMapList,removeFromMapList=[],addToMapList=[];for(i=0;i<prevMapList.length;i++)iTempIndex=mapList.indexOf(prevMapList[i]),iTempIndex===-1&&removeFromMapList.push(prevMapList[i]);if(removeFromMapList.length>0){for(i=0;i<removeFromMapList.length;i++)emp.storage.addToRemoveTransaction(transactions,removeFromMapList[i],parent,storageEntry),emp.storage.processChildrenRemoves(transactions,removeFromMapList[i],storageEntry);for(parentMapList=parent.getParentMapInstanceList(),i=0;i<parentMapList.length;i++)emp.storage.addToObjectRemoveTransaction(transactions,parentMapList[i],parent,storageEntry)}for(i=0;i<mapList.length;i++)prevMapList.indexOf(mapList[i])===-1&&addToMapList.push(mapList[i]);if(addToMapList.length>0){for(i=0;i<addToMapList.length;i++)emp.storage.addToAddTransaction(transactions,addToMapList[i],parent,storageEntry,zoom),emp.storage.processChildrenAdds(transactions,addToMapList[i],storageEntry);for(parentMapList=parent.getParentMapInstanceList(),i=0;i<parentMapList.length;i++)emp.storage.addToObjectAddTransaction(transactions,parentMapList[i],parent,storageEntry)}if(0===removeFromMapList.length&&0===addToMapList.length)for(parentMapList=parent.getParentMapInstanceList(),i=0;i<parentMapList.length;i++)parent.isParentOf(storageEntry.getCoreId())?emp.storage.addToUpdateTransaction(transactions,parentMapList[i],parent,storageEntry):emp.storage.addToObjectRemoveTransaction(transactions,parentMapList[i],parent,storageEntry)},emp.storage.overlay.update=function(oTransaction){var oOverlayItem,oStorageEntry,iIndex,aPrevMapList,aMapList,iParentCount,iParentIndex,oParent,oaItems=oTransaction.items,oTransactions={};for(iIndex=0;iIndex<oaItems.length;)if(oOverlayItem=oaItems[iIndex],oStorageEntry=emp.storage.findOverlay(oOverlayItem.overlayId),void 0!==oStorageEntry){if(aPrevMapList=oStorageEntry.getParentMapInstanceList(),emp.storage.overlay.updateItem(oTransactions,oTransaction,oStorageEntry,oOverlayItem,!0)){for(aMapList=oStorageEntry.getParentMapInstanceList(),iParentCount=oStorageEntry.parentCount(),iParentIndex=0;iParentIndex<iParentCount;iParentIndex++)oParent=oStorageEntry.getParentByIndex(iParentIndex),emp.storage.processRequest(oTransactions,aPrevMapList,aMapList,oParent,oStorageEntry,!1);iIndex++}}else oTransaction.fail({coreId:oStorageEntry.getCoreId(),level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay "+oOverlayItem.overlayId+" not found."});emp.storage.executeTransactions(oTransactions)},emp.storage.overlay.clusterSet=function(oTransaction){for(var oClusterDef,oOverlay,i=0;i<oTransaction.items.length;i+=1)oClusterDef=oTransaction.items[i],oClusterDef&&(oOverlay=emp.storage.findOverlay(oClusterDef.getOverlayId()),oOverlay&&(oOverlay.properties.cluster=oClusterDef,oOverlay.properties.bClusterActive=!0))},emp.storage.overlay.clusterActivate=function(oTransaction){for(var oClusterDef,oOverlay,i=0;i<oTransaction.items.length;i+=1)oClusterDef=oTransaction.items[i],oClusterDef&&(oOverlay=emp.storage.findOverlay(oClusterDef.getOverlayId()),oOverlay&&(oOverlay.properties.bClusterActive=!0))},emp.storage.overlay.clusterDeactivate=function(oTransaction){for(var oClusterDef,oOverlay,i=0;i<oTransaction.items.length;i+=1)oClusterDef=oTransaction.items[i],oClusterDef&&(oOverlay=emp.storage.findOverlay(oClusterDef.getOverlayId()),oOverlay&&(oOverlay.properties.bClusterActive=!1))},emp.storage.overlay.clusterRemove=function(oTransaction){for(var oClusterDef,oOverlay,i=0;i<oTransaction.items.length;i+=1)oClusterDef=oTransaction.items[i],oClusterDef&&(oOverlay=emp.storage.findOverlay(oClusterDef.getOverlayId()),oOverlay&&(oOverlay.properties.hasOwnProperty("cluster")&&delete oOverlay.properties.cluster,oOverlay.properties.hasOwnProperty("bClusterActive")&&delete oOverlay.properties.bClusterActive))},emp.storage.staticContent={},emp.storage.staticContent.add=function(oTransaction){var i,item,EmpStaticContent,oEmpParent,store=emp.storage._storage.store,mapInstanceId=oTransaction.mapInstanceId,sRootGUID=emp.storage.getRootGuid(mapInstanceId);for(i=0;i<oTransaction.items.length;i+=1)item=oTransaction.items[i],EmpStaticContent=store[item.coreId],EmpStaticContent||(EmpStaticContent=new emp.classLibrary.EmpStaticContent(item),void 0===item.coreParent&&(emp.helpers.isEmptyString(item.parentId)?emp.helpers.isEmptyString(item.overlayId)?item.coreParent=sRootGUID:item.coreParent=item.overlayId:item.coreParent=item.parentId),oEmpParent=store[item.coreParent],void 0===oEmpParent?oTransaction.fail({coreId:item.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Static content parent of "+item.name+" not found in storage."}):(store[EmpStaticContent.getCoreId()]=EmpStaticContent,oEmpParent.addChild(EmpStaticContent,item.visible)))},emp.storage.visibility={},emp.storage.visibility.set=function(oTransaction){var iIndex,oItem,oStorageItem,sCoreId,oParent,oParentList,oStatus,aoItems=oTransaction.items,oNewItems=[],oNewTrans=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_VISIBILITY_SET,mapInstanceId:oTransaction.mapInstanceId,source:emp.core.sources.CORE,items:oNewItems}),setChildVisibilityRecursive=function(oParentEntry){var oChild,oChildList;if(oParentEntry.isOnMap(oTransaction.mapInstanceId)){oChildList=oParentEntry.getChildrenList();for(sCoreId in oChildList)if(oChildList.hasOwnProperty(sCoreId)){if(oChild=emp.storage.get.id({id:sCoreId}),!oChild)return!1;if(oChild.visibility(oNewTrans,oParentEntry.getCoreId(),oItem.visible,!0),setChildVisibilityRecursive(oChild))return!0}}},setVisibilityTrans=function(oObject,oParentEntry,bVisibility,bTraceUp){var oParentList,sParentCoreId=oParentEntry.getCoreId();if(oParentEntry.isOnMap(oTransaction.mapInstanceId)){if(oObject.visibility(oNewTrans,sParentCoreId,bVisibility,!0),sParentCoreId===emp.storage.getRootGuid(oTransaction.mapInstanceId))return!0;if(bVisibility&&bTraceUp){oParentList=oParentEntry.getParentRelationshipList();for(sCoreId in oParentList)if(oParentList.hasOwnProperty(sCoreId)&&setVisibilityTrans(oParentEntry,emp.storage.get.id({id:sCoreId}),oItem.visible,bTraceUp))return!0}}return!1};if(oTransaction.source!==emp.core.sources.CORE){for(iIndex=0;iIndex<aoItems.length;)if(oItem=aoItems[iIndex],oStorageItem=emp.helpers.isEmptyString(oItem.featureId)?emp.storage.findOverlay(oItem.overlayId):emp.storage.findFeature(oItem.overlayId,oItem.featureId))if(oItem.targetAttributes=oStorageItem.getObjectData(),oItem.coreId=oStorageItem.getCoreId(),oStorageItem.isOnMap(oTransaction.mapInstanceId))if(oStatus=emp.storage.findParent(oTransaction.mapInstanceId,oStorageItem.getCoreObjectType(),oItem),oStatus.success){if(oParent=oStatus.parent){if(!oParent.isParentOf(oStorageItem.getCoreId())){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:oParent.getName()+" is not a parent of "+oStorageItem.getName()+". Visibility not set."});continue}setVisibilityTrans(oStorageItem,oParent,oItem.visible,!1),oItem.coreParent=oParent.getCoreId(),oItem.parentTargetAttributes=oParent.getObjectData()}else{oParentList=oStorageItem.getParentRelationshipList();for(sCoreId in oParentList)oParentList.hasOwnProperty(sCoreId)&&(oParent=oStorageItem.getParent(sCoreId),setVisibilityTrans(oStorageItem,oParent,oItem.visible,!0));oItem.parentTargetAttributes=null,oParent=oStorageItem.getParent(Object.keys(oStorageItem.options.parentObjects)[0]),emp.storage.isRoot(oParent.options.coreId)||emp.wms.manager.isRootWMS(oParent.options.coreId)||(oItem.parentTargetAttributes=oParent.getObjectData())}oItem.recurse&&setChildVisibilityRecursive(oStorageItem),iIndex++}else oTransaction.fail({coreId:oStatus.oError.coreId,level:oStatus.oError.level,message:oStatus.oError.message+" Visibility not set."});else oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature "+oStorageItem.getName()+" is not on the map instance provided."});else{if(emp.helpers.isEmptyString(oItem.featureId)){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay does not exists."});continue}oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature does not exists."})}oNewTrans.run()}},emp.storage.visibility.checkChildrenVisibility=function(oParent,bVisible,oTransaction){var oChild,oItem,oaItems=oTransaction.items,store=emp.storage._storage.store;if(oParent.hasChildren())for(var sCoreId in oParent.nodes)if(emp.helpers.findIndexOf(oaItems,"coreId",sCoreId)===-1&&(oChild=store[sCoreId],oChild.setVisibilityWithParent(oParent.coreId,bVisible))){switch(oChild.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:oItem=oChild.getObjectData(oTransaction.mapInstanceId,oParent.getCoreId()),oaItems.push(oItem);break;case emp.typeLibrary.types.OVERLAY:oItem=oChild.getObjectData(oTransaction.mapInstanceId,oParent.getCoreId()),oaItems.push(oItem),oItem.coreParent!==emp.storage.getRootGuid(oTransaction.mapInstanceId)&&oTransaction.duplicate(oItem.coreId);break;case emp.typeLibrary.types.WMS:default:continue}oItem.visible=bVisible,oItem.coreParent=oParent.coreId,emp.storage.visibility.checkChildrenVisibility(oChild,bVisible,oTransaction)}},emp.storage.visibility.get=function(args){var i,store=emp.storage._storage.store;for(i=0;i<args.items.length;i+=1)args.items[i].visible=store[args.items[i].coreId].visible},emp.storage.visibility.getState=function(transaction){var visible,parentObjects,visibilitySetting,visibilityState,target,parent,store=emp.storage._storage.store;target=store[transaction.items[0].coreId],void 0===target?transaction.fail(new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MINOR,message:"Could not find target on map"})):(visible=target.options.visibleOnMap[transaction.mapInstanceId],void 0===visible?transaction.fail(new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MINOR,message:"Could not find target on map"})):transaction.items[0].parentId?(parent=store[transaction.items[0].parentId],parent?(visible?visibilityState=emp3.api.enums.VisibilityStateEnum.VISIBLE:(parentObjects=store[transaction.items[0].coreId].options.parentObjects,visibilitySetting=parentObjects[transaction.items[0].parentId].options.visibilitySetting[transaction.mapInstanceId],void 0===visibilitySetting?transaction.fail(new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MINOR,message:"Could not find parent on map"})):visibilityState=visibilitySetting===!0?emp3.api.enums.VisibilityStateEnum.VISIBLE_ANCESTOR_HIDDEN:emp3.api.enums.VisibilityStateEnum.HIDDEN),transaction.items[0].visible=visibilityState):transaction.fail(new emp.typeLibrary.Error({coreId:transaction.items[0].coreId,level:emp.typeLibrary.Error.level.MINOR,message:"Could not find parent on map"}))):(visibilityState=visible?emp3.api.enums.VisibilityStateEnum.VISIBLE:emp3.api.enums.VisibilityStateEnum.HIDDEN,transaction.items[0].visible=visibilityState))},emp.storage.selection={},emp.storage.selection._selectedList={},emp.storage.selection.getSelectedList=function(mapInstanceId){return emp.storage.selection._selectedList.hasOwnProperty(mapInstanceId)||(emp.storage.selection._selectedList[mapInstanceId]=[]),emp.storage.selection._selectedList[mapInstanceId]},emp.storage.selection.removeSelectedList=function(mapInstanceId){emp.storage.selection._selectedList.hasOwnProperty(mapInstanceId)&&delete emp.storage.selection._selectedList[mapInstanceId]},emp.storage.selection.getSelectionIndex=function(mapInstanceId,oSelection){var iIndex,oaSelectionList=emp.storage.selection.getSelectedList(mapInstanceId),bNoSelectedId=emp.helpers.isEmptyString(oSelection.selectedId);for(iIndex=0;iIndex<oaSelectionList.length;iIndex++)if(oSelection.coreId===oaSelectionList[iIndex].coreId){if(bNoSelectedId&&emp.helpers.isEmptyString(oaSelectionList[iIndex].selectedId))return iIndex;if(oSelection.selectedId===oaSelectionList[iIndex].selectedId)return iIndex}return-1},emp.storage.selection.set=function(oTransaction){var sCoreID,oSelectionItem,oStorageItem,iIndex,iSelectionIndex,oaSelectionList=emp.storage.selection.getSelectedList(oTransaction.mapInstanceId),oaItems=oTransaction.items;for(iIndex=0;iIndex<oaItems.length;iIndex++)oSelectionItem=oaItems[iIndex],sCoreID=oSelectionItem.coreId,sCoreID!==emp.typeLibrary.Selection._NOSELECT&&(oStorageItem=emp.storage.findObject(sCoreID),oStorageItem&&oStorageItem.getCoreObjectType()===emp.typeLibrary.types.FEATURE&&(iSelectionIndex=emp.storage.selection.getSelectionIndex(oTransaction.mapInstanceId,oSelectionItem),oSelectionItem.select?iSelectionIndex===-1&&oaSelectionList.push(oSelectionItem):iSelectionIndex>-1&&oaSelectionList.splice(iSelectionIndex,1)))},emp.storage.selection.selectionChange=function(oTransaction){for(var sCoreID,oSelectionItem,oStorageItem,oSelectionTransaction,oDeselectionTransaction,iSelectionIndex,oaSelectionList=emp.storage.selection.getSelectedList(oTransaction.mapInstanceId),oaItems=oTransaction.items,oSelectList=[],oDeselectList=[],iIndex=0;iIndex<oaItems.length;iIndex++)oSelectionItem=oaItems[iIndex],sCoreID=oSelectionItem.coreId,sCoreID!==emp.typeLibrary.Selection._NOSELECT&&(oStorageItem=emp.storage.findObject(sCoreID),void 0!==oStorageItem&&(iSelectionIndex=emp.storage.selection.getSelectionIndex(oTransaction.mapInstanceId,oSelectionItem),oSelectionItem.select?(iSelectionIndex===-1&&oaSelectionList.push(oSelectionItem),oSelectList.push(oSelectionItem)):(iSelectionIndex>-1&&oaSelectionList.splice(iSelectionIndex,1),oDeselectList.push(oSelectionItem))));oSelectList.length>0&&(oSelectionTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.SELECTION_OUTBOUND,mapInstanceId:oTransaction.mapInstanceId,source:"CORE-EVENTING",sender:"EMP_MAP_CORE",items:oSelectList}),oSelectionTransaction.run()),oDeselectList.length>0&&(oDeselectionTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.DESELECTION_OUTBOUND,mapInstanceId:oTransaction.mapInstanceId,source:"CORE-EVENTING",sender:"EMP_MAP_CORE",items:oDeselectList}),oDeselectionTransaction.run())},emp.storage.map={},emp.storage.map.status=function(){},emp.storage.view={},emp.storage.view.set=function(args){emp.storage._storage.currentView=args.items[0]},emp.storage.view.get=function(){},emp.storage._status={},emp.storage._status.set=function(args){"replay"===args&&emp.storage.replay()},emp.storage.editBegin=function(oTransaction){var sCoreId,oStorageEntry;oTransaction.items&&oTransaction.items.length>0&&(sCoreId=oTransaction.items[0].coreId,oStorageEntry=emp.storage.get.id({id:sCoreId}),oStorageEntry&&oStorageEntry.setEditMode(!0))},emp.storage.feature.validateUpdate=function(oTransaction){function isMoveValid(oFeature){var oParent,oChild,sDestParentID=oFeature.destCoreParent,oDestParent=emp.storage._storage.get({coreId:sDestParentID});if(sErrorMsg="",sDestParentID===emp.storage.getRootGuid(oTransaction.mapInstanceId)){if(oFeature.globalType!==emp.typeLibrary.types.WMS)return sErrorMsg="A feature item can not be moved to the root.",!1;oDestParent=emp.storage._storage.get({coreId:emp.wms.manager.getWmsOverlayId()})}else if(void 0===oDestParent){if(oFeature.destParentId)return sErrorMsg="Destination parent does not exists.",!1;if(oFeature.createDestinationParent(),oDestParent=emp.storage._storage.get({coreId:sDestParentID}),void 0===oDestParent)return sErrorMsg="Destination parent overlay creation failed.",!1}if(oFeature.globalType===emp.typeLibrary.types.WMS&&oDestParent.globalType!==emp.typeLibrary.types.OVERLAY)return sErrorMsg="The parent of a WMS service MUST be an overlay.",!1;var sCoreId;switch(oFeature.globalType){case emp.typeLibrary.types.FEATURE:for(sCoreId in oDestParent.nodes){if(oChild=oDestParent.nodes[sCoreId],oChild.globalType===emp.typeLibrary.types.FEATURE&&oChild.featureId===oFeature.featureId)return sErrorMsg="Move would create a duplicate ID under destination parent.",!1;if(oChild.globalType===emp.typeLibrary.types.WMS&&oChild.id===oFeature.featureId)return sErrorMsg="Move would create a duplicate ID under destination parent.",!1}break;case emp.typeLibrary.types.WMS:for(sCoreId in oDestParent.nodes){if(oChild=oDestParent.nodes[sCoreId],oChild.globalType===emp.typeLibrary.types.WMS&&oChild.id===oFeature.id)return sErrorMsg="Move would create a duplicate ID under destination parent.",!1;if(oChild.globalType===emp.typeLibrary.types.FEATURE&&oChild.featureId===oFeature.id)return sErrorMsg="Move would create a duplicate ID under destination parent.",!1}}switch(oParent=oDestParent,oFeature.globalType){case emp.typeLibrary.types.FEATURE:for(;oParent&&oParent.coreId!==emp.storage.getRootGuid(oTransaction.mapInstanceId);){if(oParent.globalType===emp.typeLibrary.types.FEATURE&&oParent.featureId===oFeature.featureId&&oParent.overlayId===oFeature.destOverlayId)return sErrorMsg="Move would cause a parent child loop.",!1;oParent=emp.storage._storage.get({coreId:oParent.coreParent})}break;case emp.typeLibrary.types.WMS:for(;oParent&&oParent.coreId!==emp.storage.getRootGuid(oTransaction.mapInstanceId);){if(oParent.globalType===emp.typeLibrary.types.WMS&&oParent.id===oFeature.id&&oParent.overlayId===oFeature.destOverlayId)return sErrorMsg="Move would cause a parent child loop.",!1;oParent=emp.storage._storage.get({coreId:oParent.coreParent})}}return!0}var sDestOverlay,sDestParentId,oStorageEntry,iIndex,oItem,oNewItem,sErrorMsg;if(oTransaction.items&&oTransaction.items.length>0)for(iIndex=0;iIndex<oTransaction.items.length;)if(oItem=oTransaction.items[iIndex],oStorageEntry=emp.storage.get.byIds(oItem),void 0!==oStorageEntry){switch(sDestOverlay=oItem.destOverlayId,sDestParentId=oItem.destParentId,oStorageEntry.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:if(oStorageEntry.isMultiParentRequired()){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Operation not supported on multi parented objects."});continue}oNewItem=oStorageEntry.getObjectData(oTransaction.mapInstanceId,oItem.coreParent);var oPayload={newOverlayId:oItem.destOverlayId,newParentId:oItem.destParentId};oItem.name&&(oPayload.name=oItem.name),oNewItem.applyUpdate(oPayload);break;case emp.typeLibrary.types.WMS:if(sDestParentId){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"A WMS can not be a child of a feature."});continue}oNewItem=oStorageEntry.getObjectData(oTransaction.mapInstanceId,oItem.coreParent),void 0!==oItem.name&&(oNewItem.name=oItem.name);break;default:oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid object type retrieved from storage engine."});continue}oTransaction.items[iIndex]=oNewItem,oStorageEntry&&(sDestOverlay||sDestParentId)?oStorageEntry.isInEditMode()?oTransaction.fail([{coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Update failed, the Feature is being edited."}]):isMoveValid(oNewItem)?iIndex++:oTransaction.fail({coreId:oNewItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:sErrorMsg}):iIndex++}else oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature does not exists."})},emp.storage.overlay.validateParent=function(sCoreId,coreParentId){var oParentCheck,aParentList,iIndex,oRetStatus=!0,oParent=emp.storage.findObject(coreParentId);if(sCoreId===coreParentId)return{success:!1,errorMsg:"An overlay cannot be its own ancestor."};if(emp.helpers.isEmptyString(coreParentId))return!0;if(oParentCheck=oParent.getParent(sCoreId))return{success:!1,errorMsg:"An overlay cannot be its own ancestor."};for(aParentList=oParent.getParentCoreIds(),iIndex=0;iIndex<aParentList.length&&(oRetStatus=emp.storage.overlay.validateParent(sCoreId,aParentList[iIndex]),oRetStatus===!0);iIndex++);return oRetStatus},emp.storage.overlay.validateUpdate=function(oTransaction){for(var oItem,oNewItem,oStorageItem,oParentValid,oaItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,iIndex=0;iIndex<oaItems.length;)if(oItem=oaItems[iIndex],oStorageItem=emp.storage.findOverlay(oItem.overlayId),void 0!==oStorageItem)if(oStorageItem.getCoreObjectType()===emp.typeLibrary.types.OVERLAY)if(!emp.helpers.isEmptyString(oItem.parentId)&&oStorageItem.parentCount()>1)oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Move operation on an overlay with more than 1 parent is not supported."});else{if(!emp.helpers.isEmptyString(oItem.parentId)){switch(oItem.parentId){case emp.constant.parentIds.ALL_PARENTS:case emp.constant.parentIds.MAP_LAYER_PARENT:oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid parentId for overlay move. Overlay update canceled."});continue;case emp.constant.parentIds.MAP_ROOT:oItem.parentId=emp.storage.getRootGuid(mapInstanceId),oItem.coreParent=oItem.parentId;break;default:oItem.coreParent=oItem.parentId}if(oParentValid=emp.storage.overlay.validateParent(oStorageItem.getCoreId(),oItem.coreParent),oParentValid!==!0){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:oParentValid.errorMsg});continue}}oNewItem=oStorageItem.getObjectData(mapInstanceId,oItem.coreParent),oItem.name&&(oNewItem.name=oItem.name),oItem.hasOwnProperty("properties")&&(oNewItem.properties=oItem.properties,oStorageItem.getProperties().hasOwnProperty("cluster")&&(oNewItem.properties.cluster=oStorageItem.getProperties().cluster,oNewItem.properties.bClusterActive=oStorageItem.getProperties().bClusterActive)),oItem.hasOwnProperty("menuId")&&(oNewItem.menuId=oItem.menuId),oaItems[iIndex]=oNewItem,oItem=oNewItem,iIndex++}else oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Storage contains an object with the same ID that is not an overlay."});else oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay does not exists."})},emp.storage.editTransCplt=function(oTransaction){var sCoreId,iIndex,oStorageEntry;if(oTransaction.items&&oTransaction.items.length>0)for(iIndex=0;iIndex<oTransaction.items.length;iIndex++)sCoreId=oTransaction.items[iIndex].coreId,oStorageEntry=emp.storage.get.id({id:sCoreId}),oStorageEntry&&oStorageEntry.setEditMode(!1);if(oTransaction.failures&&oTransaction.failures.length>0)for(iIndex=0;iIndex<oTransaction.failures.length;iIndex++)sCoreId=oTransaction.failures[iIndex].coreId,oStorageEntry=emp.storage.get.id({id:sCoreId}),oStorageEntry&&oStorageEntry.setEditMode(!1)},emp.storage.validateEdit=function(oTransaction){for(var oStorageEntry,oEditItem,oParent,iIndex=0;iIndex<oTransaction.items.length;)oEditItem=oTransaction.items[iIndex],oStorageEntry=emp.storage.findFeature(oEditItem.overlayId,oEditItem.featureId),void 0!==oStorageEntry?oStorageEntry.isInEditMode()?oTransaction.fail([{coreId:oEditItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature is already being edited."}]):oStorageEntry.canMapEngineEdit(oTransaction.mapInstanceId)?(oParent=emp.storage.findParentOnMap(oTransaction.mapInstanceId,oStorageEntry),oEditItem.originFeature=oStorageEntry.getObjectData(oTransaction.mapInstanceId,oParent.getCoreId()),iIndex++):oTransaction.fail([{coreId:oEditItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Current map does not support editing a feature of this type."}]):oTransaction.fail([{coreId:oEditItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature does not exist."}])},emp.storage.validateDraw=function(oTransaction){for(var iIndex=0;iIndex<oTransaction.items.length;iIndex++){var oDrawItem=oTransaction.items[iIndex],oFeature=emp.storage.findFeature(oDrawItem.overlayId,oDrawItem.featureId);if(oFeature)switch(oFeature.getFormat()){case emp.typeLibrary.featureFormatType.GEOJSON:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:case emp3.api.enums.FeatureTypeEnum.GEO_ACM:oDrawItem.coreId=oFeature.coreId,oDrawItem.parentCoreId=oFeature.parentCoreId;break;default:oTransaction.fail([{coreId:oDrawItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"A draw operation is not supported on feature "+oFeature.featureId+" due to it having a format of: "+oFeature.format+". Please see documentation for a list of feature formats that support drawing."}]),iIndex--;continue}else if(void 0!==oDrawItem.overlayId&&null!==oDrawItem.overlayId){var oOverlay=emp.storage.findOverlay(oDrawItem.overlayId);void 0!==oOverlay?oDrawItem.parentCoreId=oOverlay.coreId:oDrawItem.parentCoreId=oFeature.overlayId}}},emp.storage.overlay.remove=function(oTransaction){var oStorageEntry,aMapList,aPrevMapList,iIndex,oItem,oParent,oaItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,oTransactions={};for(iIndex=0;iIndex<oaItems.length;)if(oItem=oaItems[iIndex],oStorageEntry=emp.storage.findOverlay(oItem.overlayId),void 0!==oStorageEntry){if(emp.helpers.isEmptyString(oItem.parentId)){if(oParent=emp.storage.findOverlay(emp.storage.getRootGuid(mapInstanceId)),void 0===oParent){new emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"Unable to find map instance root ("+emp.storage.getRootGuid(mapInstanceId)+") for overlay "+oStorageEntry.getName()+"."}),oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find map root of overlay "+oStorageEntry.getName()+"."});continue}}else if(oParent=emp.storage.findOverlay(oItem.parentId),void 0===oParent){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to find parent overlay of overlay "+oStorageEntry.getName()+"."});continue}oParent.isParentOf(oStorageEntry.getCoreId())?(aPrevMapList=oStorageEntry.getParentMapInstanceList(),oParent.removeChild(oStorageEntry),aMapList=oStorageEntry.getParentMapInstanceList(),emp.storage.processRequest(oTransactions,aPrevMapList,aMapList,oParent,oStorageEntry,!1),0===aMapList.length&&(emp.storage.removeParentFromChildren(oStorageEntry),emp.storage.deleteObject(oStorageEntry)),aMapList=oParent.getParentMapInstanceList(),iIndex++):oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:oParent.getName()+" is not a parent of feature "+oStorageEntry.getName()+"."})}else oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay remove: overlay "+oItem.overlayId+" not found."});emp.storage.executeTransactions(oTransactions)},emp.storage.removeParentFromChildren=function(oParent){var oChild;if(oParent.hasChildren())for(var coreIdList=oParent.getChildrenCoreIds(),iIndex=0;iIndex<coreIdList.length;iIndex++)oChild=oParent.getChild(coreIdList[iIndex]),oParent.removeChild(oChild),oChild.hasParents()||(emp.storage.removeParentFromChildren(oChild),emp.storage.deleteObject(oChild))},emp.storage.feature.validateAdd=function(oTransaction){for(var oStorageEntry,oItem,oParent,oItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,iIndex=0;iIndex<oItems.length;)if(oItem=oItems[iIndex],oParent=emp.storage.get.id({id:oItem.coreParent}),oItem.parentId&&void 0===oItem.coreParent)oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"The parent feature ("+oItem.parentId+") of feature "+oItem.name+" does not exists."});else{if(void 0!==oParent&&oParent.options.coreId===oItem.coreId)return oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Cannot set a feature as a child of itself: "+oItem.name+"."}),!1;if(void 0===oParent&&void 0===oItem.parentId)switch(oItem.overlayId){case emp.constant.parentIds.ALL_PARENTS:case void 0:if(oStorageEntry=emp.storage.findFeature(void 0,oItem.featureId),!oStorageEntry){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid parent for new feature ("+oItem.name+")."});continue}delete oItem.overlayId,delete oItem.parentId,delete oItem.coreParent;break;case emp.constant.parentIds.MAP_ROOT:oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Features can not be added to the root of the map."});continue;default:if(emp.storage.overlay.createOverlay(mapInstanceId,oItem.overlayId,oTransaction.sender),oParent=emp.storage.findObject(oItem.coreParent),void 0===oParent){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to create parent overlay of this feature ("+oItem.name+")."});continue}}iIndex++}},
emp.storage.overlay.validateAdd=function(oTransaction){for(var oItem,oParent,oItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,rootCoreId=emp.storage.getRootGuid(mapInstanceId),iIndex=0;iIndex<oItems.length;){if(oItem=oItems[iIndex],void 0!==oItem.parentId?(oItem.coreParent=oItem.parentId,oItem.parentCoreId=oItem.coreParent):(oItem.coreParent=rootCoreId,oItem.parentCoreId=void 0),oItem.coreParent!==rootCoreId)if(oParent=emp.storage.findObject(oItem.coreParent),void 0!==oParent);else switch(oItem.overlayId){case emp.constant.parentIds.MAP_ROOT:break;case emp.constant.parentIds.ALL_PARENTS:case void 0:break;default:if(emp.storage.overlay.createOverlay(mapInstanceId,oItem.parentId,oTransaction.sender),oParent=emp.storage.findObject(oItem.parentId),void 0===oParent){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to create parent of this overlay ("+oItem.name+")."});continue}}iIndex++}},emp.storage.overlay.validateCluster=function(oTransaction){for(var oItem,oOverlay,oItems=oTransaction.items,iIndex=0;iIndex<oItems.length;iIndex++)oItem=oItems[iIndex],oOverlay=emp.storage.get.id({id:oItem.coreId}),oOverlay?oOverlay.isMultiParentRequired()&&oOverlay.coreParent!==emp.storage.getRootGuid(oTransaction.mapInstanceId)&&(oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Only the root multi-parent overlay can be clustered."}),iIndex--):(oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Cluster Set failed. Overlay does NOT exists."}),iIndex--)},emp.storage.findParent=function(mapInstanceId,objectType,oItem){var oReturnStatus={success:!1,parent:void 0,oError:{coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent not found."}};if(oItem.hasOwnProperty("parentId")){if(objectType===emp.typeLibrary.types.OVERLAY)switch(oItem.parentId){case emp.constant.parentIds.ALL_PARENTS:oReturnStatus.success=!0;break;case emp.constant.parentIds.MAP_ROOT:oReturnStatus.success=!0,oReturnStatus.parent=emp.storage.findOverlay(emp.storage.getRootGuid(mapInstanceId));break;default:emp.helpers.isEmptyString(oItem.parentId)?oReturnStatus.oError={coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid parent Id for overlay."}:(oReturnStatus.parent=emp.storage.findOverlay(oItem.parentId),void 0===oReturnStatus.parent?oReturnStatus.oError={coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent overlay "+oItem.parentId+" not found."}:oReturnStatus.success=!0)}else if(objectType===emp.typeLibrary.types.FEATURE)switch(oItem.parentId){case emp.constant.parentIds.ALL_PARENTS:case emp.constant.parentIds.MAP_ROOT:oReturnStatus.success=!0;break;default:emp.helpers.isEmptyString(oItem.parentId)||(oReturnStatus.parent=emp.storage.findFeature(oItem.overlayId,oItem.parentId),void 0===oReturnStatus.parent?oReturnStatus.oError={coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent feature "+oItem.parentId+" not found."}:oReturnStatus.success=!0)}}else if(oItem.hasOwnProperty("overlayId")&&objectType===emp.typeLibrary.types.FEATURE)switch(oItem.overlayId){case emp.constant.parentIds.ALL_PARENTS:oReturnStatus.success=!0;break;case emp.constant.parentIds.MAP_ROOT:oReturnStatus.oError={coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Feature "+oItem.featureId+" is not at the map root."};break;default:emp.helpers.isEmptyString(oItem.overlayId)||(oReturnStatus.parent=emp.storage.findOverlay(oItem.overlayId),oReturnStatus.parent?oReturnStatus.success=!0:oReturnStatus.oError={coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent Overlay "+oItem.overlayId+" not found."})}return oReturnStatus},emp.storage.mapservice={},emp.storage.mapservice.validateAdd=function(oTransaction){var oItem,iIndex,oStorageEntry,oaItems=oTransaction.items;for(iIndex=0;iIndex<oaItems.length;)if(oItem=oaItems[iIndex],oStorageEntry=emp.storage.get.id({id:oItem.coreId}),oStorageEntry&&oStorageEntry.getCoreObjectType()!==emp.typeLibrary.types.WMS)oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"MapService feature id is duplicate."});else{switch(oItem.overlayId){case emp.constant.parentIds.ALL_PARENTS:oStorageEntry||(oItem.overlayId=emp.constant.parentIds.MAP_LAYER_PARENT);break;case emp.constant.parentIds.MAP_ROOT:oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid overlay Id for WMS feature."});continue;case emp.constant.parentIds.MAP_LAYER_PARENT:break;case void 0:oStorageEntry?oItem.overlayId=emp.constant.parentIds.ALL_PARENTS:oItem.overlayId=emp.constant.parentIds.MAP_LAYER_PARENT}iIndex++}},emp.storage.mapservice.add=function(oTransaction){var oItem,iIndex,oParent,oStorageEntry,oMapIdList,oPrevMapList,oaItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,oTransactions={};for(iIndex=0;iIndex<oaItems.length;){switch(oItem=oaItems[iIndex],oStorageEntry=emp.storage.get.id({id:oItem.coreId}),oItem.overlayId){case emp.constant.parentIds.ALL_PARENTS:break;case emp.constant.parentIds.MAP_LAYER_PARENT:oItem.coreParent=emp.wms.manager.getWmsOverlayId(mapInstanceId),oParent=emp.storage.findOverlay(emp.wms.manager.getWmsOverlayId(mapInstanceId));break;default:if(oParent=emp.storage.findOverlay(oItem.overlayId),!oParent&&(emp.storage.overlay.createOverlay(mapInstanceId,oItem.overlayId,oTransaction.sender),oParent=emp.storage.get.id({id:oItem.overlayId}),void 0===oParent)){oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Unable to create parent overlay of WMS feature ("+oItem.url+")."});continue}oItem.coreParent=oItem.overlayId}if(oPrevMapList=[],oStorageEntry)oStorageEntry.update(oItem),oPrevMapList=oStorageEntry.getParentMapInstanceList();else switch(oItem.type){case"wms":oStorageEntry=new emp.classLibrary.EmpWMS(oItem),emp.storage._storage.set(oStorageEntry);break;case"wmts":oStorageEntry=new emp.classLibrary.EmpWMTS(oItem),emp.storage._storage.set(oStorageEntry);break;case"kml":oStorageEntry=new emp.classLibrary.EmpKmlLayer(oItem),emp.storage._storage.set(oStorageEntry)}if(oParent&&!oParent.isParentOf(oStorageEntry))switch(oItem.type){case"wms":oParent.addChild(oStorageEntry,oItem.visible&&(oStorageEntry.hasLayers()||oStorageEntry.hasVisibleLayers()));break;case"wmts":case"kml":oParent.addChild(oStorageEntry,oItem.visible)}oMapIdList=oStorageEntry.getParentMapInstanceList(),emp.storage.processRequest(oTransactions,oPrevMapList,oMapIdList,oParent,oStorageEntry),iIndex++}emp.storage.executeTransactions(oTransactions)},emp.storage.mapservice.remove=function(oTransaction){var oItem,iIndex,oMapIdList,oPrevMapIdList,oStorageEntry,oParent,oaItems=oTransaction.items,mapInstanceId=oTransaction.mapInstanceId,oTransactions={};for(iIndex=0;iIndex<oaItems.length;)if(oItem=oaItems[iIndex],oStorageEntry=emp.storage.get.id({id:oItem.coreId})){switch(oItem.overlayId){case emp.constant.parentIds.ALL_PARENTS:oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Invalid overlay id. WMS feature not removed."});continue;case emp.constant.parentIds.MAP_LAYER_PARENT:oItem.coreParent=emp.wms.manager.getWmsOverlayId(mapInstanceId),oParent=emp.storage.findOverlay(oItem.coreParent);break;default:oParent=emp.storage.findOverlay(oItem.overlayId),oItem.coreParent=oItem.overlayId}oParent?oParent.isParentOf(oStorageEntry.getCoreId())?(oPrevMapIdList=oStorageEntry.getParentMapInstanceList(),oParent.removeChild(oStorageEntry),oMapIdList=oStorageEntry.getParentMapInstanceList(),emp.storage.processRequest(oTransactions,oPrevMapIdList,oMapIdList,oParent,oStorageEntry),0===oStorageEntry.parentCount()&&(emp.storage.removeParentFromChildren(oStorageEntry),emp.storage.deleteObject(oStorageEntry)),iIndex++):oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MINOR,message:"Overlay "+oParent.getName()+" is not a parent of WMS "+oStorageEntry.getName()+". WMS feature not removed."}):oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Parent overlay not found. WMS feature not removed."})}else oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"WMS feature not found."});emp.storage.executeTransactions(oTransactions)},emp.storage.searchEngine=function(sMapInstanceId,oSearchCriteria){var mapInstanceId=sMapInstanceId,sRootCoreId=emp.storage.getRootGuid(mapInstanceId),oCriteria=oSearchCriteria,searchedEntries={},searchChildren=function(oCurrentResultSet,oTypes,iMaxResults,oStorageEntry){var sCoreId,oChild,oChildList;if(void 0===searchedEntries[oStorageEntry.getCoreId()]&&(searchedEntries[oStorageEntry.getCoreId()]=oStorageEntry,oStorageEntry.hasChildren())){oChildList=oStorageEntry.getChildrenList();for(sCoreId in oChildList)if(oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId])){if(globalTypeMatch(oChild,oTypes)&&oCurrentResultSet.indexOf(oChild)===-1&&(emp.storage.isRoot(oChild.options.coreId)||oCurrentResultSet.push(oChild)),void 0!==iMaxResults&&oCurrentResultSet.length>=iMaxResults)break;searchChildren(oCurrentResultSet,oTypes,iMaxResults,oChild)}}},findChildrenNoFilter=function(oCurrentResultSet,oTypes,iMaxResults,oStorageEntry,bRecursive){var sCoreId,oChild,oChildList;if(void 0===searchedEntries[oStorageEntry.getCoreId()]&&(searchedEntries[oStorageEntry.getCoreId()]=oStorageEntry,oStorageEntry.hasChildren())){oChildList=oStorageEntry.getChildrenList();for(sCoreId in oChildList)if(oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId]))if(globalTypeMatch(oChild,oTypes)){if(oCurrentResultSet.indexOf(oChild)===-1&&(emp.storage.isRoot(oChild.options.coreId)||emp.wms.manager.isRootWMS(oChild.options.coreId)||oChild.options.hidden||oCurrentResultSet.push(oChild),void 0!==iMaxResults&&oCurrentResultSet.length>=iMaxResults))break;bRecursive&&findChildrenNoFilter(oCurrentResultSet,oTypes,iMaxResults,oChild,bRecursive)}else bRecursive&&findChildrenNoFilter(oCurrentResultSet,oTypes,iMaxResults,oChild,bRecursive)}},searchChildrenWithFilter=function(oCurrentResultSet,oTypes,oFilter,iMaxResults,oStorageEntry){var sCoreId,oChild,oChildList;if(void 0===searchedEntries[oStorageEntry.getCoreId()]&&(searchedEntries[oStorageEntry.getCoreId()]=oStorageEntry,oStorageEntry.hasChildren())){oChildList=oStorageEntry.getChildrenList();for(sCoreId in oChildList)if(oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId])){if(globalTypeMatch(oChild,oTypes)&&(oFilter.length>0?passesFilters(oChild,oFilter)&&oCurrentResultSet.indexOf(oChild)===-1&&(emp.storage.isRoot(oChild.options.coreId)||oCurrentResultSet.push(oChild)):oCurrentResultSet.indexOf(oChild)===-1&&(emp.storage.isRoot(oChild.options.coreId)||oCurrentResultSet.push(oChild))),void 0!==iMaxResults&&oCurrentResultSet.length>=iMaxResults)break;searchChildrenWithFilter(oCurrentResultSet,oTypes,oFilter,iMaxResults,oChild)}}},passesFeatureIdFilter=function(oStorageEntry,sFeatureId){var oParent,sParentCoreId,oParentRelationshipList=oStorageEntry.getParentRelationshipList();for(sParentCoreId in oParentRelationshipList)if(oParentRelationshipList.hasOwnProperty(sParentCoreId)&&(oParent=emp.storage.findObject(sParentCoreId),oParent.getCoreObjectType()===emp.typeLibrary.types.FEATURE&&oParent.getFeatureId()===sFeatureId))return!0;return!1},passesOverlayIdFilter=function(oStorageEntry,sOverlayId){var oParent,sParentCoreId,oParentRelationshipList=oStorageEntry.getParentRelationshipList();for(sParentCoreId in oParentRelationshipList)if(oParentRelationshipList.hasOwnProperty(sParentCoreId))if(oParent=emp.storage.findObject(sParentCoreId),oParent.getCoreObjectType()===emp.typeLibrary.types.OVERLAY){if(void 0===sOverlayId){if(oParent.getOverlayId()===sRootCoreId)return!0}else if(oParent.getOverlayId()===sOverlayId)return!0}else if(oParent.getCoreObjectType()===emp.typeLibrary.types.FEATURE&&passesOverlayIdFilter(oParent,sOverlayId))return!0;return!1},passesFilter=function(oStorageEntry,oFilter){switch(oStorageEntry.getCoreObjectType()){case emp.typeLibrary.types.FEATURE:switch(oFilter.property){case"overlayId":return passesOverlayIdFilter(oStorageEntry,oFilter.term);case"parentId":return void 0===oFilter.term||passesFeatureIdFilter(oStorageEntry,oFilter.term)}break;case emp.typeLibrary.types.OVERLAY:switch(oFilter.property){case"parentId":return void 0===oFilter.term||passesOverlayIdFilter(oStorageEntry,oFilter.term)}}return oStorageEntry.compareProperty(mapInstanceId,oFilter.property,oFilter.term)},passesFilters=function(oStorageEntry,aoFilters){var iIndex;if(0===aoFilters.length)return!0;for(iIndex=0;iIndex<aoFilters.length;iIndex++)if(!passesFilter(oStorageEntry,aoFilters[iIndex]))return!1;return!0},searchEntry=function(oCurrentResultSet,oTypes,oaPropertyFilter,iMaxResults,oStorageEntry,bRecurse){var aParentList,i;if(globalTypeMatch(oStorageEntry,oTypes))if(oaPropertyFilter.length>0)passesFilters(oStorageEntry,oaPropertyFilter)&&(emp.storage.isRoot(oStorageEntry.options.coreId)||oCurrentResultSet.push(oStorageEntry)),bRecurse&&searchChildrenWithFilter(oCurrentResultSet,oTypes,oaPropertyFilter,iMaxResults,oStorageEntry);else{if(mapInstanceId){for(aParentList=oStorageEntry.getParentMapInstanceList(),i=0;i<aParentList.length;i+=1)if(aParentList[i]===mapInstanceId){oCurrentResultSet.push(oStorageEntry);break}}else emp.storage.isRoot(oStorageEntry.options.coreId)||oCurrentResultSet.push(oStorageEntry);bRecurse&&searchChildren(oCurrentResultSet,oTypes,iMaxResults,oStorageEntry)}else bRecurse&&searchChildrenWithFilter(oCurrentResultSet,oTypes,oaPropertyFilter,iMaxResults,oStorageEntry)},globalTypeMatch=function(oStorageEntry,oTypes){var iIndex;if(oStorageEntry.getCoreId()===sRootCoreId)return!1;for(iIndex=0;iIndex<oTypes.length;iIndex++)if(oStorageEntry.getCoreObjectType()===oTypes[iIndex])return!0;return!1};return{execute:function(){var sCoreId,oChild,oChildList,iIndex,oStorageEntry,oStorageRoot,sOverlayId,sFeatureId,sParentId,sChildId,bLookingForOverlay=!1,bLookingForFeature=!1,filter=oCriteria.filter||[],types=oCriteria.types?oCriteria.types.concat([]):[],recurse=oCriteria.recursive!==!1,iMaxResults=oCriteria.maxResults||void 0,currentResultSet=[],oaPropertyFilter=[];if(searchedEntries={},void 0===types||null===types||0===types.length)return currentResultSet;for(oCriteria.types=types,iIndex=0;iIndex<types.length;iIndex++)switch(types[iIndex]){case"overlays":types[iIndex]="overlay",bLookingForOverlay=!0;break;case"features":types[iIndex]="feature",bLookingForFeature=!0;break;case"overlay":bLookingForOverlay=!0;break;case"feature":bLookingForFeature=!0}if(types.indexOf(emp.typeLibrary.types.FEATURE)>=0&&types.indexOf(emp.typeLibrary.types.WMS)===-1&&types.push(emp.typeLibrary.types.WMS),types.indexOf(emp.typeLibrary.types.FEATURE)>=0&&types.indexOf(emp.typeLibrary.types.WMTS)===-1&&types.push(emp.typeLibrary.types.WMTS),filter.length>0)for(iIndex=0;iIndex<filter.length;iIndex++)switch(filter[iIndex].property){case"overlayId":sOverlayId=filter[iIndex].term;break;case"featureId":sFeatureId=filter[iIndex].term;break;case"parentId":sParentId=filter[iIndex].term;break;case"childId":sChildId=filter[iIndex].term;break;default:oaPropertyFilter.push(filter[iIndex])}if(bLookingForOverlay&&void 0!==sOverlayId)oStorageEntry=emp.storage.findOverlay(sOverlayId),oStorageEntry&&searchEntry(currentResultSet,types,oaPropertyFilter,iMaxResults,oStorageEntry,recurse);else if(bLookingForOverlay&&void 0!==sParentId){if(oStorageEntry=emp.storage.findOverlay(sParentId)){searchedEntries[oStorageEntry.getCoreId()]=oStorageEntry,oChildList=oStorageEntry.getChildrenList();for(sCoreId in oChildList)oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId],searchEntry(currentResultSet,types,oaPropertyFilter,iMaxResults,oChild,recurse))}}else if(bLookingForFeature&&void 0!==sFeatureId)oStorageEntry=emp.storage.findFeature(sOverlayId,sFeatureId),oStorageEntry&&searchEntry(currentResultSet,types,oaPropertyFilter,iMaxResults,oStorageEntry,recurse);else if(bLookingForFeature&&void 0!==sParentId){if(oStorageEntry=emp.storage.findFeature(sOverlayId,sParentId)){searchedEntries[oStorageEntry.getCoreId()]=oStorageEntry,oChildList=oStorageEntry.getChildrenList();for(sCoreId in oChildList)oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId],searchEntry(currentResultSet,types,oaPropertyFilter,iMaxResults,oChild,recurse))}}else if(bLookingForFeature&&void 0!==sOverlayId){if(oStorageEntry=emp.storage.findOverlay(sOverlayId)){searchedEntries[oStorageEntry.getCoreId()]=oStorageEntry,oChildList=oStorageEntry.getChildrenList();for(sCoreId in oChildList)oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId],searchEntry(currentResultSet,types,oaPropertyFilter,iMaxResults,oChild,recurse))}}else if(sChildId){var storageObject=emp.storage.get.id({id:sChildId});for(sCoreId in storageObject.options.parentObjects)storageObject.options.parentObjects.hasOwnProperty(sCoreId)&&(emp.storage.isRoot(sCoreId)||currentResultSet.push(emp.storage.get.id({id:sCoreId})))}else if(filter.length>0){oStorageRoot=emp.storage.findOverlay(sRootCoreId),oChildList=oStorageRoot.getChildrenList();for(sCoreId in oChildList)if(oChildList.hasOwnProperty(sCoreId)&&(oChild=oChildList[sCoreId],searchEntry(currentResultSet,types,oaPropertyFilter,iMaxResults,oChild,recurse),void 0!==iMaxResults&&currentResultSet.length>=iMaxResults))break}else oStorageRoot=emp.storage.findOverlay(sRootCoreId),findChildrenNoFilter(currentResultSet,types,iMaxResults,oStorageRoot,recurse);return types.indexOf(emp.typeLibrary.types.WMS)>-1&&types.splice(types.indexOf(emp.typeLibrary.types.WMS),1),types.indexOf(emp.typeLibrary.types.WMTS)>-1&&types.splice(types.indexOf(emp.typeLibrary.types.WMTS),1),currentResultSet}}},emp.storage.query=function(oTransaction){var iIndex,oSearchEngine,oResultSet,oTypes=oTransaction.items[0].types instanceof Array?oTransaction.items[0].types:[emp.typeLibrary.types.FEATURE],oFilters=oTransaction.items[0].filter||[],mapInstanceId=oTransaction.mapInstanceId;for(oTransaction.items[0].filter=oFilters,oTransaction.items[0].types=oTypes,oSearchEngine=new emp.storage.searchEngine(mapInstanceId,oTransaction.items[0]),oResultSet=oSearchEngine.execute(),oTypes=oTransaction.items[0].types,iIndex=0;iIndex<oTypes.length;iIndex++)oTransaction.items[0][oTypes[iIndex]]instanceof Array||(oTransaction.items[0][oTypes[iIndex]]=[]);for(iIndex=0;iIndex<oResultSet.length;iIndex++)switch(oResultSet[iIndex].getCoreObjectType()){case emp.typeLibrary.types.FEATURE:case emp.typeLibrary.types.OVERLAY:oTransaction.items[0][oResultSet[iIndex].getCoreObjectType()].push(oResultSet[iIndex].getObjectData(mapInstanceId,void 0));break;case emp.typeLibrary.types.WMS:case emp.typeLibrary.types.WMTS:oTransaction.items[0][emp.typeLibrary.types.FEATURE].push(oResultSet[iIndex].getObjectData(mapInstanceId,void 0))}return oResultSet},emp.storage._checkForRoot=function(oTypes,oFilters){var bAddRootStartingPoint=!0;if(void 0!==oFilters&&(null!==oFilters||oFilters instanceof Array)){for(var iIndex=0;iIndex<oFilters.length;iIndex++)switch(oFilters[iIndex].property){case"overlayId":case"parentId":case"featureId":bAddRootStartingPoint=!1}if(bAddRootStartingPoint){for(bAddRootStartingPoint=!1,iIndex=0;iIndex<oTypes.length;iIndex++)if("overlay"===oTypes[iIndex]){bAddRootStartingPoint=!0;break}bAddRootStartingPoint&&oFilters.push({term:void 0,property:"parentId"})}}},emp.storage.get={},emp.storage.get.id=function(args){return emp.storage._storage.store[args.id]},emp.storage.get.byIds=function(args){var sOverlayId=args.overlayId,sFeatureId=args.featureId;return void 0!==sFeatureId?emp.storage.findFeature(sOverlayId,sFeatureId):emp.storage.findOverlay(sOverlayId)},emp.storage.get.selected=function(oTransaction){var iIndex,oaSelectionList=emp.storage.selection.getSelectedList(oTransaction.mapInstanceId),returnVar={features:[]};if(oaSelectionList.length>0)for(iIndex=0;iIndex<oaSelectionList.length;iIndex++)returnVar.features.push(oaSelectionList[iIndex]);oTransaction.items[0].features=returnVar.features},emp.storage.findFeatureUnderFeature=function(oFeature,sFeatureId){var oChild;for(var sCoreId in oFeature.nodes)switch(oChild=oFeature.nodes[sCoreId],oChild.globalType){case emp.typeLibrary.types.FEATURE:if(oChild.featureId===sFeatureId)return oChild;if(oChild=emp.storage.findFeatureUnderFeature(oChild,sFeatureId))return oChild}},emp.storage.findFeatureUnderOverlay=function(oOverlay,sFeatureId){return emp.storage._storage.store[sFeatureId]},emp.storage.findFeature=function(sOverlayId,sFeatureId){return emp.storage._storage.store[sFeatureId]},emp.storage.findOverlay=function(sOverlayId){return emp.storage._storage.store[sOverlayId]},emp.storage.findObject=function(sCoreId){return emp.storage._storage.store[sCoreId]},emp.storage.storeObject=function(oEmpObject){emp.storage._storage.store[oEmpObject.getCoreId()]=oEmpObject},emp.storage.deleteObject=function(oEmpObject){emp.storage._storage.store.hasOwnProperty(oEmpObject.getCoreId())&&delete emp.storage._storage.store[oEmpObject.getCoreId()]},emp.storage.findParentOnMap=function(sMapInstanceId,oStorageEntry){var oParent,iParentIndex=0,iParentCnt=oStorageEntry.parentCount();for(oParent=oStorageEntry.getParentByIndex(iParentIndex);iParentIndex<iParentCnt;){if(oParent.isOnMap(sMapInstanceId))return oParent;iParentIndex++,oParent=oStorageEntry.getParentByIndex(iParentIndex)}},emp.storage.findParentOverlayOnMap=function(sMapInstanceId,oStorageEntry){for(var oParent,iParentIndex=0,iParentCnt=oStorageEntry.parentCount(),oEntry=oStorageEntry;iParentIndex<iParentCnt;)if(oParent=oEntry.getParentByIndex(iParentIndex),oParent.isOnMap(sMapInstanceId)){if(oParent.getCoreObjectType()===emp.typeLibrary.types.OVERLAY)return oParent;oEntry=oParent,iParentCnt=oEntry.parentCount(),iParentIndex=0}else iParentIndex++},emp.storage._replay={},emp.storage.MapReload=function(InstanceId){var _struct=[],mapInstanceId=InstanceId,iItemsSent=0,iItemsCompleted=0,iMaxItemsPerIteration=100,hReloadTimer=null,publicInterface={startFireTimer:function(){var oThis=this;setTimeout(function(){oThis.fire()},50)},structure:function(){var currentCoreId,oDupItem,oaLevels=[],iCurrentLevel=0,rootCoreId=emp.storage.getRootGuid(mapInstanceId),oRootOverlay=emp.storage.findObject(rootCoreId),oRootFeatureList=oRootOverlay.getChildrenList();oaLevels[iCurrentLevel]={overlays:[],features:[],wms:[]},oDupItem=oRootOverlay.getObjectData(mapInstanceId,void 0),oDupItem.parentCoreId=void 0,oaLevels[iCurrentLevel].overlays.push(oDupItem),iCurrentLevel++;var buildStructure=function(iLevel,oFeatureList){var oStorageEntry;oaLevels[iLevel]||(oaLevels[iLevel]={overlays:[],features:[],wms:[]});for(currentCoreId in oFeatureList)if(oFeatureList.hasOwnProperty(currentCoreId)&&(oStorageEntry=oFeatureList[currentCoreId],!oStorageEntry.isDisabled())){switch(oStorageEntry.getCoreObjectType()){case emp.typeLibrary.types.OVERLAY:break;case emp.typeLibrary.types.FEATURE:emp.helpers.canMapEnginePlotFeature(mapInstanceId,oStorageEntry)&&(oDupItem=oStorageEntry.getObjectData(mapInstanceId,rootCoreId),oDupItem.parentCoreId=rootCoreId,oaLevels[iLevel].features.push(oDupItem));break;case emp.typeLibrary.types.WMS:if(emp.helpers.canMapEnginePlotFeature(mapInstanceId,oStorageEntry)){var sWMSParentID=rootCoreId,oWMSParent=oStorageEntry.getParentByIndex(0),sWMSOverlayId=emp.wms.manager.getWmsOverlayId(mapInstanceId);sWMSOverlayId===oWMSParent.getCoreId()&&(sWMSParentID=sWMSOverlayId),oDupItem=oStorageEntry.getObjectData(mapInstanceId,sWMSParentID),oDupItem.parentCoreId=rootCoreId,oaLevels[iLevel].wms.push(oDupItem)}}buildStructure(iLevel+1,oStorageEntry.getChildrenList())}0===oaLevels[iLevel].overlays.length&&0===oaLevels[iLevel].features.length&&0===oaLevels[iLevel].wms.length&&oaLevels.splice(iLevel,1)};buildStructure(iCurrentLevel,oRootFeatureList),_struct=oaLevels},fire:function(){var oTransaction,oFeatures,oItem,sCurrentType,data=_struct,itemCount=0,sPreviousType="",sTransID=emp.helpers.id.newGUID(),rootId=emp.storage.getRootGuid(mapInstanceId),oThis=this;if(void 0===data||null===data||0===data.length)return void(iItemsSent===iItemsCompleted?(clearTimeout(hReloadTimer),this.stop()):hReloadTimer=setTimeout(function(){oThis.fire()},100));for(var i=0;i<data.length;){var oOverlays=[],wmsServices=[];for(oFeatures=[];(data[i].overlays.length>0||data[i].features.length>0||data[i].wms.length>0)&&itemCount<iMaxItemsPerIteration&&(data[i].overlays.length>0?(oItem=data[i].overlays[0],sCurrentType=emp.typeLibrary.types.OVERLAY):data[i].features.length>0?(oItem=data[i].features[0],sCurrentType=emp.typeLibrary.types.FEATURE):(oItem=data[i].wms[0],sCurrentType=emp.typeLibrary.types.WMS),""===sPreviousType||sPreviousType===sCurrentType);)switch(sPreviousType=sCurrentType,itemCount++,sCurrentType){case emp.typeLibrary.types.FEATURE:oItem.zoom=!1,oFeatures.push(oItem),oItem.parentCoreId=rootId,data[i].features.splice(0,1);break;case emp.typeLibrary.types.OVERLAY:oOverlays.push(oItem),data[i].overlays.splice(0,1);break;case emp.typeLibrary.types.WMS:wmsServices.push(oItem),data[i].wms.splice(0,1)}if(oOverlays.length>0&&(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_OVERLAY_ADD,mapInstanceId:mapInstanceId,source:emp.core.sources.STORAGE,transactionId:sTransID,items:oOverlays}),iItemsSent+=oOverlays.length,oTransaction.run()),oFeatures.length>0&&(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_FEATURE_ADD,mapInstanceId:mapInstanceId,source:emp.core.sources.STORAGE,transactionId:sTransID,items:oFeatures}),iItemsSent+=oFeatures.length,oTransaction.run()),wmsServices.length>0&&(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MI_WMS_ADD,mapInstanceId:mapInstanceId,source:emp.core.sources.STORAGE,transactionId:sTransID,items:wmsServices}),iItemsSent+=wmsServices.length,oTransaction.run()),0!==data[i].overlays.length||0!==data[i].features.length||0!==data[i].wms.length||(data.splice(i,1),0!==itemCount))break;iItemsSent===iItemsCompleted&&i>=data.length&&(clearTimeout(hReloadTimer),this.stop())}},start:function(){iItemsCompleted=0,iItemsSent=0,emp.transactionQueue.listener.add({type:emp.intents.control.MI_OVERLAY_ADD,mapInstanceId:mapInstanceId,callback:emp.storage.processTransactionComplete}),emp.transactionQueue.listener.add({type:emp.intents.control.MI_FEATURE_ADD,mapInstanceId:mapInstanceId,callback:emp.storage.processTransactionComplete}),emp.transactionQueue.listener.add({type:emp.intents.control.MI_WMS_ADD,mapInstanceId:mapInstanceId,callback:emp.storage.processTransactionComplete})},stop:function(){emp.transactionQueue.listener.remove({type:emp.intents.control.MI_OVERLAY_ADD,mapInstanceId:mapInstanceId,callback:emp.storage.processTransactionComplete}),emp.transactionQueue.listener.remove({type:emp.intents.control.MI_FEATURE_ADD,mapInstanceId:mapInstanceId,callback:emp.storage.processTransactionComplete}),emp.transactionQueue.listener.remove({type:emp.intents.control.MI_WMS_ADD,mapInstanceId:mapInstanceId,callback:emp.storage.processTransactionComplete});var oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.STORAGE_RELOAD_COMPLETE,mapInstanceId:mapInstanceId,source:emp.core.sources.STORAGE,items:[]});oTransaction.run(),delete emp.storage._replay[mapInstanceId]},processTransactionComplete:function(oTransaction){var oErrorInfo,oStorageEntry,oThis=this;switch(oTransaction.intent){case emp.intents.control.MI_FEATURE_ADD:case emp.intents.control.MI_OVERLAY_ADD:case emp.intents.control.MI_WMS_ADD:if(clearTimeout(hReloadTimer),void 0!==oTransaction.failures&&null!==oTransaction.failures&&oTransaction.failures.length>0)for(;oTransaction.failures.length>0;)oErrorInfo=oTransaction.failures.splice(0,1)[0],oErrorInfo.coreId&&(oStorageEntry=emp.storage.get.id({id:oErrorInfo.coreId}),oStorageEntry.setDisabled(!0),iItemsCompleted++);iItemsCompleted+=oTransaction.items.length,iItemsSent===iItemsCompleted&&(hReloadTimer=setTimeout(function(){oThis.fire()},100))}}};return publicInterface},emp.storage.processTransactionComplete=function(oTransaction){emp.storage._replay.hasOwnProperty(oTransaction.mapInstanceId)&&emp.storage._replay[oTransaction.mapInstanceId].processTransactionComplete(oTransaction)},emp.storage.reload=function(instanceId){emp.storage._replay.hasOwnProperty(instanceId)||(emp.storage._replay[instanceId]=new emp.storage.MapReload(instanceId)),emp.storage._replay[instanceId].start(),emp.storage._replay[instanceId].structure(),emp.storage._replay[instanceId].startFireTimer()},emp.storage._dropStaticContent=function(oStorageEntry){var oChildEntry,iIndex,aChildCoreIdList=oStorageEntry.getChildrenCoreIds();for(iIndex=0;iIndex<aChildCoreIdList.length;iIndex++)oChildEntry=emp.storage.findObject(aChildCoreIdList[iIndex]),oChildEntry&&(emp.storage._dropStaticContent(oChildEntry),oChildEntry.getCoreObjectType()===emp.typeLibrary.types.STATIC&&(oChildEntry.removeFromAllParent(),emp.storage.deleteObject(oChildEntry)))},emp.storage.prepForMapSwap=function(instanceId){var oStore=emp.storage._storage.store,oStorageEntry=oStore[emp.storage.getRootGuid(instanceId)];emp.storage._dropStaticContent(oStorageEntry)},emp.editors=emp.editors||{},emp.editors.Vertex=function(feature,type){if(!feature)throw new Error("Missing parameter: feature");if(!type)throw new Error("Missing parameter: type");this.feature=feature,this.type=type,this.next=null,this.before=null},emp.editors=emp.editors||{},emp.editors.Vertices=function(){this.head=null,this.tail=null,this.list=[],this.length=0},emp.editors.Vertices.prototype.push=function(vertex){vertex.feature&&vertex.type&&(null===this.head&&(this.head=vertex,vertex.before=null),null===this.tail?(this.tail=vertex,vertex.next=null):(vertex.before=this.tail,this.tail.next=vertex,vertex.next=null,this.tail=vertex),this.list[vertex.feature.featureId]=vertex,this.length++)},emp.editors.Vertices.prototype.toString=function(){var result="",current=this.head;for(result="[";null!==current;)result+=current.feature.featureId+" ("+current.type+")",current=current.next,null!==current&&(result+=" => ");return result+="]"},emp.editors.Vertices.prototype.insert=function(featureId,vertex){var target=this.find(featureId);target&&(vertex.before=target.before,vertex.next=target,null===target.before?(target.before=vertex,this.head=vertex):(target.before.next=vertex,target.before=vertex),this.list[vertex.feature.featureId]=vertex,this.length++)},emp.editors.Vertices.prototype.append=function(featureId,vertex){var target=this.find(featureId);target&&(vertex.next=target.next,vertex.before=target,null===target.next?(target.next=vertex,this.tail=vertex):(target.next.before=vertex,target.next=vertex),this.list[vertex.feature.featureId]=vertex,this.length++)},emp.editors.Vertices.prototype.find=function(featureId){return this.list[featureId]},emp.editors.Vertices.prototype.findFeature=function(featureId){return this.list[featureId].feature},emp.editors.Vertices.prototype.getFeatures=function(){var id,vertex,result=[];for(id in this.list)vertex=this.list[id],result.push(vertex.feature);return result},emp.editors.Vertices.prototype.getVerticesAsLineString=function(){var currentVertex,coordinates=[];for(currentVertex=this.head;null!==currentVertex;)"vertex"===currentVertex.type&&coordinates.push(currentVertex.feature.data.coordinates),currentVertex=currentVertex.next;return coordinates},emp.editors.Vertices.prototype.clear=function(){this.head=null,this.tail=null,this.list=[],this.length=0},emp.editors.Vertices.prototype.getIndex=function(featureId){for(var index=0,currentVertex=this.head;currentVertex.feature.featureId!==featureId&&null!==currentVertex;)currentVertex=currentVertex.next,"vertex"===currentVertex.type&&index++;return null===currentVertex&&(index=-1),index},emp.editors=emp.editors||{},emp.editors.EditorBase=function(args){this.vertices=new emp.editors.Vertices,this.featureCopy=emp.helpers.copyObject(args.feature),this.mapInstance=args.mapInstance;
},emp.editors.EditorBase.prototype.addControlPoints=function(){},emp.editors.EditorBase.prototype.removeControlPoints=function(){},emp.editors.EditorBase.prototype.isControlPoint=function(featureId){var result=!1;return this.vertices.find(featureId)&&(result=!0),result},emp.editors.EditorBase.prototype.isFeature=function(featureId){var result=!1;return this.featureCopy.featureId===featureId&&(result=!0),result},emp.editors.EditorBase.prototype.moveControlPoint=function(featureId,pointer){var index,newCoordinates,coordinateUpdate,updateData,newFeature=this.vertices.findFeature(featureId);newFeature.data.coordinates=[pointer.lon,pointer.lat];var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[newFeature]});transaction.run(),index=this.vertices.getIndex(featureId),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.EditorBase.prototype.startMoveControlPoint=function(featureId,pointer){var index,newCoordinates,coordinateUpdate,updateData,newFeature=this.vertices.findFeature(featureId);newFeature.data.coordinates=[pointer.lon,pointer.lat];var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[newFeature]});transaction.run(),index=this.vertices.getIndex(featureId),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.EditorBase.prototype.endMoveControlPoint=function(featureId,pointer){var index,newCoordinates,coordinateUpdate,updateData,newFeature=this.vertices.findFeature(featureId);newFeature.data.coordinates=[pointer.lon,pointer.lat];var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[newFeature]});transaction.run(),index=this.vertices.getIndex(featureId),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.EditorBase.prototype.moveFeature=function(startX,startY,pointer){var transaction,item;"Point"===this.featureCopy.data.type&&(this.featureCopy.data.coordinates=[pointer.lon,pointer.lat],item=new emp.typeLibrary.Feature({overlayId:this.featureCopy.overlayId,featureId:this.featureCopy.featureId,format:this.featureCopy.format,data:this.featureCopy.data,properties:this.featureCopy.properties}),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[item]}),transaction.run())},emp.editors=emp.editors||{},emp.editors.Point=function(args){emp.editors.EditorBase.call(this,args)},emp.editors.Point.prototype=Object.create(emp.editors.EditorBase.prototype),emp.editors.Point.prototype.constructor=emp.editors.Point,emp.editors.Point.prototype.addControlPoints=function(){},emp.editors.Point.prototype.removeControlPoints=function(){},emp.editors.Point.prototype.isControlPoint=function(){return!1},emp.editors.Point.prototype.moveControlPoint=function(){},emp.editors.Point.prototype.moveFeature=function(startX,startY,pointer){var transaction,item,coordinateUpdate,oldCoordinates,newCoordinates,altitude,updateData={};return oldCoordinates=this.featureCopy.data.coordinates,oldCoordinates.length>2?(altitude=oldCoordinates[2],this.featureCopy.data.coordinates=[pointer.lon,pointer.lat,altitude],newCoordinates=[{lat:pointer.lat,lon:pointer.lon,alt:altitude}]):(this.featureCopy.data.coordinates=[pointer.lon,pointer.lat],newCoordinates=[{lat:pointer.lat,lon:pointer.lon}]),item=new emp.typeLibrary.Feature({overlayId:this.featureCopy.overlayId,featureId:this.featureCopy.featureId,format:this.featureCopy.format,data:this.featureCopy.data,properties:this.featureCopy.properties}),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[item]}),transaction.run(),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[0],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors=emp.editors||{},emp.editors.Path=function(args){this.animation=void 0,emp.editors.EditorBase.call(this,args),this.calculateAddPoints=function(){}},emp.editors.Path.prototype=Object.create(emp.editors.EditorBase.prototype),emp.editors.Path.prototype.constructor=emp.editors.Path,emp.editors.Path.prototype.addControlPoints=function(){var i,controlPoint,transaction,length,coordinates,midpoint,vertex,addPoint,items=[];if("LineString"===this.featureCopy.data.type){for(length=this.featureCopy.data.coordinates.length,coordinates=this.featureCopy.data.coordinates,i=0;i<length;i++)if(controlPoint=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:coordinates[i],type:"Point"},properties:{iconUrl:emp.ui.images.editPoint,iconXOffset:12,iconYOffset:12,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),vertex=new emp.editors.Vertex(controlPoint,"vertex"),this.vertices.push(vertex),items.push(controlPoint),i<length-1){var pt1=new LatLon(coordinates[i][1],coordinates[i][0]),pt2=new LatLon(coordinates[i+1][1],coordinates[i+1][0]),pt3=pt1.midpointTo(pt2);midpoint=[pt3.lon(),pt3.lat()],addPoint=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),items.push(addPoint),vertex=new emp.editors.Vertex(addPoint,"add"),this.vertices.push(vertex)}this.featureCopy.data.coordinates=this.vertices.getVerticesAsLineString(),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items}),transaction.run()}},emp.editors.Path.prototype.removeControlPoints=function(){var transaction,items,vertices=this.vertices.getFeatures();items=vertices,transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:items}),this.vertices.clear(),transaction.run()},emp.editors.Path.prototype.isControlPoint=function(featureId){var result=!1;return this.vertices.find(featureId)&&(result=!0),result},emp.editors.Path.prototype.startMoveControlPoint=function(featureId,pointer){var currentFeature,currentVertex,front,back,backFeature,frontFeature,newBackFeature,newFrontFeature,pt1,pt2,pt3,midpoint,index,coordinateUpdate,newCoordinates,items=[],updateData={},type=emp.typeLibrary.CoordinateUpdateType.UPDATE,animationCoordinates=[];currentVertex=this.vertices.find(featureId),currentVertex&&(currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],"add"===currentVertex.type&&(type=emp.typeLibrary.CoordinateUpdateType.ADD,currentVertex.type="vertex",currentFeature=currentVertex.feature,currentFeature.properties.iconUrl=emp.ui.images.editPoint,backFeature=currentVertex.before.feature,pt1=new LatLon(backFeature.data.coordinates[1],backFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],newBackFeature=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),frontFeature=currentVertex.next.feature,pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(frontFeature.data.coordinates[1],frontFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],newFrontFeature=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),front=new emp.editors.Vertex(newFrontFeature,"add"),back=new emp.editors.Vertex(newBackFeature,"add"),this.vertices.insert(currentFeature.featureId,back),this.vertices.append(currentFeature.featureId,front),items.push(newFrontFeature),items.push(newBackFeature)),items.push(currentFeature)),null!==currentVertex.before&&animationCoordinates.push(currentVertex.before.before.feature.data.coordinates),animationCoordinates.push(currentFeature.data.coordinates),null!==currentVertex.next&&animationCoordinates.push(currentVertex.next.next.feature.data.coordinates),this.animation=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_PATH,data:{coordinates:animationCoordinates,type:"LineString"},properties:{lineColor:"FFFFFF00"}}),items.push(this.animation);var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items});transaction.run(),index=this.vertices.getIndex(featureId),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return coordinateUpdate={type:type,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.Path.prototype.moveControlPoint=function(featureId,pointer){var currentFeature,currentVertex,back,front,backFeature,frontFeature,nextFrontVertexFeature,nextBackVertexFeature,pt1,pt2,pt3,midpoint,newCoordinates,coordinateUpdate,index,items=[],updateData={},animationCoordinates=[];currentVertex=this.vertices.find(featureId),currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],items.push(currentFeature),back=currentVertex.before,front=currentVertex.next,null!==back&&(backFeature=back.feature,nextBackVertexFeature=back.before.feature,pt1=new LatLon(nextBackVertexFeature.data.coordinates[1],nextBackVertexFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],backFeature.data.coordinates=midpoint,items.push(backFeature)),null!==front&&(frontFeature=front.feature,nextFrontVertexFeature=front.next.feature,pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(nextFrontVertexFeature.data.coordinates[1],nextFrontVertexFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],frontFeature.data.coordinates=midpoint,items.push(frontFeature)),this.featureCopy.data.coordinates=this.vertices.getVerticesAsLineString(),null!==currentVertex.before&&animationCoordinates.push(currentVertex.before.before.feature.data.coordinates),animationCoordinates.push(currentFeature.data.coordinates),null!==currentVertex.next&&animationCoordinates.push(currentVertex.next.next.feature.data.coordinates),this.animation.data.coordinates=animationCoordinates,items.push(this.animation);var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items});transaction.run(),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return index=this.vertices.getIndex(featureId),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.Path.prototype.endMoveControlPoint=function(featureId,pointer){var newCoordinates,coordinateUpdate,index,addTransaction,removeTransaction,currentVertex,currentFeature,back,front,backFeature,nextBackVertexFeature,frontFeature,nextFrontVertexFeature,pt1,pt2,pt3,midpoint,items=[],updateData={};currentVertex=this.vertices.find(featureId),currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],this.featureCopy.data.coordinates=this.vertices.getVerticesAsLineString(),items.push(this.featureCopy),back=currentVertex.before,front=currentVertex.next,null!==back&&(backFeature=back.feature,nextBackVertexFeature=back.before.feature,pt1=new LatLon(nextBackVertexFeature.data.coordinates[1],nextBackVertexFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],backFeature.data.coordinates=midpoint,items.push(backFeature)),null!==front&&(frontFeature=front.feature,nextFrontVertexFeature=front.next.feature,pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(nextFrontVertexFeature.data.coordinates[1],nextFrontVertexFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],frontFeature.data.coordinates=midpoint,items.push(frontFeature)),addTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items}),removeTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:[this.animation]}),addTransaction.run(),removeTransaction.run(),this.animation=void 0,newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return index=this.vertices.getIndex(featureId),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.Path.prototype.moveFeature=function(){},emp.editors=emp.editors||{},emp.editors.Polygon=function(args){this.animation=void 0,emp.editors.EditorBase.call(this,args)},emp.editors.Polygon.prototype=Object.create(emp.editors.EditorBase.prototype),emp.editors.Polygon.prototype.constructor=emp.editors.Polygon,emp.editors.Polygon.prototype.addControlPoints=function(){var i,controlPoint,transaction,length,coordinates,midpoint,vertex,addPoint,pt1,pt2,pt3,items=[];if("Polygon"===this.featureCopy.data.type){for(length=this.featureCopy.data.coordinates[0].length,coordinates=this.featureCopy.data.coordinates,i=0;i<length;i++)controlPoint=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:coordinates[0][i],type:"Point"},properties:{iconUrl:emp.ui.images.editPoint,iconXOffset:12,iconYOffset:12,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),vertex=new emp.editors.Vertex(controlPoint,"vertex"),this.vertices.push(vertex),items.push(controlPoint),i<length-1?(pt1=new LatLon(coordinates[0][i][1],coordinates[0][i][0]),pt2=new LatLon(coordinates[0][i+1][1],coordinates[0][i+1][0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()]):i===length-1&&(pt1=new LatLon(coordinates[0][i][1],coordinates[0][i][0]),pt2=new LatLon(coordinates[0][0][1],coordinates[0][0][0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()]),addPoint=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),items.push(addPoint),vertex=new emp.editors.Vertex(addPoint,"add"),this.vertices.push(vertex);this.featureCopy.data.coordinates=[this.vertices.getVerticesAsLineString()],transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items}),transaction.run()}},emp.editors.Polygon.prototype.removeControlPoints=function(){var transaction,items,vertices=this.vertices.getFeatures();items=vertices,transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:items}),this.vertices.clear(),transaction.run()},emp.editors.Polygon.prototype.startMoveControlPoint=function(featureId,pointer){var currentFeature,currentVertex,front,back,backFeature,frontFeature,newBackFeature,newFrontFeature,pt1,pt2,pt3,midpoint,index,coordinateUpdate,newCoordinates,items=[],updateData={},type=emp.typeLibrary.CoordinateUpdateType.UPDATE,animationCoordinates=[];currentVertex=this.vertices.find(featureId),currentVertex&&(currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],"add"===currentVertex.type&&(type=emp.typeLibrary.CoordinateUpdateType.ADD,currentVertex.type="vertex",currentFeature=currentVertex.feature,currentFeature.properties.iconUrl=emp.ui.images.editPoint,backFeature=currentVertex.before.feature,pt1=new LatLon(backFeature.data.coordinates[1],backFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],newBackFeature=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),frontFeature=null===currentVertex.next?this.vertices.head.feature:currentVertex.next.feature,pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(frontFeature.data.coordinates[1],frontFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],newFrontFeature=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),front=new emp.editors.Vertex(newFrontFeature,"add"),back=new emp.editors.Vertex(newBackFeature,"add"),this.vertices.insert(currentFeature.featureId,back),this.vertices.append(currentFeature.featureId,front),items.push(newFrontFeature),items.push(newBackFeature)),items.push(currentFeature)),null===currentVertex.before?animationCoordinates.push(this.vertices.tail.before.feature.data.coordinates):animationCoordinates.push(currentVertex.before.before.feature.data.coordinates),animationCoordinates.push(currentFeature.data.coordinates),null===currentVertex.next.next?animationCoordinates.push(this.vertices.head.feature.data.coordinates):animationCoordinates.push(currentVertex.next.next.feature.data.coordinates),this.animation=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_PATH,data:{coordinates:animationCoordinates,type:"LineString"},properties:{lineColor:"FFFFFF00"}}),items.push(this.animation);var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items});transaction.run(),index=this.vertices.getIndex(featureId),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates[0].length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[0][i][1],lon:this.featureCopy.data.coordinates[0][i][0]});return coordinateUpdate={type:type,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.Polygon.prototype.moveControlPoint=function(featureId,pointer){var currentFeature,currentVertex,back,front,backFeature,frontFeature,nextFrontVertexFeature,nextBackVertexFeature,pt1,pt2,pt3,midpoint,newCoordinates,coordinateUpdate,index,items=[],updateData={},animationCoordinates=[];currentVertex=this.vertices.find(featureId),currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],items.push(currentFeature),back=currentVertex.before,front=currentVertex.next,null===back?(backFeature=this.vertices.tail.feature,nextBackVertexFeature=this.vertices.tail.before.feature):(backFeature=back.feature,nextBackVertexFeature=back.before.feature),pt1=new LatLon(nextBackVertexFeature.data.coordinates[1],nextBackVertexFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],backFeature.data.coordinates=midpoint,items.push(backFeature),null===front.next?(frontFeature=front.feature,nextFrontVertexFeature=this.vertices.head.feature):(frontFeature=front.feature,nextFrontVertexFeature=front.next.feature),pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(nextFrontVertexFeature.data.coordinates[1],nextFrontVertexFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],frontFeature.data.coordinates=midpoint,items.push(frontFeature),this.featureCopy.data.coordinates=[this.vertices.getVerticesAsLineString()],null===currentVertex.before?animationCoordinates.push(this.vertices.tail.before.feature.data.coordinates):animationCoordinates.push(currentVertex.before.before.feature.data.coordinates),animationCoordinates.push(currentFeature.data.coordinates),null===currentVertex.next.next?animationCoordinates.push(this.vertices.head.feature.data.coordinates):animationCoordinates.push(currentVertex.next.next.feature.data.coordinates),this.animation.data.coordinates=animationCoordinates,items.push(this.animation);var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items});transaction.run(),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates[0].length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[0][i][1],lon:this.featureCopy.data.coordinates[0][i][0]});return index=this.vertices.getIndex(featureId),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.Polygon.prototype.endMoveControlPoint=function(featureId,pointer){var newCoordinates,coordinateUpdate,index,addTransaction,removeTransaction,currentVertex,currentFeature,back,front,backFeature,nextBackVertexFeature,frontFeature,nextFrontVertexFeature,pt1,pt2,pt3,midpoint,items=[],updateData={};currentVertex=this.vertices.find(featureId),currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],this.featureCopy.data.coordinates=[this.vertices.getVerticesAsLineString()];var copy=emp.helpers.copyObject(this.featureCopy);items.push(copy),back=currentVertex.before,front=currentVertex.next,null===back?(backFeature=this.vertices.tail.feature,nextBackVertexFeature=this.vertices.tail.before.feature):(backFeature=back.feature,nextBackVertexFeature=back.before.feature),pt1=new LatLon(nextBackVertexFeature.data.coordinates[1],nextBackVertexFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],backFeature.data.coordinates=midpoint,items.push(backFeature),null===front.next?(frontFeature=front.feature,nextFrontVertexFeature=this.vertices.head.feature):(frontFeature=front.feature,nextFrontVertexFeature=front.next.feature),pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(nextFrontVertexFeature.data.coordinates[1],nextFrontVertexFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],frontFeature.data.coordinates=midpoint,items.push(frontFeature),addTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items}),removeTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:[this.animation]}),addTransaction.run(),removeTransaction.run(),this.animation=void 0,newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates[0].length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[0][i][1],lon:this.featureCopy.data.coordinates[0][i][0]});return index=this.vertices.getIndex(featureId),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.Polygon.prototype.moveFeature=function(){},emp.editors=emp.editors||{},emp.editors.MilStdPolygon=function(args){this.animation=void 0,emp.editors.EditorBase.call(this,args)},emp.editors.MilStdPolygon.prototype=Object.create(emp.editors.EditorBase.prototype),emp.editors.MilStdPolygon.prototype.constructor=emp.editors.MilStdPolygon,emp.editors.MilStdPolygon.prototype.addControlPoints=function(){var i,controlPoint,transaction,length,coordinates,midpoint,vertex,addPoint,pt1,pt2,pt3,items=[];if("LineString"===this.featureCopy.data.type){for(length=this.featureCopy.data.coordinates.length,coordinates=this.featureCopy.data.coordinates,i=0;i<length;i++)controlPoint=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:coordinates[i],type:"Point"},properties:{iconUrl:emp.ui.images.editPoint,iconXOffset:12,iconYOffset:12,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),vertex=new emp.editors.Vertex(controlPoint,"vertex"),this.vertices.push(vertex),items.push(controlPoint),i<length-1?(pt1=new LatLon(coordinates[i][1],coordinates[i][0]),pt2=new LatLon(coordinates[i+1][1],coordinates[i+1][0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()]):i===length-1&&(pt1=new LatLon(coordinates[i][1],coordinates[i][0]),pt2=new LatLon(coordinates[0][1],coordinates[0][0]),
pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()]),addPoint=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),items.push(addPoint),vertex=new emp.editors.Vertex(addPoint,"add"),this.vertices.push(vertex);this.featureCopy.data.coordinates=this.vertices.getVerticesAsLineString(),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items}),transaction.run()}},emp.editors.MilStdPolygon.prototype.removeControlPoints=function(){var transaction,items,vertices=this.vertices.getFeatures();items=vertices,transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:items}),this.vertices.clear(),transaction.run()},emp.editors.MilStdPolygon.prototype.startMoveControlPoint=function(featureId,pointer){var currentFeature,currentVertex,front,back,backFeature,frontFeature,newBackFeature,newFrontFeature,pt1,pt2,pt3,midpoint,index,coordinateUpdate,newCoordinates,items=[],updateData={},type=emp.typeLibrary.CoordinateUpdateType.UPDATE,animationCoordinates=[];currentVertex=this.vertices.find(featureId),currentVertex&&(currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],"add"===currentVertex.type&&(type=emp.typeLibrary.CoordinateUpdateType.ADD,currentVertex.type="vertex",currentFeature=currentVertex.feature,currentFeature.properties.iconUrl=emp.ui.images.editPoint,backFeature=currentVertex.before.feature,pt1=new LatLon(backFeature.data.coordinates[1],backFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],newBackFeature=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),frontFeature=null===currentVertex.next?this.vertices.head.feature:currentVertex.next.feature,pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(frontFeature.data.coordinates[1],frontFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],newFrontFeature=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_POINT,data:{coordinates:midpoint,type:"Point"},properties:{iconUrl:emp.ui.images.addPoint,iconXOffset:8,iconYOffset:8,xUnits:"pixels",yUnits:"pixels",altitudeMode:cmapi.enums.altitudeMode.CLAMP_TO_GROUND}}),front=new emp.editors.Vertex(newFrontFeature,"add"),back=new emp.editors.Vertex(newBackFeature,"add"),this.vertices.insert(currentFeature.featureId,back),this.vertices.append(currentFeature.featureId,front),items.push(newFrontFeature),items.push(newBackFeature)),items.push(currentFeature)),null===currentVertex.before?animationCoordinates.push(this.vertices.tail.before.feature.data.coordinates):animationCoordinates.push(currentVertex.before.before.feature.data.coordinates),animationCoordinates.push(currentFeature.data.coordinates),null===currentVertex.next.next?animationCoordinates.push(this.vertices.head.feature.data.coordinates):animationCoordinates.push(currentVertex.next.next.feature.data.coordinates),this.animation=new emp.typeLibrary.Feature({overlayId:"vertices",featureId:emp3.api.createGUID(),format:emp3.api.enums.FeatureTypeEnum.GEO_PATH,data:{coordinates:animationCoordinates,type:"LineString"},properties:{lineColor:"FFFFFF00"}}),items.push(this.animation);var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items});transaction.run(),index=this.vertices.getIndex(featureId),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return coordinateUpdate={type:type,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.MilStdPolygon.prototype.moveControlPoint=function(featureId,pointer){var currentFeature,currentVertex,back,front,backFeature,frontFeature,nextFrontVertexFeature,nextBackVertexFeature,pt1,pt2,pt3,midpoint,newCoordinates,coordinateUpdate,index,items=[],updateData={},animationCoordinates=[];currentVertex=this.vertices.find(featureId),currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],items.push(currentFeature),back=currentVertex.before,front=currentVertex.next,null===back?(backFeature=this.vertices.tail.feature,nextBackVertexFeature=this.vertices.tail.before.feature):(backFeature=back.feature,nextBackVertexFeature=back.before.feature),pt1=new LatLon(nextBackVertexFeature.data.coordinates[1],nextBackVertexFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],backFeature.data.coordinates=midpoint,items.push(backFeature),null===front.next?(frontFeature=front.feature,nextFrontVertexFeature=this.vertices.head.feature):(frontFeature=front.feature,nextFrontVertexFeature=front.next.feature),pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(nextFrontVertexFeature.data.coordinates[1],nextFrontVertexFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],frontFeature.data.coordinates=midpoint,items.push(frontFeature),this.featureCopy.data.coordinates=this.vertices.getVerticesAsLineString(),null===currentVertex.before?animationCoordinates.push(this.vertices.tail.before.feature.data.coordinates):animationCoordinates.push(currentVertex.before.before.feature.data.coordinates),animationCoordinates.push(currentFeature.data.coordinates),null===currentVertex.next.next?animationCoordinates.push(this.vertices.head.feature.data.coordinates):animationCoordinates.push(currentVertex.next.next.feature.data.coordinates),this.animation.data.coordinates=animationCoordinates,items.push(this.animation);var transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items});transaction.run(),newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return index=this.vertices.getIndex(featureId),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.MilStdPolygon.prototype.endMoveControlPoint=function(featureId,pointer){var newCoordinates,coordinateUpdate,index,addTransaction,removeTransaction,currentVertex,currentFeature,back,front,backFeature,nextBackVertexFeature,frontFeature,nextFrontVertexFeature,pt1,pt2,pt3,midpoint,items=[],updateData={};currentVertex=this.vertices.find(featureId),currentFeature=currentVertex.feature,currentFeature.data.coordinates=[pointer.lon,pointer.lat],this.featureCopy.data.coordinates=this.vertices.getVerticesAsLineString();var copy=emp.helpers.copyObject(this.featureCopy);items.push(copy),back=currentVertex.before,front=currentVertex.next,null===back?(backFeature=this.vertices.tail.feature,nextBackVertexFeature=this.vertices.tail.before.feature):(backFeature=back.feature,nextBackVertexFeature=back.before.feature),pt1=new LatLon(nextBackVertexFeature.data.coordinates[1],nextBackVertexFeature.data.coordinates[0]),pt2=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],backFeature.data.coordinates=midpoint,items.push(backFeature),null===front.next?(frontFeature=front.feature,nextFrontVertexFeature=this.vertices.head.feature):(frontFeature=front.feature,nextFrontVertexFeature=front.next.feature),pt1=new LatLon(currentFeature.data.coordinates[1],currentFeature.data.coordinates[0]),pt2=new LatLon(nextFrontVertexFeature.data.coordinates[1],nextFrontVertexFeature.data.coordinates[0]),pt3=pt1.midpointTo(pt2),midpoint=[pt3.lon(),pt3.lat()],frontFeature.data.coordinates=midpoint,items.push(frontFeature),addTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:items}),removeTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:this.mapInstance.mapInstanceId,transactionId:null,sender:this.mapInstance.mapInstanceId,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,messageOriginator:this.mapInstance.mapInstanceId,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:[this.animation]}),addTransaction.run(),removeTransaction.run(),this.animation=void 0,newCoordinates=[];for(var i=0;i<this.featureCopy.data.coordinates.length;i++)newCoordinates.push({lat:this.featureCopy.data.coordinates[i][1],lon:this.featureCopy.data.coordinates[i][0]});return index=this.vertices.getIndex(featureId),coordinateUpdate={type:emp.typeLibrary.CoordinateUpdateType.UPDATE,indices:[index],coordinates:newCoordinates},updateData.coordinateUpdate=coordinateUpdate,updateData.properties=this.featureCopy.properties,updateData},emp.editors.MilStdPolygon.prototype.moveFeature=function(){};var OWF=OWF||{};emp.environment.owf=function(){function loadScript(args){var script=document.createElement("script");script.type="text/javascript",script.readyState?script.onreadystatechange=function(){script.intervalCount=50,script.timer=setInterval(function(){"loaded"===script.readyState||"complete"===script.readyState?void 0===window[args.objectToLoad]?(script.intervalCount--,0===script.intervalCount&&(clearInterval(script.timer),args.failedcallback())):(clearInterval(script.timer),args.callback()):(script.intervalCount--,0===script.intervalCount&&(clearInterval(script.timer),args.failedcallback()))},100),script.onreadystatechange=null}:(script.onerror=function(){args.failedcallback()},script.onload=function(){void 0===window[args.objectToLoad]?args.failedcallback():args.callback()}),script.src=args.url,document.getElementsByTagName("head")[0].appendChild(script)}function checkSender(sender){if("string"==typeof sender)try{sender=JSON.parse(sender)}catch(err){sender={id:emp.helpers.id.newGUID()},emp.typeLibrary.Error({message:"Sender was a string for the OWF widget intent, but it was not valid JSON. A default sender object with a random ID was generated."})}return sender}function plotIntentKml(sender,intent,data){var oItem,cmap,transaction,payload={};sender=checkSender(sender),data.hasOwnProperty("common_map")&&(cmap=data.common_map,cmap.hasOwnProperty("overlayId")?payload.overlayId=cmap.overlayId:payload.overlayId=sender.id,cmap.hasOwnProperty("featureId")?payload.featureId=cmap.featureId:payload.featureId=emp.helpers.id.newGUID(),cmap.hasOwnProperty("name")&&(payload.name=cmap.name),cmap.hasOwnProperty("zoom")&&(payload.zoom=cmap.zoom),payload.feature=data.data,payload.format="kml",oItem=new emp.typeLibrary.Feature(payload),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,transactionId:"",sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,originalMessage:payload,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[oItem]}),transaction.queue())}function loadIntentKml(sender,intent,data){var item,cmap,transaction,i,len,payload={},items=[];for(sender=checkSender(sender),len=data.data.length,i=0;i<len;i++)payload.url=data.data[i],payload.format="kml",payload.visible=!0,payload.save=!1,payload.params={},payload.transactionId=emp.helpers.id.newGUID(),cmap=data.hasOwnProperty("common_map")?data.common_map:{},cmap.hasOwnProperty("overlayId")?payload.overlayId=cmap.overlayId:payload.overlayId=sender.id,cmap.hasOwnProperty("featureId")?payload.featureId=cmap.featureId:payload.featureId=emp.helpers.id.newGUID(),cmap.hasOwnProperty("name")?payload.name=cmap.name:payload.name="Untitled",cmap.hasOwnProperty("zoom")&&(payload.zoom=cmap.zoom),item=new emp.typeLibrary.Feature(payload),items.push(item);transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,transactionId:payload.transactionId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT_URL,source:emp.api.cmapi.SOURCE,originalMessage:payload,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT_URL,items:items}),transaction.queue()}function plotIntentJson(sender,intent,data){var oItem,cmap,transaction,payload={};sender=checkSender(sender),data.hasOwnProperty("common_map")&&(cmap=data.common_map,cmap.hasOwnProperty("overlayId")?payload.overlayId=cmap.overlayId:payload.overlayId=sender.id,cmap.hasOwnProperty("featureId")?payload.featureId=cmap.featureId:payload.featureId=emp.helpers.id.newGUID(),cmap.hasOwnProperty("name")?payload.name=cmap.name:payload.name="Untitled",cmap.hasOwnProperty("zoom")&&(payload.zoom=cmap.zoom),payload.feature=data.data,payload.format="geojson",oItem=new emp.typeLibrary.Feature(payload),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,transactionId:"",sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,originalMessage:payload,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[oItem]}),transaction.queue())}function loadIntentJson(sender,intent,data){function getJsonSuccess(data){payload.feature=data,payload.format="geojson",item=new emp.typeLibrary.Feature(payload),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,transactionId:emp.helpers.emp.helpers.id.newGUID(),sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,originalMessage:payload,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:[item]}),transaction.queue()}function getJsonFailure(){emp.typeLibrary.Error({message:"error loading GeoJSON from URL with uri-list/geo+json"})}var item,cmap,transaction,i,len,payload={};if(sender=checkSender(sender),data.hasOwnProperty("common_map"))for(cmap=data.common_map,cmap.hasOwnProperty("overlayId")?payload.overlayId=cmap.overlayId:payload.overlayId=sender.id,cmap.hasOwnProperty("featureId")?payload.featureId=cmap.featureId:payload.featureId=emp.helpers.id.newGUID(),cmap.hasOwnProperty("name")?payload.name=cmap.name:payload.name="Untitled",cmap.hasOwnProperty("zoom")&&(payload.zoom=cmap.zoom),len=data.data.length,i=0;i<len;i++)$.getJSON(data.data[i],getJsonSuccess).fail(getJsonFailure)}function populateBounds(sender,intent,data){var payload=new emp.typeLibrary.View({sender:sender.id}),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_GET,sendTransactionComplete:!1,sender:sender.id,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_STATUS_REQUEST,items:[payload]});transaction.queue()}function registerWidgetIntents(){OWF.Intents&&(OWF.Intents.receive({action:"SwitchWorkspaceView",dataType:"GEOINT"},function(){widgetState=new Ozone.state.WidgetState,widgetState.activateWidget()}),OWF.Intents.receive({action:"pick",dataType:"application/vnd.owf.common-map-1.0"},function(){}),OWF.Intents.receive({action:"pick",dataType:"application/vnd.owf.common-map-1.1"},function(){}),OWF.Intents.receive({action:"pick",dataType:"application/vnd.owf.common-map-1.2"},function(){}),OWF.Intents.receive({action:"pick",dataType:"application/json+common-map-bounds"},function(sender,intent,data){populateBounds(sender,intent,data)}),OWF.Intents.receive({action:"plot",dataType:"application/vnd.google-earth.kml+xml"},function(sender,intent,data){plotIntentKml(sender,intent,data)}),OWF.Intents.receive({action:"plot",dataType:"application/geo+json"},function(sender,intent,data){plotIntentJson(sender,intent,data)}),OWF.Intents.receive({action:"plot",dataType:"uri-list/geo+json"},function(sender,intent,data){loadIntentJson(sender,intent,data)}),OWF.Intents.receive({action:"view",dataType:"application/vnd.google-earth.kml+xml"},function(sender,intent,data){plotIntentKml(sender,intent,data)}),OWF.Intents.receive({action:"view",dataType:"uri-list/vnd.google-earth.kml+xml"},function(sender,intent,data){loadIntentKml(sender,intent,data)}),OWF.Intents.receive({action:"view",dataType:"application/geo+json"},function(sender,intent,data){plotIntentJson(sender,intent,data)}),OWF.Intents.receive({action:"view",dataType:"uri-list/geo+json"},function(sender,intent,data){loadIntentJson(sender,intent,data)}))}function viewChangeHdlr(){hViewChgTimer&&clearTimeout(hViewChgTimer)}function handleStateEvent(sender,msg){"beforeclose"===msg.eventName&&(shutdownCallback&&shutdownCallback(),widgetState.removeStateEventOverrides({events:["beforeclose"],callback:function(){widgetState.closeWidget()}}))}function owf35Unload(){shutdownCallback&&shutdownCallback()}function mapInit(){var event,widgetGuid,launchData,launchDataStr,transactionMessage,bInstallViewChangeListener=!1;switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":widgetEventingController=new Ozone.eventing.Widget(template.properties.rpcRelayPath),OWF=Ozone,OWF.Eventing=widgetEventingController,OWF.getInstanceId=function(){return JSON.parse(widgetEventingController.getWidgetId()).id},"Firefox"===OWF.BrowserDetect.browser?bInstallViewChangeListener=!0:window.addEventListener("unload",owf35Unload),widgetGuid=OWF.getInstanceId(),OWF.pref.PrefServer.getWidget({widgetId:widgetGuid,onSuccess:function(results){template.properties.widgetName=results.value.originalName,template.properties.universalName=results.value.universalName,template.name=results.value.namespace},onFailure:function(){template.properties.widgetName="",template.properties.universalName=""}});break;case"4.0.0-GA":widgetEventingController=new Ozone.eventing.Widget(template.properties.rpcRelayPath),OWF=Ozone,OWF.Eventing=widgetEventingController,OWF.getInstanceId=function(){return OWF.Widget.getInstanceId()},widgetState=Ozone.state.WidgetState.getInstance({widgetEventingController:widgetEventingController,autoInit:!0,onStateEventReceived:handleStateEvent}),widgetState.addStateEventOverrides({events:["beforeclose"]}),widgetGuid=OWF.Widget.getWidgetGuid(),OWF.pref.PrefServer.getWidget({widgetId:widgetGuid,onSuccess:function(results){template.properties.widgetName=results.value.originalName,template.properties.universalName=results.value.universalName,template.name=results.value.namespace},onFailure:function(){template.properties.widgetName="",template.properties.universalName=""}});break;default:OWF.relayFile=this.rpcRelayPath,widgetEventingController=new Ozone.eventing.Widget(this.rpcRelayPath),widgetState=Ozone.state.WidgetState.getInstance({widgetEventingController:widgetEventingController,autoInit:!0,onStateEventReceived:handleStateEvent}),widgetState.addStateEventOverrides({events:["beforeclose"]}),widgetGuid=OWF.getWidgetGuid(),launchDataStr=OWF.Launcher.getLaunchData(),null!=launchDataStr&&(launchData=Ozone.util.parseJson(launchDataStr),null!=launchData&&launchData.hasOwnProperty("senderId")&&launchData.hasOwnProperty("messageId")&&(ownerId={senderId:launchData.senderId},isPrivateInstance=!0,transactionMessage={messageId:launchData.messageId,originatingChannel:"",status:"success",details:{},failures:[]},template.pubSub.publish("map.transaction.complete",transactionMessage,ownerId))),OWF.Preferences.getWidget({widgetId:widgetGuid,onSuccess:function(results){template.properties.widgetName=results.value.originalName,template.properties.universalName=results.value.universalName,template.name=results.value.namespace},onFailure:function(){template.properties.widgetName="",template.properties.universalName=""}})}registerWidgetIntents(),event={},event.type="mapLoading",event.eventData={},initCallback({success:!0}),bInstallViewChangeListener&&emp.transactionQueue.listener.add({type:emp.intents.control.VIEW_CHANGE,mapInstanceId:"0",callback:viewChangeHdlr})}function initialize(){void 0!==window.OWF?(template.version=OWF.getContainerVersion(),OWF.ready(mapInit)):void 0!==window.Ozone?Ozone.pref.PrefServer.getServerVersion({onSuccess:function(version){template.version=version.serverVersion,mapInit()}}):owfLoadAttempted===!1&&void 0!==emp.configManager.config.owfJsLocation&&null!==emp.configManager.config.owfJsLocation&&""!==emp.configManager.config.owfJsLocation&&"owf"===emp.appSetup.environment?(owfLoadAttempted=!0,loadScript({objectToLoad:"Ozone",url:emp.configManager.config.owfJsLocation,callback:initialize,failedcallback:function(){emp.typeLibrary.Error({message:"The OWF javascript Library failed to load from: "+emp.configManager.config.owfJsLocation,level:emp.typeLibrary.Error.level.CATASTROPHIC})}})):(emp.typeLibrary.Error({message:"The OWF javascript Library does not appear to be included on the page and the application cannot initialize",level:emp.typeLibrary.Error.level.CATASTROPHIC}),initCallback({success:!1}))}var initCallback,shutdownCallback,ownerId,hViewChgTimer,template=emp.createEnvironmentTemplate(),widgetState=null,widgetEventingController=null,subscribedCallbacks={},owfLoadAttempted=!1,isPrivateInstance=!1;return template.name="Ozone Widget Framework",template.init=function(args){initCallback=args.initcallback,shutdownCallback=args.shutdowncallback,initialize()},template.pubSub.publish=function(args){var success=!1;args.sender&&"undefined"!=typeof args.sender.forwardMsg&&(args.sender=void 0),isPrivateInstance===!0&&(args.sender=ownerId);try{args.sender?(OWF.Eventing.publish(args.channel,JSON.stringify(args.message),args.sender),success=!0):(OWF.Eventing.publish(args.channel,JSON.stringify(args.message)),success=!0)}catch(e){window.console&&window.console.hasOwnProperty("log")&&console.error("An error occurred while attempting to publish a message on "+args.channel+" in the EMP OWF environment. "+e.toString())}return success},template.properties.rpcRelayPath="rpc_relay.uncompressed.html",template.pubSub.subscribe=function(args){var success=!1;try{OWF.Eventing.subscribe(args.channel,args.callback),success=!0,subscribedCallbacks[args.channel]=args.callback}catch(e){emp.typeLibrary.Error({message:"An error occurred while attempting to subscribe to the "+args.channel+" channel in the EMP OWF environment",jsError:e})}return success},template.pubSub.unsubscribe=function(args){var success=!1;try{OWF.Eventing.unsubscribe(args.channel),success=!0,delete subscribedCallbacks[args.channel]}catch(e){emp.typeLibrary.Error({message:"An error occurred while attempting to unsubscribe to the "+args.channel+" channel in the EMP OWF environment",jsError:e})}return success},template.pubSub.forwardSubscribeMessages=function(win){function channelCallback(sender,msg,channel){win&&!win.closed&&win.emp?win.emp.environment.get().pubSub.publish({channel:channel,message:msg,sender:sender}):console.error("Failed to forward message "+channel)}var channel,success=!1;try{if(win&&!win.closed&&win.emp&&win.emp.environment.get().pubSub){for(channel in subscribedCallbacks)OWF.Eventing.unsubscribe(channel);for(channel in subscribedCallbacks)OWF.Eventing.subscribe(channel,channelCallback);success=!0}}catch(e){emp.typeLibrary.Error({message:"An error occurred while attempting to forward subscriptions in the EMP OWF environment",jsError:e})}return success},template.pubSub.stopForwardingSubscribe=function(){var channel;try{for(channel in subscribedCallbacks)OWF.Eventing.unsubscribe(channel);for(channel in subscribedCallbacks)OWF.Eventing.subscribe(channel,subscribedCallbacks[channel])}catch(e){emp.typeLibrary.Error({message:"An error occurred while attempting to stop forwarding in the EMP OWF environment",jsError:e})}},template.properties.rpcRelayPath="rpc_relay.uncompressed.html",template.prefs.get=function(args){var successCallback=args.onSuccess,failureCallback=args.onError,onSuccess=function(args){successCallback&&successCallback({value:args.value})},onFailure=function(error){failureCallback&&failureCallback({error:error})};switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":OWF.pref.PrefServer.setUserPreference({namespace:"mil.army.sec.emp",name:args.key,value:args.value,onSuccess:onSuccess,onFailure:onFailure});break;case"4.0.0-GA":OWF.pref.PrefServer.setUserPreference({namespace:"mil.army.sec.emp",name:args.key,value:args.value,onSuccess:onSuccess,onFailure:onFailure});break;default:OWF.Preferences.setUserPreference({namespace:"mil.army.sec.emp",name:args.key,value:args.value,onSuccess:onSuccess,onFailure:onFailure})}},template.prefs.put=function(args){var successCallback=args.onSuccess,failureCallback=args.onError,onSuccess=function(args){successCallback&&successCallback({value:args.value})},onFailure=function(error){failureCallback&&failureCallback({error:error})};switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":OWF.pref.PrefServer.setUserPreference({namespace:"mil.army.sec.emp",name:args.key,value:args.value,onSuccess:onSuccess,onFailure:onFailure});break;case"4.0.0-GA":OWF.pref.PrefServer.setUserPreference({namespace:"mil.army.sec.emp",name:args.key,value:args.value,onSuccess:onSuccess,onFailure:onFailure});break;default:OWF.Preferences.setUserPreference({namespace:"mil.army.sec.emp",name:args.key,value:args.value,onSuccess:onSuccess,onFailure:onFailure})}},template.getInstanceId=function(){return OWF.getInstanceId()},template.launchTool=function(args){var launchCallback=function(callbackArgs){var onSuccess=args.onSuccess,onError=args.onError;callbackArgs.error?"function"==typeof onError&&onError({message:"The current user does not have permissions to run this tool.",statusCode:"Failed"}):"function"==typeof onSuccess&&onSuccess()};switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":case"4.0.0-GA":var widgetLauncher=new OWF.launcher.WidgetLauncher(widgetEventingController);widgetLauncher.launchWidget({guid:args.toolHandle.path,launchOnlyIfClosed:!0});break;default:OWF.Launcher.launch({guid:args.toolHandle.path,launchOnlyIfClosed:!0},launchCallback)}},template.getToolInfo=function(args){var getToolInfoSuccess=function(widgets){var iIndex,toolInfo,oErrorInfo,onSuccess=args.onSuccess,onError=args.onError,toolName=args.toolInfo.toolName;switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":if(widgets.success&&widgets.rows.length>0){for(iIndex=0;iIndex<widgets.rows.length&&widgets.rows[iIndex].value.namespace!==toolName;iIndex++);iIndex<widgets.rows.length?(toolInfo={toolName:widgets.rows[iIndex].value.namespace,toolhandle:widgets.rows[iIndex]},onSuccess(toolInfo)):"function"==typeof onError&&(oErrorInfo={message:"Widget ("+toolName+") not found.",statusCode:"404"},onError(oErrorInfo))}else"function"==typeof onError&&(oErrorInfo={message:"Widget ("+toolName+") not found.",statusCode:"404"},onError(oErrorInfo));break;case"4.0.0-GA":widgets.length>0?(toolInfo={toolName:widgets[0].value.namespace,toolhandle:widgets[0]},onSuccess(toolInfo)):"function"==typeof onError&&(oErrorInfo={message:"Widget ("+toolName+") not found.",statusCode:"404"},onError(oErrorInfo));break;default:widgets.length>0?setTimeout(function(){var widgetID=widgets[0].path,getToolName=toolName;OWF.Preferences.getWidget({widgetId:widgetID,onSuccess:function(getWidgetArgs){var toolInf={toolName:getToolName,toolhandle:getWidgetArgs};onSuccess(toolInf)},onFailure:function(){if("function"==typeof onError){var errInfo={message:"The current user does not have permissions to run this tool ("+getToolName+").",statusCode:"Failed"};onError(errInfo)}}})},50):"function"==typeof onError&&(oErrorInfo={message:"Widget ("+toolName+") not found.",statusCode:"404"},onError(oErrorInfo))}},getToolInfoError=function(errorArgs){var onError=args.onError;if(onError){var oErrorInfo={message:errorArgs.message,statusCode:errorArgs.statusCode};onError(oErrorInfo)}},searchConfig={searchParams:{widgetName:args.toolInfo.toolName,widgetNameExactMatch:!0},onSuccess:getToolInfoSuccess,onFailure:getToolInfoError};if("function"!=typeof args.onSuccess)throw emp.typeLibrary.Error({message:"The onSuccess callback parameter is required.",level:emp.typeLibrary.Error.level.MAJOR});switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":case"4.0.0-GA":OWF.pref.PrefServer.findWidgets(searchConfig);break;default:OWF.Preferences.findWidgets(searchConfig)}},template}(),emp.environment.browser=function(){var forwardMsgWindow,template=emp.createEnvironmentTemplate(),senderId=emp.helpers.id.newGUID();template.name="Browser";var subscribedCallbacks={};return template.init=function(args){var transactionMessage;args&&(args.hasOwnProperty("initcallback")&&args.initcallback(),args.hasOwnProperty("mapInstanceId")&&void 0!==args.mapInstanceId&&null!==args.mapInstanceId&&args.hasOwnProperty("messageId")&&void 0!==args.messageId&&null!==args.messageId&&(transactionMessage={messageId:args.messageId,originatingChannel:"",status:"success",details:{},failures:[]},template.pubSub.publish({channel:"map.message.complete",message:transactionMessage,sender:{id:args.mapInstanceId}})))},template.pubSub.publish=function(args){var success=!1,fwdMsg=!0;return args.sender&&(args.sender.hasOwnProperty("id")&&(senderId=args.sender.id),args.sender.hasOwnProperty("forwardMsg")&&null!==args.sender.forwardMsg&&(fwdMsg=args.sender.forwardMsg)),forwardMsgWindow&&!args.sender?(args.sender={forwardMsg:!1},forwardMsgWindow.emp.environment.get().pubSub.publish(args),success=!0):(emp.environment.browser.mediator.publish({channel:args.channel,message:args.message,sender:{id:senderId,forwardMsg:fwdMsg}}),success=!0),success},template.pubSub.subscribe=function(args){var success=!1;return emp.environment.browser.mediator.subscribe({channel:args.channel,callback:args.callback,senderId:args.mapInstanceId}),subscribedCallbacks[args.channel]=args.callback,success=!0;
},template.pubSub.unsubscribe=function(args){var success=!1;return emp.environment.browser.mediator.unsubscribe({channel:args.channel,callback:args.callback}),delete subscribedCallbacks[args.channel],success=!0},template.pubSub.forwardSubscribeMessages=function(win){var channel,success=!1;try{if(win&&!win.closed&&win.emp&&win.emp.environment.get().pubSub){for(channel in subscribedCallbacks)emp.environment.browser.mediator.unsubscribe({channel:channel,callback:subscribedCallbacks[channel]});for(channel in subscribedCallbacks)emp.environment.browser.mediator.subscribe({channel:channel,callback:function(sender,msg,channel){sender.forwardMsg?win&&!win.closed&&win.emp?win.emp.environment.get().pubSub.publish({channel:channel,message:msg,sender:senderId}):console.error("Failed to forward message "+channel):subscribedCallbacks[channel](sender,msg,channel)}});success=!0}}catch(e){emp.typeLibrary.Error({message:"An error occurred while attempting to forward subscriptions in the EMP Browser environment",jsError:e})}return success},template.pubSub.stopForwardingSubscribe=function(){var channel,args;try{for(channel in subscribedCallbacks)args={channel:channel,callback:subscribedCallbacks[channel]},emp.environment.browser.mediator.unsubscribe(args);for(channel in subscribedCallbacks)args={channel:channel,callback:subscribedCallbacks[channel]},emp.environment.browser.mediator.subscribe(args)}catch(e){emp.typeLibrary.Error({message:"An error occurred while attempting to stop forwarding in the EMP Browser environment",jsError:e})}},template.pubSub.stopForwardingPublish=function(){forwardMsgWindow=void 0},template.pubSub.forwardPublishedMessages=function(win){win&&win.emp&&win.emp.environment.get().pubSub&&(forwardMsgWindow=win)},template}(),emp.environment.browser.mediator=function(){var listeners=new emp.utilities.Hash,publicInterface={subscribe:function(listenerInfo){if(null!==listeners.getItem(listenerInfo.channel)&&void 0!==listeners.getItem(listenerInfo.channel))listeners.getItem(listenerInfo.channel).push({callback:listenerInfo.callback,senderId:listenerInfo.senderId});else{var callbacks=[];callbacks.push({callback:listenerInfo.callback,senderId:listenerInfo.senderId}),listeners.setItem(listenerInfo.channel,callbacks)}},unsubscribe:function(listenerInfo){var callbackArray,len,i;if(null!==listeners.getItem(listenerInfo.channel)&&void 0!==listeners.getItem(listenerInfo.channel))for(callbackArray=listeners.getItem(listenerInfo.channel),len=callbackArray.length,i=0;i<len;i+=1)if(callbackArray[i].callback===listenerInfo.callback)return callbackArray.splice(i,1),!0;return!1},publish:function(message){var len,i,callbacks=listeners.getItem(message.channel),errorMessages=[],success={success:!1,message:"An unanticipated error has occurred in emp.environment.browser.mediator.dispatch"};try{if("string"==typeof message.message&&(message.message=JSON.parse(message.message)),null!==callbacks&&void 0!==callbacks)for(len=callbacks.length,i=0;i<len;i+=1)if(null!==callbacks[i])try{if(message.hasOwnProperty("dest")&&null!==message.dest&&""!==message.dest&&!emp.helpers.isEmptyString(message.dest.id)){if(message.dest.id===callbacks[i].senderId)try{callbacks[i].callback(message.sender,message.message,message.channel)}catch(err){emp.errorHandler.log({level:emp.typeLibrary.Error.level.MINOR,jsError:err,message:"An error occurred in emp.environment.browser.mediator.js"}),errorMessages.push(err.message)}}else if(emp.helpers.isEmptyString(callbacks[i].senderId))try{callbacks[i].callback(message.sender,message.message,message.channel)}catch(err){emp.errorHandler.log({level:emp.typeLibrary.Error.level.MINOR,jsError:err,message:"An error occurred in emp.environment.browser.mediator.js"}),errorMessages.push(err.message)}}catch(err){emp.errorHandler.log({level:emp.typeLibrary.Error.level.MINOR,jsError:err,message:"An error occurred in emp.environment.browser.mediator.js"}),emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.INFO,jsError:err,message:"An error occurred in emp.transactionQueue.dispatch while attempting to invoke a callback function"})}}catch(err2){errorMessages.push(err2.message),emp.errorHandler.log({level:emp.typeLibrary.Error.level.MINOR,jsError:err2,message:"An error occurred in emp.transactionQueue.dispatch while attempting to invoke a callback function"}),success={success:!1,message:err2.toString()}}return success=0===errorMessages.length?{success:!0}:{success:!1,message:"An unanticipated error has occurred in emp.environment.browser.mediator.dispatch: "+JSON.stringify(errorMessages)}},publishSynch:function(args){var result,storageObject,engineTemplate,transaction,items=[];if(engineTemplate=emp.instanceManager.getInstance(args.mapId),args.message)switch(args.message.cmd){case"Container.hasChildren":try{storageObject=emp.storage.get.id({id:args.message.container.geoId}),storageObject&&storageObject.options&&storageObject.options.childObjects||(result={success:!0,hasChildren:!1});for(var child in storageObject.options.childObjects)if(storageObject.options.childObjects.hasOwnProperty(child))return result={success:!0,hasChildren:!0};result={success:!0,hasChildren:!1}}catch(err){result={success:!1,hasChildren:!1,message:err.message}}break;case"map.convert":if(!engineTemplate)break;"offsetPixelToDecimalDegrees"===args.message.conversionType?(oItem=new emp.typeLibrary.Convert({y:args.message.y,x:args.message.x}),items.push(oItem),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.GET_LATLON_FROM_XY,mapInstanceId:args.mapId,transactionId:"",sender:"",source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.MAP_CONVERT,originalMessage:args.message,messageOriginator:"",originalMessageType:cmapi.channel.names.MAP_CONVERT,items:items}),engineTemplate.engine.view.getLatLonFromXY(transaction),result=transaction.items[0].invalid?null:new emp3.api.GeoPosition({latitude:transaction.items[0].lat,longitude:transaction.items[0].lon})):"decimalDegreesToOffsetPixel"===args.message.conversionType&&(oItem=new emp.typeLibrary.Convert({lat:args.message.y,lon:args.message.x}),items.push(oItem),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.GET_XY_FROM_LATLON,mapInstanceId:args.mapInstanceId,transactionId:"",sender:"",source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.MAP_CONVERT,originalMessage:args.originalMessage,messageOriginator:"",originalMessageType:cmapi.channel.names.MAP_CONVERT,items:items}),engineTemplate.engine.view.getXYFromLatLon(transaction),0===transaction.items.length||transaction.items[0].invalid?(window.console.error(transaction.failures),result=null):result={x:transaction.items[0].x,y:transaction.items[0].y});break;case"map.view.lock":if(!engineTemplate)break;var oItem=new emp.typeLibrary.Lock({lock:args.message.lock});items.push(oItem),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:args.mapInstanceId,transactionId:"",sender:"",source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.MAP_CONVERT,originalMessage:args.originalMessage,messageOriginator:"",originalMessageType:cmapi.channel.names.MAP_CONVERT,items:items}),engineTemplate.engine.navigation.enable(transaction)}return result}};return publicInterface}(),emp.environment.starfish=function(){var nerve,template=emp.createEnvironmentTemplate();return template.name="Starfish",template.init=function(args){nerve=new com.octabits.starfish.Nerve,template.sender.id=nerve.id,args&&args.hasOwnProperty("initcallback")&&args.initcallback()},template.pubSub.publish=function(args){var success=!1;return nerve.publish({channel:args.channel,message:args.message}),success=!0},template.pubSub.subscribe=function(args){var success=!1;return nerve.subscribe({channel:args.channel,callback:args.callback}),success=!0},template.pubSub.unsubscribe=function(args){var success=!1;return nerve.unsubscribe({channel:args.channel,callback:args.callback}),success=!0},template.getInstanceId=function(){return nerve.id},template}(),emp.environment.iwc=function(){function getChannel(achannel){var channel=channelLookup[achannel];return void 0!==channel&&null!==channel||(channelLookup[achannel]=new iwcClient.data.Reference(achannel,{lifespan:"Bound",respondOn:"all"}),channel=channelLookup[achannel]),channel}var iwcClient,template=emp.createEnvironmentTemplate(),channelLookup={},callbackLookup={},adjustChannelName=function(channelName){return"/cmapi_"+channelName.replace(/\./g,"_")},revertChannelName=function(channelName){return channelName=channelName.replace("/cmapi_",""),channelName.replace(/\_/g,".")},recieveMessage=function(event){var callback,callbackList,msg=event.newValue;if(msg.sender.id!==template.sender.id){callbackList=callbackLookup[msg.channel];for(callback in callbackList)callbackList.hasOwnProperty(callback)&&"function"==typeof callbackList[callback]&&callbackList[callback](msg.sender,msg.msg,revertChannelName(msg.channel))}};return template.name="Ozone Platform Inter Widget Communication (IWC)",template.version="1.0.0",template.properties={},template.sender={id:"broadcast"},template.iwcHost="vendor/iwc/",template.init=function(args){var transactionMessage,success=!1;if(void 0!==ozpIwc&&null!==ozpIwc&&"function"==typeof ozpIwc.hasOwnProperty&&ozpIwc.hasOwnProperty("Client")){iwcClient=new ozpIwc.Client(this.iwcHost);var closureArgs=args,that=this;iwcClient.connect().then(function(){closureArgs.initcallback({success:!0}),template.sender.id="broadcast",void 0!==closureArgs.messageId&&null!==closureArgs.messageId&&(transactionMessage={messageId:closureArgs.messageId,originatingChannel:"",status:"success",details:{},failures:[]},template.pubSub.publish({channel:"map.message.complete",message:transactionMessage,sender:{id:"broadcast"}}))}).catch(function(err){console.error("IWC Client failed to connect to "+that.iwcHost+" :",err)}),success=!0}else console.error("The Ozone Platform IWC JavaScript ozpIwc object was not found on this page.  Please ensure that the path to ozpIwc-client.js in your app is correct"),args.initcallback({success:!1});return success},template.createInstance=function(args){var result=!1;return args&&args.hasOwnProperty("containerId")&&args.hasOwnProperty("messageId")&&(emp.instanceManager.createInstance({instanceDomId:args.containerId,messageId:args.messageId,config:args.config,extent:args.extent,environment:template,startMapEngineId:args.startMapEngineId}),result=!0),result},template.destroyInstance=function(args){var result=!1;return args&&args.hasOwnProperty("id")&&(emp.instanceManager.destroyInstance({mapInstanceId:args.id,messageId:args.messageId}),result=!0),result},template.pubSub.publish=function(args){var cName=adjustChannelName(args.channel),channel=getChannel(cName);return channel.set({msg:args.message,channel:cName,sender:{id:"broadcast"}}).catch(function(err){console.error("ERROR publishing core message: "+cName+" - "+JSON.stringify(err))}),!0},template.pubSub.subscribe=function(args){var cName=adjustChannelName(args.channel),channel=getChannel(cName);void 0!==callbackLookup[cName]?callbackLookup[cName][args.callback]=args.callback:(callbackLookup[cName]={},callbackLookup[cName][args.callback]=args.callback),channel.watch(recieveMessage)},template.pubSub.unsubscribe=function(args){var cName=adjustChannelName(args.channel),channel=getChannel(cName);return void 0!==callbackLookup[cName]&&delete callbackLookup[cName][args.callback],channel.unwatch(cName),!0},template}(),emp.wms=emp.wms||{},emp.wms.manager=function(){var publicInterface,instanceData={};return publicInterface={getWmsOverlayId:function(mapInstanceId){if(instanceData.hasOwnProperty(mapInstanceId))return instanceData[mapInstanceId].wmsOverlayId},isRootWMS:function(id){for(var instance in instanceData)if(instanceData.hasOwnProperty(instance)&&instanceData[instance].wmsOverlayId===id)return!0;return!1},newMapInstance:function(args){var oData,wmsOverlay,overlayTransaction,wmsOverlayId=emp.helpers.id.newGUID();wmsOverlay=new emp.typeLibrary.Overlay({name:"WMS Map Layers",overlayId:wmsOverlayId}),oData={instanceId:args.mapInstanceId,wmsOverlayId:wmsOverlayId,overlay:wmsOverlay},instanceData[args.mapInstanceId]=oData,overlayTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_ADD,mapInstanceId:args.mapInstanceId,source:emp.core.sources.CORE,items:[wmsOverlay]}),overlayTransaction.queue()},removeMapInstance:function(args){instanceData.hasOwnProperty(args.mapInstanceId)&&delete instanceData[args.mapInstanceId]}}}(),emp.api={sources:[],checkApiSource:function(source){var i,isApiSource=!1,len=emp.api.sources.length;for(i=0;i<len;i++)if(source===emp.api.sources[i]){isApiSource=!0;break}return isApiSource}},emp.intents={},emp.intents.control={STATUS:"status",STATUS_RESET:"status.reset",STATUS_DESTROY:"status.destroy",MODE_GET:"mode.get",MODE_SET:"mode.set",CAPTURE_SCREENSHOT:"capture.screenshot",FEATURE_ADD:"feature.add",MP_FEATURE_ADD:"multiparent.feature.add",FREEHAND_START:"freehand.start",FREEHAND_STOP:"freehand.stop",FREEHAND_LINE_DRAW_START:"freehand.linedraw.start",FREEHAND_LINE_DRAW_END:"freehand.linedraw.end",FREEHAND_LINE_DRAW_UPDATE:"freehand.linedraw.update",MAP_SERVICE_ADD:"mapservice.add",MAP_SERVICE_REMOVE:"mapservice.remove",WMS_ADD:"wms.add",WMS_REMOVE:"wms.remove",WMTS_ADD:"wmts.add",WMTS_REMOVE:"wmts.remove",KMLLAYER_ADD:"kmllayer.add",KMLLAYER_REMOVE:"kmllayer.remove",FEATURE_OUTBOUND_PLOT:"feature.outbound.plot",FEATURE_REMOVE:"feature.remove",MP_FEATURE_REMOVE:"multiparent.feature.remove",FEATURE_UPDATE:"feature.update",MAP_CONFIG:"map.config",DRAW_BEGIN:"draw.begin",DRAW_CANCEL:"draw.cancel",DRAW_COMPLETE:"draw.complete",EDIT_BEGIN:"edit.begin",EDIT_CANCEL:"edit.cancel",EDIT_END:"edit.end",EDIT_ENDED:"edit.ended",SELECTION_GET:"selection.get",SELECTION_SET:"selection.set",SELECTION_CLEAR:"selection.clear",GET_LATLON_FROM_XY:"getLatLonFromXY",GET_XY_FROM_LATLON:"getXYFromLatLon",SELECTION_OUTBOUND:"selection-outbound",DESELECTION_OUTBOUND:"deselection-outbound",OVERLAY_ADD:"overlay.add",OVERLAY_REMOVE:"overlay.remove",OVERLAY_UPDATE:"overlay.update",OVERLAY_CLEAR:"overlay.clear",OVERLAY_STYLE:"overlay.style",MP_OVERLAY_ADD:"multiparent.overlay.add",MP_OVERLAY_REMOVE:"multiparent.overlay.remove",VISIBILITY_SET:"visibility.set",MI_VISIBILITY_SET:"map.instance.visibility.set",VISIBILITY_GET:"visibility.get",LAYER_ADD:"layer.add",LAYER_REMOVE:"layer.remove",LAYER_UPDATE:"layer.update",LAYER_GET:"layer.get",VIEW_LOCK:"view.lock",VIEW_SET:"view.set",VIEW_GET:"view.get",LOOKAT_SET:"lookAt.set",GET:"map.get",EDIT_UPDATE:"edit.update",DRAW_UPDATE:"draw.update",EVENT_MAP_CLICK:"map.click",MIL_ICON_SIZE_SET:"mil.icon.size",MIL_ICON_LABELS_SET:"mil.icon.labels.set",PROJECTION_ENABLE_FLAT:"projection.enable.Flat",ERROR:"error",STATUS_CHANGE:"status-change",CLICK:"click",FEATURE_CLICK:"feature.click",POINTER:"pointer",SELECTION_BOX:"selection.box",VIEW_CHANGE:"view-change",SELECTION_CHANGE:"selection-change",STATIC_CONTENT:"static-content",DRAW_ENDED:"draw.ended",DRAW_END:"draw.end",DRAW_START:"draw.start",EDIT_START:"edit.start",ENVIRONMENT_READY:"environment.ready",TRANSACTION_COMPLETE:"transaction.complete",TRANSACTION_PROGRESS:"transaction.progress",STATUS_RESPONSE_ABOUT:"status.response.about",STATUS_RESPONSE_FORMAT:"status.response.format",STATUS_RESPONSE_SELECTED:"status.response.selected",STATUS_RESPONSE_INIT:"status.response.init",STATUS_REQUEST_SCREENSHOT:"status.request.screenshot",STATUS_RESPONSE_COORD_SYSTEM:"status.response.coordinatesystem",VIEW_COORDINATESYSTEM:"view.coordinatesystem",OVERLAY_CLUSTER_SET:"overlay.cluster.set",OVERLAY_CLUSTER_ACTIVATE:"overlay.cluster.activate",OVERLAY_CLUSTER_DEACTIVATE:"overlay.cluster.deactivate",OVERLAY_CLUSTER_REMOVE:"overlay.cluster.remove",MAP_CURSOR_MODE_SET:"map.cursor.mode.set",MAP_ENGINE_SWAP_START:"map.engine.swap.start",MAP_ENGINE_SWAP_COMPLETE:"map.engine.swap.complete",MAP_SWAP:"map.swap",STORAGE_RELOAD_COMPLETE:"storage.reload.complete",CMAPI_GENERIC_FEATURE_REMOVE:"cmapi.generic.feature.remove",EMP_UI_INSTANCE_INIT:"emp.ui.instance.init",MI_OVERLAY_ADD:"map.instance.overlay.add",MI_FEATURE_ADD:"map.instance.feature.add",MI_FEATURE_UPDATE:"map.instance.feature.update",MI_FEATURE_REMOVE:"map.instance.feature.remove",MI_WMS_ADD:"map.instance.wms.add",MI_WMS_REMOVE:"map.instance.wms.remove",MI_WMTS_ADD:"map.instance.wmts.add",MI_WMTS_REMOVE:"map.instance.wmts.remove",MI_KML_LAYER_ADD:"map.instance.kml.add",MI_KML_LAYER_REMOVE:"map.instance.kml.remove",STORAGE_OBJECT_ADDED:"storage.object.added",STORAGE_OBJECT_REMOVED:"storage.object.removed",STORAGE_OBJECT_UPDATED:"storage.object.updated",STORAGE_OBJECT_CHILD_REMOVED:"storage.object.child.removed"},emp.intents.control._func={SE:"store",API:"normal"},emp.intents.control.register=function(args){emp.intents.control._func[args.component]=args.func},emp.intents.control.storageHandleSuccess=function(args){var fnStorageHandler=emp.storage[emp.intents.control._func.SE];fnStorageHandler&&fnStorageHandler(args)},emp.intents.control.transactionComplete=function(args){switch(emp.intents.control._func.API){case"normal":emp.transactionQueue._complete(args);break;case"reload":emp.storage.processTransactionComplete(args)}},emp.intents.control.useNewEditing=function(args){var symbol,symbolCode,standard,basicCode,symbolDef,unitDef,drawCategory,result=!1,originalFeature=args.items[0].originFeature;return originalFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(symbol=!0,symbolCode=originalFeature.data.symbolCode,originalFeature.properties&&originalFeature.properties.modifiers&&(standard=originalFeature.properties.modifiers.standard||1),basicCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(symbolCode,standard),armyc2.c2sd.renderer.utilities.SymbolDefTable.hasSymbolDef(basicCode,standard)?(symbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicCode,standard),symbolDef&&(drawCategory=symbolDef.drawCategory)):(unitDef=armyc2.c2sd.renderer.utilities.UnitDefTable.getUnitDef(basicCode,standard),unitDef&&(drawCategory=unitDef.drawCategory))),originalFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_POINT||symbol&&drawCategory===armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_POINT?result=!0:originalFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_PATH||symbol&&drawCategory===armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_LINE?result=!0:(originalFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_POLYGON||symbol&&drawCategory===armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_POLYGON)&&(result=!0),result},emp.intents.control.intentSequenceMapper=function(){var intentSequenceMapper=[];return intentSequenceMapper[emp.intents.control.ERROR]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Error]}},intentSequenceMapper[emp.intents.control.SELECTION_OUTBOUND]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.DESELECTION_OUTBOUND]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.EDIT_UPDATE]=function(){return{forward:[],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.DRAW_UPDATE]=function(){return{forward:[],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.MAP_CURSOR_MODE_SET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&(oMapInstance.engines.isMapSwapInProgress()?args.queue():oMapInstance.engine&&oMapInstance.engine.cursor.mode.set(args))}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.GET_LATLON_FROM_XY]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.view.getLatLonFromXY(args)}],exit:[emp.intents.control.transactionComplete],constructor:[]}},intentSequenceMapper[emp.intents.control.GET_XY_FROM_LATLON]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.view.getXYFromLatLon(args)}],exit:[emp.intents.control.transactionComplete],constructor:[]}},intentSequenceMapper[emp.intents.control.FREEHAND_START]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId),item=args.items[0];oMapInstance&&oMapInstance.freehandStart(item)}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.FREEHAND_STOP]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.freehandStop()}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.MAP_CONFIG]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance){oMapInstance.engine&&oMapInstance.engine.map.config(args);var item=args.items[0];item&&item.freehandStrokeStyle&&oMapInstance.setFreehandStrokeStyle(item.freehandStrokeStyle)}}],exit:[emp.intents.control.transactionComplete],constructor:[]}},intentSequenceMapper[emp.intents.control.SELECTION_CHANGE]=function(){return{forward:[emp.storage.selection.selectionChange],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Selection]}},intentSequenceMapper[emp.intents.control.CLICK]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Click]}},intentSequenceMapper[emp.intents.control.CAPTURE_SCREENSHOT]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.MI_FEATURE_ADD]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.feature.add(args)},function(transaction){var oMapInstance=emp.instanceManager.getInstance(transaction.mapInstanceId);if(oMapInstance){var publisher=cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD];publisher&&publisher.process(transaction)}}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_FEATURE_UPDATE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.feature.add(args)},function(transaction){var oMapInstance=emp.instanceManager.getInstance(transaction.mapInstanceId);if(oMapInstance){var publisher=cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE];publisher&&publisher.process(transaction)}}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_FEATURE_REMOVE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.status.cancelDrawEditForFeatureRemove(args)},function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.feature.remove(args)},function(transaction){var oMapInstance=emp.instanceManager.getInstance(transaction.mapInstanceId);if(oMapInstance){var publisher=cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE];publisher&&publisher.process(transaction)}}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.FEATURE_ADD]=function(){return{forward:[emp.storage.feature.validateAdd,emp.storage.feature.add],exit:[emp.intents.control.transactionComplete],constructor:[]}},intentSequenceMapper[emp.intents.control.MAP_SERVICE_ADD]=function(){return{forward:[emp.storage.mapservice.validateAdd,emp.storage.mapservice.add],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.MAP_SERVICE_REMOVE]=function(){return{forward:[emp.storage.mapservice.remove],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.MI_WMS_ADD]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.wms.add(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)console.error(args.failures[i].message)}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_WMTS_ADD]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.wmts.add(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)console.error(args.failures[i].message)}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_WMS_REMOVE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.wms.remove(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)console.error(args.failures[i].message)}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_KML_LAYER_ADD]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.kmllayer.add(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)console.error(args.failures[i].message)}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_KML_LAYER_REMOVE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.kmllayer.remove(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)console.error(args.failures[i].message)}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.MI_WMTS_REMOVE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.wmts.remove(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)console.error(args.failures[i].message)}],exit:[emp.transactionQueue._custom],constructor:[]}},intentSequenceMapper[emp.intents.control.FEATURE_REMOVE]=function(){return{forward:[emp.storage.feature.remove],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.FEATURE_UPDATE]=function(){return{forward:[emp.storage.feature.validateUpdate,emp.storage.feature.update],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.VISIBILITY_GET]=function(){return{forward:[emp.storage.visibility.getState],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.VISIBILITY_SET]=function(){return{forward:[emp.storage.visibility.set],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.MI_VISIBILITY_SET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.visibility.set(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.Feature]}},intentSequenceMapper[emp.intents.control.DRAW_BEGIN]=function(){return{forward:[emp.storage.validateDraw,function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.status.validateState(args)},emp.storage.editBegin,function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);if(oMapInstance&&oMapInstance.engine&&oMapInstance.engine.draw.begin(args),args.failures.length>0)for(var i=0;i<args.failures.length;i++)window.console.error(args.failures[i].message)}],exit:[emp.storage.editTransCplt,emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Draw]}},intentSequenceMapper[emp.intents.control.DRAW_END]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.draw.end(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.Draw]}},intentSequenceMapper[emp.intents.control.DRAW_CANCEL]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.draw.cancel(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.Draw]}},intentSequenceMapper[emp.intents.control.EDIT_BEGIN]=function(){return{forward:[emp.storage.validateEdit,function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.status&&oMapInstance.status.validateState(args)},emp.storage.editBegin,function(args){var useNewEditing,oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);useNewEditing=emp.intents.control.useNewEditing(args),useNewEditing?oMapInstance&&oMapInstance.editingManager&&oMapInstance.editingManager.get().edit(args):oMapInstance&&oMapInstance.engine&&oMapInstance.engine.edit.begin(args)}],exit:[emp.storage.editTransCplt,emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Edit]}},intentSequenceMapper[emp.intents.control.EDIT_END]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId),useNewEditing=emp.intents.control.useNewEditing(args);useNewEditing?oMapInstance&&oMapInstance.status&&oMapInstance.editingManager.get().complete(args):oMapInstance&&oMapInstance.engine&&oMapInstance.engine.edit.end(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.Edit]}},intentSequenceMapper[emp.intents.control.EDIT_CANCEL]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId),useNewEditing=emp.intents.control.useNewEditing(args);useNewEditing?oMapInstance&&oMapInstance.status&&oMapInstance.editingManager.get().cancel(args):oMapInstance&&oMapInstance.engine&&oMapInstance.engine.edit.cancel(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.Edit]}},intentSequenceMapper[emp.intents.control.SELECTION_GET]=function(){return{forward:[emp.storage.get.selected],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Selection]}},intentSequenceMapper[emp.intents.control.SELECTION_SET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.selection.set(args)},emp.storage.selection.set],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Selection]}},intentSequenceMapper[emp.intents.control.SELECTION_CLEAR]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Selection]}},intentSequenceMapper[emp.intents.control.MI_OVERLAY_ADD]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.overlay.add(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.Overlay]}},intentSequenceMapper[emp.intents.control.OVERLAY_ADD]=function(){return{forward:[emp.storage.overlay.validateAdd,emp.storage.overlay.add],exit:[emp.intents.control.transactionComplete],
constructor:[emp.typeLibrary.Overlay]}},intentSequenceMapper[emp.intents.control.OVERLAY_REMOVE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engines.validateOverlayRemoval(args)},function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.status&&oMapInstance.status.cancelDrawEditForOverlayRemove(args)},emp.storage.overlay.remove],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Overlay]}},intentSequenceMapper[emp.intents.control.OVERLAY_UPDATE]=function(){return{forward:[emp.storage.overlay.validateUpdate,emp.storage.overlay.update],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Overlay]}},intentSequenceMapper[emp.intents.control.OVERLAY_CLEAR]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engines.validateOverlayClear(args)},function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.status.cancelDrawEditForOverlayRemove(args)},emp.storage.overlay.clear],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Overlay]}},intentSequenceMapper[emp.intents.control.VIEW_LOCK]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.navigation.enable(args)}],exit:[emp.intents.control.transactionComplete],constructor:[]}},intentSequenceMapper[emp.intents.control.VIEW_SET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.view.set(args)},emp.storage.view.set],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.View]}},intentSequenceMapper[emp.intents.control.VIEW_GET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.view.get(args)}],exit:[emp.transactionQueue._custom],constructor:[emp.typeLibrary.View]}},intentSequenceMapper[emp.intents.control.LOOKAT_SET]=function(){return{forward:[function(args){var mapInstance=emp.instanceManager.getInstance(args.mapInstanceId);mapInstance&&mapInstance.engine&&mapInstance.engine.lookAt.set(args)}],exit:[emp.intents.control.transactionComplete],constructor:[]}},intentSequenceMapper[emp.intents.control.VIEW_COORDINATESYSTEM]=function(){return{forward:[],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.View]}},intentSequenceMapper[emp.intents.control.GET]=function(){return{forward:[emp.storage.query],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Status]}},intentSequenceMapper[emp.intents.control.OVERLAY_STYLE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.overlay.style(args)}],exit:[emp.intents.control.transactionComplete],constructor:[emp.typeLibrary.Overlay]}},intentSequenceMapper[emp.intents.control.MIL_ICON_LABELS_SET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.settings.mil2525.icon.labels.set(args)}],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.MIL_ICON_SIZE_SET]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.settings.mil2525.icon.size.set(args)}],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_SET]=function(){return{forward:[emp.storage.overlay.validateCluster,function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.overlay.cluster.set(args)}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_ACTIVATE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.overlay.cluster.activate(args)}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.overlay.cluster.deactivate(args)}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_REMOVE]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.overlay.cluster.remove(args)}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.PROJECTION_ENABLE_FLAT]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.projection.enable.flat(args)}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.STATUS_REQUEST_SCREENSHOT]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&oMapInstance.engine&&oMapInstance.engine.capture.screenshot(args)}],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE]=function(){return{forward:[cmapi.channel.support.genericFeatureRemove],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.EMP_UI_INSTANCE_INIT]=function(){return{forward:[],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.STATIC_CONTENT]=function(){return{forward:[emp.storage.staticContent.add],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.STATUS_CHANGE]=function(){return{forward:[emp.instanceManager.statusChangeHdlr],exit:[emp.transactionQueue._custom]}},intentSequenceMapper[emp.intents.control.MAP_SWAP]=function(){return{forward:[function(args){var oMapInstance=emp.instanceManager.getInstance(args.mapInstanceId);oMapInstance&&(oMapInstance.engines.isMapSwapInProgress()?args.fail({coreId:args.items[0].mapId,level:emp.typeLibrary.Error.level.MAJOR,message:"Previous map engine swap execution is still in progress."}):oMapInstance.engines.load(args.items[0].engine))}],exit:[emp.intents.control.transactionComplete]}},intentSequenceMapper[emp.intents.control.POINTER]=function(){return{forward:[],exit:[emp.transactionQueue._custom]}},intentSequenceMapper}(),emp.intents.getSequence=function(args){var response,fnResponse=emp.intents.control.intentSequenceMapper[args.intent];return response=void 0===fnResponse?{forward:[],exit:[emp.transactionQueue._custom]}:fnResponse(args)},emp.prefs=function(){function getPref(args){var raw,value=null;try{"undefined"!=typeof Storage&&(raw=localStorage[args.key],void 0!==raw&&null!==raw&&(value=JSON.parse(raw)))}catch(err){emp.typeLibrary.Error({jsError:err,level:emp.typeLibrary.Error.MINOR,message:"emp.prefs was unable to retrieve the value of: '"+args.key+"'. Please see the jsError for more details"})}return value}function savePref(args){var success=!1;try{"undefined"!=typeof Storage&&(localStorage[args.key]=JSON.stringify(args.value),success=!0)}catch(err){emp.typeLibrary.Error({jsError:err,level:emp.typeLibrary.Error.MINOR,message:"emp.prefs was unable to save the value of: '"+args.key+"'. Please see the jsError for more details"})}return success}function clearPref(args){try{"undefined"!=typeof Storage&&delete localStorage[args.key]}catch(err){emp.typeLibrary.Error({jsError:err,level:emp.typeLibrary.Error.MINOR,message:"emp.prefs was unable to clear the value of: '"+args.key+"'. Please see the jsError for more details"})}}var publicInterface={engine:{set:function(engine){savePref({key:"engine",value:engine})},get:function(){return getPref({key:"engine"})},clear:function(){clearPref({key:"engine"}),alert("Your default map engine selection has been cleared.  You will be asked to choose an engine the next time the map is restarted")}}};return publicInterface}();var cmapi=cmapi||{};cmapi.channel=cmapi.channel||{},cmapi.channel.schema=cmapi.channel.schema||{},cmapi.channel.handler=cmapi.channel.handler||{},cmapi.channel.publisher=cmapi.channel.publisher||{},cmapi.channel.support=cmapi.channel.support||{},cmapi.typeLibrary=cmapi.typeLibrary||{},cmapi.map=cmapi.map||{},cmapi.map.message=cmapi.map.message||{},cmapi.map.message.complete=cmapi.map.message.complete||{},cmapi.map.message.complete.builder=cmapi.map.message.complete.builder||{},cmapi.map.message.progress=cmapi.map.message.progress||{},cmapi.map.message.progress.builder=cmapi.map.message.progress.builder||{},cmapi.channel.names={CMAPI2_VISIBILITY_GET:"cmapi2.visibility.get",CMAPI2_MAP_CONFIG:"cmapi2.map.config",CMAPI2_FEATURE_EVENT_ADD:"cmapi2.map.feature.event.add",CMAPI2_FEATURE_EVENT_REMOVE:"cmapi2.map.feature.event.remove",CMAPI2_FEATURE_EVENT_UPDATE:"cmapi2.map.feature.event.update",CMAPI2_FREEHAND_START:"cmapi2.map.freehand.start",CMAPI2_FREEHAND_STOP:"cmapi2.map.freehand.stop",CMAPI2_FREEHAND_LINE_DRAW:"cmapi2.map.freehand.linedraw",CMAPI2_MAP_DRAG:"cmapi2.map.view.drag",CMAPI2_MAP_DRAG_COMPLETE:"cmapi2.map.view.dragComplete",CMAPI2_FEATURE_DRAG:"cmapi2.map.feature.drag",CMAPI2_FEATURE_DRAG_COMPLETE:"cmapi2.map.feature.dragComplete",MAP_SHUTDOWN:"map.shutdown",MAP_CONVERT:"map.convert",MAP_SWAP:"map.swap",MAP_MESSAGE_COMPLETE:"map.message.complete",MAP_MESSAGE_PROGRESS:"map.message.progress",MAP_MESSAGE_CANCEL:"map.message.cancel",MAP_OVERLAY_CREATE:"map.overlay.create",MAP_OVERLAY_REMOVE:"map.overlay.remove",MAP_OVERLAY_HIDE:"map.overlay.hide",MAP_OVERLAY_SHOW:"map.overlay.show",MAP_OVERLAY_UPDATE:"map.overlay.update",MAP_OVERLAY_STYLE:"map.overlay.style",MAP_OVERLAY_CLUSTER_SET:"map.overlay.cluster.set",MAP_OVERLAY_CLUSTER_ACTIVATE:"map.overlay.cluster.activate",MAP_OVERLAY_CLUSTER_DEACTIVATE:"map.overlay.cluster.deactivate",MAP_OVERLAY_CLUSTER_REMOVE:"map.overlay.cluster.remove",MAP_OVERLAY_CLEAR:"map.overlay.clear",MAP_FEATURE_DESELECTED:"map.feature.deselected",MAP_FEATURE_SELECTED:"map.feature.selected",MAP_FEATURE_PLOT:"map.feature.plot",MAP_FEATURE_PLOT_URL:"map.feature.plot.url",MAP_FEATURE_UNPLOT:"map.feature.unplot",MAP_FEATURE_HIDE:"map.feature.hide",MAP_FEATURE_SHOW:"map.feature.show",MAP_FEATURE_UPDATE:"map.feature.update",MAP_FEATURE_EDIT:"map.feature.edit",MAP_FEATURE_DRAW:"map.feature.draw",MAP_FEATURE_CLICKED:"map.feature.clicked",MAP_FEATURE_MOUSEUP:"map.feature.mouseup",MAP_FEATURE_MOUSEDOWN:"map.feature.mousedown",MAP_VIEW_ZOOM:"map.view.zoom",MAP_VIEW_CENTER_OVERLAY:"map.view.center.overlay",MAP_VIEW_CENTER_FEATURE:"map.view.center.feature",MAP_VIEW_CENTER_LOCATION:"map.view.center.location",MAP_VIEW_CENTER_BOUNDS:"map.view.center.bounds",MAP_VIEW_LOCK:"map.view.lock",MAP_VIEW_CLICKED:"map.view.clicked",MAP_VIEW_MOUSEUP:"map.view.mouseup",MAP_VIEW_MOUSEDOWN:"map.view.mousedown",MAP_VIEW_MOUSEMOVE:"map.view.mousemove",MAP_VIEW_AREA_SELECTED:"map.view.area.selected",MAP_VIEW_COORDINATESYSTEM:"map.view.coordinatesystem",MAP_GET:"map.get",MAP_MENU_CREATE:"map.menu.create",MAP_MENU_CLICKED:"map.menu.clicked",MAP_MENU_REMOVE:"map.menu.remove",MAP_MENU_ACTIVE:"map.menu.active",MAP_STATUS_REQUEST:"map.status.request",MAP_STATUS_INITIALIZATION:"map.status.initialization",MAP_STATUS_VIEW:"map.status.view",MAP_STATUS_FORMAT:"map.status.format",MAP_STATUS_ABOUT:"map.status.about",MAP_STATUS_COORDINATESYSTEM:"map.status.coordinatesystem",MAP_STATUS_SCREENSHOT:"map.status.screenshot",MAP_STATUS_SELECTED:"map.status.selected",MAP_ERROR:"map.error",MAP_TRANSACTION_COMPLETE:"map.transaction.complete",MAP_STATUS_REQUEST_OVERLAYS:"map.status.request.overlays",MAP_STATUS_REQUEST_OVERLAY:"map.status.request.overlay",MAP_STATUS_REQUEST_FEATURE:"map.status.request.feature",MAP_STATUS_REQUEST_FEATURES:"map.status.request.features",MAP_STATUS_OVERLAYS:"map.status.overlays",MAP_STATUS_OVERLAY:"map.status.overlay",MAP_STATUS_FEATURE:"map.status.feature",MAP_STATUS_FEATURES:"map.status.features",MAP_MENU_DRAWING_COMPLETE:"map.menu.drawing.complete",MAP_MENU_DRAWING_CREATE:"map.menu.drawing.create",MAP_MENU_DRAWING_REMOVE:"map.menu.drawing.remove",MAP_FEATURE_PLOT_BATCH:"map.feature.plot.batch",MAP_FEATURE_UNPLOT_BATCH:"map.feature.unplot.batch",MAP_FEATURE_SELECTED_BATCH:"map.feature.selected.batch",MAP_FEATURE_DESELECTED_BATCH:"map.feature.deselected.batch",MAP_VIEW_LOOKAT_LOCATION:"map.view.lookat.location"},emp.api.cmapi=emp.api.cmapi||{},emp.api.cmapi.publisher=emp.api.cmapi.publisher||{},emp.api.cmapi.SOURCE="emp-api-cmapi",emp.api.sources.push(emp.api.cmapi.SOURCE),emp.api.cmapiMapInstanceInterface=function(args){var _widgetId,mapInstanceId=args.mapInstanceId,channels=[cmapi.channel.names.MAP_CONVERT,cmapi.channel.names.MAP_OVERLAY_CREATE,cmapi.channel.names.MAP_OVERLAY_REMOVE,cmapi.channel.names.MAP_OVERLAY_HIDE,cmapi.channel.names.MAP_OVERLAY_SHOW,cmapi.channel.names.MAP_OVERLAY_UPDATE,cmapi.channel.names.MAP_OVERLAY_STYLE,cmapi.channel.names.MAP_FEATURE_PLOT_URL,cmapi.channel.names.MAP_FEATURE_UNPLOT,cmapi.channel.names.MAP_FEATURE_HIDE,cmapi.channel.names.MAP_FEATURE_SHOW,cmapi.channel.names.MAP_FEATURE_DESELECTED,cmapi.channel.names.MAP_FEATURE_SELECTED,cmapi.channel.names.MAP_FEATURE_UPDATE,cmapi.channel.names.MAP_FEATURE_EDIT,cmapi.channel.names.MAP_FEATURE_DRAW,cmapi.channel.names.MAP_VIEW_LOCK,cmapi.channel.names.MAP_VIEW_ZOOM,cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY,cmapi.channel.names.MAP_VIEW_CENTER_FEATURE,cmapi.channel.names.MAP_VIEW_CENTER_LOCATION,cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS,cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION,cmapi.channel.names.MAP_GET,cmapi.channel.names.MAP_SWAP,cmapi.channel.names.MAP_STATUS_REQUEST,cmapi.channel.names.MAP_MESSAGE_CANCEL,cmapi.channel.names.MAP_MESSAGE_COMPLETE,cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH,cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH,cmapi.channel.names.CMAPI2_VISIBILITY_GET,cmapi.channel.names.CMAPI2_MAP_CONFIG,cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD,cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE,cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE,cmapi.channel.names.CMAPI2_FREEHAND_START,cmapi.channel.names.CMAPI2_FREEHAND_STOP],messageHandler=function(sender,msg,channel){var item,handler=cmapi.channel.handler[channel],message={},oSender="string"==typeof sender?JSON.parse(sender):sender;if(oSender.id!==_widgetId){if(void 0===msg||null===msg||""===msg)return void emp.typeLibrary.Error({level:2,message:"[CMAPI] Inbound Message was empty",coreId:"UNKNOWN"});message.payload="string"==typeof msg?JSON.parse(msg):msg,Array.isArray(message.payload)?(item=message.payload[0],void 0!==item&&null!==item&&item.hasOwnProperty("messageId")&&null!==item.messageId&&item.messageId.length>0&&(message.messageId=item.messageId)):void 0!==message.payload.messageId&&null!==message.payload.messageId&&(message.messageId=message.payload.messageId),handler?handler.process({message:message,sender:oSender,mapInstanceId:mapInstanceId,originalMessage:"string"==typeof msg?msg:JSON.stringify(msg)}):emp.typeLibrary.Error({message:"Received a message with no handler over channel "+channel+"."})}},callPublisher=function(args){var publisher,channel=emp.api.cmapi.publisher.intentChannelMap[args.intent];channel?(publisher=cmapi.channel.publisher[channel],publisher?publisher.process(args):emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"Intent "+args.intent+" has no publisher defined. callPublisher."})):emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.CATASTROPHIC,message:"Intent "+args.intent+" has no channel defined. callPublisher."})},transactionComplete=function(oTransaction){var channel,publisher,sOriginChannel=oTransaction.originChannel;if(oTransaction.source!==emp.api.cmapi.SOURCE)switch(oTransaction.intent){case emp.intents.control.FEATURE_ADD:oTransaction.items.length>1?oTransaction.originChannel=cmapi.channel.names.MAP_FEATURE_PLOT_BATCH:oTransaction.items.length>0&&oTransaction.items[0].url?oTransaction.originChannel=cmapi.channel.names.MAP_FEATURE_PLOT_URL:oTransaction.originChannel=cmapi.channel.names.MAP_FEATURE_PLOT,oTransaction.sendTransactionComplete=!0;break;case emp.intents.control.FEATURE_REMOVE:oTransaction.items.length>1?oTransaction.originChannel=cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH:oTransaction.originChannel=cmapi.channel.names.MAP_FEATURE_UNPLOT,oTransaction.sendTransactionComplete=!0;break;case emp.intents.control.OVERLAY_ADD:oTransaction.originChannel=cmapi.channel.names.MAP_OVERLAY_CREATE,oTransaction.sendTransactionComplete=!0;break;case emp.intents.control.OVERLAY_REMOVE:oTransaction.originChannel=cmapi.channel.names.MAP_OVERLAY_REMOVE,oTransaction.sendTransactionComplete=!0;break;case emp.intents.control.EDIT_BEGIN:oTransaction.originChannel=cmapi.channel.names.MAP_FEATURE_EDIT,oTransaction.sendTransactionComplete=!0;break;default:return}channel=emp.api.cmapi.publisher.intentChannelMap[emp.intents.control.TRANSACTION_COMPLETE],publisher=cmapi.channel.publisher[channel],publisher?publisher.process(oTransaction):emp.typeLibrary.Error({message:"Intent "+oTransaction.intent+" has no publisher defined."}),oTransaction.hasOwnProperty("failures")&&oTransaction.failures.length>0&&(publisher=cmapi.channel.publisher[cmapi.channel.names.MAP_ERROR],publisher.process(oTransaction)),oTransaction.originChannel=sOriginChannel},statusChangeHdlr=function(oTrans){var oTransaction;switch(oTrans.items[0].status){case emp.map.states.INITIALIZING:case emp.map.states.READY:case emp.map.states.SHUTDOWN_IN_PROGRESS:case emp.map.states.TEARDOWN:case emp.map.states.MAP_SWAP_IN_PROGRESS:case emp.map.states.MAP_INSTANCE_INIT_FAILED:oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.STATUS_RESPONSE_INIT,mapInstanceId:oTrans.mapInstanceId,sendTransactionComplete:!1,source:emp.api.cmapi.SOURCE,items:oTrans.items}),oTransaction.run()}},publicInterface={init:function(){var i,len,environment=emp.environment.get();for(_widgetId=environment.getInstanceId()||mapInstanceId,len=channels.length,i=0;i<len;i++)environment.pubSub.subscribe({channel:channels[i],callback:messageHandler,mapInstanceId:mapInstanceId});emp.transactionQueue.listener.add({type:emp.intents.control.TRANSACTION_COMPLETE,mapInstanceId:mapInstanceId,callback:transactionComplete}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_RESPONSE_ABOUT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_RESPONSE_FORMAT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_RESPONSE_INIT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_RESPONSE_SELECTED,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_REQUEST_SCREENSHOT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_UPDATE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.DRAW_UPDATE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.FEATURE_CLICK,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.SELECTION_OUTBOUND,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.DESELECTION_OUTBOUND,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.FEATURE_OUTBOUND_PLOT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.SYMBOL_OUTBOUND_PLOT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.POINTER,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.CLICK,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.SELECTION_BOX,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.MENU_CONTEXT_CLICK,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.ERROR,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.MENU_DRAW_FEATURE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.FEATURE_REMOVE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.OVERLAY_REMOVE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.VIEW_CHANGE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.VIEW_GET,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_CHANGE,mapInstanceId:mapInstanceId,callback:statusChangeHdlr}),emp.transactionQueue.listener.add({type:emp.intents.control.FREEHAND_LINE_DRAW_START,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.FREEHAND_LINE_DRAW_END,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.add({type:emp.intents.control.FREEHAND_LINE_DRAW_UPDATE,mapInstanceId:mapInstanceId,callback:callPublisher})},destroy:function(){var i,len,environment=emp.environment.get();for(len=channels.length,i=0;i<len;i++)environment.pubSub.unsubscribe({channel:channels[i],callback:messageHandler,mapInstanceId:mapInstanceId});emp.transactionQueue.listener.remove({type:emp.intents.control.TRANSACTION_COMPLETE,mapInstanceId:mapInstanceId,callback:transactionComplete}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_RESPONSE_ABOUT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_RESPONSE_FORMAT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_RESPONSE_INIT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_RESPONSE_SELECTED,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_REQUEST_SCREENSHOT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.EDIT_UPDATE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.DRAW_UPDATE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.FEATURE_CLICK,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.SELECTION_OUTBOUND,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.DESELECTION_OUTBOUND,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.FEATURE_OUTBOUND_PLOT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.SYMBOL_OUTBOUND_PLOT,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.POINTER,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.CLICK,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.SELECTION_BOX,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.MENU_CONTEXT_CLICK,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.ERROR,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.MENU_DRAW_FEATURE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.FEATURE_REMOVE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.OVERLAY_REMOVE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.VIEW_CHANGE,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.VIEW_GET,mapInstanceId:mapInstanceId,callback:callPublisher}),emp.transactionQueue.listener.remove({type:emp.intents.control.STATUS_CHANGE,mapInstanceId:mapInstanceId,callback:statusChangeHdlr})},processMessage:function(sender,msg,channel){messageHandler(sender,msg,channel)}};return publicInterface},emp.api.cmapiInterface=function(){var sFirstMapInstanceId="",mapInstanceData={},broadcastChannels=[cmapi.channel.names.MAP_OVERLAY_CREATE,cmapi.channel.names.MAP_OVERLAY_REMOVE,cmapi.channel.names.MAP_OVERLAY_UPDATE,cmapi.channel.names.MAP_OVERLAY_STYLE,cmapi.channel.names.MAP_OVERLAY_CLEAR,cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET,cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE,cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE,cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE,cmapi.channel.names.MAP_FEATURE_PLOT,cmapi.channel.names.MAP_FEATURE_PLOT_URL,cmapi.channel.names.MAP_FEATURE_UNPLOT,cmapi.channel.names.MAP_FEATURE_UPDATE,cmapi.channel.names.MAP_GET,cmapi.channel.names.MAP_STATUS_REQUEST,cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,cmapi.channel.names.MAP_MENU_CREATE,cmapi.channel.names.MAP_MENU_REMOVE,cmapi.channel.names.MAP_MENU_ACTIVE],setFirstInstanceId=function(){var aKeyList=emp.helpers.associativeArray.getKeys(mapInstanceData);sFirstMapInstanceId=aKeyList.length>0?aKeyList[0]:""},messageHandler=function(sender,msg,channel){if(!emp.helpers.isEmptyString(sFirstMapInstanceId)){if(void 0===mapInstanceData[sFirstMapInstanceId]&&(setFirstInstanceId(),emp.helpers.isEmptyString(sFirstMapInstanceId)||void 0===mapInstanceData[sFirstMapInstanceId]))return;mapInstanceData[sFirstMapInstanceId].processMessage(sender,msg,channel)}},setupFeatureProcessing=function(){var iIndex,len,environment=emp.environment.get();for(len=broadcastChannels.length,iIndex=0;iIndex<len;iIndex++)environment.pubSub.subscribe({channel:broadcastChannels[iIndex],callback:messageHandler,mapInstanceId:""})},stopFeatureProcessing=function(){var iIndex,len,environment=emp.environment.get();for(len=broadcastChannels.length,iIndex=0;iIndex<len;iIndex++)environment.pubSub.unsubscribe({channel:broadcastChannels[iIndex],callback:messageHandler,mapInstanceId:""})},publicInterface={init:function(){},createMapInstance:function(args){var iMapInstanceCnt,cmapiMapInterface=emp.api.cmapiMapInstanceInterface(args);cmapiMapInterface.init(args),mapInstanceData[args.mapInstanceId]=cmapiMapInterface,iMapInstanceCnt=emp.helpers.associativeArray.size(mapInstanceData),setFirstInstanceId(),1===iMapInstanceCnt&&setupFeatureProcessing()},destroyMapInstance:function(args){var iMapInstanceCnt;mapInstanceData.hasOwnProperty(args.instanceId)&&(mapInstanceData[args.instanceId].destroy(),delete mapInstanceData[args.instanceId],setFirstInstanceId(),iMapInstanceCnt=emp.helpers.associativeArray.size(mapInstanceData),0===iMapInstanceCnt&&stopFeatureProcessing())}};return publicInterface},emp.api.cmapi.publisher.intentChannelMap=function(){var mapping={};return mapping[emp.intents.control.TRANSACTION_COMPLETE]=cmapi.channel.names.MAP_MESSAGE_COMPLETE,mapping[emp.intents.control.ERROR]=cmapi.channel.names.MAP_ERROR,mapping[emp.intents.control.EDIT_UPDATE]=cmapi.channel.names.MAP_MESSAGE_PROGRESS,mapping[emp.intents.control.DRAW_UPDATE]=cmapi.channel.names.MAP_MESSAGE_PROGRESS,mapping[emp.intents.control.FEATURE_OUTBOUND_PLOT]=cmapi.channel.names.MAP_FEATURE_PLOT,mapping[emp.intents.control.SYMBOL_OUTBOUND_PLOT]=cmapi.channel.names.MAP_SYMBOL_FEATURE_PLOT,mapping[emp.intents.control.POINTER]=cmapi.channel.names.MAP_VIEW_CLICKED,mapping[emp.intents.control.CLICK]=cmapi.channel.names.MAP_VIEW_CLICKED,mapping[emp.intents.control.FEATURE_CLICK]=cmapi.channel.names.MAP_FEATURE_CLICKED,mapping[emp.intents.control.SELECTION_OUTBOUND]=cmapi.channel.names.MAP_FEATURE_SELECTED,mapping[emp.intents.control.DESELECTION_OUTBOUND]=cmapi.channel.names.MAP_FEATURE_DESELECTED,mapping[emp.intents.control.VIEW_CHANGE]=cmapi.channel.names.MAP_STATUS_VIEW,mapping[emp.intents.control.SELECTION_BOX]=cmapi.channel.names.MAP_VIEW_AREA_SELECTED,mapping[emp.intents.control.STATUS_RESPONSE_ABOUT]=cmapi.channel.names.MAP_STATUS_ABOUT,mapping[emp.intents.control.STATUS_RESPONSE_FORMAT]=cmapi.channel.names.MAP_STATUS_FORMAT,mapping[emp.intents.control.VIEW_GET]=cmapi.channel.names.MAP_STATUS_VIEW,mapping[emp.intents.control.STATUS_RESPONSE_SELECTED]=cmapi.channel.names.MAP_STATUS_SELECTED,mapping[emp.intents.control.STATUS_RESPONSE_INIT]=cmapi.channel.names.MAP_STATUS_INITIALIZATION,mapping[emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM]=cmapi.channel.names.MAP_STATUS_COORDINATESYSTEM,mapping[emp.intents.control.STATUS_REQUEST_SCREENSHOT]=cmapi.channel.names.MAP_STATUS_SCREENSHOT,mapping[emp.intents.control.FEATURE_REMOVE]=cmapi.channel.names.MAP_FEATURE_UNPLOT,mapping[emp.intents.control.OVERLAY_REMOVE]=cmapi.channel.names.MAP_OVERLAY_REMOVE,mapping[emp.intents.control.FREEHAND_LINE_DRAW_START]=cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW,mapping[emp.intents.control.FREEHAND_LINE_DRAW_END]=cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW,mapping[emp.intents.control.FREEHAND_LINE_DRAW_UPDATE]=cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW,mapping}(),cmapi.typeLibrary.msgComplete=cmapi.typeLibrary.msgComplete||{},cmapi.typeLibrary.msgComplete.status={SUCCESS:"success",MIXED:"mixed",FAILURE:"failure",CANCELLED:"cancelled"},cmapi.typeLibrary.MessageComplete=function(oTransaction){var publicInterface={messageId:oTransaction.transactionId,status:cmapi.typeLibrary.msgComplete.status.SUCCESS,originatingChannel:oTransaction.originChannel,details:{},failures:[]};oTransaction.failures.length>0&&(oTransaction.items.length>0?publicInterface.status=cmapi.typeLibrary.msgComplete.status.MIXED:publicInterface.status=cmapi.typeLibrary.msgComplete.status.FAILURE);for(var oFailure,oFailRec,iIndex=0;iIndex<oTransaction.failures.length;iIndex++)oFailure=oTransaction.failures[iIndex],oFailRec={payload:{},message:""},0===iIndex&&(oFailRec.payload=oTransaction.originalMessage),oFailRec.message=oFailure.message,publicInterface.failures.push(oFailRec);return publicInterface},cmapi.typeLibrary.MessageProgress=function(oTransaction){
var publicInterface={messageId:oTransaction.transactionId,originatingChannel:oTransaction.originChannel,details:{}};return publicInterface},cmapi.channel.schema[cmapi.channel.names.MAP_ERROR]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.error",description:"Map Widget reports errors occurred when attempting to process any message.",type:"object",properties:{sender:{type:"string",default:" ",description:"Sender ID of message that caused error."},type:{type:"string",default:" ",description:"Type of message that caused error."},msg:{type:"object",default:" ",description:"The message that caused error."},error:{type:"string",default:" ",description:"A description of the error."}},required:["sender","type","msg","error"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.deselected.batch",description:"De-Select, or report that a collection of feature objects were de-selected.",type:"object",properties:{payloads:{description:"An array of map.feature.deSelected payload objects.  See map.feature.deSelected for the object format and schema",type:"Array"},overlayId:{description:"The default overlayId to be applied to all map.feature.deSelected objects in the payloads array that don't include an overlayId. I.e., similar behavior to CSS.  See map.feature.deSelected for more details",type:"string",default:""},messageId:{description:"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.",type:"string",extension:"User Manipulation - Message Complete"}},required:["payloads"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_DESELECTED]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.deselected",description:"De-Select, or report that object was de-selected.",properties:{deSelectedId:{description:"The ID of the object to be de-selected (may be a sub-feature contained within the aggregate feature data with the given featureId).",type:"string",default:"N/A"},deSelectedName:{description:"The name of the de-selected object.",type:"string",default:"N/A"},featureId:{description:"The ID of the feature that contains the de-selected object.",type:"string",default:"N/A"},overlayId:{description:"The ID of the overlay which contains the de-selected object. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed.",type:"string",default:"sending widget's ID"},messageId:{description:"A globally unique ID that identifies this particular message.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_HIDE]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.hide",description:"Hide existing feature on the map.",type:"object",properties:{overlayId:{description:"The ID of the overlay where the feature to be hidden is found. If no overlayId is included, default overlay with ID equal to sending widget's ID is assumed.",type:"string",default:"sending widget's ID"},featureId:{description:"The ID of the feature to be hidden.",type:"string",default:"N/A"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId"]},cmapi.channel.schema["map.feature.plot.batch"]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.plot.batch",description:"Plots a batch of feature data on the map.",type:"object",properties:{features:{description:"An array of map.feature.plot payloads minus the messageId property.  See map.feature.plot for the object format and schema",type:"Array"},overlayId:{description:"The default overlayId to be applied to all feature objects in the features array that don’t include an overlayId. I.e., similar behavior to CSS.  See map.feature.plot for more details",type:"string",default:""},format:{description:"The default format to be applied to all feature objects in the features array that don’t include a format value. I.e., similar behavior to CSS.  See map.feature.plot for definition of format property.",type:"string",default:""},zoom:{description:"Whether the map should zoom to the newly loaded feature data.  See map.feature.plot for definition of format property.",type:"boolean",default:""},readOnly:{description:"The default value for readOnly to be applied to all feature objects in the features array that don’t include a readOnly value. I.e., similar behavior to CSS.  See map.feature.plot for definition of readOnly property.",type:"boolean",default:""},messageId:{description:"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.",type:"string",extension:"User Manipulation - Message Complete"},menuId:{description:"The default format to be applied to all feature objects in the features array that don’t include a menuId value. I.e., similar behaviour to CSS.  See map.feature.plot for definition of menuId property.",type:"string",extension:"User Manipulation - Context Menus"}},required:["features"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_PLOT]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.plot",description:"Plots feature data on the map.",type:"object",properties:{overlayId:{description:"The ID of the overlay this feature should be loaded into. If an overlay with this ID already exists, the new feature is merged into existing overlay; otherwise, a new overlay is created. If no overlayId is included, default overlay with ID equal to sending widget's ID is used. If an overlay exists, it will retain its status (whether visible or hidden). If an overlay is created, it will be made visible.",type:"string",default:"sending widget's ID"},featureId:{description:"Unique identifier for the given feature data. Note that feature IDs MUST be unique within a given overlay. Reusing a feature ID will be considered a reload, with the original feature data being removed and replaced by the new feature data.",type:"string",default:"N/A"},name:{description:"Name for the given feature data. Note that feature names do not have to be unique and are intended for display purposes only.",type:"string",default:"N/A"},format:{description:"Data format of the given feature. All map implementations MUST support kml and geojson.  If no format is specified, the format defaults to kml. A list of formats supported by a particular map implementation may be obtained by querying the map using the map.status channel (see map.status).",type:"string",default:"kml"},feature:{description:"Feature data to be loaded into the map.   See Appendix A for additional information on required KML support, Appendix B for information on required GeoJSON, and Appendix C for information on Area of Interest (AOI) support.",type:["object","string"],additionalProperties:!0,default:"N/A"},zoom:{description:"true if map should zoom to newly loaded feature data, false if not. Default is false.",type:"boolean",default:!1},readOnly:{description:"Valid values are true or false. If true, then the end user MUST NOT be able to edit the feature from the map’s user interface, if false the end user MAY edit the feature from the map’s user interface. Default value is true.   If an edit takes place, the map SHOULD dispatch a map.feature.plot with the updated feature to ensure other widgets are aware that a change took place.",type:"boolean",default:!0},properties:{additionalProperties:!0,description:"A free form object that can contain any additional JSON objects or elements to send with this message. This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.",type:"object",status:"new"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"},menuId:{description:"The id of a context menu. If populated, the context menu MUST have already been pre-registered via the map.menu.create channel. If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu. If no menuId is assigned, the feature will not have a context menu associated when right-clicked.",type:"string",status:"new",extension:"User Manipulation - Context Menus"}},required:["featureId","feature"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_PLOT_URL]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.plot.url",description:"Have the map plot feature data from a Uniform Resource Locator (URL).",type:"object",properties:{overlayId:{description:"The ID of the overlay this feature should be loaded into. If an overlay with this ID already exists, new feature is merged into existing overlay; otherwise, a new overlay will be created. If no overlayId is included, default overlay with ID equal to sending widget's ID is used. If overlay exists, it will retain its status (whether visible or hidden). If overlay is created, it will be made visible.",required:!1,type:"string",default:"sending widget's ID"},featureId:{description:"Unique identifier for the given feature data. Note that feature ids must be unique within a given overlay. Reusing a feature id will be considered a reload with the original feature data being removed and replaced by the new feature data.",required:!0,type:"string",default:"N/A"},name:{description:"Name for the given feature data. Note that feature names do not have to be unique and are intended for display purposes only.",required:!1,type:"string",default:"N/A"},format:{description:"Data format of the given feature. If no format is specified, the format defaults to kml. A list of formats supported by a particular map implementation can be obtained by querying the map using the map.status channel (see map.status). Note that for this version of the Common Map Widget API, all map implementations MUST support KML, GeoJSON, and WMS (GetMap only).",required:!1,type:"string",default:"kml"},url:{description:"URL from which to retrieve the feature data to load onto the map",required:!0,type:"string",default:"N/A"},params:{description:"A JSON object containing a list of parameters to be passed to the server along with the URL when loading WMS data. Params object is ignored unless format is set to wms.  Note that request, exceptions, SRS/CRS, width, height, and bbox params should not be passed in as they are determined by the map as needed and will be ignored if passed. Params as passed will be concatenated to the URL and are expected to follow the WMS specification.   All parameters passed in must not be URL encoded (the map widget implementation will URL encode all passed in params).",type:"object",required:[],default:"N/A"},zoom:{description:"true if map should zoom to newly loaded feature data, false if not. Default is false.  Ignored when loading WMS data.",required:!1,type:"boolean",default:!1},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId","url"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.selected.batch",description:"Select, or report that a collection of feature objects were selected.",type:"object",properties:{payloads:{description:"An array of map.feature.selected payload objects.  See map.feature.selected for the object format and schema",type:"Array"},overlayId:{description:"The default overlayId to be applied to all map.feature.selected objects in the payloads array that don't include an overlayId. I.e., similar behavior to CSS.  See map.feature.selected for more details",type:"string",default:""},messageId:{description:"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.",type:"string",extension:"User Manipulation - Message Complete"}},required:["payloads"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.selected",description:"Select, or report that object was selected.",properties:{selectedId:{description:"The ID of the object to be selected (may be a sub-feature contained within the aggregate feature data with the given featureId).",type:"string",default:"N/A"},selectedName:{description:"The name of the selected object.",type:"string",default:"N/A"},featureId:{description:"The ID of the feature that contains the selected object.",type:"string",default:"N/A"},overlayId:{description:"The ID of the overlay which contains the selected object. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed.",type:"string",default:"sending widget's ID"},messageId:{description:"A globally unique ID that identifies this particular message.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId"]},cmapi.channel.schema["map.feature.show"]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.show",description:"Have the map show previously hidden feature data.",type:"object",properties:{overlayId:{description:"The ID of the overlay where the feature to be shown is found. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed.",type:"string",default:"sending widget's ID"},featureId:{description:"The ID of the feature to be shown.",type:"string",default:"N/A"},zoom:{description:"true if map should zoom to the shown feature, false if not. Default is false.",type:"boolean",default:!1},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.unplot.batch",description:"Remove collection of features from the map.",type:"object",properties:{payloads:{description:"An array of map.feature.unplot payloads minus the messageId.  See map.feature.unplot for the object format and schema",type:"Array"},overlayId:{description:"when included at the array level, this value will be applied to all map.feature.unplot objects in the features array that don't include an overlayID. I.e., similar behavior to CSS.  See map.feature.unplot for definition of this property",type:"string",default:""},messageId:{description:"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.",type:"string",extension:"User Manipulation - Message Complete"}},required:["payloads"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UNPLOT]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.unplot",description:"Removes feature data from the map.",type:"object",properties:{overlayId:{description:"The ID of the overlay where the feature to be removed is found. If no overlayId is included, default overlay with an ID equal to sending widget's ID is assumed.",type:"string",default:"sending widget's ID"},featureId:{description:"The ID of the feature to be removed.",type:"string",default:"N/A"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId"]},cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UPDATE]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.feature.update",description:"Update an existing feature on the map.",type:"object",properties:{overlayId:{description:"The ID of the overlay where the feature to be updated is currently found. If no overlayId is included, default overlay with ID equal to sending widget's ID is assumed.",type:"string",default:"sending widget's ID"},featureId:{description:"The ID of the feature to be updated",type:"string",default:"N/A"},name:{description:"If the name provided differs from the feature's current name, the display value will be changed to show the new value.  If no value is provided, the feature name will remain unchanged.",type:"string",default:"N/A"},newOverlayId:{description:"This represents the ID of an overlay to move the feature to.  If this attribute is provided, the feature MUST be removed from its current overlay and added to the overlay with this ID.  If an overlay with an ID of newOverlayId does not exist, a new overlay will be created with an ID of newOverlayId, and the feature to be updated will be moved to the overlay identified by newOverlayId.",type:"string",default:"N/A"},properties:{additionalProperties:!0,description:"A free form object that can contain any additional JSON objects or elements to send with this message. This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.",type:"object",status:"new"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"},menuId:{description:"The id of a context menu. If populated, the context menu MUST have already been pre-registered via the map.menu.create channel. If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu. If no menuId is assigned, the feature will not have a context menu associated when right-clicked.",type:"string",status:"new",extension:"User Manipulation - Context Menus"}},required:["featureId"]},cmapi.channel.schema["map.overlay.create"]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.overlay.create",description:"Create an overlay into which data can be aggregated.",properties:{name:{description:"The name of the overlay. If not included, the ID is used as the name. Note that overlay names do not have to be unique and are intended for display purposes only.",type:"string",default:"N/A"},overlayId:{description:"The unique ID of the new overlay. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed. If an overlay with the given ID already exists, this message will have no effect. Note that overlay IDs must be unique even across multiple parent overlays.",type:"string",default:"sending widget's ID"},parentId:{description:"The ID of the parent overlay in which to create this overlay. If an overlay with an ID of parentId does not exist, a new overlay will be created with an ID of parentId, and the parentage of the overlay identified by overlayId will be set to the newly created parent overlay.",type:"string",default:"N/A"},properties:{description:"A free form object that can contain any additional JSON objects or elements to send with this message.  This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.",type:"object",status:"new"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"},menuId:{description:"The id of a context menu.  If populated, the context menu MUST have already been pre-registered via the map.menu.create channel.  If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu.  If no menuId is assigned, the feature will not have a context menu associated when right-clicked.",type:"string",status:"new",extension:"User Manipulation - Context Menus"}},required:[]},cmapi.channel.schema["map.overlay.hide"]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.overlay.hide",description:"Hide existing overlay on the map.",properties:{overlayId:{description:"The ID of the overlay to be hidden. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed. ",type:"string",default:"sending widget's ID"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:[]},cmapi.channel.schema["map.overlay.remove"]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.overlay.remove",description:"Remove entire overlay from the map.",properties:{overlayId:{description:"The ID of the overlay to be removed. If no overlayId is included, default overlay with ID equal to sending widget's ID is assumed. ",type:"string",default:"sending widget's ID"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:[]},cmapi.channel.schema["map.overlay.show"]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.overlay.show",description:"Show existing overlay on the map.",properties:{overlayId:{description:"The ID of the overlay to be shown. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed.",type:"string",default:"sending widget's ID"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:[]},cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_UPDATE]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.overlay.update",description:"Update an existing overlay.",properties:{name:{description:"The new name of the overlay. Note that overlay names do not have to be unique and are intended for display purposes only.",type:"string",default:"N/A"},overlayId:{description:"The unique ID of the overlay being updated. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed. If an overlay with the given ID already exists, this message will update that overlay. If an overlay with the given ID does not exist, an error is generated.  Note that overlay IDs MUST be unique even across multiple parent overlays.",type:"string",default:"sending widget's ID"},parentId:{description:"The ID of the parent overlay that is associated with this overlay.  If no ID is provided, the overlay will keep its existing parentage.  If a parentId is provided, the parentage of the overlay will be changed to the new parentId.  If an overlay with an ID of parentId does not exist, a new overlay will be created and the parentage of the overlay identified by overlayId will be changed to the newly created parent overlay.",type:"string",default:"N/A"},properties:{description:"A free form object that can contain any additional JSON objects or elements to send with this message. This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.",type:"object",status:"new"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"},menuId:{description:"The id of a context menu. If populated, the context menu MUST have already been pre-registered via the map.menu.create channel. If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu. If no menuId is assigned, the feature will not have a context menu associated when right-clicked.",type:"string",status:"new",extension:"User Manipulation - Context Menus"}},required:[]},cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_ABOUT]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.status.about",description:"Send out static information about the map implementation",type:"object",properties:{version:{type:"string",default:" ",description:"A comma delimited list of the version numbers of the Common Map Widget API that this map widget supports."},type:{enum:["2-D","3-D","other"],default:" ",description:"The type of map in the map widget.  Allowable values are 2-D, 3-D, or other."},widgetName:{type:"string",default:" ",description:"The registered name of the map widget which is consistent across all version of OWF and cannot change during a user's session. "},instanceName:{type:"string",default:"N/A",description:"The name of the widget on the users dashboard.  This name can be changed by the end user and by the widget developer in code so this name may change during a user's session.  "},universalName:{type:"string",default:"N/A",description:"The universal name of the map widget set in the widget registration.  This is not available in all versions of OWF."},extensions:{description:"An array of optional extensions that the widget supports.  Allowable values are intents, clustering, and userManipulation.  If no extensions are supported, then an empty array SHALL be sent.",type:["array","enum"],default:"N/A",uniqueItems:!0,items:{anyOf:["intents","clustering","userManipulation","selected",null]}}},required:["version","type","widgetName","extensions"]},cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_FORMAT]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.status.format",description:"Send out the list of data formats that the map widget supports; in other words, this map implementation supports the following feature data formats.",type:"object",properties:{formats:{description:"An array of the formats that this map supports. Note that for this version of the Common Map Widget API, all map implementations MUST support 'kml', 'geojson' and 'wms'.  Additional map formats MAY be supported.",type:"array",uniqueItems:!0,default:["kml"],items:{anyOf:["kml","geojson","wms"]}}},required:["formats"]},cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_INITIALIZATION]={
$schema:"http://json-schema.org/draft-04/schema#",title:"map.status.initialization",description:"To receive notification of map events including the readiness, initialization and teardown of the map.",type:"object",properties:{status:{description:"Indicates the current state of the map.  This can be one of the following options: init, ready, teardown. 1.init - means the map has been launched but is not ready to begin accepting commands. 2.ready -  means the map is ready to begin accepting commands.  A map will be ready once it has finished loading. 3.teardown - indicates the user has closed the map and it is no longer available to use. 4.mapswapinprogress - A map swap process has started. A 'ready' status is issued when the process completes.",enum:["init","ready","teardown","mapswapinprogress"]}},required:["status"]},cmapi.channel.mapStatusRequest={requestTypes:{STATUS_REQUEST_ABOUT:"about",STATUS_REQUEST_FORMAT:"format",STATUS_REQUEST_VIEW:"view",STATUS_REQUEST_SELECTED:"selected",STATUS_REQUEST_SCREENSHOT:"screenshot",STATUS_REQUEST_INIT:"initialization",STATUS_REQUEST_COORD_SYSTEM:"coordinatesystem"}},cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_REQUEST]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.status.request",description:"Request current status from the map. Map will send out requested map.status.xyz messages in response.",type:"object",properties:{types:{description:"An array of status types being requested. Map widgets MUST support status types of 'about', 'format', 'selected', 'view', and 'initialization' and MUST respond with the applicable status message (e.g., map.status.about, map.status.format, map.status.selected, map.status.view, and/or map.status.initialization). If the types attribute is not included, all status messages MUST be generated.",type:"array",items:{enum:["view","format","selected","about","initialization"]}}},required:[]},cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_SELECTED]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.status.selected",description:"Send out the list of currently selected features.",type:"object",properties:{overlayId:{type:"string",default:" ",description:"The ID of the overlay which contains the selected objects."},selectedFeatures:{description:"An array of features from the identified overlay that are currently selected.",type:"array",default:" ",properties:{selectedFeature:{description:"Individual selected feature object",type:"object",properties:{featureId:{type:"string",description:"The ID of the feature that contains the selected object."},selectedId:{type:"string",description:"The ID of the actual selected object (may be a sub-feature contained within the aggregate feature data with the given featureId)."},selectedName:{type:"string",description:"The name of the selected object."}},required:["featureId"]}}}},required:["overlayId","selectedFeatures"]},cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_VIEW]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.status.view",description:"Send out the current status of the map view",type:"object",properties:{bounds:{description:"Bounding box of area visible on map.",type:"object",default:" ",properties:{southWest:{description:"Bottom right of the bounds",type:"object",properties:{lat:{type:"number",description:"The latitude value of the point",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude value of the point",minimum:"-180",maximum:"180"}},required:["lat","lon"]},northEast:{description:"Top left of the bounds",type:"object",properties:{lat:{type:"number",description:"The latitude value of the point",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude value of the point",minimum:"-180",maximum:"180"}},required:["lat","lon"]}},required:["southWest","northEast"]},center:{type:"object",default:" ",description:"The current center of the map",properties:{lat:{type:"number",description:"The latitude of the location that was clicked",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude of the location that was clicked",minimum:"-180",maximum:"180"}},required:["lat","lon"]},range:{description:"The current distance, in meters, map is zoomed out",type:"number"},requester:{description:"ID of client that requested this status message be sent (if any).  If no requester, message is being sent due to a map view change",type:"string",status:"updated"}},required:["bounds","center","range"]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.center.bounds",description:"Center the map on a particular bounding box. The map may also be zoomed to show the entire bounds (if possible) or to show a given range.",type:"object",properties:{bounds:{description:"Bounding box of area to be centered in map.",type:"object",default:" ",properties:{southWest:{description:"Bottom right of the bounds",type:"object",properties:{lat:{type:"number",description:"The latitude value of the point",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude value of the point",minimum:"-180",maximum:"180"}},required:["lat","lon"]},northEast:{description:"Top left of the bounds",type:"object",properties:{lat:{type:"number",description:"The latitude value of the point",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude value of the point",minimum:"-180",maximum:"180"}},required:["lat","lon"]}},required:["southWest","northEast"]},zoom:{description:"Attribute that defines the zoom behaviour of the map. If auto, map will adjust to zoom as close as possible to the given location in the user's viewable area. If a number, map will zoom to specified range in meters. If no zoom attribute is included, no zoom is performed.",type:["string","number"],default:" "},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["bounds"]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_FEATURE]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.center.feature",description:"Center the map on a particular feature. The map may also be zoomed to show the entire feature (if possible) or to show a given range.",type:"object",properties:{overlayId:{description:"The ID of the overlay overlay where the feature to be centered on is found. If no overlayId is included, default overlay with ID equal to sending widget ID is assumed.",type:"string",default:"sending widget's ID"},featureId:{description:"The ID of the feature to center on",type:"string",default:"N/A"},zoom:{description:"Attribute that defines the zoom behaviour of the map. If auto, map will adjust to best fit the feature in the user's viewable area. If a number, map will zoom to specified range in meters. If no zoom attribute is included, no zoom is performed.",type:["string","number"],default:"N/A"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["featureId"]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.center.location",description:"Center the map on a particular location. The map may also be zoomed as close as possible to the location or to a given range",type:"object",properties:{location:{description:"Location to be centered in map.",default:"N/A",type:"object",properties:{lat:{type:"number",description:"The latitude value of the point",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude value of the point",minimum:"-180",maximum:"180"}},required:["lat","lon"]},zoom:{description:"If auto, map will adjust to zoom as close as possible to the given location in the user's viewable area. If a number, map will zoom to specified range in meters. If no zoom attribute is included, no zoom is performed.",type:["string","number"],default:"N/A"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["location"]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.center.overlay",description:"Center the map on a particular overlay. The map may also be zoomed to show the entire overlay (if possible) or to show a given range",type:"object",properties:{overlayId:{description:"The ID of the overlay to center on. If no overlayId is included, default overlay with ID equal to sending widget’s ID is assumed.",type:"string",default:"sending widget's ID"},zoom:{description:"Attribute that defines the zoom behaviour of the map. If auto, zoom will adjust to best fit the overlay in the user's viewable area.  If a number, map will zoom to specified range in meters.  If no zoom attribute is included, no zoom is performed.",type:"string",default:"N/A"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:[]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.lookat.location",description:"Centers the camera on a particular location.",type:"object",properties:{latitude:{type:"number",description:"The latitude value of the location",minimum:"-90",maximum:"90",default:"0"},longitude:{type:"number",description:"The longitude value of the location",minimum:"-180",maximum:"180",default:"0"},altitude:{type:"number",description:"The altitude value of the location",default:"0"},heading:{type:"number",description:"Direction (that is, North, South, East, West), in degrees. Default=0(North)",minimum:"0",maximum:"360",default:"0"},tilt:{type:"number",description:"Angle between the direction of the LookAt position and the normal to the surface of the Earth. A value of -90 indicates viewing directly down from above while 0 looks directly  at the horizon",minimum:"-90",maximum:"90",default:"-90"},range:{description:"Distance in meters from the location specified",type:"number",default:"N/A"},altitudeMode:{description:"Specifies how the <altitude> specified for the LookAt point is interpreted.",type:"string",default:"clampToGround"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["range"]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CLICKED]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.clicked",description:"'Click', or report that map was clicked",type:"object",properties:{lat:{type:"number",description:"The latitude of the location that was clicked",default:"N/A",minimum:"-90",maximum:"90"},lon:{type:"number",description:"The longitude of the location that was clicked",default:"N/A",minimum:"-180",maximum:"180"},button:{description:"Which mouse button was clicked.  Allowable values are right, left, and middle.  For backwards compatibility, if this attribute is not populated it MUST be treated as a left mouse click the same as if it were populated with left.",type:["string","enum"],enum:["left","middle","right"],default:"left"},type:{description:"The type of click event. Allowable values are single and double.  For backwards compatibility, if this attribute is not populated it MUST be assumed to be a single mouse click and treated the same as if it were populated with single.",type:["string","enum"],enum:["single","double"],default:"single"},keys:{description:"An array of keys pressed during the click event.  Allowable values are alt, ctrl, shift, and none. For backwards compatibility, if this attribute is not populated it MUST be assumed that no additional keys were pressed and behave the same way as if it were populated with none.",type:"array",uniqueItems:!0,default:["none"],items:{enum:["shift","alt","ctrl","none"]}}},required:["lat","lon","button","keys","type"]},cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_ZOOM]={$schema:"http://json-schema.org/draft-04/schema#",title:"map.view.zoom",description:"Zoom the map to a particular range",type:"object",properties:{range:{description:"The distance in meters from the map (note that most 2-D map renderers do not support infinite zoom and the range will be translated into the nearest supported zoom level).",type:"number",default:"N/A"},messageId:{description:"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.",type:"string",status:"new",extension:"User Manipulation - Message Complete"}},required:["range"]},cmapi.channel.handler[cmapi.channel.names.CMAPI2_VISIBILITY_GET]={process:function(args){var oTransaction,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VISIBILITY_GET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.CMAPI2_VISIBILITY_GET,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.CMAPI2_VISIBILITY_GET,items:[{coreId:message.payload[0].targetId,parentId:message.payload[0].parentId,visible:void 0}]}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.CMAPI2_MAP_CONFIG]={process:function(args){var configTransaction,labelTransaction,labels,labelItem,message=args.message,sender=args.sender,configItem={};Array.isArray(message.payload)||(message.payload=[message.payload]),configTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MAP_CONFIG,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.CMAPI2_MAP_CONFIG,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,items:[],originalMessageType:cmapi.channel.names.CMAPI2_MAP_CONFIG}),labelTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MIL_ICON_LABELS_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.CMAPI2_MAP_CONFIG,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,items:[],originalMessageType:cmapi.channel.names.CMAPI2_MAP_CONFIG});for(var prop in message.payload[0])"milStdLabels"===prop?(labels=this.getMilStdLabelList(message.payload[0][prop]),labelItem=labels):configItem[prop]=message.payload[0][prop];labelItem&&(labelTransaction.items.push(labelItem),labelTransaction.queue()),configItem&&(configTransaction.items.push(configItem),configTransaction.queue())},getMilStdLabelList:function(labelOption){var labels=[];return labels.push("V"),labels.push("L"),labels.push("S"),labels.push("AA"),labels.push("AB"),labels.push("AC"),labelOption===emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS&&(labels.push("H"),labels.push("M"),labels.push("T"),labels.push("T1"),labels.push("CN")),labelOption===emp3.api.enums.MilStdLabelSettingEnum.ALL_LABELS&&(labels.push("H"),labels.push("M"),labels.push("T"),labels.push("T1"),labels.push("CN"),labels.push("C"),labels.push("F"),labels.push("G"),labels.push("H1"),labels.push("H2"),labels.push("J"),labels.push("K"),labels.push("N"),labels.push("P"),labels.push("W"),labels.push("W1"),labels.push("X"),labels.push("Y"),labels.push("Z")),labels}},cmapi.channel.handler[cmapi.channel.names.CMAPI2_FREEHAND_START]={process:function(args){var transaction,item,message=args.message,sender=args.sender;transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FREEHAND_START,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.CMAPI2_FREEHAND_START,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,items:[],originalMessageType:cmapi.channel.names.CMAPI2_FREEHAND_START}),item={freehandStrokeStyle:args.message.payload.strokeStyle},transaction.items.push(item),transaction.queue()}},cmapi.channel.handler[cmapi.channel.names.CMAPI2_FREEHAND_STOP]={process:function(args){var transaction,message=args.message,sender=args.sender;transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FREEHAND_STOP,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.CMAPI2_FREEHAND_STOP,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,items:[{}],originalMessageType:cmapi.channel.names.CMAPI2_FREEHAND_STOP}),transaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_CONVERT]={process:function(args){var xyTransaction,latlonTransaction,payload,oItem,message=args.message,sender=args.sender,xyToLatlonItems=[],latlonToXYItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]);for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)switch(payload=message.payload[iIndex],payload.conversionType||(payload.conversionType="offsetPixelToDecimalDegrees"),payload.conversionType){case"offsetPixelToDecimalDegrees":oItem=new emp.typeLibrary.Convert({y:payload.y,x:payload.x}),xyToLatlonItems.push(oItem);break;case"decimalDegreesToOffsetPixel":oItem=new emp.typeLibrary.Convert({lat:payload.y,lon:payload.x}),latlonToXYItems.push(oItem)}xyToLatlonItems.length>0&&(xyTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.GET_LATLON_FROM_XY,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.MAP_CONVERT,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_CONVERT,items:xyToLatlonItems}),xyTransaction.queue()),latlonToXYItems.length>0&&(latlonTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.GET_XY_FROM_LATLON,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.MAP_CONVERT,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_CONVERT,items:latlonToXYItems}),latlonTransaction.queue())}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_CLEAR]={process:function(args){var oTransaction,payload,oItem,oStorageItem,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]);for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)if(payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),oStorageItem=emp.storage.get.byIds(payload),void 0===oStorageItem)oItem=new emp.typeLibrary.Feature({overlayId:payload.overlayId,parentId:payload.parentId,featureId:payload.featureId}),oItems.push(oItem);else switch(oStorageItem.globalType){case emp.typeLibrary.types.WMS:oItem=oStorageItem.createDuplicate(),oItems.push(oItem);break;case emp.typeLibrary.types.FEATURE:default:oItem=oStorageItem.createDuplicate(),oItems.push(oItem)}oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_CLEAR,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_CLEAR,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH]={process:function(args){var featureTransaction,i,len,payload,item,sOverlayId,featureItems=[],cmapiBatchMsg=args.message.payload,sender=args.sender,oaBatchPayload=cmapiBatchMsg.features;for(featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.SELECTION_SET,mapInstanceId:args.mapInstanceId,transactionId:cmapiBatchMsg.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH,items:featureItems}),cmapiBatchMsg.hasOwnProperty("overlayId")&&(sOverlayId=cmapiBatchMsg.overlayId),len=oaBatchPayload.length,i=0;i<len;i+=1)payload=oaBatchPayload[i],item={},void 0!==payload.overlayId&&null!==payload.overlayId||(sOverlayId?payload.overlayId=sOverlayId:payload.overlayId=sender.id),item=new emp.typeLibrary.Selection({overlayId:payload.overlayId,featureId:payload.featureId,parentId:payload.parentId,selectedId:payload.selectedId,selectedName:payload.selectedName,select:!1,transactionId:featureTransaction.transactionId}),featureItems.push(item);featureTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_DESELECTED]={process:function(args){var featureTransaction,i,len,payload,item,featureItems=[],message=args.message,sender=args.sender;for(featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.SELECTION_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_DESELECTED,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_DESELECTED,items:featureItems}),Array.isArray(message.payload)||(message.payload=[message.payload]),len=message.payload.length,i=0;i<len;i+=1)payload=message.payload[i],item={},void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),item=new emp.typeLibrary.Selection({overlayId:payload.overlayId,featureId:payload.featureId,parentId:payload.parentId,selectedId:payload.deSelectedId,selectedName:payload.deSelectedName,select:!1,transactionId:featureTransaction.transactionId}),featureItems.push(item);featureTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_DRAW]={process:function(args){var oTransaction,payload,oItem,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]);for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),oItem=new emp.typeLibrary.Draw({overlayId:payload.overlayId,parentId:payload.parentId,featureId:payload.featureId,type:payload.type,name:payload.name,symbolCode:payload.symbolCode,coordinates:payload.coordinates,properties:payload.properties,menuId:payload.menuId}),oItem.source=emp.api.cmapi.SOURCE,oItem.transactionId=message.messageId,oItems.push(oItem);oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.DRAW_BEGIN,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_DRAW,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_DRAW,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_EDIT]={process:function(args){var transaction,payload,item,message=args.message,sender=args.sender,items=[];Array.isArray(message.payload)||(message.payload=[message.payload]);for(var i=0,length=message.payload.length;i<length;i++)payload=message.payload[i],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),item=new emp.typeLibrary.Edit(payload),item.transactionId=message.messageId,items.push(item);transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.EDIT_BEGIN,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_EDIT,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_EDIT,items:items}),transaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_HIDE]={process:function(args){var oTransaction,oItem,payload,oItems=[],message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VISIBILITY_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_HIDE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_HIDE,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],emp.helpers.isEmptyString(payload.overlayId)&&(payload.overlayId=sender.id),oItem={overlayId:payload.overlayId,featureId:payload.featureId,visible:!1,zoom:!1},emp.helpers.isEmptyString(payload.parentId)||(oItem.parentId=payload.parentId),oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT_BATCH]={process:function(args){var oTransaction,feature,oItem,iLength,iIndex,message=args.message,sender=args.sender,payload=message.payload,oItems=[],sOverlayId=payload.overlayId,sParentId=payload.parentId,sFormat=payload.format,bZoom=payload.zoom===!0,bReadOnly=payload.readOnly===!0,sMenuId=payload.menuId;for(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:args.mapInstanceId,transactionId:payload.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,items:oItems}),iIndex=0,iLength=payload.features.length;iIndex<iLength;iIndex++)feature=payload.features[iIndex],emp.helpers.isEmptyString(feature.overlayId)&&(sOverlayId?feature.overlayId=sOverlayId:feature.overlayId=sender.id),emp.helpers.isEmptyString(feature.parentId)&&sParentId&&(feature.parentId=sParentId),emp.helpers.isEmptyString(feature.format)&&sFormat&&(feature.format=sFormat),void 0!==feature.zoom&&null!==feature.zoom||(feature.zoom=bZoom),void 0!==feature.readOnly&&null!==feature.readOnly||(feature.readOnly=bReadOnly),emp.helpers.isEmptyString(feature.menuId)&&sMenuId&&(feature.menuId=sMenuId),oItem=new emp.typeLibrary.Feature({overlayId:feature.overlayId,parentId:feature.parentId,featureId:feature.featureId,name:feature.name,format:feature.format,data:feature.feature,zoom:feature.zoom,readOnly:feature.readOnly,menuId:feature.menuId,properties:feature.properties,visible:feature.visible}),oItem.format!==emp.typeLibrary.featureFormatType.GEOJSON&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_POINT&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_POLYGON&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_SQUARE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_TEXT||cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT].mergeGeoJSONStyles(oItem),oItem.validate(),oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT]={process:function(args){var oTransaction,payload,oItem,iLength,iIndex,message=args.message,sender=args.sender,oItems=[];for(Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT,items:oItems}),iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),oItem=new emp.typeLibrary.Feature({overlayId:payload.overlayId,parentId:payload.parentId,featureId:payload.featureId,name:payload.name,format:payload.format,data:payload.feature,zoom:payload.zoom,readOnly:payload.readOnly,menuId:payload.menuId,properties:payload.properties,visible:payload.visible}),oItem.format!==emp.typeLibrary.featureFormatType.GEOJSON&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_POINT&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_POLYGON&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_SQUARE&&oItem.format!==emp3.api.enums.FeatureTypeEnum.GEO_TEXT||this.mergeGeoJSONStyles(oItem),oItem.validate(),oItems.push(oItem);oTransaction.queue()},mergeGeoJSONStyles:function(oFeature){if(oFeature.hasOwnProperty("properties")){if(oFeature.properties.hasOwnProperty("iconUrl"))return}else oFeature.properties={};if(oFeature.hasOwnProperty("data")){var geojson=oFeature.data;if("string"==typeof oFeature.data)try{geojson=JSON.parse(oFeature.data)}catch(oError){return}geojson.hasOwnProperty("type")&&"feature"===geojson.type.toLowerCase()&&geojson.hasOwnProperty("properties")&&geojson.properties.hasOwnProperty("style")&&geojson.properties.style.hasOwnProperty("iconStyle")&&geojson.properties.style.iconStyle.hasOwnProperty("url")&&(oFeature.properties.iconUrl=geojson.properties.style.iconStyle.url)}}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT_URL]={process:function(args){var featureTransaction,mapServiceTransaction,i,len,payload,item,visible,layers,bUseProxy,mapServiceItems=[],featureItems=[],message=args.message,sender=args.sender;
for(Array.isArray(message.payload)||(message.payload=[message.payload]),len=message.payload.length,i=0;i<len;i+=1)switch(payload=message.payload[i],item={},visible=!0,layers=[],bUseProxy=payload.useProxy,void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),visible=!0,void 0!==payload.visible&&payload.visible===!1&&(visible=!1),payload.hasOwnProperty("format")||(payload.format="kml"),payload.format.toLowerCase()){case"wms":payload.hasOwnProperty("params")&&payload.params.hasOwnProperty("layers")&&(emp.util.isEmptyString(payload.params.layers)?Array.isArray(payload.params.layers)&&(layers=payload.params.layers,delete payload.params.layers):(layers=payload.params.layers.split(","),delete payload.params.layers)),item=new emp.typeLibrary.WMS({id:payload.featureId,overlayId:payload.overlayId,visible:visible,layers:layers,zoom:payload.zoom,name:payload.name,format:payload.format,url:payload.url,useProxy:bUseProxy,params:payload.params,transactionId:message.messageId,messageId:payload.messageId,intent:emp.intents.control.MAP_SERVICE_ADD}),mapServiceItems.push(item);break;case"wmts":item=new emp.typeLibrary.WMTS({id:payload.featureId,overlayId:payload.overlayId,visible:visible,name:payload.name,layer:payload.layer,format:payload.format,url:payload.url,useProxy:bUseProxy,params:payload.params,transactionId:message.messageId,messageId:payload.messageId,intent:emp.intents.control.MAP_SERVICE_ADD}),mapServiceItems.push(item);break;case"kmllayer":item=new emp.typeLibrary.KmlLayer({id:payload.featureId,overlayId:payload.overlayId,visible:visible,name:payload.name,kmlData:payload.kmlString,format:payload.format,url:payload.url,useProxy:bUseProxy,transactionId:message.messageId,messageId:payload.messageId,intent:emp.intents.control.MAP_SERVICE_ADD}),mapServiceItems.push(item);break;case"geojson":default:item=new emp.typeLibrary.Feature({featureId:payload.featureId,parentId:payload.parentId,overlayId:payload.overlayId,visible:visible,zoom:payload.zoom,name:payload.name,format:payload.format,url:payload.url,params:payload.params,properties:payload.properties}),item.validate(),featureItems.push(item)}featureItems.length>0&&(featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_ADD,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT_URL,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT_URL,items:featureItems}),featureTransaction.queue()),mapServiceItems.length>0&&(mapServiceTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MAP_SERVICE_ADD,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_PLOT_URL,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_PLOT_URL,items:mapServiceItems}),mapServiceTransaction.queue())}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH]={process:function(args){var featureTransaction,i,len,payload,item,sOverlayId,featureItems=[],cmapiBatchMsg=args.message.payload,sender=args.sender,oaBatchPayload=cmapiBatchMsg.features;for(featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.SELECTION_SET,mapInstanceId:args.mapInstanceId,transactionId:cmapiBatchMsg.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH,items:featureItems}),cmapiBatchMsg.hasOwnProperty("overlayId")&&(sOverlayId=cmapiBatchMsg.overlayId),len=oaBatchPayload.length,i=0;i<len;i+=1)payload=oaBatchPayload[i],item={},void 0!==payload.overlayId&&null!==payload.overlayId||(sOverlayId?payload.overlayId=sOverlayId:payload.overlayId=sender.id),item=new emp.typeLibrary.Selection({overlayId:payload.overlayId,featureId:payload.featureId,parentId:payload.parentId,selectedId:payload.selectedId,selectedName:payload.selectedName,select:!0,transactionId:featureTransaction.transactionId}),featureItems.push(item);featureTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_SELECTED]={process:function(args){var featureTransaction,i,len,payload,item,featureItems=[],message=args.message,sender=args.sender;for(featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.SELECTION_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_SELECTED,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_SELECTED,items:featureItems}),Array.isArray(message.payload)||(message.payload=[message.payload]),len=message.payload.length,i=0;i<len;i+=1)payload=message.payload[i],item={},void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),item=new emp.typeLibrary.Selection({overlayId:payload.overlayId,featureId:payload.featureId,parentId:payload.parentId,selectedId:payload.selectedId,selectedName:payload.selectedName,select:!0,transactionId:featureTransaction.transactionId}),featureItems.push(item);featureTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_SHOW]={process:function(args){var oTransaction,payload,bZoomTo,oItem,oItems=[],message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VISIBILITY_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_SHOW,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_SHOW,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],bZoomTo=payload.zoom===!0&&1===message.payload.length,emp.helpers.isEmptyString(payload.overlayId)&&(payload.overlayId=sender.id),oItem={overlayId:payload.overlayId,featureId:payload.featureId,visible:!0,zoom:bZoomTo},emp.helpers.isEmptyString(payload.parentId)||(oItem.parentId=payload.parentId),oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH]={process:function(args){var featureTransaction,i,len,payload,sOverlayId,featureItems=[],message=args.message.payload,oaFeatures=message.features,sender=args.sender;for(message.hasOwnProperty("overlayId")&&(sOverlayId=message.overlayId),len=oaFeatures.length,i=0;i<len;i+=1)payload=oaFeatures[i],void 0!==payload.overlayId&&null!==payload.overlayId||(sOverlayId?payload.overlayId=sOverlayId:payload.overlayId=sender.id),featureItems.push({overlayId:payload.overlayId,parentId:payload.parentId,featureId:payload.featureId});featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,items:featureItems}),featureTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_UNPLOT]={process:function(args){var featureTransaction,i,len,payload,featureItems=[],message=args.message,sender=args.sender;for(Array.isArray(message.payload)||(message.payload=[message.payload]),len=message.payload.length,i=0;i<len;i+=1)payload=message.payload[i],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),featureItems.push({overlayId:payload.overlayId,parentId:payload.parentId,featureId:payload.featureId});featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_FEATURE_UNPLOT,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_UNPLOT,items:featureItems}),featureTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_UPDATE]={process:function(args){var oTransaction,oItem,oPayload,oaItems=[],message=args.message,oSender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_UPDATE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:oSender.id,originChannel:cmapi.channel.names.MAP_FEATURE_UPDATE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:oSender.id,originalMessageType:cmapi.channel.names.MAP_FEATURE_UPDATE,items:oaItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)oPayload=message.payload[iIndex],void 0!==oPayload.overlayId&&null!==oPayload.overlayId||(oPayload.overlayId=oSender.id),oItem=new emp.typeLibrary.Feature({featureId:oPayload.featureId,parentId:oPayload.parentId,overlayId:oPayload.overlayId,name:oPayload.name}),oItem.parentId=oPayload.parentId,oPayload.hasOwnProperty("name")?oItem.name=oPayload.name:oItem.name=void 0,oPayload.hasOwnProperty("newOverlayId")&&(oItem.destOverlayId=oPayload.newOverlayId),oPayload.hasOwnProperty("newParentId")&&(oItem.destParentId=oPayload.newParentId),oaItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_GET]={process:function(args){var oTransaction,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.GET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_GET,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_GET,items:[new emp.typeLibrary.Status(message.payload[0])]}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_MESSAGE_CANCEL]={process:function(args){var len,transactionId,i,message=args.message;for(Array.isArray(message.payload)||(message.payload=[message.payload]),len=message.payload.length,i=0;i<len;i+=1)message.payload[i].messageId&&(transactionId=message.payload[i].messageId,emp.transactionQueue.cancel(transactionId))}},cmapi.channel.handler[cmapi.channel.names.MAP_MESSAGE_COMPLETE]={process:function(args){var len,transactionId,i,message=args.message;for(Array.isArray(message.payload)||(message.payload=[message.payload]),len=message.payload.length,i=0;i<len;i+=1)message.payload[i].messageId&&(transactionId=message.payload[i].messageId,emp.transactionQueue.end(transactionId))}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLEAR]={process:function(args){var oTransaction,payload,oItem,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_CLEAR,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_CLEAR,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_CLEAR,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),oItem=new emp.typeLibrary.Overlay({overlayId:payload.overlayId}),oItems.push(oItem),emp.storage.findOverlay(payload.overlayId)||oTransaction.fail({coreId:oItem.coreId,level:emp.typeLibrary.Error.level.MAJOR,message:"Overlay does not exist."});oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE]={process:function(args){var oTransaction,payload,oItem,i,len,oItems=[],message=args.message,sender=args.sender;for(Array.isArray(message.payload)||(message.payload=[message.payload]),i=0,len=message.payload.length;i<len;i++)payload=message.payload[i],oItem=new emp.typeLibrary.Overlay.Cluster({overlayId:payload.overlayId||sender.id}),oItems.push(oItem);oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_CLUSTER_ACTIVATE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,originChannel:cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE,sender:sender.id,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE]={process:function(args){var oTransaction,payload,oItem,i,len,oItems=[],message=args.message,sender=args.sender;for(Array.isArray(message.payload)||(message.payload=[message.payload]),i=0,len=message.payload.length;i<len;i++)payload=message.payload[i],oItem=new emp.typeLibrary.Overlay.Cluster({overlayId:payload.overlayId||sender.id}),oItems.push(oItem);oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,originChannel:cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE,sender:sender.id,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE]={process:function(args){var oTransaction,payload,oItem,i,len,oItems=[],message=args.message,sender=args.sender;for(Array.isArray(message.payload)||(message.payload=[message.payload]),i=0,len=message.payload.length;i<len;i++)payload=message.payload[i],oItem=new emp.typeLibrary.Overlay.Cluster({overlayId:payload.overlayId||sender.id}),oItems.push(oItem);oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_CLUSTER_REMOVE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET]={process:function(args){var oTransaction,payload,i,len,oItems=[],message=args.message,sender=args.sender;for(Array.isArray(message.payload)||(message.payload=[message.payload]),i=0,len=message.payload.length;i<len;i++)payload=message.payload[i],oItems.push(new emp.typeLibrary.Overlay.Cluster({overlayId:payload.overlayId||sender.id,threshold:payload.threshold,distance:payload.distance,clusterStyle:payload.clusterStyle}));oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_CLUSTER_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CREATE]={process:function(args){var oTransaction,payload,oItem,sDescription,bReadOnly,bVisible,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_ADD,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_CREATE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_CREATE,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),sDescription=void 0,bReadOnly=!1,bVisible=!0,payload.hasOwnProperty("description")&&(sDescription=payload.description),payload.hasOwnProperty("readOnly")&&(bReadOnly=payload.readOnly===!0),payload.hasOwnProperty("visible")&&(bVisible=payload.visible!==!1),oItem=new emp.typeLibrary.Overlay({overlayId:payload.overlayId,parentId:payload.parentId,name:payload.name,properties:payload.properties,description:sDescription,readOnly:bReadOnly,visible:bVisible}),oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_HIDE]={process:function(args){var oTransaction,payload,oItem,oItems=[],message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VISIBILITY_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_HIDE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_HIDE,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],oItem={overlayId:payload.overlayId,visible:!1,zoom:!1,recurse:payload.recurse},emp.helpers.isEmptyString(payload.parentId)?oItem.parentId=emp.constant.parentIds.ALL_PARENTS:oItem.parentId=payload.parentId,oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_REMOVE]={process:function(args){var oTransaction,payload,oItem,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_REMOVE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_REMOVE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_REMOVE,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),oItem=new emp.typeLibrary.Overlay({overlayId:payload.overlayId,parentId:payload.parentId}),oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_SHOW]={process:function(args){var oTransaction,payload,oItem,oItems=[],message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VISIBILITY_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_SHOW,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_SHOW,items:oItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],oItem={overlayId:payload.overlayId,visible:!0,zoom:!1,recurse:payload.recurse},emp.helpers.isEmptyString(payload.parentId)?oItem.parentId=emp.constant.parentIds.ALL_PARENTS:oItem.parentId=payload.parentId,oItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_STYLE]={process:function(args){var oTransaction,payload,oItem,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]);for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],void 0!==payload.overlayId&&null!==payload.overlayId||(payload.overlayId=sender.id),oItem=new emp.typeLibrary.OverlayStyle(payload),oItems.push(oItem);oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_STYLE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_STYLE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_STYLE,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_UPDATE]={process:function(args){var oTransaction,oItem,oPayload,oaItems=[],message=args.message,oSender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.OVERLAY_UPDATE,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:oSender.id,originChannel:cmapi.channel.names.MAP_OVERLAY_UPDATE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:oSender.id,originalMessageType:cmapi.channel.names.MAP_OVERLAY_UPDATE,items:oaItems});for(var iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)oPayload=message.payload[iIndex],oItem={coreId:oPayload.overlayId,overlayId:oPayload.overlayId,name:oPayload.name},oPayload.hasOwnProperty("parentId")&&(oItem.parentId=oPayload.parentId),oPayload.hasOwnProperty("properties")&&(oItem.properties=oPayload.properties),oaItems.push(oItem);oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_STATUS_REQUEST]={process:function(args){var oTransaction,payload,sIntent,sTrasnID,message=args.message,sender=args.sender,asTypes=[];Array.isArray(message.payload)||(message.payload=[message.payload]),asTypes=message.payload[0].types,message.messageId&&(sTrasnID=message.messageId),asTypes&&0!==asTypes.length||(asTypes=[cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_INIT,cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_ABOUT,cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_FORMAT,cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_VIEW,cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_SELECTED,cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_COORD_SYSTEM]);for(var iIndex=0;iIndex<asTypes.length;iIndex++){switch(payload={},asTypes[iIndex]){case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_ABOUT:sIntent=emp.intents.control.STATUS_RESPONSE_ABOUT;break;case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_FORMAT:sIntent=emp.intents.control.STATUS_RESPONSE_FORMAT;break;case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_VIEW:sIntent=emp.intents.control.VIEW_GET,payload=new emp.typeLibrary.View({sender:sender.id});break;case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_SELECTED:sIntent=emp.intents.control.STATUS_RESPONSE_SELECTED;break;case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_SCREENSHOT:sIntent=emp.intents.control.STATUS_REQUEST_SCREENSHOT,payload=new emp.typeLibrary.View({screenshot:!0});break;case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_INIT:sIntent=emp.intents.control.STATUS_RESPONSE_INIT;break;case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_COORD_SYSTEM:sIntent=emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM;break;default:continue}payload.transactionId=sTrasnID,oTransaction=new emp.typeLibrary.Transaction({intent:sIntent,mapInstanceId:args.mapInstanceId,transactionId:sTrasnID,sender:sender.id,intentParams:asTypes[iIndex],source:emp.api.cmapi.SOURCE,originChannel:cmapi.channel.names.MAP_STATUS_REQUEST,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_STATUS_REQUEST,items:[payload]}),oTransaction.queue(),sTrasnID=void 0}}},cmapi.channel.handler[cmapi.channel.names.MAP_SWAP]={process:function(args){var oTransaction,message=args.message,sender=args.sender,oItems=[];Array.isArray(message.payload)||(message.payload=[message.payload]),oItems.push({mapId:message.payload[0].mapId,engine:message.payload[0].engine}),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MAP_SWAP,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_SWAP,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_SWAP,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_LOCK]={process:function(args){var oTransaction,payload,oItem,iIndex,iLength,message=args.message,sender=args.sender,oItems=[];for(Array.isArray(message.payload)||(message.payload=[message.payload]),iIndex=0,iLength=message.payload.length;iIndex<iLength;iIndex++)payload=message.payload[iIndex],oItem=new emp.typeLibrary.Lock({lock:payload.lock}),oItems.push(oItem);oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_LOCK,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_LOCK,items:oItems}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS]={process:function(args){var oTransaction,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS,items:[new emp.typeLibrary.View({zoom:message.payload[0].zoom,bounds:message.payload[0].bounds,animate:message.payload[0].animate})]}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_FEATURE]={process:function(args){var oTransaction,bounds,feature,maxExtent,featureExtent,item,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]);for(var i=0,len=message.payload.length;i<len;i++)feature=emp.storage.findFeature(null,message.payload[i].featureId),maxExtent?featureExtent=feature.getMapExtent():maxExtent=feature.getMapExtent(),featureExtent&&!featureExtent.isEmpty()&&(maxExtent.addCoordinate(featureExtent.getNorthEast()),maxExtent.addCoordinate(featureExtent.getSouthWest()));bounds={west:maxExtent.getWest(),east:maxExtent.getEast(),south:maxExtent.getSouth(),north:maxExtent.getNorth()},bounds.west===bounds.east&&bounds.north===bounds.south?(feature=emp.storage.findFeature(null,message.payload[0].featureId),item=new emp.typeLibrary.Feature({featureId:feature.options.featureId,coreId:feature.options.coreId,overlayId:feature.options.overlayId,parentId:feature.options.parentId,data:feature.options.data,properties:feature.options.properties,format:feature.options.format})):item=new emp.typeLibrary.View({bounds:bounds,zoom:message.payload[0].zoom}),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_CENTER_FEATURE,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_CENTER_FEATURE,items:[]}),oTransaction.items.push(item),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_LOCATION]={process:function(args){var oTransaction,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_CENTER_LOCATION,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_CENTER_LOCATION,items:[new emp.typeLibrary.View({zoom:message.payload[0].zoom,tilt:message.payload[0].tilt,roll:message.payload[0].roll,heading:message.payload[0].heading,location:{lat:message.payload[0].location.lat,lon:message.payload[0].location.lon},animate:message.payload[0].animate})]}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY]={process:function(args){var oTransaction,oPayload,oOverlay,oMapExtent,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oPayload=message.payload[0],void 0!==oPayload.overlayId&&null!==oPayload.overlayId||(oPayload.overlayId=sender.id),oOverlay=emp.storage.findOverlay(oPayload.overlayId),oOverlay&&(oMapExtent=oOverlay.getMapExtent(),oMapExtent&&!oMapExtent.isEmpty()&&(oPayload.bounds={west:oMapExtent.getWest(),east:oMapExtent.getEast(),south:oMapExtent.getSouth(),north:oMapExtent.getNorth()})),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY,items:[new emp.typeLibrary.View({bounds:oPayload.bounds,zoom:oPayload.zoom})]}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM]={process:function(args){var oTransaction,sTrasnID,message=args.message,sender=args.sender,asTypes=[],sCoordsystem="dd";Array.isArray(message.payload)||(message.payload=[message.payload]),message.payload[0]&&message.payload[0].coordinateSystem&&(sCoordsystem=message.payload[0].coordinateSystem,emp.ui.coordinates.setFormat(sCoordsystem)),message.messageId&&(sTrasnID=message.messageId),asTypes=[cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_COORD_SYSTEM],oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_COORDINATESYSTEM,mapInstanceId:args.mapInstanceId,transactionId:sTrasnID,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,items:[new emp.typeLibrary.Status(message.payload[0])]}),oTransaction.queue(),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,source:emp.api.cmapi.SOURCE,items:asTypes}),oTransaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION]={process:function(args){var transaction,message=args.message,sender=args.sender,payload=message.payload;payload.overlayId||(payload.overlayId=sender.id),transaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.LOOKAT_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION,items:[new emp.typeLibrary.LookAt({overlayId:payload.overlayId,latitude:payload.latitude,longitude:payload.longitude,altitude:payload.altitude,
range:payload.range,tilt:payload.tilt,heading:payload.heading,animate:payload.animate})]}),transaction.queue()}},cmapi.channel.handler[cmapi.channel.names.MAP_VIEW_ZOOM]={process:function(args){var oTransaction,message=args.message,sender=args.sender;Array.isArray(message.payload)||(message.payload=[message.payload]),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VIEW_SET,mapInstanceId:args.mapInstanceId,transactionId:message.messageId,sender:sender.id,originChannel:cmapi.channel.names.MAP_VIEW_ZOOM,source:emp.api.cmapi.SOURCE,originalMessage:args.originalMessage,messageOriginator:sender.id,originalMessageType:cmapi.channel.names.MAP_VIEW_ZOOM,items:[new emp.typeLibrary.View({range:message.payload[0].range})]}),oTransaction.queue()}},cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD]={process:function(transaction){try{for(var feature,message={features:[]},features=transaction.items,i=0,len=transaction.items.length;i<len;i++){feature=features[i];var featureToAdd={featureId:feature.featureId,name:feature.name,feature:feature.data,properties:feature.properties};feature.symbolCode&&(featureToAdd.symbolCode=feature.symbolCode),message.features.push(featureToAdd)}emp.environment.get().pubSub.publish({message:message,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE]={process:function(transaction){try{for(var feature,message={features:[]},features=transaction.items,i=0,len=transaction.items.length;i<len;i++){feature=features[i];var featureToAdd={featureId:feature.featureId,name:feature.name,feature:feature.data,properties:feature.properties};feature.symbolCode&&(featureToAdd.symbolCode=feature.symbolCode),message.features.push(featureToAdd)}emp.environment.get().pubSub.publish({message:message,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE]={process:function(transaction){try{for(var feature,message={features:[]},features=transaction.items,i=0,len=transaction.items.length;i<len;i++){feature=features[i];var featureToAdd={featureId:feature.featureId,name:feature.name,feature:feature.data,properties:feature.properties};feature.symbolCode&&(featureToAdd.symbolCode=feature.symbolCode),message.features.push(featureToAdd)}emp.environment.get().pubSub.publish({message:message,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW]={process:function(transaction){try{var strokeStyle,item=transaction.items[0],message={feature:item.data};item.properties&&item.properties.lineColor&&(strokeStyle||(strokeStyle={}),strokeStyle.strokeColor=emp.util.convertHexToColor(item.properties.lineColor)),item.properties&&item.properties.lineWidth&&(strokeStyle||(strokeStyle={}),strokeStyle.strokeWidth=item.properties.lineWidth),message.strokeStyle=strokeStyle,transaction.intent===emp.intents.control.FREEHAND_LINE_DRAW_START?message.type=emp3.api.enums.MapFreehandEventEnum.MAP_FREEHAND_LINE_DRAW_START:transaction.intent===emp.intents.control.FREEHAND_LINE_DRAW_END?message.type=emp3.api.enums.MapFreehandEventEnum.MAP_FREEHAND_LINE_DRAW_END:transaction.intent===emp.intents.control.FREEHAND_LINE_DRAW_UPDATE&&(message.type=emp3.api.enums.MapFreehandEventEnum.MAP_FREEHAND_LINE_DRAW_UPDATE),emp.environment.get().pubSub.publish({message:message,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_ERROR]={process:function(transaction){try{for(var sErrorMessage="",bErrorsPresent=!1,iIndex=0;iIndex<transaction.failures.length;iIndex++)transaction.failures[iIndex].hasOwnProperty("level")&&transaction.failures[iIndex].level===emp.typeLibrary.Error.level.INFO||(bErrorsPresent=!0,transaction.failures[iIndex].hasOwnProperty("message")&&(sErrorMessage.length>0&&(sErrorMessage+="\n"),sErrorMessage+=transaction.failures[iIndex].message));if(!bErrorsPresent)return;var payload={sender:transaction.messageOriginator,type:transaction.originalMessageType,msg:transaction.originalMessage,error:sErrorMessage};emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_ERROR})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_ERROR+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_CLICKED]={process:function(transaction){try{var feature,oPointer=transaction.items[0],oFeature=emp.storage.findFeature(oPointer.overlayId,oPointer.featureId),payload={overlayId:oPointer.overlayId,featureId:oPointer.featureId,button:oPointer.button,type:oPointer.type,mgrs:oPointer.mgrs,keys:oPointer.keys,clientX:oPointer.clientX,clientY:oPointer.clientY,screenX:oPointer.screenX,screenY:oPointer.screenY,width:oPointer.width,height:oPointer.height,zoom:oPointer.range,scale:oPointer.scale};void 0!==oFeature&&(feature=oFeature.getObjectData(null,null),feature&&(payload.properties=feature.properties,payload.format=feature.format,payload.feature=feature.data,payload.name=feature.name,payload.menuId=feature.menuId)),emp.util.isEmptyString(oPointer.parentId)||(payload.parentId=oPointer.parentId),void 0!==oPointer.bounds&&null!==oPointer.bounds&&(payload.bounds={northEast:{lat:oPointer.bounds.north,lon:oPointer.bounds.east},southWest:{lat:oPointer.bounds.south,lon:oPointer.bounds.west}}),emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_CLICKED})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_DESELECTED]={process:function(transaction){try{for(var oSelectItems=transaction.items,payload=[],iIndex=0;iIndex<oSelectItems.length;iIndex++)payload.push({featureId:oSelectItems[iIndex].featureId,deSelectedId:oSelectItems[iIndex].selectedId,deSelectedName:oSelectItems[iIndex].selectedName});emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_DESELECTED})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_DESELECTED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_PLOT]={process:function(transaction){try{var oFeature=transaction.items[0],payload={};if(transaction.source===emp.api.cmapi.SOURCE)return;payload.overlayId=oFeature.overlayId,payload.featureId=oFeature.featureId,emp.helpers.isEmptyString(oFeature.parentId)||(payload.parentId=oFeature.parentId),payload.name=oFeature.name,payload.format=oFeature.format,payload.feature=oFeature.data,payload.properties=oFeature.properties,payload.messageId=transaction.transactionId,payload.menuId=oFeature.menuId,emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_PLOT})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_PLOT+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_PLOT_URL]={process:function(transaction){try{var oFeature=transaction.items[0],payload={};if(transaction.source===emp.api.cmapi.SOURCE)return;payload.overlayId=oFeature.overlayId,payload.featureId=oFeature.featureId,emp.util.isEmptyString(oFeature.parentId)||(payload.parentId=oFeature.parentId),payload.name=oFeature.name,payload.format=oFeature.format,payload.properties=oFeature.properties,payload.url=oFeature.url,payload.params=oFeature.params,payload.transactionId=transaction.transactionId,emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_PLOT_URL})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_PLOT_URL+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_SELECTED]={process:function(transaction){var oSelectItems,i,payload;try{for(oSelectItems=transaction.items,payload=[],i=0;i<oSelectItems.length;i++)payload.push({featureId:oSelectItems[i].featureId,selectedId:oSelectItems[i].selectedId,selectedName:oSelectItems[i].selectedName});emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_SELECTED})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_SELECTED+" failed due to an error. ",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_UNPLOT]={process:function(transaction){var i,oData,oFeatures=transaction.items,payload=[];try{if(oFeatures=transaction.items,payload=[],transaction.source===emp.api.cmapi.SOURCE)return;for(i=0;i<oFeatures.length;i++)oData={overlayId:oFeatures[i].overlayId,featureId:oFeatures[i].featureId},emp.util.isEmptyString(oFeatures[i].parentId)||(oData.parentId=oFeatures[i].parentId),payload.push(oData);if(0===payload.length)return;emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_UNPLOT})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_UNPLOT+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_MESSAGE_COMPLETE]={process:function(oTransaction){try{var oMessage,oMsgBuilder;oTransaction.sendTransactionComplete===!0&&(oMsgBuilder=cmapi.map.message.complete.builder[oTransaction.intent],oMessage=oMsgBuilder?oMsgBuilder.build(oTransaction):new cmapi.typeLibrary.MessageComplete(oTransaction),emp.environment.get().pubSub.publish({message:oMessage,sender:{id:oTransaction.mapInstanceId},channel:cmapi.channel.names.MAP_MESSAGE_COMPLETE}))}catch(e){emp.typeLibrary.Error({message:"Publishing "+oTransaction.intent+" on channel "+cmapi.channel.names.MAP_MESSAGE_COMPLETE+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_MESSAGE_PROGRESS]={process:function(oTransaction){try{var oMessage,oMsgBuilder;oMsgBuilder=cmapi.map.message.progress.builder[oTransaction.intent],oMsgBuilder?(oMessage=oMsgBuilder.build(oTransaction),emp.environment.get().pubSub.publish({message:oMessage,sender:{id:oTransaction.mapInstanceId},channel:cmapi.channel.names.MAP_MESSAGE_PROGRESS})):emp.typeLibrary.Error({message:"No cmapi.map.message.progress.builder for intent "+oTransaction.intent+"."})}catch(e){emp.typeLibrary.Error({message:"Publishing progress for intent "+oTransaction.intent+" on channel "+cmapi.channel.names.MAP_MESSAGE_PROGRESS+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_OVERLAY_REMOVE]={process:function(transaction){try{var oData,oOveralys=transaction.items,payload=[];if(transaction.source===emp.api.cmapi.SOURCE)return;for(var iIndex=0;iIndex<oOveralys.length;iIndex++)oData={overlayId:oOveralys[iIndex].overlayId},emp.util.isEmptyString(oOveralys[iIndex].parentId)||(oData.parentId=oOveralys[iIndex].parentId),payload.push(oData);if(0===payload.length)return;emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_OVERLAY_REMOVE})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_OVERLAY_REMOVE+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_ABOUT]={process:function(transaction){try{var payload={},oaformats=[],mapInstance=emp.instanceManager.getInstance(transaction.mapInstanceId);payload.version=emp.version,mapInstance.engine.capabilities.mapType.type2D?payload.type="2D":mapInstance.engine.capabilities.mapType.type3D?payload.type="3D":payload.type="unknown",payload.widgetName=emp.environment.get().name,payload.instanceName=emp.environment.get().properties.widgetName,payload.universalName=emp.environment.get().properties.universalName,payload.extensions=[],mapInstance.engine.implementation&&(mapInstance.engine.implementation.displayName&&payload.extensions.push({engineName:mapInstance.engine.implementation.displayName}),mapInstance.engine.implementation.version&&payload.extensions.push({sprint:mapInstance.engine.implementation.version})),(mapInstance.engine.capabilities.formats.GEOJSON_BASIC.plot||mapInstance.engine.capabilities.formats.GEOJSON_FULL)&&oaformats.push("geojson"),(mapInstance.engine.capabilities.formats.WMS.version_1_1||mapInstance.engine.capabilities.formats.WMS.version_1_3)&&oaformats.push("wms"),(mapInstance.engine.capabilities.formats.KML_BASIC||mapInstance.engine.capabilities.formats.KML_COMPLEX)&&oaformats.push("kml"),mapInstance.engine.capabilities.formats.IMAGE.plot&&oaformats.push("image"),(mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot||mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot)&&oaformats.push("milstd"),mapInstance.engine.capabilities.formats.AIRSPACE.plot&&oaformats.push("airspace"),mapInstance.engine.capabilities.formats.AOI.plot&&oaformats.push("aoi"),mapInstance.engine.capabilities.formats.ArcGIS&&oaformats.push("arc"),payload.extensions.push({formats:oaformats}),emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_ABOUT})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_COORDINATESYSTEM]={process:function(transaction){try{var payload={};payload.displayedCoordinateSystem=emp.ui.coordinates.currentFormat(),payload.coordinateSystem=emp.ui.coordinates.currentFormat(),emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_COORDINATESYSTEM})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_FORMAT]={process:function(transaction){try{var payload={},oaformats=[],mapInstance=emp.instanceManager.getInstance(transaction.mapInstanceId);(mapInstance.engine.capabilities.formats.GEOJSON_BASIC.plot||mapInstance.engine.capabilities.formats.GEOJSON_FULL)&&oaformats.push("geojson"),(mapInstance.engine.capabilities.formats.WMS.version_1_1||mapInstance.engine.capabilities.formats.WMS.version_1_3)&&oaformats.push("wms"),(mapInstance.engine.capabilities.formats.KML_BASIC||mapInstance.engine.capabilities.formats.KML_COMPLEX)&&oaformats.push("kml"),mapInstance.engine.capabilities.formats.IMAGE.plot&&oaformats.push("image"),(mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot||mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot)&&oaformats.push("milstd"),mapInstance.engine.capabilities.formats.AIRSPACE.plot&&oaformats.push("airspace"),mapInstance.engine.capabilities.formats.AOI.plot&&oaformats.push("aoi"),mapInstance.engine.capabilities.formats.ArcGIS&&oaformats.push("arc"),payload.formats=oaformats,emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_FORMAT})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_INITIALIZATION]={process:function(transaction){try{var sField,payload={},mapInstance=emp.instanceManager.getInstance(transaction.mapInstanceId);if(payload={status:"ready",engineId:mapInstance.engineId,types:[]},transaction.items.length>0&&transaction.items[0].hasOwnProperty("status")&&(payload.status=transaction.items[0].status),"ready"===payload.status){for(sField in cmapi.channel.mapStatusRequest.requestTypes)payload.types.push(cmapi.channel.mapStatusRequest.requestTypes[sField]);payload.defaultWMSOverlayId=emp.wms.manager.getWmsOverlayId(transaction.mapInstanceId),payload.defaultLayerOverlayId=mapInstance.engines.getDefaultLayerOverlayID(transaction.mapInstanceId)}emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_INITIALIZATION}),"teardown"===payload.status&&emp.environment.get().pubSub.publish({message:{type:"MAP_CLOSE"},channel:"MapChannel"})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_STATUS_INITIALIZATION+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_SCREENSHOT]={process:function(transaction){try{var oData=transaction.items[0],payload={};oData&&(payload.dataUrl=oData.dataUrl),emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_SCREENSHOT})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_SELECTED]={process:function(transaction){try{for(var feature,selection,payload,selectedFeatures=[],selectedList=emp.storage.selection.getSelectedList(transaction.mapInstanceId),iIndex=0;iIndex<selectedList.length;iIndex++)selection=selectedList[iIndex],feature=emp.storage.findObject(selection.coreId),feature&&selectedFeatures.push({name:feature.options.name,featureId:feature.options.featureId,feature:feature.options.data,format:feature.options.format,properties:feature.options.properties});payload={messageId:transaction.items[0].transactionId,selectedFeatures:selectedFeatures},emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_SELECTED})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_VIEW]={process:function(transaction){try{var view=transaction.items[0],lookAt=transaction.items[1],payload={};transaction.intent!==emp.intents.control.VIEW_CHANGE,transaction.hasOwnProperty("sender")&&(payload.requester=transaction.sender),"object"==typeof view.bounds&&(payload.bounds={southWest:{lat:view.bounds.south,lon:view.bounds.west},northEast:{lat:view.bounds.north,lon:view.bounds.east}}),"object"==typeof view.location&&(payload.center={lat:view.location.lat,lon:view.location.lon}),payload.altitude=view.altitude,payload.heading=view.heading,payload.tilt=view.tilt,payload.roll=view.roll,payload.range=view.range,payload.animate=view.animate,payload.lookAt=lookAt,emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_STATUS_VIEW})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_STATUS_VIEW+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_VIEW_AREA_SELECTED]={process:function(transaction){try{var payload,bounds,pointer=transaction.items[0];void 0!==pointer.bounds&&null!==pointer.bounds&&(bounds={northEast:{lat:pointer.bounds.north,lon:pointer.bounds.east},southWest:{lat:pointer.bounds.south,lon:pointer.bounds.west}}),payload={button:pointer.button,keys:pointer.keys,bounds:bounds,zoom:pointer.zoom,scale:pointer.scale},emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_VIEW_AREA_SELECTED})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_VIEW_AREA_SELECTED+" failed due to an error.",jsError:e})}}},cmapi.channel.publisher[cmapi.channel.names.MAP_VIEW_CLICKED]={process:function(transaction){try{var payload,bounds,oFeature,feature,pointer=transaction.items[0];if(pointer.type!==emp.typeLibrary.Pointer.EventType.MOVE||isNaN(pointer.lat)||isNaN(pointer.lon)){if(void 0!==pointer.bounds&&null!==pointer.bounds&&(bounds={northEast:{lat:pointer.bounds.north,lon:pointer.bounds.east},southWest:{lat:pointer.bounds.south,lon:pointer.bounds.west}}),payload={lat:pointer.lat,lon:pointer.lon,mgrs:pointer.mgrs,button:pointer.button,type:pointer.type,keys:pointer.keys,bounds:bounds,clientX:pointer.clientX,clientY:pointer.clientY,screenX:pointer.screenX,screenY:pointer.screenY,width:pointer.width,height:pointer.height,zoom:pointer.range,scale:pointer.scale,overlayId:pointer.overlayId,featureId:pointer.featureId,parentId:pointer.parentId},"feature"===pointer.target.toLowerCase())switch(oFeature=emp.storage.findFeature(pointer.overlayId,pointer.featureId),void 0!==oFeature&&(feature=oFeature.getObjectData(null,null),feature&&(payload.properties=feature.properties,payload.format=feature.format,payload.feature=feature.data,payload.name=feature.name,payload.menuId=feature.menuId)),pointer.type){case emp.typeLibrary.Pointer.EventType.MOUSEDOWN:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_MOUSEDOWN});break;case emp.typeLibrary.Pointer.EventType.MOUSEUP:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_FEATURE_MOUSEUP});break;case emp.typeLibrary.Pointer.EventType.DRAG:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_FEATURE_DRAG});break;case emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_FEATURE_DRAG_COMPLETE})}switch(delete payload.overlayId,delete payload.featureId,delete payload.parentId,feature&&(delete payload.properties,delete payload.format,delete payload.feature,delete payload.menuId),pointer.type){case emp.typeLibrary.Pointer.EventType.MOUSEDOWN:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_VIEW_MOUSEDOWN});break;case emp.typeLibrary.Pointer.EventType.MOUSEUP:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_VIEW_MOUSEUP});break;case emp.typeLibrary.Pointer.EventType.DRAG:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_MAP_DRAG});break;case emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.CMAPI2_MAP_DRAG_COMPLETE});break;case emp.typeLibrary.Pointer.EventType.SINGLE_CLICK:case emp.typeLibrary.Pointer.EventType.DBL_CLICK:emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_VIEW_CLICKED})}}else payload={latitude:pointer.lat,longitude:pointer.lon,type:pointer.type,clientX:pointer.clientX,clientY:pointer.clientY,screenX:pointer.screenX,screenY:pointer.screenY,keys:pointer.keys},emp.environment.get().pubSub.publish({message:payload,sender:{id:transaction.mapInstanceId},channel:cmapi.channel.names.MAP_VIEW_MOUSEMOVE})}catch(e){emp.typeLibrary.Error({message:"Publishing "+transaction.intent+" on channel "+cmapi.channel.names.MAP_FEATURE_CLICKED+" failed due to an error.",jsError:e})}}},cmapi.map.message.complete.builder[emp.intents.control.DRAW_BEGIN]={build:function(oTransaction){var oDetail,oFeature,sFormat,oDraw=oTransaction.items[0],oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);if(oTransaction.failures.length>0&&oTransaction.failures[0].level===emp.typeLibrary.Error.level.INFO&&(oMsgCompletion.status=cmapi.typeLibrary.msgComplete.status.CANCELLED),oDraw){if(oFeature=oDraw.plotFeature)oDetail={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,type:oDraw.type,name:oFeature.name,format:oFeature.format,feature:oFeature.data,properties:oFeature.properties,menuId:oFeature.menuId,coordinates:oDraw.updates&&oDraw.updates.coordinates?oDraw.updates.coordinates:[]};else{switch(sFormat="",oDraw.type.toLowerCase()){case"point":case"line":case"polygon":sFormat=emp.typeLibrary.featureFormatType.GEOJSON;break;case"milstd":sFormat=emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL;break;case"airspace":sFormat=emp3.api.enums.FeatureTypeEnum.GEO_ACM}oDetail={overlayId:oDraw.overlayId,parentId:oDraw.parentId,featureId:oDraw.featureId,type:oDraw.type,format:sFormat,name:oDraw.name,properties:oDraw.properties,coordinates:oDraw.updates&&oDraw.updates.coordinates?oDraw.updates.coordinates:[]}}oMsgCompletion.details=oDetail}return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.EDIT_BEGIN]={build:function(transaction){var feature,detail,messageComplete=new cmapi.typeLibrary.MessageComplete(transaction);return transaction.failures.length>0?transaction.failures[0].level===emp.typeLibrary.Error.level.INFO&&(messageComplete.status=cmapi.typeLibrary.msgComplete.status.CANCELLED,feature=transaction.items[0].originFeature):feature=transaction.items[0].updatedFeature,feature&&(detail={overlayId:feature.overlayId,parentId:feature.parentId,featureId:feature.featureId,name:feature.name,format:feature.format,feature:feature.data,properties:feature.properties,menuId:feature.menuId},messageComplete.details=detail),messageComplete}},cmapi.map.message.complete.builder[emp.intents.control.FEATURE_ADD]={build:function(oTransaction){var oFeature,oDetail,iIndex,empParent,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]};for(iIndex=0;iIndex<oFeatures.length;iIndex++){switch(oFeature=oFeatures[iIndex],oTransaction.originChannel){case cmapi.channel.names.MAP_FEATURE_PLOT:case cmapi.channel.names.MAP_FEATURE_PLOT_BATCH:oDetail={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,name:oFeature.name,format:oFeature.format,feature:oFeature.data,properties:oFeature.properties,menuId:oFeature.menuId};break;case cmapi.channel.names.MAP_FEATURE_PLOT_URL:oDetail={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,name:oFeature.name,format:oFeature.format,url:oFeature.url,params:oFeature.params}}oFeature.parentId?(empParent=emp.storage.get.id({id:oFeature.parentId}).options,oDetail.parentInfo={featureId:empParent.featureId,name:empParent.name,format:empParent.format,feature:empParent.data,properties:emp.helpers.copyObject(empParent.properties),menuId:empParent.menuId}):(empParent=emp.storage.get.id({id:oFeature.overlayId}).options,oDetail.parentInfo={name:empParent.name,overlayId:empParent.overlayId,properties:emp.helpers.copyObject(empParent.properties),menuId:empParent.menuId,description:empParent.description}),oDetails.features.push(oDetail)}return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.FEATURE_HIDE]={build:function(oTransaction){for(var oFeature,oDetail,payload,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]},iIndex=0;iIndex<oFeatures.length;iIndex++)oFeature=oFeatures[iIndex],payload=oTransaction.message.payload[iIndex],oDetail={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId||oFeature.id,recurse:payload.recurse},oDetails.features.push(oDetail);return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.FEATURE_REMOVE]={build:function(oTransaction){var oFeature,oDetail,empParent,iIndex,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]};for(iIndex=0;iIndex<oFeatures.length;iIndex++)oFeature=oFeatures[iIndex],oDetail={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,name:oFeature.name,format:oFeature.format,feature:oFeature.data,properties:oFeature.properties,menuId:oFeature.menuId},oFeature.url&&(oDetail.url=oFeature.url,oDetail.params=oFeature.params,delete oDetail.feature,delete oDetail.properties,delete oDetail.menuId),oFeature.parentId?(empParent=emp.storage.get.id({id:oFeature.parentId}).options,oDetail.parentInfo={featureId:empParent.featureId,name:empParent.name,format:empParent.format,feature:empParent.data,properties:emp.helpers.copyObject(empParent.properties),menuId:empParent.menuId}):(empParent=emp.storage.get.id({id:oFeature.overlayId}).options,oDetail.parentInfo={name:empParent.name,overlayId:empParent.overlayId,properties:emp.helpers.copyObject(empParent.properties),menuId:empParent.menuId,description:empParent.description}),oDetails.features.push(oDetail);return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.SELECTION_SET]={build:function(oTransaction){for(var feature,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]},iIndex=0;iIndex<oFeatures.length;iIndex++)oFeatures[iIndex].featureId&&(feature=emp.storage.findObject(oFeatures[iIndex].coreId),feature&&oDetails.features.push({featureId:feature.options.featureId,name:feature.options.name,format:feature.options.format,feature:feature.options.data,properties:feature.options.properties,symbolCode:feature.options.symbolCode}));return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.FEATURE_SHOW]={build:function(oTransaction){for(var oFeature,oDetail,payload,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]},iIndex=0;iIndex<oFeatures.length;iIndex++)oFeature=oFeatures[iIndex],payload=oTransaction.message.payload[iIndex],oDetail={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId||oFeature.id,recurse:payload.recurse},oDetails.features.push(oDetail);return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.FEATURE_UPDATE]={build:function(oTransaction){for(var oFeature,oDetail,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]},iIndex=0;iIndex<oFeatures.length;iIndex++)oFeature=emp.storage.get.id({id:oFeatures[iIndex].coreId}),oDetail=void 0!==oFeature.url?{overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,name:oFeature.name,format:oFeature.format,feature:oFeature.data,properties:oFeature.properties,menuId:oFeature.menuId
}:{overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,name:oFeature.name,format:oFeature.format,url:oFeature.url,params:oFeature.params},oDetails.features.push(oDetail);return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.GET_LATLON_FROM_XY]={build:function(oTransaction){var convert,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);return oMsgCompletion.failures.length>0?oMsgCompletion:(convert=oTransaction.items[0],oMsgCompletion.details.x=convert.lon,oMsgCompletion.details.y=convert.lat,oMsgCompletion.details.invalid=convert.invalid,oMsgCompletion)}},cmapi.map.message.complete.builder[emp.intents.control.GET_XY_FROM_LATLON]={build:function(oTransaction){var convert,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);return oMsgCompletion.failures.length>0?oMsgCompletion:(convert=oTransaction.items[0],oMsgCompletion.details.x=convert.x,oMsgCompletion.details.y=convert.y,oMsgCompletion.details.invalid=convert.invalid,oMsgCompletion)}},cmapi.map.message.complete.builder[emp.intents.control.GET]={build:function(oTransaction){var oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);return oTransaction.items&&oTransaction.items.length>0&&(oMsgCompletion.details.successes={feature:oTransaction.items[0].feature,overlay:oTransaction.items[0].overlay}),oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.OVERLAY_ADD]={build:function(oTransaction){var oOverlay,oDetail,i,empParentOverlayProperties,empParentOverlay,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oOverlays=oTransaction.items,instanceRootId=emp.storage.getRootGuid(oTransaction.mapInstanceId);if(1===oOverlays.length)oOverlay=oOverlays[0],oOverlay.parentId&&instanceRootId&&instanceRootId!==oOverlay.parentId&&(empParentOverlay=emp.storage.get.id({id:oOverlay.parentId}).options,empParentOverlayProperties=emp.helpers.copyObject(empParentOverlay.properties)),oDetail={name:oOverlay.name,overlayId:oOverlay.overlayId,parentId:oOverlay.parentId,properties:oOverlay.properties,description:oOverlay.description},empParentOverlay&&(oDetail.parentInfo={name:empParentOverlay.name,overlayId:empParentOverlay.overlayId,properties:empParentOverlayProperties,menuId:empParentOverlay.menuId,description:empParentOverlay.description}),oMsgCompletion.details=oDetail;else for(oMsgCompletion.details=[],i=0;i<oOverlays.length;i++)oOverlay=oOverlays[i],oOverlay.parentId&&instanceRootId&&instanceRootId!==oOverlay.parentId&&(empParentOverlay=emp.storage.get.id({id:oOverlay.parentId}).options,empParentOverlayProperties=emp.helpers.copyObject(empParentOverlay.properties)),oDetail={name:oOverlay.name,overlayId:oOverlay.overlayId,parentId:oOverlay.parentId,properties:oOverlay.properties,description:oOverlay.description},empParentOverlay&&(oDetail.parentInfo={name:empParentOverlay.name,overlayId:empParentOverlay.overlayId,properties:empParentOverlayProperties,menuId:empParentOverlay.menuId,description:empParentOverlay.description}),oMsgCompletion.details.push(oDetail);return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.OVERLAY_HIDE]={build:function(oTransaction){var oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oOverlay=oTransaction.items[0];if(oOverlay){var oDetails={overlayId:oOverlay.overlayId};oMsgCompletion.details=oDetails}return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.OVERLAY_REMOVE]={build:function(oTransaction){var oOverlay,oDetail,i,empParentOverlayProperties,empParentOverlay,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oOverlays=oTransaction.items,instanceRootId=emp.storage.getRootGuid(oTransaction.mapInstanceId);if(1===oOverlays.length)oOverlay=oOverlays[0],oOverlay.parentId&&instanceRootId&&instanceRootId!==oOverlay.parentId&&(empParentOverlay=emp.storage.get.id({id:oOverlay.parentId}).options,empParentOverlayProperties=emp.helpers.copyObject(empParentOverlay.properties)),oDetail={name:oOverlay.name,overlayId:oOverlay.overlayId,parentId:oOverlay.parentId,properties:oOverlay.properties,description:oOverlay.description},empParentOverlay&&(oDetail.parentInfo={name:empParentOverlay.name,overlayId:empParentOverlay.overlayId,properties:empParentOverlayProperties,description:empParentOverlay.description}),oMsgCompletion.details=oDetail;else for(oMsgCompletion.details=[],i=0;i<oOverlays.length;i++)oOverlay=oOverlays[i],oOverlay.parentId&&instanceRootId&&instanceRootId!==oOverlay.parentId&&(empParentOverlay=emp.storage.get.id({id:oOverlay.parentId}).options,empParentOverlayProperties=emp.helpers.copyObject(empParentOverlay.properties)),oDetail={name:oOverlay.name,overlayId:oOverlay.overlayId,parentId:oOverlay.parentId,properties:oOverlay.properties,menuId:oOverlay.menuId,description:oOverlay.description},empParentOverlay&&(oDetail.parentInfo={name:empParentOverlay.name,overlayId:empParentOverlay.overlayId,properties:empParentOverlayProperties,description:empParentOverlay.description}),oMsgCompletion.details.push(oDetail);return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.OVERLAY_SHOW]={build:function(oTransaction){var oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oOverlay=oTransaction.items[0];if(oOverlay){var oDetails={overlayId:oOverlay.overlayId};oMsgCompletion.details=oDetails}return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.OVERLAY_UPDATE]={build:function(oTransaction){var oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oOverlay=oTransaction.items[0];if(oOverlay){var oDetails={name:oOverlay.name,overlayId:oOverlay.overlayId,parentId:oOverlay.parentId,properties:oOverlay.properties,menuId:oOverlay.menuId};oMsgCompletion.details=oDetails}return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.VIEW_SET]={build:function(oTransaction){var oView,oBounds,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);return oMsgCompletion.failures.length>0?oMsgCompletion:(oView=oTransaction.items[0],oView.bounds&&(oBounds={northEast:{lat:oView.bounds.north,lon:oView.bounds.east},southWest:{lat:oView.bounds.south,lon:oView.bounds.west}},oMsgCompletion.details.bounds=oBounds),oMsgCompletion.details.range=oView.range,oMsgCompletion.details.center=oView.location,oMsgCompletion.details.tilt=oView.tilt,oMsgCompletion.details.heading=oView.heading,oMsgCompletion.details.roll=oView.roll,oMsgCompletion.details.overlayId=oView.overlayId,oMsgCompletion.details.parentId=oView.parentId,oMsgCompletion.details.featureId=oView.featureId,oMsgCompletion)}},cmapi.map.message.complete.builder[emp.intents.control.VISIBILITY_GET]={build:function(oTransaction){var item,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);return oMsgCompletion.failures.length>0?oMsgCompletion:(item=oTransaction.items[0],oMsgCompletion.details={visible:item.visible,targetId:item.coreId,parentId:item.parentId},oMsgCompletion)}},cmapi.map.message.complete.builder[emp.intents.control.VISIBILITY_SET]={build:function(oTransaction){var item,i,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction);if(oMsgCompletion.failures.length>0)return oMsgCompletion;for(oMsgCompletion.details=[],i=0;i<oTransaction.items.length;i+=1)item=oTransaction.items[i],oMsgCompletion.details.push({visibilityState:item.visible?emp3.api.enums.VisibilityStateEnum.VISIBLE:emp3.api.enums.VisibilityStateEnum.HIDDEN,targetAttributes:item.targetAttributes,parentTargetAttributes:item.parentTargetAttributes});return oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.MAP_SERVICE_ADD]={build:function(oTransaction){for(var oWMS,oDetail,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oWMSs=oTransaction.items,oDetails={features:[]},iIndex=0;iIndex<oWMSs.length;iIndex++)switch(oWMS=oWMSs[iIndex],oTransaction.originChannel){case cmapi.channel.names.MAP_FEATURE_PLOT_URL:oDetail={overlayId:oWMS.overlayId,featureId:oWMS.id,name:oWMS.name,format:emp.typeLibrary.featureFormatType.WMS,url:oWMS.url,params:oWMS.params},oDetails.features.push(oDetail)}return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.complete.builder[emp.intents.control.MAP_SERVICE_REMOVE]={build:function(oTransaction){for(var oFeature,oDetail,oMsgCompletion=new cmapi.typeLibrary.MessageComplete(oTransaction),oFeatures=oTransaction.items,oDetails={features:[]},iIndex=0;iIndex<oFeatures.length;iIndex++)oFeature=oFeatures[iIndex],oDetail={overlayId:oFeature.overlayId,featureId:oFeature.id},oDetails.features.push(oDetail);return oMsgCompletion.details=oDetails,oMsgCompletion}},cmapi.map.message.progress.builder[emp.intents.control.DRAW_UPDATE]={build:function(oTransaction){var oFeature=oTransaction.items[0],oMsgProgress=new cmapi.typeLibrary.MessageProgress(oTransaction),oDetails={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,name:oFeature.name,type:oFeature.type,properties:oFeature.properties,format:oFeature.format,feature:oFeature.data,menuId:oFeature.menuId};switch(oFeature.updateEventType){case emp.typeLibrary.UpdateEventType.START:oDetails.status="start";break;case emp.typeLibrary.UpdateEventType.UPDATE:oDetails.status="update",oDetails.updates={type:oFeature.updates.type,indices:oFeature.updates.indices,coordinates:oFeature.updates.coordinates};break;case emp.typeLibrary.UpdateEventType.COMPLETE:oDetails.status="complete",oDetails.updates={type:oFeature.updates.type,indices:oFeature.updates.indices,coordinates:oFeature.updates.coordinates};break;default:return}return oMsgProgress.details=oDetails,oMsgProgress.messageId=oFeature.transactionId,oMsgProgress.originatingChannel=cmapi.channel.names.MAP_FEATURE_DRAW,oMsgProgress}},cmapi.map.message.progress.builder[emp.intents.control.EDIT_UPDATE]={build:function(oTransaction){var oFeature=oTransaction.items[0],oMsgProgress=new cmapi.typeLibrary.MessageProgress(oTransaction),oDetails={overlayId:oFeature.overlayId,parentId:oFeature.parentId,featureId:oFeature.featureId,properties:oFeature.properties,format:oFeature.format,feature:oFeature.data,menuId:oFeature.menuId};switch(oFeature.updateEventType){case emp.typeLibrary.UpdateEventType.START:oDetails.status="start";break;case emp.typeLibrary.UpdateEventType.UPDATE:oDetails.status="update",oDetails.updates={type:oFeature.updates.type,indices:oFeature.updates.indices,coordinates:oFeature.updates.coordinates};break;case emp.typeLibrary.UpdateEventType.COMPLETE:oDetails.status="complete",oDetails.updates={type:oFeature.updates.type,indices:oFeature.updates.indices,coordinates:oFeature.updates.coordinates};break;default:return}return oMsgProgress.details=oDetails,oMsgProgress.messageId=oFeature.transactionId,oMsgProgress.originatingChannel=cmapi.channel.names.MAP_FEATURE_EDIT,oMsgProgress}},cmapi.channel.support.genericFeatureRemove=function(oTransaction){for(var oItem,oFeature,itemInStorage,oaItems=oTransaction.items,mapServiceItems=[],featureItems=[],iIndex=0;iIndex<oaItems.length;iIndex++)if(oItem=oaItems[iIndex],itemInStorage=emp.storage.findFeature(oItem.overlayId,oItem.featureId),void 0===itemInStorage)oFeature=new emp.typeLibrary.Feature({overlayId:oItem.overlayId,parentId:oItem.parentId,featureId:oItem.featureId}),featureItems.push(oFeature);else switch(itemInStorage.getCoreObjectType()){case emp.typeLibrary.types.WMS:oFeature=new emp.typeLibrary.WMS({overlayId:oItem.overlayId,id:oItem.featureId}),mapServiceItems.push(oFeature);break;case emp.typeLibrary.types.WMTS:oFeature=new emp.typeLibrary.WMTS({overlayId:oItem.overlayId,id:oItem.featureId}),mapServiceItems.push(oFeature);break;case emp.typeLibrary.types.KML:oFeature=new emp.typeLibrary.KmlLayer({overlayId:oItem.overlayId,id:oItem.featureId}),mapServiceItems.push(oFeature);break;case emp.typeLibrary.types.FEATURE:default:oFeature=new emp.typeLibrary.Feature({overlayId:oItem.overlayId,parentId:oItem.parentId,featureId:oItem.featureId}),featureItems.push(oFeature)}if(featureItems.length>0){var featureTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.FEATURE_REMOVE,mapInstanceId:oTransaction.mapInstanceId,transactionId:oTransaction.transactionId,sender:oTransaction.sender,originChannel:oTransaction.originChannel,source:oTransaction.source,originalMessage:oTransaction.originalMessage,messageOriginator:oTransaction.messageOriginator,originalMessageType:oTransaction.originalMessageType,items:featureItems});setTimeout(function(){featureTransaction.run()},0)}if(mapServiceItems.length>0){var mapServiceTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MAP_SERVICE_REMOVE,mapInstanceId:oTransaction.mapInstanceId,transactionId:oTransaction.transactionId,sender:oTransaction.sender,originChannel:oTransaction.originChannel,source:oTransaction.source,originalMessage:oTransaction.originalMessage,messageOriginator:oTransaction.messageOriginator,originalMessageType:oTransaction.originalMessageType,items:mapServiceItems});setTimeout(function(){mapServiceTransaction.run()},0)}},emp.api.core={},emp.api.core.SOURCE="emp-core-api-core",emp.api.sources.push(emp.api.core.SOURCE),emp.api.core._widgetId="",emp.api.core._isOzoneInitialized=!1,emp.api.core._init=function(){var fixture=emp.api.core.fixture.channels;for(var i in fixture)"inbound"!==fixture[i].direction&&"bidirectional"!==fixture[i].direction||emp.environment.get().pubSub.subscribe({channel:i,callback:emp.api.core.handleMessage});var environment=emp.environment.get();environment===emp.environment.owf&&(this._widgetId=OWF.getInstanceId(),this._isOzoneInitialized=!0),emp.transactionQueue.listener.add({type:emp.intents.control.CLICK,callback:function(args){emp.api.core.publish(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.FEATURE_CLICK,callback:function(args){emp.api.core.publish(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.VIEW_CHANGE,callback:function(args){emp.api.core.publish(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.STATUS_CHANGE,callback:function(args){emp.api.core.publish(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.FEATURE_REMOVE,callback:function(args){emp.api.core.updateHash(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.OVERLAY_REMOVE,callback:function(args){emp.api.core.updateHash(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.DRAW_UPDATE,callback:function(args){emp.api.core.publish(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.EDIT_UPDATE,callback:function(args){emp.api.core.publish(args)}}),emp.transactionQueue.listener.add({type:emp.intents.control.TRANSACTION_COMPLETE,callback:function(args){emp.api.core.transactionQueue.transCompleteHandler(args)}})};var emp=emp||{};emp.api=emp.api||{},emp.api.core=emp.api.core||{},emp.api.core.fixture={title:"Core Map API Payload Specification",version:"13.11",channels:{"Bcw.Map.Broadcast":{purpose:"Receives all incoming core-map-api traffic",extension:!1,direction:"inbound"},BcwMapBrokerChannel:{purpose:"sends outgoing events to core-map-api widgets",extension:!1,direction:"outbound"}}},emp.api.core.channel={},emp.api.core.channel.names={MAP_BROADCAST:"Bcw.Map.Broadcast",MAP_BROKER:"BcwMapBrokerChannel",GRAPHICS_DRAW_EVENT:"core.api.graphics.drawing",GRAPHIC_EVENT:"core.api.graphics.eventing",MAP_EVENT:"core.api.map.eventing"},emp.api.core.EventType={GRAPHIC_UPDATE:"graphicUpdate",GRAPHIC_CLICK:"graphicClick",GRAPHIC_DBL_CLICK:"graphicDoubleClick",DRAW_COMPLETE:"drawComplete",MAP_MOVE:"mapMove",MAP_READY:"mapReady",MAP_CLICKED:"mapClick",MAP_DBL_CLICKED:"mapDoubleClick"},emp.api.core.DataType={MIL_STD_SYMBOL:"milStdSymbol",POINT:"point",LINE:"line",POLYGON:"polygon",MIL_STD_MULTI_POINT:"MilStdMultiPoint",AIRSPACE:"3DShape",UNKNOWN:"unknown"},emp.api.core._featureHash=[],emp.api.core._overlayHash=[],emp.api.core.scaleMultiplier=10.5,emp.api.core.transactionQueue=function(){function transactionWaitTimeout(){oOutstandingTransaction&&(emp.typeLibrary.Error({level:emp.typeLibrary.Error.level.MINOR,message:"V1 "+oOutstandingTransaction.intent+" transaction with "+(oOutstandingTransaction.items.length+oOutstandingTransaction.failures.length)+" items timed out ("+iWaittime/1e3+" sec). V1 queue released."}),oOutstandingTransaction=null)}function runQueue(){if(tranQueue.length>0&&null===oOutstandingTransaction){var transaction=tranQueue.shift();switch(transaction.intent){case emp.intents.control.DRAW_BEGIN:break;case emp.intents.control.EDIT_BEGIN:transaction.items[0].originFeature=emp.storage.get.id({id:transaction.items[0].coreId});break;default:oOutstandingTransaction=transaction,oWaitTimer=setTimeout(transactionWaitTimeout,iWaittime)}emp.transactionQueue.add(transaction)}setTimeout(runQueue,50)}var oWaitTimer,iWaittime=5e3,tranQueue=[],oOutstandingTransaction=null,publicInterface={add:function(transaction){tranQueue.push(transaction)},transCompleteHandler:function(oTransaction){oOutstandingTransaction&&oTransaction.transactionId===oOutstandingTransaction.transactionId&&(clearTimeout(oWaitTimer),oOutstandingTransaction=null)}};return runQueue(),publicInterface}(),emp.api.core.updateHash=function(args){var i,id;if(args&&args.items&&args.items.length>0)for(i=0;i<args.items.length;i+=1)args.intent===emp.intents.control.FEATURE_REMOVE?(id=emp.api.core.recurseStrFixOutbound(args.items[i].featureId),emp.api.core.removeFeature(id)):args.intent===emp.intents.control.OVERLAY_REMOVE&&(id=emp.api.core.recurseStrFixOutbound(args.items[i].overlayId),emp.api.core.removeOverlay(id))},emp.api.core.isFeature=function(id){return!!emp.api.core._featureHash[id]},emp.api.core.isOverlay=function(id){return!!emp.api.core._overlayHash[id]},emp.api.core.getOverlayId=function(id){return emp.api.core._featureHash[id]?emp.api.core._featureHash[id].overlayId:void 0},emp.api.core.removeFeature=function(id){emp.api.core._featureHash[id]&&delete emp.api.core._featureHash[id]},emp.api.core.removeOverlay=function(id){var i;if(emp.api.core._overlayHash[id]){for(i=0;i<emp.api.core._overlayHash[id].length;i+=1)emp.api.core.removeFeature(emp.api.core._overlayHash[id][i]);delete emp.api.core._overlayHash[id]}},emp.api.core.addOverlay=function(id){emp.api.core._overlayHash[id]||(emp.api.core._overlayHash[id]=[])},emp.api.core.addParent=function(typeLibraryArgs,overlayId){emp.api.core.isFeature(overlayId)?(typeLibraryArgs.parentId=overlayId,typeLibraryArgs.overlayId=emp.api.core.getOverlayId(overlayId),emp.api.core._featureHash[typeLibraryArgs.featureId]={overlayId:typeLibraryArgs.overlayId,parentId:typeLibraryArgs.parentId}):(typeLibraryArgs.overlayId=overlayId,emp.api.core._featureHash[typeLibraryArgs.featureId]={overlayId:typeLibraryArgs.overlayId},emp.api.core.isOverlay(overlayId)?emp.api.core._overlayHash[overlayId].push(typeLibraryArgs.featureId):emp.api.core._overlayHash[overlayId]=[typeLibraryArgs.featureId])},emp.api.core.translateToFeature=function(sender,oArgs){var payloads=[],sKML="";sKML+='<Folder id="'+oArgs.overlayId+'">',sKML+="<name>"+oArgs.name+"</name>",sKML+="<Placemark></Placemark></Folder>";var typeLibraryArgs={name:oArgs.name,featureId:oArgs.overlayId,format:"kml",feature:sKML,v1type:emp.api.core.DataType.POINT};typeLibraryArgs.properties={},typeLibraryArgs.properties.readOnly=!0,typeLibraryArgs.properties.description="",typeLibraryArgs.properties.altitudeMode="clampToGround",typeLibraryArgs.properties.modifiers={},payloads.push(typeLibraryArgs),emp.api.core.addParent(typeLibraryArgs,oArgs.parentId),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addEffort=function(sender,payload){var typeLibraryArgs,args,readOnly,payloads=[];args=emp.api.core.splitArgs(payload),emp.api.core.decodeParameters(args),readOnly="true"!==args[3],typeLibraryArgs={overlayId:args[1],parentId:args[2],name:args[0],properties:{readOnly:readOnly,description:args[4],iconUrl:args[5]}},typeLibraryArgs.parentId&&emp.api.core.isFeature(typeLibraryArgs.parentId)?emp.api.core.translateToFeature(sender,typeLibraryArgs):(emp.api.core.addOverlay(typeLibraryArgs.overlayId),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Overlay",emp.intents.control.OVERLAY_ADD,payloads))},emp.api.core.translateToRemoveGraphic=function(sender,oArgs){var sPayload="";sPayload+='"'+oArgs.overlayId+'",',sPayload+='"unused",',sPayload+='"'+emp.api.core._featureHash[oArgs.overlayId].parentId+'",',emp.api.core.removeGraphic(sender,sPayload)},emp.api.core.removeEffort=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),emp.api.core.decodeParameters(args),typeLibraryArgs={overlayId:args[0]},typeLibraryArgs.overlayId&&emp.api.core.isFeature(typeLibraryArgs.overlayId)?emp.api.core.translateToRemoveGraphic(sender,typeLibraryArgs):(emp.api.core.removeOverlay(typeLibraryArgs.overlayId),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Overlay",emp.intents.control.OVERLAY_REMOVE,payloads))},emp.api.core.addPoint=function(sender,payload){var args,modifiers,kml,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),emp.api.core.decodeParameters(args),modifiers={},11===args.length&&(modifiers=JSON.parse(args[10]).modifiers,modifiers.hasOwnProperty("xOffset")&&"string"==typeof modifiers.xOffset&&(modifiers.xOffset=parseInt(modifiers.xOffset)),modifiers.hasOwnProperty("yOffset")&&"string"==typeof modifiers.yOffset&&(modifiers.yOffset=parseInt(modifiers.yOffset))),kml=emp.api.core.getPointKml({name:args[0],lat:args[4],lon:args[5],iconUrl:args[8],modifiers:modifiers}),typeLibraryArgs={name:args[0],featureId:args[1],format:"kml",feature:kml,v1type:emp.api.core.DataType.POINT},"undefined"==typeof args[7]&&"undefined"==typeof args[8]&&"undefined"==typeof args[9]&&"undefined"==typeof args[10]||(typeLibraryArgs.properties={},"undefined"!=typeof args[7]&&(typeLibraryArgs.properties.description=args[7]),"undefined"!=typeof args[8]&&(typeLibraryArgs.properties.iconUrl=args[8]),"undefined"!=typeof args[9]&&(typeLibraryArgs.properties.altitudeMode=args[9]),"undefined"!=typeof args[10]&&emp.api.core.addCoreModifiersToProperties(modifiers,typeLibraryArgs.properties)),payloads.push(typeLibraryArgs),emp.api.core.addParent(typeLibraryArgs,args[3]),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addPointBatch=function(sender,payload){var batch,i,typeLibraryArgs,payloads=[];for(payload=emp.api.core.formatJSON(payload),batch=JSON.parse(payload),i=0;i<batch.length;i+=1)typeLibraryArgs={},batch[i].name&&(typeLibraryArgs.name=batch[i].name),batch[i].id&&(typeLibraryArgs.featureId=batch[i].id),typeLibraryArgs.format="kml",typeLibraryArgs.v1type=emp.api.core.DataType.POINT,typeLibraryArgs.feature=emp.api.core.getPointKml({name:batch[i].name,lat:batch[i].lat,lon:batch[i].lon,altitude:batch[i].altitude,iconUrl:batch[i].url}),(batch[i].description||batch[i].url||batch[i].altitudeMode)&&(typeLibraryArgs.properties={},batch[i].description&&(typeLibraryArgs.properties.description=batch[i].description),batch[i].url&&(typeLibraryArgs.properties.iconUrl=batch[i].url),batch[i].altitudeMode&&(typeLibraryArgs.properties.altitudeMode=batch[i].altitudeMode),batch[i].modifiers&&emp.api.core.addCoreModifiersToProperties(batch[i].modifiers,typeLibraryArgs.properties),batch[i].overlayId&&(emp.api.core.addParent(typeLibraryArgs,batch[i].overlayId),payloads.push(typeLibraryArgs)));payloads.length>0&&(emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads))},emp.api.core.addMilStdPoint=function(sender,payload){var args,modifiers,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),emp.api.core.decodeParameters(args),modifiers=null,11===args.length&&(modifiers=args[10]),typeLibraryArgs=emp.api.core.createMilStdPointParams({id:args[1],name:args[0],symbolCode:args[4],lat:args[5],lon:args[6],altitude:args[7],description:args[8],altitudeMode:args[9],modifiers:modifiers}),armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode,0)?typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_MULTI_POINT:typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_SYMBOL,payloads.push(typeLibraryArgs),emp.api.core.addParent(typeLibraryArgs,args[3]),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addMilStdPointBatch=function(sender,payload){var typeLibraryArgs,batch,i,payloads=[];for(payload=emp.api.core.formatJSON(payload),batch=JSON.parse(payload),i=0;i<batch.length;i+=1)typeLibraryArgs=emp.api.core.createMilStdPointParams({id:batch[i].id,name:decodeURIComponent(batch[i].name),symbolCode:batch[i].symbolCode,description:decodeURIComponent(batch[i].description),lat:batch[i].lat,lon:batch[i].lon,altitude:batch[i].altitude,altitudeMode:batch[i].altitudeMode,modifiers:decodeURIComponent(batch[i].modifiers)}),armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode,0)?typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_MULTI_POINT:typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_SYMBOL,batch[i].overlayId&&(emp.api.core.addParent(typeLibraryArgs,batch[i].overlayId),payloads.push(typeLibraryArgs));payloads.length>0&&(emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads))},emp.api.core.addMilStdSymbol=function(sender,payload){var args,args2,typeLibraryArgs,payloads=[];args=payload.split('","'),7===args.length?args2=args[6].split(","):(args2=args[7].split(","),args2.splice(0,0,args[6])),emp.api.core.decodeParameters(args),emp.api.core.decodeParameters(args2),typeLibraryArgs=emp.api.core.createMilStdMultiPointParams({name:args[0].replace(/\"/g,""),id:args[1],symbolCode:args[4],coordinates:args[5],description:args2[0],modifiers:"null"===args2[1]?null:args2[1],altitudeMode:args2[3]}),armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode,0)?typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_MULTI_POINT:typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_SYMBOL,emp.api.core.addParent(typeLibraryArgs,args[3]),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addMilStdMultiPointBatch=function(sender,payload){var batch,i,typeLibraryArgs,len,payloads=[];for(payload=emp.api.core.formatJSON(payload),batch=JSON.parse(payload),len=batch.length,i=0;i<len;i+=1)typeLibraryArgs=emp.api.core.createMilStdMultiPointParams({id:batch[i].id,name:decodeURIComponent(batch[i].name),symbolCode:batch[i].symbolCode,description:decodeURIComponent(batch[i].description),coordinates:batch[i].coordinates,altitudeMode:batch[i].altitudeMode,modifiers:decodeURIComponent(batch[i].modifiers)}),armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode,0)?typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_MULTI_POINT:typeLibraryArgs.v1type=emp.api.core.DataType.MIL_STD_SYMBOL,batch[i].overlayId&&emp.api.core.addParent(typeLibraryArgs,batch[i].overlayId),payloads.push(typeLibraryArgs);payloads.length>0&&(emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads))},emp.api.core.add3DShape=function(sender,payload){var args,overlayId,altitudeMode,attributes,typeLibraryArgs,payloads=[];for(args=payload.split('","'),emp.api.core.decodeParameters(args),attributes=args[9];'"'===attributes[attributes.length-1];)attributes=attributes.substr(0,attributes.length-1);attributes=JSON.parse(attributes),altitudeMode=args[6].replace(/\"/g,""),""===altitudeMode&&(altitudeMode=emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND);for(var iIndex=0;iIndex<attributes.attributes.length;iIndex++)void 0===attributes.attributes[iIndex].altitudeMode&&(attributes.attributes[iIndex].altitudeMode=altitudeMode);overlayId=args[3].replace(/\"/g,""),void 0!==overlayId&&null!==overlayId||(overlayId=args[2].replace(/\"/g,"")),typeLibraryArgs=emp.api.core.createMilStdMultiPointParams({name:args[0].replace(/\"/g,""),id:args[1].replace(/\"/g,""),format:"airspace",symbolCode:args[4].replace(/\"/g,""),coordinates:args[7].replace(/\"/g,""),properties:{lineColor:args[8].replace(/\"/g,""),fillColor:args[8].replace(/\"/g,""),attributes:attributes.attributes},v1type:emp.api.core.DataType.AIRSPACE}),emp.api.core.addParent(typeLibraryArgs,overlayId),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addLine=function(sender,payload){var args,args2,extrude,kml,typeLibraryArgs,payloads=[];payload=emp.api.core.formatJSON(payload),args=payload.split('","'),args2=args[6].split(","),emp.api.core.decodeParameters(args),emp.api.core.decodeParameters(args2),extrude=!1,"true"===args2[2]&&(extrude=!0),kml=emp.api.core.getLineKml({name:args[0],coordinates:args[4],extrude:extrude}),typeLibraryArgs={name:args[0].replace(/\"/g,""),featureId:args[1],format:"kml",feature:kml,properties:{lineColor:args2[0],lineWidth:parseInt(args2[1]),altitudeMode:args2[2]},v1type:emp.api.core.DataType.LINE},payloads.push(typeLibraryArgs),emp.api.core.addParent(typeLibraryArgs,args[3]),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addPolygon=function(sender,payload){var args,args2,extrude,kml,typeLibraryArgs,payloads=[];args=payload.split('","'),args2=args[7].split(","),emp.api.core.decodeParameters(args),emp.api.core.decodeParameters(args2),extrude=!1,"true"===args2[3]&&(extrude=!0),kml=emp.api.core.getPolygonKml({name:args[0],coordinates:args[4],extrude:extrude}),typeLibraryArgs={name:args[0].replace(/\"/g,""),featureId:args[1],format:"kml",feature:kml,properties:{description:args[5],fillColor:args[6],lineColor:args2[0],lineWidth:parseInt(args2[1]),altitudeMode:args2[2]},v1type:emp.api.core.DataType.POLYGON},payloads.push(typeLibraryArgs),emp.api.core.addParent(typeLibraryArgs,args[3]),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addKmlStringToOverlay=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={name:args[1],featureId:args[2],format:"kml",feature:decodeURIComponent(args[0]),v1type:emp.api.core.DataType.UNKNOWN},payloads.push(typeLibraryArgs),emp.api.core.addParent(typeLibraryArgs,args[3]),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.setVisibilityBatch=function(sender,payload){var batch,i,typeLibraryArgs,overlayId,payloads=[],payloads2=[];for(payload=payload.substr(1),payload=payload.substr(0,payload.length-1),payload=unescape(payload),batch=JSON.parse(payload),i=0;i<batch.length;i+=1)overlayId=emp.api.core.getOverlayId(batch[i].id),overlayId&&(typeLibraryArgs={featureId:batch[i].id},emp.api.core._featureHash[batch[i].id].parentId&&(typeLibraryArgs.parentId=emp.api.core._featureHash[batch[i].id].parentId),batch[i].visibility?payloads.push(typeLibraryArgs):payloads2.push(typeLibraryArgs));payloads.length>0&&emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.VISIBILITY_SET,payloads),payloads2.length>0&&emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.VISIBILITY_SET,payloads);
},emp.api.core.removeGraphic=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),emp.api.core.decodeParameters(args),typeLibraryArgs={featureId:args[0]},emp.api.core._featureHash[args[2]]?(typeLibraryArgs.overlayId=emp.api.core._featureHash[args[2]].overlayId,typeLibraryArgs.parentId=args[2]):typeLibraryArgs.overlayId=args[2],payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_REMOVE,payloads)},emp.api.core.removeGraphicBatch=function(sender,payload){var typeLibraryArgs,i,batch,payloads=[];for(payload=payload.substr(1),payload=payload.substr(0,payload.length-1),payload=unescape(payload),batch=JSON.parse(payload),i=0;i<batch.graphics.length;i+=1)typeLibraryArgs={featureId:batch.graphics[i].id},emp.api.core._featureHash[batch.graphics[i].overlayId]?(typeLibraryArgs.overlayId=emp.api.core._featureHash[batch.graphics[i].overlayId].overlayId,typeLibraryArgs.parentId=batch.graphics[i].overlayId):typeLibraryArgs.overlayId=batch.graphics[i].overlayId,payloads.push(typeLibraryArgs);emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_REMOVE,payloads)},emp.api.core.removeWMS=function(sender,payload){var typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),typeLibraryArgs={overlayId:emp.wms.manager.getWmsOverlayId(),id:payload,coreId:payload},payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"WMS",emp.intents.control.WMS_REMOVE,payloads)},emp.api.core.removeUrl=function(sender,payload){var typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),typeLibraryArgs={coreId:payload,overlayId:emp.api.core.getOverlayId(payload),featureId:payload},payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.WMS_REMOVE,payloads)},emp.api.core.addKml=function(sender,payload){var args,typeLibraryArgs,payloads=[],mapInstance=emp.instanceManager.getInstance(sender.id);payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={coreId:args[0],featureId:args[0],name:args[1],url:args[0],format:"kml",v1type:emp.api.core.DataType.UNKNOWN},emp.api.core.addParent(typeLibraryArgs,mapInstance.engines.getDefaultLayerOverlayID()),payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addImageOverlay=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={featureId:args[0],name:"Image",format:"image",url:args[0],params:{left:args[1],bottom:args[2],right:args[3],top:args[4]},v1type:emp.api.core.DataType.UNKNOWN},emp.api.core.addParent(typeLibraryArgs,emp.wms.manager.getWmsOverlayId()),payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)},emp.api.core.addKmlFromString=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={featureId:args[2],name:args[1],feature:args[0],format:"kml",v1type:emp.api.core.DataType.UNKNOWN},payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"Feature",emp.intents.control.FEATURE_ADD,payloads)};var iWMSCount=1;emp.api.core.addWms=function(sender,payload){var typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),typeLibraryArgs={id:payload,coreId:payload,name:"V1 WMS Service "+iWMSCount,url:payload,format:"wms",v1type:emp.api.core.DataType.UNKNOWN},iWMSCount++,emp.api.core.addParent(typeLibraryArgs,emp.wms.manager.getWmsOverlayId()),payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"WMS",emp.intents.control.WMS_ADD,payloads)},emp.api.core.editFeature=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),emp.api.core.decodeParameters(args),typeLibraryArgs={featureId:args[0]},emp.api.core._featureHash[args[2]]?(typeLibraryArgs.overlayId=emp.api.core._featureHash[args[2]].overlayId,typeLibraryArgs.parentId=args[2]):typeLibraryArgs.overlayId=args[2],payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Edit",emp.intents.control.EDIT_BEGIN,payloads)},emp.api.core.gotoLocation=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={location:{lat:parseFloat(args[0]),lon:parseFloat(args[1])}},args[2]&&(typeLibraryArgs.zoom=parseFloat(args[2])),payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"View",emp.intents.control.VIEW_SET,payloads)},emp.api.core.goToLocationWithScale=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={location:{lat:parseFloat(args[0]),lon:parseFloat(args[1])}},args[2]&&(typeLibraryArgs.zoom=parseFloat(args[2])*emp.api.core.scaleMultiplier),payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"View",emp.intents.control.VIEW_SET,payloads)},emp.api.core.setScale=function(sender,payload){var typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),typeLibraryArgs={range:parseFloat(payload)*emp.api.core.scaleMultiplier},payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"View",emp.intents.control.VIEW_SET,payloads)},emp.api.core.setView=function(sender,payload){var typeLibraryArgs,payloads=[];payload=JSON.parse(payload),typeLibraryArgs={location:{lat:payload.latitude,lon:payload.longitude},range:payload.altitude,tilt:payload.tilt,heading:payload.heading},payloads.push(typeLibraryArgs),emp.api.core.createTransaction(sender.id,"View",emp.intents.control.VIEW_SET,payloads)},emp.api.core.goToLocationById=function(sender,payload){var typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),typeLibraryArgs={featureId:payload,overlayId:emp.api.core.getOverlayId(payload)},payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"View",emp.intents.control.VIEW_SET,payloads)},emp.api.core.drawPolygon=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={name:args[0],featureId:args[1],v1type:emp.api.core.DataType.POLYGON,type:"polygon"},emp.api.core.addParent(typeLibraryArgs,args[3]),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Draw",emp.intents.control.DRAW_BEGIN,payloads)},emp.api.core.drawLine=function(sender,payload){var args,typeLibraryArgs,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),typeLibraryArgs={name:args[0],featureId:args[1],v1type:emp.api.core.DataType.LINE,type:"line"},emp.api.core.addParent(typeLibraryArgs,args[3]),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Draw",emp.intents.control.DRAW_BEGIN,payloads)},emp.api.core.drawMil2525Symbol=function(sender,payload){var args,typeLibraryArgs,sType=emp.api.core.DataType.UNKNOWN,payloads=[];payload=payload.replace(/\"/g,""),args=payload.split(","),sType=emp.helpers.isAirspaceSymbol(args[4])?emp.api.core.DataType.AIRSPACE:armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(args[4],0)?emp.api.core.DataType.MIL_STD_MULTI_POINT:emp.api.core.DataType.MIL_STD_SYMBOL,typeLibraryArgs={name:args[0],featureId:args[1],symbolCode:args[4],v1type:sType,type:"milstd"},emp.api.core.addParent(typeLibraryArgs,args[3]),args[5]&&(typeLibraryArgs.properties={},typeLibraryArgs.properties.modifiers=emp.api.core.createModifiers(args[5])),payloads.push(typeLibraryArgs),emp.api.core.recurseStrFixInbound(payloads),emp.api.core.createTransaction(sender.id,"Draw",emp.intents.control.DRAW_BEGIN,payloads)},emp.api.core.formatJSON=function(input){var exp=/\,\s*([a-zA-Z0-9]*)\s*\:/g,exp2=/\{\s*([a-zA-Z0-9]*)\s*\:/g,exp3=/\:\s*(undefined|null)\s*\,/g;return input=input.replace(exp,function(match,capture){return', "'+capture+'" : '}),input=input.replace(exp2,function(match,capture){return'{ "'+capture+'" : '}),input=input.replace(exp3,function(match,capture){return': "'+capture+'" ,'})},emp.api.core.createModifiers=function(oldModifiers){var modifiers={};if(void 0!==oldModifiers&&null!==oldModifiers){for(;'"'===oldModifiers[oldModifiers.length-1];)oldModifiers=oldModifiers.substr(0,oldModifiers.length-1);oldModifiers=JSON.parse(oldModifiers),modifiers=oldModifiers?oldModifiers.modifiers:void 0}else modifiers=void 0;return modifiers},emp.api.core.decodeParameters=function(array){var i;for(i=0;i<array.length;i++)jQuery.type("string"===array[i])&&(array[i]=decodeURIComponent(array[i]),"undefined"!==array[i]&&'"undefined"'!==array[i]||(array[i]=void 0))},emp.api.core.strFix=function(args){var sPattern1=/\./g;return sPattern1.test(args)&&(args="FIX_DONE"+args.replace(sPattern1,"-A_PERIOD-")),args},emp.api.core.strDeFix=function(args){var sPattern1=/^FIX\x5FDONE/,sPattern2=/\x2DA\x5FPERIOD\x2D/g;return sPattern1.test(args)&&(args=args.replace(sPattern1,""),sPattern2.test(args)&&(args=args.replace(sPattern2,"."))),args},emp.api.core.recurseStrFixInbound=function(args){return args},emp.api.core.recurseStrFixOutbound=function(args){return args},emp.api.core.addCoreModifiersToProperties=function(oldModifiers,properties){return void 0!==oldModifiers.xOffset&&(properties.xOffset=oldModifiers.xOffset),void 0!==oldModifiers.yOffset&&(properties.yOffset=oldModifiers.yOffset),oldModifiers.xUnits&&(properties.xUnits=oldModifiers.xUnits),oldModifiers.yUnits&&(properties.yUnits=oldModifiers.yUnits),properties},emp.api.core.createMilStdPointParams=function(args){var modifiers,typeLibraryArgs={name:args.name,featureId:args.id,data:{type:"Point",coordinates:[args.lon,args.lat],symbolCode:args.symbolCode},format:"milstd",type:emp.api.core.DataType.MIL_STD_SYMBOL};if(args.altitude&&typeLibraryArgs.data.coordinates.push(args.altitude),args.modifiers||args.description){if(typeLibraryArgs.properties={},args.modifiers&&(modifiers=emp.api.core.createModifiers(args.modifiers),modifiers&&(typeLibraryArgs.properties.modifiers=modifiers),modifiers.fillColor)){var sColor=modifiers.fillColor.substr(2);typeLibraryArgs.properties.fillColor=sColor,sColor=modifiers.fillColor.substr(0,2),typeLibraryArgs.properties.fillOpacity=parseInt("0x"+sColor)/255}args.description&&(typeLibraryArgs.properties.description=args.description)}return typeLibraryArgs},emp.api.core.createMilStdMultiPointParams=function(args){var coordinatesStringArray,coordinateComponents,coordinate,coordinates=[],typeLibraryArgs={name:args.name,featureId:args.id,overlayId:args.overlayId,data:{symbolCode:args.symbolCode},format:args.format||"milstd",properties:args.properties||{},type:emp.api.core.DataType.MIL_STD_MULTI_POINT};if((args.description||args.modifiers)&&(args.description&&(typeLibraryArgs.properties.description=args.description),args.modifiers&&(typeLibraryArgs.properties.modifiers=emp.api.core.createModifiers(args.modifiers))),args.coordinates){coordinatesStringArray=args.coordinates.split(" ");for(var iIndex=0;iIndex<coordinatesStringArray.length;iIndex++)coordinateComponents=coordinatesStringArray[iIndex].split(","),coordinateComponents.length>=2&&(coordinate=new Array,coordinate.push(parseFloat(coordinateComponents[0])),coordinate.push(parseFloat(coordinateComponents[1])),coordinateComponents>=3&&coordinate.push(parseFloat(coordinateComponents[2])),coordinates.push(coordinate));1===coordinates.length?(typeLibraryArgs.data.coordinates=coordinate,typeLibraryArgs.data.type="Point"):(typeLibraryArgs.data.coordinates=coordinates,typeLibraryArgs.data.type="LineString")}return typeLibraryArgs},emp.api.core.getPointKml=function(args){var kmlString,hotSpotX=32,hotSpotY=1,xUnits="pixels",yUnits="pixels",iconUrl="http://maps.google.com/mapfiles/kml/paddle/wht-blank.png";return args.hasOwnProperty("modifiers")&&(args.modifiers.hasOwnProperty("xOffset")&&(hotSpotX=args.modifiers.xOffset),args.modifiers.hasOwnProperty("yOffset")&&(hotSpotY=args.modifiers.yOffset)),kmlString="<Placemark><name>"+args.name+"</name><Style><IconStyle><Icon>",kmlString+=args.iconUrl?"<href>"+args.iconUrl+"</href>":"<href>"+iconUrl+"</href>",kmlString+="</Icon>",kmlString+='<hotSpot x="'+hotSpotX+'" y="'+hotSpotY+'" xunits="'+xUnits+'" yunits="'+yUnits+'"/>',kmlString+="</IconStyle></Style><Point><coordinates>"+args.lon+","+args.lat,void 0!==args.altitude&&(kmlString+=","+args.altitude),kmlString+="</coordinates></Point></Placemark>"},emp.api.core.getLineKml=function(args){var kmlString;return kmlString="<Placemark><name>"+args.name+"</name><LineString><coordinates>"+args.coordinates+"</coordinates></LineString></Placemark>"},emp.api.core.getPolygonKml=function(args){var kmlString,firstCoordinate;return firstCoordinate=args.coordinates.substr(0,args.coordinates.indexOf(" ")),kmlString="<Placemark><name>"+args.name+"</name><Polygon><outerBoundaryIs><LinearRing><coordinates>"+args.coordinates+" "+firstCoordinate+"</coordinates></LinearRing></outerBoundaryIs></Polygon></Placemark>"},emp.api.core.handleMessage=function(sender,msg){var functionName,payload;functionName=msg.substring(0,msg.indexOf("(")),payload=msg.substring(msg.indexOf("(")+1,msg.lastIndexOf(")")),sender=JSON.parse(sender),emp.api.core._callbackHash[functionName](sender,payload)},emp.api.core.splitArgs=function(payload){var i,args=payload.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g),len=args.length;for(i=0;i<len;i++)args[i]=args[i].replace(/\"/g,"");return args},emp.api.core.createTransaction=function(senderId,sGlobalType,sIntent,payloads){var transaction,i,oItem,oItems=[],sTransID=emp.helpers.id.newGUID();for(i=0;i<payloads.length;i+=1){switch(payloads[i].intent=sIntent,oItem=new emp.typeLibrary[sGlobalType](payloads[i]),sIntent){case emp.intents.control.DRAW_BEGIN:case emp.intents.control.FEATURE_ADD:oItem.v1Type=payloads[i].v1type}oItems.push(oItem)}transaction=new emp.typeLibrary.Transaction({intent:sIntent,transactionId:sTransID,sender:senderId,source:emp.api.core.SOURCE,items:oItems}),emp.api.core.transactionQueue.add(transaction)},emp.api.core._callbackHash={addMilStdPointBatch:emp.api.core.addMilStdPointBatch,addMilStdPoint:emp.api.core.addMilStdPoint,addMilStdMultiPointBatch:emp.api.core.addMilStdMultiPointBatch,addMilStdSymbol:emp.api.core.addMilStdSymbol,addEffort:emp.api.core.addEffort,removeEffort:emp.api.core.removeEffort,addKmlStringToOverlay:emp.api.core.addKmlStringToOverlay,addPoint:emp.api.core.addPoint,addPointBatch:emp.api.core.addPointBatch,addLine:emp.api.core.addLine,add3DShape:emp.api.core.add3DShape,addPolygon:emp.api.core.addPolygon,addImageOverlay:emp.api.core.addImageOverlay,removeImageOverlay:emp.api.core.removeUrl,removeKml:emp.api.core.removeUrl,removeWms:emp.api.core.removeWMS,goToLocationWithRange:emp.api.core.gotoLocation,goToLocation:emp.api.core.gotoLocation,goToLocationWithScale:emp.api.core.goToLocationWithScale,setScale:emp.api.core.setScale,addKml:emp.api.core.addKml,addKmlFromString:emp.api.core.addKmlFromString,addWms:emp.api.core.addWms,setVisibilityBatch:emp.api.core.setVisibilityBatch,goToLocationById:emp.api.core.goToLocationById,editFeature:emp.api.core.editFeature,drawPolygon:emp.api.core.drawPolygon,drawLine:emp.api.core.drawLine,drawMil2525Symbol:emp.api.core.drawMil2525Symbol,removeGraphicBatch:emp.api.core.removeGraphicBatch,removeGraphic:emp.api.core.removeGraphic,setView:emp.api.core.setView},emp.api.core.publish=function(args){var channel,payload,button,i,index,lon,lat,type,dataType,oItem,oFeature,ctrlKey=!1,shiftKey=!1,altKey=!1,eventData={},getKMLCoordinateString=function(sKML){var sStrCoordinate="",oKMLDoc=emp.util.parseXML(sKML);return emp.util.each(oKMLDoc.getElementsByTagName("coordinates"),function(node){sStrCoordinate.length>0&&(sStrCoordinate+=" "),sStrCoordinate+=node.childNodes[0].nodeValue}),sStrCoordinate};if(args&&args.items&&args.items.length>0){switch(oItem=args.items[0],args.intent){case emp.intents.control.VIEW_CHANGE:channel=emp.api.core.channel.names.MAP_EVENT,payload={type:emp.api.core.EventType.MAP_MOVE,eventData:{lat:args.items[0].location.lat,lon:args.items[0].location.lon,altitude:args.items[0].range,scale:args.items[0].range/emp.api.core.scaleMultiplier,left:args.items[0].bounds.west,bottom:args.items[0].bounds.south,right:args.items[0].bounds.east,top:args.items[0].bounds.north}};break;case emp.intents.control.STATUS_CHANGE:channel=emp.api.core.channel.names.MAP_EVENT,"ready"===args.items[0].status&&(payload={type:emp.api.core.EventType.MAP_READY,eventData:{lat:void 0,lon:void 0,altitude:void 0,scale:void 0,left:void 0,bottom:void 0,right:void 0,top:void 0}});break;case emp.intents.control.FEATURE_CLICK:if(channel=emp.api.core.channel.names.GRAPHIC_EVENT,"single"===oItem.type)type=emp.api.core.EventType.GRAPHIC_CLICK;else{if("double"!==oItem.type)return;type=emp.api.core.EventType.GRAPHIC_DBL_CLICK}switch(oItem.button){case"left":button=0;break;case"middle":button=1;break;case"right":button=2}for(i=0;i<oItem.keys.length;i+=1)"ctrl"===oItem.keys[i]?ctrlKey=!0:"shift"===oItem.keys[i]?shiftKey=!0:"alt"===oItem.keys[i]&&(altKey=!0);if(oFeature=emp.storage.findFeature(oItem.overlayId,oItem.featureId),payload={type:type,eventData:{id:oItem.featureId,overlayId:oItem.overlayId,name:oItem.name,lat:oItem.lat,lon:oItem.lon,mgrs:oItem.mgrs,altitude:oItem.elevation,button:button,clientX:oItem.clientX,clientY:oItem.clientY,screenX:oItem.screenX,screenY:oItem.screenY,altKey:altKey,ctrlKey:ctrlKey,shiftKey:shiftKey}},oFeature)switch(oFeature.v1Type){case emp.api.core.DataType.MIL_STD_SYMBOL:payload.eventData.dataType="milStdPoint",payload.eventData.symbolCode=oFeature.data.symbolCode,payload.eventData.coordinates=emp.helpers.coordinatesToString(oFeature.data);break;case emp.api.core.DataType.POINT:payload.eventData.dataType=emp.api.core.DataType.POINT,payload.eventData.coordinates=getKMLCoordinateString(oFeature.data);break;case emp.api.core.DataType.LINE:payload.eventData.dataType=emp.api.core.DataType.LINE,payload.eventData.coordinates=getKMLCoordinateString(oFeature.data);break;case emp.api.core.DataType.POLYGON:payload.eventData.dataType=emp.api.core.DataType.POLYGON;var sStrCoord=getKMLCoordinateString(oFeature.data);payload.eventData.coordinates=sStrCoord.slice(0,sStrCoord.lastIndexOf(" "));break;case emp.api.core.DataType.MIL_STD_MULTI_POINT:payload.eventData.dataType=emp.api.core.DataType.MIL_STD_MULTI_POINT,payload.eventData.symbolCode=oFeature.data.symbolCode,payload.eventData.coordinates=emp.helpers.coordinatesToString(oFeature.data);break;case emp.api.core.DataType.AIRSPACE:payload.eventData.dataType=emp.api.core.DataType.AIRSPACE,payload.eventData.symbolCode=oFeature.data.symbolCode,payload.eventData.coordinates=emp.helpers.coordinatesToString(oFeature.data)}break;case emp.intents.control.CLICK:if(channel=emp.api.core.channel.names.MAP_EVENT,"single"===args.items[0].type)type=emp.api.core.EventType.MAP_CLICKED;else{if("double"!==args.items[0].type)return;type=emp.api.core.EventType.MAP_DBL_CLICKED}switch(args.items[0].button){case"left":button=0;break;case"middle":button=1;break;case"right":button=2}for(i=0;i<args.items[0].keys.length;i+=1)"ctrl"===args.items[0].keys[i]?ctrlKey=!0:"shift"===args.items[0].keys[i]?shiftKey=!0:"alt"===args.items[0].keys[i]&&(altKey=!0);payload={type:type,eventData:{lat:args.items[0].lat,lon:args.items[0].lon,mgrs:args.items[0].mgrs,altitude:args.items[0].elevation,button:button,clientX:args.items[0].clientX,clientY:args.items[0].clientY,screenX:args.items[0].screenX,screenY:args.items[0].screenY,altKey:altKey,ctrlKey:ctrlKey,shiftKey:shiftKey}};break;case emp.intents.control.DRAW_UPDATE:case emp.intents.control.EDIT_UPDATE:switch(channel=emp.api.core.channel.names.GRAPHICS_DRAW_EVENT,oFeature=args.items[0],args.intent===emp.intents.control.EDIT_UPDATE&&(channel=emp.api.core.channel.names.GRAPHIC_EVENT),oFeature.v1Type){case emp.api.core.DataType.UNKNOWN:case void 0:switch(oFeature.format){case emp.typeLibrary.featureFormatType.IMAGE:break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:var iStdVersion=emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oFeature.properties.standard);dataType=armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(oFeature.data.symbolCode,iStdVersion)?emp.api.core.DataType.MIL_STD_MULTI_POINT:emp.api.core.DataType.MIL_STD_SYMBOL;break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:dataType=emp.api.core.DataType.AIRSPACE;break;case emp.typeLibrary.featureFormatType.GEOJSON:case emp.typeLibrary.featureFormatType.KML:switch(oFeature.data.type){case"Point":dataType=emp.api.core.DataType.POINT;break;case"LineString":dataType=emp.api.core.DataType.LINE;break;case"Polygon":dataType=emp.api.core.DataType.POLYGON}}break;default:dataType=oFeature.v1Type}oFeature.updates&&oFeature.updates.indices&&oFeature.updates.indices.length>0?(index=oFeature.updates.indices[0],lon=oFeature.updates.coordinates[0].lon,lat=oFeature.updates.coordinates[0].lat):(index=-1,lon=0,lat=0),eventData={isComplete:oFeature.complete,dataType:dataType,description:oFeature.description,id:oFeature.featureId,name:oFeature.name,coordinates:emp.helpers.coordinatesToString(oFeature.data),index:index,lat:lat,lon:lon},payload={type:oFeature.complete?emp.api.core.EventType.DRAW_COMPLETE:emp.api.core.EventType.GRAPHIC_UPDATE,eventData:eventData}}void 0!==channel&&void 0!==payload&&emp.environment.get().pubSub.publish({message:payload,channel:channel})}};var emp=window.emp||{};emp.instanceManager=function(){function cleanupInstance(mapInstanceId,bDumpQ){var oInstance,oKeyList,iIndex,oUIComponent,domContainerId;if(oInstance=instances[mapInstanceId].map,domContainerId=instances[mapInstanceId].domContainer,bDumpQ?emp.transactionQueue.dumpMapQueue(mapInstanceId):emp.transactionQueue.purgeMapQueue(mapInstanceId),emp.transactionQueue.listener.remove({type:emp.intents.control.MAP_ENGINE_SWAP_START,mapInstanceId:mapInstanceId,callback:storageReloadStart}),emp.transactionQueue.listener.remove({type:emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,mapInstanceId:mapInstanceId,callback:storageReloadComplete}),void 0!==oInstance.uiComponents)for(oKeyList=emp.helpers.associativeArray.getKeys(oInstance.uiComponents),iIndex=0;iIndex<oKeyList.length;iIndex+=1)oUIComponent=oInstance.uiComponents[oKeyList[iIndex]],oUIComponent&&"function"==typeof oUIComponent.destroy&&oUIComponent.destroy(),delete oInstance.uiComponents[oKeyList[iIndex]];emp.wms.manager.removeMapInstance({mapInstanceId:mapInstanceId}),new oInstance.eventing.StatusChange({status:emp.map.states.TEARDOWN}),oInstance.discardInstance(),cmapiInterface.destroyMapInstance({instanceId:mapInstanceId}),emp.storage.removeMapInstance({mapInstanceId:mapInstanceId}),emp.transactionQueue.removeMapInstance(mapInstanceId),delete instances[mapInstanceId];for(var container=document.getElementById(domContainerId);container.firstChild;)container.removeChild(container.firstChild)}var hCheckPendingTimer,bInitialLoadInProgress=!1,bMapSwapInProgress=!1,oPendingMapInstanceCreateList=[],instances={},oRegisteredMapEngines={},cmapiInterface=emp.api.cmapiInterface(),initialize=function(args){var environment=args.environment,clientCallback=args.callback,clientShutdownCB=args.shutdownCallback,map=args.map,readyCallback=function(){cmapiInterface.createMapInstance({mapInstanceId:map.mapInstanceId}),clientCallback&&clientCallback(map.mapInstanceId)},shutdownCallback=function(){var payload={status:emp.map.states.TEARDOWN},oTransaction=new emp.typeLibrary.Transaction({mapInstanceId:map.instanceId,intent:emp.intents.control.STATUS_RESPONSE_INIT,source:emp.core.sources.CORE,items:[payload]});oTransaction.run(),clientShutdownCB&&clientShutdownCB()};args&&(args.hasOwnProperty("relayPath")&&(emp.environment.owf.properties.rpcRelayPath=args.rpcRelayPath),args.hasOwnProperty("logLevel")&&emp.errorHandler.set(args.logLevel),args.hasOwnProperty("validate")&&(args.validate===!0?emp.validate=!0:args.validate===!1&&(emp.validate=!1))),emp.environment.setCallbacks(readyCallback,shutdownCallback),environment!==emp.environment.browser?emp.environment.set({environments:[environment,emp.environment.browser],mapInstanceId:args.map.mapInstanceId,messageId:args.messageId}):emp.environment.set({environments:[emp.environment.browser],mapInstanceId:args.map.mapInstanceId,messageId:args.messageId})},buildInstance=function(args){var initEngine,environment,map,instanceDomId=args.instanceDomId,instanceId=args.instanceId;return instanceDomId=emp.ui.renderContainer({instanceId:instanceId,domContainer:instanceDomId,recorder:args.recorder}),map=emp.map({mapInstanceId:instanceId,extent:args.extent}),instances[instanceId]={map:map,domContainer:instanceDomId},emp.transactionQueue.newMapInstance({mapInstanceId:instanceId}),emp.storage.newMapInstance({mapInstanceId:instanceId}),emp.wms.manager.newMapInstance({mapInstanceId:instanceId}),map.init(),map.uiComponents={},initEngine=function(){setTimeout(function(){try{new map.eventing.StatusChange({status:emp.map.states.INITIALIZING}),map.engines.load(args.engine)}catch(err){console.error("Map instance startup failed.\n  name:"+err.name+"\n  message:"+err.message+"\n  stack:"+err.stack),emp.instanceManager.mapInstanceStartupFailed(instanceId)}},0)},environment=emp.util.validateEnvironment(args.environment),initialize({callback:initEngine,environment:environment,map:map,instanceId:instanceId,instanceDomId:instanceDomId,messageId:args.messageId}),map};cmapiInterface.init(),emp.storage.init();var storageReloadStart=function(){bMapSwapInProgress=!0},storageReloadComplete=function(){bMapSwapInProgress=!1},attempts=10,checkRendererFontsLoaded=function(){return void 0===armyc2||void 0===armyc2.c2sd||void 0===armyc2.c2sd.renderer||void 0===armyc2.c2sd.renderer.utilities||void 0===armyc2.c2sd.renderer.utilities.RendererUtilities?void setTimeout(checkRendererFontsLoaded,1e3):!!armyc2.c2sd.renderer.utilities.RendererUtilities.fontsLoaded()||void(attempts>0?(attempts-=1,setTimeout(checkRendererFontsLoaded,1e3),armyc2.c2sd.renderer.MilStdIconRenderer.Render("SHAPWMSA-------",{})):console.error("MIL-SYM-JS 2525 Rendering fonts failed to load.  Please ensure that the mil-symjs JavaScript and CSS files are included on the application correctly"))},publicInterface={getInstance:function(instanceId){if(instances[instanceId])return instances[instanceId].map},createInstance:function(args){return 0===emp.helpers.associativeArray.size(instances)&&checkRendererFontsLoaded(),args.instanceId=emp.helpers.id.newGUID(),oPendingMapInstanceCreateList.push(args),this.startNextPendingMapInstance(),emp.transactionQueue.listener.add({type:emp.intents.control.MAP_ENGINE_SWAP_START,mapInstanceId:args.instanceId,callback:storageReloadStart}),emp.transactionQueue.listener.add({type:emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,mapInstanceId:args.instanceId,callback:storageReloadComplete}),args.instanceId},destroyInstance:function(args){instances.hasOwnProperty(args.mapInstanceId)&&(this.isMapEngineLoading()?setTimeout(function(){publicInterface.destroyInstance(args)},50):(new publicInterface.getInstance(args.mapInstanceId).eventing.StatusChange({status:emp.map.states.SHUTDOWN_IN_PROGRESS}),cleanupInstance(args.mapInstanceId,!1),setTimeout(function(){var transactionMessage={messageId:args.messageId,originatingChannel:cmapi.channel.names.MAP_SHUTDOWN,status:"success",details:{},failures:[]};emp.environment.get().pubSub.publish({channel:cmapi.channel.names.MAP_MESSAGE_COMPLETE,message:transactionMessage,sender:{id:args.mapInstanceId}})},50)))},isMapEngineLoading:function(){return bMapSwapInProgress||bInitialLoadInProgress},startNextPendingMapInstance:function(){var oInstanceArgs;hCheckPendingTimer&&(clearTimeout(hCheckPendingTimer),hCheckPendingTimer=void 0),oPendingMapInstanceCreateList.length>0&&(this.isMapEngineLoading()?hCheckPendingTimer=setTimeout(function(){hCheckPendingTimer=void 0,emp.instanceManager.startNextPendingMapInstance()},1e3):(bInitialLoadInProgress=!0,oInstanceArgs=oPendingMapInstanceCreateList.shift(),emp.util.config.getConfigObject(),buildInstance(oInstanceArgs)))},statusChangeHdlr:function(oTrans){var oMapEngine,oTransaction,oSettings,asLabels;switch(instances.hasOwnProperty(oTrans.mapInstanceId)&&(oMapEngine=instances[oTrans.mapInstanceId].map,oSettings=oMapEngine.uiComponents.settings),oTrans.items[0].status){case emp.map.states.INITIALIZING:break;case emp.map.states.READY:case emp.map.states.MAP_SWAP_IN_PROGRESS:oMapEngine&&oMapEngine.engines.isMapSwapInProgress()?void 0!==oSettings&&(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MIL_ICON_SIZE_SET,mapInstanceId:oTrans.mapInstanceId,source:emp.core.sources.CORE,items:[oSettings.iconSizeOption]}),oTransaction.run(),asLabels=oSettings.getMilStdLabelList(),oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.MIL_ICON_LABELS_SET,mapInstanceId:oTrans.mapInstanceId,source:emp.core.sources.CORE,items:[asLabels]}),oTransaction.run(),oMapEngine&&oMapEngine.engine.capabilities.projection.flat&&(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.PROJECTION_ENABLE_FLAT,mapInstanceId:oTrans.mapInstanceId,items:[oSettings.mapProjectionFlat]}),oTransaction.run())):oMapEngine&&bInitialLoadInProgress&&(void 0!==oSettings&&oMapEngine&&oMapEngine.engine.capabilities.projection.flat&&(oTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.PROJECTION_ENABLE_FLAT,mapInstanceId:oTrans.mapInstanceId,items:[oSettings.mapProjectionFlat]}),oTransaction.queue()),bInitialLoadInProgress=!1),hCheckPendingTimer=setTimeout(function(){emp.instanceManager.startNextPendingMapInstance()},50);break;case emp.map.states.MAP_INSTANCE_INIT_FAILED:oMapEngine&&emp.instanceManager.mapInstanceStartupFailed(oTrans.mapInstanceId)}},registerMapEngine:function(args){var currentEngineConfiguration=emp.util.config.getCurrentEngineConfiguration();oRegisteredMapEngines[emp.util.config.getCurrentMapEngineId()]={fnInitialize:args.fnInitialize,engineConfiguration:currentEngineConfiguration}},getMapEngineRegistration:function(mapEngineId){return oRegisteredMapEngines[mapEngineId]},getPreviousMapEngineId:function(){return oRegisteredMapEngines.previousMapEngineId},getCurrentMapEngineId:function(){return oRegisteredMapEngines.currentMapEngineId},mapInstanceStartupFailed:function(mapInstanceId){bInitialLoadInProgress&&setTimeout(function(){cleanupInstance(mapInstanceId,!0),bInitialLoadInProgress=!1,emp.instanceManager.startNextPendingMapInstance()},50)}};return publicInterface}();var emp=window.emp||{};emp.ui=emp.ui||{},emp.ui.consts={IFRAME_SHIM:'<iframe class="emp_iframeshim" frameborder="0" scrolling="no"><html><head></head><body></body></html></iframe>'},emp.ui.images=emp.ui.images||{},emp.ui.images.addPoint="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABO0lEQVQ4jd2SMS8DcRjGf70Wxw1KXGmCxFYnFhUxNRFJvwEz30JiELOBwZeQiG8gpJGQMJhaHYjh0tJrqR531//17iwGrqXm/pJ3efO+T573yQs9j/xVvxLp1JxVZW17dXJnekTOWJbL+X0jt3/5tNv0gnxXgdSYrB1vpM7m5kcTDPeD4dDUPzi4KFe2TvUV4IdINCywl506zC4mllhOwIIKwkN6thmWJOX2yVL1hjj+Pi+Fbx5X+jL4AQgfrBYIH8/1EZ6POhTLhDOJhR2UTIGoOvRfG1Co4xs2xkuTkulSs1tteYUFnNMHM5dOKusTposkRXizWzzWBTcli2LVyQHOnxncVe285QZrQYCiN1yKtSZX+jsnhdeKbopNwGiz0QFtJj5wlE4q5dmxwXJcjh4B2n8Ww3R9pB7gE7HRfjsJdfStAAAAAElFTkSuQmCC",emp.ui.images.editPoint="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAACD0lEQVRIie2UvU4UURiGnznDTGZnQZefsBHMYgwYCiUh8QIIBUEgVDZ7AYaCizCxtLMwFLZGCgsNBYV3YEg0mqCFKyFZdU1k3ew4szPnzMwZi1ELdRTQSnmrU5w8z/n5vg9O8s/HOMJeAdhf1grQf0vg1mprq9Xqct2yTp9LU+h2XzaazY3NIHi2DfSOLSiVzp+dmbl9Z2xsfsG2bQGQJCAldLsfdaNxY6vVurUOvCtimL86+ezsvbu12uLiwIBpVCrQ3w9C5BLDKBmuOzfd672aCsPdLSD+GUQU0cfH11ar1fkF24ahIZiYgFoNhoehVMpFluUwOnptxTDspSJOkUCMjCzXTdMWppkDXRfKZXCcHP41jjMlXPdSvYjVVyCwhcg/NI7B96HTgSwDzwOl8mdK0wytI0zz1CR5hUWHFRDHCUpBGMLBAURRLgiCXKgUKCWJ4xZJ8qkIUyhQnrfTGBycm8ky8e0WuTiXSZkg5Rt6vRdIudcg740fUlRFWRTt6XJ57qphjBhpKlAqL08pM6SUhGET339Ku31fh+Hz68DuUQSkaWdfqbcXLWtiWus+4jhFqR5SfiCKXuP7T+h0tvG8Rw+yTN2koEx/18lj5fLljUrlyorjXBCGIUgSDyn38f3HOgh2HmodrAPviwCHGhUglizrTF2I0mSWpSRJu6G1twn82aj4Lscadif5D/IZExLkwq8MOJIAAAAASUVORK5CYII=",
emp.ui.renderContainer=function(args){var domCont,instanceContainer,instanceId=args.instanceId,domTargetId=args.domContainer,styleStrings={loadingPanel:"height:100%;overflow: hidden;z-index: 9989;display:flex;align-items: center; justify-content: center;",emp:"color: #FFFFFF;text-align:center;",loader:"",absmax:";position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px; overflow: hidden;",instanceStyle:"position:relative;width:100%; height:100%;overflow: hidden; background-color:#616161",containerStyle:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }.circle { width: 100px; height: 100px; position: absolute; top: 200px; left: 0; bottom: 0; right: 0; margin: auto; background-color: #717171; border-radius: 50%; }.inner-circle { width: 92%; height: 92%; background: #616161; border-radius: 50%; margin: auto; vertical-align: middle; position: absolute; top: 0; left: 0; bottom: 0; right: 0; }.spinner { height: 0; width: 0; border-radius: 50%; border: 50px solid transparent; border-right-color: rgba(255, 255, 255, 0.3); -webkit-animation: spin 1.6s infinite; -moz-animation: spin 1.6s infinite; -o-animation: spin 1.6s infinite; animation: spin 1.6s infinite; }",recorder:"position: absolute; top: 35px; left: 100px; overflow: hidden; width: 100px height: 100px z-index: 10500; background-color: yellow"};instanceContainer=document.createElement("div"),instanceContainer.id=instanceId,instanceContainer.setAttribute("style",styleStrings.instanceStyle);var loadingPanel,flexStart,flexEnd,loadingPanelStatus,messageHolder,spinner,innerSpinner,innerCircle,loadingMessageSpan,loadingStatus,styleTag,instanceMap,head;if(head=document.head||document.getElementsByTagName("head")[0],styleTag=document.createElement("style"),styleTag.type="text/css",styleTag.styleSheet?styleTag.setAttribute("style",styleStrings.containerStyle):styleTag.appendChild(document.createTextNode(styleStrings.containerStyle)),head.appendChild(styleTag),loadingPanel=document.createElement("div"),loadingPanel.id=instanceId+"_loadingPanel",loadingPanel.setAttribute("style",styleStrings.loadingPanel),flexStart=document.createElement("div"),flexStart.style.alignSelf="flex-start",loadingPanelStatus=document.createElement("div"),loadingPanelStatus.id=instanceId+"_loadingPanelStatus",messageHolder=document.createElement("div"),messageHolder.id=instanceId+"_messageHolder",messageHolder.setAttribute("style",styleStrings.emp),loadingMessageSpan=document.createElement("span"),loadingMessageSpan.id=instanceId+"_loadingMessage",loadingStatus=document.createElement("div"),loadingStatus.id=instanceId+"_loadingStatus",spinner=document.createElement("div"),spinner.id=instanceId+"_loadSpinner",spinner.className="circle",innerSpinner=document.createElement("div"),innerSpinner.className="spinner",innerCircle=document.createElement("div"),innerCircle.className="inner-circle",flexEnd=document.createElement("div"),flexEnd.style.alignSelf="flex-end",instanceMap=document.createElement("div"),instanceMap.id=instanceId+"_map",instanceMap.setAttribute("style",styleStrings.absmax),instanceContainer.appendChild(loadingPanel),loadingPanel.appendChild(flexStart),loadingPanel.appendChild(loadingPanelStatus),loadingPanelStatus.appendChild(messageHolder),messageHolder.appendChild(loadingMessageSpan),loadingMessageSpan.appendChild(document.createTextNode("Loading Map")),messageHolder.appendChild(document.createElement("br")),messageHolder.appendChild(loadingStatus),loadingStatus.appendChild(document.createTextNode("Fetching configuration...")),loadingPanelStatus.appendChild(spinner),spinner.appendChild(innerSpinner),spinner.appendChild(innerCircle),loadingPanel.appendChild(flexEnd),instanceContainer.appendChild(instanceMap),args.recorder){emp.recorder.record();var recorder=document.createElement("div");recorder.setAttribute("style",styleStrings.recorder);var recordButton=document.createElement("button");recordButton.id="emp_record",recordButton.disabled=!0,recordButton.onclick=emp.ui.record,recordButton.style.backgroundColor="green",recordButton.appendChild(document.createTextNode("RECORD"));var stopButton=document.createElement("button");stopButton.id="emp_stop",stopButton.onclick=emp.ui.stop,stopButton.style.backgroundColor="red",stopButton.appendChild(document.createTextNode("STOP"));var saveButton=document.createElement("button");saveButton.id="emp_save",saveButton.onclick=emp.ui.save,saveButton.style.backgroundColor="blue",saveButton.appendChild(document.createTextNode("SAVE"));var clearButton=document.createElement("button");clearButton.id="emp_clear",clearButton.onclick=emp.ui.clear,clearButton.style.backgroundColor="yellow",clearButton.appendChild(document.createTextNode("CLEAR"));var saveAnchor=document.createElement("a");saveAnchor.href="#",saveAnchor.id="recorderElem",recorder.appendChild(recordButton),recorder.appendChild(stopButton),recorder.appendChild(saveButton),recorder.appendChild(clearButton),recorder.appendChild(saveAnchor),instanceContainer.appendChild(recorder)}return domTargetId&&(domCont=document.getElementById(domTargetId)),domCont?domCont.appendChild(instanceContainer):document.body.appendChild(instanceContainer),instanceId},emp.ui.record=function(){var record=document.getElementById("emp_record"),stop=document.getElementById("emp_stop");record.disabled=!0,stop.disabled=!1,emp.recorder.record()},emp.ui.stop=function(){var record=document.getElementById("emp_record"),stop=document.getElementById("emp_stop");record.disabled=!1,stop.disabled=!0,emp.recorder.stop()},emp.ui.save=function(){emp.recorder.save()},emp.ui.clear=function(){emp.recorder.clear()},emp.ui.SOURCE="emp-core-ui",emp.ui.config={},emp.ui.config.lang="enUS",window.emp||(window.emp={}),emp.recorder=function(){var log=[],recording=!1,publicInterface={record:function(){recording=!0},stop:function(){recording=!1},log:function(entry){recording&&log.push(entry)},save:function(){var dataStr="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({results:log},0,2)),recorderElem=document.getElementById("recorderElem");recorderElem.setAttribute("href",dataStr),recorderElem.setAttribute("download","results.json"),recorderElem.click()},clear:function(){log=[]}};return publicInterface}(),cmapi=cmapi||{},cmapi.enums={altitudeMode:{CLAMP_TO_GROUND:"CLAMP_TO_GROUND",RELATIVE_TO_GROUND:"RELATIVE_TO_GROUND",ABSOLUTE:"ABSOLUTE"},fillPattern:{solid:"solid",hatched:"hatched",crossHatched:"crossHatched"},justification:{LEFT:"LEFT",CENTER:"CENTER",RIGHT:"RIGHT"},typeface:{REGULAR:"REGULAR",BOLD:"BOLD",ITALIC:"ITALIC",BOLDITALIC:"BOLDITALIC"},symbolStandard:{MIL_STD_2525C:"2525c",MIL_STD_2525B:"2525b"},acmType:{ROUTE:"ROUTE----------",CYLINDER:"CYLINDER-------",ORBIT:"ORBIT----------",POLYGON:"POLYGON--------",RADARC:"RADARC---------",POLYARC:"POLYARC--------",TRACK:"TRACK----------",CURTAIN:"CURTAIN--------"}},cmapi.IGeoAltitudeMode=function(args){"use strict";var _altitudeMode;Object.defineProperty(this,"altitudeMode",{enumerable:!0,get:function(){return _altitudeMode},set:function(value){_altitudeMode=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoTimeSpan=function(args){"use strict";var _begin;Object.defineProperty(this,"begin",{enumerable:!0,get:function(){return _begin},set:function(value){_begin=value}});var _end;Object.defineProperty(this,"end",{enumerable:!0,get:function(){return _end},set:function(value){_end=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoPosition=function(args){"use strict";var _latitude=0;Object.defineProperty(this,"latitude",{enumerable:!0,get:function(){return _latitude},set:function(value){_latitude=value}});var _longitude=0;Object.defineProperty(this,"longitude",{enumerable:!0,get:function(){return _longitude},set:function(value){_longitude=value}});var _altitude=0;Object.defineProperty(this,"altitude",{enumerable:!0,get:function(){return _altitude},set:function(value){_altitude=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoPositionGroup=function(args){"use strict";cmapi.inherit(new cmapi.IGeoAltitudeMode,this);var _positions;Object.defineProperty(this,"positions",{enumerable:!0,get:function(){return _positions},set:function(value){_positions=value}});var _timeStamp;Object.defineProperty(this,"timeStamp",{enumerable:!0,get:function(){return _timeStamp},set:function(value){_timeStamp=value}});var _timeSpans;Object.defineProperty(this,"timeSpans",{enumerable:!0,get:function(){return _timeSpans},set:function(value){_timeSpans=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoPositionHistory=function(args){"use strict";var _positionHistory;Object.defineProperty(this,"positionHistory",{enumerable:!0,get:function(){return _positionHistory},set:function(value){_positionHistory=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoCamera=function(args){"use strict";cmapi.inherit(new cmapi.IGeoBase,this);var _altitudeMode;Object.defineProperty(this,"altitudeMode",{enumerable:!0,get:function(){return _altitudeMode},set:function(value){_altitudeMode=value}});var _latitude=0;Object.defineProperty(this,"latitude",{enumerable:!0,get:function(){return _latitude},set:function(value){_latitude=value}});var _longitude=0;Object.defineProperty(this,"longitude",{enumerable:!0,get:function(){return _longitude},set:function(value){_longitude=value}});var _altitude=0;Object.defineProperty(this,"altitude",{enumerable:!0,get:function(){return _altitude},set:function(value){_altitude=value}});var _tilt=0;Object.defineProperty(this,"tilt",{enumerable:!0,get:function(){return _tilt},set:function(value){_tilt=value}});var _roll=0;Object.defineProperty(this,"roll",{enumerable:!0,get:function(){return _roll},set:function(value){_roll=value}});var _heading=0;Object.defineProperty(this,"heading",{enumerable:!0,get:function(){return _heading},set:function(value){_heading=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoLookAt=function(args){"use strict";cmapi.inherit(new cmapi.IGeoBase,this);var _altitudeMode;Object.defineProperty(this,"altitudeMode",{enumerable:!0,get:function(){return _altitudeMode},set:function(value){_altitudeMode=value}});var _latitude=0;Object.defineProperty(this,"latitude",{enumerable:!0,get:function(){return _latitude},set:function(value){_latitude=value}});var _longitude=0;Object.defineProperty(this,"longitude",{enumerable:!0,get:function(){return _longitude},set:function(value){_longitude=value}});var _altitude=0;Object.defineProperty(this,"altitude",{enumerable:!0,get:function(){return _altitude},set:function(value){_altitude=value}});var _tilt=0;Object.defineProperty(this,"tilt",{enumerable:!0,get:function(){return _tilt},set:function(value){_tilt=value}});var _heading=0;Object.defineProperty(this,"heading",{enumerable:!0,get:function(){return _heading},set:function(value){_heading=value}});var _range=1e6;Object.defineProperty(this,"range",{enumerable:!0,get:function(){return _range},set:function(value){_range=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoBounds=function(args){"use strict";var _west;Object.defineProperty(this,"west",{enumerable:!0,get:function(){return _west},set:function(value){_west=value}});var _east;Object.defineProperty(this,"east",{enumerable:!0,get:function(){return _east},set:function(value){_east=value}});var _north;Object.defineProperty(this,"north",{enumerable:!0,get:function(){return _north},set:function(value){_north=value}});var _south;Object.defineProperty(this,"south",{enumerable:!0,get:function(){return _south},set:function(value){_south=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoView=function(args){"use strict";var _camera;Object.defineProperty(this,"camera",{enumerable:!0,get:function(){return _camera},set:function(value){_camera=value}});var _lookAt;Object.defineProperty(this,"lookAt",{enumerable:!0,get:function(){return _lookAt},set:function(value){_lookAt=value}});var _bounds;Object.defineProperty(this,"bounds",{enumerable:!0,get:function(){return _bounds},set:function(value){_bounds=value}});var _scale;Object.defineProperty(this,"scale",{enumerable:!0,get:function(){return _scale},set:function(value){_scale=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoColor=function(args){"use strict";var _red=0;Object.defineProperty(this,"red",{enumerable:!0,get:function(){return _red},set:function(value){_red=value}});var _green=0;Object.defineProperty(this,"green",{enumerable:!0,get:function(){return _green},set:function(value){_green=value}});var _blue=0;Object.defineProperty(this,"blue",{enumerable:!0,get:function(){return _blue},set:function(value){_blue=value}});var _alpha=.8;Object.defineProperty(this,"alpha",{enumerable:!0,get:function(){return _alpha},set:function(value){_alpha=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoStrokeStyle=function(args){"use strict";var _strokeColor;Object.defineProperty(this,"strokeColor",{enumerable:!0,get:function(){return _strokeColor},set:function(value){_strokeColor=value}});var _stipplingPattern=0;Object.defineProperty(this,"stipplingPattern",{enumerable:!0,get:function(){return _stipplingPattern},set:function(value){_stipplingPattern=value}});var _stipplingFactor=0;Object.defineProperty(this,"stipplingFactor",{enumerable:!0,get:function(){return _stipplingFactor},set:function(value){_stipplingFactor=value}});var _strokeWidth=3;Object.defineProperty(this,"strokeWidth",{enumerable:!0,get:function(){return _strokeWidth},set:function(value){_strokeWidth=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoFillStyle=function(args){"use strict";var _description;Object.defineProperty(this,"description",{enumerable:!0,get:function(){return _description},set:function(value){_description=value}});var _fillColor;Object.defineProperty(this,"fillColor",{enumerable:!0,get:function(){return _fillColor},set:function(value){_fillColor=value}});var _fillPattern="solid";Object.defineProperty(this,"fillPattern",{enumerable:!0,get:function(){return _fillPattern},set:function(value){_fillPattern=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoIconStyle=function(args){"use strict";var _size=32;Object.defineProperty(this,"size",{enumerable:!0,get:function(){return _size},set:function(value){_size=value}});var _offSetX=0;Object.defineProperty(this,"offSetX",{enumerable:!0,get:function(){return _offSetX},set:function(value){_offSetX=value}});var _offSetY=0;Object.defineProperty(this,"offSetY",{enumerable:!0,get:function(){return _offSetY},set:function(value){_offSetY=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoLabelStyle=function(args){"use strict";var _size=12;Object.defineProperty(this,"size",{enumerable:!0,get:function(){return _size},set:function(value){_size=value}});var _color;Object.defineProperty(this,"color",{enumerable:!0,get:function(){return _color},set:function(value){_color=value}});var _outlineColor;Object.defineProperty(this,"outlineColor",{enumerable:!0,get:function(){return _outlineColor},set:function(value){_outlineColor=value}});var _justification="LEFT";Object.defineProperty(this,"justification",{enumerable:!0,get:function(){return _justification},set:function(value){_justification=value}});var _fontFamily;Object.defineProperty(this,"fontFamily",{enumerable:!0,get:function(){return _fontFamily},set:function(value){_fontFamily=value}});var _typeface=cmapi.enums.typeface.REGULAR;Object.defineProperty(this,"typeface",{enumerable:!0,get:function(){return _typeface},set:function(value){_typeface=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoBase=function(args){"use strict";var _name="";Object.defineProperty(this,"name",{enumerable:!0,get:function(){return _name},set:function(value){_name=value}});var _geoId=cmapi.randomUUID();Object.defineProperty(this,"geoId",{enumerable:!0,get:function(){return _geoId},set:function(value){_geoId=value}});var _dataProviderId;Object.defineProperty(this,"dataProviderId",{enumerable:!0,get:function(){return _dataProviderId},set:function(value){_dataProviderId=value}});var _description="";Object.defineProperty(this,"description",{enumerable:!0,get:function(){return _description},set:function(value){_description=value}});var _properties;Object.defineProperty(this,"properties",{enumerable:!0,get:function(){return _properties}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoContainer=function(args){"use strict";cmapi.inherit(new cmapi.IGeoBase,this);var _readOnly=!1;Object.defineProperty(this,"readOnly",{enumerable:!0,get:function(){return _readOnly},set:function(value){_readOnly=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoRenderable=function(args){"use strict";cmapi.inherit(new cmapi.IGeoContainer,this);var _altitudeMode;Object.defineProperty(this,"altitudeMode",{enumerable:!0,get:function(){return _altitudeMode},set:function(value){_altitudeMode=value}});var _positions;Object.defineProperty(this,"positions",{enumerable:!0,get:function(){return _positions},set:function(value){_positions=value}});var _timeStamp;Object.defineProperty(this,"timeStamp",{enumerable:!0,get:function(){return _timeStamp},set:function(value){_timeStamp=value}});var _timeSpans;Object.defineProperty(this,"timeSpans",{enumerable:!0,get:function(){return _timeSpans},set:function(value){_timeSpans=value}});var _labelStyle;Object.defineProperty(this,"labelStyle",{enumerable:!0,get:function(){return _labelStyle},set:function(value){_labelStyle=value}});var _strokeStyle;Object.defineProperty(this,"strokeStyle",{enumerable:!0,get:function(){return _strokeStyle},set:function(value){_strokeStyle=value}});var _fillStyle;Object.defineProperty(this,"fillStyle",{enumerable:!0,get:function(){return _fillStyle},set:function(value){_fillStyle=value}});var _extrude=!1;Object.defineProperty(this,"extrude",{enumerable:!0,get:function(){return _extrude},set:function(value){_extrude=value}});var _tessellate=!0;Object.defineProperty(this,"tessellate",{enumerable:!0,get:function(){return _tessellate},set:function(value){_tessellate=value}});var _buffer=0;Object.defineProperty(this,"buffer",{enumerable:!0,get:function(){return _buffer},set:function(value){_buffer=value}});var _azimuth=0;Object.defineProperty(this,"azimuth",{enumerable:!0,get:function(){return _azimuth},set:function(value){_azimuth=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoPoint=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _iconStyle;Object.defineProperty(this,"iconStyle",{enumerable:!0,get:function(){return _iconStyle},set:function(value){_iconStyle=value}});var _iconURI;Object.defineProperty(this,"iconURI",{enumerable:!0,get:function(){return _iconURI},set:function(value){_iconURI=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoText=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoPolygon=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoPath=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoCircle=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _radius=100;Object.defineProperty(this,"radius",{enumerable:!0,get:function(){return _radius},set:function(value){_radius=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoEllipse=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _semiMajor=150;Object.defineProperty(this,"semiMajor",{enumerable:!0,get:function(){return _semiMajor},set:function(value){_semiMajor=value}});var _semiMinor=75;Object.defineProperty(this,"semiMinor",{enumerable:!0,get:function(){return _semiMinor},set:function(value){_semiMinor=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoRectangle=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _width=150;Object.defineProperty(this,"width",{enumerable:!0,get:function(){return _width},set:function(value){_width=value}});var _height=75;Object.defineProperty(this,"height",{enumerable:!0,get:function(){return _height},set:function(value){_height=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoSquare=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _width=100;Object.defineProperty(this,"width",{enumerable:!0,get:function(){return _width},set:function(value){_width=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoImageOverlay=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _imageURI;Object.defineProperty(this,"imageURI",{enumerable:!0,get:function(){return _imageURI},set:function(value){_imageURI=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoMilSymbol=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _symbolStandard="2525c";Object.defineProperty(this,"symbolStandard",{enumerable:!0,get:function(){return _symbolStandard},set:function(value){_symbolStandard=value}});var _symbolCode="SUGP-----------";Object.defineProperty(this,"symbolCode",{enumerable:!0,get:function(){return _symbolCode},set:function(value){_symbolCode=value}});var _modifiers;Object.defineProperty(this,"modifiers",{enumerable:!0,get:function(){return _modifiers},set:function(value){_modifiers=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoAirControlMeasure=function(args){"use strict";cmapi.inherit(new cmapi.IGeoRenderable,this);var _acmType;Object.defineProperty(this,"acmType",{enumerable:!0,get:function(){return _acmType},set:function(value){_acmType=value}});var _attributes;Object.defineProperty(this,"attributes",{enumerable:!0,get:function(){return _attributes},set:function(value){_attributes=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.IGeoDocument=function(args){"use strict";cmapi.inherit(new cmapi.IGeoBase,this);var _documentURI;Object.defineProperty(this,"documentURI",{enumerable:!0,get:function(){return _documentURI},set:function(value){_documentURI=value}});var _documentMIMEType;Object.defineProperty(this,"documentMIMEType",{enumerable:!0,get:function(){return _documentMIMEType},set:function(value){_documentMIMEType=value}}),this.patchProps=function(update){var prop,propVal;for(prop in update)propVal=update[prop],void 0!==propVal&&"undefined"!==propVal&&(this[prop]=propVal)},args&&this.patchProps(args)},cmapi.inherit=function(source,target){var prop;for(prop in source)target[prop]=source[prop]},cmapi.randomUUID=function(){function s(n){return h(Math.random()*(1<<(n<<2))^Date.now()).slice(-n)}function h(n){return(0|n).toString(16)}return[s(4)+s(4),s(4),"4"+s(3),h(8|4*Math.random())+s(3),Date.now().toString(16).slice(-10)+s(2)].join("-")},window.emp3||(emp3={}),window.emp3.api||(emp3.utils={}),emp3.utils.geoLibrary={METERS_PER_DEG:111319.49079327357,Point:function(x,y){return{x:x,y:y}},metersPerPixel:function(scale){var inchPerMeter=39.3700787,pixelsPerInch=96,step1=scale/pixelsPerInch;return step1/inchPerMeter},ddToMGRS:function(latDD,longDD){var lat,lng,NS="N",EW="E";return latDD<0&&(latDD=Math.abs(latDD),NS="S"),longDD<0&&(longDD=Math.abs(longDD),EW="W"),lat=emp3.utils.geoLibrary.ddToDMS(latDD),lng=emp3.utils.geoLibrary.ddToDMS(longDD),emp3.utils.geoLibrary.dmsToMGRS(lat.deg,lat.minute,lat.sec,lng.deg,lng.minute,lng.sec,NS,EW)},ddToDMS:function(decDeg){var sec,deg=Math.abs(decDeg),DMS={};return DMS.deg=Math.abs(Math.floor(deg)),DMS.minute=Math.floor(60*Math.abs(deg-DMS.deg)),sec=60*(60*(deg-DMS.deg)-DMS.minute),DMS.sec=sec,DMS},deg2rad:function(deg){var conv_factor=2*Math.PI/360;return deg*conv_factor},dmsToMGRS:function(latDegrees,latMinutes,latSeconds,longDegrees,longMinutes,longSeconds,NS,EW){var West,North,East,IEast,INorth,EastStr,NorthStr,Long,K,L,SINK,COSK,TANK,TANK2,COSK2,COSK3,K3,K4,Merid,MeridWest,L0,J3,J4,J5,J6,M,Temp,V,R,H2,P,P2,P4,J7,J8,J9,GR100km,GRremainder,LongZone,GR,Letters,Pos,LatZone,N100km,E100km,Deg2Rad=Math.PI/180,Area="UTM2",F0=.9996,A1=6378137*F0,B1=6356752.3142*F0,K0=0,N0=0,E0=5e5,N1=(A1-B1)/(A1+B1),N2=N1*N1,N3=N2*N1,E2=(A1*A1-B1*B1)/(A1*A1),Deg=latDegrees,Min=latMinutes,Sec=latSeconds,Lat=Math.abs(Deg)+Math.abs(Min)/60+Math.abs(Sec)/3600,South="S"===NS.toUpperCase()&&Lat>0;for(South&&(Lat=-Lat),Deg=longDegrees,Min=longMinutes,Sec=longSeconds,West="W"===EW.toUpperCase(),Long=1*Math.abs(Deg)+Math.abs(Min)/60+Math.abs(Sec)/3600,West&&(Long=-Long),K=Lat*Deg2Rad,L=Long*Deg2Rad,SINK=Math.sin(K),COSK=Math.cos(K),TANK=SINK/COSK,TANK2=TANK*TANK,COSK2=COSK*COSK,COSK3=COSK2*COSK,K3=K-K0,K4=K+K0,Merid=6*Math.floor(Long/6)+3,Lat>=72&&Long>=0&&(Long<9?Merid=3:Long<21?Merid=15:Long<33?Merid=27:Long<42&&(Merid=39)),Lat>=56&&Lat<64&&Long>=3&&Long<12&&(Merid=9),MeridWest=Merid<0,L0=Merid*Deg2Rad,J3=K3*(1+N1+1.25*(N2+N3)),J4=Math.sin(K3)*Math.cos(K4)*(3*(N1+N2+.875*N3)),J5=Math.sin(2*K3)*Math.cos(2*K4)*(1.875*(N2+N3)),J6=Math.sin(3*K3)*Math.cos(3*K4)*35/24*N3,M=(J3-J4+J5-J6)*B1,Temp=1-E2*SINK*SINK,V=A1/Math.sqrt(Temp),R=V*(1-E2)/Temp,H2=V/R-1,P=L-L0,P2=P*P,P4=P2*P2,J3=M+N0,J4=V/2*SINK*COSK,J5=V/24*SINK*COSK3*(5-TANK2+9*H2),J6=V/720*SINK*COSK3*COSK2*(61-58*TANK2+TANK2*TANK2),North=J3+P2*J4+P4*J5+P4*P2*J6,"UTM1"!==Area&&"UTM2"!==Area||!South||(North+=1e7),J7=V*COSK,J8=V/6*COSK3*(V/R-TANK2),J9=V/120*COSK3*COSK2,J9*=5-18*TANK2+TANK2*TANK2+14*H2-58*TANK2*H2,East=E0+P*J7+P2*P*J8+P4*P*J9,IEast=Math.round(East),INorth=Math.round(North),EastStr="",EastStr+=Math.abs(IEast),NorthStr="",NorthStr+=Math.abs(INorth);EastStr.length<7;)EastStr="0"+EastStr;for(;NorthStr.length<7;)NorthStr="0"+NorthStr;if(GR100km=EastStr.substring(1,2)+NorthStr.substring(1,2),GRremainder=EastStr.substring(2,7)+" "+NorthStr.substring(2,7),"UTM1"===Area||"UTM2"===Area){if(LongZone=(Merid-3)/6+31,LongZone%1!==0)GR=null;else if(IEast<1e5||Lat<-80||IEast>899999||Lat>=84)GR=null;else{for(Letters="ABCDEFGHJKLMNPQRSTUVWXYZ",Pos=Math.round(Lat/8-.5)+10+2,LatZone=Letters.substring(Pos,Pos+1),LatZone>"X"&&(LatZone="X"),Pos=Math.round(Math.abs(INorth)/1e5-.5);Pos>19;)Pos-=20;for(LongZone%2===0&&(Pos+=5,Pos>19&&(Pos-=20)),N100km=Letters.substring(Pos,Pos+1),Pos=GR100km/10-1,P=LongZone;P>3;)P-=3;Pos+=8*(P-1),E100km=Letters.substring(Pos,Pos+1),GR=LongZone+LatZone+" "+E100km+N100km+" "+GRremainder}return GR}return"Did not convert correctly"},ValidLongZone:function(ZoneCell){return!(ZoneCell<1||ZoneCell>60)},UTMCMfromLongZone:function(ZoneCell){return this.ValidLongZone(ZoneCell)?6*(ZoneCell-1)-180+3:-181},truncateDecimal:function(value){var baseValue,decValue,precision=5,returnValue=value,valString=value.toString(),dotIndex=valString.indexOf(".");return dotIndex!==-1&&dotIndex+precision<=valString.length&&(baseValue=parseFloat(valString.substr(0,dotIndex)),decValue=parseFloat(valString.substr(dotIndex,precision+1)),baseValue<0?(.99999===decValue&&(baseValue-=1,decValue=0),returnValue=baseValue-decValue):(.99999===decValue&&(baseValue+=1,decValue=0),returnValue=baseValue+decValue)),returnValue},TM2LL:function(LatLong,EastCell,NorthCell,Merid){var F0,A1,B1,K0,L0,N0,N1,N2,N3,E0,E2,N,E,NRel,K,K3,K4,J3,J4,J5,J6,M,Finished,SINK,COSK,TANK,TANK2,Temp,V,R,H2,V3,Y1,Y12,K9,J7,J8,J9,L,Area=4,Deg2Rad=.017453292519943278,MGRS_Old=Area<0;if(MGRS_Old&&(Area=-Area),4!==Area)return-181;for(F0=.9996,A1=6378137*F0,B1=6356752.3142*F0,K0=0,L0=Merid*Deg2Rad,N0=0,E0=5e5,N1=(A1-B1)/(A1+B1),N2=N1*N1,N3=N2*N1,E2=(A1*A1-B1*B1)/(A1*A1),N=NorthCell,E=EastCell,NRel=N-N0,K=NRel/A1+K0;!Finished;)K3=K-K0,K4=K+K0,J3=K3*(1+N1+1.25*(N2+N3)),J4=Math.sin(K3)*Math.cos(K4)*(3*(N1+N2+.875*N3)),J5=Math.sin(2*K3)*Math.cos(2*K4)*(1.875*(N2+N3)),J6=Math.sin(3*K3)*Math.cos(3*K4)*35/24*N3,M=(J3-J4+J5-J6)*B1,Finished=Math.abs(NRel-M)<.001,Finished||(K+=(NRel-M)/A1);return SINK=Math.sin(K),COSK=Math.cos(K),TANK=SINK/COSK,TANK2=TANK*TANK,Temp=1-E2*SINK*SINK,V=A1/Math.sqrt(Temp),R=V*(1-E2)/Temp,H2=V/R-1,V3=V*V*V,Y1=E-E0,Y12=Y1*Y1,J3=TANK/(2*R*V),J4=TANK/(24*R*V3)*(5+3*TANK2+H2-9*TANK2*H2),J5=TANK/(720*R*Math.pow(V,5))*(61+90*TANK*TANK+45*Math.pow(TANK,4)),K9=K-Y12*J3+Y12*Y12*J4-Math.pow(Y1,6)*J5,J6=1/(COSK*V),J7=1/(6*COSK*V3)*(V/R+2*TANK2),J8=1/(120*COSK*Math.pow(V,5))*(5+28*TANK*TANK+24*Math.pow(TANK,4)),
J9=1/(5040*COSK*Math.pow(V,7)),J9*=61+662*TANK*TANK+1320*Math.pow(TANK,4)+720*Math.pow(TANK,6),L=L0+Y1*J6-Y1*Y12*J7+Math.pow(Y1,5)*J8-Math.pow(Y1,7)*J9,K=K9,"LATITUDE"===LatLong.toUpperCase()?this.truncateDecimal(K/Deg2Rad):"LONGITUDE"===LatLong.toUpperCase()?this.truncateDecimal(L/Deg2Rad):-181},mgrsToDD:function(LatLong,GRCell){var isEven,S,i,LongZoneNumber,Posn,MGRS_Old,GRLength,LatZoneNumber,GRX,LatZoneLetter,Long100Letter,Lat100Letter,LongZoneMerid,Long100Number,LatZoneDeg,Lat100Number,ApproxLatZoneKm,LatKm,Neg,Diff,PrevDiff,GRY,Ndigits,X,Y,nn,HalfDigits,Mult,hj,Merid,Area=4,noSpace=GRCell.split(" ");if(GRCell=noSpace.join(""),isEven=!1,GRCell.length>=6&&!isEven){if(GRLength=GRCell.length,GRLength>2){for(S="",i=0;i<GRLength;i+=1)" "!==GRCell.substr(i,1)&&(S+=GRCell.substr(i,1));GRCell=S}if(GRLength=GRCell.length,GRLength<3)return-181;if(GRCell=GRCell.toUpperCase(),MGRS_Old=Area<0,MGRS_Old&&(Area=-Area),4===Area){if(isNaN(parseFloat(GRCell.substr(0,2)))?(Posn=1,LongZoneNumber=parseFloat(GRCell.substr(0,1))):(Posn=2,LongZoneNumber=parseFloat(GRCell.substr(0,2))),LatZoneLetter=GRCell.substr(Posn,1),Posn+=1,Long100Letter=GRCell.substr(Posn,1),Posn+=1,Lat100Letter=GRCell.substr(Posn,1),Posn+=1,LongZoneMerid=6*(LongZoneNumber-1)-180+3,Long100Number=Long100Letter.charCodeAt(0)-64,Long100Number<1||Long100Number>26||9===Long100Number||15===Long100Number)return-181;if(Long100Number>8&&(Long100Number-=9,Long100Number>5&&(Long100Number-=1,Long100Number>8&&(Long100Number-=8))),GRX=1e5*Long100Number,LatZoneNumber=LatZoneLetter.charCodeAt(0)-66,LatZoneNumber<1||LatZoneNumber>22||7===LatZoneNumber||13===LatZoneNumber)return-181;if(LatZoneNumber>6&&(LatZoneNumber-=1,LatZoneNumber>11&&(LatZoneNumber-=1)),LatZoneDeg=8*(LatZoneNumber-1)-80,Lat100Number=Lat100Letter.charCodeAt(0)-64,Lat100Number<1||Lat100Number>22||9===Lat100Number||15===Lat100Number)return-181;for(Lat100Number>8&&(Lat100Number-=1,Lat100Number>13&&(Lat100Number-=1)),LongZoneNumber%2===0&&(Lat100Number>5?Lat100Number-=5:Lat100Number+=15),ApproxLatZoneKm=110*LatZoneDeg,LatKm=100*(Lat100Number-1),Neg=ApproxLatZoneKm<0,Neg&&(LatKm=2e3-LatKm,ApproxLatZoneKm=-ApproxLatZoneKm),Neg&&(ApproxLatZoneKm-=880),Diff=0,PrevDiff=1;Diff<PrevDiff;)PrevDiff=Math.abs(LatKm-ApproxLatZoneKm),LatKm+=2e3,Diff=Math.abs(LatKm-ApproxLatZoneKm);switch(LatKm-=2e3,"X"===LatZoneLetter&&LatKm<100*Math.floor(ApproxLatZoneKm/100)&&(LatKm+=2e3),Neg&&(LatKm=-LatKm),MGRS_Old&&(LatKm-=1e3),GRY=1e3*LatKm,Ndigits=GRCell.length-(Posn+1),X=0,Y=0,Ndigits){case 0:case 1:switch(nn=parseInt(GRCell.substr(Posn,1),10)){case 1:Y=5e4;break;case 2:case 3:X=5e4,Y=5e4;break;case 4:X=5e4;break;default:return-181}break;default:for(HalfDigits=Ndigits/2,X=parseInt(GRCell.substr(Posn,HalfDigits+1),10),Y=parseInt(GRCell.substr(Posn+HalfDigits+1,HalfDigits+1),10),Mult=1e5,hj=0;hj<HalfDigits;hj+=1)Mult/=10;X*=Mult,Y*=Mult}return GRX+=X,GRY+=Y,Merid=this.UTMCMfromLongZone(LongZoneNumber),this.TM2LL(LatLong,GRX,GRY,Merid)}return-181}return-181},getMetersPerDegAtLat:function(lat){var m1,m2,m3,m4,p1,p2,p3,latlen,longlen;return lat=emp3.utils.geoLibrary.deg2rad(lat),m1=111132.92,m2=-559.82,m3=1.175,m4=-.0023,p1=111412.84,p2=-93.5,p3=.118,latlen=m1+m2*Math.cos(2*lat)+m3*Math.cos(4*lat)+m4*Math.cos(6*lat),longlen=p1*Math.cos(lat)+p2*Math.cos(3*lat)+p3*Math.cos(5*lat)},getPointFromDistanceBearing:function(startLat,startLon,distance,bearing){bearing=bearing*Math.PI/180;var R=6371,lat2=Math.asin(Math.sin(startLat)*Math.cos(distance/R)+Math.cos(startLat)*Math.sin(distance/R)*Math.cos(bearing)),lon2=startLon+Math.atan2(Math.sin(bearing)*Math.sin(distance/R)*Math.cos(startLat),Math.cos(distance/R)-Math.sin(startLat)*Math.sin(lat2));return{lat:lat2,lon:lon2}},getMidPoint:function(lat1,lon1,lat2,lon2){var lat3=(lat1+lat2)/2,f1=Math.tan(Math.PI/4+lat1/2),f2=Math.tan(Math.PI/4+lat2/2),f3=Math.tan(Math.PI/4+lat3/2),lon3=((lon2-lon1)*Math.log(f3)+lon1*Math.log(f2)-lon2*Math.log(f1))/Math.log(f2/f1);return lon3},measureDistance:function(latitude1,longitude1,latitude2,longitude2,unitOfMeasure){var rad,distance=-1;switch(unitOfMeasure.toLowerCase()){case"kilometers":rad=6378.137;break;case"meters":rad=6378137;break;case"miles":rad=3963.1;break;case"feet":rad=20925524.9;break;case"yards":rad=6975174.98;break;case"nautical":rad=3443.9;break;case"nautical miles":rad=3443.9;break;default:return-1}return latitude1*=Math.PI/180,latitude2*=Math.PI/180,longitude1*=Math.PI/180,longitude2*=Math.PI/180,distance=Math.acos(Math.cos(latitude1)*Math.cos(longitude1)*Math.cos(latitude2)*Math.cos(longitude2)+Math.cos(latitude1)*Math.sin(longitude1)*Math.cos(latitude2)*Math.sin(longitude2)+Math.sin(latitude1)*Math.sin(latitude2))*rad},coordinateArrayToString:function(coordinates){var i,len=coordinates.length,coordString="";coordinates[0][0],coordinates[0][1];for(i=0;i<len;i+=1)i>0&&(coordString+=" "),coordString+=coordinates[i][0].toString()+","+coordinates[i][1].toString(),coordString+=3===coordinates[i].length?","+coordinates[i][2].toString():",0";return coordString},coordinateStringToArray:function(coordinates){var pairs,len,i,values,alt,coordArr=[];if(coordinates.length>0)for(pairs=coordinates.split(" "),len=pairs.length,i=0;i<len;i+=1)values=pairs[i].split(","),alt=0,3===values.length&&(alt=parseInt(values[2],10)),coordArr.push({lat:parseFloat(values[1]),lon:parseFloat(values[0]),alt:alt});return coordArr},validateLatLon:function(lat,lon){var valid=!1;return isNaN(lat)||isNaN(lon)||lat<=90&&lat>=-90&&lon<=180&&lon>=-180&&(valid=!0),valid},DegToRad:function(deg){return deg/180*Math.PI},RadToDeg:function(rad){return rad/Math.PI*180},GetAzimuth:function(c1,c2){var theta=0;try{var lat1=this.DegToRad(c1.y),lon1=this.DegToRad(c1.x),lat2=this.DegToRad(c2.y),lon2=this.DegToRad(c2.x),y=Math.sin(lon2-lon1);y*=Math.cos(lat2);var x=Math.cos(lat1);x*=Math.sin(lat2);var z=Math.sin(lat1);z*=Math.cos(lat2),z*=Math.cos(lon2-lon1),x-=z,theta=Math.atan2(y,x),theta=this.RadToDeg(theta)}catch(error){}return theta},geodesic_coordinate:function(start,distance,azimuth){var pt=this.Point(),sm_a=6378137;try{var a=0,b=0,c=0,d=0,e=0,f=0,g=0,h=0,k=0,l=0,m=0,n=0,p=0;a=this.DegToRad(start.y),b=Math.cos(a),c=this.DegToRad(azimuth),d=Math.sin(a),e=Math.cos(distance/sm_a),f=Math.sin(distance/sm_a),g=Math.cos(c);var lat=this.RadToDeg(Math.asin(d*e+b*f*g));h=Math.sin(c),k=Math.sin(h),l=Math.cos(a),m=this.DegToRad(lat),n=Math.sin(m),p=Math.atan2(h*f*b,e-d*n);var lon=start.x+this.RadToDeg(p);pt=this.Point(),pt.x=lon,pt.y=lat}catch(error){}return pt},IntersectLines:function(p1,brng1,p2,brng2){var ptResult=null;try{var lat1=this.DegToRad(p1.y),lon1=this.DegToRad(p1.x),lat2=this.DegToRad(p2.y),lon2=this.DegToRad(p2.x),brng13=this.DegToRad(brng1),brng23=this.DegToRad(brng2),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2)));if(0===dist12)return null;var brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1)));isNaN(brngA)&&(brngA=0);var brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),brng12=0,brng21=0;Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB);var alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI;if(0===Math.sin(alpha1)&&0===Math.sin(alpha2))return null;if(Math.sin(alpha1)*Math.sin(alpha2)<0)return null;var alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13;lon3=(lon3+Math.PI)%(2*Math.PI)-Math.PI,ptResult=this.Point(RadToDeg(lon3),RadToDeg(lat3))}catch(error){}return ptResult},doesBoundingBoxIntersect:function(bbox1,bbox2){var bbox1a,bbox1b,bbox2a,bbox2b;return bbox1.left>bbox1.right?(bbox1a=new BoundingBox,bbox1a.left=bbox1.left,bbox1a.right=180,bbox1a.top=bbox1.top,bbox1a.bottom=bbox1.bottom,bbox1b=new BoundingBox,bbox1b.left=-180,bbox1b.right=bbox1.right,bbox1b.top=bbox1.top,bbox1b.bottom=bbox1.bottom,bbox2.left>bbox2.right?(bbox2a=new BoundingBox,bbox2a.left=bbox2.left,bbox2a.right=180,bbox2a.top=bbox2.top,bbox2a.bottom=bbox2.bottom,bbox2b=new BoundingBox,bbox2b.left=-180,bbox2b.right=bbox2.right,bbox2b.top=bbox2.top,bbox2b.bottom=bbox2.bottom,this.checkBboxOverlap(bbox1a,bbox2a)===!0||this.checkBboxOverlap(bbox2a,bbox1a)===!0||this.checkBboxOverlap(bbox1b,bbox2b)===!0||this.checkBboxOverlap(bbox2b,bbox1b)===!0):(bbox2a=new BoundingBox,bbox2a.left=bbox2.left,bbox2a.right=180,bbox2a.top=bbox2.top,bbox2a.bottom=bbox2.bottom,bbox2b=new BoundingBox,bbox2b.left=-180,bbox2b.right=bbox2.right,bbox2b.top=bbox2.top,bbox2b.bottom=bbox2.bottom,this.checkBboxOverlap(bbox1,bbox2a)===!0||this.checkBboxOverlap(bbox2a,bbox1)===!0||this.checkBboxOverlap(bbox1,bbox2b)===!0||this.checkBboxOverlap(bbox2b,bbox1)===!0)):bbox2.left>bbox2.right?this.checkBboxOverlap(bbox1a,bbox2)===!0||this.checkBboxOverlap(bbox2,bbox1a)===!0||this.checkBboxOverlap(bbox1b,bbox2)===!0||this.checkBboxOverlap(bbox2,bbox1b)===!0:this.checkBboxOverlap(bbox1,bbox2)===!0||this.checkBboxOverlap(bbox2,bbox1)===!0},pointInBbox:function(bbox,x,y){return(null!==bbox||void 0!==bbox.left||void 0!==bbox.right||void 0!==bbox.top||void 0!==bbox.bototm)&&x>=bbox.left&&x<=bbox.right&&y>=bbox.bottom&&y<=bbox.top},checkBboxOverlap:function(bbox1,bbox2){if(null!==bbox1&&null!==bbox2){if(this.pointInBbox(bbox1,bbox2.left,bbox2.top))return!0;if(this.pointInBbox(bbox1,bbox2.right,bbox2.top))return!0;if(this.pointInBbox(bbox1,bbox2.left,bbox2.bottom))return!0;if(this.pointInBbox(bbox1,bbox2.right,bbox2.bottom))return!0}return!1},BoundingBox:function(pointString){var len,points,p1,p2,point,i;if(null!==pointString)for(points=pointString.split(" "),len=points.length,i=0;i<len;i++)if(point=points[i].split(","),p1=parseFloat(point[0]),p2=parseFloat(point[1]),point.length>=2&&(null===this.left?this.left=p1:p1<this.left&&(this.left=p1),null===this.right?this.right=p1:p1>this.right&&(this.right=p1),null===this.top?this.top=p2:p2>this.top&&(this.top=p2),null===this.bottom?this.bottom=p2:point[1]<this.bottom&&(this.bottom=p2),this.right-this.left>180)){var savedvalue=this.left;this.left=this.right,this.right=savedvalue}},getBox:function(points){var left,right,top,bottom,len,p1,p2,point,i;for(len=points.length,i=0;i<len;i++)if(point=points[i],p1=point.lon,p2=point.lat,null===left?left=p1:p1<left&&(left=p1),null===right?right=p1:p1>right&&(right=p1),null===top?top=p2:p2>top&&(top=p2),null===bottom?bottom=p2:p2<bottom&&(bottom=p2),right-left>180){var savedvalue=left;left=right,right=savedvalue}return[{lat:bottom,lon:left},{lat:top,lon:left},{lat:top,lon:right},{lat:bottom,lon:right}]},getBoxIDL:function(points){var left,right,top,bottom,len,p1,p2,point,i,temp;for(len=points.length,i=0;i<len;i++)point=points[i],p1=point.lon+180,p2=point.lat+90,null===left?left=p1:p1<left&&(left=p1),null===right?right=p1:p1>right&&(right=p1),null===top?top=p2:p2>top&&(top=p2),null===bottom?bottom=p2:p2<bottom&&(bottom=p2);return right-left>180&&(temp=left,left=right,right=temp),top-bottom>90&&(temp=top,top=bottom,bottom=temp),[{lat:bottom-90,lon:left-180},{lat:top-90,lon:left-180},{lat:top-90,lon:right-180},{lat:bottom-90,lon:right-180}]},latLongToUtm:function(numLat,numLong){var numLongOrigin,numN,numT,numC,numAA,numM,numLongOriginRad,intZoneNumber,numUTMEasting=0,numUTMNorthing=0,strZone="",numA=6378137,numEccSquared=.00669438,numK0=.9996,numLongTemp=numLong+180-360*Math.floor((numLong+180)/360)-180,numLatRad=numLat*(Math.PI/180),numLongRad=numLongTemp*(Math.PI/180);intZoneNumber=Math.floor((numLongTemp+180)/6)+1,numLat>=56&&numLat<64&&numLongTemp>=3&&numLongTemp<12&&(intZoneNumber=32),numLat>=772&&numLat<84&&(numLongTemp>=0&&numLongTemp<9?intZoneNumber=31:numLongTemp>=9&&numLongTemp<21?intZoneNumber=33:numLongTemp>=21&&numLongTemp<33?intZoneNumber=35:numLongTemp>=33&&numLongTemp<42&&(intZoneNumber=37)),numLongOrigin=6*(intZoneNumber-1)-180+3,numLongOriginRad=numLongOrigin*(Math.PI/180),strZone=intZoneNumber.toString()+this.utmLetterDesignator(numLat);var eccPrimeSquared=numEccSquared/(1-numEccSquared);numN=numA/Math.sqrt(1-numEccSquared*Math.sin(numLatRad)*Math.sin(numLatRad)),numT=Math.tan(numLatRad)*Math.tan(numLatRad),numC=eccPrimeSquared*Math.cos(numLatRad)*Math.cos(numLatRad),numAA=Math.cos(numLatRad)*(numLongRad-numLongOriginRad),numM=numA*((1-numEccSquared/4-3*numEccSquared*numEccSquared/64-5*numEccSquared*numEccSquared*numEccSquared/256)*numLatRad-(3*numEccSquared/8+3*numEccSquared*numEccSquared/32+45*numEccSquared*numEccSquared*numEccSquared/1024)*Math.sin(2*numLatRad)+(15*numEccSquared*numEccSquared/256+45*numEccSquared*numEccSquared*numEccSquared/1024)*Math.sin(4*numLatRad)-35*numEccSquared*numEccSquared*numEccSquared/3072*Math.sin(6*numLatRad)),numUTMEasting=Number(numK0*numN*(numAA+(1-numT+numC)*numAA*numAA*numAA/6+(5-18*numT+numT*numT+72*numC-58*eccPrimeSquared)*numAA*numAA*numAA*numAA*numAA/120)+5e5),numUTMNorthing=Number(numK0*(numM+numN*Math.tan(numLatRad)*(numAA*numAA/2+(5-numT+9*numC+4*numC*numC)*numAA*numAA*numAA*numAA/24+(61-58*numT+numT*numT+600*numC-330*eccPrimeSquared)*numAA*numAA*numAA*numAA*numAA*numAA/720))),numLat<0&&(numUTMNorthing+=1e7);var utmValue=strZone+","+Math.round(numUTMEasting).toString()+","+Math.round(numUTMNorthing).toString();return utmValue},utmLetterDesignator:function(numLat){var strLetterDesignator="Z";return strLetterDesignator=84>=numLat&&numLat>=72?"X":72>numLat&&numLat>=64?"W":64>numLat&&numLat>=56?"V":56>numLat&&numLat>=48?"U":48>numLat&&numLat>=40?"T":40>numLat&&numLat>=32?"S":32>numLat&&numLat>=24?"R":24>numLat&&numLat>=16?"Q":16>numLat&&numLat>=8?"P":8>numLat&&numLat>=0?"N":0>numLat&&numLat>=-8?"M":-8>numLat&&numLat>=-16?"L":-16>numLat&&numLat>=-24?"K":-24>numLat&&numLat>=-32?"J":-32>numLat&&numLat>=-40?"H":-40>numLat&&numLat>=-48?"G":-48>numLat&&numLat>=-56?"F":-56>numLat&&numLat>=-64?"E":-64>numLat&&numLat>=-72?"D":-72>numLat&&numLat>=-89?"C":"Z"},utmToLatLong:function(numZone,numEasting,numNorthing,blNorthernHemisphere){void 0!==blNorthernHemisphere&&null!==blNorthernHemisphere||(blNorthernHemisphere=!0),blNorthernHemisphere||(numNorthing=1e7-numNorthing);var numA=6378137,numE=.081819191,numE1sq=.006739497,numK0=.9996,numArc=numNorthing/numK0,numMu=numArc/(numA*(1-Math.pow(numE,2)/4-3*Math.pow(numE,4)/64-5*Math.pow(numE,6)/256)),numEi=(1-Math.pow(1-numE*numE,.5))/(1+Math.pow(1-numE*numE,.5)),numCa=3*numEi/2-27*Math.pow(numEi,3)/32,numCb=21*Math.pow(numEi,2)/16-55*Math.pow(numEi,4)/32,numCc=151*Math.pow(numEi,3)/96,numCd=1097*Math.pow(numEi,4)/512,numPhi1=numMu+numCa*Math.sin(2*numMu)+numCb*Math.sin(4*numMu)+numCc*Math.sin(6*numMu)+numCd*Math.sin(8*numMu),numN0=numA/Math.pow(1-Math.pow(numE*Math.sin(numPhi1),2),.5),numR0=numA*(1-numE*numE)/Math.pow(1-Math.pow(numE*Math.sin(numPhi1),2),1.5),numFact1=numN0*Math.tan(numPhi1)/numR0,num_a1=5e5-numEasting,numDd0=num_a1/(numN0*numK0),numFact2=numDd0*numDd0/2,numT0=Math.pow(Math.tan(numPhi1),2),numQ0=numE1sq*Math.pow(Math.cos(numPhi1),2),numFact3=(5+3*numT0+10*numQ0-4*numQ0*numQ0-9*numE1sq)*Math.pow(numDd0,4)/24,numFact4=(61+90*numT0+298*numQ0+45*numT0*numT0-252*numE1sq-3*numQ0*numQ0)*Math.pow(numDd0,6)/720,numLof1=num_a1/(numN0*numK0),numLof2=(1+2*numT0+numQ0)*Math.pow(numDd0,3)/6,numLof3=(5-2*numQ0+28*numT0-3*Math.pow(numQ0,2)+8*numE1sq+24*Math.pow(numT0,2))*Math.pow(numDd0,5)/120,num_a2=(numLof1-numLof2+numLof3)/Math.cos(numPhi1),num_a3=180*num_a2/Math.PI,numLatitude=180*(numPhi1-numFact1*(numFact2+numFact3+numFact4))/Math.PI;blNorthernHemisphere||(numLatitude=-numLatitude);var numLongitude=(numZone>0&&6*numZone-183||3)-num_a3;return numLatitude.toString()+","+numLongitude.toString()}},LatLon.prototype.distanceTo=function(point,precision){"undefined"==typeof precision&&(precision=4);var R=this._radius,lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=point._lat.toRad(),lon2=point._lon.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d.toPrecisionFixed(precision)},LatLon.prototype.bearingTo=function(point){var lat1=this._lat.toRad(),lat2=point._lat.toRad(),dLon=(point._lon-this._lon).toRad(),y=Math.sin(dLon)*Math.cos(lat2),x=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon),brng=Math.atan2(y,x);return(brng.toDeg()+360)%360},LatLon.prototype.finalBearingTo=function(point){var lat1=point._lat.toRad(),lat2=this._lat.toRad(),dLon=(this._lon-point._lon).toRad(),y=Math.sin(dLon)*Math.cos(lat2),x=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon),brng=Math.atan2(y,x);return(brng.toDeg()+180)%360},LatLon.prototype.midpointTo=function(point){var lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=point._lat.toRad(),dLon=(point._lon-this._lon).toRad(),Bx=Math.cos(lat2)*Math.cos(dLon),By=Math.cos(lat2)*Math.sin(dLon),lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+Bx)*(Math.cos(lat1)+Bx)+By*By));return lon3=lon1+Math.atan2(By,Math.cos(lat1)+Bx),lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())},LatLon.prototype.destinationPoint=function(brng,dist){dist="number"==typeof dist?dist:"string"==typeof dist&&""!==dist.trim()?+dist:NaN,dist/=this._radius,brng=brng.toRad();var lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=Math.asin(Math.sin(lat1)*Math.cos(dist)+Math.cos(lat1)*Math.sin(dist)*Math.cos(brng)),lon2=lon1+Math.atan2(Math.sin(brng)*Math.sin(dist)*Math.cos(lat1),Math.cos(dist)-Math.sin(lat1)*Math.sin(lat2));return lon2=(lon2+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat2.toDeg(),lon2.toDeg())},LatLon.intersection=function(p1,brng1,p2,brng2){brng1="number"==typeof brng1?brng1:"string"==typeof brng1&&""!==trim(brng1)?+brng1:NaN,brng2="number"==typeof brng2?brng2:"string"==typeof brng2&&""!==trim(brng2)?+brng2:NaN;var dist12,dist13,lat3,lon3,brngA,brngB,brng12,brng21,alpha1,alpha2,alpha3,dLon13,lat1=p1._lat.toRad(),lon1=p1._lon.toRad(),lat2=p2._lat.toRad(),lon2=p2._lon.toRad(),brng13=brng1.toRad(),brng23=brng2.toRad(),dLat=lat2-lat1,dLon=lon2-lon1;return dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2))),0===dist12?null:(brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1))),isNaN(brngA)&&(brngA=0),brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB),alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI,0===Math.sin(alpha1)&&0===Math.sin(alpha2)?null:Math.sin(alpha1)*Math.sin(alpha2)<0?null:(alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13,lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())))},LatLon.prototype.rhumbDistanceTo=function(point){var R=this._radius,lat1=this._lat.toRad(),lat2=point._lat.toRad(),dLat=(point._lat-this._lat).toRad(),dLon=Math.abs(point._lon-this._lon).toRad(),dPhi=Math.log(Math.tan(lat2/2+Math.PI/4)/Math.tan(lat1/2+Math.PI/4)),q=isNaN(dLat/dPhi)?Math.cos(lat1):dLat/dPhi;dLon>Math.PI&&(dLon=2*Math.PI-dLon);var dist=Math.sqrt(dLat*dLat+q*q*dLon*dLon)*R;return dist.toPrecisionFixed(4)},LatLon.prototype.rhumbBearingTo=function(point){var lat1=this._lat.toRad(),lat2=point._lat.toRad(),dLon=(point._lon-this._lon).toRad(),dPhi=Math.log(Math.tan(lat2/2+Math.PI/4)/Math.tan(lat1/2+Math.PI/4));Math.abs(dLon)>Math.PI&&(dLon=dLon>0?-(2*Math.PI-dLon):2*Math.PI+dLon);var brng=Math.atan2(dLon,dPhi);return(brng.toDeg()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(brng,dist){var R=this._radius,d=parseFloat(dist)/R,lat1=this._lat.toRad(),lon1=this._lon.toRad();brng=brng.toRad();var lon2,lat2=lat1+d*Math.cos(brng),dLat=lat2-lat1,dPhi=Math.log(Math.tan(lat2/2+Math.PI/4)/Math.tan(lat1/2+Math.PI/4)),q=isNaN(dLat/dPhi)?Math.cos(lat1):dLat/dPhi,dLon=d*Math.sin(brng)/q;return Math.abs(lat2)>Math.PI/2&&(lat2=lat2>0?Math.PI-lat2:-(Math.PI-lat2)),lon2=(lon1+dLon+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat2.toDeg(),lon2.toDeg())},LatLon.prototype.lat=function(format,dp){return"undefined"==typeof format?this._lat:Geo.toLat(this._lat,format,dp)},LatLon.prototype.lon=function(format,dp){return"undefined"==typeof format?this._lon:Geo.toLon(this._lon,format,dp)},LatLon.prototype.toString=function(format,dp){return"undefined"==typeof format&&(format="dms"),isNaN(this._lat)||isNaN(this._lon)?"-,-":Geo.toLat(this._lat,format,dp)+", "+Geo.toLon(this._lon,format,dp)},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),"undefined"==typeof Number.prototype.toPrecisionFixed&&(Number.prototype.toPrecisionFixed=function(precision){if(isNaN(this))return"NaN";var n,numb=this<0?-this:this,sign=this<0?"-":"";if(0===numb){for(n="0.";precision--;)n+="0";return n}var scale=Math.ceil(Math.log(numb)*Math.LOG10E);if(n=String(Math.round(numb*Math.pow(10,precision-scale))),scale>0){for(var l=scale-n.length;l-- >0;)n+="0";scale<n.length&&(n=n.slice(0,scale)+"."+n.slice(scale))}else{for(;scale++<0;)n="0"+n;n="0."+n}return sign+n}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),console||(window.console={}),console.info||(console.info=function(){}),console.error||(console.error=function(){}),console.warn||(console.warn=function(){}),window.emp3||(window.emp3={}),window.emp3.api||(window.emp3.api={}),window.emp3.api.enums||(emp3.api.enums={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.createGUID=function(){var S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()},emp3.api.Hash=function(){var i;for(this.length=0,this.items=[],i=0;i<arguments.length;i+=2)"undefined"!=typeof arguments[i+1]&&(this.items[arguments[i]]=arguments[i+1],this.length+=1);this.removeItem=function(in_key){var tmp_previous;return"undefined"!=typeof this.items[in_key]&&(this.length-=1,tmp_previous=this.items[in_key],delete this.items[in_key]),tmp_previous},this.getItem=function(in_key){return this.items[in_key]},this.setItem=function(in_key,in_value){var tmp_previous;return"undefined"!=typeof in_value&&("undefined"==typeof this.items[in_key]?this.length+=1:tmp_previous=this.items[in_key],this.items[in_key]=in_value),tmp_previous},this.hasItem=function(in_key){return"undefined"!=typeof this.items[in_key]},this.clear=function(){var i;for(i in this.items)this.items.hasOwnProperty(i)&&delete this.items[i];this.length=0},this.toArray=function(){var i,array=[];for(i in this.items)this.items.hasOwnProperty(i)&&array.push(this.items[i]);return array}},emp3.api.convertToKilometers=function(measurement,units){var returnValue;switch(units){case"km":returnValue=measurement;break;case"mi":returnValue=measurement/.62137;break;case"nmi":returnValue=measurement/.53996;break;case"yd":returnValue=measurement/1093.6;break;case"ft":returnValue=measurement/3280.8;break;case"m":returnValue=measurement/1e3;break;default:throw new Error('Unsupported unit type: use either "m", "km", "nmi", "mi", "yd" or "ft"')}return returnValue},emp3.api.isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},emp3.api.isString=function(obj){return"[object String]"===Object.prototype.toString.call(obj)},emp3.api.isOverlay=function(obj){var result=!1;return obj&&"overlay"===obj.type&&(result=!0),result},emp3.api.isFeature=function(obj){var result=!1;return obj.featureType&&(obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_POINT&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_PATH&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_POLYGON&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_ACM&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_SQUARE&&obj.featureType!==emp3.api.enums.FeatureTypeEnum.GEO_TEXT||(result=!0)),result},emp3.api.getProperties=function(feature){var properties={};switch(properties.featureType=feature.featureType,properties.readOnly=feature.readOnly,properties.azimuth=feature.azimuth,properties.buffer=feature.buffer,properties.timeStamp=feature.timeStamp,properties.extrude=feature.extrude,properties.tessellate=feature.tessellate,properties.altitudeMode=emp3.api.convertAltitudeMode(feature.altitudeMode),feature.labelStyle&&(properties.labelStyle=feature.labelStyle,"object"==typeof feature.labelStyle.color?properties.labelColor=emp.util.convertColorToHexColor(feature.labelStyle.color):properties.labelColor=feature.labelStyle.color,"object"==typeof feature.labelStyle.outlineColor?properties.outlineColor=emp.util.convertColorToHexColor(feature.labelStyle.outlineColor):properties.outlineColor=feature.labelStyle.outlineColor,properties.labelScale=feature.labelStyle.labelScale,properties.labelStyle.family=feature.labelStyle.fontFamily),feature.fillStyle&&(properties.fillStyle=feature.fillStyle,"object"==typeof feature.fillStyle.fillColor?properties.fillColor=emp.util.convertColorToHexColor(feature.fillStyle.fillColor):properties.fillColor=feature.fillStyle.fillColor,properties.fillPattern=feature.fillStyle.fillPattern),feature.strokeStyle&&(properties.strokeStyle=feature.strokeStyle,properties.lineWidth=feature.strokeStyle.strokeWidth,"object"==typeof feature.strokeStyle.strokeColor?properties.lineColor=emp.util.convertColorToHexColor(feature.strokeStyle.strokeColor):properties.lineColor=feature.strokeStyle.strokeColor,properties.strokeDashstyle=feature.strokeStyle.strokePattern),feature.featureType){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:properties.attributes=feature.attributes;break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:properties.radius=feature.radius;break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:properties.semiMinor=feature.semiMinor,properties.semiMajor=feature.semiMajor;break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:properties.modifiers=feature.modifiers||{},properties.modifiers.standard=feature.symbolStandard;break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:properties.stippleFactor=feature.stippleFactor,properties.stipplePattern=feature.stipplePattern;break;case emp3.api.enums.FeatureTypeEnum.GEO_POINT:properties.iconUrl=feature.iconURI,properties.iconYOffset=feature.offsetY,properties.iconXOffset=feature.offsetX,properties.iconSize=feature.iconSize;break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:properties.width=feature.width,properties.height=feature.height;break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:properties.width=feature.width;break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:}return properties},emp3.api.convertAltitudeMode=function(newAltitudeMode){var val;switch(newAltitudeMode){case cmapi.enums.altitudeMode.CLAMP_TO_GROUND:val="clampToGround";break;case cmapi.enums.altitudeMode.RELATIVE_TO_GROUND:val="relativeToGround";break;case cmapi.enums.altitudeMode.ABSOLUTE:val="absolute";break;default:val=void 0}return val},emp3.api.convertCMAPIPropertiesToFeature=function(feature,properties){switch(feature.fillColor=properties.fillColor,feature.strokeColor=properties.lineColor,feature.strokeWidth=properties.lineWidth,feature.altitudeMode=emp3.api.convertAltitudeMode(properties.altitudeMode),feature.strokePattern=properties.strokeDashstyle,feature.readOnly=properties.readOnly,feature.labelColor=properties.labelColor,feature.labelScale=properties.labelScale,feature.azimuth=properties.azimuth,feature.buffer=properties.buffer,feature.timeStamp=properties.timeStamp,feature.extrude=properties.extrude,feature.tessellate=properties.tessellate,properties.featureType){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:feature.attributes=properties.attributes,feature.labelStyle=properties.labelStyle;break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:feature.radius=properties.radius,feature.strokeWidth=properties.lineThickness;break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:feature.semiMajor=properties.semiMajor,feature.semiMinor=properties.semiMinor;break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:feature.modifiers=properties.modifiers||{},feature.modifiers.standard=feature.symbolStandard;break;case emp3.api.enums.FeatureTypeEnum.GEO_POINT:feature.labelStyle=properties.labelStyle,feature.iconURI=properties.iconUrl;break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:feature.stippleFactor=properties.stippleFactor,feature.stipplePattern=properties.stipplePattern;break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:feature.width=properties.width,feature.height=properties.height;break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:feature.width=properties.width;break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:}},emp3.api.convertLocationArrayToCMAPI=function(locations){var i,k,newLocations=[],len=locations.length;for(i=0,k=len;i<k;i+=1)newLocations.push({latitude:locations[i].lat,longitude:locations[i].lon,altitude:locations[i].alt});return newLocations},emp3.api.convertCMAPIPositionsToGeoJson=function(positions,type){var j,len,coords=[];if(type=type||"LineString","Point"===type)coords.push(positions[0].longitude),coords.push(positions[0].latitude),positions[0].altitude&&coords.push(positions[0].altitude);else if("LineString"===type)for(len=positions.length,j=0;j<len;j++)positions[j].altitude?coords.push([positions[j].longitude,positions[j].latitude,positions[j].altitude]):coords.push([positions[j].longitude,positions[j].latitude]);else if("Polygon"===type)for(coords.push([]),len=positions.length,j=0;j<len;j++)positions[j].altitude?coords[0].push([positions[j].longitude,positions[j].latitude,positions[j].altitude]):coords[0].push([positions[j].longitude,positions[j].latitude]);return coords},emp3.api.convertGeoJsonToCMAPIPositions=function(geojson){var position,i,positions=[];if(geojson.type)if("Point"===geojson.type)position={longitude:geojson.coordinates[0],latitude:geojson.coordinates[1]},positions.push(position);else if("LineString"===geojson.type)for(i=0;i<geojson.coordinates.length;i+=1)position={longitude:geojson.coordinates[i][0],latitude:geojson.coordinates[i][1]},positions.push(position);else if("Polygon"===geojson.type)for(i=0;i<geojson.coordinates[0].length;i+=1)position={longitude:geojson.coordinates[0][i][0],latitude:geojson.coordinates[0][i][1]},positions.push(position);return positions},emp3.api.convertFeatureToGeoJSON=function(feature){var convertedFeature={};switch(feature.featureType){case emp3.api.enums.FeatureTypeEnum.GEOJSON:return feature.GeoJSONData;case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:convertedFeature.type="Point";break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:convertedFeature.type="Point";
break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:convertedFeature.type="Point";break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:convertedFeature.type="Point";break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:convertedFeature.type="Point";break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:convertedFeature.type="LineString";break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:convertedFeature.type="Polygon";break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(feature.symbolCode,0)?convertedFeature.type="LineString":convertedFeature.type="Point",convertedFeature.symbolCode=feature.symbolCode;break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:feature.acmType===cmapi.enums.acmType.CYLINDER||feature.acmType===cmapi.enums.acmType.RADARC?convertedFeature.type="Point":convertedFeature.type="LineString",convertedFeature.symbolCode=feature.acmType;break;default:convertedFeature.type="Point"}return convertedFeature.coordinates=emp3.api.convertCMAPIPositionsToGeoJson(feature.positions,convertedFeature.type),convertedFeature},emp3.api.convertFeatureToKML=function(feature){return feature.KMLString},emp3.api.convertStatusType=function(status){var result;switch(status){case"init":result=emp3.api.enums.MapStateEnum.INIT_IN_PROGRESS;break;case"ready":result=emp3.api.enums.MapStateEnum.MAP_READY;break;case"teardown":result=emp3.api.enums.MapStateEnum.SHUTDOWN;break;case"mapswapinprogress":result=emp3.api.enums.MapStateEnum.MAP_SWAP_IN_PROGRESS;break;case"shutdowninprogress":result=emp3.api.enums.MapStateEnum.SHUTDOWN_IN_PROGRESS;break;default:result=status}return result},emp3.api.buildFeature=function(args){var feature,standardArgs={name:args.name,geoId:args.geoId,positions:args.coordinates};switch(args.type){case emp3.api.enums.FeatureTypeEnum.GEO_POINT:feature=new emp3.api.Point(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:feature=new emp3.api.Path(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:feature=new emp3.api.Polygon(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:feature=new emp3.api.Square(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:feature=new emp3.api.Rectangle(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:feature=new emp3.api.Circle(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:feature=new emp3.api.Ellipse(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:standardArgs.symbolCode=args.symbolCode,feature=new emp3.api.MilStdSymbol(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:feature=new emp3.api.Text(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:feature=new emp3.api.AirControlMeasure(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.KML:delete standardArgs.positions,standardArgs.KMLString=args.KMLString,feature=new emp3.api.KML(standardArgs);break;case emp3.api.enums.FeatureTypeEnum.GEOJSON:delete standardArgs.positions,standardArgs.GeoJSONData=JSON.stringify(args.GeoJSONData),feature=new emp3.api.GeoJSON(standardArgs)}return emp3.api.convertCMAPIPropertiesToFeature(feature,args.properties),feature},emp3.api.buildOverlay=function(args){var overlay;return overlay=new emp3.api.Overlay({name:args.name,geoId:args.geoId,dataProviderId:args.dataProviderId,description:args.description,properties:args.properties,children:args.children,readOnly:args.readOnly})},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.enums||(emp3.api.enums={}),emp3.api.enums.CameraEventEnum={CAMERA_IN_MOTION:0,CAMERA_MOTION_STOPPED:1},emp3.api.enums.ContainerEventEnum={OBJECT_ADDED:0,OBJECT_REMOVED:1},emp3.api.enums.FeatureDrawEventEnum={DRAW_CANCELLED:"cancel",DRAW_COMPLETE:"complete",DRAW_START:"start",DRAW_UPDATE:"update"},emp3.api.enums.FeatureEditEventEnum={EDIT_CANCELLED:"cancel",EDIT_COMPLETE:"complete",EDIT_START:"start",EDIT_UPDATE:"update"},emp3.api.enums.FeatureEditUpdateType={ACM_ATTRIBUTE_UPDATED:"acm",COORDINATE_ADDED:"add",COORDINATE_MOVED:"update",COORDINATE_DELETED:"remove",FEATURE_PROPERTY_UPDATED:"property",MILSTD_MODIFIER_UPDATED:"modifier",POSITION_UPDATED:"moved"},emp3.api.enums.FeatureEventEnum={FEATURE_DESELECTED:0,FEATURE_SELECTED:1},emp3.api.enums.FeatureTypeEnum={GEO_ACM:"airspace",GEO_CIRCLE:"circle",GEO_ELLIPSE:"ellipse",GEO_MIL_SYMBOL:"milstd",GEO_PATH:"path",GEO_POINT:"point",GEO_POLYGON:"polygon",GEO_RECTANGLE:"rectangle",GEO_SQUARE:"square",GEO_TEXT:"text",KML:"kml",GEOJSON:"geojson"},emp3.api.enums.IconSizeEnum={LARGE:"large",MEDIUM:"medium",SMALL:"small",TINY:"tiny"},emp3.api.enums.MapEventEnum={STATE_CHANGE:0},emp3.api.enums.MapFreehandEventEnum={MAP_ENTERED_FREEHAND_DRAW_MODE:0,MAP_EXIT_FREEHAND_DRAW_MODE:1,MAP_FREEHAND_LINE_DRAW_END:2,MAP_FREEHAND_LINE_DRAW_START:3,MAP_FREEHAND_LINE_DRAW_UPDATE:4},emp3.api.enums.MapMotionLockEnum={NO_MOTION:0,NO_PAN:1,NO_ZOOM:2,NO_ZOOM_NO_PAN:3,SMART_MOTION:4,UNLOCKED:5},emp3.api.enums.MapStateEnum={INIT_IN_PROGRESS:0,MAP_NEW:1,MAP_READY:2,MAP_SWAP_IN_PROGRESS:3,SHUTDOWN:4,SHUTDOWN_IN_PROGRESS:5},emp3.api.enums.MapViewEventEnum={VIEW_IN_MOTION:"viewInMotion",VIEW_MOTION_STOPPED:"viewStopped"},emp3.api.enums.MilStdLabelSettingEnum={ALL_LABELS:"all",COMMON_LABELS:"common",REQUIRED_LABELS:"required"},emp3.api.enums.UserInteractionEventEnum={CLICKED:"single",DOUBLE_CLICKED:"double",LONG_PRESS:"press",MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",MOUSE_MOVE:"move",DRAG:"drag",DRAG_COMPLETE:"dragComplete"},emp3.api.enums.UserInteractionMouseButtonEventEnum={LEFT:0,MIDDLE:1,RIGHT:2},emp3.api.enums.UserInteractionKeyEventEnum={CTRL:0,ALT:1,SHIFT:2},emp3.api.enums.VisibilityActionEnum={HIDE_ALL:0,SHOW_ALL:1,TOGGLE_OFF:2,TOGGLE_ON:3},emp3.api.enums.VisibilityStateEnum={HIDDEN:0,VISIBLE:1,VISIBLE_ANCESTOR_HIDDEN:2},emp3.api.enums.WMSVersionEnum={VERSION_1_1:"1.1",VERSION_1_1_1:"1.1.1",VERSION_1_3:"1.3.0"},emp3.api.enums.EventType={CAMERA_EVENT:"emp3.api.events.CameraEvent",CONTAINER:"emp3.api.events.ContainerEvent",FEATURE_DRAW:"emp3.api.events.FeatureDrawEvent",FEATURE_EDIT:"emp3.api.events.FeatureEditEvent",FEATURE_EVENT:"emp3.api.events.FeatureEvent",FEATURE_INTERACTION:"emp3.api.events.FeatureInteractionEvent",LOOKAT_EVENT:"emp3.api.events.LookAtEvent",MAP_CURSOR_MOVE:"emp3.api.events.MapCursorMoveEvent",MAP_FEATURE_ADDED:"emp3.api.events.MapFeatureAddedEvent",MAP_FEATURE_UPDATED:"emp3.api.events.MapFeatureUpdatedEvent",MAP_FEATURE_REMOVED:"emp3.api.events.MapFeatureRemovedEvent",MAP_INTERACTION:"emp3.api.events.MapInteractionEvent",MAP_FREEHAND_DRAW_EVENT:"emp3.api.events.MapFreehandDrawEvent",MAP_STATE_CHANGE:"emp3.api.events.MapStateChangeEvent",MAP_VIEW_CHANGE:"emp3.api.events.MapViewChangeEvent",OVERLAY_CHANGE:"emp3.api.events.OverlayChangeEvent",VISIBILITY:"emp3.api.events.VisibilityEvent"},emp3.api.enums.messageCompletionStatus={FAILURE:"failure",MIXED:"mixed",SUCCESS:"success",CANCELLED:"cancelled"},emp3.api.enums.channel={mapShutdown:"map.shutdown",convert:"map.convert",swap:"map.swap",convertResponse:"map.convert.response",removeOverlay:"map.overlay.remove",createOverlay:"map.overlay.create",hideOverlay:"map.overlay.hide",showOverlay:"map.overlay.show",styleOverlay:"map.overlay.style",updateOverlay:"map.overlay.update",clearFeatures:"map.overlay.clear",overlayClusterSet:"map.overlay.cluster.set",overlayClusterActivate:"map.overlay.cluster.activate",overlayClusterDeactivate:"map.overlay.cluster.deactivate",overlayClusterRemove:"map.overlay.cluster.remove",plotFeature:"map.feature.plot",plotFeatureBatch:"map.feature.plot.batch",draw:"map.feature.draw",featureEdit:"map.feature.edit",plotUrl:"map.feature.plot.url",unplotFeature:"map.feature.unplot",unplotFeatureBatch:"map.feature.unplot.batch",hideFeature:"map.feature.hide",showFeature:"map.feature.show",updateFeature:"map.feature.update",featureSelected:"map.feature.selected",featureSelectedBatch:"map.feature.selected.batch",featureDeselected:"map.feature.deselected",featureDeselectedBatch:"map.feature.deselected.batch",featureClicked:"map.feature.clicked",featureMouseDown:"map.feature.mousedown",featureMouseUp:"map.feature.mouseup",get:"map.get",clearMap:"map.clear",statusScreenshot:"map.status.screenshot",menuCreate:"map.menu.create",menuClicked:"map.menu.clicked",menuRemove:"map.menu.remove",menuSetVisible:"map.menu.active",zoom:"map.view.zoom",centerOnOverlay:"map.view.center.overlay",centerOnFeature:"map.view.center.feature",centerOnLocation:"map.view.center.location",centerOnBounds:"map.view.center.bounds",lookAtLocation:"map.view.lookat.location",coordinateSystem:"map.view.coordinatesystem",lockView:"map.view.lock",clicked:"map.view.clicked",mouseup:"map.view.mouseup",mousedown:"map.view.mousedown",mousemove:"map.view.mousemove",statusRequest:"map.status.request",statusInitialization:"map.status.initialization",statusView:"map.status.view",statusFormat:"map.status.format",statusAbout:"map.status.about",statusCoordinateSystem:"map.status.coordinatesystem",statusSelected:"map.status.selected",error:"map.error",transactionComplete:"map.message.complete",cancel:"map.message.cancel",messageProgress:"map.message.progress",menuDrawingCreate:"map.menu.drawing.create",menuDrawingComplete:"map.menu.drawing.complete",menuDrawingRemove:"map.menu.drawing.remove",getVisibility:"cmapi2.visibility.get",config:"cmapi2.map.config",featureAddEvent:"cmapi2.map.feature.event.add",featureUpdateEvent:"cmapi2.map.feature.event.update",featureRemoveEvent:"cmapi2.map.feature.event.remove",freehandDrawStart:"cmapi2.map.freehand.start",freehandDrawExit:"cmapi2.map.freehand.stop",freehandLineDraw:"cmapi2.map.freehand.linedraw",drag:"cmapi2.map.view.drag",dragComplete:"cmapi2.map.view.dragComplete",featureDrag:"cmapi2.map.feature.drag",featureDragComplete:"cmapi2.map.feature.dragComplete"},emp3.api.enums.updateEventType={UPDATE:"update",COMPLETE:"complete",START:"start"},emp3.api.enums.version="ER1 Sprint 10",emp3.api.enums.defaultMilStdLabelSetting=emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS,emp3.api.enums.defaultMidDistanceThreshold=2e4,emp3.api.enums.defaultFarDistanceThreshold=6e5,emp3.api.enums.defaultIconSize=emp3.api.enums.IconSizeEnum.SMALL,emp3.api.enums.defaultOverlayId={WMS:void 0,Layers:void 0},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Container=function(args){cmapi.inherit(new cmapi.IGeoContainer,this),this.patchProps(args)},emp3.api.Container.prototype.addEventListener=function(args){if(args=args||{},!args.callback)throw new Error("Missing argument: callback");if(!args.eventType)throw new Error("Missing argument: eventType");return emp3.api.MessageHandler.getInstance().addEventListener({id:this.geoId,event:args.eventType,callback:args.callback}),args.callback},emp3.api.Container.prototype.removeEventListener=function(args){if(args=args||{},!args.eventType)throw new Error("Missing argument: eventType");if(!args.callback)throw new Error("Missing argument: callback");return emp3.api.MessageHandler.getInstance().removeEventListener({id:this.geoId,event:args.eventType,callback:args.callback}),args.callback},emp3.api.Container.prototype.clearContainer=function(){throw new Error("clearContainer has not been implemented by this class")},emp3.api.Container.prototype.getParents=function(){throw new Error("getParents has not been implemented by this class")},emp3.api.Container.prototype.getChildren=function(){throw new Error("getChildren has not been implemented by this class")},emp3.api.Container.prototype.hasChildren=function(){return emp3.api.MessageHandler.getInstance().hasChildren(this)},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.CameraManager=function(){function init(){_mapToCamera={}}function setCameraForMap(args){if(args=args||{},!args.camera)throw new Error("Missing argument: camera");if(!(args.camera instanceof emp3.api.Camera))throw new TypeError("Invalid argument: camera is not of type emp3.api.Camera");if(!args.map)throw new Error("Missing argument: map");var mapId;if("string"==typeof args.map)mapId=args.map;else{if(!(args.map instanceof emp3.api.Map))throw new TypeError(INVALID_MAP_TYPE_ERROR);mapId=args.map.geoId}_mapToCamera[mapId]=args.camera}function getCameraForMap(args){if(args=args||{},!args.map)throw new Error("Missing argument: map");var mapId;if("string"==typeof args.map)mapId=args.map;else{if(!(args.map instanceof emp3.api.Map))throw new TypeError(INVALID_MAP_TYPE_ERROR);mapId=args.map.geoId}return _mapToCamera[mapId]}function getMapsForCamera(args){if(args=args||{},!args.camera)throw new Error("Missing argument: camera");var cameraId;if("string"==typeof args.camera)cameraId=args.camera;else{if(!(args.camera instanceof emp3.api.Camera))throw new TypeError(INVALID_CAMERA_TYPE_ERROR);cameraId=args.camera.geoId}var maps=[];for(var map in _mapToCamera)_mapToCamera[map].geoId===cameraId&&maps.push(map);return maps}function removeCameraForMap(args){if(args=args||{},!args.map)throw new Error("Missing argument: map");var mapId;if("string"==typeof args.map)mapId=args.map;else{if(!(args.map instanceof emp3.api.Map))throw new TypeError(INVALID_MAP_TYPE_ERROR);mapId=args.map.geoId}delete _mapToCamera[mapId]}var INVALID_CAMERA_TYPE_ERROR="Invalid argument: expected camera to be emp3.api.Camera or geoId string",INVALID_MAP_TYPE_ERROR="Invalid argument: expected map to be emp3.api.Map or geoId string",_mapToCamera={};return{init:init,setCameraForMap:setCameraForMap,getCameraForMap:getCameraForMap,getMapsForCamera:getMapsForCamera,removeCameraForMap:removeCameraForMap}}(),window.emp3||(window.emp3={}),window.emp3.api||(window.emp3.api={}),emp3.api.LookAtManager=function(){function init(){_mapToLookAt={}}function setLookAtForMap(args){if(args=args||{},!args.lookAt)throw new Error("Missing argument: lookAt");if(!(args.lookAt instanceof emp3.api.LookAt))throw new TypeError("Invalid argument: lookAt is not of type emp3.api.LookAt");if(!args.map)throw new Error("Missing argument: map");var mapId;if("string"==typeof args.map)mapId=args.map;else{if(!(args.map instanceof emp3.api.Map))throw new TypeError(INVALID_MAP_TYPE_ERROR);mapId=args.map.geoId}_mapToLookAt[mapId]=args.lookAt}function getLookAtForMap(args){if(args=args||{},!args.map)throw new Error("Missing argument: map");var mapId;if("string"==typeof args.map)mapId=args.map;else{if(!(args.map instanceof emp3.api.Map))throw new TypeError(INVALID_MAP_TYPE_ERROR);mapId=args.map.geoId}return _mapToLookAt[mapId]}function getMapsForLookAt(args){if(args=args||{},!args.lookAt)throw new Error("Missing argument: lookAt");var lookAtId;if("string"==typeof args.lookAt)lookAtId=args.lookAt;else{if(!(args.lookAt instanceof emp3.api.LookAt))throw new TypeError(INVALID_LOOKAT_TYPE_ERROR);lookAtId=args.lookAt.geoId}var maps=[];for(var map in _mapToLookAt)_mapToLookAt[map].geoId===lookAtId&&maps.push(map);return maps}function removeLookAtForMap(args){if(args=args||{},!args.map)throw new Error("Missing argument: map");var mapId;if("string"==typeof args.map)mapId=args.map;else{if(!(args.map instanceof emp3.api.Map))throw new TypeError(INVALID_MAP_TYPE_ERROR);mapId=args.map.geoId}delete _mapToLookAt[mapId]}var INVALID_LOOKAT_TYPE_ERROR="Invalid argument: expected lookAt to be emp3.api.LookAt or geoId string",INVALID_MAP_TYPE_ERROR="Invalid argument: expected map to be emp3.api.Map or geoId string",_mapToLookAt={};return{init:init,setLookAtForMap:setLookAtForMap,getLookAtForMap:getLookAtForMap,getMapsForLookAt:getMapsForLookAt,removeLookAtForMap:removeLookAtForMap}}(),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Transaction=function(args){if(args=args||{},!args.id)throw new Error("Missing parameter: id has not been set");this.id=args.id,this.mapId=args.mapId,this.geoId=args.geoId},emp3.api.Transaction.prototype.cancel=function(){var cmd;cmd={cmd:emp3.api.enums.channel.cancel,transaction:this},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.mapId,source:this,method:"Transaction.cancel",args:{}})},emp3.api.Transaction.prototype.complete=function(){var cmd;cmd={cmd:emp3.api.enums.channel.transactionComplete,transaction:this},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.mapId,source:this,method:"Transaction.complete",args:{}})},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Camera=function(args){if(cmapi.inherit(new cmapi.IGeoCamera(args),this),args=args||{},"undefined"!=typeof args.latitude&&"number"!=typeof args.latitude)throw new TypeError("Invalid argument: expected latitude to be a number");if(args.latitude>90||args.latitude<-90)throw new Error("Invalid latitude: latitude must be between 90.0 and -90.0");if("undefined"!=typeof args.longitude&&"number"!=typeof args.longitude)throw new TypeError("Invalid argument: expected longitude to be a number");if(args.longitude>180||args.longitude<-180)throw new Error("Invalid longitude: longitude must be between 180.0 and -180.0");if("undefined"!=typeof args.altitude&&"number"!=typeof args.altitude)throw new TypeError("Invalid argument: expected altitude to be a number");if("undefined"!=typeof args.roll&&"number"!=typeof args.roll)throw new TypeError("Invalid argument: expected roll to be a number");if("undefined"!=typeof args.heading&&"number"!=typeof args.heading)throw new TypeError("Invalid argument: expected heading to be a number");if("undefined"!=typeof args.tilt&&"number"!=typeof args.tilt)throw new TypeError("Invalid argument: expected tilt to be a number");if("undefined"!=typeof args.altitudeMode){var validMode=!1;for(var mode in cmapi.enums.altitudeMode)if(args.altitudeMode===cmapi.enums.altitudeMode[mode]){validMode=!0;break}if(!validMode)throw new Error("Invalid Argument: altitudeMode is not valid")}else args.altitudeMode=cmapi.enums.altitudeMode.ABSOLUTE;this.patchProps(args)},emp3.api.Camera.prototype.addCameraEventListener=function(args){if(args=args||{},!args.callback)throw new Error("Missing argument: callback");if("undefined"==typeof args.eventType)throw new Error("Missing argument: eventType");return emp3.api.MessageHandler.getInstance().addEventListener({id:this.geoId,event:args.eventType,callback:args.callback}),args.callback},emp3.api.Camera.prototype.removeEventListener=function(args){if(args=args||{},"undefined"==typeof args.eventType)throw new Error("Missing argument: eventType");if(!args.callback)throw new Error("Missing argument: callback");return emp3.api.MessageHandler.getInstance().removeEventListener({id:this.geoId,event:args.eventType,callback:args.callback}),args.callback},emp3.api.Camera.prototype.apply=function(){if(this.latitude>90||this.latitude<-90)throw new Error("Invalid latitude: latitude must be between 90.0 and -90.0");if(this.longitude>180||this.longitude<-180)throw new Error("Invalid longitude: longitude must be between 180.0 and -180.0");var maps=emp3.api.CameraManager.getMapsForCamera({camera:this});for(var mapIt in maps){var map=emp3.api.MessageHandler.getInstance().lookupMap(maps[mapIt]);if(map.getCamera().geoId===this.geoId){var cmd={cmd:emp3.api.enums.channel.centerOnLocation,camera:this};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:map.geoId,source:this,method:"Camera.apply",args:this})}}},emp3.api.Camera.prototype.copySettingsFrom=function(camera){if("undefined"==typeof camera)throw new Error("Missing argument: camera");if(!(camera instanceof emp3.api.Camera))throw new TypeError("Invalid argument: camera is not of type emp3.api.Camera");for(var prop in camera)camera.hasOwnProperty(prop)&&"geoId"!==prop&&(this[prop]=camera[prop])},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.LookAt=function(args){if(args=args||{},cmapi.inherit(new cmapi.IGeoLookAt(args),this),"undefined"!=typeof args.latitude&&"number"!=typeof args.latitude)throw new TypeError("Invalid argument: expected latitude to be a number");if(args.latitude>90||args.latitude<-90)throw new Error("Invalid argument: expected latitude to be between 90.0 and -90.0");if("undefined"!=typeof args.longitude&&"number"!=typeof args.longitude)throw new TypeError("Invalid argument: expected longitude to be a number");if(args.longitude>180||args.longitude<-180)throw new Error("Invalid argument: expected longitude to be between 180.0 and -180.0");if("undefined"!=typeof args.altitude&&"number"!=typeof args.altitude)throw new TypeError("Invalid argument: expected altitude to be a number");if("undefined"!=typeof args.range&&"number"!=typeof args.range)throw new TypeError("Invalid argument: expected range to be a number");if("undefined"!=typeof args.heading&&"number"!=typeof args.heading)throw new TypeError("Invalid argument: expected heading to be a number");if("undefined"!=typeof args.tilt){if("number"!=typeof args.tilt)throw new TypeError("Invalid argument: expected tilt to be a number");if(args.tilt<0||args.tilt>180)throw new Error("Invalid argument: valid tilt values are between 0.0 and 180.0")}if("undefined"!=typeof args.altitudeMode){var validMode=!1;for(var mode in cmapi.enums.altitudeMode)if(cmapi.enums.altitudeMode.hasOwnProperty(mode)&&args.altitudeMode===cmapi.enums.altitudeMode[mode]){validMode=!0;break}if(!validMode)throw new Error("Invalid Argument: altitudeMode is not valid")}else args.altitudeMode=cmapi.enums.altitudeMode.ABSOLUTE;this.patchProps(args)},emp3.api.LookAt.prototype.apply=function(){if(this.tilt<0||this.tilt>180)throw new Error("Invalid tilt value: expected tilt to be between 0.0 and 180.0");if(this.latitude>90||this.latitude<-90)throw new Error("Invalid latitude: expected latitude to be between 90.0 and -90.0");if(this.longitude>180||this.longitude<-180)throw new Error("Invalid longitude: expected longitude to be between 180.0 and -180.0");var maps=emp3.api.LookAtManager.getMapsForLookAt({lookAt:this});for(var mapIt in maps){var map=emp3.api.MessageHandler.getInstance().lookupMap(maps[mapIt]);if(map.getLookAt().geoId===this.geoId){var cmd={cmd:emp3.api.enums.channel.lookAtLocation,lookAt:this};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:map.geoId,source:this,method:"LookAt.apply",args:this})}}},emp3.api.LookAt.prototype.copySettingsFrom=function(lookAt){if(!lookAt)throw new Error("Missing Argument: lookAt");if(!(lookAt instanceof emp3.api.LookAt))throw new TypeError("Invalid Argument: Expected emp3.api.LookAt");for(var prop in lookAt)lookAt.hasOwnProperty(prop)&&"geoId"!==prop&&(this[prop]=lookAt[prop])},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Map=function(args){var callInfo,mhInstance,urlEnv;if(console.log("EMP3 web %s",emp3.api.global.version),args=args||{},this.environment=args.environment||"browser",urlEnv=emp.util.getParameterByName("empenv"),null!==urlEnv)switch(urlEnv){case"iwc":this.environment="iwc";break;case"starfish":this.environment="starfish";break;case"owf":this.environment="owf"}if(!args.container&&"browser"===this.environment&&""!==args.container)throw new Error("The container argument must be populated if environment is set to 'browser'");if(args.iwcHost=emp.util.getParameterByName("iwchost")||args.iwcHost,emp.environment.iwc.iwcHost=args.iwcHost,!args.iwcHost&&"iwc"===this.environment)throw new Error("No iwcHost attribute was provided in emp3.api.Map args object nor an iwchost parameter present in the URL querystring. EMP cannot use the IWC environment without a specified iwchost pointing to the IWC location to be used by all participating applications.");if(this.status=emp3.api.enums.MapStateEnum.MAP_NEW,this.geoId=void 0,this.bounds={north:void 0,south:void 0,east:void 0,west:void 0},this.engine=args.engine,args.onSuccess=args.onSuccess||function(){},args.onError=args.onError||function(){},this.drawTransaction=null,this.editTransaction=null,args.bounds&&(void 0===args.bounds.north||void 0===args.bounds.south||void 0===args.bounds.east||void 0===args.bounds.west))throw new Error("Invalid parameter bounds: bounds must contain at least north, east, south, and west");if(!args.engine)throw new Error("An 'engine' argument must be populated");if(!args.engine.engineBasePath)throw new Error("An 'engineBasePath' argument must be populated");if(!args.engine.mapEngineId)throw new Error("An 'mapEngineId' argument must be populated");args.engine.properties||(args.engine.properties={}),void 0!==args.iconSize?this.iconSize=args.iconSize:this.iconSize=emp3.api.enums.defaultIconSize,args.engine.properties.iconSize=this.iconSize,void 0!==args.milStdLabels?this.milStdLabels=args.milStdLabels:this.milStdLabels=emp3.api.enums.defaultMilStdLabelSetting,args.engine.properties.milStdLabels=this.milStdLabels,void 0!==args.backgroundBrightness?this.brightness=args.backgroundBrightness:this.brightness=args.backgroundBrightness,args.engine.properties.brightness=this.brightness,void 0!==args.renderingOptimization?this.renderingOptimization=args.renderingOptimization:this.renderingOptimization=!0,args.engine.properties.renderingOptimization=this.renderingOptimization,void 0!==args.midDistanceThreshold?this.midDistanceThreshold=args.midDistanceThreshold:this.midDistanceThreshold=emp3.api.enums.defaultMidDistanceThreshold,args.engine.properties.midDistanceThreshold=this.midDistanceThreshold,void 0!==args.farDistanceThreshold?this.farDistanceThreshold=args.farDistanceThreshold:this.farDistanceThreshold=emp3.api.enums.defaultFarDistanceThreshold,args.engine.properties.farDistanceThreshold=args.farDistanceThreshold,args.engine.manifestName=args.engine.manifestName||"manifest.js";var oThis=this;mhInstance=emp3.api.MessageHandler.getInstance({environment:this.environment,iwcHost:args.iwcHost,container:args.container});var mapInstantiatedSuccess=function(cbArgs){oThis.geoId=cbArgs.id,oThis.status=emp3.api.enums.MapStateEnum.MAP_READY,callInfo={mapId:oThis.geoId,source:oThis,method:"Map",args:args},mhInstance.registerMap(oThis),args.onSuccess({callInfo:callInfo,source:callInfo.source,args:callInfo.args,failures:cbArgs.failures})};args.container&&""!==args.container?(this.container=args.container,setTimeout(function(){mhInstance.spawnMap({map:oThis,defaultExtent:args.bounds,container:args.container,engine:oThis.engine,environment:oThis.environment,recorder:args.recorder,onSuccess:mapInstantiatedSuccess,onError:function(args){window.console.error(args)}})},0)):args.spawnMap?setTimeout(function(){mhInstance.spawnMap({map:this,defaultExtent:args.bounds,container:args.mapWidgetName||"CPCE Map",engine:this.engine,environment:oThis.environment,onSuccess:mapInstantiatedSuccess,onError:function(args){window.console.error(args)}})}.bind(this),0):(this.geoId="broadcast",mhInstance.registerMap(this),callInfo={mapId:this.geoId,source:this,method:"Map",args:args},mhInstance.notifyOnReady({callInfo:callInfo,args:{id:this.geoId,onSuccess:function(){oThis.status=emp3.api.enums.MapStateEnum.MAP_READY,args.onSuccess({callInfo:callInfo,source:callInfo.source,args:callInfo.args,failures:[]})},onError:function(args){window.console.error(args)}}}),this.status=emp3.api.enums.MapStateEnum.MAP_READY)},emp3.api.Map.prototype=new emp3.api.Container,emp3.api.Map.prototype.addMapService=function(args){var cmd;if(args=args||{},this.readyCheck(),!args.mapService)throw new Error("Missing argument: mapService");cmd={cmd:emp3.api.enums.channel.plotUrl,mapService:args.mapService,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.addMapService",args:args})},emp3.api.Map.prototype.addOverlay=function(args){if(args=args||{},this.readyCheck(),!args.overlay)throw new Error("Missing argument: overlay");this.addOverlays({overlays:[args.overlay],onSuccess:args.onSuccess,onError:args.onError})},emp3.api.Map.prototype.addOverlays=function(args){var cmd;if(args=args||{},this.readyCheck(),!args.overlays)throw new Error("Missing argument: overlays");cmd={cmd:emp3.api.enums.channel.createOverlay,overlays:args.overlays,parentId:this.geoId,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.addOverlays",args:args})},emp3.api.Map.prototype.cancelDraw=function(){this.drawTransaction&&(this.drawTransaction.cancel(),this.drawTransaction=null)},emp3.api.Map.prototype.cancelEdit=function(){this.editTransaction&&(this.editTransaction.cancel(),this.editTransaction=null)},emp3.api.Map.prototype.completeDraw=function(){this.drawTransaction&&(this.drawTransaction.complete(),this.drawTransaction=null)},emp3.api.Map.prototype.completeEdit=function(){this.editTransaction&&(this.editTransaction.complete(),this.editTransaction=null)},emp3.api.Map.prototype.drawFeature=function(args){var type;if(this.readyCheck(),args=args||{},!args.feature)throw new Error("Missing argument: feature");if(type=args.feature.featureType,!type)throw new Error("Cannot draw a feature of type emp3.map.Feature");var cmd={cmd:emp3.api.enums.channel.draw,feature:args.feature,onError:args.onDrawError,startCallback:args.onDrawStart||"",updateCallback:args.onDrawUpdate||"",completeCallback:args.onDrawComplete||"",cancelCallback:args.onDrawCancel||""};this.drawTransaction=emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.drawFeature",args:args})},emp3.api.Map.prototype.drawFreehand=function(args){this.readyCheck(),args=args||{};var cmd={cmd:emp3.api.enums.channel.freehandDrawStart,strokeStyle:args.strokeStyle,freehandCallback:args.onFreehandEvent};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.drawFreehand",args:args})},emp3.api.Map.prototype.drawFreehandExit=function(){this.readyCheck();var cmd={cmd:emp3.api.enums.channel.freehandDrawExit};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.drawFreehandExit"})},emp3.api.Map.prototype.setFreehandStyle=function(args){this.readyCheck();var cmd={cmd:emp3.api.enums.channel.config,freehandStrokeStyle:args.initialStyle};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setFreehandStyle"})},emp3.api.Map.prototype.editFeature=function(args){if(args=args||{},!args.feature)throw new Error("Missing argument: feature");var cmd={cmd:emp3.api.enums.channel.featureEdit,feature:args.feature,startCallback:args.onEditStart||"",updateCallback:args.onEditUpdate||"",completeCallback:args.onEditComplete||"",cancelCallback:args.onEditCancel||"",onError:args.onEditError},callInfo={mapId:this.geoId,source:this,method:"Map.editFeature",args:args};if(this.editTransaction&&this.editTransaction.geoId===args.feature.geoId){if(args.onEditError){var msg="Feature is already in edit mode";args.onEditError({errorMessage:msg,callInfo:callInfo,source:this,args:args})}}else this.editTransaction=emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Map.prototype.getFarDistanceThreshold=function(){return this.farDistanceThreshold},emp3.api.Map.prototype.getIconSize=function(){return this.iconSize},emp3.api.Map.prototype.getMidDistanceThreshold=function(){return this.midDistanceThreshold},emp3.api.Map.prototype.setFarDistanceThreshold=function(threshold){if("number"!=typeof threshold)throw new Error("Type Error: Cannot set threshold to non-number.");if(threshold<this.midDistanceThreshold)throw new Error("Range Error: Cannot set far-distance threshold lower than the mid-distance threshold.");var cmd={cmd:emp3.api.enums.channel.config,farDistanceThreshold:threshold},callInfo={mapId:this.geoId,source:this,method:"Map.setFarDistanceThreshold",args:{threshold:threshold}};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo),this.farDistanceThreshold=threshold},emp3.api.Map.prototype.setIconSize=function(size){if(size!==emp3.api.enums.IconSizeEnum.TINY&&size!==emp3.api.enums.IconSizeEnum.SMALL&&size!==emp3.api.enums.IconSizeEnum.MEDIUM&&size!==emp3.api.enums.IconSizeEnum.LARGE)throw new Error("Type Error: Cannot set icon size to be anything other than emp3.api.enums.IconSizeEnum.");var cmd={cmd:emp3.api.enums.channel.config,iconSize:size},callInfo={mapId:this.geoId,source:this,method:"Map.setIconSize",
args:{size:size}};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo),this.iconSize=size},emp3.api.Map.prototype.setMidDistanceThreshold=function(threshold){if("number"!=typeof threshold)throw new Error("Type Error: Cannot set threshold to non-number.");if(threshold>this.farDistanceThreshold)throw new Error("Range Error: Cannot set mid-distance threshold greater than the far-distance threshold.");var cmd={cmd:emp3.api.enums.channel.config,midDistanceThreshold:threshold},callInfo={mapId:this.geoId,method:"Map.setMidDistanceThreshold",args:{threshold:threshold}};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo),this.midDistanceThreshold=threshold},emp3.api.Map.prototype.getMilStdLabels=function(){return this.milStdLabels},emp3.api.Map.prototype.getVisibility=function(args){if(args=args||{},this.readyCheck(),!args.target)throw new Error("Missing argument: target");var cmd={cmd:emp3.api.enums.channel.getVisibility,target:args.target,parent:args.parent,onSuccess:args.onSuccess,onError:args.onError},callInfo={mapId:this.geoId,source:this,method:"Map.getVisibility",args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Map.prototype.setMilStdLabels=function(labelSetting){if(labelSetting!==emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS&&labelSetting!==emp3.api.enums.MilStdLabelSettingEnum.REQUIRED_LABELS&&labelSetting!==emp3.api.enums.MilStdLabelSettingEnum.ALL_LABELS)throw new Error("Type Error: Cannot set MilStdLabels to be anything other than emp3.api.enums.MilStdLabelSettingEnum.");var cmd={cmd:emp3.api.enums.channel.config,milStdLabels:labelSetting},callInfo={mapId:this.geoId,source:this,method:"Map.setMilStdLabels",args:{labelSetting:labelSetting}};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo),this.milStdLabels=labelSetting},emp3.api.Map.prototype.setVisibility=function(args){var parentId,cmd,featureIds=[],overlayIds=[];if(args=args||{},this.readyCheck(),"undefined"==typeof args.target&&(args.target=[]),emp3.api.isArray(args.target))for(var target in args.target)args.target.hasOwnProperty(target)&&(emp3.api.isOverlay(args.target[target])?overlayIds.push(args.target[target].geoId):featureIds.push(args.target[target].geoId));else emp3.api.isOverlay(args.target)?overlayIds.push(args.target.geoId):featureIds.push(args.target.geoId);args.parent&&(parentId=emp3.api.isString(args.parent)?args.parent:args.parent.geoId),args.onSuccess||(args.onSuccess=function(){}),args.onError||(args.onError=function(){});var featureCallbacks={onSuccess:args.onSuccess,onError:args.onError},overlayCallbacks={onSuccess:args.onSuccess,onError:args.onError};overlayIds.length>0&&featureIds.length>0&&(featureCallbacks={onSuccess:function(){},onError:function(){}});var recurse=args.action===emp3.api.enums.VisibilityActionEnum.SHOW_ALL||args.action===emp3.api.enums.VisibilityActionEnum.HIDE_ALL;if(featureIds.length>0&&(cmd={features:featureIds,parent:parentId,recurse:recurse,onSuccess:featureCallbacks.onSuccess,onError:featureCallbacks.onError},args.action===emp3.api.enums.VisibilityActionEnum.SHOW_ALL||args.action===emp3.api.enums.VisibilityActionEnum.TOGGLE_ON?cmd.cmd=emp3.api.enums.channel.showFeature:args.action!==emp3.api.enums.VisibilityActionEnum.HIDE_ALL&&args.action!==emp3.api.enums.VisibilityActionEnum.TOGGLE_OFF||(cmd.cmd=emp3.api.enums.channel.hideFeature),emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setVisibility",args:args})),overlayIds.length>0){if(cmd={overlays:overlayIds,parent:parentId,recurse:recurse,onSuccess:overlayCallbacks.onSuccess,onError:overlayCallbacks.onError},args.action===emp3.api.enums.VisibilityActionEnum.SHOW_ALL||args.action===emp3.api.enums.VisibilityActionEnum.TOGGLE_ON)cmd.cmd=emp3.api.enums.channel.showOverlay;else{if(args.action!==emp3.api.enums.VisibilityActionEnum.HIDE_ALL&&args.action!==emp3.api.enums.VisibilityActionEnum.TOGGLE_OFF)throw new Error("Invalid Visibility Action "+args.action);cmd.cmd=emp3.api.enums.channel.hideOverlay}emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setVisibility",args:args})}},emp3.api.Map.prototype.getAllOverlays=function(args){args=args||{};var recursive=!0;if(this.readyCheck(),"function"!=typeof args.onSuccess)throw new Error("onSuccess argument is required, and must be a function.");var cmd={cmd:emp3.api.enums.channel.get,types:["overlay"],select:["overlayId","name","properties","parentId"],recursive:recursive,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.getOverlays",args:args})},emp3.api.Map.prototype.getMapServices=function(args){if(args=args||{},this.readyCheck(),"function"!=typeof args.onSuccess)throw new Error("onSuccess argument is required, and must be a function.");var cmd={cmd:emp3.api.enums.channel.get,types:["feature"],select:["name","description","featureId","url","format","params"],recursive:!0,filter:[{property:"overlayId",term:emp3.api.enums.defaultOverlayId.WMS}],onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.getMapServices",args:args})},emp3.api.Map.prototype.getAllFeatures=function(args){var cmd;if(args=args||{},this.readyCheck(),"function"!=typeof args.onSuccess)throw new Error("Missing argument: onSuccess");cmd={cmd:emp3.api.enums.channel.get,types:["feature"],select:["featureId","format","overlayId","name","properties"],recursive:!0,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.getFeatures",args:args})},emp3.api.Map.prototype.getBounds=function(){return{north:this.bounds.north,south:this.bounds.south,east:this.bounds.east,west:this.bounds.west}},emp3.api.Map.prototype.getCamera=function(){return emp3.api.CameraManager.getCameraForMap({map:this})},emp3.api.Map.prototype.getScreenCapture=function(args){var cmd;if(args=args||{},this.readyCheck(),"function"!=typeof args.onSuccess)throw new Error("onSuccess argument is required, and must be a function.");cmd={cmd:emp3.api.enums.channel.statusRequest,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.getScreenshot",args:args})},emp3.api.Map.prototype.getState=function(){return this.status},emp3.api.Map.prototype.purge=function(args){var cmd;if("string"==typeof this.geoId&&0!==this.geoId.length){if("browser"!==this.environment)throw new Error("Wrong environment: The map must be in the browser environment to call this method.  You are in environment "+this.environment);args=args||{},args.onSuccess=args.onSuccess||function(){},args.onError=args.onError||function(){},cmd={cmd:emp3.api.enums.channel.mapShutdown,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{map:this,source:this,method:"Map.shutdown",args:args}),emp3.api.CameraManager.removeCameraForMap({map:this})}},emp3.api.Map.prototype.readyCheck=function(){if(this.status!==emp3.api.enums.MapStateEnum.MAP_READY)throw new Error("Map is not ready. The Map object has not received a notification that it is ready to begin accepting requests")},emp3.api.Map.prototype.setBounds=function(args){var cmd;if(this.readyCheck(),args=args||{},"number"!=typeof args.north)throw new TypeError("Invalid bounds: expected north to be a number");if("number"!=typeof args.south)throw new TypeError("Invalid bounds: expected south to be a number");if("number"!=typeof args.east)throw new TypeError("Invalid bounds: expected east to be a number");if("number"!=typeof args.west)throw new TypeError("Invalid bounds: expected west to be a number");if(args.north>90||args.north<-90)throw new Error("Invalid bounds: north must be between 90.0 and -90.0");if(args.south>90||args.south<-90)throw new Error("Invalid bounds: south must be between 90.0 and  -90.0");if(args.south>args.north)throw new Error("Invalid bounds: southern bounds must be below northern bounds");if(args.east>180||args.east<-180)throw new Error("Invalid bounds: east must be be between -180.0 and 180.0");if(args.west>180||args.west<-180)throw new Error("Invalid bounds: west must be be between -180.0 and 180.0");args.east<args.west,cmd={cmd:emp3.api.enums.channel.centerOnBounds,north:args.north,south:args.south,east:args.east,west:args.west,animate:args.animate,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setBounds",args:args})},emp3.api.Map.prototype.setCamera=function(args){var cmd;if(this.readyCheck(),!args.camera)throw new Error("Missing argument(s): camera");cmd={cmd:emp3.api.enums.channel.centerOnLocation,camera:args.camera,animate:args.animate||!1,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setCamera",args:args}),emp3.api.CameraManager.setCameraForMap({camera:args.camera,map:this.geoId})},emp3.api.Map.prototype.setLookAt=function(args){if(args=args||{},this.readyCheck(),!args.lookAt)throw new Error("Missing argument: lookAt");var cmd={cmd:emp3.api.enums.channel.lookAtLocation,lookAt:args.lookAt,animate:args.animate,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setLookAt",args:args}),emp3.api.LookAtManager.setLookAtForMap({lookAt:args.lookAt,map:this})},emp3.api.Map.prototype.getLookAt=function(){return emp3.api.LookAtManager.getLookAtForMap({map:this})},emp3.api.Map.prototype.removeOverlay=function(args){if(args=args||{},this.readyCheck(),!args.overlay)throw new Error("Missing required parameter: overlay");this.removeOverlays({overlays:[args.overlay],onSuccess:args.onSuccess,onError:args.onError})},emp3.api.Map.prototype.removeOverlays=function(args){var cmd;if(args=args||{},this.readyCheck(),!args.overlays)throw new Error("Missing required parameter: overlays");cmd={cmd:emp3.api.enums.channel.removeOverlay,parentId:this.geoId,overlays:args.overlays,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.removeOverlays",args:args})},emp3.api.Map.prototype.removeMapService=function(args){if(args=args||{},!args.mapService)throw new Error("missing argument: mapService");var services=[];if(Array.isArray(args.mapService))for(var service in args.mapService)args.mapService.hasOwnProperty(service)&&services.push(args.mapService[service].geoId);else services=[args.mapService];var cmd={cmd:emp3.api.enums.channel.unplotFeature,overlayId:emp3.api.enums.defaultOverlayId.WMS,features:services,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.removeMapService",args:args})},emp3.api.Map.prototype.zoomTo=function(args){var cmd,featureIds=[];if(args=args||{},this.readyCheck(),!args.feature&&!args.overlay&&!args.featureList)throw new Error("Missing parameter: feature, overlay or featureList");if(args.featureList){if(emp3.api.isArray(args.featureList)){for(var i=0,j=args.featureList.length;i<j;i+=1)emp3.api.isFeature(args.featureList[i])||window.console.error("Type error: args.featureList contains an object that is not a feature."),featureIds.push(args.featureList[i].geoId);cmd={cmd:emp3.api.enums.channel.centerOnFeature,featureIds:featureIds}}}else args.overlay?emp3.api.isOverlay(args.overlay)?cmd={cmd:emp3.api.enums.channel.centerOnOverlay,overlayId:args.overlay.geoId}:window.console.error("Type error: args.featureList contains an object that is not an overlay."):args.feature&&(emp3.api.isFeature(args.feature)?cmd={cmd:emp3.api.enums.channel.centerOnFeature,featureId:args.feature.geoId}:console.error("Type error: args.feature contains an object that is not a feature."));emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.zoomTo",args:args})},emp3.api.Map.prototype.containerToGeo=function(args){args=args||{};var cmd={cmd:emp3.api.enums.channel.convert,conversionType:"offsetPixelToDecimalDegrees",x:args.x,y:args.y},callInfo={mapId:this.geoId,source:this,method:"map.convert",args:args};return emp3.api.MessageHandler.getInstance().convert(callInfo,cmd)},emp3.api.Map.prototype.geoToContainer=function(args){if(args=args||{},"number"!=typeof args.latitude)throw new TypeError("Invalid argument: expected latitude to be a number");if("number"!=typeof args.longitude)throw new TypeError("Invalid argument: expected longitude to be a number");var cmd={cmd:emp3.api.enums.channel.convert,conversionType:"decimalDegreesToOffsetPixel",x:args.longitude,y:args.latitude},callInfo={mapId:this.geoId,source:this,method:"Map.getXYFromLatLon",args:args},containerOffset=emp3.api.MessageHandler.getInstance().convert(callInfo,cmd);return containerOffset.x=Math.round(containerOffset.x),containerOffset.y=Math.round(containerOffset.y),containerOffset},emp3.api.Map.prototype.screenToGeo=function(args){if(args=args||{},"number"!=typeof args.x)throw new TypeError("Invalid argument: expected x to be a number");if("number"!=typeof args.y)throw new TypeError("Invalid argument: expected y to be a number");var container=document.getElementById(this.container),box=container.getBoundingClientRect(),offset={top:box.top+(window.pageYOffset||container.scrollTop)-(container.clientTop||0),left:box.left+(window.pageXOffset||container.scrollLeft)-(container.clientLeft||0)},cmd={cmd:emp3.api.enums.channel.convert,conversionType:"offsetPixelToDecimalDegrees",x:args.x-offset.left,y:args.y-offset.top},callInfo={mapId:this.geoId,source:this,method:"map.convert",args:args};return emp3.api.MessageHandler.getInstance().convert(callInfo,cmd)},emp3.api.Map.prototype.geoToScreen=function(args){if(args=args||{},"number"!=typeof args.latitude)throw new TypeError("Invalid argument: expected latitude to be a number");if("number"!=typeof args.longitude)throw new TypeError("Invalid argument: expected longitude to be a number");var container=document.getElementById(this.container),box=container.getBoundingClientRect(),offset={top:box.top+(window.pageYOffset||container.scrollTop)-(container.clientTop||0),left:box.left+(window.pageXOffset||container.scrollLeft)-(container.clientLeft||0)},cmd={cmd:emp3.api.enums.channel.convert,conversionType:"decimalDegreesToOffsetPixel",x:args.longitude,y:args.latitude},callInfo={mapId:this.geoId,source:this,method:"map.convert",args:args},containerOffset=emp3.api.MessageHandler.getInstance().convert(callInfo,cmd);return containerOffset.x+=offset.left,containerOffset.y+=offset.top,containerOffset.x=Math.round(containerOffset.x),containerOffset.y=Math.round(containerOffset.y),containerOffset},emp3.api.Map.prototype.setMotionLockMode=function(args){if(args=args||{},this.readyCheck(),void 0===args.mode)throw new Error("Missing Argument: mode");var cmd={cmd:emp3.api.enums.channel.lockView,lock:args.mode};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setMotionLockMode",args:args})},emp3.api.Map.prototype.swapMapEngine=function(args){if(this.readyCheck(),args=args||{},!args.engine)throw new Error("An 'engine' argument must be populated");if(!args.engine.engineBasePath)throw new Error("An 'engineBasePath' argument must be populated");if(!args.engine.mapEngineId)throw new Error("An 'mapEngineId' argument must be populated");args.engine.manifestName=args.engine.manifestName||"manifest.js";var cmd={cmd:emp3.api.enums.channel.swap,engine:args.engine,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Map.swapMapEngine",mapId:this.geoId,map:this,source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Map.prototype.getChildren=function(args){if(this.readyCheck(),args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["overlay"],select:["overlayId","name","properties","parentId"],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={mapId:this.geoId,method:"Map.getChildren",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Map.prototype.getParents=function(){},emp3.api.Map.prototype.getInstanceVisibility=function(parent,child){this.readyCheck();var mapGeoId=this.geoId;if(!(parent instanceof emp3.api.Map||parent instanceof emp3.api.Overlay||parent instanceof emp3.api.Feature))throw new TypeError("Invalid argument: parent should be a map, overlay, or feature");if(!(child instanceof emp3.api.Overlay||child instanceof emp3.api.Feature))throw new TypeError("Invalid argument: child should be an overlay or feature");if(parent instanceof emp3.api.Feature&&child instanceof emp3.api.Overlay)throw new Error("Invalid argument: a feature may not be the parent of an overlay");var state,getVisibilityTransaction=new emp.typeLibrary.Transaction({intent:emp.intents.control.VISIBILITY_GET,mapInstanceId:mapGeoId,transactionId:emp3.api.createGUID(),sender:mapGeoId,originChannel:cmapi.channel.names.CMAPI2_VISIBILITY_GET,source:emp.api.cmapi.SOURCE,messageOriginator:mapGeoId,originalMessageType:cmapi.channel.names.CMAPI2_VISIBILITY_GET,items:[{coreId:child.geoId,parentId:parent.geoId,visible:void 0}]});try{emp.storage.visibility.getState(getVisibilityTransaction),state=getVisibilityTransaction.items[0].visible}catch(err){console.error(err)}return state},emp3.api.Map.prototype.setSelectionStyle=function(args){var color,scale;color=args.color,scale=args.scale;var cmd={cmd:emp3.api.enums.channel.config,color:color,scale:scale};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.setSelectionStyle",args:args})},emp3.api.Map.prototype.getSelected=function(){return this.readyCheck(),emp3.api.MessageHandler.getInstance().getSelected(this.geoId)},emp3.api.Map.prototype.isSelected=function(args){if(args=args||{},this.readyCheck(),!args.feature)throw new Error("Missing argument: feature");return emp3.api.MessageHandler.getInstance().isSelected(this.geoId,args.feature.geoId)},emp3.api.Map.prototype.deselectFeature=function(args){if(args=args||{},this.readyCheck(),!args.feature)throw new Error("Missing argument: feature");this.deselectFeatures({features:[args.feature],onSuccess:args.onSuccess,onError:args.onError})},emp3.api.Map.prototype.deselectFeatures=function(args){if(args=args||{},this.readyCheck(),!args.features)throw new Error("Missing argument: features");var cmd={cmd:emp3.api.enums.channel.featureDeselectedBatch,features:args.features,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.deselectFeatures",args:args})},emp3.api.Map.prototype.selectFeature=function(args){if(args=args||{},this.readyCheck(),!args.feature)throw new Error("Missing argument: feature");this.selectFeatures({features:[args.feature],onSuccess:args.onSuccess,onError:args.onError})},emp3.api.Map.prototype.selectFeatures=function(args){if(args=args||{},this.readyCheck(),!args.features)throw new Error("Missing argument: features");var cmd={cmd:emp3.api.enums.channel.featureSelectedBatch,features:args.features,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.selectFeatures",args:args})},emp3.api.Map.prototype.clearSelected=function(){this.readyCheck();var cmd={cmd:emp3.api.enums.channel.featureDeselected,mapId:this.geoId};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{mapId:this.geoId,source:this,method:"Map.clearSelected",args:{}})},emp3.api.Map.prototype.setBackgroundBrightness=function(brightness){void 0===brightness&&(brightness=50),brightness>100?brightness=100:brightness<0&&(brightness=0);var cmd={cmd:emp3.api.enums.channel.config,brightness:brightness},callInfo={mapId:this.geoId,source:this,method:"Map.setBackgroundBrightness",args:{brightness:brightness}};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo),this.brightness=brightness},emp3.api.Map.prototype.clearContainer=function(args){args=args||{};var cmd={cmd:emp3.api.enums.channel.clearMap,overlay:this,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Map.clearContainer",args:args})},emp3.api.Map.prototype.getBackgroundBrightness=function(){return this.brightness},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Overlay=function(args){args=args||{},this.type="overlay",this.geoId=args.geoId||emp3.api.createGUID(),this.name=args.name||"untitled overlay",this.properties=args.properties||{}},emp3.api.Overlay.prototype=new emp3.api.Container,emp3.api.Overlay.prototype.addFeature=function(args){if(args=args||{},!args.feature)throw new Error("Missing argument: feature");Array.isArray(args.feature)?args.features=args.feature:args.features=[args.feature],this.addFeatures({features:args.features,visible:args.visible,onSuccess:args.onSuccess,onError:args.onError})},emp3.api.Overlay.prototype.addFeatures=function(args){var cmd;if(args=args||{},!args.features)throw new Error("Missing argument: features");if(!Array.isArray(args.features))throw new TypeError("Invalid Argument: expected features to be an array");args.features.length>0&&(cmd={cmd:emp3.api.enums.channel.plotFeature,overlayId:this.geoId,visible:args.visible,features:args.features,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.addFeatures",args:args}))},emp3.api.Overlay.prototype.addOverlay=function(args){if(args=args||{},!args.overlay)throw new Error("Missing argument: overlay");Array.isArray(args.overlay)?args.overlays=args.overlay:args.overlays=[args.overlay],this.addOverlays(args)},emp3.api.Overlay.prototype.addOverlays=function(args){var cmd;if(args=args||{},!args.overlays)throw new Error("Missing argument: overlays");if(!Array.isArray(args.overlays))throw new TypeError("Invalid Argument: expected overlays to be an array");cmd={cmd:emp3.api.enums.channel.createOverlay,overlays:args.overlays,parentId:this.geoId,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.addOverlays",args:args})},emp3.api.Overlay.prototype.apply=function(args){args=args||{};var cmd={cmd:emp3.api.enums.channel.updateOverlay,overlay:this,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.apply",args:args})},emp3.api.Overlay.prototype.getChildren=function(args){if(args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["overlay","feature"],select:["overlayId","featureId","name","properties","parentId"],filter:[{property:"parentId",term:this.geoId}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Overlay.getChildren",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Overlay.prototype.getFeatures=function(args){args=args||{};var cmd,includeVisibleFeaturesOnly=!1;if("function"!=typeof args.onSuccess)throw new Error("onSuccess argument is required, and must be a function.");"undefined"!=typeof args.includeVisibleFeaturesOnly&&null!==args.includeVisibleFeaturesOnly&&(includeVisibleFeaturesOnly=args.includeVisibleFeaturesOnly),cmd={cmd:emp3.api.enums.channel.get,recursive:!1,types:["feature"],select:["featureId","overlayId","parentId","name","properties","format","feature"],filter:[{property:"overlayId",term:this.geoId}],onSuccess:args.onSuccess,onError:args.onError},includeVisibleFeaturesOnly&&cmd.filter.push({property:"visible",term:!0}),emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.getFeatures",args:args})},emp3.api.Overlay.prototype.getOverlays=function(args){if(args=args||{},"function"!=typeof args.onSuccess)throw new Error("onSuccess argument is required, and must be a function.");var cmd={cmd:emp3.api.enums.channel.get,recursive:!1,types:["overlay"],select:["overlayId","parentId","name","properties"],filter:[{property:"parentId",term:this.geoId}],onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.getOverlays",args:args})},emp3.api.Overlay.prototype.removeFeature=function(args){if(args=args||{},!args.feature)throw new Error("Missing argument: feature");if(!(args.feature instanceof emp3.api.Feature))throw new TypeError("Invalid argument: expected feature to be of type emp3.api.Feature");args.features=[args.feature],this.removeFeatures(args)},emp3.api.Overlay.prototype.removeFeatures=function(args){if(args=args||{},!args.features&&!args.featureIds)throw new Error("missing argument: featureIds or features must be set");if(!Array.isArray(args.features))throw new TypeError("Invalid argument: featureId is not an array");var cmd={cmd:emp3.api.enums.channel.unplotFeatureBatch,overlayId:this.geoId,features:args.features,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.removeFeatures",args:args})},emp3.api.Overlay.prototype.removeOverlay=function(args){if(args=args||{},!args.overlay)throw new Error("Missing argument: overlay");if(!(args.overlay instanceof emp3.api.Overlay))throw new TypeError("Invalid argument: overlay should be of type emp3.api.Overlay");this.removeOverlays({overlays:[args.overlay],onSuccess:args.onSuccess||function(){},onError:args.onError||function(){}})},emp3.api.Overlay.prototype.removeOverlays=function(args){if(args=args||{},!args.overlays)throw new Error("Missing argument: overlays");if(!Array.isArray(args.overlays))throw new TypeError("Invalid argument: overlays is not an array");var cmd={cmd:emp3.api.enums.channel.removeOverlay,parentId:this.geoId,overlays:args.overlays,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.removeOverlays",args:args})},emp3.api.Overlay.prototype.clearContainer=function(args){args=args||{};var cmd={cmd:emp3.api.enums.channel.clearFeatures,overlay:this,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Overlay.clearContainer",args:args})},emp3.api.Overlay.prototype.getParents=function(args){if(args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["overlay"],select:["overlayId","name","properties","parentId"],filter:[{property:"childId",term:this.geoId}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Overlay.getParents",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},window.emp3||(window.emp3={}),window.emp3.api||(emp3.api={}),emp3.api.MapService=function(args){"undefined"==typeof args||null===args||"object"!=typeof args?args={name:"untitled map service",description:"",geoId:cmapi.randomUUID(),url:""}:("undefined"!=typeof args.name&&"string"==typeof args.name||(args.name="untitled map service"),"undefined"!=typeof args.description&&"string"==typeof args.description||(args.description=""),("undefined"==typeof args.geoId||"string"!=typeof args.geoId&&"number"!=typeof args.geoId)&&(args.geoId=cmapi.randomUUID()),"undefined"!=typeof args.url&&"string"==typeof args.url||(args.url=void 0));var _description=args.description;Object.defineProperty(this,"description",{enumerable:!0,get:function(){return _description},set:function(value){_description=value}});var _geoId=args.geoId;Object.defineProperty(this,"geoId",{enumerable:!0,get:function(){return _geoId},set:function(value){_geoId=value}});var _name=args.name;Object.defineProperty(this,"name",{enumerable:!0,get:function(){return _name},set:function(value){_name=value}});var _url=args.url;Object.defineProperty(this,"url",{enumerable:!0,get:function(){return _url},set:function(value){_url=value}});var _useProxy=args.useProxy;Object.defineProperty(this,"useProxy",{enumerable:!1,get:function(){return _useProxy},set:function(value){_useProxy=value}})},emp3.api.MapService.prototype.remove=function(args){if(!this.id||this.id.length<1)throw new Error("This layer does not have an ID. Has it been added to the map yet?");args=args||{};var cmd={cmd:emp3.api.channels.unplotFeature,feature:this,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"MapService.remove",args:args}),this.overlay=void 0},emp3.api.MapService.prototype.setVisible=function(args){if(args=args||{},!this.id||this.id.length<1)throw new Error("This layer does not have an ID. Has it been added to the map yet?");var visible=!0;"boolean"==typeof args.visible&&(visible=args.visible,this.properties.visible=args.visible);var cmd={cmd:visible?emp3.api.channels.showFeature:emp3.api.channels.hideFeature,layer:this,visible:visible,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Layer.setVisible",args:args})},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.WMS=function(args){"undefined"==typeof args||null===args||"object"!=typeof args?args={version:"1.3",transparent:!1,layers:[],tileFormat:"image/png"}:("undefined"!=typeof args.version&&"string"==typeof args.version||(args.version="1.3"),"undefined"!=typeof args.transparent&&"boolean"==typeof args.version||(args.transparent=!1),"undefined"!=typeof args.tileFormat&&"string"==typeof args.tileFormat||(args.tileFormat="image/png"),"undefined"!=typeof args.layers&&Array.isArray(args.layers)||("string"==typeof args.layers?args.layers=args.layers.split(","):args.layers=[])),emp3.api.MapService.call(this,args),Object.defineProperty(this,"format",{enumerable:!0,writable:!1,value:"wms"});var _version=args.version;Object.defineProperty(this,"version",{enumerable:!0,get:function(){return _version},set:function(value){_version=value}});var _layers=args.layers;Object.defineProperty(this,"layers",{enumerable:!0,get:function(){return _layers},set:function(value){_layers=value}});var _tileFormat=args.tileFormat;Object.defineProperty(this,"tileFormat",{enumerable:!0,get:function(){return _tileFormat},set:function(value){_tileFormat=value}});var _transparent=args.transparent;Object.defineProperty(this,"transparent",{enumerable:!0,get:function(){return _transparent},set:function(value){_transparent=value}})},emp3.api.WMS.prototype=new emp3.api.MapService({type:"wms",format:"wms",url:""}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.WMTS=function(args){"undefined"==typeof args||null===args||"object"!=typeof args?args={version:"1.0.0",tileFormat:"image/png",style:"default"}:("undefined"!=typeof args.version&&"string"==typeof args.version||(args.version="1.0.0"),"undefined"!=typeof args.tileFormat&&"string"==typeof args.tileFormat||(args.tileFormat="image/png"),"undefined"!=typeof args.style&&"string"==typeof args.style||(args.style="default")),emp3.api.MapService.call(this,args),Object.defineProperty(this,"format",{enumerable:!0,writable:!1,value:"wmts"});var _version=args.version;Object.defineProperty(this,"version",{enumerable:!0,get:function(){return _version},set:function(value){
_version=value}});var _style=args.style;Object.defineProperty(this,"style",{enumerable:!0,get:function(){return _style},set:function(value){_style=value}});var _tileFormat=args.tileFormat;Object.defineProperty(this,"tileFormat",{enumerable:!0,get:function(){return _tileFormat},set:function(value){_tileFormat=value}});var _layer=args.layer;Object.defineProperty(this,"layer",{enumerable:!0,get:function(){return _layer},set:function(value){_layer=value}});var _sampleDimensions=args.sampleDimensions;Object.defineProperty(this,"sampleDimensions",{enumerable:!0,get:function(){return _sampleDimensions},set:function(value){_sampleDimensions=value}})},emp3.api.WMS.prototype=new emp3.api.MapService({type:"wmts",format:"wmts",url:""}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.KMLLayer=function(args){args=args||{},emp3.api.MapService.call(this,args);var _kmlString=void 0===args.url?args.kmlString:void 0;Object.defineProperty(this,"kmlString",{enumerable:!0,get:function(){return _kmlString},set:function(value){_kmlString=value}}),Object.defineProperty(this,"format",{enumerable:!0,writable:!1,value:"kmlLayer"})},emp3.api.KMLLayer.prototype=Object.create(emp3.api.MapService.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Feature=function(args){var _featureType=null;if(cmapi.inherit(new cmapi.IGeoRenderable,this),args=args||{},this.type="Feature",this.data=args.data,this.properties=args.properties||{},this.readOnly=args.readOnly,args.position){if("number"==typeof args.position.latitude&&(args.position.latitude>90||args.position.latitude<-90))throw new Error("Invalid latitude: latitude must be between 90.0 and -90.0");if("number"==typeof args.position.longitude&&(args.position.longitude>180||args.position.longitude<-180))throw new Error("Invalid longitude: longitude must be between 180.0 and -180.0")}else if(args.positions)for(var coords=args.positions.length,idx=0;idx<coords;idx++){if(args.positions[idx].latitude>90||args.positions[idx].latitude<-90)throw new Error("Invalid latitude: latitude must be between 90.0 and -90.0");if(args.positions[idx].longitude>180||args.positions[idx].longitude<-180)throw new Error("Invalid longitude: longitude must be between 180.0 and -180.0")}Object.defineProperty(this,"featureType",{enumerable:!0,get:function(){return _featureType},set:function(value){_featureType=value}}),this.patchProps(args)},emp3.api.Feature.prototype=new emp3.api.Container,emp3.api.Feature.prototype.apply=function(){if(this.positions)for(var numPositions=this.positions.length,idx=0;idx<numPositions;idx++){if(this.positions[idx].latitude>90||this.positions[idx].latitude<-90)throw new Error("Invalid latitude: latitude must be between 90.0 and -90.0");if(this.positions[idx].longitude>180||this.positions[idx].longitude<-180)throw new Error("Invalid longitude: longitude must be between 180.0 and -180.0")}emp3.api.MessageHandler.getInstance().apply(this)},emp3.api.Feature.prototype.addFeature=function(args){if(args=args||{},!args.feature)throw new Error("Missing argument: feature");Array.isArray(args.feature)?args.features=args.feature:args.features=[args.feature],args.visible||(args.visible=!0),this.addFeatures(args)},emp3.api.Feature.prototype.addFeatures=function(args){var cmd;if(args=args||{},!args.features&&"[object Array]"===Object.prototype.toString.call(args.features))throw new Error("Missing argument: features");args.visible="boolean"!=typeof args.visible||args.visible,args.zoom="boolean"==typeof args.zoom&&args.zoom,args.features.length>0&&(cmd={cmd:emp3.api.enums.channel.plotFeature,parentId:this.geoId,features:args.features,visible:args.visible,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Feature.addFeatures",args:args}))},emp3.api.Feature.prototype.getChildFeatures=function(args){this.getChildren(args)},emp3.api.Feature.prototype.removeFeature=function(args){if(args=args||{},!args.feature)throw new Error("Missing argument: feature");Array.isArray(args.feature)?args.features=args.feature:args.features=[args.feature],this.removeFeatures(args)},emp3.api.Feature.prototype.removeFeatures=function(args){var cmd;if(args=args||{},!args.features||!Array.isArray(args.features))throw new Error("Missing argument: features");cmd={cmd:emp3.api.enums.channel.unplotFeatureBatch,parentId:this.geoId,features:args.features,onSuccess:args.onSuccess,onError:args.onError},emp3.api.MessageHandler.getInstance().sendMessage(cmd,{source:this,method:"Feature.removeFeatures",args:args})},emp3.api.Feature.prototype.clearContainer=function(args){args=args||{};var parent=this;this.getChildFeatures({onSuccess:function(cbArgs){var cmd={cmd:emp3.api.enums.channel.unplotFeatureBatch,features:cbArgs.features,parentId:parent.geoId,onSuccess:args.onSuccess,onError:args.onError};emp3.api.MessageHandler.getInstance().sendMessage(cmd,{method:"Feature.clearContainer",source:this,args:args})}.bind(this)})},emp3.api.Feature.prototype.getChildren=function(args){if(args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["feature"],select:["parentId","overlayId","name","properties"],filter:[{property:"parentId",term:this.geoId}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Feature.getChildren",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Feature.prototype.getParents=function(args){if(args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["overlay","feature"],select:["overlayId","featureId","name","properties","parentId"],filter:[{property:"childId",term:this.geoId}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Feature.getParents",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Feature.prototype.getParentFeatures=function(args){if(args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["feature"],select:["featureId","name","properties","parentId"],filter:[{property:"childId",term:this.geoId}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Feature.getParentFeatures",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},emp3.api.Feature.prototype.getParentOverlays=function(args){if(args=args||{},"undefined"==typeof args.onSuccess)throw new Error("Missing Argument: onSuccess");if("function"!=typeof args.onSuccess)throw new TypeError("Invalid Argument: expected onSuccess to be a function");var cmd={cmd:emp3.api.enums.channel.get,types:["overlay"],select:["overlayId","name","properties","parentId"],filter:[{property:"childId",term:this.geoId}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={method:"Feature.getParentOverlays",source:this,args:args};emp3.api.MessageHandler.getInstance().sendMessage(cmd,callInfo)},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.AirControlMeasure=function(args){args=args||{},cmapi.inherit(new cmapi.IGeoAirControlMeasure,this);var _acmType=cmapi.enums.acmType.CYLINDER;Object.defineProperty(this,"acmType",{enumerable:!0,get:function(){return _acmType},set:function(value){_acmType=value}});var _attributes=[{minAlt:1e4,maxAlt:2e4,radius:5e3}];Object.defineProperty(this,"attributes",{enumerable:!0,get:function(){return _attributes},set:function(value){if(!emp3.api.isArray(_attributes))throw new Error("Type Error: attributes is not an array of emp3.api.enums.IGeoAirControlMeasure.Attribute");_attributes=value}}),args.positions||(args.positions=[{latitude:0,longitude:0}]),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_ACM}),this.patchProps(args)},emp3.api.AirControlMeasure.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Point=function(args){cmapi.inherit(new cmapi.IGeoPoint,this),this.positions=[new cmapi.IGeoPosition],Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),"undefined"==typeof args||null===args||"object"!=typeof args?args={position:new emp3.api.GeoPosition({latitude:0,longitude:0})}:"undefined"!=typeof args.position&&null!==args.position&&"object"==typeof args.position||"undefined"!=typeof args.positions&&null!==args.positions?args.position&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new emp3.api.GeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new emp3.api.GeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new emp3.api.GeoPosition).altitude)):args.position=new emp3.api.GeoPosition({latitude:0,longitude:0}),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_POINT}),this.patchProps(args)},emp3.api.Point.prototype=new emp3.api.Feature,window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Polygon=function(args){if(cmapi.inherit(new cmapi.IGeoPolygon,this),"undefined"!=typeof args&&null!==args&&"object"==typeof args)if("undefined"!=typeof args.positions&&null!==args.positions&&Array.isArray(args.positions)){for(var badArgFound=!1,idx=0;idx<args.positions.length;idx++){if("undefined"!=typeof args.positions[idx].latitude&&"number"!=typeof args.positions[idx].latitude){badArgFound=!0;break}if("undefined"!=typeof args.positions[idx].longitude&&"number"!=typeof args.positions[idx].longitude){badArgFound=!0;break}if("undefined"!=typeof args.positions[idx].altitude&&"number"!=typeof args.positions[idx].altitude){badArgFound=!0;break}}badArgFound&&(args.positions=[])}else args.positions=[];else args={positions:[]};Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_POLYGON}),this.patchProps(args)},emp3.api.Polygon.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Polygon"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Circle=function(args){cmapi.inherit(new cmapi.IGeoCircle,this),args=args||{},void 0===args.position||null!==args.position&&"object"==typeof args.position?void 0!==args.position&&"object"==typeof args.position&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new cmapi.IGeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new cmapi.IGeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new cmapi.IGeoPosition).altitude)):args.position=new cmapi.IGeoPosition,"number"!=typeof args.radius&&(args.radius=(new cmapi.IGeoCircle).radius),this.positions=[new cmapi.IGeoPosition],Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE}),this.patchProps(args)},emp3.api.Circle.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point",symbolCode:emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Rectangle=function(args){cmapi.inherit(new cmapi.IGeoRectangle,this),this.positions=[new cmapi.IGeoPosition],Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),args=args||{},void 0===args.position||null!==args.position&&"object"==typeof args.position?void 0!==args.position&&"object"==typeof args.position&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new cmapi.IGeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new cmapi.IGeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new cmapi.IGeoPosition).altitude)):args.position=new cmapi.IGeoPosition,"number"!=typeof args.height&&(args.height=(new cmapi.IGeoRectangle).height),"number"!=typeof args.width&&(args.width=(new cmapi.IGeoRectangle).width),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE}),this.patchProps(args)},emp3.api.Rectangle.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point",symbolCode:emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Square=function(args){cmapi.inherit(new cmapi.IGeoSquare,this),this.positions=[new cmapi.IGeoPosition],Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),args=args||{},void 0===args.position||null!==args.position&&"object"==typeof args.position?void 0!==args.position&&"object"==typeof args.position&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new cmapi.IGeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new cmapi.IGeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new cmapi.IGeoPosition).altitude)):args.position=new cmapi.IGeoPosition,"number"!=typeof args.width&&(args.width=(new cmapi.IGeoSquare).width),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_SQUARE}),this.patchProps(args)},emp3.api.Square.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Text=function(args){cmapi.inherit(new cmapi.IGeoText,this);var _fontSize="";Object.defineProperty(this,"fontSize",{enumerable:!0,get:function(){return _fontSize},set:function(value){_fontSize=value}});var _fontFamily="";Object.defineProperty(this,"fontFamily",{enumerable:!0,get:function(){return _fontFamily},set:function(value){_fontFamily=value}});var _typeFaceStyle="";Object.defineProperty(this,"typeFaceStyle",{enumerable:!0,get:function(){return _typeFaceStyle},set:function(value){_typeFaceStyle=value}}),this.positions=[new cmapi.IGeoPosition],Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),args=args||{},void 0===args.position||null!==args.position&&"object"==typeof args.position?void 0!==args.position&&"object"==typeof args.position&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new cmapi.IGeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new cmapi.IGeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new cmapi.IGeoPosition).altitude)):args.position=new cmapi.IGeoPosition,"string"!=typeof args.text&&(args.text=""),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_TEXT}),this.patchProps(args)},emp3.api.Text.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Ellipse=function(args){cmapi.inherit(new cmapi.IGeoEllipse(args),this),this.positions=[new cmapi.IGeoPosition],Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),args=args||{},void 0===args.position||null!==args.position&&"object"==typeof args.position?void 0!==args.position&&"object"==typeof args.position&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new cmapi.IGeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new cmapi.IGeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new cmapi.IGeoPosition).altitude)):args.position=new cmapi.IGeoPosition,"number"!=typeof args.semiMajor&&(args.semiMajor=(new cmapi.IGeoEllipse).semiMajor),"number"!=typeof args.semiMinor&&(args.semiMinor=(new cmapi.IGeoEllipse).semiMinor),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE}),this.patchProps(args)},emp3.api.Ellipse.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Path=function(args){if(cmapi.inherit(new cmapi.IGeoPath,this),"undefined"==typeof args||null===args||"object"!=typeof args)args={positions:[],timeStamp:new Date,timeSpans:[]};else{if("undefined"!=typeof args.positions&&null!==args.positions&&Array.isArray(args.positions)){for(var badArgFound=!1,idx=0;idx<args.positions.length;idx++){if("undefined"!=typeof args.positions[idx].latitude&&"number"!=typeof args.positions[idx].latitude){badArgFound=!0;break}if("undefined"!=typeof args.positions[idx].longitude&&"number"!=typeof args.positions[idx].longitude){badArgFound=!0;break}if("undefined"!=typeof args.positions[idx].altitude&&"number"!=typeof args.positions[idx].altitude){badArgFound=!0;break}}badArgFound&&(args.positions=[])}else args.positions=[];"string"!=typeof args.timeStamp&&(args.timeStamp=new Date),"undefined"!=typeof args.timeSpans&&"object"==typeof args.timeSpans&&Array.isArray(args.timeSpans)||(args.timeSpans=[])}Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_PATH}),this.patchProps(args)},emp3.api.Path.prototype=new emp3.api.Feature({format:"geojson",data:{type:"LineString"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.KML=function(args){args=args||{},emp3.api.Feature.call(this,args);var _KMLString=args.KMLString;Object.defineProperty(this,"KMLString",{enumerable:!0,get:function(){return _KMLString},set:function(value){_KMLString=value}}),this.featureType=emp3.api.enums.FeatureTypeEnum.KML},emp3.api.KML.prototype=Object.create(emp3.api.Feature.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.GeoJSON=function(args){args=args||{},emp3.api.Feature.call(this,args);var _GeoJSONData=args.GeoJSONData;Object.defineProperty(this,"GeoJSONData",{enumerable:!0,get:function(){return _GeoJSONData},set:function(value){_GeoJSONData=value}}),this.featureType=emp3.api.enums.FeatureTypeEnum.GEOJSON},emp3.api.GeoJSON.prototype=Object.create(emp3.api.Feature.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.GeoPosition=function(args){if(args=args||{},cmapi.inherit(new cmapi.IGeoPosition,this),"number"!=typeof args.latitude)args.latitude=(new cmapi.IGeoPosition).latitude;else if(args.latitude>90||args.latitude<-90)throw new Error("Invalid latitude: latitude must be between 90.0 and -90.0");if("number"!=typeof args.longitude)args.longitude=(new cmapi.IGeoPosition).longitude;else if(args.longitude>180||args.longitude<-180)throw new Error("Invalid longitude: longitude must be between 180.0 and -90.0");"number"!=typeof args.altitude&&(args.altitude=(new cmapi.IGeoPosition).altitude),this.patchProps(args)},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.MilStdSymbol=function(args){cmapi.inherit(new cmapi.IGeoMilSymbol,this),"undefined"==typeof args||null===args||"object"!=typeof args?args={position:new emp3.api.GeoPosition({latitude:0,longitude:0})}:"undefined"!=typeof args.positions||"undefined"!=typeof args.position&&null!==args.position&&"object"==typeof args.position?args.hasOwnProperty("position")&&("number"!=typeof args.position.latitude&&(args.position.latitude=(new emp3.api.GeoPosition).latitude),"number"!=typeof args.position.longitude&&(args.position.longitude=(new emp3.api.GeoPosition).longitude),"number"!=typeof args.position.altitude&&(args.position.altitude=(new emp3.api.GeoPosition).altitude)):args.position=new emp3.api.GeoPosition({latitude:0,longitude:0}),this.positions=[new cmapi.IGeoPosition],args.hasOwnProperty("positions")&&(this.positions=args.positions),Object.defineProperty(this,"position",{enumerable:!0,get:function(){return this.positions[0]},set:function(value){this.positions[0]=value}}),Object.defineProperty(this,"featureType",{enumerable:!0,writable:!1,value:emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL}),this.patchProps(args)},emp3.api.MilStdSymbol.prototype=new emp3.api.Feature({format:"geojson",data:{type:"Point"}}),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.MessageHandler=function(){function joinDetails(details,originChannel){var i,len,features=[];switch(len=details.length,originChannel){case emp3.api.enums.channel.plotFeatureBatch:case emp3.api.enums.channel.unplotFeatureBatch:case emp3.api.enums.channel.featureSelectedBatch:case emp3.api.enums.channel.featureDeselectedBatch:for(i=0;i<len;i+=1)features=features.concat(details[i].features);details.features=features}return details}function PrivateConstructor(args){var environment,that=this;if(this.isEnvironmentReady=!1,this.messageCallbackHash=new emp3.api.Hash,this.statusRequestPendingList={about:[],format:[],view:[],selected:[],screenshot:[],initialization:[],coordinatesystem:[]},this.mapReadyCallback=[],this.eventListeners=[],this.mapWidgetName="CPCE Map",!args||!args.environment||args.container&&""!==args.container)environment=emp3.api.environment.browser;else switch(args.environment){case"starfish":case emp3.api.environment.starfish:environment=emp3.api.environment.starfish;break;case"owf":case emp3.api.environment.owf:environment=emp3.api.environment.owf;break;case"iwc":case emp3.api.environment.iwc:emp3.api.environment.iwc.iwcHost=args.iwcHost,environment=emp3.api.environment.iwc;break;default:environment=emp3.api.environment.browser}this.getEventListeners=function(){return this.eventListeners},this.addEventListener=function(args){var eventListeners,that=this;args.id&&(this.eventListeners[args.id]||(this.eventListeners[args.id]=[]),eventListeners=this.eventListeners[args.id],args.event&&(eventListeners[args.event]||(eventListeners[args.event]=[],args.event===emp3.api.enums.EventType.MAP_CURSOR_MOVE?environment.pubSub.subscribe({channel:emp3.api.enums.channel.mousemove,callback:that.handleMapCursorMove.bind(that)}):args.event===emp3.api.enums.EventType.MAP_VIEW_CHANGE&&environment.pubSub.subscribe({channel:emp3.api.enums.channel.statusView,callback:function(sender,msg){that.handleStatusView(sender,msg)}})),args.callback&&eventListeners[args.event].push(args.callback)))},this.removeEventListener=function(args){var eventListeners,eventListener,i;if(args.id&&args.callback&&args.event&&(eventListeners=this.eventListeners[args.id],eventListeners&&(eventListener=eventListeners[args.event]))){if(args.callback)for(i=0;i<eventListener.length;i++)eventListener[i]===args.callback&&eventListener.splice(i,1);else delete eventListeners[args.event];0===eventListener.length&&delete eventListeners[args.event]}},this.isAMapReady=function(){var mapId;for(mapId in mapHash.items)if(mapHash.items.hasOwnProperty(mapId)&&mapHash.items[mapId].status===emp3.api.enums.MapStateEnum.MAP_READY)return!0;return!1},this.sendMessage=function(message,callInfo){var transaction;if(callInfo.hasOwnProperty("map"))callInfo.map.status===emp3.api.enums.MapStateEnum.MAP_READY&&(transaction=this.publish(message,callInfo));else{if(!this.isAMapReady())throw new Error("There is no map engine available to publish messages to");transaction=this.publish(message,callInfo)}return transaction},this.publish=function(message,callInfo){var transactionId,transaction,returnedTransaction;transactionId=emp3.api.createGUID(),transaction={mapId:callInfo.mapId,transactionId:transactionId,callInfo:callInfo,source:callInfo.source,args:callInfo.args,data:message},message.onSuccess?transaction.onSuccess=message.onSuccess:transaction.onSuccess=function(){emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId)},message.onError?transaction.onError=message.onError:transaction.onError=function(){emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId)},message.completeCallback?transaction.completeCallback=message.completeCallback:transaction.completeCallback=function(){emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId)},message.cancelCallback?transaction.cancelCallback=message.cancelCallback:transaction.cancelCallback=function(){emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId)},message.startCallback&&(transaction.startCallback=message.startCallback),message.updateCallback&&(transaction.updateCallback=message.updateCallback),this.messageCallbackHash.setItem(transactionId,transaction);var payload=emp3.api.MessageFactory.constructPayload(message,callInfo,transactionId);if(payload)return validatePayload(payload,callInfo),payload.transaction();switch(message.cmd){case emp3.api.enums.channel.convert:this.convert(callInfo,message);break;case emp3.api.enums.channel.overlayClusterSet:this.overlayClusterSet(callInfo,message,transactionId);break;case emp3.api.enums.channel.overlayClusterActivate:this.overlayClusterActivate(callInfo,message,transactionId);break;case emp3.api.enums.channel.overlayClusterDeactivate:this.overlayClusterDeactivate(callInfo,message,transactionId);break;case emp3.api.enums.channel.overlayClusterRemove:this.overlayClusterRemove(callInfo,message,transactionId);break;case emp3.api.enums.channel.menuRemove:break;case emp3.api.enums.channel.menuSetVisible:break;case emp3.api.enums.channel.centerOnLocation:this.centerOnLocation(callInfo,message,transactionId);break;case emp3.api.enums.channel.centerOnBounds:this.centerOnBounds(callInfo,message,transactionId);break;case emp3.api.enums.channel.lookAtLocation:this.lookAtLocation(callInfo,message,transactionId);break;case emp3.api.enums.channel.featureEdit:returnedTransaction=this.featureEdit(callInfo,message,transactionId);break;case emp3.api.enums.channel.styleOverlay:this.styleOverlay(callInfo,message,transactionId);break;case emp3.api.enums.channel.zoom:this.zoom(callInfo,message,transactionId);break;case emp3.api.enums.channel.centerOnOverlay:this.centerOnOverlay(callInfo,message,transactionId);break;case emp3.api.enums.channel.centerOnFeature:this.centerOnFeature(callInfo,message,transactionId);break;case emp3.api.enums.channel.hideFeature:this.hideFeature(callInfo,message,transactionId);break;case emp3.api.enums.channel.showFeature:this.showFeature(callInfo,message,transactionId);break;case emp3.api.enums.channel.clearFeatures:this.clearFeatures(callInfo,message,transactionId);break;case emp3.api.enums.channel.statusRequest:this.statusRequest(callInfo,transaction,transactionId);break;case emp3.api.enums.channel.menuDrawingCreate:break;case emp3.api.enums.channel.menuDrawingRemove:break;case emp3.api.enums.channel.clearMap:this.clearMap(callInfo,message,transactionId);break;case emp3.api.enums.channel.lockView:this.lockView(callInfo,message);break;case emp3.api.enums.channel.get:this.get(callInfo,message,transactionId);break;case emp3.api.enums.channel.cancel:this.cancel(callInfo,message);break;case emp3.api.enums.channel.transactionComplete:this.complete(callInfo,message);break;case emp3.api.enums.channel.mapShutdown:this.mapShutdown(callInfo,message,transactionId);break;case emp3.api.enums.channel.getVisibility:this.getVisibility(callInfo,message,transactionId);break;case emp3.api.enums.channel.swap:this.mapSwap(callInfo,message,transactionId)}return returnedTransaction},this.validate=function(channel,message,callInfo){var tempArray,splitPayload,queuedMessage,publishData;if(channel!==emp3.api.enums.channel.plotFeatureBatch&&channel!==emp3.api.enums.channel.unplotFeatureBatch||(splitPayload=message.features.splice(0,500),tempArray=message.features,callInfo.remainingPayload=tempArray,callInfo.successes=[],callInfo.failures=[],message.features=splitPayload),publishData={channel:channel,message:message},callInfo.hasOwnProperty("mapId")&&"string"==typeof callInfo.mapId&&callInfo.mapId.length>0&&(publishData.dest={id:callInfo.mapId}),this.isEnvironmentReady){if(queue.length>0)for(;queue.length>0;)queuedMessage=queue.shift(),environment.pubSub.publish({dest:queuedMessage.sender,channel:queuedMessage.channel,message:queuedMessage.message});environment.pubSub.publish(publishData)}else queue.push(publishData)},this.getEnvironment=function(){return environment};var validatePayload=function(payload,callInfo){var queuedMessage,publishData,splitPayload,tempArray;if(payload.channel!==emp3.api.enums.channel.plotFeatureBatch&&payload.channel!==emp3.api.enums.channel.unplotFeatureBatch||(splitPayload=payload.payload.features.splice(0,500),tempArray=payload.payload.features,callInfo.remainingPayload=tempArray,callInfo.successes=[],callInfo.failures=[],payload.payload.features=splitPayload),publishData={channel:payload.channel,message:payload.payload},callInfo.hasOwnProperty("mapId")&&"string"==typeof callInfo.mapId&&callInfo.mapId.length>0&&(publishData.dest={id:callInfo.mapId}),this.isEnvironmentReady){if(queue.length>0)for(;queue.length>0;)queuedMessage=queue.shift(),environment.pubSub.publish({dest:queuedMessage.sender,channel:queuedMessage.channel,message:queuedMessage.message});environment.pubSub.publish(publishData)}else queue.push(publishData)}.bind(this);this.registerMap=function(map){mapHash.hasItem(map.geoId)||mapHash.setItem(map.geoId,map)},this.lookupMap=function(mapId){if(mapId&&"string"==typeof mapId)return mapHash.getItem(mapId)},this.unregisterMap=function(map){mapHash.removeItem(map.geoId)},this.notifyOnReady=function(message){function checkEnvReady(){that.isEnvironmentReady===!0?that.validate(emp3.api.enums.channel.statusRequest,payload,messageRef.callInfo):setTimeout(checkEnvReady,500)}var payload={},messageRef=message;message.args.onSuccess&&(payload.types=["initialization"],this.mapReadyCallback.push({onSuccess:message.args.onSuccess,onError:message.args.onError}),checkEnvReady())},this.spawnMap=function(args){var transaction,messageId=emp3.api.createGUID(),callInfo={};if(!args)throw new Error("Missing args.");if(!args.onSuccess)throw new Error("emp3.api.MessageHandler.spawnMap missing args: onSuccess");if(!args.onError)throw new Error("emp3.api.MessageHandler.spawnMap missing args: onError");if(!args.container,!args.map)throw new Error("emp3.api.MessageHandler.spawnMap missing args: map");if(!args.engine)throw new Error("emp3.api.MessageHandler.spawnMap missing args: engine");args.messageId=messageId,callInfo={source:this,method:"MessageHandler.spawnMap",args:args},callInfo.map=args.map,transaction={transactionId:messageId,callInfo:callInfo,source:args.map,args:callInfo.args,onSuccess:args.onSuccess,onError:args.onError},this.messageCallbackHash.setItem(messageId,transaction),environment.createInstance({containerId:args.container,messageId:messageId,extent:args.defaultExtent,engine:args.engine,farDistanceThreshold:args.farDistanceThreshold,midDistanceThreshold:args.midDistanceThreshold,brightness:args.brightness,recorder:args.recorder,environment:args.environment})},this.mapShutdown=function(callInfo,message,transactionId){mapHash.hasItem(callInfo.map.geoId)?"browser"===environment.name.toLowerCase()&&environment.destroyInstance({id:callInfo.map.geoId,messageId:transactionId}):(this.messageCallbackHash.removeItem(transactionId),message.onError({errorMessage:"Map with id "+callInfo.map.geoId+" does not exist.",callInfo:callInfo,source:callInfo.source,args:callInfo.args}))},this.handleMapShutdownTransactionComplete=function(callbacks){try{callbacks.onSuccess()}catch(err){console.error("onSuccess function generated an exception.\n  name:"+err.name+"\n  message:"+err.message+"\n  stack:"+err.stack);
}},this.handleGetVisibilityTransactionComplete=function(callbacks,details,failures){try{callbacks.onSuccess({target:callbacks.args.target,parent:callbacks.args.parent,visible:details.visible,failures:failures})}catch(err){console.error("onSuccess function generated an exception.\n  name:"+err.name+"\n  message:"+err.message+"\n  stack:"+err.stack)}},this.handleMapStatus=function(sender,msg){var payload,event,i,j,callbacks,callInfo,source,args,map,previousState,removeSuccess=!1;if(msg){if(payload="string"==typeof msg?JSON.parse(msg):msg,map=mapHash.getItem(sender.id),void 0===map&&(map=mapHash.getItem("broadcast"),void 0===map))return;if(previousState=map.getState(),map.status=emp3.api.convertStatusType(payload.status),map.engineId=payload.engineId,map&&this.eventListeners[map.geoId]&&this.eventListeners[map.geoId][emp3.api.enums.EventType.MAP_STATE_CHANGE])for(callbacks=this.eventListeners[map.geoId][emp3.api.enums.EventType.MAP_STATE_CHANGE],event=new emp3.api.events.MapStateChangeEvent({event:emp3.api.enums.MapEventEnum.STATE_CHANGE,target:map,previousState:previousState}),i=0;i<callbacks.length;i++)try{callbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}switch(map.status){case emp3.api.enums.MapStateEnum.MAP_READY:for(emp3.api.enums.defaultOverlayId.WMS=payload.defaultWMSOverlayId,emp3.api.enums.defaultOverlayId.Layers=payload.defaultLayerOverlayId,i=0;i<this.mapReadyCallback.length;i+=1)if(callInfo=this.mapReadyCallback[i].callInfo,source=this.mapReadyCallback[i].source,args=this.mapReadyCallback[i].args,sender.id===source.geoId||"broadcast"===source.geoId){try{this.mapReadyCallback[i].onSuccess()}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}removeSuccess=!0;break}removeSuccess&&this.mapReadyCallback.splice(i,1);break;case emp3.api.enums.MapStateEnum.SHUTDOWN:for(i in this.eventListeners[map.geoId])for(j in this.eventListeners[map.geoId][i])map.removeEventListener({eventType:i,callback:this.eventListeners[map.geoId][i][j]});this.unregisterMap(map);break;case"mapInstanceInitFailed":for(i=0;i<this.mapReadyCallback.length;i+=1)if(callInfo=this.mapReadyCallback[i].callInfo,source=this.mapReadyCallback[i].source,args=this.mapReadyCallback[i].args,sender.id===source.geoId){this.mapReadyCallback[i].onError({source:source,callInfo:callInfo,args:args,failures:payload.failures}),this.mapReadyCallback.splice(i,1);break}}}},this.handleMapConvert=function(callbacks,details){switch(callbacks.callInfo.method){case"Map.getLatLonFromXY":try{callbacks.onSuccess({lat:details.y,lon:details.x,invalid:details.invalid})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}break;case"Map.getXYFromLatLon":try{callbacks.onSuccess({x:details.x,y:details.y,invalid:details.invalid})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}},this.handleMessageProgress=function(sender,msg){var oMessage,oDetails,sOriginalChannel,transactionId;if(void 0!==msg&&null!==msg)switch(oMessage="string"==typeof msg?JSON.parse(msg):msg,sOriginalChannel=oMessage.originatingChannel,oDetails=oMessage.details,transactionId=oMessage.messageId,sOriginalChannel){case emp3.api.enums.channel.featureEdit:this.handleEdit(sender,oDetails,transactionId);break;case emp3.api.enums.channel.draw:this.handleDraw(sender,oDetails,transactionId);break;default:return}},this.generateFeatureAddEvents=function(sender,payload){var parentId,details,parentInfo,i,j,event={};for(details=Array.isArray(payload.details.features)?payload.details.features:[payload.details.features],i=0;i<details.length;i+=1)if(parentInfo=details[i].parentInfo,parentInfo&&(parentId=parentInfo.featureId||parentInfo.overlayId),parentId&&this.eventListeners[parentId]&&this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]){if(event[parentId]=event[parentId]||{},!event[parentId].callbacks){if(event[parentId].callbacks=this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER],parentInfo.hasOwnProperty("featureId")){switch(event[parentId].target={geoId:parentInfo.featureId,name:parentInfo.name,type:parentInfo.format,properties:parentInfo.properties,description:parentInfo.description},event[parentId].target.type){case emp3.api.enums.FeatureTypeEnum.KML:event[parentId].target.KMLString=parentInfo.feature;break;case emp3.api.enums.FeatureTypeEnum.GEOJSON:event[parentId].target.GeoJSONData=parentInfo.feature;break;default:event[parentId].target.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(parentInfo.feature)}event[parentId].target.type===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(event[parentId].target.symbolCode=parentInfo.feature.symbolCode),event[parentId].target=emp3.api.buildFeature(event[parentId].target)}else event[parentId].target=emp3.api.buildOverlay({geoId:parentId,name:parentInfo.name,dataProviderId:parentInfo.dataProviderId,description:parentInfo.description,properties:parentInfo.properties,children:parentInfo.children,readOnly:parentInfo.properties.readOnly});event[parentId].affectedChildren=[],event[parentId].containerEvent=new emp3.api.events.ContainerEvent({event:emp3.api.enums.ContainerEventEnum.OBJECT_ADDED,target:event[parentId].target,affectedChildren:event[parentId].affectedChildren})}switch(event[parentId].affectedChild={geoId:details[i].featureId,name:details[i].name,type:details[i].format,properties:details[i].properties,description:details[i].description},event[parentId].affectedChild.type){case emp3.api.enums.FeatureTypeEnum.KML:event[parentId].affectedChild.KMLString=details[i].feature;break;case emp3.api.enums.FeatureTypeEnum.GEOJSON:event[parentId].affectedChild.GeoJSONData=details[i].feature;break;default:event[parentId].affectedChild.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(details[i].feature)}event[parentId].affectedChild.type===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(event[parentId].affectedChild.symbolCode=details[i].feature.symbolCode),event[parentId].affectedChildren.push(emp3.api.buildFeature(event[parentId].affectedChild))}for(i in event)for(j=0;j<event[i].callbacks.length;j+=1)try{event[i].callbacks[j](event[i].containerEvent)}catch(e){console.error("Event callback generated an exception. "+e.message)}},this.generateFeatureDeletedEvents=function(sender,payload){var parentId,details,parentInfo,i,j,event={};for(details=Array.isArray(payload.details.features)?payload.details.features:[payload.details.features],i=0;i<details.length;i+=1)if(parentInfo=details[i].parentInfo,parentInfo&&(parentId=parentInfo.featureId||parentInfo.overlayId),parentId&&this.eventListeners[parentId]&&this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]){if(event[parentId]=event[parentId]||{},!event[parentId].callbacks){if(event[parentId].callbacks=this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER],parentInfo.hasOwnProperty("featureId")){switch(event[parentId].target={geoId:parentInfo.featureId,name:parentInfo.name,type:parentInfo.format,properties:parentInfo.properties,description:parentInfo.description},event[parentId].target.type){case emp3.api.enums.FeatureTypeEnum.KML:event[parentId].target.KMLString=parentInfo.feature;break;case emp3.api.enums.FeatureTypeEnum.GEOJSON:event[parentId].target.GeoJSONData=parentInfo.feature;break;default:event[parentId].target.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(parentInfo.feature)}event[parentId].target.type===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(event[parentId].target.symbolCode=parentInfo.feature.symbolCode),event[parentId].target=emp3.api.buildFeature(event[parentId].target)}else event[parentId].target=emp3.api.buildOverlay({geoId:parentId,name:parentInfo.name,dataProviderId:parentInfo.dataProviderId,description:parentInfo.description,properties:parentInfo.properties,children:parentInfo.children,readOnly:parentInfo.properties.readOnly});event[parentId].affectedChildren=[],event[parentId].containerEvent=new emp3.api.events.ContainerEvent({event:emp3.api.enums.ContainerEventEnum.OBJECT_REMOVED,target:event[parentId].target,affectedChildren:event[parentId].affectedChildren})}switch(event[parentId].affectedChild={geoId:details[i].featureId,name:details[i].name,type:details[i].format,properties:details[i].properties,description:details[i].description},event[parentId].affectedChild.type){case emp3.api.enums.FeatureTypeEnum.KML:event[parentId].affectedChild.KMLString=details[i].feature;break;case emp3.api.enums.FeatureTypeEnum.GEOJSON:event[parentId].affectedChild.GeoJSONData=details[i].feature;break;default:event[parentId].affectedChild.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(details[i].feature)}event[parentId].affectedChild.type===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&(event[parentId].affectedChild.symbolCode=details[i].feature.symbolCode),event[parentId].affectedChildren.push(emp3.api.buildFeature(event[parentId].affectedChild))}for(i in event)for(j=0;j<event[i].callbacks.length;j+=1)try{event[i].callbacks[j](event[i].containerEvent)}catch(e){console.error("Event callback generated an exception. "+e.message)}},this.generateOverlayUpdatedEvents=function(callbacks){var i,j,overlay,event,eventHandlers,overlays=[];for(callbacks.data.overlay?overlays=[callbacks.data.overlay]:callbacks.data.overlays&&(overlays=callbacks.data.overlays),i=0;i<overlays.length;i++)if(overlay=overlays[i],this.eventListeners[overlay.geoId]&&(eventHandlers=this.eventListeners[overlay.geoId][emp3.api.enums.EventType.OVERLAY_CHANGE]),eventHandlers)for(event=new emp3.api.events.OverlayUpdatedEvent({target:overlay}),j=0;j<eventHandlers.length;j++)try{eventHandlers[j](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}},this.generateOverlayAddEvents=function(sender,payload){var parentId,details,parentInfo,i,j,event={};for(details=Array.isArray(payload.details)?payload.details:[payload.details],i=0;i<details.length;i+=1)parentId=details[i].parentId,parentId&&this.eventListeners[parentId]&&this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]&&(event[parentId]=event[parentId]||{},event[parentId].callbacks||(event[parentId].callbacks=this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER],parentId===sender.id?event[parentId].target=mapHash.getItem(parentId):(parentInfo=details[i].parentInfo,event[parentId].target=emp3.api.buildOverlay({geoId:parentId,name:parentInfo.name,dataProviderId:parentInfo.dataProviderId,description:parentInfo.description,properties:parentInfo.properties,children:parentInfo.children,readOnly:parentInfo.properties.readOnly})),event[parentId].affectedChildren=[],event[parentId].containerEvent=new emp3.api.events.ContainerEvent({event:emp3.api.enums.ContainerEventEnum.OBJECT_ADDED,target:event[parentId].target,affectedChildren:event[parentId].affectedChildren})),event[parentId].affectedChildren.push(emp3.api.buildOverlay({geoId:details[i].overlayId,name:details[i].name,dataProviderId:details[i].dataProviderId,description:details[i].description,properties:details[i].properties,children:details[i].children,readOnly:details[i].properties.readOnly})));for(i in event)for(j=0;j<event[i].callbacks.length;j+=1)try{event[i].callbacks[j](event[i].containerEvent)}catch(e){console.error("Event callback generated an exception. "+e.message)}},this.generateOverlayDeletedEvents=function(sender,payload){var parentId,details,parentInfo,i,j,event={};for(details=Array.isArray(payload.details)?payload.details:[payload.details],i=0;i<details.length;i+=1)parentId=details[i].parentId,parentId&&this.eventListeners[parentId]&&this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]&&(event[parentId]=event[parentId]||{},event[parentId].callbacks||(event[parentId].callbacks=this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER],parentId===sender.id?event[parentId].target=mapHash.getItem(parentId):(parentInfo=details[i].parentInfo,event[parentId].target=emp3.api.buildOverlay({geoId:parentId,name:parentInfo.name,dataProviderId:parentInfo.dataProviderId,description:parentInfo.description,properties:parentInfo.properties,children:parentInfo.children,readOnly:parentInfo.properties.readOnly})),event[parentId].affectedChildren=[],event[parentId].containerEvent=new emp3.api.events.ContainerEvent({event:emp3.api.enums.ContainerEventEnum.OBJECT_REMOVED,target:event[parentId].target,affectedChildren:event[parentId].affectedChildren})),event[parentId].affectedChildren.push(emp3.api.buildOverlay({geoId:details[i].overlayId,name:details[i].name,dataProviderId:details[i].dataProviderId,description:details[i].description,properties:details[i].properties,children:details[i].children,readOnly:details[i].properties.readOnly})));for(i in event)for(j=0;j<event[i].callbacks.length;j+=1)try{event[i].callbacks[j](event[i].containerEvent)}catch(e){console.error("Event callback generated an exception. "+e.message)}},this.generateVisibilityEvent=function(sender,payload){var map,parentTargetAttributes,parentContainer,targetAttributes,targetContainer,visibilityState,visibilityEvent,i,j,containers=payload.details,callbacks=[];for(sender.id&&(map=mapHash.getItem(sender.id),this.eventListeners[sender.id]&&this.eventListeners[sender.id][emp3.api.enums.EventType.VISIBILITY]&&callbacks.push(this.eventListeners[sender.id][emp3.api.enums.EventType.VISIBILITY])),i=0;i<containers.length;i+=1){if(visibilityState=containers[i].visibilityState,parentTargetAttributes=containers[i].parentTargetAttributes,targetAttributes=containers[i].targetAttributes,null!==parentTargetAttributes)switch(parentTargetAttributes.globalType){case"overlay":parentTargetAttributes.geoId=parentTargetAttributes.overlayId,parentTargetAttributes.properties.hasOwnProperty("readOnly")&&(parentTargetAttributes.readOnly=parentTargetAttributes.properties.readOnly,delete parentTargetAttributes.properties.readOnly),parentContainer=emp3.api.buildOverlay(parentTargetAttributes);break;case"feature":parentTargetAttributes.geoId=parentTargetAttributes.featureId,parentTargetAttributes.type=parentTargetAttributes.format,parentTargetAttributes.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(parentTargetAttributes.data),parentContainer=emp3.api.buildFeature(parentTargetAttributes)}else parentContainer=map;switch(targetAttributes.globalType){case"overlay":targetAttributes.geoId=targetAttributes.overlayId,targetAttributes.properties.hasOwnProperty("readOnly")&&(targetAttributes.readOnly=targetAttributes.properties.readOnly,delete targetAttributes.properties.readOnly),targetContainer=emp3.api.buildOverlay(targetAttributes);break;case"feature":targetAttributes.geoId=targetAttributes.featureId,targetAttributes.type=targetAttributes.format,targetAttributes.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(targetAttributes.data),targetContainer=emp3.api.buildFeature(targetAttributes)}if(this.eventListeners[targetAttributes.geoId]&&this.eventListeners[targetAttributes.geoId][emp3.api.enums.EventType.VISIBILITY]&&callbacks.push(this.eventListeners[targetAttributes.geoId][emp3.api.enums.EventType.VISIBILITY]),visibilityEvent=new emp3.api.events.VisibilityEvent({event:visibilityState,target:targetContainer,parent:parentContainer,map:map}),callbacks.length>0)for(callbacks=2===callbacks.length?callbacks.concat(callbacks.shift(),callbacks.shift()):callbacks.concat(callbacks,callbacks.shift()),j=callbacks.length;j>0;j-=1)callbacks.shift()(visibilityEvent)}},this.handleTransactionComplete=function(sender,msg){var payload,transactionId,callbacks,eventArgs,originChannel,failures,details,drawEventCallbacks,editEventCallbacks,i,event,handleCallback=!1;if(void 0===msg||null===msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,originChannel=payload.originatingChannel,transactionId=payload.messageId,payload.failures&&(failures=payload.failures),payload.details&&(details=payload.details),callbacks=this.messageCallbackHash.getItem(transactionId),payload.status===emp3.api.enums.messageCompletionStatus.CANCELLED){if(originChannel===emp3.api.enums.channel.draw||originChannel===emp3.api.enums.channel.featureEdit&&sender&&sender.id)switch(eventArgs=this.handleCancel(sender,payload),originChannel){case emp3.api.enums.channel.draw:if(drawEventCallbacks=this.eventListeners[sender.id]?this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_DRAW]:null)for(event=new emp3.api.events.FeatureDrawEvent({event:emp3.api.enums.FeatureDrawEventEnum.DRAW_CANCELLED,target:eventArgs.feature,map:eventArgs.map}),i=0;i<drawEventCallbacks.length;i+=1)try{drawEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}break;case emp3.api.enums.channel.featureEdit:if(editEventCallbacks=this.eventListeners[sender.id]?this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_EDIT]:null)for(event=new emp3.api.events.FeatureEditEvent({event:emp3.api.enums.FeatureEditEventEnum.EDIT_CANCELLED,target:eventArgs.feature,map:eventArgs.map}),i=0;i<editEventCallbacks.length;i+=1)try{editEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}}}else if(payload.status!==emp3.api.enums.messageCompletionStatus.FAILURE)switch(originChannel){case emp3.api.enums.channel.plotFeature:case emp3.api.enums.channel.plotFeatureBatch:this.generateFeatureAddEvents(sender,payload);break;case emp3.api.enums.channel.unplotFeature:case emp3.api.enums.channel.unplotFeatureBatch:this.generateFeatureDeletedEvents(sender,payload);break;case emp3.api.enums.channel.createOverlay:this.generateOverlayAddEvents(sender,payload);break;case emp3.api.enums.channel.removeOverlay:this.generateOverlayDeletedEvents(sender,payload);break;case emp3.api.enums.channel.updateOverlay:this.generateOverlayUpdatedEvents(callbacks);break;case emp3.api.enums.channel.hideFeature:case emp3.api.enums.channel.showFeature:case emp3.api.enums.channel.hideOverlay:case emp3.api.enums.channel.showOverlay:this.generateVisibilityEvent(sender,payload);break;case emp3.api.enums.channel.featureDeselected:case emp3.api.enums.channel.featureDeselectedBatch:this.manageDeselection(sender,payload);break;case emp3.api.enums.channel.featureSelected:case emp3.api.enums.channel.featureSelectedBatch:this.manageSelection(sender,payload);break;case emp3.api.enums.channel.freehandDrawStart:case emp3.api.enums.channel.freehandDrawExit:this.handleFreehand(sender,msg)}if(callbacks){if(callbacks.callInfo&&callbacks.callInfo.remainingPayload)if(callbacks.callInfo.failures=callbacks.callInfo.failures.concat(failures),callbacks.callInfo.successes=callbacks.callInfo.successes.concat(details),(originChannel===emp3.api.enums.channel.plotFeatureBatch||originChannel===emp3.api.enums.channel.unplotFeatureBatch)&&callbacks.callInfo.remainingPayload.length>0){var splitPayload=callbacks.callInfo.remainingPayload.splice(0,500),msgPayload={messageId:callbacks.transactionId,features:splitPayload};environment.pubSub.publish({channel:originChannel,message:msgPayload})}else originChannel!==emp3.api.enums.channel.plotFeatureBatch&&originChannel!==emp3.api.enums.channel.unplotFeatureBatch||0!==callbacks.callInfo.remainingPayload.length||(payload.details=joinDetails(callbacks.callInfo.successes,originChannel),callbacks.callInfo.failures=callbacks.callInfo.failures.concat(failures),handleCallback=!0);else handleCallback=!0;if(handleCallback)if(this.messageCallbackHash.removeItem(transactionId),payload.status===emp3.api.enums.messageCompletionStatus.FAILURE&&originChannel!==emp3.api.enums.channel.draw&&originChannel!==emp3.api.enums.channel.featureEdit)try{callbacks.onError({callInfo:callbacks.callInfo,source:callbacks.source,args:callbacks.args,errorMessage:failures[0].message})}catch(e){console.error("onError function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}else if(originChannel){var broker=emp3.api.ResponseBrokerFactory.getBroker(originChannel);if(broker){try{broker.process(callbacks,payload.details,failures)}catch(err){console.error("Callback function generated an exception.\n  name:"+err.name+"\n  message:"+err.message+"\n  stack:"+err.stack)}return}switch(originChannel){case emp3.api.enums.channel.centerOnBounds:this.handleCenterOnBoundsTransactionComplete(callbacks,payload.details);break;case emp3.api.enums.channel.zoom:this.handleZoomTransactionComplete(callbacks,payload.details);break;case emp3.api.enums.channel.centerOnFeature:this.handleCenterOnFeatureTransactionComplete(callbacks,payload.details);break;case emp3.api.enums.channel.centerOnLocation:this.handleCenterOnLocationTransactionComplete(callbacks,payload.details);break;case emp3.api.enums.channel.lookAtLocation:this.handleLookAtLocationTransactionComplete(callbacks,payload.details);break;case emp3.api.enums.channel.draw:case emp3.api.enums.channel.featureEdit:this.handleDrawEditTransactionComplete(callbacks,payload,failures);break;case emp3.api.enums.channel.convert:this.handleMapConvert(callbacks,payload.details);break;case emp3.api.enums.channel.mapShutdown:this.handleMapShutdownTransactionComplete(callbacks);break;case emp3.api.enums.channel.getVisibility:this.handleGetVisibilityTransactionComplete(callbacks,payload.details,failures);break;case emp3.api.enums.channel.setVisibility:try{callbacks.onSuccess({failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}break;default:try{callbacks.onSuccess()}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}}else try{callbacks.onSuccess({id:sender.id})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}},this.handleError=function(sender,msg){var payload,transactionId,callbacks,i;if(void 0===msg||null===msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,void 0===payload.sender||null===payload.sender||void 0===payload.type||null===payload.type||void 0===payload.msg||null===payload.msg)throw new Error(missingParameterError);if(payload.sender===environment.sender.id){if(Array.isArray(payload.msg)){for(i=0;i<payload.msg.length;i+=1)if(void 0!==payload.msg[i].transactionId&&null!==payload.msg[i].transactionId){transactionId=payload.msg[i].transactionId,callbacks=this.messageCallbackHash.getItem(transactionId),void 0!==callbacks&&null!==callbacks&&(this.messageCallbackHash.removeItem(transactionId),callbacks.onError({callInfo:callbacks.callInfo,source:callbacks.source,args:callbacks.args,errorMessage:payload.error}));break}}else void 0!==payload.msg.transactionId&&null!==payload.msg.transactionId&&(transactionId=payload.msg.transactionId,callbacks=this.messageCallbackHash.getItem(transactionId),void 0!==callbacks&&null!==callbacks&&(callbacks.onError({callInfo:callbacks.callInfo,source:callbacks.source,args:callbacks.args,errorMessage:payload.error}),this.messageCallbackHash.removeItem(transactionId)));window.hasOwnProperty("console")&&(console.error(payload.error),console.info(msg))}},this.handleStatusView=function(sender,msg){var payload,map,camera,lookAt,mapViewCallbacks,cameraCallbacks,lookAtCallbacks,executeCallbacks,cameraEvent,lookAtEvent,mapViewEvent,extent;if(sender&&sender.id&&(payload="string"==typeof msg?JSON.parse(msg):msg,map=mapHash.getItem(sender.id),extent={north:payload.bounds.northEast.lat,west:payload.bounds.southWest.lon,south:payload.bounds.southWest.lat,east:payload.bounds.northEast.lon,range:payload.range,altitude:payload.altitude,scale:payload.scale,centerLat:payload.center.lat,centerLon:payload.center.lon,roll:payload.roll,heading:payload.heading,tilt:payload.tilt},map&&(map.bounds=extent,camera=map.getCamera(),camera||(camera=new emp3.api.Camera,emp3.api.CameraManager.setCameraForMap({camera:camera,map:map})),camera.latitude=extent.centerLat,camera.longitude=extent.centerLon,camera.altitude=extent.altitude,camera.roll=extent.roll,camera.tilt=extent.tilt,camera.heading=extent.heading,lookAt=map.getLookAt(),lookAt||(lookAt=new emp3.api.LookAt,emp3.api.LookAtManager.setLookAtForMap({lookAt:lookAt,map:map})),lookAt.latitude=payload.lookAt.latitude,lookAt.longitude=payload.lookAt.longitude,lookAt.altitude=payload.lookAt.altitude,lookAt.range=payload.lookAt.range,lookAt.tilt=payload.lookAt.tilt,lookAt.heading=payload.lookAt.heading,lookAt.altitudeMode=cmapi.enums.altitudeMode.CLAMP_TO_GROUND),this.eventListeners[sender.id])){if(executeCallbacks=function(args){for(var i=0;i<args.callbacksArray.length;i+=1)try{args.callbacksArray[i](args.event)}catch(e){console.error("Event callback generated an exception. "+e.message)}},camera=map.getCamera(),cameraEvent=new emp3.api.events.CameraEvent({event:0!==payload.animate?emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION:emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED,target:camera}),mapViewEvent=new emp3.api.events.MapViewChangeEvent({event:payload.animate||emp3.api.enums.MapViewEventEnum.VIEW_MOTION_STOPPED,target:map}),mapViewCallbacks=this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_VIEW_CHANGE],cameraCallbacks=this.eventListeners[sender.id][emp3.api.enums.EventType.CAMERA_EVENT],mapViewCallbacks)try{executeCallbacks({callbacksArray:mapViewCallbacks,event:mapViewEvent})}catch(e){console.error("Event callback generated an exception. "+e.message)}if(cameraCallbacks)try{executeCallbacks({callbacksArray:cameraCallbacks,event:cameraEvent})}catch(e){console.error("Event callback generated an exception. "+e.message)}if(lookAtCallbacks)try{executeCallbacks({callbacksArray:lookAtCallbacks,event:lookAtEvent})}catch(e){console.error("Event callback generated an exception. "+e.message)}}},this.handleStatusAboutResponse=function(sender,msg){var payload,callbacks;if(void 0===msg||null===msg)throw new Error(missingMessageError);for(payload="string"==typeof msg?JSON.parse(msg):msg;this.statusRequestPendingList.about.length>0;){if(callbacks=this.statusRequestPendingList.about[0],void 0!==callbacks&&null!==callbacks&&"function"==typeof callbacks.onSuccess)try{callbacks.onSuccess(payload)}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}this.statusRequestPendingList.about.splice(0,1)}},this.handleStatusFormatResponse=function(sender,msg){var payload,callbacks;if(void 0===msg||null===msg)throw new Error(missingMessageError);for(payload="string"==typeof msg?JSON.parse(msg):msg;this.statusRequestPendingList.format.length>0;){if(callbacks=this.statusRequestPendingList.format[0],void 0!==callbacks&&null!==callbacks&&"function"==typeof callbacks.onSuccess)try{callbacks.onSuccess(payload)}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}this.statusRequestPendingList.format.splice(0,1)}},this.handleStatusScreenshot=function(sender,msg){var payload,callbacks;if(void 0===msg||null===msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,this.statusRequestPendingList.screenshot.length>0){if(callbacks=this.statusRequestPendingList.screenshot[0],void 0!==callbacks&&null!==callbacks&&"function"==typeof callbacks.onSuccess)try{callbacks.onSuccess({dataUrl:payload.dataUrl})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}this.statusRequestPendingList.screenshot.splice(0,1)}},this.handleOverlaysStatus=function(sender,msg){var payload,transactionId,map,overlays,overlayArray,callbacks;if(void 0===msg||null===msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,void 0!==payload.overlays&&null!==payload.overlay&&(overlays=payload.overlays),void 0!==payload.messageId&&null!==payload.messageId&&(transactionId=payload.messageId,callbacks=this.messageCallbackHash.getItem(transactionId),void 0!==callbacks&&null!==callbacks)){map=callbacks.source,map.overlays={},overlayArray=[],overlayArray=this.buildOverlayArray(overlays,overlayArray,map);try{callbacks.onSuccess({overlays:overlayArray})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}this.messageCallbackHash.removeItem(transactionId)}},this.buildOverlayArray=function(overlays,overlayArray,map){var overlayId,obj,overlay;for(overlayId in overlays)overlays.hasOwnProperty(overlayId)&&(overlay=overlays[overlayId],obj=new emp3.api.Overlay({id:overlay.id,name:overlay.name,parentId:overlay.parentId,owner:overlay.owner,description:overlay.description,iconUrl:overlay.iconUrl,isVisible:overlay.visible,permissions:{readonly:overlay.readonly},map:map}),map.overlays[overlay.id]=obj,overlayArray.push(obj),overlay.children&&(overlayArray=this.buildOverlayArray(overlay.children,overlayArray,map)));return overlayArray},this.handleOverlayStatus=function(sender,msg){var payload,transactionId,map,overlay,callbacks;if(void 0===msg||null===msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,void 0!==payload.messageId&&null!==payload.messageId&&(transactionId=payload.messageId,callbacks=this.messageCallbackHash.getItem(transactionId),void 0!==callbacks&&null!==callbacks)){map=callbacks.source,overlay=new emp3.api.Overlay({id:payload.id,name:payload.name,owner:payload.owner,isVisible:payload.isVisible,permissions:{readonly:payload.readonly},map:map}),overlay.parentId=payload.parentId;try{callbacks.onSuccess({overlay:overlay})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}this.messageCallbackHash.removeItem(transactionId)}},this.handleStatusSelected=function(sender,msg){var callbacks,args,selectedFeature,payload,i,transactionId,feature;if(!msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,payload&&(transactionId=payload.messageId,callbacks=this.messageCallbackHash.getItem(transactionId))){switch(args={failures:payload.failures},callbacks.callInfo.method){case"Map.getSelected":for(args.features=[],i=0;i<payload.selectedFeatures.length;i++)selectedFeature=payload.selectedFeatures[i],feature=emp3.api.buildFeature({type:selectedFeature.properties.featureType,geoId:selectedFeature.featureId,name:selectedFeature.name,coordinates:emp3.api.convertLocationArrayToCMAPI(selectedFeature.feature.coordinates),properties:selectedFeature.properties}),args.features.push(feature)}if("function"==typeof callbacks.onSuccess)try{callbacks.onSuccess(args)}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}},this.handleCancel=function(sender,message){var messageId,callbacks,args={};return messageId=message.messageId,callbacks=this.messageCallbackHash.getItem(messageId),args.map=mapHash.getItem(sender.id),callbacks&&(args.feature=callbacks.data.feature,callbacks.cancelCallback&&callbacks.cancelCallback(args)),args},this.handleDraw=function(sender,message,messageId){var eventArgs,event,i,drawEventCallbacks;if(message&&message.status&&sender&&sender.id)switch(drawEventCallbacks=this.eventListeners[sender.id]?this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_DRAW]:null,message.status){case emp3.api.enums.FeatureDrawEventEnum.DRAW_START:if(eventArgs=this.handleStart(sender,message,messageId),drawEventCallbacks)for(event=new emp3.api.events.FeatureDrawEvent({event:emp3.api.enums.FeatureDrawEventEnum.DRAW_START,target:eventArgs.feature,map:eventArgs.map}),i=0;i<drawEventCallbacks.length;i+=1)try{drawEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}break;case emp3.api.enums.FeatureDrawEventEnum.DRAW_UPDATE:if(eventArgs=this.handleUpdate(sender,message,messageId),
drawEventCallbacks)for(event=new emp3.api.events.FeatureDrawEvent({event:emp3.api.enums.FeatureDrawEventEnum.DRAW_UPDATE,target:eventArgs.feature,map:eventArgs.map,updateList:eventArgs.updateList}),i=0;i<drawEventCallbacks.length;i+=1)try{drawEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}break;case emp3.api.enums.FeatureDrawEventEnum.DRAW_COMPLETE:if(eventArgs=this.handleComplete(sender,message,messageId),drawEventCallbacks)for(event=new emp3.api.events.FeatureDrawEvent({event:emp3.api.enums.FeatureDrawEventEnum.DRAW_COMPLETE,target:eventArgs.feature,map:eventArgs.map}),i=0;i<drawEventCallbacks.length;i+=1)try{drawEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}}},this.handleStart=function(sender,message,messageId){var callbacks,args={};return callbacks=this.messageCallbackHash.getItem(messageId),args.map=mapHash.getItem(sender.id),message.properties&&message.properties.featureType&&message.feature&&(args.feature=emp3.api.buildFeature({type:message.properties.featureType,geoId:message.featureId,name:message.name,coordinates:emp3.api.convertGeoJsonToCMAPIPositions(message.feature),properties:message.properties})),callbacks&&callbacks.startCallback&&callbacks.startCallback(args),args},this.handleUpdate=function(sender,message,messageId){var callbacks,args={};return callbacks=this.messageCallbackHash.getItem(messageId),args.map=mapHash.getItem(sender.id),args.updateList=[],message.updates&&(message.properties&&message.properties.featureType&&(args.feature=emp3.api.buildFeature({type:message.properties.featureType,geoId:message.featureId,name:message.name,coordinates:emp3.api.convertLocationArrayToCMAPI(message.updates.coordinates),properties:message.properties})),args.updateList.push({changedAttribute:void 0,changedModifier:void 0,coordinateIndexes:message.updates.indices,updateType:message.updates.type})),callbacks&&callbacks.updateCallback&&callbacks.updateCallback(args),args},this.handleComplete=function(sender,message,messageId){var callbacks,args={};return callbacks=this.messageCallbackHash.getItem(messageId),args.map=mapHash.getItem(sender.id),message.updates&&message.properties&&message.properties.featureType&&(args.feature=emp3.api.buildFeature({type:message.properties.featureType,geoId:message.featureId,name:message.name,coordinates:emp3.api.convertLocationArrayToCMAPI(message.updates.coordinates),properties:message.properties})),callbacks&&callbacks.completeCallback&&callbacks.completeCallback(args),args},this.handleEdit=function(sender,message,messageId){var eventArgs,event,i,editEventCallbacks;if(message&&message.status&&sender&&sender.id)switch(editEventCallbacks=this.eventListeners[sender.id]?this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_EDIT]:null,message.status){case emp3.api.enums.FeatureEditEventEnum.EDIT_START:if(eventArgs=this.handleStart(sender,message,messageId),editEventCallbacks)for(event=new emp3.api.events.FeatureEditEvent({event:emp3.api.enums.FeatureEditEventEnum.EDIT_START,target:eventArgs.feature,map:eventArgs.map}),i=0;i<editEventCallbacks.length;i+=1)try{editEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}break;case emp3.api.enums.FeatureEditEventEnum.EDIT_UPDATE:if(eventArgs=this.handleUpdate(sender,message,messageId),editEventCallbacks)for(event=new emp3.api.events.FeatureEditEvent({event:emp3.api.enums.FeatureEditEventEnum.EDIT_UPDATE,target:eventArgs.feature,map:eventArgs.map,updateList:eventArgs.updateList}),i=0;i<editEventCallbacks.length;i+=1)try{editEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}break;case emp3.api.enums.FeatureEditEventEnum.EDIT_COMPLETE:if(eventArgs=this.handleComplete(sender,message,messageId),editEventCallbacks)for(event=new emp3.api.events.FeatureEditEvent({event:emp3.api.enums.FeatureEditEventEnum.EDIT_COMPLETE,target:eventArgs.feature,map:eventArgs.map}),i=0;i<editEventCallbacks.length;i+=1)try{editEventCallbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}}},this.handleMapCursorMove=function(sender,msg){var callbacks,payload,i,mapCursorMoveEvent={},keys=[];if(sender.id&&this.eventListeners[sender.id]&&(callbacks=this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_CURSOR_MOVE],callbacks&&void 0!==msg&&null!==msg)){payload="string"==typeof msg?JSON.parse(msg):msg,mapCursorMoveEvent.type=emp3.api.enums.EventType.MAP_CURSOR_MOVE,mapCursorMoveEvent.event=emp3.api.enums.UserInteractionEventEnum.MOUSE_MOVE,mapCursorMoveEvent.target=mapHash.getItem(sender.id),mapCursorMoveEvent.point={x:payload.clientX,y:payload.clientY},mapCursorMoveEvent.position={latitude:payload.latitude,longitude:payload.longitude,altitude:payload.altitude};for(i in payload.keys)switch(payload.keys[i]){case"ctrl":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.CTRL);break;case"shift":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.SHIFT);break;case"alt":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.ALT)}for(mapCursorMoveEvent.keys=keys,i=0;i<callbacks.length;i+=1)try{callbacks[i](mapCursorMoveEvent)}catch(e){console.error("Event callback generated an exception. "+e.message)}}},this.handleMapClick=function(sender,msg){var keys,clickType,event,payload,callbacks,i;if(void 0===msg||null===msg)throw new Error(missingMessageError);payload="string"==typeof msg?JSON.parse(msg):msg,keys=[];for(i in payload.keys)switch(payload.keys[i]){case"ctrl":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.CTRL);break;case"shift":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.SHIFT);break;case"alt":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.ALT)}switch(payload.type){case"single":clickType=emp3.api.enums.UserInteractionEventEnum.CLICKED;break;case"double":clickType=emp3.api.enums.UserInteractionEventEnum.DOUBLE_CLICKED;break;case"mouseDown":clickType=emp3.api.enums.UserInteractionEventEnum.MOUSE_DOWN;break;case"mouseUp":clickType=emp3.api.enums.UserInteractionEventEnum.MOUSE_UP;break;case"drag":clickType=emp3.api.enums.UserInteractionEventEnum.DRAG;break;case"dragComplete":clickType=emp3.api.enums.UserInteractionEventEnum.DRAG_COMPLETE;break;default:clickType=payload.type}switch(payload.button){case"left":payload.button=emp3.api.enums.UserInteractionMouseButtonEventEnum.LEFT;break;case"right":payload.button=emp3.api.enums.UserInteractionMouseButtonEventEnum.RIGHT;break;case"middle":payload.button=emp3.api.enums.UserInteractionMouseButtonEventEnum.MIDDLE}if(sender.id&&this.eventListeners[sender.id]&&(callbacks=this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_INTERACTION],event=new emp3.api.events.MapUserInteractionEvent({event:clickType,target:mapHash.getItem(sender.id),point:{x:payload.clientX,y:payload.clientY},position:new emp3.api.GeoPosition({latitude:payload.lat,longitude:payload.lon,altitude:payload.alt}),button:payload.button,keys:keys}),callbacks))for(i=0;i<callbacks.length;i+=1)try{callbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}},this.handleFeatureClick=function(sender,msg){var event,keys,clickType,payload,feature,callbacks,i,features=[];if(void 0===msg||null===msg)throw new Error(missingMessageError);payload="string"==typeof msg?JSON.parse(msg):msg,keys=[];for(i in payload.keys)switch(payload.keys[i]){case"ctrl":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.CTRL);break;case"shift":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.SHIFT);break;case"alt":keys.push(emp3.api.enums.UserInteractionKeyEventEnum.ALT)}switch(payload.type){case"single":clickType=emp3.api.enums.UserInteractionEventEnum.CLICKED;break;case"double":clickType=emp3.api.enums.UserInteractionEventEnum.DOUBLE_CLICKED;break;case"mouseDown":clickType=emp3.api.enums.UserInteractionEventEnum.MOUSE_DOWN;break;case"mouseUp":clickType=emp3.api.enums.UserInteractionEventEnum.MOUSE_UP;break;case"drag":clickType=emp3.api.enums.UserInteractionEventEnum.DRAG;break;case"dragComplete":clickType=emp3.api.enums.UserInteractionEventEnum.DRAG_COMPLETE;break;default:clickType=payload.type}switch(payload.button){case"left":payload.button=emp3.api.enums.UserInteractionMouseButtonEventEnum.LEFT;break;case"right":payload.button=emp3.api.enums.UserInteractionMouseButtonEventEnum.RIGHT;break;case"middle":payload.button=emp3.api.enums.UserInteractionMouseButtonEventEnum.MIDDLE;break;default:payload.button=payload.button}if(sender.id&&this.eventListeners[sender.id]&&(callbacks=this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_INTERACTION])){if("[object Array]"===Object.prototype.toString.call(payload))for(i=0;i<payload.length;i+=1)feature=emp3.api.buildFeature({type:payload[i].format,geoId:payload[i].featureId,name:payload[i].name,coordinates:emp3.api.convertGeoJsonToCMAPIPositions(payload[i].feature),properties:payload[i].properties,symbolCode:payload[i].feature.symbolCode}),features.push(feature);else feature=emp3.api.buildFeature({type:payload.format,geoId:payload.featureId,name:payload.name,coordinates:emp3.api.convertGeoJsonToCMAPIPositions(payload.feature),properties:payload.properties,symbolCode:payload.feature.symbolCode}),features.push(feature);for(event=new emp3.api.events.FeatureUserInteractionEvent({event:clickType,target:features,point:{x:payload.clientX,y:payload.clientY},position:new emp3.api.GeoPosition({latitude:payload.lat,longitude:payload.lon,altitude:payload.alt}),map:mapHash.getItem(sender.id),button:payload.button,keys:keys}),i=0;i<callbacks.length;i+=1)try{callbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}}},this.handleConvertResponse=function(sender,msg){var callbacks;if(msg){var payload="string"==typeof msg?JSON.parse(msg):msg;if(callbacks=this.messageCallbackHash.getItem(msg.messageId))try{callbacks.onSuccess({x:payload.x,y:payload.y})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}},this.handleDrawEditTransactionComplete=function(callbacks,payload,failures){failures&&failures.length>0&&payload.status!==emp3.api.enums.messageCompletionStatus.CANCELLED&&callbacks.onError({callInfo:callbacks.callInfo,source:callbacks.source,args:callbacks.args,errorMessage:failures[0].message})},this.handleCenterOnLocationTransactionComplete=function(callbacks,details){try{"Map.setCamera"===callbacks.callInfo.method&&callbacks.onSuccess({camera:new emp3.api.Camera({geoId:callbacks.callInfo.args.camera.geoId,name:callbacks.callInfo.args.camera.name,latitude:details.center.lat,longitude:details.center.lon,altitude:details.range,tilt:details.tilt,roll:details.roll,heading:details.heading})})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},this.handleCenterOnFeatureTransactionComplete=function(callbacks,details){try{callbacks.onSuccess({centerLat:details.center.lat,centerLon:details.center.lon,north:details.bounds.northEast.lat,east:details.bounds.northEast.lon,south:details.bounds.southWest.lat,west:details.bounds.southWest.lon,range:details.range})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},this.handleCenterOnBoundsTransactionComplete=function(callbacks,details){try{callbacks.onSuccess({centerLat:details.center.lat,centerLon:details.center.lon,north:details.bounds.northEast.lat,east:details.bounds.northEast.lon,south:details.bounds.southWest.lat,west:details.bounds.southWest.lon,range:details.range})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},this.handleLookAtLocationTransactionComplete=function(callbacks,details){try{callbacks.onSuccess({latitude:details.latitude,longitude:details.longitude,altitude:details.altitude,altitudeMode:details.altitudeMode,range:details.range,tilt:details.tilt,heading:details.heading})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},this.handleZoomTransactionComplete=function(callbacks,details){try{callbacks.onSuccess({centerLat:details.center.lat,centerLon:details.center.lon,north:details.bounds.northEast.lat,east:details.bounds.northEast.lon,south:details.bounds.southWest.lat,west:details.bounds.southWest.lon,range:details.range})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},this.convert=function(callInfo,message){return emp.environment.browser.mediator.publishSynch({mapId:callInfo.mapId,message:message})},this.overlayClusterSet=function(callInfo,message,transactionId){var payload;"Overlay.clusterSet"===callInfo.method&&(payload={overlayId:callInfo.args.overlay.id,threshold:callInfo.args.cluster.threshold,distance:callInfo.args.cluster.distance,clusterStyle:callInfo.args.cluster.clusterStyle,messageId:transactionId}),this.validate(emp3.api.enums.channel.overlayClusterSet,payload)},this.overlayClusterActivate=function(callInfo,message,transactionId){var payload;"Overlay.clusterActivate"===callInfo.method&&(payload={overlayId:callInfo.args.overlay.id,messageId:transactionId}),this.validate(emp3.api.enums.channel.overlayClusterActivate,payload)},this.overlayClusterDeactivate=function(callInfo,message,transactionId){var payload;"Overlay.clusterDeactivate"===callInfo.method&&(payload={overlayId:callInfo.args.overlay.id,messageId:transactionId}),this.validate(emp3.api.enums.channel.overlayClusterDeactivate,payload)},this.overlayClusterRemove=function(callInfo,message,transactionId){var payload;"Overlay.clusterRemove"===callInfo.method&&(payload={overlayId:callInfo.args.overlay.id,messageId:transactionId}),this.validate(emp3.api.enums.channel.overlayClusterRemove,payload)},this.featureEdit=function(callInfo,message,transactionId){var payload;return payload={featureId:message.feature.geoId,messageId:transactionId},this.validate(emp3.api.enums.channel.featureEdit,payload,callInfo),new emp3.api.Transaction({id:transactionId,mapId:callInfo.mapId,geoId:message.feature.geoId})},this.centerOnBounds=function(callInfo,message,transactionId){var payload,bounds,southWest,northEast,zoom;bounds={},southWest={},northEast={},northEast.lat=message.north,southWest.lon=message.west,southWest.lat=message.south,northEast.lon=message.east,bounds.southWest=southWest,bounds.northEast=northEast,zoom=message.range||"auto",payload={bounds:bounds,zoom:zoom,animate:message.animate,messageId:transactionId},this.validate(emp3.api.enums.channel.centerOnBounds,payload,callInfo)},this.centerOnLocation=function(callInfo,message,transactionId){var payload;payload={location:{lat:message.camera.latitude,lon:message.camera.longitude},zoom:message.camera.altitude,altitudeMode:message.camera.altitudeMode,heading:message.camera.heading,tilt:message.camera.tilt,roll:message.camera.roll,animate:message.animate,messageId:transactionId},this.validate(emp3.api.enums.channel.centerOnLocation,payload,callInfo)},this.lookAtLocation=function(callInfo,message,transactionId){var payload={messageId:transactionId,animate:message.animate,range:message.lookAt.range,tilt:message.lookAt.tilt,heading:message.lookAt.heading,latitude:message.lookAt.latitude,longitude:message.lookAt.longitude,altitude:message.lookAt.altitude,altitudeMode:message.lookAt.altitudeMode};this.validate(emp3.api.enums.channel.lookAtLocation,payload,callInfo)},this.styleOverlay=function(callInfo,message,transactionId){var multiPointStyle,pointStyle,lineStyle,polygonStyle,payload={};switch(callInfo.method){case"styleMultiPoints":payload.properties={},void 0!==message.multiPointStyle.mark.fill&&(payload.properties.fillColor=message.multiPointStyle.mark.fill.color),void 0!==message.multiPointStyle.mark.stroke&&(payload.properties.lineColor=message.multiPointStyle.mark.stroke.color,payload.properties.lineWidth=message.multiPointStyle.mark.stroke.width),void 0!==message.multiPointStyle.mark.wellKnownName&&(payload.properties.iconUrl=message.multiPointStyle.mark.wellKnownName),void 0!==message.multiPointStyle.mark.graphicHeight&&(payload.properties.graphicHeight=message.multiPointStyle.mark.graphicHeight),void 0!==message.multiPointStyle.mark.graphicWidth&&(payload.properties.graphicWidth=message.multiPointStyle.mark.graphicWidth),payload.type="multigeometry",payload.messageId=transactionId,payload.overlayId=message.overlayId;break;case"stylePolygons":payload.properties={},void 0!==message.polygonStyle.mark.fill&&(payload.properties.fillColor=message.polygonStyle.mark.fill.color),void 0!==message.polygonStyle.mark.stroke&&(payload.properties.lineColor=message.polygonStyle.mark.stroke.color,payload.properties.lineWidth=message.polygonStyle.mark.stroke.width),void 0!==message.polygonStyle.mark.wellKnownName&&(payload.properties.iconUrl=message.polygonStyle.mark.wellKnownName),payload.type="polygon",payload.messageId=transactionId,payload.overlayId=message.overlayId;break;case"styleLines":payload.properties={},void 0!==message.lineStyle.mark.fill&&(payload.properties.fillColor=message.lineStyle.mark.fill.color),void 0!==message.lineStyle.mark.stroke&&(payload.properties.lineColor=message.lineStyle.mark.stroke.color,payload.properties.lineWidth=message.lineStyle.mark.stroke.width),void 0!==message.lineStyle.mark.wellKnownName&&(payload.properties.iconUrl=message.lineStyle.mark.wellKnownName),payload.type="line",payload.messageId=transactionId,payload.overlayId=message.overlayId;break;case"stylePoints":payload.properties={},void 0!==message.pointStyle.mark.fill&&(payload.properties.fillColor=message.pointStyle.mark.fill.color),void 0!==message.pointStyle.mark.stroke&&(payload.properties.lineColor=message.pointStyle.mark.stroke.color,payload.properties.lineWidth=message.pointStyle.mark.stroke.width),void 0!==message.pointStyle.mark.wellKnownName&&(payload.properties.iconUrl=message.pointStyle.mark.wellKnownName),void 0!==message.pointStyle.mark.graphicHeight&&(payload.properties.graphicHeight=message.pointStyle.mark.graphicHeight),void 0!==message.pointStyle.mark.graphicWidth&&(payload.properties.graphicWidth=message.pointStyle.mark.graphicWidth),payload.type="point",payload.messageId=transactionId,payload.overlayId=message.overlayId;break;case"styleOverlay":payload=[],multiPointStyle={},multiPointStyle.properties={},pointStyle={},pointStyle.properties={},lineStyle={},lineStyle.properties={},polygonStyle={},polygonStyle.properties={},void 0!==message.pointStyle.mark.fill&&(pointStyle.properties.fillColor=message.pointStyle.mark.fill.color),void 0!==message.pointStyle.mark.stroke&&(pointStyle.properties.lineColor=message.pointStyle.mark.stroke.color,pointStyle.properties.lineWidth=message.pointStyle.mark.stroke.width),void 0!==message.pointStyle.mark.wellKnownName&&(pointStyle.properties.iconUrl=message.pointStyle.mark.wellKnownName),void 0!==message.pointStyle.mark.graphicHeight&&(pointStyle.properties.graphicHeight=message.pointStyle.mark.graphicHeight),void 0!==message.pointStyle.mark.graphicWidth&&(pointStyle.properties.graphicWidth=message.pointStyle.mark.graphicWidth),pointStyle.type="point",pointStyle.overlayId=message.overlayId,void 0!==message.multiPointStyle.mark.fill&&(multiPointStyle.properties.fillColor=message.multiPointStyle.mark.fill.color),void 0!==message.multiPointStyle.mark.stroke&&(multiPointStyle.properties.lineColor=message.multiPointStyle.mark.stroke.color,multiPointStyle.properties.lineWidth=message.multiPointStyle.mark.stroke.width),void 0!==message.multiPointStyle.mark.wellKnownName&&(multiPointStyle.properties.iconUrl=message.multiPointStyle.mark.wellKnownName),multiPointStyle.type="multigeometry",multiPointStyle.overlayId=message.overlayId,void 0!==message.lineStyle.mark.fill&&(lineStyle.properties.fillColor=message.lineStyle.mark.fill.color),void 0!==message.lineStyle.mark.stroke&&(lineStyle.properties.lineColor=message.lineStyle.mark.stroke.color,lineStyle.properties.lineWidth=message.lineStyle.mark.stroke.width),void 0!==message.lineStyle.mark.wellKnownName&&(lineStyle.properties.iconUrl=message.lineStyle.mark.wellKnownName),lineStyle.type="line",lineStyle.overlayId=message.overlayId,void 0!==message.polygonStyle.mark.fill&&(polygonStyle.properties.fillColor=message.polygonStyle.mark.fill.color),void 0!==message.polygonStyle.mark.stroke&&(polygonStyle.properties.lineColor=message.polygonStyle.mark.stroke.color,polygonStyle.properties.lineWidth=message.polygonStyle.mark.stroke.width),void 0!==message.polygonStyle.mark.wellKnownName&&(polygonStyle.properties.iconUrl=message.polygonStyle.mark.wellKnownName),polygonStyle.type="polygon",polygonStyle.overlayId=message.overlayId,pointStyle.messageId=transactionId,lineStyle.messageId=transactionId,polygonStyle.messageId=transactionId,multiPointStyle.messageId=transactionId,payload.push(pointStyle),payload.push(lineStyle),payload.push(polygonStyle),payload.push(multiPointStyle)}this.validate(emp3.api.enums.channel.styleOverlay,payload,callInfo)},this.zoom=function(callInfo,message,transactionId){var payload,range;void 0!==message.altitude&&(range=message.altitude),payload={range:range,messageId:transactionId},this.validate(emp3.api.enums.channel.zoom,payload,callInfo)},this.centerOnOverlay=function(callInfo,message,transactionId){var payload;payload={overlayId:message.overlayId,zoom:message.range||"auto",messageId:transactionId},this.validate(emp3.api.enums.channel.centerOnOverlay,payload,callInfo)},this.centerOnFeature=function(callInfo,message,transactionId){var payload,multiPayload=[];if(message.featureIds){for(var i=0;i<message.featureIds.length;i+=1)payload={featureId:message.featureIds[i],zoom:message.range||"auto",messageId:transactionId},multiPayload.push(payload);this.validate(emp3.api.enums.channel.centerOnFeature,multiPayload,callInfo)}else payload={featureId:message.featureId,zoom:message.range||"auto",messageId:transactionId},this.validate(emp3.api.enums.channel.centerOnFeature,payload,callInfo)},this.hideFeature=function(callInfo,message,transactionId){var payload,i;for(payload=[],i=0;i<message.features.length;i+=1)payload.push({featureId:message.features[i],overlayId:message.parent||emp.constant.parentIds.ALL_PARENTS,messageId:transactionId});this.validate(emp3.api.enums.channel.hideFeature,payload,callInfo)},this.showFeature=function(callInfo,message,transactionId){var payload,i;for(payload=[],i=0;i<message.features.length;i+=1)payload.push({featureId:message.features[i],overlayId:message.parent||emp.constant.parentIds.ALL_PARENTS,messageId:transactionId});this.validate(emp3.api.enums.channel.showFeature,payload,callInfo)},this.statusRequest=function(callInfo,transaction,transactionId){var payload;switch(transaction.callInfo.method){case"Map.getScreenshot":payload={types:["screenshot"],messageId:transactionId},this.statusRequestPendingList.screenshot.push(transaction)}this.validate(emp3.api.enums.channel.statusRequest,payload,callInfo)},this.isSelected=function(mapId,featureId){var selected=!1;return selectionHash[mapId]&&selectionHash[mapId][featureId]&&(selected=!0),selected},this.getSelected=function(mapId){var featureId,selected=[];if(selectionHash[mapId])for(featureId in selectionHash[mapId])selected.push(selectionHash[mapId][featureId]);return selected},this.get=function(callInfo,message,transactionId){var payload;payload={types:message.types,recursive:message.recursive,select:message.select,filter:message.filter,messageId:transactionId},this.validate(emp3.api.enums.channel.get,payload,callInfo)},this.manageSelection=function(sender,msg){var mapId,payload,featureId,feature;if(sender&&sender.id&&msg){payload="string"==typeof msg?JSON.parse(msg):msg,mapId=sender.id,selectionHash[mapId]||(selectionHash[mapId]=[]);for(var i=0,len=payload.details.features.length;i<len;i++)featureId=payload.details.features[i].featureId,feature=emp3.api.buildFeature({type:payload.details.features[i].properties.featureType,geoId:payload.details.features[i].featureId,name:payload.details.features[i].name,coordinates:emp3.api.convertGeoJsonToCMAPIPositions(payload.details.features[i].feature),properties:payload.details.features[i].properties,symbolCode:payload.details.features[i].symbolCode}),featureId&&feature&&(selectionHash[mapId][featureId]||(selectionHash[mapId][featureId]=feature))}},this.manageDeselection=function(sender,msg){var mapId,payload,featureIds=[];if(sender&&sender.id&&msg&&(payload="string"==typeof msg?JSON.parse(msg):msg,mapId=sender.id,payload.details&&payload.details.features)){for(var i=0,len=payload.details.features.length;i<len;i++)featureIds.push(payload.details.features[i].featureId);this.removeSelection(mapId,featureIds)}},this.removeSelection=function(mapId,featureIds){var featureId,features;if(selectionHash[mapId])for(var i=0,len=featureIds.length;i<len;i++)featureId=featureIds[i],features=selectionHash[mapId],features[featureId]&&delete features[featureId]},this.setDrawCallbackHash=function(args){drawListenerCallbackHash.setItem(args.overlayId,{startDrawCallback:args.startDrawCallback,drawCallback:args.drawCallback,completeDrawCallback:args.completeDrawCallback,cancelDrawCallback:args.cancelDrawCallback,errorDrawCallback:args.errorDrawCallback})},this.clearMap=function(callInfo,message,transactionId){var payload;payload={messageId:transactionId},this.validate(emp3.api.enums.channel.updateFeature,payload,callInfo)},this.clearFeatures=function(callInfo,message,transactionId){var payload;payload={overlayId:message.overlay.geoId,messageId:transactionId},this.validate(emp3.api.enums.channel.clearFeatures,payload,callInfo)},this.hasChildren=function(container){if(!container||!container.geoId)return!1;var publishData={message:{cmd:"Container.hasChildren",container:container}},rc=environment.pubSub.publishSync(publishData);return rc.hasChildren},this.getVisibility=function(callInfo,message,transactionId){var payload;payload={targetId:message.target.geoId,parentId:message.parent?message.parent.geoId:void 0,messageId:transactionId},this.validate(emp3.api.enums.channel.getVisibility,payload,callInfo)},this.mapSwap=function(callInfo,message,transactionId){var payload;payload={mapId:callInfo.mapId,engine:message.engine,messageId:transactionId},this.validate(emp3.api.enums.channel.swap,payload,callInfo)},this.lockView=function(callInfo,message){return emp.environment.browser.mediator.publishSynch({mapId:callInfo.mapId,message:message})},this.cancel=function(callInfo,message){var payload;message&&message.transaction&&message.transaction.id&&(payload={messageId:message.transaction.id}),this.validate(emp3.api.enums.channel.cancel,payload,callInfo)},this.complete=function(callInfo,message){var payload;message&&message.transaction&&message.transaction.id&&(payload={messageId:message.transaction.id}),this.validate(emp3.api.enums.channel.transactionComplete,payload,callInfo)},this.apply=function(feature){var payload,that,convertedFeature=emp3.api.convertFeatureToGeoJSON(feature),properties=emp3.api.getProperties(feature),timeElapsedSinceLastUpdate=Date.now()-updateTime;payload={overlayId:emp.constant.parentIds.ALL_PARENTS,featureId:feature.geoId,format:feature.featureType,feature:convertedFeature,name:feature.name,readOnly:feature.readOnly,properties:properties},updates.push(payload),updateTimer&&timeElapsedSinceLastUpdate<100&&updates.length<500&&clearTimeout(updateTimer),updateTime=Date.now(),that=this,updateTimer=setTimeout(function(){that.validate(emp3.api.enums.channel.plotFeature,updates,{}),updates=[]},50)},this.handleFeatureAdd=function(sender,msg){this.handleFeatureEvent(emp3.api.enums.EventType.MAP_FEATURE_ADDED,sender,msg)},this.handleFeatureUpdate=function(sender,msg){this.handleFeatureEvent(emp3.api.enums.EventType.MAP_FEATURE_UPDATED,sender,msg)},this.handleFeatureRemove=function(sender,msg){this.handleFeatureEvent(emp3.api.enums.EventType.MAP_FEATURE_REMOVED,sender,msg)},this.handleFeatureEvent=function(eventType,sender,msg){var payload,cmapiFeature,feature,callbacks,i,len,myevent,features=[],featureIds=[];if(void 0===msg||null===msg)throw new Error(missingMessageError);if(sender.id&&this.eventListeners[sender.id]&&(callbacks=this.eventListeners[sender.id][eventType])){if(payload="string"==typeof msg?JSON.parse(msg):msg,payload.features)for(i=0,len=payload.features.length;i<len;i++)if(cmapiFeature=payload.features[i],cmapiFeature.properties&&cmapiFeature.properties.featureType){switch(feature={type:cmapiFeature.properties.featureType,geoId:cmapiFeature.featureId,name:cmapiFeature.name,properties:cmapiFeature.properties,symbolCode:cmapiFeature.symbolCode},feature.type){case emp3.api.enums.FeatureTypeEnum.KML:feature.KMLString=cmapiFeature.feature;break;default:feature.coordinates=emp3.api.convertGeoJsonToCMAPIPositions(cmapiFeature.feature)}feature=emp3.api.buildFeature(feature),feature&&(features.push(feature),featureIds.push(feature.geoId))}for(eventType===emp3.api.enums.EventType.MAP_FEATURE_REMOVED&&this.removeSelection(sender.id,featureIds),i=0,len=callbacks.length;i<len;i++){switch(eventType){case emp3.api.enums.EventType.MAP_FEATURE_REMOVED:myevent=new emp3.api.events.MapFeatureRemovedEvent({target:mapHash.getItem(sender.id),features:features});break;case emp3.api.enums.EventType.MAP_FEATURE_ADDED:myevent=new emp3.api.events.MapFeatureAddedEvent({target:mapHash.getItem(sender.id),features:features});break;case emp3.api.enums.EventType.MAP_FEATURE_UPDATED:myevent=new emp3.api.events.MapFeatureUpdatedEvent({target:mapHash.getItem(sender.id),features:features})}try{callbacks[i](myevent)}catch(e){console.error("Event callback generated an exception. "+e.message)}}}},this.handleFreehand=function(sender,msg){var event,payload,callbacks,j,i,coordinateArray,geoPositions=[];if(void 0===msg||null===msg)throw new Error(missingMessageError);if(payload="string"==typeof msg?JSON.parse(msg):msg,sender.id&&this.eventListeners[sender.id]&&(callbacks=this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT]))for(i in callbacks){if(payload.details)payload.originatingChannel===emp3.api.enums.channel.freehandDrawStart?event=new emp3.api.events.MapFreehandEvent({event:emp3.api.enums.MapFreehandEventEnum.MAP_ENTERED_FREEHAND_DRAW_MODE,target:mapHash.items[sender.id]}):payload.originatingChannel===emp3.api.enums.channel.freehandDrawExit&&(event=new emp3.api.events.MapFreehandEvent({event:emp3.api.enums.MapFreehandEventEnum.MAP_EXIT_FREEHAND_DRAW_MODE,target:mapHash.items[sender.id]}));else{coordinateArray=emp3.api.convertGeoJsonToCMAPIPositions(payload.feature);for(j in coordinateArray)geoPositions.push(new emp3.api.GeoPosition({latitude:coordinateArray[j].latitude,longitude:coordinateArray[j].longitude,altitude:coordinateArray[j].altitude}));event=new emp3.api.events.MapFreehandEvent({event:payload.type,target:mapHash.items[sender.id],positionGroup:{positions:geoPositions},style:payload.strokeStyle})}if(event)try{callbacks[i](event)}catch(e){console.error("Event callback generated an exception. "+e.message)}}},environment.init({initcallback:function(args){args.success===!0?(environment.pubSub.subscribe({channel:emp3.api.enums.channel.transactionComplete,callback:that.handleTransactionComplete.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.messageProgress,callback:that.handleMessageProgress.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.statusView,callback:that.handleStatusView.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.statusAbout,callback:that.handleStatusAboutResponse.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.statusFormat,callback:that.handleStatusFormatResponse.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.statusScreenshot,callback:that.handleStatusScreenshot.bind(that)}),environment.pubSub.subscribe({
channel:emp3.api.enums.channel.statusSelected,callback:that.handleStatusSelected.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.statusInitialization,callback:that.handleMapStatus.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.clicked,callback:that.handleMapClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.freehandLineDraw,callback:that.handleFreehand.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.mouseup,callback:that.handleMapClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.mousedown,callback:that.handleMapClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.drag,callback:that.handleMapClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.dragComplete,callback:that.handleMapClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureDrag,callback:that.handleFeatureClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureDragComplete,callback:that.handleFeatureClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureClicked,callback:that.handleFeatureClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureMouseDown,callback:that.handleFeatureClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureMouseUp,callback:that.handleFeatureClick.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.convertResponse,callback:that.handleConvertResponse.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureAddEvent,callback:that.handleFeatureAdd.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureRemoveEvent,callback:that.handleFeatureRemove.bind(that)}),environment.pubSub.subscribe({channel:emp3.api.enums.channel.featureUpdateEvent,callback:that.handleFeatureUpdate.bind(that)}),that.isEnvironmentReady=!0):console&&console.error("An error occurred while initializing the "+environment.name+" environment for the CPCE Map API and will not be able to communicate with the map.")}})}var updateTimer,instance=null,missingMessageError="Message received from map is missing its payload.",missingParameterError="Message received from map is missing a required parameter.",drawListenerCallbackHash=new emp3.api.Hash,mapHash=new emp.utilities.Hash,selectionHash=[],queue=[],updates=[],updateTime=0;return{destroyInstance:function(){instance=null},getInstance:function(args){return null===instance&&(instance=new PrivateConstructor(args),instance.constructor=null),instance}}}(),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.global=emp3.api.global||{version:"2.0.0",configuration:function(){var _urlProxy="../urlproxy.jsp";return Object.defineProperty(this,"urlProxy",{enumerable:!0,get:function(){return _urlProxy},set:function(value){if("string"!=typeof value)throw new Error("Invalid value type, property urlProxy must be a string");_urlProxy=value}}),this}()},emp3.api.global.findOverlay=function(args){var message={},callInfo={};message.cmd=emp3.api.enums.channel.get,message.filter=[{property:"overlayId",term:args.uuid}],message.types=["overlay"],message.select=["overlayId","name","description","properties"],message.recursive=!1,message.onSuccess=args.onSuccess,message.onError=args.onError,callInfo.source="global",callInfo.method="global.findOverlay",callInfo.args=args,emp3.api.MessageHandler.getInstance().sendMessage(message,callInfo)},emp3.api.global.findFeature=function(args){var message={},callInfo={};message.cmd=emp3.api.enums.channel.get,message.filter=[{property:"featureId",term:args.uuid}],message.types=["feature"],message.select=["featureId","name","description","properties"],message.recursive=!1,message.onSuccess=args.onSuccess,message.onError=args.onError,callInfo.source="global",callInfo.method="global.findFeature",callInfo.args=args,emp3.api.MessageHandler.getInstance().sendMessage(message,callInfo)},emp3.api.global.findContainer=function(args){if(args=args||{},!args.onSuccess)throw new Error("Missing argument: onSuccess");if(!args.uuid)throw new Error("Missing argument: uuid");if("string"!=typeof args.uuid)throw new TypeError("Invalid type: expected uuid to be a string");var message={cmd:emp3.api.enums.channel.get,types:["feature","overlay"],select:["featureId","overlayId","name","description","properties"],filter:[{property:"featureId",term:args.uuid},{property:"overlayId",term:args.uuid}],recursive:!1,onSuccess:args.onSuccess,onError:args.onError},callInfo={source:"global",method:"global.findContainer",args:args};emp3.api.MessageHandler.getInstance().sendMessage(message,callInfo)},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.MessageFactory=function(){var _messageHash={};return{constructPayload:function(message,callInfo,transactionId){if(_messageHash[message.cmd])return new _messageHash[message.cmd](message,callInfo,transactionId)},registerMessage:function(channels,message){if(Array.isArray(channels))for(var channel in channels)channels.hasOwnProperty(channel)&&(_messageHash[channels[channel]]=message);else _messageHash[channels]=message}}}(),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.Message=function(channel,transactionId){this.channel=channel,this.transactionId=transactionId||emp3.api.createGUID(),this.payload={}},emp3.api.Message.prototype.transaction=function(){},emp3.api.Message.prototype.serialize=function(){return this.payload.channel=this.channel,JSON.stringify(this.payload)},MapFeaturePlotMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.plotFeature,emp3.api.enums.channel.plotFeatureBatch];emp3.api.MessageFactory.registerMessage(channels,MapFeaturePlotMessage),MapFeaturePlotUrlMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.plotUrl];emp3.api.MessageFactory.registerMessage(channels,MapFeaturePlotUrlMessage),MapFeatureUnplotMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.unplotFeatureBatch,emp3.api.enums.channel.unplotFeature];emp3.api.MessageFactory.registerMessage(channels,MapFeatureUnplotMessage),MapFeatureDrawMessage.prototype=Object.create(emp3.api.Message.prototype),MapFeatureDrawMessage.prototype.transaction=function(){return new emp3.api.Transaction({id:this.transactionId,geoId:this.feature.geoId,mapId:this.mapId})},emp3.api.MessageFactory.registerMessage(emp3.api.enums.channel.draw,MapFeatureDrawMessage),MapFeatureUpdateMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.updateFeature];emp3.api.MessageFactory.registerMessage(channels,MapFeatureUpdateMessage),MapFeatureSelected.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.featureSelectedBatch,emp3.api.enums.channel.featureSelected];emp3.api.MessageFactory.registerMessage(channels,MapFeatureSelected),MapFeatureDeselected.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.featureDeselectedBatch,emp3.api.enums.channel.featureDeselected];emp3.api.MessageFactory.registerMessage(channels,MapFeatureDeselected),MapOverlayCreateMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.createOverlay];emp3.api.MessageFactory.registerMessage(channels,MapOverlayCreateMessage),MapOverlayUpdateMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.updateOverlay];emp3.api.MessageFactory.registerMessage(channels,MapOverlayUpdateMessage),MapOverlayRemoveMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.removeOverlay];emp3.api.MessageFactory.registerMessage(channels,MapOverlayRemoveMessage),MapOverlayShowMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.showOverlay];emp3.api.MessageFactory.registerMessage(channels,MapOverlayShowMessage),MapOverlayHideMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.hideOverlay];emp3.api.MessageFactory.registerMessage(channels,MapOverlayHideMessage),ConfigMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.config];emp3.api.MessageFactory.registerMessage(channels,ConfigMessage),FreehandStartMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.freehandDrawStart];emp3.api.MessageFactory.registerMessage(channels,FreehandStartMessage),FreehandStopMessage.prototype=Object.create(emp3.api.Message.prototype);var channels=[emp3.api.enums.channel.freehandDrawExit];emp3.api.MessageFactory.registerMessage(channels,FreehandStopMessage),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.ResponseBrokerFactory=function(){var _responseBrokers={};return{getBroker:function(channel){if(_responseBrokers[channel])return _responseBrokers[channel]},registerBroker:function(channels,broker){if(Array.isArray(channels))for(var channel in channels)channels.hasOwnProperty(channel)&&(_responseBrokers[channels[channel]]=broker);else _responseBrokers[channels]=broker}}}(),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),emp3.api.ResponseBroker=function(){},emp3.api.ResponseBroker.prototype.process=function(callbacks,details,failures){throw window.console.log(callbacks,details,failures),new Error("Process has not been implemented by this broker")},PlotFeatureTransactionCompleteBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),PlotFeatureTransactionCompleteBroker.prototype.process=function(callbacks,details,failures){var i,hashId,features=[],createdFeatures=details.features,quickHash=[];for(i=0;i<createdFeatures.length;i+=1)quickHash[createdFeatures[i].featureId]=createdFeatures[i];for(i=0;i<callbacks.data.features.length;i+=1)hashId=callbacks.data.features[i].geoId,quickHash[hashId]&&features.push(callbacks.data.features[i]);if("function"==typeof callbacks.onSuccess)if("Feature.update"===callbacks.callInfo.method||"Feature.setGeometry"===callbacks.callInfo.method||"Feature.setProperties"===callbacks.callInfo.method||"Feature.updateProperties"===callbacks.callInfo.method)try{callbacks.onSuccess({feature:features[0],failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}else try{callbacks.onSuccess({features:features,failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}};var channels=[emp3.api.enums.channel.plotFeature,emp3.api.enums.channel.plotFeatureBatch];emp3.api.ResponseBrokerFactory.registerBroker(channels,new PlotFeatureTransactionCompleteBroker),CreateUnplotFeatureTransactionCompleteBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),CreateUnplotFeatureTransactionCompleteBroker.prototype.process=function(callbacks,details,failures){try{switch(callbacks.callInfo.method){case"Map.removeMapService":try{callbacks.onSuccess({mapService:callbacks.data.features[0],failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}break;default:var i,features=[],successes=details.features;for(i=0;i<successes.length;i+=1)features.push(successes[i]);if("Overlay.removeFeatures"===callbacks.callInfo.method||"Feature.removeFeature"===callbacks.callInfo.method||"Feature.removeFeatures"===callbacks.callInfo.method||"Feature.clearContainer"===callbacks.callInfo.method)try{callbacks.onSuccess({features:features,failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}}}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}};var channels=[emp3.api.enums.channel.unplotFeature,emp3.api.enums.channel.unplotFeatureBatch];emp3.api.ResponseBrokerFactory.registerBroker(channels,new CreateUnplotFeatureTransactionCompleteBroker),HandleMapGetBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),HandleMapGetBroker.prototype.process=function(callbacks,details){var methodCalled,feature,service,map,i,positions,features=[],services=[],overlays=[],cbArgs={},successes=details.successes;if(callbacks.callInfo){if(methodCalled=callbacks.callInfo.method,successes.feature)for(i=0;i<successes.feature.length;i+=1)if(successes.feature[i].url){switch(successes.feature[i].type){case"wms":service=new emp3.api.WMS({name:successes.feature[i].name,geoId:successes.feature[i].id,description:successes.feature[i].description,url:successes.feature[i].url,version:successes.feature[i].params.version,layers:successes.feature[i].params.layers,tileFormat:successes.feature[i].params.format});break;case"wmts":service=new emp3.api.WMTS({name:successes.feature[i].name,geoId:successes.feature[i].id,description:successes.feature[i].description,url:successes.feature[i].url,version:successes.feature[i].params.version,layer:successes.feature[i].params.layer,tileFormat:successes.feature[i].params.format,style:successes.feature[i].params.style,sampleDimensions:successes.feature[i].params.sampleDimensions});break;case"kmlLayer":service=new emp3.api.WMTS({name:successes.feature[i].name,geoId:successes.feature[i].id,description:successes.feature[i].description,url:successes.feature[i].url,kmlString:successes.feature[i].kmlData})}services.push(service)}else{if(positions=emp3.api.convertGeoJsonToCMAPIPositions(successes.feature[i].data),successes.feature[i].properties){switch(successes.feature[i].properties.featureType){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:feature=new emp3.api.AirControlMeasure({geoId:successes.feature[i].featureId,name:successes.feature[i].name,acmType:successes.feature[i].data.symbolCode,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:feature=new emp3.api.Circle({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:feature=new emp3.api.Ellipse({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:feature=new emp3.api.MilStdSymbol({geoId:successes.feature[i].featureId,name:successes.feature[i].name,symbolCode:successes.feature[i].data.symbolCode,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:feature=new emp3.api.Path({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_POINT:feature=new emp3.api.Point({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:feature=new emp3.api.Polygon({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:feature=new emp3.api.Rectangle({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:feature=new emp3.api.Square({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:feature=new emp3.api.Text({geoId:successes.feature[i].featureId,name:successes.feature[i].name,positions:positions});break;case emp3.api.enums.FeatureTypeEnum.KML:feature=new emp3.api.KML({geoId:successes.feature[i].featureId,name:successes.feature[i].name,KMLString:successes.feature[i].data});break;case emp3.api.enums.FeatureTypeEnum.GEOJSON:feature=new emp3.api.GeoJSON({geoId:successes.feature[i].featureId,name:successes.feature[i].name,GeoJSONData:JSON.stringify(successes.feature[i].data)})}emp3.api.convertCMAPIPropertiesToFeature(feature,successes.feature[i].properties)}features.push(feature)}switch(successes.overlay&&(map=callbacks.source.type?callbacks.source.map:callbacks.source,overlays=getOverlaysFromTransactionComplete(successes.overlay,map)),methodCalled){case"Map.getFeatures":case"Feature.getChildren":case"Feature.getParentFeatures":case"Overlay.getFeatures":cbArgs.features=features,processSuccessCallbacks(cbArgs,callbacks);break;case"global.findOverlay":cbArgs.overlay=overlays[0],processSuccessCallbacks(cbArgs,callbacks);break;case"global.findContainer":features.length>0?cbArgs.container=features[0]:overlays.length>0?cbArgs.container=overlays[0]:cbArgs.container=void 0,features.length+overlays.length>1&&console.error("findContainer yielded multiple results with the same ID"),processSuccessCallbacks(cbArgs,callbacks);break;case"Feature.getParentOverlays":case"Overlay.getParents":case"Overlay.getOverlays":case"Map.getChildren":case"Map.getOverlays":cbArgs.overlays=overlays,processSuccessCallbacks(cbArgs,callbacks);break;case"Feature.getParents":case"Overlay.getChildren":cbArgs.overlays=overlays,cbArgs.features=features,processSuccessCallbacks(cbArgs,callbacks);break;case"global.findFeature":cbArgs.feature=features[0],processSuccessCallbacks(cbArgs,callbacks);break;case"Map.getFeatureById":case"Overlay.getFeatureById":features.length>0?(cbArgs.feature=features[0],processSuccessCallbacks(cbArgs,callbacks)):(cbArgs.errorMessage="Could not find a feature with the provided id.",processErrorCallbacks(cbArgs,callbacks));break;case"Map.getOverlayById":overlays.length>0?(cbArgs.overlay=overlays[0],processSuccessCallbacks(cbArgs,callbacks)):(cbArgs.errorMessage="Could not find a overlay with the provided id.",processErrorCallbacks(cbArgs,callbacks));break;case"Map.getMapServices":cbArgs.services=services,processSuccessCallbacks(cbArgs,callbacks);break;default:console.error("Originating method "+methodCalled+" was not handled \nstack: handleMapGet")}}},emp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.get,new HandleMapGetBroker),OverlayTransactionCompleteBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),OverlayTransactionCompleteBroker.prototype.process=function(callbacks,details,failures){try{callbacks.onSuccess({failures:failures})}catch(err){console.error("onSuccess function generated an exception.\n  name:"+err.name+"\n  message:"+err.message+"\n  stack:"+err.stack)}};var channels=[emp3.api.enums.channel.showOverlay,emp3.api.enums.channel.hideOverlay,emp3.api.enums.channel.clearFeatures,emp3.api.enums.channel.centerOnOverlay,emp3.api.enums.channel.updateOverlay,emp3.api.enums.channel.overlayClusterSet,emp3.api.enums.channel.overlayClusterActivate,emp3.api.enums.channel.overlayClusterDeactivate,emp3.api.enums.channel.overlayClusterRemove];emp3.api.ResponseBrokerFactory.registerBroker(channels,new OverlayTransactionCompleteBroker),CreateOverlayTransactionCompleteBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),CreateOverlayTransactionCompleteBroker.prototype.process=function(callbacks,details,failures){try{callbacks.onSuccess({overlays:callbacks.data.overlays,failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},emp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.createOverlay,new CreateOverlayTransactionCompleteBroker),RemoveOverlayTransactionCompleteBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),RemoveOverlayTransactionCompleteBroker.prototype.process=function(callbacks,details,failures){try{callbacks.onSuccess({overlays:callbacks.data.overlays,failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},emp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.removeOverlay,new RemoveOverlayTransactionCompleteBroker),HandleFeaturePlotUrlBroker.prototype=Object.create(emp3.api.ResponseBroker.prototype),HandleFeaturePlotUrlBroker.prototype.process=function(callbacks,details,failures){var mapService=callbacks.data.mapService;try{callbacks.onSuccess({mapService:mapService,failures:failures})}catch(e){console.error("onSuccess function generated an exception.\n  name:"+e.name+"\n  message:"+e.message+"\n  stack:"+e.stack)}},emp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.plotUrl,new HandleFeaturePlotUrlBroker),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.Event=function(args){args=args||{};var _event=args.event,_target=args.target,_type=args.type;Object.defineProperty(this,"type",{enumerable:!0,get:function(){return _type}}),Object.defineProperty(this,"event",{enumerable:!0,get:function(){return _event}}),Object.defineProperty(this,"target",{enumerable:!0,get:function(){return _target}})},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.UserInteractionEvent=function(args){args=args||{},emp3.api.events.Event.call(this,args);var _keys=args.keys,_button=args.button,_position=args.position,_point=args.point;this.type,this.event,this.target,Object.defineProperty(this,"point",{enumerable:!0,get:function(){return _point}}),Object.defineProperty(this,"position",{enumerable:!0,get:function(){return _position}}),Object.defineProperty(this,"button",{enumerable:!0,get:function(){return _button}}),Object.defineProperty(this,"keys",{enumerable:!0,get:function(){return _keys}})},emp3.api.events.UserInteractionEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapUserInteractionEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_INTERACTION,emp3.api.events.UserInteractionEvent.call(this,args),this.type,this.event,this.target,this.point,this.position,this.button,this.keys},emp3.api.events.MapUserInteractionEvent.prototype=Object.create(emp3.api.events.UserInteractionEvent.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapCursorMoveEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_CURSOR_MOVE,emp3.api.events.MapUserInteractionEvent.call(this,args),this.type,this.event,this.target,this.point,this.position,this.button,this.keys},emp3.api.events.MapCursorMoveEvent.prototype=Object.create(emp3.api.events.MapUserInteractionEvent.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapFreehandEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT,emp3.api.events.Event.call(this,args);var _style=args.style,_positionGroup=args.positionGroup;this.type,this.event,this.target,Object.defineProperty(this,"positionGroup",{enumerable:!0,get:function(){return _positionGroup}}),Object.defineProperty(this,"style",{enumerable:!0,get:function(){return _style}})},emp3.api.events.MapFreehandEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.FeatureUserInteractionEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.FEATURE_INTERACTION,emp3.api.events.UserInteractionEvent.call(this,args);var _map=args.map;this.type,this.event,this.target,this.point,this.position,this.button,this.keys,Object.defineProperty(this,"map",{enumerable:!0,get:function(){return _map}})},emp3.api.events.FeatureUserInteractionEvent.prototype=Object.create(emp3.api.events.UserInteractionEvent.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.CameraEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.CAMERA_EVENT,emp3.api.events.Event.call(this,args),this.type,this.event,this.target},emp3.api.events.CameraEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapViewChangeEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_VIEW_CHANGE,emp3.api.events.Event.call(this,args);var _bounds=this.target.getBounds(),_lookAt=this.target.getLookAt(),_camera=this.target.getCamera();Object.defineProperty(this,"bounds",{enumerable:!0,get:function(){return _bounds}}),Object.defineProperty(this,"lookAt",{enumerable:!0,get:function(){return _lookAt}}),Object.defineProperty(this,"camera",{enumerable:!0,get:function(){return _camera}})},emp3.api.events.MapViewChangeEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.ContainerEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.CONTAINER,emp3.api.events.Event.call(this,args);var _affectedChildren=args.affectedChildren;this.type,this.event,this.target,Object.defineProperty(this,"affectedChildren",{enumerable:!0,get:function(){return _affectedChildren}})},emp3.api.events.ContainerEvent.prototype=Object.create(emp3.api.events.Event.prototype),emp3.api.events.ContainerEvent.prototype.targetIsFeature=function(){return emp3.api.isFeature(this.target)},emp3.api.events.ContainerEvent.prototype.targetIsOverlay=function(){return emp3.api.isOverlay(this.target)},emp3.api.events.ContainerEvent.prototype.targetIsMap=function(){return this.target instanceof emp3.api.Map},window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapStateChangeEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_STATE_CHANGE,emp3.api.events.Event.call(this,args);var _previousState=args.previousState;this.type,this.event,this.target,Object.defineProperty(this,"newState",{enumerable:!0,get:function(){return this.target.getState()}}),Object.defineProperty(this,"previousState",{enumerable:!0,get:function(){return _previousState}})},emp3.api.events.MapStateChangeEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.FeatureEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.FEATURE_EVENT,emp3.api.events.Event.call(this,args),this.type,this.event,this.target},emp3.api.events.FeatureEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.FeatureDrawEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.FEATURE_DRAW,emp3.api.events.Event.call(this,args);var _updateList=args.updateList,_map=args.map;this.type,this.event,this.target,Object.defineProperty(this,"map",{enumerable:!0,get:function(){return _map}}),Object.defineProperty(this,"updateList",{enumerable:!0,get:function(){return _updateList}})},emp3.api.events.FeatureDrawEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.FeatureEditEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.FEATURE_EDIT,emp3.api.events.Event.call(this,args);var _updateList=args.updateList,_map=args.map;this.type,this.event,this.target,Object.defineProperty(this,"map",{enumerable:!0,get:function(){return _map}}),Object.defineProperty(this,"updateList",{enumerable:!0,get:function(){return _updateList}})},emp3.api.events.FeatureEditEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.OverlayUpdatedEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.OVERLAY_CHANGE,emp3.api.events.Event.call(this,args),this.type,this.event,this.target},emp3.api.events.OverlayUpdatedEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapFeatureAddedEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_FEATURE_ADDED,emp3.api.events.Event.call(this,args);var _features=args.features;this.type,this.event,this.target,Object.defineProperty(this,"features",{enumerable:!0,get:function(){return _features}})},emp3.api.events.MapFeatureAddedEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapFeatureRemovedEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_FEATURE_REMOVED,emp3.api.events.Event.call(this,args);var _features=args.features;this.type,this.event,this.target,Object.defineProperty(this,"features",{enumerable:!0,get:function(){return _features}})},emp3.api.events.MapFeatureRemovedEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.MapFeatureUpdatedEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.MAP_FEATURE_UPDATED,emp3.api.events.Event.call(this,args);var _features=args.features;this.type,this.event,this.target,Object.defineProperty(this,"features",{enumerable:!0,get:function(){return _features}})},emp3.api.events.MapFeatureUpdatedEvent.prototype=Object.create(emp3.api.events.Event.prototype),window.emp3||(emp3={}),window.emp3.api||(emp3.api={}),window.emp3.api.events||(emp3.api.events={}),emp3.api.events.VisibilityEvent=function(args){args=args||{},args.type=emp3.api.enums.EventType.VISIBILITY,emp3.api.events.Event.call(this,args);var _map=args.map,_parent=args.parent;this.type,this.event,this.target,Object.defineProperty(this,"parent",{enumerable:!0,get:function(){return _parent}}),Object.defineProperty(this,"map",{enumerable:!0,get:function(){return _map}})},emp3.api.events.VisibilityEvent.prototype=Object.create(emp3.api.events.Event.prototype),emp3.api.events.VisibilityEvent.prototype.targetIsFeature=function(){return emp3.api.isFeature(this.target)},emp3.api.events.VisibilityEvent.prototype.targetIsOverlay=function(){return emp3.api.isOverlay(this.target)};var emp3=emp3||{};emp3.api=emp3.api||{},emp3.api.createEnvironmentTemplate=function(){var environmentInterface={init:function(args){return emp.typeLibrary.Error({message:"The init method has not been implemented by this environment"}),!1},destroy:function(){return emp.typeLibrary.Error({message:"The destroy method has not been implemented by this environment"}),!1},createInstance:function(args){return emp.typeLibrary.Error({message:"The createInstance method has not been implemented by this environment"}),!1},pubSub:{publish:function(args){return emp.typeLibrary.Error({message:"pubSub.publish has not been implemented by this environment"}),!1},publishSync:function(args){return emp.typeLibrary.Error({message:"pubSub.publishSync has not been implemented by this environment"}),!1},subscribe:function(args){return emp.typeLibrary.Error({message:"pubSub.subscribe has not been implemented by this environment"}),!1}},prefs:{get:function(args){return emp.typeLibrary.Error({message:"prefs.get has not been implemented by this environment"}),null},set:function(args){return emp.typeLibrary.Error({message:"prefs.set has not been implemented by this environment"}),!1}},name:"Unnamed Environment",version:"1.0.0",properties:{},sender:{id:"not-set"}};return environmentInterface},emp3.api.environment=emp3.api.environment||{},emp3.api.environment.owf=function(){
function addToOWFQueue(callback){console&&console.log("Callback added to OWF queue"),owfReadyCallbackQueue.push(callback)}function loadScript(args){var script=document.createElement("script");script.type="text/javascript",script.readyState?script.onreadystatechange=function(){script.intervalCount=50,script.timer=setInterval(function(){"loaded"===script.readyState||"complete"===script.readyState?void 0===window[args.objectToLoad]?(script.intervalCount--,0===script.intervalCount&&(clearInterval(script.timer),args.failedcallback())):(clearInterval(script.timer),args.callback()):(script.intervalCount--,0===script.intervalCount&&(clearInterval(script.timer),args.failedcallback()))},100),script.onreadystatechange=null}:(script.onerror=function(){console.error("An error was found loading the script: "+args.url),args.failedcallback()},script.onload=function(){void 0===window[args.objectToLoad]?(console.error("An error was found loading the script: "+args.url),args.failedcallback()):args.callback()}),script.src=args.url,document.getElementsByTagName("head")[0].appendChild(script)}function getConfig(args){var xhr,data;console&&console.hasOwnProperty("log")&&console.log("Loading map config to get path for OWF from: "+args.path),emp3.api.environment.appSetup.configData?(emp3.api.environment.appSetup.config=emp3.api.environment.appSetup.configData,args.callback()):(xhr=new XMLHttpRequest,xhr.open("GET",encodeURI(args.path)),xhr.onload=function(){try{200===xhr.status?(data=JSON.parse(xhr.responseText),emp3.api.environment.appSetup.config=data,args.callback()):args.fail(args)}catch(e){console&&console.hasOwnProperty("log")&&console.log("CP CE Map API: An error occurred while trying to load the OWF js file from: "+args.path+"  Error: "+e.message),args.fail(args)}},xhr.send())}function handleStateEvent(sender,msg){"beforeclose"===msg.eventName&&(shutdownCallback&&shutdownCallback(),widgetState.removeStateEventOverrides({events:["beforeclose"],callback:function(){widgetState.closeWidget()}}))}function mapInit(){var i,widgetLauncher;switch(template.version){case"3.5.0-GA":case"3.6.0-GA":case"3.7.0-GA":case"3.8.0-GA":case"3.8.1-GA":widgetEventingController=new Ozone.eventing.Widget(template.properties.rpcRelayPath),window.OWF=Ozone,OWF.Eventing=widgetEventingController,OWF.getInstanceId=function(){return JSON.parse(widgetEventingController.getWidgetId()).id},template.sender.id=JSON.parse(widgetEventingController.getWidgetId()).id,OWF.Preferences=Ozone.pref.PrefServer,widgetLauncher=new Ozone.launcher.WidgetLauncher(this.widgetEventingController),OWF.Launcher={},OWF.Launcher.launch=widgetLauncher.launchWidget;break;case"4.0.0-GA":widgetEventingController=new Ozone.eventing.Widget(template.properties.rpcRelayPath),window.OWF=Ozone.Widget,OWF.Eventing=widgetEventingController,OWF.getInstanceId=function(){return JSON.parse(widgetEventingController.getWidgetId()).id},template.sender.id=JSON.parse(widgetEventingController.getWidgetId()).id,OWF.Preferences=Ozone.pref.PrefServer,widgetLauncher=new Ozone.launcher.WidgetLauncher(this.widgetEventingController),OWF.Launcher={},OWF.Launcher.launch=widgetLauncher.launchWidget;break;default:OWF.relayFile=this.rpcRelayPath,widgetEventingController=new Ozone.eventing.Widget(this.rpcRelayPath),widgetState=Ozone.state.WidgetState.getInstance({widgetEventingController:widgetEventingController,autoInit:!0,onStateEventReceived:handleStateEvent}),widgetState.addStateEventOverrides({events:["beforeclose"]});var widgetGuid=OWF.getWidgetGuid();template.sender.id=OWF.getInstanceId(),OWF.Preferences.getWidget({widgetId:widgetGuid,onSuccess:function(results){template.properties.widgetName=results.value.originalName,template.properties.universalName=results.value.universalName},onFailure:function(){template.properties.widgetName="",template.properties.universalName=""}})}for(void 0!==initCallback&&null!==initCallback&&initCallback({success:!0}),i=0;i<owfReadyCallbackQueue.length;i+=1)OWF.ready(owfReadyCallbackQueue[i])}function initialize(){var scriptLoadAttempt=!1;void 0!==window.OWF&&OWF.ready&&OWF.getContainerVersion?(console&&console.log("CP CE Map API: OWF already exits no need to load OWf JS file"),template.version=OWF.getContainerVersion(),OWF.ready(mapInit)):void 0!==window.Ozone?(console&&console.log("CP CE Map API: Running under Ozone namespace no need to load OWF JS file"),Ozone.pref.PrefServer.getServerVersion({onSuccess:function(version){template.version=version.serverVersion,mapInit()}})):scriptLoadAttempt||(console&&console.log("CP CE Map API: OWF does not already exist attempting to load OWF JS file"),scriptLoadAttempt=!0,emp3.api.environment.hasOwnProperty("appSetup")&&emp3.api.environment.appSetup.hasOwnProperty("config")&&emp3.api.environment.appSetup.config.hasOwnProperty("owfJsLocation")&&(owfJsLocation=emp3.api.environment.appSetup.config.owfJsLocation),loadScript({objectToLoad:"Ozone",url:owfJsLocation,failedcallback:function(){console&&console.log("The OWF javaScript file was not included on the page and was not able to load from the URL: "+owfJsLocation+". Please correct the URL to point to a valid location for this file in the CPCE Map Configuration Page."),initCallback({success:!1})},callback:function(){console&&console.log("The OWF javaScript file successfully loaded from the URL: "+owfJsLocation),initialize()}}))}var initCallback,shutdownCallback,template=emp3.api.createEnvironmentTemplate(),owfJsLocation="/owf/js-min/owf-widget-min.js",widgetState=null,widgetEventingController=null,owfReadyCallbackQueue=[];return window.hasOwnProperty("OWF")||(window.OWF={}),window.OWF.hasOwnProperty("ready")||(window.OWF.ready=addToOWFQueue),template.name="Ozone Widget Framework",template.init=function(args){void 0!==args&&null!==args&&(initCallback=args.initcallback,shutdownCallback=args.shutdowncallback),emp3.api.environment.hasOwnProperty("appSetup")||(emp3.api.environment.appSetup={}),emp3.api.environment.appSetup.hasOwnProperty("configLocation")||(emp3.api.environment.appSetup.configLocation="/cpce-map/config/getMapConfiguration"),void 0!==window.OWF&&OWF.ready&&OWF.getContainerVersion||void 0!==window.Ozone?initialize():getConfig({path:emp3.api.environment.appSetup.configLocation,callback:initialize,fail:function(){window.console&&window.console.hasOwnProperty("error")&&console.error("Could not find map configuration service at : "+emp3.api.environment.appSetup.configLocation+".  Loading OWF js file from default location."),initialize()}})},template.createInstance=function(args){var senderId,transactionId=emp3.api.createGUID();return args&&args.hasOwnProperty("containerId")&&window.OWF&&(args=args||{},senderId=OWF.getInstanceId(),senderId&&OWF.hasOwnProperty("Preferences")&&OWF.Preferences.findWidgets({searchParams:{widgetName:args.containerId,widgetNameExactMatch:!0},onSuccess:function(result){void 0!==result.rows?OWF.Launcher.launch({data:JSON.stringify({senderId:transactionId}),guid:result.rows[0].path,launchOnlyIfClosed:!0},function(){window.hasOwnProperty("console")&&console.log("OWF.Launcher.launch succeeded")},function(){window.hasOwnProperty("console")&&console.log("OWF.Launcher.launch failed")}):OWF.Launcher.launch({data:JSON.stringify({senderId:transactionId}),guid:result[0].id,launchOnlyIfClosed:!0},function(){})},onFailure:function(){}})),!0},template.pubSub.publish=function(args){var success=!1;try{args.sender?(OWF.Eventing.publish(args.channel,args.message,args.sender),success=!0):(OWF.Eventing.publish(args.channel,args.message),success=!0)}catch(ignore){}return success},template.pubSub.subscribe=function(args){var success=!1;try{OWF.Eventing.subscribe(args.channel,args.callback),success=!0}catch(ignore){}return success},template.properties.rpcRelayPath="rpc_relay.uncompressed.html",template}(),emp3.api.environment=emp3.api.environment||{},emp3.api.environment.browser=function(){var template=emp3.api.createEnvironmentTemplate(),senderId=emp3.api.createGUID();return template.sender={id:senderId},template.name="Browser",template.init=function(args){args&&args.hasOwnProperty("initcallback")&&(args.success=!0,args.initcallback(args))},template.createInstance=function(args){var result=!1;return args&&args.hasOwnProperty("containerId")&&args.hasOwnProperty("messageId")&&(emp.instanceManager.createInstance({instanceDomId:args.containerId,messageId:args.messageId,extent:args.extent,engine:args.engine,recorder:args.recorder,environment:args.environment}),result=!0),result},template.destroyInstance=function(args){var result=!1;return args&&args.hasOwnProperty("id")&&(emp.instanceManager.destroyInstance({mapInstanceId:args.id,messageId:args.messageId}),result=!0),result},template.pubSub.publish=function(args){var message={channel:args.channel,message:args.message,sender:template.sender};emp.recorder.log({timestamp:Date.now(),logEntry:args}),args.hasOwnProperty("dest")&&(message.dest=args.dest);var rc=emp.environment.browser.mediator.publish(message);if(rc.success)return!0;throw new Error(rc.message)},template.pubSub.publishSync=function(args){var message={channel:args.channel,message:args.message,sender:template.sender};return emp.recorder.log({timestamp:Date.now(),logEntry:args}),args.hasOwnProperty("dest")&&(message.dest=args.dest),emp.environment.browser.mediator.publishSynch(message)},template.pubSub.subscribe=function(args){var success=!1;return emp.environment.browser.mediator.subscribe({channel:args.channel,callback:args.callback}),success=!0},template}(),emp3.api.environment=emp3.api.environment||{},emp3.api.environment.starfish=function(){function loadScript(args){var script=document.createElement("script");script.type="text/javascript",script.readyState?script.onreadystatechange=function(){script.intervalCount=50,script.timer=setInterval(function(){"loaded"===script.readyState||"complete"===script.readyState?void 0===window[args.objectToLoad]?(script.intervalCount--,0===script.intervalCount&&(clearInterval(script.timer),args.failedcallback())):(clearInterval(script.timer),args.callback()):(script.intervalCount--,0===script.intervalCount&&(clearInterval(script.timer),args.failedcallback()))},100),script.onreadystatechange=null}:(script.onerror=function(){console.log("An error was found loading the script"),args.failedcallback()},script.onload=function(){console.log("Script loaded successfully."),void 0===window[args.objectToLoad]?args.failedcallback():args.callback()}),script.src=args.url,document.getElementsByTagName("head")[0].appendChild(script)}function initialize(){void 0!==window.com&&void 0!==window.com.octabits&&void 0!==window.com.octabits.starfish?(nerve=new com.octabits.starfish.Nerve,template.sender.id=nerve.id,initCallback({success:!0})):scriptLoadAttempt||(scriptLoadAttempt=!0,loadScript({objectToLoad:"com",url:starfishjslocation,failedcallback:function(){initCallback({success:!1})},callback:function(){initialize()}}))}var nerve,template=emp3.api.createEnvironmentTemplate(),scriptLoadAttempt=!1,starfishjslocation="js/environment/starfish/com.octabits.starfish.js";return template.name="Starfish",template.init=function(args){args&&args.hasOwnProperty("initcallback")&&(initCallback=args.initcallback),initialize()},template.pubSub.publish=function(args){var success=!1;return void 0!==nerve&&nerve.publish({channel:args.channel,message:args.message}),success=!0},template.pubSub.subscribe=function(args){var success=!1;return nerve.subscribe({channel:args.channel,callback:args.callback}),success=!0},template}(),emp3.api.environment=emp3.api.environment||{},emp3.api.environment.iwc=function(){function getChannel(achannel){var channel=channelLookup[achannel];return void 0!==channel&&null!==channel||(channelLookup[achannel]=new iwcClient.data.Reference(achannel,{lifespan:"Bound",respondOn:"all"}),channel=channelLookup[achannel]),channel}var iwcClient,template=emp3.api.createEnvironmentTemplate(),channelLookup={},callbackLookup={},adjustChannelName=function(channelName){return"/cmapi_"+channelName.replace(/\./g,"_")},revertChannelName=function(channelName){return channelName=channelName.replace("/cmapi_",""),channelName.replace(/\_/g,".")},receiveMessage=function(event){var callback,callbackList,msg=event.newValue;if(msg.sender.id!==iwcClient.address){callbackList=callbackLookup[msg.channel];for(callback in callbackList)callbackList.hasOwnProperty(callback)&&"function"==typeof callbackList[callback]&&callbackList[callback](msg.sender,msg.msg,revertChannelName(msg.channel))}};return template.name="Ozone Platform Inter Widget Communication (IWC)",template.version="1.0.0",template.properties={},template.sender={id:"not-set"},template.iwcHost="vendor/iwc/",template.init=function(args){var success=!1;if(void 0!==ozpIwc&&null!==ozpIwc&&"function"==typeof ozpIwc.hasOwnProperty&&ozpIwc.hasOwnProperty("Client")){iwcClient=new ozpIwc.Client(this.iwcHost);var closureArgs=args;iwcClient.connect().then(function(){console.log("emp3 IWC Environment instance connected: "+iwcClient.address),closureArgs.initcallback({success:!0}),template.sender.id=iwcClient.address}).catch(function(err){console.error("IWC Client failed to connect:",err)}),success=!0}else console.error("The Ozone Platform IWC JavaScript was not found on this page.  Please ensure that the path to ozpIwc-client.js on your app is correct"),args.initcallback({success:!1});return success},template.destroy=function(){return iwcClient.disconnect(),!0},template.createInstance=function(){return!0},template.pubSub.publish=function(args){var cName=adjustChannelName(args.channel),channel=getChannel(cName);return channel.set({msg:args.message,channel:cName,sender:{id:iwcClient.address}}).catch(function(err){console.error("ERROR publishing core message: "+cName+" - "+JSON.stringify(err))}),!0},template.pubSub.subscribe=function(args){var cName=adjustChannelName(args.channel),channel=getChannel(cName);void 0!==callbackLookup[cName]?callbackLookup[cName][args.callback]=args.callback:(callbackLookup[cName]={},callbackLookup[cName][args.callback]=args.callback),channel.watch(receiveMessage)},template}();
//# sourceMappingURL=emp3.min.js.map