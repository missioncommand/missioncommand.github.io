{"version":3,"sources":["../../src/sdk/core/emp.geoLibrary.js","../../src/sdk/api/utils/emp3.utils.geoLibrary.js","../../src/sdk/api/emp3.api.js","../../src/sdk/api/messages/map.feature.plot.Message.js","../../src/sdk/api/messages/map.feature.plot.url.Message.js","../../src/sdk/api/messages/map.feature.unplot.Message.js","../../src/sdk/api/messages/map.feature.draw.Message.js","../../src/sdk/api/messages/map.feature.update.Message.js","../../src/sdk/api/messages/map.feature.selected.Message.js","../../src/sdk/api/messages/map.feature.deselected.Message.js","../../src/sdk/api/messages/map.overlay.create.Message.js","../../src/sdk/api/messages/map.overlay.update.Message.js","../../src/sdk/api/messages/map.overlay.remove.Message.js","../../src/sdk/api/messages/map.overlay.show.Message.js","../../src/sdk/api/messages/map.overlay.hide.Message.js","../../src/sdk/api/messages/cmapi2.map.config.Message.js","../../src/sdk/api/messages/cmapi2.map.freehand.start.Message.js","../../src/sdk/api/messages/cmapi2.map.freehand.stop.Message.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.plotFeatureTransactionComplete.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.handleMapGet.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.handleOverlayTransactionComplete.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.handleCreateOverlayTransactionComplete.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.handleRemoveOverlayTransactionComplete.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.handleFeaturePlotUrl.js","../../src/sdk/vendor/tv4.js","../../src/sdk/core/emp.js","../../src/sdk/core/emp.util.js","../../src/sdk/core/emp.util.config.js","../../src/sdk/core/emp.constant.js","../../src/sdk/core/emp.elementResizeListener.js","../../src/sdk/core/emp.classLibrary.Class.js","../../src/sdk/core/emp.classLibrary.Coordinate.js","../../src/sdk/core/emp.classLibrary.MapExtent.js","../../src/sdk/core/emp.util.geojson.js","../../src/sdk/core/emp.util.kml.js","../../src/sdk/core/emp.helpers.js","../../src/sdk/core/emp.utilities.js","../../src/sdk/core/emp.geojsonParser.js","../../src/sdk/core/emp.errorHandler.js","../../src/sdk/core/emp.transactionQueue.js","../../src/sdk/core/emp.editingManager.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.js","../../src/sdk/core/typeLibrary/utils/emp.typeLibrary.utils.js","../../src/sdk/core/typeLibrary/utils/milstd/emp.typeLibrary.utils.milstd.AOI.js","../../src/sdk/core/typeLibrary/utils/milstd/emp.typeLibrary.utils.milstd.Modifiers.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.LatLonCoordinates.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Base.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Transaction.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Overlay.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Feature.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Static.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Status.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Lock.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.LookAt.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.View.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Menu.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Pointer.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Draw.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Edit.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Selection.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.SelectionBox.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.Error.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.WMS.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.WMTS.js","../../src/sdk/core/typeLibrary/emp.typeLibrary.KmlLayer.js","../../src/sdk/core/classLibrary/emp.classLibrary.ObjectRelationship.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpObject.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpRenderableObject.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpOverlay.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpStaticContent.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpFeature.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpMapService.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpWMS.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpWMTS.js","../../src/sdk/core/classLibrary/emp.classLibrary.EmpKmlLayer.js","../../src/sdk/core/emp.map.js","../../src/sdk/core/emp.engineTemplate.js","../../src/sdk/core/environment/emp.environment.js","../../src/sdk/core/environment/emp.environmentTemplate.js","../../src/sdk/core/storage/contextMenu/emp.contextMenuStorageManager.js","../../src/sdk/core/storage/emp.storage.js","../../src/sdk/core/storage/emp.storage.controller.js","../../src/sdk/core/storage/emp.storage.search.js","../../src/sdk/core/storage/emp.storage.query.js","../../src/sdk/core/storage/emp.storage.get.js","../../src/sdk/core/storage/emp.storage.repopulate.js","../../src/sdk/core/editors/emp.editors.EditorBase.js","../../src/sdk/core/editors/emp.editors.Point.js","../../src/sdk/core/environment/owf/emp.environment.owf.js","../../src/sdk/core/environment/browser/emp.environment.browser.js","../../src/sdk/core/environment/browser/emp.environment.browser.mediator.js","../../src/sdk/core/environment/starfish/emp.environment.starfish.js","../../src/sdk/core/environment/iwc/emp.environment.iwc.js","../../src/sdk/core/emp.wms.manager.js","../../src/sdk/core/api/emp.api.js","../../src/sdk/core/emp.intents.js","../../src/sdk/core/emp.prefs.js","../../src/sdk/core/api/cmapi/cmapi.js","../../src/sdk/core/api/cmapi/cmapi.channel.names.js","../../src/sdk/core/api/cmapi/emp.api.cmapi.js","../../src/sdk/core/api/cmapi/emp.api.cmapi.publisher.intentChannelMap.js","../../src/sdk/core/api/cmapi/typeLibrary/cmapi.typeLibrary.msgComplete.status.js","../../src/sdk/core/api/cmapi/typeLibrary/cmapi.typeLibrary.MessageComplete.js","../../src/sdk/core/api/cmapi/typeLibrary/cmapi.typeLibrary.MessageProgress.js","../../src/sdk/core/api/cmapi/channel/schema/map.error.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.deselected.batch.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.deselected.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.hide.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.plot.batch.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.plot.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.plot.url.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.selected.batch.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.selected.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.show.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.unplot.batch.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.unplot.js","../../src/sdk/core/api/cmapi/channel/schema/map.feature.update.js","../../src/sdk/core/api/cmapi/channel/schema/map.overlay.create.js","../../src/sdk/core/api/cmapi/channel/schema/map.overlay.hide.js","../../src/sdk/core/api/cmapi/channel/schema/map.overlay.remove.js","../../src/sdk/core/api/cmapi/channel/schema/map.overlay.show.js","../../src/sdk/core/api/cmapi/channel/schema/map.overlay.update.js","../../src/sdk/core/api/cmapi/channel/schema/map.status.about.js","../../src/sdk/core/api/cmapi/channel/schema/map.status.format.js","../../src/sdk/core/api/cmapi/channel/schema/map.status.initialization.js","../../src/sdk/core/api/cmapi/channel/schema/map.status.request.js","../../src/sdk/core/api/cmapi/channel/schema/map.status.selected.js","../../src/sdk/core/api/cmapi/channel/schema/map.status.view.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.center.bounds.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.center.feature.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.center.location.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.center.overlay.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.lookat.location.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.clicked.js","../../src/sdk/core/api/cmapi/channel/schema/map.view.zoom.js","../../src/sdk/core/api/cmapi/channel/handler/cmapi2.visibility.get.js","../../src/sdk/core/api/cmapi/channel/handler/cmapi2.map.config.js","../../src/sdk/core/api/cmapi/channel/handler/cmapi2.map.freehand.start.js","../../src/sdk/core/api/cmapi/channel/handler/cmapi2.map.freehand.stop.js","../../src/sdk/core/api/cmapi/channel/handler/map.convert.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.clear.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.deselected.batch.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.deselected.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.draw.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.edit.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.hide.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.plot.batch.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.plot.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.plot.url.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.selected.batch.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.selected.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.show.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.unplot.batch.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.unplot.js","../../src/sdk/core/api/cmapi/channel/handler/map.feature.update.js","../../src/sdk/core/api/cmapi/channel/handler/map.get.js","../../src/sdk/core/api/cmapi/channel/handler/map.message.cancel.js","../../src/sdk/core/api/cmapi/channel/handler/map.message.complete.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.clear.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.cluster.activate.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.cluster.deactivate.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.cluster.remove.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.cluster.set.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.create.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.hide.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.remove.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.show.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.style.js","../../src/sdk/core/api/cmapi/channel/handler/map.overlay.update.js","../../src/sdk/core/api/cmapi/channel/handler/map.status.request.js","../../src/sdk/core/api/cmapi/channel/handler/map.swap.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.lock.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.center.bounds.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.center.feature.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.center.location.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.center.overlay.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.coordinatesystem.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.lookat.location.js","../../src/sdk/core/api/cmapi/channel/handler/map.view.zoom.js","../../src/sdk/core/api/cmapi/channel/publisher/cmapi2.map.feature.event.add.js","../../src/sdk/core/api/cmapi/channel/publisher/cmapi2.map.feature.event.remove.js","../../src/sdk/core/api/cmapi/channel/publisher/cmapi2.map.feature.event.update.js","../../src/sdk/core/api/cmapi/channel/publisher/cmapi2.map.freehand.linedraw.js","../../src/sdk/core/api/cmapi/channel/publisher/map.error.js","../../src/sdk/core/api/cmapi/channel/publisher/map.feature.clicked.js","../../src/sdk/core/api/cmapi/channel/publisher/map.feature.deselected.js","../../src/sdk/core/api/cmapi/channel/publisher/map.feature.plot.js","../../src/sdk/core/api/cmapi/channel/publisher/map.feature.plot.url.js","../../src/sdk/core/api/cmapi/channel/publisher/map.feature.selected.js","../../src/sdk/core/api/cmapi/channel/publisher/map.feature.unplot.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.progress.js","../../src/sdk/core/api/cmapi/channel/publisher/map.overlay.remove.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.about.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.coordinatesystem.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.format.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.initialization.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.screenshot.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.selected.js","../../src/sdk/core/api/cmapi/channel/publisher/map.status.view.js","../../src/sdk/core/api/cmapi/channel/publisher/map.view.area.selected.js","../../src/sdk/core/api/cmapi/channel/publisher/map.view.clicked.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/draw.begin.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/edit.begin.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/feature.add.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/feature.hide.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/feature.remove.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/feature.selected.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/feature.show.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/feature.update.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/map.convert.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/map.get.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/overlay.create.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/overlay.hide.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/overlay.remove.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/overlay.show.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/overlay.update.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/view.set.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/visibility.get.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/visibility.set.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/mapservice.add.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.complete/mapservice.remove.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.progress/draw.update.js","../../src/sdk/core/api/cmapi/channel/publisher/map.message.progress/edit.update.js","../../src/sdk/core/api/cmapi/channel/support/cmapi.generic.feature.remove.js","../../src/sdk/core/api/cpcev1/emp.api.core.js","../../src/sdk/core/api/cpcev1/emp.api.core.fixture.js","../../src/sdk/core/api/cpcev1/emp.api.core.handler.js","../../src/sdk/core/api/cpcev1/emp.api.core.publish.js","../../src/sdk/core/emp.instanceManager.js","../../src/sdk/core/emp.ui.js","../../src/sdk/core/emp.recorder.js","../../src/sdk/api/org.cmapi.primitives.js","../../src/sdk/api/emp3.api.enums.js","../../src/sdk/api/emp3.api.Container.js","../../src/sdk/api/emp3.api.CameraManager.js","../../src/sdk/api/emp3.api.LookAtManager.js","../../src/sdk/api/emp3.api.Transaction.js","../../src/sdk/api/emp3.api.Camera.js","../../src/sdk/api/emp3.api.LookAt.js","../../src/sdk/api/emp3.api.Map.js","../../src/sdk/api/emp3.api.Overlay.js","../../src/sdk/api/emp3.api.MapService.js","../../src/sdk/api/emp3.api.WMS.js","../../src/sdk/api/emp3.api.WMTS.js","../../src/sdk/api/emp3.api.KMLLayer.js","../../src/sdk/api/emp3.api.Feature.js","../../src/sdk/api/emp3.api.AirControlMeasure.js","../../src/sdk/api/emp3.api.Point.js","../../src/sdk/api/emp3.api.Polygon.js","../../src/sdk/api/emp3.api.Circle.js","../../src/sdk/api/emp3.api.Rectangle.js","../../src/sdk/api/emp3.api.Square.js","../../src/sdk/api/emp3.api.Text.js","../../src/sdk/api/emp3.api.Ellipse.js","../../src/sdk/api/emp3.api.Path.js","../../src/sdk/api/emp3.api.KML.js","../../src/sdk/api/emp3.api.GeoJSON.js","../../src/sdk/api/emp3.api.GeoPosition.js","../../src/sdk/api/emp3.api.MilStdSymbol.js","../../src/sdk/api/emp3.api.MessageHandler.js","../../src/sdk/api/emp3.api.global.js","../../src/sdk/api/messages/emp3.api.MessageFactory.js","../../src/sdk/api/messages/emp3.api.Message.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBrokerFactory.js","../../src/sdk/api/responseBrokers/emp3.api.ResponseBroker.js","../../src/sdk/api/events/emp3.api.events.Event.js","../../src/sdk/api/events/emp3.api.events.UserInteractionEvent.js","../../src/sdk/api/events/emp3.api.events.MapUserInteractionEvent.js","../../src/sdk/api/events/emp3.api.events.MapCursorMoveEvent.js","../../src/sdk/api/events/emp3.api.events.MapFreehandEvent.js","../../src/sdk/api/events/emp3.api.events.FeatureUserInteractionEvent.js","../../src/sdk/api/events/emp3.api.events.CameraEvent.js","../../src/sdk/api/events/emp3.api.events.MapViewChangeEvent.js","../../src/sdk/api/events/emp3.api.events.ContainerEvent.js","../../src/sdk/api/events/emp3.api.events.MapStateChangeEvent.js","../../src/sdk/api/events/emp3.api.events.FeatureEvent.js","../../src/sdk/api/events/emp3.api.events.FeatureDrawEvent.js","../../src/sdk/api/events/emp3.api.events.FeatureEditEvent.js","../../src/sdk/api/events/emp3.api.events.OverlayUpdatedEvent.js","../../src/sdk/api/events/emp3.api.events.MapFeatureAddedEvent.js","../../src/sdk/api/events/emp3.api.events.MapFeatureRemovedEvent.js","../../src/sdk/api/events/emp3.api.events.MapFeatureUpdatedEvent.js","../../src/sdk/api/events/emp3.api.events.VisibilityEvent.js","../../src/sdk/api/environment/emp3.api.createEnvironmentTemplate.js","../../src/sdk/api/environment/emp3.environment.owf.js","../../src/sdk/api/environment/emp3.environment.browser.js","../../src/sdk/api/environment/emp3.environment.starfish.js","../../src/sdk/api/environment/emp3.environment.iwc.js"],"names":["LatLon","lat","lon","rad","this","_lat","trim","NaN","_lon","_radius","convertGeoJsonToCoordinateString","geojson","i","coordString","type","coordinates","toLowerCase","length","convertCoordinateStringToGeoJson","coordinateArray","geoJsonCoordinateArray","geojsontype","splitcoordinates","point","k","j","geojsonObject","replace","split","push","convertLocationArrayToString","locations","len","alt","sizeof","object","key","index","objects","size","Object","prototype","toString","call","processed","search","MapFeaturePlotMessage","message","callInfo","transactionId","payload","convertedFeature","feature","featureCount","multiPayload","features","emp3","api","Message","enums","channel","plotFeatureBatch","plotFeature","featureType","FeatureTypeEnum","KML","convertFeatureToKML","convertFeatureToGeoJSON","overlayId","featureId","geoId","visible","parentId","format","name","readOnly","properties","getProperties","modifiers","standard","symbolStandard","messageId","MapFeaturePlotUrlMessage","plotUrl","mapService","emp","constant","parentIds","MAP_LAYER_PARENT","description","url","useProxy","params","layers","tileFormat","version","layer","style","sampleDimensions","kmlString","MapFeatureUnplotMessage","unplotFeatureBatch","undefined","MapFeatureDrawMessage","draw","Error","convertCMAPIPositionsToGeoJson","positions","symbolCode","mapId","MapFeatureUpdateMessage","updateFeature","method","oldOverlayId","newOverlayId","oldParentId","newParentId","Array","isArray","MapFeatureSelected","featureSelectedBatch","util","each","Feature","MapFeatureDeselected","featureDeselectedBatch","toDeselect","MessageHandler","getInstance","getSelected","MapOverlayCreateMessage","createOverlay","overlays","overlay","bind","MapOverlayUpdateMessage","updateOverlay","MapOverlayRemoveMessage","removeOverlay","MapOverlayShowMessage","showOverlay","parent","ALL_PARENTS","recurse","MapOverlayHideMessage","hideOverlay","ConfigMessage","config","midDistanceThreshold","farDistanceThreshold","iconSize","milStdLabels","selectionScale","scale","selectionColor","color","freehandStrokeStyle","brightness","FreehandStartMessage","freehandDrawStart","strokeStyle","FreehandStopMessage","freehandDrawExit","PlotFeatureTransactionCompleteBroker","HandleMapGetBroker","processSuccessCallbacks","args","callbacks","onSuccess","e","console","error","stack","processErrorCallbacks","onError","getOverlaysFromTransactionComplete","transactionOverlaySuccess","map","childOverlays","Overlay","children","concat","OverlayTransactionCompleteBroker","CreateOverlayTransactionCompleteBroker","RemoveOverlayTransactionCompleteBroker","HandleFeaturePlotUrlBroker","global","recursiveCompare","A","B","parseURI","m","String","match","href","protocol","authority","host","hostname","port","pathname","hash","resolveUrl","base","removeDotSegments","input","output","p","pop","join","charAt","slice","lastIndexOf","normSchema","schema","baseUri","id","ValidationError","code","dataPath","schemaPath","subErrors","searchForTrustedSchemas","substring","remainder","ValidatorContext","collectMultiple","missing","schemas","create","errors","handleError","collectError","returnError","prefixErrors","startIndex","prefixWith","getSchema","baseUrl","fragment","indexOf","pointerPath","decodeURIComponent","parts","component","addSchema","validateAll","data","dataPathParts","schemaPathParts","errorCount","validateBasic","validateNumeric","validateString","validateArray","validateObject","validateCombinations","dataPart","schemaPart","validateType","validateEnum","dataType","allowedTypes","ErrorCodes","INVALID_TYPE","enumVal","ENUM_MISMATCH","JSON","stringify","validateMultipleOf","validateMinMax","multipleOf","divisibleBy","NUMBER_MULTIPLE_OF","minimum","NUMBER_MINIMUM","exclusiveMinimum","NUMBER_MINIMUM_EXCLUSIVE","maximum","NUMBER_MAXIMUM","exclusiveMaximum","NUMBER_MAXIMUM_EXCLUSIVE","validateStringLength","validateStringPattern","minLength","STRING_LENGTH_SHORT","maxLength","STRING_LENGTH_LONG","pattern","regexp","RegExp","test","STRING_PATTERN","validateArrayLength","validateArrayUniqueItems","validateArrayItems","minItems","ARRAY_LENGTH_SHORT","maxItems","ARRAY_LENGTH_LONG","uniqueItems","ARRAY_UNIQUE","items","additionalItems","ARRAY_ADDITIONAL_ITEMS","validateObjectMinMaxProperties","validateObjectRequiredProperties","validateObjectProperties","validateObjectDependencies","keys","minProperties","OBJECT_PROPERTIES_MINIMUM","maxProperties","OBJECT_PROPERTIES_MAXIMUM","required","OBJECT_REQUIRED","foundMatch","patternProperties","patternKey","additionalProperties","OBJECT_ADDITIONAL_PROPERTIES","dependencies","depKey","dep","OBJECT_DEPENDENCY_KEY","requiredKey","validateAllOf","validateAnyOf","validateOneOf","validateNot","allOf","subSchema","anyOf","startErrorCount","ANY_OF_MISSING","oneOf","validIndex","ONE_OF_MULTIPLE","ONE_OF_MISSING","not","oldErrorCount","notErrors","NOT_PASSED","dataPrefix","schemaPrefix","globalContext","publicApi","validate","context","$ref","valid","validateResult","result","apply","arguments","validateMultiple","errorCodes","tv4","module","exports","window","core","sources","CONDUCTOR","CONFIG","ERROR","EVENTING","INTENT","MAP","QUEUE","STORAGE","LIBRARY","HOST","EMP","CORE","settings","labelSize","iconSizeOption","isEmptyString","str","isEmpty","getBooleanValue","value","bDefault","ret","isAirspaceSymbol","sSymbolCode","airspaceSymbolCode","SHAPE3D_CAKE","SHAPE3D_ROUTE","SHAPE3D_CYLINDER","SHAPE3D_ORBIT","SHAPE3D_POLYGON","SHAPE3D_RADARC","SHAPE3D_POLYARC","SHAPE3D_TRACK","SHAPE3D_CURTAIN","getParameterByName","location","regex","results","exec","validateEnvironment","environment","starfish","owf","iwc","browser","convertColorToHexColor","red","green","blue","alpha","Math","round","toUpperCase","convertHexToColor","hex","substr","parseInt","parseXML","xmlStr","DOMParser","parseFromString","collection","func","HTMLCollection","NodeList","forEach","el","NamedNodeMap","DOMNodeTypes","Element","Attr","Text","CDATASection","EntityReference","Entity","ProcessingInstruction","Comment","Document","DocumentType","DocumentFragment","Notation","empV3Config","publicInterface","setConfigObject","hasOwnProperty","urlProxy","configuration","getConfigObject","setAutoSelect","getConfigParameter","sParameter","oConfigObject","getProxyUrl","getUseProxySetting","getAutoSelect","flag","autoSelect","setCurrentEngineConfiguration","engineConfig","previousMapEngineId","currentMapEngineId","mapEngineId","currentEngineConfiguration","getCurrentEngineConfiguration","getCurrentMapEngineId","getPreviousMapEngineId","MAP_ROOT","LEAFLET","CESIUM","WORLD_WIND","featureFormatType","GEOJSON","WKT","WMS","WFS","IMAGE","MILSTD","AIRSPACE","GEO_ACM","GEO_CIRCLE","GEO_ELLIPSE","GEO_MIL_SYMBOL","GEO_PATH","GEO_POINT","GEO_POLYGON","GEO_RECTANGLE","GEO_SQUARE","GEO_TEXT","featureMilStdVersionType","MILSTD_2525B","MILSTD_2525C","convertToNumeric","sVersion","iVersion","helpers","typeLibrary","featureAltitudeModeType","CLAMP_TO_GROUND","RELATIVE_TO_GROUND","ABSOLUTE","orbitTurnType","CENTER","RIGHT","LEFT","primitives","BBS_CIRCLE","BBS_ELLIPSE","BBS_PATH","BBS_POINT","BBS_POLYGON","BBS_RECTANGLE","BBS_SQUARE","BBS_TEXT","AOIType","POINT_RADIUS","LINE","POLYGON","BBOX","OutlineStyleType","DOT","DASH","DASH_DOT","LONG_DASH","LONG_DASH_DOT","SOLID","resizeListener","win","target","srcElement","__resizeRAF__","cancelFrame","requestFrame","trigger","__resizeTrigger__","__resizeListeners__","fn","objectLoad","contentDocument","defaultView","__resizeElement__","addEventListener","attachEvent","document","isIE","navigator","userAgent","raf","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","setTimeout","cancel","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","clearTimeout","addResizeListener","element","getComputedStyle","position","obj","createElement","setAttribute","onload","appendChild","removeResizeListener","splice","detachEvent","removeEventListener","removeChild","classLibrary","Util","extend","dest","src","invokeEach","limitExecByInterval","time","lock","execOnUnlock","wrapperFn","falseFn","formatNum","num","digits","pow","splitWords","setOptions","options","getParamString","existingUrl","uppercase","encodeURIComponent","template","Class","props","NewClass","initialize","_initHooks","callInitHooks","F","proto","constructor","statics","includes","__super__","_initHooksCalled","include","mergeOptions","addInitHook","init","privateClass","latitude","longitude","altitude","oLatLon","oOptions","isNaN","parseFloat","getLatitude","getLongitude","getAltitude","getLatLon","distanceTo","precision","Coordinate","bearingTo","finalBearingTo","midpointTo","latLon","destinationPoint","brng","dist","rhumbDistanceTo","rhumbBearingTo","rhumbDestinationPoint","sStr","oSW","oNE","oSouthWest","oNorthEast","oLatLngList","degNorth","degSouth","degWest","degEast","MapExtent","getSouthWest","getNorthEast","iIndex","addCoordinate","destroy","oCoord","degSE2Coord","degSW2Coord","oCoordinate","geoLibrary","GetAzimuth","x","y","getNorth","getSouth","getWest","getEast","getCenter","oCenter","getCenterWest","dCenterLat","getCenterEast","getSouthEast","getNorthWest","containsCoordiante","contained","oMapExtent","intersects","oBNorthEast","dBrng","oSouthEast","oBNorthWest","getCenterWidth","oCenterWest","oCenterEast","setCenterWidth","dWidth","oNewWestCoord","oNewEastCoord","reset","geoJson","oGeoJson","toCoordinate","oCoordinates","toCoordinateArray","geometry","convertCoordinateToGeoJson","oEmpCoordinate","oGeoJsonCoord","convertCoordinateArrayToGeoJson","oEmpCoordinateArray","kml","sKML","aCoord","dLng","dLat","dAlt","oaCoordList","oKmlDoc","bIsPolygon","processCoordString","sCoordStr","aStrCoordList","Number","getElementsByTagName","oDescElem","childNodes","nodeValue","toKMLfromCoordinateArray","oaCoordArray","getXmlAsString","xmlDom","XMLSerializer","serializeToString","xml","bDone","copyObject","oFrom","parse","get","coreId","sOverlayId","sFeatureId","oStorageEntry","storage","byIds","coreParent","oStorageItem","setId","sId","isId","newGUID","lut","d0","random","d1","d2","d3","coordinatesToString","oData","iPolygonIndex","sCoord","isAOI","oItem","bRet","canMapEngineEditFeature","mapInstanceId","oEmpFeature","oProperties","mapInstance","instanceManager","getFormat","engine","capabilities","formats","KML_BASIC","edit","KML_COMPLEX","AOI","GEOJSON_BASIC","GEOJSON_FULL","version2525B","version2525C","symbolId","getSymbolCode","oModifiers","sec","web","renderer","utilities","JavaRendererUtilities","is3dSymbol","altitudeDepth","iCoordinateCnt","getData","distance","canMapEnginePlotFeature","getCoreObjectType","types","OVERLAY","FEATURE","plot","version_1_1","getVersion","version_1_3","WMTS","KML_LAYER","findIndexOf","oArray","fieldName","fieldValue","associativeArray","aArray","getKeys","aKeys","relToAbs","base_url","getReplacementString","fnCallback","sParam","sValue","iParamEnd","oRegExp","sStrCopy","bContinue","iParamStart","createCircleCanvas","oArgs","wrapText","text","lineHeight","iMaxWidth","iTextHeight","iCharIndex","sCurrLine","oLines","sTxt","measureText","width","yOffset","floor","fillText","oCtx","iRadius","dOpacity","sStrokeColor","sFillColor","sGradientColor","sTextColor","sText","iLineWidth","iWidth","iHeight","iX","iY","oCanvas","height","getContext","beginPath","globalAlpha","oGradient","createRadialGradient","addColorStop","fillStyle","arc","PI","fill","lineWidth","stroke","font","textAlign","isUrl","s","oHiddenSpan","getStringPixelDimensions","sFontFamily","sFontSize","sFontWeight","textMeasuringSpan","body","insertBefore","getElementById","fontFamily","fontSize","fontWeight","innerHTML","getAffiliationColor","sColor","sAffiliation","get3DMilStdAffiliationColor","GeoJsonHasAltitude","coordinateHasAltitude","coordinateArrayHasAltitude","polygonCoordinateHasAltitude","multiPolygonCoordinateHasAltitude","oGeoJsonData","geometries","level","CATASTROPHIC","isCompoundGeoJson","isCompoundKML","sKMLData","xmlDoc","coordNodes","Ex","Hash","removeItem","in_key","tmp_previous","getItem","setItem","in_value","hasItem","clear","getDefaultIcon","basePath","icon","iconUrl","offset","xUnits","yUnits","referencePoint","TOP_LEFT","BOTTOM_LEFT","oDefaultIcon","getDefaultIconURL","calculateXOffset","iIconWidth","nOffset","sOffsetType","iOffset","calculateYOffset","iIconHeight","cRefPoint","getDefaultIconOffset","xOffset","METERS_PER_DEG","Point","metersPerPixel","inchPerMeter","pixelsPerInch","step1","ddToMGRS","latDD","longDD","lng","NS","EW","abs","ddToDMS","dmsToMGRS","deg","minute","decDeg","DMS","deg2rad","conv_factor","latDegrees","latMinutes","latSeconds","longDegrees","longMinutes","longSeconds","West","North","East","IEast","INorth","EastStr","NorthStr","Long","K","L","SINK","COSK","TANK","TANK2","COSK2","COSK3","K3","K4","Merid","MeridWest","L0","J3","J4","J5","J6","M","Temp","V","R","H2","P","P2","P4","J7","J8","J9","GR100km","GRremainder","LongZone","GR","Letters","Pos","LatZone","N100km","E100km","Deg2Rad","Area","F0","A1","B1","K0","N0","E0","N1","N2","N3","E2","Deg","Min","Sec","Lat","South","sin","cos","sqrt","ValidLongZone","ZoneCell","UTMCMfromLongZone","truncateDecimal","baseValue","decValue","returnValue","valString","dotIndex","isNegative","TM2LL","LatLong","EastCell","NorthCell","N","E","NRel","Finished","V3","Y1","Y12","K9","MGRS_Old","mgrsToDD","GRCell","isEven","S","LongZoneNumber","Posn","GRLength","LatZoneNumber","GRX","LatZoneLetter","Long100Letter","Lat100Letter","LongZoneMerid","Long100Number","LatZoneDeg","Lat100Number","ApproxLatZoneKm","LatKm","Neg","Diff","PrevDiff","GRY","Ndigits","X","Y","nn","HalfDigits","Mult","hj","noSpace","charCodeAt","getMetersPerDegAtLat","m1","m2","m3","m4","p1","p2","p3","latlen","longlen","getPointFromDistanceBearing","startLat","startLon","bearing","lat2","asin","lon2","atan2","getMidPoint","lat1","lon1","lat3","f1","tan","f2","f3","lon3","log","measureDistance","latitude1","longitude1","latitude2","longitude2","unitOfMeasure","acos","coordinateArrayToString","coordinateStringToArray","pairs","values","coordArr","validateLatLon","DegToRad","RadToDeg","c1","c2","theta","z","geodesic_coordinate","start","azimuth","pt","sm_a","a","b","c","d","f","g","h","l","n","IntersectLines","brng1","brng2","ptResult","brng13","brng23","dLon","dist12","brngA","brngB","brng12","brng21","alpha1","alpha2","alpha3","dist13","dLon13","doesBoundingBoxIntersect","bbox1","bbox2","bbox1a","bbox1b","bbox2a","bbox2b","left","right","BoundingBox","top","bottom","checkBboxOverlap","pointInBbox","bbox","bototm","checkBboxIntersects","tw","th","rw","rh","tx","ty","rx","ry","OUT_LEFT","OUT_TOP","OUT_RIGHT","OUT_BOTTOM","outcode","out","checkLineIntersectsBox","x1","y1","x2","y2","out1","out2","pointString","points","savedvalue","getBox","getBoxIDL","temp","latLongToUtm","numLat","numLong","numLongOrigin","numN","numT","numC","numAA","numM","numLongOriginRad","intZoneNumber","numUTMEasting","numUTMNorthing","strZone","numA","numEccSquared","numK0","numLongTemp","numLatRad","numLongRad","utmLetterDesignator","eccPrimeSquared","utmValue","strLetterDesignator","utmToLatLong","numZone","numEasting","numNorthing","blNorthernHemisphere","numE","numE1sq","numArc","numMu","numEi","numCa","numCb","numCc","numCd","numPhi1","numN0","numR0","numFact1","num_a1","numDd0","numFact2","numT0","numQ0","numFact3","numFact4","numLof1","numLof2","numLof3","num_a2","num_a3","numLatitude","numLongitude","toRad","toPrecisionFixed","toDeg","Bx","By","intersection","dPhi","q","dp","Geo","toLat","toLon","numb","sign","ceil","LOG10E","geojsonParser","adjustColor","adjustedColor","getPointKml","success","addGeoJsonPoint","zoom","fillColor","iconObj","getStyle","iconXOffset","iconYOffset","getLineStringKml","latlon","endChar","coordinateString","addGeoJsonLineString","lineColor","lineThickness","getPolygonKml","polygon","numRings","coordIdx","ringIdx","firstCoordinate","lastCoordinate","addGeoJsonPolygon","getMultiPointKml","overallResult","addGeoJsonMultiPoint","getMultiLineStringKml","lines","addGeoJsonMultiLineString","getMultiPolygonKml","polygons","addGeoJsonMultiPolygon","getGeomtryCollectionKml","addGeoJsonFeature","coloredRow","propertyName","geEngine","utils","popupContentHTML","addGeoJsonFeatureCollection","addGeoJsonGeometryCollection","geojsonToKmlBatch","batch","newBatch","err","geojsonToKml","argb","lineStyle","r","armyc2","c2sd","Color","rgbToHexString","polyStyle","iconStyle","timePrimitive","timeSpan","begin","end","timestamp","errorHandler","enumerateError","ecopy","fileName","file","lineNumber","line","columnNumber","column","debugLevel","logJSONArray","placeholder","methods","jsError","msgLog","jsErrorStr","MAJOR","MINOR","INFO","warn","unshift","pubSub","publish","set","getMessages","clearLog","exportLog","dataUrl","txtData","escape","jsonOutputStr","open","transactionQueue","outstandingTimerFunc","oOutstandingTransaction","intent","failures","outstandingTimeout","outstandingTimer","runQueue","transaction","oInstanceData","nextQueue","iListSize","oMapInstanceIdList","findQueueWithOldestTransaction","oMapInstanceData","running","transQueue","shift","transHash","intents","control","DRAW_BEGIN","EDIT_BEGIN","WMS_ADD","VIEW_SET","bViewSetProcessed","run","lowestTime","queueId","instanceData","creationTime","cancelTransaction","processHash","o","Transaction","DRAW_CANCEL","source","originChannel","EDIT_CANCEL","endTransaction","DRAW_END","EDIT_END","dispatch","event","instanceId","listeners","err2","mapInstanceData","pauseCnt","isTransactionOutStanding","sTransID","add","state","print","transactionQueueString","_complete","returnDuplicatesToItems","POINTER","STATIC_CONTENT","TRANSACTION_COMPLETE","_progress","TRANSACTION_PROGRESS","_custom","pause","listener","listenerInfo","callback","remove","callbackArray","newMapInstance","removeMapInstance","oTrans","purgeMapQueue","sMapInstanceId","dumpMapQueue","getMapQueueSize","editingManager","editTransaction","activeEditor","updateData","originalFeature","basicCode","symbolDef","unitDef","drawCategory","symbol","eventing","EditStart","update","updates","updateEventType","UpdateEventType","START","originFeature","getObjectData","getRootGuid","SymbolUtilities","getBasicSymbolID","SymbolDefTable","hasSymbolDef","getSymbolDef","UnitDefTable","getUnitDef","DRAW_CATEGORY_POINT","editors","EditorBase","addControlPoints","initFailList","EditEnd","removeControlPoints","FEATURE_ADD","sender","cmapi","names","MAP_FEATURE_PLOT","SOURCE","messageOriginator","originalMessageType","complete","item","updatedFeature","featureCopy","coordinateUpdate","COMPLETE","editMouseDown","mapLock","lockMapTransaction","Lock","VIEW_LOCK","MAP_VIEW_LOCK","editDragStart","pointer","isControlPoint","moveControlPoint","isFeature","editDragMove","startX","startY","moveFeature","UPDATE","editDragComplete","DRAW","EDIT","MENU","SELECTION","SELECTION_BOX","STATIC","STATUS","TRANSACTION","VIEW","LOOKAT","OVERLAY_CLUSTER","CoordinateUpdateType","REMOVE","ADD","BoundingBoxType","east","north","west","south","parentRelationship","visibilitySetting","milstd","getAOISymbolCode","aoiType","eAOIType","getModifiers","newModifiers","aoi","buffer","Modifiers","C_QUANTITY","ModifiersTG","H_ADDITIONAL_INFO_1","H1_ADDITIONAL_INFO_2","H2_ADDITIONAL_INFO_3","N_HOSTILE","Q_DIRECTION_OF_MOVEMENT","S_OFFSET_INDICATOR","T_UNIQUE_DESIGNATION_1","T1_UNIQUE_DESIGNATION_2","V_EQUIP_TYPE","W_DTG_1","W1_DTG_2","X_ALTITUDE_DEPTH","Y_LOCATION","AM_DISTANCE","AN_AZIMUTH","F_REDUCED_OR_REINFORCED","G_STAFF_COMMENTS","J_EVALUATION_RATING","K_COMBAT_EFFECTIVENESS","L_SIGNATURE_EQUIPMENT","M_HIGHER_FORMATION","P_IFF_SIF","Z_SPEED","AA_SPECIAL_C2_HEADQUARTERS","STANDARD","StringModifiers","FILL_COLOR","LINE_COLOR","X_OFFSET","X_UNITS","Y_OFFSET","Y_UNITS","SIZE","LINE_THICKNESS","HEADING","String2Modifier","mapping","longModifiers","s2525Modifiers","Modifier2String","convertModifiers2Strings","aStringModifiers","sModifier","convertStrings2Modifiers","oStringModifiers","convertToString","iValue","sRet","LatLonCoordinates","CoordinateUpdate","indices","geojsonCoordToLatLonCoordinates","oLLCoord","convertFromGeoJson","oCoordList","Convert","invalid","globalType","getVisibilityCount","iCount","isMultiParentRequired","oRelationship","sCoreId","parentNodes","isVisibilityAffected","sParentCoreId","bVisible","bSend","iPrevVisibilityCount","addAffectedChildren","oTransaction","oChild","oDupChild","oaItems","bAffected","sChildCoreId","nodes","isOnItemsList","createDuplicate","duplicate","getVisibilityWithParent","visibility","bGoDeep","setVisibilityWithParent","locate","View","getRootCoreId","oRootCoreId","multiParentRootId","getRootParent","hasChildren","hasParents","removeFromAllParent","oParent","oMultiParentRoot","aParentCoreIdList","getParentCoreIds","isUnderParent","removeFromOverlayFeatureList","oCurrentParent","removeFromFeatureList","removeAllChildrenFromOverlayFeatureList","oOverlay","addAllChildrenToOverlayFeatureList","isOnFeatureList","addToFeatureList","addToOverlayFeatureList","findOverlay","addParent","bVisibleSetting","addChild","parentCoreId","getChildrenCoreIds","childrenCount","parentCount","getChild","getParent","multiParentRequired","hasChildNodes","getChildNodesCoreIds","getVisibilitySettingWithParent","sParentCodeId","sParentID","bSetting","iCurrentVisibilityCount","isVisible","Date","now","sendTransactionComplete","originination","origination","intentParams","throttled","successes","fail","removedItem","MENU_CONTEXT_CREATE","menuId","VISIBILITY_GET","targetId","failInvalidItems","queue","sequenceNumber","lastNumber","closeNumber","inTask","runner","getSequence","forward","getNextItemSet","exit","prepItemsForExecution","checkTransactionSplicing","FEATURE_REMOVE","VISIBILITY_SET","SELECTION_SET","WMS_REMOVE","OVERLAY_ADD","OVERLAY_REMOVE","OVERLAY_UPDATE","sTempStr","pendingItems","iCumSize","iNextChunkSize","iItemCnt","originalMessage","duplicateItems","prepForExecution","pushToItemsList","tName","disabled","hidden","title","permissions","createParent","transactionType","oNewOverlay","stringFeature","objectFeature","OverlayStyle","enum","OverlayStyleType","POINT","MULTIGEOMETRY","Cluster","oClusterStyle","getOverlayId","iThreshold","getThreshold","iDistance","getDistance","getClusterStyle","Style","threshold","clusterStyle","getCoreId","oOveraly","oCS","oPointStyle","oIconStyle","sLabel","getLabel","sTitle","getTitle","sSummary","getSummary","sDescription","getDescription","getPointStyle","getIconStyle","PointStyle","IconStyle","label","summary","pointStyle","oPS","getRadius","oColor","getColor","radius","createIcon","getHexColor","getAlpha","iRed","getRed","iGreen","getGreen","iBlue","getBlue","dAlpha","sByte","getFullHexColor","oIS","sUrl","getURL","destOverlayId","destParentId","unescape","selected","tempCoreParentId","tempParent","altitudeMode","disable","createDestinationParent","destCoreId","destCoreParent","currentlyInEditMode","setEditMode","bValue","isInEditMode","getFeatureStructure","copyFromFeature","oFromFeature","oNewFeature","sCoreParent","oNodes","oParentNodes","oChildNodes","applyUpdate","findFeature","oParentOverlay","generateData","getXmlString","xmlObj","node","nodeType","nodeName","attributes","attrib","buildGeoJsonPoint","oNewCoordinates","geoJsonCoords","buildGeoJsonLineString","iLength","buildGeoJsonPolygon","buildGeoJsonFeature","oFeatureData","oGeometryData","coords","kmlDoc","coord","Static","Status","requester","status","about","filter","select","coordinateSystem","displayedCoordinateSystem","widgetName","universalName","instanceName","extensions","recursive","LookAt","range","tilt","heading","animate","roll","center","bounds","southWest","northEast","screenshot","oFeature","Menu","menu","tooltip","menuType","menuItems","active","itemId","Type","MAP_GLOBAL","OVERLAY_GLOBAL","FEATURE_GLOBAL","OBJECT_INSTANCE","SUBMENU","itemLabel","Pointer","oTemp","mgrs","popupInfo","content","button","clientX","clientY","screenX","screenY","elevation","menuItemId","EventType","MOVE","MOUSEUP","MOUSEDOWN","SINGLE_CLICK","DBL_CLICK","DRAG","DRAG_COMPLETE","ButtonType","LEFT_BUTTON","MIDDLE_BUTTON","RIGHT_BUTTON","KeyType","ALT_KEY","CTRL_KEY","SHIFT_KEY","NO_KEY","Draw","autoPopulate","iStdVersion","isMultiPoint","t","sTranID","checkApiSource","v3","v1Type","DRAW_UPDATE","oToAPITrans","FEATURE_OUTBOUND_PLOT","oToMapTran","MI_FEATURE_ADD","Types","PATH","CIRCLE","ELLIPSE","RECTANGLE","SQUARE","TEXT","Edit","storageEntry","sProp","EDIT_UPDATE","getParentByIndex","getFeatureId","outBoundTrans","newTrans","Selection","selectedId","selectedName","getId","_NOSELECT","SelectionBox","date","transparent","activeLayers","aTemp","layerHierarchy","loadSuccess","loadFail","visibleLayers","onCapabilitiesLoad","scope","xmlCapabilities","hierarchy","getParentFolderOfLayer","layerName","findFoldersOfLayer","sLayerName","oFolder","oFolderFound","folders","getParentFolderOfFolder","folderTitle","findParentOfFolder","onCapabilitiesFail","originSchema","bVisibility","getAllLayer","oaLayers","getLayers","oLayerList","oaLayerList","getLayersFromFolders","oFolders","oaTemp","getAllNamedFolders","getNamedFolders","oaFolderList","oaFoldersSelected","oaLayersSelected","selectFolder","sFolderName","isFolderSelected","unselectFolder","selectAllFolders","unselectAllFolders","selectLayer","isLayerSelected","unselectLayer","selectAllLayers","unselectAllLayers","oObj","oNewWMS","KmlLayer","kmlData","parentStorageEntry","childStorageEntry","visibleUnderParent","getParentCoreId","getChildCoreId","getVisibilitySettingOnMap","getVisibleUnderParentOnMap","isOnMap","setVisibilitySettingOnMap","setVisibleUnderParentOnMap","getMapInstanceList","ObjectRelationship","coreObjectType","EmpObject","visibleOnMap","parentObjects","childObjects","setProperties","oValue","setPropertyValue","sProperty","Value","setReadOnly","isReadOnly","isDisabled","setDisabled","removeFromMap","removeObjectFromMapRoot","getParentRelationshipList","getChildrenList","getParentRelationship","getName","setName","sName","setDescription","sDesc","isVisibleOnMap","setVisibleOnMap","getMapExtent","isDescendantOf","isChildOf","isParentOf","getParentMapInstanceList","aMapList","aRetList","oParentRelationshipList","isRoot","removeMapInstanceFromRelationship","aParentMapList","deleteParentEntry","aPrevMapList","aNewMapList","deleteChildEntry","childCoreId","rootCoreId","oRootOverlay","addObjectToMapRoot","addMapInstanceToRelationship","bParentVisible","oMapList","getAllFeatureChildren","oRetAssoArray","oAssoArray","getParentCoreIdsOnMap","aParentCoreIds","mapCount","aCoreIds","mapExtent","oChildList","compareValues","Value1","Value2","compareProperty","EmpRenderableObject","featureList","cluster","clusterActive","getParentId","getMenuId","setMenuId","getFeatureList","oNewOverlayData","EmpOverlay","EmpStaticContent","inEditMode","setMapExtent","verifyAltitudeMode","verifyMilStd","verifyReadOnly","setData","sData","sMenuId","setURL","getParams","setParams","coreParentId","oParams","basicSymbolID","bStdVersionNotFound","sNewFillColor","fillOpacity","sOpacity","sLineColor","lineOpacity","getMilStdVersion","canMapEnginePlot","canMapEngineEdit","oUpdateFeature","getCoordinateList","Err","oFeatureExtent","oCoordinateArray","EmpFeature","EmpMapService","parentFolder","visibleLayerList","bNewMapInstance","setActiveLayers","clearActiveLayers","add2ActiveLayers","hasVisibleLayers","getVisibleLayers","hasLayers","getActiveLayers","sLayer","getLayerHierarchy","EmpWMS","EmpWMTS","EmpKmlLayer","checkResourceType","resource","loadCSS","fileref","isScriptLoaded","sURL","sAbsUrl","script","querySelectorAll","loadScript","readyState","onreadystatechange","getStartupExtent","initialExtent","defaultExtent","centerLat","centerLon","loadNextResource","completed","resourceLen","engineBasePath","resources","loadComplete","configProperties","extent","loadResource","manifestSuccess","oResources","oMapRegistration","getMapEngineRegistration","fnInitialize","engineId","fnCreateInstance","resourceList","handlerStatusChange","states","INITIALIZING","READY","bReloadInProgress","voice","silence","setMapView","bLoadInProgress","MAP_INSTANCE_INIT_FAILED","handleTCDrawEditBegin","sDrawEditTransactionID","sDrawEditIntent","oDrawEditOperation","StatusChange","handleDrawEditStart","oStartEventTransaction","mapSwapSetViewcomplete","sMapSwapSetViewTransactionId","reload","oView","oViewCenter","dViewRange","storageReloadComplete","MAP_ENGINE_SWAP_COMPLETE","processEngineSwapRequest","bDoReload","isMapEngineLoading","MAP_SWAP_IN_PROGRESS","MAP_ENGINE_SWAP_START","prepForMapSwap","loadMapEngine","verifyManifestLoaded","previousMapEngineConfiguration","engines","isMapSwapInProgress","engineConfiguration","previousSwapFailed","load","visiblity","mapNode","firstChild","getTime","container","manifestUrl","mapInstanceStartupFailed","handleDrawEditEnded","handleDrawEditCanceled","bExecuteRemove","oRTran","oRemoveTransaction","oEditDrawTransaction","removeListeners","STATUS_CHANGE","DRAW_START","EDIT_START","DRAW_ENDED","EDIT_ENDED","STORAGE_RELOAD_COMPLETE","sManifestFile","currentStatus","sDefaultLayerOverlayID","freehandLineColorOverride","freehandLineWidthOverride","activeEngine","oViewBounds","engDirectDefault","ref","freehandMode","freehandModeDrawStart","freehandLineColor","freehandLineWidth","freehandFeature","freehandStart","FREEHAND_START","navigation","enable","strokeColor","strokeWidth","freehandStop","FREEHAND_STOP","setFreehandStrokeStyle","mapDrag","mapDragStart","silent","SelectionChange","SELECTION_CHANGE","ViewChange","viewArgs","lookAtArgs","mapViewEventEnum","view","CameraEventEnum","CAMERA_IN_MOTION","lookAt","VIEW_CHANGE","fTransaction","dragPointer","FREEHAND_LINE_DRAW_START","FREEHAND_LINE_DRAW_END","FREEHAND_LINE_DRAW_UPDATE","CLICK","FEATURE_CLICK","viewArea","StaticContent","newStatus","DrawStart","DrawEnd","oDraw","oEdit","getViewBounds","getViewCenter","getViewRange","getMapLockStatus","mapLockStatus","setMapLockStatus","validateState","bConfirmResponse","bSuccess","sErrorMsg","confirmationMessage","confirm","drawEditCancel","cancelDrawEditForOverlayRemove","sParentKey","bExecuteCancel","_storage","cancelDrawEditForFeatureRemove","sDrawEditKey","burstSoftLimit","isInitialLoadInProgress","validateOverlayRemoval","getDefaultLayerOverlayID","wms","manager","getWmsOverlayId","validateOverlayClear","drawEditComplete","bProceedWithSwap","sTempText","manifestName","engineDirect","loadResources","manifest","sManifestURL","engineName","findObject","MI_OVERLAY_ADD","oDefaultLayerOverlay","discardInstance","IDLE","FREEHAND","TEARDOWN","SHUTDOWN_IN_PROGRESS","cursor","ENABLED","DISABLED","createEngineTemplate","ENGINE_INTERFACE_CN","engineInterface","implementation","displayName","help","mapType","projection","flat","type2D","type2_5D","type3D","elevationData","version_1_0_0","ArcGIS","overlayClustering","labelOption","requirements","wmsCapabilities","succeed","mode","capture","deactivate","activate","getXYFromLatLon","getLatLonFromXY","mil2525","labels","wmts","kmllayer","selection","dispatchReady","isReady","readyCallbacks","checkReady","readyCount","environmentList","checkShutdown","dispatchShutdown","shutdownCallbacks","meesage","subscribeAll","subscribe","publishAll","MAP_VIEW_MOUSEMOVE","proxyEnvironment","env","environments","initcallback","shutdowncallback","iwcHost","createEnvironmentTemplate","setCallbacks","readyCB","shutdownCB","environmentInterface","unsubscribe","prefs","getInstanceId","launchTool","getToolInfo","contextMenuStorageManager","oContextMenuStorage","globalMenus","mapInstanceMenus","getMapMenuStorage","getMenuListfn","eType","mapMenuStorage","oMenuCollection","mapMenus","mapOverlayMenus","mapFeatureMenus","iItemIndex","oItems","ui","model","oMapInstanceMenus","iMenuItemIndex","sMenuItemId","aMenuItems","findMenuItem","aMenuIdList","oMenu","getFeatureMenuIdList","rObject","getMenuList","instances","removeMapInstanceFromStorage","oRootStorageEntry","store","rootGUID","removeParentFromChildren","deleteObject","empObject","instance","editUpdate","OVERLAY_CLUSTER_SET","clusterSet","OVERLAY_CLUSTER_ACTIVATE","clusterActivate","OVERLAY_CLUSTER_DEACTIVATE","clusterDeactivate","OVERLAY_CLUSTER_REMOVE","clusterRemove","removeSelectedList","readOnlyPermission","mapRootGUID","recurseUp","bContinueRecursion","oParentList","getPrimaryCount","removeFromParent","addToParent","oParentNode","aCoreIdList","numChildren","empFeature","mapList","prevMapList","transactions","updateItem","storeObject","processRequest","executeTransactions","_setChildrenOverlay","oChildItem","oListCopy","oTransactions","oNewItem","iMapIndex","oNewParent","sBasicSC1","sBasicSC2","addToObjectRemoveTransaction","oFeatureRemoveFromMapTransactions","oWMSRemoveFromMapTransactions","oWMTSRemoveFromMapTransactions","oKmlLayerRemoveFromMapTransactions","oObjectRemoveTransaction","oObjectAddTransaction","oFeatureAddToMapTransactions","oWMSAddToMapTransactions","oWMTSAddToMapTransactions","oKmlLayerAddToMapTransactions","featureUpdateTransactions","oObjectUpdatedTransaction","oEditItem","removeItems","oTempTransaction","oEmpOverlay","oTransactionList","aChildrenCoreIdList","processChildrenRemoves","addToRemoveTransaction","bFromUpdate","oOldParent","oParentValid","sPropertyField","validateParent","errorMsg","addToObjectUpdateTransaction","addToObjectAddTransaction","oDupItem","STORAGE_OBJECT_ADDED","STORAGE_OBJECT_REMOVED","STORAGE_OBJECT_CHILD_REMOVED","addToUpdateTransaction","transactionList","child","dupItem","MI_FEATURE_UPDATE","addToAddTransaction","bZoom","MI_WMS_ADD","MI_KML_LAYER_ADD","MI_WMTS_ADD","MI_FEATURE_REMOVE","MI_WMS_REMOVE","MI_WMTS_REMOVE","MI_MAP_LAYER_REMOVE","iChildrenCount","processChildrenAdds","oChildFeatures","iTempIndex","parentMapList","removeFromMapList","addToMapList","oOverlayItem","iParentCount","iParentIndex","oClusterDef","bClusterActive","staticContent","oEmpParent","sRootGUID","oStatus","aoItems","oNewItems","oNewTrans","MI_VISIBILITY_SET","setChildVisibilityRecursive","oParentEntry","setVisibilityTrans","oObject","bTraceUp","targetAttributes","findParent","parentTargetAttributes","isRootWMS","oError","checkChildrenVisibility","getState","visibilityState","VisibilityStateEnum","VISIBLE","VISIBLE_ANCESTOR_HIDDEN","HIDDEN","_selectedList","getSelectedList","getSelectionIndex","oSelection","oaSelectionList","bNoSelectedId","sCoreID","oSelectionItem","iSelectionIndex","selectionChange","oSelectionTransaction","oDeselectionTransaction","oSelectList","oDeselectList","SELECTION_OUTBOUND","DESELECTION_OUTBOUND","currentView","_status","replay","editBegin","validateUpdate","isMoveValid","sDestParentID","oDestParent","sDestOverlay","sDestParentId","oPayload","oParentCheck","aParentList","oRetStatus","editTransCplt","validateEdit","findParentOnMap","validateDraw","oDrawItem","validateAdd","validateCluster","objectType","oReturnStatus","mapservice","oMapIdList","oPrevMapList","oPrevMapIdList","searchEngine","oSearchCriteria","sRootCoreId","oCriteria","searchedEntries","searchChildren","oCurrentResultSet","oTypes","iMaxResults","globalTypeMatch","findChildrenNoFilter","bRecursive","searchChildrenWithFilter","oFilter","passesFilters","passesFeatureIdFilter","passesOverlayIdFilter","passesFilter","property","term","aoFilters","searchEntry","oaPropertyFilter","bRecurse","execute","oStorageRoot","sParentId","sChildId","bLookingForOverlay","bLookingForFeature","maxResults","currentResultSet","storageObject","query","oSearchEngine","oResultSet","oFilters","_checkForRoot","bAddRootStartingPoint","returnVar","findFeatureUnderFeature","findFeatureUnderOverlay","oEmpObject","iParentCnt","findParentOverlayOnMap","oEntry","_replay","MapReload","InstanceId","_struct","iItemsSent","iItemsCompleted","iMaxItemsPerIteration","hReloadTimer","startFireTimer","oThis","fire","structure","currentCoreId","oaLevels","iCurrentLevel","oRootFeatureList","buildStructure","iLevel","oFeatureList","sWMSParentID","oWMSParent","sWMSOverlayId","oFeatures","sCurrentType","itemCount","sPreviousType","rootId","stop","oOverlays","wmsServices","processTransactionComplete","oErrorInfo","_dropStaticContent","oChildEntry","aChildCoreIdList","oStore","controlPoints","controlPoint","controlPointFeatureId","createGUID","CMAPI_GENERIC_FEATURE_REMOVE","MAP_FEATURE_UNPLOT","oldCoordinates","newCoordinates","OWF","intervalCount","timer","setInterval","objectToLoad","clearInterval","failedcallback","onerror","checkSender","plotIntentKml","cmap","common_map","loadIntentKml","save","MAP_FEATURE_PLOT_URL","plotIntentJson","loadIntentJson","getJsonSuccess","getJsonFailure","$","getJSON","populateBounds","VIEW_GET","MAP_STATUS_REQUEST","registerWidgetIntents","Intents","receive","action","widgetState","Ozone","WidgetState","activateWidget","viewChangeHdlr","hViewChgTimer","handleStateEvent","msg","eventName","shutdownCallback","removeStateEventOverrides","events","closeWidget","owf35Unload","mapInit","widgetGuid","launchData","launchDataStr","transactionMessage","bInstallViewChangeListener","widgetEventingController","Widget","rpcRelayPath","Eventing","getWidgetId","BrowserDetect","pref","PrefServer","getWidget","widgetId","originalName","namespace","onFailure","autoInit","onStateEventReceived","addStateEventOverrides","getWidgetGuid","relayFile","Launcher","getLaunchData","parseJson","ownerId","senderId","isPrivateInstance","originatingChannel","details","Preferences","eventData","initCallback","getContainerVersion","ready","getServerVersion","serverVersion","owfLoadAttempted","configManager","owfJsLocation","appSetup","subscribedCallbacks","forwardMsg","forwardSubscribeMessages","channelCallback","closed","stopForwardingSubscribe","successCallback","failureCallback","setUserPreference","put","launchCallback","callbackArgs","statusCode","widgetLauncher","launcher","WidgetLauncher","launchWidget","guid","toolHandle","path","launchOnlyIfClosed","launch","getToolInfoSuccess","widgets","toolInfo","toolName","rows","toolhandle","widgetID","getToolName","getWidgetArgs","toolInf","errInfo","getToolInfoError","errorArgs","searchConfig","searchParams","widgetNameExactMatch","findWidgets","forwardMsgWindow","fwdMsg","mediator","stopForwardingPublish","forwardPublishedMessages","errorMessages","publishSynch","engineTemplate","cmd","conversionType","GET_LATLON_FROM_XY","MAP_CONVERT","GeoPosition","GET_XY_FROM_LATLON","nerve","com","octabits","Nerve","getChannel","achannel","channelLookup","iwcClient","Reference","lifespan","respondOn","callbackLookup","adjustChannelName","channelName","revertChannelName","recieveMessage","callbackList","newValue","ozpIwc","Client","closureArgs","that","connect","then","catch","createInstance","instanceDomId","containerId","startMapEngineId","destroyInstance","cName","watch","unwatch","wmsOverlayId","wmsOverlay","overlayTransaction","isApiSource","STATUS_RESET","STATUS_DESTROY","MODE_GET","MODE_SET","CAPTURE_SCREENSHOT","MP_FEATURE_ADD","MAP_SERVICE_ADD","MAP_SERVICE_REMOVE","WMTS_ADD","WMTS_REMOVE","KMLLAYER_ADD","KMLLAYER_REMOVE","MP_FEATURE_REMOVE","FEATURE_UPDATE","MAP_CONFIG","DRAW_COMPLETE","SELECTION_GET","SELECTION_CLEAR","OVERLAY_CLEAR","OVERLAY_STYLE","MP_OVERLAY_ADD","MP_OVERLAY_REMOVE","LAYER_ADD","LAYER_REMOVE","LAYER_UPDATE","LAYER_GET","LOOKAT_SET","GET","EVENT_MAP_CLICK","MIL_ICON_SIZE_SET","MIL_ICON_LABELS_SET","PROJECTION_ENABLE_FLAT","ENVIRONMENT_READY","STATUS_RESPONSE_ABOUT","STATUS_RESPONSE_FORMAT","STATUS_RESPONSE_SELECTED","STATUS_RESPONSE_INIT","STATUS_REQUEST_SCREENSHOT","STATUS_RESPONSE_COORD_SYSTEM","VIEW_COORDINATESYSTEM","MAP_CURSOR_MODE_SET","MAP_SWAP","EMP_UI_INSTANCE_INIT","MI_KML_LAYER_REMOVE","STORAGE_OBJECT_UPDATED","_func","SE","API","register","storageHandleSuccess","fnStorageHandler","transactionComplete","useNewEditing","intentSequenceMapper","oMapInstance","Click","publisher","CMAPI2_FEATURE_EVENT_ADD","process","CMAPI2_FEATURE_EVENT_UPDATE","CMAPI2_FEATURE_EVENT_REMOVE","support","genericFeatureRemove","statusChangeHdlr","response","fnResponse","getPref","raw","Storage","localStorage","savePref","clearPref","alert","handler","builder","progress","CMAPI2_VISIBILITY_GET","CMAPI2_MAP_CONFIG","CMAPI2_FREEHAND_START","CMAPI2_FREEHAND_STOP","CMAPI2_FREEHAND_LINE_DRAW","CMAPI2_MAP_DRAG","CMAPI2_MAP_DRAG_COMPLETE","CMAPI2_FEATURE_DRAG","CMAPI2_FEATURE_DRAG_COMPLETE","MAP_SHUTDOWN","MAP_MESSAGE_COMPLETE","MAP_MESSAGE_PROGRESS","MAP_MESSAGE_CANCEL","MAP_OVERLAY_CREATE","MAP_OVERLAY_REMOVE","MAP_OVERLAY_HIDE","MAP_OVERLAY_SHOW","MAP_OVERLAY_UPDATE","MAP_OVERLAY_STYLE","MAP_OVERLAY_CLUSTER_SET","MAP_OVERLAY_CLUSTER_ACTIVATE","MAP_OVERLAY_CLUSTER_DEACTIVATE","MAP_OVERLAY_CLUSTER_REMOVE","MAP_OVERLAY_CLEAR","MAP_FEATURE_DESELECTED","MAP_FEATURE_SELECTED","MAP_FEATURE_HIDE","MAP_FEATURE_SHOW","MAP_FEATURE_UPDATE","MAP_FEATURE_EDIT","MAP_FEATURE_DRAW","MAP_FEATURE_CLICKED","MAP_FEATURE_MOUSEUP","MAP_FEATURE_MOUSEDOWN","MAP_VIEW_ZOOM","MAP_VIEW_CENTER_OVERLAY","MAP_VIEW_CENTER_FEATURE","MAP_VIEW_CENTER_LOCATION","MAP_VIEW_CENTER_BOUNDS","MAP_VIEW_CLICKED","MAP_VIEW_MOUSEUP","MAP_VIEW_MOUSEDOWN","MAP_VIEW_AREA_SELECTED","MAP_VIEW_COORDINATESYSTEM","MAP_GET","MAP_MENU_CREATE","MAP_MENU_CLICKED","MAP_MENU_REMOVE","MAP_MENU_ACTIVE","MAP_STATUS_INITIALIZATION","MAP_STATUS_VIEW","MAP_STATUS_FORMAT","MAP_STATUS_ABOUT","MAP_STATUS_COORDINATESYSTEM","MAP_STATUS_SCREENSHOT","MAP_STATUS_SELECTED","MAP_ERROR","MAP_TRANSACTION_COMPLETE","MAP_STATUS_REQUEST_OVERLAYS","MAP_STATUS_REQUEST_OVERLAY","MAP_STATUS_REQUEST_FEATURE","MAP_STATUS_REQUEST_FEATURES","MAP_STATUS_OVERLAYS","MAP_STATUS_OVERLAY","MAP_STATUS_FEATURE","MAP_STATUS_FEATURES","MAP_MENU_DRAWING_COMPLETE","MAP_MENU_DRAWING_CREATE","MAP_MENU_DRAWING_REMOVE","MAP_FEATURE_PLOT_BATCH","MAP_FEATURE_UNPLOT_BATCH","MAP_FEATURE_SELECTED_BATCH","MAP_FEATURE_DESELECTED_BATCH","MAP_VIEW_LOOKAT_LOCATION","cmapiMapInstanceInterface","_widgetId","channels","messageHandler","oSender","callPublisher","intentChannelMap","sOriginChannel","SYMBOL_OUTBOUND_PLOT","MENU_CONTEXT_CLICK","MENU_DRAW_FEATURE","processMessage","cmapiInterface","sFirstMapInstanceId","broadcastChannels","setFirstInstanceId","aKeyList","setupFeatureProcessing","stopFeatureProcessing","createMapInstance","iMapInstanceCnt","cmapiMapInterface","destroyMapInstance","MAP_SYMBOL_FEATURE_PLOT","msgComplete","SUCCESS","MIXED","FAILURE","CANCELLED","MessageComplete","oFailure","oFailRec","MessageProgress","$schema","default","payloads","extension","deSelectedId","deSelectedName","mapStatusRequest","requestTypes","STATUS_REQUEST_ABOUT","STATUS_REQUEST_FORMAT","STATUS_REQUEST_VIEW","STATUS_REQUEST_SELECTED","STATUS_REQUEST_INIT","STATUS_REQUEST_COORD_SYSTEM","selectedFeatures","selectedFeature","configTransaction","labelTransaction","labelItem","configItem","prop","getMilStdLabelList","MilStdLabelSettingEnum","COMMON_LABELS","ALL_LABELS","xyTransaction","latlonTransaction","xyToLatlonItems","latlonToXYItems","MAP_FEATURE_CLEAR","featureTransaction","featureItems","cmapiBatchMsg","oaBatchPayload","sFormat","bReadOnly","mergeGeoJSONStyles","mapServiceTransaction","bUseProxy","mapServiceItems","bZoomTo","oaFeatures","sIntent","sTrasnID","asTypes","maxExtent","featureExtent","sCoordsystem","setFormat","featureToAdd","MapFreehandEventEnum","MAP_FREEHAND_LINE_DRAW_START","MAP_FREEHAND_LINE_DRAW_END","MAP_FREEHAND_LINE_DRAW_UPDATE","sErrorMessage","bErrorsPresent","oPointer","oSelectItems","oMessage","oMsgBuilder","build","oOveralys","oaformats","sprint","currentFormat","sField","defaultWMSOverlayId","defaultLayerOverlayId","selectedList","oDetail","oMsgCompletion","detail","messageComplete","empParent","oDetails","parentInfo","FEATURE_HIDE","FEATURE_SHOW","convert","empParentOverlayProperties","empParentOverlay","instanceRootId","OVERLAY_HIDE","OVERLAY_SHOW","oBounds","oWMS","oWMSs","oMsgProgress","itemInStorage","_isOzoneInitialized","_init","fixture","direction","handleMessage","updateHash","transCompleteHandler","Bcw.Map.Broadcast","purpose","BcwMapBrokerChannel","MAP_BROADCAST","MAP_BROKER","GRAPHICS_DRAW_EVENT","GRAPHIC_EVENT","MAP_EVENT","GRAPHIC_UPDATE","GRAPHIC_CLICK","GRAPHIC_DBL_CLICK","MAP_MOVE","MAP_READY","MAP_CLICKED","MAP_DBL_CLICKED","DataType","MIL_STD_SYMBOL","MIL_STD_MULTI_POINT","UNKNOWN","_featureHash","_overlayHash","scaleMultiplier","transactionWaitTimeout","iWaittime","tranQueue","oWaitTimer","recurseStrFixOutbound","removeFeature","isOverlay","addOverlay","typeLibraryArgs","translateToFeature","v1type","recurseStrFixInbound","createTransaction","addEffort","splitArgs","decodeParameters","translateToRemoveGraphic","sPayload","removeGraphic","removeEffort","addPoint","addCoreModifiersToProperties","addPointBatch","formatJSON","addMilStdPoint","createMilStdPointParams","addMilStdPointBatch","addMilStdSymbol","args2","createMilStdMultiPointParams","addMilStdMultiPointBatch","add3DShape","addLine","extrude","getLineKml","addPolygon","addKmlStringToOverlay","setVisibilityBatch","payloads2","removeGraphicBatch","graphics","removeWMS","removeUrl","addKml","addImageOverlay","addKmlFromString","iWMSCount","addWms","editFeature","gotoLocation","goToLocationWithScale","setScale","setView","goToLocationById","drawPolygon","drawLine","drawMil2525Symbol","sType","createModifiers","exp","exp2","exp3","oldModifiers","array","jQuery","strFix","sPattern1","strDeFix","sPattern2","coordinatesStringArray","coordinateComponents","coordinate","hotSpotX","hotSpotY","functionName","_callbackHash","sGlobalType","removeImageOverlay","removeKml","removeWms","goToLocationWithRange","goToLocation","ctrlKey","shiftKey","altKey","getKMLCoordinateString","sStrCoordinate","oKMLDoc","sStrCoord","isComplete","cleanupInstance","bDumpQ","oInstance","oKeyList","oUIComponent","domContainerId","domContainer","storageReloadStart","uiComponents","hCheckPendingTimer","bInitialLoadInProgress","bMapSwapInProgress","oPendingMapInstanceCreateList","oRegisteredMapEngines","clientCallback","clientShutdownCB","readyCallback","logLevel","buildInstance","initEngine","renderContainer","recorder","attempts","checkRendererFontsLoaded","RendererUtilities","fontsLoaded","MilStdIconRenderer","Render","startNextPendingMapInstance","oInstanceArgs","oMapEngine","oSettings","asLabels","mapProjectionFlat","registerMapEngine","consts","IFRAME_SHIM","domCont","instanceContainer","domTargetId","styleStrings","loadingPanel","loader","absmax","instanceStyle","containerStyle","flexStart","flexEnd","loadingPanelStatus","messageHolder","spinner","innerSpinner","innerCircle","loadingMessageSpan","loadingStatus","styleTag","instanceMap","head","styleSheet","createTextNode","alignSelf","className","record","recordButton","onclick","backgroundColor","stopButton","saveButton","clearButton","saveAnchor","lang","recording","entry","dataStr","recorderElem","click","fillPattern","solid","hatched","crossHatched","justification","typeface","REGULAR","BOLD","ITALIC","BOLDITALIC","MIL_STD_2525C","MIL_STD_2525B","acmType","ROUTE","CYLINDER","ORBIT","RADARC","POLYARC","TRACK","CURTAIN","IGeoAltitudeMode","_altitudeMode","defineProperty","enumerable","patchProps","propVal","IGeoTimeSpan","_begin","_end","IGeoPosition","_latitude","_longitude","_altitude","IGeoPositionGroup","inherit","_positions","_timeStamp","_timeSpans","IGeoPositionHistory","_positionHistory","IGeoCamera","IGeoBase","_tilt","_roll","_heading","IGeoLookAt","_range","IGeoBounds","_west","_east","_north","_south","IGeoView","_camera","_lookAt","_bounds","_scale","IGeoColor","_red","_green","_blue","_alpha","IGeoStrokeStyle","_strokeColor","_stipplingPattern","_stipplingFactor","_strokeWidth","IGeoFillStyle","_description","_fillColor","_fillPattern","IGeoIconStyle","_size","_offSetX","_offSetY","IGeoLabelStyle","_color","_outlineColor","_justification","_fontFamily","_typeface","_name","_geoId","randomUUID","_dataProviderId","_properties","IGeoContainer","_readOnly","IGeoRenderable","_labelStyle","_strokeStyle","_fillStyle","_extrude","_tessellate","_buffer","_azimuth","IGeoPoint","_iconStyle","_iconURI","IGeoText","IGeoPolygon","IGeoPath","IGeoCircle","IGeoEllipse","_semiMajor","_semiMinor","IGeoRectangle","_width","_height","IGeoSquare","IGeoImageOverlay","_imageURI","IGeoMilSymbol","_symbolStandard","_symbolCode","_modifiers","IGeoAirControlMeasure","_acmType","_attributes","IGeoDocument","_documentURI","_documentMIMEType","info","S4","toArray","convertToKilometers","measurement","units","isString","timeStamp","tessellate","convertAltitudeMode","labelStyle","labelColor","outlineColor","labelScale","family","strokeDashstyle","strokePattern","semiMinor","semiMajor","stippleFactor","stipplePattern","iconURI","offsetY","offsetX","newAltitudeMode","val","convertCMAPIPropertiesToFeature","convertLocationArrayToCMAPI","newLocations","convertGeoJsonToCMAPIPositions","GeoJSONData","KMLString","convertStatusType","MapStateEnum","INIT_IN_PROGRESS","SHUTDOWN","buildFeature","standardArgs","Path","Polygon","Square","Rectangle","Circle","Ellipse","MilStdSymbol","AirControlMeasure","GeoJSON","buildOverlay","dataProviderId","CAMERA_MOTION_STOPPED","ContainerEventEnum","OBJECT_ADDED","OBJECT_REMOVED","FeatureDrawEventEnum","DRAW_CANCELLED","FeatureEditEventEnum","EDIT_CANCELLED","EDIT_COMPLETE","FeatureEditUpdateType","ACM_ATTRIBUTE_UPDATED","COORDINATE_ADDED","COORDINATE_MOVED","COORDINATE_DELETED","FEATURE_PROPERTY_UPDATED","MILSTD_MODIFIER_UPDATED","POSITION_UPDATED","FeatureEventEnum","FEATURE_DESELECTED","FEATURE_SELECTED","IconSizeEnum","LARGE","MEDIUM","SMALL","TINY","MapEventEnum","STATE_CHANGE","MAP_ENTERED_FREEHAND_DRAW_MODE","MAP_EXIT_FREEHAND_DRAW_MODE","MapMotionLockEnum","NO_MOTION","NO_PAN","NO_ZOOM","NO_ZOOM_NO_PAN","SMART_MOTION","UNLOCKED","MAP_NEW","MapViewEventEnum","VIEW_IN_MOTION","VIEW_MOTION_STOPPED","REQUIRED_LABELS","UserInteractionEventEnum","CLICKED","DOUBLE_CLICKED","LONG_PRESS","MOUSE_DOWN","MOUSE_UP","MOUSE_MOVE","UserInteractionMouseButtonEventEnum","MIDDLE","UserInteractionKeyEventEnum","CTRL","ALT","SHIFT","VisibilityActionEnum","HIDE_ALL","SHOW_ALL","TOGGLE_OFF","TOGGLE_ON","WMSVersionEnum","VERSION_1_1","VERSION_1_1_1","VERSION_1_3","CAMERA_EVENT","CONTAINER","FEATURE_DRAW","FEATURE_EDIT","FEATURE_EVENT","FEATURE_INTERACTION","LOOKAT_EVENT","MAP_CURSOR_MOVE","MAP_FEATURE_ADDED","MAP_FEATURE_UPDATED","MAP_FEATURE_REMOVED","MAP_INTERACTION","MAP_FREEHAND_DRAW_EVENT","MAP_STATE_CHANGE","MAP_VIEW_CHANGE","OVERLAY_CHANGE","VISIBILITY","messageCompletionStatus","mapShutdown","swap","convertResponse","styleOverlay","clearFeatures","overlayClusterSet","overlayClusterActivate","overlayClusterDeactivate","overlayClusterRemove","featureEdit","unplotFeature","hideFeature","showFeature","featureSelected","featureDeselected","featureClicked","featureMouseDown","featureMouseUp","clearMap","statusScreenshot","menuCreate","menuClicked","menuRemove","menuSetVisible","centerOnOverlay","centerOnFeature","centerOnLocation","centerOnBounds","lookAtLocation","lockView","clicked","mouseup","mousedown","mousemove","statusRequest","statusInitialization","statusView","statusFormat","statusAbout","statusCoordinateSystem","statusSelected","messageProgress","menuDrawingCreate","menuDrawingComplete","menuDrawingRemove","getVisibility","featureAddEvent","featureUpdateEvent","featureRemoveEvent","freehandLineDraw","drag","dragComplete","featureDrag","featureDragComplete","defaultMilStdLabelSetting","defaultMidDistanceThreshold","defaultFarDistanceThreshold","defaultIconSize","defaultOverlayId","Layers","Container","eventType","clearContainer","getParents","getChildren","CameraManager","_mapToCamera","setCameraForMap","camera","Camera","TypeError","Map","INVALID_MAP_TYPE_ERROR","getCameraForMap","getMapsForCamera","cameraId","INVALID_CAMERA_TYPE_ERROR","maps","removeCameraForMap","LookAtManager","_mapToLookAt","setLookAtForMap","getLookAtForMap","getMapsForLookAt","lookAtId","INVALID_LOOKAT_TYPE_ERROR","removeLookAtForMap","sendMessage","validMode","addCameraEventListener","mapIt","lookupMap","getCamera","copySettingsFrom","getLookAt","mhInstance","urlEnv","drawTransaction","backgroundBrightness","renderingOptimization","mapInstantiatedSuccess","cbArgs","registerMap","spawnMap","mapWidgetName","notifyOnReady","addMapService","readyCheck","addOverlays","cancelDraw","cancelEdit","completeDraw","completeEdit","drawFeature","onDrawError","startCallback","onDrawStart","updateCallback","onDrawUpdate","completeCallback","onDrawComplete","cancelCallback","onDrawCancel","drawFreehand","freehandCallback","onFreehandEvent","drawFreehandExit","setFreehandStyle","initialStyle","onEditStart","onEditUpdate","onEditComplete","onEditCancel","onEditError","errorMessage","getFarDistanceThreshold","getIconSize","getMidDistanceThreshold","setFarDistanceThreshold","setIconSize","setMidDistanceThreshold","getMilStdLabels","setMilStdLabels","labelSetting","setVisibility","featureIds","overlayIds","featureCallbacks","overlayCallbacks","getAllOverlays","getMapServices","getAllFeatures","getBounds","getScreenCapture","purge","setBounds","setCamera","setLookAt","removeOverlays","removeMapService","services","service","zoomTo","containerToGeo","geoToContainer","containerOffset","screenToGeo","box","getBoundingClientRect","pageYOffset","scrollTop","clientTop","pageXOffset","scrollLeft","clientLeft","geoToScreen","setMotionLockMode","swapMapEngine","getInstanceVisibility","mapGeoId","getVisibilityTransaction","setSelectionStyle","isSelected","deselectFeature","deselectFeatures","selectFeature","selectFeatures","clearSelected","setBackgroundBrightness","getBackgroundBrightness","addFeature","addFeatures","getFeatures","includeVisibleFeaturesOnly","getOverlays","removeFeatures","MapService","_url","_useProxy","setVisible","writable","_version","_layers","_tileFormat","_transparent","_style","_layer","_sampleDimensions","KMLLayer","_kmlString","_featureType","idx","numPositions","getChildFeatures","getParentFeatures","getParentOverlays","minAlt","maxAlt","badArgFound","_fontSize","_typeFaceStyle","timeSpans","_KMLString","_GeoJSONData","joinDetails","PrivateConstructor","isEnvironmentReady","messageCallbackHash","statusRequestPendingList","initialization","coordinatesystem","mapReadyCallback","eventListeners","getEventListeners","handleMapCursorMove","handleStatusView","eventListener","isAMapReady","mapHash","returnedTransaction","MessageFactory","constructPayload","validatePayload","mapSwap","tempArray","splitPayload","queuedMessage","publishData","remainingPayload","getEnvironment","unregisterMap","checkEnvReady","messageRef","handleMapShutdownTransactionComplete","handleGetVisibilityTransactionComplete","handleMapStatus","previousState","removeSuccess","MapStateChangeEvent","handleMapConvert","handleMessageProgress","sOriginalChannel","handleEdit","handleDraw","generateFeatureAddEvents","affectedChildren","containerEvent","ContainerEvent","affectedChild","generateFeatureDeletedEvents","generateOverlayUpdatedEvents","eventHandlers","OverlayUpdatedEvent","generateOverlayAddEvents","generateOverlayDeletedEvents","generateVisibilityEvent","parentContainer","targetContainer","visibilityEvent","containers","VisibilityEvent","handleTransactionComplete","eventArgs","drawEventCallbacks","editEventCallbacks","handleCallback","missingMessageError","handleCancel","FeatureDrawEvent","FeatureEditEvent","manageDeselection","manageSelection","handleFreehand","msgPayload","broker","ResponseBrokerFactory","getBroker","handleCenterOnBoundsTransactionComplete","handleZoomTransactionComplete","handleCenterOnFeatureTransactionComplete","handleCenterOnLocationTransactionComplete","handleLookAtLocationTransactionComplete","handleUnplotFeatureTransactionComplete","handleDrawEditTransactionComplete","missingParameterError","mapViewCallbacks","cameraCallbacks","lookAtCallbacks","executeCallbacks","cameraEvent","lookAtEvent","mapViewEvent","callbacksArray","CameraEvent","MapViewChangeEvent","handleStatusAboutResponse","handleStatusFormatResponse","handleStatusScreenshot","handleOverlaysStatus","overlayArray","buildOverlayArray","owner","readonly","handleOverlayStatus","handleStatusSelected","handleStart","handleUpdate","updateList","handleComplete","changedAttribute","changedModifier","coordinateIndexes","updateType","mapCursorMoveEvent","handleMapClick","clickType","MapUserInteractionEvent","handleFeatureClick","FeatureUserInteractionEvent","handleConvertResponse","handleRemoveFeatureTransactionComplete","layerIds","multiPointStyle","polygonStyle","mark","wellKnownName","graphicHeight","graphicWidth","selectionHash","removeSelection","setDrawCallbackHash","drawListenerCallbackHash","startDrawCallback","drawCallback","completeDrawCallback","cancelDrawCallback","errorDrawCallback","rc","publishSync","timeElapsedSinceLastUpdate","updateTime","updateTimer","handleFeatureAdd","handleFeatureEvent","handleFeatureUpdate","handleFeatureRemove","cmapiFeature","myevent","MapFeatureRemovedEvent","MapFeatureAddedEvent","MapFeatureUpdatedEvent","geoPositions","MapFreehandEvent","positionGroup","_urlProxy","uuid","findContainer","_messageHash","registerMessage","serialize","_responseBrokers","registerBroker","ResponseBroker","hashId","createdFeatures","quickHash","methodCalled","Event","_event","_target","_type","UserInteractionEvent","_keys","_button","_position","_point","MapCursorMoveEvent","_positionGroup","_map","_affectedChildren","targetIsFeature","targetIsOverlay","targetIsMap","_previousState","FeatureEvent","_updateList","_features","_parent","addToOWFQueue","owfReadyCallbackQueue","getConfig","xhr","configData","XMLHttpRequest","encodeURI","responseText","send","scriptLoadAttempt","configLocation","ignore","logEntry","starfishjslocation","receiveMessage","address","disconnect"],"mappings":"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","file":"emp3.min.js","sourcesContent":["/*globals emp, Geo, trim*/\r\n/* eslint-disable */\r\n/**\r\n * Used to convert various measurements to other formats\r\n * @type {Object}\r\n * @namespace emp.geoLibrary\r\n *\r\n */\r\nemp.geoLibrary = {\r\n\r\n  METERS_PER_DEG: 111319.49079327357264771338267056,\r\n\r\n  Point: function (x, y) {\r\n    /*this.x = null;\r\n     this.y = null;\r\n     if (x != null)\r\n     this.x = x;\r\n     if (y != null)\r\n     this.y = y;*/\r\n    return {\r\n      x: x,\r\n      y: y\r\n    };\r\n  },\r\n\r\n\r\n  metersPerPixel: function (scale) {\r\n    var inchPerMeter = 39.3700787,\r\n      pixelsPerInch = 96,\r\n      step1 = scale / pixelsPerInch;\r\n    return step1 / inchPerMeter;\r\n  },\r\n\r\n  ddToMGRS: function (latDD, longDD) {\r\n    var NS = \"N\",\r\n      EW = \"E\",\r\n      lat,\r\n      lng;\r\n\r\n    if (latDD < 0) {\r\n      latDD = Math.abs(latDD);\r\n      NS = \"S\";\r\n    }\r\n    if (longDD < 0) {\r\n      longDD = Math.abs(longDD);\r\n      EW = \"W\";\r\n    }\r\n    lat = emp.geoLibrary.ddToDMS(latDD);\r\n    lng = emp.geoLibrary.ddToDMS(longDD);\r\n    return emp.geoLibrary.dmsToMGRS(lat.deg, lat.minute, lat.sec, lng.deg, lng.minute, lng.sec, NS, EW);\r\n  },\r\n\r\n  ddToDMS: function (decDeg) {\r\n    var deg = Math.abs(decDeg),\r\n      DMS = {},\r\n      sec;\r\n    DMS.deg = Math.abs(Math.floor(deg));\r\n    DMS.minute = Math.floor(Math.abs(deg - DMS.deg) * 60);\r\n    sec = (((deg - DMS.deg) * 60) - DMS.minute) * 60;\r\n    DMS.sec = sec;\r\n    return DMS;\r\n  },\r\n\r\n  deg2rad: function (deg) {\r\n    var conv_factor = (2.0 * Math.PI) / 360.0;\r\n    return (deg * conv_factor);\r\n  },\r\n\r\n  dmsToMGRS: function (latDegrees, latMinutes, latSeconds, longDegrees, longMinutes, longSeconds, NS, EW) {\r\n    //with (Math) {\r\n    var Deg2Rad = Math.PI / 180.0,\r\n      Area = \"UTM2\",\r\n      // UTM WGS84 Ellipsoid\r\n      F0 = 0.9996,\r\n      A1 = 6378137.0 * F0,\r\n      B1 = 6356752.3142 * F0,\r\n      K0 = 0,\r\n      N0 = 0,\r\n      E0 = 500000,\r\n      N1 = (A1 - B1) / (A1 + B1),\r\n      // n\r\n      N2 = N1 * N1,\r\n      N3 = N2 * N1,\r\n      E2 = ((A1 * A1) - (B1 * B1)) / (A1 * A1),\r\n      // e^2\r\n      Deg = latDegrees,\r\n      Min = latMinutes,\r\n      Sec = latSeconds,\r\n      Lat = Math.abs(Deg) + Math.abs(Min) / 60.0 + Math.abs(Sec) / 3600.0,\r\n      South = ((NS.toUpperCase() === 'S') && (Lat > 0)),\r\n      West,\r\n      North,\r\n      East,\r\n      IEast,\r\n      INorth,\r\n      EastStr,\r\n      NorthStr,\r\n      Long,\r\n      K,\r\n      L,\r\n      SINK,\r\n      COSK,\r\n      TANK,\r\n      TANK2,\r\n      COSK2,\r\n      COSK3,\r\n      K3,\r\n      K4,\r\n      Merid,\r\n      MeridWest,\r\n      L0,\r\n      J3,\r\n      J4,\r\n      J5,\r\n      J6,\r\n      M,\r\n      Temp,\r\n      V,\r\n      R,\r\n      H2,\r\n      P,\r\n      P2,\r\n      P4,\r\n      J7,\r\n      J8,\r\n      J9,\r\n      GR100km,\r\n      GRremainder,\r\n      LongZone,\r\n      GR,\r\n      Letters,\r\n      Pos,\r\n      LatZone,\r\n      N100km,\r\n      E100km;\r\n\r\n    if (South) {\r\n      Lat = -Lat;\r\n    }\r\n\r\n    Deg = longDegrees;\r\n    Min = longMinutes;\r\n    Sec = longSeconds;\r\n    West = (EW.toUpperCase() === 'W');\r\n    Long = 1.0 * Math.abs(Deg) + Math.abs(Min) / 60.0 + Math.abs(Sec) / 3600.0;\r\n    if (West) {\r\n      Long = -Long;\r\n    }\r\n    K = Lat * Deg2Rad;\r\n    L = Long * Deg2Rad;\r\n    SINK = Math.sin(K);\r\n    COSK = Math.cos(K);\r\n    TANK = SINK / COSK;\r\n    TANK2 = TANK * TANK;\r\n    COSK2 = COSK * COSK;\r\n    COSK3 = COSK2 * COSK;\r\n    K3 = K - K0;\r\n    K4 = K + K0;\r\n    Merid = Math.floor((Long) / 6) * 6 + 3;\r\n    if ((Lat >= 72) && (Long >= 0)) {\r\n      if (Long < 9) {\r\n        Merid = 3;\r\n      } else if (Long < 21) {\r\n        Merid = 15;\r\n      } else if (Long < 33) {\r\n        Merid = 27;\r\n      } else if (Long < 42) {\r\n        Merid = 39;\r\n      }\r\n    }\r\n    if ((Lat >= 56) && (Lat < 64)) {\r\n      if ((Long >= 3) && (Long < 12)) {\r\n        Merid = 9;\r\n      }\r\n    }\r\n    MeridWest = Merid < 0;\r\n    L0 = Merid * Deg2Rad;\r\n    // Long of True Origin (3,9,15 etc)\r\n    // ArcofMeridian\r\n    J3 = K3 * (1 + N1 + 1.25 * (N2 + N3));\r\n    J4 = Math.sin(K3) * Math.cos(K4) * (3 * (N1 + N2 + 0.875 * N3));\r\n    J5 = Math.sin(2 * K3) * Math.cos(2 * K4) * (1.875 * (N2 + N3));\r\n    J6 = Math.sin(3 * K3) * Math.cos(3 * K4) * 35 / 24 * N3;\r\n    M = (J3 - J4 + J5 - J6) * B1;\r\n    // VRH2\r\n    Temp = 1 - E2 * SINK * SINK;\r\n    V = A1 / Math.sqrt(Temp);\r\n    R = V * (1 - E2) / Temp;\r\n    H2 = V / R - 1.0;\r\n    P = L - L0;\r\n    P2 = P * P;\r\n    P4 = P2 * P2;\r\n    J3 = M + N0;\r\n    J4 = V / 2 * SINK * COSK;\r\n    J5 = V / 24 * SINK * (COSK3) * (5 - (TANK2) + 9 * H2);\r\n    J6 = V / 720 * SINK * COSK3 * COSK2 * (61 - 58 * (TANK2) + TANK2 * TANK2);\r\n    North = J3 + P2 * J4 + P4 * J5 + P4 * P2 * J6;\r\n    if (((Area === 'UTM1') || (Area === 'UTM2')) && South) {\r\n      North = North + 10000000.0;\r\n      // UTM S hemisphere\r\n    }\r\n    J7 = V * COSK;\r\n    J8 = V / 6 * COSK3 * (V / R - TANK2);\r\n    J9 = V / 120 * COSK3 * COSK2;\r\n    J9 = J9 * (5 - 18 * TANK2 + TANK2 * TANK2 + 14 * H2 - 58 * TANK2 * H2);\r\n    East = E0 + P * J7 + P2 * P * J8 + P4 * P * J9;\r\n    IEast = Math.round(East);\r\n    INorth = Math.round(North);\r\n    // should strictly be trunc\r\n    EastStr = '';\r\n    EastStr = EastStr + Math.abs(IEast);\r\n    NorthStr = '';\r\n    NorthStr = NorthStr + Math.abs(INorth);\r\n    while (EastStr.length < 7) {\r\n      EastStr = '0' + EastStr;\r\n    }\r\n    while (NorthStr.length < 7) {\r\n      NorthStr = '0' + NorthStr;\r\n    }\r\n    GR100km = EastStr.substring(1, 2) + NorthStr.substring(1, 2);\r\n    GRremainder = EastStr.substring(2, 7) + \" \" + NorthStr.substring(2, 7);\r\n\r\n    if ((Area === 'UTM1') || (Area === 'UTM2')) {\r\n      // UTM\r\n      LongZone = (Merid - 3) / 6 + 31;\r\n      if (LongZone % 1 !== 0) {\r\n        //non-UTM central meridian\r\n        GR = null;\r\n      } else {\r\n        if (IEast < 100000 || Lat < -80 || IEast > 899999 || Lat >= 84) {\r\n          // outside UTM grid area\r\n          GR = null;\r\n        } else {\r\n          Letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ';\r\n          Pos = Math.round(Lat / 8 - 0.5) + 10 + 2;\r\n          LatZone = Letters.substring(Pos, Pos + 1);\r\n          if (LatZone > 'X') {\r\n            LatZone = 'X';\r\n          }\r\n          Pos = Math.round(Math.abs(INorth) / 100000 - 0.5);\r\n          while (Pos > 19) {\r\n            Pos = Pos - 20;\r\n          }\r\n          if (LongZone % 2 === 0) {\r\n            Pos = Pos + 5;\r\n            if (Pos > 19) {\r\n              Pos = Pos - 20;\r\n            }\r\n          }\r\n          N100km = Letters.substring(Pos, Pos + 1);\r\n\r\n          Pos = GR100km / 10 - 1;\r\n          P = LongZone;\r\n          while (P > 3) {\r\n            P = P - 3;\r\n          }\r\n          Pos = Pos + ((P - 1) * 8);\r\n          E100km = Letters.substring(Pos, Pos + 1);\r\n          GR = LongZone + LatZone + ' ' + E100km + N100km + ' ' + GRremainder;\r\n        }\r\n      }\r\n      return GR;\r\n    }\r\n\r\n    return \"Did not convert correctly\";\r\n  },\r\n  ValidLongZone: function (ZoneCell) {\r\n    if ((ZoneCell < 1) || (ZoneCell > 60)) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  },\r\n  UTMCMfromLongZone: function (ZoneCell) {\r\n    if (!this.ValidLongZone(ZoneCell)) {\r\n      return -181; //\"#INVALID LONGITUDE ZONE\";\r\n    } else {\r\n      return (ZoneCell - 1) * 6 - 180 + 3;\r\n    }\r\n  },\r\n\r\n  truncateDecimal: function (value) {\r\n    var precision = 5,\r\n      returnValue = value,\r\n      valString = value.toString(),\r\n      dotIndex = valString.indexOf(\".\"),\r\n      baseValue,\r\n      decValue,\r\n      isNegative = valString.indexOf(\"-\"); //Added by AOrechovesky because this does not take into acount\r\n    //negative coords that do not have a base (i.e. -0.7)\r\n    if (dotIndex !== -1) {\r\n      if (dotIndex + precision <= valString.length) {\r\n        baseValue = parseFloat(valString.substr(0, dotIndex));\r\n        decValue = parseFloat(valString.substr(dotIndex, precision + 1));\r\n        //if \"isNegative\" means that it found a \"no base value\"\r\n        //negative number\r\n        if (baseValue < 0 || isNegative !== -1) {\r\n          if (decValue === 0.99999) {\r\n            baseValue -= 1;\r\n            decValue = 0.0;\r\n          }\r\n          returnValue = baseValue - decValue;\r\n        } else {\r\n          if (decValue === 0.99999) {\r\n            baseValue += 1;\r\n            decValue = 0.0;\r\n          }\r\n          returnValue = baseValue + decValue;\r\n        }\r\n      }\r\n    }\r\n    return returnValue;\r\n  },\r\n  TM2LL: function (LatLong, EastCell, NorthCell, Merid) {\r\n    var Area = 4,\r\n      Deg2Rad = 3.14159265358979 / 180,\r\n      MGRS_Old = (Area < 0),\r\n      F0,\r\n      A1,\r\n      B1,\r\n      K0,\r\n      L0,\r\n      N0,\r\n      N1,\r\n      N2,\r\n      N3,\r\n      E0,\r\n      E2,\r\n      N,\r\n      E,\r\n      NRel,\r\n      K,\r\n      K3,\r\n      K4,\r\n      J3,\r\n      J4,\r\n      J5,\r\n      J6,\r\n      M,\r\n      Finished,\r\n      SINK,\r\n      COSK,\r\n      TANK,\r\n      TANK2,\r\n      Temp,\r\n      V,\r\n      R,\r\n      H2,\r\n      V3,\r\n      Y1,\r\n      Y12,\r\n      K9,\r\n      J7,\r\n      J8,\r\n      J9,\r\n      L;\r\n\r\n    if (MGRS_Old) {\r\n      Area = -Area;\r\n    }\r\n    if (Area === 4) {\r\n      // ' UTM WGS84 Ellipsoid\r\n      F0 = 0.9996;\r\n      //' Local scale factor on Central Meridian\r\n      A1 = 6378137 * F0;\r\n      // ' Major Semi-axis, WGS84 ellipsoid\r\n      B1 = 6356752.3142 * F0;\r\n      // ' Minor Semi-axis, WGS84 ellipsoid\r\n      K0 = 0;\r\n      // ' Lat of True Origin\r\n      L0 = Merid * Deg2Rad;\r\n      // ' Long of True Origin (3,6,9 etc)\r\n      N0 = 0;\r\n      // ' Grid Northing of True Origin (m)\r\n      E0 = 500000;\r\n      // ' Grid Easting of True Origin (m)\r\n    } else {\r\n      return -181; //\"#INVALID AREA 8\";\r\n    }\r\n\r\n    N1 = (A1 - B1) / (A1 + B1);\r\n    // ' n\r\n    N2 = N1 * N1;\r\n    N3 = N2 * N1;\r\n    E2 = ((A1 * A1) - (B1 * B1)) / (A1 * A1);\r\n    // ' e^2\r\n    N = NorthCell;\r\n    E = EastCell;\r\n    NRel = N - N0;\r\n    K = NRel / A1 + K0;\r\n\r\n    while (!Finished) {\r\n      K3 = K - K0;\r\n      K4 = K + K0;\r\n      J3 = K3 * (1 + N1 + 1.25 * (N2 + N3));\r\n      J4 = Math.sin(K3) * Math.cos(K4) * (3 * (N1 + N2 + 0.875 * N3));\r\n      J5 = Math.sin(2 * K3) * Math.cos(2 * K4) * (1.875 * (N2 + N3));\r\n      J6 = Math.sin(3 * K3) * Math.cos(3 * K4) * 35 / 24 * N3;\r\n      M = (J3 - J4 + J5 - J6) * B1;\r\n      Finished = Math.abs(NRel - M) < 0.001;\r\n      if (!Finished) {\r\n        K = K + (NRel - M) / A1;\r\n      }\r\n    }\r\n    SINK = Math.sin(K);\r\n    COSK = Math.cos(K);\r\n    TANK = SINK / COSK;\r\n    TANK2 = TANK * TANK;\r\n    Temp = 1 - E2 * SINK * SINK;\r\n    V = A1 / Math.sqrt(Temp);\r\n    R = V * (1 - E2) / Temp;\r\n    H2 = V / R - 1;\r\n    V3 = V * V * V;\r\n    Y1 = E - E0;\r\n    Y12 = Y1 * Y1;\r\n    J3 = TANK / (2 * R * V);\r\n    J4 = TANK / (24 * R * V3) * (5 + 3 * TANK2 + H2 - 9 * TANK2 * H2);\r\n    J5 = TANK / (720 * R * Math.pow(V, 5)) * (61 + 90 * TANK * TANK + 45 * Math.pow(TANK, 4));\r\n    K9 = K - Y12 * J3 + Y12 * Y12 * J4 - Math.pow(Y1, 6) * J5;\r\n    J6 = 1 / (COSK * V);\r\n    J7 = 1 / (COSK * 6 * V3) * (V / R + 2 * TANK2);\r\n    J8 = 1 / (COSK * 120 * Math.pow(V, 5)) * (5 + 28 * TANK * TANK + 24 * Math.pow(TANK, 4));\r\n    J9 = 1 / (COSK * 5040 * Math.pow(V, 7));\r\n    J9 = J9 * (61 + 662 * TANK * TANK + 1320 * Math.pow(TANK, 4) + 720 * Math.pow(TANK, 6));\r\n    L = L0 + Y1 * J6 - Y1 * Y12 * J7 + Math.pow(Y1, 5) * J8 - Math.pow(Y1, 7) * J9;\r\n    //var L = L0 + Y1 * J6 - Y1 * Y12 * J7 + Y1 ^ 5 * J8 - Y1 ^ 7 * J9;\r\n    K = K9;\r\n    if (LatLong.toUpperCase() === \"LATITUDE\") {\r\n      //return -181;//\r\n      return this.truncateDecimal(K / Deg2Rad);\r\n      //'TM2LL = Int(K / Deg2Rad * 100000 + 0.5) / 100000\r\n    } else if (LatLong.toUpperCase() === \"LONGITUDE\") {\r\n      return this.truncateDecimal(L / Deg2Rad);\r\n      //'TM2LL = Int(L / Deg2Rad * 100000 + 0.5) / 100000\r\n    } else {\r\n      return -181; //\"#FIRST PARAMETER MUST BE 9\";\r\n      // & Chr(34) & \"latitude\" & Chr(34) & \" or \" & Chr(34) & \"longitude\" & Chr(34)\r\n    }\r\n  },\r\n\r\n\r\n  mgrsToDD: function (LatLong, GRCell) {\r\n    var Area = 4,\r\n      noSpace = GRCell.split(\" \"),\r\n      isEven,\r\n      S,\r\n      i,\r\n      LongZoneNumber,\r\n      Posn,\r\n      MGRS_Old,\r\n      GRLength,\r\n      LatZoneNumber,\r\n      GRX,\r\n      LatZoneLetter,\r\n      Long100Letter,\r\n      Lat100Letter,\r\n      LongZoneMerid,\r\n      Long100Number,\r\n      LatZoneDeg,\r\n      Lat100Number,\r\n      ApproxLatZoneKm,\r\n      LatKm,\r\n      Neg,\r\n      Diff,\r\n      PrevDiff,\r\n      GRY,\r\n      Ndigits,\r\n      X,\r\n      Y,\r\n      nn,\r\n      HalfDigits,\r\n      Mult,\r\n      hj,\r\n      Merid;\r\n    GRCell = noSpace.join(\"\");\r\n    isEven = false;\r\n    if ((GRCell.length >= 6) && (!isEven)) {\r\n      GRLength = GRCell.length;\r\n      if (GRLength > 2) {\r\n        S = \"\";\r\n        for (i = 0; i < GRLength; i += 1) {\r\n          if (GRCell.substr(i, 1) !== \" \") {\r\n            S = S + GRCell.substr(i, 1);\r\n          }\r\n        }\r\n        GRCell = S;\r\n      }\r\n      GRLength = GRCell.length;\r\n      if (GRLength < 3) {\r\n        //#INVALID MGRS GRID REFERENCE 1\r\n\r\n        return -181; //\"#INVALID GRID REFERENCE 1\";\r\n      }\r\n      GRCell = GRCell.toUpperCase();\r\n      MGRS_Old = Area < 0;\r\n      if (MGRS_Old) {\r\n        Area = -Area;\r\n      }\r\n      if (Area === 4) {\r\n\r\n        //' analyse UTM code\r\n        if (!isNaN(parseFloat(GRCell.substr(0, 2)))) {\r\n          //if (parseInt(GRCell.substr(1, 1)))\r\n          //{\r\n          Posn = 2;\r\n\r\n          LongZoneNumber = parseFloat(GRCell.substr(0, 2));\r\n          //}\r\n          //else\r\n          //{\r\n          //\tPosn = 1;\r\n          //}\r\n\r\n        } else {\r\n          //#INVALID MGRS GRID REFERENCE 2\r\n          //return -181;//\"#INVALID MGRS GRID REFERENCE 2\";\r\n          Posn = 1;\r\n\r\n          LongZoneNumber = parseFloat(GRCell.substr(0, 1));\r\n\r\n        }\r\n        LatZoneLetter = GRCell.substr(Posn, 1);\r\n        Posn = Posn + 1;\r\n        Long100Letter = GRCell.substr(Posn, 1);\r\n        Posn = Posn + 1;\r\n        Lat100Letter = GRCell.substr(Posn, 1);\r\n        Posn = Posn + 1;\r\n        //' deal with longitude params\r\n        LongZoneMerid = (LongZoneNumber - 1) * 6 - 180 + 3;\r\n        Long100Number = Long100Letter.charCodeAt(0) - 64;\r\n        if ((Long100Number < 1) || (Long100Number > 26) || (Long100Number === 9) || (Long100Number === 15)) {\r\n          return -181; //\"#INVALID MGRS GRID REFERENCE 3\";\r\n        }\r\n        //' 24 long codes 'A'..'Z' missing out 'I' and 'O'\r\n        //' ABCDEFFG  JKLMNPQR  STUVWXYZ\r\n        //' 12345678  12345678  12345678\r\n        if (Long100Number > 8) {\r\n          // ' 'I'...\r\n          Long100Number = Long100Number - 9;\r\n          if (Long100Number > 5) {\r\n            // Then ' 'O'...\r\n            Long100Number = Long100Number - 1;\r\n            if (Long100Number > 8) {\r\n              Long100Number = Long100Number - 8;\r\n            }\r\n          }\r\n        }\r\n        GRX = 100000 * Long100Number;\r\n        //' 100km to M\r\n        //' deal with latitude params\r\n        LatZoneNumber = LatZoneLetter.charCodeAt(0) - 66;\r\n        if ((LatZoneNumber < 1) || (LatZoneNumber > 22) || (LatZoneNumber === 7) || (LatZoneNumber === 13)) {\r\n          // INVALID MGRS GRID REFERENCE 4\r\n          return -181; //\"#INVALID MGRS GRID REFERENCE 4\";\r\n        }\r\n        //' 20 lat zones 'C'..'X' Missing out I' and 'O' 'C'=1  at 80S\r\n        if (LatZoneNumber > 6) {\r\n          //  ' get rid of 'I' and 'O'\r\n          LatZoneNumber = LatZoneNumber - 1;\r\n          if (LatZoneNumber > 11) {\r\n            LatZoneNumber = LatZoneNumber - 1;\r\n          }\r\n        }\r\n        LatZoneDeg = (LatZoneNumber - 1) * 8 - 80;\r\n        //' N from 80S\r\n        Lat100Number = Lat100Letter.charCodeAt(0) - 64;\r\n        if ((Lat100Number < 1) || (Lat100Number > 22) || (Lat100Number === 9) || (Lat100Number === 15)) {\r\n          //INVALID MGRS GRID REFERENCE 5\r\n          return -181; //;\r\n        }\r\n        //' 20 lat codes 'A'..'V' missing out 'I' and 'O'\r\n        if (Lat100Number > 8) {\r\n          // Then  ' get rid of 'I' and 'O'\r\n          Lat100Number = Lat100Number - 1;\r\n          if (Lat100Number > 13) {\r\n            Lat100Number = Lat100Number - 1;\r\n          }\r\n        }\r\n        if ((LongZoneNumber % 2) === 0) {\r\n          // Then ' convert 'F'..'V'..'E' to 'A'..'V''\r\n          if (Lat100Number > 5) {\r\n            Lat100Number = Lat100Number - 5;\r\n          } else {\r\n            Lat100Number = Lat100Number + 15;\r\n          }\r\n        }\r\n        ApproxLatZoneKm = LatZoneDeg * 110;\r\n        LatKm = (Lat100Number - 1) * 100;\r\n        Neg = ApproxLatZoneKm < 0;\r\n        if (Neg) {\r\n          LatKm = 2000 - LatKm;\r\n          ApproxLatZoneKm = -ApproxLatZoneKm;\r\n        }\r\n        if (Neg) {\r\n          ApproxLatZoneKm = ApproxLatZoneKm - 110 * 8;\r\n        }\r\n        Diff = 0;\r\n        PrevDiff = 1;\r\n        while (Diff < PrevDiff) {\r\n          PrevDiff = Math.abs(LatKm - ApproxLatZoneKm);\r\n          LatKm = LatKm + 2000;\r\n          Diff = Math.abs(LatKm - ApproxLatZoneKm);\r\n        }\r\n        LatKm = LatKm - 2000;\r\n        if ((LatZoneLetter === \"X\") && (LatKm < (Math.floor(ApproxLatZoneKm / 100) * 100))) {\r\n          LatKm = LatKm + 2000;\r\n        }\r\n        if (Neg) {\r\n          LatKm = -LatKm;\r\n        }\r\n        if (MGRS_Old) {\r\n          LatKm = LatKm - 1000;\r\n        }\r\n        GRY = LatKm * 1000;\r\n        //' now locate within 100km square\r\n        Ndigits = GRCell.length - (Posn + 1);\r\n        X = 0;\r\n        Y = 0;\r\n        switch (Ndigits) {\r\n          case 0:\r\n          // ' 100km\r\n          case 1:\r\n            //  ' 50km\r\n            nn = parseInt(GRCell.substr(Posn, 1), 10);\r\n            switch (nn) {\r\n              case 1:\r\n                Y = 50000;\r\n                break;\r\n              case 2:\r\n              case 3:\r\n                X = 50000;\r\n                Y = 50000;\r\n                break;\r\n              case 4:\r\n                X = 50000;\r\n                break;\r\n              default:\r\n                // INVALID MGRS GRID REFERENCE 5\r\n                return -181; //;\r\n            }\r\n            break;\r\n          //case 2:\r\n          //case 4:\r\n          //case 6:\r\n          //case 8:\r\n          //case 10:\r\n          default:\r\n            // ' 10km...1m\r\n            HalfDigits = Ndigits / 2;\r\n            X = parseInt(GRCell.substr(Posn, HalfDigits + 1), 10);\r\n            Y = parseInt(GRCell.substr((Posn + HalfDigits + 1), HalfDigits + 1), 10);\r\n            Mult = 100000;\r\n            for (hj = 0; hj < HalfDigits; hj += 1) {\r\n              Mult = Mult / 10;\r\n            }\r\n            X = X * Mult;\r\n            Y = Y * Mult;\r\n            // INVALID MGRS GRID REFERENCE 6\r\n            break;\r\n        }\r\n\r\n        if (isNaN(X) || isNaN(Y) || isNaN(LongZoneNumber)) {\r\n          return -181;\r\n        }\r\n        GRX = GRX + X;\r\n        GRY = GRY + Y;\r\n        Merid = this.UTMCMfromLongZone(LongZoneNumber);\r\n        return this.TM2LL(LatLong, GRX, GRY, Merid);\r\n      } else {\r\n        // UNSUPPORTED AREA 7\r\n        return -181;\r\n\r\n      }\r\n    }\r\n    // end of function bad return\r\n    return -181;\r\n  },\r\n\r\n\r\n  getMetersPerDegAtLat: function (lat) // Compute lengths of degrees\r\n  {\r\n\r\n    var m1,\r\n      m2,\r\n      m3,\r\n      m4,\r\n      p1,\r\n      p2,\r\n      p3,\r\n      latlen,\r\n      longlen;\r\n\r\n    // Convert latitude to radians\r\n    lat = emp.geoLibrary.deg2rad(lat);\r\n\r\n    // Set up \"Constants\"\r\n    m1 = 111132.92; // latitude calculation term 1\r\n\r\n    m2 = -559.82; // latitude calculation term 2\r\n\r\n    m3 = 1.175; // latitude calculation term 3\r\n\r\n    m4 = -0.0023; // latitude calculation term 4\r\n\r\n    p1 = 111412.84; // longitude calculation term 1\r\n\r\n    p2 = -93.5; // longitude calculation term 2\r\n\r\n    p3 = 0.118; // longitude calculation term 3\r\n\r\n    // Calculate the length of a degree of latitude and longitude in meters\r\n\r\n    latlen = m1 + (m2 * Math.cos(2 * lat)) + (m3 * Math.cos(4 * lat)) + (m4 * Math.cos(6 * lat));\r\n\r\n    longlen = (p1 * Math.cos(lat)) + (p2 * Math.cos(3 * lat)) + (p3 * Math.cos(5 * lat));\r\n\r\n    return longlen; //,latlen];\r\n\r\n    //return emp.geoLibrary.measureDistance(lat,0,lat,1,\"meters\");\r\n  },\r\n\r\n  getPointFromDistanceBearing: function (startLat, startLon, distance, bearing) {\r\n\r\n    // Comvert bearing in degrees to bearing in mils for calculation\r\n    bearing = bearing * Math.PI / 180;\r\n    //Earths radius according to WGS84\r\n    var R = 6371; // 007.1809;\r\n    var lat2 = Math.asin(Math.sin(startLat) * Math.cos(distance / R) + Math.cos(startLat) * Math.sin(distance / R) * Math.cos(bearing));\r\n    var lon2 = startLon + Math.atan2(Math.sin(bearing) * Math.sin(distance / R) * Math.cos(startLat), Math.cos(distance / R) - Math.sin(startLat) * Math.sin(lat2));\r\n    return {\r\n      lat: lat2,\r\n      lon: lon2\r\n    };\r\n  },\r\n\r\n  getMidPoint: function (lat1, lon1, lat2, lon2) {\r\n    var lat3 = (lat1 + lat2) / 2;\r\n    var f1 = Math.tan(Math.PI / 4 + lat1 / 2);\r\n    var f2 = Math.tan(Math.PI / 4 + lat2 / 2);\r\n    var f3 = Math.tan(Math.PI / 4 + lat3 / 2);\r\n    var lon3 = ((lon2 - lon1) * Math.log(f3) + lon1 * Math.log(f2) - lon2 * Math.log(f1)) / Math.log(f2 / f1);\r\n    return lon3;\r\n  },\r\n  /*\r\n   getBearing: function(){\r\n   var y = Math.sin(dLon) * Math.cos(lat2);\r\n   var x = Math.cos(lat1)*Math.sin(lat2) - Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);\r\n   var brng = Math.atan2(y, x).toDeg();\r\n   return brng;\r\n   },\r\n   */\r\n  measureDistance: function (latitude1, longitude1, latitude2, longitude2, unitOfMeasure) {\r\n    // latitude1,latitude2 = latitude, longitude1,longitude2 = longitude\r\n    //Radius is 6378.1 (km), 3963.1 (mi), 3443.9 (nm\r\n\r\n    var distance = -1,\r\n      rad;\r\n    //if((validateCoordinate(latitude1,longitude1) == true)&&(validateCoordinate(latitude2,longitude2) == true))\r\n    //{\r\n\r\n    switch (unitOfMeasure.toLowerCase()) {\r\n      case \"kilometers\":\r\n        rad = 6378.137;\r\n        break;\r\n      case \"meters\":\r\n        rad = 6378137;\r\n        break;\r\n      case \"miles\":\r\n        rad = 3963.1;\r\n        break;\r\n      case \"feet\":\r\n        rad = 20925524.9;\r\n        break;\r\n      case \"yards\":\r\n        rad = 6975174.98;\r\n        break;\r\n      case \"nautical\":\r\n        rad = 3443.9;\r\n        break;\r\n      case \"nautical miles\":\r\n        rad = 3443.9;\r\n        break;\r\n      default:\r\n        return -1;\r\n    }\r\n    latitude1 = latitude1 * (Math.PI / 180);\r\n    latitude2 = latitude2 * (Math.PI / 180);\r\n    longitude1 = longitude1 * (Math.PI / 180);\r\n    longitude2 = longitude2 * (Math.PI / 180);\r\n    distance = (Math.acos(Math.cos(latitude1) * Math.cos(longitude1) * Math.cos(latitude2) * Math.cos(longitude2) + Math.cos(latitude1) * Math.sin(longitude1) * Math.cos(latitude2) * Math.sin(longitude2) + Math.sin(latitude1) * Math.sin(latitude2)) * rad);\r\n    //}\r\n    return distance;\r\n  },\r\n\r\n  coordinateArrayToString: function (coordinates) {\r\n    var len = coordinates.length,\r\n      coordString = '',\r\n      i;\r\n\r\n    for (i = 0; i < len; i += 1) {\r\n      if (i > 0) {\r\n        coordString += ' ';\r\n      }\r\n      coordString += coordinates[i][0].toString() + \",\" + coordinates[i][1].toString();\r\n      if (coordinates[i].length === 3) {\r\n        coordString += \",\" + coordinates[i][2].toString();\r\n      } else {\r\n        coordString += \",0\";\r\n      }\r\n    }\r\n    return coordString;\r\n  },\r\n\r\n  coordinateStringToArray: function (coordinates) {\r\n    var coordArr = [],\r\n      pairs,\r\n      len,\r\n      i,\r\n      values,\r\n      alt;\r\n    if (coordinates.length > 0) {\r\n      pairs = coordinates.split(\" \");\r\n      len = pairs.length;\r\n      for (i = 0; i < len; i += 1) {\r\n        values = pairs[i].split(',');\r\n        alt = 0;\r\n        if (values.length === 3) {\r\n          alt = parseInt(values[2], 10);\r\n        }\r\n        coordArr.push({\r\n          lat: parseFloat(values[1]),\r\n          lon: parseFloat(values[0]),\r\n          alt: alt\r\n        });\r\n      }\r\n    }\r\n    return coordArr;\r\n  },\r\n\r\n  validateLatLon: function (lat, lon) {\r\n    var valid = false;\r\n    if (!isNaN(lat) && !isNaN(lon)) {\r\n      if (lat <= 90 && lat >= -90 && lon <= 180 && lon >= -180) {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  },\r\n\r\n  //private static double sm_a\t= 6378137;WGS-84\r\n  /*\r\n   Degrees To Radians\r\n   */\r\n  DegToRad: function (deg) {\r\n    return deg / 180.0 * Math.PI;\r\n  },\r\n\r\n  /*\r\n   Radians to Degrees\r\n   */\r\n  RadToDeg: function (rad) {\r\n    return rad / Math.PI * 180.0;\r\n  },\r\n\r\n  /**\r\n   * Returns the azimuth from true north between two points\r\n   * @param c1 - geocoord object with 'x' and 'y' parameters\r\n   * @param c2 - geocoord object with 'x' and 'y' parameters\r\n   * @return the azimuth from c1 to c2 in degrees\r\n   */\r\n  GetAzimuth: function (c1, c2) { //was private\r\n    var theta = 0;\r\n    try {\r\n      var lat1 = this.DegToRad(c1.y);\r\n      var lon1 = this.DegToRad(c1.x);\r\n      var lat2 = this.DegToRad(c2.y);\r\n      var lon2 = this.DegToRad(c2.x);\r\n      //formula\r\n      // = atan2( sin(long).cos(lat2),\r\n      //cos(lat1).sin(lat2)  sin(lat1).cos(lat2).cos(long) )\r\n      //var theta = Math.atan2( Math.sin(lon2-lon1)*Math.cos(lat2),\r\n      //Math.cos(lat1)*Math.sin(lat2)  Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1) );\r\n      var y = Math.sin(lon2 - lon1);\r\n      y *= Math.cos(lat2);\r\n      var x = Math.cos(lat1);\r\n      x *= Math.sin(lat2);\r\n      var z = Math.sin(lat1);\r\n      z *= Math.cos(lat2);\r\n      z *= Math.cos(lon2 - lon1);\r\n      x = x - z;\r\n      theta = Math.atan2(y, x);\r\n      theta = this.RadToDeg(theta);\r\n    } catch (error) {\r\n      //System.out.println(e.getMessage());\r\n    }\r\n    return theta; //RadToDeg(k);\r\n  },\r\n\r\n  /**\r\n   * Calculates a geodesic point and given distance and azimuth from the srating geodesic point\r\n   *\r\n   * @param start the starting point\r\n   * @param distance the distance in meters\r\n   * @param azimuth the azimuth or bearing in degrees\r\n   *\r\n   * @return the calculated point\r\n   */\r\n  geodesic_coordinate: function (start,\r\n                                 distance,\r\n                                 azimuth) {\r\n    var pt = this.Point();\r\n\r\n    var sm_a = 6378137; //WGS - 84\r\n    try {\r\n      //formula\r\n      //lat2 = asin(sin(lat1)*cos(d/R) + cos(lat1)*sin(d/R)*cos())\r\n      //lon2 = lon1 + atan2(sin()*sin(d/R)*cos(lat1), cos(d/R)sin(lat1)*sin(lat2))\r\n\r\n      var a = 0,\r\n        b = 0,\r\n        c = 0,\r\n        d = 0,\r\n        e = 0,\r\n        f = 0,\r\n        g = 0,\r\n        h = 0,\r\n        k = 0,\r\n        l = 0,\r\n        m = 0,\r\n        n = 0,\r\n        p = 0;\r\n\r\n      a = this.DegToRad(start.y);\r\n      b = Math.cos(a);\r\n      c = this.DegToRad(azimuth);\r\n      d = Math.sin(a);\r\n      e = Math.cos(distance / sm_a);\r\n      f = Math.sin(distance / sm_a);\r\n      g = Math.cos(c);\r\n      //uncomment to test calculation\r\n      //var lat2 = RadToDeg(Math.asin(Math.sin(DegToRad(start.y)) * Math.cos(DegToRad(distance / sm_a)) + Math.cos(DegToRad(start.y)) * Math.sin(DegToRad(distance / sm_a)) * Math.cos(DegToRad(azimuth))));\r\n      //lat2 = asin(sin(lat1)*cos(d/R) + cos(lat1)*sin(d/R)*cos())\r\n      //var lat2 = RadToDeg(Math.asin(Math.sin(DegToRad(start.y)) * Math.cos(distance / sm_a) + Math.cos(DegToRad(start.y)) * Math.sin(distance / sm_a) * Math.cos(DegToRad(azimuth))));\r\n      //double lat2 = RadToDeg(Math.asin(Math.sin(DegToRad(start.y)) * Math.cos(distance / sm_a) + Math.cos(DegToRad(start.y)) * Math.sin(distance / sm_a) * Math.cos(DegToRad(azimuth))));\r\n      var lat = this.RadToDeg(Math.asin(d * e + b * f * g));\r\n      h = Math.sin(c);\r\n      k = Math.sin(h);\r\n      l = Math.cos(a);\r\n      m = this.DegToRad(lat);\r\n      n = Math.sin(m);\r\n      p = Math.atan2(h * f * b, e - d * n);\r\n      //uncomment to test calculation\r\n      //var lon2 = start.x + DegToRad(Math.atan2(Math.sin(DegToRad(azimuth)) * Math.sin(DegToRad(distance / sm_a)) * Math.cos(DegToRad(start.y)), Math.cos(DegToRad(distance / sm_a)) - Math.sin(DegToRad(start.y)) * Math.sin(DegToRad(lat))));\r\n      //lon2 = lon1 + atan2(sin()*sin(d/R)*cos(lat1), cos(d/R)sin(lat1)*sin(lat2))\r\n      //var lon2 = start.x + RadToDeg(Math.atan2(Math.sin(DegToRad(azimuth)) * Math.sin(distance / sm_a) * Math.cos(DegToRad(start.y)), Math.cos(distance / sm_a) - Math.sin(DegToRad(start.y)) * Math.sin(DegToRad(lat2))));\r\n      var lon = start.x + this.RadToDeg(p);\r\n      pt = this.Point();\r\n      pt.x = lon;\r\n      pt.y = lat;\r\n\r\n    } catch (error) {\r\n      //clsUtility.WriteFile(\"Error in mdlGeodesic.geodesic_distance\");\r\n\r\n    }\r\n    return pt;\r\n  },\r\n\r\n  /**\r\n   * returns intersection of two lines, each defined by a point and a bearing\r\n   *\r\n   * @param p1\r\n   * @param brng1\r\n   * @param p2\r\n   * @param brng2\r\n   * @return {string}\r\n   */\r\n  IntersectLines: function (p1,\r\n                            brng1,\r\n                            p2,\r\n                            brng2) {\r\n    var ptResult = null;\r\n    try {\r\n      var lat1 = this.DegToRad(p1.y); //p1._lat.toRad();\r\n      var lon1 = this.DegToRad(p1.x); //p1._lon.toRad();\r\n      var lat2 = this.DegToRad(p2.y); //p2._lat.toRad();\r\n      var lon2 = this.DegToRad(p2.x); //p2._lon.toRad();\r\n      var brng13 = this.DegToRad(brng1); //brng1.toRad();\r\n      var brng23 = this.DegToRad(brng2); //brng2.toRad();\r\n      var dLat = lat2 - lat1;\r\n      var dLon = lon2 - lon1;\r\n\r\n\r\n      var dist12 = 2 * Math.asin(Math.sqrt(Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n          Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2)));\r\n\r\n      if (dist12 === 0) {\r\n        return null;\r\n      }\r\n\r\n      var brngA = Math.acos((Math.sin(lat2) - Math.sin(lat1) * Math.cos(dist12)) /\r\n        (Math.sin(dist12) * Math.cos(lat1)));\r\n\r\n      if (isNaN(brngA)) {\r\n        brngA = 0; // protect against rounding\r\n      }\r\n      var brngB = Math.acos((Math.sin(lat1) - Math.sin(lat2) * Math.cos(dist12)) /\r\n        (Math.sin(dist12) * Math.cos(lat2)));\r\n\r\n      var brng12 = 0,\r\n        brng21 = 0;\r\n      if (Math.sin(lon2 - lon1) > 0) {\r\n        brng12 = brngA;\r\n        brng21 = 2 * Math.PI - brngB;\r\n      } else {\r\n        brng12 = 2 * Math.PI - brngA;\r\n        brng21 = brngB;\r\n      }\r\n\r\n      var alpha1 = (brng13 - brng12 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 2-1-3\r\n      var alpha2 = (brng21 - brng23 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 1-2-3\r\n\r\n      if (Math.sin(alpha1) === 0 && Math.sin(alpha2) === 0) {\r\n        return null; // infinite intersections\r\n      }\r\n      if (Math.sin(alpha1) * Math.sin(alpha2) < 0) {\r\n        return null; // ambiguous intersection\r\n      }\r\n      //alpha1 = Math.abs(alpha1);\r\n      //alpha2 = Math.abs(alpha2);  // ... Ed Williams takes abs of alpha1/alpha2, but seems to break calculation?\r\n      var alpha3 = Math.acos(-Math.cos(alpha1) * Math.cos(alpha2) +\r\n        Math.sin(alpha1) * Math.sin(alpha2) * Math.cos(dist12));\r\n\r\n      var dist13 = Math.atan2(Math.sin(dist12) * Math.sin(alpha1) * Math.sin(alpha2),\r\n        Math.cos(alpha2) + Math.cos(alpha1) * Math.cos(alpha3));\r\n\r\n      var lat3 = Math.asin(Math.sin(lat1) * Math.cos(dist13) +\r\n        Math.cos(lat1) * Math.sin(dist13) * Math.cos(brng13));\r\n      var dLon13 = Math.atan2(Math.sin(brng13) * Math.sin(dist13) * Math.cos(lat1),\r\n        Math.cos(dist13) - Math.sin(lat1) * Math.sin(lat3));\r\n      var lon3 = lon1 + dLon13;\r\n      lon3 = (lon3 + Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..180\r\n\r\n      //return new POINT2(lat3.toDeg(), lon3.toDeg());\r\n      ptResult = this.Point(this.RadToDeg(lon3), this.RadToDeg(lat3));\r\n\r\n    } catch (error) {\r\n\r\n    }\r\n    return ptResult;\r\n  },\r\n  /**\r\n   Checks to see if two bounding boxes touch each other.   Includes intesections or containment of one box within\r\n   the other.  Takes into the case if one of the boxes cross the international date line.\r\n   */\r\n  doesBoundingBoxIntersect: function (bbox1, bbox2) {\r\n    var bbox1a;\r\n    var bbox1b;\r\n    var bbox2a;\r\n    var bbox2b;\r\n    // Check edge case where boxes cross the international date line\r\n    // (180th Meridian)\r\n    if (bbox1.left > bbox1.right) {\r\n      // Divide the bounding box into 2 sections, one to the left of the 180th Meridian\r\n      // and one to the right.\r\n      bbox1a = new emp.geoLibrary.BoundingBox();\r\n      bbox1a.left = bbox1.left;\r\n      bbox1a.right = 180.0;\r\n      bbox1a.top = bbox1.top;\r\n      bbox1a.bottom = bbox1.bottom;\r\n      bbox1b = new emp.geoLibrary.BoundingBox();\r\n      bbox1b.left = -180.0;\r\n      bbox1b.right = bbox1.right;\r\n      bbox1b.top = bbox1.top;\r\n      bbox1b.bottom = bbox1.bottom;\r\n      // Check to see if the second bounding box crosses the 180th Meridian\r\n      if (bbox2.left > bbox2.right) {\r\n        bbox2a = new emp.geoLibrary.BoundingBox();\r\n        bbox2a.left = bbox2.left;\r\n        bbox2a.right = 180.0;\r\n        bbox2a.top = bbox2.top;\r\n        bbox2a.bottom = bbox2.bottom;\r\n        bbox2b = new emp.geoLibrary.BoundingBox();\r\n        bbox2b.left = -180.0;\r\n        bbox2b.right = bbox2.right;\r\n        bbox2b.top = bbox2.top;\r\n        bbox2b.bottom = bbox2.bottom;\r\n        // The 2nd bounding box does not cross the meridian, so just compare the\r\n        // the split first bouding box.  If any piece intersects with bbox2 it intersects.\r\n        if (this.checkBboxOverlap(bbox1a, bbox2a) === true || this.checkBboxOverlap(bbox2a, bbox1a) === true || this.checkBboxOverlap(bbox1b, bbox2b) === true || this.checkBboxOverlap(bbox2b, bbox1b) === true) {\r\n          return true;\r\n        }\r\n        return false;\r\n      } else {\r\n        // Divide the bounding box into 2 sections, one to the left of the 180th Meridian\r\n        // and one to the right.\r\n        bbox2a = new emp.geoLibrary.BoundingBox();\r\n        bbox2a.left = bbox2.left;\r\n        bbox2a.right = 180.0;\r\n        bbox2a.top = bbox2.top;\r\n        bbox2a.bottom = bbox2.bottom;\r\n        bbox2b = new emp.geoLibrary.BoundingBox();\r\n        bbox2b.left = -180.0;\r\n        bbox2b.right = bbox2.right;\r\n        bbox2b.top = bbox2.top;\r\n        bbox2b.bottom = bbox2.bottom;\r\n        // The 2nd bounding box does not cross the meridian, so just compare the\r\n        // the split first bouding box.  If any piece intersects with bbox2 it intersects.\r\n        if (this.checkBboxOverlap(bbox1, bbox2a) === true || this.checkBboxOverlap(bbox2a, bbox1) === true || this.checkBboxOverlap(bbox1, bbox2b) === true || this.checkBboxOverlap(bbox2b, bbox1) === true) {\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n    } else if (bbox2.left > bbox2.right) {\r\n      if (this.checkBboxOverlap(bbox1a, bbox2) === true || this.checkBboxOverlap(bbox2, bbox1a) === true || this.checkBboxOverlap(bbox1b, bbox2) === true || this.checkBboxOverlap(bbox2, bbox1b) === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    } else {\r\n      if (this.checkBboxOverlap(bbox1, bbox2) === true || this.checkBboxOverlap(bbox2, bbox1) === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n  },\r\n  pointInBbox: function (bbox, x, y) {\r\n    if (bbox || bbox.left !== undefined || bbox.right !== undefined || bbox.top !== undefined || bbox.bototm !== undefined) {\r\n      if ((x >= bbox.left) && (x <= bbox.right) && (y >= bbox.bottom) && (y <= bbox.top)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n  checkBboxOverlap: function (bbox1, bbox2) {\r\n    if (bbox1 && bbox2) {\r\n      if (this.pointInBbox(bbox1, bbox2.left, bbox2.top)) {\r\n        return true;\r\n      }\r\n      if (this.pointInBbox(bbox1, bbox2.right, bbox2.top)) {\r\n        return true;\r\n      }\r\n      if (this.pointInBbox(bbox1, bbox2.left, bbox2.bottom)) {\r\n        return true;\r\n      }\r\n      if (this.pointInBbox(bbox1, bbox2.right, bbox2.bottom)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n\r\n  //Rectangle.intersection adapted from Rectangle.java to work with geo coords based bounding boxes\r\n  //TODO: Needs more work.  Still returns false in some \"true\" scenarios.\r\n  checkBboxIntersects: function (bbox1, bbox2) {\r\n    var tw = bbox1.right - bbox1.left;\r\n    var th = bbox1.top - bbox1.bottom; //this.height;\r\n    var rw = bbox2.right - bbox2.left;\r\n    var rh = bbox2.top - bbox2.bottom;\r\n    if (rw <= 0 || rh <= 0 || tw <= 0 || th <= 0) {\r\n      return false;\r\n    }\r\n    var tx = bbox1.left;\r\n    var ty = bbox1.top;\r\n    var rx = bbox2.left;\r\n    var ry = bbox2.top;\r\n    rw += rx;\r\n    rh += ry;\r\n    tw += tx;\r\n    th += ty;\r\n    //      overflow || intersect\r\n    return ((rw < rx || rw > tx) &&\r\n    (rh > ry || rh < ty) &&\r\n    (tw < tx || tw > rx) &&\r\n    (th > ty || th < ry));\r\n  },\r\n\r\n  //This code for checkLineIntersectsBox/////////////////////////////////////\r\n  OUT_LEFT: 1,\r\n  OUT_TOP: 2,\r\n  OUT_RIGHT: 4,\r\n  OUT_BOTTOM: 8,\r\n\r\n  outcode: function (bbox, x, y) {\r\n\r\n    var out = 0;\r\n    if (bbox.width <= 0) {\r\n      out |= this.OUT_LEFT | this.OUT_RIGHT;\r\n    } else if (x < bbox.left) {\r\n      out |= this.OUT_LEFT;\r\n    } else if (x > bbox.right) {\r\n      out |= this.OUT_RIGHT;\r\n    }\r\n    if (bbox.height <= 0) {\r\n      out |= this.OUT_TOP | this.OUT_BOTTOM;\r\n    } else if (y > bbox.top) {\r\n      out |= this.OUT_TOP;\r\n    } else if (y < bbox.bottom) {\r\n      out |= this.OUT_BOTTOM;\r\n    }\r\n    return out;\r\n  },\r\n\r\n  //Checks if a line segment intersects a bounding box\r\n  checkLineIntersectsBox: function (bbox, x1, y1, x2, y2) {\r\n    var out1, out2;\r\n    if ((out2 = this.outcode(bbox, x2, y2)) === 0) {\r\n      return true;\r\n    }\r\n    while ((out1 = this.outcode(bbox, x1, y1)) !== 0) {\r\n      if ((out1 & out2) !== 0) {\r\n        return false;\r\n      }\r\n      if ((out1 & (this.OUT_LEFT | this.OUT_RIGHT)) !== 0) {\r\n        var x = bbox.left;\r\n        if ((out1 & this.OUT_RIGHT) !== 0) {\r\n          x = bbox.right;\r\n        }\r\n        y1 = y1 + (x - x1) * (y2 - y1) / (x2 - x1);\r\n        x1 = x;\r\n      } else {\r\n        var y = bbox.top;\r\n        if ((out1 & this.OUT_BOTTOM) !== 0) {\r\n          y = bbox.bottom;\r\n        }\r\n        x1 = x1 + (y - y1) * (x2 - x1) / (y2 - y1);\r\n        y1 = y;\r\n      }\r\n    }\r\n    return true;\r\n  },\r\n  //End, this code for checkLineIntersectsBox////////////////////////////////\r\n\r\n  BoundingBox: function (pointString) {\r\n    var len,\r\n      points,\r\n      p1,\r\n      p2,\r\n      point,\r\n      i;\r\n    // if the user passes in a coordinate string, parse\r\n    // the coordinate string and find the min and max values for\r\n    // each to get the bounding box.\r\n    // at sacrifice for accuracy if difference between left and right is\r\n    // greater than 180, make the asssumption they crossed the 180th meridian.\r\n    if (pointString) {\r\n      points = pointString.split(\" \");\r\n      len = points.length;\r\n      for (i = 0; i < len; i++) {\r\n        point = points[i].split(\",\");\r\n        p1 = parseFloat(point[0]);\r\n        p2 = parseFloat(point[1]);\r\n        if (point.length >= 2) {\r\n          if (this.left === null) {\r\n            this.left = p1;\r\n          } else {\r\n            if (p1 < this.left) {\r\n              this.left = p1;\r\n            }\r\n          }\r\n          if (this.right === null) {\r\n            this.right = p1;\r\n          } else {\r\n            if (p1 > this.right) {\r\n              this.right = p1;\r\n            }\r\n          }\r\n          if (this.top === null) {\r\n            this.top = p2;\r\n          } else {\r\n            if (p2 > this.top) {\r\n              this.top = p2;\r\n            }\r\n          }\r\n          if (this.bottom === null) {\r\n            this.bottom = p2;\r\n          } else {\r\n            if (point[1] < this.bottom) {\r\n              this.bottom = p2;\r\n            }\r\n          }\r\n          // if the difference between right and left is greater\r\n          // than 180 there is a good chance that the user intends\r\n          // to cross the 180th meridian.  reverse left and right in\r\n          // that case.  There is no way to prove this.\r\n          if ((this.right - this.left) > 180) {\r\n            var savedvalue = this.left;\r\n            this.left = this.right;\r\n            this.right = savedvalue;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  getBox: function (points) {\r\n    var left,\r\n      right,\r\n      top,\r\n      bottom,\r\n      len,\r\n      p1,\r\n      p2,\r\n      point,\r\n      i;\r\n\r\n    len = points.length;\r\n    for (i = 0; i < len; i++) {\r\n      point = points[i];\r\n      p1 = point.lon;\r\n      p2 = point.lat;\r\n      //if (point.length >= 2) {\r\n      if (left === null) {\r\n        left = p1;\r\n      } else {\r\n        if (p1 < left) {\r\n          left = p1;\r\n        }\r\n      }\r\n      if (right === null) {\r\n        right = p1;\r\n      } else {\r\n        if (p1 > right) {\r\n          right = p1;\r\n        }\r\n      }\r\n      if (top === null) {\r\n        top = p2;\r\n      } else {\r\n        if (p2 > top) {\r\n          top = p2;\r\n        }\r\n      }\r\n      if (bottom === null) {\r\n        bottom = p2;\r\n      } else {\r\n        if (p2 < bottom) {\r\n          bottom = p2;\r\n        }\r\n      }\r\n      // if the difference between right and left is greater\r\n      // than 180 there is a good chance that the user intends\r\n      // to cross the 180th meridian.  reverse left and right in\r\n      // that case.  There is no way to prove\r\n      if ((right - left) > 180) {\r\n        var savedvalue = left;\r\n        left = right;\r\n        right = savedvalue;\r\n      }\r\n      // }\r\n    }\r\n    return [{\r\n      lat: bottom,\r\n      lon: left\r\n    }, {\r\n      lat: top,\r\n      lon: left\r\n    }, {\r\n      lat: top,\r\n      lon: right\r\n    }, {\r\n      lat: bottom,\r\n      lon: right\r\n    }];\r\n  },\r\n\r\n  /**\r\n   * Calculates a 4 coordinate bounding box from any polygon.  This function takes into account if the the polygon crosses\r\n   * the IDL and may return a bounding box where the left value is greater than the right value.\r\n   *\r\n   * <BR><BR>Example:\r\n   * <P><BLOCKQUOTE><PRE>\r\n   * var points = [{lat:50,lon:45},{lat:50,lon:45},{lat:50,lon:45}];\r\n   * var box = emp.geoLibrary.getBoxIDL(points);\r\n   * var boxString = \"left: \"+box[0].lon+\",\"+box[0].lat+\r\n   *                 \"bottom: \"+box[1].lon+\",\"+box[1].lat;\r\n   *                 \"right: \"+box[2].lon+\",\"+box[2].lat;\r\n   *                 \"top: \"+box[3].lon+\",\"+box[3].lat;\r\n   *\r\n   * alert( boxString );\r\n   *\r\n   * </PRE></BLOCKQUOTE></P>\r\n   * @param {Array} points required - An array of point with latitude and longitude\r\n   * values in degrees decimal format objects\r\n   * @return A new array of 4 objects each with a lat and lon property in the order of left,bottom,right,top\r\n   * @type Array\r\n   */\r\n  getBoxIDL: function (points) {\r\n    var left,\r\n      right,\r\n      top,\r\n      bottom,\r\n      len,\r\n      p1,\r\n      p2,\r\n      point,\r\n      i,\r\n      temp;\r\n\r\n\r\n    len = points.length;\r\n    for (i = 0; i < len; i++) {\r\n      point = points[i];\r\n      p1 = point.lon + 180;\r\n      p2 = point.lat + 90;\r\n      if (left === null) {\r\n        left = p1;\r\n      } else {\r\n        if (p1 < left) {\r\n          left = p1;\r\n        }\r\n      }\r\n      if (right === null) {\r\n        right = p1;\r\n      } else {\r\n        if (p1 > right) {\r\n          right = p1;\r\n        }\r\n      }\r\n      if (top === null) {\r\n        top = p2;\r\n      } else {\r\n        if (p2 > top) {\r\n          top = p2;\r\n        }\r\n      }\r\n      if (bottom === null) {\r\n        bottom = p2;\r\n      } else {\r\n        if (p2 < bottom) {\r\n          bottom = p2;\r\n        }\r\n      }\r\n\r\n    }\r\n    if ((right - left) > 180) {\r\n      temp = left;\r\n      left = right;\r\n      right = temp;\r\n    }\r\n\r\n    // Removed this top/bottom swap.  This is in presumably if you\r\n    // are at the poles.  If you are at the poles, we are pretty much\r\n    // dead in the water because of GE to begin with. Uncomment if\r\n    // this causes an issue.\r\n    /*\r\n     if ((top - bottom) > 90) {\r\n     temp = top;\r\n     top = bottom;\r\n     bottom = temp;\r\n     }\r\n     */\r\n\r\n    return [{\r\n      lat: bottom - 90,\r\n      lon: left - 180\r\n    }, {\r\n      lat: top - 90,\r\n      lon: left - 180\r\n    }, {\r\n      lat: top - 90,\r\n      lon: right - 180\r\n    }, {\r\n      lat: bottom - 90,\r\n      lon: right - 180\r\n    }];\r\n  },\r\n\r\n  /**\r\n   * @name latLongToUtm\r\n   *\r\n   * @desc Converts a lat long coordinate into a utm coordinate\r\n   *\r\n   * NOTE: Code derived from http://forum.worldwindcentral.com/showthread.php?t=9863\r\n   *\r\n   * @param numLat - IN - Latitude of the coordinate we want to convert\r\n   * @param numLong - IN - Longitude of the coordinate we want to convert\r\n   * @return A utm coordinate in this format: \"zone,easting,northing\"\r\n   */\r\n  latLongToUtm: function (numLat, numLong) {\r\n    //try {\r\n    var numUTMEasting = 0;\r\n    var numUTMNorthing = 0;\r\n    var strZone = \"\";\r\n\r\n    var numA = 6378137; //WGS84\r\n    var numEccSquared = 0.00669438; //WGS84\r\n    var numK0 = 0.9996;\r\n\r\n    var numLongOrigin;\r\n    var numN;\r\n    var numT;\r\n    var numC;\r\n    var numAA;\r\n    var numM;\r\n\r\n    // Make sure the longitude is between -180.00 .. 179.9\r\n    //changed a cast to int to Math.floor\r\n    var numLongTemp = (numLong + 180) - (Math.floor((numLong + 180) / 360)) * 360 - 180; // -180.00 .. 179.9\r\n\r\n    var numLatRad = numLat * (Math.PI / 180);\r\n    var numLongRad = numLongTemp * (Math.PI / 180);\r\n    var numLongOriginRad;\r\n    var intZoneNumber;\r\n    //changed (int) to Math.floor\r\n    intZoneNumber = (Math.floor((numLongTemp + 180) / 6)) + 1;\r\n\r\n    if (numLat >= 56.0 && numLat < 64.0 && numLongTemp >= 3.0 && numLongTemp < 12.0) {\r\n      intZoneNumber = 32;\r\n    }\r\n\r\n    // Special zones for Svalbard\r\n    if (numLat >= 772.0 && numLat < 84.0) {\r\n      if (numLongTemp >= 0.0 && numLongTemp < 9.0) {\r\n        intZoneNumber = 31;\r\n      } else if (numLongTemp >= 9.0 && numLongTemp < 21.0) {\r\n        intZoneNumber = 33;\r\n      } else if (numLongTemp >= 21.0 && numLongTemp < 33.0) {\r\n        intZoneNumber = 35;\r\n      } else if (numLongTemp >= 33.0 && numLongTemp < 42.0) {\r\n        intZoneNumber = 37;\r\n      }\r\n    }\r\n\r\n    numLongOrigin = (intZoneNumber - 1) * 6 - 180 + 3; //+3 puts origin in middle of zone\r\n    numLongOriginRad = numLongOrigin * (Math.PI / 180);\r\n\r\n    // Compute the UTM Zone from the latitude and longitude\r\n    strZone = intZoneNumber.toString() + this.utmLetterDesignator(numLat);\r\n\r\n    var eccPrimeSquared = (numEccSquared) / (1 - numEccSquared);\r\n\r\n    numN = numA / Math.sqrt(1 - numEccSquared * Math.sin(numLatRad) * Math.sin(numLatRad));\r\n    numT = Math.tan(numLatRad) * Math.tan(numLatRad);\r\n    numC = eccPrimeSquared * Math.cos(numLatRad) * Math.cos(numLatRad);\r\n    numAA = Math.cos(numLatRad) * (numLongRad - numLongOriginRad);\r\n\r\n    numM = numA * (\r\n      (1 - numEccSquared / 4 - 3 * numEccSquared * numEccSquared / 64 - 5 * numEccSquared * numEccSquared * numEccSquared / 256) *\r\n      numLatRad -\r\n      (3 * numEccSquared / 8 + 3 * numEccSquared * numEccSquared / 32 + 45 * numEccSquared * numEccSquared * numEccSquared / 1024) *\r\n      Math.sin(2 * numLatRad) +\r\n      (15 * numEccSquared * numEccSquared / 256 + 45 * numEccSquared * numEccSquared * numEccSquared / 1024) *\r\n      Math.sin(4 * numLatRad) - (35 * numEccSquared * numEccSquared * numEccSquared / 3072) * Math.sin(6 * numLatRad));\r\n\r\n    numUTMEasting = Number((numK0 * numN * (numAA + (1 - numT + numC) * numAA * numAA * numAA / 6 +\r\n    (5 - 18 * numT + numT * numT + 72 * numC - 58 * eccPrimeSquared) * numAA * numAA * numAA * numAA * numAA / 120) + 500000.0));\r\n\r\n    numUTMNorthing = Number(numK0 * (numM + numN * Math.tan(numLatRad) * (numAA * numAA / 2 + (5 - numT + 9 * numC + 4 * numC * numC) *\r\n      numAA * numAA * numAA * numAA / 24 + (61 - 58 * numT + numT * numT + 600 * numC - 330 * eccPrimeSquared) *\r\n      numAA * numAA * numAA * numAA * numAA * numAA / 720)));\r\n\r\n    if (numLat < 0) {\r\n      numUTMNorthing += 10000000.0; //10000000 meter offset for southern hemisphere\r\n    }\r\n\r\n    //var utmValue = strZone + \",\" + numUTMEasting.toString() + \",\" + numUTMNorthing.toString();\r\n    var utmValue = strZone + \",\" + Math.round(numUTMEasting).toString() + \",\" + Math.round(numUTMNorthing).toString();\r\n    return utmValue;\r\n    // } // End try\r\n    // catch (e) {\r\n\r\n    // }\r\n\r\n    //  return \"\";\r\n  },\r\n\r\n  /**\r\n   * @name utmLetterDesignator\r\n   *\r\n   * @desc Gets the utm letter that corresponds with a passed in latitude value\r\n   *\r\n   * NOTE: Code derived from http://forum.worldwindcentral.com/showthread.php?t=9863\r\n   *\r\n   * @param numLat - IN - Latitude that need to figure out what utm letter to return\r\n   * @return Utm letter that corresponds with a passed in latitude value\r\n   */\r\n  utmLetterDesignator: function (numLat) {\r\n    var strLetterDesignator = \"Z\";\r\n\r\n    // try {\r\n    if ((84 >= numLat) && (numLat >= 72)) {\r\n      strLetterDesignator = \"X\";\r\n    } else if ((72 > numLat) && (numLat >= 64)) {\r\n      strLetterDesignator = \"W\";\r\n    } else if ((64 > numLat) && (numLat >= 56)) {\r\n      strLetterDesignator = \"V\";\r\n    } else if ((56 > numLat) && (numLat >= 48)) {\r\n      strLetterDesignator = \"U\";\r\n    } else if ((48 > numLat) && (numLat >= 40)) {\r\n      strLetterDesignator = \"T\";\r\n    } else if ((40 > numLat) && (numLat >= 32)) {\r\n      strLetterDesignator = \"S\";\r\n    } else if ((32 > numLat) && (numLat >= 24)) {\r\n      strLetterDesignator = \"R\";\r\n    } else if ((24 > numLat) && (numLat >= 16)) {\r\n      strLetterDesignator = \"Q\";\r\n    } else if ((16 > numLat) && (numLat >= 8)) {\r\n      strLetterDesignator = \"P\";\r\n    } else if ((8 > numLat) && (numLat >= 0)) {\r\n      strLetterDesignator = \"N\";\r\n    } else if ((0 > numLat) && (numLat >= -8)) {\r\n      strLetterDesignator = \"M\";\r\n    } else if ((-8 > numLat) && (numLat >= -16)) {\r\n      strLetterDesignator = \"L\";\r\n    } else if ((-16 > numLat) && (numLat >= -24)) {\r\n      strLetterDesignator = \"K\";\r\n    } else if ((-24 > numLat) && (numLat >= -32)) {\r\n      strLetterDesignator = \"J\";\r\n    } else if ((-32 > numLat) && (numLat >= -40)) {\r\n      strLetterDesignator = \"H\";\r\n    } else if ((-40 > numLat) && (numLat >= -48)) {\r\n      strLetterDesignator = \"G\";\r\n    } else if ((-48 > numLat) && (numLat >= -56)) {\r\n      strLetterDesignator = \"F\";\r\n    } else if ((-56 > numLat) && (numLat >= -64)) {\r\n      strLetterDesignator = \"E\";\r\n    } else if ((-64 > numLat) && (numLat >= -72)) {\r\n      strLetterDesignator = \"D\";\r\n    } else if ((-72 > numLat) && (numLat >= -89)) {\r\n      strLetterDesignator = \"C\";\r\n    } else {\r\n      strLetterDesignator = \"Z\"; // Latitude is outside the UTM limits\r\n    }\r\n    //  } // End try\r\n    // catch (e) {\r\n    //     trace(e.getStackTrace());\r\n    // }\r\n\r\n    return strLetterDesignator;\r\n  },\r\n\r\n  /**\r\n   * @name utmToLatLong\r\n   *\r\n   * @desc Converts a utm coordinate into a lat long coordinate\r\n   *\r\n   * NOTE: code derived from http://stackoverflow.com/questions/343865/how-to-convert-from-utm-to-latlng-in-python-or-javascript\r\n   *\r\n   * @param numZone - IN - Utm zone\r\n   * @param numEasting - IN - Easting value of the utm coordinate\r\n   * @param numNorthing - IN - Northing value of the utm coordinate\r\n   * @param blNorthernHemisphere - IN - True if we are in the northern hemisphere, false otherwise\r\n   * @return A lat long coordinate in this format: \"latitude,longitude\"\r\n   */\r\n  utmToLatLong: function (numZone, numEasting, numNorthing, blNorthernHemisphere) {\r\n    //try {\r\n    if (blNorthernHemisphere === undefined || blNorthernHemisphere === null) {\r\n      blNorthernHemisphere = true;\r\n    }\r\n    if (!blNorthernHemisphere) {\r\n      numNorthing = 10000000 - numNorthing;\r\n    }\r\n\r\n    var numA = 6378137;\r\n    var numE = 0.081819191;\r\n    var numE1sq = 0.006739497;\r\n    var numK0 = 0.9996;\r\n\r\n    var numArc = numNorthing / numK0;\r\n    var numMu = numArc / (numA * (1 - Math.pow(numE, 2) / 4.0 - 3 * Math.pow(numE, 4) / 64.0 - 5 * Math.pow(numE, 6) / 256.0));\r\n\r\n    var numEi = (1 - Math.pow((1 - numE * numE), (1 / 2.0))) / (1 + Math.pow((1 - numE * numE), (1 / 2.0)));\r\n\r\n    var numCa = 3 * numEi / 2 - 27 * Math.pow(numEi, 3) / 32;\r\n    var numCb = 21 * Math.pow(numEi, 2) / 16 - 55 * Math.pow(numEi, 4) / 32;\r\n    var numCc = 151 * Math.pow(numEi, 3) / 96;\r\n    var numCd = 1097 * Math.pow(numEi, 4) / 512;\r\n    var numPhi1 = numMu + numCa * Math.sin(2 * numMu) + numCb * Math.sin(4 * numMu) + numCc * Math.sin(6 * numMu) + numCd * Math.sin(8 * numMu);\r\n\r\n    var numN0 = numA / Math.pow((1 - Math.pow((numE * Math.sin(numPhi1)), 2)), (1 / 2.0));\r\n\r\n    var numR0 = numA * (1 - numE * numE) / Math.pow((1 - Math.pow((numE * Math.sin(numPhi1)), 2)), (3 / 2.0));\r\n    var numFact1 = numN0 * Math.tan(numPhi1) / numR0;\r\n\r\n    var num_a1 = 500000 - numEasting;\r\n    var numDd0 = num_a1 / (numN0 * numK0);\r\n    var numFact2 = numDd0 * numDd0 / 2;\r\n\r\n    var numT0 = Math.pow(Math.tan(numPhi1), 2);\r\n    var numQ0 = numE1sq * Math.pow(Math.cos(numPhi1), 2);\r\n    var numFact3 = (5 + 3 * numT0 + 10 * numQ0 - 4 * numQ0 * numQ0 - 9 * numE1sq) * Math.pow(numDd0, 4) / 24;\r\n    var numFact4 = (61 + 90 * numT0 + 298 * numQ0 + 45 * numT0 * numT0 - 252 * numE1sq - 3 * numQ0 * numQ0) * Math.pow(numDd0, 6) / 720;\r\n\r\n    var numLof1 = num_a1 / (numN0 * numK0);\r\n    var numLof2 = (1 + 2 * numT0 + numQ0) * Math.pow(numDd0, 3) / 6.0;\r\n    var numLof3 = (5 - 2 * numQ0 + 28 * numT0 - 3 * Math.pow(numQ0, 2) + 8 * numE1sq + 24 * Math.pow(numT0, 2)) * Math.pow(numDd0, 5) / 120;\r\n    var num_a2 = (numLof1 - numLof2 + numLof3) / Math.cos(numPhi1);\r\n    var num_a3 = num_a2 * 180 / Math.PI;\r\n\r\n    var numLatitude = 180 * (numPhi1 - numFact1 * (numFact2 + numFact3 + numFact4)) / Math.PI;\r\n\r\n    if (!blNorthernHemisphere) {\r\n      numLatitude = -numLatitude;\r\n    }\r\n\r\n    var numLongitude = ((numZone > 0) && (6 * numZone - 183) || 3) - num_a3;\r\n\r\n    return numLatitude.toString() + \",\" + numLongitude.toString();\r\n    // } // End try\r\n    //  catch (e) {\r\n    //trace(e.getStackTrace());\r\n    //  }\r\n\r\n    //  return \"\";\r\n  } // End utmToLatLong\r\n\r\n\r\n};\r\n\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n/*  Latitude/longitude spherical geodesy formulae & scripts (c) Chris Veness 2002-2011            */\r\n/*   - www.movable-type.co.uk/scripts/latlong.html                                                */\r\n/*                                                                                                */\r\n/*  Sample usage:                                                                                 */\r\n/*    var p1 = new LatLon(51.5136, -0.0983);                                                      */\r\n/*    var p2 = new LatLon(51.4778, -0.0015);                                                      */\r\n/*    var dist = p1.distanceTo(p2);          // in km                                             */\r\n/*    var brng = p1.bearingTo(p2);           // in degrees clockwise from north                   */\r\n/*    ... etc                                                                                     */\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n/*  Note that minimal error checking is performed in this example code!                           */\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n\r\n/**\r\n * Creates a point on the earth's surface at the supplied latitude / longitude\r\n *\r\n * @constructor\r\n * @param {Number} lat: latitude in numeric degrees\r\n * @param {Number} lon: longitude in numeric degrees\r\n * @param {Number} [rad=6371]: radius of earth if different value is required from standard 6,371km\r\n */\r\n\r\nfunction LatLon(lat, lon, rad) {\r\n  if (typeof (rad) == 'undefined') rad = 6371; // earth's mean radius in km\r\n  // only accept numbers or valid numeric strings\r\n  this._lat = typeof (lat) === 'number' ? lat : typeof (lat) === 'string' && lat.trim() !== '' ? +lat : NaN;\r\n  this._lon = typeof (lon) === 'number' ? lon : typeof (lon) === 'string' && lon.trim() !== '' ? +lon : NaN;\r\n  this._radius = typeof (rad) === 'number' ? rad : typeof (rad) === 'string' && trim(lon) !== '' ? +rad : NaN;\r\n}\r\n\r\n\r\n/**\r\n * Returns the distance from this point to the supplied point, in km\r\n * (using Haversine formula)\r\n *\r\n * from: Haversine formula - R. W. Sinnott, \"Virtues of the Haversine\",\r\n *       Sky and Telescope, vol 68, no 2, 1984\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @param   {Number} [precision=4]: no of significant digits to use for returned value\r\n * @returns {Number} Distance in km between this point and destination point\r\n */\r\nLatLon.prototype.distanceTo = function (point, precision) {\r\n  // default 4 sig figs reflects typical 0.3% accuracy of spherical model\r\n  if (typeof precision == 'undefined') precision = 4;\r\n\r\n  var R = this._radius;\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad();\r\n  var lat2 = point._lat.toRad(),\r\n    lon2 = point._lon.toRad();\r\n  var dLat = lat2 - lat1;\r\n  var dLon = lon2 - lon1;\r\n\r\n  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(lat1) * Math.cos(lat2) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  var d = R * c;\r\n  return d.toPrecisionFixed(precision);\r\n};\r\n\r\n\r\n/**\r\n * Returns the (initial) bearing from this point to the supplied point, in degrees\r\n *   see http://williams.best.vwh.net/avform.htm#Crs\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Initial bearing in degrees from North\r\n */\r\nLatLon.prototype.bearingTo = function (point) {\r\n  var lat1 = this._lat.toRad(),\r\n    lat2 = point._lat.toRad();\r\n  var dLon = (point._lon - this._lon).toRad();\r\n\r\n  var y = Math.sin(dLon) * Math.cos(lat2);\r\n  var x = Math.cos(lat1) * Math.sin(lat2) -\r\n    Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);\r\n  var brng = Math.atan2(y, x);\r\n\r\n  return (brng.toDeg() + 360) % 360;\r\n};\r\n\r\n\r\n/**\r\n * Returns final bearing arriving at supplied destination point from this point; the final bearing\r\n * will differ from the initial bearing by varying degrees according to distance and latitude\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Final bearing in degrees from North\r\n */\r\nLatLon.prototype.finalBearingTo = function (point) {\r\n  // get initial bearing from supplied point back to this point...\r\n  var lat1 = point._lat.toRad(),\r\n    lat2 = this._lat.toRad();\r\n  var dLon = (this._lon - point._lon).toRad();\r\n\r\n  var y = Math.sin(dLon) * Math.cos(lat2);\r\n  var x = Math.cos(lat1) * Math.sin(lat2) -\r\n    Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);\r\n  var brng = Math.atan2(y, x);\r\n\r\n  // ... & reverse it by adding 180\r\n  return (brng.toDeg() + 180) % 360;\r\n};\r\n\r\n\r\n/**\r\n * Returns the midpoint between this point and the supplied point.\r\n *   see http://mathforum.org/library/drmath/view/51822.html for derivation\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {LatLon} Midpoint between this point and the supplied point\r\n */\r\nLatLon.prototype.midpointTo = function (point) {\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad();\r\n  var lat2 = point._lat.toRad();\r\n  var dLon = (point._lon - this._lon).toRad();\r\n\r\n  var Bx = Math.cos(lat2) * Math.cos(dLon);\r\n  var By = Math.cos(lat2) * Math.sin(dLon);\r\n\r\n  var lat3 = Math.atan2(Math.sin(lat1) + Math.sin(lat2),\r\n    Math.sqrt((Math.cos(lat1) + Bx) * (Math.cos(lat1) + Bx) + By * By));\r\n  var lon3 = lon1 + Math.atan2(By, Math.cos(lat1) + Bx);\r\n  lon3 = (lon3 + 3 * Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..+180\r\n\r\n  return new LatLon(lat3.toDeg(), lon3.toDeg());\r\n};\r\n\r\n\r\n/**\r\n * Returns the destination point from this point having travelled the given distance (in km) on the\r\n * given initial bearing (bearing may vary before destination is reached)\r\n *\r\n *   see http://williams.best.vwh.net/avform.htm#LL\r\n *\r\n * @param   {Number} brng: Initial bearing in degrees\r\n * @param   {Number} dist: Distance in km\r\n * @returns {LatLon} Destination point\r\n */\r\nLatLon.prototype.destinationPoint = function (brng, dist) {\r\n  dist = typeof (dist) == 'number' ? dist : typeof (dist) === 'string' && dist.trim() !== '' ? +dist : NaN;\r\n  dist = dist / this._radius; // convert dist to angular distance in radians\r\n  brng = brng.toRad(); //\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad();\r\n\r\n  var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) +\r\n    Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));\r\n  var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) * Math.cos(lat1),\r\n      Math.cos(dist) - Math.sin(lat1) * Math.sin(lat2));\r\n  lon2 = (lon2 + 3 * Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..+180\r\n\r\n  return new LatLon(lat2.toDeg(), lon2.toDeg());\r\n};\r\n\r\n\r\n/**\r\n * Returns the point of intersection of two paths defined by point and bearing\r\n *\r\n *   see http://williams.best.vwh.net/avform.htm#Intersection\r\n *\r\n * @param   {LatLon} p1: First point\r\n * @param   {Number} brng1: Initial bearing from first point\r\n * @param   {LatLon} p2: Second point\r\n * @param   {Number} brng2: Initial bearing from second point\r\n * @returns {LatLon} Destination point (null if no unique intersection defined)\r\n */\r\nLatLon.intersection = function (p1, brng1, p2, brng2) {\r\n  brng1 = typeof brng1 == 'number' ? brng1 : typeof brng1 == 'string' && trim(brng1) !== '' ? +brng1 : NaN;\r\n  brng2 = typeof brng2 == 'number' ? brng2 : typeof brng2 == 'string' && trim(brng2) !== '' ? +brng2 : NaN;\r\n  var lat1 = p1._lat.toRad(),\r\n    lon1 = p1._lon.toRad();\r\n  var lat2 = p2._lat.toRad(),\r\n    lon2 = p2._lon.toRad();\r\n  var brng13 = brng1.toRad(),\r\n    brng23 = brng2.toRad();\r\n  var dLat = lat2 - lat1,\r\n    dLon = lon2 - lon1;\r\n  var brng12,\r\n    brng21,\r\n    dist13,\r\n    alpha1,\r\n    alpha2,\r\n    alpha3,\r\n    lat3,\r\n    lon3,\r\n    dLon13;\r\n\r\n  var dist12 = 2 * Math.asin(Math.sqrt(Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2)));\r\n  if (dist12 === 0) return null;\r\n\r\n  // initial/final bearings between points\r\n  var brngA = Math.acos((Math.sin(lat2) - Math.sin(lat1) * Math.cos(dist12)) /\r\n    (Math.sin(dist12) * Math.cos(lat1)));\r\n  if (isNaN(brngA)) brngA = 0; // protect against rounding\r\n  var brngB = Math.acos((Math.sin(lat1) - Math.sin(lat2) * Math.cos(dist12)) /\r\n    (Math.sin(dist12) * Math.cos(lat2)));\r\n\r\n  if (Math.sin(lon2 - lon1) > 0) {\r\n    brng12 = brngA;\r\n    brng21 = 2 * Math.PI - brngB;\r\n  } else {\r\n    brng12 = 2 * Math.PI - brngA;\r\n    brng21 = brngB;\r\n  }\r\n\r\n  alpha1 = (brng13 - brng12 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 2-1-3\r\n  alpha2 = (brng21 - brng23 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 1-2-3\r\n\r\n  if (Math.sin(alpha1) === 0 && Math.sin(alpha2) === 0) return null; // infinite intersections\r\n  if (Math.sin(alpha1) * Math.sin(alpha2) < 0) return null; // ambiguous intersection\r\n\r\n  //alpha1 = Math.abs(alpha1);\r\n  //alpha2 = Math.abs(alpha2);\r\n  // ... Ed Williams takes abs of alpha1/alpha2, but seems to break calculation?\r\n\r\n  alpha3 = Math.acos(-Math.cos(alpha1) * Math.cos(alpha2) +\r\n    Math.sin(alpha1) * Math.sin(alpha2) * Math.cos(dist12));\r\n  dist13 = Math.atan2(Math.sin(dist12) * Math.sin(alpha1) * Math.sin(alpha2),\r\n    Math.cos(alpha2) + Math.cos(alpha1) * Math.cos(alpha3));\r\n  lat3 = Math.asin(Math.sin(lat1) * Math.cos(dist13) +\r\n    Math.cos(lat1) * Math.sin(dist13) * Math.cos(brng13));\r\n  dLon13 = Math.atan2(Math.sin(brng13) * Math.sin(dist13) * Math.cos(lat1),\r\n    Math.cos(dist13) - Math.sin(lat1) * Math.sin(lat3));\r\n  lon3 = lon1 + dLon13;\r\n  lon3 = (lon3 + 3 * Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..+180\r\n\r\n  return new LatLon(lat3.toDeg(), lon3.toDeg());\r\n};\r\n\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n/**\r\n * Returns the distance from this point to the supplied point, in km, travelling along a rhumb line\r\n *\r\n *   see http://williams.best.vwh.net/avform.htm#Rhumb\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Distance in km between this point and destination point\r\n */\r\nLatLon.prototype.rhumbDistanceTo = function (point) {\r\n  var R = this._radius;\r\n  var lat1 = this._lat.toRad(),\r\n    lat2 = point._lat.toRad();\r\n  var dLat = (point._lat - this._lat).toRad();\r\n  var dLon = Math.abs(point._lon - this._lon).toRad();\r\n\r\n  var dPhi = Math.log(Math.tan(lat2 / 2 + Math.PI / 4) / Math.tan(lat1 / 2 + Math.PI / 4));\r\n  var q = (!isNaN(dLat / dPhi) && (dPhi !== 0)) ? dLat / dPhi : Math.cos(lat1); // E-W line gives dPhi=0\r\n  // if dLon over 180 take shorter rhumb across 180 meridian:\r\n  if (dLon > Math.PI) dLon = 2 * Math.PI - dLon;\r\n  var dist = Math.sqrt(dLat * dLat + q * q * dLon * dLon) * R;\r\n\r\n  return dist.toPrecisionFixed(4); // 4 sig figs reflects typical 0.3% accuracy of spherical model\r\n};\r\n\r\n/**\r\n * Returns the bearing from this point to the supplied point along a rhumb line, in degrees\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Bearing in degrees from North\r\n */\r\nLatLon.prototype.rhumbBearingTo = function (point) {\r\n  var lat1 = this._lat.toRad(),\r\n    lat2 = point._lat.toRad();\r\n  var dLon = (point._lon - this._lon).toRad();\r\n\r\n  var dPhi = Math.log(Math.tan(lat2 / 2 + Math.PI / 4) / Math.tan(lat1 / 2 + Math.PI / 4));\r\n  if (Math.abs(dLon) > Math.PI) dLon = dLon > 0 ? -(2 * Math.PI - dLon) : (2 * Math.PI + dLon);\r\n  var brng = Math.atan2(dLon, dPhi);\r\n\r\n  return (brng.toDeg() + 360) % 360;\r\n};\r\n\r\n/**\r\n * Returns the destination point from this point having travelled the given distance (in km) on the\r\n * given bearing along a rhumb line\r\n *\r\n * @param   {Number} brng: Bearing in degrees from North\r\n * @param   {Number} dist: Distance in km\r\n * @returns {LatLon} Destination point\r\n */\r\nLatLon.prototype.rhumbDestinationPoint = function (brng, dist) {\r\n  var R = this._radius;\r\n  var d = parseFloat(dist) / R; // d = angular distance covered on earth's surface\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad(),\r\n    lon2;\r\n  brng = brng.toRad();\r\n\r\n  var lat2 = lat1 + d * Math.cos(brng);\r\n  var dLat = lat2 - lat1;\r\n  var dPhi = Math.log(Math.tan(lat2 / 2 + Math.PI / 4) / Math.tan(lat1 / 2 + Math.PI / 4));\r\n  var q = (!isNaN(dLat / dPhi) && (dPhi !== 0)) ? dLat / dPhi : Math.cos(lat1); // E-W line gives dPhi=0\r\n  var dLon = d * Math.sin(brng) / q;\r\n  // check for some daft bugger going past the pole\r\n  if (Math.abs(lat2) > Math.PI / 2) lat2 = lat2 > 0 ? Math.PI - lat2 : -(Math.PI - lat2);\r\n  lon2 = (lon1 + dLon + 3 * Math.PI) % (2 * Math.PI) - Math.PI;\r\n\r\n  return new LatLon(lat2.toDeg(), lon2.toDeg());\r\n};\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n\r\n/**\r\n * Returns the latitude of this point; signed numeric degrees if no format, otherwise format & dp\r\n * as per Geo.toLat()\r\n *\r\n * @param   {String} [format]: Return value as 'd', 'dm', 'dms'\r\n * @param   {Number} [dp=0|2|4]: No of decimal places to display\r\n * @returns {Number|String} Numeric degrees if no format specified, otherwise deg/min/sec\r\n *\r\n * @requires Geo\r\n */\r\nLatLon.prototype.lat = function (format, dp) {\r\n  if (typeof format == 'undefined') return this._lat;\r\n\r\n  return Geo.toLat(this._lat, format, dp);\r\n};\r\n\r\n/**\r\n * Returns the longitude of this point; signed numeric degrees if no format, otherwise format & dp\r\n * as per Geo.toLon()\r\n *\r\n * @param   {String} [format]: Return value as 'd', 'dm', 'dms'\r\n * @param   {Number} [dp=0|2|4]: No of decimal places to display\r\n * @returns {Number|String} Numeric degrees if no format specified, otherwise deg/min/sec\r\n *\r\n * @requires Geo\r\n */\r\nLatLon.prototype.lon = function (format, dp) {\r\n  if (typeof format == 'undefined') return this._lon;\r\n\r\n  return Geo.toLon(this._lon, format, dp);\r\n};\r\n\r\n/**\r\n * Returns a string representation of this point; format and dp as per lat()/lon()\r\n *\r\n * @param   {String} [format]: Return value as 'd', 'dm', 'dms'\r\n * @param   {Number} [dp=0|2|4]: No of decimal places to display\r\n * @returns {String} Comma-separated latitude/longitude\r\n *\r\n * @requires Geo\r\n */\r\nLatLon.prototype.toString = function (format, dp) {\r\n  if (typeof format == 'undefined') format = 'dms';\r\n\r\n  if (isNaN(this._lat) || isNaN(this._lon)) return '-,-';\r\n\r\n  return Geo.toLat(this._lat, format, dp) + ', ' + Geo.toLon(this._lon, format, dp);\r\n};\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n// ---- extend Number object with methods for converting degrees/radians\r\n\r\n/** Converts numeric degrees to radians */\r\nif (typeof (Number.prototype.toRad) === \"undefined\") {\r\n  Number.prototype.toRad = function () {\r\n    return this * Math.PI / 180;\r\n  };\r\n}\r\n\r\n/** Converts radians to numeric (signed) degrees */\r\nif (typeof (Number.prototype.toDeg) === \"undefined\") {\r\n  Number.prototype.toDeg = function () {\r\n    return this * 180 / Math.PI;\r\n  };\r\n}\r\n\r\n/**\r\n * Formats the significant digits of a number, using only fixed-point notation (no exponential)\r\n *\r\n * @param   {Number} precision: Number of significant digits to appear in the returned string\r\n * @returns {String} A string representation of number which contains precision significant digits\r\n */\r\nif (typeof (Number.prototype.toPrecisionFixed) === \"undefined\") {\r\n  Number.prototype.toPrecisionFixed = function (precision) {\r\n    if (isNaN(this)) return 'NaN';\r\n    var numb = this < 0 ? -this : this; // can't take log of -ve number...\r\n    var sign = this < 0 ? '-' : '',\r\n      l,\r\n      n;\r\n\r\n    // The following if must not compare ===. 0 is of type number but numb\r\n    // is of type object, therefore it would never be ===.\r\n    if (numb === 0) { // can't take log of zero, just format with precision zeros\r\n      n = '0.';\r\n      while (precision--) n += '0';\r\n      return n;\r\n    }\r\n\r\n    var scale = Math.ceil(Math.log(numb) * Math.LOG10E); // no of digits before decimal\r\n    n = String(Math.round(numb * Math.pow(10, precision - scale)));\r\n    if (scale > 0) { // add trailing zeros & insert decimal as required\r\n      l = scale - n.length;\r\n      while (l-- > 0) n = n + '0';\r\n      if (scale < n.length) n = n.slice(0, scale) + '.' + n.slice(scale);\r\n    } else { // prefix decimal and leading zeros if required\r\n      while (scale++ < 0) n = '0' + n;\r\n      n = '0.' + n;\r\n    }\r\n    return sign + n;\r\n  };\r\n}\r\n\r\n/** Trims whitespace from string (q.v. blog.stevenlevithan.com/archives/faster-trim-javascript) */\r\nif (typeof (String.prototype.trim) === \"undefined\") {\r\n  String.prototype.trim = function () {\r\n    return String(this).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n  };\r\n}\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n/* eslint-enable */","/* global Geo */\r\n/* eslint-disable */\r\n\r\n// Ensure the namespace has been created\r\nif (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.utils = {};\r\n}\r\n\r\n/**\r\n * @namespace\r\n * @ignore\r\n */\r\nemp3.utils.geoLibrary = {\r\n\r\n  /**\r\n   * Meters per Degree\r\n   * @constant\r\n   */\r\n  METERS_PER_DEG: 111319.49079327357264771338267056,\r\n\r\n  /**\r\n   *\r\n   * @param x\r\n   * @param y\r\n   * @returns {{x: *, y: *}}\r\n   * @ignore\r\n   * @constructor\r\n   */\r\n  Point: function (x, y) {\r\n    /*this.x = null;\r\n     this.y = null;\r\n     if (x != null)\r\n     this.x = x;\r\n     if (y != null)\r\n     this.y = y;*/\r\n    return {\r\n      x: x,\r\n      y: y\r\n    };\r\n  },\r\n\r\n\r\n  /**\r\n   *\r\n   * @param scale\r\n   * @returns {number}\r\n   */\r\n  metersPerPixel: function (scale) {\r\n    var inchPerMeter = 39.3700787,\r\n      pixelsPerInch = 96,\r\n      step1 = scale / pixelsPerInch;\r\n    return step1 / inchPerMeter;\r\n  },\r\n\r\n  ddToMGRS: function (latDD, longDD) {\r\n    var NS = \"N\",\r\n      EW = \"E\",\r\n      lat,\r\n      lng;\r\n\r\n    if (latDD < 0) {\r\n      latDD = Math.abs(latDD);\r\n      NS = \"S\";\r\n    }\r\n    if (longDD < 0) {\r\n      longDD = Math.abs(longDD);\r\n      EW = \"W\";\r\n    }\r\n    lat = emp3.utils.geoLibrary.ddToDMS(latDD);\r\n    lng = emp3.utils.geoLibrary.ddToDMS(longDD);\r\n    return emp3.utils.geoLibrary.dmsToMGRS(lat.deg, lat.minute, lat.sec, lng.deg, lng.minute, lng.sec, NS, EW);\r\n  },\r\n\r\n  ddToDMS: function (decDeg) {\r\n    var deg = Math.abs(decDeg),\r\n      DMS = {},\r\n      sec;\r\n    DMS.deg = Math.abs(Math.floor(deg));\r\n    DMS.minute = Math.floor(Math.abs(deg - DMS.deg) * 60);\r\n    sec = (((deg - DMS.deg) * 60) - DMS.minute) * 60;\r\n    DMS.sec = sec;\r\n    return DMS;\r\n  },\r\n\r\n  deg2rad: function (deg) {\r\n    var conv_factor = (2.0 * Math.PI) / 360.0;\r\n    return (deg * conv_factor);\r\n  },\r\n\r\n  dmsToMGRS: function (latDegrees, latMinutes, latSeconds, longDegrees, longMinutes, longSeconds, NS, EW) {\r\n    //with (Math) {\r\n    var Deg2Rad = Math.PI / 180.0,\r\n      Area = \"UTM2\",\r\n      Alpha100km = 'VQLFAVQLFAWRMGBWRMGBXSNHCXSNHCYTOJDYTOJDZUPKEZUPKEVQLFAVQLFAWRMGBWRMGBXSNHCXSNHCYTOJDYTOJDZUPKEZUPKE',\r\n      // UTM WGS84 Ellipsoid\r\n      F0 = 0.9996,\r\n      A1 = 6378137.0 * F0,\r\n      B1 = 6356752.3142 * F0,\r\n      K0 = 0,\r\n      N0 = 0,\r\n      E0 = 500000,\r\n      N1 = (A1 - B1) / (A1 + B1),\r\n      // n\r\n      N2 = N1 * N1,\r\n      N3 = N2 * N1,\r\n      E2 = ((A1 * A1) - (B1 * B1)) / (A1 * A1),\r\n      // e^2\r\n      Deg = latDegrees,\r\n      Min = latMinutes,\r\n      Sec = latSeconds,\r\n      Lat = Math.abs(Deg) + Math.abs(Min) / 60.0 + Math.abs(Sec) / 3600.0,\r\n      South = ((NS.toUpperCase() === 'S') && (Lat > 0)),\r\n      West,\r\n      North,\r\n      East,\r\n      IEast,\r\n      INorth,\r\n      EastStr,\r\n      NorthStr,\r\n      Long,\r\n      K,\r\n      L,\r\n      SINK,\r\n      COSK,\r\n      TANK,\r\n      TANK2,\r\n      COSK2,\r\n      COSK3,\r\n      K3,\r\n      K4,\r\n      Merid,\r\n      MeridWest,\r\n      L0,\r\n      J3,\r\n      J4,\r\n      J5,\r\n      J6,\r\n      M,\r\n      Temp,\r\n      V,\r\n      R,\r\n      H2,\r\n      P,\r\n      P2,\r\n      P4,\r\n      J7,\r\n      J8,\r\n      J9,\r\n      GR100km,\r\n      GRremainder,\r\n      LongZone,\r\n      GR,\r\n      Letters,\r\n      Pos,\r\n      LatZone,\r\n      N100km,\r\n      E100km;\r\n\r\n    if (South) {\r\n      Lat = -Lat;\r\n    }\r\n\r\n    Deg = longDegrees;\r\n    Min = longMinutes;\r\n    Sec = longSeconds;\r\n    West = (EW.toUpperCase() === 'W');\r\n    Long = 1.0 * Math.abs(Deg) + Math.abs(Min) / 60.0 + Math.abs(Sec) / 3600.0;\r\n    if (West) {\r\n      Long = -Long;\r\n    }\r\n    K = Lat * Deg2Rad;\r\n    L = Long * Deg2Rad;\r\n    SINK = Math.sin(K);\r\n    COSK = Math.cos(K);\r\n    TANK = SINK / COSK;\r\n    TANK2 = TANK * TANK;\r\n    COSK2 = COSK * COSK;\r\n    COSK3 = COSK2 * COSK;\r\n    K3 = K - K0;\r\n    K4 = K + K0;\r\n    Merid = Math.floor((Long) / 6) * 6 + 3;\r\n    if ((Lat >= 72) && (Long >= 0)) {\r\n      if (Long < 9) {\r\n        Merid = 3;\r\n      } else if (Long < 21) {\r\n        Merid = 15;\r\n      } else if (Long < 33) {\r\n        Merid = 27;\r\n      } else if (Long < 42) {\r\n        Merid = 39;\r\n      }\r\n    }\r\n    if ((Lat >= 56) && (Lat < 64)) {\r\n      if ((Long >= 3) && (Long < 12)) {\r\n        Merid = 9;\r\n      }\r\n    }\r\n    MeridWest = Merid < 0;\r\n    L0 = Merid * Deg2Rad;\r\n    // Long of True Origin (3,9,15 etc)\r\n    // ArcofMeridian\r\n    J3 = K3 * (1 + N1 + 1.25 * (N2 + N3));\r\n    J4 = Math.sin(K3) * Math.cos(K4) * (3 * (N1 + N2 + 0.875 * N3));\r\n    J5 = Math.sin(2 * K3) * Math.cos(2 * K4) * (1.875 * (N2 + N3));\r\n    J6 = Math.sin(3 * K3) * Math.cos(3 * K4) * 35 / 24 * N3;\r\n    M = (J3 - J4 + J5 - J6) * B1;\r\n    // VRH2\r\n    Temp = 1 - E2 * SINK * SINK;\r\n    V = A1 / Math.sqrt(Temp);\r\n    R = V * (1 - E2) / Temp;\r\n    H2 = V / R - 1.0;\r\n    P = L - L0;\r\n    P2 = P * P;\r\n    P4 = P2 * P2;\r\n    J3 = M + N0;\r\n    J4 = V / 2 * SINK * COSK;\r\n    J5 = V / 24 * SINK * (COSK3) * (5 - (TANK2) + 9 * H2);\r\n    J6 = V / 720 * SINK * COSK3 * COSK2 * (61 - 58 * (TANK2) + TANK2 * TANK2);\r\n    North = J3 + P2 * J4 + P4 * J5 + P4 * P2 * J6;\r\n    if (((Area === 'UTM1') || (Area === 'UTM2')) && South) {\r\n      North = North + 10000000.0;\r\n      // UTM S hemisphere\r\n    }\r\n    J7 = V * COSK;\r\n    J8 = V / 6 * COSK3 * (V / R - TANK2);\r\n    J9 = V / 120 * COSK3 * COSK2;\r\n    J9 = J9 * (5 - 18 * TANK2 + TANK2 * TANK2 + 14 * H2 - 58 * TANK2 * H2);\r\n    East = E0 + P * J7 + P2 * P * J8 + P4 * P * J9;\r\n    IEast = Math.round(East);\r\n    INorth = Math.round(North);\r\n    // should strictly be trunc\r\n    EastStr = '';\r\n    EastStr = EastStr + Math.abs(IEast);\r\n    NorthStr = '';\r\n    NorthStr = NorthStr + Math.abs(INorth);\r\n    while (EastStr.length < 7) {\r\n      EastStr = '0' + EastStr;\r\n    }\r\n    while (NorthStr.length < 7) {\r\n      NorthStr = '0' + NorthStr;\r\n    }\r\n    GR100km = EastStr.substring(1, 2) + NorthStr.substring(1, 2);\r\n    GRremainder = EastStr.substring(2, 7) + \" \" + NorthStr.substring(2, 7);\r\n\r\n    if ((Area === 'UTM1') || (Area === 'UTM2')) {\r\n      // UTM\r\n      LongZone = (Merid - 3) / 6 + 31;\r\n      if (LongZone % 1 !== 0) {\r\n        //non-UTM central meridian\r\n        GR = null;\r\n      } else {\r\n        if (IEast < 100000 || Lat < -80 || IEast > 899999 || Lat >= 84) {\r\n          // outside UTM grid area\r\n          GR = null;\r\n        } else {\r\n          Letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ';\r\n          Pos = Math.round(Lat / 8 - 0.5) + 10 + 2;\r\n          LatZone = Letters.substring(Pos, Pos + 1);\r\n          if (LatZone > 'X') {\r\n            LatZone = 'X';\r\n          }\r\n          Pos = Math.round(Math.abs(INorth) / 100000 - 0.5);\r\n          while (Pos > 19) {\r\n            Pos = Pos - 20;\r\n          }\r\n          if (LongZone % 2 === 0) {\r\n            Pos = Pos + 5;\r\n            if (Pos > 19) {\r\n              Pos = Pos - 20;\r\n            }\r\n          }\r\n          N100km = Letters.substring(Pos, Pos + 1);\r\n\r\n          Pos = GR100km / 10 - 1;\r\n          P = LongZone;\r\n          while (P > 3) {\r\n            P = P - 3;\r\n          }\r\n          Pos = Pos + ((P - 1) * 8);\r\n          E100km = Letters.substring(Pos, Pos + 1);\r\n          GR = LongZone + LatZone + ' ' + E100km + N100km + ' ' + GRremainder;\r\n        }\r\n      }\r\n      return GR;\r\n    }\r\n\r\n    return \"Did not convert correctly\";\r\n  },\r\n  ValidLongZone: function (ZoneCell) {\r\n    if ((ZoneCell < 1) || (ZoneCell > 60)) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  },\r\n  UTMCMfromLongZone: function (ZoneCell) {\r\n    if (!this.ValidLongZone(ZoneCell)) {\r\n      return -181; //\"#INVALID LONGITUDE ZONE\";\r\n    } else {\r\n      return (ZoneCell - 1) * 6 - 180 + 3;\r\n    }\r\n  },\r\n\r\n  truncateDecimal: function (value) {\r\n    var precision = 5,\r\n      returnValue = value,\r\n      valString = value.toString(),\r\n      dotIndex = valString.indexOf(\".\"),\r\n      baseValue,\r\n      decValue;\r\n    if (dotIndex !== -1) {\r\n      if (dotIndex + precision <= valString.length) {\r\n        baseValue = parseFloat(valString.substr(0, dotIndex));\r\n        decValue = parseFloat(valString.substr(dotIndex, precision + 1));\r\n        if (baseValue < 0) {\r\n          if (decValue === 0.99999) {\r\n            baseValue -= 1;\r\n            decValue = 0.0;\r\n          }\r\n          returnValue = baseValue - decValue;\r\n        } else {\r\n          if (decValue === 0.99999) {\r\n            baseValue += 1;\r\n            decValue = 0.0;\r\n          }\r\n          returnValue = baseValue + decValue;\r\n        }\r\n      }\r\n    }\r\n    return returnValue;\r\n  },\r\n  TM2LL: function (LatLong, EastCell, NorthCell, Merid) {\r\n    var Area = 4,\r\n      Deg2Rad = 3.14159265358979 / 180,\r\n      MGRS_Old = (Area < 0),\r\n      F0,\r\n      A1,\r\n      B1,\r\n      K0,\r\n      L0,\r\n      N0,\r\n      N1,\r\n      N2,\r\n      N3,\r\n      E0,\r\n      E2,\r\n      N,\r\n      E,\r\n      NRel,\r\n      K,\r\n      K3,\r\n      K4,\r\n      J3,\r\n      J4,\r\n      J5,\r\n      J6,\r\n      M,\r\n      Finished,\r\n      SINK,\r\n      COSK,\r\n      TANK,\r\n      TANK2,\r\n      Temp,\r\n      V,\r\n      R,\r\n      H2,\r\n      V3,\r\n      Y1,\r\n      Y12,\r\n      K9,\r\n      J7,\r\n      J8,\r\n      J9,\r\n      L;\r\n\r\n    if (MGRS_Old) {\r\n      Area = -Area;\r\n    }\r\n    if (Area === 4) {\r\n      // ' UTM WGS84 Ellipsoid\r\n      F0 = 0.9996;\r\n      //' Local scale factor on Central Meridian\r\n      A1 = 6378137 * F0;\r\n      // ' Major Semi-axis, WGS84 ellipsoid\r\n      B1 = 6356752.3142 * F0;\r\n      // ' Minor Semi-axis, WGS84 ellipsoid\r\n      K0 = 0;\r\n      // ' Lat of True Origin\r\n      L0 = Merid * Deg2Rad;\r\n      // ' Long of True Origin (3,6,9 etc)\r\n      N0 = 0;\r\n      // ' Grid Northing of True Origin (m)\r\n      E0 = 500000;\r\n      // ' Grid Easting of True Origin (m)\r\n    } else {\r\n      return -181; //\"#INVALID AREA 8\";\r\n    }\r\n\r\n    N1 = (A1 - B1) / (A1 + B1);\r\n    // ' n\r\n    N2 = N1 * N1;\r\n    N3 = N2 * N1;\r\n    E2 = ((A1 * A1) - (B1 * B1)) / (A1 * A1);\r\n    // ' e^2\r\n    N = NorthCell;\r\n    E = EastCell;\r\n    NRel = N - N0;\r\n    K = NRel / A1 + K0;\r\n\r\n    while (!Finished) {\r\n      K3 = K - K0;\r\n      K4 = K + K0;\r\n      J3 = K3 * (1 + N1 + 1.25 * (N2 + N3));\r\n      J4 = Math.sin(K3) * Math.cos(K4) * (3 * (N1 + N2 + 0.875 * N3));\r\n      J5 = Math.sin(2 * K3) * Math.cos(2 * K4) * (1.875 * (N2 + N3));\r\n      J6 = Math.sin(3 * K3) * Math.cos(3 * K4) * 35 / 24 * N3;\r\n      M = (J3 - J4 + J5 - J6) * B1;\r\n      Finished = Math.abs(NRel - M) < 0.001;\r\n      if (!Finished) {\r\n        K = K + (NRel - M) / A1;\r\n      }\r\n    }\r\n    SINK = Math.sin(K);\r\n    COSK = Math.cos(K);\r\n    TANK = SINK / COSK;\r\n    TANK2 = TANK * TANK;\r\n    Temp = 1 - E2 * SINK * SINK;\r\n    V = A1 / Math.sqrt(Temp);\r\n    R = V * (1 - E2) / Temp;\r\n    H2 = V / R - 1;\r\n    V3 = V * V * V;\r\n    Y1 = E - E0;\r\n    Y12 = Y1 * Y1;\r\n    J3 = TANK / (2 * R * V);\r\n    J4 = TANK / (24 * R * V3) * (5 + 3 * TANK2 + H2 - 9 * TANK2 * H2);\r\n    J5 = TANK / (720 * R * Math.pow(V, 5)) * (61 + 90 * TANK * TANK + 45 * Math.pow(TANK, 4));\r\n    K9 = K - Y12 * J3 + Y12 * Y12 * J4 - Math.pow(Y1, 6) * J5;\r\n    J6 = 1 / (COSK * V);\r\n    J7 = 1 / (COSK * 6 * V3) * (V / R + 2 * TANK2);\r\n    J8 = 1 / (COSK * 120 * Math.pow(V, 5)) * (5 + 28 * TANK * TANK + 24 * Math.pow(TANK, 4));\r\n    J9 = 1 / (COSK * 5040 * Math.pow(V, 7));\r\n    J9 = J9 * (61 + 662 * TANK * TANK + 1320 * Math.pow(TANK, 4) + 720 * Math.pow(TANK, 6));\r\n    L = L0 + Y1 * J6 - Y1 * Y12 * J7 + Math.pow(Y1, 5) * J8 - Math.pow(Y1, 7) * J9;\r\n    //var L = L0 + Y1 * J6 - Y1 * Y12 * J7 + Y1 ^ 5 * J8 - Y1 ^ 7 * J9;\r\n    K = K9;\r\n    if (LatLong.toUpperCase() === \"LATITUDE\") {\r\n      //return -181;//\r\n      return this.truncateDecimal(K / Deg2Rad);\r\n      //'TM2LL = Int(K / Deg2Rad * 100000 + 0.5) / 100000\r\n    } else if (LatLong.toUpperCase() === \"LONGITUDE\") {\r\n      return this.truncateDecimal(L / Deg2Rad);\r\n      //'TM2LL = Int(L / Deg2Rad * 100000 + 0.5) / 100000\r\n    } else {\r\n      return -181; //\"#FIRST PARAMETER MUST BE 9\";\r\n      // & Chr(34) & \"latitude\" & Chr(34) & \" or \" & Chr(34) & \"longitude\" & Chr(34)\r\n    }\r\n  },\r\n\r\n\r\n  mgrsToDD: function (LatLong, GRCell) {\r\n    var Area = 4,\r\n      noSpace = GRCell.split(\" \"),\r\n      isEven,\r\n      S,\r\n      i,\r\n      LongZoneNumber,\r\n      Posn,\r\n      MGRS_Old,\r\n      GRLength,\r\n      LatZoneNumber,\r\n      GRX,\r\n      LatZoneLetter,\r\n      Long100Letter,\r\n      Lat100Letter,\r\n      LongZoneMerid,\r\n      Long100Number,\r\n      LatZoneDeg,\r\n      Lat100Number,\r\n      ApproxLatZoneKm,\r\n      LatKm,\r\n      Neg,\r\n      Diff,\r\n      PrevDiff,\r\n      GRY,\r\n      Ndigits,\r\n      X,\r\n      Y,\r\n      nn,\r\n      HalfDigits,\r\n      Mult,\r\n      hj,\r\n      Merid;\r\n    GRCell = noSpace.join(\"\");\r\n    isEven = false;\r\n    if ((GRCell.length >= 6) && (!isEven)) {\r\n      GRLength = GRCell.length;\r\n      if (GRLength > 2) {\r\n        S = \"\";\r\n        for (i = 0; i < GRLength; i += 1) {\r\n          if (GRCell.substr(i, 1) !== \" \") {\r\n            S = S + GRCell.substr(i, 1);\r\n          }\r\n        }\r\n        GRCell = S;\r\n      }\r\n      GRLength = GRCell.length;\r\n      if (GRLength < 3) {\r\n        //#INVALID MGRS GRID REFERENCE 1\r\n\r\n        return -181; //\"#INVALID GRID REFERENCE 1\";\r\n      }\r\n      GRCell = GRCell.toUpperCase();\r\n      MGRS_Old = Area < 0;\r\n      if (MGRS_Old) {\r\n        Area = -Area;\r\n      }\r\n      if (Area === 4) {\r\n\r\n        //' analyse UTM code\r\n        if (!isNaN(parseFloat(GRCell.substr(0, 2)))) {\r\n          //if (parseInt(GRCell.substr(1, 1)))\r\n          //{\r\n          Posn = 2;\r\n\r\n          LongZoneNumber = parseFloat(GRCell.substr(0, 2));\r\n          //}\r\n          //else\r\n          //{\r\n          //\tPosn = 1;\r\n          //}\r\n\r\n        } else {\r\n          //#INVALID MGRS GRID REFERENCE 2\r\n          //return -181;//\"#INVALID MGRS GRID REFERENCE 2\";\r\n          Posn = 1;\r\n\r\n          LongZoneNumber = parseFloat(GRCell.substr(0, 1));\r\n\r\n        }\r\n        LatZoneLetter = GRCell.substr(Posn, 1);\r\n        Posn = Posn + 1;\r\n        Long100Letter = GRCell.substr(Posn, 1);\r\n        Posn = Posn + 1;\r\n        Lat100Letter = GRCell.substr(Posn, 1);\r\n        Posn = Posn + 1;\r\n        //' deal with longitude params\r\n        LongZoneMerid = (LongZoneNumber - 1) * 6 - 180 + 3;\r\n        Long100Number = Long100Letter.charCodeAt(0) - 64;\r\n        if ((Long100Number < 1) || (Long100Number > 26) || (Long100Number === 9) || (Long100Number === 15)) {\r\n          return -181; //\"#INVALID MGRS GRID REFERENCE 3\";\r\n        }\r\n        //' 24 long codes 'A'..'Z' missing out 'I' and 'O'\r\n        //' ABCDEFFG  JKLMNPQR  STUVWXYZ\r\n        //' 12345678  12345678  12345678\r\n        if (Long100Number > 8) {\r\n          // ' 'I'...\r\n          Long100Number = Long100Number - 9;\r\n          if (Long100Number > 5) {\r\n            // Then ' 'O'...\r\n            Long100Number = Long100Number - 1;\r\n            if (Long100Number > 8) {\r\n              Long100Number = Long100Number - 8;\r\n            }\r\n          }\r\n        }\r\n        GRX = 100000 * Long100Number;\r\n        //' 100km to M\r\n        //' deal with latitude params\r\n        LatZoneNumber = LatZoneLetter.charCodeAt(0) - 66;\r\n        if ((LatZoneNumber < 1) || (LatZoneNumber > 22) || (LatZoneNumber === 7) || (LatZoneNumber === 13)) {\r\n          // INVALID MGRS GRID REFERENCE 4\r\n          return -181; //\"#INVALID MGRS GRID REFERENCE 4\";\r\n        }\r\n        //' 20 lat zones 'C'..'X' Missing out I' and 'O' 'C'=1  at 80S\r\n        if (LatZoneNumber > 6) {\r\n          //  ' get rid of 'I' and 'O'\r\n          LatZoneNumber = LatZoneNumber - 1;\r\n          if (LatZoneNumber > 11) {\r\n            LatZoneNumber = LatZoneNumber - 1;\r\n          }\r\n        }\r\n        LatZoneDeg = (LatZoneNumber - 1) * 8 - 80;\r\n        //' N from 80S\r\n        Lat100Number = Lat100Letter.charCodeAt(0) - 64;\r\n        if ((Lat100Number < 1) || (Lat100Number > 22) || (Lat100Number === 9) || (Lat100Number === 15)) {\r\n          //INVALID MGRS GRID REFERENCE 5\r\n          return -181; //;\r\n        }\r\n        //' 20 lat codes 'A'..'V' missing out 'I' and 'O'\r\n        if (Lat100Number > 8) {\r\n          // Then  ' get rid of 'I' and 'O'\r\n          Lat100Number = Lat100Number - 1;\r\n          if (Lat100Number > 13) {\r\n            Lat100Number = Lat100Number - 1;\r\n          }\r\n        }\r\n        if ((LongZoneNumber % 2) === 0) {\r\n          // Then ' convert 'F'..'V'..'E' to 'A'..'V''\r\n          if (Lat100Number > 5) {\r\n            Lat100Number = Lat100Number - 5;\r\n          } else {\r\n            Lat100Number = Lat100Number + 15;\r\n          }\r\n        }\r\n        ApproxLatZoneKm = LatZoneDeg * 110;\r\n        LatKm = (Lat100Number - 1) * 100;\r\n        Neg = ApproxLatZoneKm < 0;\r\n        if (Neg) {\r\n          LatKm = 2000 - LatKm;\r\n          ApproxLatZoneKm = -ApproxLatZoneKm;\r\n        }\r\n        if (Neg) {\r\n          ApproxLatZoneKm = ApproxLatZoneKm - 110 * 8;\r\n        }\r\n        Diff = 0;\r\n        PrevDiff = 1;\r\n        while (Diff < PrevDiff) {\r\n          PrevDiff = Math.abs(LatKm - ApproxLatZoneKm);\r\n          LatKm = LatKm + 2000;\r\n          Diff = Math.abs(LatKm - ApproxLatZoneKm);\r\n        }\r\n        LatKm = LatKm - 2000;\r\n        if ((LatZoneLetter === \"X\") && (LatKm < (Math.floor(ApproxLatZoneKm / 100) * 100))) {\r\n          LatKm = LatKm + 2000;\r\n        }\r\n        if (Neg) {\r\n          LatKm = -LatKm;\r\n        }\r\n        if (MGRS_Old) {\r\n          LatKm = LatKm - 1000;\r\n        }\r\n        GRY = LatKm * 1000;\r\n        //' now locate within 100km square\r\n        Ndigits = GRCell.length - (Posn + 1);\r\n        X = 0;\r\n        Y = 0;\r\n        switch (Ndigits) {\r\n          case 0:\r\n          // ' 100km\r\n          case 1:\r\n            //  ' 50km\r\n            nn = parseInt(GRCell.substr(Posn, 1), 10);\r\n            switch (nn) {\r\n              case 1:\r\n                Y = 50000;\r\n                break;\r\n              case 2:\r\n              case 3:\r\n                X = 50000;\r\n                Y = 50000;\r\n                break;\r\n              case 4:\r\n                X = 50000;\r\n                break;\r\n              default:\r\n                // INVALID MGRS GRID REFERENCE 5\r\n                return -181; //;\r\n            }\r\n            break;\r\n          //case 2:\r\n          //case 4:\r\n          //case 6:\r\n          //case 8:\r\n          //case 10:\r\n          default:\r\n            // ' 10km...1m\r\n            HalfDigits = Ndigits / 2;\r\n            X = parseInt(GRCell.substr(Posn, HalfDigits + 1), 10);\r\n            Y = parseInt(GRCell.substr((Posn + HalfDigits + 1), HalfDigits + 1), 10);\r\n            Mult = 100000;\r\n            for (hj = 0; hj < HalfDigits; hj += 1) {\r\n              Mult = Mult / 10;\r\n            }\r\n            X = X * Mult;\r\n            Y = Y * Mult;\r\n            // INVALID MGRS GRID REFERENCE 6\r\n            break;\r\n        }\r\n        GRX = GRX + X;\r\n        GRY = GRY + Y;\r\n        Merid = this.UTMCMfromLongZone(LongZoneNumber);\r\n        return this.TM2LL(LatLong, GRX, GRY, Merid);\r\n      } else {\r\n        // UNSUPPORTED AREA 7\r\n        return -181;\r\n\r\n      }\r\n    }\r\n    // end of function bad return\r\n    return -181;\r\n  },\r\n\r\n\r\n  getMetersPerDegAtLat: function (lat) // Compute lengths of degrees\r\n  {\r\n\r\n    var m1,\r\n      m2,\r\n      m3,\r\n      m4,\r\n      p1,\r\n      p2,\r\n      p3,\r\n      latlen,\r\n      longlen;\r\n\r\n    // Convert latitude to radians\r\n    lat = emp3.utils.geoLibrary.deg2rad(lat);\r\n\r\n    // Set up \"Constants\"\r\n    m1 = 111132.92; // latitude calculation term 1\r\n\r\n    m2 = -559.82; // latitude calculation term 2\r\n\r\n    m3 = 1.175; // latitude calculation term 3\r\n\r\n    m4 = -0.0023; // latitude calculation term 4\r\n\r\n    p1 = 111412.84; // longitude calculation term 1\r\n\r\n    p2 = -93.5; // longitude calculation term 2\r\n\r\n    p3 = 0.118; // longitude calculation term 3\r\n\r\n    // Calculate the length of a degree of latitude and longitude in meters\r\n\r\n    latlen = m1 + (m2 * Math.cos(2 * lat)) + (m3 * Math.cos(4 * lat)) + (m4 * Math.cos(6 * lat));\r\n\r\n    longlen = (p1 * Math.cos(lat)) + (p2 * Math.cos(3 * lat)) + (p3 * Math.cos(5 * lat));\r\n\r\n    return longlen; //,latlen];\r\n\r\n    //return emp3.utils.geoLibrary.measureDistance(lat,0,lat,1,\"meters\");\r\n  },\r\n\r\n  getPointFromDistanceBearing: function (startLat, startLon, distance, bearing) {\r\n    var milsPerDegree = 17.7777777778;\r\n    // Comvert bearing in degrees to bearing in mils for calculation\r\n    bearing = bearing * Math.PI / 180;\r\n    //Earths radius according to WGS84\r\n    var R = 6371; // 007.1809;\r\n    var lat2 = Math.asin(Math.sin(startLat) * Math.cos(distance / R) + Math.cos(startLat) * Math.sin(distance / R) * Math.cos(bearing));\r\n    var lon2 = startLon + Math.atan2(Math.sin(bearing) * Math.sin(distance / R) * Math.cos(startLat), Math.cos(distance / R) - Math.sin(startLat) * Math.sin(lat2));\r\n    return {\r\n      lat: lat2,\r\n      lon: lon2\r\n    };\r\n  },\r\n\r\n  getMidPoint: function (lat1, lon1, lat2, lon2) {\r\n    var lat3 = (lat1 + lat2) / 2;\r\n    var f1 = Math.tan(Math.PI / 4 + lat1 / 2);\r\n    var f2 = Math.tan(Math.PI / 4 + lat2 / 2);\r\n    var f3 = Math.tan(Math.PI / 4 + lat3 / 2);\r\n    var lon3 = ((lon2 - lon1) * Math.log(f3) + lon1 * Math.log(f2) - lon2 * Math.log(f1)) / Math.log(f2 / f1);\r\n    return lon3;\r\n  },\r\n  /*\r\n   getBearing: function(){\r\n   var y = Math.sin(dLon) * Math.cos(lat2);\r\n   var x = Math.cos(lat1)*Math.sin(lat2) - Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);\r\n   var brng = Math.atan2(y, x).toDeg();\r\n   return brng;\r\n   },\r\n   */\r\n  measureDistance: function (latitude1, longitude1, latitude2, longitude2, unitOfMeasure) {\r\n    // latitude1,latitude2 = latitude, longitude1,longitude2 = longitude\r\n    //Radius is 6378.1 (km), 3963.1 (mi), 3443.9 (nm\r\n\r\n    var distance = -1,\r\n      rad;\r\n    //if((validateCoordinate(latitude1,longitude1) == true)&&(validateCoordinate(latitude2,longitude2) == true))\r\n    //{\r\n\r\n    switch (unitOfMeasure.toLowerCase()) {\r\n      case \"kilometers\":\r\n        rad = 6378.137;\r\n        break;\r\n      case \"meters\":\r\n        rad = 6378137;\r\n        break;\r\n      case \"miles\":\r\n        rad = 3963.1;\r\n        break;\r\n      case \"feet\":\r\n        rad = 20925524.9;\r\n        break;\r\n      case \"yards\":\r\n        rad = 6975174.98;\r\n        break;\r\n      case \"nautical\":\r\n        rad = 3443.9;\r\n        break;\r\n      case \"nautical miles\":\r\n        rad = 3443.9;\r\n        break;\r\n      default:\r\n        return -1;\r\n    }\r\n    latitude1 = latitude1 * (Math.PI / 180);\r\n    latitude2 = latitude2 * (Math.PI / 180);\r\n    longitude1 = longitude1 * (Math.PI / 180);\r\n    longitude2 = longitude2 * (Math.PI / 180);\r\n    distance = (Math.acos(Math.cos(latitude1) * Math.cos(longitude1) * Math.cos(latitude2) * Math.cos(longitude2) + Math.cos(latitude1) * Math.sin(longitude1) * Math.cos(latitude2) * Math.sin(longitude2) + Math.sin(latitude1) * Math.sin(latitude2)) * rad);\r\n    //}\r\n    return distance;\r\n  },\r\n\r\n  coordinateArrayToString: function (coordinates) {\r\n    var len = coordinates.length,\r\n      coordString = '',\r\n      controlLong = coordinates[0][0],\r\n      controlLat = coordinates[0][1],\r\n      i;\r\n\r\n    for (i = 0; i < len; i += 1) {\r\n      if (i > 0) {\r\n        coordString += ' ';\r\n      }\r\n      coordString += coordinates[i][0].toString() + \",\" + coordinates[i][1].toString();\r\n      if (coordinates[i].length === 3) {\r\n        coordString += \",\" + coordinates[i][2].toString();\r\n      } else {\r\n        coordString += \",0\";\r\n      }\r\n    }\r\n    return coordString;\r\n  },\r\n\r\n  coordinateStringToArray: function (coordinates) {\r\n    var coordArr = [],\r\n      pairs,\r\n      len,\r\n      i,\r\n      values,\r\n      alt;\r\n    if (coordinates.length > 0) {\r\n      pairs = coordinates.split(\" \");\r\n      len = pairs.length;\r\n      for (i = 0; i < len; i += 1) {\r\n        values = pairs[i].split(',');\r\n        alt = 0;\r\n        if (values.length === 3) {\r\n          alt = parseInt(values[2], 10);\r\n        }\r\n        coordArr.push({\r\n          lat: parseFloat(values[1]),\r\n          lon: parseFloat(values[0]),\r\n          alt: alt\r\n        });\r\n      }\r\n    }\r\n    return coordArr;\r\n  },\r\n\r\n  validateLatLon: function (lat, lon) {\r\n    var valid = false;\r\n    if (!isNaN(lat) && !isNaN(lon)) {\r\n      if (lat <= 90 && lat >= -90 && lon <= 180 && lon >= -180) {\r\n        valid = true;\r\n      }\r\n    }\r\n    return valid;\r\n  },\r\n\r\n  //private static double sm_a\t= 6378137;WGS-84\r\n  /*\r\n   Degrees To Radians\r\n   */\r\n  DegToRad: function (deg) {\r\n    return deg / 180.0 * Math.PI;\r\n  },\r\n\r\n  /*\r\n   Radians to Degrees\r\n   */\r\n  RadToDeg: function (rad) {\r\n    return rad / Math.PI * 180.0;\r\n  },\r\n\r\n  /**\r\n   * Returns the azimuth from true north between two points\r\n   * @param c1 - geocoord object with 'x' and 'y' parameters\r\n   * @param c2 - geocoord object with 'x' and 'y' parameters\r\n   * @return the azimuth from c1 to c2 in degrees\r\n   */\r\n  GetAzimuth: function (c1, c2) { //was private\r\n    var theta = 0;\r\n    try {\r\n      var lat1 = this.DegToRad(c1.y);\r\n      var lon1 = this.DegToRad(c1.x);\r\n      var lat2 = this.DegToRad(c2.y);\r\n      var lon2 = this.DegToRad(c2.x);\r\n      //formula\r\n      // = atan2( sin(long).cos(lat2),\r\n      //cos(lat1).sin(lat2)  sin(lat1).cos(lat2).cos(long) )\r\n      //var theta = Math.atan2( Math.sin(lon2-lon1)*Math.cos(lat2),\r\n      //Math.cos(lat1)*Math.sin(lat2)  Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1) );\r\n      var y = Math.sin(lon2 - lon1);\r\n      y *= Math.cos(lat2);\r\n      var x = Math.cos(lat1);\r\n      x *= Math.sin(lat2);\r\n      var z = Math.sin(lat1);\r\n      z *= Math.cos(lat2);\r\n      z *= Math.cos(lon2 - lon1);\r\n      x = x - z;\r\n      theta = Math.atan2(y, x);\r\n      theta = this.RadToDeg(theta);\r\n    } catch (error) {\r\n      //System.out.println(e.getMessage());\r\n    }\r\n    return theta; //RadToDeg(k);\r\n  },\r\n\r\n  /**\r\n   * Calculates a geodesic point and given distance and azimuth from the srating geodesic point\r\n   *\r\n   * @param start the starting point\r\n   * @param distance the distance in meters\r\n   * @param azimuth the azimuth or bearing in degrees\r\n   *\r\n   * @return the calculated point\r\n   */\r\n  geodesic_coordinate: function (start,\r\n                                 distance,\r\n                                 azimuth) {\r\n    var pt = this.Point();\r\n\r\n    var sm_a = 6378137; //WGS - 84\r\n    try {\r\n      //formula\r\n      //lat2 = asin(sin(lat1)*cos(d/R) + cos(lat1)*sin(d/R)*cos())\r\n      //lon2 = lon1 + atan2(sin()*sin(d/R)*cos(lat1), cos(d/R)sin(lat1)*sin(lat2))\r\n\r\n      var a = 0,\r\n        b = 0,\r\n        c = 0,\r\n        d = 0,\r\n        e = 0,\r\n        f = 0,\r\n        g = 0,\r\n        h = 0,\r\n        j = 0,\r\n        k = 0,\r\n        l = 0,\r\n        m = 0,\r\n        n = 0,\r\n        p = 0,\r\n        q = 0;\r\n\r\n      a = this.DegToRad(start.y);\r\n      b = Math.cos(a);\r\n      c = this.DegToRad(azimuth);\r\n      d = Math.sin(a);\r\n      e = Math.cos(distance / sm_a);\r\n      f = Math.sin(distance / sm_a);\r\n      g = Math.cos(c);\r\n      //uncomment to test calculation\r\n      //var lat2 = RadToDeg(Math.asin(Math.sin(DegToRad(start.y)) * Math.cos(DegToRad(distance / sm_a)) + Math.cos(DegToRad(start.y)) * Math.sin(DegToRad(distance / sm_a)) * Math.cos(DegToRad(azimuth))));\r\n      //lat2 = asin(sin(lat1)*cos(d/R) + cos(lat1)*sin(d/R)*cos())\r\n      //var lat2 = RadToDeg(Math.asin(Math.sin(DegToRad(start.y)) * Math.cos(distance / sm_a) + Math.cos(DegToRad(start.y)) * Math.sin(distance / sm_a) * Math.cos(DegToRad(azimuth))));\r\n      //double lat2 = RadToDeg(Math.asin(Math.sin(DegToRad(start.y)) * Math.cos(distance / sm_a) + Math.cos(DegToRad(start.y)) * Math.sin(distance / sm_a) * Math.cos(DegToRad(azimuth))));\r\n      var lat = this.RadToDeg(Math.asin(d * e + b * f * g));\r\n      h = Math.sin(c);\r\n      k = Math.sin(h);\r\n      l = Math.cos(a);\r\n      m = this.DegToRad(lat);\r\n      n = Math.sin(m);\r\n      p = Math.atan2(h * f * b, e - d * n);\r\n      //uncomment to test calculation\r\n      //var lon2 = start.x + DegToRad(Math.atan2(Math.sin(DegToRad(azimuth)) * Math.sin(DegToRad(distance / sm_a)) * Math.cos(DegToRad(start.y)), Math.cos(DegToRad(distance / sm_a)) - Math.sin(DegToRad(start.y)) * Math.sin(DegToRad(lat))));\r\n      //lon2 = lon1 + atan2(sin()*sin(d/R)*cos(lat1), cos(d/R)sin(lat1)*sin(lat2))\r\n      //var lon2 = start.x + RadToDeg(Math.atan2(Math.sin(DegToRad(azimuth)) * Math.sin(distance / sm_a) * Math.cos(DegToRad(start.y)), Math.cos(distance / sm_a) - Math.sin(DegToRad(start.y)) * Math.sin(DegToRad(lat2))));\r\n      var lon = start.x + this.RadToDeg(p);\r\n      pt = this.Point();\r\n      pt.x = lon;\r\n      pt.y = lat;\r\n\r\n    } catch (error) {\r\n      //clsUtility.WriteFile(\"Error in mdlGeodesic.geodesic_distance\");\r\n\r\n    }\r\n    return pt;\r\n  },\r\n\r\n  /**\r\n   * returns intersection of two lines, each defined by a point and a bearing\r\n   * <a rel=\"license\" href=\"http://creativecommons.org/licenses/by/3.0/\"><img alt=\"Creative Commons License\" style=\"border-width:0\" src=\"http://i.creativecommons.org/l/by/3.0/88x31.png\" /></a><br />This work is licensed under a <a rel=\"license\" href=\"http://creativecommons.org/licenses/by/3.0/\">Creative Commons Attribution 3.0 Unported License</a>.\r\n   * @param p1\r\n   * @param brng1\r\n   * @param p2\r\n   * @param brng2\r\n   * @return boolean\r\n   */\r\n  IntersectLines: function (p1,\r\n                            brng1,\r\n                            p2,\r\n                            brng2) {\r\n    var ptResult = null;\r\n    try {\r\n      var lat1 = this.DegToRad(p1.y); //p1._lat.toRad();\r\n      var lon1 = this.DegToRad(p1.x); //p1._lon.toRad();\r\n      var lat2 = this.DegToRad(p2.y); //p2._lat.toRad();\r\n      var lon2 = this.DegToRad(p2.x); //p2._lon.toRad();\r\n      var brng13 = this.DegToRad(brng1); //brng1.toRad();\r\n      var brng23 = this.DegToRad(brng2); //brng2.toRad();\r\n      var dLat = lat2 - lat1;\r\n      var dLon = lon2 - lon1;\r\n\r\n\r\n      var dist12 = 2 * Math.asin(Math.sqrt(Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n          Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2)));\r\n\r\n      if (dist12 === 0) {\r\n        return null;\r\n      }\r\n\r\n      var brngA = Math.acos((Math.sin(lat2) - Math.sin(lat1) * Math.cos(dist12)) /\r\n        (Math.sin(dist12) * Math.cos(lat1)));\r\n\r\n      if (isNaN(brngA)) {\r\n        brngA = 0; // protect against rounding\r\n      }\r\n      var brngB = Math.acos((Math.sin(lat1) - Math.sin(lat2) * Math.cos(dist12)) /\r\n        (Math.sin(dist12) * Math.cos(lat2)));\r\n\r\n      var brng12 = 0,\r\n        brng21 = 0;\r\n      if (Math.sin(lon2 - lon1) > 0) {\r\n        brng12 = brngA;\r\n        brng21 = 2 * Math.PI - brngB;\r\n      } else {\r\n        brng12 = 2 * Math.PI - brngA;\r\n        brng21 = brngB;\r\n      }\r\n\r\n      var alpha1 = (brng13 - brng12 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 2-1-3\r\n      var alpha2 = (brng21 - brng23 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 1-2-3\r\n\r\n      if (Math.sin(alpha1) === 0 && Math.sin(alpha2) === 0) {\r\n        return null; // infinite intersections\r\n      }\r\n      if (Math.sin(alpha1) * Math.sin(alpha2) < 0) {\r\n        return null; // ambiguous intersection\r\n      }\r\n      //alpha1 = Math.abs(alpha1);\r\n      //alpha2 = Math.abs(alpha2);  // ... Ed Williams takes abs of alpha1/alpha2, but seems to break calculation?\r\n      var alpha3 = Math.acos(-Math.cos(alpha1) * Math.cos(alpha2) +\r\n        Math.sin(alpha1) * Math.sin(alpha2) * Math.cos(dist12));\r\n\r\n      var dist13 = Math.atan2(Math.sin(dist12) * Math.sin(alpha1) * Math.sin(alpha2),\r\n        Math.cos(alpha2) + Math.cos(alpha1) * Math.cos(alpha3));\r\n\r\n      var lat3 = Math.asin(Math.sin(lat1) * Math.cos(dist13) +\r\n        Math.cos(lat1) * Math.sin(dist13) * Math.cos(brng13));\r\n      var dLon13 = Math.atan2(Math.sin(brng13) * Math.sin(dist13) * Math.cos(lat1),\r\n        Math.cos(dist13) - Math.sin(lat1) * Math.sin(lat3));\r\n      var lon3 = lon1 + dLon13;\r\n      lon3 = (lon3 + Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..180\r\n\r\n      //return new POINT2(lat3.toDeg(), lon3.toDeg());\r\n      ptResult = this.Point(RadToDeg(lon3), RadToDeg(lat3));\r\n\r\n    } catch (error) {\r\n\r\n    }\r\n    return ptResult;\r\n  },\r\n  /**\r\n   Checks to see if two bounding boxes touch each other.   Includes intesections or containment of one box within\r\n   the other.  Takes into the case if one of the boxes cross the international date line.\r\n   */\r\n  doesBoundingBoxIntersect: function (bbox1, bbox2) {\r\n    var bbox1a;\r\n    var bbox1b;\r\n    var bbox2a;\r\n    var bbox2b;\r\n    // Check edge case where boxes cross the international date line\r\n    // (180th Meridian)\r\n    if (bbox1.left > bbox1.right) {\r\n      // Divide the bounding box into 2 sections, one to the left of the 180th Meridian\r\n      // and one to the right.\r\n      bbox1a = new BoundingBox();\r\n      bbox1a.left = bbox1.left;\r\n      bbox1a.right = 180.0;\r\n      bbox1a.top = bbox1.top;\r\n      bbox1a.bottom = bbox1.bottom;\r\n      bbox1b = new BoundingBox();\r\n      bbox1b.left = -180.0;\r\n      bbox1b.right = bbox1.right;\r\n      bbox1b.top = bbox1.top;\r\n      bbox1b.bottom = bbox1.bottom;\r\n      // Check to see if the second bounding box crosses the 180th Meridian\r\n      if (bbox2.left > bbox2.right) {\r\n        bbox2a = new BoundingBox();\r\n        bbox2a.left = bbox2.left;\r\n        bbox2a.right = 180.0;\r\n        bbox2a.top = bbox2.top;\r\n        bbox2a.bottom = bbox2.bottom;\r\n        bbox2b = new BoundingBox();\r\n        bbox2b.left = -180.0;\r\n        bbox2b.right = bbox2.right;\r\n        bbox2b.top = bbox2.top;\r\n        bbox2b.bottom = bbox2.bottom;\r\n        // The 2nd bounding box does not cross the meridian, so just compare the\r\n        // the split first bouding box.  If any piece intersects with bbox2 it intersects.\r\n        if (this.checkBboxOverlap(bbox1a, bbox2a) === true || this.checkBboxOverlap(bbox2a, bbox1a) === true || this.checkBboxOverlap(bbox1b, bbox2b) === true || this.checkBboxOverlap(bbox2b, bbox1b) === true) {\r\n          return true;\r\n        }\r\n        return false;\r\n      } else {\r\n        // Divide the bounding box into 2 sections, one to the left of the 180th Meridian\r\n        // and one to the right.\r\n        bbox2a = new BoundingBox();\r\n        bbox2a.left = bbox2.left;\r\n        bbox2a.right = 180.0;\r\n        bbox2a.top = bbox2.top;\r\n        bbox2a.bottom = bbox2.bottom;\r\n        bbox2b = new BoundingBox();\r\n        bbox2b.left = -180.0;\r\n        bbox2b.right = bbox2.right;\r\n        bbox2b.top = bbox2.top;\r\n        bbox2b.bottom = bbox2.bottom;\r\n        // The 2nd bounding box does not cross the meridian, so just compare the\r\n        // the split first bouding box.  If any piece intersects with bbox2 it intersects.\r\n        if (this.checkBboxOverlap(bbox1, bbox2a) === true || this.checkBboxOverlap(bbox2a, bbox1) === true || this.checkBboxOverlap(bbox1, bbox2b) === true || this.checkBboxOverlap(bbox2b, bbox1) === true) {\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n    } else if (bbox2.left > bbox2.right) {\r\n      if (this.checkBboxOverlap(bbox1a, bbox2) === true || this.checkBboxOverlap(bbox2, bbox1a) === true || this.checkBboxOverlap(bbox1b, bbox2) === true || this.checkBboxOverlap(bbox2, bbox1b) === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    } else {\r\n      if (this.checkBboxOverlap(bbox1, bbox2) === true || this.checkBboxOverlap(bbox2, bbox1) === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n  },\r\n  pointInBbox: function (bbox, x, y) {\r\n    if (bbox !== null || bbox.left !== undefined || bbox.right !== undefined || bbox.top !== undefined || bbox.bototm !== undefined) {\r\n      if ((x >= bbox.left) && (x <= bbox.right) && (y >= bbox.bottom) && (y <= bbox.top)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n  checkBboxOverlap: function (bbox1, bbox2) {\r\n    if (bbox1 !== null && bbox2 !== null) {\r\n      if (this.pointInBbox(bbox1, bbox2.left, bbox2.top)) {\r\n        return true;\r\n      }\r\n      if (this.pointInBbox(bbox1, bbox2.right, bbox2.top)) {\r\n        return true;\r\n      }\r\n      if (this.pointInBbox(bbox1, bbox2.left, bbox2.bottom)) {\r\n        return true;\r\n      }\r\n      if (this.pointInBbox(bbox1, bbox2.right, bbox2.bottom)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n\r\n  BoundingBox: function (pointString) {\r\n    var left,\r\n      right,\r\n      top,\r\n      bottom,\r\n      len,\r\n      points,\r\n      p1,\r\n      p2,\r\n      point,\r\n      i;\r\n    // if the user passes in a coordinate string, parse\r\n    // the coordinate string and find the min and max values for\r\n    // each to get the bounding box.\r\n    // at sacrifice for accuracy if difference between left and right is\r\n    // greater than 180, make the asssumption they crossed the 180th meridian.\r\n    if (pointString !== null) {\r\n      points = pointString.split(\" \");\r\n      len = points.length;\r\n      for (i = 0; i < len; i++) {\r\n        point = points[i].split(\",\");\r\n        p1 = parseFloat(point[0]);\r\n        p2 = parseFloat(point[1]);\r\n        if (point.length >= 2) {\r\n          if (this.left === null) {\r\n            this.left = p1;\r\n          } else {\r\n            if (p1 < this.left) {\r\n              this.left = p1;\r\n            }\r\n          }\r\n          if (this.right === null) {\r\n            this.right = p1;\r\n          } else {\r\n            if (p1 > this.right) {\r\n              this.right = p1;\r\n            }\r\n          }\r\n          if (this.top === null) {\r\n            this.top = p2;\r\n          } else {\r\n            if (p2 > this.top) {\r\n              this.top = p2;\r\n            }\r\n          }\r\n          if (this.bottom === null) {\r\n            this.bottom = p2;\r\n          } else {\r\n            if (point[1] < this.bottom) {\r\n              this.bottom = p2;\r\n            }\r\n          }\r\n          // if the difference between right and left is greater\r\n          // than 180 there is a good chance that the user intends\r\n          // to cross the 180th meridian.  reverse left and right in\r\n          // that case.  There is no way to prove this.\r\n          if ((this.right - this.left) > 180) {\r\n            var savedvalue = this.left;\r\n            this.left = this.right;\r\n            this.right = savedvalue;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  getBox: function (points) {\r\n    var left,\r\n      right,\r\n      top,\r\n      bottom,\r\n      len,\r\n      p1,\r\n      p2,\r\n      point,\r\n      i;\r\n\r\n    len = points.length;\r\n    for (i = 0; i < len; i++) {\r\n      point = points[i];\r\n      p1 = point.lon;\r\n      p2 = point.lat;\r\n      //if (point.length >= 2) {\r\n      if (left === null) {\r\n        left = p1;\r\n      } else {\r\n        if (p1 < left) {\r\n          left = p1;\r\n        }\r\n      }\r\n      if (right === null) {\r\n        right = p1;\r\n      } else {\r\n        if (p1 > right) {\r\n          right = p1;\r\n        }\r\n      }\r\n      if (top === null) {\r\n        top = p2;\r\n      } else {\r\n        if (p2 > top) {\r\n          top = p2;\r\n        }\r\n      }\r\n      if (bottom === null) {\r\n        bottom = p2;\r\n      } else {\r\n        if (p2 < bottom) {\r\n          bottom = p2;\r\n        }\r\n      }\r\n      // if the difference between right and left is greater\r\n      // than 180 there is a good chance that the user intends\r\n      // to cross the 180th meridian.  reverse left and right in\r\n      // that case.  There is no way to prove\r\n      if ((right - left) > 180) {\r\n        var savedvalue = left;\r\n        left = right;\r\n        right = savedvalue;\r\n      }\r\n      // }\r\n    }\r\n    return [{\r\n      lat: bottom,\r\n      lon: left\r\n    }, {\r\n      lat: top,\r\n      lon: left\r\n    }, {\r\n      lat: top,\r\n      lon: right\r\n    }, {\r\n      lat: bottom,\r\n      lon: right\r\n    }];\r\n  },\r\n\r\n  /**\r\n   * Calculates a 4 coordinate bounding box from any polygon.  This function takes into account if the the polygon crosses\r\n   * the IDL and may return a bounding box where the left value is greater than the right value.\r\n   *\r\n   * @example\r\n   * var points = [{lat:50,lon:45},{lat:50,lon:45},{lat:50,lon:45}];\r\n   * var box = emp3.utils.geoLibrary.getBoxIDL(points);\r\n   * var boxString = \"left: \"+box[0].lon+\",\"+box[0].lat+\r\n   *                 \"bottom: \"+box[1].lon+\",\"+box[1].lat;\r\n   *                 \"right: \"+box[2].lon+\",\"+box[2].lat;\r\n   *                 \"top: \"+box[3].lon+\",\"+box[3].lat;\r\n   *\r\n   * alert( boxString );\r\n   *\r\n   * @private\r\n   * @param {Array} points required - An array of point with latitude and longitude\r\n   * values in degrees decimal format objects\r\n   * @return A new array of 4 objects each with a lat and lon property in the order of left,bottom,right,top\r\n   * @type Array\r\n   */\r\n  getBoxIDL: function (points) {\r\n    var left,\r\n      right,\r\n      top,\r\n      bottom,\r\n      len,\r\n      p1,\r\n      p2,\r\n      point,\r\n      i,\r\n      temp;\r\n\r\n\r\n    len = points.length;\r\n    for (i = 0; i < len; i++) {\r\n      point = points[i];\r\n      p1 = point.lon + 180;\r\n      p2 = point.lat + 90;\r\n      if (left === null) {\r\n        left = p1;\r\n      } else {\r\n        if (p1 < left) {\r\n          left = p1;\r\n        }\r\n      }\r\n      if (right === null) {\r\n        right = p1;\r\n      } else {\r\n        if (p1 > right) {\r\n          right = p1;\r\n        }\r\n      }\r\n      if (top === null) {\r\n        top = p2;\r\n      } else {\r\n        if (p2 > top) {\r\n          top = p2;\r\n        }\r\n      }\r\n      if (bottom === null) {\r\n        bottom = p2;\r\n      } else {\r\n        if (p2 < bottom) {\r\n          bottom = p2;\r\n        }\r\n      }\r\n\r\n    }\r\n    if ((right - left) > 180) {\r\n      temp = left;\r\n      left = right;\r\n      right = temp;\r\n    }\r\n\r\n    if ((top - bottom) > 90) {\r\n      temp = top;\r\n      top = bottom;\r\n      bottom = temp;\r\n    }\r\n    return [{\r\n      lat: bottom - 90,\r\n      lon: left - 180\r\n    }, {\r\n      lat: top - 90,\r\n      lon: left - 180\r\n    }, {\r\n      lat: top - 90,\r\n      lon: right - 180\r\n    }, {\r\n      lat: bottom - 90,\r\n      lon: right - 180\r\n    }];\r\n  },\r\n\r\n  /**\r\n   * Converts a lat long coordinate into a utm coordinate\r\n   *\r\n   * NOTE: Code derived from http://forum.worldwindcentral.com/showthread.php?t=9863\r\n   * @private\r\n   * @param numLat - IN - Latitude of the coordinate we want to convert\r\n   * @param numLong - IN - Longitude of the coordinate we want to convert\r\n   * @return A utm coordinate in this format: \"zone,easting,northing\"\r\n   */\r\n  latLongToUtm: function (numLat, numLong) {\r\n    //try {\r\n    var numUTMEasting = 0;\r\n    var numUTMNorthing = 0;\r\n    var strZone = \"\";\r\n\r\n    var numA = 6378137; //WGS84\r\n    var numEccSquared = 0.00669438; //WGS84\r\n    var numK0 = 0.9996;\r\n\r\n    var numLongOrigin;\r\n    var numEcPrimeSquared;\r\n    var numN;\r\n    var numT;\r\n    var numC;\r\n    var numAA;\r\n    var numM;\r\n\r\n    // Make sure the longitude is between -180.00 .. 179.9\r\n    //changed a cast to int to Math.floor\r\n    var numLongTemp = (numLong + 180) - (Math.floor((numLong + 180) / 360)) * 360 - 180; // -180.00 .. 179.9\r\n\r\n    var numLatRad = numLat * (Math.PI / 180);\r\n    var numLongRad = numLongTemp * (Math.PI / 180);\r\n    var numLongOriginRad;\r\n    var intZoneNumber;\r\n    //changed (int) to Math.floor\r\n    intZoneNumber = (Math.floor((numLongTemp + 180) / 6)) + 1;\r\n\r\n    if (numLat >= 56.0 && numLat < 64.0 && numLongTemp >= 3.0 && numLongTemp < 12.0) {\r\n      intZoneNumber = 32;\r\n    }\r\n\r\n    // Special zones for Svalbard\r\n    if (numLat >= 772.0 && numLat < 84.0) {\r\n      if (numLongTemp >= 0.0 && numLongTemp < 9.0) {\r\n        intZoneNumber = 31;\r\n      } else if (numLongTemp >= 9.0 && numLongTemp < 21.0) {\r\n        intZoneNumber = 33;\r\n      } else if (numLongTemp >= 21.0 && numLongTemp < 33.0) {\r\n        intZoneNumber = 35;\r\n      } else if (numLongTemp >= 33.0 && numLongTemp < 42.0) {\r\n        intZoneNumber = 37;\r\n      }\r\n    }\r\n\r\n    numLongOrigin = (intZoneNumber - 1) * 6 - 180 + 3; //+3 puts origin in middle of zone\r\n    numLongOriginRad = numLongOrigin * (Math.PI / 180);\r\n\r\n    // Compute the UTM Zone from the latitude and longitude\r\n    strZone = intZoneNumber.toString() + this.utmLetterDesignator(numLat);\r\n\r\n    var eccPrimeSquared = (numEccSquared) / (1 - numEccSquared);\r\n\r\n    numN = numA / Math.sqrt(1 - numEccSquared * Math.sin(numLatRad) * Math.sin(numLatRad));\r\n    numT = Math.tan(numLatRad) * Math.tan(numLatRad);\r\n    numC = eccPrimeSquared * Math.cos(numLatRad) * Math.cos(numLatRad);\r\n    numAA = Math.cos(numLatRad) * (numLongRad - numLongOriginRad);\r\n\r\n    numM = numA * (\r\n      (1 - numEccSquared / 4 - 3 * numEccSquared * numEccSquared / 64 - 5 * numEccSquared * numEccSquared * numEccSquared / 256) *\r\n      numLatRad -\r\n      (3 * numEccSquared / 8 + 3 * numEccSquared * numEccSquared / 32 + 45 * numEccSquared * numEccSquared * numEccSquared / 1024) *\r\n      Math.sin(2 * numLatRad) +\r\n      (15 * numEccSquared * numEccSquared / 256 + 45 * numEccSquared * numEccSquared * numEccSquared / 1024) *\r\n      Math.sin(4 * numLatRad) - (35 * numEccSquared * numEccSquared * numEccSquared / 3072) * Math.sin(6 * numLatRad));\r\n\r\n    numUTMEasting = Number((numK0 * numN * (numAA + (1 - numT + numC) * numAA * numAA * numAA / 6 +\r\n    (5 - 18 * numT + numT * numT + 72 * numC - 58 * eccPrimeSquared) * numAA * numAA * numAA * numAA * numAA / 120) + 500000.0));\r\n\r\n    numUTMNorthing = Number(numK0 * (numM + numN * Math.tan(numLatRad) * (numAA * numAA / 2 + (5 - numT + 9 * numC + 4 * numC * numC) *\r\n      numAA * numAA * numAA * numAA / 24 + (61 - 58 * numT + numT * numT + 600 * numC - 330 * eccPrimeSquared) *\r\n      numAA * numAA * numAA * numAA * numAA * numAA / 720)));\r\n\r\n    if (numLat < 0) {\r\n      numUTMNorthing += 10000000.0; //10000000 meter offset for southern hemisphere\r\n    }\r\n\r\n    //var utmValue = strZone + \",\" + numUTMEasting.toString() + \",\" + numUTMNorthing.toString();\r\n    var utmValue = strZone + \",\" + Math.round(numUTMEasting).toString() + \",\" + Math.round(numUTMNorthing).toString();\r\n    return utmValue;\r\n    // } // End try\r\n    // catch (e) {\r\n\r\n    // }\r\n\r\n    //  return \"\";\r\n  },\r\n\r\n  /**\r\n   * @name utmLetterDesignator\r\n   *\r\n   * @desc Gets the utm letter that corresponds with a passed in latitude value\r\n   *\r\n   * NOTE: Code derived from http://forum.worldwindcentral.com/showthread.php?t=9863\r\n   * @private\r\n   * @param numLat - IN - Latitude that need to figure out what utm letter to return\r\n   * @return Utm letter that corresponds with a passed in latitude value\r\n   *\r\n   */\r\n  utmLetterDesignator: function (numLat) {\r\n    var strLetterDesignator = \"Z\";\r\n\r\n    // try {\r\n    if ((84 >= numLat) && (numLat >= 72)) {\r\n      strLetterDesignator = \"X\";\r\n    } else if ((72 > numLat) && (numLat >= 64)) {\r\n      strLetterDesignator = \"W\";\r\n    } else if ((64 > numLat) && (numLat >= 56)) {\r\n      strLetterDesignator = \"V\";\r\n    } else if ((56 > numLat) && (numLat >= 48)) {\r\n      strLetterDesignator = \"U\";\r\n    } else if ((48 > numLat) && (numLat >= 40)) {\r\n      strLetterDesignator = \"T\";\r\n    } else if ((40 > numLat) && (numLat >= 32)) {\r\n      strLetterDesignator = \"S\";\r\n    } else if ((32 > numLat) && (numLat >= 24)) {\r\n      strLetterDesignator = \"R\";\r\n    } else if ((24 > numLat) && (numLat >= 16)) {\r\n      strLetterDesignator = \"Q\";\r\n    } else if ((16 > numLat) && (numLat >= 8)) {\r\n      strLetterDesignator = \"P\";\r\n    } else if ((8 > numLat) && (numLat >= 0)) {\r\n      strLetterDesignator = \"N\";\r\n    } else if ((0 > numLat) && (numLat >= -8)) {\r\n      strLetterDesignator = \"M\";\r\n    } else if ((-8 > numLat) && (numLat >= -16)) {\r\n      strLetterDesignator = \"L\";\r\n    } else if ((-16 > numLat) && (numLat >= -24)) {\r\n      strLetterDesignator = \"K\";\r\n    } else if ((-24 > numLat) && (numLat >= -32)) {\r\n      strLetterDesignator = \"J\";\r\n    } else if ((-32 > numLat) && (numLat >= -40)) {\r\n      strLetterDesignator = \"H\";\r\n    } else if ((-40 > numLat) && (numLat >= -48)) {\r\n      strLetterDesignator = \"G\";\r\n    } else if ((-48 > numLat) && (numLat >= -56)) {\r\n      strLetterDesignator = \"F\";\r\n    } else if ((-56 > numLat) && (numLat >= -64)) {\r\n      strLetterDesignator = \"E\";\r\n    } else if ((-64 > numLat) && (numLat >= -72)) {\r\n      strLetterDesignator = \"D\";\r\n    } else if ((-72 > numLat) && (numLat >= -89)) {\r\n      strLetterDesignator = \"C\";\r\n    } else {\r\n      strLetterDesignator = \"Z\"; // Latitude is outside the UTM limits\r\n    }\r\n    //  } // End try\r\n    // catch (e) {\r\n    //     trace(e.getStackTrace());\r\n    // }\r\n\r\n    return strLetterDesignator;\r\n  },\r\n\r\n  /**\r\n   * @name utmToLatLong\r\n   *\r\n   * @desc Converts a utm coordinate into a lat long coordinate\r\n   *\r\n   * NOTE: code derived from http://stackoverflow.com/questions/343865/how-to-convert-from-utm-to-latlng-in-python-or-javascript\r\n   *\r\n   * @private\r\n   * @param numZone - IN - Utm zone\r\n   * @param numEasting - IN - Easting value of the utm coordinate\r\n   * @param numNorthing - IN - Northing value of the utm coordinate\r\n   * @param blNorthernHemisphere - IN - True if we are in the northern hemisphere, false otherwise\r\n   * @return A lat long coordinate in this format: \"latitude,longitude\"\r\n   */\r\n  utmToLatLong: function (numZone, numEasting, numNorthing, blNorthernHemisphere) {\r\n    //try {\r\n    if (blNorthernHemisphere === undefined || blNorthernHemisphere === null) {\r\n      blNorthernHemisphere = true;\r\n    }\r\n    if (!blNorthernHemisphere) {\r\n      numNorthing = 10000000 - numNorthing;\r\n    }\r\n\r\n    var numA = 6378137;\r\n    var numE = 0.081819191;\r\n    var numE1sq = 0.006739497;\r\n    var numK0 = 0.9996;\r\n\r\n    var numArc = numNorthing / numK0;\r\n    var numMu = numArc / (numA * (1 - Math.pow(numE, 2) / 4.0 - 3 * Math.pow(numE, 4) / 64.0 - 5 * Math.pow(numE, 6) / 256.0));\r\n\r\n    var numEi = (1 - Math.pow((1 - numE * numE), (1 / 2.0))) / (1 + Math.pow((1 - numE * numE), (1 / 2.0)));\r\n\r\n    var numCa = 3 * numEi / 2 - 27 * Math.pow(numEi, 3) / 32;\r\n    var numCb = 21 * Math.pow(numEi, 2) / 16 - 55 * Math.pow(numEi, 4) / 32;\r\n    var numCc = 151 * Math.pow(numEi, 3) / 96;\r\n    var numCd = 1097 * Math.pow(numEi, 4) / 512;\r\n    var numPhi1 = numMu + numCa * Math.sin(2 * numMu) + numCb * Math.sin(4 * numMu) + numCc * Math.sin(6 * numMu) + numCd * Math.sin(8 * numMu);\r\n\r\n    var numN0 = numA / Math.pow((1 - Math.pow((numE * Math.sin(numPhi1)), 2)), (1 / 2.0));\r\n\r\n    var numR0 = numA * (1 - numE * numE) / Math.pow((1 - Math.pow((numE * Math.sin(numPhi1)), 2)), (3 / 2.0));\r\n    var numFact1 = numN0 * Math.tan(numPhi1) / numR0;\r\n\r\n    var num_a1 = 500000 - numEasting;\r\n    var numDd0 = num_a1 / (numN0 * numK0);\r\n    var numFact2 = numDd0 * numDd0 / 2;\r\n\r\n    var numT0 = Math.pow(Math.tan(numPhi1), 2);\r\n    var numQ0 = numE1sq * Math.pow(Math.cos(numPhi1), 2);\r\n    var numFact3 = (5 + 3 * numT0 + 10 * numQ0 - 4 * numQ0 * numQ0 - 9 * numE1sq) * Math.pow(numDd0, 4) / 24;\r\n    var numFact4 = (61 + 90 * numT0 + 298 * numQ0 + 45 * numT0 * numT0 - 252 * numE1sq - 3 * numQ0 * numQ0) * Math.pow(numDd0, 6) / 720;\r\n\r\n    var numLof1 = num_a1 / (numN0 * numK0);\r\n    var numLof2 = (1 + 2 * numT0 + numQ0) * Math.pow(numDd0, 3) / 6.0;\r\n    var numLof3 = (5 - 2 * numQ0 + 28 * numT0 - 3 * Math.pow(numQ0, 2) + 8 * numE1sq + 24 * Math.pow(numT0, 2)) * Math.pow(numDd0, 5) / 120;\r\n    var num_a2 = (numLof1 - numLof2 + numLof3) / Math.cos(numPhi1);\r\n    var num_a3 = num_a2 * 180 / Math.PI;\r\n\r\n    var numLatitude = 180 * (numPhi1 - numFact1 * (numFact2 + numFact3 + numFact4)) / Math.PI;\r\n\r\n    if (!blNorthernHemisphere) {\r\n      numLatitude = -numLatitude;\r\n    }\r\n\r\n    var numLongitude = ((numZone > 0) && (6 * numZone - 183) || 3) - num_a3;\r\n\r\n    return numLatitude.toString() + \",\" + numLongitude.toString();\r\n    // } // End try\r\n    //  catch (e) {\r\n    //trace(e.getStackTrace());\r\n    //  }\r\n\r\n    //  return \"\";\r\n  } // End utmToLatLong\r\n\r\n\r\n};\r\n\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n/*  Latitude/longitude spherical geodesy formulae & scripts (c) Chris Veness 2002-2011            */\r\n/*   - www.movable-type.co.uk/scripts/latlong.html                                                */\r\n/*                                                                                                */\r\n/*  Sample usage:                                                                                 */\r\n/*    var p1 = new LatLon(51.5136, -0.0983);                                                      */\r\n/*    var p2 = new LatLon(51.4778, -0.0015);                                                      */\r\n/*    var dist = p1.distanceTo(p2);          // in km                                             */\r\n/*    var brng = p1.bearingTo(p2);           // in degrees clockwise from north                   */\r\n/*    ... etc                                                                                     */\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n/*  Note that minimal error checking is performed in this example code!                           */\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n\r\n/**\r\n * Creates a point on the earth's surface at the supplied latitude / longitude\r\n *\r\n * @constructor\r\n * @param {Number} lat: latitude in numeric degrees\r\n * @param {Number} lon: longitude in numeric degrees\r\n * @param {Number} [rad=6371]: radius of earth if different value is required from standard 6,371km\r\n *\r\n * @ignore\r\n */\r\n\r\nfunction LatLon(lat, lon, rad) {\r\n  if (typeof (rad) == 'undefined') rad = 6371; // earth's mean radius in km\r\n  // only accept numbers or valid numeric strings\r\n  this._lat = typeof (lat) == 'number' ? lat : typeof (lat) == 'string' && lat.trim() !== '' ? +lat : NaN;\r\n  this._lon = typeof (lon) == 'number' ? lon : typeof (lon) == 'string' && lon.trim() !== '' ? +lon : NaN;\r\n  this._radius = typeof (rad) == 'number' ? rad : typeof (rad) == 'string' && trim(lon) !== '' ? +rad : NaN;\r\n}\r\n\r\n\r\n/**\r\n * Returns the distance from this point to the supplied point, in km\r\n * (using Haversine formula)\r\n *\r\n * from: Haversine formula - R. W. Sinnott, \"Virtues of the Haversine\",\r\n *       Sky and Telescope, vol 68, no 2, 1984\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @param   {Number} [precision=4]: no of significant digits to use for returned value\r\n * @returns {Number} Distance in km between this point and destination point\r\n * @ignore\r\n */\r\nLatLon.prototype.distanceTo = function (point, precision) {\r\n  // default 4 sig figs reflects typical 0.3% accuracy of spherical model\r\n  if (typeof precision == 'undefined') precision = 4;\r\n\r\n  var R = this._radius;\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad();\r\n  var lat2 = point._lat.toRad(),\r\n    lon2 = point._lon.toRad();\r\n  var dLat = lat2 - lat1;\r\n  var dLon = lon2 - lon1;\r\n\r\n  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(lat1) * Math.cos(lat2) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  var d = R * c;\r\n  return d.toPrecisionFixed(precision);\r\n};\r\n\r\n\r\n/**\r\n * Returns the (initial) bearing from this point to the supplied point, in degrees\r\n *   see http://williams.best.vwh.net/avform.htm#Crs\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Initial bearing in degrees from North\r\n */\r\nLatLon.prototype.bearingTo = function (point) {\r\n  var lat1 = this._lat.toRad(),\r\n    lat2 = point._lat.toRad();\r\n  var dLon = (point._lon - this._lon).toRad();\r\n\r\n  var y = Math.sin(dLon) * Math.cos(lat2);\r\n  var x = Math.cos(lat1) * Math.sin(lat2) -\r\n    Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);\r\n  var brng = Math.atan2(y, x);\r\n\r\n  return (brng.toDeg() + 360) % 360;\r\n};\r\n\r\n\r\n/**\r\n * Returns final bearing arriving at supplied destination point from this point; the final bearing\r\n * will differ from the initial bearing by varying degrees according to distance and latitude\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Final bearing in degrees from North\r\n * @ignore\r\n */\r\nLatLon.prototype.finalBearingTo = function (point) {\r\n  // get initial bearing from supplied point back to this point...\r\n  var lat1 = point._lat.toRad(),\r\n    lat2 = this._lat.toRad();\r\n  var dLon = (this._lon - point._lon).toRad();\r\n\r\n  var y = Math.sin(dLon) * Math.cos(lat2);\r\n  var x = Math.cos(lat1) * Math.sin(lat2) -\r\n    Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);\r\n  var brng = Math.atan2(y, x);\r\n\r\n  // ... & reverse it by adding 180\r\n  return (brng.toDeg() + 180) % 360;\r\n};\r\n\r\n\r\n/**\r\n * Returns the midpoint between this point and the supplied point.\r\n *   see http://mathforum.org/library/drmath/view/51822.html for derivation\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {LatLon} Midpoint between this point and the supplied point\r\n * @ignore\r\n */\r\nLatLon.prototype.midpointTo = function (point) {\r\n  var lat1 = this._lat.toRad();\r\n  var lon1 = this._lon.toRad();\r\n  var lat2 = point._lat.toRad();\r\n  var dLon = (point._lon - this._lon).toRad();\r\n\r\n  var Bx = Math.cos(lat2) * Math.cos(dLon);\r\n  var By = Math.cos(lat2) * Math.sin(dLon);\r\n\r\n  var lat3 = Math.atan2(Math.sin(lat1) + Math.sin(lat2),\r\n    Math.sqrt((Math.cos(lat1) + Bx) * (Math.cos(lat1) + Bx) + By * By));\r\n  lon3 = lon1 + Math.atan2(By, Math.cos(lat1) + Bx);\r\n  lon3 = (lon3 + 3 * Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..+180\r\n\r\n  return new LatLon(lat3.toDeg(), lon3.toDeg());\r\n};\r\n\r\n\r\n/**\r\n * Returns the destination point from this point having travelled the given distance (in km) on the\r\n * given initial bearing (bearing may vary before destination is reached)\r\n *\r\n *   see http://williams.best.vwh.net/avform.htm#LL\r\n *\r\n * @param   {Number} brng: Initial bearing in degrees\r\n * @param   {Number} dist: Distance in km\r\n * @returns {LatLon} Destination point\r\n * @ignore\r\n */\r\nLatLon.prototype.destinationPoint = function (brng, dist) {\r\n  dist = typeof (dist) == 'number' ? dist : typeof (dist) == 'string' && dist.trim() !== '' ? +dist : NaN;\r\n  dist = dist / this._radius; // convert dist to angular distance in radians\r\n  brng = brng.toRad(); //\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad();\r\n\r\n  var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) +\r\n    Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));\r\n  var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) * Math.cos(lat1),\r\n      Math.cos(dist) - Math.sin(lat1) * Math.sin(lat2));\r\n  lon2 = (lon2 + 3 * Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..+180\r\n\r\n  return new LatLon(lat2.toDeg(), lon2.toDeg());\r\n};\r\n\r\n\r\n/**\r\n * Returns the point of intersection of two paths defined by point and bearing\r\n *\r\n *   see http://williams.best.vwh.net/avform.htm#Intersection\r\n *\r\n * @param   {LatLon} p1: First point\r\n * @param   {Number} brng1: Initial bearing from first point\r\n * @param   {LatLon} p2: Second point\r\n * @param   {Number} brng2: Initial bearing from second point\r\n * @returns {LatLon} Destination point (null if no unique intersection defined)\r\n * @ignore\r\n */\r\nLatLon.intersection = function (p1, brng1, p2, brng2) {\r\n  brng1 = typeof brng1 == 'number' ? brng1 : typeof brng1 == 'string' && trim(brng1) !== '' ? +brng1 : NaN;\r\n  brng2 = typeof brng2 == 'number' ? brng2 : typeof brng2 == 'string' && trim(brng2) !== '' ? +brng2 : NaN;\r\n  var lat1 = p1._lat.toRad(),\r\n    lon1 = p1._lon.toRad();\r\n  var lat2 = p2._lat.toRad(),\r\n    lon2 = p2._lon.toRad();\r\n  var brng13 = brng1.toRad(),\r\n    brng23 = brng2.toRad();\r\n  var dLat = lat2 - lat1,\r\n    dLon = lon2 - lon1;\r\n\r\n  var dist12,\r\n    dist13,\r\n    lat3,\r\n    lon3,\r\n    brngA,\r\n    brngB,\r\n    brng12,\r\n    brng21,\r\n    alpha1,\r\n    alpha2,\r\n    alpha3,\r\n    dLon13;\r\n\r\n  dist12 = 2 * Math.asin(Math.sqrt(Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2)));\r\n  if (dist12 === 0) return null;\r\n\r\n  // initial/final bearings between points\r\n  brngA = Math.acos((Math.sin(lat2) - Math.sin(lat1) * Math.cos(dist12)) /\r\n    (Math.sin(dist12) * Math.cos(lat1)));\r\n  if (isNaN(brngA)) brngA = 0; // protect against rounding\r\n  brngB = Math.acos((Math.sin(lat1) - Math.sin(lat2) * Math.cos(dist12)) /\r\n    (Math.sin(dist12) * Math.cos(lat2)));\r\n\r\n  if (Math.sin(lon2 - lon1) > 0) {\r\n    brng12 = brngA;\r\n    brng21 = 2 * Math.PI - brngB;\r\n  } else {\r\n    brng12 = 2 * Math.PI - brngA;\r\n    brng21 = brngB;\r\n  }\r\n\r\n  alpha1 = (brng13 - brng12 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 2-1-3\r\n  alpha2 = (brng21 - brng23 + Math.PI) % (2 * Math.PI) - Math.PI; // angle 1-2-3\r\n\r\n  if (Math.sin(alpha1) === 0 && Math.sin(alpha2) === 0) return null; // infinite intersections\r\n  if (Math.sin(alpha1) * Math.sin(alpha2) < 0) return null; // ambiguous intersection\r\n\r\n  //alpha1 = Math.abs(alpha1);\r\n  //alpha2 = Math.abs(alpha2);\r\n  // ... Ed Williams takes abs of alpha1/alpha2, but seems to break calculation?\r\n\r\n  alpha3 = Math.acos(-Math.cos(alpha1) * Math.cos(alpha2) +\r\n    Math.sin(alpha1) * Math.sin(alpha2) * Math.cos(dist12));\r\n  dist13 = Math.atan2(Math.sin(dist12) * Math.sin(alpha1) * Math.sin(alpha2),\r\n    Math.cos(alpha2) + Math.cos(alpha1) * Math.cos(alpha3));\r\n  lat3 = Math.asin(Math.sin(lat1) * Math.cos(dist13) +\r\n    Math.cos(lat1) * Math.sin(dist13) * Math.cos(brng13));\r\n  dLon13 = Math.atan2(Math.sin(brng13) * Math.sin(dist13) * Math.cos(lat1),\r\n    Math.cos(dist13) - Math.sin(lat1) * Math.sin(lat3));\r\n  lon3 = lon1 + dLon13;\r\n  lon3 = (lon3 + 3 * Math.PI) % (2 * Math.PI) - Math.PI; // normalise to -180..+180\r\n\r\n  return new LatLon(lat3.toDeg(), lon3.toDeg());\r\n};\r\n\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n/**\r\n * Returns the distance from this point to the supplied point, in km, travelling along a rhumb line\r\n *\r\n *   see http://williams.best.vwh.net/avform.htm#Rhumb\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Distance in km between this point and destination point\r\n * @ignore\r\n */\r\nLatLon.prototype.rhumbDistanceTo = function (point) {\r\n  var R = this._radius;\r\n  var lat1 = this._lat.toRad(),\r\n    lat2 = point._lat.toRad();\r\n  var dLat = (point._lat - this._lat).toRad();\r\n  var dLon = Math.abs(point._lon - this._lon).toRad();\r\n\r\n  var dPhi = Math.log(Math.tan(lat2 / 2 + Math.PI / 4) / Math.tan(lat1 / 2 + Math.PI / 4));\r\n  var q = (!isNaN(dLat / dPhi)) ? dLat / dPhi : Math.cos(lat1); // E-W line gives dPhi=0\r\n  // if dLon over 180 take shorter rhumb across 180 meridian:\r\n  if (dLon > Math.PI) dLon = 2 * Math.PI - dLon;\r\n  var dist = Math.sqrt(dLat * dLat + q * q * dLon * dLon) * R;\r\n\r\n  return dist.toPrecisionFixed(4); // 4 sig figs reflects typical 0.3% accuracy of spherical model\r\n};\r\n\r\n/**\r\n * Returns the bearing from this point to the supplied point along a rhumb line, in degrees\r\n *\r\n * @param   {LatLon} point: Latitude/longitude of destination point\r\n * @returns {Number} Bearing in degrees from North\r\n */\r\nLatLon.prototype.rhumbBearingTo = function (point) {\r\n  var lat1 = this._lat.toRad(),\r\n    lat2 = point._lat.toRad();\r\n  var dLon = (point._lon - this._lon).toRad();\r\n\r\n  var dPhi = Math.log(Math.tan(lat2 / 2 + Math.PI / 4) / Math.tan(lat1 / 2 + Math.PI / 4));\r\n  if (Math.abs(dLon) > Math.PI) dLon = dLon > 0 ? -(2 * Math.PI - dLon) : (2 * Math.PI + dLon);\r\n  var brng = Math.atan2(dLon, dPhi);\r\n\r\n  return (brng.toDeg() + 360) % 360;\r\n};\r\n\r\n/**\r\n * Returns the destination point from this point having travelled the given distance (in km) on the\r\n * given bearing along a rhumb line\r\n *\r\n * @param   {Number} brng: Bearing in degrees from North\r\n * @param   {Number} dist: Distance in km\r\n * @returns {LatLon} Destination point\r\n * @ignore\r\n */\r\nLatLon.prototype.rhumbDestinationPoint = function (brng, dist) {\r\n  var R = this._radius;\r\n  var d = parseFloat(dist) / R; // d = angular distance covered on earth's surface\r\n  var lat1 = this._lat.toRad(),\r\n    lon1 = this._lon.toRad();\r\n  brng = brng.toRad();\r\n  var lon2;\r\n\r\n  var lat2 = lat1 + d * Math.cos(brng);\r\n  var dLat = lat2 - lat1;\r\n  var dPhi = Math.log(Math.tan(lat2 / 2 + Math.PI / 4) / Math.tan(lat1 / 2 + Math.PI / 4));\r\n  var q = (!isNaN(dLat / dPhi)) ? dLat / dPhi : Math.cos(lat1); // E-W line gives dPhi=0\r\n  var dLon = d * Math.sin(brng) / q;\r\n  // check for some daft bugger going past the pole\r\n  if (Math.abs(lat2) > Math.PI / 2) lat2 = lat2 > 0 ? Math.PI - lat2 : -(Math.PI - lat2);\r\n  lon2 = (lon1 + dLon + 3 * Math.PI) % (2 * Math.PI) - Math.PI;\r\n\r\n  return new LatLon(lat2.toDeg(), lon2.toDeg());\r\n};\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n\r\n/**\r\n * Returns the latitude of this point; signed numeric degrees if no format, otherwise format & dp\r\n * as per Geo.toLat()\r\n *\r\n * @param   {String} [format]: Return value as 'd', 'dm', 'dms'\r\n * @param   {Number} [dp=0|2|4]: No of decimal places to display\r\n * @returns {Number|String} Numeric degrees if no format specified, otherwise deg/min/sec\r\n * @ignore\r\n *\r\n * @requires Geo\r\n */\r\nLatLon.prototype.lat = function (format, dp) {\r\n  if (typeof format == 'undefined') return this._lat;\r\n\r\n  return Geo.toLat(this._lat, format, dp);\r\n};\r\n\r\n/**\r\n * Returns the longitude of this point; signed numeric degrees if no format, otherwise format & dp\r\n * as per Geo.toLon()\r\n *\r\n * @param   {String} [format]: Return value as 'd', 'dm', 'dms'\r\n * @param   {Number} [dp=0|2|4]: No of decimal places to display\r\n * @returns {Number|String} Numeric degrees if no format specified, otherwise deg/min/sec\r\n * @ignore\r\n *\r\n * @requires Geo\r\n */\r\nLatLon.prototype.lon = function (format, dp) {\r\n  if (typeof format == 'undefined') return this._lon;\r\n\r\n  return Geo.toLon(this._lon, format, dp);\r\n};\r\n\r\n/**\r\n * Returns a string representation of this point; format and dp as per lat()/lon()\r\n *\r\n * @param   {String} [format]: Return value as 'd', 'dm', 'dms'\r\n * @param   {Number} [dp=0|2|4]: No of decimal places to display\r\n * @returns {String} Comma-separated latitude/longitude\r\n * @ignore\r\n *\r\n * @requires Geo\r\n */\r\nLatLon.prototype.toString = function (format, dp) {\r\n  if (typeof format == 'undefined') format = 'dms';\r\n\r\n  if (isNaN(this._lat) || isNaN(this._lon)) return '-,-';\r\n\r\n  return Geo.toLat(this._lat, format, dp) + ', ' + Geo.toLon(this._lon, format, dp);\r\n};\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n\r\n// ---- extend Number object with methods for converting degrees/radians\r\n\r\n/** Converts numeric degrees to radians */\r\nif (typeof (Number.prototype.toRad) === \"undefined\") {\r\n  Number.prototype.toRad = function () {\r\n    return this * Math.PI / 180;\r\n  };\r\n}\r\n\r\n/** Converts radians to numeric (signed) degrees */\r\nif (typeof (Number.prototype.toDeg) === \"undefined\") {\r\n  Number.prototype.toDeg = function () {\r\n    return this * 180 / Math.PI;\r\n  };\r\n}\r\n\r\n/**\r\n * Formats the significant digits of a number, using only fixed-point notation (no exponential)\r\n *\r\n * @param   {Number} precision: Number of significant digits to appear in the returned string\r\n * @returns {String} A string representation of number which contains precision significant digits\r\n * @ignore\r\n */\r\nif (typeof (Number.prototype.toPrecisionFixed) === \"undefined\") {\r\n  Number.prototype.toPrecisionFixed = function (precision) {\r\n    if (isNaN(this)) return 'NaN';\r\n    var numb = this < 0 ? -this : this; // can't take log of -ve number...\r\n    var sign = this < 0 ? '-' : '';\r\n    var n;\r\n\r\n    if (numb === 0) { // can't take log of zero, just format with precision zeros\r\n      n = '0.';\r\n      while (precision--) n += '0';\r\n      return n;\r\n    }\r\n\r\n    var scale = Math.ceil(Math.log(numb) * Math.LOG10E); // no of digits before decimal\r\n    n = String(Math.round(numb * Math.pow(10, precision - scale)));\r\n    if (scale > 0) { // add trailing zeros & insert decimal as required\r\n      var l = scale - n.length;\r\n      while (l-- > 0) n = n + '0';\r\n      if (scale < n.length) n = n.slice(0, scale) + '.' + n.slice(scale);\r\n    } else { // prefix decimal and leading zeros if required\r\n      while (scale++ < 0) n = '0' + n;\r\n      n = '0.' + n;\r\n    }\r\n    return sign + n;\r\n  };\r\n}\r\n\r\n/** Trims whitespace from string (q.v. blog.stevenlevithan.com/archives/faster-trim-javascript) */\r\nif (typeof (String.prototype.trim) === \"undefined\") {\r\n  String.prototype.trim = function () {\r\n    return String(this).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n  };\r\n}\r\n\r\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\r\n/* eslint-enable */\r\n","/*globals window, console, mil*/\r\n\r\n/**\r\n * The main process for the CPCE Map Api\r\n * This is where we construct and define all the different pieces of the CPCE Map Api\r\n * @private\r\n */\r\n\r\n/* eslint-disable no-console */\r\n// If no console object is present, create one that does nothing.\r\nif (!console) {\r\n  window.console = {};\r\n}\r\nif (!console.info) {\r\n  console.info = function () {\r\n  };\r\n}\r\nif (!console.error) {\r\n  console.error = function () {\r\n  };\r\n}\r\nif (!console.warn) {\r\n  console.warn = function () {\r\n  };\r\n}\r\n/* eslint-enable no-console */\r\n\r\n/**\r\n * Namespace Root namespace for the Extensible Mapping Platform v3.\r\n * @namespace emp3\r\n */\r\nif (!window.emp3) {\r\n  window.emp3 = {};\r\n}\r\n\r\n/**\r\n * Namespace Contains the classes used to create and manipulate at map.\r\n * @namespace emp3.api\r\n * @memberOf  emp3\r\n */\r\nif (!window.emp3.api) {\r\n  window.emp3.api = {};\r\n}\r\n\r\n/**\r\n * window.emp3.api.enums Contains all enumerations and constants for the EMPv3 API.\r\n * @namespace emp3.api.enums\r\n * @memberOf emp3.api\r\n */\r\nif (!window.emp3.api.enums) {\r\n  emp3.api.enums = {};\r\n}\r\n\r\n/**\r\n * emp3.api.events Contains classes for all the events.\r\n * @namespace emp3.api.events\r\n * @memberOf emp3.api\r\n */\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n\r\n/**\r\n * Used to create pseudo random GUID's for use in the CPCE Api - Used internally and can be used externally\r\n * @return {String}  GUID - 5 block seq of numbers\r\n * @ignore\r\n */\r\nemp3.api.createGUID = function () {\r\n  var S4 = function () {\r\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n  };\r\n  return (S4() + S4() + '-' + S4() + '-' + S4() + '-' + S4() + '-' + S4() + S4() + S4());\r\n};\r\n\r\n/**\r\n *  A simple javascript-based hash map.\r\n *  @ignore\r\n */\r\nemp3.api.Hash = function () {\r\n\r\n  var i;\r\n\r\n  this.length = 0;\r\n  this.items = [];\r\n  for (i = 0; i < arguments.length; i += 2) {\r\n    if (typeof(arguments[i + 1]) !== 'undefined') {\r\n      this.items[arguments[i]] = arguments[i + 1];\r\n      this.length += 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  @name emp3.api.Hash#removeItem\r\n   *  @param {string} in_key String used to ID hash table Items\r\n   *  @memberof emp3.api.Hash\r\n   *  @method removeItem\r\n   *  @returns {object} Object that was destroyed\r\n   * */\r\n  this.removeItem = function (in_key) {\r\n    var tmp_previous;\r\n    if (typeof(this.items[in_key]) !== 'undefined') {\r\n      this.length -= 1;\r\n      tmp_previous = this.items[in_key];\r\n      delete this.items[in_key];\r\n    }\r\n\r\n    return tmp_previous;\r\n  };\r\n  /**\r\n   *  @name emp3.api.Hash#getItem\r\n   *  @param {string} in_key String used to ID hash table Items\r\n   *  @memberof emp3.api.Hash\r\n   *  @method getItem\r\n   *  @example exampleHash.getItem(keyGUID);\r\n   *  @returns {object} Object that is stored in the Hash Table for the specified GUID\r\n   * */\r\n  this.getItem = function (in_key) {\r\n    return this.items[in_key];\r\n  };\r\n  /** @private\r\n   *  @name emp3.api.Hash#setItem\r\n   *  @param {string} in_key String used to ID hash table Items\r\n   *  @param {object} in_value (Can be any type) value to set in the hash table\r\n   *  @memberof emp3.api.Hash\r\n   *  @method setItem\r\n   *  @return {object} Returns passed value\r\n   * */\r\n  this.setItem = function (in_key, in_value) {\r\n    var tmp_previous;\r\n    if (typeof(in_value) !== 'undefined') {\r\n      if (typeof(this.items[in_key]) === 'undefined') {\r\n        this.length += 1;\r\n      } else {\r\n        tmp_previous = this.items[in_key];\r\n      }\r\n\r\n      this.items[in_key] = in_value;\r\n    }\r\n\r\n    return tmp_previous;\r\n  };\r\n\r\n  /** @private\r\n   *  @name emp3.api.Hash#hasItem\r\n   *  @param {string} in_key String used to ID hash table Items\r\n   *  @memberof emp3.api.Hash\r\n   *  @method hasItem\r\n   *  @returns {boolean} Returns true if object exists\r\n   * */\r\n  this.hasItem = function (in_key) {\r\n    return typeof(this.items[in_key]) !== 'undefined';\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   *  @name emp3.api.Hash#clear\r\n   *\r\n   *  @memberof emp3.api.Hash\r\n   *  @method clear\r\n   *  @returns {void}\r\n   * */\r\n  this.clear = function () {\r\n    var i;\r\n\r\n    for (i in this.items) {\r\n      if (this.items.hasOwnProperty(i)) {\r\n        delete this.items[i];\r\n      }\r\n    }\r\n\r\n    this.length = 0;\r\n  };\r\n  /**\r\n   * @private\r\n   *  @name emp3.api.Hash#toArray\r\n   *\r\n   *  @memberof emp3.api.Hash\r\n   *  @method toArray\r\n   *  @returns {Array} Returns array of hashtable\r\n   * */\r\n  this.toArray = function () {\r\n    var array = [],\r\n      i;\r\n    for (i in this.items) {\r\n      if (this.items.hasOwnProperty(i)) {\r\n        array.push(this.items[i]);\r\n      }\r\n    }\r\n\r\n    return array;\r\n  };\r\n};\r\n\r\n/**\r\n *\r\n *  Converts a measurement from one unit to kilometers.\r\n *  Source values may be meters, kilometers, miles, nautical miles,\r\n *  yards, or feet.  Set the units parameter to 'm', 'km', 'mi', 'nm', 'yd',\r\n *  or 'ft' respectively.\r\n *\r\n * @param {int} measurement Length of measurement to be converted\r\n * @param {string} units Units for the measurement to be converted to.\r\n * @returns {int} Returns the converted measurement\r\n * @ignore\r\n */\r\nemp3.api.convertToKilometers = function (measurement, units) {\r\n  var returnValue;\r\n\r\n  switch (units) {\r\n    case 'km':\r\n      returnValue = measurement;\r\n      break;\r\n    case 'mi':\r\n      returnValue = measurement / 0.62137;\r\n      break;\r\n    case 'nmi':\r\n      returnValue = measurement / 0.53996;\r\n      break;\r\n    case 'yd':\r\n      returnValue = measurement / 1093.6;\r\n      break;\r\n    case 'ft':\r\n      returnValue = measurement / 3280.8;\r\n      break;\r\n    case 'm':\r\n      returnValue = measurement / 1000;\r\n      break;\r\n    default:\r\n      throw new Error('Unsupported unit type: use either \"m\", \"km\", \"nmi\", \"mi\", \"yd\" or \"ft\"');\r\n  }\r\n  return returnValue;\r\n};\r\n\r\n/**\r\n * Takes a geojson object and converts it into a kml coordinate string.  Does not support\r\n * the multipoint, multilinestring, multipolygon or geometryCollection geojson types. This function\r\n * will only return the outer ring of a polygon, and not interior polygons. An\r\n * error will return an empty string.\r\n * @private\r\n * @param  {object} geojson Any geojson object.\r\n * @return {string} A space delimited string of coordinates of the format x0,y0[,z0] [xn,yn[,zn]]\r\n * @ignore\r\n */\r\nfunction convertGeoJsonToCoordinateString(geojson) { // eslint-disable-line no-unused-vars\r\n  var coordString = '',\r\n    i;\r\n\r\n  if (geojson && geojson.type && geojson.coordinates) {\r\n    switch (geojson.type.toLowerCase()) {\r\n      case 'point':\r\n        if (geojson.coordinates.length >= 2) {\r\n          coordString = geojson.coordinates[0] + ',' + geojson.coordinates[1];\r\n\r\n          if (geojson.coordinates.length >= 3) {\r\n            coordString += geojson.coordinates[2];\r\n          }\r\n        }\r\n        break;\r\n      case 'linestring':\r\n\r\n        for (i = 0; i < geojson.coordinates.length; i += 1) {\r\n          if (geojson.coordinates[i].length >= 2) {\r\n            coordString += geojson.coordinates[i][0] + ',' + geojson.coordinates[i][1];\r\n\r\n            if (geojson.coordinates[i].length >= 3) {\r\n              coordString += geojson.coordinates[i][2];\r\n            }\r\n\r\n            coordString += ' ';\r\n          }\r\n        }\r\n        break;\r\n      case 'polygon':\r\n        if (geojson.coordinates.length >= 1) {\r\n\r\n          for (i = 0; i < geojson.coordinates[0].length; i += 1) {\r\n            if (geojson.coordinates[0][i].length >= 2) {\r\n              coordString += geojson.coordinates[0][i][0] + ',' + geojson.coordinates[0][i][1];\r\n\r\n              if (geojson.coordinates[i].length >= 3) {\r\n                coordString += geojson.coordinates[0][i][2];\r\n              }\r\n\r\n              coordString += ' ';\r\n            }\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  return coordString;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param coordinates\r\n * @returns {{type: *, coordinates: Array}|*}\r\n * @ignore\r\n */\r\nfunction convertCoordinateStringToGeoJson(coordinates) { // eslint-disable-line no-unused-vars\r\n                                                         // convert the coordinates into geojson and use the data field.\r\n                                                         // like a feature.\r\n\r\n  var coordinateArray,\r\n    geoJsonCoordinateArray,\r\n    geojsontype,\r\n    splitcoordinates,\r\n    point,\r\n    k,\r\n    j,\r\n    geojsonObject;\r\n\r\n  // trim beginning and trailing spaces of the coordinates.\r\n  coordinates = coordinates.replace(/^\\s|\\s$/g, '');\r\n\r\n  coordinateArray = coordinates.split(' ');\r\n  geoJsonCoordinateArray = [];\r\n\r\n  if (coordinateArray.length > 1) {\r\n    geojsontype = 'LineString';\r\n    for (k = 0; k < coordinateArray.length; k += 1) {\r\n      if (coordinateArray[k] !== '') {\r\n        splitcoordinates = coordinateArray[k].split(',');\r\n        point = [];\r\n        for (j = 0; j < splitcoordinates.length; j += 1) {\r\n          point.push(splitcoordinates[j]);\r\n        }\r\n        geoJsonCoordinateArray.push(point);\r\n      }\r\n    }\r\n  } else {\r\n    geojsontype = 'Point';\r\n    splitcoordinates = coordinateArray[0].split(',');\r\n    for (k = 0; k < splitcoordinates.length; k += 1) {\r\n      geoJsonCoordinateArray.push(splitcoordinates[k]);\r\n    }\r\n  }\r\n\r\n  geojsonObject = {\r\n    type: geojsontype,\r\n    coordinates: geoJsonCoordinateArray\r\n  };\r\n\r\n  return geojsonObject;\r\n}\r\n\r\n/**\r\n * Converts an array of location objects such as the ones\r\n * returned by cmw-a draw/edit callbacks into a KML location\r\n * string.\r\n *\r\n * @param  {Array} locations an array of location objects of the format {lat, lon, alt}\r\n * @return {string} a string of space separated coordinates in the format \"x0,y0,z0 x1,y1,z1,...xn,yn,zn\"\r\n * @ignore\r\n */\r\n\r\nfunction convertLocationArrayToString(locations) { // eslint-disable-line no-unused-vars\r\n  var coordString = '',\r\n    i,\r\n    len = locations.length;\r\n\r\n  //loop through the array and start converting each coordinate to a string\r\n  for (i = 0; i < len; i += 1) {\r\n    // make sure this coordinate has a lat and a lon.  Without that it is\r\n    // invalid, and skip to the next one.\r\n    if (locations[i].lat && locations[i].lon) {\r\n      coordString += locations[i].lon + ',' + locations[i].lat;\r\n\r\n      // if it has an altitude, add that onto the string\r\n      if (locations[i].alt) {\r\n        coordString += ',' + locations[i].alt;\r\n      }\r\n\r\n      if (i < locations.length - 1) {\r\n        // add the separator.\r\n        coordString += ' ';\r\n      }\r\n    }\r\n  }\r\n\r\n  // return the final coordinate string.\r\n  return coordString;\r\n}\r\n\r\n/**\r\n *\r\n * @param obj\r\n * @returns {boolean}\r\n * @ignore\r\n */\r\nemp3.api.isArray = function (obj) {\r\n  return Object.prototype.toString.call(obj) === \"[object Array]\";\r\n};\r\n\r\n/**\r\n * @param obj\r\n * @returns {boolean}\r\n * @ignore\r\n */\r\nemp3.api.isString = function (obj) {\r\n  return Object.prototype.toString.call(obj) === \"[object String]\";\r\n};\r\n\r\n/**\r\n * @param obj\r\n * @returns {boolean}\r\n * @ignore\r\n */\r\nemp3.api.isOverlay = function (obj) {\r\n  var result = false;\r\n\r\n  if (obj) {\r\n    if (obj.type === 'overlay') {\r\n      result = true;\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n *\r\n * @param obj\r\n * @returns {boolean}\r\n * @ignore\r\n */\r\nemp3.api.isFeature = function (obj) {\r\n  var result = false;\r\n\r\n  if (obj.featureType) {\r\n    if (obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_POINT ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_PATH ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_POLYGON ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_ACM ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_SQUARE ||\r\n      obj.featureType === emp3.api.enums.FeatureTypeEnum.GEO_TEXT) {\r\n      result = true;\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * Returns the approximate memory usage, in bytes, of the specified object.\r\n * @private\r\n *\r\n * @param {Object} object the object whose size should be determined\r\n * @return {Number} A close approximation of the size of the object.\r\n * @ignore\r\n */\r\nfunction sizeof(object) { // eslint-disable-line no-unused-vars\r\n\r\n  // initialise the list of objects and size\r\n  var objects = [object];\r\n  var size = 0,\r\n    key,\r\n    index,\r\n    len = objects.length;\r\n\r\n  // loop over the objects\r\n  for (index = 0; index < len; index++) {\r\n\r\n    // determine the type of the object\r\n    switch (typeof objects[index]) {\r\n\r\n      // the object is a boolean\r\n      case 'boolean':\r\n        size += 4;\r\n        break;\r\n\r\n      // the object is a number\r\n      case 'number':\r\n        size += 8;\r\n        break;\r\n\r\n      // the object is a string\r\n      case 'string':\r\n        size += 2 * objects[index].length;\r\n        break;\r\n\r\n      // the object is a generic object\r\n      case 'object':\r\n\r\n        // if the object is not an array, add the sizes of the keys\r\n        if (Object.prototype.toString.call(objects[index]) != '[object Array]') {\r\n          for (key in objects[index]) size += 2 * key.length;\r\n        }\r\n\r\n        // loop over the keys\r\n        for (key in objects[index]) {\r\n\r\n          // determine whether the value has already been processed\r\n          var processed = false;\r\n          for (var search = 0; search < objects.length; search++) {\r\n            if (objects[search] === objects[index][key]) {\r\n              processed = true;\r\n              break;\r\n            }\r\n          }\r\n\r\n          // queue the value to be processed if appropriate\r\n          if (!processed) objects.push(objects[index][key]);\r\n\r\n        }\r\n    }\r\n  }\r\n\r\n  // return the calculated size\r\n  return size;\r\n}\r\n\r\n/**\r\n * Retrieves an old properties object from a v3 Feature to work\r\n * with CMAPI 1.3.\r\n *\r\n * @param {emp3.api.Feature} feature The feature we are obtaining the properties\r\n * from.\r\n * @return {Properties} A legacy properties object from v2/early v3.\r\n * @ignore\r\n */\r\nemp3.api.getProperties = function (feature) {\r\n\r\n  var properties = {};\r\n\r\n  // Handle generic properties\r\n  properties.featureType = feature.featureType;\r\n  properties.readOnly = feature.readOnly;\r\n  properties.azimuth = feature.azimuth;\r\n  properties.buffer = feature.buffer;\r\n  properties.timeStamp = feature.timeStamp;\r\n  properties.extrude = feature.extrude;\r\n  properties.tessellate = feature.tessellate;\r\n  properties.altitudeMode = emp3.api.convertAltitudeMode(feature.altitudeMode);\r\n\r\n  if (feature.labelStyle) {\r\n    properties.labelStyle = feature.labelStyle;\r\n    if (typeof feature.labelStyle.color === \"object\") {\r\n      properties.labelColor = emp.util.convertColorToHexColor(feature.labelStyle.color);\r\n    } else {\r\n      properties.labelColor = feature.labelStyle.color;\r\n    }\r\n    if (typeof feature.labelStyle.outlineColor === \"object\") {\r\n      properties.outlineColor = emp.util.convertColorToHexColor(feature.labelStyle.outlineColor);\r\n    } else {\r\n      properties.outlineColor = feature.labelStyle.outlineColor;\r\n    }\r\n    properties.labelScale = feature.labelStyle.labelScale;\r\n    properties.labelStyle.family = feature.labelStyle.fontFamily; // Handles legacy family property\r\n  }\r\n\r\n  if (feature.fillStyle) {\r\n    properties.fillStyle = feature.fillStyle;\r\n    if (typeof feature.fillStyle.fillColor === \"object\") {\r\n      properties.fillColor = emp.util.convertColorToHexColor(feature.fillStyle.fillColor);\r\n    } else {\r\n      properties.fillColor = feature.fillStyle.fillColor;\r\n    }\r\n    properties.fillPattern = feature.fillStyle.fillPattern;\r\n  }\r\n\r\n  if (feature.strokeStyle) {\r\n    properties.strokeStyle = feature.strokeStyle;\r\n    properties.lineWidth = feature.strokeStyle.strokeWidth;\r\n    if (typeof feature.strokeStyle.strokeColor === \"object\") {\r\n      properties.lineColor = emp.util.convertColorToHexColor(feature.strokeStyle.strokeColor);\r\n    } else {\r\n      properties.lineColor = feature.strokeStyle.strokeColor;\r\n    }\r\n    properties.strokeDashstyle = feature.strokeStyle.strokePattern;\r\n  }\r\n\r\n  // Handle type specific properties\r\n  switch (feature.featureType) {\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n      properties.attributes = feature.attributes;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n      properties.radius = feature.radius;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n      properties.semiMinor = feature.semiMinor;\r\n      properties.semiMajor = feature.semiMajor;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n      properties.modifiers = feature.modifiers || {};\r\n      properties.modifiers.standard = feature.symbolStandard;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n      // No extra properties\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n      properties.stippleFactor = feature.stippleFactor;\r\n      properties.stipplePattern = feature.stipplePattern;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n      properties.iconUrl = feature.iconURI;\r\n      properties.iconYOffset = feature.offsetY;\r\n      properties.iconXOffset = feature.offsetX;\r\n      properties.iconSize = feature.iconSize;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n      properties.width = feature.width;\r\n      properties.height = feature.height;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n      properties.width = feature.width;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n    default:\r\n      // Nothing extra required\r\n  }\r\n\r\n  return properties;\r\n};\r\n\r\n/**\r\n * @param newAltitudeMode\r\n * @returns {cmapi.enums.altitudeMode}\r\n * @ignore\r\n */\r\nemp3.api.convertAltitudeMode = function (newAltitudeMode) {\r\n  var val;\r\n\r\n  switch (newAltitudeMode) {\r\n    case cmapi.enums.altitudeMode.CLAMP_TO_GROUND:\r\n      val = \"clampToGround\";\r\n      break;\r\n    case cmapi.enums.altitudeMode.RELATIVE_TO_GROUND:\r\n      val = \"relativeToGround\";\r\n      break;\r\n    case cmapi.enums.altitudeMode.ABSOLUTE:\r\n      val = \"absolute\";\r\n      break;\r\n    default:\r\n      val = undefined;\r\n  }\r\n\r\n  return val;\r\n};\r\n\r\n/**\r\n * Sets the properties onto the feature.\r\n * @ignore\r\n */\r\nemp3.api.convertCMAPIPropertiesToFeature = function (feature, properties) {\r\n\r\n  // Handle generic properties\r\n  feature.fillColor = properties.fillColor;\r\n  feature.strokeColor = properties.lineColor;\r\n  feature.strokeWidth = properties.lineWidth;\r\n  feature.altitudeMode = emp3.api.convertAltitudeMode(properties.altitudeMode);\r\n  feature.strokePattern = properties.strokeDashstyle;\r\n  feature.readOnly = properties.readOnly;\r\n  feature.labelColor = properties.labelColor;\r\n  feature.labelScale = properties.labelScale;\r\n  feature.azimuth = properties.azimuth;\r\n  feature.buffer = properties.buffer;\r\n  feature.timeStamp = properties.timeStamp;\r\n  feature.extrude = properties.extrude;\r\n  feature.tessellate = properties.tessellate;\r\n\r\n  // Handle type specific properties\r\n  switch (properties.featureType) {\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n      feature.attributes = properties.attributes;\r\n      feature.labelStyle = properties.labelStyle;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n      feature.radius = properties.radius;\r\n      feature.strokeWidth = properties.lineThickness; // TODO is the proper value lineWidth or lineThickness\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n      feature.semiMajor = properties.semiMajor;\r\n      feature.semiMinor = properties.semiMinor;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n      feature.modifiers = properties.modifiers || {};\r\n      feature.modifiers.standard = feature.symbolStandard;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n      feature.labelStyle = properties.labelStyle;\r\n      feature.iconURI = properties.iconUrl;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n      feature.stippleFactor = properties.stippleFactor;\r\n      feature.stipplePattern = properties.stipplePattern;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n      feature.width = properties.width;\r\n      feature.height = properties.height;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n      feature.width = properties.width;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n      break;\r\n  }\r\n};\r\n\r\n/**\r\n * Convert a location array used to pass coordinates from drawing\r\n * to a CMAPI GeoPositionGroup.\r\n * @param {Array} locations\r\n *\r\n * @ignore\r\n */\r\nemp3.api.convertLocationArrayToCMAPI = function (locations) {\r\n  var newLocations = [],\r\n    i, k,\r\n    len = locations.length;\r\n\r\n  for (i = 0, k = len; i < k; i += 1) {\r\n    newLocations.push({\r\n      latitude: locations[i].lat,\r\n      longitude: locations[i].lon,\r\n      altitude: locations[i].alt\r\n    });\r\n  }\r\n\r\n  return newLocations;\r\n};\r\n\r\n/**\r\n * Converts a IGeoPositionGroup to a GeoJSON coordinates array.  This does\r\n * not return a geoJSON object but the coordinates that will go in the\r\n * coordinates field of a GeoJSON object.\r\n *\r\n * @param {emp3.api.GeoPosition[]} positions\r\n * @param {String} type - The GeoJSON type that we are targeting.\r\n *\r\n * @return {Array} An array as specified by the GeoJSON specification for\r\n * the coordinates field.  The array format returned depends on the type passed\r\n * in\r\n * @ignore\r\n */\r\nemp3.api.convertCMAPIPositionsToGeoJson = function (positions, type) {\r\n  var coords = [],\r\n    j, len;\r\n\r\n  type = type || \"LineString\";\r\n\r\n  if (type === \"Point\") {\r\n    // Point is a\r\n    coords.push(positions[0].longitude);\r\n    coords.push(positions[0].latitude);\r\n    if (positions[0].altitude) {\r\n      coords.push(positions[0].altitude);\r\n    }\r\n  } else if (type === \"LineString\") {\r\n    len = positions.length;\r\n    for (j = 0; j < len; j++) {\r\n      if (positions[j].altitude) {\r\n        coords.push([positions[j].longitude, positions[j].latitude, positions[j].altitude]);\r\n      } else {\r\n        coords.push([positions[j].longitude, positions[j].latitude]);\r\n      }\r\n    }\r\n  } else if (type === \"Polygon\") {\r\n    //Polygons are 3 dimensional arrays.  Make sure to add the 3rd dimension.\r\n    coords.push([]);\r\n    len = positions.length;\r\n    for (j = 0; j < len; j++) {\r\n      if (positions[j].altitude) {\r\n        coords[0].push([positions[j].longitude, positions[j].latitude, positions[j].altitude]);\r\n      } else {\r\n        coords[0].push([positions[j].longitude, positions[j].latitude]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return coords;\r\n};\r\n\r\n/**\r\n * Converts a geojson object into GeoPositionGroup.\r\n * @ignore\r\n * @return {cmapi.IGeoPositionGroup} a GeoPositionGroup that can be used as\r\n * positions for any feature object.\r\n */\r\nemp3.api.convertGeoJsonToCMAPIPositions = function (geojson) {\r\n  var positions = [],\r\n    position,\r\n    i;\r\n\r\n  // only handling point, linestring and polygon for now.  All data should\r\n  // be these 3.\r\n  if (geojson.type) {\r\n    if (geojson.type === \"Point\") {\r\n      position = {\r\n        longitude: geojson.coordinates[0],\r\n        latitude: geojson.coordinates[1]\r\n      };\r\n      positions.push(position);\r\n    } else if (geojson.type === \"LineString\") {\r\n      for (i = 0; i < geojson.coordinates.length; i += 1) {\r\n        position = {\r\n          longitude: geojson.coordinates[i][0],\r\n          latitude: geojson.coordinates[i][1]\r\n        };\r\n        positions.push(position);\r\n      }\r\n    } else if (geojson.type === \"Polygon\") {\r\n      // Our polygon cannot handle holes, ignore first dimension\r\n      // of coordinates.\r\n      for (i = 0; i < geojson.coordinates[0].length; i += 1) {\r\n        position = {\r\n          longitude: geojson.coordinates[0][i][0],\r\n          latitude: geojson.coordinates[0][i][1]\r\n        };\r\n        positions.push(position);\r\n      }\r\n    }\r\n  }\r\n\r\n  return positions;\r\n};\r\n\r\n/**\r\n * Converts a Feature into GeoJSON so that it can be processed by the\r\n * CMAPI 1.3 handlers.\r\n *\r\n * @param {emp3.api.Feature} feature\r\n *\r\n * @return {Object} A GeoJSON object that is usable to pass to the\r\n * CMAPI 1.3 handler.\r\n *\r\n * @ignore\r\n */\r\nemp3.api.convertFeatureToGeoJSON = function (feature) {\r\n\r\n  var convertedFeature = {};\r\n\r\n  // First determine the type of GeoJSON this symbolCode\r\n  // will be.  This is determined by the Feature type.\r\n  // Once we do this we can figure out how the coordinates should\r\n  // be translated.\r\n  switch (feature.featureType) {\r\n    case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n      return feature.GeoJSONData;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n      convertedFeature.type = \"Point\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n      convertedFeature.type = \"Point\";\r\n      //convertedFeature.symbolCode = \"PBS_CIRCLE-----\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n      convertedFeature.type = \"Point\";\r\n      //convertedFeature.symbolCode = \"PBS_ELLIPSE----\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n      convertedFeature.type = \"Point\";\r\n      //convertedFeature.symbolCode = \"PBS_RECTANGLE--\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n      convertedFeature.type = \"Point\";\r\n      //convertedFeature.symbolCode = \"PBS_SQUARE-----\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n      convertedFeature.type = \"LineString\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n      convertedFeature.type = \"Polygon\";\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n      if (armyc2.c2sd.renderer.utilities.SymbolUtilities.isMultiPoint(feature.symbolCode, 0)) {\r\n        convertedFeature.type = \"LineString\";\r\n      } else {\r\n        convertedFeature.type = \"Point\";\r\n      }\r\n      convertedFeature.symbolCode = feature.symbolCode;\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n      if (feature.acmType === cmapi.enums.acmType.CYLINDER ||\r\n        feature.acmType === cmapi.enums.acmType.RADARC) {\r\n        convertedFeature.type = \"Point\";\r\n      } else {\r\n        convertedFeature.type = \"LineString\";\r\n      }\r\n      convertedFeature.symbolCode = feature.acmType;\r\n      break;\r\n    default:\r\n      convertedFeature.type = \"Point\";\r\n      break;\r\n  }\r\n\r\n  // We have the type, we can get the coordinate string now.\r\n  convertedFeature.coordinates = emp3.api.convertCMAPIPositionsToGeoJson(feature.positions, convertedFeature.type);\r\n\r\n  return convertedFeature;\r\n};\r\n\r\n/**\r\n * Converts a Feature into KML so that it can be processed by the\r\n * CMAPI 1.3 handlers.\r\n *\r\n * @param {emp3.api.Feature} feature\r\n *\r\n * @return {Object} A KML string that is usable to pass to the\r\n * CMAPI 1.3 handler.\r\n *\r\n * @ignore\r\n */\r\nemp3.api.convertFeatureToKML = function (feature) {\r\n  return feature.KMLString;\r\n};\r\n\r\n/**\r\n * Converts the map status types from CMAPI to emp3 api enumeration values.\r\n * @returns {emp3.api.enums.MapStateEnum}\r\n * @ignore\r\n */\r\nemp3.api.convertStatusType = function (status) {\r\n  var result;\r\n\r\n  switch (status) {\r\n    case \"init\":\r\n      result = emp3.api.enums.MapStateEnum.INIT_IN_PROGRESS;\r\n      break;\r\n    case \"ready\":\r\n      result = emp3.api.enums.MapStateEnum.MAP_READY;\r\n      break;\r\n    case \"teardown\":\r\n      result = emp3.api.enums.MapStateEnum.SHUTDOWN;\r\n      break;\r\n    case \"mapswapinprogress\":\r\n      result = emp3.api.enums.MapStateEnum.MAP_SWAP_IN_PROGRESS;\r\n      break;\r\n    case \"shutdowninprogress\":\r\n      result = emp3.api.enums.MapStateEnum.SHUTDOWN_IN_PROGRESS;\r\n      break;\r\n    default:\r\n      result = status;\r\n      break;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * From base information from a CMAPI 1.3 message, produce a CMAPI 2.0 feature.\r\n * @param {object} args\r\n * @param {emp3.api.enums.FeatureTypeEnum} args.type\r\n * @param {string} args.name\r\n * @param {string} args.geoId\r\n * @param {object} args.coordinates\r\n * @param {string} [args.symbolCode]\r\n * @param {object} args.properties\r\n *\r\n * @ignore\r\n */\r\nemp3.api.buildFeature = function (args) {\r\n  var feature,\r\n    standardArgs = {\r\n      name: args.name,\r\n      geoId: args.geoId,\r\n      positions: args.coordinates\r\n    };\r\n\r\n  switch (args.type) {\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n      feature = new emp3.api.Point(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n      feature = new emp3.api.Path(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n      feature = new emp3.api.Polygon(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n      feature = new emp3.api.Square(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n      feature = new emp3.api.Rectangle(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n      feature = new emp3.api.Circle(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n      feature = new emp3.api.Ellipse(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n      standardArgs.symbolCode = args.symbolCode;\r\n      feature = new emp3.api.MilStdSymbol(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n      feature = new emp3.api.Text(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n      feature = new emp3.api.AirControlMeasure(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.KML:\r\n      delete standardArgs.positions;\r\n      standardArgs.KMLString = args.KMLString;\r\n      feature = new emp3.api.KML(standardArgs);\r\n      break;\r\n    case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n      delete standardArgs.positions;\r\n      standardArgs.GeoJSONData = JSON.stringify(args.GeoJSONData);\r\n      feature = new emp3.api.GeoJSON(standardArgs);\r\n      break;\r\n    default:\r\n    // TODO warn on unhandled/invalid type\r\n  }\r\n\r\n  emp3.api.convertCMAPIPropertiesToFeature(feature, args.properties);\r\n\r\n  return feature;\r\n};\r\n\r\n/**\r\n * From base information from a CMAPI 1.3 message, produce a CMAPI 2.0 overlay.\r\n * @returns {emp3.api.Overlay}\r\n * @ignore\r\n */\r\nemp3.api.buildOverlay = function (args) {\r\n  var overlay;\r\n\r\n  overlay = new emp3.api.Overlay({\r\n    name: args.name,\r\n    geoId: args.geoId,\r\n    dataProviderId: args.dataProviderId,\r\n    description: args.description,\r\n    properties: args.properties,\r\n    children: args.children,\r\n    readOnly: args.readOnly\r\n  });\r\n\r\n  return overlay;\r\n};\r\n","/**\r\n * @classdesc Sends the Features over the map.feature.plot channel..\r\n * @extends emp3.api.Message\r\n *\r\n * @see emp3.api.ResponseBroker.plotFeatureTransactionComplete\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Feature[]} message.features\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeaturePlotMessage(message, callInfo, transactionId) {\r\n  message = message || {};\r\n  var payload, multiPayload = [], i, length,\r\n    convertedFeature, feature,\r\n    featureCount;\r\n\r\n  if (message.features) {\r\n    featureCount = message.features.length;\r\n  } else if (message.feature) {\r\n    featureCount = 1;\r\n    message.features = [message.feature];\r\n  }\r\n\r\n  // This message dynamically determines its channel based on the given features\r\n  if (featureCount > 1) {\r\n    emp3.api.Message.call(this, emp3.api.enums.channel.plotFeatureBatch, transactionId);\r\n  } else {\r\n    emp3.api.Message.call(this, emp3.api.enums.channel.plotFeature, transactionId);\r\n  }\r\n\r\n  // create the channel payload for each of the features.\r\n  for (i = 0; i < featureCount; i++ ) {\r\n    feature = message.features[i];\r\n    switch (feature.featureType) {\r\n      case emp3.api.enums.FeatureTypeEnum.KML:\r\n        convertedFeature = emp3.api.convertFeatureToKML(feature);\r\n        break;\r\n      default:\r\n        convertedFeature = emp3.api.convertFeatureToGeoJSON(feature);\r\n        break;\r\n    }\r\n\r\n    payload = {\r\n      overlayId: message.overlayId,\r\n      featureId: feature.geoId,\r\n      visible: message.visible,\r\n      parentId: message.parentId,\r\n      format: feature.featureType,\r\n      feature: convertedFeature,\r\n      name: feature.name,\r\n      readOnly: feature.readOnly,\r\n      properties:emp3.api.getProperties(feature)\r\n    };\r\n    payload.properties.modifiers = payload.properties.modifiers || {};\r\n    payload.properties.modifiers.standard = feature.symbolStandard;\r\n    multiPayload.push(payload);\r\n  }\r\n\r\n  // If the length of the payload is greater than 500, then\r\n  // break up the messages into smaller payloads as to prevent messages\r\n  // that are too large and break the Ozone framework.\r\n  length = multiPayload.length;\r\n  if (length > 1) {\r\n    this.payload = {\r\n      messageId: transactionId,\r\n      features: multiPayload\r\n    };\r\n  } else {\r\n    this.payload = multiPayload[0];\r\n    this.payload.messageId = transactionId;\r\n  }\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeaturePlotMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.plotFeature,\r\n  emp3.api.enums.channel.plotFeatureBatch\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapFeaturePlotMessage);\r\n","/**\r\n * @classdesc Sends the Features over the map.feature.plot.url channel.\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.MapService} message.mapService\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeaturePlotUrlMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.plotUrl, transactionId);\r\n\r\n  var payload;\r\n  payload = {\r\n    format: message.mapService.format,\r\n    featureId: message.mapService.geoId,\r\n    overlayId: emp.constant.parentIds.MAP_LAYER_PARENT,\r\n    name: message.mapService.name,\r\n    description: message.mapService.description,\r\n    messageId: transactionId,\r\n    url: message.mapService.url,\r\n    useProxy: message.mapService.useProxy\r\n  };\r\n\r\n  // Based on the format, the service may have different\r\n  // params.\r\n  switch (message.mapService.format) {\r\n      case 'wms':\r\n        payload.params = {\r\n          layers: message.mapService.layers,\r\n          format: message.mapService.tileFormat,\r\n          version: message.mapService.version\r\n        };\r\n        break;\r\n      case 'wmts':\r\n        payload.params = {\r\n          layer: message.mapService.layer,\r\n          format: message.mapService.tileFormat,\r\n          version: message.mapService.version,\r\n          style: message.mapService.style,\r\n          sampleDimensions: message.mapService.sampleDimensions\r\n        };\r\n        break;\r\n      case 'kmlLayer':\r\n        payload.kmlString = message.mapService.kmlString;\r\n        break;\r\n  }\r\n\r\n  this.payload = payload;\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeaturePlotUrlMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.plotUrl\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapFeaturePlotUrlMessage);\r\n","/**\r\n * @classdesc Sends the Features over the map.feature.plot channel..\r\n * @extends emp3.api.Message\r\n *\r\n * @see emp3.api.ResponseBroker.plotFeatureTransactionComplete\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Feature[]} message.features\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeatureUnplotMessage(message, callInfo, transactionId) {\r\n\r\n  var i,\r\n    featureCount = 0,\r\n    payload,\r\n    features = [];\r\n\r\n  message = message || {};\r\n\r\n  if (message.features) {\r\n    featureCount = message.features.length;\r\n  }\r\n\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.unplotFeatureBatch, transactionId);\r\n\r\n  for (i = 0; i < featureCount; i += 1) {\r\n    payload = {\r\n      featureId: message.features[i].geoId\r\n    };\r\n\r\n    if (message.overlayId) {\r\n      payload.overlayId = message.overlayId;\r\n    }\r\n\r\n    if (message.overlayId !== undefined) {\r\n      payload.overlayId = message.overlayId;\r\n    }\r\n    else if (message.parentId) {\r\n      payload.parentId = message.parentId;\r\n    }\r\n\r\n    features.push(payload);\r\n  }\r\n\r\n  this.payload = {\r\n    features: features,\r\n    messageId: transactionId\r\n  };\r\n\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeatureUnplotMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.unplotFeatureBatch,\r\n  emp3.api.enums.channel.unplotFeature\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapFeatureUnplotMessage);\r\n","/**\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {object} callInfo\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeatureDrawMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.draw, transactionId);\r\n\r\n  message = message || {};\r\n  if (!message.feature) {\r\n    throw new Error('Missing argument: feature');\r\n  }\r\n\r\n  this.feature = message.feature;\r\n\r\n  var properties = emp3.api.getProperties(this.feature);\r\n  var coordinates = emp3.api.convertCMAPIPositionsToGeoJson(this.feature.positions, this.feature.featureType);\r\n\r\n  this.payload = {\r\n    featureId: this.feature.geoId,\r\n    name: this.feature.name,\r\n    type: this.feature.featureType,\r\n    symbolCode: this.feature.symbolCode,\r\n    properties: properties,\r\n    coordinates: coordinates,\r\n    messageId: transactionId\r\n  };\r\n\r\n  this.mapId = callInfo.mapId;\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeatureDrawMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nMapFeatureDrawMessage.prototype.transaction = function () {\r\n  return new emp3.api.Transaction({\r\n    id: this.transactionId,\r\n    geoId: this.feature.geoId,\r\n    mapId: this.mapId\r\n  });\r\n};\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(emp3.api.enums.channel.draw, MapFeatureDrawMessage);\r\n","/**\r\n * @classdesc Sends the Features over the map.feature.update channel..\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Feature[]} message.features\r\n * @param {string} message.oldOverlayId\r\n * @param {string} message.newOverlayId\r\n * @param {string} message.oldParentId\r\n * @param {string} message.newParentId\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeatureUpdateMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.updateFeature, transactionId);\r\n\r\n  switch (callInfo.method) {\r\n    case \"Feature.move\":\r\n      this.payload = {\r\n        featureId: message.features[0].geoId,\r\n        overlayId: message.oldOverlayId,\r\n        newOverlayId: message.newOverlayId,\r\n        parentId: message.oldParentId,\r\n        newParentId: message.newParentId,\r\n        messageId: transactionId\r\n      };\r\n      break;\r\n    default:\r\n      this.payload = {\r\n        features: Array.isArray(message.features) ? message.features : [],\r\n        messageId: transactionId\r\n      };\r\n  }\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeatureUpdateMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.updateFeature\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapFeatureUpdateMessage);\r\n","/**\r\n * Function packages the payload to be sent over the map.feature.selected.batch cmapi channel.\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Feature | emp3.api.Feature[]} message.features\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeatureSelected(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.featureSelectedBatch, transactionId);\r\n\r\n  var features = [];\r\n\r\n  if (Array.isArray(message.features)) {\r\n    emp.util.each(message.features, function(feature) {\r\n      features.push({\r\n        featureId: feature.geoId\r\n      });\r\n    });\r\n  } else if (message.features instanceof emp3.api.Feature) {\r\n    features = [message.features.geoId];\r\n  }\r\n\r\n  this.payload = {\r\n    features: features,\r\n    messageId: transactionId\r\n  };\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeatureSelected.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.featureSelectedBatch,\r\n  emp3.api.enums.channel.featureSelected\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapFeatureSelected);\r\n","/**\r\n * Function packages the payload to be sent over the map.feature.deselected.batch cmapi channel.\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Feature[]} [message.features]\r\n * @param {string} [message.mapId]\r\n * @param {CallInfo} callInfo\r\n * @param {string} transactionId\r\n */\r\nfunction MapFeatureDeselected(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.featureDeselectedBatch, transactionId);\r\n\r\n  var toDeselect,\r\n    features = [];\r\n\r\n  if (callInfo.method === \"Map.clearSelected\") {\r\n    toDeselect = emp3.api.MessageHandler.getInstance().getSelected(message.mapId);\r\n  } else {\r\n    toDeselect = message.features;\r\n  }\r\n\r\n  emp.util.each(toDeselect, function(feature) {\r\n    features.push({featureId: feature.geoId});\r\n  });\r\n\r\n  this.payload = {\r\n    features: features,\r\n    messageId: transactionId\r\n  };\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapFeatureDeselected.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.featureDeselectedBatch,\r\n  emp3.api.enums.channel.featureDeselected\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapFeatureDeselected);\r\n","/**\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Overlay[]} message.overlays\r\n * @param {string} message.parentId\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapOverlayCreateMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.createOverlay, transactionId);\r\n\r\n  this.payload = [];\r\n\r\n  emp.util.each(message.overlays, function(overlay) {\r\n    this.payload.push({\r\n      name: overlay.name,\r\n      overlayId: overlay.geoId,\r\n      parentId: message.parentId,\r\n      messageId: transactionId\r\n    });\r\n  }.bind(this));\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapOverlayCreateMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.createOverlay\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapOverlayCreateMessage);\r\n","/**\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Overlay} message.overlay\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapOverlayUpdateMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.updateOverlay, transactionId);\r\n\r\n  this.payload = {\r\n    overlayId: message.overlay.geoId,\r\n    name: message.overlay.name,\r\n    properties: message.overlay.properties,\r\n    messageId: transactionId\r\n  };\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapOverlayUpdateMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.updateOverlay\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapOverlayUpdateMessage);\r\n","/**\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {emp3.api.Overlay[]} message.overlays\r\n * @param {string} message.parentId\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapOverlayRemoveMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.removeOverlay, transactionId);\r\n\r\n  this.payload = [];\r\n  emp.util.each(message.overlays, function(overlay) {\r\n    this.payload.push({\r\n      overlayId: overlay.geoId,\r\n      parentId: message.parentId,\r\n      messageId: transactionId\r\n    });\r\n  }.bind(this));\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapOverlayRemoveMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.removeOverlay\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapOverlayRemoveMessage);\r\n","/**\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {string[]} message.overlays overlay Ids\r\n * @param {string} [message.parent]\r\n * @param {boolean} [message.recurse]\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapOverlayShowMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.showOverlay, transactionId);\r\n\r\n  this.payload = [];\r\n  emp.util.each(message.overlays, function(overlay) {\r\n    this.payload.push({\r\n      overlayId: overlay, //TODO investigate if overlay or overlayId is required\r\n      parentId: message.parent || emp.constant.parentIds.ALL_PARENTS,\r\n      recurse: message.recurse || false,\r\n      messageId: transactionId\r\n    });\r\n  }.bind(this));\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapOverlayShowMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.showOverlay\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapOverlayShowMessage);\r\n","/**\r\n * @extends emp3.api.Message\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {string[]} message.overlays overlay Ids\r\n * @param {string} [message.parent]\r\n * @param {boolean} [message.recurse]\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction MapOverlayHideMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.hideOverlay, transactionId);\r\n\r\n  this.payload = [];\r\n  emp.util.each(message.overlays, function(overlay) {\r\n    this.payload.push({\r\n      overlayId: overlay,\r\n      parentId: message.parent || emp.constant.parentIds.ALL_PARENTS,\r\n      recurse: message.recurse || false,\r\n      messageId: transactionId\r\n    });\r\n  }.bind(this));\r\n}\r\n\r\n// Extend emp3.api.Message\r\nMapOverlayHideMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.hideOverlay\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, MapOverlayHideMessage);\r\n","/**\r\n * @classdesc Sets map configuration settings over the cmapi2.map.config.\r\n * @extends emp3.api.Message\r\n *\r\n * @memberof emp3.api.messages\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {object} callInfo\r\n * @param {string} transactionId\r\n */\r\nfunction ConfigMessage(message, callInfo, transactionId) {\r\n  message = message || {};\r\n\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.config, transactionId);\r\n\r\n  var payload = {};\r\n\r\n\r\n  switch (callInfo.method) {\r\n    case \"Map.setMidDistanceThreshold\":\r\n      payload.midDistanceThreshold = message.midDistanceThreshold;\r\n      break;\r\n    case \"Map.setFarDistanceThreshold\":\r\n      payload.farDistanceThreshold = message.farDistanceThreshold;\r\n      break;\r\n    case \"Map.setIconSize\":\r\n      payload.iconSize = message.iconSize;\r\n      break;\r\n    case \"Map.setMilStdLabels\":\r\n      payload.milStdLabels = message.milStdLabels;\r\n      break;\r\n    case \"Map.setSelectionStyle\":\r\n      payload.selectionScale = message.scale;\r\n      payload.selectionColor = message.color;\r\n      break;\r\n    case \"Map.setFreehandStyle\":\r\n      payload.freehandStrokeStyle = message.freehandStrokeStyle;\r\n      break;\r\n    case \"Map.setBackgroundBrightness\":\r\n      payload.brightness = message.brightness;\r\n      break;\r\n  }\r\n\r\n  payload.messageId = transactionId;\r\n\r\n  this.payload = payload;\r\n}\r\n\r\n// Extend emp3.api.Message\r\nConfigMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.config\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, ConfigMessage);\r\n","/**\r\n * @classdesc Starts freehand drawing over the cmapi2.map.freehandDraw.start channel.\r\n * @extends emp3.api.Message\r\n *\r\n * @memberof emp3.api.messages\r\n *\r\n * @ignore\r\n * @class\r\n * @param {object} message\r\n * @param {IGeoStrokeStyle} message.strokeStyle\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction FreehandStartMessage(message, callInfo, transactionId) {\r\n  message = message || {};\r\n\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.freehandDrawStart, transactionId);\r\n\r\n  // this is a very simple message.  It just indicates to map to start\r\n  // drawing.  Only parameter is stroke style.\r\n  this.payload = {\r\n    messageId: transactionId,\r\n    strokeStyle: message.strokeStyle\r\n  };\r\n}\r\n\r\n// Extend emp3.api.Message\r\nFreehandStartMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.freehandDrawStart\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, FreehandStartMessage);\r\n","/**\r\n * @ignore\r\n * @classdesc Stops freehand draw over the cmapi2.map.freehandDraw.stop channel.\r\n * @extends emp3.api.Message\r\n *\r\n * @class\r\n * @param {object} message Unused for this message.\r\n * @param {object} callInfo Unused for this message\r\n * @param {string} transactionId\r\n */\r\nfunction FreehandStopMessage(message, callInfo, transactionId) {\r\n  emp3.api.Message.call(this, emp3.api.enums.channel.freehandDrawExit, transactionId);\r\n\r\n  // this is a very simple message.  It just indicates to map to start\r\n  // drawing.  Only parameter is stroke style.\r\n  this.payload = {\r\n    messageId: transactionId\r\n  };\r\n}\r\n\r\n// Extend emp3.api.Message\r\nFreehandStopMessage.prototype = Object.create(emp3.api.Message.prototype);\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.freehandDrawExit\r\n];\r\n\r\n// Register with the MessageFactory\r\nemp3.api.MessageFactory.registerMessage(channels, FreehandStopMessage);\r\n","/**\r\n * @ignore\r\n * @class emp3.api.ResponseBroker.plotFeatureTransactionComplete\r\n */\r\nfunction PlotFeatureTransactionCompleteBroker() {}\r\n// Extend emp3.api.ResponseBroker\r\nPlotFeatureTransactionCompleteBroker.prototype = Object.create(emp3.api.ResponseBroker.prototype);\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nPlotFeatureTransactionCompleteBroker.prototype.process = function(callbacks, details, failures) {\r\n  var features = [],\r\n    createdFeatures = details.features,\r\n    i,\r\n    hashId,\r\n    quickHash = [];\r\n\r\n  // send only the successful items back from the transaction.\r\n  for (i = 0; i < createdFeatures.length; i += 1) {\r\n\r\n    // In order for us to return an entire feature in the onSuccess callback,\r\n    // we need to keep track of which features actually passed.  We'll keep\r\n    // a quick hash for easy lookup.  That hash will be deleted on function complete.\r\n    // Then we loop through our data in the messageCallbackHash.  If it isn't found\r\n    // in our 'quickHash' we do not return it in the onSuccess.\r\n    quickHash[createdFeatures[i].featureId] = createdFeatures[i];\r\n  }\r\n\r\n  // call onSuccessCallback.  We need to decide which of the features were successful in returning.\r\n  // Check the 'quickHash' for each feature.\r\n  for (i = 0; i < callbacks.data.features.length; i += 1) {\r\n    hashId = callbacks.data.features[i].geoId;\r\n\r\n    if (quickHash[hashId]) {\r\n      // If we want to sent what the map sent us replace the following lines.\r\n      //features.push(quickHash[hashId]);\r\n      features.push(callbacks.data.features[i]);\r\n    }\r\n  }\r\n\r\n  if (typeof callbacks.onSuccess === 'function') {\r\n\r\n    // Feature.update uses same channel as Overlay.addFeatures, but has\r\n    // different onSuccess callback signature.\r\n    if (callbacks.callInfo.method === 'Feature.update' ||\r\n      callbacks.callInfo.method === 'Feature.setGeometry' ||\r\n      callbacks.callInfo.method === 'Feature.setProperties' ||\r\n      callbacks.callInfo.method === 'Feature.updateProperties') {\r\n\r\n      try {\r\n        callbacks.onSuccess({\r\n          feature: features[0],\r\n          failures: failures\r\n        });\r\n      } catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    } else {\r\n      try {\r\n        callbacks.onSuccess({\r\n          features: features,\r\n          failures: failures\r\n        });\r\n      } catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.plotFeature,\r\n  emp3.api.enums.channel.plotFeatureBatch\r\n];\r\n\r\n// Register with the broker factory\r\nemp3.api.ResponseBrokerFactory.registerBroker(channels, new PlotFeatureTransactionCompleteBroker());\r\n","/**\r\n * Handles the map.get channel messages. The results are returned from core storage.\r\n * This method handles the following methods\r\n *\r\n * - Feature.getChildren\r\n * - Overlay.getFeatures \r\n * - Overlay.getOverlays \r\n * - Overlay.getFeatureById \r\n * - Overlay.getChildren \r\n * - Map.getFeatures \r\n * - Map.getFeatureById \r\n * - Map.getChildren \r\n * - Map.getOverlays \r\n * - Map.getOverlayById \r\n * - Map.getMapServices\r\n * - Map.getChildren\r\n *\r\n * @ignore\r\n */\r\nfunction HandleMapGetBroker() {}\r\n\r\n// Extend emp3.api.ResponseBroker\r\nHandleMapGetBroker.prototype = Object.create(emp3.api.ResponseBroker.prototype);\r\n\r\n/**\r\n * Runs the onSuccess callbacks\r\n * @ignore\r\n * @param args\r\n * @param callbacks\r\n */\r\nfunction processSuccessCallbacks(args, callbacks) {\r\n  try {\r\n    callbacks.onSuccess(args);\r\n  } catch (e) {\r\n    console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n  }\r\n}\r\n\r\n/**\r\n * Runs the onError callbacks\r\n * @ignore\r\n * @param args\r\n * @param callbacks\r\n */\r\nfunction processErrorCallbacks(args, callbacks) {\r\n  try {\r\n    callbacks.onError(args);\r\n  } catch (e) {\r\n    console.error(\"onError function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n  }\r\n}\r\n\r\n/**\r\n * Converts the overlay hierarchy from a transaction complete to a\r\n * flat list.\r\n *\r\n * @ignore\r\n * @param  {Array} transactionOverlaySuccess\r\n * @param {emp3.api.Map} map\r\n * @returns {emp3.api.Overlay[]}\r\n */\r\nfunction getOverlaysFromTransactionComplete(transactionOverlaySuccess, map) {\r\n  var overlay,\r\n    overlays = [],\r\n    childOverlays,\r\n    i,\r\n    len = transactionOverlaySuccess.length;\r\n\r\n  for (i = 0; i < len; i += 1) {\r\n    overlay = new emp3.api.Overlay({\r\n      geoId: transactionOverlaySuccess[i].overlayId,\r\n      name: transactionOverlaySuccess[i].name,\r\n      properties: transactionOverlaySuccess[i].properties\r\n    });\r\n\r\n    overlay.visible = transactionOverlaySuccess[i].visible;\r\n    overlay.parentId = transactionOverlaySuccess[i].parentId;\r\n\r\n    overlays.push(overlay);\r\n\r\n    // If the overlay has been added to a map, assign it now.\r\n    // If the source is a map, it will not have the type field, then just use source.\r\n    // If the source is an overlay, it will have a type field, then use the source.map property.\r\n    // This is a hack but prevents having to pass in additional information just so we can set this property.\r\n    overlay.map = map;\r\n\r\n    if (transactionOverlaySuccess[i].children) {\r\n      childOverlays = getOverlaysFromTransactionComplete(transactionOverlaySuccess[i].children, map);\r\n    }\r\n    if (childOverlays !== undefined && childOverlays !== null) {\r\n      overlays = overlays.concat(childOverlays);\r\n      // once the child overlays have been concatenated, clear them out.\r\n      childOverlays = null;\r\n    }\r\n  }\r\n  return overlays;\r\n}\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nHandleMapGetBroker.prototype.process = function (callbacks, details) {\r\n  var methodCalled,\r\n    feature,\r\n    service,\r\n    map,\r\n    features = [],\r\n    services = [],\r\n    overlays = [],\r\n    cbArgs = {},\r\n    successes = details.successes,\r\n    i,\r\n    positions;\r\n\r\n  if (callbacks.callInfo) {\r\n    methodCalled = callbacks.callInfo.method;\r\n\r\n    if (successes.feature) {\r\n      // Check the to see if layers was part of the query, if not\r\n      // we need to filter them out.\r\n\r\n      for (i = 0; i < successes.feature.length; i += 1) {\r\n        // if its a layer, it will have a url parameter.  But first,\r\n        // check to make sure we are interested in layer by checking out\r\n        // the useLayers flag.  If it is, we want to create a layer and return\r\n        // it.\r\n        if (successes.feature[i].url) {\r\n\r\n          // Based on the format decide what type of layer to return.\r\n          // There will be many more service types, coming.  left it as\r\n          // a switch statement to accommodate future.\r\n          switch (successes.feature[i].type) {\r\n            case \"wms\":\r\n              service = new emp3.api.WMS({\r\n                name: successes.feature[i].name,\r\n                geoId: successes.feature[i].id,\r\n                description: successes.feature[i].description,\r\n                url: successes.feature[i].url,\r\n                version: successes.feature[i].params.version,\r\n                layers: successes.feature[i].params.layers,\r\n                tileFormat: successes.feature[i].params.format\r\n              });\r\n\r\n              break;\r\n            case \"wmts\":\r\n              service = new emp3.api.WMTS({\r\n                name: successes.feature[i].name,\r\n                geoId: successes.feature[i].id,\r\n                description: successes.feature[i].description,\r\n                url: successes.feature[i].url,\r\n                version: successes.feature[i].params.version,\r\n                layer: successes.feature[i].params.layer,\r\n                tileFormat: successes.feature[i].params.format,\r\n                style: successes.feature[i].params.style,\r\n                sampleDimensions: successes.feature[i].params.sampleDimensions\r\n              });\r\n              break;\r\n            case \"kmlLayer\":\r\n              service = new emp3.api.WMTS({\r\n                name: successes.feature[i].name,\r\n                geoId: successes.feature[i].id,\r\n                description: successes.feature[i].description,\r\n                url: successes.feature[i].url,\r\n                kmlString: successes.feature[i].kmlData\r\n              });\r\n              break;\r\n          }\r\n          services.push(service);\r\n        } else {\r\n\r\n          // grab the geojson from these coordinates and\r\n          // convert them to GeoPositionGroup for features.\r\n          positions = emp3.api.convertGeoJsonToCMAPIPositions(successes.feature[i].data);\r\n\r\n          // based on the featureType, decide which feature to create.\r\n          // This should be refactored to use emp3.api.buildFeature() utility\r\n          // function.\r\n          if (successes.feature[i].properties) {\r\n            switch (successes.feature[i].properties.featureType) {\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n                feature = new emp3.api.AirControlMeasure({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  acmType: successes.feature[i].data.symbolCode,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n                feature = new emp3.api.Circle({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n                feature = new emp3.api.Ellipse({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n                feature = new emp3.api.MilStdSymbol({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  symbolCode: successes.feature[i].data.symbolCode,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n                feature = new emp3.api.Path({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n                feature = new emp3.api.Point({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n                feature = new emp3.api.Polygon({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n                feature = new emp3.api.Rectangle({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n                feature = new emp3.api.Square({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n                feature = new emp3.api.Text({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  positions: positions\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.KML:\r\n                feature = new emp3.api.KML({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  KMLString: successes.feature[i].data\r\n                });\r\n                break;\r\n              case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n                feature = new emp3.api.GeoJSON({\r\n                  geoId: successes.feature[i].featureId,\r\n                  name: successes.feature[i].name,\r\n                  GeoJSONData: JSON.stringify(successes.feature[i].data)\r\n                });\r\n                break;\r\n            }\r\n\r\n            emp3.api.convertCMAPIPropertiesToFeature(feature, successes.feature[i].properties);\r\n          }\r\n\r\n          features.push(feature);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (successes.overlay) {\r\n      map = (callbacks.source.type) ? callbacks.source.map : callbacks.source;\r\n      overlays = getOverlaysFromTransactionComplete(successes.overlay, map);\r\n    }\r\n\r\n    // The rest of the variables sent back differ from function to\r\n    // function.  Figure out which function was called so we can\r\n    // send back the correct variables.  After we do that\r\n    // we can call the callback function.\r\n    switch (methodCalled) {\r\n      case \"Map.getFeatures\":\r\n      case \"Feature.getChildren\":\r\n      case \"Feature.getParentFeatures\":\r\n      case \"Overlay.getFeatures\":\r\n        cbArgs.features = features;\r\n        // The call succeeded, call the onSuccess function associated with this.\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      case \"global.findOverlay\":\r\n        cbArgs.overlay = overlays[0];\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      case \"global.findContainer\":\r\n        if (features.length > 0) {\r\n          cbArgs.container = features[0];\r\n        } else if (overlays.length > 0) {\r\n          cbArgs.container = overlays[0];\r\n        } else {\r\n          cbArgs.container = undefined;\r\n        }\r\n\r\n        if (features.length + overlays.length > 1) {\r\n          console.error(\"findContainer yielded multiple results with the same ID\");\r\n        }\r\n\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      case \"Feature.getParentOverlays\":\r\n      case \"Overlay.getParents\":\r\n      case \"Overlay.getOverlays\":\r\n      case \"Map.getChildren\":\r\n      case \"Map.getOverlays\":\r\n        cbArgs.overlays = overlays;\r\n\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      case \"Feature.getParents\":\r\n      case \"Overlay.getChildren\":\r\n        cbArgs.overlays = overlays;\r\n        cbArgs.features = features;\r\n\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      case \"global.findFeature\":\r\n        cbArgs.feature = features[0];\r\n        // The call succeeded, call the onSuccess function associated with this.\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      case \"Map.getFeatureById\":\r\n      case \"Overlay.getFeatureById\":\r\n        if (features.length > 0) {\r\n          cbArgs.feature = features[0];\r\n          // The call succeeded, call the onSuccess function associated with this.\r\n          processSuccessCallbacks(cbArgs, callbacks);\r\n        } else {\r\n          cbArgs.errorMessage = \"Could not find a feature with the provided id.\";\r\n          processErrorCallbacks(cbArgs, callbacks);\r\n        }\r\n        break;\r\n      case \"Map.getOverlayById\":\r\n        if (overlays.length > 0) {\r\n          cbArgs.overlay = overlays[0];\r\n          // The call succeeded, call the onSuccess function associated with this.\r\n          processSuccessCallbacks(cbArgs, callbacks);\r\n        } else {\r\n          cbArgs.errorMessage = \"Could not find a overlay with the provided id.\";\r\n          processErrorCallbacks(cbArgs, callbacks);\r\n        }\r\n        break;\r\n      case \"Map.getMapServices\":\r\n        cbArgs.services = services;\r\n        processSuccessCallbacks(cbArgs, callbacks);\r\n        break;\r\n      default:\r\n        console.error(\"Originating method \" + methodCalled + \" was not handled \\nstack: handleMapGet\");\r\n    }\r\n  }\r\n};\r\n\r\n//======================================================================================================================\r\n\r\n// Register with the broker factory\r\nemp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.get, new HandleMapGetBroker());\r\n","function OverlayTransactionCompleteBroker() {\r\n}\r\n// extend emp3.api.ResponseBroker\r\nOverlayTransactionCompleteBroker.prototype = Object.create(emp3.api.ResponseBroker.prototype);\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nOverlayTransactionCompleteBroker.prototype.process = function (callbacks, details, failures) {\r\n  try {\r\n    callbacks.onSuccess({\r\n      failures: failures\r\n    });\r\n  } catch (err) {\r\n    console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + err.name + \"\\n  message:\" + err.message + \"\\n  stack:\" + err.stack);\r\n  }\r\n};\r\n\r\n//======================================================================================================================\r\nvar channels = [\r\n  emp3.api.enums.channel.showOverlay,\r\n  emp3.api.enums.channel.hideOverlay,\r\n  emp3.api.enums.channel.clearFeatures,\r\n  emp3.api.enums.channel.centerOnOverlay,\r\n  emp3.api.enums.channel.updateOverlay,\r\n  emp3.api.enums.channel.overlayClusterSet,\r\n  emp3.api.enums.channel.overlayClusterActivate,\r\n  emp3.api.enums.channel.overlayClusterDeactivate,\r\n  emp3.api.enums.channel.overlayClusterRemove\r\n];\r\n\r\n// Register with the broker factory\r\nemp3.api.ResponseBrokerFactory.registerBroker(channels, new OverlayTransactionCompleteBroker());\r\n","function CreateOverlayTransactionCompleteBroker() { }\r\nCreateOverlayTransactionCompleteBroker.prototype = Object.create(emp3.api.ResponseBroker.prototype);\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nCreateOverlayTransactionCompleteBroker.prototype.process = function (callbacks, details, failures) {\r\n  try {\r\n    callbacks.onSuccess({\r\n      overlays: callbacks.data.overlays,\r\n      failures: failures\r\n    });\r\n  } catch (e) {\r\n    console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n  }\r\n};\r\n//======================================================================================================================\r\nemp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.createOverlay, new CreateOverlayTransactionCompleteBroker());\r\n","function RemoveOverlayTransactionCompleteBroker() { }\r\nRemoveOverlayTransactionCompleteBroker.prototype = Object.create(emp3.api.ResponseBroker.prototype);\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nRemoveOverlayTransactionCompleteBroker.prototype.process = function (callbacks, details, failures) {\r\n  try {\r\n    callbacks.onSuccess({\r\n      overlays: callbacks.data.overlays,\r\n      failures: failures\r\n    });\r\n  } catch (e) {\r\n    console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n  }\r\n};\r\n//======================================================================================================================\r\nemp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.removeOverlay, new RemoveOverlayTransactionCompleteBroker());\r\n","function HandleFeaturePlotUrlBroker() { }\r\nHandleFeaturePlotUrlBroker.prototype = Object.create(emp3.api.ResponseBroker.prototype);\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nHandleFeaturePlotUrlBroker.prototype.process = function (callbacks, details, failures) {\r\n  var mapService = callbacks.data.mapService;\r\n\r\n  try {\r\n    callbacks.onSuccess({\r\n      mapService: mapService,\r\n      failures: failures\r\n    });\r\n  } catch (e) {\r\n    console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n  }\r\n};\r\n//======================================================================================================================\r\nemp3.api.ResponseBrokerFactory.registerBroker(emp3.api.enums.channel.plotUrl, new HandleFeaturePlotUrlBroker());\r\n","/**\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the \"public domain\" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n**/\r\n\r\n(function (global) {\r\nvar ValidatorContext = function (parent, collectMultiple) {\r\n\tthis.missing = [];\r\n\tthis.schemas = parent ? Object.create(parent.schemas) : {};\r\n\tthis.collectMultiple = collectMultiple;\r\n\tthis.errors = [];\r\n\tthis.handleError = collectMultiple ? this.collectError : this.returnError;\r\n};\r\nValidatorContext.prototype.returnError = function (error) {\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.collectError = function (error) {\r\n\tif (error) {\r\n\t\tthis.errors.push(error);\r\n\t}\r\n\treturn null;\r\n}\r\nValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\r\n\tfor (var i = startIndex; i < this.errors.length; i++) {\r\n\t\tthis.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nValidatorContext.prototype.getSchema = function (url) {\r\n\tif (this.schemas[url] != undefined) {\r\n\t\tvar schema = this.schemas[url];\r\n\t\treturn schema;\r\n\t}\r\n\tvar baseUrl = url;\r\n\tvar fragment = \"\";\r\n\tif (url.indexOf('#') != -1) {\r\n\t\tfragment = url.substring(url.indexOf(\"#\") + 1);\r\n\t\tbaseUrl = url.substring(0, url.indexOf(\"#\"));\r\n\t}\r\n\tif (this.schemas[baseUrl] != undefined) {\r\n\t\tvar schema = this.schemas[baseUrl];\r\n\t\tvar pointerPath = decodeURIComponent(fragment);\r\n\t\tif (pointerPath == \"\") {\r\n\t\t\treturn schema;\r\n\t\t} else if (pointerPath.charAt(0) != \"/\") {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar parts = pointerPath.split(\"/\").slice(1);\r\n\t\tfor (var i = 0; i < parts.length; i++) {\r\n\t\t\tvar component = parts[i].replace(\"~1\", \"/\").replace(\"~0\", \"~\");\r\n\t\t\tif (schema[component] == undefined) {\r\n\t\t\t\tschema = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tschema = schema[component];\r\n\t\t}\r\n\t\tif (schema != undefined) {\r\n\t\t\treturn schema;\r\n\t\t}\r\n\t}\r\n\tif (this.missing[baseUrl] == undefined) {\r\n\t\tthis.missing.push(baseUrl);\r\n\t\tthis.missing[baseUrl] = baseUrl;\r\n\t}\r\n};\r\nValidatorContext.prototype.addSchema = function (url, schema) {\r\n\tvar map = {};\r\n\tmap[url] = schema;\r\n\tnormSchema(schema, url);\r\n\tsearchForTrustedSchemas(map, schema, url);\r\n\tfor (var key in map) {\r\n\t\tthis.schemas[key] = map[key];\r\n\t}\r\n\treturn map;\r\n};\r\n\t\r\nValidatorContext.prototype.validateAll = function validateAll(data, schema, dataPathParts, schemaPathParts) {\r\n\tif (schema['$ref'] != undefined) {\r\n\t\tschema = this.getSchema(schema['$ref']);\r\n\t\tif (!schema) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar errorCount = this.errors.length;\r\n\tvar error = this.validateBasic(data, schema)\r\n\t\t|| this.validateNumeric(data, schema)\r\n\t\t|| this.validateString(data, schema)\r\n\t\t|| this.validateArray(data, schema)\r\n\t\t|| this.validateObject(data, schema)\r\n\t\t|| this.validateCombinations(data, schema)\r\n\t\t|| null\r\n\tif (error || errorCount != this.errors.length) {\r\n\t\twhile ((dataPathParts && dataPathParts.length) || (schemaPathParts && schemaPathParts.length)) {\r\n\t\t\tvar dataPart = (dataPathParts && dataPathParts.length) ? \"\" + dataPathParts.pop() : null;\r\n\t\t\tvar schemaPart = (schemaPathParts && schemaPathParts.length) ? \"\" + schemaPathParts.pop() : null;\r\n\t\t\tif (error) {\r\n\t\t\t\terror = error.prefixWith(dataPart, schemaPart);\r\n\t\t\t}\r\n\t\t\tthis.prefixErrors(errorCount, dataPart, schemaPart);\r\n\t\t}\r\n\t}\r\n\t\t\r\n\treturn this.handleError(error);\r\n}\r\n\r\nfunction recursiveCompare(A, B) {\r\n\tif (A === B) {\r\n\t\treturn true;\r\n\t}\r\n\tif (typeof A == \"object\" && typeof B == \"object\") {\r\n\t\tif (Array.isArray(A) != Array.isArray(B)) {\r\n\t\t\treturn false;\r\n\t\t} else if (Array.isArray(A)) {\r\n\t\t\tif (A.length != B.length) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < A.length; i++) {\r\n\t\t\t\tif (!recursiveCompare(A[i], B[i])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (var key in A) {\r\n\t\t\t\tif (B[key] === undefined && A[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var key in B) {\r\n\t\t\t\tif (A[key] === undefined && B[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var key in A) {\r\n\t\t\t\tif (!recursiveCompare(A[key], B[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValidatorContext.prototype.validateBasic = function validateBasic(data, schema) {\r\n\tvar error;\r\n\tif (error = this.validateType(data, schema)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\tif (error = this.validateEnum(data, schema)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateType = function validateType(data, schema) {\r\n\tif (schema.type == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar dataType = typeof data;\r\n\tif (data == null) {\r\n\t\tdataType = \"null\";\r\n\t} else if (Array.isArray(data)) {\r\n\t\tdataType = \"array\";\r\n\t}\r\n\tvar allowedTypes = schema.type;\r\n\tif (typeof allowedTypes != \"object\") {\r\n\t\tallowedTypes = [allowedTypes];\r\n\t}\r\n\t\r\n\tfor (var i = 0; i < allowedTypes.length; i++) {\r\n\t\tvar type = allowedTypes[i];\r\n\t\tif (type == dataType || (type == \"integer\" && dataType == \"number\" && (data%1 == 0))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn new ValidationError(ErrorCodes.INVALID_TYPE, \"invalid data type: \" + dataType);\r\n}\r\n\r\nValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\r\n\tif (schema[\"enum\"] == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tfor (var i = 0; i < schema[\"enum\"].length; i++) {\r\n\t\tvar enumVal = schema[\"enum\"][i];\r\n\t\tif (recursiveCompare(data, enumVal)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn new ValidationError(ErrorCodes.ENUM_MISMATCH, \"No enum match for: \" + JSON.stringify(data));\r\n}\r\nValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema) {\r\n\treturn this.validateMultipleOf(data, schema)\r\n\t\t|| this.validateMinMax(data, schema)\r\n\t\t|| null;\r\n}\r\n\r\nValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\r\n\tvar multipleOf = schema.multipleOf || schema.divisibleBy;\r\n\tif (multipleOf == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tif (typeof data == \"number\") {\r\n\t\tif (data%multipleOf != 0) {\r\n\t\t\treturn new ValidationError(ErrorCodes.NUMBER_MULTIPLE_OF, \"Value \" + data + \" is not a multiple of \" + multipleOf);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\r\n\tif (typeof data != \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minimum != undefined) {\r\n\t\tif (data < schema.minimum) {\r\n\t\t\treturn new ValidationError(ErrorCodes.NUMBER_MINIMUM, \"Value \" + data + \" is less than minimum \" + schema.minimum).prefixWith(null, \"minimum\");\r\n\t\t}\r\n\t\tif (schema.exclusiveMinimum && data == schema.minimum) {\r\n\t\t\treturn new ValidationError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, \"Value \"+ data + \" is equal to exclusive minimum \" + schema.minimum).prefixWith(null, \"exclusiveMinimum\");\r\n\t\t}\r\n\t}\r\n\tif (schema.maximum != undefined) {\r\n\t\tif (data > schema.maximum) {\r\n\t\t\treturn new ValidationError(ErrorCodes.NUMBER_MAXIMUM, \"Value \" + data + \" is greater than maximum \" + schema.maximum).prefixWith(null, \"maximum\");\r\n\t\t}\r\n\t\tif (schema.exclusiveMaximum && data == schema.maximum) {\r\n\t\t\treturn new ValidationError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, \"Value \"+ data + \" is equal to exclusive maximum \" + schema.maximum).prefixWith(null, \"exclusiveMaximum\");\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\nValidatorContext.prototype.validateString = function validateString(data, schema) {\r\n\treturn this.validateStringLength(data, schema)\r\n\t\t|| this.validateStringPattern(data, schema)\r\n\t\t|| null;\r\n}\r\n\r\nValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\r\n\tif (typeof data != \"string\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minLength != undefined) {\r\n\t\tif (data.length < schema.minLength) {\r\n\t\t\treturn new ValidationError(ErrorCodes.STRING_LENGTH_SHORT, \"String is too short (\" + data.length + \" chars), minimum \" + schema.minLength).prefixWith(null, \"minLength\");\r\n\t\t}\r\n\t}\r\n\tif (schema.maxLength != undefined) {\r\n\t\tif (data.length > schema.maxLength) {\r\n\t\t\treturn new ValidationError(ErrorCodes.STRING_LENGTH_LONG, \"String is too long (\" + data.length + \" chars), maximum \" + schema.maxLength).prefixWith(null, \"maxLength\");\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\r\n\tif (typeof data != \"string\" || schema.pattern == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar regexp = new RegExp(schema.pattern);\r\n\tif (!regexp.test(data)) {\r\n\t\treturn new ValidationError(ErrorCodes.STRING_PATTERN, \"String does not match pattern\").prefixWith(null, \"pattern\");\r\n\t}\r\n\treturn null;\r\n}\r\nValidatorContext.prototype.validateArray = function validateArray(data, schema) {\r\n\tif (!Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateArrayLength(data, schema)\r\n\t\t|| this.validateArrayUniqueItems(data, schema)\r\n\t\t|| this.validateArrayItems(data, schema)\r\n\t\t|| null;\r\n}\r\n\r\nValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\r\n\tif (schema.minItems != undefined) {\r\n\t\tif (data.length < schema.minItems) {\r\n\t\t\tvar error = (new ValidationError(ErrorCodes.ARRAY_LENGTH_SHORT, \"Array is too short (\" + data.length + \"), minimum \" + schema.minItems)).prefixWith(null, \"minItems\");\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxItems != undefined) {\r\n\t\tif (data.length > schema.maxItems) {\r\n\t\t\tvar error = (new ValidationError(ErrorCodes.ARRAY_LENGTH_LONG, \"Array is too long (\" + data.length + \" chars), maximum \" + schema.maxItems)).prefixWith(null, \"maxItems\");\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\r\n\tif (schema.uniqueItems) {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tfor (var j = i + 1; j < data.length; j++) {\r\n\t\t\t\tif (recursiveCompare(data[i], data[j])) {\r\n\t\t\t\t\tvar error = (new ValidationError(ErrorCodes.ARRAY_UNIQUE, \"Array items are not unique (indices \" + i + \" and \" + j + \")\")).prefixWith(null, \"uniqueItems\");\r\n\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema) {\r\n\tif (schema.items == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tif (Array.isArray(schema.items)) {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tif (i < schema.items.length) {\r\n\t\t\t\tif (error = this.validateAll(data[i], schema.items[i], [i], [\"items\", i])) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t} else if (schema.additionalItems != undefined) {\r\n\t\t\t\tif (typeof schema.additionalItems == \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalItems) {\r\n\t\t\t\t\t\terror = (new ValidationError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, \"Additional items not allowed\")).prefixWith(\"\" + i, \"additionalItems\");\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (error = this.validateAll(data[i], schema.additionalItems, [i], [\"additionalItems\"])) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tif (error = this.validateAll(data[i], schema.items, [i], [\"items\"])) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\nValidatorContext.prototype.validateObject = function validateObject(data, schema) {\r\n\tif (typeof data != \"object\" || data == null || Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateObjectMinMaxProperties(data, schema)\r\n\t\t|| this.validateObjectRequiredProperties(data, schema)\r\n\t\t|| this.validateObjectProperties(data, schema)\r\n\t\t|| this.validateObjectDependencies(data, schema)\r\n\t\t|| null;\r\n}\r\n\r\nValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\r\n\tvar keys = Object.keys(data);\r\n\tif (schema.minProperties != undefined) {\r\n\t\tif (keys.length < schema.minProperties) {\r\n\t\t\tvar error = new ValidationError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, \"Too few properties defined (\" + keys.length + \"), minimum \" + schema.minProperties).prefixWith(null, \"minProperties\");\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxProperties != undefined) {\r\n\t\tif (keys.length > schema.maxProperties) {\r\n\t\t\tvar error = new ValidationError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, \"Too many properties defined (\" + keys.length + \"), maximum \" + schema.maxProperties).prefixWith(null, \"maxProperties\");\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\r\n\tif (schema.required != undefined) {\r\n\t\tfor (var i = 0; i < schema.required.length; i++) {\r\n\t\t\tvar key = schema.required[i];\r\n\t\t\tif (data[key] === undefined) {\r\n\t\t\t\tvar error = new ValidationError(ErrorCodes.OBJECT_REQUIRED, \"Missing required property: \" + key).prefixWith(null, \"\" + i).prefixWith(null, \"required\");\r\n\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema) {\r\n\tvar error;\r\n\tfor (var key in data) {\r\n\t\tvar foundMatch = false;\r\n\t\tif (schema.properties != undefined && schema.properties[key] != undefined) {\r\n\t\t\tfoundMatch = true;\r\n\t\t\tif (error = this.validateAll(data[key], schema.properties[key], [key], [\"properties\", key])) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (schema.patternProperties != undefined) {\r\n\t\t\tfor (var patternKey in schema.patternProperties) {\r\n\t\t\t\tvar regexp = new RegExp(patternKey);\r\n\t\t\t\tif (regexp.test(key)) {\r\n\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], [\"patternProperties\", patternKey])) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!foundMatch && schema.additionalProperties != undefined) {\r\n\t\t\tif (typeof schema.additionalProperties == \"boolean\") {\r\n\t\t\t\tif (!schema.additionalProperties) {\r\n\t\t\t\t\terror = new ValidationError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, \"Additional properties not allowed\").prefixWith(key, \"additionalProperties\");\r\n\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (error = this.validateAll(data[key], schema.additionalProperties, [key], [\"additionalProperties\"])) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema) {\r\n\tvar error;\r\n\tif (schema.dependencies != undefined) {\r\n\t\tfor (var depKey in schema.dependencies) {\r\n\t\t\tif (data[depKey] !== undefined) {\r\n\t\t\t\tvar dep = schema.dependencies[depKey];\r\n\t\t\t\tif (typeof dep == \"string\") {\r\n\t\t\t\t\tif (data[dep] === undefined) {\r\n\t\t\t\t\t\terror = new ValidationError(ErrorCodes.OBJECT_DEPENDENCY_KEY, \"Dependency failed - key must exist: \" + dep).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (Array.isArray(dep)) {\r\n\t\t\t\t\tfor (var i = 0; i < dep.length; i++) {\r\n\t\t\t\t\t\tvar requiredKey = dep[i];\r\n\t\t\t\t\t\tif (data[requiredKey] === undefined) {\r\n\t\t\t\t\t\t\terror = new ValidationError(ErrorCodes.OBJECT_DEPENDENCY_KEY, \"Dependency failed - key must exist: \" + requiredKey).prefixWith(null, \"\" + i).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data, dep, [], [\"dependencies\", depKey])) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema) {\r\n\tvar error;\r\n\treturn this.validateAllOf(data, schema)\r\n\t\t|| this.validateAnyOf(data, schema)\r\n\t\t|| this.validateOneOf(data, schema)\r\n\t\t|| this.validateNot(data, schema)\r\n\t\t|| null;\r\n}\r\n\r\nValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema) {\r\n\tif (schema.allOf == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.allOf.length; i++) {\r\n\t\tvar subSchema = schema.allOf[i];\r\n\t\tif (error = this.validateAll(data, subSchema, [], [\"allOf\", i])) {\r\n\t\t\treturn error;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema) {\r\n\tif (schema.anyOf == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tfor (var i = 0; i < schema.anyOf.length; i++) {\r\n\t\tvar subSchema = schema.anyOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"anyOf\", i]);\r\n\r\n\t\tif (error == null && errorCount == this.errors.length) {\r\n\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (error) {\r\n\t\t\terrors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"anyOf\"));\r\n\t\t}\r\n\t}\r\n\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\treturn new ValidationError(ErrorCodes.ANY_OF_MISSING, \"Data does not match any schemas from \\\"anyOf\\\"\", \"\", \"/anyOf\", errors);\r\n}\r\n\r\nValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema) {\r\n\tif (schema.oneOf == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar validIndex = null;\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tfor (var i = 0; i < schema.oneOf.length; i++) {\r\n\t\tvar subSchema = schema.oneOf[i];\r\n\t\t\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"oneOf\", i]);\r\n\t\t\r\n\t\tif (error == null && errorCount == this.errors.length) {\r\n\t\t\tif (validIndex == null) {\r\n\t\t\t\tvalidIndex = i;\r\n\t\t\t} else {\r\n\t\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\t\t\treturn new ValidationError(ErrorCodes.ONE_OF_MULTIPLE, \"Data is valid against more than one schema from \\\"oneOf\\\": indices \" + validIndex + \" and \" + i, \"\", \"/oneOf\");\r\n\t\t\t}\r\n\t\t} else if (error) {\r\n\t\t\terrors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"oneOf\"));\r\n\t\t}\r\n\t}\r\n\tif (validIndex == null) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn new ValidationError(ErrorCodes.ONE_OF_MISSING, \"Data does not match any schemas from \\\"oneOf\\\"\", \"\", \"/oneOf\", errors);\r\n\t} else {\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nValidatorContext.prototype.validateNot = function validateNot(data, schema) {\r\n\tif (schema.not == undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar oldErrorCount = this.errors.length;\r\n\tvar error = this.validateAll(data, schema.not);\r\n\tvar notErrors = this.errors.slice(oldErrorCount);\r\n\tthis.errors = this.errors.slice(0, oldErrorCount);\r\n\tif (error == null && notErrors.length == 0) {\r\n\t\treturn new ValidationError(ErrorCodes.NOT_PASSED, \"Data matches schema from \\\"not\\\"\", \"\", \"/not\")\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n// parseURI() and resolveUrl() are from https://gist.github.com/1088850\r\n//   -  released as public domain by author (\"Yaffle\") - see comments on gist\r\n\r\nfunction parseURI(url) {\r\n\tvar m = String(url).replace(/^\\s+|\\s+$/g, '').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/);\r\n\t// authority = '//' + user + ':' + pass '@' + hostname + ':' port\r\n\treturn (m ? {\r\n\t\thref     : m[0] || '',\r\n\t\tprotocol : m[1] || '',\r\n\t\tauthority: m[2] || '',\r\n\t\thost     : m[3] || '',\r\n\t\thostname : m[4] || '',\r\n\t\tport     : m[5] || '',\r\n\t\tpathname : m[6] || '',\r\n\t\tsearch   : m[7] || '',\r\n\t\thash     : m[8] || ''\r\n\t} : null);\r\n}\r\n\r\nfunction resolveUrl(base, href) {// RFC 3986\r\n\r\n\tfunction removeDotSegments(input) {\r\n\t\tvar output = [];\r\n\t\tinput.replace(/^(\\.\\.?(\\/|$))+/, '')\r\n\t\t\t.replace(/\\/(\\.(\\/|$))+/g, '/')\r\n\t\t\t.replace(/\\/\\.\\.$/, '/../')\r\n\t\t\t.replace(/\\/?[^\\/]*/g, function (p) {\r\n\t\t\t\tif (p === '/..') {\r\n\t\t\t\t\toutput.pop();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput.push(p);\r\n\t\t\t\t}\r\n\t\t});\r\n\t\treturn output.join('').replace(/^\\//, input.charAt(0) === '/' ? '/' : '');\r\n\t}\r\n\r\n\thref = parseURI(href || '');\r\n\tbase = parseURI(base || '');\r\n\r\n\treturn !href || !base ? null : (href.protocol || base.protocol) +\r\n\t\t(href.protocol || href.authority ? href.authority : base.authority) +\r\n\t\tremoveDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === '/' ? href.pathname : (href.pathname ? ((base.authority && !base.pathname ? '/' : '') + base.pathname.slice(0, base.pathname.lastIndexOf('/') + 1) + href.pathname) : base.pathname)) +\r\n\t\t(href.protocol || href.authority || href.pathname ? href.search : (href.search || base.search)) +\r\n\t\thref.hash;\r\n}\r\n\r\nfunction normSchema(schema, baseUri) {\r\n\tif (baseUri == undefined) {\r\n\t\tbaseUri = schema.id;\r\n\t} else if (typeof schema.id == \"string\") {\r\n\t\tbaseUri = resolveUrl(baseUri, schema.id);\r\n\t\tschema.id = baseUri;\r\n\t}\r\n\tif (typeof schema == \"object\") {\r\n\t\tif (Array.isArray(schema)) {\r\n\t\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\t\tnormSchema(schema[i], baseUri);\r\n\t\t\t}\r\n\t\t} else if (typeof schema['$ref'] == \"string\") {\r\n\t\t\tschema['$ref'] = resolveUrl(baseUri, schema['$ref']);\r\n\t\t} else {\r\n\t\t\tfor (var key in schema) {\r\n\t\t\t\tif (key != \"enum\") {\r\n\t\t\t\t\tnormSchema(schema[key], baseUri);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar ErrorCodes = {\r\n\tINVALID_TYPE: 0,\r\n\tENUM_MISMATCH: 1,\r\n\tANY_OF_MISSING: 10,\r\n\tONE_OF_MISSING: 11,\r\n\tONE_OF_MULTIPLE: 12,\r\n\tNOT_PASSED: 13,\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: 100,\r\n\tNUMBER_MINIMUM: 101,\r\n\tNUMBER_MINIMUM_EXCLUSIVE: 102,\r\n\tNUMBER_MAXIMUM: 103,\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: 104,\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: 200,\r\n\tSTRING_LENGTH_LONG: 201,\r\n\tSTRING_PATTERN: 202,\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: 300,\r\n\tOBJECT_PROPERTIES_MAXIMUM: 301,\r\n\tOBJECT_REQUIRED: 302,\r\n\tOBJECT_ADDITIONAL_PROPERTIES: 303,\r\n\tOBJECT_DEPENDENCY_KEY: 304,\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: 400,\r\n\tARRAY_LENGTH_LONG: 401,\r\n\tARRAY_UNIQUE: 402,\r\n\tARRAY_ADDITIONAL_ITEMS: 403\r\n};\r\n\r\nfunction ValidationError(code, message, dataPath, schemaPath, subErrors) {\r\n\tif (code == undefined) {\r\n\t\tthrow new Error (\"No code supplied for error: \"+ message);\r\n\t}\r\n\tthis.code = code;\r\n\tthis.message = message;\r\n\tthis.dataPath = dataPath ? dataPath : \"\";\r\n\tthis.schemaPath = schemaPath ? schemaPath : \"\";\r\n\tthis.subErrors = subErrors ? subErrors : null;\r\n}\r\nValidationError.prototype = {\r\n\tprefixWith: function (dataPrefix, schemaPrefix) {\r\n\t\tif (dataPrefix != null) {\r\n\t\t\tdataPrefix = dataPrefix.replace(\"~\", \"~0\").replace(\"/\", \"~1\");\r\n\t\t\tthis.dataPath = \"/\" + dataPrefix + this.dataPath;\r\n\t\t}\r\n\t\tif (schemaPrefix != null) {\r\n\t\t\tschemaPrefix = schemaPrefix.replace(\"~\", \"~0\").replace(\"/\", \"~1\");\r\n\t\t\tthis.schemaPath = \"/\" + schemaPrefix + this.schemaPath;\r\n\t\t}\r\n\t\tif (this.subErrors != null) {\r\n\t\t\tfor (var i = 0; i < this.subErrors.length; i++) {\r\n\t\t\t\tthis.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\nfunction searchForTrustedSchemas(map, schema, url) {\r\n\tif (typeof schema.id == \"string\") {\r\n\t\tif (schema.id.substring(0, url.length) == url) {\r\n\t\t\tvar remainder = schema.id.substring(url.length);\r\n\t\t\tif ((url.length > 0 && url.charAt(url.length - 1) == \"/\")\r\n\t\t\t\t|| remainder.charAt(0) == \"#\"\r\n\t\t\t\t|| remainder.charAt(0) == \"?\") {\r\n\t\t\t\tif (map[schema.id] == undefined) {\r\n\t\t\t\t\tmap[schema.id] = schema;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (typeof schema == \"object\") {\r\n\t\tfor (var key in schema) {\r\n\t\t\tif (key != \"enum\" && typeof schema[key] == \"object\") {\r\n\t\t\t\tsearchForTrustedSchemas(map, schema[key], url);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn map;\r\n}\r\n\r\nvar globalContext = new ValidatorContext();\r\n\r\nvar publicApi = {\r\n\tvalidate: function (data, schema) {\r\n\t\tvar context = new ValidatorContext(globalContext);\r\n\t\tif (typeof schema == \"string\") {\r\n\t\t\tschema = {\"$ref\": schema};\r\n\t\t}\r\n\t\tvar added = context.addSchema(\"\", schema);\r\n\t\tvar error = context.validateAll(data, schema);\r\n\t\tthis.error = error;\r\n\t\tthis.missing = context.missing;\r\n\t\tthis.valid = (error == null);\r\n\t\treturn this.valid;\r\n\t},\r\n\tvalidateResult: function () {\r\n\t\tvar result = {};\r\n\t\tthis.validate.apply(result, arguments);\r\n\t\treturn result;\r\n\t},\r\n\tvalidateMultiple: function (data, schema) {\r\n\t\tvar context = new ValidatorContext(globalContext, true);\r\n\t\tif (typeof schema == \"string\") {\r\n\t\t\tschema = {\"$ref\": schema};\r\n\t\t}\r\n\t\tcontext.addSchema(\"\", schema);\r\n\t\tcontext.validateAll(data, schema);\r\n\t\tvar result = {};\r\n\t\tresult.errors = context.errors;\r\n\t\tresult.missing = context.missing;\r\n\t\tresult.valid = (result.errors.length == 0);\r\n\t\treturn result;\r\n\t},\r\n\taddSchema: function (url, schema) {\r\n\t\treturn globalContext.addSchema(url, schema);\r\n\t},\r\n\tgetSchema: function (url) {\r\n\t\treturn globalContext.getSchema(url);\r\n\t},\r\n\tmissing: [],\r\n\terror: null,\r\n\tnormSchema: normSchema,\r\n\tresolveUrl: resolveUrl,\r\n\terrorCodes: ErrorCodes\r\n};\r\n\r\nglobal.tv4 = publicApi;\r\n\r\n})((typeof module !== 'undefined' && module.exports) ? exports : this);\r\n\r\n","/**\r\n * This namespace encapsulates all the classes, functions, and constants defined for the Extensible Mapping Platform.\r\n * @namespace\r\n */\r\nvar emp = window.emp || {};\r\nemp.version = \"3.0.0 Beta 1\";\r\nemp.validate = true;\r\n\r\n/**\r\n * @namespace\r\n */\r\nemp.core = {\r\n  sources: {\r\n    CONDUCTOR: \"conductor\",\r\n    CONFIG: \"config\",\r\n    ERROR: \"error\",\r\n    EVENTING: \"eventing\",\r\n    INTENT: \"intent\",\r\n    MAP: \"map\",\r\n    QUEUE: \"queue\",\r\n    STORAGE: \"storage\",\r\n    LIBRARY: \"library\",\r\n    HOST: \"EMP\",\r\n    EMP: \"EMP\",\r\n    CORE: \"core\"\r\n  }\r\n};\r\n/**\r\n * @namespace\r\n */\r\nemp.settings = emp.settings || {\r\n  iconSize: 1.2,\r\n  labelSize: 0.9,\r\n  iconSizeOption: 24\r\n};\r\n","var emp = window.emp || {};\r\n\r\n/**\r\n * @namespace\r\n */\r\nemp.util = emp.util || {};\r\n\r\n/**\r\n * @description This function test if the parameters is an empty string. An undefined,\r\n * null, non string type, or \"\" value is considered empty.\r\n * @param {String} str The string on which the test is to be performed.\r\n * @returns {Boolean}\r\n */\r\nemp.util.isEmptyString = function (str) {\r\n  var isEmpty = false;\r\n  if (str === undefined ||\r\n    str === null ||\r\n    typeof str !== \"string\" ||\r\n    str === \"\" ||\r\n    str === \"undefined\" ||\r\n    str === \"null\" || !str.replace(/\\s/g, '').length) {\r\n    isEmpty = true;\r\n  }\r\n  return isEmpty;\r\n};\r\n\r\n/**\r\n * @description This function return the value contained in the Value parameter to a boolean value. It return the value of bDefault if the Value can't be converted.\r\n * @param {String|Boolean} value\r\n * @param {Boolean} bDefault\r\n * @throws {String} This function throw an error if the bDefault parameters is NOT a boolean value.\r\n * @returns {Boolean}\r\n */\r\nemp.util.getBooleanValue = function (value, bDefault) {\r\n\r\n  var ret;\r\n\r\n  if (typeof bDefault !== 'boolean') {\r\n    throw 'Invalid boolean default value.';\r\n  }\r\n\r\n  if (typeof value === 'boolean') {\r\n    ret = value;\r\n  } else if (typeof value === 'string') {\r\n    value = value.toLowerCase();\r\n    if (value === 'true') {\r\n      ret = true;\r\n    } else if (value === 'false') {\r\n      ret = false;\r\n    } else {\r\n      ret = bDefault;\r\n    }\r\n  } else {\r\n    ret = bDefault;\r\n  }\r\n\r\n  return ret;\r\n};\r\n\r\n/**\r\n * Returns true if the symbol code represents a valid Airspace Symbol\r\n * @param sSymbolCode\r\n * @returns {boolean}\r\n */\r\nemp.util.isAirspaceSymbol = function (sSymbolCode) {\r\n  return (sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_CAKE ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_ROUTE ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_CYLINDER ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_ORBIT ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_POLYGON ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_RADARC ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_POLYARC ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_TRACK ||\r\n  sSymbolCode === emp.constant.airspaceSymbolCode.SHAPE3D_CURTAIN);\r\n\r\n};\r\n\r\n/**\r\n * Parses the URL for passed parameters\r\n * @param name\r\n * @param url\r\n * @returns {*}\r\n */\r\nemp.util.getParameterByName = function (name, url) {\r\n  if (!url) url = window.location.href;\r\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n  var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\r\n    results = regex.exec(url);\r\n  if (!results) return null;\r\n  if (!results[2]) return '';\r\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\r\n};\r\n\r\n/**\r\n * Returns the enumeration version of the environment\r\n * @param {string} environment\r\n * @returns {string}\r\n */\r\nemp.util.validateEnvironment = function (environment) {\r\n  switch (environment) {\r\n    case \"starfish\":\r\n      environment = emp.environment.starfish;\r\n      break;\r\n    case \"owf\":\r\n      environment = emp.environment.owf;\r\n      break;\r\n    case \"iwc\":\r\n      environment = emp.environment.iwc;\r\n      break;\r\n    default:\r\n      environment = emp.environment.browser;\r\n      break;\r\n  }\r\n  return environment;\r\n};\r\n\r\n/**\r\n * @param {ColorObject} color\r\n * @returns {string} AARRGGBB\r\n */\r\nemp.util.convertColorToHexColor = function (color) {\r\n  var red,\r\n    green,\r\n    blue,\r\n    alpha;\r\n\r\n  red = color.red.toString(16);\r\n  if (red.length === 1) {\r\n    red = '0' + red;\r\n  }\r\n  green = color.green.toString(16);\r\n  if (green.length === 1) {\r\n    green = '0' + green;\r\n  }\r\n  blue = color.blue.toString(16);\r\n  if (blue.length === 1) {\r\n    blue = '0' + blue;\r\n  }\r\n  alpha = Math.round(255 * color.alpha).toString(16);\r\n  if (alpha.length === 1) {\r\n    alpha = '0' + alpha;\r\n  }\r\n\r\n  return (alpha + red + green + blue).toUpperCase();\r\n};\r\n\r\n/**\r\n * @param {string} hex AARRGGBB\r\n * @returns {ColorObject}\r\n */\r\nemp.util.convertHexToColor = function (hex) {\r\n  var color = {},\r\n    alpha,\r\n    red,\r\n    blue,\r\n    green;\r\n\r\n  if (hex.length === 8) {\r\n    alpha = hex.substr(0, 2);\r\n    red = hex.substr(2, 2);\r\n    green = hex.substr(4, 2);\r\n    blue = hex.substr(6, 2);\r\n\r\n    color.red = parseInt(red, 16);\r\n    color.blue = parseInt(blue, 16);\r\n    color.green = parseInt(green, 16);\r\n    color.alpha = (parseInt(alpha, 16)) / 255;\r\n\r\n    return color;\r\n  } else {\r\n    return undefined;\r\n  }\r\n};\r\n\r\n/**\r\n * @typedef {object} ColorObject\r\n * @property {number} red\r\n * @property {number} green\r\n * @property {number} blue\r\n * @property {number} alpha\r\n */\r\n\r\n/**\r\n *\r\n * @param xmlStr\r\n * @returns {Document}\r\n */\r\nemp.util.parseXML = function (xmlStr) {\r\n  return (new window.DOMParser()).parseFromString(xmlStr, \"text/xml\");\r\n};\r\n\r\n/**\r\n *\r\n * @param {Array.<*>|HTMLCollection|NodeList|NamedNodeMap} collection\r\n * @param {emp.util.each~Callback} func\r\n * @throws TypeError\r\n */\r\nemp.util.each = function (collection, func) {\r\n  if (!collection) {\r\n    return;\r\n  }\r\n\r\n  // Convert some expected types to Array\r\n  if (collection instanceof HTMLCollection || collection instanceof NodeList) {\r\n    collection = Array.prototype.slice.call(collection);\r\n  }\r\n\r\n  if (Array.isArray(collection)) {\r\n    // use standard array logic\r\n    Array.prototype.forEach.call(collection, function (el, i) {\r\n      func(el, i);\r\n    });\r\n  } else if (collection instanceof NamedNodeMap) {\r\n    var i,\r\n      len = collection.length;\r\n\r\n    for (i = 0; i < len; i++) {\r\n      func(collection[i], i);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * This callback handles the each function.\r\n * @callback emp.util.each~Callback\r\n * @param {*} elem\r\n * @param {number} index\r\n */\r\n\r\n/**\r\n * @namespace\r\n */\r\nemp.util.enums = {};\r\n/**\r\n * @enum {number}\r\n * @readonly\r\n */\r\nemp.util.enums.DOMNodeTypes = {\r\n  /**\r\n   * nodeName: element name\r\n   * nodeValue: null\r\n   */\r\n  \"Element\": 1,\r\n  /**\r\n   * nodeName: attribute name\r\n   * nodeValue: attribute value\r\n   */\r\n  \"Attr\": 2,\r\n  /**\r\n   * nodeName: #text\r\n   * nodeValue: content of node\r\n   */\r\n  \"Text\": 3,\r\n  /**\r\n   * nodeName: #cdata-section\r\n   * nodeValue: content of node\r\n   */\r\n  \"CDATASection\": 4,\r\n  /**\r\n   * nodeName: entity reference name\r\n   * nodeValue: null\r\n   */\r\n  \"EntityReference\": 5,\r\n  /**\r\n   * nodeName: entity name\r\n   * nodeValue: null\r\n   */\r\n  \"Entity\": 6,\r\n  /**\r\n   * nodeName: target\r\n   * nodeValue: content of node\r\n   */\r\n  \"ProcessingInstruction\": 7,\r\n  /**\r\n   * nodeName: #comment\r\n   * nodeValue: comment text\r\n   */\r\n  \"Comment\": 8,\r\n  /**\r\n   * nodeName: #document\r\n   * nodeValue: null\r\n   */\r\n  \"Document\": 9,\r\n  /**\r\n   * nodeName: doctype name\r\n   * nodeValue: null\r\n   */\r\n  \"DocumentType\": 10,\r\n  /**\r\n   * nodeName: #document fragment\r\n   * nodeValue: null\r\n   */\r\n  \"DocumentFragment\": 11,\r\n  /**\r\n   * nodeName: notation name\r\n   * nodeValue: null\r\n   */\r\n  \"Notation\": 12\r\n};\r\n","/*\r\n *\r\n * This file must be loaded directly by the client.\r\n */\r\nvar emp = window.emp || {};\r\nemp.util = emp.util || {};\r\n\r\nif (emp.util.config === undefined) {\r\n    /**\r\n     * @memberOf emp.util\r\n     * @static\r\n     * @class This class contains the EMP configuration.\r\n     * @description The configuration object is currently parsed is of type\r\n     * @link emp.util.configType.\r\n     */\r\n    emp.util.config = (function(){\r\n        var empV3Config;\r\n\r\n        var publicInterface = {\r\n            /**\r\n             * @description This function sets the config object for the map instance.\r\n             * It applies any global properties to the unique config object for this\r\n             * instance.\r\n             */\r\n            setConfigObject: function() {\r\n              empV3Config = {};\r\n              \r\n              if (!empV3Config.hasOwnProperty('urlProxy')) {\r\n                empV3Config.urlProxy =  emp3.api.global.configuration.urlProxy;\r\n              }\r\n            },\r\n            /**\r\n             * @description This function return the emp config object.\r\n             * @returns {Object} This function return the emp config object.\r\n             */\r\n            getConfigObject: function() {\r\n              if (empV3Config === undefined) {\r\n                this.setConfigObject();\r\n              }\r\n              // true is the default for autoSelect\r\n              this.setAutoSelect(true);\r\n              return empV3Config;\r\n            },\r\n            /**\r\n             * @description This function retrieves the value of the specified parameter.\r\n             * @param {String} sParameter This parameter must contain the name of the parameter whos value is being requested.\r\n             * @returns {undefined | Object | boolean | Number | String | Array} The value of the parameter or undefined if it is not found.\r\n             */\r\n            getConfigParameter: function(sParameter) {\r\n              var oConfigObject = this.getConfigObject();\r\n\r\n              if (oConfigObject.hasOwnProperty(sParameter)) {\r\n                return oConfigObject[sParameter];\r\n              }\r\n              return undefined;\r\n            },\r\n            /**\r\n             * @description This function retrieves the value of the urlProxy parameter.\r\n             * @returns {String} This function returns the value of the parameter.\r\n             */\r\n            getProxyUrl: function() {\r\n                return this.getConfigParameter('urlProxy');\r\n            },\r\n            /**\r\n             * @description This function retrieves the value of the useProxy parameter.\r\n             * @returns {Boolean} This function returns the value of the parameter.\r\n             */\r\n            getUseProxySetting: function() {\r\n                // When useProxy has been implemented in Features/Map Services classes\r\n                // and all references to this function have been altered/deleted, this\r\n                // function can be deleted. For now change this value to turn proxy on\r\n                // and off for the instance.\r\n                return false;\r\n            },\r\n            /**\r\n             * @description Retrieves whether autoSelect is turned on for this map.\r\n             * @return {boolean}\r\n             */\r\n            getAutoSelect: function() {\r\n                return this.getConfigParameter('autoSelect');\r\n            },\r\n            /**\r\n             * @description Sets the autoSelect for this map.\r\n             */\r\n            setAutoSelect: function(flag) {\r\n              if (empV3Config.hasOwnProperty('autoSelect')) {\r\n                if (typeof (empV3Config.autoSelect) === 'boolean') {\r\n                    empV3Config.autoSelect = empV3Config.autoSelect;\r\n                } else {\r\n                    empV3Config.autoSelect =  flag;\r\n                }\r\n              } else {\r\n                empV3Config.autoSelect =  flag;\r\n              }\r\n            },\r\n            // The currentMapEngineId should remain on a global level once\r\n            // separate config object are maintained for each instance.\r\n            /**\r\n             * @description Sets the current engine configuration and mapEngineId.\r\n             */\r\n            setCurrentEngineConfiguration: function (engineConfig) {\r\n              empV3Config.previousMapEngineId = empV3Config.currentMapEngineId;\r\n              empV3Config.currentMapEngineId = engineConfig.mapEngineId;\r\n              empV3Config.currentEngineConfiguration = engineConfig;\r\n            },\r\n            /**\r\n             * @description Gets the currentEngineConfiguration.\r\n             * @return {string}\r\n             */\r\n            getCurrentEngineConfiguration: function () {\r\n              return this.getConfigParameter('currentEngineConfiguration');\r\n            },\r\n            /**\r\n             * @description Gets the currentMapEngineId.\r\n             * @return {string}\r\n             */\r\n            getCurrentMapEngineId: function () {\r\n              return this.getConfigParameter('currentMapEngineId');\r\n            },\r\n            /**\r\n             * @description Gets the previousMapEngineId.\r\n             * @return {string}\r\n             */\r\n            getPreviousMapEngineId: function () {\r\n              return this.getConfigParameter('previousMapEngineId');\r\n            }\r\n        };\r\n\r\n        return publicInterface;\r\n    }());\r\n}","var emp = window.emp || {};\r\n/**\r\n * @namespace constant\r\n * @memberof emp\r\n */\r\nemp.constant = emp.constant || {};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n */\r\nemp.constant.parentIds = {\r\n  ALL_PARENTS: 'ALL_PARENTS',\r\n  MAP_ROOT: 'MAP_ROOT',\r\n  MAP_LAYER_PARENT: 'MAP_LAYER_PARENT'\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n */\r\nemp.constant.mapEngineId = {\r\n  LEAFLET: 'leafletMapEngine',\r\n  CESIUM: 'cesiumMapEngine',\r\n  WORLD_WIND: 'worldWindMapEngine'\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid values for the feature format field.\r\n */\r\nemp.constant.featureFormatType = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is a KML. Therefore the data\r\n   * field contains an unescaped KML string.\r\n   */\r\n  KML: \"kml\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is a GEOJSON. Therefore the data\r\n   * field contains an unescaped GEOJSON object.\r\n   */\r\n  GEOJSON: \"geojson\",\r\n  WKT: \"wkt\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature describes a WMS service.\r\n   */\r\n  WMS: \"wms\",\r\n  WFS: \"wfs\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is an image. Therefore the url\r\n   * field contains an unescaped URL to the image which the implementation must display at the location\r\n   * indicated in the bounding box provided in the params field.\r\n   */\r\n  IMAGE: \"image\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is a MilStd 2525 symbol. Therefore the data.symbolCode\r\n   * field contains the actual symbolCode, the properties contains a structure with the\r\n   * symbol modifiers as well as the 2525 version.\r\n   */\r\n  MILSTD: \"milstd\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is an airspace. Therefore the data.symbolCode\r\n   * field contains the type of airspace.\r\n   */\r\n  AIRSPACE: \"airspace\",\r\n\r\n  /**\r\n   * An air control measure.\r\n   */\r\n  GEO_ACM: 'airspace',\r\n  /**\r\n   * A Circle\r\n   */\r\n  GEO_CIRCLE: 'circle',\r\n  /**\r\n   * An ellipse\r\n   */\r\n  GEO_ELLIPSE: 'ellipse',\r\n  /**\r\n   * A MIL-STD-2525 symbol.\r\n   */\r\n  GEO_MIL_SYMBOL: 'milstd',\r\n  /**\r\n   * A path\r\n   */\r\n  GEO_PATH: 'path',\r\n  /**\r\n   * A point\r\n   */\r\n  GEO_POINT: 'point',\r\n  /**\r\n   * Polygon\r\n   */\r\n  GEO_POLYGON: 'polygon',\r\n  /**\r\n   * A rectangle\r\n   */\r\n  GEO_RECTANGLE: 'rectangle',\r\n  /**\r\n   * A square\r\n   */\r\n  GEO_SQUARE: 'square',\r\n  /**\r\n   * Free text on the map.\r\n   */\r\n  GEO_TEXT: 'text'\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid values for milstd version properties field.\r\n */\r\nemp.constant.featureMilStdVersionType = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is to be rendered as MilStd 2525B symbol.\r\n   */\r\n  MILSTD_2525B: \"2525B\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is to be rendered as MilStd 2525C symbol.\r\n   */\r\n  MILSTD_2525C: \"2525C\",\r\n  /**\r\n   *\r\n   * @method\r\n   * @description This function converts a string version to the numeric constant\r\n   * used by the sec render.\r\n   * @param {String} sVersion A string indicating the MilStd 2525 version\r\n   */\r\n  convertToNumeric: function (sVersion) {\r\n    var iVersion = 0;\r\n\r\n    if (emp.helpers.isEmptyString(sVersion)) {\r\n      iVersion = 0;\r\n    }\r\n    else if (sVersion.toUpperCase() === emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C) {\r\n      iVersion = 1;\r\n    }\r\n\r\n    return iVersion;\r\n  }\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid values for a features altitude mode.\r\n */\r\nemp.constant.featureAltitudeModeType = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature is to be at ground level.\r\n   */\r\n  CLAMP_TO_GROUND: \"clampToGround\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature altitudes are relative to the ground at its location.\r\n   */\r\n  RELATIVE_TO_GROUND: \"relativeToGround\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the feature are relative to MSL.\r\n   */\r\n  ABSOLUTE: \"absolute\"\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid values for a orbit turn attribute.\r\n */\r\nemp.constant.orbitTurnType = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the orbit is centered on the end points.\r\n   */\r\n  CENTER: \"center\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the orbit turns to the right of the end points.\r\n   */\r\n  RIGHT: \"right\",\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates that the orbit turns to the left of the end points.\r\n   */\r\n  LEFT: \"left\"\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates primitives\r\n */\r\nemp.constant.primitives = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Circle primitive\r\n   */\r\n  BBS_CIRCLE: 'BBS_CIRCLE',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates an Ellipse primitive\r\n   */\r\n  BBS_ELLIPSE: 'BBS_ELLIPSE',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Path primitive\r\n   */\r\n  BBS_PATH: 'BBS_PATH',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Point primitive\r\n   */\r\n  BBS_POINT: 'BBS_POINT',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Polygon primitive\r\n   */\r\n  BBS_POLYGON: 'BBS_POLYGON',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Rectangle primitive\r\n   */\r\n  BBS_RECTANGLE: 'BBS_RECTANGLE',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Square primitive\r\n   */\r\n  BBS_SQUARE: 'BBS_SQUARE',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a Text primitive\r\n   */\r\n  BBS_TEXT: 'BBS_TEXT'\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid airspace symbol codes.\r\n */\r\nemp.constant.airspaceSymbolCode = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a cake airspace.\r\n   */\r\n  SHAPE3D_CAKE: 'CAKE-----------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a route airspace.\r\n   */\r\n  SHAPE3D_ROUTE: 'ROUTE----------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a cylinder airspace.\r\n   */\r\n  SHAPE3D_CYLINDER: 'CYLINDER-------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a orbit airspace.\r\n   */\r\n  SHAPE3D_ORBIT: 'ORBIT----------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a polygon airspace.\r\n   */\r\n  SHAPE3D_POLYGON: 'POLYGON--------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a rad arc airspace.\r\n   */\r\n  SHAPE3D_RADARC: 'RADARC---------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a poly arc airspace.\r\n   */\r\n  SHAPE3D_POLYARC: 'POLYARC--------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a track airspace.\r\n   */\r\n  SHAPE3D_TRACK: 'TRACK----------',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a curtain airspace.\r\n   */\r\n  SHAPE3D_CURTAIN: 'CURTAIN--------'\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid AOI types.\r\n */\r\nemp.constant.AOIType = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a point with a radius of interest.\r\n   */\r\n  POINT_RADIUS: 'point-radius',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a line with a width of interest.\r\n   */\r\n  LINE: 'line',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates an area with an extended distance of interest.\r\n   */\r\n  POLYGON: 'polygon',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a bounding box of interest.\r\n   */\r\n  BBOX: 'bbox'\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid Outline styles.\r\n */\r\nemp.constant.OutlineStyleType = {\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a dotted line.\r\n   */\r\n  DOT: 'dot',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a dash line.\r\n   */\r\n  DASH: 'dash',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a line of dashes with dots between them.\r\n   */\r\n  DASH_DOT: 'dashdot',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a line of long dashes.\r\n   */\r\n  LONG_DASH: 'longdash',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a line of long dashes with dots between them.\r\n   */\r\n  LONG_DASH_DOT: 'longdashdot',\r\n  /**\r\n   * @constant\r\n   * @type string\r\n   * @description This value indicates a solid line, and is the default.\r\n   */\r\n  SOLID: 'solid'\r\n};\r\n","(function() {\r\n    var attachEvent = document.attachEvent;\r\n    var isIE = navigator.userAgent.match(/Trident/);\r\n    //console.log(isIE);\r\n    var requestFrame = (function(){\r\n        var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame ||\r\n            function(fn){ return window.setTimeout(fn, 20); };\r\n        return function(fn){ return raf(fn); };\r\n    })();\r\n\r\n    var cancelFrame = (function(){\r\n        var cancel = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame ||\r\n               window.clearTimeout;\r\n        return function(id){ return cancel(id); };\r\n    })();\r\n\r\n    function resizeListener(e){\r\n        var win = e.target || e.srcElement;\r\n        if (win.__resizeRAF__) {\r\n            cancelFrame(win.__resizeRAF__);\r\n        }\r\n        win.__resizeRAF__ = requestFrame(function(){\r\n            var trigger = win.__resizeTrigger__;\r\n            trigger.__resizeListeners__.forEach(function(fn){\r\n                fn.call(trigger, e);\r\n            });\r\n        });\r\n    }\r\n\r\n    function objectLoad(){\r\n        this.contentDocument.defaultView.__resizeTrigger__ = this.__resizeElement__;\r\n        this.contentDocument.defaultView.addEventListener('resize', resizeListener);\r\n    }\r\n\r\n    window.addResizeListener = function(element, fn){\r\n        if (!element.__resizeListeners__) {\r\n            element.__resizeListeners__ = [];\r\n            if (attachEvent) {\r\n                element.__resizeTrigger__ = element;\r\n                element.attachEvent('onresize', resizeListener);\r\n            }\r\n            else {\r\n                if (getComputedStyle(element).position == 'static') {\r\n                    element.style.position = 'relative';\r\n                }\r\n                var obj = element.__resizeTrigger__ = document.createElement('object');\r\n                obj.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;');\r\n                obj.__resizeElement__ = element;\r\n                obj.onload = objectLoad;\r\n                obj.type = 'text/html';\r\n                if (isIE) {\r\n                    element.appendChild(obj);\r\n                }\r\n                obj.data = 'about:blank';\r\n                if (!isIE) {\r\n                    element.appendChild(obj);\r\n                }\r\n            }\r\n        }\r\n        element.__resizeListeners__.push(fn);\r\n    };\r\n\r\n    window.removeResizeListener = function(element, fn){\r\n        element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn), 1);\r\n        if (!element.__resizeListeners__.length) {\r\n            if (attachEvent) {\r\n                element.detachEvent('onresize', resizeListener);\r\n            } else {\r\n                element.__resizeTrigger__.contentDocument.defaultView.removeEventListener('resize', resizeListener);\r\n                element.__resizeTrigger__ = !element.removeChild(element.__resizeTrigger__);\r\n            }\r\n        }\r\n    };\r\n})();\r\n","/**\r\n * @namespace classLibrary\r\n * @memberof emp\r\n */\r\nemp.classLibrary = emp.classLibrary || {};\r\n\r\n/**\r\n * emp.Util contains various utility functions used throughout the code.\r\n * @namespace Util\r\n * @memberof emp.classLibrary\r\n */\r\nemp.classLibrary.Util = {\r\n  /**\r\n   *\r\n   * @param dest\r\n   * @returns {*}\r\n   */\r\n  extend: function(dest) { // (Object[, Object, ...]) ->\r\n    var sources = Array.prototype.slice.call(arguments, 1),\r\n      i, j, len, src;\r\n\r\n    for (j = 0, len = sources.length; j < len; j++) {\r\n      src = sources[j] || {};\r\n      for (i in src) {\r\n        if (src.hasOwnProperty(i)) {\r\n          dest[i] = src[i];\r\n        }\r\n      }\r\n    }\r\n    return dest;\r\n  },\r\n  /**\r\n   *\r\n   * @param fn\r\n   * @param obj\r\n   * @returns {Function}\r\n   */\r\n  bind: function(fn, obj) { // (Function, Object) -> Function\r\n    var args = arguments.length > 2 ? Array.prototype.slice.call(arguments, 2) : null;\r\n    return function() {\r\n      return fn.apply(obj, args || arguments);\r\n    };\r\n  },\r\n  /**\r\n   *\r\n   * @param obj\r\n   * @param method\r\n   * @param context\r\n   * @returns {boolean}\r\n   */\r\n  invokeEach: function(obj, method, context) {\r\n    var i, args;\r\n\r\n    if (typeof obj === 'object') {\r\n      args = Array.prototype.slice.call(arguments, 3);\r\n\r\n      for (i in obj) {\r\n        method.apply(context, [i, obj[i]].concat(args));\r\n      }\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  },\r\n  /**\r\n   *\r\n   * @param fn\r\n   * @param time\r\n   * @param context\r\n   * @returns {wrapperFn}\r\n   */\r\n  limitExecByInterval: function(fn, time, context) {\r\n    var lock, execOnUnlock;\r\n\r\n    return function wrapperFn() {\r\n      var args = arguments;\r\n\r\n      if (lock) {\r\n        execOnUnlock = true;\r\n        return;\r\n      }\r\n\r\n      lock = true;\r\n\r\n      setTimeout(function() {\r\n        lock = false;\r\n\r\n        if (execOnUnlock) {\r\n          wrapperFn.apply(context, args);\r\n          execOnUnlock = false;\r\n        }\r\n      }, time);\r\n\r\n      fn.apply(context, args);\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Returns false\r\n   * @returns {boolean}\r\n   */\r\n  falseFn: function() {\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param num\r\n   * @param digits\r\n   * @returns {number}\r\n   */\r\n  formatNum: function(num, digits) {\r\n    var pow = Math.pow(10, digits || 5);\r\n    return Math.round(num * pow) / pow;\r\n  },\r\n  /**\r\n   *\r\n   * @param str\r\n   * @returns {*}\r\n   */\r\n  trim: function(str) {\r\n    return str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n  },\r\n  /**\r\n   *\r\n   * @param str\r\n   */\r\n  splitWords: function(str) {\r\n    return emp.classLibrary.Util.trim(str).split(/\\s+/);\r\n  },\r\n  /**\r\n   *\r\n   * @param obj\r\n   * @param options\r\n   * @returns {*}\r\n   */\r\n  setOptions: function(obj, options) {\r\n    obj.options = emp.classLibrary.Util.extend({}, obj.options, options);\r\n    return obj.options;\r\n  },\r\n  /**\r\n   *\r\n   * @param obj\r\n   * @param existingUrl\r\n   * @param uppercase\r\n   * @returns {string}\r\n   */\r\n  getParamString: function(obj, existingUrl, uppercase) {\r\n    var params = [];\r\n    for (var i in obj) {\r\n      params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n    }\r\n    return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n  },\r\n  /**\r\n   *\r\n   * @param str\r\n   * @param data\r\n   */\r\n  template: function(str, data) {\r\n    return str.replace(/\\{ *([\\w_]+) *\\}/g, function(str, key) {\r\n      var value = data[key];\r\n      if (value === undefined) {\r\n        throw new Error('No value provided for variable ' + str);\r\n      } else if (typeof value === 'function') {\r\n        value = value(data);\r\n      }\r\n      return value;\r\n    });\r\n  },\r\n  /**\r\n   *\r\n   */\r\n  isArray: Array.isArray || function(obj) {\r\n    return (Object.prototype.toString.call(obj) === '[object Array]');\r\n  }\r\n};\r\n\r\n/*\r\n * emp.Class powers the OOP facilities of the library.\r\n * Thanks to John Resig and Dean Edwards for inspiration!\r\n */\r\n\r\nemp.classLibrary.Class = function() { };\r\n\r\nemp.classLibrary.Class.extend = function(props) {\r\n\r\n  // extended class with the new prototype\r\n  var NewClass = function() {\r\n\r\n    // call the constructor\r\n    if (this.initialize) {\r\n      this.initialize.apply(this, arguments);\r\n    }\r\n\r\n    // call all constructor hooks\r\n    if (this._initHooks) {\r\n      this.callInitHooks();\r\n    }\r\n  };\r\n\r\n  // instantiate class without calling constructor\r\n  var F = function() { };\r\n  F.prototype = this.prototype;\r\n\r\n  var proto = new F();\r\n  proto.constructor = NewClass;\r\n\r\n  NewClass.prototype = proto;\r\n\r\n  //inherit parent's statics\r\n  for (var i in this) {\r\n    if (this.hasOwnProperty(i) && i !== 'prototype') {\r\n      NewClass[i] = this[i];\r\n    }\r\n  }\r\n\r\n  // mix static properties into the class\r\n  if (props.statics) {\r\n    emp.classLibrary.Util.extend(NewClass, props.statics);\r\n    delete props.statics;\r\n  }\r\n\r\n  // mix includes into the prototype\r\n  if (props.includes) {\r\n    emp.classLibrary.Util.extend.apply(null, [proto].concat(props.includes));\r\n    delete props.includes;\r\n  }\r\n\r\n  // merge options\r\n  if (props.options && proto.options) {\r\n    props.options = emp.classLibrary.Util.extend({}, proto.options, props.options);\r\n  }\r\n\r\n  // mix given properties into the prototype\r\n  emp.classLibrary.Util.extend(proto, props);\r\n\r\n  proto._initHooks = [];\r\n\r\n  var parent = this;\r\n  // jshint camelcase: false\r\n  NewClass.__super__ = parent.prototype;\r\n\r\n  // add method for calling all hooks\r\n  proto.callInitHooks = function() {\r\n\r\n    if (this._initHooksCalled) {\r\n      return;\r\n    }\r\n\r\n    if (parent.prototype.callInitHooks) {\r\n      parent.prototype.callInitHooks.call(this);\r\n    }\r\n\r\n    this._initHooksCalled = true;\r\n\r\n    for (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n      proto._initHooks[i].call(this);\r\n    }\r\n  };\r\n\r\n  return NewClass;\r\n};\r\n\r\n\r\n// method for adding properties to prototype\r\nemp.classLibrary.Class.include = function(props) {\r\n  emp.classLibrary.Util.extend(this.prototype, props);\r\n};\r\n\r\n// merge new default options to the Class\r\nemp.classLibrary.Class.mergeOptions = function(options) {\r\n  emp.classLibrary.Util.extend(this.prototype.options, options);\r\n};\r\n\r\n// add a constructor hook\r\nemp.classLibrary.Class.addInitHook = function(fn) { // (Function) || (String, args...)\r\n  var args = Array.prototype.slice.call(arguments, 1);\r\n\r\n  var init = typeof fn === 'function' ? fn : function() {\r\n    this[fn].apply(this, args);\r\n  };\r\n\r\n  this.prototype._initHooks = this.prototype._initHooks || [];\r\n  this.prototype._initHooks.push(init);\r\n};\r\n","\r\n/* global NaN, LatLon */\r\n\r\nemp.classLibrary.privateClass = function() {\r\n    var publicInterface = {\r\n        initialize: function (lat, lon, alt) {\r\n            var latitude;\r\n            var longitude;\r\n            var altitude;\r\n            var oLatLon;\r\n            var oOptions;\r\n            \r\n            if (lat instanceof LatLon) {\r\n                latitude = lat._lat;\r\n                longitude = lat._lon;\r\n            } else {\r\n                if ((typeof (lat) === 'number') && !isNaN(lat)) {\r\n                    latitude = lat;\r\n                } else if (!emp.util.isEmptyString(lat)) {\r\n                    latitude = parseFloat(lat);\r\n                } else {\r\n                    throw new Error('Invalid Latitude value: (' + lat + ')');\r\n                }\r\n\r\n                if ((typeof (lon) === 'number') && !isNaN(lon)) {\r\n                    longitude = lon;\r\n                } else if (!emp.util.isEmptyString(lon)) {\r\n                    longitude = parseFloat(lon);\r\n                } else {\r\n                    throw new Error('Invalid Longitude value: (' + lon + ')');\r\n                }\r\n            }\r\n            \r\n            oLatLon = new LatLon(latitude, longitude);\r\n\r\n            if ((typeof (alt) === 'number') && !isNaN(alt)) {\r\n                altitude = alt;\r\n            } else if (!emp.util.isEmptyString(alt)) {\r\n                altitude = parseFloat(alt);\r\n            }\r\n            \r\n            oOptions = {\r\n                oLatLon: oLatLon,\r\n                altitude: altitude\r\n            };\r\n            emp.classLibrary.Util.setOptions(this, oOptions);\r\n        },\r\n        /**\r\n         * @description This function return the latitude of the coordinate.\r\n         */\r\n        getLatitude: function() {\r\n            return this.options.oLatLon._lat;\r\n        },\r\n        /**\r\n         * @description This function return the longitude of the coordinate.\r\n         */\r\n        getLongitude: function() {\r\n            return this.options.oLatLon._lon;\r\n        },\r\n        /**\r\n         * @description This function return the altitude of the coordinate.\r\n         */\r\n        getAltitude: function() {\r\n            return this.options.altitude;\r\n        },\r\n        /**\r\n         * @description This function return the LatLon coordinate.\r\n         */\r\n        getLatLon: function() {\r\n            return this.options.oLatLon;\r\n        },\r\n        /**\r\n         * Returns the distance from this point to the supplied point, in km\r\n         * (using Haversine formula)\r\n         *\r\n         * from: Haversine formula - R. W. Sinnott, \"Virtues of the Haversine\",\r\n         *       Sky and Telescope, vol 68, no 2, 1984\r\n         *\r\n         * @param   {LatLon | emp.classLibrary.Coordinate} point Latitude/longitude of destination point\r\n         * @param   {Number} [precision=4] no of significant digits to use for returned value\r\n         * @returns {Number} Distance in km between this point and destination point\r\n         */\r\n        distanceTo: function (point, precision) {\r\n            if (point instanceof emp.classLibrary.Coordinate) {\r\n                return this.options.oLatLon.distanceTo(point.getLatLon(), precision);\r\n            }\r\n            return this.options.oLatLon.distanceTo(point, precision);\r\n        },\r\n        /**\r\n         * Returns the (initial) bearing from this point to the supplied point, in degrees\r\n         *   see http://williams.best.vwh.net/avform.htm#Crs\r\n         *\r\n         * @param {LatLon | emp.classLibrary.Coordinate} point Latitude/longitude of destination point\r\n         * @returns {Number} Initial bearing in degrees from North\r\n         */\r\n        bearingTo: function (point) {\r\n            if (point instanceof emp.classLibrary.Coordinate) {\r\n                return this.options.oLatLon.bearingTo(point.getLatLon());\r\n            }\r\n            return this.options.oLatLon.bearingTo(point);\r\n        },\r\n        /**\r\n         * Returns final bearing arriving at supplied destination point from this point; the final bearing\r\n         * will differ from the initial bearing by varying degrees according to distance and latitude\r\n         *\r\n         * @param {LatLon | emp.classLibrary.Coordinate} point Latitude/longitude of destination point\r\n         * @returns {Number} Final bearing in degrees from North\r\n         */\r\n        finalBearingTo: function (point) {\r\n            if (point instanceof emp.classLibrary.Coordinate) {\r\n                return this.options.oLatLon.finalBearingTo(point.getLatLon());\r\n            }\r\n            return this.options.oLatLon.finalBearingTo(point);\r\n        },\r\n        /**\r\n         * Returns the midpoint between this point and the supplied point.\r\n         *   see http://mathforum.org/library/drmath/view/51822.html for derivation\r\n         *\r\n         * @param   {LatLon | emp.classLibrary.Coordinate} point Latitude/longitude of destination point\r\n         * @returns {emp.classLibrary.Coordinate} Midpoint between this point and the supplied point\r\n         */\r\n        midpointTo: function (point) {\r\n            var latLon;\r\n            \r\n            if (point instanceof emp.classLibrary.Coordinate) {\r\n                latLon = this.options.oLatLon.finalBearingTo(point.getLatLon());\r\n            } else {\r\n                latLon = this.options.oLatLon.finalBearingTo(point);\r\n            }\r\n            return new emp.classLibrary.Coordinate(latLon._lat, latLon._lon);\r\n        },\r\n        /**\r\n         * Returns the destination point from this point having travelled the given distance (in km) on the\r\n         * given initial bearing (bearing may vary before destination is reached)\r\n         *\r\n         *   see http://williams.best.vwh.net/avform.htm#LL\r\n         *\r\n         * @param   {Number} brng Initial bearing in degrees\r\n         * @param   {Number} dist Distance in km\r\n         * @returns {emp.classLibrary.Coordinate} Destination point\r\n         */\r\n        destinationPoint: function (brng, dist) {\r\n            var latLon = this.options.oLatLon.destinationPoint(brng, dist);\r\n            return new emp.classLibrary.Coordinate(latLon._lat, latLon._lon);\r\n        },\r\n        /**\r\n         * Returns the distance from this point to the supplied point, in km, travelling along a rhumb line\r\n         *\r\n         *   see http://williams.best.vwh.net/avform.htm#Rhumb\r\n         *\r\n         * @param   {LatLon | emp.classLibrary.Coordinate} point Latitude/longitude of destination point\r\n         * @returns {Number} Distance in km between this point and destination point\r\n         */\r\n        rhumbDistanceTo: function (point) {\r\n            if (point instanceof emp.classLibrary.Coordinate) {\r\n                return this.options.oLatLon.rhumbDistanceTo(point.getLatLon());\r\n            }\r\n            return this.options.oLatLon.rhumbDistanceTo(point);\r\n        },\r\n        /**\r\n         * Returns the bearing from this point to the supplied point along a rhumb line, in degrees\r\n         *\r\n         * @param   {LatLon | emp.classLibrary.Coordinate} point Latitude/longitude of destination point\r\n         * @returns {Number} Bearing in degrees from North\r\n         */\r\n        rhumbBearingTo: function (point) {\r\n            if (point instanceof emp.classLibrary.Coordinate) {\r\n                return this.options.oLatLon.rhumbBearingTo(point.getLatLon());\r\n            }\r\n            return this.options.oLatLon.rhumbBearingTo(point);\r\n        },\r\n        /**\r\n         * Returns the destination point from this point having travelled the given distance (in km) on the\r\n         * given bearing along a rhumb line\r\n         *\r\n         * @param   {Number} brng Bearing in degrees from North\r\n         * @param   {Number} dist Distance in km\r\n         * @returns {emp.classLibrary.Coordinate} Destination point\r\n         */\r\n        rhumbDestinationPoint: function (brng, dist) {\r\n            var latLon = this.options.oLatLon.rhumbDestinationPoint(brng, dist);\r\n            return new emp.classLibrary.Coordinate(latLon._lat, latLon._lon);\r\n        },\r\n        toString: function() {\r\n            var sStr = \"\";\r\n            \r\n            if (isNaN(this.options.oLatLon._lat)) {\r\n                sStr += \"-\";\r\n            } else {\r\n                sStr += this.options.oLatLon._lat;\r\n            }\r\n            sStr += \",\";\r\n\r\n            if (isNaN(this.options.oLatLon._lon)) {\r\n                sStr += \"-\";\r\n            } else {\r\n                sStr += this.options.oLatLon._lon;\r\n            }\r\n\r\n            if (!isNaN(this.options.altitude)) {\r\n                sStr += \",\" + this.options.altitude;\r\n            }\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\nemp.classLibrary.Coordinate = emp.classLibrary.Class.extend(emp.classLibrary.privateClass());\r\n","\r\n/* global LatLon */\r\n\r\nemp.classLibrary.privateClass = function() {\r\n    var publicInterface = {\r\n        initialize: function (oSW, oNE) {\r\n            var oSouthWest;\r\n            var oNorthEast;\r\n            var options;\r\n            var oLatLngList;\r\n\r\n            options = {\r\n                degNorth: undefined,\r\n                degSouth: undefined,\r\n                degWest: undefined,\r\n                degEast: undefined\r\n            };\r\n            emp.classLibrary.Util.setOptions(this, options);\r\n\r\n            if (oSW === undefined) {\r\n                oLatLngList = [];\r\n            } else if (oNE === undefined) {\r\n                if (oSW instanceof emp.classLibrary.MapExtent)\r\n                {\r\n                    oSouthWest = oSW.getSouthWest();\r\n                    oNorthEast = oSW.getNorthEast();\r\n\r\n                    if (oSouthWest && oNorthEast)\r\n                    {\r\n                        oLatLngList = [oSouthWest, oNorthEast];\r\n                    }\r\n                    else\r\n                    {\r\n                        oLatLngList = [];\r\n                    }\r\n                } else if (oSW instanceof Array) {\r\n                    oLatLngList = oSW;\r\n                } else if (oSW instanceof LatLon) {\r\n                    oLatLngList = [oSW];\r\n                } else {\r\n                    throw new Error(\"Invalid type oSouthWest.\");\r\n                }\r\n            } else {\r\n                oLatLngList = [oSW, oNE];\r\n            }\r\n\r\n            for (var iIndex = 0; iIndex < oLatLngList.length; iIndex++) {\r\n                this.addCoordinate(oLatLngList[iIndex]);\r\n            }\r\n        },\r\n        destroy: function() {\r\n        },\r\n        addCoordinate: function(oCoord) {\r\n            var degSE2Coord;\r\n            var degSW2Coord;\r\n            var oCoordinate = oCoord; //.wrap();\r\n\r\n            if (oCoord instanceof emp.classLibrary.Coordinate) {\r\n                oCoordinate = oCoord.getLatLon();\r\n            }\r\n\r\n            if (this.options.degNorth === undefined)\r\n            {\r\n                this.options.degNorth = oCoordinate._lat;\r\n                this.options.degSouth = oCoordinate._lat;\r\n                this.options.degWest = oCoordinate._lon;\r\n                this.options.degEast = oCoordinate._lon;\r\n            }\r\n            else\r\n            {\r\n                if (oCoordinate._lat > this.options.degNorth)\r\n                {\r\n                    this.options.degNorth = oCoordinate._lat;\r\n                }\r\n                else if (oCoordinate._lat < this.options.degSouth)\r\n                {\r\n                    this.options.degSouth = oCoordinate._lat;\r\n                }\r\n\r\n                degSE2Coord = emp.geoLibrary.GetAzimuth({x: this.options.degEast, y: this.options.degSouth}, {x: oCoordinate._lon, y: oCoordinate._lat});\r\n\r\n                if (degSE2Coord > 0.0)\r\n                {\r\n                    // The Longitude is east of the east edge.\r\n                    this.options.degEast = oCoordinate._lon;\r\n                }\r\n                else\r\n                {\r\n                    degSW2Coord = emp.geoLibrary.GetAzimuth({x: this.options.degWest, y: this.options.degSouth}, {x: oCoordinate._lon, y: oCoordinate._lat});\r\n\r\n                    if (degSW2Coord < 0.0)\r\n                    {\r\n                        // The Longitude is to the west of the west edge.\r\n                        this.options.degWest = oCoordinate._lon;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        getNorth: function() {\r\n            return this.options.degNorth;\r\n        },\r\n        getSouth: function() {\r\n            return this.options.degSouth;\r\n        },\r\n        getWest: function() {\r\n            return this.options.degWest;\r\n        },\r\n        getEast: function() {\r\n            return this.options.degEast;\r\n        },\r\n        getCenter: function() {\r\n            var oSW = new LatLon(this.options.degSouth, this.options.degWest);\r\n            var oNE = new LatLon(this.options.degNorth, this.options.degEast);\r\n            var oCenter = oSW.midpointTo(oNE);\r\n\r\n            return new LatLon(oCenter._lat, oCenter._lon);\r\n        },\r\n        getCenterWest: function() {\r\n            var dCenterLat = (this.options.degNorth + this.options.degSouth) / 2.0;\r\n            return new LatLon(dCenterLat, this.options.degWest);\r\n        },\r\n        getCenterEast: function() {\r\n            var dCenterLat = (this.options.degNorth + this.options.degSouth) / 2.0;\r\n            return new LatLon(dCenterLat, this.options.degEast);\r\n        },\r\n        getSouthWest: function() {\r\n            return new LatLon(this.options.degSouth, this.options.degWest);\r\n        },\r\n        getNorthEast: function() {\r\n            return new LatLon(this.options.degNorth, this.options.degEast);\r\n        },\r\n        getSouthEast: function() {\r\n            return new LatLon(this.options.degSouth, this.options.degEast);\r\n        },\r\n        getNorthWest: function() {\r\n            return new LatLon(this.options.degNorth, this.options.degWest);\r\n        },\r\n        containsCoordiante: function(oCoordinate) {\r\n            var degSE2Coord;\r\n            var degSW2Coord;\r\n\r\n            if (!this.options.degNorth)\r\n            {\r\n                return false;\r\n            }\r\n            else\r\n            {\r\n                if (oCoordinate._lat > this.options.degNorth)\r\n                {\r\n                    return false;\r\n                }\r\n                else if (oCoordinate._lat < this.options.degSouth)\r\n                {\r\n                    return false;\r\n                }\r\n\r\n                degSE2Coord = emp.geoLibrary.GetAzimuth({x: this.options.degEast, y: this.options.degSouth}, {x: oCoordinate._lon, y: oCoordinate._lat});\r\n\r\n                if (degSE2Coord > 0.0)\r\n                {\r\n                    // The Longitude is east of the east edge.\r\n                    return false;\r\n                }\r\n                else\r\n                {\r\n                    degSW2Coord = emp.geoLibrary.GetAzimuth({x: this.options.degWest, y: this.options.degSouth}, {x: oCoordinate._lon, y: oCoordinate._lat});\r\n\r\n                    if (degSW2Coord < 0.0)\r\n                    {\r\n                        // The Longitude is to the west of the west edge.\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n        contained: function(oMapExtent) {\r\n            var degSE2Coord;\r\n            var degSW2Coord;\r\n\r\n            if (!this.options.degNorth || !oMapExtent.getNorth())\r\n            {\r\n                return false;\r\n            }\r\n            else\r\n            {\r\n                if (oMapExtent.getNorth() > this.options.degNorth)\r\n                {\r\n                    return false;\r\n                }\r\n                else if (oMapExtent.getSouth() < this.degSouth)\r\n                {\r\n                    return false;\r\n                }\r\n\r\n                degSE2Coord = emp.geoLibrary.GetAzimuth({x: this.options.degEast, y: this.options.degSouth}, {x: oMapExtent.getEast(), y: oMapExtent.getNorth()});\r\n\r\n                if (degSE2Coord > 0.0)\r\n                {\r\n                    // The Longitude is east of the east edge.\r\n                    return false;\r\n                }\r\n                else\r\n                {\r\n                    degSW2Coord = emp.geoLibrary.GetAzimuth({x: this.options.degWest, y: this.options.degSouth}, {x: oMapExtent.getWest(), y: oMapExtent.getNorth()});\r\n\r\n                    if (degSW2Coord < 0.0)\r\n                    {\r\n                        // The Longitude is to the west of the west edge.\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n        intersects: function(oMapExtent) {\r\n            var oSouthWest;\r\n            var oBNorthEast;\r\n            var dBrng;\r\n            var oSouthEast;\r\n            var oBNorthWest;\r\n\r\n            if (!(oMapExtent instanceof emp.classLibrary.MapExtent)) {\r\n                throw new Error(\"Invalid parameters type.\");\r\n            }\r\n\r\n            if (!this.options.degNorth || !oMapExtent.getNorth())\r\n            {\r\n                return false;\r\n            }\r\n            else\r\n            {\r\n                if ((oMapExtent.getNorth() < this.options.degSouth) &&\r\n                        (oMapExtent.getSouth() > this.options.degNorth))\r\n                {\r\n                    // The oBoundary is below or above this one.\r\n                    return false;\r\n                }\r\n                else\r\n                {\r\n                    oSouthWest = this.getSouthWest();\r\n                    oBNorthEast = oMapExtent.getNorthEast();\r\n                    dBrng = oSouthWest.bearingTo(oBNorthEast);\r\n\r\n                    if ((dBrng < 0.0) || (dBrng > 90.0))\r\n                    {\r\n                        return false;\r\n                    }\r\n\r\n                    oSouthEast = this.getSouthEast();\r\n                    oBNorthWest = oMapExtent.getNorthWest();\r\n\r\n                    dBrng = oSouthEast.bearingTo(oBNorthWest);\r\n\r\n                    if (dBrng < 270.0)\r\n                    {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n        isEmpty: function() {\r\n            return (this.options.degNorth === undefined ||\r\n              this.options.degSouth === undefined ||\r\n              this.options.degWest === undefined ||\r\n              this.options.degEast === undefined);\r\n        },\r\n        getCenterWidth: function() {\r\n            var oCenterWest = this.getCenterWest();\r\n            var oCenterEast = this.getCenterEast();\r\n            return oCenterWest.distanceTo(oCenterEast);\r\n        },\r\n        setCenterWidth: function(dWidth) {\r\n            var oCenter = this.getCenter();\r\n            var oNewWestCoord = oCenter.destinationPoint(270, dWidth / 2.0);\r\n            var oNewEastCoord = oCenter.destinationPoint(90, dWidth / 2.0);\r\n\r\n            this.degWest = oNewWestCoord._lon;\r\n            this.degEast = oNewEastCoord._lon;\r\n        },\r\n        reset: function() {\r\n            this.options.degNorth = undefined;\r\n            this.options.degSouth = undefined;\r\n            this.options.degWest = undefined;\r\n            this.options.degEast = undefined;\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nemp.classLibrary.MapExtent = emp.classLibrary.Class.extend(emp.classLibrary.privateClass());\r\n","\r\nemp = emp || {};\r\nemp.util = emp.util || {};\r\n\r\nemp.util.geoJson = (function(){\r\n    var publicInterface = {\r\n        /**\r\n         * @description This function converts the geojson coordinates to a string.\r\n         * @param {object} oGeoJson This parameter must be a geojson object.\r\n         * @returns {String}\r\n         */\r\n        toString: function(oGeoJson) {\r\n            var sStr = \"\",\r\n                iIndex;\r\n            if (!oGeoJson.hasOwnProperty('type')) {\r\n                throw new Error(\"GeoJSON object with no type property.\");\r\n            }\r\n            \r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    sStr = oGeoJson.coordinates[0] + \",\" + oGeoJson.coordinates[1];\r\n                        \r\n                    if (oGeoJson.coordinates.length === 3) {\r\n                        sStr += \",\" + oGeoJson.coordinates[2];\r\n                    }\r\n                    break;\r\n                case 'linestring':\r\n                    for (iIndex = 0; iIndex < oGeoJson.coordinates.length; iIndex++) {\r\n                        if (sStr.length > 0) {\r\n                            sStr += \" \";\r\n                        }\r\n                        sStr += oGeoJson.coordinates[iIndex][0] + \",\" + oGeoJson.coordinates[iIndex][1];\r\n                        \r\n                        if (oGeoJson.coordinates[iIndex].length === 3) {\r\n                            sStr += \",\" + oGeoJson.coordinates[iIndex][2];\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    // we get the coordinates of the outter polygon.\r\n                    for (iIndex = 0; iIndex < oGeoJson.coordinates[0].length; iIndex++) {\r\n                        if (sStr.length > 0) {\r\n                            sStr += \" \";\r\n                        }\r\n                        sStr += oGeoJson.coordinates[0][iIndex][0] + \",\" + oGeoJson.coordinates[0][iIndex][1];\r\n                        \r\n                        if (oGeoJson.coordinates[0][iIndex].length === 3) {\r\n                            sStr += \",\" + oGeoJson.coordinates[0][iIndex][2];\r\n                        }\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Error(\"Invalid type for coordinate parsing.\");\r\n            }\r\n            \r\n            return sStr;\r\n        },\r\n        /**\r\n         * @description This function converts a single geojson coordinate to an emp.classLibrary.Coordinate object.\r\n         * @param {object} oCoord This parameter must be a single geojson coordinate.\r\n         * @returns {emp.classLibrary.Coordinate}\r\n         */\r\n        toCoordinate: function(oCoord)\r\n        {\r\n            var oCoordinates;\r\n            \r\n            if (oCoord.length === 3) {\r\n                oCoordinates = new emp.classLibrary.Coordinate(oCoord[1], oCoord[0], oCoord[2]);\r\n            } else {\r\n                oCoordinates = new emp.classLibrary.Coordinate(oCoord[1], oCoord[0]);\r\n            }\r\n            \r\n            return oCoordinates;\r\n        },\r\n        /**\r\n         * @description This function convert a geojson coorinates to an array of emp.classLibrary.Coordinate.\r\n         * @param {object} oGeoJson This parameters must be a geojson object.\r\n         * @returns {Array<emp.classLibrary.Coordinate>}\r\n         */\r\n        toCoordinateArray: function(oGeoJson) {\r\n            var oCoordinates = [];\r\n            var oCoord;\r\n            var iIndex;\r\n\r\n            if (!oGeoJson.hasOwnProperty('type')) {\r\n                throw new Error(\"GeoJSON object with no type property.\");\r\n            }\r\n            \r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    if (oGeoJson.coordinates.length > 0) {\r\n                        oCoordinates.push(publicInterface.toCoordinate(oGeoJson.coordinates));\r\n                    }\r\n                    break;\r\n                case 'linestring':\r\n                    for (iIndex = 0; iIndex < oGeoJson.coordinates.length; iIndex++) {\r\n                        oCoord = publicInterface.toCoordinate(oGeoJson.coordinates[iIndex]);\r\n                        oCoordinates.push(oCoord);\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    // we get the coordinates of the outter polygon.\r\n                    for (iIndex = 0; iIndex < oGeoJson.coordinates[0].length; iIndex++) {\r\n                        oCoord = publicInterface.toCoordinate(oGeoJson.coordinates[0][iIndex]);\r\n                        oCoordinates.push(oCoord);\r\n                    }\r\n                    break;\r\n                case 'feature':\r\n                    switch (oGeoJson.geometry.type.toLowerCase()) {\r\n                        case 'point':\r\n                            if (oGeoJson.geometry.coordinates.length > 0) {\r\n                                oCoordinates.push(publicInterface.toCoordinate(oGeoJson.geometry.coordinates));\r\n                            }\r\n                            break;\r\n                        case 'linestring':\r\n                            for (iIndex = 0; iIndex < oGeoJson.geometry.coordinates.length; iIndex++) {\r\n                                oCoord = publicInterface.toCoordinate(oGeoJson.geometry.coordinates[iIndex]);\r\n                                oCoordinates.push(oCoord);\r\n                            }\r\n                            break;\r\n                        case 'polygon':\r\n                            // we get the coordinates of the outter polygon.\r\n                            for (iIndex = 0; iIndex < oGeoJson.geometry.coordinates[0].length; iIndex++) {\r\n                                oCoord = publicInterface.toCoordinate(oGeoJson.geometry.coordinates[0][iIndex]);\r\n                                oCoordinates.push(oCoord);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            throw new Error(\"Invalid type for coordinate parsing.\");\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Error(\"Invalid type for coordinate parsing.\");\r\n            }\r\n\r\n            return oCoordinates;\r\n        },\r\n        /**\r\n         * @description This function converts a single emp.classLibrary.Coordinate coordinate to a\r\n         * geojson coordinate object.\r\n         * @param {emp.classLibrary.Coordinate} oEmpCoordinate\r\n         * @returns {object} A geojson coordinate object.\r\n         */\r\n        convertCoordinateToGeoJson: function(oEmpCoordinate) {\r\n            var oGeoJsonCoord = [];\r\n            \r\n            oGeoJsonCoord.push(oEmpCoordinate.getLongitude());\r\n            oGeoJsonCoord.push(oEmpCoordinate.getLatitude());\r\n            \r\n            if (!isNaN(oEmpCoordinate.getAltitude())) {\r\n                oGeoJsonCoord.push(oEmpCoordinate.getAltitude());\r\n            }\r\n            \r\n            return oGeoJsonCoord;\r\n        },\r\n        /**\r\n         * @description This function coverts an array of emp.classLibrary.Coordinate objects into \r\n         * geojson coordinate object.\r\n         * @param {object} oGeoJson This parameter must be a geojson object.\r\n         * @param {Array<emp.classLibrary.Coordinate>} oEmpCoordinateArray An array of emp.classLibrary.Coordinate objects.\r\n         */\r\n        convertCoordinateArrayToGeoJson: function(oGeoJson, oEmpCoordinateArray) {\r\n            var iIndex;\r\n            \r\n            switch (oGeoJson.type.toLowerCase()) {\r\n                case 'point':\r\n                    oGeoJson.coordinates = publicInterface.convertCoordinateToGeoJson(oEmpCoordinateArray[0]);\r\n                    break;\r\n                case 'linestring':\r\n                    oGeoJson.coordinates = [];\r\n\r\n                    for (iIndex = 0; iIndex < oEmpCoordinateArray.length; iIndex++) {\r\n                        oGeoJson.coordinates.push(publicInterface.convertCoordinateToGeoJson(oEmpCoordinateArray[iIndex]));\r\n                    }\r\n                    break;\r\n                case 'polygon':\r\n                    oGeoJson.coordinates = [[]];\r\n\r\n                    for (iIndex = 0; iIndex < oEmpCoordinateArray.length; iIndex++) {\r\n                        oGeoJson.coordinates[0].push(publicInterface.convertCoordinateToGeoJson(oEmpCoordinateArray[iIndex]));\r\n                    }\r\n                    break;\r\n                case 'feature':\r\n                    publicInterface.convertCoordinateArrayToGeoJson(oGeoJson.geometry, oEmpCoordinateArray);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n}());\r\n","\r\nemp = emp || {};\r\nemp.util = emp.util || {};\r\n\r\n/**\r\n *\r\n */\r\nemp.util.kml = (function(){\r\n    var publicInterface = {\r\n        toCoordinateArray: function(sKML) {\r\n            var oaCoordList = [];\r\n            var oKmlDoc = emp.util.parseXML(sKML);\r\n            var bIsPolygon = false;\r\n            var aCoord;\r\n            var dLng;\r\n            var dLat;\r\n            var dAlt;\r\n            var iIndex;\r\n\r\n            var processCoordString = function(sCoordStr) {\r\n                var aStrCoordList;\r\n\r\n                if (!emp.util.isEmptyString(sCoordStr)) {\r\n                    aStrCoordList = sCoordStr.split(/\\s+/g);\r\n\r\n                    for (iIndex = 0; iIndex < aStrCoordList.length; iIndex++) {\r\n                        if (aStrCoordList[iIndex].length > 0) {\r\n                            aCoord = aStrCoordList[iIndex].split(',');\r\n                            if (aCoord.length > 1) {\r\n                                dLng = Number(aCoord[0]);\r\n                                dLat = Number(aCoord[1]);\r\n                                dAlt = undefined;\r\n                                if (aCoord.length > 2) {\r\n                                    dAlt = Number(aCoord[2]);\r\n                                }\r\n                                oaCoordList.push(new emp.classLibrary.Coordinate(dLat, dLng, dAlt));\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (bIsPolygon && (oaCoordList.length > 1)) {\r\n                        // we need to remove the last one if there is more than one.\r\n                        oaCoordList.splice(oaCoordList.length - 1, 1);\r\n                    }\r\n                }\r\n            };\r\n\r\n            emp.util.each(oKmlDoc.getElementsByTagName(\"Polygon\"), function() {\r\n                bIsPolygon = true;\r\n            });\r\n\r\n            emp.util.each(oKmlDoc.getElementsByTagName(\"coordinates\"), function(oDescElem) {\r\n                processCoordString(oDescElem.childNodes[0].nodeValue);\r\n            });\r\n\r\n            return oaCoordList;\r\n        },\r\n        toKMLfromCoordinateArray: function(sKML, oaCoordArray) {\r\n            var bIsPolygon = false;\r\n            var oKmlDoc = emp.util.parseXML(sKML);\r\n            var sCoordStr = \"\";\r\n\r\n            emp.util.each(oKmlDoc.getElementsByTagName(\"Polygon\"), function() {\r\n                bIsPolygon = true;\r\n            });\r\n\r\n            for (var iIndex = 0; iIndex < oaCoordArray.length; iIndex++) {\r\n                if (sCoordStr.length > 0) {\r\n                    sCoordStr += \" \";\r\n                }\r\n                sCoordStr += oaCoordArray[iIndex].getLongitude() + \",\";\r\n                sCoordStr += oaCoordArray[iIndex].getLatitude();\r\n                if (!isNaN(oaCoordArray[iIndex].getAltitude())) {\r\n                    sCoordStr += \",\" + oaCoordArray[iIndex].getAltitude();\r\n                }\r\n            }\r\n\r\n            if (bIsPolygon) {\r\n                // For polygon we need to repeat the first one last.\r\n                if (sCoordStr.length > 0) {\r\n                    sCoordStr += \" \";\r\n                }\r\n                sCoordStr += oaCoordArray[0].getLongitude() + \",\";\r\n                sCoordStr += oaCoordArray[0].getLatitude();\r\n                if (!isNaN(oaCoordArray[0].getAltitude())) {\r\n                    sCoordStr += \",\" + oaCoordArray[0].getAltitude();\r\n                }\r\n            }\r\n\r\n            var bDone = false;\r\n            emp.util.each(oKmlDoc.getElementsByTagName(\"coordinates\"), function(oDescElem) {\r\n                if (!bDone) {\r\n                    oDescElem.childNodes[0].nodeValue = sCoordStr;\r\n                    bDone = true;\r\n                }\r\n            });\r\n            function getXmlAsString(xmlDom){\r\n                return (typeof window.XMLSerializer !== \"undefined\") ? (new window.XMLSerializer()).serializeToString(xmlDom):\r\n                        xmlDom.xml;\r\n            }\r\n\r\n            return getXmlAsString(oKmlDoc);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n}());\r\n","/* global sec */\r\nvar emp = window.emp || {};\r\n\r\n/**\r\n *\r\n * EMP Helpers is a set of common functions used to facilitate action amongst the core.\r\n * @namespace emp.helpers\r\n */\r\nemp.helpers = {};\r\n\r\n/**\r\n *\r\n * @method\r\n * @description This function makes a copy of an object by stringifying and parsing it.\r\n */\r\nemp.helpers.copyObject = function (oFrom) {\r\n  if ((oFrom instanceof Array) || (typeof(oFrom) === 'object')) {\r\n    var sStr = JSON.stringify(oFrom);\r\n    return JSON.parse(sStr);\r\n  }\r\n\r\n  return oFrom;\r\n};\r\n\r\n/**\r\n * Simple helper to break up coreId's and reset them.\r\n * @type {Object}\r\n * @namespace  emp.helpers.id\r\n */\r\nemp.helpers.id = {};\r\n\r\n/**\r\n * Various methods used to extract or generate Id's\r\n * @namespace emp.helpers.id.get\r\n * @memberof  emp.helpers.id\r\n * @inner\r\n */\r\nemp.helpers.id.get = {}; // stub\r\n\r\n\r\n/**\r\n * This function is no longer used. It is deprecated.\r\n *\r\n * @param  {object} args\r\n * @public\r\n * @return {string|undefined}\r\n * @inner\r\n * @deprecated\r\n */\r\nemp.helpers.id.get.coreId = function (args) {\r\n\r\n  var sOverlayId = args.overlayId;\r\n  var sFeatureId = args.featureId || args.id;\r\n\r\n  var oStorageEntry = emp.storage.get.byIds({\r\n    overlayId: sOverlayId,\r\n    featureId: sFeatureId\r\n  });\r\n\r\n  if (oStorageEntry) {\r\n    return oStorageEntry.coreId;\r\n  }\r\n\r\n  return undefined;\r\n};\r\n\r\n/**\r\n * Returns coreParent of the item identified in args\r\n * @param  {object} args\r\n * @return {string}\r\n */\r\nemp.helpers.id.get.coreParent = function (args) {\r\n\r\n  if (args !== undefined && args !== null) {\r\n    if (args.coreId !== undefined && args.coreId !== null) {\r\n      var oStorageItem = emp.storage.get.id({\r\n        id: args.coreId\r\n      });\r\n\r\n      if (oStorageItem) {\r\n        return oStorageItem.coreParent;\r\n      }\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n};\r\n\r\n/**\r\n * Returns setId verifies the value to be an id or undefined.\r\n * @param  {string} sId\r\n * @return {undefined|string}\r\n */\r\nemp.helpers.id.get.setId = function (sId) {\r\n  if (sId === undefined) {\r\n    return;\r\n  } else if (sId === null) {\r\n    return;\r\n  } else if (sId === \"\") {\r\n    return;\r\n  }\r\n  return sId;\r\n};\r\n\r\n/**\r\n * Returns isId return true if it is an ID.\r\n * @param  {string} sId\r\n * @return {boolean}\r\n */\r\nemp.helpers.id.get.isId = function (sId) {\r\n  if (sId === undefined) {\r\n    return false;\r\n  } else if (sId === null) {\r\n    return false;\r\n  } else if (sId === \"\") {\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\n/**\r\n *\r\n * @returns {string}\r\n */\r\nemp.helpers.id.newGUID = function () {\r\n  //this needs to be checked against table of used ID's to avoid collisions\r\n  var lut = emp.helpers.id.newGUID.lut;\r\n  var d0 = Math.random() * 0xffffffff | 0;\r\n  var d1 = Math.random() * 0xffffffff | 0;\r\n  var d2 = Math.random() * 0xffffffff | 0;\r\n  var d3 = Math.random() * 0xffffffff | 0;\r\n\r\n  return lut[d0 & 0xff] + lut[d0 >> 8 & 0xff] + lut[d0 >> 16 & 0xff] + lut[d0 >> 24 & 0xff] + '-' +\r\n    lut[d1 & 0xff] + lut[d1 >> 8 & 0xff] + lut[d1 >> 16 & 0x0f | 0x40] + lut[d1 >> 24 & 0xff] + '-' +\r\n    lut[d2 & 0x3f | 0x80] + lut[d2 >> 8 & 0xff] + lut[d2 >> 16 & 0xff] + lut[d2 >> 24 & 0xff] + '-' +\r\n    lut[d3 & 0xff] + lut[d3 >> 8 & 0xff] + lut[d3 >> 16 & 0xff] + lut[d3 >> 24 & 0xff];\r\n};\r\n\r\n/**\r\n *\r\n */\r\nemp.helpers.id.newGUID.lut = function () {\r\n  var lut = [];\r\n  for (var i = 0; i < 256; i++) {\r\n    lut[i] = (i < 16 ? '0' : '') + (i).toString(16);\r\n  }\r\n  return lut;\r\n}();\r\n\r\n/**\r\n * @borrows emp.util.isAirspaceSymbol as emp.helpers.isAirspaceSymbol\r\n */\r\nemp.helpers.isAirspaceSymbol = emp.util.isAirspaceSymbol;\r\n\r\n/**\r\n *\r\n * @param oData\r\n * @returns {string}\r\n */\r\nemp.helpers.coordinatesToString = function (oData) {\r\n  var sCoord = \"\",\r\n    iIndex,\r\n    iPolygonIndex;\r\n\r\n\r\n  switch (oData.type) {\r\n    case \"Point\":\r\n      sCoord = oData.coordinates[0] + \",\" + oData.coordinates[1];\r\n\r\n      if (oData.coordinates.length > 2) {\r\n        sCoord += \",\" + oData.coordinates[2];\r\n      }\r\n      break;\r\n    case \"LineString\":\r\n      for (iIndex = 0; iIndex < oData.coordinates.length; iIndex++) {\r\n        if (sCoord.length > 0) {\r\n          sCoord += \" \";\r\n        }\r\n\r\n        sCoord += oData.coordinates[iIndex][0] + \",\" + oData.coordinates[iIndex][1];\r\n\r\n        if (oData.coordinates[iIndex].length > 2) {\r\n          sCoord += \",\" + oData.coordinates[iIndex][2];\r\n        }\r\n      }\r\n      break;\r\n    case \"Polygon\":\r\n      for (iPolygonIndex = 0; iPolygonIndex < oData.coordinates.length; iPolygonIndex++) { // TODO figure out this oddity\r\n        for (iIndex = 0; iIndex < oData.coordinates[iPolygonIndex].length; iIndex++) {\r\n          if (sCoord.length > 0) {\r\n            sCoord += \" \";\r\n          }\r\n\r\n          sCoord += oData.coordinates[iPolygonIndex][iIndex][0] + \",\" + oData.coordinates[iPolygonIndex][iIndex][1];\r\n\r\n          if (oData.coordinates[iPolygonIndex][iIndex].length > 2) {\r\n            sCoord += \",\" + oData.coordinates[iPolygonIndex][iIndex][2];\r\n          }\r\n        }\r\n        break; // Only do one.\r\n      }\r\n      break;\r\n  }\r\n\r\n  return sCoord;\r\n};\r\n\r\n/**\r\n *\r\n * @param oItem\r\n * @returns {boolean}\r\n */\r\nemp.helpers.isAOI = function (oItem) {\r\n  var bRet = false;\r\n  var oGeoJson = oItem.data;\r\n\r\n  if (oGeoJson.hasOwnProperty('type') &&\r\n    (oGeoJson.type.toLowerCase() === 'feature')) {\r\n    if (oGeoJson.hasOwnProperty('properties') &&\r\n      oGeoJson.properties.hasOwnProperty('aoi')) {\r\n      bRet = true;\r\n    }\r\n  }\r\n  return bRet;\r\n};\r\n\r\n/**\r\n *\r\n * @param mapInstanceId\r\n * @param oEmpFeature\r\n * @returns {boolean}\r\n */\r\nemp.helpers.canMapEngineEditFeature = function (mapInstanceId, oEmpFeature) {\r\n  var bRet = false;\r\n  var oProperties;\r\n  var mapInstance = emp.instanceManager.getInstance(mapInstanceId);\r\n\r\n  try {\r\n    switch (oEmpFeature.getFormat()) {\r\n      case emp.typeLibrary.featureFormatType.KML:\r\n        if (mapInstance.engine.capabilities.formats.KML_BASIC.edit ||\r\n          mapInstance.engine.capabilities.formats.KML_COMPLEX.edit) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.featureFormatType.GEOJSON:\r\n        if (oEmpFeature.isAOI()) {\r\n          if (mapInstance.engine.capabilities.formats.AOI.edit) {\r\n            bRet = true;\r\n          }\r\n        } else if (mapInstance.engine.capabilities.formats.GEOJSON_BASIC.edit ||\r\n          mapInstance.engine.capabilities.formats.GEOJSON_FULL.edit) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.featureFormatType.WMS:\r\n        break;\r\n      case emp.typeLibrary.featureFormatType.IMAGE:\r\n        if (mapInstance.engine.capabilities.formats.IMAGE.edit) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n        oProperties = oEmpFeature.getProperties();\r\n        if (oProperties && oProperties.hasOwnProperty('radius')) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n        oProperties = oEmpFeature.getProperties();\r\n        if (oProperties && oProperties.hasOwnProperty('semiMajor') &&\r\n          oProperties.hasOwnProperty('semiMinor')) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n        oProperties = oEmpFeature.getProperties();\r\n        if (oProperties && oProperties.hasOwnProperty('width') &&\r\n          oProperties.hasOwnProperty('height')) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n        oProperties = oEmpFeature.getProperties();\r\n        if (oProperties && oProperties.hasOwnProperty('width')) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n        bRet = true;\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n        oProperties = oEmpFeature.getProperties();\r\n        if (oProperties && (oProperties.standard)) {\r\n          switch (oProperties.standard.toUpperCase()) {\r\n            case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B:\r\n              if (mapInstance.engine.capabilities.formats.MILSTD.version2525B.edit) {\r\n                bRet = true;\r\n              }\r\n              break;\r\n            case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C:\r\n              if (mapInstance.engine.capabilities.formats.MILSTD.version2525C.edit) {\r\n                bRet = true;\r\n              }\r\n              break;\r\n          }\r\n        } else if (mapInstance.engine.capabilities.formats.MILSTD.version2525B.edit ||\r\n          mapInstance.engine.capabilities.formats.MILSTD.version2525C.edit) {\r\n          bRet = true;\r\n        }\r\n\r\n        if (bRet) {\r\n          if (!oProperties.hasOwnProperty(\"modifiers\")) {\r\n            // Has no modifiers\r\n            break;\r\n          } else {\r\n            var symbolId = oEmpFeature.getSymbolCode().substring(4, 10);\r\n            var oModifiers = oProperties.modifiers;\r\n\r\n            // If it can edit this milstd, we need to see if its one that gets\r\n            // rendered as 3D.\r\n            if (!sec.web.renderer.utilities.JavaRendererUtilities.is3dSymbol(oEmpFeature.getSymbolCode(), oModifiers)) {\r\n              // Its not a 3D graphic\r\n              break;\r\n            } else if (!oModifiers.hasOwnProperty(\"altitudeDepth\")) {\r\n              // Has no altitude\r\n              break;\r\n            } else if (!(oModifiers.altitudeDepth instanceof Array)) {\r\n              // Altitude is not an array\r\n              break;\r\n            } else if (oModifiers.altitudeDepth.length < 2) {\r\n              // Not enough altitudes\r\n              break;\r\n            }\r\n\r\n            if ((symbolId === \"ALC---\") ||\r\n              (symbolId === \"ALM---\") ||\r\n              (symbolId === \"ALS---\") ||\r\n              (symbolId === \"ALU---\") ||\r\n              (symbolId === \"ALL---\")) {\r\n              if (!oModifiers.hasOwnProperty(\"distance\")) {\r\n                // It should have a distnace and it does not.\r\n                break;\r\n              }\r\n\r\n              var iCoordinateCnt = oEmpFeature.getData().coordinates.length - 1;\r\n\r\n              if (oModifiers.altitudeDepth.length < (2 * iCoordinateCnt)) {\r\n                // Not enough altitudes\r\n                // It need 2 per segment.\r\n                break;\r\n              } else if (oModifiers.distance.length < iCoordinateCnt) {\r\n                // It does not have at least iCoordinateCnt # of distances.\r\n                // It need one per segment.\r\n                break;\r\n              } else if (!mapInstance.engine.capabilities.formats.AIRSPACE.edit) {\r\n                // This map can't edit this 3D MilStd airspaces.\r\n                bRet = false;\r\n              }\r\n            } else if ((symbolId === \"ACAC--\") || (symbolId === \"AKPC--\") ||\r\n              (symbolId === \"ACAR--\") || (symbolId === \"AKPR--\")) {\r\n              if (!oModifiers.hasOwnProperty(\"distance\")) {\r\n                // It should have a distnace and it does not.\r\n                break;\r\n              } else if (oModifiers.distance.length < 1) {\r\n                // It does not have a distance.\r\n                break;\r\n              } else if (!mapInstance.engine.capabilities.formats.AIRSPACE.edit) {\r\n                // This map can't edit this 3D MilStd airspaces.\r\n                bRet = false;\r\n              }\r\n            }\r\n            // All of the other symbols only need the altitude\r\n            else if (!mapInstance.engine.capabilities.formats.AIRSPACE.edit) {\r\n              // This map can't edit this 3D MilStd airspaces.\r\n              bRet = false;\r\n            }\r\n          }\r\n        }\r\n        break;\r\n      case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n        if (mapInstance.engine.capabilities.formats.AIRSPACE.edit) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n    }\r\n  } catch (e) {\r\n    // just in case\r\n    bRet = true;\r\n  }\r\n  return bRet;\r\n};\r\n\r\n/**\r\n *\r\n * @param mapInstanceId\r\n * @param oEmpFeature\r\n * @returns {boolean}\r\n */\r\nemp.helpers.canMapEnginePlotFeature = function (mapInstanceId, oEmpFeature) {\r\n  var bRet = false;\r\n  var oProperties;\r\n  var mapInstance = emp.instanceManager.getInstance(mapInstanceId);\r\n\r\n  try {\r\n    switch (oEmpFeature.getCoreObjectType()) {\r\n      case emp.typeLibrary.types.OVERLAY:\r\n        break;\r\n      case emp.typeLibrary.types.FEATURE:\r\n        switch (oEmpFeature.getFormat()) {\r\n          case emp.typeLibrary.featureFormatType.KML:\r\n            if (mapInstance.engine.capabilities.formats.KML_BASIC.plot ||\r\n              mapInstance.engine.capabilities.formats.KML_COMPLEX.plot) {\r\n              bRet = true;\r\n            }\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.GEOJSON:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n            if (oEmpFeature.isAOI()) {\r\n              if (mapInstance.engine.capabilities.formats.AOI.plot) {\r\n                bRet = true;\r\n              }\r\n            } else if (mapInstance.engine.capabilities.formats.GEOJSON_BASIC.plot ||\r\n              mapInstance.engine.capabilities.formats.GEOJSON_FULL.plot) {\r\n              bRet = true;\r\n            }\r\n            break;\r\n\r\n          case emp.typeLibrary.featureFormatType.IMAGE:\r\n            if (mapInstance.engine.capabilities.formats.IMAGE.plot) {\r\n              bRet = true;\r\n            }\r\n            break;\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n            oProperties = oEmpFeature.getProperties();\r\n            if (oProperties && (oProperties.standard)) {\r\n              switch (oProperties.standard.toUpperCase()) {\r\n                case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B:\r\n                  if (mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot) {\r\n                    bRet = true;\r\n                  }\r\n                  break;\r\n                case emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C:\r\n                  if (mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot) {\r\n                    bRet = true;\r\n                  }\r\n                  break;\r\n              }\r\n            } else if (mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot ||\r\n              mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot) {\r\n              bRet = true;\r\n            }\r\n\r\n            if (bRet) {\r\n              if (!oProperties.hasOwnProperty(\"modifiers\")) {\r\n                // Has no modifiers\r\n                break;\r\n              } else {\r\n                var symbolId = oEmpFeature.getSymbolCode().substring(4, 10);\r\n                var oModifiers = oProperties.modifiers;\r\n\r\n                // If it can edit this milstd, we need to see if its one that gets\r\n                // rendered as 3D.\r\n                if (!sec.web.renderer.utilities.JavaRendererUtilities.is3dSymbol(oEmpFeature.getSymbolCode(), oModifiers)) {\r\n                  // Its not a 3D graphic\r\n                  break;\r\n                } else if (!oModifiers.hasOwnProperty(\"altitudeDepth\")) {\r\n                  // Has no altitude\r\n                  break;\r\n                } else if (!(oModifiers.altitudeDepth instanceof Array)) {\r\n                  // Altitude is not an array\r\n                  break;\r\n                } else if (oModifiers.altitudeDepth.length < 2) {\r\n                  // Not enough altitudes\r\n                  break;\r\n                }\r\n\r\n                if ((symbolId === \"ALC---\") ||\r\n                  (symbolId === \"ALM---\") ||\r\n                  (symbolId === \"ALS---\") ||\r\n                  (symbolId === \"ALU---\") ||\r\n                  (symbolId === \"ALL---\")) {\r\n                  if (!oModifiers.hasOwnProperty(\"distance\")) {\r\n                    // It should have a distnace and it does not.\r\n                    break;\r\n                  }\r\n\r\n                  var iCoordinateCnt = oEmpFeature.getData().coordinates.length - 1;\r\n\r\n                  if (oModifiers.altitudeDepth.length < (2 * iCoordinateCnt)) {\r\n                    // Not enough altitudes\r\n                    // It need 2 per segment.\r\n                    break;\r\n                  } else if (oModifiers.distance.length < iCoordinateCnt) {\r\n                    // It does not have at least iCoordinateCnt # of distances.\r\n                    // It need one per segment.\r\n                    break;\r\n                  } else if (!mapInstance.engine.capabilities.formats.AIRSPACE.plot) {\r\n                    // This map can't edit this 3D MilStd airspaces.\r\n                    bRet = false;\r\n                  }\r\n                } else if ((symbolId === \"ACAC--\") || (symbolId === \"AKPC--\") ||\r\n                  (symbolId === \"ACAR--\") || (symbolId === \"AKPR--\")) {\r\n                  if (!oModifiers.hasOwnProperty(\"distance\")) {\r\n                    // It should have a distance and it does not.\r\n                    break;\r\n                  } else if (oModifiers.distance.length < 1) {\r\n                    // It does not have a distance.\r\n                    break;\r\n                  } else if (!mapInstance.engine.capabilities.formats.AIRSPACE.plot) {\r\n                    // This map can't edit this 3D MilStd airspaces.\r\n                    bRet = false;\r\n                  }\r\n                }\r\n                // All of the other symbols only need the altitude\r\n                else if (!mapInstance.engine.capabilities.formats.AIRSPACE.plot) {\r\n                  // This map can't edit this 3D MilStd airspaces.\r\n                  bRet = false;\r\n                }\r\n              }\r\n            }\r\n            break;\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n            if (mapInstance.engine.capabilities.formats.AIRSPACE.plot) {\r\n              bRet = true;\r\n            }\r\n            break;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.types.WMS:\r\n        if ((mapInstance.engine.capabilities.formats.WMS.version_1_1 &&\r\n          (oEmpFeature.getVersion().substr(0, 3) === '1.1')) ||\r\n          (mapInstance.engine.capabilities.formats.WMS.version_1_3 &&\r\n          (oEmpFeature.getVersion().substr(0, 3) === '1.3'))) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.types.WMTS:\r\n        if (mapInstance.engine.capabilities.formats.WMTS) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.types.KML:\r\n        if (mapInstance.engine.capabilities.formats.KML_LAYER) {\r\n          bRet = true;\r\n        }\r\n        break;\r\n    }\r\n  } catch (e) {\r\n    // just in case\r\n    bRet = true;\r\n  }\r\n  return bRet;\r\n};\r\n\r\n/**\r\n * @method\r\n * @description This function searches an array of objects for an entry that\r\n * contains a property name equal to the content of fieldName that has a value equal to the content of\r\n * fieldValue.\r\n * @param {type} oArray This parameters must contain the array of objects to search thru.\r\n * @param {type} fieldName This parameter contains the name of the property to compare.\r\n * @param {type} fieldValue This parameters contains the value to match with the property.\r\n * @returns {Number} It return the 0 base index of the elements found or -1 if a match is not found.\r\n */\r\nemp.helpers.findIndexOf = function (oArray, fieldName, fieldValue) {\r\n  for (var iIndex = 0; iIndex < oArray.length; iIndex++) {\r\n    if (oArray[iIndex].hasOwnProperty(fieldName) &&\r\n      (oArray[iIndex][fieldName] === fieldValue))\r\n      return iIndex;\r\n  }\r\n\r\n  return -1;\r\n};\r\n\r\n/**\r\n * @namespace\r\n */\r\nemp.helpers.associativeArray = {};\r\n\r\n/**\r\n *\r\n * @param aArray\r\n * @returns {number}\r\n */\r\nemp.helpers.associativeArray.size = function (aArray) {\r\n  var size = 0,\r\n    key;\r\n  for (key in aArray) {\r\n    if (aArray.hasOwnProperty(key)) {\r\n      size++;\r\n    }\r\n  }\r\n  return size;\r\n};\r\n\r\n/**\r\n *\r\n * @param aArray\r\n * @returns {boolean}\r\n */\r\nemp.helpers.associativeArray.isEmpty = function (aArray) {\r\n  var key;\r\n  for (key in aArray) {\r\n    if (aArray.hasOwnProperty(key)) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\n/**\r\n *\r\n * @param aArray\r\n * @returns {Array}\r\n */\r\nemp.helpers.associativeArray.getKeys = function (aArray) {\r\n  var aKeys = [];\r\n  var key;\r\n  for (key in aArray) {\r\n    if (aArray.hasOwnProperty(key)) {\r\n      // Push it only if its a property.\r\n      aKeys.push(key);\r\n    }\r\n  }\r\n  return aKeys;\r\n};\r\n// Append the window location to a relative path to turn it into an absolute path\r\nemp.helpers.relToAbs = function (url) {\r\n  /* Only accept commonly trusted protocols:\r\n   * Only data-image URLs are accepted, Exotic flavours (escaped slash,\r\n   * html-entitied characters) are not supported to keep the function fast */\r\n  if (/^(https?:|file:|ftps?:|mailto:|javascript:|data:image\\/[^;]{2,9})/i.test(url))\r\n    return url; //Url is already absolute\r\n\r\n  var base_url = location.href.match(/^(.+)\\/?(?:#.+)?$/)[0] + \"/\";\r\n  if (url.substring(0, 2) === \"//\")\r\n    return location.protocol + url;\r\n  else if (url.charAt(0) === \"/\")\r\n    return location.protocol + \"//\" + location.host + url;\r\n  else if (url.substring(0, 2) === \"./\")\r\n    url = \".\" + url;\r\n  else if (/^\\s*$/.test(url))\r\n    return \"\"; //Empty = Return nothing\r\n  else url = \"../\" + url;\r\n\r\n  url = base_url + url;\r\n  while (/\\/\\.\\.\\//.test(url)) {\r\n    url = url.replace(/[^\\/]+\\/+\\.\\.\\//i, \"\");\r\n  }\r\n\r\n  /* Escape certain characters to prevent XSS */\r\n  url = url.replace(/\\.$/, \"\").replace(/\\/\\./g, \"\").replace(/\"/g, \"%22\")\r\n    .replace(/'/g, \"%27\").replace(/</g, \"%3C\").replace(/>/g, \"%3E\");\r\n  return url;\r\n\r\n};\r\n\r\n/**\r\n * @function\r\n * @description This function pareses a string for replacement parameters.\r\n * For each replacement parameter found the callback is called to obtain\r\n * the value.\r\n * @param {String} sStr The string with or without replacements parameters.\r\n * @param {function} fnCallback The function which is called to obtain the value.\r\n * The function must be of the form function(sParam) and must return a string.\r\n * @returns {String}\r\n */\r\nemp.helpers.getReplacementString = function (sStr, fnCallback) {\r\n  var sStrCopy = sStr;\r\n  var sParam;\r\n  var sValue;\r\n  var bContinue = true;\r\n  var iParamStart = 0;\r\n  var iParamEnd;\r\n  var oRegExp;\r\n\r\n  if (typeof(fnCallback) !== 'function') {\r\n    throw new Error(\"fnCallback parameter is not a function.\");\r\n  }\r\n\r\n  if (typeof(sStr) !== 'string') {\r\n    throw new Error(\"sStr parameter is not a string.\");\r\n  }\r\n\r\n  while (bContinue) {\r\n    iParamStart = sStrCopy.indexOf(\"${\");\r\n\r\n    if (iParamStart === -1) {\r\n      bContinue = false;\r\n      continue;\r\n    }\r\n\r\n    iParamEnd = sStrCopy.indexOf(\"}\");\r\n    if (iParamEnd === -1) {\r\n      bContinue = false;\r\n      continue;\r\n    }\r\n\r\n    sParam = sStrCopy.substring(iParamStart + 2, iParamEnd);\r\n\r\n    if (sParam.length === 0) {\r\n      oRegExp = new RegExp(\"\\\\$\\\\{\\\\}\", \"g\");\r\n      sStrCopy = sStrCopy.replace(oRegExp, \"[REPLACEMENT PARAMETER NOT PROVIDED]\");\r\n    } else {\r\n      sValue = fnCallback(sParam);\r\n\r\n      if (typeof(sValue) !== 'string') {\r\n        throw new Error(\"replacement value returned for \" + sParam + \" is not a string.\");\r\n      }\r\n\r\n      oRegExp = new RegExp(\"\\\\$\\\\{\" + sParam + \"\\\\}\", \"g\");\r\n      sStrCopy = sStrCopy.replace(oRegExp, sValue);\r\n    }\r\n  }\r\n\r\n  return sStrCopy;\r\n};\r\n\r\n/**\r\n * @function\r\n * @description Function that creates a circles in a canvas element and returns\r\n * the canvas.\r\n * @argument {object} oArgs An object with the following structure.\r\n * @argument {Integer} oArgs.iRadius Required parameter containing the radius of\r\n * the circle in pixels.\r\n * @argument {Number} oArgs.dOpacity Required parameter containing the opacity\r\n * value for the circle.\r\n * @argument {String=} oArgs.sStrokeColor Optional parameter which if provided the\r\n * circle is drawn with a border of this color.\r\n * @argument {Integer=} oArgs.iLineWidth Optional parameters used for the line\r\n * width of the circumference if drawn. Default value 1.\r\n * @argument {String=} oArgs.sFillColor Optional circle fill color.\r\n * @argument {String=} oArgs.sGradientColor Optional color used to create a radial\r\n * gradient. If this property is provided the fill color must be provided.\r\n * @argument {String=} sTextColor Optional text color. The Default is black.\r\n * @argument {String=} oArgs.sText Optional text, which if provided will be centered\r\n * in the circle.\r\n */\r\nemp.helpers.createCircleCanvas = function (oArgs) {\r\n  var iRadius = oArgs.iRadius;\r\n  var dOpacity = oArgs.dOpacity;\r\n  var sStrokeColor = oArgs.sStrokeColor;\r\n  var sFillColor = oArgs.sFillColor;\r\n  var sGradientColor = oArgs.sGradientColor;\r\n  var sTextColor = oArgs.sTextColor;\r\n  var sText = oArgs.sText;\r\n  var iLineWidth = oArgs.iLineWidth || 1;\r\n\r\n  var iWidth = (iRadius * 2);\r\n  var iHeight = iWidth;\r\n  var iX = iRadius;\r\n  var iY = iRadius;\r\n  var oCanvas = document.createElement('canvas');\r\n  var oCtx;\r\n\r\n  if (typeof(iRadius) !== \"number\") {\r\n    throw new Error(\"Invalid radius.\");\r\n  }\r\n\r\n  if (typeof(dOpacity) !== \"number\") {\r\n    throw new Error(\"Invalid opacity.\");\r\n  }\r\n\r\n  if (sGradientColor && !sFillColor) {\r\n    throw new Error(\"If a gradient color is provided a fill color must be provided.\");\r\n  }\r\n\r\n  if (sGradientColor && (typeof(sGradientColor) !== \"string\")) {\r\n    throw new Error(\"Invalid gradient color. It must be a string.\");\r\n  }\r\n\r\n  if (sStrokeColor && (typeof(sStrokeColor) !== \"string\")) {\r\n    throw new Error(\"Invalid stroke color. It must be a string.\");\r\n  }\r\n\r\n  if (sFillColor && (typeof(sFillColor) !== \"string\")) {\r\n    throw new Error(\"Invalid fill color. It must be a string.\");\r\n  }\r\n\r\n  if (sTextColor && (typeof(sTextColor) !== \"string\")) {\r\n    throw new Error(\"Invalid text color. It must be a string.\");\r\n  } else if (!sTextColor) {\r\n    sTextColor = \"black\";\r\n  }\r\n\r\n  oCanvas.width = iWidth;\r\n  oCanvas.height = iHeight;\r\n  oCtx = oCanvas.getContext(\"2d\");\r\n\r\n  oCtx.beginPath();\r\n  oCtx.globalAlpha = dOpacity;\r\n\r\n  if (sGradientColor) {\r\n    var oGradient = oCtx.createRadialGradient(iRadius, iRadius, Math.round(iRadius * 0.7), iRadius, iRadius, iRadius);\r\n    oGradient.addColorStop(0, sFillColor);\r\n    oGradient.addColorStop(1, sGradientColor);\r\n\r\n    oCtx.fillStyle = oGradient;\r\n  } else if (sFillColor) {\r\n    oCtx.fillStyle = sFillColor;\r\n  }\r\n\r\n  if (sFillColor) {\r\n    oCtx.arc(iX, iY, iRadius, 0, 2 * Math.PI);\r\n    oCtx.fill();\r\n  }\r\n\r\n  if (sStrokeColor) {\r\n    oCtx.lineWidth = iLineWidth;\r\n    oCtx.strokeStyle = sStrokeColor;\r\n    oCtx.arc(iX, iY, (iRadius - iLineWidth), 0, 2 * Math.PI);\r\n    oCtx.stroke();\r\n  }\r\n\r\n  function wrapText(context, text, x, y, lineHeight, iMaxWidth) {\r\n    var iTextHeight = 0;\r\n    var iCharIndex = 0;\r\n    var sCurrLine = \"\";\r\n    var oLines = [];\r\n    var sTxt = text.replace(\"<br/>\", \"\\n\");\r\n\r\n    while ((sTxt.length > 0) && (sTxt.charAt(0) === '\\n')) {\r\n      // Get rid of \\n at the beginning.\r\n      sTxt = sTxt.substr(1);\r\n    }\r\n\r\n    while (sTxt.length > 0) {\r\n      if (iTextHeight > iMaxWidth) {\r\n        break;\r\n      }\r\n\r\n      if (sTxt.charAt(iCharIndex) === '\\n') {\r\n        oLines.push(sCurrLine);\r\n        sCurrLine = \"\";\r\n        iTextHeight += lineHeight;\r\n        sTxt = sTxt.substr(1);\r\n      } else {\r\n        sCurrLine += sTxt.charAt(iCharIndex);\r\n        if (context.measureText(sCurrLine).width > iMaxWidth) {\r\n          sCurrLine = sCurrLine.substr(0, sCurrLine.length - 1);\r\n          oLines.push(sCurrLine);\r\n          sCurrLine = \"\";\r\n          iTextHeight += lineHeight;\r\n        } else {\r\n          sTxt = sTxt.substr(1);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (sCurrLine.length > 0) {\r\n      oLines.push(sCurrLine);\r\n    }\r\n\r\n    // x, y are in the center.\r\n    if (oLines.length > 1) {\r\n      // If there is more than one line we need to\r\n      // move the y up by the correct amount.\r\n      var yOffset = Math.floor(oLines.length / 2 * lineHeight);\r\n      y -= yOffset;\r\n    }\r\n\r\n    for (var iIndex = 0; iIndex < oLines.length; iIndex++) {\r\n      context.fillText(oLines[iIndex], x, y);\r\n      y += lineHeight;\r\n    }\r\n  }\r\n\r\n  if ((typeof(sText) === 'string') && (sText.length > 0)) {\r\n    oCtx.globalAlpha = 1.0;\r\n    oCtx.font = \"12px Arial\";\r\n    oCtx.textAlign = \"center\";\r\n    oCtx.fillStyle = sTextColor;\r\n    var lineHeight = 12;\r\n\r\n    wrapText(oCtx, sText, iRadius, iRadius + (lineHeight / 2), lineHeight, iWidth);\r\n  }\r\n\r\n  return oCanvas;\r\n};\r\n\r\n/**\r\n * This will validate an absolute URL.\r\n * Relative URL will fail.\r\n */\r\nemp.helpers.isUrl = function (s) {\r\n  var regexp = /^(http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\r\n  return regexp.test(s);\r\n};\r\n\r\nemp.helpers.oHiddenSpan = null;\r\n\r\n/**\r\n *\r\n * @param sText\r\n * @param sFontFamily\r\n * @param sFontSize\r\n * @param sFontWeight\r\n * @returns {{width, height}}\r\n */\r\nemp.helpers.getStringPixelDimensions = function (sText, sFontFamily, sFontSize, sFontWeight) {\r\n  var iWidth = 0;\r\n  var iHeight = 0;\r\n\r\n  if (emp.helpers.oHiddenSpan === null) {\r\n    var style = \"position: absolute; visibility: hidden; white-space: nowrap; top: -100px; font-family: \" +\r\n      sFontFamily + \"; \" + \"font-size: \" + sFontSize + \"; font-weight: \" + sFontWeight + \";\";\r\n\r\n    var textMeasuringSpan = document.createElement(\"span\");\r\n    textMeasuringSpan.id = \"empTextMeasuringSpan\";\r\n    textMeasuringSpan.setAttribute(\"style\", style);\r\n    document.body.insertBefore(textMeasuringSpan, null);\r\n\r\n    emp.helpers.oHiddenSpan = document.getElementById(\"empTextMeasuringSpan\");\r\n  } else {\r\n    emp.helpers.oHiddenSpan.style.fontFamily = sFontFamily;\r\n    emp.helpers.oHiddenSpan.style.fontSize = sFontSize;\r\n    emp.helpers.oHiddenSpan.style.fontWeight = sFontWeight;\r\n  }\r\n\r\n  if (emp.helpers.oHiddenSpan !== null) {\r\n      emp.helpers.oHiddenSpan.innerHTML = sText;\r\n\r\n      iWidth = emp.helpers.oHiddenSpan.width;\r\n      iHeight = emp.helpers.oHiddenSpan.height;\r\n  }\r\n\r\n  return {\r\n    width: iWidth,\r\n    height: iHeight\r\n  };\r\n};\r\n\r\n/**\r\n *\r\n * @param sSymbolCode\r\n * @returns {string}\r\n */\r\nemp.helpers.getAffiliationColor = function (sSymbolCode) {\r\n  var sColor = '000000';\r\n  var sAffiliation = sSymbolCode.charAt(1);\r\n\r\n  switch (sAffiliation.toUpperCase()) {\r\n    case 'P': // PENDING\r\n    case 'U': //UNKNOWN\r\n    case 'G': //EXERCISE PENDING\r\n    case 'W': //EXERCISE UNKNOWN\r\n      sColor = 'FFFF00'; //(YELLOW)\r\n      break;\r\n    case 'F': //FRIEND\r\n    case 'A': //ASSUMED FRIEND\r\n    case 'D': //EXERCISE FRIEND\r\n    case 'M': //EXERCISE ASSUMED FRIEND\r\n      sColor = '00FFFF'; //(CYAN)\r\n      break;\r\n    case 'N': //NEUTRAL\r\n    case 'L': //EXERCISE NEUTRAL\r\n      sColor = '00FF00'; //(GREEN)\r\n      break;\r\n    case 'H': //HOSTILE\r\n    case 'S': //SUSPECT\r\n    case 'J': //JOKER\r\n    case 'K': //FAKER\r\n      sColor = 'FF0000'; //(RED)\r\n      break;\r\n  }\r\n\r\n  return sColor;\r\n};\r\n\r\n/**\r\n *\r\n * @param sSymbolCode\r\n * @returns {string}\r\n */\r\nemp.helpers.get3DMilStdAffiliationColor = function (sSymbolCode) {\r\n  var sColor = '000000';\r\n  var sAffiliation = sSymbolCode.charAt(1);\r\n\r\n  switch (sAffiliation.toUpperCase()) {\r\n    case 'P': // PENDING\r\n    case 'U': //UNKNOWN\r\n    case 'G': //EXERCISE PENDING\r\n    case 'W': //EXERCISE UNKNOWN\r\n      sColor = 'FFFF00'; //(YELLOW)\r\n      break;\r\n    case 'F': //FRIEND\r\n    case 'A': //ASSUMED FRIEND\r\n    case 'D': //EXERCISE FRIEND\r\n    case 'M': //EXERCISE ASSUMED FRIEND\r\n      sColor = '000000'; //(Black)\r\n      break;\r\n    case 'N': //NEUTRAL\r\n    case 'L': //EXERCISE NEUTRAL\r\n      sColor = '00FF00'; //(GREEN)\r\n      break;\r\n    case 'H': //HOSTILE\r\n    case 'S': //SUSPECT\r\n    case 'J': //JOKER\r\n    case 'K': //FAKER\r\n      sColor = 'FF0000'; //(RED)\r\n      break;\r\n  }\r\n\r\n  return sColor;\r\n};\r\n\r\n/**\r\n * Checks if a string contains only whitespace return true is only spaces,the text null, undefined, false if it\r\n * contains any other character\r\n * @param str\r\n * @returns {boolean}\r\n */\r\nemp.helpers.isEmptyString = function (str) {\r\n  var isEmpty = false;\r\n  if (str === undefined ||\r\n    str === null ||\r\n    typeof str !== \"string\" ||\r\n    str === \"\" ||\r\n    str === \"undefined\" ||\r\n    str === \"null\" || !str.replace(/\\s/g, '').length) {\r\n    isEmpty = true;\r\n  }\r\n  return isEmpty;\r\n};\r\n\r\n/**\r\n *\r\n */\r\nemp.helpers.GeoJsonHasAltitude = (function () {\r\n  var coordinateHasAltitude = function (oGeoJsonCoord) {\r\n    var bRet = false;\r\n\r\n    if (Array.isArray(oGeoJsonCoord) && (oGeoJsonCoord.length > 2)) {\r\n      bRet = true;\r\n    }\r\n    return bRet;\r\n  };\r\n\r\n  var coordinateArrayHasAltitude = function (oGeoJsonCoord) {\r\n    var iIndex;\r\n    var bRet = false;\r\n\r\n    if (Array.isArray(oGeoJsonCoord)) {\r\n      for (iIndex = 0; iIndex < oGeoJsonCoord.length; iIndex++) {\r\n        bRet = coordinateHasAltitude(oGeoJsonCoord[iIndex]);\r\n\r\n        if (bRet) {\r\n          // If we find 1 altitude we can stop looking.\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return bRet;\r\n  };\r\n\r\n  var polygonCoordinateHasAltitude = function (oGeoJsonCoord) {\r\n    var iIndex;\r\n    var bRet = false;\r\n\r\n    if (Array.isArray(oGeoJsonCoord)) {\r\n      for (iIndex = 0; iIndex < oGeoJsonCoord.length; iIndex++) {\r\n        bRet = coordinateArrayHasAltitude(oGeoJsonCoord[iIndex]);\r\n\r\n        if (bRet) {\r\n          // If we find 1 altitude we can stop looking.\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return bRet;\r\n  };\r\n\r\n  var multiPolygonCoordinateHasAltitude = function (oGeoJsonCoord) {\r\n    var iIndex;\r\n    var bRet = false;\r\n\r\n    if (Array.isArray(oGeoJsonCoord)) {\r\n      for (iIndex = 0; iIndex < oGeoJsonCoord.length; iIndex++) {\r\n        bRet = polygonCoordinateHasAltitude(oGeoJsonCoord[iIndex]);\r\n\r\n        if (bRet) {\r\n          // If we find 1 altitude we can stop looking.\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return bRet;\r\n  };\r\n\r\n  var publicInterface = function (oGeoJsonData) {\r\n    var iIndex;\r\n    var bRet = false;\r\n\r\n    if (!oGeoJsonData.hasOwnProperty('type')) {\r\n      emp.typeLibrary.Error({\r\n        level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n        message: \"emp.helpers.GeoJsonHasAltitude: GeoJson with no type property. (\" + oGeoJsonData + \")\"\r\n      });\r\n    } else {\r\n      switch (oGeoJsonData.type.toLowerCase()) {\r\n        case 'point':\r\n          bRet = coordinateHasAltitude(oGeoJsonData.coordinates);\r\n          break;\r\n        case 'multipoint':\r\n        case 'linestring':\r\n          bRet = coordinateArrayHasAltitude(oGeoJsonData.coordinates);\r\n          break;\r\n        case 'multilinestring':\r\n        case 'polygon':\r\n          bRet = polygonCoordinateHasAltitude(oGeoJsonData.coordinates);\r\n          break;\r\n        case 'multipolygon':\r\n          bRet = multiPolygonCoordinateHasAltitude(oGeoJsonData.coordinates);\r\n          break;\r\n        case 'feature':\r\n          bRet = emp.helpers.GeoJsonHasAltitude(oGeoJsonData.geometry);\r\n          break;\r\n        case 'featurecollection':\r\n          if (Array.isArray(oGeoJsonData.features)) {\r\n            for (iIndex = 0; iIndex < oGeoJsonData.features.length; iIndex++) {\r\n              bRet = emp.helpers.GeoJsonHasAltitude(oGeoJsonData.features[iIndex]);\r\n              if (bRet) {\r\n                // We only need to find 1.\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 'geometrycollection':\r\n          if (Array.isArray(oGeoJsonData.geometries)) {\r\n            for (iIndex = 0; iIndex < oGeoJsonData.geometries.length; iIndex++) {\r\n              bRet = emp.helpers.GeoJsonHasAltitude(oGeoJsonData.geometries[iIndex]);\r\n              if (bRet) {\r\n                // We only need to find 1.\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    return bRet;\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n\r\n/**\r\n *\r\n */\r\nemp.helpers.isCompoundGeoJson = (function () {\r\n  var publicInterface = function (oGeoJsonData) {\r\n    var bRet = false;\r\n\r\n    if (!oGeoJsonData.hasOwnProperty('type')) {\r\n      emp.typeLibrary.Error({\r\n        level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n        message: \"emp.helpers.isCompoundGeoJson: GeoJson with no type property. (\" + oGeoJsonData + \")\"\r\n      });\r\n    } else {\r\n      switch (oGeoJsonData.type.toLowerCase()) {\r\n        case 'point':\r\n        case 'linestring':\r\n        case 'polygon':\r\n          break;\r\n        case 'multipoint':\r\n        case 'multilinestring':\r\n        case 'multipolygon':\r\n          bRet = true;\r\n          break;\r\n        case 'feature':\r\n          bRet = emp.helpers.isCompoundGeoJson(oGeoJsonData.geometry);\r\n          break;\r\n        case 'featurecollection':\r\n          if (Array.isArray(oGeoJsonData.features)) {\r\n            if (oGeoJsonData.features.length === 1) {\r\n              bRet = emp.helpers.isCompoundGeoJson(oGeoJsonData.features[0]);\r\n            } else {\r\n              bRet = true;\r\n            }\r\n          }\r\n          break;\r\n        case 'geometrycollection':\r\n          if (Array.isArray(oGeoJsonData.geometries)) {\r\n            if (oGeoJsonData.geometries.length === 1) {\r\n              bRet = emp.helpers.isCompoundGeoJson(oGeoJsonData.geometries[0]);\r\n            } else {\r\n              bRet = true;\r\n\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    return bRet;\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n\r\n/**\r\n * Returns true if multiple `coordinates` nodes are found\r\n * @returns {boolean}\r\n */\r\nemp.helpers.isCompoundKML = (function () {\r\n\r\n  var publicInterface = function (sKMLData) {\r\n    var bRet = false;\r\n\r\n    try {\r\n      var xmlDoc = emp.util.parseXML(sKMLData);\r\n      var coordNodes = xmlDoc.getElementsByTagName(\"coordinates\");\r\n\r\n      if (coordNodes.length !== 1) {\r\n        bRet = true;\r\n      }\r\n    } catch (Ex) {\r\n      bRet = true;\r\n    }\r\n\r\n    return bRet;\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n","var emp = window.emp || {};\r\n\r\n/**\r\n * @namespace\r\n */\r\nemp.utilities = emp.utilities || {};\r\n\r\n/**\r\n * @class\r\n */\r\nemp.utilities.Hash = function() {\r\n  var i;\r\n  this.length = 0;\r\n  this.items = [];\r\n  for (i = 0; i < arguments.length; i += 2) {\r\n    if (typeof(arguments[i + 1]) !== 'undefined') {\r\n      this.items[arguments[i]] = arguments[i + 1];\r\n      this.length += 1;\r\n    }\r\n  }\r\n  /**\r\n   *\r\n   * @param in_key\r\n   * @returns {*}\r\n   */\r\n  this.removeItem = function(in_key) {\r\n    var tmp_previous;\r\n    if (typeof(this.items[in_key]) !== 'undefined') {\r\n      this.length -= 1;\r\n      tmp_previous = this.items[in_key];\r\n      delete this.items[in_key];\r\n    }\r\n\r\n    return tmp_previous;\r\n  };\r\n  /**\r\n   *\r\n   * @param in_key\r\n   * @returns {Array}\r\n   */\r\n  this.getItem = function(in_key) {\r\n    return this.items[in_key];\r\n  };\r\n  /**\r\n   *\r\n   * @param in_key\r\n   * @param in_value\r\n   * @returns {*}\r\n   */\r\n  this.setItem = function(in_key, in_value) {\r\n    var tmp_previous;\r\n    if (typeof(in_value) !== 'undefined') {\r\n      if (typeof(this.items[in_key]) === 'undefined') {\r\n        this.length += 1;\r\n      } else {\r\n        tmp_previous = this.items[in_key];\r\n      }\r\n\r\n      this.items[in_key] = in_value;\r\n    }\r\n\r\n    return tmp_previous;\r\n  };\r\n  /**\r\n   *\r\n   * @param in_key\r\n   * @returns {boolean}\r\n   */\r\n  this.hasItem = function(in_key) {\r\n    return typeof(this.items[in_key]) !== 'undefined';\r\n  };\r\n  /**\r\n   *\r\n   */\r\n  this.clear = function() {\r\n    var j;\r\n\r\n    for (j in this.items) {\r\n      if (this.items.hasOwnProperty(j)) {\r\n        delete this.items[j];\r\n      }\r\n    }\r\n\r\n    this.length = 0;\r\n  };\r\n};\r\n\r\n/**\r\n *\r\n * @param basePath\r\n * @returns {{iconUrl: string, offset: {x: number, y: number, xUnits: string, yUnits: string, width: number, height: number}}}\r\n */\r\nemp.utilities.getDefaultIcon = function(basePath) {\r\n  // This structure allows the engine to properly set the icons hot spot.\r\n  // The x,y are assumed to be the top left corner of the icon.\r\n  // If the default icons is used for Kml, the map engine is responsible\r\n  // for flipping the y according to the y units to account for the \r\n  // KML origin being in the bottom left.\r\n  var icon = \"data:image/png;base64,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\";\r\n\r\n\r\n  if (emp.helpers.isEmptyString(basePath)) {\r\n    basePath = \"../\";\r\n  }\r\n\r\n  return {\r\n    iconUrl: icon,\r\n    offset: {\r\n      x: 0.5,\r\n      y: 1.0,\r\n      xUnits: 'fraction',\r\n      yUnits: 'fraction',\r\n      width: 25,\r\n      height: 41\r\n    }\r\n  };\r\n\r\n};\r\n\r\n/**\r\n *\r\n */\r\nemp.utilities.icon = (function() {\r\n  var publicInterface = {\r\n    referencePoint: {\r\n      TOP_LEFT: 'topleft',\r\n      BOTTOM_LEFT: 'bottomleft'\r\n    },\r\n    /**\r\n     * This function returns the default icon\r\n     * with the offset ref to the bottom left.\r\n     */\r\n    getDefaultIcon: function(basePath) {\r\n      var oDefaultIcon = emp.utilities.getDefaultIcon(basePath);\r\n      var yOffset = oDefaultIcon.offset.y;\r\n      var yUnits = oDefaultIcon.offset.yUnits;\r\n\r\n      // Given that the core default icon is defined with the\r\n      // offset ref in the top left we need to convert the y offset\r\n      // to bottom left.\r\n\r\n      if (yUnits === 'pixels') {\r\n        yOffset = oDefaultIcon.offset.height - yOffset;\r\n      }\r\n      else if (yUnits === 'fraction') {\r\n        yOffset = 1.0 - yOffset;\r\n      }\r\n      else if (yUnits === 'insetPixels') {\r\n        yOffset = oDefaultIcon.offset.height - yOffset;\r\n      }\r\n\r\n      return {\r\n        iconUrl: oDefaultIcon.iconUrl,\r\n        offset: {\r\n          x: oDefaultIcon.offset.x,\r\n          y: yOffset,\r\n          xUnits: oDefaultIcon.offset.xUnits,\r\n          yUnits: oDefaultIcon.offset.yUnits\r\n        },\r\n        size: {\r\n          width: oDefaultIcon.offset.width,\r\n          height: oDefaultIcon.offset.height\r\n        }\r\n      };\r\n    },\r\n    /**\r\n     *\r\n     * @param basePath\r\n     * @returns {{iconUrl, offset}}\r\n     */\r\n    getDefaultIconURL: function(basePath) {\r\n\r\n      //return emp.utilities.getDefaultIcon(basePath).iconUrl;\r\n      return emp.utilities.getDefaultIcon(basePath);//.iconUrl;\r\n    },\r\n    /**\r\n     *\r\n     * @param iIconWidth\r\n     * @param nOffset\r\n     * @param sOffsetType\r\n     * @returns {number}\r\n     */\r\n    calculateXOffset: function(iIconWidth, nOffset, sOffsetType) {\r\n      var iOffset = 0;\r\n\r\n      switch (sOffsetType.toLowerCase()) {\r\n        case 'fraction':\r\n          iOffset = Math.floor(iIconWidth * nOffset * -1.0);\r\n          break;\r\n        case 'pixels':\r\n          iOffset = nOffset * -1;\r\n          break;\r\n        case 'insetpixels':\r\n          iOffset = (iIconWidth - nOffset) * -1;\r\n          break;\r\n      }\r\n\r\n      return iOffset;\r\n    },\r\n    /**\r\n     *\r\n     * @param iIconHeight\r\n     * @param nOffset\r\n     * @param sOffsetType\r\n     * @param cRefPoint\r\n     * @returns {number}\r\n     */\r\n    calculateYOffset: function(iIconHeight, nOffset, sOffsetType, cRefPoint) {\r\n      var iOffset = 0;\r\n\r\n      if (cRefPoint === emp.utilities.icon.referencePoint.TOP_LEFT) {\r\n        switch (sOffsetType.toLowerCase()) {\r\n          case 'fraction':\r\n            nOffset = (1.0 - nOffset);\r\n            break;\r\n          case 'pixels':\r\n            nOffset = (iIconHeight - nOffset);\r\n            break;\r\n          case 'insetpixels':\r\n            nOffset = (iIconHeight - nOffset);\r\n            break;\r\n        }\r\n      }\r\n      switch (sOffsetType.toLowerCase()) {\r\n        case 'fraction':\r\n          iOffset = Math.floor(iIconHeight * nOffset * -1.0);\r\n          break;\r\n        case 'pixels':\r\n          iOffset = nOffset * -1.0;\r\n          break;\r\n        case 'insetpixels':\r\n          iOffset = (iIconHeight - nOffset) * -1.0;\r\n          break;\r\n      }\r\n\r\n      return iOffset;\r\n    },\r\n    /**\r\n     *\r\n     * @param cRefPoint\r\n     * @returns {{xOffset: *, yOffset: *}}\r\n     */\r\n    getDefaultIconOffset: function(cRefPoint) {\r\n      var oDefaultIcon = emp.utilities.icon.getDefaultIcon('../');\r\n\r\n      return {\r\n        xOffset: emp.utilities.icon.calculateXOffset(oDefaultIcon.size.width, oDefaultIcon.offset.x, oDefaultIcon.offset.xUnits),\r\n        yOffset: emp.utilities.icon.calculateYOffset(oDefaultIcon.size.height, oDefaultIcon.offset.y, oDefaultIcon.offset.yUnits, cRefPoint)\r\n      };\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n})();\r\n","/*globals emp, geEngine*/\r\n\r\n/**\r\n * Geo Json Parser\r\n * @private\r\n * @return {Object}\r\n * @namespace geojsonParser\r\n */\r\nemp.geojsonParser = (function() {\r\n\r\n    function adjustColor(color) {\r\n        var alpha = \"CC\",\r\n            red = \"\",\r\n            green = \"\",\r\n            blue = \"\",\r\n            adjustedColor = \"CC000000\";\r\n        if (color !== undefined && color !== null) {\r\n            if (color.length === 8) {\r\n                alpha = color.substr(0, 2);\r\n                red = color.substr(2, 2);\r\n                green = color.substr(4, 2);\r\n                blue = color.substr(6, 2);\r\n                adjustedColor = alpha + blue + green + red;\r\n            } else if (color.length === 6) {\r\n                red = color.substr(0, 2);\r\n                green = color.substr(2, 2);\r\n                blue = color.substr(4, 2);\r\n                adjustedColor = alpha + blue + green + red;\r\n            }\r\n        }\r\n        return adjustedColor;\r\n\r\n    }\r\n\r\n    /** \r\n    Gets the geometry KML object from a geojson point coordinate.\r\n\r\n    @param {array} coordinates - the point coordinates of a geojson object.\r\n    */\r\n\r\n    function getPointKml(coordinates) {\r\n        var lat,\r\n            lon,\r\n            altitude,\r\n            kml,\r\n            result;\r\n\r\n        // Check to make sure there is a valid number of coordinate sub components\r\n        if (coordinates.length >= 2) {\r\n            // Get the lat/lon values\r\n            lat = coordinates[1];\r\n            lon = coordinates[0];\r\n\r\n            // Check to see if the coordinate has an altitude.\r\n            if (coordinates.length === 3) {\r\n                altitude = coordinates[2];\r\n            }\r\n\r\n            // Create the kml for this geometry.\r\n            kml = '<Point>' +\r\n                '<coordinates>' + lon + ',' + lat + (altitude !== undefined ? ',' + altitude : '') + '</coordinates>' +\r\n                '</Point>';\r\n\r\n            // return the kml in an object.\r\n            result = {\r\n                success: true,\r\n                message: \"\",\r\n                data: kml\r\n            };\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"geojson does not have a valid coordinate.\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /** \r\n    Create the KML for a geojson point.\r\n    */\r\n\r\n    function addGeoJsonPoint(geojson, name, id, overlayId, modifiers, zoom) {\r\n        var coordinates,\r\n            iconUrl,\r\n            xOffset,\r\n            yOffset,\r\n            xUnits,\r\n            yUnits,\r\n            fillColor,\r\n            kml,\r\n            obj,\r\n            result,\r\n            description,\r\n            style,\r\n            iconObj;\r\n\r\n        // set defaults in case there aren't any parameters        \r\n        modifiers = modifiers || {};\r\n\r\n        // retrieve the style elements from the geojson if availble.\r\n        style = emp.geojsonParser.getStyle(geojson);\r\n\r\n        if (modifiers.iconUrl) {\r\n            modifiers.iconUrl = modifiers.iconUrl.replace('&', '&amp;');\r\n        }\r\n\r\n        iconUrl = modifiers.iconUrl || style.iconUrl;\r\n\r\n        // If no icon has been specified try to pull the default icon\r\n        // from the map environment.\r\n        if (!iconUrl) {\r\n\r\n            iconObj = emp.utilities.getDefaultIcon();\r\n\r\n            iconUrl = iconObj.iconUrl;\r\n            xOffset = iconObj.offset.x;\r\n            yOffset = 1 - iconObj.offset.y;\r\n            xUnits = iconObj.offset.xUnits;\r\n            yUnits = iconObj.offset.yUnits;\r\n        } else {\r\n            xOffset = modifiers.iconXOffset || 0;\r\n            yOffset = modifiers.iconYOffset || 0;\r\n            xUnits = modifiers.xUnits || \"pixels\";\r\n            yUnits = modifiers.yUnits || \"pixels\";\r\n        }\r\n\r\n        fillColor = modifiers.fillColor || style.fillColor || \"FF000000\";\r\n        name = style.name || name || \"\";\r\n\r\n        if (style.description) {\r\n            description = style.description;\r\n        } else if (modifiers.description) {\r\n            description = modifiers.description;\r\n        }\r\n\r\n        fillColor = adjustColor(fillColor);\r\n\r\n        if (geojson.coordinates !== undefined || geojson.coordinates !== null) {\r\n            coordinates = geojson.coordinates;\r\n\r\n            kml = '<Placemark>' +\r\n                '<name><![CDATA[' + name + ']]></name>';\r\n\r\n            if (description) {\r\n                kml += '<description><![CDATA[' + description + ']]></description>';\r\n            }\r\n\r\n            kml += '<Style id=\"user-icon\">' +\r\n                '<IconStyle>' +\r\n                '<scale>1.0</scale>' +\r\n                '<Icon>' +\r\n                '<href>' + iconUrl + '</href>' +\r\n                '</Icon>' +\r\n                '<hotSpot x=\"' + xOffset + '\" y=\"' + yOffset + '\" xunits=\"' + xUnits + '\" yunits=\"' + yUnits + '\"/>' +\r\n                '</IconStyle>' +\r\n                '</Style>';\r\n\r\n            result = getPointKml(coordinates);\r\n            if (result.success) {\r\n                kml += result.data;\r\n                kml += '</Placemark>';\r\n\r\n                obj = {\r\n                    kml: kml,\r\n                    name: name,\r\n                    id: id,\r\n                    overlayId: overlayId,\r\n                    data: geojson,\r\n                    format: 'geojson',\r\n                    properties: modifiers,\r\n                    zoom: zoom\r\n                };\r\n\r\n                return {\r\n                    success: true,\r\n                    message: \"\",\r\n                    data: obj\r\n                };\r\n            }\r\n\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"geojson does not have a valid coordinate.\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    function getLineStringKml(coordinates) {\r\n        var coordinateString = \"\",\r\n            i,\r\n            latlon,\r\n            lat,\r\n            lon,\r\n            endChar,\r\n            result = null,\r\n            altitude,\r\n            kml;\r\n\r\n        // Loop through each coordinate and get the lat/lons\r\n        // to build a line string we pass to our renderer\r\n        for (i = 0; i < coordinates.length; i += 1) {\r\n            // Make sure we have at least 2 points for a line, if not\r\n            // it is not a valid line.\r\n            if (coordinates.length >= 2) {\r\n\r\n                latlon = coordinates[i];\r\n\r\n                if (latlon !== undefined && latlon !== null) {\r\n                    // Make sure we have at least a lat and a lon, if not\r\n                    // it is not a valid point.\r\n                    if (latlon.length >= 2) {\r\n                        lat = latlon[1];\r\n                        lon = latlon[0];\r\n\r\n                        // If we have 3 points, then we need to note this\r\n                        // line has altitude. (3rd point is z value) This\r\n                        // line will have to be extruded from the globe.\r\n                        if (latlon.length === 3) {\r\n                            altitude = latlon[2];\r\n                            coordinateString = coordinateString + lon + \",\" + lat + \",\" + altitude;\r\n                            endChar = (i !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                            coordinateString = coordinateString + endChar;\r\n                        } else {\r\n                            coordinateString = coordinateString + lon + \",\" + lat;\r\n                            endChar = (i !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                            coordinateString = coordinateString + endChar;\r\n                        }\r\n\r\n                    } else {\r\n                        result = {\r\n                            success: false,\r\n                            message: \"geojson does not have a valid coordinate.\"\r\n                        };\r\n                        break;\r\n                    }\r\n                } else {\r\n                    result = {\r\n                        success: false,\r\n                        message: \"geojson does not have a valid coordinate.  Point is null.\"\r\n                    };\r\n                    break;\r\n                }\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"geojson does not have enough coordinates to make a line.\"\r\n                };\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (result === null) {\r\n            kml = '<LineString>' +\r\n                '<tessellate>1</tessellate>' +\r\n                '<coordinates>' + coordinateString + '</coordinates>' +\r\n                '</LineString>';\r\n\r\n            result = {\r\n                success: true,\r\n                message: \"\",\r\n                data: kml\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    function addGeoJsonLineString(geojson, name, id, overlayId, modifiers, zoom) {\r\n        var result = \"\",\r\n            coordinates,\r\n            kml,\r\n            lineColor,\r\n            lineThickness,\r\n            obj,\r\n            description,\r\n            style;\r\n\r\n\r\n        style = emp.geojsonParser.getStyle(geojson);\r\n\r\n        modifiers = modifiers || {};\r\n        lineColor = modifiers.lineColor || style.lineColor || 'FF000000';\r\n        lineThickness = modifiers.lineThickness || 3.0;\r\n\r\n        lineColor = adjustColor(lineColor);\r\n\r\n        name = style.name || name || \"\";\r\n\r\n        if (style.description) {\r\n            description = style.description;\r\n        } else if (modifiers.description) {\r\n            description = modifiers.description;\r\n        }\r\n\r\n        // The type of GeoJson is a Line. Parse the Line and add it to the\r\n        // map.\r\n        if (geojson.coordinates !== undefined || geojson.coordinates !== null) {\r\n\r\n            // A line string is contained in a 2 dimensional array.\r\n            // Once we get the coordinates, we will need to pull\r\n            // each one out which resides in it's own array.\r\n            coordinates = geojson.coordinates;\r\n\r\n            if (coordinates !== undefined && coordinates !== null) {\r\n\r\n                //coordinateString = result.data;\r\n\r\n                kml = '<Placemark>' +\r\n                    '<name><![CDATA[' + name + ']]></name>';\r\n\r\n                if (description) {\r\n                    kml += '<description><![CDATA[' + description + ']]></description>';\r\n                }\r\n\r\n                kml += '<Style id=\"user-line\">' +\r\n                    '<LineStyle>' +\r\n                    '<color>' + lineColor + '</color>' +\r\n                    '<width>' + lineThickness + '</width>' +\r\n                    '</LineStyle>' +\r\n                    '</Style>';\r\n\r\n                result = getLineStringKml(coordinates);\r\n\r\n                // Make sure that there weren't any errors processing the JSON prior to \r\n                // creating the kml.\r\n                if (result !== undefined && result.success !== false) {\r\n                    kml += result.data;\r\n                    kml += '</Placemark>';\r\n\r\n                    obj = {\r\n                        kml: kml,\r\n                        name: name,\r\n                        id: id,\r\n                        overlayId: overlayId,\r\n                        data: geojson,\r\n                        format: 'geojson',\r\n                        properties: modifiers,\r\n                        zoom: zoom\r\n                    };\r\n\r\n                    result = {\r\n                        success: true,\r\n                        message: \"\",\r\n                        data: obj\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"geojson does not have a valid coordinates.  Coordinates are null. \"\r\n                };\r\n            }\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"geojson does not have a valid coordinate\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    function getPolygonKml(polygon) {\r\n        var latlon,\r\n            lat,\r\n            lon,\r\n            endChar,\r\n            coordinateString = \"\",\r\n            kml = '<Polygon>' + '<tessellate>1</tessellate>',\r\n            coordinates,\r\n            numRings,\r\n            coordIdx,\r\n            ringIdx;\r\n\r\n        // The first polygon is the outline, thereafter the following are holes\r\n        // First get the coordinates for the linear ring that defines the outline (outer boundary).\r\n        coordinates = polygon[0];\r\n        numRings = polygon.length;\r\n\r\n        if (numRings > 0) {\r\n            // Loop through the polygon outline and create a linear ring from all\r\n            // its points.\r\n\r\n            // Make sure we have at least 4 points to build a polygon.\r\n            if (coordinates.length <= 3) {\r\n                // Add a 4th point equalling the first point\r\n                polygon[0][3] = polygon[0][0];\r\n                return getPolygonKml(polygon);\r\n            }\r\n\r\n            for (coordIdx = 0; coordIdx < coordinates.length; coordIdx += 1) {\r\n                latlon = coordinates[coordIdx];\r\n\r\n                if (latlon !== undefined && latlon !== null) {\r\n                    // Make sure we have at least a lat and a lon, if not\r\n                    // it is not a valid point.\r\n                    if (latlon.length >= 2) {\r\n                        lat = latlon[1];\r\n                        lon = latlon[0];\r\n\r\n                        // If we have 3 points, then we need to note this\r\n                        // line has altitude. (3rd point is z value)\r\n                        if (latlon.length === 3) {\r\n                            coordinateString = coordinateString + lon + \",\" + lat + \",\" + latlon[2];\r\n                            endChar = (coordIdx !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                            coordinateString = coordinateString + endChar;\r\n                        } else {\r\n                            coordinateString = coordinateString + lon + \",\" + lat;\r\n                            endChar = (coordIdx !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                            coordinateString = coordinateString + endChar;\r\n                        }\r\n                    } else {\r\n                        return {\r\n                            success: false,\r\n                            message: \"geojson does not have a valid coordinate.\"\r\n                        };\r\n                    }\r\n                } else {\r\n                    return {\r\n                        success: false,\r\n                        message: \"geojson does not have a valid coordinate.  Point is null.\"\r\n                    };\r\n                }\r\n            }\r\n\r\n            // Verify that the polygon closes itself out.  Some people do this, some people don't, but\r\n            // KML requires the first and last points to be the same.\r\n            var firstCoordinate = coordinates[0];\r\n            var lastCoordinate = coordinates[coordinates.length - 1];\r\n\r\n            if (firstCoordinate.length === 3 && lastCoordinate.length === 3) {\r\n                // If lat lon are different make the first and last points the same.\r\n                if (firstCoordinate[0] !== lastCoordinate[0] ||\r\n                    firstCoordinate[1] !== lastCoordinate[1] ||\r\n                    firstCoordinate[2] !== lastCoordinate[2]) {\r\n                    coordinateString = coordinateString + \" \" + firstCoordinate[0] + \",\" + firstCoordinate[1] + \",\" + firstCoordinate[2];\r\n                }\r\n            } else {\r\n                if (firstCoordinate.length === 2 && lastCoordinate.length === 2) {\r\n\r\n                    // If lat lon are different make the first and last points the same.\r\n                    if (firstCoordinate[0] !== lastCoordinate[0] ||\r\n                        firstCoordinate[1] !== lastCoordinate[1]) {\r\n                        coordinateString = coordinateString + \" \" + firstCoordinate[0] + \",\" + firstCoordinate[1];\r\n                    }\r\n\r\n                } else {\r\n\r\n                    if (firstCoordinate.length > 2) {\r\n                        coordinateString = coordinateString + \" \" + firstCoordinate[0] + \",\" + firstCoordinate[1] + \",\" + firstCoordinate[2];\r\n                    } else {\r\n                        coordinateString = coordinateString + \" \" + firstCoordinate[0] + \",\" + firstCoordinate[1];\r\n                    }\r\n                }\r\n            }\r\n\r\n            kml += '<outerBoundaryIs>' +\r\n                '<LinearRing>' +\r\n                '<coordinates>' + coordinateString + '</coordinates>' +\r\n                '</LinearRing>' +\r\n                '</outerBoundaryIs>';\r\n\r\n            // If there is more than one linear ring, then add the interior rings.\r\n            if (numRings > 1) {\r\n\r\n                for (ringIdx = 1; ringIdx < numRings; ringIdx += 1) {\r\n                    coordinates = polygon[ringIdx];\r\n                    coordinateString = \"\";\r\n\r\n                    // Make sure we have at least 3 points to build a linear ring.\r\n                    if (coordinates.length < 3) {\r\n                        return {\r\n                            success: false,\r\n                            message: \"geojson does not have enough coordinates to build a polygon.\"\r\n                        };\r\n                    }\r\n\r\n                    for (coordIdx = 0; coordIdx < coordinates.length; coordIdx += 1) {\r\n                        latlon = coordinates[coordIdx];\r\n                        if (latlon !== undefined && latlon !== null) {\r\n                            // Make sure we have at least a lat and a lon, if not\r\n                            // it is not a valid point.\r\n                            if (latlon.length >= 2) {\r\n                                lat = latlon[1];\r\n                                lon = latlon[0];\r\n\r\n                                // If we have 3 points, then we need to note this\r\n                                // line has altitude. (3rd point is z value)\r\n                                if (latlon.length === 3) {\r\n                                    coordinateString = coordinateString + lon + \",\" + lat + \",\" + latlon[2];\r\n                                    endChar = (coordIdx !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                                    coordinateString = coordinateString + endChar;\r\n                                } else {\r\n                                    coordinateString = coordinateString + lon + \",\" + lat;\r\n                                    endChar = (coordIdx !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                                    coordinateString = coordinateString + endChar;\r\n                                }\r\n                            } else {\r\n                                return {\r\n                                    success: false,\r\n                                    message: \"geojson does not have a valid coordinate.\"\r\n                                };\r\n                            }\r\n                        } else {\r\n                            return {\r\n                                success: false,\r\n                                message: \"geojson does not have a valid coordinate.  Point is null.\"\r\n                            };\r\n                        }\r\n                    }\r\n                    // We successfully got an interior ring.  Add the kml for the\r\n                    // interior ring.\r\n                    kml += '<innerBoundaryIs>' +\r\n                        '<LinearRing>' +\r\n                        '<coordinates>' + coordinateString + '</coordinates>' +\r\n                        '</LinearRing>' +\r\n                        '</innerBoundaryIs>';\r\n                }\r\n            }\r\n\r\n            kml += '</Polygon>';\r\n            return {\r\n                success: true,\r\n                message: \"\",\r\n                data: kml\r\n            };\r\n\r\n        } else {\r\n            return {\r\n                success: false,\r\n                message: \"geojson does not have enough coordinates to build a polygon.\"\r\n            };\r\n        }\r\n    }\r\n\r\n    function addGeoJsonPolygon(geojson, name, id, overlayId, modifiers, zoom) {\r\n\r\n        var result = \"\",\r\n            coordinates,\r\n            fillColor,\r\n            lineColor,\r\n            lineThickness,\r\n            kml,\r\n            obj,\r\n            description,\r\n            style;\r\n\r\n        style = emp.geojsonParser.getStyle(geojson);\r\n\r\n        // The type of GeoJson is a Polygon. Parse the Polygon and add it to the\r\n        // map. A Polygon is expressed as a 3 dimensional array. We need to make\r\n        // sure\r\n        // before going in we have at least 2 dimensions before starting. A polygon\r\n        // 2nd dimension is first the border of the polygon followed by any interior\r\n        // rings of the polygon.\r\n        if ((geojson.coordinates !== undefined || geojson.coordinates !== null) && geojson.coordinates.length > 0) {\r\n\r\n            modifiers = modifiers || {};\r\n            fillColor = style.fillColor || modifiers.fillColor || \"88FFFFFF\";\r\n            lineColor = style.lineColor || modifiers.lineColor || \"FF000000\";\r\n            lineThickness = modifiers.lineThickness || 3.0;\r\n\r\n            lineColor = adjustColor(lineColor);\r\n            fillColor = adjustColor(fillColor);\r\n\r\n            if (style.description) {\r\n                description = style.description;\r\n            } else if (modifiers.description) {\r\n                description = modifiers.description;\r\n            }\r\n\r\n            name = style.name || name || \"\";\r\n\r\n            // get the polygon\r\n            coordinates = geojson.coordinates;\r\n\r\n            if (coordinates !== undefined && coordinates !== null) {\r\n\r\n                result = getPolygonKml(coordinates);\r\n\r\n                // Make sure that there weren't any errors processing the JSON prior to \r\n                // creating the kml.\r\n                if (result !== undefined && result.success !== false) {\r\n                    kml = '<Placemark>' +\r\n                        '<name><![CDATA[' + name + ']]></name>';\r\n\r\n                    if (description) {\r\n                        kml += '<description><![CDATA[' + description + ']]></description>';\r\n                    }\r\n\r\n                    kml += '<Style id=\"user-polygon\">' +\r\n                        '<LineStyle>' +\r\n                        '<color>' + lineColor + '</color>' +\r\n                        '<width>' + lineThickness + '</width>' +\r\n                        '</LineStyle>' +\r\n                        '<PolyStyle>' +\r\n                        '<color>' + fillColor + '</color>' +\r\n                        '</PolyStyle>' +\r\n                        '</Style>';\r\n\r\n                    kml += result.data;\r\n                    kml += '</Placemark>';\r\n\r\n                    obj = {\r\n                        kml: kml,\r\n                        name: name,\r\n                        id: id,\r\n                        overlayId: overlayId,\r\n                        data: geojson,\r\n                        format: 'geojson',\r\n                        properties: modifiers,\r\n                        zoom: zoom\r\n                    };\r\n\r\n                    result = {\r\n                        success: true,\r\n                        message: \"\",\r\n                        data: obj\r\n                    };\r\n\r\n                }\r\n\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"geojson does not have a valid coordinates.  Coordinates are null. \"\r\n                };\r\n            }\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"geojson does not have a valid coordinate\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n    From a set of geojson coordinates in a multi point configuration, get the geometry\r\n    KML needed to build the graphic.\r\n    */\r\n\r\n    function getMultiPointKml(coordinates) {\r\n        var kml,\r\n            point,\r\n            lat,\r\n            lon,\r\n            result,\r\n            overallResult = null,\r\n            coordinateString,\r\n            i,\r\n            altitude;\r\n\r\n        kml = '<MultiGeometry>';\r\n\r\n        // Loop through each coordinate and get the lat/lons\r\n        // to build a line string we pass to our renderer\r\n        for (i = 0; i < coordinates.length; i += 1) {\r\n\r\n            point = coordinates[i];\r\n\r\n            if (point !== null) {\r\n                if (point.length >= 2) {\r\n                    lat = point[1];\r\n                    lon = point[0];\r\n\r\n                    if (point.length === 3) {\r\n                        altitude = point[2];\r\n                        coordinateString = lon + \",\" + lat + \",\" + altitude;\r\n                    } else {\r\n                        coordinateString = lon + \",\" + lat;\r\n                    }\r\n\r\n                    kml += '<Point>' +\r\n                        '<coordinates>' + coordinateString + '</coordinates>' +\r\n                        '</Point>';\r\n                } else {\r\n                    result = {\r\n                        success: false,\r\n                        message: \"A portion of this geojson does not have a valid coordinate.\"\r\n                    };\r\n                }\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"A portion of this geojson does not have a valid coordinate.\"\r\n                };\r\n            }\r\n\r\n            if (overallResult === null && result !== undefined && result.success === false) {\r\n                overallResult = result;\r\n            }\r\n        }\r\n\r\n        kml += '</MultiGeometry>';\r\n\r\n        if (overallResult === null) {\r\n            overallResult = {\r\n                success: true,\r\n                message: \"\",\r\n                data: kml\r\n            };\r\n        }\r\n\r\n        return overallResult;\r\n    }\r\n\r\n    /**\r\n    Converts a geojson multi point to KML.\r\n    */\r\n\r\n    function addGeoJsonMultiPoint(geojson, name, id, overlayId, modifiers, zoom) {\r\n        var iconUrl,\r\n            coordinates,\r\n            kml,\r\n            fillColor,\r\n            xOffset,\r\n            yOffset,\r\n            xUnits,\r\n            yUnits,\r\n            result,\r\n            obj,\r\n            iconObj,\r\n            description,\r\n            style;\r\n\r\n\r\n\r\n        if (geojson.coordinates !== undefined || geojson.coordinates !== null) {\r\n            coordinates = geojson.coordinates;\r\n\r\n            style = emp.geojsonParser.getStyle(geojson);\r\n\r\n            modifiers = modifiers || {};\r\n            fillColor = style.fillColor || modifiers.fillColor || \"FFFFFFFF\";\r\n            name = style.name || name || \"\";\r\n            iconUrl = modifiers.iconUrl || style.iconUrl;\r\n\r\n            // If no icon has been specified try to pull the default icon\r\n            // from the map environment.\r\n            if (!iconUrl) {\r\n\r\n                iconObj = emp.utilities.getDefaultIcon();\r\n\r\n                iconUrl = iconObj.iconUrl;\r\n                xOffset = iconObj.offset.x;\r\n                yOffset = 1 - iconObj.offset.y;\r\n                xUnits = iconObj.offset.xUnits;\r\n                yUnits = iconObj.offset.yUnits;\r\n            } else {\r\n                xOffset = modifiers.iconXOffset || 0;\r\n                yOffset = modifiers.iconYOffset || 0;\r\n                xUnits = modifiers.xUnits || \"pixels\";\r\n                yUnits = modifiers.yUnits || \"pixels\";\r\n            }\r\n\r\n            if (style.description) {\r\n                description = style.description;\r\n            } else if (modifiers.description) {\r\n                description = modifiers.description;\r\n            }\r\n\r\n            fillColor = adjustColor(fillColor);\r\n\r\n            if (coordinates !== undefined && coordinates !== null) {\r\n\r\n                fillColor = adjustColor(fillColor);\r\n                kml = '<Placemark>' +\r\n                    '<name><![CDATA[' + name + ']]></name>';\r\n\r\n                if (description) {\r\n                    kml += '<description><![CDATA[' + description + ']]></description>';\r\n                }\r\n\r\n                kml += '<Style id=\"s_clr-pushpin\">' +\r\n                    '<IconStyle>' +\r\n                    '<color>' + fillColor + '</color>' +\r\n                    '<scale>1.0</scale>' +\r\n                    '<Icon>' +\r\n                    '<href>' + iconUrl + '</href>' +\r\n                    '</Icon>' +\r\n                    '<hotSpot x=\"' + xOffset + '\" y=\"' + yOffset + '\" xunits=\"' + xUnits + '\" yunits=\"' + yUnits + '\"/>' +\r\n                    '</IconStyle>' +\r\n                    '</Style>';\r\n\r\n                result = getMultiPointKml(coordinates);\r\n\r\n                if (result.success) {\r\n                    kml += result.data;\r\n                    kml += '</Placemark>';\r\n\r\n                    obj = {\r\n                        kml: kml,\r\n                        name: name,\r\n                        id: id,\r\n                        overlayId: overlayId,\r\n                        data: geojson,\r\n                        format: 'geojson',\r\n                        properties: modifiers,\r\n                        zoom: zoom\r\n                    };\r\n\r\n                    result = {\r\n                        success: true,\r\n                        message: \"\",\r\n                        data: obj\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"geojson does not have any coordinates.\"\r\n                };\r\n            }\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"geojson does not have a valid coordinate\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /** \r\n    From a set of geojson coordinates configured in a multi line string pattern, get the\r\n    geometry KML that corresponds to the multi linen string.\r\n    */\r\n\r\n    function getMultiLineStringKml(lines) {\r\n        var kml,\r\n            i,\r\n            j,\r\n            result,\r\n            coordinates,\r\n            coordinateString = \"\",\r\n            point,\r\n            altitude,\r\n            endChar,\r\n            lat,\r\n            lon,\r\n            overallResult = null;\r\n\r\n        kml = '<MultiGeometry>';\r\n\r\n        for (i = 0; i < lines.length; i += 1) {\r\n            result = {};\r\n            coordinates = lines[i];\r\n            coordinateString = \"\";\r\n\r\n            if (coordinates !== null) {\r\n                // Loop through each coordinate and get the lat/lons\r\n                // to build a line string we pass to our renderer\r\n                for (j = 0; j < coordinates.length; j += 1) {\r\n                    point = coordinates[j];\r\n\r\n                    if (point !== null) {\r\n                        lat = point[1];\r\n                        lon = point[0];\r\n\r\n                        if (point.length >= 2) {\r\n                            // If we have 3 points, then we need to note\r\n                            // this\r\n                            // line has altitude. (3rd point is z value)\r\n                            // This\r\n                            // line will have to be extruded from the globe.\r\n                            if (point.length === 3) {\r\n                                altitude = point[2];\r\n                                coordinateString = coordinateString + lon + \",\" + lat + \",\" + altitude;\r\n                                endChar = (j !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                                coordinateString = coordinateString + endChar;\r\n                            } else {\r\n                                coordinateString = coordinateString + lon + \",\" + lat;\r\n                                endChar = (j !== (coordinates.length - 1)) ? \" \" : \"\";\r\n                                coordinateString = coordinateString + endChar;\r\n                            }\r\n                        } else {\r\n                            result = {\r\n                                success: false,\r\n                                message: \"A portion of this geojson does not have a valid coordinate.\"\r\n                            };\r\n                        }\r\n                    } else {\r\n                        result = {\r\n                            success: false,\r\n                            message: \"A portion of this geojson does not have a valid coordinate.\"\r\n                        };\r\n                    }\r\n\r\n                    if (overallResult === null && result !== undefined && result.success === false) {\r\n                        overallResult = result;\r\n                    }\r\n                }\r\n\r\n                if (result !== undefined && result.success !== false) {\r\n                    kml += '<LineString>' +\r\n                        '<tessellate>1</tessellate>' +\r\n                        '<coordinates>' + coordinateString + '</coordinates>' +\r\n                        '</LineString>';\r\n                }\r\n\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"geojson does not have any coordinates.\"\r\n                };\r\n            }\r\n\r\n            if (overallResult === null && result !== undefined && result.success === false) {\r\n                overallResult = result;\r\n            }\r\n        }\r\n\r\n        kml = kml + '</MultiGeometry>';\r\n\r\n        if (overallResult === null) {\r\n            overallResult = {\r\n                success: true,\r\n                message: \"\",\r\n                data: kml\r\n            };\r\n        }\r\n\r\n        return overallResult;\r\n    }\r\n\r\n    function addGeoJsonMultiLineString(geojson, name, id, overlayId, modifiers, zoom) {\r\n\r\n        var result,\r\n            lines,\r\n            kml,\r\n            lineColor,\r\n            obj,\r\n            description,\r\n            style;\r\n\r\n\r\n        if (geojson.coordinates !== undefined || geojson.coordinates !== null) {\r\n\r\n            style = emp.geojsonParser.getStyle(geojson);\r\n            modifiers = modifiers || {};\r\n            lineColor = style.lineColor || modifiers.lineColor || \"FF000000\";\r\n            //lineThickness = modifiers.lineThickness || 3.0;\r\n\r\n            lines = geojson.coordinates;\r\n\r\n            lineColor = adjustColor(lineColor);\r\n\r\n            name = style.name || name || \"\";\r\n\r\n            if (style.description) {\r\n                description = style.description;\r\n            } else if (modifiers.description) {\r\n                description = modifiers.description;\r\n            }\r\n\r\n            if (lines !== null) {\r\n\r\n                kml = '<Placemark>' +\r\n                    '<name><![CDATA[' + name + ']]></name>' +\r\n                    '<description><![CDATA[' + description + ']]></description>' +\r\n                    '<Style id=\"bufferLineStyle\">' +\r\n                    '<LineStyle>' +\r\n                    '<color>' + lineColor + '</color>' +\r\n                    '<width>' + 4 + '</width>' +\r\n                    '</LineStyle>' +\r\n                    '</Style>';\r\n\r\n                result = getMultiLineStringKml(lines);\r\n\r\n                if (result.success) {\r\n                    kml += result.data;\r\n                    kml += '</Placemark>';\r\n\r\n                    obj = {\r\n                        kml: kml,\r\n                        name: name,\r\n                        id: id,\r\n                        overlayId: overlayId,\r\n                        data: geojson,\r\n                        format: 'geojson',\r\n                        properties: modifiers,\r\n                        zoom: zoom\r\n                    };\r\n\r\n                    result = {\r\n                        success: true,\r\n                        message: \"\",\r\n                        data: obj\r\n                    };\r\n                }\r\n\r\n\r\n            } else {\r\n                result = {\r\n                    success: false,\r\n                    message: \"There are no lines within this MultiLineString.\"\r\n                };\r\n            }\r\n\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"This MultiLineString geojson does not have an coordinates\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    function getMultiPolygonKml(polygons) {\r\n        var kml = '<MultiGeometry>',\r\n            i,\r\n            len = polygons.length,\r\n            result;\r\n        for (i = 0; i < len; i += 1) {\r\n            result = getPolygonKml(polygons[i]);\r\n            if (!result.success) {\r\n                return result;\r\n            }\r\n            kml += result.data;\r\n        }\r\n        kml += \"</MultiGeometry>\";\r\n        return {\r\n            success: true,\r\n            message: \"\",\r\n            data: kml\r\n        };\r\n    }\r\n\r\n    function addGeoJsonMultiPolygon(geojson, name, id, overlayId, description, modifiers, zoom) {\r\n\r\n        var result,\r\n            polygons,\r\n            fillColor,\r\n            lineColor,\r\n            lineThickness,\r\n            kml,\r\n            obj,\r\n            style;\r\n\r\n        // The type of GeoJson is a Polygon. Parse the Polygon and add it to the\r\n        // map. A Polygon is expressed as a 3 dimensional array. We need to make\r\n        // sure\r\n        // before going in we have at least 2 dimensions before starting. A polygon\r\n        // 2nd dimension is first the border of the polygon followed by any interior\r\n        // rings of the polygon.\r\n        if ((geojson.coordinates !== undefined || geojson.coordinates !== null) && geojson.coordinates.length > 0) {\r\n\r\n            style = emp.geojsonParser.getStyle(geojson);\r\n            modifiers = modifiers || {};\r\n            fillColor = style.fillColor || modifiers.fillColor || \"88000000\";\r\n            lineColor = style.lineColor || modifiers.lineColor || \"FF000000\";\r\n            lineThickness = modifiers.lineThickness || 3.0;\r\n\r\n            if (style.description) {\r\n                description = style.description;\r\n            } else if (modifiers.description) {\r\n                description = modifiers.description;\r\n            }\r\n\r\n            name = style.name || name || \"\";\r\n\r\n            kml = \"<Placemark>\";\r\n            kml += '<name><![CDATA[' + name + ']]></name>';\r\n            kml += \"<description><![CDATA[\" + description + \"]]></description>\";\r\n            kml += \"<Style id='bufferLineStyle'>\";\r\n            kml += \"<LineStyle>\";\r\n            kml += \"<color>\" + lineColor + \"</color>\";\r\n            kml += \"<width>\" + lineThickness + \"</width>\";\r\n            kml += \"</LineStyle>\";\r\n            kml += \"<PolyStyle>\";\r\n            kml += \"<color>\" + fillColor + \"</color>\";\r\n            kml += \"</PolyStyle>\";\r\n            kml += \"</Style>\";\r\n\r\n            polygons = geojson.coordinates;\r\n            result = getMultiPolygonKml(polygons);\r\n\r\n            if (result.success) {\r\n                kml += result.data;\r\n                kml += \"</Placemark>\";\r\n\r\n                obj = {\r\n                    kml: kml,\r\n                    name: name,\r\n                    id: id,\r\n                    overlayId: overlayId,\r\n                    data: geojson,\r\n                    format: 'geojson',\r\n                    properties: modifiers,\r\n                    zoom: zoom\r\n                };\r\n\r\n                result = {\r\n                    success: true,\r\n                    message: \"\",\r\n                    data: obj\r\n                };\r\n            }\r\n\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"geojson does not have a valid coordinate\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n    /**\r\n    Produces the KML Geometry needed from geoJSON coordinates and a geoJSON type.  \r\n    */\r\n\r\n    function getGeomtryCollectionKml(type, coordinates) {\r\n        var result,\r\n            kml;\r\n\r\n        if (type !== null) {\r\n\r\n            switch (type.toLowerCase()) {\r\n                case \"point\":\r\n                    result = getPointKml(coordinates);\r\n                    if (result.success) {\r\n                        kml = result.data;\r\n                    }\r\n                    break;\r\n                case \"linestring\":\r\n                    result = getLineStringKml(coordinates);\r\n                    if (result.success) {\r\n                        kml = result.data;\r\n                    }\r\n                    break;\r\n                case \"polygon\":\r\n                    result = getPolygonKml(coordinates);\r\n                    if (result.success) {\r\n                        kml = result.data;\r\n                    }\r\n                    break;\r\n                case \"multipoint\":\r\n                    result = getMultiPointKml(coordinates);\r\n                    if (result.success) {\r\n                        kml = result.data;\r\n                    }\r\n                    break;\r\n                case \"multilinestring\":\r\n                    result = getMultiLineStringKml(coordinates);\r\n                    if (result.success) {\r\n                        kml = result.data;\r\n                    }\r\n                    break;\r\n                case \"multipolygon\":\r\n                    result = getMultiPolygonKml(coordinates);\r\n                    if (result.success) {\r\n                        kml = result.data;\r\n                    }\r\n                    break;\r\n                case \"geometrycollection\":\r\n                    kml = '<MultiGeometry>';\r\n                    result = getGeomtryCollectionKml(coordinates);\r\n                    if (result.success) {\r\n                        kml += result.data;\r\n                    }\r\n                    kml += '</MultiGeometry>';\r\n                    break;\r\n                default:\r\n                    result = {\r\n                        success: false,\r\n                        message: \"Unssupported GeoJson type. Skipping Geometry.\"\r\n                    };\r\n                    break;\r\n            }\r\n\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"Undefined type in GeometryCollection. Skipping Geometry.\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    function addGeoJsonFeature(geojson, name, id, overlayId, modifiers, zoom) {\r\n\r\n        var geometry,\r\n            properties,\r\n            coloredRow,\r\n            result,\r\n            kml,\r\n            coordinates,\r\n            fillColor,\r\n            lineColor,\r\n            lineThickness,\r\n            iconUrl,\r\n            xOffset,\r\n            yOffset,\r\n            xUnits,\r\n            yUnits,\r\n            obj,\r\n            iconObj,\r\n            propertyName,\r\n            description,\r\n            style;\r\n\r\n        style = emp.geojsonParser.getStyle(geojson);\r\n        modifiers = modifiers || {};\r\n        fillColor = style.fillColor || modifiers.fillColor || \"88000000\";\r\n        lineColor = style.lineColor || modifiers.lineColor || \"FF000000\";\r\n        lineThickness = modifiers.lineThickness || 3.0;\r\n\r\n        iconUrl = modifiers.iconUrl || style.iconUrl;\r\n\r\n        // If no icon has been specified try to pull the default icon\r\n        // from the map environment.\r\n        if (!iconUrl) {\r\n\r\n            iconObj = emp.utilities.getDefaultIcon();\r\n\r\n            iconUrl = iconObj.iconUrl;\r\n            xOffset = iconObj.offset.x;\r\n            yOffset = 1 - iconObj.offset.y;\r\n            xUnits = iconObj.offset.xUnits;\r\n            yUnits = iconObj.offset.yUnits;\r\n        } else {\r\n            xOffset = modifiers.iconXOffset || 0;\r\n            yOffset = modifiers.iconYOffset || 0;\r\n            xUnits = modifiers.xUnits || \"pixels\";\r\n            yUnits = modifiers.yUnits || \"pixels\";\r\n        }\r\n\r\n        lineColor = geEngine.utils.adjustColor(lineColor);\r\n        fillColor = geEngine.utils.adjustColor(fillColor);\r\n\r\n        if (style.description) {\r\n            description = style.description;\r\n        } else if (modifiers.description) {\r\n            description = modifiers.description;\r\n        }\r\n\r\n        name = style.name || name || \"\";\r\n\r\n        // Make sure the type is a feature which is what we are checking\r\n        // for.  \r\n        if (geojson !== undefined && geojson !== null) {\r\n\r\n\r\n            // Get the geometry inside the feature.  This is what will be drawn.            \r\n            geometry = geojson.geometry;\r\n\r\n            // Get the properties inside this feature.  This will go into the description.\r\n            properties = geojson.properties; //properties populated in emp.validation\r\n\r\n\r\n\r\n            if (modifiers.popupContentHTML) {\r\n                description = modifiers.popupContentHTML;\r\n            } else if (properties !== null) {\r\n                // Build a table from the description.\r\n                if (description) {\r\n                    description = description + \"<br/><table border=\\\"1\\\" cellpadding=\\\"2\\\" cellspacing=\\\"0\\\" width=100%>\";\r\n                } else {\r\n                    description = \"<br/><table border=\\\"1\\\" cellpadding=\\\"2\\\" cellspacing=\\\"0\\\" width=100%>\";\r\n                }\r\n\r\n                coloredRow = false;\r\n\r\n                for (propertyName in properties) {\r\n                    if (properties.hasOwnProperty(propertyName)) {\r\n                        description = description + \"<tr \" + (coloredRow ? \" bgcolor=\\\"#F0F0F0\\\">\" : \">\");\r\n                        description = description + \"<td>\";\r\n                        description = description + \"<b>\";\r\n                        description = description + propertyName;\r\n                        description = description + \"</b>\";\r\n                        description = description + \"</td>\";\r\n                        description = description + \"<td>\";\r\n                        description = description + properties[propertyName];\r\n                        description = description + \"</td>\";\r\n                        description = description + \"</tr>\";\r\n                        coloredRow = !coloredRow;\r\n                    }\r\n                }\r\n                description = description + \"</table>\";\r\n            }\r\n\r\n            // Get the coordinates of the geometry;\r\n            coordinates = geometry.coordinates;\r\n\r\n            switch (geometry.type.toLowerCase()) {\r\n                case \"point\":\r\n                    result = getPointKml(coordinates);\r\n                    break;\r\n                case \"linestring\":\r\n                    result = getLineStringKml(coordinates);\r\n                    break;\r\n                case \"polygon\":\r\n                    result = getPolygonKml(coordinates);\r\n                    break;\r\n                case \"multipoint\":\r\n                    result = getMultiPointKml(coordinates);\r\n                    break;\r\n                case \"multilinestring\":\r\n                    result = getMultiLineStringKml(coordinates);\r\n                    break;\r\n                case \"multipolygon\":\r\n                    result = getMultiPolygonKml(coordinates);\r\n                    break;\r\n                case \"geometrycollection\":\r\n                    result = getGeomtryCollectionKml(coordinates);\r\n                    break;\r\n                default:\r\n                    result = {\r\n                        success: false,\r\n                        message: \"Unsupported GeoJson type. Skipping Geometry.\"\r\n                    };\r\n                    break;\r\n            }\r\n\r\n            if (result.success) {\r\n                kml = '<Placemark>' +\r\n                    '<name><![CDATA[' + name + ']]></name>' +\r\n                    '<description><![CDATA[' + description + ']]></description>' +\r\n                    '<Style id=\"geomcollection\">' +\r\n                    '<LineStyle>' +\r\n                    '<color>' + lineColor + '</color>' +\r\n                    '<width>' + lineThickness + '</width>' +\r\n                    '</LineStyle>' +\r\n                    '<PolyStyle>' +\r\n                    '<color>' + fillColor + '</color>' +\r\n                    '</PolyStyle>' +\r\n                    '<IconStyle>' +\r\n                    '<scale>1.0</scale>' +\r\n                    '<Icon>' +\r\n                    '<href>' + iconUrl + '</href>' +\r\n                    '</Icon>' +\r\n                    '<hotSpot x=\"' + xOffset + '\" y=\"' + yOffset + '\" xunits=\"' + xUnits + '\" yunits=\"' + yUnits + '\"/>' +\r\n                    '</IconStyle>' +\r\n                    '</Style>';\r\n                kml += result.data;\r\n                kml += '</Placemark>';\r\n\r\n                obj = {\r\n                    kml: kml,\r\n                    name: name,\r\n                    id: id,\r\n                    overlayId: overlayId,\r\n                    data: geojson,\r\n                    format: 'geojson',\r\n                    properties: modifiers,\r\n                    zoom: zoom\r\n                };\r\n\r\n                result = {\r\n                    success: true,\r\n                    message: \"\",\r\n                    data: obj\r\n                };\r\n            }\r\n\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"GeoJson is either null or not of the correct type.\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Adds a GeoJson FeatureCollection object to the map.  Feature collection is a\r\n     * logically grouped container of Features.  A FeatureCollection only contains Features,\r\n     * so there has to be a number of Features defined and populated for the Json to parse\r\n     * correctly.\r\n     *\r\n     * @param geojson the FeatureCollection Json formatted to the GeoJson 1.0 specification\r\n     * @param name The name of the containing effort id used to group the Features.  The Features\r\n     * will be named after this indexed by the order they appear in the FeatureCollection.\r\n     * @param description The data that will appear in the bubble when clicked on in Google Maps.\r\n     * @param modifiers Can contain line, fill, colors, offsets, iconUrls.\r\n     * @returns {String}\r\n     */\r\n\r\n    function addGeoJsonFeatureCollection(geojson, name, id, overlayId, modifiers, zoom) {\r\n\r\n        var result,\r\n            len,\r\n            feature,\r\n            features,\r\n            i,\r\n            obj,\r\n            kml,\r\n            lineColor,\r\n            lineThickness,\r\n            fillColor,\r\n            iconUrl,\r\n            iconObj,\r\n            xOffset,\r\n            yOffset,\r\n            xUnits,\r\n            yUnits,\r\n            style;\r\n\r\n        if (geojson !== null && geojson.type === \"FeatureCollection\") {\r\n\r\n            style = emp.geojsonParser.getStyle(geojson);\r\n\r\n            modifiers = modifiers || {};\r\n            fillColor = style.fillColor || modifiers.fillColor || \"88000000\";\r\n            lineColor = style.lineColor || modifiers.lineColor || \"FF000000\";\r\n            lineThickness = modifiers.lineThickness || 3.0;\r\n\r\n            iconUrl = modifiers.iconUrl || style.iconUrl;\r\n\r\n            // If no icon has been specified try to pull the default icon\r\n            // from the map environment.\r\n            if (!iconUrl) {\r\n\r\n                iconObj = emp.utilities.getDefaultIcon();\r\n\r\n                iconUrl = iconObj.iconUrl;\r\n                xOffset = iconObj.offset.x;\r\n                yOffset = 1 - iconObj.offset.y;\r\n                xUnits = iconObj.offset.xUnits;\r\n                yUnits = iconObj.offset.yUnits;\r\n            } else {\r\n                xOffset = modifiers.iconXOffset || 0;\r\n                yOffset = modifiers.iconYOffset || 0;\r\n                xUnits = modifiers.xUnits || \"pixels\";\r\n                yUnits = modifiers.yUnits || \"pixels\";\r\n            }\r\n\r\n            lineColor = adjustColor(lineColor);\r\n            fillColor = adjustColor(fillColor);\r\n\r\n/*\r\n            if (style.description) {\r\n                description = style.description;\r\n            } else if (modifiers.description) {\r\n                description = modifiers.description;\r\n            }\r\n*/\r\n\r\n            name = style.name || name || \"\";\r\n\r\n            // Retrieve all the features in the feature collection\r\n            features = geojson.features;\r\n\r\n            if (features !== null) {\r\n\r\n\r\n                kml = \"<Folder>\" +\r\n                    \"<name><![CDATA[\" + name + \"]]></name>\" +\r\n                    \"<Style id='geomcollection'>\" +\r\n                    \"<LineStyle>\" +\r\n                    \"<color>\" + lineColor + \"</color>\" +\r\n                    \"<width>\" + lineThickness + \"</width>\" +\r\n                    \"</LineStyle>\" +\r\n                    \"<PolyStyle>\" +\r\n                    \"<color>\" + fillColor + \"</color>\" +\r\n                    \"</PolyStyle>\" +\r\n                    \"<IconStyle>\" +\r\n                    \"<scale>1.0</scale>\" +\r\n                    \"<Icon>\" +\r\n                    \"<href>\" + iconUrl + \"</href>\" +\r\n                    \"</Icon>\" +\r\n                    \"<hotSpot x='\" + xOffset + \"' y='\" + yOffset + \"' xunits='\" + xUnits + \"' yunits='\" + yUnits + \"'/>\" +\r\n                    \"</IconStyle>\" +\r\n                    \"</Style>\";\r\n\r\n\r\n                // Add the features to the overlay just created.\r\n                len = features.length;\r\n                for (i = 0; i < len; i += 1) {\r\n                    result = {};\r\n                    feature = features[i];\r\n\r\n                    // If the feature has properties, use them\r\n                    if (Object.keys(feature.properties).length !== 0) {\r\n                        modifiers = feature.properties;\r\n                    }\r\n\r\n                    result = addGeoJsonFeature(feature, name, id, overlayId, modifiers, zoom);\r\n\r\n                    if (result.success) {\r\n                        kml += result.data.kml;\r\n                    }\r\n                }\r\n\r\n                kml += \"</Folder>\";\r\n\r\n                obj = {\r\n                    kml: kml,\r\n                    name: name,\r\n                    id: id,\r\n                    overlayId: overlayId,\r\n                    data: geojson,\r\n                    format: \"geojson\",\r\n                    properties: modifiers,\r\n                    zoom: zoom\r\n                };\r\n\r\n                result = {\r\n                    success: true,\r\n                    message: \"\",\r\n                    data: obj\r\n                };\r\n            } else {\r\n                result = \"FeatureCollection contains no features.\";\r\n            }\r\n\r\n\r\n        } else {\r\n            result = \"GeoJson is either null or not of the correct type.\";\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Adds a GeoJson GeometryCollection.  A GeometryCollection can be any type\r\n     * of GeoJson geometry, point, line, polygon, multi-point, multi-linestring, multi-\r\n     * polygon, or another geometryCollection.  All graphics within the geometry\r\n     * Collection are related and grouped under an containing effort.  Names of each\r\n     * graphic are incremented by an index number in the order they are written\r\n     * in the Json.  Ids are renamed similarly.\r\n     *\r\n     * @param geojson\r\n     * @param name\r\n     * @param description\r\n     * @param modifiers\r\n     * @returns {String}\r\n     */\r\n\r\n    function addGeoJsonGeometryCollection(geojson, name, id, overlayId, modifiers, zoom) {\r\n        // Contains any error messages.  Returned at end of function.\r\n        var len,\r\n            i,\r\n            geometry,\r\n            type,\r\n            kml,\r\n            lineColor,\r\n            fillColor,\r\n            iconUrl,\r\n            iconObj,\r\n            xOffset,\r\n            yOffset,\r\n            xUnits,\r\n            yUnits,\r\n            coordinates,\r\n            result,\r\n            obj,\r\n            description,\r\n            style;\r\n\r\n        // Make sure geojson contains valid data for this type.\r\n        if (geojson !== null && geojson.type === 'GeometryCollection' &&\r\n            geojson.geometries !== undefined && geojson.geometries !== null) {\r\n\r\n            style = emp.geojsonParser.getStyle(geojson);\r\n            modifiers = modifiers || {};\r\n            fillColor = style.fillColor || modifiers.fillColor || \"88000000\";\r\n            lineColor = style.lineColor || modifiers.lineColor || \"FF000000\";\r\n            //lineThickness = modifiers.lineThickness || 3.0;\r\n            iconUrl = modifiers.iconUrl || style.iconUrl;\r\n\r\n            // If no icon has been specified try to pull the default icon\r\n            // from the map environment.\r\n            if (!iconUrl) {\r\n\r\n                iconObj = emp.utilities.getDefaultIcon();\r\n\r\n                iconUrl = iconObj.iconUrl;\r\n                xOffset = iconObj.offset.x;\r\n                yOffset = 1 - iconObj.offset.y;\r\n                xUnits = iconObj.offset.xUnits;\r\n                yUnits = iconObj.offset.yUnits;\r\n            } else {\r\n                xOffset = modifiers.iconXOffset || 0;\r\n                yOffset = modifiers.iconYOffset || 0;\r\n                xUnits = modifiers.xUnits || \"pixels\";\r\n                yUnits = modifiers.yUnits || \"pixels\";\r\n            }\r\n\r\n            lineColor = geEngine.utils.adjustColor(lineColor);\r\n            fillColor = geEngine.utils.adjustColor(fillColor);\r\n\r\n            if (style.description) {\r\n                description = style.description;\r\n            } else if (modifiers.description) {\r\n                description = modifiers.description;\r\n            }\r\n\r\n            name = style.name || name || \"\";\r\n\r\n            // Loop through all the geometries add add them to a multi-geometry kml.\r\n            // We interpret a geometry collection to be a group of related graphics\r\n            // That contain unique properties for a main container. All graphics are\r\n            // part of that main container.\r\n            len = geojson.geometries.length;\r\n\r\n            kml = '<Placemark>' +\r\n                '<name><![CDATA[' + name + ']]></name>' +\r\n                '<description><![CDATA[' + description + ']]></description>' +\r\n                '<Style id=\"geomcollection\">' +\r\n                '<LineStyle>' +\r\n                '<color>' + lineColor + '</color>' +\r\n                '<width>' + 3.0 + '</width>' +\r\n                '</LineStyle>' +\r\n                '<PolyStyle>' +\r\n                '<color>' + fillColor + '</color>' +\r\n                '</PolyStyle>' +\r\n                '<IconStyle>' +\r\n                '<scale>1.0</scale>' +\r\n                '<Icon>' +\r\n                '<href>' + iconUrl + '</href>' +\r\n                '</Icon>' +\r\n                '<hotSpot x=\"' + xOffset + '\" y=\"' + yOffset + '\" xunits=\"' + xUnits + '\" yunits=\"' + yUnits + '\"/>' +\r\n                '</IconStyle>' +\r\n                '</Style>' +\r\n                '<MultiGeometry>';\r\n\r\n            for (i = 0; i < len; i += 1) {\r\n                geometry = geojson.geometries[i];\r\n                type = geometry.type;\r\n                coordinates = geojson.geometries[i].coordinates;\r\n                result = getGeomtryCollectionKml(type, coordinates);\r\n                if (result.success) {\r\n                    kml += result.data;\r\n                }\r\n            }\r\n            kml = kml + '</MultiGeometry>' +\r\n                '</Placemark>';\r\n\r\n            obj = {\r\n                kml: kml,\r\n                name: name,\r\n                id: id,\r\n                overlayId: overlayId,\r\n                data: geojson,\r\n                format: 'geojson',\r\n                properties: modifiers,\r\n                zoom: zoom\r\n            };\r\n\r\n            result = {\r\n                success: true,\r\n                message: \"\",\r\n                data: obj\r\n            };\r\n\r\n        } else {\r\n            result = {\r\n                success: false,\r\n                message: \"GeoJson is either null or not of the correct type.\"\r\n            };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    return {\r\n\r\n        /**\r\n         * @memberOf emp.geojsonParser\r\n         * @description Converts an array of geojson objects to kml.  The returned object that can\r\n         * be passed to the data manager to be added to an overlay.\r\n         *\r\n         * @param {Array.object} batch an array of geojson objects that are of the format:\r\n         * @param {string} geojson geojson object\r\n         * @param {string} name the display name of the object\r\n         * @param {string} featureId the id of the object\r\n         * @param {parentId} parentId the folder the object should be in\r\n         * @param {string} description a description of the object, possibly in html\r\n         * @param {emp.typeLibrary.Feature.modifiersType} modifiers a Modifiers object that can have color, line, point and polygon information\r\n         * @return {object} The result of the operation in the following format.\r\n         *      {\r\n         *          success - true | false\r\n         *          message - If the success field is false this field contains the error message.\r\n         *          data - the converted kml data if the success field === true.\r\n         *      }\r\n         */\r\n        geojsonToKmlBatch: function(batch) {\r\n            var result,\r\n                type,\r\n                overallResult = null,\r\n                i,\r\n                length,\r\n                geojson,\r\n                name,\r\n                featureId,\r\n                parentId,\r\n                modifiers,\r\n                newBatch = [],\r\n                zoom;\r\n\r\n\r\n\r\n            // loop through each of the geojson objects and parse into kml, so that our engines\r\n            // can handle it.\r\n            length = batch.length;\r\n            for (i = 0; i < length; i += 1) {\r\n                try {\r\n\r\n                    name = batch[i].name || \"\";\r\n                    featureId = batch[i].featureId;\r\n                    parentId = batch[i].parentId || \"\";\r\n                    modifiers = batch[i].modifiers || {}; //changed modifier to properties\r\n                    zoom = batch[i].zoom || false;\r\n\r\n\r\n                    // get the Json from the batch.\r\n                    geojson = batch[i].data;\r\n\r\n                    // Check the type of geo Json and parse it into kml.\r\n                    if (geojson.type !== undefined || geojson.type !== null) {\r\n                        type = geojson.type;\r\n\r\n                        switch (type.toLowerCase()) {\r\n                            case \"point\":\r\n                                result = addGeoJsonPoint(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"linestring\":\r\n                                result = addGeoJsonLineString(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"polygon\":\r\n                                result = addGeoJsonPolygon(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"multipoint\":\r\n                                result = addGeoJsonMultiPoint(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"multilinestring\":\r\n                                result = addGeoJsonMultiLineString(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"multipolygon\":\r\n                                result = addGeoJsonMultiPolygon(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"geometrycollection\":\r\n                                result = addGeoJsonGeometryCollection(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"feature\":\r\n                                result = addGeoJsonFeature(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            case \"featurecollection\":\r\n                                result = addGeoJsonFeatureCollection(geojson, name, featureId, parentId,\r\n                                    modifiers, zoom);\r\n                                break;\r\n                            default:\r\n                                result = {\r\n                                    success: false,\r\n                                    message: \"Unsupported GeoJson type\"\r\n                                };\r\n                                break;\r\n                        }\r\n\r\n                        // Check to make sure the geojson was parsed correctly, and\r\n                        // the parameters were good.  If not do not add to the map, return an error.\r\n                        if (result.success === true) {\r\n                            newBatch.push(result.data);\r\n                            // Since this is a batch call, only report the first error that was found. Maintain\r\n                            // a separate variable for overall result\r\n                        } else if (overallResult === null) {\r\n                            overallResult = result;\r\n                        }\r\n                    } else {\r\n                        result = {\r\n                            success: false,\r\n                            message: \"Incorrectly formatted GeoJson\"\r\n                        };\r\n                        // Since this is a batch call, only report the first error that was found. Maintain\r\n                        // a separate variable for overall result\r\n                        if (overallResult === null) {\r\n                            overallResult = result;\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    result = {\r\n                        success: false,\r\n                        message: err.message\r\n                    };\r\n                    // Since this is a batch call, only report the first error that was found. Maintain\r\n                    // a separate variable for overall result\r\n                    if (overallResult === null) {\r\n                        overallResult = result;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Since this is a batch call, only report the first error that was found. Maintain\r\n            // a separate variable for overall result, which will not if anything failed.\r\n            if (overallResult === null) {\r\n                overallResult = {\r\n                    success: true,\r\n                    message: \"\",\r\n                    data: newBatch\r\n                };\r\n            }\r\n\r\n            return overallResult;\r\n        },\r\n\r\n        /**\r\n        Converts geojson to kml.  The returned object that can be passed to the data manager.\r\n        The returned object is in the format as follows:\r\n\r\n        { \r\n            success: (bool),\r\n            message: (string),\r\n            data: {[\r\n                kml: (string),\r\n                id: (string),\r\n                                                \r\n                                                \r\n                overlayId: (string),\r\n                name: (string)]\r\n            }\r\n        }\r\n        */\r\n        geojsonToKml: function(geojson, name, id, overlayId, modifiers) {\r\n            var batch = [],\r\n                obj = {},\r\n                result;\r\n\r\n            try {\r\n                obj = {\r\n                    data: geojson,\r\n                    format: 'geojson',\r\n                    name: name,\r\n                    id: id,\r\n                    overlayId: overlayId,\r\n                    properties: modifiers\r\n                };\r\n                batch.push(obj);\r\n                result = this.geojsonToKmlBatch(batch);\r\n\r\n            } catch (err) {\r\n                result = {\r\n                    success: false,\r\n                    message: err.message\r\n                };\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        getStyle: function(geojson) {\r\n            var style = {},\r\n                argb;\r\n\r\n            if (geojson.properties) {\r\n                if (geojson.properties.style) {\r\n\r\n                    if (geojson.properties.style.lineStyle) {\r\n                        if (geojson.properties.style.lineStyle.color &&\r\n                            geojson.properties.style.lineStyle.color.r !== undefined &&\r\n                            geojson.properties.style.lineStyle.color.g !== undefined &&\r\n                            geojson.properties.style.lineStyle.color.b !== undefined &&\r\n                            geojson.properties.style.lineStyle.color.a !== undefined) {\r\n\r\n                            argb = armyc2.c2sd.renderer.utilities.Color.rgbToHexString(\r\n                                geojson.properties.style.lineStyle.color.r,\r\n                                geojson.properties.style.lineStyle.color.g,\r\n                                geojson.properties.style.lineStyle.color.b,\r\n                                geojson.properties.style.lineStyle.color.a).replace('#', '');\r\n\r\n                            style.lineColor = argb;\r\n                        }\r\n                    }\r\n\r\n                    if (geojson.properties.style.polyStyle) {\r\n                        if (geojson.properties.style.polyStyle.color &&\r\n                            geojson.properties.style.polyStyle.color.r !== undefined &&\r\n                            geojson.properties.style.polyStyle.color.g !== undefined &&\r\n                            geojson.properties.style.polyStyle.color.b !== undefined &&\r\n                            geojson.properties.style.polyStyle.color.a !== undefined) {\r\n\r\n                            argb = armyc2.c2sd.renderer.utilities.Color.rgbToHexString(\r\n                                geojson.properties.style.polyStyle.color.r,\r\n                                geojson.properties.style.polyStyle.color.g,\r\n                                geojson.properties.style.polyStyle.color.b,\r\n                                geojson.properties.style.polyStyle.color.a).replace('#', '');\r\n\r\n                            style.fillColor = argb;\r\n                        }\r\n                    }\r\n\r\n                    if (geojson.properties.style.iconStyle) {\r\n                        if (geojson.properties.style.iconStyle.url) {\r\n                            style.url = geojson.properties.style.iconStyle.url;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (geojson.properties.name) {\r\n                    style.name = geojson.properties.name;\r\n                }\r\n\r\n                if (geojson.properties.id) {\r\n                    style.id = geojson.properties.id;\r\n                }\r\n\r\n                if (geojson.properties.description) {\r\n                    style.description = geojson.properties.description;\r\n                }\r\n\r\n                // Don't do anything here.  This is just in for future work.\r\n                if (geojson.properties.timePrimitive) {\r\n                    if (geojson.properties.timePrimitive.timeSpan) {\r\n                        if (geojson.properties.timePrimitive.timeSpan.begin &&\r\n                            geojson.properties.timePrimitive.timeSpan.end) {\r\n                            // Placeholder\r\n                        }\r\n                    }\r\n\r\n                    if (geojson.properties.timePrimitive.timestamp) { /*Placeholder*/ }\r\n                }\r\n            }\r\n\r\n            return style;\r\n        }\r\n    };\r\n}());","/*global emp, console, window */\r\n/* eslint-disable no-console */\r\n/*\r\n * ERROR Handler.\r\n */\r\n/**\r\n * Error Handler\r\n *\r\n * @namespace  errorHandler\r\n * @memberOf emp\r\n */\r\nemp.errorHandler = (function () {\r\n  /**\r\n   * Level of Debug.\r\n   * 0 = Normal Operation. No console output\r\n   * 1 = Widget Developer Output. Generally centered around TypeLibrary Errors or Transaction failures.\r\n   * 2 = Map Engine Developer Output. All the above plus minor or recoverable errors, anonymous error from the engine\r\n   * 3 = CPCE Developer. All Errors get written to console and evented out\r\n   *\r\n   * @type {number}\r\n   */\r\n  var debugLevel = 3;\r\n  var logJSONArray = [];\r\n\r\n  // Avoid console errors in browsers that lack a console.\r\n  (function () {\r\n    var method,\r\n      placeholder = function () {\r\n      },\r\n      methods = [\r\n        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\r\n        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\r\n        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\r\n        'timeStamp', 'trace', 'warn'\r\n      ],\r\n      len = methods.length,\r\n      console = (window.console = window.console || {});\r\n\r\n    while (len--) {\r\n      method = methods[len];\r\n\r\n      // Only substitute undefined methods with the placeholder function.\r\n      if (!console[method]) {\r\n        console[method] = placeholder;\r\n      }\r\n    }\r\n  }());\r\n\r\n  function enumerateError(error) {\r\n    var ecopy = {\r\n      name: error.name,\r\n      message: error.message\r\n    };\r\n    if (error.fileName) {\r\n      ecopy.file = error.fileName;\r\n    }\r\n    if (error.lineNumber) {\r\n      ecopy.line = error.lineNumber;\r\n    }\r\n    if (error.columnNumber) {\r\n      ecopy.column = error.columnNumber;\r\n    }\r\n    if (error.stack) {\r\n      ecopy.stack = error.stack;\r\n    }\r\n\r\n    return ecopy;\r\n  }\r\n\r\n  var publicInterface = {\r\n    /**\r\n     * For entering errors that are correctly reported.\r\n     * @memberof emp.errorHandler\r\n     * @public\r\n     * @param  {object} args\r\n     * @param {string} args.message\r\n     * @param {number} [args.level]\r\n     * @param {object} args.jsError JavaScript error object\r\n     */\r\n    log: function (args) {\r\n      /**\r\n       * Level of error\r\n       * @enum {number}\r\n       * 0 = Info\r\n       * 1 = Minor\r\n       * 2 = Major\r\n       * 3 = Catastrophic\r\n       */\r\n\r\n      var jsError = {},\r\n        success = true,\r\n        environment,\r\n        msgLog = {},\r\n        jsErrorStr = \"\";\r\n\r\n      if (typeof args.level === 'undefined') {\r\n        args.level = emp.typeLibrary.Error.level.MAJOR;\r\n\r\n      } else if (args.level !== emp.typeLibrary.Error.level.CATASTROPHIC && args.level !== emp.typeLibrary.Error.level.MAJOR && args.level !== emp.typeLibrary.Error.level.MINOR && args.level !== emp.typeLibrary.Error.level.INFO) {\r\n        args.level = emp.typeLibrary.Error.level.MAJOR;\r\n\r\n      }\r\n      if (emp.util.isEmptyString(args.message)) {\r\n\r\n        args.message = \"No Message Provided\";\r\n      }\r\n      if (args.hasOwnProperty(\"jsError\")) {\r\n        jsError = enumerateError(args.jsError);\r\n        msgLog.jsError = jsError;\r\n\r\n        try {\r\n          jsErrorStr = JSON.stringify(jsError);\r\n          //jsErrorStr = encodeURIComponent(jsErrorStr);\r\n        } catch (e) {\r\n          jsErrorStr = \"Unable to parse script error\";\r\n          console.error(e);\r\n        }\r\n      }\r\n      if (jsErrorStr === \"{}\") {\r\n        jsErrorStr = \"\";\r\n      }\r\n      msgLog.jsErrorStr = jsErrorStr;\r\n\r\n      msgLog.message = args.message;\r\n\r\n      jsErrorStr = jsErrorStr.replace(/\\\\n/g, '\\n');\r\n      jsErrorStr = jsErrorStr.replace(/,/g, ',\\n');\r\n      jsErrorStr = jsErrorStr.replace('\"stack\":', '\"stack\":\\n');\r\n\r\n      switch (args.level) {\r\n\r\n        case emp.typeLibrary.Error.level.CATASTROPHIC:\r\n          msgLog.level = \"CATASTROPHIC\";\r\n          console.error(args.message + \"\\n\" + jsErrorStr);\r\n          break;\r\n        case emp.typeLibrary.Error.level.MAJOR:\r\n          msgLog.level = \"MAJOR\";\r\n          console.error(args.message + \"\\n\" + jsErrorStr);\r\n          break;\r\n        case emp.typeLibrary.Error.level.MINOR:\r\n          console.warn(args.message + \"\\n\" + jsErrorStr);\r\n          msgLog.level = \"MINOR\";\r\n          break;\r\n        case emp.typeLibrary.Error.level.INFO:\r\n          console.log(args.message + \"\\n\" + jsErrorStr);\r\n          msgLog.level = \"INFO\";\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n      logJSONArray.unshift(msgLog);\r\n\r\n      if (logJSONArray.length > 100) {\r\n        console.log(\"Log JSON Array has reached its max length. The oldest error has been removed.\");\r\n        logJSONArray.pop();\r\n      }\r\n\r\n      try {\r\n        environment = emp.environment.get();\r\n        if (environment !== undefined && environment !== null && environment.hasOwnProperty(\"pubSub\")) {\r\n          environment.pubSub.publish({\r\n            message: {\r\n              message: args.message,\r\n              error: jsError\r\n            },\r\n            channel: \"emp.error\"\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error(e);\r\n        success = false;\r\n      }\r\n\r\n      return success;\r\n    },\r\n    /**\r\n     * Set debug level\r\n     * @method\r\n     * @public\r\n     * @memberOf emp.errorHandler\r\n     * @param {string} args\r\n     */\r\n    set: function (args) {\r\n      debugLevel = args;\r\n    },\r\n    /**\r\n     * Gets the debug level\r\n     * @returns {number}\r\n     */\r\n    get: function () {\r\n      return debugLevel;\r\n    },\r\n    /**\r\n     * getMessages\r\n     * @method\r\n     * @public\r\n     * @memberOf  emp.errorHandler\r\n     */\r\n    getMessages: function () {\r\n      return logJSONArray;\r\n    },\r\n    /**\r\n     * clearLog\r\n     * @method\r\n     * @public\r\n     * @memberOf  emp.errorHandler\r\n     */\r\n    clearLog: function () {\r\n      logJSONArray = [];\r\n    },\r\n    /**\r\n     * exportLog\r\n     * @method\r\n     * @public\r\n     * @memberOf  emp.errorHandler\r\n     */\r\n    exportLog: function () {\r\n      var jsonOutputStr = JSON.stringify(logJSONArray);\r\n\r\n      function dataUrl(txtData) {\r\n        return \"data:x-application/text,\" + escape(txtData);\r\n      }\r\n\r\n      window.open(dataUrl(jsonOutputStr), true, \"height=1,width=1\");\r\n    }\r\n  };\r\n  return publicInterface;\r\n}());\r\n/* eslint-enable no-console */\r\n","var emp = window.emp || {};\r\n\r\n/**\r\n * Queue used to buffer the core application from locking the process thread with back to back transaction calls\r\n * @namespace\r\n * @memberof emp\r\n */\r\nemp.transactionQueue = (function() {\r\n  var mapInstanceData = function(args) {\r\n    return {\r\n      mapInstanceId: args.mapInstanceId,\r\n      transQueue: [],\r\n      running: false,\r\n      pauseCnt: 1,\r\n      bViewSetProcessed: false\r\n    };\r\n  };\r\n  /**\r\n   * Hash of transactions to process\r\n   * @private\r\n   */\r\n  var transHash = {},\r\n    outstandingTimer,\r\n    outstandingTimeout = 5000,\r\n    listeners = new emp.utilities.Hash(),\r\n    oOutstandingTransaction = null,\r\n    oMapInstanceData = {},\r\n    oMapInstanceIdList = [];\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function outstandingTimerFunc() {\r\n    // If this timeout expires the transaction took to long.\r\n    // We post a warning if there is still an outstanding transaction.\r\n\r\n    if (oOutstandingTransaction) {\r\n      emp.typeLibrary.Error({\r\n        level: emp.typeLibrary.Error.level.MINOR,\r\n        message: \"A \" + oOutstandingTransaction.intent + \" transaction with \" +\r\n        (oOutstandingTransaction.items.length + oOutstandingTransaction.failures.length) +\r\n        \" items has timed out. (timeout: \" + (outstandingTimeout / 1000) + \" sec)\"\r\n      });\r\n      oOutstandingTransaction = null;\r\n      outstandingTimer = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   */\r\n  function runQueue() {\r\n    var transaction;\r\n    var oInstanceData;\r\n    //var bNotDone = true;\r\n    //var iNextIndex = oMapInstanceListIndex;\r\n    var iListSize = oMapInstanceIdList.length;\r\n    var nextQueue;\r\n\r\n    if ((iListSize > 0) && (oOutstandingTransaction === null)) {\r\n\r\n\r\n      nextQueue = findQueueWithOldestTransaction();\r\n\r\n      while (nextQueue) {\r\n\r\n        oInstanceData = oMapInstanceData[nextQueue];\r\n\r\n        if (oInstanceData &&\r\n          (oInstanceData.running === true) &&\r\n          (oInstanceData.transQueue.length > 0)) {\r\n\r\n          // get the oldest item in the queue\r\n          transaction = oInstanceData.transQueue.shift();\r\n          // clean the id out of the transHash used for quick queue lookups\r\n          delete transHash[transaction.transactionId];\r\n\r\n          switch (transaction.intent) {\r\n            case emp.intents.control.DRAW_BEGIN:\r\n            case emp.intents.control.EDIT_BEGIN:\r\n            case emp.intents.control.WMS_ADD:\r\n              // Just let these transactions thru.\r\n              break;\r\n            default:\r\n              oOutstandingTransaction = transaction;\r\n              outstandingTimer = setTimeout(outstandingTimerFunc, outstandingTimeout);\r\n              break;\r\n          }\r\n\r\n          if (transaction.intent === emp.intents.control.VIEW_SET) {\r\n            oInstanceData.bViewSetProcessed = true;\r\n          }\r\n\r\n          // run the transaction\r\n          transaction.run();\r\n          //bNotDone = false;\r\n\r\n        }\r\n        nextQueue = findQueueWithOldestTransaction();\r\n      }\r\n    }\r\n\r\n    // repeat with break in between code execution to avoid locking thread\r\n    // with back to back calls in a loop\r\n    setTimeout(runQueue, 50);\r\n  }\r\n\r\n  /**\r\n   * Looks at the first item in each transaction queue of each map instance\r\n   * and determines the next transaction to call.  If the queues are empty\r\n   * then, the method will return undefined.\r\n   *\r\n   */\r\n  function findQueueWithOldestTransaction() {\r\n    var mapInstanceId,\r\n      lowestTime,\r\n      queueId,\r\n      transaction,\r\n      instanceData;\r\n\r\n    // Get the first item in each map queue.\r\n    // Find the one with the earliest creation time.\r\n    for (mapInstanceId in oMapInstanceData) {\r\n\r\n      // Look at this map instance's queue.\r\n      instanceData = oMapInstanceData[mapInstanceId];\r\n\r\n      // if the transaction queue is not empty, then pull the first transaction\r\n      if (instanceData &&\r\n        instanceData.running &&\r\n        instanceData.transQueue.length > 0) {\r\n\r\n        transaction = instanceData.transQueue[0];\r\n\r\n        // check to make sure that transaction was pulled,\r\n        // if the lowestTime has not been set yet, just pull that\r\n        if (transaction && (!lowestTime || transaction.creationTime < lowestTime)) {\r\n\r\n          lowestTime = transaction.creationTime;\r\n          queueId = mapInstanceId;\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    return queueId;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param transactionId\r\n   * @returns {boolean}\r\n   */\r\n  function cancelTransaction(transactionId) {\r\n    var transaction = transHash[transactionId],\r\n      oInstanceData,\r\n      success = false,\r\n      i,\r\n      len;\r\n\r\n    // Look to see if the transaction is still sitting in the queue\r\n    if (transaction) {\r\n      oInstanceData = oMapInstanceData[transaction.mapInstanceId];\r\n      len = oInstanceData.transQueue.length;\r\n\r\n      for (i = 0; i < len; i++) {\r\n        if (oInstanceData.transQueue[i].transactionId === transactionId) {\r\n          // Remove the transaction for the queue\r\n          oInstanceData.transQueue.splice(i, 1);\r\n          // Remove the transaction from the hash\r\n          delete transHash[transactionId];\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      // If transaction was not found in queue, look to see if it is in process\r\n      // and a type that is cancelable\r\n      transaction = publicInterface.processHash[transactionId];\r\n      if (transaction) {\r\n        var o;\r\n        if (transaction.intent === emp.intents.control.DRAW_BEGIN) {\r\n          o = new emp.typeLibrary.Transaction({\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            mapInstanceId: transaction.mapInstanceId,\r\n            intent: emp.intents.control.DRAW_CANCEL,\r\n            source: transaction.source,\r\n            originChannel: transaction.originChannel,\r\n            items: [transaction.items[0]]\r\n          });\r\n          o.run();\r\n          success = true;\r\n        } else if (transaction.intent === emp.intents.control.EDIT_BEGIN) {\r\n          o = new emp.typeLibrary.Transaction({\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            intent: emp.intents.control.EDIT_CANCEL,\r\n            mapInstanceId: transaction.mapInstanceId,\r\n            source: transaction.source,\r\n            originChannel: transaction.originChannel,\r\n            items: [transaction.items[0]]\r\n          });\r\n          o.run();\r\n          success = true;\r\n        } else {\r\n          emp.typeLibrary.Error({\r\n            message: \"The \" + transaction.intent + \" transaction with the id '\" + transactionId + \"' was found, and could not be cancelled.\"\r\n          });\r\n        }\r\n      } else {\r\n        emp.typeLibrary.Error({\r\n          message: \"No transaction with the id '\" + transactionId + \"' could be found.  The transaction could not be cancelled.\"\r\n        });\r\n      }\r\n    }\r\n    return success;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param transactionId\r\n   * @returns {boolean}\r\n   */\r\n  function endTransaction(transactionId) {\r\n    var transaction = transHash[transactionId],\r\n      oInstanceData,\r\n      success = false,\r\n      len;\r\n\r\n    if (transaction) {\r\n      oInstanceData = oMapInstanceData[transaction.mapInstanceId];\r\n      len = oInstanceData.transQueue.length;\r\n\r\n      for (var i = 0; i < len; i++) {\r\n        if (oInstanceData.transQueue[i].transactionId === transactionId) {\r\n          // Remove the transaction for the queue\r\n          oInstanceData.transQueue.splice(i, 1);\r\n          // Remove the transaction from the hash\r\n          delete transHash[transactionId];\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      // If transaction was not found in queue, look to see if it is in process\r\n      // and a type that is cancelable\r\n      transaction = publicInterface.processHash[transactionId];\r\n      if (transaction) {\r\n        var o;\r\n        if (transaction.intent === emp.intents.control.DRAW_BEGIN) {\r\n          o = new emp.typeLibrary.Transaction({\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            intent: emp.intents.control.DRAW_END,\r\n            mapInstanceId: transaction.mapInstanceId,\r\n            source: transaction.source,\r\n            originChannel: transaction.originChannel,\r\n            items: [transaction.items[0]]\r\n          });\r\n          o.run();\r\n          success = true;\r\n        } else if (transaction.intent === emp.intents.control.EDIT_BEGIN) {\r\n          o = new emp.typeLibrary.Transaction({\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            intent: emp.intents.control.EDIT_END,\r\n            mapInstanceId: transaction.mapInstanceId,\r\n            source: transaction.source,\r\n            originChannel: transaction.originChannel,\r\n            items: [transaction.items[0]]\r\n          });\r\n          o.run();\r\n          success = true;\r\n        } else {\r\n          emp.typeLibrary.Error({\r\n            message: \"The \" + transaction.intent + \" transaction with the id '\" + transactionId + \"' was found, but can not be completed.\"\r\n          });\r\n        }\r\n      } else {\r\n        emp.typeLibrary.Error({\r\n          message: \"No transaction with the id '\" + transactionId + \"' could not be found.  The transaction could not be completed.\"\r\n        });\r\n      }\r\n    }\r\n    return success;\r\n  }\r\n\r\n  /**\r\n   * @method\r\n   * @private\r\n   * @memberOf emp.transactionQueue\r\n   * @param {object} event\r\n   *\r\n   */\r\n  function dispatch(event) {\r\n    // retrieve the array of callback functions registered for this event type.\r\n    var instanceId = event.transaction.mapInstanceId;\r\n    var callbacks = listeners.getItem(event.type + instanceId),\r\n      len,\r\n      i,\r\n      success = {\r\n        success: false,\r\n        message: \"An unanticipated error has occurred in emp.transactionQueue.dispatch\"\r\n      };\r\n\r\n    try {\r\n      if (callbacks !== null && callbacks !== undefined) {\r\n        // We use a copy in case a callback unregisters itself.\r\n        callbacks = callbacks.concat([]);\r\n\r\n        len = callbacks.length;\r\n        for (i = 0; i < len; i += 1) {\r\n          if (callbacks[i] !== null) {\r\n            try {\r\n              callbacks[i](event.transaction);\r\n            } catch (err) {\r\n              emp.errorHandler.log(emp.typeLibrary.Error({\r\n                level: emp.typeLibrary.Error.level.INFO,\r\n                jsError: err,\r\n                message: \"An error occurred in emp.transactionQueue.dispatch while attempting to invoke a callback function\"\r\n              }));\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (err2) {\r\n      success = {\r\n        success: false,\r\n        message: err2.toString()\r\n      };\r\n    }\r\n    return success;\r\n  } // end dispatch\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.transactionQueue\r\n     * @method\r\n     * @description This function return true if there is a transaction outstanding.\r\n     * @param {String} mapInstanceId The map instance Id.\r\n     * False otherwise.\r\n     */\r\n    isTransactionOutStanding: function(mapInstanceId) {\r\n      var sTransID;\r\n\r\n      for (sTransID in publicInterface.processHash) {\r\n        if (publicInterface.processHash.hasOwnProperty(sTransID)) {\r\n          if (publicInterface.processHash[sTransID].mapInstanceId === mapInstanceId) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n    },\r\n    /**\r\n     * Add a transaction to the\r\n     * @method\r\n     * @memberof emp.transactionQueue\r\n     */\r\n    add: function(transaction) {\r\n      var oInstanceData = oMapInstanceData[transaction.mapInstanceId];\r\n\r\n      transaction.state = \"queued\";\r\n      oInstanceData.transQueue.push(transaction);\r\n      transHash[transaction.transactionId] = transaction;\r\n    },\r\n\r\n    /* eslint-disable no-console */\r\n    /**\r\n     * Prints the transaction queue to the console\r\n     */\r\n    print: function() {\r\n\r\n      var mapInstanceId,\r\n        oInstanceData,\r\n        transactionQueueString,\r\n        i;\r\n\r\n      for (mapInstanceId in oMapInstanceData) {\r\n\r\n        oInstanceData = oMapInstanceData[mapInstanceId];\r\n\r\n        console.log(\"================ Map Instance: \" + mapInstanceId + \" ==================\");\r\n        transactionQueueString = \"\";\r\n\r\n        for (i = 0; i < oInstanceData.transQueue.length; i += 1) {\r\n          console.log(i + \": \" + oInstanceData.transQueue[i].intent + \"\\n\");\r\n        }\r\n\r\n        console.log(transactionQueueString);\r\n      }\r\n\r\n    },\r\n    /* eslint-enable no-console */\r\n\r\n    /**\r\n     * End or complete a transaction that is already in process\r\n     * @method\r\n     * @memberof emp.transactionQueue\r\n     */\r\n    end: function(transactionId) {\r\n      return endTransaction(transactionId);\r\n    },\r\n    /**\r\n     * Attempt to cancel a transaction.  If the transaction is in the queue it will be removed.\r\n     * If the transaction is in process it will only be cancled if its a draw or an edit.\r\n     * @method\r\n     * @memberof emp.transactionQueue\r\n     */\r\n    cancel: function(transactionId) {\r\n      return cancelTransaction(transactionId);\r\n    },\r\n    /**\r\n     * function invoked at the end of each transaction intent to make the Transaction available to API and UI via emp.transactionQueue.listener\r\n     * @private\r\n     */\r\n    _complete: function(transaction) {\r\n\r\n      transaction.returnDuplicatesToItems();\r\n\r\n      // Do not let pointer / mouse move events get dispatched over the TRANSACTION_COMPLETE\r\n      // as they fire too rapidly and should only be subscribed to directly\r\n      // Below is the catch all way to get transactions without having to subscribe to individual types\r\n      if ((transaction.intent !== emp.intents.control.POINTER) &&\r\n        transaction.intent !== emp.intents.control.STATIC_CONTENT) {\r\n        dispatch({\r\n          type: emp.intents.control.TRANSACTION_COMPLETE,\r\n          transaction: transaction\r\n        });\r\n      }\r\n      // This will only invoke callbacks for the specific intent\r\n      dispatch({\r\n        type: transaction.intent,\r\n        transaction: transaction\r\n      });\r\n      // Moved this to the transaction runner after all the exits..\r\n      // Remove the transaction for ht ein process hash\r\n      //delete publicInterface.processHash[transaction.transactionId];\r\n\r\n      if ((oOutstandingTransaction !== null) &&\r\n        (transaction.transactionId === oOutstandingTransaction.transactionId)) {\r\n        if (outstandingTimer) {\r\n          clearTimeout(outstandingTimer);\r\n          outstandingTimer = null;\r\n        }\r\n        // If this is the transaction we are waiting for set it to null so the queue run the next one.\r\n        oOutstandingTransaction = null;\r\n      }\r\n    },\r\n    /**\r\n     * function invoked during the processing of a long running transaction intent (such as draw or edit) to make the Transaction available to API and UI via emp.transactionQueue.listener\r\n     * @private\r\n     */\r\n    _progress: function(transaction) {\r\n      // Do not let pointer / mouse move events get dispatched over the TRANSACTION_PROGRESS\r\n      // as they fire too rapidly and should only be subscribed to directly and SHOULD NOT go over API handlers (too much traffic)\r\n      // Below is the catch all way to get transactions without having to subscribe to individual types\r\n      if (transaction.intent !== emp.intents.control.POINTER) {\r\n        dispatch({\r\n          type: emp.intents.control.TRANSACTION_PROGRESS,\r\n          transaction: transaction\r\n        });\r\n      }\r\n      // This will only invoke callbacks for the specific intent\r\n      dispatch({\r\n        type: transaction.intent,\r\n        transaction: transaction\r\n      });\r\n    },\r\n    /**\r\n     * function invoked for transactions with unknown intents.  This can be used for UI components to pass around events without impacting core\r\n     * @private\r\n     */\r\n    _custom: function(transaction) {\r\n\r\n      transaction.returnDuplicatesToItems();\r\n      // This will only invoke callbacks for the specific intent\r\n      dispatch({\r\n        type: transaction.intent,\r\n        transaction: transaction\r\n      });\r\n\r\n      // Moved this to the transaction runner after all the exits..\r\n      // Remove the transaction for ht ein process hash\r\n      // delete publicInterface.processHash[transaction.transactionId];\r\n      if ((oOutstandingTransaction !== null) &&\r\n        (transaction.transactionId === oOutstandingTransaction.transactionId)) {\r\n        // If this is the transaction we are waiting for set it to null so the queue run the next one.\r\n        oOutstandingTransaction = null;\r\n        if (outstandingTimer) {\r\n          clearTimeout(outstandingTimer);\r\n          outstandingTimer = null;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * Used to pause the queue for operations such as a map engine swap\r\n     * @private\r\n     */\r\n    pause: function(mapInstanceId) {\r\n      var oInstanceData = oMapInstanceData[mapInstanceId];\r\n\r\n      if (oInstanceData) {\r\n        oInstanceData.running = false;\r\n        oInstanceData.pauseCnt++;\r\n      }\r\n    },\r\n    /**\r\n     * Used to run the queue once the map is ready for transactions after a pause\r\n     * @private\r\n     */\r\n    run: function(mapInstanceId) {\r\n      var oInstanceData = oMapInstanceData[mapInstanceId];\r\n\r\n      if (oInstanceData) {\r\n        // We must receive that same number of runs as we do pauses.\r\n        oInstanceData.pauseCnt--;\r\n        if (oInstanceData.pauseCnt <= 0) {\r\n          oInstanceData.running = true;\r\n          oInstanceData.pauseCnt = 0;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * hash of transactions that are running but not complete\r\n     * @private\r\n     */\r\n    processHash: {},\r\n    listener: {\r\n      /**\r\n       * @method\r\n       * @public\r\n       * @memberOf emp.transactionQueue.listener\r\n       * @see emp.intents.control enumeration for a list of the intents types you can register for\r\n       * @param {object} listenerInfo\r\n       */\r\n      add: function(listenerInfo) {\r\n        var listener;\r\n        if (!listenerInfo.mapInstanceId) {\r\n          listenerInfo.mapInstanceId = \"\";\r\n        }\r\n        listener = listeners.getItem(listenerInfo.type + listenerInfo.mapInstanceId);\r\n        if (listener !== null && listener !== undefined) {\r\n          listener.push(listenerInfo.callback);\r\n        } else {\r\n          var callbacks = [];\r\n          callbacks.push(listenerInfo.callback);\r\n          listeners.setItem(listenerInfo.type + listenerInfo.mapInstanceId, callbacks);\r\n        }\r\n      },\r\n      /**\r\n       * @method\r\n       * @public\r\n       * @memberOf emp.transactionQueue.listener\r\n       * @param  {object} listenerInfo\r\n       * @return {boolean}\r\n       */\r\n      remove: function(listenerInfo) {\r\n        var callbackArray,\r\n          len,\r\n          i,\r\n          listener;\r\n\r\n        if (!listenerInfo.mapInstanceId) {\r\n          listenerInfo.mapInstanceId = \"\";\r\n        }\r\n        listener = listeners.getItem(listenerInfo.type + listenerInfo.mapInstanceId);\r\n        if (listener !== null && listener !== undefined) {\r\n          callbackArray = listeners.getItem(listenerInfo.type + listenerInfo.mapInstanceId);\r\n          len = callbackArray.length;\r\n\r\n          for (i = 0; i < len; i += 1) {\r\n            if (callbackArray[i] === listenerInfo.callback) {\r\n              callbackArray.splice(i, 1);\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n    },\r\n    /**\r\n     *\r\n     * @param args\r\n     */\r\n    newMapInstance: function(args) {\r\n      if (oMapInstanceData[args.mapInstanceId] === undefined) {\r\n        oMapInstanceData[args.mapInstanceId] = mapInstanceData(args);\r\n        oMapInstanceIdList.push(args.mapInstanceId);\r\n      }\r\n    },\r\n    /**\r\n     *\r\n     * @param mapInstanceId\r\n     */\r\n    removeMapInstance: function(mapInstanceId) {\r\n      var iIndex;\r\n      var oTrans;\r\n      var oInstanceData = oMapInstanceData[mapInstanceId];\r\n\r\n      if (oInstanceData !== undefined) {\r\n        if (outstandingTimer && oOutstandingTransaction) {\r\n          if (oOutstandingTransaction.mapInstanceId === mapInstanceId) {\r\n            clearTimeout(outstandingTimer);\r\n            if (this.processHash.hasOwnProperty(oOutstandingTransaction.transactionId)) {\r\n              delete this.processHash[oOutstandingTransaction.transactionId];\r\n            }\r\n            oOutstandingTransaction = null;\r\n          }\r\n        }\r\n        while (oInstanceData.transQueue.length > 0) {\r\n          oTrans = oInstanceData.transQueue[0];\r\n          oInstanceData.transQueue.splice(0, 1);\r\n\r\n          if (transHash.hasOwnProperty(oTrans.transactionId)) {\r\n            delete transHash[oTrans.transactionId];\r\n          }\r\n        }\r\n        delete oMapInstanceData[mapInstanceId];\r\n\r\n        iIndex = oMapInstanceIdList.indexOf(mapInstanceId);\r\n        if (iIndex !== -1) {\r\n          oMapInstanceIdList.splice(iIndex, 1);\r\n        }\r\n\r\n        //oMapInstanceListIndex = 0;\r\n      }\r\n    },\r\n    purgeMapQueue: function(sMapInstanceId) {\r\n      var oTrans;\r\n      var oInstanceData = oMapInstanceData[sMapInstanceId];\r\n\r\n      if (oInstanceData !== undefined) {\r\n        // Check to see if there is a transaction running.\r\n        if (outstandingTimer && oOutstandingTransaction) {\r\n          // Check if the transaction is for this map instance.\r\n          if (oOutstandingTransaction.mapInstanceId === sMapInstanceId) {\r\n            // Clear it out. When its done it will just die.\r\n            clearTimeout(outstandingTimer);\r\n            if (this.processHash.hasOwnProperty(oOutstandingTransaction.transactionId)) {\r\n              delete this.processHash[oOutstandingTransaction.transactionId];\r\n            }\r\n            oOutstandingTransaction = null;\r\n          }\r\n        }\r\n\r\n        // Go thru the instance's transaction queue.\r\n        while (oInstanceData.transQueue.length > 0) {\r\n          oTrans = oInstanceData.transQueue.splice(0, 1)[0];\r\n\r\n          oTrans.run();\r\n          if (transHash.hasOwnProperty(oTrans.transactionId)) {\r\n            delete transHash[oTrans.transactionId];\r\n          }\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     *\r\n     * @param sMapInstanceId\r\n     */\r\n    dumpMapQueue: function(sMapInstanceId) {\r\n      var oTrans;\r\n      var oInstanceData = oMapInstanceData[sMapInstanceId];\r\n\r\n      if (oInstanceData !== undefined) {\r\n        // Check to see if there is a transaction running.\r\n        if (outstandingTimer && oOutstandingTransaction) {\r\n          // Check if the transaction is for this map instance.\r\n          if (oOutstandingTransaction.mapInstanceId === sMapInstanceId) {\r\n            // Clear it out. When its done it will just die.\r\n            clearTimeout(outstandingTimer);\r\n            if (this.processHash.hasOwnProperty(oOutstandingTransaction.transactionId)) {\r\n              delete this.processHash[oOutstandingTransaction.transactionId];\r\n            }\r\n            oOutstandingTransaction = null;\r\n          }\r\n        }\r\n\r\n        // Go thru the instance's transaction queue.\r\n        while (oInstanceData.transQueue.length > 0) {\r\n          oTrans = oInstanceData.transQueue.splice(0, 1)[0];\r\n\r\n          if (transHash.hasOwnProperty(oTrans.transactionId)) {\r\n            delete transHash[oTrans.transactionId];\r\n          }\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @description This function retrieves the number of transaction in a specific queue.\r\n     * @param {String} sMapInstanceId The map instance Id of the map or undefined for the main transaction queue.\r\n     * @returns {Number} This function returns the number of transaction in the queue.\r\n     */\r\n    getMapQueueSize: function(sMapInstanceId) {\r\n      var oInstanceData = oMapInstanceData[sMapInstanceId];\r\n\r\n      if (oInstanceData !== undefined) {\r\n        return oInstanceData.transQueue.length;\r\n      }\r\n      return emp.helpers.associativeArray.size(transHash);\r\n    }\r\n  };\r\n  runQueue();\r\n\r\n  return publicInterface;\r\n}());\r\n","/**\r\n * Controls the process of editing Features on the map.  Will\r\n * start the process to make sure all the messages are published\r\n * to the map.\r\n */\r\nemp.editingManager = function(args) {\r\n\r\n  var editTransaction, // The original edit transaction.\r\n    mapInstance = args.mapInstance, // The map the edit is occurring on\r\n    feature, // the current state of the feature.\r\n    activeEditor, // The editor chosen based on the format and or draw type.\r\n    updateData, // The most recent change to the feature, includes metadata about the vertex move/removal and updates.\r\n    originalFeature;\r\n  var publicInterface = {\r\n\r\n    /**\r\n     * Called when the map goes into edit mode.\r\n     */\r\n    edit: function(transaction) {\r\n      var symbol = false,\r\n        standard,\r\n        symbolCode,\r\n        basicCode,\r\n        symbolDef,\r\n        unitDef,\r\n        drawCategory;\r\n\r\n      //pause the transaction\r\n      transaction.pause();\r\n\r\n      editTransaction = transaction;\r\n\r\n      //publish the start event\r\n      mapInstance.eventing.EditStart({\r\n        transaction: editTransaction,\r\n        featureId: editTransaction.items[0].featureId,\r\n        overlayId: editTransaction.items[0].overlayId,\r\n        parentId: editTransaction.items[0].parentId\r\n      });\r\n\r\n      editTransaction.items[0].update({\r\n        name: editTransaction.items[0].name,\r\n        updates: {},\r\n        properties: editTransaction.items[0].properties,\r\n        updateEventType: emp.typeLibrary.UpdateEventType.START,\r\n        mapInstanceId: mapInstance.mapInstanceId\r\n      });\r\n\r\n      // Determine the type of editor to create.\r\n      feature = emp.storage.get.id({\r\n        id: editTransaction.items[0].originFeature.coreId\r\n      });\r\n      //feature = emp.storage.findFeature(null, editTransaction.items[0].featureId);\r\n\r\n      // copy the feature.  we do not want to modify the original feature in\r\n      // the transaction.  This feature will track the current state.\r\n      if (feature) {\r\n        feature = feature.getObjectData(mapInstance.mapInstanceId, emp.storage.getRootGuid(mapInstance.mapInstanceId));\r\n        feature = emp.helpers.copyObject(feature);\r\n        // The feature prior to any changes occurring.\r\n        originalFeature = emp.helpers.copyObject(feature);\r\n      }\r\n\r\n      // Determine if this is a MIL Symbol.  The mil symbol categories can greatly\r\n      // vary, so we need to know the symbol code and standard for this.\r\n      if (feature.format === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL) {\r\n        symbol = true;\r\n\r\n        // get the symbolCode of the MIL Std feature\r\n        symbolCode = feature.data.symbolCode;\r\n\r\n        // Get which standard the symbol is using, by default it is MIL-STD-2525C.\r\n        if (feature.properties && feature.properties.modifiers) {\r\n          standard = feature.properties.modifiers.standard || 1;\r\n        }\r\n\r\n        basicCode = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(symbolCode, standard);\r\n\r\n        // Determine the draw category.  We do this using our renderer's utility\r\n        // methods.  The draw category tells us what type of editor to use.\r\n        if (armyc2.c2sd.renderer.utilities.SymbolDefTable.hasSymbolDef(basicCode, standard)) {\r\n          symbolDef = armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicCode, standard);\r\n          if (symbolDef) {\r\n            drawCategory = symbolDef.drawCategory;\r\n          }\r\n        }\r\n        else {\r\n          unitDef = armyc2.c2sd.renderer.utilities.UnitDefTable.getUnitDef(basicCode, standard);\r\n          if (unitDef) {\r\n            drawCategory = unitDef.drawCategory;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Determine the type of editor needed.\r\n      if (feature.format === emp3.api.enums.FeatureTypeEnum.GEO_POINT ||\r\n        (symbol && drawCategory === armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_POINT)) {\r\n        // create the editor for the appropriate item being edited.\r\n        activeEditor = new emp.editors.Point({\r\n          feature: feature,\r\n          mapInstance: args.mapInstance\r\n        });\r\n      }\r\n      else {\r\n        // create the editor for the appropriate item being edited.\r\n        activeEditor = new emp.editors.EditorBase({\r\n          feature: feature,\r\n          mapInstance: args.mapInstance\r\n        });\r\n      }\r\n\r\n      // have the editor create any editing features on the map.\r\n      activeEditor.addControlPoints();\r\n\r\n    },\r\n\r\n    /**\r\n     * Called when edit is cancelled.  Editing vertex are removed from\r\n     * map, and feature returns to original state.\r\n     */\r\n    cancel: function() {\r\n\r\n      var initFailList = [],\r\n      transaction;\r\n\r\n      initFailList.push(new emp.typeLibrary.Error({\r\n        coreId: editTransaction.items[0].coreId,\r\n        message: \"The editing was cancelled.\",\r\n        level: emp.typeLibrary.Error.level.INFO\r\n      }));\r\n\r\n      editTransaction.items[0].originFeature = originalFeature;\r\n      mapInstance.eventing.EditEnd({\r\n        transaction: editTransaction,\r\n        failures: initFailList\r\n      });\r\n\r\n      // remove editing control points from the map.\r\n      activeEditor.removeControlPoints();\r\n\r\n\r\n      // restore the feature to its original state.  Create\r\n      // a FEATURE_ADD transaction that updates the feature\r\n      // to its original state.\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        mapInstanceId: mapInstance.mapInstanceId,\r\n        transactionId: null,\r\n        sender: mapInstance.mapInstanceId,\r\n        originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        source: emp.api.cmapi.SOURCE,\r\n        messageOriginator: mapInstance.mapInstanceId,\r\n        originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        items: [originalFeature]\r\n      });\r\n\r\n      // undo any changes that were made during the edit.\r\n      transaction.run();\r\n\r\n      // finish running the edit transaction\r\n      editTransaction.run();\r\n\r\n      // We are done editing. Reset state of editingManager.\r\n      editTransaction = undefined;\r\n      feature = undefined;\r\n      activeEditor = undefined;\r\n      updateData = undefined;\r\n      originalFeature = undefined;\r\n    },\r\n\r\n    complete: function() {\r\n\r\n      //publish the drawing end event\r\n      var item,\r\n        transaction;\r\n\r\n      editTransaction.items[0].updatedFeature = activeEditor.featureCopy;\r\n\r\n      mapInstance.eventing.EditEnd({\r\n        transaction: editTransaction\r\n      });\r\n\r\n      // remove editing control points from the map.\r\n      activeEditor.removeControlPoints();\r\n\r\n      // update the feature to its new state. Create\r\n      // a FEATURE_ADD transaction that updates the feature\r\n      // to its new state.  We pull that state from the editor.\r\n      item = activeEditor.featureCopy;\r\n\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        mapInstanceId: mapInstance.mapInstanceId,\r\n        transactionId: null,\r\n        sender: mapInstance.mapInstanceId,\r\n        originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        source: emp.api.cmapi.SOURCE,\r\n        messageOriginator: mapInstance.mapInstanceId,\r\n        originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        items: [item]\r\n      });\r\n\r\n      // Send out the message that will trigger the complete callback.\r\n      editTransaction.items[0].update({\r\n        name: feature.name,\r\n        updates: updateData.coordinateUpdate,\r\n        properties: updateData.properties,\r\n        updateEventType: emp.typeLibrary.UpdateEventType.COMPLETE,\r\n        mapInstanceId: mapInstance.mapInstanceId\r\n      });\r\n\r\n\r\n      // Immediately update the feature to the new state.\r\n      transaction.run();\r\n\r\n      // finish running the transaction\r\n      editTransaction.run();\r\n\r\n      // We are done editing. Reset state of editingManager.\r\n      editTransaction = undefined;\r\n      feature = undefined;\r\n      activeEditor = undefined;\r\n      updateData = undefined;\r\n      originalFeature = undefined;\r\n    },\r\n\r\n    editMouseDown: function(featureId) {\r\n\r\n      var mapLock,\r\n        lockMapTransaction;\r\n\r\n      // only raise the event if the item we are trying to drag is\r\n      // the item that is being edited.\r\n      if (originalFeature && featureId === originalFeature.featureId) {\r\n\r\n        mapLock = new emp.typeLibrary.Lock({\r\n          lock: true\r\n        });\r\n\r\n        // first lock the map in place so the map does not pan.\r\n\r\n        lockMapTransaction = new emp.typeLibrary.Transaction({\r\n          intent: emp.intents.control.VIEW_LOCK,\r\n          mapInstanceId: mapInstance.mapInstanceId,\r\n          source: mapInstance.mapInstanceId,\r\n          messageOriginator: mapInstance.mapInstanceId,\r\n          originalMessageType: cmapi.channel.names.MAP_VIEW_LOCK,\r\n          items: [mapLock]\r\n        });\r\n\r\n        lockMapTransaction.run();\r\n      }\r\n\r\n    },\r\n\r\n    editDragStart: function(featureId, pointer) {\r\n\r\n      var transaction;\r\n      var lockMapTransaction;\r\n      var mapLock;\r\n\r\n      // only raise the event if the item we are trying to drag is\r\n      // the item that is being edited.\r\n      if (originalFeature && featureId === originalFeature.featureId) {\r\n\r\n        // If we are dragging a control point, we don't want\r\n        // any events going out, because it is not a feature.\r\n        if (activeEditor.isControlPoint(featureId)) {\r\n          activeEditor.moveControlPoint(featureId, pointer);\r\n        }\r\n        else if (activeEditor.isFeature(featureId)) {\r\n          // If this is the feature we are editing, raise a feature drag\r\n          // event.\r\n\r\n          // create a feature drag event.\r\n          transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstance.mapInstanceId,\r\n            intent: emp.intents.control.POINTER,\r\n            originChannel: \"cmapi2.map.view.drag\",\r\n            source: emp.core.sources.MAP,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            items: [pointer]\r\n          });\r\n\r\n          // send out the event.\r\n          transaction.run();\r\n        }\r\n      }\r\n      else {\r\n        mapLock = new emp.typeLibrary.Lock({\r\n          lock: false\r\n        });\r\n\r\n        // first lock the map in place so the map does not pan.\r\n\r\n        lockMapTransaction = new emp.typeLibrary.Transaction({\r\n          intent: emp.intents.control.VIEW_LOCK,\r\n          mapInstanceId: mapInstance.mapInstanceId,\r\n          source: mapInstance.mapInstanceId,\r\n          messageOriginator: mapInstance.mapInstanceId,\r\n          originalMessageType: cmapi.channel.names.MAP_VIEW_LOCK,\r\n          items: [mapLock]\r\n        });\r\n\r\n        lockMapTransaction.run();\r\n      }\r\n    },\r\n\r\n    editDragMove: function(featureId, startX, startY, pointer) {\r\n\r\n      if (originalFeature && featureId === originalFeature.featureId) {\r\n\r\n        if (activeEditor.isControlPoint(featureId)) {\r\n          updateData = activeEditor.moveControlPoint(featureId, pointer);\r\n        }\r\n        else if (activeEditor.isFeature(featureId)) {\r\n          updateData = activeEditor.moveFeature(startX, startY, pointer);\r\n        }\r\n\r\n        editTransaction.items[0].update({\r\n          name: feature.name,\r\n          updates: updateData.coordinateUpdate,\r\n          properties: updateData.properties,\r\n          updateEventType: emp.typeLibrary.UpdateEventType.UPDATE,\r\n          mapInstanceId: mapInstance.mapInstanceId\r\n        });\r\n      }\r\n    },\r\n\r\n    editDragComplete: function(featureId, startX, startY, pointer) {\r\n      var transaction;\r\n      var lockMapTransaction;\r\n      var mapLock;\r\n\r\n      if (originalFeature && featureId === originalFeature.featureId) {\r\n        if (activeEditor.isControlPoint(featureId)) {\r\n          updateData = activeEditor.moveControlPoint(featureId, pointer);\r\n        }\r\n        else if (activeEditor.isFeature(featureId)) {\r\n          updateData = activeEditor.moveFeature(startX, startY, pointer);\r\n\r\n          // send out a feature drag complete event.\r\n          transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstance.mapInstanceId,\r\n            intent: emp.intents.control.POINTER,\r\n            originChannel: \"cmapi2.map.view.dragComplete\",\r\n            source: emp.core.sources.MAP,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            items: [pointer]\r\n          });\r\n          transaction.run();\r\n        }\r\n\r\n        editTransaction.items[0].update({\r\n          name: feature.name,\r\n          updates: updateData.coordinateUpdate,\r\n          properties: updateData.properties,\r\n          updateEventType: emp.typeLibrary.UpdateEventType.UPDATE,\r\n          mapInstanceId: mapInstance.mapInstanceId\r\n        });\r\n\r\n        mapLock = new emp.typeLibrary.Lock({\r\n          lock: false\r\n        });\r\n\r\n        lockMapTransaction = new emp.typeLibrary.Transaction({\r\n          intent: emp.intents.control.VIEW_LOCK,\r\n          mapInstanceId: mapInstance.mapInstanceId,\r\n          source: mapInstance.mapInstanceId,\r\n          messageOriginator: mapInstance.mapInstanceId,\r\n          originalMessageType: cmapi.channel.names.MAP_VIEW_LOCK,\r\n          items: [mapLock]\r\n        });\r\n\r\n        lockMapTransaction.run();\r\n      }\r\n    }\r\n  };\r\n  return publicInterface;\r\n\r\n};\r\n","/* global emp */\r\n/**\r\n *\r\n * @namespace\r\n * @desc This namespace encapsulates all the types utilized by the map\r\n * engine interface.\r\n */\r\nemp.typeLibrary = {};\r\n\r\n/**\r\n *\r\n * @enum\r\n * @readonly\r\n * @description This enumerates the different type library classes and is used to identify the class in\r\n * the type library. The values are used to populate the globalType field of the classes.\r\n */\r\nemp.typeLibrary.types = {\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a draw class.\r\n     */\r\n    DRAW : \"draw\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a edit class.\r\n     */\r\n    EDIT:\"edit\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a error class.\r\n     */\r\n    ERROR:\"error\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a feature class.\r\n     */\r\n    FEATURE:\"feature\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a menu class.\r\n     */\r\n    MENU:\"menu\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a overlay class.\r\n     */\r\n    OVERLAY:\"overlay\",\r\n    /**\r\n     * @public\r\n     * @type string\r\n     * @constant\r\n     * @description This value identifies the object as a pointer class.\r\n     */\r\n    POINTER:\"pointer\",\r\n    /**\r\n     * @public\r\n     * @type string\r\n     * @constant\r\n     * @description This value identifies the object as a selection class.\r\n     */\r\n    SELECTION:\"selection\",\r\n    /**\r\n     * @public\r\n     * @type string\r\n     * @constant\r\n     * @description This value identifies the object as a selectionBox class.\r\n     */\r\n    SELECTION_BOX:\"selectionBox\",\r\n    /**\r\n     * @public\r\n     * @type string\r\n     * @constant\r\n     * @description This value identifies the object as a static class.\r\n     */\r\n    STATIC:\"static\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a status class.\r\n     */\r\n    STATUS:\"status\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a transaction class.\r\n     */\r\n    TRANSACTION:\"transaction\",\r\n    /**\r\n     * @public\r\n     * @type string\r\n     * @constant\r\n     * @description This value identifies the object as a view class.\r\n     */\r\n    VIEW:\"view\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a lookAt class.\r\n     */\r\n    LOOKAT:\"lookAt\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a WMS class.\r\n     */\r\n    WMS:\"wms\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a WMTS class.\r\n     */\r\n    WMTS: \"wmts\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as a KML layer class.\r\n     */\r\n    KML: \"kmllayer\",\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value identifies the object as an Overlay Cluster class.\r\n     */\r\n    OVERLAY_CLUSTER: \"overlayCluster\"\r\n};\r\n\r\n/**\r\n *\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description Contains the event types defined for the updates generated by a map engine when an item is placed in draw or edit mode.\r\n */\r\nemp.typeLibrary.UpdateEventType = {\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description Event type indicating that the event contains updated data. The update is\r\n     * not the the final update.\r\n     */\r\n    UPDATE: \"update\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description Event type indicating that the event contains updated data and the update is\r\n     * the the final update. All map engines must generate the last update with this event type.\r\n     */\r\n    COMPLETE: \"complete\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description Event type indicating that the feature has been placed in edit/draw mode.\r\n     * The data in the event contains any default data applied to the feature that was not provided by the originator.\r\n     * All map engine must generate the first update event with this event type.\r\n     */\r\n    START: \"start\"\r\n};\r\n\r\n/**\r\n * @public\r\n * @enum\r\n * @readonly\r\n * @description This type enumerates the valid values for the update field of the Draw and Edit update events.\r\n */\r\nemp.typeLibrary.CoordinateUpdateType = {\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a control point has been moved.\r\n     * The index of the control point is contained in the indices array field.\r\n     */\r\n    UPDATE: \"update\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a control point has been removed.\r\n     * The index of the control point is contained in the indices array field.\r\n     */\r\n    REMOVE: \"remove\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a control point has been added.\r\n     * The index of the control point is contained in the indices array field.\r\n     */\r\n    ADD: \"add\"\r\n};\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @public\r\n * @typedef {object} LatLonCoordinates\r\n * @property {number} lat This property contains the latitude value of the coordinate.\r\n * @property {number} lon This property contains the longitude value of the coordinate.\r\n * @property {number=} alt This property contains the altitude value of the coordinate if applicable.\r\n */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @public\r\n * @typedef {object} CoordinateUpdate\r\n * @property {emp.typeLibrary.CoordinateUpdateType} type This property identifies\r\n * the type of update. For ADD and UPDATE the indices identifies the coordinates\r\n * in the coordinates array that have been added or updates. For REMOVE the indices\r\n * array identifies the coordinates that have been removed from the coordinates array.\r\n * @property {number[]} indices This property contains an array of indexes\r\n * identifying the control points that are affected.\r\n * @property {LatLonCoordinates[]} coordinates This property contains an\r\n * array of all the feature coordinates {@link emp.typeLibrary.LatLonCoordinates}.\r\n */\r\n\r\nemp.typeLibrary.featureFormatType = emp.constant.featureFormatType;\r\n\r\nemp.typeLibrary.featureMilStdVersionType = emp.constant.featureMilStdVersionType;\r\n\r\nemp.typeLibrary.featureAltitudeModeType = emp.constant.featureAltitudeModeType;\r\n\r\nemp.typeLibrary.orbitTurnType = emp.constant.orbitTurnType;\r\n\r\n/**\r\n * @class\r\n * @description This type defines the bounding box of an area.\r\n */\r\nemp.typeLibrary.BoundingBoxType = function(args){\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This field contains the east coordinate of the bounding box in degrees.\r\n     */\r\n    this.east = args.east;\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This field contains the north coordinate of the bounding box in degrees.\r\n     */\r\n    this.north = args.north;\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This field contains the west coordinate of the bounding box in degrees.\r\n     */\r\n    this.west = args.west;\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This field contains the south coordinate of the bounding box in degrees.\r\n     */\r\n    this.south = args.south;\r\n};\r\n\r\nemp.typeLibrary.airspaceSymbolCode = emp.constant.airspaceSymbolCode;\r\n\r\n/**\r\n * @private\r\n */\r\nemp.typeLibrary.parentRelationship = function(args)\r\n{\r\n    /**\r\n     * @description A reference to the parent object.\r\n     */\r\n    this.parent = args.parent;\r\n    /**\r\n     * @description The visibility of the child under this parent.\r\n     */\r\n    this.visible = args.visible;\r\n    /**\r\n     * @description The visibility setting of the child under this parent as\r\n     * set by the user or client.\r\n     */\r\n    this.visibilitySetting = args.visibilitySetting;\r\n};\r\n\r\nemp.typeLibrary.AOIType = emp.constant.AOIType;\r\n\r\nemp.typeLibrary.OutlineStyleType = emp.constant.OutlineStyleType;\r\n","/*\r\n * This file should be moved to emp-map core so it does not have to be\r\n * recoded or copied to each map engine.\r\n */\r\n/* global emp */\r\n\r\nemp.typeLibrary.utils = emp.typeLibrary.utils || {};\r\nemp.typeLibrary.utils.milstd = emp.typeLibrary.utils.milstd || {};\r\n","/* global emp */\r\n\r\nemp.typeLibrary.utils.milstd.AOI = emp.typeLibrary.utils.milstd.AOI || {};\r\n\r\nemp.typeLibrary.utils.milstd.AOI.isAOI = function(oItem) {\r\n    var bRet = false;\r\n    var oGeoJson = oItem.data;\r\n\r\n    if (oGeoJson.hasOwnProperty('type') &&\r\n        (oGeoJson.type.toLowerCase() === 'feature'))\r\n    {\r\n        if (oGeoJson.hasOwnProperty('properties') &&\r\n            oGeoJson.properties.hasOwnProperty('aoi'))\r\n        {\r\n            bRet = true;\r\n        }\r\n    }\r\n    return bRet;\r\n};\r\n\r\nemp.typeLibrary.utils.milstd.AOI.getAOISymbolCode = function (aoiType) {\r\n    var eAOIType = emp.typeLibrary.AOIType,\r\n        result;\r\n\r\n    switch (aoiType)\r\n    {\r\n        case eAOIType.POINT_RADIUS:\r\n            result = \"BBS_POINT------\";\r\n            break;\r\n        case eAOIType.LINE:\r\n            result = \"BBS_LINE-------\";\r\n            break;\r\n        case eAOIType.POLYGON:\r\n            result = \"BBS_AREA-------\";\r\n            break;\r\n        case eAOIType.BBOX:\r\n            result = \"BBS_RECTANGLE--\";\r\n            break;\r\n    }\r\n    return result;\r\n};\r\n\r\nemp.typeLibrary.utils.milstd.AOI.getModifiers = function (oItem) {\r\n    var oGeoJson = emp.helpers.copyObject(oItem.data);\r\n    //var eMilStdModifiers = emp.typeLibrary.utils.milstd.Modifiers;\r\n    var oProperties = oGeoJson.properties;\r\n    var newModifiers = emp.helpers.copyObject(oItem.properties.modifiers) || {};\r\n\r\n    newModifiers[\"T\"] = oItem.name;\r\n    newModifiers[\"AM\"] = oItem.data.properties.aoi.buffer;\r\n\r\n    if (oProperties)\r\n    {\r\n        if (oProperties.hasOwnProperty('fillColor'))\r\n        {\r\n            newModifiers[\"fillColor\"] = oProperties.fillColor;\r\n        }\r\n        if (oProperties.hasOwnProperty('lineColor'))\r\n        {\r\n            newModifiers[\"lineColor\"] = oProperties.lineColor;\r\n        }\r\n    }\r\n\r\n    if (!newModifiers[\"fillColor\"])\r\n    {\r\n        if (oGeoJson && oGeoJson.properties.hasOwnProperty('fillColor'))\r\n        {\r\n            newModifiers[\"fillColor\"] = oGeoJson.properties.fillColor;\r\n        }\r\n    }\r\n\r\n    if (!newModifiers[\"lineColor\"])\r\n    {\r\n        if (oGeoJson && oGeoJson.properties.hasOwnProperty('lineColor'))\r\n        {\r\n            newModifiers[\"lineColor\"] = oGeoJson.properties.lineColor;\r\n        }\r\n    }\r\n\r\n    if (!newModifiers[\"fillColor\"])\r\n    {\r\n        // If fill color is still not set, set our default.\r\n        // I would prefer the default to be set by the renderer but it fails\r\n        // if one is not provided.\r\n        newModifiers[\"fillColor\"] = '99AAAAAA';\r\n    }\r\n    \r\n    return newModifiers;\r\n};","/* global emp, armyc2 */\r\n\r\n/**\r\n * @description This type enumerates the MilStd modifiers as defined in 2525 and the ones \r\n * used by the renderer.\r\n */\r\n//armyc2.c2sd.renderer.utilities.ModifiersTG;\r\nemp.typeLibrary.utils.milstd.Modifiers = {\r\n    C_QUANTITY : armyc2.c2sd.renderer.utilities.ModifiersTG.C_QUANTITY,\r\n    H_ADDITIONAL_INFO_1 : armyc2.c2sd.renderer.utilities.ModifiersTG.H_ADDITIONAL_INFO_1,\r\n    H1_ADDITIONAL_INFO_2 : armyc2.c2sd.renderer.utilities.ModifiersTG.H1_ADDITIONAL_INFO_2,\r\n    H2_ADDITIONAL_INFO_3 : armyc2.c2sd.renderer.utilities.ModifiersTG.H2_ADDITIONAL_INFO_3,\r\n    N_HOSTILE : armyc2.c2sd.renderer.utilities.ModifiersTG.N_HOSTILE,\r\n    Q_DIRECTION_OF_MOVEMENT : armyc2.c2sd.renderer.utilities.ModifiersTG.Q_DIRECTION_OF_MOVEMENT,\r\n    S_OFFSET_INDICATOR : armyc2.c2sd.renderer.utilities.ModifiersTG.S_OFFSET_INDICATOR,\r\n    T_UNIQUE_DESIGNATION_1 : armyc2.c2sd.renderer.utilities.ModifiersTG.T_UNIQUE_DESIGNATION_1,\r\n    T1_UNIQUE_DESIGNATION_2 : armyc2.c2sd.renderer.utilities.ModifiersTG.T1_UNIQUE_DESIGNATION_2,\r\n    V_EQUIP_TYPE : armyc2.c2sd.renderer.utilities.ModifiersTG.V_EQUIP_TYPE,\r\n    W_DTG_1 : armyc2.c2sd.renderer.utilities.ModifiersTG.W_DTG_1,\r\n    W1_DTG_2 : armyc2.c2sd.renderer.utilities.ModifiersTG.W1_DTG_2,\r\n    X_ALTITUDE_DEPTH : armyc2.c2sd.renderer.utilities.ModifiersTG.X_ALTITUDE_DEPTH,\r\n    Y_LOCATION : armyc2.c2sd.renderer.utilities.ModifiersTG.Y_LOCATION,\r\n    AM_DISTANCE : armyc2.c2sd.renderer.utilities.ModifiersTG.AM_DISTANCE,\r\n    AN_AZIMUTH : armyc2.c2sd.renderer.utilities.ModifiersTG.AN_AZIMUTH,\r\n    F_REDUCED_OR_REINFORCED: \"F\",\r\n    G_STAFF_COMMENTS: \"G\",\r\n    J_EVALUATION_RATING: \"J\",\r\n    K_COMBAT_EFFECTIVENESS: \"K\",\r\n    L_SIGNATURE_EQUIPMENT: \"L\",\r\n    M_HIGHER_FORMATION: \"M\",\r\n    P_IFF_SIF: \"P\",\r\n    Z_SPEED: \"Z\",\r\n    AA_SPECIAL_C2_HEADQUARTERS: \"AA\",\r\n    STANDARD: \"SYMSTD\"\r\n};\r\n\r\n/**\r\n * @description This type enumerates the MilStd modifiers sent by the API client.\r\n */\r\nemp.typeLibrary.utils.milstd.StringModifiers = {\r\n    C_QUANTITY: \"quantity\",\r\n    F_REDUCED_OR_REINFORCED: \"reinforcedOrReduced\",\r\n    G_STAFF_COMMENTS: \"staffComments\",\r\n    H_ADDITIONAL_INFO_1: \"additionalInfo1\",\r\n    H1_ADDITIONAL_INFO_2: \"additionalInfo2\",\r\n    H2_ADDITIONAL_INFO_3: \"additionalInfo3\",\r\n    J_EVALUATION_RATING: \"evaluationRating\",\r\n    K_COMBAT_EFFECTIVENESS: \"combatEffectiveness\",\r\n    L_SIGNATURE_EQUIPMENT: \"signatureEquipment\",\r\n    M_HIGHER_FORMATION: \"higherFormation\",\r\n    N_HOSTILE: \"hostile\",\r\n    P_IFF_SIF: \"iffSif\",\r\n    Q_DIRECTION_OF_MOVEMENT: \"directionOfMovement\",\r\n    S_OFFSET_INDICATOR: \"offsetIndicator\",\r\n    T_UNIQUE_DESIGNATION_1: \"uniqueDesignation1\",\r\n    T1_UNIQUE_DESIGNATION_2: \"uniqueDesignation2\",\r\n    V_EQUIP_TYPE: \"equipmentType\",\r\n    W_DTG_1: \"dateTimeGroup1\",\r\n    W1_DTG_2: \"dateTimeGroup2\",\r\n    X_ALTITUDE_DEPTH: \"altitudeDepth\",\r\n    Y_LOCATION: \"location\",\r\n    Z_SPEED: \"speed\",\r\n    AA_SPECIAL_C2_HEADQUARTERS: \"specialC2Headquarters\",\r\n    AM_DISTANCE: \"distance\",\r\n    AN_AZIMUTH: \"azimuth\",\r\n    FILL_COLOR: \"fillColor\",\r\n    LINE_COLOR: \"lineColor\",\r\n    X_OFFSET: \"xOffset\",\r\n    X_UNITS: \"xUnits\",\r\n    Y_OFFSET: \"yOffset\",\r\n    Y_UNITS: \"yUnits\",\r\n    SIZE: \"size\",\r\n    LINE_THICKNESS: \"lineThickness\",\r\n    HEADING: \"heading\",\r\n    STANDARD: \"standard\"\r\n};\r\n\r\nemp.typeLibrary.utils.milstd.String2Modifier = (function(){\r\n    var mapping = {};\r\n    var longModifiers = emp.typeLibrary.utils.milstd.StringModifiers;\r\n    var s2525Modifiers = emp.typeLibrary.utils.milstd.Modifiers;\r\n    \r\n    mapping[longModifiers.C_QUANTITY] = s2525Modifiers.C_QUANTITY;\r\n    mapping[longModifiers.F_REDUCED_OR_REINFORCED] = s2525Modifiers.F_REDUCED_OR_REINFORCED;\r\n    mapping[longModifiers.G_STAFF_COMMENTS] = s2525Modifiers.G_STAFF_COMMENTS;\r\n    mapping[longModifiers.H_ADDITIONAL_INFO_1] = s2525Modifiers.H_ADDITIONAL_INFO_1;\r\n    mapping[longModifiers.H1_ADDITIONAL_INFO_2] = s2525Modifiers.H1_ADDITIONAL_INFO_2;\r\n    mapping[longModifiers.H2_ADDITIONAL_INFO_3] = s2525Modifiers.H2_ADDITIONAL_INFO_3;\r\n    mapping[longModifiers.J_EVALUATION_RATING] = s2525Modifiers.J_EVALUATION_RATING;\r\n    mapping[longModifiers.K_COMBAT_EFFECTIVENESS] = s2525Modifiers.K_COMBAT_EFFECTIVENESS;\r\n    mapping[longModifiers.L_SIGNATURE_EQUIPMENT] = s2525Modifiers.L_SIGNATURE_EQUIPMENT;\r\n    mapping[longModifiers.M_HIGHER_FORMATION] = s2525Modifiers.M_HIGHER_FORMATION;\r\n    mapping[longModifiers.N_HOSTILE] = s2525Modifiers.N_HOSTILE;\r\n    mapping[longModifiers.P_IFF_SIF] = s2525Modifiers.P_IFF_SIF;\r\n    mapping[longModifiers.Q_DIRECTION_OF_MOVEMENT] = s2525Modifiers.Q_DIRECTION_OF_MOVEMENT;\r\n    mapping[longModifiers.S_OFFSET_INDICATOR] = s2525Modifiers.S_OFFSET_INDICATOR;\r\n    mapping[longModifiers.T_UNIQUE_DESIGNATION_1] = s2525Modifiers.T_UNIQUE_DESIGNATION_1;\r\n    mapping[longModifiers.T1_UNIQUE_DESIGNATION_2] = s2525Modifiers.T1_UNIQUE_DESIGNATION_2;\r\n    mapping[longModifiers.V_EQUIP_TYPE] = s2525Modifiers.V_EQUIP_TYPE;\r\n    mapping[longModifiers.W_DTG_1] = s2525Modifiers.W_DTG_1;\r\n    mapping[longModifiers.W1_DTG_2] = s2525Modifiers.W1_DTG_2;\r\n    mapping[longModifiers.X_ALTITUDE_DEPTH] = s2525Modifiers.X_ALTITUDE_DEPTH;\r\n    mapping[longModifiers.Y_LOCATION] = s2525Modifiers.Y_LOCATION;\r\n    mapping[longModifiers.Z_SPEED] = s2525Modifiers.Z_SPEED;\r\n    mapping[longModifiers.AA_SPECIAL_C2_HEADQUARTERS] = s2525Modifiers.AA_SPECIAL_C2_HEADQUARTERS;\r\n    mapping[longModifiers.AM_DISTANCE] = s2525Modifiers.AM_DISTANCE;\r\n    mapping[longModifiers.AN_AZIMUTH] = s2525Modifiers.AN_AZIMUTH;\r\n    //mapping[longModifiers.FILL_COLOR] = longModifiers.FILL_COLOR;\r\n    //mapping[longModifiers.LINE_COLOR] = longModifiers.LINE_COLOR;\r\n    //mapping[longModifiers.X_OFFSET] = longModifiers.X_OFFSET;\r\n    //mapping[longModifiers.X_UNITS] = longModifiers.X_UNITS;\r\n    //mapping[longModifiers.Y_OFFSET] = longModifiers.Y_OFFSET;\r\n    //mapping[longModifiers.Y_UNITS] = longModifiers.Y_UNITS;\r\n    //mapping[longModifiers.SIZE] = longModifiers.SIZE;\r\n    //mapping[longModifiers.LINE_THICKNESS] = longModifiers.LINE_THICKNESS;\r\n    mapping[longModifiers.HEADING] = s2525Modifiers.Q_DIRECTION_OF_MOVEMENT;\r\n    //mapping[longModifiers.STANDARD] = s2525Modifiers.STANDARD;\r\n    \r\n    return mapping;\r\n}());\r\n\r\nemp.typeLibrary.utils.milstd.Modifier2String = (function(){\r\n    var mapping = {};\r\n    var longModifiers = emp.typeLibrary.utils.milstd.StringModifiers;\r\n    var s2525Modifiers = emp.typeLibrary.utils.milstd.Modifiers;\r\n    \r\n    mapping[s2525Modifiers.C_QUANTITY] = longModifiers.C_QUANTITY;\r\n    mapping[s2525Modifiers.F_REDUCED_OR_REINFORCED] = longModifiers.F_REDUCED_OR_REINFORCED;\r\n    mapping[s2525Modifiers.G_STAFF_COMMENTS] = longModifiers.G_STAFF_COMMENTS;\r\n    mapping[s2525Modifiers.H_ADDITIONAL_INFO_1] = longModifiers.H_ADDITIONAL_INFO_1;\r\n    mapping[s2525Modifiers.H1_ADDITIONAL_INFO_2] = longModifiers.H1_ADDITIONAL_INFO_2;\r\n    mapping[s2525Modifiers.H2_ADDITIONAL_INFO_3] = longModifiers.H2_ADDITIONAL_INFO_3;\r\n    mapping[s2525Modifiers.J_EVALUATION_RATING] = longModifiers.J_EVALUATION_RATING;\r\n    mapping[s2525Modifiers.K_COMBAT_EFFECTIVENESS] = longModifiers.K_COMBAT_EFFECTIVENESS;\r\n    mapping[s2525Modifiers.L_SIGNATURE_EQUIPMENT] = longModifiers.L_SIGNATURE_EQUIPMENT;\r\n    mapping[s2525Modifiers.M_HIGHER_FORMATION] = longModifiers.M_HIGHER_FORMATION;\r\n    mapping[s2525Modifiers.N_HOSTILE] = longModifiers.N_HOSTILE;\r\n    mapping[s2525Modifiers.P_IFF_SIF] = longModifiers.P_IFF_SIF;\r\n    mapping[s2525Modifiers.Q_DIRECTION_OF_MOVEMENT] = longModifiers.Q_DIRECTION_OF_MOVEMENT;\r\n    mapping[s2525Modifiers.S_OFFSET_INDICATOR] = longModifiers.S_OFFSET_INDICATOR;\r\n    mapping[s2525Modifiers.T_UNIQUE_DESIGNATION_1] = longModifiers.T_UNIQUE_DESIGNATION_1;\r\n    mapping[s2525Modifiers.T1_UNIQUE_DESIGNATION_2] = longModifiers.T1_UNIQUE_DESIGNATION_2;\r\n    mapping[s2525Modifiers.V_EQUIP_TYPE] = longModifiers.V_EQUIP_TYPE;\r\n    mapping[s2525Modifiers.W_DTG_1] = longModifiers.W_DTG_1;\r\n    mapping[s2525Modifiers.W1_DTG_2] = longModifiers.W1_DTG_2;\r\n    mapping[s2525Modifiers.X_ALTITUDE_DEPTH] = longModifiers.X_ALTITUDE_DEPTH;\r\n    mapping[s2525Modifiers.Y_LOCATION] = longModifiers.Y_LOCATION;\r\n    mapping[s2525Modifiers.Z_SPEED] = longModifiers.Z_SPEED;\r\n    mapping[s2525Modifiers.AA_SPECIAL_C2_HEADQUARTERS] = longModifiers.AA_SPECIAL_C2_HEADQUARTERS;\r\n    mapping[s2525Modifiers.AM_DISTANCE] = longModifiers.AM_DISTANCE;\r\n    mapping[s2525Modifiers.AN_AZIMUTH] = longModifiers.AN_AZIMUTH;\r\n    //mapping[longModifiers.FILL_COLOR] = longModifiers.FILL_COLOR;\r\n    //mapping[longModifiers.LINE_COLOR] = longModifiers.LINE_COLOR;\r\n    //mapping[longModifiers.X_OFFSET] = longModifiers.X_OFFSET;\r\n    //mapping[longModifiers.X_UNITS] = longModifiers.X_UNITS;\r\n    //mapping[longModifiers.Y_OFFSET] = longModifiers.Y_OFFSET;\r\n    //mapping[longModifiers.Y_UNITS] = longModifiers.Y_UNITS;\r\n    //mapping[longModifiers.SIZE] = longModifiers.SIZE;\r\n    //mapping[longModifiers.LINE_THICKNESS] = longModifiers.LINE_THICKNESS;\r\n    mapping[s2525Modifiers.HEADING] = longModifiers.Q_DIRECTION_OF_MOVEMENT;\r\n    //mapping[s2525Modifiers.STANDARD] = longModifiers.STANDARD;\r\n    \r\n    return mapping;\r\n}());\r\n\r\nemp.typeLibrary.utils.milstd.convertModifiers2Strings = function(oModifiers)\r\n{\r\n    var aStringModifiers = {};\r\n    \r\n    for (var sModifier in oModifiers)\r\n    {\r\n        if (emp.typeLibrary.utils.milstd.Modifier2String.hasOwnProperty(sModifier))\r\n        {\r\n            aStringModifiers[emp.typeLibrary.utils.milstd.Modifier2String[sModifier]] = oModifiers[sModifier];\r\n        }\r\n    }\r\n    \r\n    return aStringModifiers;\r\n};\r\n\r\nemp.typeLibrary.utils.milstd.convertStrings2Modifiers = function(oStringModifiers)\r\n{\r\n    var oModifiers = {};\r\n    \r\n    for (var sModifier in oStringModifiers)\r\n    {\r\n        if (emp.typeLibrary.utils.milstd.String2Modifier.hasOwnProperty(sModifier))\r\n        {\r\n            oModifiers[emp.typeLibrary.utils.milstd.String2Modifier[sModifier]] = oStringModifiers[sModifier];\r\n        }\r\n    }\r\n    \r\n    return oModifiers;\r\n};\r\n\r\n/*\r\n * This function should be added to the emp-map emp.typeLibrary.featureMilStdVersionType\r\n */\r\nemp.typeLibrary.featureMilStdVersionType.convertToString = function(iValue)\r\n{\r\n    var sRet = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n    switch (iValue)\r\n    {\r\n        case 0:\r\n            sRet = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n            break;\r\n        case 1:\r\n            sRet = emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C;\r\n            break;\r\n    }\r\n    \r\n    return sRet;\r\n};\r\n","\r\n/* global emp */\r\n\r\n/**\r\n * @memberof emp.typeLibrary\r\n * @class\r\n * @description This class represent a coordinate object used in the CoordinateUpdate class\r\n */\r\nemp.typeLibrary.LatLonCoordinates = function (args) {\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This property contains the latitude value of the coordiante.\r\n     */\r\n    this.lat = args.lat;\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This property contains the longitude value of the coordinate.\r\n     */\r\n    this.lon = args.lon;\r\n    \r\n    if (typeof (args.alt) === 'number')\r\n    {\r\n        /**\r\n         * @field\r\n         * @type number=\r\n         * @description This property, if present, contains the altitude value of the coordinate if applicable.\r\n         */\r\n        this.alt = args.alt;\r\n    }\r\n};\r\n\r\n/**\r\n * @memberof emp.typeLibrary\r\n * @class\r\n * @description This class represent the update data utilized in the draw and event update events.\r\n */\r\nemp.typeLibrary.CoordinateUpdate = function (args) {\r\n    /**\r\n     * @field\r\n     * @type emp.typeLibrary.CoordinateUpdateType\r\n     * @description This property identifies \r\n     * the type of update. For ADD and UPDATE the indices identifies the coordinates\r\n     * in the coordinates array that have been added or updates. For REMOVE the indices\r\n     * array identifies the coordinates that have been removed from the coordinates array.\r\n     */\r\n    this.type = args.type;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number[]}\r\n     * @description This property contains an array of indexes \r\n     * identifying the control points that are affected.\r\n     */\r\n    this.indices = args.indices;\r\n\r\n    /**\r\n     * @field\r\n     * @type {LatLonCoordinates[]}\r\n     * @description This property contains an \r\n     * array of all the feature coordinates {@link emp.typeLibrary.LatLonCoordinates}.\r\n     */\r\n    this.coordinates = args.coordinates;\r\n\r\n    /**\r\n     * @private\r\n     * @method\r\n     * @param {Array} oGeoJsonCoord This parameters must contain a single coordinate in GeoJson format.\r\n     */\r\n    this.geojsonCoordToLatLonCoordinates = function(oGeoJsonCoord)\r\n    {\r\n        var oLLCoord;\r\n        \r\n        if (oGeoJsonCoord.length > 2)\r\n        {\r\n            oLLCoord = new emp.typeLibrary.LatLonCoordinates({\r\n                lat: oGeoJsonCoord[1],\r\n                lon: oGeoJsonCoord[0],\r\n                alt: oGeoJsonCoord[2]\r\n            });\r\n        }\r\n        else\r\n        {\r\n            oLLCoord = new emp.typeLibrary.LatLonCoordinates({\r\n                lat: oGeoJsonCoord[1],\r\n                lon: oGeoJsonCoord[0]\r\n            });\r\n        }\r\n        \r\n        return oLLCoord;\r\n    };\r\n    \r\n    /**\r\n     * @method\r\n     * @description This method will convert geojson coordiantes to {@link emp.typeLibrary.LatLonCoordinates}\r\n     * and place the result in the coordinates field.\r\n     * @param {object} oGeoJsonData This parameters must be a geojson simple object Point, LineString or Polygon.\r\n     */\r\n    this.convertFromGeoJson = function(oGeoJsonData)\r\n    {\r\n        var oCoordList = [];\r\n        \r\n        if (!oGeoJsonData.hasOwnProperty('type'))\r\n        {\r\n            throw new Error(\"Argument object with no type property.\");\r\n        }\r\n        \r\n        if (!oGeoJsonData.hasOwnProperty('coordinates')\r\n                || !(oGeoJsonData.coordinates instanceof Array))\r\n        {\r\n            throw new Error(\"Argument object with no or invalid coordinates property.\");\r\n        }\r\n\r\n        var iIndex;\r\n        switch (oGeoJsonData.type.toLowerCase())\r\n        {\r\n            case 'point':\r\n                if (oGeoJsonData.coordinates.length > 0)\r\n                {\r\n                    oCoordList.push(this.geojsonCoordToLatLonCoordinates(oGeoJsonData.coordinates));\r\n                }\r\n                break;\r\n            case 'linestring':\r\n                for (iIndex = 0; iIndex < oGeoJsonData.coordinates.length; iIndex++)\r\n                {\r\n                    oCoordList.push(this.geojsonCoordToLatLonCoordinates(oGeoJsonData.coordinates[iIndex]));\r\n                }\r\n                break;\r\n            case 'polygon':\r\n                if ((oGeoJsonData.coordinates.length === 0)\r\n                        || !(oGeoJsonData.coordinates[0] instanceof Array))\r\n                {\r\n                    throw new Error(\"Argument object with an invalid polygon coordinates property.\");\r\n                }\r\n                for (iIndex = 0; iIndex < oGeoJsonData.coordinates[0].length; iIndex++)\r\n                {\r\n                    oCoordList.push(this.geojsonCoordToLatLonCoordinates(oGeoJsonData.coordinates[0][iIndex]));\r\n                }\r\n                break;\r\n        }\r\n        \r\n        this.coordinates = oCoordList;\r\n    };\r\n};\r\n\r\n/**\r\n * @memberof emp.typeLibrary\r\n * @class\r\n * @description This class represents a pixel to lat lon conversion or a lat lon to pixel conversion..\r\n */\r\nemp.typeLibrary.Convert = function (args) {\r\n    /**\r\n     * @field\r\n     * @type float\r\n     * @description Represents x coordinate of a pixel.\r\n     */\r\n    this.x = args.x; //No\r\n    \r\n    /**\r\n     * @field\r\n     * @type float\r\n     * @description Represents y coordinate of a pixel.\r\n     */\r\n    this.y = args.y;\r\n    \r\n    /**\r\n     * @field\r\n     * @type float\r\n     * @description Represents a geographical location.\r\n     * which contains the feature.\r\n     */\r\n    this.lat = args.lat;\r\n    \r\n    /**\r\n     * @field\r\n     * @type float\r\n     * @description Represents a geographical location.\r\n     */\r\n    this.lon = args.lon;\r\n\r\n    /**\r\n     * @field\r\n     * @type Boolean\r\n     * @description If the conversion can't happen set to true.\r\n     */\r\n    this.invalid = false;   \r\n    \r\n};\r\n\r\n","/*global emp, tv4 */\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n *\r\n * @desc Used as prototype for other types includes validation, visibility and locate methods.\r\n * Methods in this base class should never be called by a map engine.\r\n */\r\nemp.typeLibrary.base = {\r\n  /**\r\n   * @method\r\n   * @desc Validates EMP {@link global} Types against the schema using TinyValidator 4 with the JSON Schema Specification\r\n   * @returns {boolean} valid - Whether or not the object is valid\r\n   * @returns {object} validationErrors - What is not validating correctly\r\n   * @returns {object} validationMissing - What is missing per schema\r\n   */\r\n  validate: function () {\r\n    if (emp.validate === true) {\r\n      var message,\r\n        i,\r\n        valid = tv4.validateMultiple(this, this.schema);\r\n\r\n      if (valid.valid) {\r\n        this.valid = true;\r\n\r\n      } else {\r\n        message = \"An emp.typeLibrary \" + this.globalType + \" Object has failed to validate: \";\r\n        message += \" \";\r\n        for (i = 0; i < valid.errors.length; i++) {\r\n          message += \"\\n \" + valid.errors[i].message + \" \" + valid.errors[i].schemaPath + \" \" + valid.errors[i].dataPath;\r\n        }\r\n\r\n        emp.typeLibrary.Error({\r\n          sender: this.sender,\r\n          message: message,\r\n          transactionId: this.transactionId,\r\n          coreId: this.coreId,\r\n          level: emp.typeLibrary.Error.level.INFO\r\n        });\r\n\r\n        this.valid = false;\r\n\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n  },\r\n  /**\r\n   * Returns the number of parents the object is listed as visible for\r\n   * @returns {number}\r\n   */\r\n  getVisibilityCount: function () {\r\n    var iCount = 0;\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      var oRelationship;\r\n\r\n      for (var sCoreId in this.parentNodes) {\r\n        oRelationship = this.parentNodes[sCoreId];\r\n\r\n        if (oRelationship.visible) {\r\n          iCount++;\r\n        }\r\n      }\r\n    } else {\r\n      iCount = this.visible ? 1 : 0;\r\n    }\r\n\r\n    return iCount;\r\n  },\r\n  /**\r\n   * @private\r\n   * @param {type} bVisible\r\n   * @param {type} sParentCoreId\r\n   */\r\n  isVisibilityAffected: function (sParentCoreId, bVisible) {\r\n    var bSend = false;\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      var iPrevVisibilityCount = this.getVisibilityCount();\r\n\r\n      if (this.parentNodes.hasOwnProperty(sParentCoreId)) {\r\n        if ((iPrevVisibilityCount === 1) && !bVisible &&\r\n          this.parentNodes[sParentCoreId].visible) {\r\n          // There is only one visible\r\n          // and we are turning off visibility\r\n          // and this is the one that is on.\r\n          // We send it.\r\n          bSend = true;\r\n        } else if ((iPrevVisibilityCount === 0) &&\r\n          bVisible &&\r\n          this.parentNodes[sParentCoreId].visibilitySetting) {\r\n          // There are none visible\r\n          // and we are turing the parent on.\r\n          // and the user wants this one on.\r\n          // Send it.\r\n          bSend = true;\r\n        } else if (!bVisible && this.parentNodes[sParentCoreId].visible) {\r\n          // Its parent is being turn off and this one is on.\r\n          // We must turn it off but not send it.\r\n          this.parentNodes[sParentCoreId].visible = bVisible;\r\n        } else if (bVisible && !this.parentNodes[sParentCoreId].visible &&\r\n          this.parentNodes[sParentCoreId].visibilitySetting) {\r\n          // Its parent is being turn on and this one is off.\r\n          // But the user wants it on.\r\n          // We must turn it on but not send it.\r\n          this.parentNodes[sParentCoreId].visible = bVisible;\r\n        }\r\n\r\n        if (bSend) {\r\n          this.parentNodes[sParentCoreId].visible = bVisible;\r\n        }\r\n      }\r\n    } else {\r\n      // Its not MP.\r\n      if (this.visible !== bVisible) {\r\n        if (bVisible) {\r\n          // Its being turned on\r\n          if (this.visibilitySetting) {\r\n            // The user wants it on.\r\n            // So we send it.\r\n            bSend = true;\r\n          }\r\n        } else {\r\n          // Its being turn off\r\n          // We send it.\r\n          bSend = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (bSend) {\r\n      this.visible = bVisible;\r\n    }\r\n\r\n    return bSend;\r\n  },\r\n  /**\r\n   * @private\r\n   * @param {Boolean} bVisible\r\n   * @param {emp.typeLibrary.Transaction} oTransaction\r\n   */\r\n  addAffectedChildren: function (oTransaction, bVisible) {\r\n    var oaItems = oTransaction.items;\r\n    var oChild;\r\n    var oDupChild;\r\n    var bAffected = false;\r\n\r\n    for (var sChildCoreId in this.nodes) {\r\n      oChild = this.nodes[sChildCoreId];\r\n\r\n      bAffected = oChild.isVisibilityAffected(this.coreId, bVisible);\r\n\r\n      if (bAffected) {\r\n        if (oTransaction.isOnItemsList(oChild)) {\r\n          // Its on the list already. Skip it.\r\n          continue;\r\n        }\r\n        oDupChild = oChild.createDuplicate();\r\n        oDupChild.coreParent = this.coreId;\r\n        oaItems.push(oDupChild);\r\n\r\n        switch (oChild.globalType) {\r\n          case emp.typeLibrary.types.OVERLAY:\r\n            if (this.isMultiParentRequired()) {\r\n              // But we only send multi-parent overlays to the map engine if and only if\r\n              // its the root overlay.\r\n              // So given that its not the root we add it to the duplicates.\r\n              oTransaction.duplicate(oChild.coreId);\r\n            }\r\n            break;\r\n          default:\r\n            //everything else gets sent to the map engine.\r\n            break;\r\n        }\r\n\r\n        oChild.addAffectedChildren(oTransaction, bVisible);\r\n      } else if (bVisible && oChild.getVisibilityWithParent(this.coreId)) {\r\n        oChild.addAffectedChildren(oTransaction, bVisible);\r\n      }\r\n    }\r\n  },\r\n  /**\r\n   * @desc designed as a fast way for DE or SE to flip visibility.\r\n   * @param {emp.typeLibrary.Transaction} oTransaction\r\n   * @param {string} sParentCoreId - The coreId of the parent the visibility is being set.\r\n   * @param {boolean} bVisible - Visibility Flag\r\n   * @param {boolean} bGoDeep - True if the visibility should affect children.\r\n   */\r\n  visibility: function (oTransaction, sParentCoreId, bVisible, bGoDeep) {\r\n    var //oTransaction,\r\n        //oAffectedTransaction,\r\n      oItem,\r\n      oaItems = oTransaction.items;\r\n\r\n\r\n    switch (this.globalType) {\r\n      case emp.typeLibrary.types.OVERLAY:\r\n      case emp.typeLibrary.types.FEATURE:\r\n      case emp.typeLibrary.types.STATIC:\r\n        break;\r\n      default:\r\n        // visibility called on wrong object\r\n        emp.errorHandler.log(emp.typeLibrary.Error({\r\n          level: 1,\r\n          message: \"Visibility called on incompatible object\",\r\n          jsError: \"\",\r\n          coreId: this.coreId\r\n        }));\r\n        return;\r\n    }\r\n\r\n    if (typeof bVisible !== 'boolean') {\r\n      // It must be true or false.\r\n      return;\r\n    }\r\n\r\n    if (this.setVisibilityWithParent(sParentCoreId, bVisible)) {\r\n      oItem = this.createDuplicate();\r\n      oItem.coreParent = sParentCoreId;\r\n      oaItems.push(oItem);\r\n      switch (this.globalType) {\r\n        case emp.typeLibrary.types.OVERLAY:\r\n          if (this.isMultiParentRequired()) {\r\n            if (this.coreParent !== emp.storage.getRootGuid(oTransaction.mapInstanceId)) {\r\n              // But we only send multi-parent overlays to the map engine if and only if\r\n              // its the root overlay.\r\n              // So given that its not the root we add it to the duplicates.\r\n              oTransaction.duplicate(oItem.coreId);\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n          //everything else gets sent to the map engine.\r\n          break;\r\n      }\r\n\r\n      if (bGoDeep) {\r\n        this.addAffectedChildren(oTransaction, bVisible);\r\n      }\r\n    } else {\r\n      // This is not being sent so we add it and dump it to the duplicates.\r\n      oItem = this.createDuplicate();\r\n      oItem.coreParent = sParentCoreId;\r\n      oaItems.push(oItem);\r\n      oTransaction.duplicate(oItem.coreId);\r\n    }\r\n  },\r\n  /**\r\n   * Creates a transaction to move the map to this object\r\n   * @param {Object} args\r\n   * @param {string} [args.component=\"\"]\r\n   * @param {string} args.mapInstanceId\r\n   * @returns {emp.typeLibrary.Transaction}\r\n   */\r\n  locate: function (args) {\r\n    var transaction,\r\n      payload;\r\n\r\n    args = args || {};\r\n    args.component = args.component || \"\";\r\n\r\n    payload = {\r\n      coreId: this.coreId,\r\n      overlayId: this.overlayId,\r\n      parentId: this.parentId,\r\n      featureId: this.featureId || this.id,\r\n      zoom: true,\r\n      visible: true\r\n    };\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.VIEW_SET,\r\n      mapInstanceId: args.mapInstanceId,\r\n      source: emp.core.sources.CORE,\r\n      items: function () {\r\n        var r = [];\r\n        r.push(new emp.typeLibrary.View(payload));\r\n        return r;\r\n      }\r\n    });\r\n    if (args.component === \"de\") {\r\n      transaction.run();\r\n    } else {\r\n      return transaction;\r\n    }\r\n\r\n  },\r\n  /**\r\n   *\r\n   * @returns {string}\r\n   */\r\n  getRootCoreId: function () {\r\n    var oRootCoreId = emp.storage.getRootGuid();\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      if (this.parentNodes[oRootCoreId] !== undefined) {\r\n        // If the storage root is a parent of this entry its the multi-parent root.\r\n        oRootCoreId = this.coreId;\r\n      } else {\r\n        oRootCoreId = this.multiParentRootId;\r\n      }\r\n    }\r\n    return oRootCoreId;\r\n  },\r\n  /**\r\n   * @returns {emp.classLibrary.EmpRenderableObject}\r\n   */\r\n  getRootParent: function () {\r\n    if (this.isMultiParentRequired()) {\r\n      var oRootCoreId = this.getRootCoreId();\r\n      return emp.storage.get.id({\r\n        id: oRootCoreId\r\n      });\r\n    }\r\n    return undefined;\r\n  },\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  hasChildren: function () {\r\n    return !emp.helpers.associativeArray.isEmpty(this.nodes);\r\n  },\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  hasParents: function () {\r\n    return !emp.helpers.associativeArray.isEmpty(this.parentNodes);\r\n  },\r\n  /**\r\n   *\r\n   */\r\n  removeFromAllParent: function () {\r\n    var oParent;\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      var oMultiParentRoot;\r\n      var aParentCoreIdList = this.getParentCoreIds();\r\n\r\n      // If this is a multi parent object find\r\n      // its root parent just in case we need to\r\n      // remove it.\r\n      oMultiParentRoot = this.getRootParent();\r\n\r\n      // Go thru all the parents and remove this object.\r\n      for (var iIndex = 0; iIndex < aParentCoreIdList.length; iIndex++) {\r\n        oParent = this.parentNodes[aParentCoreIdList[iIndex]].parent;\r\n        oParent.removeChild(this);\r\n      }\r\n\r\n      if (oMultiParentRoot && (this.coreId !== oMultiParentRoot.coreId)) {\r\n        // If this object its not the root parent,\r\n        // we need to remove it from its root parent's childNodes.\r\n        if (oMultiParentRoot.childNodes.hasOwnProperty(this.coreId)) {\r\n          delete oMultiParentRoot.childNodes[this.coreId];\r\n        }\r\n      }\r\n    } else {\r\n      oParent = emp.storage.get.id({\r\n        id: this.coreParent\r\n      });\r\n      if (oParent !== undefined) {\r\n        oParent.removeChild(this);\r\n      }\r\n    }\r\n  },\r\n  /**\r\n   * This function checks to see if the object identified by sCoreId, is an ancestor of this.\r\n   * This function should have been called isAnAncestor\r\n   * @param {string} sCoreId\r\n   * @returns {boolean}\r\n   */\r\n  isUnderParent: function (sCoreId) {\r\n    var oParent;\r\n    var bRet = false;\r\n    if (this.coreId === sCoreId) {\r\n      bRet = true;\r\n    } else if (this.isMultiParentRequired()) {\r\n      var oRelationship;\r\n      for (var sParentCoreId in this.parentNodes) {\r\n        oRelationship = this.parentNodes[sParentCoreId];\r\n        if (oRelationship.parent.isUnderParent(sCoreId)) {\r\n          bRet = true;\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      oParent = emp.storage.get.id({\r\n        id: this.coreParent\r\n      });\r\n\r\n      if (oParent) {\r\n        bRet = oParent.isUnderParent(sCoreId);\r\n      }\r\n    }\r\n\r\n    return bRet;\r\n  },\r\n  /**\r\n   * @param oChild\r\n   */\r\n  removeChild: function (oChild) {\r\n    if (this.nodes.hasOwnProperty(oChild.coreId)) {\r\n      oChild.removeFromOverlayFeatureList(this);\r\n      if (this.isMultiParentRequired() ||\r\n        ((this.coreId === emp.storage.getRootGuid()) &&\r\n          oChild.isMultiParentRequired())) {\r\n        // If this is a multi parent object find\r\n        // its root parent just in case we need to\r\n        // remove it.\r\n        var oMultiParentRoot;\r\n\r\n        if (this.coreId === emp.storage.getRootGuid()) {\r\n          oMultiParentRoot = oChild.getRootParent();\r\n        } else {\r\n          oMultiParentRoot = this.getRootParent();\r\n        }\r\n\r\n        if (oChild.parentNodes[this.coreId]) {\r\n          // Delete the parent from the childs parent list.\r\n          delete oChild.parentNodes[this.coreId];\r\n          //console.log(\"Remove child \" + oChild.name + \" from \" + this.name + \". Which now has \" + oChild.parentCount() + \" parents.\");\r\n        }\r\n        if (!oChild.hasParents() &&\r\n          (oChild.globalType === emp.typeLibrary.types.FEATURE) &&\r\n          (oMultiParentRoot) &&\r\n          (oChild.coreId !== oMultiParentRoot.coreId)) {\r\n          // If this object has a multi parent requirement\r\n          // and it has no more parents left, and\r\n          // its not the root parent,\r\n          // we need to remove it from its root parent's childNodes.\r\n          if (oMultiParentRoot.childNodes.hasOwnProperty(this.coreId)) {\r\n            delete oMultiParentRoot.childNodes[this.coreId];\r\n          }\r\n        }\r\n      }\r\n      // Now delete the child from the parents child list.\r\n      delete this.nodes[oChild.coreId];\r\n\r\n    }\r\n  },\r\n  /**\r\n   * @param oParent\r\n   */\r\n  removeFromOverlayFeatureList: function (oParent) {\r\n    if ((this.globalType === emp.typeLibrary.types.FEATURE) ||\r\n      (this.globalType === emp.typeLibrary.types.WMS)) {\r\n      var oCurrentParent;\r\n\r\n      if (oParent.globalType === emp.typeLibrary.types.OVERLAY) {\r\n        // Its an overlay so remove it.\r\n        oParent.removeFromFeatureList(this);\r\n        this.removeAllChildrenFromOverlayFeatureList(oParent);\r\n      } else {\r\n        if (this.isMultiParentRequired()) {\r\n          for (var sParentCoreId in oParent.parentNodes) {\r\n            oCurrentParent = oParent.parentNodes[sParentCoreId].parent;\r\n            this.removeFromOverlayFeatureList(oCurrentParent);\r\n          }\r\n        } else {\r\n          oCurrentParent = emp.storage.get.id({\r\n            id: oParent.coreParent\r\n          });\r\n          this.removeFromOverlayFeatureList(oCurrentParent);\r\n          this.removeAllChildrenFromOverlayFeatureList(oCurrentParent);\r\n        }\r\n      }\r\n    }\r\n  },\r\n  /**\r\n   * @param oOverlay\r\n   */\r\n  removeAllChildrenFromOverlayFeatureList: function (oOverlay) {\r\n    if ((this.globalType !== emp.typeLibrary.types.FEATURE) &&\r\n      (this.globalType !== emp.typeLibrary.types.WMS)) {\r\n      return;\r\n    }\r\n\r\n    var oChild;\r\n    for (var sCoreId in this.nodes) {\r\n      oChild = this.nodes[sCoreId];\r\n      oChild.removeAllChildrenFromOverlayFeatureList(oOverlay);\r\n      oOverlay.removeFromFeatureList(oChild);\r\n    }\r\n  },\r\n  /**\r\n   * @param oOverlay\r\n   */\r\n  addAllChildrenToOverlayFeatureList: function (oOverlay) {\r\n    if ((this.globalType !== emp.typeLibrary.types.FEATURE) &&\r\n      (this.globalType !== emp.typeLibrary.types.WMS)) {\r\n      return;\r\n    }\r\n\r\n    var oChild;\r\n    for (var sCoreId in this.nodes) {\r\n      oChild = this.nodes[sCoreId];\r\n\r\n      if (!oOverlay.isOnFeatureList(oChild)) {\r\n        oOverlay.addToFeatureList(oChild);\r\n        oChild.addAllChildrenToOverlayFeatureList(oOverlay);\r\n      }\r\n    }\r\n  },\r\n  /**\r\n   * @param oParent\r\n   */\r\n  addToOverlayFeatureList: function (oParent) {\r\n    if ((this.globalType === emp.typeLibrary.types.FEATURE) ||\r\n      (this.globalType === emp.typeLibrary.types.WMS)) {\r\n      var oCurrentParent;\r\n\r\n      if (oParent.globalType === emp.typeLibrary.types.OVERLAY) {\r\n        oParent.addToFeatureList(this);\r\n        this.addAllChildrenToOverlayFeatureList(oParent);\r\n      } else if (this.isMultiParentRequired()) {\r\n        for (var sParentCoreId in oParent.parentNodes) {\r\n          oCurrentParent = oParent.parentNodes[sParentCoreId].parent;\r\n\r\n          if (oCurrentParent.globalType !== emp.typeLibrary.types.OVERLAY) {\r\n            // This parent is not an overlay, keep going up.\r\n            this.addToOverlayFeatureList(oCurrentParent);\r\n          } else {\r\n            // This one is an overlay so add it.\r\n            oCurrentParent.addToFeatureList(this);\r\n            this.addAllChildrenToOverlayFeatureList(oCurrentParent);\r\n          }\r\n        }\r\n      } else {\r\n        oCurrentParent = emp.storage.findOverlay(oParent.overlayId);\r\n        oCurrentParent.addToFeatureList(this);\r\n        this.addAllChildrenToOverlayFeatureList(oCurrentParent);\r\n      }\r\n    }\r\n  },\r\n  /**\r\n   * @param oParent\r\n   * @param {boolean} bVisible\r\n   * @param {boolean} bVisibleSetting\r\n   */\r\n  addParent: function (oParent, bVisible, bVisibleSetting) {\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      if (!this.parentNodes.hasOwnProperty(oParent.coreId)) {\r\n        var oMultiParentRoot = oParent.getRootParent();\r\n        var oRelationship = new emp.typeLibrary.parentRelationship({\r\n          parent: oParent,\r\n          visible: (oParent.visible ? bVisible : false),\r\n          visibilitySetting: bVisibleSetting\r\n        });\r\n        this.parentNodes[oParent.coreId] = oRelationship;\r\n        oParent.addChild(this, bVisible, bVisibleSetting);\r\n\r\n        //console.log(\"Add parent \" + oParent.name + \" to \" + this.name + \". Which now has \" + this.parentCount() + \" parents.\");\r\n        if (this.globalType === emp.typeLibrary.types.FEATURE) {\r\n          // We must make sure that features get added to its root parents childNodes.\r\n          if (!oMultiParentRoot.childNodes.hasOwnProperty(this.coreId)) {\r\n            oMultiParentRoot.childNodes[this.coreId] = this;\r\n            // Now set the overlay and parentCoreId so the map engines\r\n            // place it on the correct root overlay.\r\n            this.parentCoreId = oMultiParentRoot.coreId;\r\n          }\r\n        }\r\n\r\n        this.multiParentRootId = (oMultiParentRoot ? oMultiParentRoot.coreId : undefined);\r\n      }\r\n    } else {\r\n      this.coreParent = oParent.coreId;\r\n      this.parentCoreId = oParent.coreId;\r\n      this.visible = (oParent.visible ? bVisible : false);\r\n      this.visibilitySetting = bVisibleSetting;\r\n      oParent.addChild(this, bVisible, bVisibleSetting);\r\n    }\r\n  },\r\n  /**\r\n   * @param oChild\r\n   * @param bVisible\r\n   * @param bVisibleSetting\r\n   */\r\n  addChild: function (oChild, bVisible, bVisibleSetting) {\r\n    if (!this.nodes.hasOwnProperty(oChild.coreId)) {\r\n      // Add it.\r\n      this.nodes[oChild.coreId] = oChild;\r\n      oChild.addToOverlayFeatureList(this);\r\n      oChild.addParent(this, bVisible, bVisibleSetting);\r\n    }\r\n  },\r\n  /**\r\n   * @returns {string[]}\r\n   */\r\n  getChildrenCoreIds: function () {\r\n    return emp.helpers.associativeArray.getKeys(this.nodes);\r\n  },\r\n  /**\r\n   * @returns {string[]}\r\n   */\r\n  getParentCoreIds: function () {\r\n    return emp.helpers.associativeArray.getKeys(this.parentNodes);\r\n  },\r\n  /**\r\n   * @returns {number}\r\n   */\r\n  childrenCount: function () {\r\n    return emp.helpers.associativeArray.size(this.nodes);\r\n  },\r\n  /**\r\n   * @returns {number}\r\n   */\r\n  parentCount: function () {\r\n    return emp.helpers.associativeArray.size(this.parentNodes);\r\n  },\r\n  /**\r\n   * @param {string} sCoreId\r\n   * @returns {emp.classLibrary.EmpRenderableObject}\r\n   */\r\n  getChild: function (sCoreId) {\r\n    return this.nodes[sCoreId];\r\n  },\r\n  /**\r\n   * @param {string} sCoreId\r\n   * @returns {emp.classLibrary.EmpRenderableObject}\r\n   */\r\n  getParent: function (sCoreId) {\r\n    if (this.parentNodes[sCoreId]) {\r\n      return this.parentNodes[sCoreId].parent;\r\n    }\r\n    return undefined;\r\n  },\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  isMultiParentRequired: function () {\r\n    if (this.hasOwnProperty('properties') && this.properties.hasOwnProperty('multiParentRequired')) {\r\n      return (this.properties.multiParentRequired === true);\r\n    }\r\n\r\n    return false;\r\n  },\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  hasChildNodes: function () {\r\n    return !emp.helpers.associativeArray.isEmpty(this.childNodes);\r\n  },\r\n  /**\r\n   * @returns {string[]}\r\n   */\r\n  getChildNodesCoreIds: function () {\r\n    return emp.helpers.associativeArray.getKeys(this.childNodes);\r\n  },\r\n  /**\r\n   * @param {string} sParentCodeId\r\n   * @returns {boolean}\r\n   */\r\n  getVisibilitySettingWithParent: function (sParentCodeId) {\r\n    var sParentID = (sParentCodeId ? sParentCodeId : emp.storage.getRootGuid());\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      if (this.parentNodes.hasOwnProperty(sParentID)) {\r\n        return this.parentNodes[sParentID].visibilitySetting;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    return this.visibilitySetting;\r\n  },\r\n  /**\r\n   * @param {string} sParentCodeId\r\n   * @returns {boolean}\r\n   */\r\n  getVisibilityWithParent: function (sParentCodeId) {\r\n    var sParentID = (sParentCodeId ? sParentCodeId : emp.storage.getRootGuid());\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      if (this.parentNodes.hasOwnProperty(sParentID)) {\r\n        return this.parentNodes[sParentID].visible;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    return this.visible;\r\n  },\r\n  /**\r\n   * @param {string} sParentCodeId\r\n   * @param {boolean} bSetting\r\n   * @returns {boolean}\r\n   */\r\n  setVisibilityWithParent: function (sParentCodeId, bSetting) {\r\n    var sParentID = (sParentCodeId ? sParentCodeId : emp.storage.getRootGuid());\r\n    var bSend = false;\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      var iPrevVisibilityCount = this.getVisibilityCount();\r\n\r\n      if (this.parentNodes.hasOwnProperty(sParentID)) {\r\n        this.parentNodes[sParentID].visible = bSetting;\r\n        this.parentNodes[sParentID].visibilitySetting = bSetting;\r\n      }\r\n      var iCurrentVisibilityCount = this.getVisibilityCount();\r\n\r\n      if (bSetting && (iPrevVisibilityCount === 0) && (iCurrentVisibilityCount === 1)) {\r\n        // This is the first visibility set to the object\r\n        bSend = true;\r\n      } else if (!bSetting && (iPrevVisibilityCount === 1) && (iCurrentVisibilityCount === 0)) {\r\n        // This is the last visibility hide set to the object.\r\n        bSend = true;\r\n      }\r\n    } else {\r\n      if (this.visible !== bSetting) {\r\n        bSend = true;\r\n      }\r\n    }\r\n\r\n    if (bSend) {\r\n      this.visible = bSetting;\r\n      this.visibilitySetting = bSetting;\r\n    }\r\n    return bSend;\r\n  },\r\n  /**\r\n   * This function traverses all parents looking for at least\r\n   * one path to the root that is totally visible.\r\n   * @returns {Boolean}\r\n   */\r\n  isVisible: function () {\r\n    var oParent;\r\n    var bRet = false;\r\n\r\n    if (this.isMultiParentRequired()) {\r\n      for (var sCoreId in this.parentNodes) {\r\n        if (this.parentNodes[sCoreId].visible) {\r\n          if (sCoreId === emp.storage.getRootGuid()) {\r\n            // It reached the root.\r\n            return true;\r\n          }\r\n          oParent = this.parentNodes[sCoreId].parent;\r\n          if (oParent.isVisible()) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    } else if (this.visible) {\r\n      if (this.coreParent === emp.storage.getRootGuid()) {\r\n        return true;\r\n      } else {\r\n        oParent = emp.storage.get.id({\r\n          id: this.coreParent\r\n        });\r\n\r\n        if (oParent) {\r\n          return oParent.isVisible();\r\n        }\r\n      }\r\n    }\r\n\r\n    return bRet;\r\n  }\r\n};\r\n","/*global emp */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n * @description This class represent a transaction in the EMP system. All operations\r\n * are conveyed with an instance of this class. A map implementation should\r\n * never create an instance of this class.\r\n */\r\nemp.typeLibrary.Transaction = function(args) {\r\n\r\n  /**\r\n   * Contains the creation time of the transaction so\r\n   * queue can execute in correct order.\r\n   * @type {number}\r\n   */\r\n  this.creationTime = Date.now();\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.coreId = emp.helpers.id.newGUID();\r\n\r\n  /**\r\n   * @private\r\n   * @description This field indicates if the core is to generate a transaction\r\n   * complete at the end of the transaction execution.\r\n   */\r\n  this.sendTransactionComplete = (function(args) {\r\n    if (args.sendTransactionComplete === true) {\r\n      return true;\r\n    }\r\n    if (args.sendTransactionComplete === false) {\r\n      return false;\r\n    }\r\n    if (args.transactionId) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }(args));\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unique transaction identifier.\r\n   */\r\n  this.transactionId = args.transactionId || emp.helpers.id.newGUID();\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unique message identifier.\r\n   */\r\n  this.messageId = args.messageId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unique id of the map instance this transaction wil interact with.\r\n   */\r\n  this.mapInstanceId = args.mapInstanceId || \"\";\r\n\r\n  /**\r\n   *\r\n   * @private\r\n   */\r\n  this.globalType = emp.typeLibrary.types.TRANSACTION;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.sender = args.sender;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.originChannel = args.originChannel;\r\n  /**\r\n   * DEPRECATED\r\n   * @private\r\n   * @type {string}\r\n   * @deprecated replaced by source\r\n   */\r\n  this.originination = args.origination;\r\n  /**\r\n   * Creation source\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.source = args.source || emp.core.sources.CORE;\r\n\r\n  /**\r\n   * Intent of transaction\r\n   * @see  emp.intents.control\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.intent = args.intent;\r\n  /**\r\n   * Additional params for intent, ie: true/false for visible\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.intentParams = args.intentParams;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.options = args.options;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.type = \"transaction\"; // redundant?\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.throttled = false; // used for queuing.\r\n  // when queued and broke up will set flag so CMAPI will send only one complete (success/fail) message\r\n  // when complete.\r\n  // @todo Implement on CMAPI side.\r\n  /**\r\n   * Used by QM to determine whether or not transaction completed\r\n   * @todo Implement in CMAPI\r\n   * @type {Boolean}\r\n   * @private\r\n   */\r\n  this.complete = true;\r\n  /**\r\n   * This was originally set to expect a function, but using arrays\r\n   * is more reliable.  Allowing both until all uses of function are removed from code base\r\n   * @field items\r\n   * @type {Array}\r\n   * @description All of the items associated with the transaction, instantiated from\r\n   * other typeLibrary objects.\r\n   */\r\n  if (typeof args.items === \"function\") {\r\n    this.items = args.items();\r\n  } else {\r\n    this.items = args.items;\r\n  }\r\n\r\n  /**\r\n   * Array of successful items once the transaction is finished\r\n   * @type {Array}\r\n   * @private\r\n   */\r\n  this.successes = [];\r\n\r\n  /**\r\n   * This method must be called by the map implementation to fail any individual item if the requested operation\r\n   * on the items fails.\r\n   * @param  {emp.typeLibrary.Error | emp.typeLibrary.Error[]} args An object with, among all other properties, the coreId of the item that failed.\r\n   */\r\n  this.fail = function(args) {\r\n    var i,\r\n      x,\r\n      removedItem;\r\n\r\n    if (!Array.isArray(args)) {\r\n      args = [args];\r\n    }\r\n\r\n    if (!this.hasOwnProperty(\"failures\")) {\r\n      this.failures = [];\r\n    }\r\n    for (i = 0; i < args.length; i = i + 1) {\r\n      for (x = 0; x < this.items.length; x = x + 1) {\r\n        if (this.items[x].coreId === args[i].coreId) {\r\n          removedItem = this.items.splice(x, 1);\r\n          switch (this.intent) {\r\n            case emp.intents.control.WMS_ADD:\r\n              args[i].id = removedItem[0].id;\r\n              args[i].overlayId = removedItem[0].overlayId;\r\n              break;\r\n            case emp.intents.control.MENU_CONTEXT_CREATE:\r\n              args[i].menuId = removedItem[0].menuId;\r\n              break;\r\n            case emp.intents.control.VISIBILITY_GET:\r\n              args[i].targetId = removedItem[0].coreId;\r\n              args[i].parentId = removedItem[0].parentId;\r\n              break;\r\n            default:\r\n              args[i].overlayId = removedItem[0].overlayId;\r\n              args[i].featureId = removedItem[0].featureId;\r\n              args[i].parentId = removedItem[0].parentId;\r\n              break;\r\n          }\r\n          this.failures.push(args[i]);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  // /**\r\n  //  * @private\r\n  //  */\r\n/*\r\n  this.breakCoreId = function(args) {\r\n    var returnVar = [],\r\n      i,\r\n      coreId;\r\n\r\n    for (i = 0; i < args.length; i = i + 1) {\r\n\r\n      coreId = args[i].coreId;\r\n      coreId = coreId.split(\".\");\r\n      if (coreId.length === 1) {\r\n        returnVar.push({\r\n          overlayId: coreId[0]\r\n        });\r\n      } else if (coreId.length === 2) {\r\n        returnVar.push({\r\n          overlayId: coreId[0],\r\n          featureId: coreId[1]\r\n        });\r\n      } else if (coreId.length === 3) {\r\n        returnVar.push({\r\n          overlayId: coreId[0],\r\n          parentId: coreId[1],\r\n          featureId: coreId[2]\r\n        });\r\n      }\r\n    }\r\n    return returnVar;\r\n  };\r\n*/\r\n  /**\r\n   * Used by CMAPI to finalize transaction prior to publishing.\r\n   * @return {void}\r\n   */\r\n\r\n  /**\r\n   * @private\r\n   */\r\n/*\r\n  this.close = function() {\r\n\r\n    var r = [],\r\n      i;\r\n    for (i = 0; i < this.items.length; i = i + 1) {\r\n      r.push({\r\n        coreId: this.items[i].coreId\r\n      });\r\n    }\r\n\r\n    if (this.items.length > 0) {\r\n      if ((this.items[0].bounds !== undefined &&\r\n          this.items[0].bounds !== null) ||\r\n        (this.items[0].location !== undefined &&\r\n          this.items[0].location !== null) ||\r\n        (this.items[0].range !== undefined &&\r\n          this.items[0].range !== null)) {\r\n        this.successes = [{\r\n          bounds: this.items[0].bounds,\r\n          center: this.items[0].location,\r\n          range: this.items[0].range\r\n        }];\r\n      } else if (this.intent === \"map.get\") {\r\n        this.successes = {\r\n          overlay: this.items[0].overlay,\r\n          feature: this.items[0].feature\r\n\r\n        };\r\n      } else {\r\n        this.successes = this.breakCoreId(r);\r\n      }\r\n    }\r\n\r\n    this.state = \"closed\";\r\n  };\r\n*/\r\n  /*\r\n     this is our setup for -INITIAL- validation errors.\r\n     This will not work twice.\r\n     */\r\n  /**\r\n   * List of failed items in the transaction.\r\n   * @type {Array}\r\n   * @private\r\n   */\r\n  this.failures = [];\r\n\r\n  /**\r\n   * @private\r\n   */\r\n\r\n  this.failInvalidItems = function() {\r\n    var i,\r\n      type = \"undefined\",\r\n      coreId = \"undefined\",\r\n      message = \"\";\r\n\r\n    if (this.items !== undefined && this.items !== null) {\r\n      for (i = 0; i < this.items.length; i++) {\r\n        if (this.items[i]) {\r\n          if (this.items[i].valid === false) {\r\n            if (this.items[i].hasOwnProperty('coreId')) {\r\n              coreId = this.items[i].coreId;\r\n            }\r\n            if (this.items[i].hasOwnProperty('globalType')) {\r\n              type = this.items[i].globalType;\r\n            }\r\n            message = \"The item with a core ID of \" + coreId + \" of type \" + type + \" is not valid and has been moved to the failure list on the transaction with an id of \" + this.transactionId;\r\n            this.fail([emp.typeLibrary.Error({\r\n              coreId: this.items[i].coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: message\r\n            })]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Used by the transaction to Queue it's self.\r\n   * @return {void}\r\n   */\r\n\r\n  this.queue = function() {\r\n    this.state = \"queued\";\r\n    emp.transactionQueue.add(this);\r\n  };\r\n\r\n  /**\r\n   * Used in intent control. Where are we.\r\n   * @type {Number}\r\n   * @private\r\n   */\r\n  this.sequenceNumber = 0;\r\n  /**\r\n   * Used to ensure we are not out of order.\r\n   * @type {Number}\r\n   * @private\r\n   */\r\n  this.lastNumber = 1;\r\n  /**\r\n   * Used to control close sequence\r\n   * @type {Number}\r\n   * @private\r\n   */\r\n  this.closeNumber = 0;\r\n  /**\r\n   * Control transaction state\r\n   * @type {String}\r\n   * @private\r\n   */\r\n  this.state = \"init\";\r\n  /**\r\n   * Used to describe if transaction is mid-stroke\r\n   * @type {Boolean}\r\n   * @private\r\n   */\r\n  this.inTask = false;\r\n  /**\r\n   * The primary method in which the transaction makes it through the intent workflow\r\n   * @method\r\n   * @return {void}\r\n   * @private\r\n   */\r\n  this.runner = function() {\r\n\r\n    var control = emp.intents.getSequence(this),\r\n      i,\r\n      e;\r\n\r\n    this.inTask = true;\r\n    //console.log(this.intent + \"  TransID:\" + this.transactionId + \" In runner.\");\r\n\r\n\r\n    if (this.state === \"paused\") {\r\n      this.inTask = false;\r\n      return false;\r\n    } else {\r\n      do {\r\n        for (i = this.sequenceNumber; i < control.forward.length; i = i + 1) {\r\n          if (this.items.length < 1) {\r\n            this.state = \"run\";\r\n            continue;\r\n          }\r\n          if (this.lastNumber === i) {\r\n            continue;\r\n          }\r\n\r\n          // set as we are running current task.\r\n          // (in case of async)\r\n          this.lastNumber = i;\r\n          //                this.inTask = true;\r\n\r\n          try {\r\n            control.forward[i](this);\r\n          } catch (err) {\r\n            // If the map engine generates an exception we must fail all items.\r\n            emp.typeLibrary.Error({\r\n              coreId: this.items[0].coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Intent \" + this.intent + \" function \" + i + \" generated an exception. All items are placed on the fail list.\",\r\n              jsError: err\r\n            });\r\n            while (this.items.length > 0) {\r\n              this.fail({\r\n                coreId: this.items[0].coreId\r\n              });\r\n            }\r\n            // In case it was paused we must set it to run.\r\n            this.state = \"running\";\r\n            //rValue = true;\r\n          }\r\n\r\n          this.sequenceNumber = i;\r\n\r\n          if (this.state === \"paused\") {\r\n            //bail.\r\n            // need to increment...\r\n            this.sequenceNumber = this.sequenceNumber + 1;\r\n            //console.log(this.intent + \"  TransID:\" + this.transactionId + \" Runner exit. Paused by action.\");\r\n            this.inTask = false;\r\n            return false;\r\n          }\r\n        }\r\n      } while (this.getNextItemSet());\r\n    }\r\n    // make sure we don't exit even if only one action.\r\n    if (this.state === \"paused\") {\r\n      this.sequenceNumber++;\r\n      //console.log(this.intent + \"  TransID:\" + this.transactionId + \" Runner exit. Paused after forward loop.\");\r\n      this.inTask = false;\r\n      return false;\r\n    } else {\r\n      for (e = this.closeNumber; e < control.exit.length; e = e + 1) {\r\n        try {\r\n          control.exit[e](this);\r\n        } catch (err) {\r\n          emp.typeLibrary.Error({\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"Intent \" + this.intent + \" exit function \" + i + \" generated an exception. All items are placed on the fail list.\",\r\n            jsError: err\r\n          });\r\n          while (this.items.length > 0) {\r\n            this.fail({\r\n              coreId: this.items[0].coreId\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      if (emp.transactionQueue.processHash.hasOwnProperty(this.transactionId)) {\r\n        delete emp.transactionQueue.processHash[this.transactionId];\r\n      }\r\n    }\r\n\r\n    //console.log(this.intent + \"  TransID:\" + this.transactionId + \" Runner clean exit.\");\r\n    this.inTask = false;\r\n  };\r\n\r\n  /**\r\n   * @method\r\n   * @description This method must be called by the map implementation if the operations\r\n   * requested by the transaction are not completed by the end of the request call.\r\n   */\r\n  this.pause = function() {\r\n    this.state = \"paused\";\r\n  };\r\n\r\n  /**\r\n   * @method\r\n   * @description This method must be called by the map implementation if it pauses the transaction at any point.\r\n   * Not running a paused transaction can cause unexpected behavior.\r\n   * @return {void}\r\n   */\r\n  this.run = function() {\r\n    if (!emp.transactionQueue.processHash.hasOwnProperty(this.transactionId)) {\r\n      emp.transactionQueue.processHash[this.transactionId] = this;\r\n      this.prepItemsForExecution();\r\n      this.failInvalidItems();\r\n      this.checkTransactionSplicing();\r\n    }\r\n    if (this.inTask === true) {\r\n      this.state = \"running\";\r\n    } else if (this.inTask === false) {\r\n      this.state = \"running\";\r\n      this.runner();\r\n    }\r\n\r\n  };\r\n\r\n  this.checkTransactionSplicing = function() {\r\n    switch (this.intent) {\r\n      // We will only splice the transaction for the following intents.\r\n      case emp.intents.control.FEATURE_ADD:\r\n      case emp.intents.control.FEATURE_REMOVE:\r\n      case emp.intents.control.VISIBILITY_SET:\r\n      case emp.intents.control.SELECTION_SET:\r\n      case emp.intents.control.WMS_ADD:\r\n      case emp.intents.control.WMS_REMOVE:\r\n      case emp.intents.control.OVERLAY_ADD:\r\n      case emp.intents.control.OVERLAY_REMOVE:\r\n      case emp.intents.control.OVERLAY_UPDATE:\r\n        if (this.items && (this.items.length > 1)) {\r\n          var sTempStr = JSON.stringify(this);\r\n\r\n          if (sTempStr.length > 2000000) {\r\n            //console.log(\"Splicing transaction \" + this.intent + \" with \" + this.items.length + \" items.\");\r\n            this.pendingItems = this.items;\r\n            this.items = [];\r\n            this.getNextItemSet();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  this.getNextItemSet = function() {\r\n    if (this.pendingItems && (this.pendingItems.length > 0)) {\r\n      var iCumSize = 0;\r\n      var sTempStr;\r\n      while (this.items.length > 0) {\r\n        this.duplicate(this.items[0].coreId);\r\n      }\r\n\r\n      var iNextChunkSize;\r\n      var iItemCnt = 0;\r\n      var oItem;\r\n\r\n      while ((this.pendingItems.length > 0) && (iItemCnt < 500)) {\r\n        oItem = this.pendingItems[0];\r\n        sTempStr = JSON.stringify(oItem);\r\n        iNextChunkSize = sTempStr.length;\r\n\r\n        if (((iCumSize + iNextChunkSize) > 2000000) && this.items.length > 0) {\r\n          // There are items in the items list but adding this one will\r\n          // put it over the limit. So break out and process the ones that are there first.\r\n          break;\r\n        }\r\n\r\n        iCumSize += iNextChunkSize;\r\n        this.items.push(oItem);\r\n        this.pendingItems.splice(0, 1);\r\n        iItemCnt++;\r\n      }\r\n      //console.log(\"     Processing next \" + iItemCnt + \" items. \" + iCumSize + \" Bytes\");\r\n\r\n      this.sequenceNumber = 0;\r\n      this.lastNumber = 1;\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * @description This parameter stores the original payload of cmapi messages.\r\n   * It is stored here for error processing.\r\n   * @private\r\n   */\r\n  this.originalMessage = args.originalMessage;\r\n  /**\r\n   * @private\r\n   */\r\n  this.messageOriginator = args.messageOriginator;\r\n  /**\r\n   * @private\r\n   */\r\n  this.originalMessageType = args.originalMessageType;\r\n\r\n  /**\r\n   * @private\r\n   * @description This field is populated with duplicate items that do not get sent to the map engines.\r\n   * However the transaction complete must add them back to the items list before\r\n   * publishing the message.\r\n   */\r\n  this.duplicateItems = [];\r\n\r\n  this.duplicate = function(sCoreId) {\r\n    var iIndex;\r\n    var removedItem;\r\n\r\n    for (iIndex = 0; iIndex < this.items.length; iIndex++) {\r\n      if (this.items[iIndex].coreId === sCoreId) {\r\n        // We found the item, so remove it from items and add it to duplicateItems.\r\n        removedItem = this.items.splice(iIndex, 1);\r\n        this.duplicateItems.push(removedItem[0]);\r\n        return;\r\n      }\r\n    }\r\n  };\r\n\r\n  this.returnDuplicatesToItems = function() {\r\n    var iIndex;\r\n\r\n    for (iIndex = 0; iIndex < this.duplicateItems.length; iIndex++) {\r\n      this.items.push(this.duplicateItems[iIndex]);\r\n    }\r\n\r\n    this.duplicateItems = [];\r\n  };\r\n\r\n  this.prepItemsForExecution = function() {\r\n    var iIndex,\r\n      len = this.items.length,\r\n      item;\r\n    for (iIndex = 0; iIndex < len; iIndex++) {\r\n      item = this.items[iIndex];\r\n      if ((item !== undefined) && (item !== null)\r\n              && item.hasOwnProperty('prepForExecution')\r\n              && (typeof item.prepForExecution === 'function')) {\r\n            item.prepForExecution();\r\n      }\r\n    }\r\n  };\r\n\r\n  this.isOnItemsList = function(oItem) {\r\n    var iIndex;\r\n    for (iIndex = 0; iIndex < this.items.length; iIndex++) {\r\n      if (this.items[iIndex].coreId === oItem.coreId) {\r\n        // Its already on the list.\r\n        return true;\r\n      }\r\n    }\r\n    for (iIndex = 0; iIndex < this.duplicateItems.length; iIndex++) {\r\n      if (this.duplicateItems[iIndex].coreId === oItem.coreId) {\r\n        // Its already on the list.\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  this.pushToItemsList = function(oItem) {\r\n    if (!this.isOnItemsList(oItem)) {\r\n      this.items.push(oItem);\r\n    }\r\n  };\r\n};\r\n","/* global emp */\r\n\r\n/**\r\n  * @classdesc This class represents an overlay in the EMP system.\r\n * @memberof emp.typeLibrary\r\n * @class\r\n *\r\n * @param {object} args\r\n * @param {string} args.transactionId\r\n * @param {string} [args.intent]\r\n * @param {string} args.name\r\n * @param {string} args.description\r\n * @param {string} [args.sender]\r\n * @param {string} args.coreParent\r\n * @param {string} args.coreId\r\n * @param {string} args.overlayId\r\n * @param {string} args.parentId\r\n * @param {boolean} [args.visible=false]\r\n * @param {boolean} args.readOnly\r\n * @param {object} [args.properties]\r\n * @param args.permissions\r\n * @param {boolean} args.hidden\r\n */\r\nemp.typeLibrary.Overlay = function (args) {\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field indicates the operation indicated in the transaction.\r\n     */\r\n    this.intent = args.intent || \"false\";\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field provides the transaction ID the request came in under.\r\n     */\r\n    this.transactionId = args.transactionId; /* REMOVED Auto Gen */\r\n\r\n    /**\r\n     * @field\r\n     * @type emp.typeLibrary.types\r\n     * @description This field identifies the class to all internal and external components.\r\n     * It is provided so it can be used in place of the instanceof operator.\r\n     * @see {@link emp.typeLibrary.types}\r\n     */\r\n    this.globalType = emp.typeLibrary.types.OVERLAY;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.tName = args.name;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.sender = args.sender || emp.helpers.id.newGUID();\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field provides a readable name for the overlay.\r\n     * If it is not provided one will be assigned.\r\n     */\r\n    this.name = (function (args) {\r\n            if (args.tName !== undefined && args.tName !== null) {\r\n                    return args.tName;\r\n            } else {\r\n                    if (args.intent !== \"overlay.update\") {\r\n                            var r = \"Overlay \" + args.sender;\r\n                            return r;\r\n                    }\r\n            }\r\n    }(this));\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field provides a readable description for the overlay.\r\n     */\r\n    this.description = args.description || \"No Description\";\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.type = \"overlay\";\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.disabled = false;\r\n    /* EMP-184 */\r\n    // this doesn't work if args.overlayId is 'set' to false... \r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field provides the unique identifier for the overlay.\r\n     */\r\n    this.overlayId = args.overlayId || args.sender;\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field is the primary key for the overlay in the system.\r\n     */\r\n    this.coreId = this.overlayId;\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field, if present, indicates the ID of its parent overlay.\r\n     * The map implementation must place this overlay as a child of the parent.\r\n     */\r\n    this.parentId = emp.helpers.id.get.setId(args.parentId);\r\n    this.coreParent = args.coreParent || this.parentId;\r\n\r\n    /**\r\n     * @field\r\n     * @type boolean\r\n     * @description This field indicates the visibility state of the overlay.\r\n     * The map implementation must create the overlay even if it is not visible.\r\n     */\r\n    this.visible = (args.visible !== false);\r\n\r\n    this.properties = args.properties || {};\r\n\r\n    if (this.properties.hasOwnProperty('readOnly'))\r\n    {\r\n        this.properties.readOnly = (this.properties.readOnly !== false);\r\n    }\r\n    else\r\n    {\r\n        this.properties.readOnly = (args.readOnly === true) || false;\r\n    }\r\n\r\n    /** Denotes a special layer that should not be returned in a general search */\r\n    this.hidden = args.hidden || false;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.schema = {\r\n            \"title\": \"EMP-Overlay Schema\",\r\n            \"type\": \"object\",\r\n            \"properties\": {\r\n                    \"overlayId\": {\r\n                            \"type\": \"string\"\r\n                    },\r\n                    \"name\": {\r\n                            \"type\": [\"string\", \"null\"]\r\n                    },\r\n                    \"parentId\": {\r\n                            \"type\": [\"string\", \"null\"]\r\n                    },\r\n                    \"iconUrl\": {\r\n                            \"type\": \"string\"\r\n                    },\r\n                    \"description\": {\r\n                            \"type\": \"string\"\r\n                    },\r\n                    \"permissions\": {\r\n                            \"type\": \"boolean\"\r\n                    },\r\n                    \"visible\": {\r\n                            \"type\": \"boolean\"\r\n                    },\r\n                    \"properties\": {\r\n                            \"type\": \"object\"\r\n                    },\r\n                    \"transactionId\": {\r\n                            \"type\": [\"string\", \"null\"]\r\n                    }\r\n            },\r\n      \"required\": [\"overlayId\"]\r\n    };\r\n    \r\n    this.validate();\r\n\r\n    /**\r\n     * @description Created a parent overlay for a overlay if it doesn't exist.\r\n     * This method must be called by the map implementation if the parent\r\n     * overlay indicated does not exists. The core will issue an overlay.add\r\n     * transaction which should create the overlay. Once this method returns\r\n     * the parent overlay should exists. But the map implementation must check\r\n     * for the parent in case the creation failed. In which case the overlay add\r\n     * must be failed.\r\n     */\r\n    this.createParent = function () {\r\n            var transaction,\r\n                    payload;\r\n\r\n            payload = {\r\n                    name: \"Overlay \" + this.sender,\r\n                    overlayId: this.parentId\r\n            };\r\n\r\n            transaction = new emp.typeLibrary.Transaction({\r\n                    intent: emp.intents.control.OVERLAY_ADD,\r\n                    originChannel: \"map.overlay.create\",\r\n                    sender: this.sender,\r\n                    transactionType: \"overlay\",\r\n                    type: \"transaction\",\r\n                    items: function () {\r\n                            var r = [];\r\n                            r.push(new emp.typeLibrary.Overlay(payload));\r\n                            return r;\r\n                    }\r\n            });\r\n            transaction.run();\r\n    };\r\n    \r\n    /**\r\n     * @method\r\n     * @description This function return a structure of the overlay field without the overhead of functions and private fields.\r\n     */\r\n    this.getObjectData = function()\r\n    {\r\n        return {\r\n                overlayId: this.overlayId,\r\n                parentId: this.parentId,\r\n                name: this.name,\r\n                description: this.description,\r\n                disabled: this.disabled,\r\n                readOnly: this.readOnly,\r\n                visible: this.visible,\r\n                iconUrl: this.iconUrl,\r\n                properties: emp.helpers.copyObject(this.properties)\r\n            };\r\n    };\r\n    \r\n    this.createDuplicate = function()\r\n    {\r\n        var oNewOverlay;\r\n        var stringFeature = JSON.stringify(this);\r\n        var objectFeature = JSON.parse(stringFeature);\r\n        \r\n        oNewOverlay = new emp.typeLibrary.Overlay(objectFeature);\r\n        \r\n        return oNewOverlay;\r\n    };\r\n\r\n\r\n    this.prepForExecution = function() {\r\n        // We don't need to do anything.\r\n    };\r\n};\r\n\r\n\r\nemp.typeLibrary.Overlay.prototype.validate = emp.typeLibrary.base.validate;\r\n/*\r\nemp.typeLibrary.Overlay.prototype.visibility = emp.typeLibrary.base.visibility;\r\nemp.typeLibrary.Overlay.prototype.locate = emp.typeLibrary.base.locate;\r\nemp.typeLibrary.Overlay.prototype.hasChildren = emp.typeLibrary.base.hasChildren;\r\nemp.typeLibrary.Overlay.prototype.hasParents = emp.typeLibrary.base.hasParents;\r\nemp.typeLibrary.Overlay.prototype.removeChild = emp.typeLibrary.base.removeChild;\r\nemp.typeLibrary.Overlay.prototype.addParent = emp.typeLibrary.base.addParent;\r\nemp.typeLibrary.Overlay.prototype.addChild = emp.typeLibrary.base.addChild;\r\nemp.typeLibrary.Overlay.prototype.getChildrenCoreIds = emp.typeLibrary.base.getChildrenCoreIds;\r\nemp.typeLibrary.Overlay.prototype.getParentCoreIds = emp.typeLibrary.base.getParentCoreIds;\r\nemp.typeLibrary.Overlay.prototype.childrenCount = emp.typeLibrary.base.childrenCount;\r\nemp.typeLibrary.Overlay.prototype.parentCount = emp.typeLibrary.base.parentCount;\r\nemp.typeLibrary.Overlay.prototype.getChild = emp.typeLibrary.base.getChild;\r\nemp.typeLibrary.Overlay.prototype.getParent = emp.typeLibrary.base.getParent;\r\nemp.typeLibrary.Overlay.prototype.isMultiParentRequired = emp.typeLibrary.base.isMultiParentRequired;\r\nemp.typeLibrary.Overlay.prototype.hasChildNodes = emp.typeLibrary.base.hasChildNodes;\r\nemp.typeLibrary.Overlay.prototype.getChildNodesCoreIds = emp.typeLibrary.base.getChildNodesCoreIds;\r\nemp.typeLibrary.Overlay.prototype.removeFromAllParent = emp.typeLibrary.base.removeFromAllParent;\r\nemp.typeLibrary.Overlay.prototype.getVisibilityWithParent = emp.typeLibrary.base.getVisibilityWithParent;\r\nemp.typeLibrary.Overlay.prototype.setVisibilityWithParent = emp.typeLibrary.base.setVisibilityWithParent;\r\nemp.typeLibrary.Overlay.prototype.getRootParent = emp.typeLibrary.base.getRootParent;\r\nemp.typeLibrary.Overlay.prototype.getVisibilityCount = emp.typeLibrary.base.getVisibilityCount;\r\nemp.typeLibrary.Overlay.prototype.getRootCoreId = emp.typeLibrary.base.getRootCoreId;\r\nemp.typeLibrary.Overlay.prototype.addAffectedChildren = emp.typeLibrary.base.addAffectedChildren;\r\nemp.typeLibrary.Overlay.prototype.isVisible = emp.typeLibrary.base.isVisible;\r\nemp.typeLibrary.Overlay.prototype.isUnderParent = emp.typeLibrary.base.isUnderParent;\r\nemp.typeLibrary.Overlay.prototype.addToOverlayFeatureList = emp.typeLibrary.base.addToOverlayFeatureList;\r\nemp.typeLibrary.Overlay.prototype.removeFromOverlayFeatureList = emp.typeLibrary.base.removeFromOverlayFeatureList;\r\nemp.typeLibrary.Overlay.prototype.removeAllChildrenFromOverlayFeatureList = emp.typeLibrary.base.removeAllChildrenFromOverlayFeatureList;\r\nemp.typeLibrary.Overlay.prototype.addAllChildrenToOverlayFeatureList = emp.typeLibrary.base.addAllChildrenToOverlayFeatureList;\r\nemp.typeLibrary.Overlay.prototype.isVisibilityAffected = emp.typeLibrary.base.isVisibilityAffected;\r\nemp.typeLibrary.Overlay.prototype.getVisibilitySettingWithParent = emp.typeLibrary.base.getVisibilitySettingWithParent;\r\n*/\r\n\r\n/**\r\n * @class\r\n * @description This class is used in the overlay.style call to set the style\r\n * of all the feature contained in the overlay.\r\n */\r\nemp.typeLibrary.OverlayStyle = function (args) {\r\n    \r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field is the primary key for the overlay the style applies to.\r\n     */\r\n    this.coreId = args.overlayId;\r\n    \r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field provides the unique identifier of the overlay the style is to be applied to.\r\n     */\r\n    this.overlayId = args.overlayId;\r\n    \r\n    /**\r\n     * @private\r\n     */\r\n    this.type = args.type || \"all\";\r\n    /**\r\n     * @field\r\n     * @type object\r\n     * @description This field provides the style properties to be applied.\r\n     */\r\n    this.properties = args.properties;\r\n    \r\n    /**\r\n     * @private\r\n     */\r\n    this.iconUrl = args.iconUrl;\r\n    \r\n    /**\r\n     * @private\r\n     */\r\n    this.schema = {\r\n        \"title\": \"EMP-Overlay-Style Schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"overlayId\": {\r\n                \"type\": \"string\"\r\n            },\r\n            \"type\": {\r\n                \"type\": \"string\",\r\n                \"enum\": [\r\n                    \"point\",\r\n                    \"line\",\r\n                    \"polygon\",\r\n                    \"multigeometry\",\r\n                    \"all\"\r\n                ]\r\n            },\r\n            \"properties\": {\r\n                \"type\": [\"object\", \"null\"]\r\n            }\r\n\r\n        },\r\n        \"required\": [\"overlayId\"]\r\n    };\r\n    this.validate();\r\n};\r\nemp.typeLibrary.OverlayStyle.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\nemp.typeLibrary.OverlayStyleType = {\r\n    POINT: 'point',\r\n    LINE: 'line',\r\n    POLYGON: 'polygon',\r\n    MULTIGEOMETRY: 'multigeometry'\r\n};\r\n\r\n\r\n/**\r\n * @class\r\n * @description This class is used in the overlay.cluster.set call to define a cluster\r\n * for an overlay\r\n */\r\nemp.typeLibrary.Overlay.Cluster = function (args)\r\n{\r\n/*\r\n{\r\n  threshold: integer (optional), \r\n  distance: integer (optional), \r\n  clusterStyle: object (optional){\r\n    label: string (optional), \r\n    title: string (optional), \r\n    summary: string (optional), \r\n    description: string (optional), \r\n    pointStyle: object (optional){\r\n      color: object (optional){\r\n        r: integer (required), \r\n        g: integer (required), \r\n        b: integer (required), \r\n        a: number (required)\r\n      }, \r\n      radius: integer | string (optional)\r\n    }, \r\n    iconStyle: object (optional){\r\n      url: string (required)\r\n    }\r\n  }, \r\n  overlayId: string (optional)\r\n}*/\r\n    this.coreId = undefined;\r\n    this.oClusterStyle = undefined;\r\n    \r\n    if (args instanceof emp.typeLibrary.Overlay.Cluster)\r\n    {\r\n        this.overlayId = args.getOverlayId();\r\n        this.iThreshold = args.getThreshold();\r\n        this.iDistance = args.getDistance();\r\n        this.oClusterStyle = args.getClusterStyle();\r\n\r\n        if (this.oClusterStyle)\r\n        {\r\n            this.oClusterStyle = new emp.typeLibrary.Overlay.Cluster.Style(this.oClusterStyle);\r\n        }\r\n    }\r\n    else\r\n    {\r\n        this.overlayId = args.overlayId;\r\n        this.iThreshold = args.threshold || 2;\r\n        this.iDistance = args.distance || 50;\r\n\r\n        if (args.clusterStyle)\r\n        {\r\n            this.oClusterStyle = new emp.typeLibrary.Overlay.Cluster.Style(args.clusterStyle);\r\n        }\r\n    }\r\n    \r\n    this.globalType = emp.typeLibrary.types.OVERLAY_CLUSTER;\r\n    \r\n    this.getCoreId = function()\r\n    {\r\n        return this.coreId;\r\n    };\r\n    \r\n    this.getOverlayId = function()\r\n    {\r\n        return this.overlayId;\r\n    };\r\n    \r\n    this.getThreshold = function()\r\n    {\r\n        return this.iThreshold;\r\n    };\r\n    \r\n    this.getDistance = function()\r\n    {\r\n        return this.iDistance;\r\n    };\r\n\r\n    this.getClusterStyle = function()\r\n    {\r\n        return this.oClusterStyle;\r\n    };\r\n    \r\n    this.prepForExecution = function()\r\n    {\r\n        var oOveraly = emp.storage.findOverlay(this.overlayId);\r\n\r\n        if (oOveraly)\r\n        {\r\n            this.coreId = oOveraly.coreId;\r\n        }\r\n    };\r\n};\r\n\r\nemp.typeLibrary.Overlay.Cluster.Style = function (oCS)\r\n{\r\n    this.oPointStyle = undefined;\r\n    this.oIconStyle = undefined;\r\n\r\n    if (oCS instanceof emp.typeLibrary.Overlay.Cluster.Style)\r\n    {\r\n        this.sLabel = oCS.getLabel();\r\n        this.sTitle = oCS.getTitle();\r\n        this.sSummary = oCS.getSummary();\r\n        this.sDescription = oCS.getDescription();\r\n        this.oPointStyle = oCS.getPointStyle();\r\n        this.oIconStyle = oCS.getIconStyle();\r\n\r\n        if (this.oPointStyle)\r\n        {\r\n            this.oPointStyle = new emp.typeLibrary.Overlay.Cluster.Style.PointStyle(this.oPointStyle);\r\n        }\r\n\r\n        if (this.oIconStyle)\r\n        {\r\n            this.oIconStyle = new emp.typeLibrary.Overlay.Cluster.Style.IconStyle(this.oIconStyle);\r\n        }\r\n    }\r\n    else\r\n    {\r\n        this.sLabel = oCS.label;\r\n        this.sTitle = oCS.title;\r\n        this.sSummary = oCS.summary;\r\n        this.sDescription = oCS.description;\r\n        this.oPointStyle = undefined;\r\n        this.oIconStyle = undefined;\r\n\r\n        if (oCS.pointStyle)\r\n        {\r\n            this.oPointStyle = new emp.typeLibrary.Overlay.Cluster.Style.PointStyle(oCS.pointStyle);\r\n        }\r\n\r\n        if (oCS.iconStyle)\r\n        {\r\n            this.oIconStyle = new emp.typeLibrary.Overlay.Cluster.Style.IconStyle(oCS.iconStyle);\r\n        }\r\n    }\r\n\r\n    this.getLabel = function()\r\n    {\r\n        return this.sLabel;\r\n    };\r\n    \r\n    this.getTitle = function()\r\n    {\r\n        return this.sTitle;\r\n    };\r\n    \r\n    this.getSummary = function()\r\n    {\r\n        return this.sSummary;\r\n    };\r\n    \r\n    this.getDescription = function()\r\n    {\r\n        return this.sDescription;\r\n    };\r\n    \r\n    this.getPointStyle = function()\r\n    {\r\n        return this.oPointStyle;\r\n    };\r\n    \r\n    this.getIconStyle = function()\r\n    {\r\n        return this.oIconStyle;\r\n    };\r\n};\r\n\r\nemp.typeLibrary.Overlay.Cluster.Style.PointStyle = function (oPS)\r\n{\r\n    if (oPS instanceof emp.typeLibrary.Overlay.Cluster.Style.PointStyle)\r\n    {\r\n        this.iRadius = oPS.getRadius();\r\n        this.oColor = oPS.getColor();\r\n    \r\n        if (this.oColor)\r\n        {\r\n            this.oColor = new emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color(this.oColor);\r\n        }\r\n    }\r\n    else\r\n    {\r\n        this.iRadius = oPS.radius || 6;\r\n        this.oColor = undefined;\r\n    \r\n        if (oPS.color)\r\n        {\r\n            this.oColor = new emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color(oPS.color);\r\n        }\r\n    }\r\n\r\n    this.getColor = function()\r\n    {\r\n        return this.oColor;\r\n    };\r\n    \r\n    this.getRadius = function()\r\n    {\r\n        return this.iRadius;\r\n    };\r\n    \r\n    this.createIcon = function(sText)\r\n    {\r\n        var iRadius = this.getRadius();\r\n        var oColor = \"#\" + this.oColor.getHexColor();\r\n\r\n        return emp.helpers.createCircleCanvas({\r\n                iRadius: iRadius,\r\n                dOpacity: this.oColor.getAlpha(),\r\n                sFillColor: oColor,\r\n                sTextColor: \"black\",\r\n                sText: sText\r\n            });\r\n    };\r\n};\r\n\r\nemp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color = function (oColor)\r\n{\r\n    if (oColor instanceof emp.typeLibrary.Overlay.Cluster.Style.PointStyle.Color)\r\n    {\r\n        this.iRed = oColor.getRed();\r\n        this.iGreen = oColor.getGreen();\r\n        this.iBlue = oColor.getBlue();\r\n        this.dAlpha = oColor.getAlpha();\r\n    }\r\n    else\r\n    {\r\n        this.iRed = 0;\r\n        this.iGreen = 0;\r\n        this.iBlue = 0;\r\n        this.dAlpha = 1.0;\r\n    \r\n        if (typeof (oColor.r) === 'number')\r\n        {\r\n            this.iRed = Math.round(Math.abs(oColor.r)) % 256;\r\n        }\r\n        else if (typeof (oColor.r) === 'string')\r\n        {\r\n            this.iRed = Math.round(Math.abs(parseInt(oColor.r))) % 256;\r\n        }\r\n\r\n        if (typeof (oColor.g) === 'number')\r\n        {\r\n            this.iGreen = Math.round(Math.abs(oColor.g)) % 256;\r\n        }\r\n        else if (typeof (oColor.g) === 'string')\r\n        {\r\n            this.iGreen = Math.round(Math.abs(parseInt(oColor.g))) % 256;\r\n        }\r\n\r\n        if (typeof (oColor.b) === 'number')\r\n        {\r\n            this.iBlue = Math.round(Math.abs(oColor.b)) % 256;\r\n        }\r\n        else if (typeof (oColor.b) === 'string')\r\n        {\r\n            this.iBlue = Math.round(Math.abs(parseInt(oColor.b))) % 256;\r\n        }\r\n\r\n        if (typeof (oColor.a) === 'number')\r\n        {\r\n            this.dAlpha = Math.round(Math.abs(oColor.a) * 10.0) / 10.0;\r\n        }\r\n        else if (typeof (oColor.a) === 'string')\r\n        {\r\n            this.dAlpha = Math.round(Math.abs(parseFloat(oColor.a)) * 10.0) / 10.0;\r\n        }\r\n    }\r\n\r\n    this.getRed = function()\r\n    {\r\n        return this.iRed;\r\n    };\r\n    \r\n    this.getGreen = function()\r\n    {\r\n        return this.iGreen;\r\n    };\r\n    \r\n    this.getBlue = function()\r\n    {\r\n        return this.iBlue;\r\n    };\r\n    \r\n    this.getAlpha = function()\r\n    {\r\n        return this.dAlpha;\r\n    };\r\n    \r\n    this.getHexColor = function()\r\n    {\r\n        var sColor = \"\";\r\n        var sByte = this.iRed.toString(16);\r\n\r\n        if (sByte.length === 1)\r\n        {\r\n            sByte = \"0\" + sByte;\r\n        }\r\n\r\n        sColor += sByte;\r\n\r\n        sByte = this.iGreen.toString(16);\r\n\r\n        if (sByte.length === 1)\r\n        {\r\n            sByte = \"0\" + sByte;\r\n        }\r\n\r\n        sColor += sByte;\r\n\r\n        sByte = this.iBlue.toString(16);\r\n\r\n        if (sByte.length === 1)\r\n        {\r\n            sByte = \"0\" + sByte;\r\n        }\r\n\r\n        sColor += sByte;\r\n\r\n        return sColor;\r\n    };\r\n    \r\n    this.getFullHexColor = function()\r\n    {\r\n        var sColor = this.getHexColor();\r\n\r\n        var sByte = Math.round(this.dAlpha * 255).toString(16);\r\n\r\n        if (sByte.length === 1)\r\n        {\r\n            sByte = \"0\" + sByte;\r\n        }\r\n\r\n        sColor = sByte + sColor;\r\n\r\n        return sColor;\r\n    };\r\n};\r\n\r\nemp.typeLibrary.Overlay.Cluster.Style.IconStyle = function (oIS)\r\n{\r\n    if (oIS instanceof emp.typeLibrary.Overlay.Cluster.Style.IconStyle)\r\n    {\r\n        this.sUrl = oIS.getURL();\r\n    }\r\n    else\r\n    {\r\n        this.sUrl = oIS.url;\r\n    }\r\n    \r\n    this.getURL = function()\r\n    {\r\n        return this.sUrl;\r\n    };\r\n};\r\n","/* globals emp */\r\n\r\n\r\n/**\r\n * @memberof emp.typeLibrary\r\n * @class\r\n * @description This class represent a feature within EMP.\r\n */\r\nemp.typeLibrary.Feature = function (args) {\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field any parameter required by the intent.\r\n   */\r\n  this.intentParams = args.intentParams; //No\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field shall contain the feature identifier of the feature.\r\n   */\r\n  this.featureId = emp.helpers.id.get.setId(args.featureId);\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field shall contain the unique identifier of the overlay\r\n   * which contains the feature.\r\n   */\r\n  this.overlayId = emp.helpers.id.get.setId(args.overlayId) || args.sender;\r\n\r\n  /**\r\n   * @field\r\n   * @type string | undefined\r\n   * @description This field, if present, along with the overlayId identify the parent\r\n   * feature of the feature.\r\n   */\r\n  this.parentId = emp.helpers.id.get.setId(args.parentId);\r\n\r\n  /**\r\n   * @field\r\n   * @type string=\r\n   * @description This field is only applicable of feature updates. If present\r\n   * it indicates that the feature is moving to a new parent. It contains\r\n   * the unique identifier of the new overlay.\r\n   */\r\n\r\n  this.destOverlayId = emp.helpers.id.get.setId(args.newOverlayId);\r\n\r\n  /**\r\n   * @field\r\n   * @type string=\r\n   * @description This field is only applicable of feature updates. If present\r\n   * it indicates that the feature is moving to a new parent. It contains\r\n   * the feature identifier of the new parent feature.\r\n   */\r\n  this.destParentId = emp.helpers.id.get.setId(args.newParentId);\r\n\r\n  /**\r\n   * @field\r\n   * @type emp3.api.enums.FeatureTypeEnum\r\n   * @description This field applies for feature adds in which it identifies the\r\n   * type of feature being added.\r\n   */\r\n  this.format = (this.intent !== \"feature.update\") ? args.format || \"kml\" : null;\r\n\r\n  /**\r\n   * @field\r\n   * @type emp.typeLibrary.types\r\n   * @description This field identifies the class to all internal and external components.\r\n   * It is provided so it can be used in place of the instanceof operator.\r\n   * @see {@link emp.typeLibrary.types}\r\n   */\r\n  this.globalType = emp.typeLibrary.types.FEATURE;\r\n\r\n  /**\r\n   * @field\r\n   * @description the content of this field will depend on the format field. (see {@link emp.typeLibrary.featureFormatType})\r\n   */\r\n  this.data = {};\r\n  if (args.data) {\r\n    this.data = emp.helpers.copyObject(args.data);\r\n  }\r\n  else if (args.feature) {\r\n    this.data = emp.helpers.copyObject(args.feature);\r\n  }\r\n\r\n  /**\r\n   * @field\r\n   * @type boolean\r\n   * @description This field indicates if the map implementation should zoom to\r\n   * the feature once it is added to the map.\r\n   */\r\n  this.zoom = args.zoom || false;\r\n\r\n  /**\r\n   * @field\r\n   * @type string=\r\n   * @description This field, if present, provides the menu identifier for a\r\n   * feature specific menu.\r\n   */\r\n  this.menuId = args.menuId || \"\";\r\n\r\n  /**\r\n   * @field\r\n   * @type string=\r\n   * @description This field only applies to features of type === \"url\", if present,\r\n   * it provides the actual unescaped URL the implementation is to use to access the feature.\r\n   */\r\n  this.url = args.url;\r\n\r\n  /**\r\n   * @field\r\n   * @type string=\r\n   * @description This field, if present,\r\n   * it provides any parameters needed to render the feature. I.E. the bounding box for an image.\r\n   */\r\n  this.params = args.params || {};\r\n\r\n  /**\r\n   * @field\r\n   * @type boolean\r\n   * @description This field indicates if the feature is to be made visible on the map.\r\n   * The implementation must NOT assume that all features added are to be made\r\n   * visible.\r\n   */\r\n  this.visible = (args.visible !== false);\r\n\r\n  /**\r\n   * @field\r\n   * @type boolean\r\n   * @description This field indicates if the feature is to be displayed as visible.\r\n   * The visibile indicator may be different if the parent has been made none visible.\r\n   * visible.\r\n   */\r\n  this.visibilitySetting = args.visibilitySetting || this.visible;\r\n\r\n  /**\r\n   * @field\r\n   * @type string=\r\n   * @description This field provides a readable description of the feature. The map implementation\r\n   * may choose to display this description on the map.\r\n   */\r\n  this.description = (args.description ? unescape(args.description) : \"\");\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.selected = args.selected || false;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field is present for MilStd and airspace features.\r\n   */\r\n  this.symbolCode = this.data.symbolCode;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field provides the default color for the feature.\r\n   */\r\n  this.color = \"993366ff\";\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field is only present for backward compatibility. New map engines\r\n   * should access this.data.coordinates.\r\n   */\r\n  this.coordinates = this.data.coordinates;\r\n\r\n  /**\r\n   * @field\r\n   * @type emp.typeLibrary.Feature.propertiesType\r\n   * @description This field contains the properties needed to render the feature.\r\n   */\r\n  this.properties = (args.properties ? emp.helpers.copyObject(args.properties) : {});\r\n\r\n  if (this.properties.modifiers) {\r\n    this.properties.modifiers = (function (args) {\r\n      return JSON.parse((typeof args.properties.modifiers === \"string\") ? unescape(args.properties.modifiers) : JSON.stringify(args.properties.modifiers));\r\n    })(this);\r\n  }\r\n\r\n  /* This is to support disabling a feature on map and in tree,\r\n   *  needs to be set to false by default\r\n   *  so map engine and tree have a consistent property to work with\r\n   */\r\n  if (!this.properties.hasOwnProperty('disabled')) {\r\n    this.properties.disabled = false;\r\n  } else {\r\n    this.properties.disabled = (this.properties.disabled === true);\r\n  }\r\n\r\n  /**\r\n   * @field\r\n   * @type boolean=\r\n   * @description This field indicates that the feature is to be invisible on the map.\r\n   */\r\n  this.disabled = this.properties.disabled;\r\n\r\n  // fix for CMWA 1.2.  readOnly is passed as a channel item.  Pushing it back into\r\n  // properties where engines are looking for it.\r\n  if ((this.properties.readOnly !== true) && (this.properties.readOnly !== false)) {\r\n    if ((this.readOnly === true) || (this.readOnly === false)) {\r\n      this.properties.readOnly = this.readOnly;\r\n    }\r\n    else {\r\n      this.properties.readOnly = false;\r\n    }\r\n  }\r\n\r\n  // Check if the iconUrl is a relative path and make an absolute path as some engine GE, WW need an absoplut path to load icons\r\n  if (this.properties.hasOwnProperty(\"iconUrl\")) {\r\n    // strip off all white space so regular expression in relToAbs does not fail.\r\n    this.properties.iconUrl = this.properties.iconUrl.trim();\r\n    this.properties.iconUrl = emp.helpers.relToAbs(this.properties.iconUrl);\r\n  }\r\n\r\n  /**\r\n   * @field\r\n   * @type boolean\r\n   * @description This field indicates if the feature is to be readOnly or not.\r\n   * Read only feature can not be placed in edit mode.\r\n   */\r\n  this.readOnly = this.properties.readOnly;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.complete = args.complete;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.updateEventType = args.updateEventType;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.updates = args.updates;\r\n\r\n  // overlay the updates...\r\n  // NOTE: This has to go above the support logic because the support logic handles\r\n  // some specific cases that can come though on updates.\r\n\r\n  // check the parent disabled state. parent state overrules children disabled state for the case of parent.disabled == true.\r\n  if (this.overlayId !== undefined && this.overlayId !== null && this.parentId !== undefined && this.parentId !== null) {\r\n    var tempCoreParentId = this.overlayId + \".\" + this.parentId;\r\n    var tempParent = emp.storage.get.id({\r\n      id: tempCoreParentId\r\n    });\r\n\r\n    if (tempParent) {\r\n      this.disabled = (tempParent && tempParent.disabled !== undefined && tempParent.disabled !== null) ? this.disabled || tempParent.disabled : this.disabled;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field provides the feature with a readable name. The map\r\n   * implementation may choose to display this value along with the feature.\r\n   */\r\n  this.name = args.name;\r\n\r\n  /*\r\n   Schema\r\n   */\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.schema = {\r\n    \"title\": \"EMP-Feature Schema\",\r\n    \"type\": \"object\",\r\n    \"properties\": {\r\n      \"featureId\": {\r\n        \"type\": \"string\"\r\n      },\r\n      \"name\": {\r\n        \"type\": [\"string\", \"null\"]\r\n      },\r\n      \"data\": {\r\n        \"type\": [\"object\", \"string\"]\r\n      },\r\n      \"format\": {\r\n        \"type\": [\"string\", \"null\"],\r\n        \"enum\": [null, \"geojson\", \"kml\", \"image\", emp3.api.enums.FeatureTypeEnum.GEO_POINT, emp3.api.enums.FeatureTypeEnum.GEO_PATH,\r\n          emp3.api.enums.FeatureTypeEnum.GEO_POLYGON, emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL, emp3.api.enums.FeatureTypeEnum.GEO_ACM,\r\n          emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE, emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE, emp3.api.enums.FeatureTypeEnum.GEO_SQUARE,\r\n          emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE, emp3.api.enums.FeatureTypeEnum.GEO_TEXT]\r\n      },\r\n      \"overlayId\": {\r\n        \"type\": \"string\"\r\n      }, // revisit : should be GUID\r\n      \"zoom\": {\r\n        \"type\": \"boolean\"\r\n      },\r\n      \"properties\": {\r\n        \"type\": [\"object\", \"null\"],\r\n        \"properties\": {\r\n          \"altitudeMode\": {\r\n            \"type\": [\"string\", \"null\"],\r\n            \"enum\": [null, emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND,\r\n              emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND,\r\n              emp.typeLibrary.featureAltitudeModeType.ABSOLUTE]\r\n          }\r\n        }\r\n      },\r\n      \"menuId\": {\r\n        \"type\": \"string\"\r\n      },\r\n      \"params\": {\r\n        \"type\": \"object\"\r\n      },\r\n      \"visible\": {\r\n        \"type\": \"boolean\"\r\n      },\r\n      \"disable\": {\r\n        \"type\": \"boolean\"\r\n      }\r\n    },\r\n    \"required\": [\"featureId\", \"data\", \"format\", \"overlayId\"]\r\n  };\r\n\r\n  if ((this.url !== undefined) & (this.url !== null) && (this.url !== \"\")) {\r\n    this.schema.properties.url = {};\r\n    this.schema.properties.url.type = \"string\";\r\n    this.schema.required = [\"featureId\", \"url\", \"format\", \"overlayId\"];\r\n    this.schema.properties.format[\"enum\"] = [\"kml\", \"geojson\", \"image\", \"arc\"];\r\n  }\r\n  /*\r\n   if (this.intent === \"feature.remove\") {\r\n   this.schema.properties = {\r\n   \"featureId\": {\r\n   \"type\": \"string\"\r\n   }\r\n   };\r\n   this.schema.required = [\"featureId\"];\r\n   }\r\n   if (this.intent === \"overlay.clear\") {\r\n   this.schema.properties = {\r\n   \"overlayId\": {\r\n   \"type\": \"string\"\r\n   },\r\n   \"transactionId\": {\r\n   \"type\": [\"string\", \"null\"]\r\n   },\r\n   \"parentId\": {\r\n   \"type\": [\"string\", \"null\"]\r\n   },\r\n   \"featureId\": {\r\n   \"type\": [\"string\", \"null\"]\r\n   }\r\n   };\r\n   this.schema.required = [\"overlayId\"];\r\n   }\r\n   if (this.intent === \"visibility.get\") {\r\n   this.schema.required = [\"featureId\", \"overlayId\"];\r\n   }\r\n   if (this.intent === \"feature.update\") {\r\n   this.schema.required = [];\r\n   }\r\n   */\r\n  /**\r\n   * @description Create a parent overlay for a feature if it doesn't exist\r\n   *\r\n   * @returns {transaction} transaction - the transaction containing the new overlay to be added\r\n   * @returns {array} transaction.items - the item to be added to the map. In this case, a {@link Overlay}\r\n   */\r\n  this.createParent = function () {\r\n    var transaction,\r\n      payload;\r\n\r\n    if ((this.parentId !== undefined) && (this.parentId !== null)) {\r\n      // We can not create a feature as parent.\r\n      return;\r\n    }\r\n\r\n    payload = {\r\n      name: \"Overlay \" + this.overlayId,\r\n      overlayId: this.overlayId\r\n    };\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.OVERLAY_ADD,\r\n      originChannel: \"map.overlay.create\",\r\n      sender: this.sender,\r\n      items: function () {\r\n        var r = [];\r\n        r.push(new emp.typeLibrary.Overlay(payload));\r\n        return r;\r\n      }\r\n    });\r\n    transaction.run();\r\n\r\n  };\r\n\r\n  /**\r\n   * @description Create the destination parent overlay for a feature if it doesn't exist\r\n   *\r\n   */\r\n  this.createDestinationParent = function () {\r\n    var transaction,\r\n      payload;\r\n\r\n    payload = {\r\n      name: \"Overlay \" + this.destOverlayId,\r\n      overlayId: this.destOverlayId,\r\n      parentId: \"\"\r\n    };\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      length: 1,\r\n      intent: \"overlay.add\",\r\n      transactionId: this.transactionId + \".parent\",\r\n      originChannel: \"map.overlay.create\",\r\n      sender: this.sender,\r\n      transactionType: \"overlay\",\r\n      type: \"transaction\",\r\n      items: function () {\r\n        var r = [];\r\n        r.push(new emp.typeLibrary.Overlay(payload));\r\n        return r;\r\n      }\r\n    });\r\n    transaction.run();\r\n\r\n  };\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field provides the features primary key.\r\n   */\r\n  this.coreId = args.coreId;\r\n\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field provides the features parent primary key.\r\n   */\r\n  this.coreParent = args.coreParent;\r\n\r\n  this.parentCoreId = args.parentCoreId;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field applies only to an update operation. It provides the features new primary key for a move operation.\r\n   */\r\n  this.destCoreId = undefined;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field applies only to an update operation. It provides the new primary key of the new parent for a move operation.\r\n   */\r\n  this.destCoreParent = undefined;\r\n\r\n  // We will call validate from the handlers.\r\n  //this.validate();\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.currentlyInEditMode = false;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.setEditMode = function (bValue) {\r\n    this.currentlyInEditMode = bValue;\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.isInEditMode = function () {\r\n    return this.currentlyInEditMode;\r\n  };\r\n\r\n  /**\r\n   * @method\r\n   * @description This function return a structure of the feature field without theoverhead of functions and private fields.\r\n   */\r\n  this.getFeatureStructure = function () {\r\n    return {\r\n      overlayId: this.overlayId,\r\n      parentId: this.parentId,\r\n      featureId: this.featureId,\r\n      name: this.name,\r\n      description: this.description,\r\n      format: this.format,\r\n      data: emp.helpers.copyObject(this.data),\r\n      menuId: this.menuId,\r\n      url: this.url,\r\n      params: this.params,\r\n      visible: this.visible,\r\n      readOnly: this.properties.readOnly,\r\n      properties: emp.helpers.copyObject(this.properties)\r\n    };\r\n  };\r\n  this.getObjectData = function () {\r\n    return this.getFeatureStructure();\r\n  };\r\n\r\n  /**\r\n   * @method\r\n   * @description This function copies the fields from one struction (oFromFeature) to this feature.\r\n   * @param {emp.typeLibrary.Feature} oFromFeature This parameter must be an object with feature field values.\r\n   */\r\n  this.copyFromFeature = function (oFromFeature) {\r\n    if (oFromFeature.hasOwnProperty(\"name\")) {\r\n      this.name = oFromFeature.name;\r\n    }\r\n\r\n    if (oFromFeature.hasOwnProperty(\"data\")) {\r\n      this.symbolCode = undefined;\r\n      this.coordinates = {};\r\n\r\n      this.data = emp.helpers.copyObject(oFromFeature.data);\r\n\r\n      if (this.data.hasOwnProperty(\"symbolCode\")) {\r\n        this.symbolCode = oFromFeature.data.symbolCode;\r\n      }\r\n\r\n      if (this.data.hasOwnProperty(\"coordinates\")) {\r\n        this.coordinates = oFromFeature.data.coordinates;\r\n      }\r\n    }\r\n\r\n    if (oFromFeature.hasOwnProperty(\"properties\")) {\r\n      this.properties = emp.helpers.copyObject(oFromFeature.properties);\r\n    }\r\n\r\n    if (oFromFeature.hasOwnProperty(\"menuId\") && (oFromFeature.menuId !== \"\")) {\r\n      this.menuId = oFromFeature.menuId;\r\n    }\r\n\r\n    if (oFromFeature.hasOwnProperty(\"url\")) {\r\n      this.url = oFromFeature.url;\r\n    }\r\n\r\n    //if (oFromFeature.hasOwnProperty(\"visible\"))\r\n    //{\r\n    //    this.visible = oFromFeature.visible;\r\n    //}\r\n\r\n    if (oFromFeature.hasOwnProperty(\"description\")) {\r\n      this.description = oFromFeature.description;\r\n    }\r\n\r\n    if (oFromFeature.hasOwnProperty(\"disabled\")) {\r\n      this.disabled = oFromFeature.disabled;\r\n    }\r\n\r\n    if (oFromFeature.hasOwnProperty(\"readOnly\")) {\r\n      this.readOnly = oFromFeature.readOnly;\r\n      this.properties.readOnly = oFromFeature.readOnly;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @method\r\n   * @description This function creates an un-referenced standalone copy of this feature.\r\n   */\r\n  this.createDuplicate = function () {\r\n    var oNewFeature;\r\n    var sCoreId = this.coreId;\r\n    var sCoreParent = this.coreParent;\r\n    var sParentCoreId = this.parentCoreId;\r\n    var oNodes = this.nodes;\r\n    var oParentNodes = this.parentNodes;\r\n    var oChildNodes = this.childNodes;\r\n\r\n    this.nodes = {};\r\n    this.parentNodes = {};\r\n    this.childNodes = {};\r\n\r\n    var stringFeature = JSON.stringify(this);\r\n    var objectFeature = JSON.parse(stringFeature);\r\n\r\n    this.nodes = oNodes;\r\n    this.parentNodes = oParentNodes;\r\n    this.childNodes = oChildNodes;\r\n\r\n    oNewFeature = new emp.typeLibrary.Feature(objectFeature);\r\n\r\n    oNewFeature.coreId = sCoreId;\r\n    oNewFeature.coreParent = sCoreParent;\r\n    oNewFeature.parentCoreId = sParentCoreId;\r\n\r\n    return oNewFeature;\r\n  };\r\n\r\n  /**\r\n   * @method\r\n   * @private\r\n   * @description This function is used to apply an update to the feature.\r\n   */\r\n  this.applyUpdate = function (args) {\r\n    this.destOverlayId = undefined;\r\n    this.destParentId = undefined;\r\n\r\n    if (args.hasOwnProperty(\"newOverlayId\")) {\r\n      this.destOverlayId = args.newOverlayId;\r\n    }\r\n\r\n    if (args.hasOwnProperty(\"newParentId\")) {\r\n      this.destParentId = args.newParentId;\r\n    }\r\n\r\n    if (this.destOverlayId || this.destParentId) {\r\n      var oParent;\r\n\r\n      if (this.destParentId) {\r\n        oParent = emp.storage.findFeature(this.destOverlayId, this.destParentId);\r\n      }\r\n      else {\r\n        oParent = emp.storage.findOverlay(this.destOverlayId);\r\n      }\r\n\r\n      this.destCoreParent = (oParent ? oParent.coreId : undefined);\r\n    }\r\n\r\n    this.copyFromFeature(args);\r\n\r\n    // check the parent disabled state for the case of a feature move (destCoreParent present). parent state overrules children disabled state\r\n    // for the case of parent.disabled == true.\r\n    if (this.destCoreParent && this.destCoreParent !== null && this.destCoreParent !== undefined) {\r\n      var tempParent = emp.storage.get.id({\r\n        id: this.destCoreParent\r\n      });\r\n\r\n      if (tempParent) {\r\n        this.disabled = (tempParent && tempParent.disabled !== undefined && tempParent.disabled !== null) ? this.disabled || tempParent.disabled : this.disabled;\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  this.prepForExecution = function () {\r\n    this.coreId = this.featureId;\r\n\r\n    if (this.coreParent === undefined) {\r\n      if (this.parentId) {\r\n        // The parent is a feature\r\n        var oParent = emp.storage.findFeature(this.overlayId, this.parentId);\r\n        if (oParent === undefined) {\r\n          this.coreParent = undefined;\r\n        }\r\n        else {\r\n          this.coreParent = oParent.getCoreId();\r\n        }\r\n      } else {\r\n        // The parent is an overlay.\r\n        this.coreParent = this.overlayId;\r\n      }\r\n    }\r\n\r\n    if (this.parentCoreId === undefined) {\r\n      var oParentOverlay = emp.storage.findOverlay(this.overlayId);\r\n      if (oParentOverlay) {\r\n        this.parentCoreId = oParentOverlay.getRootCoreId();\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\nemp.typeLibrary.Feature.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n/**\r\n * Generates a data object in the correct format dependant on the Feature.format and the supplied updates\r\n * Pass is an args object args = {feature: [instance of emp.typeLibrary.Feature], updates: [update object for edits here]}\r\n * This is a stateless utility function that does not access instance properties of a Feature instance so it should be declared on the prototype,\r\n * not as a property of \"this.\" in the emp.typeLibrary.Feature definition.\r\n * methods defined on the prototype are less expensive as they are only create once and used by every instance, whereas\r\n * those declared in the Feature instance \"this\" will be created each time a Feature is instantiated\r\n *\r\n * @param {object} args\r\n * @param {emp.typeLibrary.Feature} args.feature\r\n * @param {Array} args.updates\r\n */\r\nemp.typeLibrary.Feature.prototype.generateData = function (args) {\r\n  var len,\r\n    i,\r\n    geoJsonCoords = [],\r\n    data = {},\r\n    format = args.feature.format || \"geojson\";\r\n\r\n  /**\r\n   * Converts a JQuery xml object to an xml string\r\n   * @param {node} xmlObj\r\n   */\r\n  function getXmlString(xmlObj) {\r\n    var output = \"\";\r\n\r\n    emp.util.each(xmlObj.childNodes, function (node) {\r\n      if (node.nodeType !== emp.util.enums.DOMNodeTypes.Text) {\r\n        output += \"<\" + node.nodeName;\r\n\r\n        emp.util.each(node.attributes, function (attrib) {\r\n          output += \" \" + attrib.name + \"=\";\r\n          output += \"\\\"\" + attrib.value + \"\\\"\";\r\n        });\r\n\r\n        output += \">\";\r\n      }\r\n\r\n      if (node.childNodes.length > 0) {\r\n        output += getXmlString(node);\r\n      } else {\r\n        output += node.nodeValue;\r\n      }\r\n\r\n      if (node.nodeType !== emp.util.enums.DOMNodeTypes.Text) {\r\n        output += \"</\" + node.nodeName + \">\";\r\n      }\r\n    });\r\n    return output;\r\n  }\r\n\r\n  function buildGeoJsonPoint(oNewCoordinates) {\r\n    var geoJsonCoords;\r\n\r\n    if ((oNewCoordinates[0].alt === undefined) ||\r\n      (oNewCoordinates[0].alt === null)) {\r\n      geoJsonCoords = [oNewCoordinates[0].lon, oNewCoordinates[0].lat];\r\n    }\r\n    else {\r\n      geoJsonCoords = [oNewCoordinates[0].lon, oNewCoordinates[0].lat, oNewCoordinates[0].alt];\r\n    }\r\n    return {\r\n      \"type\": \"Point\",\r\n      \"coordinates\": geoJsonCoords\r\n    };\r\n  }\r\n\r\n  function buildGeoJsonLineString(oNewCoordinates) {\r\n    var geoJsonCoords = [];\r\n    var iLength = oNewCoordinates.length;\r\n\r\n    for (var iIndex = 0; iIndex < iLength; iIndex++) {\r\n      if ((oNewCoordinates[iIndex].alt === undefined) ||\r\n        (oNewCoordinates[iIndex].alt === null)) {\r\n        geoJsonCoords.push([oNewCoordinates[iIndex].lon, oNewCoordinates[iIndex].lat]);\r\n      }\r\n      else {\r\n        geoJsonCoords.push([oNewCoordinates[iIndex].lon, oNewCoordinates[iIndex].lat, oNewCoordinates[iIndex].alt]);\r\n      }\r\n    }\r\n    return {\r\n      \"type\": \"LineString\",\r\n      \"coordinates\": geoJsonCoords\r\n    };\r\n  }\r\n\r\n  function buildGeoJsonPolygon(oNewCoordinates) {\r\n    var geoJsonCoords = [];\r\n    var iLength = oNewCoordinates.length;\r\n\r\n    for (var iIndex = 0; iIndex < iLength; iIndex++) {\r\n      if ((oNewCoordinates[iIndex].alt === undefined) ||\r\n        (oNewCoordinates[iIndex].alt === null)) {\r\n        geoJsonCoords.push([oNewCoordinates[iIndex].lon, oNewCoordinates[iIndex].lat]);\r\n      }\r\n      else {\r\n        geoJsonCoords.push([oNewCoordinates[iIndex].lon, oNewCoordinates[iIndex].lat, oNewCoordinates[iIndex].alt]);\r\n      }\r\n    }\r\n    return {\r\n      \"type\": \"Polygon\",\r\n      \"coordinates\": [geoJsonCoords]\r\n    };\r\n  }\r\n\r\n  function buildGeoJsonFeature(oFeatureData, oNewCoordinates) {\r\n    var oData = emp.helpers.copyObject(oFeatureData);\r\n    var oGeometryData;\r\n\r\n    switch (oData.geometry.type.toLowerCase()) {\r\n      case 'point':\r\n        oGeometryData = buildGeoJsonPoint(oNewCoordinates);\r\n        break;\r\n      case 'linestring':\r\n        oGeometryData = buildGeoJsonLineString(oNewCoordinates);\r\n        break;\r\n      case 'polygon':\r\n        oGeometryData = buildGeoJsonPolygon(oNewCoordinates);\r\n        break;\r\n      default:\r\n        // Else leave it the same.\r\n        oGeometryData = oData.geometry;\r\n        break;\r\n    }\r\n\r\n    oData.geometry = oGeometryData;\r\n\r\n    return oData;\r\n  }\r\n\r\n  switch (format) {\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n      len = args.updates.coordinates.length;\r\n      i = 0;\r\n      geoJsonCoords = [];\r\n      if (len === 1) {\r\n        if ((args.updates.coordinates[0].alt === undefined) ||\r\n          (args.updates.coordinates[0].alt === null)) {\r\n          geoJsonCoords = [args.updates.coordinates[0].lon, args.updates.coordinates[0].lat];\r\n        }\r\n        else {\r\n          geoJsonCoords = [args.updates.coordinates[0].lon, args.updates.coordinates[0].lat, args.updates.coordinates[0].alt];\r\n        }\r\n        data = {\r\n          \"type\": \"Point\",\r\n          \"coordinates\": geoJsonCoords\r\n        };\r\n      } else {\r\n        for (i = 0; i < len; i++) {\r\n          if ((args.updates.coordinates[i].alt === undefined) ||\r\n            (args.updates.coordinates[i].alt === null)) {\r\n            geoJsonCoords.push([args.updates.coordinates[i].lon, args.updates.coordinates[i].lat]);\r\n          }\r\n          else {\r\n            geoJsonCoords.push([args.updates.coordinates[i].lon, args.updates.coordinates[i].lat, args.updates.coordinates[i].alt]);\r\n          }\r\n        }\r\n        data = {\r\n          \"type\": \"LineString\",\r\n          \"coordinates\": geoJsonCoords\r\n        };\r\n      }\r\n      data.symbolCode = args.feature.symbolCode;\r\n      break;\r\n    case emp.typeLibrary.featureFormatType.KML:\r\n      var coords = args.updates.coordinates;\r\n      var coordString = \"\";\r\n      len = coords.length;\r\n      var kmlString = \"\";\r\n      for (i = 0; i < len; i++) {\r\n        coordString += coords[i].lon + \",\" + coords[i].lat;\r\n        if (coords[i].hasOwnProperty(\"alt\")) {\r\n          coordString += \",\" + coords[i].alt;\r\n        }\r\n        if (i < len - 1) {\r\n          coordString += \" \";\r\n        }\r\n      }\r\n      var kmlDoc = emp.util.parseXML(args.feature.data);\r\n      emp.util.each(kmlDoc.getElementsByTagName(\"coordinates\"), function (coord) {\r\n        coord.childNodes[0].nodeValue = coordString;\r\n      });\r\n\r\n      kmlString = getXmlString(kmlDoc);\r\n      data = kmlString;\r\n\r\n      break;\r\n    case emp.typeLibrary.featureFormatType.GEOJSON:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n    case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n      len = args.updates.coordinates.length;\r\n\r\n      switch (args.feature.data.type.toLowerCase()) {\r\n        case \"point\":\r\n          if ((args.updates.coordinates[0].alt === undefined) ||\r\n            (args.updates.coordinates[0].alt === null)) {\r\n            geoJsonCoords = [args.updates.coordinates[0].lon, args.updates.coordinates[0].lat];\r\n          }\r\n          else {\r\n            geoJsonCoords = [args.updates.coordinates[0].lon, args.updates.coordinates[0].lat, args.updates.coordinates[0].alt];\r\n          }\r\n          data = {\r\n            \"type\": \"Point\",\r\n            \"coordinates\": geoJsonCoords\r\n          };\r\n          break;\r\n        case \"linestring\":\r\n          for (i = 0; i < len; i++) {\r\n            if ((args.updates.coordinates[i].alt === undefined) ||\r\n              (args.updates.coordinates[i].alt === null)) {\r\n              geoJsonCoords.push([args.updates.coordinates[i].lon, args.updates.coordinates[i].lat]);\r\n            }\r\n            else {\r\n              geoJsonCoords.push([args.updates.coordinates[i].lon, args.updates.coordinates[i].lat, args.updates.coordinates[i].alt]);\r\n            }\r\n          }\r\n          data = {\r\n            \"type\": \"LineString\",\r\n            \"coordinates\": geoJsonCoords\r\n          };\r\n          break;\r\n        case \"polygon\":\r\n          for (i = 0; i < len; i++) {\r\n            if ((args.updates.coordinates[i].alt === undefined) ||\r\n              (args.updates.coordinates[i].alt === null)) {\r\n              geoJsonCoords.push([args.updates.coordinates[i].lon, args.updates.coordinates[i].lat]);\r\n            }\r\n            else {\r\n              geoJsonCoords.push([args.updates.coordinates[i].lon, args.updates.coordinates[i].lat, args.updates.coordinates[i].alt]);\r\n            }\r\n          }\r\n          data = {\r\n            \"type\": \"Polygon\",\r\n            \"coordinates\": [geoJsonCoords]\r\n          };\r\n          break;\r\n        case \"feature\":\r\n          data = buildGeoJsonFeature(args.feature.data, args.updates.coordinates);\r\n          break;\r\n      }\r\n      break;\r\n    default:\r\n      /*\r\n       unknown format, just return the existing data object untouched\r\n       Need to identify a longer term solution for this case.  Formats could be something like czml,\r\n       or other custom data format the core does not understand, but a map engine does\r\n\r\n       */\r\n      data = args.feature.data;\r\n      break;\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n/**\r\n * @memberOf emp.typeLibrary.Feature\r\n * @typedef {object} emp.typeLibrary.Feature.modifiersType\r\n * @description This type defines the possible 2525 modifiers that can be applied to a symbol.\r\n * @property {string=} hostile This property if present contains 'ENY'.\r\n * @property {string=} offsetIndicator A graphic modifier for units, equipment, and\r\n * installations used when placing an object away from its actual location.\r\n * @property {string=} dateTimeGroup1 A text modifier for units, equipment, and installations that displays DTG format:\r\n * DDHHMMSSZMONYYYY or O/O for on order.\r\n * @property {string=} dateTimeGroup2 A text modifier for units, equipment, and installations that displays DTG format:\r\n * DDHHMMSSZMONYYYY or O/O for on order.\r\n * @property {string=} location A text modifier for units, equipment, and installations that displays a symbols\r\n * location in degrees, minutes, and seconds (or in UTM or other applicable display\r\n * format).\r\n * @property {string=} uniqueDesignation1 A text modifier for units, equipment, and installations that uniquely identifies a\r\n * particular symbol or track number. Identifies acquisitions number when used\r\n * with SIGINT symbology.\r\n * @property {string=} uniqueDesignation2 A text modifier for units, equipment, and installations that uniquely identifies a\r\n * particular symbol or track number. Identifies acquisitions number when used\r\n * with SIGINT symbology.\r\n * @property {string=} equipmentType A text modifier for equipment that indicates types of equipment.\r\n * @property {string=} iffSif A text modifier displaying IFF/SIF Identification modes and codes.\r\n * @property {string=} higherFormation A text modifier for units that indicates number or title of higher echelon\r\n * command (corps are designated by Roman numerals).\r\n * @property {string=} signatureEquipment A text modifier for hostile equipment; ! indicates detectable electronic\r\n * signatures.\r\n * @property {string=} combatEffectiveness A text modifier for units and installations that indicates unit effectiveness or\r\n * installation capability.\r\n * @property {string=} evaluationRating A text modifier for units, equipment, and installations that consists of a one letter\r\n * reliability rating and a one-number credibility rating:\r\n * Reliability Ratings: A-completely reliable, B-usually reliable, C-fairly reliable,\r\n * D-not usually reliable, E-unreliable, F-reliability cannot be judged.\r\n * Credibility Ratings: 1-confirmed by other sources,\r\n * 2-probably true, 3-possibly true, 4-doubtfully true,\r\n * 5-improbable, 6-truth cannot be judged.\r\n * @property {string=} additionalInfo1 A text modifier for units, equipment, and installations; content is implementation\r\n * specific.\r\n * @property {string=} additionalInfo2 A text modifier for units, equipment, and installations; content is implementation\r\n * specific.\r\n * @property {string=} additionalInfo3 A text modifier for units, equipment, and installations; content is implementation\r\n * specific.\r\n * @property {string=} staffComments A text modifier for units, equipment and installations; content is implementation\r\n * specific.\r\n * @property {string=} reinforcedOrReduced A text modifier in a unit symbol that displays (+) for reinforced, (-) for reduced,\r\n * (+) reinforced and reduced.\r\n * @property {string=} specialC2Headquarters A text modifier for units; indicator is contained inside the frame (see figures 2\r\n * and 3); contains the name of the special C2 Headquarters.\r\n * @property {emp.typeLibrary.featureMilStdVersionType=} standard This property indicate the MilStd 2525 version. The default value is 2525B.\r\n * @property {number=} size This property provides the size of the icon to be rendered. The default value is 32.\r\n * @property {number=} quantity A text modifier in an equipment symbol that identifies the number of items\r\n * present.\r\n * @property {number=} speed A text modifier for units and equipment that displays velocity as set forth in\r\n * MIL-STD-6040.\r\n * @property {number=} directionOfMovement A graphic modifier for units and equipment that identifies the direction of\r\n * movement or intended movement of an object.\r\n * @property {number[]} [altitudeDepth] A text modifier for units, equipment, and installations, that displays either\r\n * altitude flight level, depth for submerged objects; or height of equipment or\r\n * structures on the ground.\r\n * @property {number[]} [distance] A numeric modifier that displays a minimum,\r\n * maximum, or a specific distance (range, radius,\r\n * width, length, etc.), in meters.\r\n * @property {number[]} [azimuth] A numeric modifier that displays an angle\r\n * measured from true north to any other line in degrees.\r\n */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary.Feature\r\n * @typedef {object} emp.typeLibrary.Feature.attributeType\r\n * @property {number=} width This property provide the width of the airspace. This property applies to routes.\r\n * @property {number=} leftWidth This property provides the distance by which the\r\n * left side of the track segment is extended. This property applies to track segments.\r\n * @property {number=} rightWidth This property provides the distance by which the\r\n * right side of the track segment is extended. This property applies to track segments.\r\n * @property {number=} radius This property provide the outer radius of the airspace.\r\n * This property applies to Cylinder, RadArc, and PolyArc airspaces.\r\n * @property {number=} innerRadius This property provides the inner radius value for a RadArc airspace.\r\n * @property {number=} minAlt This property provides the altitude of the lower edge of the airspace.\r\n * @property {number=} maxAlt This property provides the altitude of the highest edge of the airspace.\r\n * @property {string=} fillColor This property provide the fill color the airspace must be rendered in in ARGB format.\r\n * @property {string=} lineColor This property provide the line color the airspace must be rendered in in ARGB format.\r\n * @property {emp.typeLibrary.featureAltitudeModeType=} altitudeMode This property provide the altitude mode the altitude must be rendered with.\r\n * @property {emp.typeLibrary.orbitTurnType=} turn This property provide the turn parameter of the orbit airspace.\r\n * @property {number=} leftAzimuth This property provides the left azimuth value for RadArc and PolyArc airspaces.\r\n * @property {number=} rightAzimuth This property provides the right azimuth value for RadArc and PolyArc airspaces.\r\n * @property {emp.typeLibrary.featureAltitudeModeType=} altitudeMode This property\r\n * indicates the altitude mode for the airspace or airspace segment.  If the minimumAltitudeMode\r\n * is also present this property applies to the maxAlt only.\r\n * @property {emp.typeLibrary.featureAltitudeModeType=} minimumAltitudeMode This property, if present,\r\n * indicates the altitude mode applied to the minAlt of the airspace or airspace segment.\r\n */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary.Feature\r\n * @typedef {object} emp.typeLibrary.Feature.propertiesType\r\n * @property {boolean} readOnly This property indicates if the feature can be placed into edit mode. The default value is false.\r\n * @property {string=} description This property contains a readable description of the feature.\r\n * @property {emp.typeLibrary.featureAltitudeModeType=} altitudeMode This property provide the altitude mode the altitude must be rendered with.\r\n * @property {emp.typeLibrary.Feature.modifiersType=} modifiers This property is applicable to\r\n * MilStd features only. It contains the symbol modifiers to be applied to the feature when rendering.\r\n * The map implementation must provide a default value for any required modifier that is not present.\r\n * @property {emp.typeLibrary.Feature.attributeType[]} [attributes] This property is applicable\r\n * to airspace features. It contains an array of attributes that must be applied when rendering the airspace.\r\n * For Track airspaces there can be more than one set of attributes in the array, one for each segment.\r\n * However if there are more segments than there are attribute sets, then the map implementation must\r\n * reuse the last existing set for the remainder of the segments. Extra attribute sets are ignored.\r\n * The map implementation must provide default values for any required attribute that is not present.\r\n */\r\n","/*global emp */\r\n\r\nemp.typeLibrary.Static = function (args) {\r\n    this.name = args.name;\r\n    this.overlayId = args.overlayId;\r\n    this.parentId = args.parentId;\r\n    this.featureId = args.featureId;\r\n    this.globalType = emp.typeLibrary.types.STATIC;\r\n    this.visible = args.visible;\r\n    this.properties = {\r\n      readOnly: true\r\n    };\r\n    this.disabled = false;\r\n\r\n    this.coreId = (function (args) {\r\n        if (!emp.helpers.isEmptyString(args.coreId))\r\n        {\r\n            return args.coreId;\r\n        }\r\n\r\n        return args.featureId;\r\n    })(args);\r\n\r\n    this.coreParent = (function(args){\r\n        if (!emp.helpers.isEmptyString(args.coreParent))\r\n        {\r\n            return args.coreParent;\r\n        }\r\n        return undefined;\r\n    })(args);\r\n\r\n    this.prepForExecution = function(){\r\n        // We dont need to do anything.\r\n    };\r\n};\r\nemp.typeLibrary.Static.prototype.validate = emp.typeLibrary.base.validate;\r\n/*\r\nemp.typeLibrary.Static.prototype.visibility = emp.typeLibrary.base.visibility;\r\nemp.typeLibrary.Static.prototype.locate = emp.typeLibrary.base.locate;\r\nemp.typeLibrary.Static.prototype.hasChildren = emp.typeLibrary.base.hasChildren;\r\nemp.typeLibrary.Static.prototype.hasParents = emp.typeLibrary.base.hasParents;\r\nemp.typeLibrary.Static.prototype.removeChild = emp.typeLibrary.base.removeChild;\r\nemp.typeLibrary.Static.prototype.addParent = emp.typeLibrary.base.addParent;\r\nemp.typeLibrary.Static.prototype.addChild = emp.typeLibrary.base.addChild;\r\nemp.typeLibrary.Static.prototype.getChildrenCoreIds = emp.typeLibrary.base.getChildrenCoreIds;\r\nemp.typeLibrary.Static.prototype.getParentCoreIds = emp.typeLibrary.base.getParentCoreIds;\r\nemp.typeLibrary.Static.prototype.childrenCount = emp.typeLibrary.base.childrenCount;\r\nemp.typeLibrary.Static.prototype.parentCount = emp.typeLibrary.base.parentCount;\r\nemp.typeLibrary.Static.prototype.getChild = emp.typeLibrary.base.getChild;\r\nemp.typeLibrary.Static.prototype.getParent = emp.typeLibrary.base.getParent;\r\nemp.typeLibrary.Static.prototype.isMultiParentRequired = emp.typeLibrary.base.isMultiParentRequired;\r\nemp.typeLibrary.Static.prototype.hasChildNodes = emp.typeLibrary.base.hasChildNodes;\r\nemp.typeLibrary.Static.prototype.getChildNodesCoreIds = emp.typeLibrary.base.getChildNodesCoreIds;\r\nemp.typeLibrary.Static.prototype.removeFromAllParent = emp.typeLibrary.base.removeFromAllParent;\r\nemp.typeLibrary.Static.prototype.getVisibilityWithParent = emp.typeLibrary.base.getVisibilityWithParent;\r\nemp.typeLibrary.Static.prototype.setVisibilityWithParent = emp.typeLibrary.base.setVisibilityWithParent;\r\nemp.typeLibrary.Static.prototype.getRootParent = emp.typeLibrary.base.getRootParent;\r\nemp.typeLibrary.Static.prototype.getVisibilityCount = emp.typeLibrary.base.getVisibilityCount;\r\nemp.typeLibrary.Static.prototype.getRootCoreId = emp.typeLibrary.base.getRootCoreId;\r\nemp.typeLibrary.Static.prototype.addAffectedChildren = emp.typeLibrary.base.addAffectedChildren;\r\nemp.typeLibrary.Static.prototype.isVisible = emp.typeLibrary.base.isVisible;\r\nemp.typeLibrary.Static.prototype.isUnderParent = emp.typeLibrary.base.isUnderParent;\r\nemp.typeLibrary.Static.prototype.addToOverlayFeatureList = emp.typeLibrary.base.addToOverlayFeatureList;\r\nemp.typeLibrary.Static.prototype.removeFromOverlayFeatureList = emp.typeLibrary.base.removeFromOverlayFeatureList;\r\nemp.typeLibrary.Static.prototype.removeAllChildrenFromOverlayFeatureList = emp.typeLibrary.base.removeAllChildrenFromOverlayFeatureList;\r\nemp.typeLibrary.Static.prototype.addAllChildrenToOverlayFeatureList = emp.typeLibrary.base.addAllChildrenToOverlayFeatureList;\r\nemp.typeLibrary.Static.prototype.isVisibilityAffected = emp.typeLibrary.base.isVisibilityAffected;\r\nemp.typeLibrary.Static.prototype.getVisibilitySettingWithParent = emp.typeLibrary.base.getVisibilitySettingWithParent;\r\n*/\r\n","/* globals emp */\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n * @description This class represent a map status change. A map implementation\r\n * should never create an instance of this class.\r\n * @param {emp.typeLibrary.Status.ParameterType} args - The arguments needed to create a status object\r\n */\r\nemp.typeLibrary.Status = function (args) {\r\n    this.coreId = emp.helpers.id.newGUID();\r\n    this.globalType = emp.typeLibrary.types.STATUS;\r\n    this.intent = args.intent;\r\n    this.transactionId = args.transactionId;\r\n    this.sender = args.sender;\r\n    this.requester = args.sender;\r\n    this.intentParams = args.intentParams;\r\n    this.overlay = args.overlay;\r\n    this.feature = args.feature;\r\n    this.layer = args.layer;\r\n    this.status = args.status;\r\n    this.formats = args.formats;\r\n    this.about = args.about;\r\n    this.types = args.types;\r\n    this.filter = args.filter;\r\n    this.select = args.select;\r\n    this.version = args.version;\r\n    this.coordinateSystem = args.coordinateSystem;\r\n    this.displayedCoordinateSystem = args.displayedCoordinateSystem;\r\n    this.widgetName = args.widgetName;\r\n    this.universalName = args.universalName;\r\n    this.instanceName = args.instanceName;\r\n    this.extensions = args.extensions;\r\n    this.type = args.type;\r\n    this.recursive = args.recursive || false;\r\n    this.schema = {\r\n        \"title\": \"EMP-Status Schema\",\r\n        \"type\": \"object\",\r\n\r\n        \"properties\": {\r\n            \"overlay\": {\r\n                \"type\": [\"array\", \"null\"],\r\n                \"items\": {\r\n                    \"type\": \"string\"\r\n                }\r\n            },\r\n            \"feature\": {\r\n                \"type\": [\"array\", \"null\"],\r\n                \"items\": {\r\n                    \"type\": \"string\"\r\n                }\r\n            },\r\n            \"transactionId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"coordinateSystem\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"format\": {\r\n                \"type\": [\"array\", \"null\"]\r\n            },\r\n            \"about\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"filter\": {\r\n                \"type\": [\"array\", \"null\"]\r\n            },\r\n            \"types\": {\r\n                \"type\": [\"array\", \"null\"],\r\n                \"items\": {\r\n                    \"type\": \"string\"\r\n                }\r\n            },\r\n            \"select\": {\r\n                \"type\": [\"array\", \"null\"]\r\n\r\n            },\r\n            \"recursive\": {\r\n                \"type\": [\"boolean\", \"null\"]\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    this.validate();\r\n};\r\n\r\nemp.typeLibrary.Status.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n\r\n/**\r\n * @typedef emp.typeLibrary.Status.ParameterType\r\n * @property {emp.map.states} status The new state of the map.\r\n */","var emp = window.emp || {};\r\nemp.typeLibrary = emp.typeLibrary || {};\r\n\r\n/**\r\n * @memberof emp.typeLibrary\r\n * @class\r\n * @param {object} args\r\n * @param {emp3.api.enums.MapMotionLockEnum} args.lock\r\n *\r\n * @description This class represent a lock on a particular item.  Locking\r\n * an item means it cannot be moved or interacted with.\r\n */\r\nemp.typeLibrary.Lock = function (args) {\r\n    /**\r\n     * @type emp3.api.enums.MapMotionLockEnum\r\n     * @description This property contains a boolean indicating if we want to lock or unlock\r\n     */\r\n    this.lock = args.lock;\r\n};\r\n","/**\r\n * @class\r\n * @description The class represents a view change request or a view change event.\r\n * A map implementation should never create an instance of this class.\r\n * @param  {emp.typeLibrary.LookAt.ParameterType} args Used to populate the view object\r\n * @param args.channel\r\n * @param args.transactionId\r\n */\r\n\r\nemp.typeLibrary.LookAt = function(args) {\r\n  this.globalType = emp.typeLibrary.types.VIEW;\r\n  this.transactionId = args.transactionId;\r\n  this.sender = args.sender;\r\n  this.requester = args.sender;\r\n  this.channel = args.channel;\r\n  /* View by Id */\r\n  this.overlayId = args.overlayId;\r\n\r\n  this.range = args.range ? args.range : 100000;\r\n\r\n  this.latitude = args.latitude ? args.latitude : 0;\r\n  this.longitude = args.longitude ? args.longitude : 0;\r\n  this.altitude = args.altitude ? args.altitude : 0;\r\n\r\n  this.tilt = args.tilt ? args.tilt : 0;\r\n  this.heading = args.heading ? args.heading : 0;\r\n  this.animate = args.animate ? args.animate : false;\r\n\r\n  this.altitudeMode = args.altitudeMode ? args.altitudeMode : emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n\r\n  this.coreId = args.coreId;\r\n};\r\n\r\nemp.typeLibrary.LookAt.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n/**\r\n * @typedef {object} emp.typeLibrary.LookAt.ParameterType\r\n * \r\n * @property {string} overlayId - The overlayId is the id for the overlay to be centered on.\r\n * @property {number} [range=100000] - The distance at which the view point should be placed.\r\n * @property {number} [tilt=0] - The tilt is the camera's angle on the x-axis.\r\n * @property {number} [heading=0] - The heading is the camera's angle on the z-axis.\r\n * @property {number} [latitude=0] - Latitude of the LookAt\r\n * @property {number} [longitude=0] - Longitude of the LookAt\r\n * @property {number} [altitude=0] - Altitude of the LookAt\r\n * @property {emp.constant.featureAltitudeModeType} [altitudeMode=emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND]\r\n * @property {boolean} [animate = false] - Animate the map when moving to the location\r\n */","/* globals emp */\r\n/**\r\n * @class\r\n * @description The class represents a view change request or a view change event.\r\n * A map implementation should never create an instance of this class.\r\n * @param  {emp.typeLibrary.View.ParameterType} args Used to popular the view object\r\n */\r\nemp.typeLibrary.View = function (args) {\r\n    this.globalType = emp.typeLibrary.types.VIEW;\r\n    this.transactionId = args.transactionId;\r\n    this.sender = args.sender;\r\n    this.requester = args.sender; // SHIM cmapi\r\n    this.channel = args.channel;\r\n    /* View by Id */\r\n    this.overlayId = args.overlayId;\r\n    this.featureId = args.featureId;\r\n    this.parentId = args.parentId;\r\n    /* Id logic */\r\n    if (this.featureId && !this.overlayId) {\r\n        this.overlayId = args.sender;\r\n    }\r\n\r\n    /* Camera */\r\n    this.altitudeMode = args.altitudeMode || emp.constant.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n    this.range = (typeof (args.range) === \"number\") ? args.range : (typeof (args.zoom)) === \"number\" ? args.zoom : undefined; // this is mental\r\n    this.altitude = (typeof (args.altitude) === \"number\") ? args.altitude : (typeof (args.zoom)) === \"number\" ? args.zoom : undefined; // this is mental\r\n    this.scale = args.scale;\r\n    this.zoom = args.zoom || false;\r\n    this.tilt = args.tilt;\r\n    this.roll = args.roll; // TODO is this the same as pan?\r\n    this.heading = args.heading;\r\n    this.animate = args.animate;\r\n\r\n\r\n    /* Positional */\r\n    this.location = args.location || args.center;\r\n\r\n    //this.center = args.location || args.center; // SHIM cmapi\r\n    this.bounds = args.bounds;\r\n    if (this.bounds !== undefined &&\r\n        this.bounds !== null &&\r\n        args.bounds.southWest !== undefined &&\r\n        args.bounds.southWest !== null &&\r\n        args.bounds.northEast !== undefined &&\r\n        args.bounds.northEast !== null) {\r\n        //\t\tthis.bounds = args.bounds;\r\n        this.bounds.west = args.bounds.southWest.lon;\r\n        this.bounds.east = args.bounds.northEast.lon;\r\n        this.bounds.south = args.bounds.southWest.lat;\r\n        this.bounds.north = args.bounds.northEast.lat;\r\n    }\r\n    this.types = args.types;\r\n    this.screenshot = args.screenshot;\r\n/*\r\n    this.schema = {\r\n        \"title\": \"EMP-View Schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"location\": {\r\n                \"type\": [\"object\", \"null\"],\r\n                \"properties\": {\r\n                    \"lat\": {\r\n                        \"type\": \"number\",\r\n                        \"maximum\": 90,\r\n                        \"minimum\": -90\r\n                    },\r\n                    \"lon\": {\r\n                        \"type\": \"number\",\r\n                        \"maximum\": 180,\r\n                        \"minimum\": -180\r\n                    }\r\n                }\r\n\r\n            },\r\n            \"range\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            \"zoom\": {\r\n                \"type\": [\"number\", \"string\", \"boolean\", \"null\"]\r\n            },\r\n            // @todo Min? Max?\r\n            \"tilt\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            // @todo Min? Max?\r\n            \"pan\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            // @todo Min? Max?\r\n            \"heading\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"maximum\": 360,\r\n                \"minimum\": -360\r\n            }, // @todo Mills?\r\n            \"bounds\": {\r\n                \"type\": [\"object\", \"null\"],\r\n                \"properties\": {\r\n                    \"north\": {\r\n                        \"type\": [\"number\", \"null\"],\r\n                        \"maximum\": 90,\r\n                        \"minimum\": -90\r\n                    },\r\n                    \"south\": {\r\n                        \"type\": [\"number\", \"null\"],\r\n                        \"maximum\": 90,\r\n                        \"minimum\": -90\r\n                    },\r\n                    \"east\": {\r\n                        \"type\": [\"number\", \"null\"],\r\n                        \"maximum\": 180,\r\n                        \"minimum\": -180\r\n                    },\r\n                    \"west\": {\r\n                        \"type\": [\"number\", \"null\"],\r\n                        \"maximum\": 180,\r\n                        \"minimum\": -180\r\n                    }\r\n                }\r\n            },\r\n            \"transactionId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            }\r\n        }\r\n\r\n    };\r\n    if (this.channel === \"map.view.center.bounds\") {\r\n        this.schema.properties.bounds.type = \"object\";\r\n        this.schema.required = [\"bounds\"];\r\n    } else if (this.channel === \"map.view.center.location\") {\r\n        this.schema.required = [\"location\"];\r\n    } else if (this.channel === \"map.view.center.feature\") {\r\n        this.schema.properties.featureId = {};\r\n        this.schema.properties.featureId.type = \"string\";\r\n        this.schema.required = [\"featureId\"];\r\n    } else if (this.channel === \"map.view.center.overlay\") {\r\n        this.schema.properties.overlayId = {};\r\n        this.schema.properties.overlayId.type = \"string\";\r\n        this.schema.required = [\"overlayId\"];\r\n    }\r\n\r\n    this.validate();\r\n*/\r\n    this.coreId = args.coreId;\r\n\r\n    this.prepForExecution = function(){\r\n        if ((this.coreId === undefined) || (this.coreId === null))\r\n        {\r\n            if ((this.featureId !== undefined) && (this.featureId !== null))\r\n            {\r\n                var oFeature = emp.storage.findFeature(this.overlayId, this.featureId);\r\n                if (oFeature !== undefined)\r\n                {\r\n                    this.coreId = oFeature.getCoreId();\r\n                }\r\n                else\r\n                {\r\n                    this.coreId = emp.helpers.id.newGUID();\r\n                }\r\n            }\r\n            else if ((this.overlayId !== undefined) && (this.overlayId !== null))\r\n            {\r\n                var oOverlay = emp.storage.findOverlay(args.overlayId);\r\n                if (oOverlay !== undefined)\r\n                {\r\n                    this.coreId = oOverlay.getCoreId();\r\n                }\r\n                else\r\n                {\r\n                    this.coreId = emp.helpers.id.newGUID();\r\n                }\r\n            }\r\n            else\r\n            {\r\n                this.coreId = emp.helpers.id.newGUID();\r\n            }\r\n        }\r\n    };\r\n};\r\nemp.typeLibrary.View.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n\r\n/**\r\n * @typedef {object} emp.typeLibrary.View.ParameterType\r\n * @property {string=} intent - The intent defines how the item is to be handled. The intents\r\n * for the View are: VIEW_SET and VIEW_GET\r\n * @property {(string|array)=} intentParams - For the VIEW_SET intent there are no intentParams.\r\n * For the VIEW_GET intent, the intent params is set to \"view\"\r\n * @property {string=} overlayId - The overlayId is the id for the overlay to be centered on.\r\n * @property {string=} featureId - The featureId is the id for the feature to be centered on.\r\n * @property {number=} range - The distance at which the view point should be placed.\r\n * @property {emp.typeLibrary.LatLonCoordinates=} location - The location is a point on the map for the camera to go to.\r\n * @property {number=} tilt - The tilt is the camera's angle on the x-axis.\r\n * @property {number=} pan - The pan is the camera's angle on the z-axis.\r\n * @property {number=} heading - The heading is the camera's angle on the z-axis.\r\n * @property {emp.typeLibrary.BoundingBoxType=} bounds - The bounds are the bounding box area points for the camera to center on.\r\n * @property {emp.typeLibrary.LookAt.LookAtParams} lookAt\r\n **/\r\n","/**\r\n * @private\r\n * @memberOf emp.typeLibrary\r\n * @method\r\n * @constructor\r\n * @desc Constructs a Menu object.\r\n * @param {object} args - Object needed to create Menu Object\r\n *\r\n * @return {Menu}\r\n * @mixes emp.typeLibrary.base\r\n */\r\nemp.typeLibrary.Menu = function (args) {\r\n    // Need to check if this is a context menu or a create menu.\r\n    this.intent = args.intent;\r\n    this.coreId = emp.helpers.id.newGUID();\r\n\r\n    if (args.menu) {\r\n        //This is a create menu\r\n        this.label = args.menu.label || \"\";\r\n        this.menuId = args.menu.menuId || \"\";\r\n        this.tooltip = args.menu.tooltip || \"\";\r\n        this.items = args.menu.items || [];\r\n        this.menuType = args.menu.menuType || null;\r\n    } else {\r\n        //This is a context menu\r\n        this.items = args.menuItems || args.items;\r\n        this.menuId = args.menuId;\r\n        this.properties = args.properties;\r\n        this.type = args.type;\r\n        this.menuType = args.menuType || null;\r\n        this.transactionId = args.transactionId;\r\n        this.active = args.active;\r\n        this.label = args.label;\r\n        this.itemId = args.itemId;\r\n\r\n    }\r\n\r\n    /*\r\n     if (args.hasOwnProperty(\"items\")) {\r\n     for (var i = 0; i < args.items.length; i = i + 1) {\r\n     var item = new emp.typeLibrary.DrawMenu(args.items[i]);\r\n     this.items.push(item);\r\n     }\r\n     }\r\n     */\r\n    this.schema = {\r\n        \"title\": \"EMP-Menu Schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"label\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"menuId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"tooltip\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"items\": {\r\n                \"type\": [\"array\", \"null\"]\r\n            },\r\n            \"type\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"menuType\": {\r\n                \"type\": [\"string\", \"null\"],\r\n                \"enum\": [null,\r\n                        emp.typeLibrary.Menu.Type.MAP_GLOBAL,\r\n                        emp.typeLibrary.Menu.Type.OVERLAY_GLOBAL,\r\n                        emp.typeLibrary.Menu.Type.FEATURE_GLOBAL,\r\n                        emp.typeLibrary.Menu.Type.OBJECT_INSTANCE,\r\n                        emp.typeLibrary.Menu.Type.SUBMENU]\r\n            },\r\n            /** @todo enum */\r\n            \"properties\": {\r\n                \"type\": [\"object\", \"null\"],\r\n                \"properties\": {\r\n                    \"iconUrl\": {\r\n                        \"type\": \"string\"\r\n                    },\r\n                    \"type\": {\r\n                        \"type\": \"string\"\r\n                    },\r\n                    \"lineColor\": {\r\n                        \"type\": \"string\"\r\n                    },\r\n                    \"lineWidth\": {\r\n                        \"type\": \"string\"\r\n                    },\r\n                    \"fillColor\": {\r\n                        \"type\": \"string\"\r\n                    }\r\n                }\r\n            },\r\n            \"active\": {\r\n                \"type\": [\"boolean\", \"null\"]\r\n            },\r\n            \"itemLabel\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"transactionId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            }\r\n        }\r\n    };\r\n    switch (this.intent) {\r\n    case \"menu.draw.create\":\r\n        this.schema.required = [];\r\n        break;\r\n    case \"menu.draw.remove\":\r\n        break;\r\n    case \"menu.draw.feature\":\r\n        break;\r\n    case \"menu.context.create\":\r\n        this.schema.required = [\"menuId\", \"items\"];\r\n        this.schema.properties.menuId.type = \"string\";\r\n        break;\r\n    case \"menu.context.remove\":\r\n        this.schema.required = [\"menuId\"];\r\n        this.schema.properties.menuId.type = \"string\";\r\n        break;\r\n    case \"menu.context.active\":\r\n        this.schema.required = [\"menuId\", \"itemLabel\", \"active\"];\r\n        break;\r\n    case \"menu.context.clicked\":\r\n        this.schema.required = [\"menuId\", \"itemId\", \"active\"];\r\n        break;\r\n    default:\r\n        break;\r\n    }\r\n    this.validate();\r\n};\r\n\r\nemp.typeLibrary.Menu.Type =\r\n        {\r\n            MAP_GLOBAL: 'mapglobal',          // Menu with items applicable to the map.\r\n            OVERLAY_GLOBAL: 'overlayglobal',  // Menu with items applicable to all overlays.\r\n            FEATURE_GLOBAL: 'featureglobal',  // Menu with items applicable to all features.\r\n            OBJECT_INSTANCE: 'objectinstance',// Menu with items specifica to an\r\n                                              // object instance. The object instance can\r\n                                              // be a feature, overlay, or WMS service.\r\n            SUBMENU: 'submenu'                // Menu that will be used as sub menu of\r\n                                              // another menu.\r\n        };\r\n\r\nemp.typeLibrary.Menu.prototype.validate = emp.typeLibrary.base.validate;\r\n","/*global emp */\r\n\r\n/**\r\n * Map Move is generated for Map driven Pointer event\r\n *\r\n * @class\r\n * @description This class is used to represent a pointer event.\r\n * A map implementation should never create an instance of the class.\r\n * @param {emp.typeLibrary.Pointer.ParameterType} args This argument contains all the data needed to create the class instance.\r\n */\r\nemp.typeLibrary.Pointer = function (args) {\r\n    /**\r\n     * @private\r\n     */\r\n    this.globalType = emp.typeLibrary.types.POINTER;\r\n    /**\r\n     * @private\r\n     */\r\n    this.coreId = (function (args) {\r\n        var oStorageItem;\r\n        var oTemp;\r\n\r\n        if (args.coreId)\r\n        {\r\n            // They gave us the coreId return it.\r\n            oStorageItem = emp.storage.get.id({id: args.coreId});\r\n\r\n            if (oStorageItem)\r\n            {\r\n                oTemp = oStorageItem.getObjectData(null,null);\r\n                args.overlayId = oTemp.overlayId;\r\n                args.featureId = oTemp.featureId || oTemp.id;\r\n                args.parentId = oTemp.parentId;\r\n                return oStorageItem.getCoreId();\r\n            }\r\n        }\r\n        else if (args.overlayId && args.featureId)\r\n        {\r\n            // Else find the feature.\r\n            oStorageItem = emp.storage.findFeature(args.overlayId, args.featureId);\r\n        }\r\n\r\n        // If the item is in storage return its coreId.\r\n        if (oStorageItem === undefined)\r\n        {\r\n            return emp.helpers.id.newGUID();\r\n        }\r\n        return oStorageItem.getCoreId();\r\n    }(args));\r\n\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This field indicates the latitude coordinate of the location\r\n     * the pointer event occurred. It may be undefined if the event occurred off\r\n     * the globe.\r\n     */\r\n    this.lat = args.lat;\r\n\r\n    /**\r\n     * @field\r\n     * @type number\r\n     * @description This field indicates the longitude coordinate of the location\r\n     * the pointer event occurred. It may be undefined if the event occurred off\r\n     * the globe.\r\n     */\r\n    this.lon = args.lon;\r\n\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.Pointer.EventType}\r\n     * @description This field identifies the type of event that occurred.\r\n     */\r\n    this.type = args.type;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description This field provides the coordinates in MGRS format.\r\n     */\r\n    this.mgrs = args.mgrs;\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.Pointer.popupInfoType}\r\n     * @description This field provides the object to be used by the feature popup window in the case the click target was a feature.\r\n     */\r\n    this.popupInfo = args.popupInfo || {title: \"\", content: \"\"};\r\n\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.Pointer.ButtonType}\r\n     * @description This field identifies the button that generated or was active when the event was generated.\r\n     */\r\n    this.button = args.button;\r\n\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.Pointer.KeyType[]}\r\n     * @description This field identifies the keys that were pressed when the event occurred.\r\n     */\r\n    this.keys = (args.keys? (((args.keys instanceof Array) && (args.keys.length > 0))? args.keys: [\"none\"]): [\"none\"]);\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field indicates the client window x coordinate of the pointer device when the event occurred.\r\n     */\r\n    this.clientX = args.clientX || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field indicates the client window y coordinate of the pointer device when the event occurred.\r\n     */\r\n    this.clientY = args.clientY || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field indicates the screen x coordinate of the pointer device when the event occurred.\r\n     */\r\n    this.screenX = args.screenX || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field indicates the screen y coordinate of the pointer device when the event occurred.\r\n     */\r\n    this.screenY = args.screenY || null;\r\n    /* EMP-238 EMP-205 Start */\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field indicates the terrain elevation at the coordinates of the location\r\n     * the pointer event occurred. It may be undefined if the event occurred off\r\n     * the globe.\r\n     */\r\n    this.elevation = args.elevation || null;\r\n    /* EMP-238 EMP-205 End*/\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description If the event occurred over a feature, this field indicates the feature's identifier.\r\n     */\r\n    this.featureId = args.featureId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description If the event occurred over a feature, this field indicates the feature's overlay ID.\r\n     */\r\n    this.overlayId = args.overlayId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description If the event occurred over a feature, this field indicates the feature's parent ID.\r\n     */\r\n    this.parentId = args.parentId;\r\n\r\n    /* EMP-198 start */\r\n    this.target = args.target || \"globe\";\r\n    /* EMP-198 end */\r\n    /**\r\n     * @private\r\n     */\r\n    this.menuId = args.menuId;\r\n    /**\r\n     * @private\r\n     */\r\n    this.menuItemId = args.menuItemId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field contains the map scale when the event occurred.\r\n     */\r\n    this.scale = args.scale || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field contains the map range when the event occurred.\r\n     */\r\n    this.range = args.range || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.BoundingBoxType}\r\n     * @description This field contains the map view area coordinates when the event occurred.\r\n     */\r\n    this.bounds = args.bounds || null;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.schema = {\r\n        \"title\": \"map-pointer-event-schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"type\": {\r\n                \"type\": [\"string\", \"null\"]\r\n                /*, Come back to this\r\n\t\t\t\t\"enum\": [\"single\", \"double\",\"mouseUp\",\"mouseDown\"]*/\r\n            },\r\n            \"lat\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": -90,\r\n                \"maximum\": 90\r\n            },\r\n            \"lon\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": -180,\r\n                \"maximum\": 180\r\n            },\r\n            \"elevation\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            \"mgrs\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"button\": {\r\n                \"type\": [\"string\", \"null\"],\r\n                \"anyOf\": [{\r\n                    \"format\": \"left\"\r\n                }, {\r\n                    \"format\": \"middle\"\r\n                }, {\r\n                    \"format\": \"right\"\r\n                }]\r\n            },\r\n            \"keys\": {\r\n                \"type\": [\"array\", \"null\"],\r\n                \"items\": {\r\n                    \"enum\": [\"alt\", \"ctrl\", \"shift\", \"none\", \"null\"]\r\n                }\r\n            },\r\n            \"clientX\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            \"clientY\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            \"screenX\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            \"screenY\": {\r\n                \"type\": [\"number\", \"null\"]\r\n            },\r\n            \"target\": {\r\n                \"type\": \"string\",\r\n                \"enum\": [\"globe\", \"feature\", \"overlay\", \"point\", \"water\", \"land\", \"sky\", \"space\"]\r\n            },\r\n            \"height\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": 0\r\n            },\r\n            \"width\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": 0\r\n            },\r\n            \"zoom\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": 0\r\n            },\r\n            \"scale\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": 0\r\n            },\r\n            \"bounds\": {\r\n                \"type\": [\"object\", \"null\"],\r\n                \"east\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -180,\r\n                    \"maximum\": 180\r\n                },\r\n                \"north\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -90,\r\n                    \"maximum\": 90\r\n                },\r\n                \"west\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -180,\r\n                    \"maximum\": 180\r\n                },\r\n                \"south\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -90,\r\n                    \"maximum\": 90\r\n                }\r\n            }\r\n        }\r\n    };\r\n    this.validate();\r\n};\r\nemp.typeLibrary.Pointer.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n/**\r\n * @enum\r\n * @readonly\r\n * @description This enumeration encapsulates the valid value for Pointer type field.\r\n */\r\nemp.typeLibrary.Pointer.EventType = {\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that the mouse pointer has moved.\r\n     */\r\n    MOVE: \"move\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that a mouse button as been released.\r\n     */\r\n    MOUSEUP: \"mouseUp\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that a mouse button as been pressed.\r\n     */\r\n    MOUSEDOWN: \"mouseDown\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that a mouse button as clicked once.\r\n     */\r\n    SINGLE_CLICK: \"single\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that a mouse button as clicked more than once.\r\n     */\r\n    DBL_CLICK: \"double\",\r\n    DRAG: \"drag\",\r\n    DRAG_COMPLETE: \"dragComplete\"\r\n};\r\n\r\n/**\r\n * @enum\r\n * @readonly\r\n * @description This enumeration encapsulates the valid value for Pointer button field.\r\n */\r\nemp.typeLibrary.Pointer.ButtonType = {\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that the event involves the left button of the pointer device..\r\n     */\r\n    LEFT_BUTTON: \"left\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that the event involves the middle button of the pointer device..\r\n     */\r\n    MIDDLE_BUTTON: \"middle\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This type indicates that the event involves the right button of the pointer device..\r\n     */\r\n    RIGHT_BUTTON: \"right\"\r\n};\r\n\r\n/**\r\n * @enum\r\n * @readonly\r\n * @description This enumeration encapsulates the valid value for Pointer key field.\r\n */\r\nemp.typeLibrary.Pointer.KeyType = {\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that the alt key was pressed when the event occurred.\r\n     */\r\n    ALT_KEY: \"alt\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that the control key was pressed when the event occurred.\r\n     */\r\n    CTRL_KEY: \"ctrl\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that the shift key was pressed when the event occurred.\r\n     */\r\n    SHIFT_KEY: \"shift\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that no keys were pressed when the event occurred.\r\n     */\r\n    NO_KEY: \"none\"\r\n};\r\n/**\r\n * @typedef {object} emp.typeLibrary.Pointer.popupInfoType\r\n * @property {string} [title] The text title that will show for the feature popup window\r\n * @property {string} [content] The string representing HTML content to be displayed in the popup window\r\n*/\r\n\r\n/**\r\n * @typedef {object} emp.typeLibrary.Pointer.ParameterType\r\n * @property {number} [lat] This field indicates the latitude coordinate of the location\r\n * the pointer event occurred. It may be undefined if the event occurred off\r\n * the globe.\r\n * @property {number} [lon] This field indicates the longitude coordinate of the location\r\n * the pointer event occurred. It may be undefined if the event occurred off\r\n * the globe.\r\n * @property {number} [elevation] This field indicates the terrain elevation at the coordinates of the location\r\n * the pointer event occurred. It may be undefined if the event occurred off\r\n * the globe.\r\n * @property {!emp.typeLibrary.Pointer.EventType} type This field identifies the type of event that occurred.\r\n * @property {string} [mgrs] This field provides the coordinates in MGRS format.\r\n * @property {emp.typeLibrary.Pointer.ButtonType} [button] This field identifies the button that generated or was active when the event was generated.\r\n * @property {emp.typeLibrary.Pointer.KeyType[]} [keys] This field identifies the keys that were pressed when the event occurred.\r\n * @property {number} [clientX] This field indicates the x coordinate, relative to the top left of the client window, of the pointer device when the event occurred.\r\n * @property {number} [clientY] This field indicates the y coordinate, relative to the top left of the client window, of the pointer device when the event occurred.\r\n * @property {number} [screenX] This field indicates the x coordinate, relative to the top left of the screen, of the pointer device when the event occurred.\r\n * @property {number} [screenY] This field indicates the y coordinate, relative to the top left of the screen, of the pointer device when the event occurred.\r\n * @property {string} [coreId] If the event occurred over a feature, this field indicates the feature's coreId. It is used to populate the overlay, feature and parent Ids.\r\n * @property {string} [featureId] If the event occurred over a feature, this field indicates the feature's identifier.\r\n * @property {string} [overlayId] If the event occurred over a feature, this field indicates the feature's overlay ID.\r\n * @property {string} [parentId] If the event occurred over a feature, this field indicates the feature's parent ID.\r\n * @property {number} [scale] This field contains the map scale when the event occurred.\r\n * @property {number} [range] This field contains the map range when the event occurred.\r\n * @property {emp.typeLibrary.BoundingBoxType} [bounds] This field contains the map view area coordinates when the event occurred.\r\n */\r\n","/* globals emp */\r\n\r\n/* global emp, armyc2 */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n * @desc Used to indicate a draw operation to the map engine. A map engine implementation should never create\r\n * an instance of this class.\r\n */\r\nemp.typeLibrary.Draw = function (args) {\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field contains the transaction ID the draw operation is submitted under.\r\n     */\r\n    this.transactionId = args.transactionId;\r\n\r\n    /**\r\n     * @field\r\n     * @type emp.typeLibrary.types\r\n     * @description This field identifies the class to all internal and external components.\r\n     * It is provided so it can be used in place of the instanceof operator.\r\n     * @see {@link emp.typeLibrary.types}\r\n     */\r\n    this.globalType = emp.typeLibrary.types.DRAW;\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field identifies the operation that is to be performed.\r\n     */\r\n    this.intent = args.intent;\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field shall contain the feature identifier of the feature\r\n     * the operation is to be performed on.\r\n     */\r\n    this.featureId = args.featureId;\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field, if present, shall contain a user readable name to assign to the\r\n     * drawn feature.\r\n     */\r\n    this.name = args.name;\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field contains a menuId to be applied tothe feature drawn,\r\n     */\r\n    this.menuId = args.menuId;\r\n\r\n    /**\r\n     * @field\r\n     * @type emp.typeLibrary.Draw.Types\r\n     * @description This field will identify the type of feature that is to be drawn.\r\n     * @see {@link emp.typeLibrary.Draw.Types} For a list of valid types.\r\n     */\r\n    this.type = args.type;\r\n\r\n    /**\r\n     * @field\r\n     * @type emp.typeLibrary.Feature.properties\r\n     * @description This field will contain any values required to draw the feature. However\r\n     * the map engine must provide default values for any and all required properties that\r\n     * are not provided.\r\n     * @see {@link emp.typeLibrary.Feature.properties} For a description of all properties and the features they apply to.\r\n     */\r\n    this.properties = args.properties || {};\r\n\r\n\r\n    /**\r\n     * @field\r\n     * @type string\r\n     * @description This field should contain the symbol code for drawing a MilStd graphic or the 3D airspace.\r\n     */\r\n    this.symbolCode = args.symbolCode;\r\n\r\n\r\n    /**\r\n     * Contains a geojson object containing the starting coordinates of a draw.   This will\r\n     * allow a user to continue drawing from a preset number of points.\r\n     * @type GeoJSON\r\n     */\r\n    this.coordinates = args.coordinates;\r\n\r\n    /**\r\n     * @field\r\n     * @description This field is a structure object containing the coordinates for the feature.\r\n     * It shall contains two fields, type - which indicates the type of geojson coordinates provided.\r\n     * And coordinates which shall contain the coordinates in GEOJSON format as defined in the type field.\r\n     */\r\n    this.data = args.data || {};\r\n\r\n    /* EMP-188 start */\r\n    // CMAPI Shim.\r\n\r\n    /* EMP-188 end */\r\n    /**\r\n     * @field\r\n     * @private\r\n     * @description This field is populated by the update method.\r\n     *\r\n     */\r\n    this.updates = args.updates;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.source = args.source;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.sender = args.sender;\r\n    /**\r\n     * @private\r\n     */\r\n    this.autoPopulate = args.autoPopulate;\r\n\r\n    if ((this.properties.altitudeMode === undefined) ||\r\n            (this.properties.altitudeMode === null))\r\n    {\r\n\r\n        // The client has not provided an altitudeMode.\r\n        switch (this.type)\r\n        {\r\n            case \"point\":\r\n            case \"line\":\r\n            case \"polygon\":\r\n            case \"path\":\r\n            case \"rectangle\":\r\n            case \"square\":\r\n            case \"circle\":\r\n            case \"ellipse\":\r\n            case \"text\":\r\n                this.properties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n                break;\r\n            case \"milstd\":\r\n\r\n                var iStdVersion = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(this.properties.standard);\r\n                this.properties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n\r\n                if (!armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(this.symbolCode, iStdVersion))\r\n                {\r\n                    this.properties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND;\r\n                }\r\n                break;\r\n            case \"airspace\":\r\n                this.properties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND;\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.schema = {\r\n        \"title\": \"EMP-Draw Schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"featureId\": {\r\n                \"type\": \"string\"\r\n            },\r\n            \"name\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"type\": {\r\n                \"type\": \"string\"\r\n            },\r\n            \"properties\": {\r\n                \"type\": [\"object\", \"null\"]\r\n            },\r\n            \"transactionId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            }\r\n        },\r\n        \"required\": [\"featureId\", \"type\"]\r\n    };\r\n\r\n    this.validate();\r\n\r\n\r\n    /**\r\n     * @public\r\n     * @method\r\n     * @description Method called by the map engine to generate an update event.\r\n     * @param {object} args This object must contain all items needed to generate an update event.\r\n     * @param {string=} args.name This field contains the name of the feature.\r\n     * @param {emp.typeLibrary.CoordinateUpdate} args.updates This object contains the coordinates of the feature.\r\n     * @param {emp.typeLibrary.Feature.properties} args.properties This object contains the updated properties for the feature.\r\n     * @param {emp.typeLibrary.UpdateEventType} args.updateEventType This parameter identifies the update.\r\n     * @param {emp.typeLibrary.Feature} args.plotFeature This parameter is the newly drawn feature.\r\n     */\r\n    this.update = function (args) {\r\n\r\n        var t = this,\r\n                o,\r\n                feature,\r\n                sTranID = emp.helpers.id.newGUID(),\r\n                format = \"geojson\";\r\n        /*\r\n         we don't want to create transactions for create menu initiated draws\r\n         so filter on the source\r\n         */\r\n        this.updates = args.updates;\r\n\r\n        if (emp.api.checkApiSource(this.source) === true){\r\n\r\n            // when we create a typeLibrary feature, set the format\r\n            // to geojson for any v2 messages.  If it is a v3 message, the type\r\n            // will be the format.\r\n            if (args.properties && args.properties.v3) {\r\n                if (args.properties.v3) {\r\n                  format = this.type;\r\n                }\r\n            }\r\n            feature = new emp.typeLibrary.Feature({\r\n                featureId: t.featureId,\r\n                name: args.name || t.name,\r\n                updates: args.updates,\r\n                properties: args.properties,\r\n                // set to false so the final update can be sent from the end function\r\n                // this had to be done due to engines not having the plotFeature object populated\r\n                // until the end is called.  In the end event the final update with complete set\r\n                // to true is dispatched so it has access to the final plotFeature and can send\r\n                // the entire feature\r\n                complete: ((args.updateEventType === emp.typeLibrary.UpdateEventType.COMPLETE)? true: false),\r\n                updateEventType: args.updateEventType,\r\n                format: format,\r\n                data: t.data\r\n            });\r\n\r\n            feature.transactionId = t.transactionId;\r\n\r\n            if (t.v1Type !== undefined)\r\n            {\r\n                // This is for V1 draw request.\r\n                feature.v1Type = t.v1Type;\r\n            }\r\n            if (args.plotFeature && args.plotFeature.format)\r\n            {\r\n                feature.format = args.plotFeature.format;\r\n            }\r\n            if (args.plotFeature && args.plotFeature.data)\r\n            {\r\n                feature.data = args.plotFeature.data;\r\n            }\r\n\r\n            feature.type = this.type;\r\n\r\n            if ((feature.data.coordinates === null) ||\r\n                    (feature.data.coordinates === undefined))\r\n            {\r\n                feature.data.coordinates = [];\r\n            }\r\n\r\n            o = new emp.typeLibrary.Transaction({\r\n                transactionId: sTranID,\r\n                sender: \"USER\",\r\n                intent: emp.intents.control.DRAW_UPDATE,\r\n                mapInstanceId: args.mapInstanceId,\r\n                intentParams: \"\",\r\n                items: [feature]\r\n            });\r\n            o.run();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.end = function () {\r\n\r\n    };\r\n\r\n    /**\r\n     * @field\r\n     * @description This field is the primary key of the feature.\r\n     */\r\n    this.coreId = emp.helpers.id.newGUID();\r\n\r\n    // when we create a typeLibrary feature, set the format\r\n    // to geojson for any v2 messages.  If it is a v3 message, the type\r\n    // will be the format.\r\n    var format = \"geojson\";\r\n    if (this.properties && this.properties.v3) {\r\n        if (this.properties.v3) {\r\n          format = this.type;\r\n        }\r\n    }\r\n    this.plotFeature = new emp.typeLibrary.Feature({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        source: emp.core.sources.MAP,\r\n        featureId: this.featureId,\r\n        name: this.name,\r\n        sender: this.sender,\r\n        properties: this.properties,\r\n        format: format,\r\n        originChannel: \"map.feature.plot\"\r\n    });\r\n\r\n    this.originFeature = undefined;\r\n\r\n    this.prepForExecution = function()\r\n    {\r\n        var oFeature = emp.storage.findFeature(this.overlayId, this.featureId);\r\n\r\n        if (oFeature !== undefined)\r\n        {\r\n            // If the feature exists we need to save a copy\r\n            // in case of a cancel which the map engines will delete the feature\r\n            // we need to re-plot it.\r\n            this.originFeature = oFeature.getObjectData(null, null);\r\n            this.coreId = oFeature.getCoreId();\r\n        }\r\n    };\r\n\r\n    this.cancel = function(args) {\r\n        if (this.originFeature !== undefined)\r\n        {\r\n            // If originFeature exists an existing feature was placed into draw mode.\r\n            // and the user canceled the draw.\r\n            // Given that the map engines delete the feature upon terminating a draw\r\n            // we must re-plot it in its original form.\r\n\r\n            // This transaction will send the feature to the API's\r\n            var oToAPITrans = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.FEATURE_OUTBOUND_PLOT,\r\n                mapInstanceId: args.mapInstanceId,\r\n                source: emp.core.sources.MAP,\r\n                items:[this.originFeature]\r\n            });\r\n            // This transaction will cause the plot to go to the map.\r\n            var oToMapTran = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.MI_FEATURE_ADD,\r\n                mapInstanceId: args.mapInstanceId,\r\n                source: emp.core.sources.MAP,\r\n                sender: this.sender,\r\n                items: [this.originFeature]\r\n            });\r\n\r\n            // We pospone the execusion of the transaction because we don't know\r\n            // if the map will delete the feature before calling the end event or after.\r\n            setTimeout(function(){\r\n                oToMapTran.run();\r\n                oToAPITrans.run();\r\n            }, 0);\r\n        }\r\n    };\r\n};\r\nemp.typeLibrary.Draw.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n/**\r\n * @memberOf emp.typeLibrary.Draw\r\n * @typedef {object} emp.typeLibrary.Draw.Types\r\n * @description This type defines the possible values identifying the opbject to be drawn.\r\n */\r\nemp.typeLibrary.Draw.Types = {\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a single point GeoJSON feature is to be drawn.\r\n     */\r\n    POINT: 'point',\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a GeoJSON line is to be drawn.\r\n     */\r\n    LINE: 'line',\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a GeoJSON polygon is to be drawn.\r\n     */\r\n    POLYGON: 'polygon',\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a line is to be drawn.\r\n     */\r\n    PATH: 'path',\r\n\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a circle is to be drawn.\r\n     */\r\n    CIRCLE: 'circle',\r\n\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that an ellipse is to be drawn.\r\n     */\r\n    ELLIPSE: 'ellipse',\r\n\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a rectangle is to be drawn.\r\n     */\r\n    RECTANGLE: 'rectangle',\r\n\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a square is to be drawn.\r\n     */\r\n    SQUARE: 'square',\r\n\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a freehand text is to be drawn.\r\n     */\r\n    TEXT: 'text',\r\n\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that a MIL-STD feature is to be drawn.\r\n     */\r\n    MILSTD: 'milstd',\r\n    /**\r\n     * @public\r\n     * @constant\r\n     * @type string\r\n     * @description This value indicates that an airspace is to be drawn.\r\n     */\r\n    AIRSPACE: 'airspace'\r\n};\r\n","/* globals emp */\r\n\r\n\r\n/* global emp */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n * @desc Used to indicate an Edit operation to the map engine. A map engine implementation should never create\r\n * an instance of this class.\r\n */\r\nemp.typeLibrary.Edit = function(args) {\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field contains the transaction ID the edit operation is submitted under.\r\n   */\r\n  this.transactionId = args.transactionId;\r\n\r\n  /**\r\n   * @field\r\n   * @type emp.typeLibrary.types\r\n   * @description This field identifies the class to all internal and external components.\r\n   * It is provided so it can be used in place of the instanceof operator.\r\n   * @see {@link emp.typeLibrary.types}\r\n   */\r\n  this.globalType = emp.typeLibrary.types.EDIT;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field identifies the operation that is to be performed.\r\n   */\r\n  this.intent = args.intent;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field shall contain the feature identifier of the feature\r\n   * the operation is to be performed on.\r\n   */\r\n  this.featureId = args.featureId;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field shall contain the unique identifier of the overlay\r\n   * which contains the feature the operation pertains to.\r\n   */\r\n  this.overlayId = args.overlayId;\r\n\r\n  /**\r\n   * @field\r\n   * @type string | undefined\r\n   * @description This field, if present, along with the overlayId identify the parent\r\n   * feature of the feature to be edited.\r\n   */\r\n  this.parentId = args.parentId;\r\n  /**\r\n   * @field\r\n   * @private\r\n   * @description This field is populated by the update method.\r\n   *\r\n   */\r\n  this.updates = args.updates;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field shall contain a user readable name to assign to the\r\n   * feature.\r\n   */\r\n  this.name = args.name;\r\n\r\n  /**\r\n   * @field\r\n   * @type emp.typeLibrary.featureFormatType\r\n   * @description This field identifies the format of feature.\r\n   */\r\n  this.type = args.type;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.sender = args.sender;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.complete = args.complete || false;\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This field is only present for backward compatibility. New map engines\r\n   * should access this.data.symbolCode.\r\n   */\r\n  this.symbolCode = args.symbolCode;\r\n\r\n  /**\r\n   * @field\r\n   * @type emp.typeLibrary.Feature.properties\r\n   * @description This field will contain any values required to draw the feature. However\r\n   * the map engine must provide default values for any and all required properties that\r\n   * are not provided.\r\n   * @see {@link emp.typeLibrary.Feature.properties} For a description of all properties and the features they apply to.\r\n   */\r\n  this.properties = args.properties || {};\r\n\r\n  /**\r\n   * @field\r\n   * @description This field is a structure object containing the coordinates for the feature.\r\n   * It shall contains two fields, type - which indicates the type of geojson coordinates provided.\r\n   * And coordinates which shall contain the coordinates in GEOJSON format as defined in the type field.\r\n   */\r\n  this.data = this.data || {};\r\n\r\n  /**\r\n   * @field\r\n   * @type string\r\n   * @description This optional field is present if the type indicated is milstd or airspace.\r\n   * It contains the symbol code of the feature that is to be drawn.\r\n   */\r\n  this.data.symbolCode = this.data.symbolCode || {};\r\n\r\n  /**\r\n   * @public\r\n   * @method\r\n   * @description Method called by the map engine to generate an update event.\r\n   * @param {object} args This object must contain all items needed to generate an update event.\r\n   * @param {string=} args.name This field contains the name of the feature.\r\n   * @param {emp.typeLibrary.CoordinateUpdate} args.updates This object contains the coordinates of the feature.\r\n   * @param {emp.typeLibrary.Feature.properties} args.properties This object contains the updated properties for the feature.\r\n   * @param {emp.typeLibrary.UpdateEventType} args.updateEventType This parameter identifies the update.\r\n   */\r\n  this.update = function(args) {\r\n    var t = this,\r\n      o,\r\n      data,\r\n      v1Type;\r\n    var storageEntry = emp.storage.get.id({\r\n      id: this.originFeature.coreId\r\n    });\r\n    var feature = storageEntry.getObjectData(args.mapInstanceId, emp.storage.getRootGuid(args.mapInstanceId));\r\n\r\n    feature.overlayId = this.overlayId;\r\n    feature.parentId = this.parentId;\r\n\r\n\r\n    v1Type = storageEntry.v1Type;\r\n\r\n    if (args.properties) {\r\n      for (var sProp in args.properties) {\r\n        if (args.properties.hasOwnProperty(sProp)) {\r\n          if (sProp !== 'readOnly') {\r\n            feature.properties[sProp] = emp.helpers.copyObject(args.properties[sProp]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!args.hasOwnProperty(\"updateEventType\") ||\r\n      (args.updateEventType !== emp.typeLibrary.UpdateEventType.START)) {\r\n      data = feature.generateData({\r\n        feature: feature,\r\n        updates: args.updates\r\n      });\r\n      feature.data = data;\r\n\r\n      if (args.hasOwnProperty('plotFeature') &&\r\n        (feature.format === emp.typeLibrary.featureFormatType.GEOJSON)) {\r\n        // Now check if its a GeoJSON feature.\r\n        if (feature.data.type.toLowerCase() === 'feature') {\r\n          if (feature.data.hasOwnProperty('properties') &&\r\n            feature.data.properties.hasOwnProperty('aoi')) {\r\n            if (args.plotFeature.data.hasOwnProperty('properties') &&\r\n              args.plotFeature.data.properties.hasOwnProperty('aoi')) {\r\n              feature.data.properties.aoi = args.plotFeature.data.properties.aoi;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // coordinates property needs to be updated in order for any cancelling of a\r\n      // subsequent edit operation to revert back to the last edit result instead\r\n      // of the original coordinate positioning.\r\n      feature.coordinates = \"\";\r\n      for (var i = 0; i < args.updates.coordinates.length; i++) {\r\n        feature.coordinates += args.updates.coordinates[i].lon.toString() + \",\" +\r\n          args.updates.coordinates[i].lat.toString();\r\n        if (args.updates.coordinates[i].hasOwnProperty(\"alt\")) {\r\n          feature.coordinates += \",\" + args.updates.coordinates[i].alt.toString();\r\n        }\r\n        feature.coordinates += \" \";\r\n      }\r\n      feature.coordinates = feature.coordinates.trim();\r\n    }\r\n\r\n    if ((args.complete === true) || (args.updateEventType === emp.typeLibrary.UpdateEventType.COMPLETE)) {\r\n      feature.complete = true;\r\n      args.complete = true;\r\n    }\r\n\r\n    feature.updateEventType = args.updateEventType;\r\n    feature.updates = args.updates;\r\n    feature.transactionId = t.transactionId;\r\n\r\n    if (v1Type !== undefined) {\r\n      // This is for V1 draw request.\r\n      feature.v1Type = t.originFeature.v1Type;\r\n    }\r\n\r\n    o = new emp.typeLibrary.Transaction({\r\n      sender: \"USER\",\r\n      intent: emp.intents.control.EDIT_UPDATE,\r\n      mapInstanceId: args.mapInstanceId,\r\n      intentParams: \"\",\r\n      items: [feature]\r\n    });\r\n\r\n    o.run();\r\n\r\n    this.updatedFeature = feature;\r\n  };\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.schema = {\r\n    \"title\": \"EMP-Edit Schema\",\r\n    \"type\": \"object\",\r\n    \"properties\": {\r\n      \"featureId\": {\r\n        \"type\": \"string\"\r\n      },\r\n      \"overlayId\": {\r\n        \"type\": [\"string\", \"null\"]\r\n      },\r\n      \"parentId\": {\r\n        \"type\": [\"string\", \"null\"]\r\n      },\r\n      \"transactionId\": {\r\n        \"type\": [\"string\", \"null\"]\r\n      }\r\n    },\r\n    \"required\": []\r\n  };\r\n  //this.validate();\r\n\r\n  /**\r\n   * @field\r\n   * @description This field is the primary key of the feature.\r\n   */\r\n  this.coreId = args.coreId;\r\n\r\n  // In the event of a cancel a map engine must revert the feature back\r\n  // to its original version. So here we create a duplicated of the\r\n  // feature as it is before editing.\r\n  this.originFeature;\r\n\r\n  this.end = function(args) {\r\n    var feature = this.updatedFeature;\r\n    var storageEntry = emp.storage.findFeature(null, feature.featureId);\r\n    var parent = storageEntry.getParentByIndex(0);\r\n\r\n    switch (parent.getCoreObjectType()) {\r\n      case emp.typeLibrary.types.OVERLAY:\r\n        feature.overlayId = parent.getOverlayId();\r\n        break;\r\n      case emp.typeLibrary.types.FEATURE:\r\n        feature.parentId = parent.getFeatureId();\r\n\r\n        while (parent.getCoreObjectType() !== emp.typeLibrary.types.OVERLAY) {\r\n          parent = parent.getParentByIndex(0);\r\n        }\r\n        feature.overlayId = parent.getOverlayId();\r\n        break;\r\n    }\r\n\r\n    var e = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_OUTBOUND_PLOT,\r\n      mapInstanceId: args.mapInstanceId,\r\n      source: emp.core.sources.MAP,\r\n      items: [feature]\r\n    });\r\n    e.run();\r\n  };\r\n\r\n  this.cancel = function(args) {\r\n\r\n    var outBoundTrans = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_OUTBOUND_PLOT,\r\n      mapInstanceId: args.mapInstanceId,\r\n      source: emp.core.sources.MAP,\r\n      items: [this.originFeature]\r\n    });\r\n\r\n    // This transaction will cause the plot to go to the map.\r\n    var newTrans = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.MI_FEATURE_ADD,\r\n      mapInstanceId: args.mapInstanceId,\r\n      source: emp.core.sources.MAP,\r\n      sender: this.sender,\r\n      items: [this.originFeature]\r\n    });\r\n\r\n    setTimeout(function() {\r\n      newTrans.run();\r\n      outBoundTrans.run();\r\n    }, 0);\r\n\r\n  };\r\n\r\n  this.prepForExecution = function() {\r\n    var feature;\r\n\r\n    if (emp.helpers.isEmptyString(this.coreId)) {\r\n      // It's not set.\r\n      feature = emp.storage.findFeature(this.overlayId, this.featureId);\r\n\r\n      if (feature === undefined) {\r\n        // Attempting to edit a feature that does not exist. The system will fail this\r\n        this.coreId = emp.helpers.id.newGUID();\r\n        return;\r\n      }\r\n\r\n      this.coreId = feature.getCoreId();\r\n    }\r\n  };\r\n};\r\n\r\nemp.typeLibrary.Edit.prototype.validate = emp.typeLibrary.base.validate;\r\n","/* globals emp */\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n * @desc This class contains the details of the selection operation or selection event.\r\n * A map implementation should never create an instance of the class.\r\n * @param  {emp.typeLibrary.Selection.ParameterType} args - Arguments to populate Selection.\r\n */\r\nemp.typeLibrary.Selection = function (args) {\r\n\r\n    /**\r\n     * @field\r\n     * @type {string=}\r\n     * @description This field contains the primary key of the feature.\r\n     */\r\n    this.coreId = args.coreId;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.type = args.type;\r\n    /**\r\n     * @private\r\n     */\r\n    this.globalType = emp.typeLibrary.types.SELECTION;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description The identifier of the features overlay.\r\n     */\r\n    this.overlayId = args.overlayId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description The identifier of the features.\r\n     */\r\n    this.featureId = args.featureId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description The features parent Id parameter.\r\n     */\r\n    this.parentId = args.parentId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description If the selection event refers to a sub component, this field contains the sub component's identifier.\r\n     */\r\n    this.selectedId = args.selectedId;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string}\r\n     * @description This field contains the name of the feature affected.\r\n     */\r\n    this.selectedName = args.selectedName;\r\n\r\n\r\n    /**\r\n     * @field\r\n     * @type {boolean}\r\n     * @description This field contains the indicator. True to select the feature and false\r\n     * to unselect the feature.\r\n     */\r\n    this.select = args.select;\r\n\r\n    /**\r\n     * @field\r\n     * @type {string=}\r\n     * @description If this instance is part of a selection operation, this field contains the\r\n     * transaction ID of the transaction it came in under.\r\n     */\r\n    this.transactionId = args.transactionId;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.sender = args.sender;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.originChannel = args.originChannel;\r\n    //    this.selection = args.selection || false;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.schema = {\r\n        \"title\": \"EMP-Selection Schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"featureId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"overlayId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"parentId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"selectedId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"selectedName\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            },\r\n            \"transactionId\": {\r\n                \"type\": [\"string\", \"null\"]\r\n            }\r\n        }\r\n    };\r\n    this.validate();\r\n\r\n    this.prepForExecution = function(){\r\n        var oStorageItem;\r\n        \r\n        if (this.coreId !== undefined)\r\n        {\r\n            // They gave us the coreId return it.\r\n            oStorageItem = emp.storage.get.id({id: this.coreId});\r\n            \r\n            if (oStorageItem)\r\n            {\r\n                switch(oStorageItem.getCoreObjectType()) {\r\n                    case emp.typeLibrary.types.FEATURE:\r\n                        this.featureId = oStorageItem.getFeatureId();\r\n                        break;\r\n                    case emp.typeLibrary.types.WMS:\r\n                        this.featureId = oStorageItem.getId();\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        else if (this.overlayId && this.featureId)\r\n        {\r\n            // Else find the feature.\r\n            oStorageItem = emp.storage.findFeature(this.overlayId, this.featureId);\r\n        }\r\n        \r\n        // If the item is in storage return its coreId.\r\n        if (oStorageItem === undefined)\r\n        {\r\n            this.coreId = emp.helpers.id.newGUID();\r\n        }\r\n        else\r\n        {\r\n            this.coreId = oStorageItem.getCoreId();\r\n        }\r\n    };\r\n};\r\n\r\nemp.typeLibrary.Selection.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\nemp.typeLibrary.Selection._NOSELECT = \"...EMP_CORE-NO-SELECT\";\r\n\r\n/**\r\n * @typedef emp.typeLibrary.Selection.ParameterType\r\n * @description The coreId or overlay, feature, parent Ids must be provided.\r\n * @property {string=} coreId - The coreId of the feature. It will be used to populate the\r\n * overlayId, featureId and parentId.\r\n * @property {string=} featureId - The feature identifier.\r\n * @property {string=} overlayId - The overlay ID of the feature.\r\n * @property {string=} parentId  - The parent ID of the feature\r\n * @property {string=} selectedId - If the feature affected is a sub feature, this should contain the sub feature identifier.\r\n * @property {string=} selectedName - The name of the selection\r\n * @property {string=} transactionId - If this instance is part of a selection operation, this field contains the\r\n * @property {boolean} select - If this instance is part of a selection operation, this value indicates if the feature is to be selected (TRUE)\r\n * or unselected (FALSE).\r\n */\r\n","/* globals emp */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n *\r\n * @class\r\n * @description This class is used to represent a SelectionBox event.\r\n * A map implementation should never create an instance of the class.\r\n * @param {emp.typeLibrary.SelectionBox.ParameterType} args This argument contains all the data needed to create the class instance.\r\n */\r\nemp.typeLibrary.SelectionBox = function (args) {\r\n    /**\r\n     * @private\r\n     */\r\n    this.globalType = emp.typeLibrary.types.SELECTION_BOX;\r\n        \r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.BoundingBoxType}\r\n     * @description This field contains the dragstart/dragend coordinates when the event occured.\r\n     */\r\n    this.bounds = args.bounds || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.Pointer.ButtonType=}\r\n     * @description This field identifies the mouse button that generated or was active when the event was generated.\r\n     */\r\n    this.button = args.button;\r\n\r\n    /**\r\n     * @field\r\n     * @type {emp.typeLibrary.Pointer.KeyType[]}\r\n     * @description This field identifies the keys that were pressed when the event occurred.\r\n     */\r\n    this.keys = (args.keys? (((args.keys instanceof Array) && (args.keys.length > 0))? args.keys: [\"none\"]): [\"none\"]);\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field contains the map scale when the event occured.\r\n     */\r\n    this.scale = args.scale || null;\r\n\r\n    /**\r\n     * @field\r\n     * @type {number}\r\n     * @description This field contains the map zoom when the event occured.\r\n     */\r\n    this.zoom = args.zoom || null;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.schema = {\r\n        \"title\": \"map-selection-box-event-schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"bounds\": {\r\n                \"type\": [\"object\", \"null\"],\r\n                \"east\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -180,\r\n                    \"maximum\": 180\r\n                },\r\n                \"north\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -90,\r\n                    \"maximum\": 90\r\n                },\r\n                \"west\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -180,\r\n                    \"maximum\": 180\r\n                },\r\n                \"south\": {\r\n                    \"type\": [\"number\", \"null\"],\r\n                    \"minimum\": -90,\r\n                    \"maximum\": 90\r\n                }\r\n            },\r\n            \"button\": {\r\n                \"type\": [\"string\", \"null\"],\r\n                \"anyOf\": [{\r\n                    \"format\": \"left\"\r\n                }, {\r\n                    \"format\": \"middle\"\r\n                }, {\r\n                    \"format\": \"right\"\r\n                }]\r\n            },\r\n            \"keys\": {\r\n                \"type\": [\"array\", \"null\"],\r\n                \"items\": {\r\n                    \"enum\": [\"alt\", \"ctrl\", \"shift\", \"none\", \"null\"]\r\n                }\r\n            },\r\n            \"scale\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": 0\r\n            },\r\n            \"zoom\": {\r\n                \"type\": [\"number\", \"null\"],\r\n                \"minimum\": 0\r\n            }\r\n        }\r\n    };\r\n    this.validate();\r\n\r\n    // after validation attempt to construct a valid CoreId\r\n    /**\r\n     * @private\r\n     */\r\n    this.coreId = emp.helpers.id.newGUID();\r\n\r\n};\r\nemp.typeLibrary.SelectionBox.prototype.validate = emp.typeLibrary.base.validate;\r\n\r\n/**\r\n * @typedef emp.typeLibrary.SelectionBox.ParameterType\r\n * @property {emp.typeLibrary.BoundingBoxType} [bounds] This field contains the dragstart/dragend coordinates when the event occurred.\r\n * @property {emp.typeLibrary.Pointer.ButtonType} [button] This field identifies the button that generated or was active when the event was generated.\r\n * @property {emp.typeLibrary.Pointer.KeyType[]} [keys] This field identifies the keys that were pressed when the event occurred.\r\n * @property {number} [scale] This field contains the map scale when the event occurred.\r\n * @property {number} [zoom] This field contains the map zoom when the event occurred.\r\n */\r\n","/* globals emp */\r\n\r\n/**\r\n * @memberOf emp.typeLibrary\r\n * @class\r\n * @description This class is an documents an error. When an instance is created use the new operator.\r\n * @param {emp.typeLibrary.Error.ParameterType} args - The arguments needed to create an error object\r\n * @param {string} [args.message]\r\n * @param {emp.typeLibrary.Error.level} [args.level = emp.typeLibrary.Error.level.INFO]\r\n * @param {string} [args.coreId]\r\n * @param {object} [args.jsError]\r\n */\r\nemp.typeLibrary.Error = function (args) {\r\n\r\n    var returnValue;\r\n\r\n/*\r\n    var schema = {\r\n        \"title\": \"error-schema\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"message\": {\r\n                \"type\": \"string\"\r\n            }\r\n        },\r\n        \"required\": [\"message\"]\r\n    };\r\n*/\r\n\r\n    returnValue = {\r\n        date: new Date(),\r\n        message: args.message || \"\",\r\n        level : args.level || 0,\r\n        coreId : args.coreId || \"\",\r\n        jsError : args.jsError || {}\r\n    };\r\n\r\n    emp.errorHandler.log(returnValue);\r\n    return returnValue;\r\n};\r\n\r\n/**\r\n * @memberOf emp.typeLibrary.Error\r\n * @enum\r\n * @readonly\r\n */\r\nemp.typeLibrary.Error.level = {\r\n    /**\r\n     * @constant\r\n     * @type number\r\n     * @description This value indicates an informative messages.\r\n     */\r\n    INFO: 0,\r\n    /**\r\n     * @constant\r\n     * @type number\r\n     * @description This value indicates a minor error has occurred.\r\n     */\r\n    MINOR: 1,\r\n    /**\r\n     * @constant\r\n     * @type number\r\n     * @description This value indicates a major error has occurred.\r\n     */\r\n    MAJOR: 2,\r\n    /**\r\n     * @constant\r\n     * @type number\r\n     * @description This value indicates a catastrophic error has occurred. The\r\n     * system may behave erratically or not at all.\r\n     */\r\n    CATASTROPHIC: 3\r\n};\r\n\r\n/**\r\n * @typedef emp.typeLibrary.Error.ParameterType\r\n * @property {string} [coreId] The primary key of the object the error pertains to.\r\n * @property {emp.typeLibrary.Error.level} level The severity level of the error.\r\n * @property {string} message - error message\r\n * @property {object} [jsError] - optional javascript exception object\r\n */\r\n","/*global emp */\r\n\r\n/**\r\n * @class\r\n * @description This class defines a WMS service. A map implementation should never create\r\n * an instance of this class.\r\n */\r\nemp.typeLibrary.WMS = function(args) {\r\n  /**\r\n   * @private\r\n   * @description An associative array containing a list of its children.\r\n   */\r\n  this.nodes = {};\r\n\r\n  /**\r\n   * @private\r\n   * @description An associative array containing a list of its parents.\r\n   */\r\n  this.parentNodes = {};\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.globalType = emp.typeLibrary.types.WMS;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.disabled = false;\r\n\r\n  // If name remains an empty String, it may be overridden with\r\n  // a name form the capabilities file\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains a readable name used to identify the service on the layers window.\r\n   */\r\n  this.name = args.name || \"\";\r\n\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the transaction ID the operation came under.\r\n   */\r\n  this.transactionId = args.transactionId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the message ID the operation came under.\r\n   */\r\n  this.messageId = args.messageId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {object}\r\n   * @description This field contains the service parameters to use for the WMS request.\r\n   */\r\n  this.params = args.params || {};\r\n\r\n  // Make sure the deafults are present.\r\n  if (!this.params.hasOwnProperty('transparent')) {\r\n    this.params.transparent = true;\r\n  }\r\n  else if (typeof(this.params.transparent) !== \"boolean\") {\r\n    if ((typeof(this.params.transparent) === \"string\") &&\r\n      (this.params.transparent.toUpperCase() === \"FALSE\")) {\r\n      this.params.transparent = false;\r\n    }\r\n    else {\r\n      this.params.transparent = true;\r\n    }\r\n  }\r\n\r\n  if (!this.params.hasOwnProperty('format')) {\r\n    this.params.format = escape(\"image/png\");\r\n  }\r\n  else if (typeof(this.params.format) !== \"string\") {\r\n    this.params.format = \"image/png\";\r\n  }\r\n\r\n  if (!this.params.hasOwnProperty('version')) {\r\n    this.params.version = \"1.3.0\";\r\n  }\r\n  else if (typeof(this.params.version) !== \"string\") {\r\n    this.params.version = \"1.3.0\";\r\n  }\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unique identifier of the instance.\r\n   */\r\n  this.id = args.id;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unescaped URL of the WMS service.\r\n   */\r\n  this.url = args.url;\r\n\r\n  /**\r\n   * @field\r\n   * @type Boolean\r\n   * @description This property indicates if the request for the WMS are issued via the proxy (if true,) or not (if false).\r\n   */\r\n  this.useProxy = emp.util.getBooleanValue(args.useProxy, emp.util.config.getUseProxySetting());\r\n\r\n  // OverlayId is optional.  If no overlayId is provided for the WMS service\r\n  // It will be added to root\r\n\r\n  /**\r\n   * @field\r\n   * @type {string=}\r\n   * @description This optional field contains the unique identifier of the overlay\r\n   * the WMS service is to be created under.\r\n   */\r\n  this.overlayId = emp.helpers.id.get.setId(args.overlayId) || emp.constant.parentIds.MAP_LAYER_PARENT;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string[]}\r\n   * @description This field, if present, contains a list of layer the map must\r\n   * request. The list must contain the layer name, not the title. if a default layer list is\r\n   * provided, the WMS service will never display its layers in the layers window. And\r\n   * the WMS service will be treated as one object by the core components.\r\n   */\r\n  this.layers = args.layers || [];\r\n\r\n  /**\r\n   * @field\r\n   * @type {string[]}\r\n   * @description This field contains a list of layer that the map must\r\n   * make active (visible).\r\n   */\r\n  this.activeLayers = args.activeLayers || (function(args) {\r\n    var aTemp = [];\r\n\r\n    if ((args.layers === undefined) || (args.layers === null)) {\r\n      return aTemp;\r\n    }\r\n\r\n    for (var iIndex = 0; iIndex < args.layers.length; iIndex++) {\r\n      aTemp.push(args.layers[iIndex]);\r\n    }\r\n\r\n    return aTemp;\r\n  })(this);\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.layers = args.layers;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.layerHierarchy = args.layerHierarchy;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.version = this.params.version || \"\";\r\n  // capabilities will only be provided for wms adds where no default layers are provided\r\n\r\n  /**\r\n   * @field\r\n   * @type {string=}\r\n   * @description This field contains the unescaped xml capabilities document.\r\n   * It is made available to map implementation in the event that their WMS implementation requires it.\r\n   */\r\n  this.capabilities = args.capabilities || \"\";\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.transparent = this.params.transparent || false;\r\n  // format of the getMap image request\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.format = this.params.format || \"image/png\";\r\n\r\n  /**\r\n   * @field\r\n   * @type {boolean}\r\n   * @description This field indicates if the WMS as a whole should be made visible (TRUE) or hidden (FALSE).\r\n   * The map implementation must create the WMS service with the indicated visibility.\r\n   */\r\n  this.visible = args.visible;\r\n\r\n  /**\r\n   * @field\r\n   * @type boolean\r\n   * @description This field indicates if the feature is to be displayed as visible.\r\n   * The visibile indicator may be different if the parent has been made none visible.\r\n   * visible.\r\n   */\r\n  this.visibilitySetting = args.visibilitySetting || this.visible;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.type = \"wms\";\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.intent = args.intent || \"wms.add\";\r\n  // Callback function for succesful cpabilities load\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.loadSuccess = null;\r\n  // callback function if an error occurs while loading or parsing cpabilities document\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.loadFail = null;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.visibleLayers = args.visibleLayers || [];\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.source = args.source;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.onCapabilitiesLoad = function(args) {\r\n    // This executes in window's scope so we cannot use \"this\"\r\n    // args.scope represents this WMS instance passed through\r\n    // the chain of WMS loading.\r\n    args.scope.capabilities = args.xmlCapabilities;\r\n    args.scope.layerHierarchy = args.hierarchy;\r\n\r\n    args.scope.loadSuccess();\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.getParentFolderOfLayer = function(layerName) {\r\n    var findFoldersOfLayer = function(sLayerName, oFolder) {\r\n      var oFolderFound;\r\n      var iIndex = emp.helpers.findIndexOf(oFolder.layers, 'name', sLayerName);\r\n\r\n      if (iIndex > -1) {\r\n        if (oFolder.hasOwnProperty('title') &&\r\n          (oFolder.title !== null) &&\r\n          (oFolder.title !== ''))\r\n          return oFolder;\r\n        else\r\n          return null;\r\n      }\r\n      for (iIndex = 0; iIndex < oFolder.folders.length; iIndex++) {\r\n        oFolderFound = findFoldersOfLayer(sLayerName, oFolder.folders[iIndex]);\r\n\r\n        if (oFolderFound === undefined) {\r\n          // It was not found, continue looking\r\n          continue;\r\n        }\r\n        else if (oFolderFound === null) {\r\n          // It was found but the folder has no title\r\n          // so we use this one if it has a title.\r\n\r\n          if (oFolder.hasOwnProperty('title') &&\r\n            (oFolder.title !== null) &&\r\n            (oFolder.title !== ''))\r\n            return oFolder;\r\n          else\r\n            return null;\r\n        }\r\n        else {\r\n          return oFolderFound;\r\n        }\r\n      }\r\n\r\n      return undefined;\r\n    };\r\n\r\n    var oFolder = findFoldersOfLayer(layerName, this.layerHierarchy);\r\n\r\n    // If it was found but no parent folder has a title return undefined.\r\n    if (oFolder === null)\r\n      oFolder = undefined;\r\n\r\n    return oFolder;\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.getParentFolderOfFolder = function(folderTitle) {\r\n    var findParentOfFolder = function(sTitle, oFolder) {\r\n      var oFolderFound;\r\n      var iIndex = emp.helpers.findIndexOf(oFolder.folders, 'title', sTitle);\r\n\r\n      if (iIndex > -1) {\r\n        if (oFolder.hasOwnProperty('title') &&\r\n          (oFolder.title !== null) &&\r\n          (oFolder.title !== ''))\r\n          return oFolder;\r\n        else\r\n          return null;\r\n      }\r\n      for (iIndex = 0; iIndex < oFolder.folders.length; iIndex++) {\r\n        oFolderFound = findParentOfFolder(sTitle, oFolder.folders[iIndex]);\r\n\r\n        if (oFolderFound === undefined) {\r\n          // It was not found, continue looking\r\n          continue;\r\n        }\r\n        else if (oFolderFound === null) {\r\n          // It was found but the folder has no title\r\n          // so we use this one if it has a title.\r\n\r\n          if (oFolder.hasOwnProperty('title') &&\r\n            (oFolder.title !== null) &&\r\n            (oFolder.title !== ''))\r\n            return oFolder;\r\n          else\r\n            return null;\r\n        }\r\n        else {\r\n          return oFolderFound;\r\n        }\r\n      }\r\n\r\n      return undefined;\r\n    };\r\n\r\n    var oFolder = findParentOfFolder(folderTitle, this.layerHierarchy);\r\n\r\n    // If it was found but no parent folder has a title return undefined.\r\n    if (oFolder === null)\r\n      oFolder = undefined;\r\n\r\n    return oFolder;\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.onCapabilitiesFail = function(args) {\r\n    // This executes in window's scope so we cannot use \"this\"\r\n    // args.scope represents this WMS instance passed through\r\n    // the chain of WMS loading.\r\n\r\n    args.scope.loadFail(args);\r\n  };\r\n\r\n  /**\r\n   * @description Create a parent overlay for a WMS if it doesn't exist\r\n   */\r\n  this.createParent = function() {\r\n    var transaction,\r\n      payload;\r\n\r\n    payload = {\r\n      name: \"[Unnamed Overlay(CORE)]\",\r\n      overlayId: this.overlayId,\r\n      parentId: \"\"\r\n    };\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      length: 1,\r\n      intent: emp.intents.control.OVERLAY_ADD,\r\n      transactionId: this.transactionId + \".parent\",\r\n      originChannel: \"map.overlay.create\",\r\n      sender: this.sender,\r\n      transactionType: \"overlay\",\r\n      type: \"transaction\",\r\n      items: function() {\r\n        var r = [];\r\n        r.push(new emp.typeLibrary.Overlay(payload));\r\n        return r;\r\n      }\r\n    });\r\n    transaction.run();\r\n  };\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the primary key of the instance.\r\n   */\r\n  this.coreId = (function(args) {\r\n    if ((args.coreId !== undefined) && (args.coreId !== null)) {\r\n      return args.coreId;\r\n    }\r\n\r\n    return args.id;\r\n  })(args);\r\n\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the primary key of the parent object.\r\n   */\r\n  this.coreParent = args.coreParent || (function(args) {\r\n    if (emp.helpers.id.get.isId(args.overlayId)) {\r\n      return args.overlayId;\r\n    }\r\n    else if (emp.hasOwnProperty('storage')) {\r\n      return emp.storage.getRootGuid();\r\n    }\r\n\r\n    return undefined;\r\n  })(this);\r\n\r\n  this.parentCoreId = args.parentCoreId || this.coreParent;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.locate = function(args) {\r\n    var transaction,\r\n      payload;\r\n    args = args || {};\r\n    args.component = args.component || \"\";\r\n\r\n    if (args.bounds) {\r\n      payload = {\r\n        channel: \"map.view.center.bounds\",\r\n        bounds: args.bounds,\r\n        zoom: true,\r\n        visible: true\r\n      };\r\n    }\r\n    else {\r\n      payload = {\r\n        channel: \"map.view.center.bounds\",\r\n        featureId: this.id,\r\n        overlayId: this.overlayId,\r\n        zoom: true,\r\n        visible: true\r\n      };\r\n    }\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      intent: \"view.set\",\r\n      transactionId: emp.helpers.id.newGUID(),\r\n      sender: \"core\",\r\n      originChannel: \"map.view.center.bounds\",\r\n      originSchema: \"map.view.center.bounds\",\r\n      transactionType: \"view\",\r\n      items: function() {\r\n        var r = [];\r\n        r.push(new emp.typeLibrary.View(payload));\r\n        return r;\r\n      }\r\n    });\r\n    if (args.component === \"de\") {\r\n      transaction.run();\r\n    }\r\n    else {\r\n      return transaction;\r\n    }\r\n  };\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.visibility = function(oTransaction, sParentCoreId, bVisibility) {\r\n    var //transaction,\r\n      oItem;\r\n\r\n    this.visible = bVisibility;\r\n    this.visibilitySetting = bVisibility;\r\n    oItem = this.createDuplicate();\r\n\r\n    oTransaction.items.push(oItem);\r\n  };\r\n\r\n  this.getAllLayer = function() {\r\n    var oaLayers = [];\r\n\r\n    var getLayers = function(oLayerList) {\r\n      var oaLayerList = [];\r\n\r\n      for (var iIndex = 0; iIndex < oLayerList.length; iIndex++) {\r\n        oaLayerList.push(oLayerList[iIndex].name);\r\n      }\r\n\r\n      return oaLayerList;\r\n    };\r\n\r\n    var getLayersFromFolders = function(oFolders) {\r\n      var oaLayerList = [];\r\n\r\n      for (var iIndex = 0; iIndex < oFolders.length; iIndex++) {\r\n        oaLayerList = oaLayerList.concat(getLayersFromFolders(oFolders[iIndex].folders));\r\n        oaLayerList = oaLayerList.concat(getLayers(oFolders[iIndex].layers));\r\n      }\r\n\r\n      return oaLayerList;\r\n    };\r\n    var oaTemp = getLayersFromFolders(this.layerHierarchy.folders);\r\n    oaLayers = oaLayers.concat(oaTemp);\r\n    oaTemp = getLayers(this.layerHierarchy.layers);\r\n    oaLayers = oaLayers.concat(oaTemp);\r\n\r\n    return oaLayers;\r\n  };\r\n\r\n  this.getAllNamedFolders = function() {\r\n\r\n    var getNamedFolders = function(oFolders) {\r\n      var oaFolderList = [];\r\n\r\n      for (var iIndex = 0; iIndex < oFolders.length; iIndex++) {\r\n        if ((oFolders[iIndex].layers.length > 0) ||\r\n          (oFolders[iIndex].folders.length > 0)) {\r\n          if (oFolders[iIndex].title) {\r\n            oaFolderList.push(oFolders[iIndex].title);\r\n          }\r\n          oaFolderList = oaFolderList.concat(getNamedFolders(oFolders[iIndex].folders));\r\n        }\r\n      }\r\n\r\n      return oaFolderList;\r\n    };\r\n\r\n    return getNamedFolders(this.layerHierarchy.folders);\r\n  };\r\n\r\n  this.oaFoldersSelected = [];\r\n  this.oaLayersSelected = [];\r\n\r\n  this.selectFolder = function(sFolderName) {\r\n    if (this.oaFoldersSelected.indexOf(sFolderName) === -1) {\r\n      this.oaFoldersSelected.push(sFolderName);\r\n    }\r\n  };\r\n\r\n  this.isFolderSelected = function(sFolderName) {\r\n    return (this.oaFoldersSelected.indexOf(sFolderName) !== -1);\r\n  };\r\n\r\n  this.unselectFolder = function(sFolderName) {\r\n    var iIndex = this.oaFoldersSelected.indexOf(sFolderName);\r\n    if (iIndex !== -1) {\r\n      this.oaFoldersSelected.splice(iIndex, 1);\r\n    }\r\n  };\r\n\r\n  this.selectAllFolders = function() {\r\n    this.oaFoldersSelected = this.getAllNamedFolders();\r\n  };\r\n\r\n  this.unselectAllFolders = function() {\r\n    if (this.oaFoldersSelected.length > 0) {\r\n      this.oaFoldersSelected.splice(0, this.oaFoldersSelected.length);\r\n    }\r\n  };\r\n\r\n  this.selectLayer = function(sLayerName) {\r\n    if (this.oaLayersSelected.indexOf(sLayerName) === -1) {\r\n      this.oaLayersSelected.push(sLayerName);\r\n    }\r\n  };\r\n\r\n  this.isLayerSelected = function(sLayerName) {\r\n    return (this.oaLayersSelected.indexOf(sLayerName) !== -1);\r\n  };\r\n\r\n  this.unselectLayer = function(sLayerName) {\r\n    var iIndex = this.oaLayersSelected.indexOf(sLayerName);\r\n    if (iIndex !== -1) {\r\n      this.oaLayersSelected.splice(iIndex, 1);\r\n    }\r\n  };\r\n\r\n  this.selectAllLayers = function() {\r\n    this.oaLayersSelected = this.getAllLayer();\r\n    this.activeLayers = this.oaLayersSelected;\r\n  };\r\n\r\n  this.unselectAllLayers = function() {\r\n    if (this.oaLayersSelected.length > 0) {\r\n      this.oaLayersSelected.splice(0, this.oaLayersSelected.length);\r\n    }\r\n  };\r\n\r\n  this.getObjectData = function() {\r\n    var oObj = {\r\n      id: this.id,\r\n      overlayId: this.overlayId,\r\n      name: this.name,\r\n      url: this.url,\r\n      format: this.format\r\n    };\r\n    oObj.params = emp.helpers.copyObject(this.params);\r\n\r\n    if (this.layers.length > 0) {\r\n      oObj.params.layers = this.layers.toString();\r\n    }\r\n    return oObj;\r\n  };\r\n\r\n  this.createDuplicate = function() {\r\n    var oNewWMS;\r\n    var oNodes = this.nodes;\r\n    var oParentNodes = this.parentNodes;\r\n    var oChildNodes = this.childNodes;\r\n\r\n    this.nodes = {};\r\n    this.parentNodes = {};\r\n    this.childNodes = {};\r\n\r\n    var stringFeature = JSON.stringify(this);\r\n    var objectFeature = JSON.parse(stringFeature);\r\n\r\n    this.nodes = oNodes;\r\n    this.parentNodes = oParentNodes;\r\n    this.childNodes = oChildNodes;\r\n\r\n    oNewWMS = new emp.typeLibrary.WMS(objectFeature);\r\n    oNewWMS.activeLayers = [];\r\n    for (var iIndex = 0; iIndex < this.activeLayers.length; iIndex++) {\r\n      oNewWMS.activeLayers.push(this.activeLayers[iIndex]);\r\n    }\r\n    return oNewWMS;\r\n  };\r\n\r\n  this.prepForExecution = function() {\r\n    // We dont need to do anything.\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.schema = {\r\n    \"title\": \"EMP-WMS Schema\",\r\n    \"type\": \"object\",\r\n    \"properties\": {\r\n      \"id\": {\r\n        \"type\": \"string\"\r\n      },\r\n      \"name\": {\r\n        \"type\": [\"string\", \"null\"]\r\n      },\r\n      \"overlayId\": {\r\n        \"type\": \"string\"\r\n      },\r\n      \"url\": {\r\n        \"type\": \"string\"\r\n      },\r\n      \"params\": {\r\n        \"type\": \"object\"\r\n      },\r\n      \"visible\": {\r\n        \"type\": \"boolean\"\r\n      },\r\n      \"disable\": {\r\n        \"type\": \"boolean\"\r\n      }\r\n    },\r\n    \"required\": [\"id\", \"url\"]\r\n  };\r\n};\r\n\r\nemp.typeLibrary.WMS.prototype.validate = emp.typeLibrary.base.validate;\r\n/*\r\nemp.typeLibrary.WMS.prototype.hasChildren = emp.typeLibrary.base.hasChildren;\r\nemp.typeLibrary.WMS.prototype.hasParents = emp.typeLibrary.base.hasParents;\r\nemp.typeLibrary.WMS.prototype.removeChild = emp.typeLibrary.base.removeChild;\r\nemp.typeLibrary.WMS.prototype.addParent = emp.typeLibrary.base.addParent;\r\nemp.typeLibrary.WMS.prototype.addChild = emp.typeLibrary.base.addChild;\r\nemp.typeLibrary.WMS.prototype.getChildrenCoreIds = emp.typeLibrary.base.getChildrenCoreIds;\r\nemp.typeLibrary.WMS.prototype.getParentCoreIds = emp.typeLibrary.base.getParentCoreIds;\r\nemp.typeLibrary.WMS.prototype.childrenCount = emp.typeLibrary.base.childrenCount;\r\nemp.typeLibrary.WMS.prototype.parentCount = emp.typeLibrary.base.parentCount;\r\nemp.typeLibrary.WMS.prototype.getChild = emp.typeLibrary.base.getChild;\r\nemp.typeLibrary.WMS.prototype.getParent = emp.typeLibrary.base.getParent;\r\nemp.typeLibrary.WMS.prototype.isMultiParentRequired = emp.typeLibrary.base.isMultiParentRequired;\r\nemp.typeLibrary.WMS.prototype.hasChildNodes = emp.typeLibrary.base.hasChildNodes;\r\nemp.typeLibrary.WMS.prototype.getChildNodesCoreIds = emp.typeLibrary.base.getChildNodesCoreIds;\r\nemp.typeLibrary.WMS.prototype.removeFromAllParent = emp.typeLibrary.base.removeFromAllParent;\r\nemp.typeLibrary.WMS.prototype.getVisibilityWithParent = emp.typeLibrary.base.getVisibilityWithParent;\r\nemp.typeLibrary.WMS.prototype.setVisibilityWithParent = emp.typeLibrary.base.setVisibilityWithParent;\r\nemp.typeLibrary.WMS.prototype.getRootParent = emp.typeLibrary.base.getRootParent;\r\nemp.typeLibrary.WMS.prototype.getVisibilityCount = emp.typeLibrary.base.getVisibilityCount;\r\nemp.typeLibrary.WMS.prototype.getRootCoreId = emp.typeLibrary.base.getRootCoreId;\r\nemp.typeLibrary.WMS.prototype.addAffectedChildren = emp.typeLibrary.base.addAffectedChildren;\r\nemp.typeLibrary.WMS.prototype.isVisible = emp.typeLibrary.base.isVisible;\r\nemp.typeLibrary.WMS.prototype.isUnderParent = emp.typeLibrary.base.isUnderParent;\r\nemp.typeLibrary.WMS.prototype.addToOverlayFeatureList = emp.typeLibrary.base.addToOverlayFeatureList;\r\nemp.typeLibrary.WMS.prototype.removeFromOverlayFeatureList = emp.typeLibrary.base.removeFromOverlayFeatureList;\r\nemp.typeLibrary.WMS.prototype.removeAllChildrenFromOverlayFeatureList = emp.typeLibrary.base.removeAllChildrenFromOverlayFeatureList;\r\nemp.typeLibrary.WMS.prototype.addAllChildrenToOverlayFeatureList = emp.typeLibrary.base.addAllChildrenToOverlayFeatureList;\r\nemp.typeLibrary.WMS.prototype.isVisibilityAffected = emp.typeLibrary.base.isVisibilityAffected;\r\nemp.typeLibrary.WMS.prototype.getVisibilitySettingWithParent = emp.typeLibrary.base.getVisibilitySettingWithParent;\r\n*/\r\n","/*global emp */\r\n\r\n/**\r\n * @class\r\n * @description This class defines a WMTS service. A map implementation should never create\r\n * an instance of this class.\r\n */\r\nemp.typeLibrary.WMTS = function(args) {\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains a readable name used to identify the service on the layers window.\r\n   */\r\n  this.name = args.name || \"\";\r\n\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the transaction ID the operation came under.\r\n   */\r\n  this.transactionId = args.transactionId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the message ID the operation came under.\r\n   */\r\n  this.messageId = args.messageId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {object}\r\n   * @description This field contains the service parameters to use for the WMS request.\r\n   */\r\n  this.params = args.params || {};\r\n\r\n\r\n  if (!this.params.hasOwnProperty('format')) {\r\n    this.params.format = escape(\"image/png\");\r\n  }\r\n  else if (typeof(this.params.format) !== \"string\") {\r\n    this.params.format = \"image/png\";\r\n  }\r\n\r\n  if (!this.params.hasOwnProperty('version')) {\r\n    this.params.version = \"1.0.0\";\r\n  } else if (typeof(this.params.version) !== \"string\") {\r\n    this.params.version = \"1.0.0\";\r\n  }\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unique identifier of the instance.\r\n   */\r\n  this.id = args.id;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string=}\r\n   * @description This optional field contains the unique identifier of the overlay\r\n   * the WMS service is to be created under.\r\n   */\r\n  this.overlayId = emp.helpers.id.get.setId(args.overlayId) || emp.constant.parentIds.MAP_LAYER_PARENT;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the primary key of the instance.\r\n   */\r\n  this.coreId = (function(args) {\r\n    if ((args.coreId !== undefined) && (args.coreId !== null)) {\r\n      return args.coreId;\r\n    }\r\n\r\n    return args.id;\r\n  })(args);\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the primary key of the parent object.\r\n   */\r\n  this.coreParent = args.coreParent || (function(args) {\r\n    if (emp.helpers.id.get.isId(args.overlayId)) {\r\n      return args.overlayId;\r\n    }\r\n    else if (emp.hasOwnProperty('storage')) {\r\n      return emp.storage.getRootGuid();\r\n    }\r\n\r\n    return undefined;\r\n  })(this);\r\n\r\n  this.parentCoreId = args.parentCoreId || this.coreParent;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unescaped URL of the WMS service.\r\n   */\r\n  this.url = args.url;\r\n\r\n  /**\r\n   * @field\r\n   * @type Boolean\r\n   * @description This property indicates if the request for the WMTS are issued\r\n   * via the proxy (if true,) or not (if false).\r\n   */\r\n  this.useProxy = args.useProxy;\r\n\r\n  // OverlayId is optional.  If no overlayId is provided for the WMS service\r\n  // It will be added to root\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.version = this.params.version || \"\";\r\n  // capabilities will only be provided for wms adds where no default layers are provided\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.format = this.params.format || \"image/png\";\r\n\r\n\r\n  this.layer = this.params.layer;\r\n\r\n  this.style = this.params.style;\r\n\r\n  this.sampleDimensions = this.params.sampleDimensions;\r\n\r\n  /**\r\n   * @field\r\n   * @type {boolean}\r\n   * @description This field indicates if the WMS as a whole should be made visible (TRUE) or hidden (FALSE).\r\n   * The map implementation must create the WMS service with the indicated visibility.\r\n   */\r\n  this.visible = args.visible;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.type = \"wmts\";\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.intent = args.intent || \"wmts.add\";\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.source = args.source;\r\n\r\n\r\n};\r\n","/*global emp */\r\n\r\n/**\r\n * @class\r\n * @description This class defines a KML link or KML data that is added to the map\r\n * as a map background. A map implementation should never create\r\n * an instance of this class.\r\n */\r\nemp.typeLibrary.KmlLayer = function(args) {\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains a readable name used to identify the service on the layers window.\r\n   */\r\n  this.name = args.name || \"\";\r\n\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the transaction ID the operation came under.\r\n   */\r\n  this.transactionId = args.transactionId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the message ID the operation came under.\r\n   */\r\n  this.messageId = args.messageId;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unique identifier of the instance.\r\n   */\r\n  this.id = args.id;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string=}\r\n   * @description This optional field contains the unique identifier of the overlay\r\n   * the KML service is to be created under.  By default this is the map layer\r\n   * parent.\r\n   */\r\n  this.overlayId = emp.helpers.id.get.setId(args.overlayId) || emp.constant.parentIds.MAP_LAYER_PARENT;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the primary key of the instance.\r\n   */\r\n  this.coreId = (function(args) {\r\n    if ((args.coreId !== undefined) && (args.coreId !== null)) {\r\n      return args.coreId;\r\n    }\r\n\r\n    return args.id;\r\n  })(args);\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the primary key of the parent object.\r\n   */\r\n  this.coreParent = args.coreParent || (function(args) {\r\n    if (emp.helpers.id.get.isId(args.overlayId)) {\r\n      return args.overlayId;\r\n    }\r\n    else if (emp.hasOwnProperty('storage')) {\r\n      return emp.storage.getRootGuid();\r\n    }\r\n\r\n    return undefined;\r\n  })(this);\r\n\r\n  this.parentCoreId = args.parentCoreId || this.coreParent;\r\n\r\n  /**\r\n   * @field\r\n   * @type {string}\r\n   * @description This field contains the unescaped URL of a KML or KMZ file.\r\n   */\r\n  this.url = args.url;\r\n\r\n  /**\r\n   * @field\r\n   * @type Boolean\r\n   * @description This property indicates if the request for the KML file is issued\r\n   * via the proxy (if true,) or not (if false).\r\n   */\r\n  this.useProxy = args.useProxy;\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.version = args.version || \"2.2\";\r\n  // capabilities will only be provided for wms adds where no default layers are provided\r\n\r\n\r\n  this.kmlData = args.kmlData || args.kmlData;\r\n\r\n  /**\r\n   * @field\r\n   * @type {boolean}\r\n   * @description This field indicates if the WMS as a whole should be made visible (TRUE) or hidden (FALSE).\r\n   * The map implementation must create the WMS service with the indicated visibility.\r\n   */\r\n  this.visible = args.visible;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.type = \"kml\";\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.intent = args.intent || \"kmllayer.add\";\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.source = args.source;\r\n\r\n\r\n};\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.ObjectRelationship#\r\n       * The visibilitySetting property contains an associative array keyed by\r\n       * mapInstanceId where each value is a boolean value indicating if\r\n       * the visibility setting of the object under the specified parent\r\n       * on the specific map instance.\r\n       *\r\n       * The visibleUnderParent property contains an associative array keyed by\r\n       * mapInstanceId where each value is a boolean value indicating if the\r\n       * child is visible or not due to the parent's visibility.\r\n       */\r\n      var options = {\r\n        parentStorageEntry: args.parentStorageEntry,\r\n        childStorageEntry: args.childStorageEntry,\r\n        visibilitySetting: {},\r\n        visibleUnderParent: {}\r\n      };\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getParent: function () {\r\n      return this.options.parentStorageEntry;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getChild: function () {\r\n      return this.options.childStorageEntry;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getParentCoreId: function () {\r\n      return this.options.parentStorageEntry.getCoreId();\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getChildCoreId: function () {\r\n      return this.options.childStorageEntry.getCoreId();\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getVisibilitySettingOnMap: function (mapInstanceId) {\r\n      return ((typeof this.options.visibilitySetting[mapInstanceId] === 'boolean') ? this.options.visibilitySetting[mapInstanceId] : false);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getVisibleUnderParentOnMap: function (mapInstanceId) {\r\n      return ((typeof this.options.visibleUnderParent[mapInstanceId] === 'boolean') ? this.options.visibleUnderParent[mapInstanceId] : false);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getVisibilityWithParent: function (mapInstanceId) {\r\n      return this.getVisibilitySettingOnMap(mapInstanceId) && this.getVisibleUnderParentOnMap(mapInstanceId);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    isOnMap: function (mapInstanceId) {\r\n      return this.options.visibilitySetting.hasOwnProperty(mapInstanceId);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    setVisibilitySettingOnMap: function (mapInstanceId, bVisibility) {\r\n      this.options.visibilitySetting[mapInstanceId] = bVisibility;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    setVisibleUnderParentOnMap: function (mapInstanceId, bVisibility) {\r\n      this.options.visibleUnderParent[mapInstanceId] = bVisibility;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    removeMapInstance: function (mapInstanceId) {\r\n      if (this.options.visibilitySetting.hasOwnProperty(mapInstanceId)) {\r\n        delete this.options.visibilitySetting[mapInstanceId];\r\n        delete this.options.visibleUnderParent[mapInstanceId];\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.ObjectRelationship#\r\n     */\r\n    getMapInstanceList: function () {\r\n      return emp.helpers.associativeArray.getKeys(this.options.visibilitySetting);\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n */\r\nemp.classLibrary.ObjectRelationship = emp.classLibrary.Class.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  return {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpObject#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpObject#\r\n       */\r\n      var options = {\r\n        coreObjectType: args.coreObjectType || args.globalType,\r\n        coreId: args.coreId || emp.helpers.id.newGUID()\r\n      };\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpObject#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpObject#\r\n     * @returns {emp.typeLibrary.types}\r\n     */\r\n    getCoreObjectType: function () {\r\n      return this.options.coreObjectType;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpObject#\r\n     * @returns {string} coreId of the object\r\n     */\r\n    getCoreId: function () {\r\n      return this.options.coreId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpObject#\r\n     */\r\n    prepForExecution: function () {\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * @constructor\r\n */\r\nemp.classLibrary.EmpObject = emp.classLibrary.Class.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpRenderableObject#\r\n       */\r\n      var options = {\r\n        name: args.name,\r\n        description: args.description,\r\n        disabled: (args.disabled === true) || false,\r\n        /**\r\n         * visibleOnMap contains an associative array keyed by map instance id.\r\n         * Each value is a boolean value indicating if the object is visible (= true)\r\n         * or not visible ( = false) on the specific map instance.\r\n         */\r\n        visibleOnMap: {},\r\n        /**\r\n         * parentObjects contains an associative array keyed by core id of this\r\n         * objects parents.\r\n         * Each value is an emp.classLibrary.ObjectRelationship object that defines the\r\n         * relationship with this object.\r\n         */\r\n        parentObjects: {},\r\n        /**\r\n         * childObjects contains an associative array keyed by core id of this objects children.\r\n         * Each value is a ref to the child object as it exists in storage.\r\n         */\r\n        childObjects: {},\r\n        properties: (args.properties ? emp.helpers.copyObject(args.properties) : {})\r\n      };\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n\r\n      if (this.options.properties.hasOwnProperty('readOnly')) {\r\n        this.options.properties.readOnly = (this.options.properties.readOnly === true);\r\n      }\r\n      else {\r\n        this.options.properties.readOnly = false;\r\n      }\r\n\r\n      emp.classLibrary.EmpObject.prototype.initialize.call(this, args);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getProperties: function () {\r\n      return this.options.properties;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setProperties: function (oValue) {\r\n      this.options.properties = oValue;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setPropertyValue: function (sProperty, Value) {\r\n      this.options.properties[sProperty] = Value;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setReadOnly: function (bValue) {\r\n      this.options.properties.readOnly = (bValue === true);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    isReadOnly: function () {\r\n      return this.options.properties.readOnly;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    isDisabled: function () {\r\n      return this.options.disabled;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setDisabled: function (bValue) {\r\n      this.options.disabled = (bValue === true);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    removeFromMap: function (mapInstanceId) {\r\n      if (this.options.visibleOnMap.hasOwnProperty(mapInstanceId)) {\r\n        delete this.options.visibleOnMap[mapInstanceId];\r\n        this.removeObjectFromMapRoot(mapInstanceId);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getMapInstanceList: function () {\r\n      return emp.helpers.associativeArray.getKeys(this.options.visibleOnMap);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getParentRelationshipList: function () {\r\n      return this.options.parentObjects;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getChildrenList: function () {\r\n      return this.options.childObjects;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getParentRelationship: function (parentCoreId) {\r\n      return this.options.parentObjects[parentCoreId];\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getName: function () {\r\n      return this.options.name;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setName: function (sName) {\r\n      if (!emp.helpers.isEmptyString(sName)) {\r\n        this.options.name = sName;\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getDescription: function () {\r\n      return this.options.description;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setDescription: function (sDesc) {\r\n      if (!emp.helpers.isEmptyString(sDesc)) {\r\n        this.options.description = sDesc;\r\n      }\r\n    },\r\n    /**\r\n     * @private\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function must be override by all sub classes. It is\r\n     * called to generate an object suitable for the map engines to consume.\r\n     * I.E. emp.classLibrary.EmpOverlay should return an {@link emp.typeLibrary.Overlay} object.\r\n     */\r\n    getObjectData: function () {\r\n      return {};\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    isVisibleOnMap: function (mapInstanceId) {\r\n      return ((typeof this.options.visibleOnMap[mapInstanceId] === 'boolean') ? this.options.visibleOnMap[mapInstanceId] : false);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setVisibleOnMap: function (mapInstanceId, bVisible) {\r\n      this.options.visibleOnMap[mapInstanceId] = bVisible;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    isOnMap: function (mapInstanceId) {\r\n      return this.options.visibleOnMap.hasOwnProperty(mapInstanceId);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @returns {number}\r\n     */\r\n    getVisibilityCount: function (mapInstanceId) {\r\n      var iCount = 0;\r\n      var oRelationship;\r\n      var sCoreId;\r\n\r\n      for (sCoreId in this.options.parentObjects) {\r\n        if (!this.options.parentObjects.hasOwnProperty(sCoreId)) {\r\n          continue;\r\n        }\r\n        oRelationship = this.options.parentObjects[sCoreId];\r\n\r\n        if (oRelationship.getVisibilityWithParent(mapInstanceId)) {\r\n          iCount++;\r\n        }\r\n      }\r\n\r\n      return iCount;\r\n    },\r\n    /**\r\n     * @private\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function checks to see if the visibility of an object\r\n     * on a specific map is affected if the visibility of the parent identified by\r\n     * sParentCoreId is set to bVisible.\r\n     * @param {string} mapInstanceId The is of the map instance.\r\n     * @param {string} sParentCoreId The parents coreId.\r\n     * @param {boolean} bVisible The new visible setting of the relationship.\r\n     */\r\n    isVisibilityAffected: function (mapInstanceId, sParentCoreId, bVisible) {\r\n      var oRelationship;\r\n      var bSend = false;\r\n      var iPrevVisibilityCount = this.getVisibilityCount(mapInstanceId);\r\n\r\n      if (!this.options.parentObjects.hasOwnProperty(sParentCoreId)) {\r\n        return bSend;\r\n      }\r\n      oRelationship = this.options.parentObjects[sParentCoreId];\r\n\r\n      if ((iPrevVisibilityCount === 1)\r\n        && !bVisible\r\n        && oRelationship.getVisibleUnderParentOnMap(mapInstanceId)) {\r\n        // There is only one visible\r\n        // and we are turning off visibility\r\n        // and this is the one that is on.\r\n        // We send it.\r\n        bSend = true;\r\n      } else if ((iPrevVisibilityCount === 0)\r\n        && bVisible\r\n        && oRelationship.getVisibilitySettingOnMap(mapInstanceId)) {\r\n        // There are none visible\r\n        // and we are turing the it on,\r\n        // and the parent has at least one ancestor on.\r\n        // and the current setting is off.\r\n        // Send it.\r\n        bSend = true;\r\n      } else if (!bVisible\r\n        && oRelationship.getVisibleUnderParentOnMap(mapInstanceId)) {\r\n        // Its parent is being turn off and this one is on.\r\n        // We must turn it off but not send it.\r\n        oRelationship.setVisibleUnderParentOnMap(mapInstanceId, bVisible);\r\n      } else if (bVisible\r\n        && !oRelationship.getVisibleUnderParentOnMap(mapInstanceId)\r\n        && oRelationship.getVisibilitySettingOnMap(mapInstanceId)) {\r\n        // Its parent is being turn on and this one is off.\r\n        // But the user wants it on.\r\n        // We must turn it on but not send it.\r\n        oRelationship.setVisibleUnderParentOnMap(mapInstanceId, bVisible);\r\n      }\r\n\r\n      if (bSend) {\r\n        oRelationship.setVisibleUnderParentOnMap(mapInstanceId, bVisible);\r\n        this.setVisibleOnMap(mapInstanceId, bVisible);\r\n      }\r\n\r\n      return bSend;\r\n    },\r\n    /**\r\n     * @private\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function goes thru all the objects children and finds\r\n     * all the objects that are affected by its change of visibility.\r\n     * All those affected are added to the transaction items.\r\n     * @param {boolean} bVisible\r\n     * @param {emp.typeLibrary.Transaction} oTransaction\r\n     */\r\n    addAffectedChildren: function (oTransaction, bVisible) {\r\n      var sChildCoreId;\r\n      var oChild;\r\n      var oDupChild;\r\n      var mapInstanceId = oTransaction.mapInstanceId;\r\n      var oaItems = oTransaction.items;\r\n      var bAffected = false;\r\n\r\n\r\n      for (sChildCoreId in this.options.childObjects) {\r\n        if (!this.options.childObjects.hasOwnProperty(sChildCoreId)) {\r\n          continue;\r\n        }\r\n        oChild = this.options.childObjects[sChildCoreId];\r\n        if (oTransaction.isOnItemsList({coreId: oChild.getCoreId()})) {\r\n          // Its on the list already. Skip it.\r\n          continue;\r\n        }\r\n\r\n        bAffected = oChild.isVisibilityAffected(mapInstanceId, this.getCoreId(), bVisible);\r\n\r\n        if (bAffected) {\r\n          oDupChild = oChild.getObjectData(mapInstanceId, this.getCoreId());\r\n          oDupChild.coreParent = this.getCoreId();\r\n          oDupChild.parentCoreId = mapInstanceId;\r\n          oaItems.push(oDupChild);\r\n\r\n          switch (oChild.getCoreObjectType()) {\r\n            case emp.typeLibrary.types.OVERLAY:\r\n              // Emp V3 does not send overlays to the maps.\r\n              // So we must put it on the dup list.\r\n              oTransaction.duplicate(oChild.getCoreId());\r\n              break;\r\n            case emp.typeLibrary.types.WMS:\r\n              if (!bVisible) {\r\n                // Its being turn off and its a WMS.\r\n                // We must clear out the active layer list.\r\n                oDupChild.activeLayers = [];\r\n              }\r\n              break;\r\n            default:\r\n              //everything else gets sent to the map engine.\r\n              break;\r\n          }\r\n\r\n          oChild.addAffectedChildren(oTransaction, bVisible);\r\n        } else if (bVisible && oChild.getVisibilityWithParent(this.getCoreId())) {\r\n          oChild.addAffectedChildren(oTransaction, bVisible);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @desc designed as a fast way for DE or SE to flip visibility.\r\n     * @param {string} sParentCoreId - The coreId of the parent the visibility is being set.\r\n     * @param {emp.typeLibrary.Transaction} oTransaction This parameters must be a transaction.\r\n     * @param {boolean} bVisible - Visibility Flag\r\n     * @param {boolean} bGoDeep - True if the visibility should affect children.\r\n     * @return {void}\r\n     */\r\n    visibility: function (oTransaction, sParentCoreId, bVisible, bGoDeep) {\r\n      var oItem,\r\n        mapInstanceId = oTransaction.mapInstanceId,\r\n        oaItems = oTransaction.items;\r\n\r\n      switch (this.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.OVERLAY:\r\n        case emp.typeLibrary.types.FEATURE:\r\n        case emp.typeLibrary.types.STATIC:\r\n        case emp.typeLibrary.types.WMS:\r\n          break;\r\n        default:\r\n          // visibility called on wrong object\r\n          emp.errorHandler.log(emp.typeLibrary.Error({\r\n            level: 1,\r\n            message: \"Visibility called on incompatible object\",\r\n            jsError: \"\",\r\n            coreId: this.getCoreId()\r\n          }));\r\n          return;\r\n      }\r\n\r\n      if (typeof bVisible !== 'boolean') {\r\n        // It must be true or false.\r\n        return;\r\n      }\r\n\r\n      if (this.setVisibilityWithParent(mapInstanceId, sParentCoreId, bVisible)) {\r\n        oItem = this.getObjectData(mapInstanceId, sParentCoreId);\r\n        oItem.visible = bVisible;\r\n        oaItems.push(oItem);\r\n\r\n        switch (this.getCoreObjectType()) {\r\n          case emp.typeLibrary.types.OVERLAY:\r\n            // Emp V3 does not send overlays to the maps.\r\n            // So we must put it on the dup list.\r\n            oTransaction.duplicate(this.getCoreId());\r\n            break;\r\n          case emp.typeLibrary.types.STATIC:\r\n            oItem.parentCoreId = sParentCoreId;\r\n            break;\r\n          default:\r\n            //oItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n            //everything else gets sent to the map engine.\r\n            break;\r\n        }\r\n\r\n        if (bGoDeep) {\r\n          this.addAffectedChildren(oTransaction, bVisible);\r\n        }\r\n      } else {\r\n        // This is not being sent so we add it and dump it to the duplicates.\r\n        oItem = this.getObjectData(mapInstanceId, sParentCoreId);\r\n        oItem.visible = bVisible;\r\n        switch (this.getCoreObjectType()) {\r\n          case emp.typeLibrary.types.OVERLAY:\r\n          case emp.typeLibrary.types.STATIC:\r\n            oItem.parentCoreId = sParentCoreId;\r\n            break;\r\n          default:\r\n            oItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n            //everything else gets sent to the map engine.\r\n            break;\r\n        }\r\n        oaItems.push(oItem);\r\n        oTransaction.duplicate(this.getCoreId());\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    locate: function (args) {\r\n      var transaction,\r\n        oMapExtent,\r\n        payload,\r\n        sCoreId,\r\n        oChild;\r\n\r\n      switch (this.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.FEATURE:\r\n        case emp.typeLibrary.types.OVERLAY:\r\n          break;\r\n        default:\r\n          // We can only locate features and overlays.\r\n          return;\r\n      }\r\n\r\n      args = args || {};\r\n      args.component = args.component || \"\";\r\n\r\n      payload = {\r\n        zoom: true,\r\n        visible: true\r\n      };\r\n\r\n      switch (this.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.FEATURE:\r\n          if (this.childrenCount() > 0) {\r\n            // This feature has children so get the extents.\r\n            oMapExtent = this.getMapExtent();\r\n          }\r\n          if (oMapExtent && !oMapExtent.isEmpty()) {\r\n            payload.bounds = {\r\n              west: oMapExtent.getWest(),\r\n              east: oMapExtent.getEast(),\r\n              south: oMapExtent.getSouth(),\r\n              north: oMapExtent.getNorth()\r\n            };\r\n          } else {\r\n            payload.featureId = this.getFeatureId();\r\n            payload.coreId = this.getCoreId();\r\n          }\r\n          break;\r\n        case emp.typeLibrary.types.OVERLAY:\r\n          switch (this.childrenCount()) {\r\n            case 0:\r\n              // This overlay has no children.\r\n              return;\r\n            case 1:\r\n              // This overlay has only 1 child.\r\n              // So run the locate on that child.\r\n              sCoreId = this.getChildrenCoreIds()[0];\r\n              oChild = this.getChild(sCoreId);\r\n              return oChild.locate(args);\r\n            default:\r\n              oMapExtent = this.getMapExtent();\r\n              break;\r\n          }\r\n\r\n          if (oMapExtent && !oMapExtent.isEmpty()) {\r\n            payload.bounds = {\r\n              west: oMapExtent.getWest(),\r\n              east: oMapExtent.getEast(),\r\n              south: oMapExtent.getSouth(),\r\n              north: oMapExtent.getNorth()\r\n            };\r\n          } else {\r\n            return;\r\n          }\r\n          break;\r\n      }\r\n\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.VIEW_SET,\r\n        mapInstanceId: args.mapInstanceId,\r\n        source: emp.core.sources.CORE,\r\n        items: [new emp.typeLibrary.View(payload)]\r\n      });\r\n      if (args.component === \"de\") {\r\n        transaction.run();\r\n      } else {\r\n        return transaction;\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getRootCoreId: function (mapInstanceId) {\r\n      return mapInstanceId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getRootParent: function (mapInstanceId) {\r\n      var oRootCoreId = this.getRootCoreId(mapInstanceId);\r\n      return emp.storage.get.id({\r\n        id: oRootCoreId\r\n      });\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    hasChildren: function () {\r\n      return !emp.helpers.associativeArray.isEmpty(this.options.childObjects);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    hasParents: function () {\r\n      return !emp.helpers.associativeArray.isEmpty(this.options.parentObjects);\r\n    },\r\n    /**\r\n     * @description This function removes this object from all of its parents.\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    removeFromAllParent: function () {\r\n      var iIndex;\r\n      var oParent;\r\n      var aParentCoreIdList = this.getParentCoreIds();\r\n\r\n      // Go thru all the parents and remove this object.\r\n      for (iIndex = 0; iIndex < aParentCoreIdList.length; iIndex++) {\r\n        oParent = this.getParent(aParentCoreIdList[iIndex]);\r\n        oParent.removeChild(this);\r\n      }\r\n    },\r\n    /**\r\n     * This function checks to see if this is a descendant of the object identified by the given coreId\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @param {string} sCoreId\r\n     */\r\n    isDescendantOf: function (sCoreId) {\r\n      var oRelationship;\r\n      var sParentCoreId;\r\n      var bRet = false;\r\n\r\n      if (this.getCoreId() === sCoreId) {\r\n        bRet = true;\r\n      }\r\n      else {\r\n        for (sParentCoreId in this.options.parentObjects) {\r\n          if (!this.options.parentObjects.hasOwnProperty(sParentCoreId)) {\r\n            continue;\r\n          }\r\n          oRelationship = this.options.parentObjects[sParentCoreId];\r\n          if (oRelationship.getParent().isDescendantOf(sCoreId)) {\r\n            bRet = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      return bRet;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function checks if the object identified by coreId\r\n     * is in the parent object list of this object.\r\n     * @param {string} coreId\r\n     */\r\n    isChildOf: function (coreId) {\r\n      return this.options.parentObjects.hasOwnProperty(coreId);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function checks if the object identified by coreId\r\n     * is in the child object list of this object.\r\n     * @param {string} coreId\r\n     */\r\n    isParentOf: function (coreId) {\r\n      return this.options.childObjects.hasOwnProperty(coreId);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function returns an array containing all (distinct) map instance id's\r\n     * that its parents are on.\r\n     */\r\n    getParentMapInstanceList: function () {\r\n      var aMapList;\r\n      var iIndex;\r\n      var parentCoreId;\r\n      var aRetList = [];\r\n      var oRelationship;\r\n      var oParentRelationshipList = this.getParentRelationshipList();\r\n\r\n      for (parentCoreId in oParentRelationshipList) {\r\n\r\n        // Go thru all its parent relationships.\r\n        if (!oParentRelationshipList.hasOwnProperty(parentCoreId)) {\r\n          continue;\r\n        }\r\n\r\n        oRelationship = oParentRelationshipList[parentCoreId];\r\n\r\n        // Get the map instance list of the relationship.\r\n        aMapList = oRelationship.getMapInstanceList();\r\n\r\n        for (iIndex = 0; iIndex < aMapList.length; iIndex++) {\r\n          // If the map instance id is not on the return list add it.\r\n          if (aRetList.indexOf(aMapList[iIndex]) === -1) {\r\n            aRetList.push(aMapList[iIndex]);\r\n          }\r\n        }\r\n      }\r\n\r\n      // if we didn't find a map that it's on, the parent my be\r\n      // a root.   Check to find out which map this root is on.\r\n      if (aRetList.length === 0) {\r\n        var mapInstanceId = emp.storage.isRoot(this.getCoreId());\r\n\r\n        if (mapInstanceId) {\r\n          aRetList.push(mapInstanceId);\r\n        }\r\n      }\r\n\r\n      return aRetList;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    removeMapInstanceFromRelationship: function (oParent, mapInstanceId) {\r\n      var oChild;\r\n      var sCoreId;\r\n      var aParentMapList;\r\n      var oRelationship = this.getParentRelationship(oParent.getCoreId());\r\n\r\n      if (oRelationship) {\r\n        oRelationship.removeMapInstance(mapInstanceId);\r\n      }\r\n\r\n      // Get the list of map all the parents are on.\r\n      aParentMapList = this.getParentMapInstanceList();\r\n      if (aParentMapList.indexOf(mapInstanceId) === -1) {\r\n        // This object is no longer on the map with Id = mapInstanceId.\r\n        this.removeFromMap(mapInstanceId);\r\n\r\n        if (this.hasChildren()) {\r\n          for (sCoreId in this.options.childObjects) {\r\n            if (!this.options.childObjects.hasOwnProperty(sCoreId)) {\r\n              continue;\r\n            }\r\n            oChild = this.options.childObjects[sCoreId];\r\n            oChild.removeMapInstanceFromRelationship(this, mapInstanceId);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    deleteParentEntry: function (parentCoreId) {\r\n      var oChild;\r\n      var sCoreId;\r\n      //var oParentRelationship;\r\n      //var oParent;\r\n      var iIndex;\r\n      var aPrevMapList;\r\n      var aNewMapList;\r\n\r\n      if (this.isChildOf(parentCoreId)) {\r\n        // First find the relationship.\r\n        //oParentRelationship = this.getParentRelationship(parentCoreId);\r\n        //oParent = oParentRelationship.getParent();\r\n        // Get The list of maps all the parents are on.\r\n        aPrevMapList = this.getParentMapInstanceList();\r\n        // Now remove this relationship.\r\n        delete this.options.parentObjects[parentCoreId];\r\n        // Now get the maps the remaining parents are on.\r\n        aNewMapList = this.getParentMapInstanceList();\r\n\r\n        if (aPrevMapList.length !== aNewMapList.length) {\r\n          // The list are of diff length, so\r\n          // The new one should be smaller.\r\n          for (iIndex = 0; iIndex < aPrevMapList.length; iIndex++) {\r\n            // Find the map the object is no longer on.\r\n            if (aNewMapList.indexOf(aPrevMapList[iIndex]) === -1) {\r\n              // This is a map instance that this object is no longer on.\r\n              this.removeFromMap(aPrevMapList[iIndex]);\r\n              for (sCoreId in this.options.childObjects) {\r\n                if (!this.options.childObjects.hasOwnProperty(sCoreId)) {\r\n                  continue;\r\n                }\r\n                oChild = this.options.childObjects[sCoreId];\r\n                oChild.removeMapInstanceFromRelationship(this, aPrevMapList[iIndex]);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    deleteChildEntry: function (childCoreId) {\r\n      if (this.isParentOf(childCoreId)) {\r\n        delete this.options.childObjects[childCoreId];\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    removeChild: function (oChild) {\r\n      if (this.isParentOf(oChild.getCoreId())) {\r\n        //oChild.removeFromOverlayFeatureList(this);\r\n\r\n        // Delete the parent from the childs parent list.\r\n        oChild.deleteParentEntry(this.getCoreId());\r\n\r\n        // Now delete the child from the parents child list.\r\n        this.deleteChildEntry(oChild.getCoreId());\r\n      }\r\n    },\r\n    // /**\r\n    //  * @description This function removes the feature from its closest parent\r\n    //  * overlay feature list.\r\n    //  *\r\n    //  * @param {emp.classLibrary.EmpRenderableObject} oParent\r\n    //  */\r\n    // removeFromOverlayFeatureList: function (oParent) {\r\n    //   var oCurrentParent;\r\n    //   var sParentCoreId;\r\n    //   var oParentParentList;\r\n    //\r\n    //   if ((this.getCoreObjectType() === emp.typeLibrary.types.FEATURE)\r\n    //     || (this.getCoreObjectType() === emp.typeLibrary.types.WMS)) {\r\n    //     if (oParent.getCoreObjectType() === emp.typeLibrary.types.OVERLAY) {\r\n    //       // Its an overlay so remove it.\r\n    //       oParent.removeFromFeatureList(this);\r\n    //       this.removeAllChildrenFromOverlayFeatureList(oParent);\r\n    //     }\r\n    //     else {\r\n    //       oParentParentList = oParent.getParentRelationshipList();\r\n    //\r\n    //       for (sParentCoreId in oParentParentList) {\r\n    //         if (oParentParentList.hasOwnProperty(sParentCoreId)) {\r\n    //           oCurrentParent = oParentParentList[sParentCoreId].parent;\r\n    //           this.removeFromOverlayFeatureList(oCurrentParent);\r\n    //         }\r\n    //       }\r\n    //     }\r\n    //   }\r\n    // },\r\n    // /**\r\n    //  * @description This function removes all this feature children from\r\n    //  * the overlay's feature list.\r\n    //  *\r\n    //  * @param {emp.classLibrary.EmpOverlay} oOverlay\r\n    //  */\r\n    // removeAllChildrenFromOverlayFeatureList: function (oOverlay) {\r\n    //   var oChild;\r\n    //   var sCoreId;\r\n    //   var oChildList;\r\n    //\r\n    //   if ((this.getCoreObjectType() !== emp.typeLibrary.types.FEATURE)\r\n    //     && (this.getCoreObjectType() !== emp.typeLibrary.types.WMS)) {\r\n    //     return;\r\n    //   }\r\n    //\r\n    //   oChildList = this.getChildrenList();\r\n    //   for (sCoreId in oChildList) {\r\n    //     if (oChildList.hasOwnProperty(sCoreId)) {\r\n    //       oChild = oChildList[sCoreId];\r\n    //       oChild.removeAllChildrenFromOverlayFeatureList(oOverlay);\r\n    //       oOverlay.removeFromFeatureList(oChild);\r\n    //     }\r\n    //   }\r\n    // },\r\n    // addAllChildrenToOverlayFeatureList: function (oOverlay) {\r\n    //   var oChild;\r\n    //   var sCoreId;\r\n    //   var oChildList;\r\n    //\r\n    //   if ((this.getCoreObjectType() !== emp.typeLibrary.types.FEATURE)\r\n    //     && (this.getCoreObjectType() !== emp.typeLibrary.types.WMS)) {\r\n    //     return;\r\n    //   }\r\n    //\r\n    //   oChildList = this.getChildrenList();\r\n    //   for (sCoreId in oChildList) {\r\n    //     if (oChildList.hasOwnProperty(sCoreId)) {\r\n    //       oChild = oChildList[sCoreId];\r\n    //\r\n    //       if (!oOverlay.isOnFeatureList(oChild)) {\r\n    //         oOverlay.addToFeatureList(oChild);\r\n    //         oChild.addAllChildrenToOverlayFeatureList(oOverlay);\r\n    //       }\r\n    //     }\r\n    //   }\r\n    // },\r\n    // addToOverlayFeatureList: function (oParent) {\r\n    //   var oCurrentParent;\r\n    //   var sParentCoreId;\r\n    //   var oParentParentList;\r\n    //\r\n    //   if ((this.getCoreObjectType() === emp.typeLibrary.types.FEATURE)\r\n    //     || (this.getCoreObjectType() === emp.typeLibrary.types.WMS)) {\r\n    //     if (oParent.getCoreObjectType() === emp.typeLibrary.types.OVERLAY) {\r\n    //       oParent.addToFeatureList(this);\r\n    //       this.addAllChildrenToOverlayFeatureList(oParent);\r\n    //     }\r\n    //     else {\r\n    //       oParentParentList = oParent.getParentRelationshipList();\r\n    //       for (sParentCoreId in oParentParentList) {\r\n    //         if (oParentParentList.hasOwnProperty(sParentCoreId)) {\r\n    //           oCurrentParent = oParentParentList[sParentCoreId].parent;\r\n    //\r\n    //           if (oCurrentParent.getCoreObjectType() !== emp.typeLibrary.types.OVERLAY) {\r\n    //             // This parent is not an overlay, keep going up.\r\n    //             this.addToOverlayFeatureList(oCurrentParent);\r\n    //           } else {\r\n    //             // This one is an overlay so add it.\r\n    //             oCurrentParent.addToFeatureList(this);\r\n    //             this.addAllChildrenToOverlayFeatureList(oCurrentParent);\r\n    //           }\r\n    //         }\r\n    //       }\r\n    //     }\r\n    //   }\r\n    // },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    removeObjectFromMapRoot: function (mapInstanceId) {\r\n      var rootCoreId;\r\n      var oRootOverlay;\r\n\r\n      // Now features and WMS need to be added to the map instances root overlay.\r\n      switch (this.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.FEATURE:\r\n        case emp.typeLibrary.types.WMS:\r\n          rootCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n          oRootOverlay = emp.storage.findOverlay(rootCoreId);\r\n\r\n          if (oRootOverlay === undefined) {\r\n            new emp.typeLibrary.Error({\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: 'removeObjectFromMapRoot: Root overlay for map instance not found.'\r\n            });\r\n            return;\r\n          }\r\n\r\n          oRootOverlay.removeFromFeatureList(this);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    addObjectToMapRoot: function (mapInstanceId) {\r\n      var rootCoreId;\r\n      var oRootOverlay;\r\n\r\n      // Now features and WMS need to be added to the map instances root overlay.\r\n      switch (this.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.FEATURE:\r\n        case emp.typeLibrary.types.WMS:\r\n          rootCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n          oRootOverlay = emp.storage.findOverlay(rootCoreId);\r\n\r\n          if (oRootOverlay === undefined) {\r\n            new emp.typeLibrary.Error({\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: 'addObjectToMapRoot: Root overlay for map instance not found.'\r\n            });\r\n            return;\r\n          }\r\n\r\n          oRootOverlay.addToFeatureList(this);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @param oParent\r\n     * @param mapInstanceId\r\n     * @param bParentVisible\r\n     * @param bVisibleSetting\r\n     */\r\n    addMapInstanceToRelationship: function (oParent, mapInstanceId, bParentVisible, bVisibleSetting) {\r\n      var oChild;\r\n      var sCoreId;\r\n      var oRelationship = this.options.parentObjects[oParent.getCoreId()];\r\n\r\n      if (oRelationship) {\r\n        this.options.visibleOnMap[mapInstanceId] = bParentVisible && bVisibleSetting;\r\n        oRelationship.setVisibilitySettingOnMap(mapInstanceId, bVisibleSetting);\r\n        oRelationship.setVisibleUnderParentOnMap(mapInstanceId, bParentVisible);\r\n\r\n        this.addObjectToMapRoot(mapInstanceId);\r\n      }\r\n\r\n      if (this.hasChildren()) {\r\n        for (sCoreId in this.options.childObjects) {\r\n          if (!this.options.childObjects.hasOwnProperty(sCoreId)) {\r\n            continue;\r\n          }\r\n          oChild = this.options.childObjects[sCoreId];\r\n          oChild.addMapInstanceToRelationship(this, mapInstanceId, bParentVisible, bVisibleSetting);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @description This function add this object as a child of oParent.\r\n     * @param {emp.classLibrary.EmpRenderableObject} oParent\r\n     * @param {boolean} bVisibleSetting\r\n     */\r\n    addParent: function (oParent, bVisibleSetting) {\r\n      var oRelationship;\r\n      var oMapList;\r\n      var iIndex;\r\n      var bParentVisible;\r\n      var oChild;\r\n      var sCoreId;\r\n\r\n      if (!this.isChildOf(oParent.getCoreId())) {\r\n        oRelationship = new emp.classLibrary.ObjectRelationship({\r\n          parentStorageEntry: oParent,\r\n          childStorageEntry: this\r\n        });\r\n\r\n        oMapList = oParent.getMapInstanceList();\r\n\r\n        for (iIndex = 0; iIndex < oMapList.length; iIndex++) {\r\n          bParentVisible = oParent.isVisibleOnMap(oMapList[iIndex]);\r\n          this.setVisibleOnMap(oMapList[iIndex], bParentVisible && bVisibleSetting);\r\n          oRelationship.setVisibilitySettingOnMap(oMapList[iIndex], bVisibleSetting);\r\n          oRelationship.setVisibleUnderParentOnMap(oMapList[iIndex], bParentVisible);\r\n\r\n          this.addObjectToMapRoot(oMapList[iIndex]);\r\n\r\n          for (sCoreId in this.options.childObjects) {\r\n            if (!this.options.childObjects.hasOwnProperty(sCoreId)) {\r\n              continue;\r\n            }\r\n            oChild = this.options.childObjects[sCoreId];\r\n            oChild.addMapInstanceToRelationship(this, oMapList[iIndex], bParentVisible, bVisibleSetting);\r\n          }\r\n        }\r\n\r\n        this.options.parentObjects[oParent.getCoreId()] = oRelationship;\r\n        oParent.addChild(this, bVisibleSetting);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @param {emp.classLibrary.EmpRenderableObject} oChild\r\n     * @param {boolean} bVisibleSetting\r\n     */\r\n    addChild: function (oChild, bVisibleSetting) {\r\n      if (!this.isParentOf(oChild.getCoreId())) {\r\n        // Add it.\r\n        this.options.childObjects[oChild.getCoreId()] = oChild;\r\n        oChild.addParent(this, bVisibleSetting);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getAllFeatureChildren: function (oRetAssoArray) {\r\n      var oAssoArray = oRetAssoArray || {};\r\n      var sCoreId;\r\n\r\n      for (sCoreId in this.options.childObjects) {\r\n        if (this.options.childObjects.hasOwnProperty(sCoreId)) {\r\n          if (this.options.childObjects[sCoreId].getCoreObjectType() !== emp.typeLibrary.types.OVERLAY) {\r\n            oAssoArray[sCoreId] = this.options.childObjects[sCoreId];\r\n          }\r\n          this.options.childObjects[sCoreId].getAllFeatureChildren(oAssoArray);\r\n        }\r\n      }\r\n\r\n      return oAssoArray;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @returns {string[]}\r\n     */\r\n    getChildrenCoreIds: function () {\r\n      return emp.helpers.associativeArray.getKeys(this.options.childObjects);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @returns {string[]}\r\n     */\r\n    getParentCoreIds: function () {\r\n      return emp.helpers.associativeArray.getKeys(this.options.parentObjects);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getParentCoreIdsOnMap: function (sMapInstanceId) {\r\n      var aParentCoreIds = [];\r\n      var sParentCoreId;\r\n      var oRelationship;\r\n\r\n      for (sParentCoreId in this.options.parentObjects) {\r\n        if (!this.options.parentObjects.hasOwnProperty(sParentCoreId)) {\r\n          continue;\r\n        }\r\n\r\n        oRelationship = this.options.parentObjects[sParentCoreId];\r\n        if (oRelationship.isOnMap(sMapInstanceId)) {\r\n          aParentCoreIds.push(sParentCoreId);\r\n        }\r\n      }\r\n      return aParentCoreIds;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @return {number}\r\n     */\r\n    mapCount: function () {\r\n      return emp.helpers.associativeArray.size(this.options.visibleOnMap);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @return {number}\r\n     */\r\n    childrenCount: function () {\r\n      return emp.helpers.associativeArray.size(this.options.childObjects);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @return {number}\r\n     */\r\n    parentCount: function () {\r\n      return emp.helpers.associativeArray.size(this.options.parentObjects);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getChild: function (sCoreId) {\r\n      return this.options.childObjects[sCoreId];\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getParent: function (sCoreId) {\r\n      if (this.options.parentObjects.hasOwnProperty(sCoreId)) {\r\n        return this.options.parentObjects[sCoreId].getParent();\r\n      }\r\n      return undefined;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getParentByIndex: function (iIndex) {\r\n      var aCoreIds = this.getParentCoreIds();\r\n\r\n      if (aCoreIds.length > iIndex) {\r\n        return this.getParent(aCoreIds[iIndex]);\r\n      }\r\n      return undefined;\r\n    },\r\n    /*\r\n     hasChildNodes: function()\r\n     {\r\n     return !emp.helpers.associativeArray.isEmpty(this.childNodes);\r\n     },\r\n     getChildNodesCoreIds: function()\r\n     {\r\n     return emp.helpers.associativeArray.getKeys(this.childNodes);\r\n     },\r\n     */\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getVisibilitySettingWithParent: function (mapInstanceId, sParentCodeId) {\r\n      var sParentID = (sParentCodeId ? sParentCodeId : emp.storage.getRootGuid(mapInstanceId));\r\n\r\n      if (this.isChildOf(sParentID)) {\r\n        return this.getParentRelationship(sParentID).getVisibilitySettingOnMap(mapInstanceId);\r\n      }\r\n\r\n      return false;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getVisibilityWithParent: function (mapInstanceId, sParentCodeId) {\r\n      var sParentID = (sParentCodeId ? sParentCodeId : emp.storage.getRootGuid(mapInstanceId));\r\n\r\n      if (this.isChildOf(sParentID)) {\r\n        return this.getParentRelationship(sParentID).getVisibleUnderParentOnMap(mapInstanceId);\r\n      }\r\n\r\n      return false;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    setVisibilityWithParent: function (mapInstanceId, sParentCodeId, bSetting) {\r\n      var iCurrentVisibilityCount;\r\n      var oRelationship;\r\n      var sParentID = (sParentCodeId ? sParentCodeId : emp.storage.getRootGuid(mapInstanceId));\r\n      var bSend = false;\r\n      var iPrevVisibilityCount = this.getVisibilityCount(mapInstanceId);\r\n\r\n      if (this.isChildOf(sParentID)) {\r\n        oRelationship = this.getParentRelationship(sParentID);\r\n        oRelationship.setVisibleUnderParentOnMap(mapInstanceId, bSetting);\r\n        oRelationship.setVisibilitySettingOnMap(mapInstanceId, bSetting);\r\n      }\r\n\r\n      iCurrentVisibilityCount = this.getVisibilityCount(mapInstanceId);\r\n\r\n      if (bSetting\r\n        && (iPrevVisibilityCount === 0)\r\n        && (iCurrentVisibilityCount === 1)) {\r\n        // This is the first visibility sent to the object\r\n        bSend = true;\r\n      }\r\n      else if (!bSetting\r\n        && (iPrevVisibilityCount === 1)\r\n        && (iCurrentVisibilityCount === 0)) {\r\n        // This is the last visibility hide sent to the object.\r\n        bSend = true;\r\n      }\r\n\r\n      if (bSend) {\r\n        this.setVisibleOnMap(mapInstanceId, bSetting);\r\n      }\r\n      return bSend;\r\n    },\r\n    /**\r\n     * @description This function traverses all parents looking for at least\r\n     * one path to the root that is totally visible.\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     * @returns {Boolean}\r\n     */\r\n    isVisible: function (mapInstanceId) {\r\n      var sCoreId;\r\n      var oParent;\r\n      var oParentRelationshipList = this.getParentRelationshipList();\r\n      var bRet = false;\r\n\r\n      if (this.getCoreId() === emp.storage.getRootGuid(mapInstanceId)) {\r\n        return true;\r\n      }\r\n\r\n      for (sCoreId in oParentRelationshipList) {\r\n        if (oParentRelationshipList.hasOwnProperty(sCoreId)) {\r\n          if (oParentRelationshipList[sCoreId].getVisibleUnderParentOnMap(mapInstanceId)) {\r\n            if (sCoreId === emp.storage.getRootGuid(mapInstanceId)) {\r\n              // It reached the root.\r\n              return true;\r\n            }\r\n            oParent = oParentRelationshipList[sCoreId].getParent();\r\n            if (oParent.isVisible()) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return bRet;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    getMapExtent: function (oMapExtent) {\r\n      var sCoreId;\r\n      var oChild;\r\n      var mapExtent = oMapExtent;\r\n      var oChildList = this.getChildrenList();\r\n\r\n      if (!(mapExtent instanceof emp.classLibrary.MapExtent)) {\r\n        mapExtent = new emp.classLibrary.MapExtent();\r\n      }\r\n\r\n      for (sCoreId in oChildList) {\r\n        if (!oChildList.hasOwnProperty(sCoreId)) {\r\n          continue;\r\n        }\r\n        oChild = oChildList[sCoreId];\r\n\r\n        switch (oChild.getCoreObjectType()) {\r\n          case emp.typeLibrary.types.FEATURE:\r\n          case emp.typeLibrary.types.OVERLAY:\r\n            oChild.getMapExtent(mapExtent);\r\n            break;\r\n        }\r\n      }\r\n\r\n      return mapExtent;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    compareValues: function (Value1, Value2) {\r\n      var bRet = false;\r\n\r\n      if (Value2 instanceof RegExp) {\r\n        // Regular expressions apply to string properties only.\r\n        if (typeof (Value1) === 'string') {\r\n          bRet = Value2.test(Value1);\r\n        }\r\n      } else {\r\n        bRet = (Value1 === Value2);\r\n      }\r\n      return bRet;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpRenderableObject#\r\n     */\r\n    compareProperty: function (mapInstanceId, sProperty, Value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n            bRet = this.compareValues(this.getName(), Value);\r\n            break;\r\n          case 'description':\r\n            bRet = this.compareValues(this.getDescription(), Value);\r\n            break;\r\n          case 'readonly':\r\n            bRet = this.compareValues(this.isReadOnly(), Value);\r\n            break;\r\n          case 'visible':\r\n            bRet = (this.isVisibleOnMap(mapInstanceId) === Value);\r\n            break;\r\n        }\r\n      }\r\n      return bRet;\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpObject\r\n */\r\nemp.classLibrary.EmpRenderableObject = emp.classLibrary.EmpObject.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpOverlay#\r\n       */\r\n      var options = {\r\n        overlayId: emp.helpers.id.get.setId(args.overlayId),\r\n        parentId: emp.helpers.id.get.setId(args.parentId),\r\n        menuId: emp.helpers.id.get.setId(args.menuId) || \"\",\r\n        hidden:  args.hidden || false,\r\n        /**\r\n         * @private\r\n         * @description This property  contains a list of all features under the overlay\r\n         * keyed by the feature Id which MUST be unique in all cases.\r\n         */\r\n        featureList: {},\r\n        cluster: undefined\r\n      };\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n\r\n      args.coreObjectType = emp.typeLibrary.types.OVERLAY;\r\n      emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this, args);\r\n\r\n      if (this.options.properties.hasOwnProperty('cluster')) {\r\n        this.options.cluster = new emp.typeLibrary.Overlay.Cluster(this.options.properties.cluster);\r\n\r\n        if (!this.options.properties.hasOwnProperty('clusterActive')) {\r\n          this.options.properties.clusterActive = false;\r\n        } else {\r\n          this.options.properties.clusterActive = (this.options.properties.clusterActive !== false);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    getOverlayId: function () {\r\n      return this.options.overlayId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    getParentId: function () {\r\n      return this.options.parentId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     * @deprecated\r\n     */\r\n    getMenuId: function () {\r\n      return this.options.menuId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     * @deprecated\r\n     */\r\n    setMenuId: function (sValue) {\r\n      this.options.menuId = (!emp.helpers.isEmptyString(sValue) ? sValue : \"\");\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    isOnFeatureList: function (oFeature) {\r\n      return this.options.featureList.hasOwnProperty(oFeature.getCoreId());\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    addToFeatureList: function (oFeature) {\r\n      if (!this.isOnFeatureList(oFeature)) {\r\n        this.options.featureList[oFeature.getCoreId()] = oFeature;\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    removeFromFeatureList: function (oFeature) {\r\n      if (this.isOnFeatureList(oFeature)) {\r\n        delete this.options.featureList[oFeature.getCoreId()];\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    getFeatureList: function () {\r\n      return this.options.featureList;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    getObjectData: function (mapInstanceId, parentCoreId) {\r\n      return new emp.typeLibrary.Overlay({\r\n        coreId: this.getCoreId(),\r\n        coreParent: parentCoreId,\r\n        overlayId: this.getOverlayId(),\r\n        parentId: parentCoreId,\r\n        name: this.getName(),\r\n        description: this.getDescription(),\r\n        readOnly: this.isReadOnly(),\r\n        globalType: emp.typeLibrary.types.OVERLAY,\r\n        properties: emp.helpers.copyObject(this.options.properties),\r\n        visible: this.isVisibleOnMap(mapInstanceId)\r\n      });\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    updateOverlay: function (oNewOverlayData) {\r\n      var sProperty;\r\n      var oProperties = oNewOverlayData.properties || {};\r\n\r\n      this.setName(oNewOverlayData.name);\r\n      this.setDescription(oNewOverlayData.description);\r\n\r\n      for (sProperty in oProperties) {\r\n        if (!oProperties.hasOwnProperty(sProperty)) {\r\n          continue;\r\n        }\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'readonly':\r\n            this.options.properties[sProperty] = (oProperties[sProperty] === true);\r\n            break;\r\n          case 'cluster':\r\n          case 'clusteractive':\r\n            // A cluster must be set at creation time or with the set cluster.\r\n            break;\r\n          default:\r\n            this.options.properties[sProperty] = oProperties[sProperty];\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpOverlay#\r\n     */\r\n    compareProperty: function (mapInstanceId, sProperty, Value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n          case 'description':\r\n          case 'readonly':\r\n          case 'visible':\r\n            bRet = emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n          case 'menuid':\r\n            bRet = this.compareValues(this.getMenuId(), Value);\r\n            break;\r\n          case 'overlayid':\r\n            bRet = this.compareValues(this.getOverlayId(), Value);\r\n            break;\r\n        }\r\n      }\r\n      return bRet;\r\n    }\r\n    /*\r\n     * TODO => Add function need to deal with adding, activating, deactivating and removing the cluster.\r\n     */\r\n  };\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpOverlay = emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpStaticContent#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpStaticContent#\r\n       */\r\n      var options = {\r\n        overlayId: emp.helpers.id.get.setId(args.overlayId),\r\n        parentId: emp.helpers.id.get.setId(args.parentId),\r\n        featureId: emp.helpers.id.get.setId(args.featureId)\r\n      };\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n\r\n      emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this, args);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpStaticContent#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpStaticContent#\r\n     */\r\n    getOverlayId: function () {\r\n      return this.options.overlayId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpStaticContent#\r\n     */\r\n    getParentId: function () {\r\n      return this.options.parentId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpStaticContent#\r\n     */\r\n    getFeatureId: function () {\r\n      return this.options.featureId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpStaticContent#\r\n     */\r\n    getObjectData: function (mapInstanceId, parentCoreId) {\r\n      return new emp.typeLibrary.Static({\r\n        coreId: this.getCoreId(),\r\n        coreParent: parentCoreId,\r\n        parentCoreId: parentCoreId,\r\n        name: this.getName(),\r\n        overlayId: this.getOverlayId(),\r\n        parentId: this.getParentId(),\r\n        featureId: this.getFeatureId(),\r\n        visible: this.isVisibleOnMap(mapInstanceId)\r\n      });\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpStaticContent = emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  return {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpFeature#\r\n       */\r\n      var options = {\r\n        //overlayId: emp.helpers.id.get.setId(args.overlayId),\r\n        //parentId: emp.helpers.id.get.setId(args.parentId),\r\n        featureId: args.featureId,\r\n        menuId: emp.helpers.id.get.setId(args.menuId) || \"\",\r\n        format: args.format,\r\n        data: args.data,\r\n        url: args.url,\r\n        params: args.params || {},\r\n        inEditMode: false,\r\n        mapExtent: new emp.classLibrary.MapExtent()\r\n      };\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n      args.coreObjectType = emp.typeLibrary.types.FEATURE;\r\n      emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this, args);\r\n      this.setMapExtent();\r\n      this.verifyAltitudeMode();\r\n      this.verifyMilStd();\r\n      this.verifyReadOnly();\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getFeatureId: function () {\r\n      return this.options.featureId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getFormat: function () {\r\n      return this.options.format;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getData: function () {\r\n      return this.options.data;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    setData: function (sData) {\r\n      this.options.data = sData;\r\n      this.setMapExtent();\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     * @deprecated\r\n     */\r\n    getMenuId: function () {\r\n      return this.options.menuId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     * @deprecated\r\n     */\r\n    setMenuId: function (sMenuId) {\r\n      this.options.menuId = sMenuId;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getURL: function () {\r\n      return this.options.url;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    setURL: function (sValue) {\r\n      this.options.url = sValue;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getParams: function () {\r\n      return this.options.params;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    setParams: function (sValue) {\r\n      this.options.params = sValue;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getObjectData: function (mapInstanceId, coreParentId) {\r\n      var oParent = this.getParentByIndex(0);\r\n\r\n      var oParams = {\r\n        coreId: this.getCoreId(),\r\n        coreParent: coreParentId,\r\n        parentCoreId: emp.storage.getRootGuid(mapInstanceId),\r\n        format: this.getFormat(),\r\n        name: this.getName(),\r\n        menuId: this.getMenuId(),\r\n        description: this.getDescription(),\r\n        featureId: this.getFeatureId(),\r\n        data: emp.helpers.copyObject(this.getData()),\r\n        properties: emp.helpers.copyObject(this.getProperties()),\r\n        url: this.options.url,\r\n        params: this.getParams(),\r\n        visible: this.isVisibleOnMap(mapInstanceId)\r\n      };\r\n\r\n      if (oParent) {\r\n        switch (oParent.getCoreObjectType()) {\r\n          case emp.typeLibrary.types.FEATURE:\r\n            oParams.parentId = oParent.getFeatureId();\r\n\r\n            while (oParent.getCoreObjectType() !== emp.typeLibrary.types.OVERLAY) {\r\n              oParent = oParent.getParentByIndex(0);\r\n            }\r\n            oParams.overlayId = oParent.getOverlayId();\r\n            break;\r\n          case emp.typeLibrary.types.OVERLAY:\r\n            oParams.overlayId = oParent.getOverlayId();\r\n            break;\r\n        }\r\n      }\r\n\r\n      return new emp.typeLibrary.Feature(oParams);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    verifyAltitudeMode: function () {\r\n      var oProperties = this.getProperties(),\r\n          basicSymbolID;\r\n\r\n      if (emp.util.isEmptyString(oProperties.altitudeMode)) {\r\n        // The client has not provided an altitudeMode.\r\n        switch (this.getFormat()) {\r\n          case emp.typeLibrary.featureFormatType.KML:\r\n            // It should be in the KML.\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.GEOJSON:\r\n            oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.WMS:\r\n          case emp.typeLibrary.featureFormatType.IMAGE:\r\n            oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.MILSTD:\r\n            oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n            basicSymbolID = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(this.getData().symbolCode);\r\n            basicSymbolID = basicSymbolID.slice(0, 3);\r\n            // Check Space Track/Air Track symbols and set the altitudeMode to \"absolute\" and \"relativeToGround\" respectivley\r\n            switch (basicSymbolID) {\r\n              case \"S*P\":\r\n              case \"I*P\":\r\n                oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.ABSOLUTE;\r\n                break;\r\n              case \"S*A\":\r\n              case \"I*A\":\r\n                oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND;\r\n                break;\r\n              default:\r\n                break;\r\n            }\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.AIRSPACE:\r\n            oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND;\r\n            break;\r\n          default:\r\n            oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND;\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    verifyMilStd: function () {\r\n      var oProperties = this.getProperties();\r\n\r\n      if (this.getFormat() === emp.typeLibrary.featureFormatType.MILSTD) {\r\n        var bStdVersionNotFound = true;\r\n        var iStdVersion = 0; // 2525B\r\n\r\n        if (oProperties.hasOwnProperty('modifiers')) {\r\n          if (oProperties.modifiers.hasOwnProperty('standard')) {\r\n            iStdVersion = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oProperties.modifiers.standard);\r\n            bStdVersionNotFound = false;\r\n          }\r\n        }\r\n\r\n        if (bStdVersionNotFound && oProperties.hasOwnProperty('standard')) {\r\n          iStdVersion = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oProperties.standard);\r\n        }\r\n\r\n        if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(this.getData().symbolCode, iStdVersion)\r\n          && sec.web.renderer.utilities.JavaRendererUtilities.is3dSymbol(this.getData().symbolCode, oProperties.modifiers)) {\r\n          if (oProperties.altitudeMode === emp.typeLibrary.featureAltitudeModeType.CLAMP_TO_GROUND) {\r\n            oProperties.altitudeMode = emp.typeLibrary.featureAltitudeModeType.ABSOLUTE;\r\n          }\r\n\r\n          if (!oProperties.hasOwnProperty('fillColor')) {\r\n            var sNewFillColor = emp.helpers.get3DMilStdAffiliationColor(this.getData().symbolCode);\r\n\r\n            if (oProperties.hasOwnProperty('fillOpacity')\r\n              && !isNaN(oProperties.fillOpacity)) {\r\n              var sOpacity = Math.floor(oProperties.fillOpacity * 255).toString(16);\r\n\r\n              if (sOpacity.length <= 1) {\r\n                //forces an opacity of single digit to double digit\r\n                sOpacity = '0' + sOpacity;\r\n              }\r\n              oProperties.fillColor = sOpacity + sNewFillColor;\r\n            } else {\r\n              oProperties.fillColor = '40' + sNewFillColor;\r\n            }\r\n          }\r\n\r\n          if (!oProperties.hasOwnProperty('lineColor')) {\r\n            var sLineColor = emp.helpers.get3DMilStdAffiliationColor(this.getData().symbolCode);\r\n\r\n            if (oProperties.hasOwnProperty('lineOpacity')\r\n              && !isNaN(oProperties.lineOpacity)) {\r\n              sOpacity = Math.floor(oProperties.lineOpacity * 255).toString(16);\r\n\r\n              if (sOpacity.length <= 1) {\r\n                //forces an opacity of single digit to double digit\r\n                sOpacity = '0' + sOpacity;\r\n              }\r\n\r\n              oProperties.lineColor = sOpacity + sLineColor;\r\n            } else {\r\n              oProperties.lineColor = 'FF' + sLineColor;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    verifyReadOnly: function () {\r\n      var oData;\r\n\r\n      if (!this.isReadOnly()) {\r\n        if (!emp.util.isEmptyString(this.options.url) && (this.options.url.length > 0)) {\r\n          this.setReadOnly(true);\r\n        }\r\n        else switch (this.getFormat()) {\r\n          case emp.typeLibrary.featureFormatType.KML:\r\n            if (emp.helpers.isCompoundKML(this.getData())) {\r\n              this.setReadOnly(true);\r\n            }\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.GEOJSON:\r\n            oData = this.getData();\r\n\r\n            if ((oData !== undefined)\r\n              && oData.hasOwnProperty('type')\r\n              && emp.helpers.isCompoundGeoJson(oData)) {\r\n              this.setReadOnly(true);\r\n            }\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.WMS:\r\n          case emp.typeLibrary.featureFormatType.IMAGE:\r\n            this.setReadOnly(true);\r\n            break;\r\n          case emp.typeLibrary.featureFormatType.MILSTD:\r\n          case emp.typeLibrary.featureFormatType.AIRSPACE:\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getMilStdVersion: function () {\r\n      var oProperties = this.getProperties();\r\n\r\n      if (!oProperties.hasOwnProperty('modifiers')) {\r\n        return emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n      }\r\n\r\n      if (!oProperties.modifiers.hasOwnProperty('standard')) {\r\n        return emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n      }\r\n\r\n      if (oProperties.modifiers.standard.toUpperCase() === emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C) {\r\n        return emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C;\r\n      }\r\n\r\n      return emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getSymbolCode: function () {\r\n      if (this.getFormat() === emp.typeLibrary.featureFormatType.MILSTD) {\r\n        return this.getData().symbolCode;\r\n      }\r\n      return undefined;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    isInEditMode: function () {\r\n      return this.options.inEditMode;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    setEditMode: function (bValue) {\r\n      this.options.inEditMode = (bValue === true);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    canMapEnginePlot: function (mapInstanceId) {\r\n      return emp.helpers.canMapEnginePlotFeature(mapInstanceId, this);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    canMapEngineEdit: function (mapInstanceId) {\r\n      return emp.helpers.canMapEngineEditFeature(mapInstanceId, this);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    isAOI: function () {\r\n      var bRet = false;\r\n      var oGeoJson = this.getData();\r\n\r\n      if (this.getFormat() !== emp.typeLibrary.featureFormatType.GEOJSON) {\r\n        return bRet;\r\n      }\r\n\r\n      if (oGeoJson.hasOwnProperty('type')\r\n        && (oGeoJson.type.toLowerCase() === 'feature')) {\r\n        if (oGeoJson.hasOwnProperty('properties') &&\r\n          oGeoJson.properties.hasOwnProperty('aoi')) {\r\n          bRet = true;\r\n        }\r\n      }\r\n      return bRet;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    updateFeature: function (oUpdateFeature) {\r\n      if (!emp.util.isEmptyString(oUpdateFeature.name)) {\r\n        this.setName(oUpdateFeature.name);\r\n      }\r\n\r\n      if (!emp.util.isEmptyString(oUpdateFeature.description)) {\r\n        this.setDescription(oUpdateFeature.description);\r\n      }\r\n\r\n      if ((oUpdateFeature.data !== null) && (oUpdateFeature.data !== undefined)) {\r\n        this.setData(emp.helpers.copyObject(oUpdateFeature.data));\r\n      }\r\n\r\n      if (!emp.helpers.isEmptyString(oUpdateFeature.menuId)) {\r\n        this.setMenuId(oUpdateFeature.menuId);\r\n      }\r\n\r\n      if (oUpdateFeature.properties) {\r\n        this.setProperties(emp.helpers.copyObject(oUpdateFeature.properties));\r\n      }\r\n      this.verifyAltitudeMode();\r\n      this.verifyMilStd();\r\n      this.verifyReadOnly();\r\n    },\r\n    /**\r\n     * @description This function returns an array of LatLon coordinates of the feature.\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     * @returns {LatLon[]} An array of LatLon coordinates.\r\n     */\r\n    getCoordinateList: function () {\r\n      var oCoordList;\r\n      var oParams;\r\n\r\n      try {\r\n        switch (this.getFormat()) {\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n          case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n          case emp.constant.featureFormatType.AIRSPACE:\r\n          case emp.constant.featureFormatType.GEOJSON:\r\n          case emp.constant.featureFormatType.MILSTD:\r\n            oCoordList = emp.util.geoJson.toCoordinateArray(this.getData());\r\n            break;\r\n          case emp.constant.featureFormatType.KML:\r\n            oCoordList = emp.util.kml.toCoordinateArray(this.getData());\r\n            break;\r\n          case emp.constant.featureFormatType.IMAGE:\r\n            oParams = this.getParams();\r\n            oCoordList = [];\r\n            oCoordList.push(new emp.classLibrary.Coordinate(oParams.top, oParams.left));\r\n            oCoordList.push(new emp.classLibrary.Coordinate(oParams.bottom, oParams.right));\r\n            break;\r\n        }\r\n      } catch (Err) {\r\n        oCoordList = [];\r\n      }\r\n      return oCoordList;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    compareProperty: function (mapInstanceId, sProperty, Value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n          case 'description':\r\n          case 'readonly':\r\n          case 'visible':\r\n            bRet = emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n          case 'menuid':\r\n            bRet = this.compareValues(this.getMenuId(), Value);\r\n            break;\r\n          case 'format':\r\n            bRet = this.compareValues(this.getFormat(), Value);\r\n            break;\r\n          case 'featureid':\r\n            bRet = this.compareValues(this.getFeatureId(), Value);\r\n            break;\r\n          case 'url':\r\n            bRet = this.compareValues(this.getURL(), Value);\r\n            break;\r\n        }\r\n      }\r\n      return bRet;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    getMapExtent: function (oMapExtent) {\r\n      var oFeatureExtent = this.options.mapExtent;\r\n      var mapExtent = emp.classLibrary.EmpRenderableObject.prototype.getMapExtent.call(this, oMapExtent);\r\n\r\n      if (oFeatureExtent && !oFeatureExtent.isEmpty()) {\r\n        mapExtent.addCoordinate(oFeatureExtent.getNorthEast());\r\n        mapExtent.addCoordinate(oFeatureExtent.getSouthWest());\r\n      }\r\n\r\n      return mapExtent;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpFeature#\r\n     */\r\n    setMapExtent: function () {\r\n      var iIndex;\r\n      var oCoordinateArray = this.getCoordinateList();\r\n\r\n      this.options.mapExtent.reset();\r\n\r\n      if (oCoordinateArray && (oCoordinateArray.length > 0)) {\r\n        for (iIndex = 0; iIndex < oCoordinateArray.length; iIndex++) {\r\n          this.options.mapExtent.addCoordinate(oCoordinateArray[iIndex]);\r\n        }\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpFeature = emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpWMS#\r\n       */\r\n      var options = {\r\n        id: args.id,\r\n        url: args.url,\r\n        useProxy: args.useProxy,\r\n        params: args.params,\r\n        source: args.source\r\n      };\r\n\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n\r\n      emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this, args);\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    compareProperty: function (mapInstanceId, sProperty, value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n          case 'description':\r\n          case 'readonly':\r\n          case 'visible':\r\n            bRet = emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this, mapInstanceId, sProperty, value);\r\n            break;\r\n          case 'url':\r\n            bRet = this.compareValues(this.options.url, value);\r\n            break;\r\n          case 'useProxy':\r\n            bRet = this.compareValues(this.options.useProxy, value);\r\n            break;\r\n          case 'id':\r\n            bRet = this.compareValues(this.options.id, value);\r\n            break;\r\n          case 'params':\r\n            bRet = this.compareValues(this.options.params, value);\r\n            break;\r\n        }\r\n      }\r\n\r\n      return bRet;\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    canMapEnginePlot: function (mapInstanceId) {\r\n      return emp.helpers.canMapEnginePlotFeature(mapInstanceId, this);\r\n    },\r\n\r\n    getVersion: function () {\r\n      return this.options.version;\r\n    }\r\n\r\n  };\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpMapService = emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpWMS#\r\n       */\r\n      var options = {\r\n        id: args.id,\r\n        url: args.url,\r\n        useProxy: args.useProxy,\r\n        transparent: true,\r\n        format: \"image/png\",\r\n        version: \"1.3.0\",\r\n        layers: args.layers || [],\r\n        activeLayers: {},\r\n        layerHierarchy: args.layerHierarchy,\r\n        /**\r\n         * @field\r\n         * @type {string}\r\n         * @description This field contains the unescaped xml capabilities document.\r\n         * It is made available to map implementation in the event that their WMS implementation requires it.\r\n         */\r\n        capabilities: args.capabilities || \"\",\r\n        visibleLayers: args.visibleLayers || [],\r\n        source: args.source,\r\n        oaFoldersSelected: {},\r\n        oaLayersSelected: {}\r\n      };\r\n      if (args.hasOwnProperty('params')) {\r\n        if (args.params.hasOwnProperty('transparent')) {\r\n          if (typeof (args.params.transparent) === \"boolean\") {\r\n            options.transparent = args.params.transparent;\r\n          }\r\n          else if (typeof (args.params.transparent) === \"string\") {\r\n            options.transparent = (this.params.transparent.toUpperCase() !== \"FALSE\");\r\n          }\r\n        }\r\n\r\n        if (args.params.hasOwnProperty('format')\r\n          && (typeof (args.params.format) === \"string\")) {\r\n          options.format = args.params.format;\r\n        }\r\n\r\n        if (args.params.hasOwnProperty('version')\r\n          && (typeof (args.params.version) === \"string\")) {\r\n          options.version = args.params.version;\r\n        }\r\n      }\r\n\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n\r\n      if (emp.helpers.isEmptyString(args.name)) {\r\n        args.name = 'WMS: ' + args.url;\r\n      }\r\n\r\n      args.coreObjectType = emp.typeLibrary.types.WMS;\r\n      emp.classLibrary.EmpRenderableObject.prototype.initialize.call(this, args);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    destroy: function () {\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getId: function () {\r\n      return this.options.id;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getVersion: function () {\r\n      return this.options.version;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    setVisibleOnMap: function (mapInstanceId, bVisible) {\r\n      var iIndex;\r\n      var parentFolder;\r\n      var visibleLayerList;\r\n      var bNewMapInstance = false;\r\n\r\n      emp.classLibrary.EmpRenderableObject.prototype.setVisibleOnMap.call(this, mapInstanceId, bVisible);\r\n\r\n      if (!this.options.activeLayers.hasOwnProperty(mapInstanceId)) {\r\n        this.options.activeLayers[mapInstanceId] = [];\r\n        bNewMapInstance = true;\r\n      }\r\n      if (!this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)) {\r\n        this.options.oaFoldersSelected[mapInstanceId] = [];\r\n      }\r\n      if (!this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)) {\r\n        this.options.oaLayersSelected[mapInstanceId] = [];\r\n      }\r\n\r\n      if (bNewMapInstance && bVisible) {\r\n        if (this.options.layers.length > 0) {\r\n          this.setActiveLayers(mapInstanceId, this.getLayers());\r\n        }\r\n        else if (this.options.visibleLayers.length > 0) {\r\n          visibleLayerList = this.options.visibleLayers;\r\n\r\n          this.clearActiveLayers(mapInstanceId);\r\n          for (iIndex = 0; iIndex < visibleLayerList.length; iIndex++) {\r\n            this.add2ActiveLayers(mapInstanceId, visibleLayerList[iIndex]);\r\n            this.selectLayer(mapInstanceId, visibleLayerList[iIndex]);\r\n            parentFolder = this.getParentFolderOfLayer(visibleLayerList[iIndex]);\r\n\r\n            while (parentFolder !== undefined) {\r\n              this.selectFolder(mapInstanceId, parentFolder.title);\r\n              parentFolder = this.getParentFolderOfFolder(parentFolder.title);\r\n            }\r\n          }\r\n        }\r\n        else if (this.options.source === emp.core.sources.CONFIG) {\r\n          // The WMS came from the config mgr and it has no visible layers set.\r\n          // So we don't make any of them visible.\r\n        }\r\n        else {\r\n          // Only do this if the visibleLayers list is empty.\r\n          //this.setActiveLayers(mapInstanceId, this.getAllLayer());\r\n          //this.options.oaLayersSelected[mapInstanceId] = this.options.activeLayers[mapInstanceId].slice(0);\r\n          //this.options.oaFoldersSelected[mapInstanceId] = this.getAllNamedFolders();\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    removeFromMap: function (mapInstanceId) {\r\n      if (this.options.activeLayers.hasOwnProperty(mapInstanceId)) {\r\n        delete this.options.activeLayers[mapInstanceId];\r\n      }\r\n      if (this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)) {\r\n        delete this.options.oaFoldersSelected[mapInstanceId];\r\n      }\r\n      if (this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)) {\r\n        delete this.options.oaLayersSelected[mapInstanceId];\r\n      }\r\n\r\n      emp.classLibrary.EmpRenderableObject.prototype.removeFromMap.call(this, mapInstanceId);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    hasVisibleLayers: function () {\r\n      return (this.options.visibleLayers.length > 0);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getVisibleLayers: function () {\r\n      return this.options.visibleLayers;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    hasLayers: function () {\r\n      return (this.options.layers.length > 0);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getLayers: function () {\r\n      return this.options.layers;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getActiveLayers: function (mapInstanceId) {\r\n      return this.options.activeLayers[mapInstanceId];\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    add2ActiveLayers: function (mapInstanceId, sLayer) {\r\n      if (this.options.activeLayers.hasOwnProperty(mapInstanceId)) {\r\n        this.options.activeLayers[mapInstanceId].push(sLayer);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    setActiveLayers: function (mapInstanceId, oaLayers) {\r\n      var iIndex;\r\n\r\n      this.clearActiveLayers(mapInstanceId);\r\n      for (iIndex = 0; iIndex < oaLayers.length; iIndex++) {\r\n        this.add2ActiveLayers(mapInstanceId, oaLayers[iIndex]);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    clearActiveLayers: function (mapInstanceId) {\r\n      if ((this.options.activeLayers[mapInstanceId] instanceof Array)\r\n        && (this.options.activeLayers[mapInstanceId].length > 0)) {\r\n        this.options.activeLayers[mapInstanceId].splice(0, this.options.activeLayers[mapInstanceId].length);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getLayerHierarchy: function () {\r\n      return this.options.layerHierarchy;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getParentFolderOfLayer: function (layerName) {\r\n      var findFoldersOfLayer = function (sLayerName, oFolder) {\r\n        var oFolderFound;\r\n        var iIndex = emp.helpers.findIndexOf(oFolder.layers, 'name', sLayerName);\r\n\r\n        if (iIndex > -1) {\r\n          if (oFolder.hasOwnProperty('title') &&\r\n            (oFolder.title !== null) &&\r\n            (oFolder.title !== ''))\r\n            return oFolder;\r\n          else\r\n            return null;\r\n        }\r\n        for (iIndex = 0; iIndex < oFolder.folders.length; iIndex++) {\r\n          oFolderFound = findFoldersOfLayer(sLayerName, oFolder.folders[iIndex]);\r\n\r\n          if (oFolderFound === undefined) {\r\n            // It was not found, continue looking\r\n            continue;\r\n          }\r\n          else if (oFolderFound === null) {\r\n            // It was found but the folder has no title\r\n            // so we use this one if it has a title.\r\n\r\n            if (oFolder.hasOwnProperty('title') &&\r\n              (oFolder.title !== null) &&\r\n              (oFolder.title !== ''))\r\n              return oFolder;\r\n            else\r\n              return null;\r\n          }\r\n          else {\r\n            return oFolderFound;\r\n          }\r\n        }\r\n\r\n        return undefined;\r\n      };\r\n\r\n      var oFolder = findFoldersOfLayer(layerName, this.options.layerHierarchy);\r\n\r\n      // If it was found but no parent folder has a title return undefined.\r\n      if (oFolder === null) {\r\n        oFolder = undefined;\r\n      }\r\n\r\n      return oFolder;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getParentFolderOfFolder: function (folderTitle) {\r\n      var findParentOfFolder = function (sTitle, oFolder) {\r\n        var oFolderFound;\r\n        var iIndex = emp.helpers.findIndexOf(oFolder.folders, 'title', sTitle);\r\n\r\n        if (iIndex > -1) {\r\n          if (oFolder.hasOwnProperty('title') &&\r\n            (oFolder.title !== null) &&\r\n            (oFolder.title !== '')) {\r\n            return oFolder;\r\n          } else {\r\n            return null;\r\n          }\r\n        }\r\n        for (iIndex = 0; iIndex < oFolder.folders.length; iIndex++) {\r\n          oFolderFound = findParentOfFolder(sTitle, oFolder.folders[iIndex]);\r\n\r\n          if (oFolderFound === undefined) {\r\n            // It was not found, continue looking\r\n            continue;\r\n          }\r\n          else if (oFolderFound === null) {\r\n            // It was found but the folder has no title\r\n            // so we use this one if it has a title.\r\n\r\n            if (oFolder.hasOwnProperty('title') &&\r\n              (oFolder.title !== null) &&\r\n              (oFolder.title !== '')) {\r\n              return oFolder;\r\n            } else {\r\n              return null;\r\n            }\r\n          }\r\n          else {\r\n            return oFolderFound;\r\n          }\r\n        }\r\n\r\n        return undefined;\r\n      };\r\n\r\n      var oFolder = findParentOfFolder(folderTitle, this.options.layerHierarchy);\r\n\r\n      // If it was found but no parent folder has a title return undefined.\r\n      if (oFolder === null) {\r\n        oFolder = undefined;\r\n      }\r\n\r\n      return oFolder;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    locate: function (args) {\r\n      var transaction,\r\n        payload;\r\n      args = args || {};\r\n\r\n      args.component = args.component || \"\";\r\n\r\n      if (args.bounds) {\r\n        payload = {\r\n          bounds: args.bounds,\r\n          zoom: true,\r\n          visible: true\r\n        };\r\n      }\r\n      else {\r\n        payload = {\r\n          featureId: this.id,\r\n          overlayId: this.overlayId,\r\n          zoom: true,\r\n          visible: true\r\n        };\r\n      }\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.VIEW_SET,\r\n        mapInstanceId: args.mapInstanceId,\r\n        items: [new emp.typeLibrary.View(payload)]\r\n      });\r\n      if (args.component === \"de\") {\r\n        transaction.run();\r\n      } else {\r\n        return transaction;\r\n      }\r\n    },\r\n    /*\r\n     visibility: function (oTransaction, sParentCoreId, bVisibility) {\r\n     var oItem,\r\n     mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n     this.visible = bVisibility;\r\n     this.visibilitySetting = bVisibility;\r\n     oItem = this.createDuplicate();\r\n\r\n     oTransaction.items.push(oItem);\r\n     },\r\n     */\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getAllLayer: function () {\r\n      var oaLayers = [];\r\n\r\n      var getLayers = function (oLayerList) {\r\n        var oaLayerList = [];\r\n\r\n        for (var iIndex = 0; iIndex < oLayerList.length; iIndex++) {\r\n          oaLayerList.push(oLayerList[iIndex].name);\r\n        }\r\n\r\n        return oaLayerList;\r\n      };\r\n\r\n      var getLayersFromFolders = function (oFolders) {\r\n        var oaLayerList = [];\r\n\r\n        for (var iIndex = 0; iIndex < oFolders.length; iIndex++) {\r\n          oaLayerList = oaLayerList.concat(getLayersFromFolders(oFolders[iIndex].folders));\r\n          oaLayerList = oaLayerList.concat(getLayers(oFolders[iIndex].layers));\r\n        }\r\n\r\n        return oaLayerList;\r\n      };\r\n      var oaTemp = getLayersFromFolders(this.options.layerHierarchy.folders);\r\n      oaLayers = oaLayers.concat(oaTemp);\r\n      oaTemp = getLayers(this.options.layerHierarchy.layers);\r\n      oaLayers = oaLayers.concat(oaTemp);\r\n\r\n      return oaLayers;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getAllNamedFolders: function () {\r\n      var getNamedFolders = function (oFolders) {\r\n        var oaFolderList = [];\r\n\r\n        for (var iIndex = 0; iIndex < oFolders.length; iIndex++) {\r\n          if ((oFolders[iIndex].layers.length > 0) ||\r\n            (oFolders[iIndex].folders.length > 0)) {\r\n            if (oFolders[iIndex].title) {\r\n              oaFolderList.push(oFolders[iIndex].title);\r\n            }\r\n            oaFolderList = oaFolderList.concat(getNamedFolders(oFolders[iIndex].folders));\r\n          }\r\n        }\r\n\r\n        return oaFolderList;\r\n      };\r\n\r\n      return getNamedFolders(this.options.layerHierarchy.folders);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    selectFolder: function (mapInstanceId, sFolderName) {\r\n      if (this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)) {\r\n        if (this.options.oaFoldersSelected[mapInstanceId].indexOf(sFolderName) === -1) {\r\n          this.options.oaFoldersSelected[mapInstanceId].push(sFolderName);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    isFolderSelected: function (mapInstanceId, sFolderName) {\r\n      if (this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)) {\r\n        return (this.options.oaFoldersSelected[mapInstanceId].indexOf(sFolderName) !== -1);\r\n      }\r\n      return false;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    unselectFolder: function (mapInstanceId, sFolderName) {\r\n      if (this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)) {\r\n        var iIndex = this.options.oaFoldersSelected[mapInstanceId].indexOf(sFolderName);\r\n        if (iIndex !== -1) {\r\n          this.options.oaFoldersSelected[mapInstanceId].splice(iIndex, 1);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    selectAllFolders: function (mapInstanceId) {\r\n      this.options.oaFoldersSelected[mapInstanceId] = this.getAllNamedFolders();\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    unselectAllFolders: function (mapInstanceId) {\r\n      if (this.options.oaFoldersSelected.hasOwnProperty(mapInstanceId)) {\r\n        if (this.options.oaFoldersSelected[mapInstanceId].length > 0) {\r\n          this.options.oaFoldersSelected[mapInstanceId].splice(0, this.oaFoldersSelected[mapInstanceId].length);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    selectLayer: function (mapInstanceId, sLayerName) {\r\n      if (this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)) {\r\n        if (this.options.oaLayersSelected[mapInstanceId].indexOf(sLayerName) === -1) {\r\n          this.options.oaLayersSelected[mapInstanceId].push(sLayerName);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    isLayerSelected: function (mapInstanceId, sLayerName) {\r\n      if (this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)) {\r\n        return (this.options.oaLayersSelected[mapInstanceId].indexOf(sLayerName) !== -1);\r\n      }\r\n      return false;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    unselectLayer: function (mapInstanceId, sLayerName) {\r\n      if (this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)) {\r\n        var iIndex = this.options.oaLayersSelected[mapInstanceId].indexOf(sLayerName);\r\n        if (iIndex !== -1) {\r\n          this.options.oaLayersSelected[mapInstanceId].splice(iIndex, 1);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    selectAllLayers: function (mapInstanceId) {\r\n      this.options.oaLayersSelected[mapInstanceId] = this.getAllLayer();\r\n      this.clearActiveLayers(mapInstanceId);\r\n      this.options.activeLayers[mapInstanceId] = emp.helpers.copyObject(this.options.oaLayersSelected[mapInstanceId]);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    unselectAllLayers: function (mapInstanceId) {\r\n      if (this.options.oaLayersSelected.hasOwnProperty(mapInstanceId)) {\r\n        if (this.options.oaLayersSelected[mapInstanceId].length > 0) {\r\n          this.options.oaLayersSelected[mapInstanceId].splice(0, this.options.oaLayersSelected[mapInstanceId].length);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    getObjectData: function (mapInstanceId, coreParentId) {\r\n      var oParent = this.getParentByIndex(0);\r\n\r\n      var oObj = {\r\n        coreId: this.getCoreId(),\r\n        coreParent: coreParentId,\r\n        parentCoreId: emp.storage.getRootGuid(mapInstanceId),\r\n        id: this.options.id,\r\n        overlayId: (oParent ? oParent.getOverlayId() : undefined),\r\n        name: this.options.name,\r\n        url: this.options.url,\r\n        useProxy: this.options.useProxy,\r\n        params: {\r\n          transparent: this.options.transparent,\r\n          format: this.options.format,\r\n          version: this.options.version\r\n        },\r\n        activeLayers: emp.helpers.copyObject(this.options.activeLayers[mapInstanceId]),\r\n        capabilities: emp.helpers.copyObject(this.options.capabilities),\r\n        visible: this.isVisibleOnMap(mapInstanceId)\r\n      };\r\n\r\n      if (this.options.layers.length > 0) {\r\n        oObj.layers = emp.helpers.copyObject(this.options.layers);\r\n      }\r\n      return new emp.typeLibrary.WMS(oObj);\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    update: function (args) {\r\n      if (args.hasOwnProperty('params')) {\r\n        if (args.params.hasOwnProperty('transparent')) {\r\n          if (typeof (args.params.transparent) === \"boolean\") {\r\n            this.options.transparent = args.params.transparent;\r\n          }\r\n          else if (typeof (args.params.transparent) === \"string\") {\r\n            this.options.transparent = (this.params.transparent.toUpperCase() !== \"FALSE\");\r\n          }\r\n        }\r\n\r\n        if (args.params.hasOwnProperty('format')\r\n          && (typeof (args.params.format) === \"string\")) {\r\n          this.options.format = args.params.format;\r\n        }\r\n\r\n        if (args.params.hasOwnProperty('version')\r\n          && (typeof (args.params.version) === \"string\")) {\r\n          this.options.version = args.params.version;\r\n        }\r\n      }\r\n\r\n      if (args.hasOwnProperty('url')) {\r\n        this.options.url = args.url;\r\n      }\r\n\r\n      if (args.hasOwnProperty('name')) {\r\n        this.setName(args.name);\r\n      }\r\n\r\n      if (emp.helpers.isEmptyString(this.getName())) {\r\n        this.setName('WMS: ' + this.options.url);\r\n      }\r\n\r\n      if ((args.layers !== undefined)\r\n        && (args.layers !== null)) {\r\n        this.options.layers = emp.helpers.copyObject(args.layers);\r\n        this.options.activeLayers = emp.helpers.copyObject(args.layers);\r\n      }\r\n      else if (args.hasOwnProperty('activeLayers')) {\r\n        this.options.activeLayers = emp.helpers.copyObject(args.activeLayers);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    compareProperty: function (mapInstanceId, sProperty, Value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n          case 'description':\r\n          case 'readonly':\r\n          case 'visible':\r\n            bRet = emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n          case 'featureid':\r\n            bRet = this.compareValues(this.getId(), Value);\r\n            break;\r\n          case 'format':\r\n            bRet = this.compareValues(this.options.format, Value);\r\n            break;\r\n          case 'transparent':\r\n            bRet = this.compareValues(this.options.transparent, Value);\r\n            break;\r\n          case 'version':\r\n            bRet = this.compareValues(this.options.version, Value);\r\n            break;\r\n          case 'url':\r\n            bRet = this.compareValues(this.options.url, Value);\r\n            break;\r\n        }\r\n      }\r\n      return bRet;\r\n    },\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     */\r\n    canMapEnginePlot: function (mapInstanceId) {\r\n      return emp.helpers.canMapEnginePlotFeature(mapInstanceId, this);\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpWMS = emp.classLibrary.EmpRenderableObject.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpWMS#\r\n       */\r\n      if (emp.helpers.isEmptyString(args.name)) {\r\n        args.name = 'WMTS: ' + args.url;\r\n      }\r\n\r\n      var options = {\r\n        format: args.format || \"image/png\",\r\n        version: args.version || \"1.0.0\",\r\n        layer: args.layer,\r\n        style: args.style || \"default\",\r\n        sampleDimensions: args.sampleDimensions\r\n      };\r\n\r\n      args.coreObjectType = emp.typeLibrary.types.WMTS;\r\n\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n      emp.classLibrary.EmpMapService.prototype.initialize.call(this, args);\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    getObjectData: function (mapInstanceId, coreParentId) {\r\n      var oParent = this.getParentByIndex(0);\r\n\r\n      var oObj = {\r\n        coreId: this.getCoreId(),\r\n        coreParent: coreParentId,\r\n        parentCoreId: emp.storage.getRootGuid(mapInstanceId),\r\n        id: this.options.id,\r\n        overlayId: (oParent ? oParent.getOverlayId() : undefined),\r\n        name: this.options.name,\r\n        url: this.options.url,\r\n        useProxy: this.options.useProxy,\r\n        format: this.options.params.format,\r\n        version: this.options.params.version,\r\n        layer: this.options.params.layer,\r\n        style: this.options.params.style,\r\n        visible: this.isVisibleOnMap(mapInstanceId)\r\n      };\r\n\r\n      if (this.options.sampleDimensions) {\r\n        oObj.sampleDimensions = emp.helpers.copyObject(this.options.sampleDimensions);\r\n      }\r\n\r\n      return new emp.typeLibrary.WMTS(oObj);\r\n    },\r\n\r\n    compareProperty: function (mapInstanceId, sProperty, Value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n          case 'description':\r\n          case 'readonly':\r\n          case 'visible':\r\n            bRet = emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n          case 'url':\r\n          case 'useProxy':\r\n          case 'id':\r\n          case 'params':\r\n            bRet = emp.classLibrary.EmpMapService.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n        }\r\n      }\r\n\r\n      return bRet;\r\n    }\r\n  };\r\n\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpWMTS = emp.classLibrary.EmpMapService.extend(emp.classLibrary.privateClass());\r\n","emp.classLibrary.privateClass = function () {\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.classLibrary.EmpWMS#\r\n     * @param {object} args\r\n     */\r\n    initialize: function (args) {\r\n      /**\r\n       * @memberof emp.classLibrary.EmpWMS#\r\n       */\r\n      if (emp.helpers.isEmptyString(args.name)) {\r\n        args.name = 'KML: ' + args.url;\r\n      }\r\n\r\n      var options = {\r\n        version: args.version || \"2.2\",\r\n        kmlData: args.kmlData\r\n      };\r\n\r\n      args.coreObjectType = emp.typeLibrary.types.KML;\r\n\r\n      emp.classLibrary.Util.setOptions(this, options);\r\n      emp.classLibrary.EmpMapService.prototype.initialize.call(this, args);\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    getObjectData: function (mapInstanceId, coreParentId) {\r\n      var oParent = this.getParentByIndex(0);\r\n\r\n      var oObj = {\r\n        coreId: this.getCoreId(),\r\n        coreParent: coreParentId,\r\n        parentCoreId: emp.storage.getRootGuid(mapInstanceId),\r\n        id: this.options.id,\r\n        overlayId: (oParent ? oParent.getOverlayId() : undefined),\r\n        name: this.options.name,\r\n        url: this.options.url,\r\n        useProxy: this.options.useProxy,\r\n        version: this.options.version,\r\n        kmlData: this.options.kmlData,\r\n        visible: this.isVisibleOnMap(mapInstanceId)\r\n      };\r\n\r\n      return new emp.typeLibrary.KmlLayer(oObj);\r\n    },\r\n\r\n    compareProperty: function (mapInstanceId, sProperty, Value) {\r\n      var bRet = false;\r\n\r\n      if (!emp.util.isEmptyString(sProperty)) {\r\n        switch (sProperty.toLowerCase()) {\r\n          case 'name':\r\n          case 'description':\r\n          case 'readonly':\r\n          case 'visible':\r\n            bRet = emp.classLibrary.EmpRenderableObject.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n          case 'url':\r\n          case 'useProxy':\r\n          case 'id':\r\n            bRet = emp.classLibrary.EmpMapService.prototype.compareProperty.call(this, mapInstanceId, sProperty, Value);\r\n            break;\r\n          case 'kmlData':\r\n            bRet = this.compareValues(this.options.kmlData, Value);\r\n            break;\r\n        }\r\n      }\r\n\r\n      return bRet;\r\n    }\r\n  };\r\n\r\n\r\n  return publicInterface;\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @extends emp.classLibrary.EmpRenderableObject\r\n */\r\nemp.classLibrary.EmpKmlLayer = emp.classLibrary.EmpMapService.extend(emp.classLibrary.privateClass());\r\n","/*global confirm */\r\nvar emp = window.emp || {};\r\n\r\n/**\r\n * @class\r\n * @memberOf emp\r\n * @desc Interface to the geospatial rendering component of EMP.\r\n */\r\nemp.map = function (args) {\r\n\r\n  var activeEngine = null,\r\n    oViewBounds = {\r\n      north: 0.0,\r\n      south: 0.0,\r\n      east: 0.0,\r\n      west: 0.0\r\n    },\r\n    oViewCenter = {\r\n      lat: 0.0,\r\n      lon: 0.0\r\n    },\r\n    dViewRange = 5000000.0,\r\n    resources = [],\r\n    resourceLen = 0,\r\n    completed = 0,\r\n    loadComplete,\r\n    previousSwapFailed,\r\n    bLoadInProgress = false,\r\n    bReloadInProgress = false,\r\n    bDoReload = false,\r\n    bExecuteRemove = false,\r\n    sDrawEditIntent,\r\n    oDrawEditOperation,\r\n    sDrawEditTransactionID,\r\n    sManifestFile,\r\n    engineConfig = emp.util.config,\r\n    oRemoveTransaction,\r\n    currentStatus,\r\n    sDefaultLayerOverlayID,\r\n    container,\r\n    oEditDrawTransaction = null,\r\n    sMapSwapSetViewTransactionId,\r\n    engDirectDefault = {\r\n      name: \"undefined\",\r\n      ref: null\r\n    },\r\n\r\n    mapInstanceId = args.mapInstanceId,\r\n    editingManager,\r\n    defaultExtent = args.extent,\r\n    // This config parameter may be used in the future when\r\n    // a unique map instance config object is created which\r\n    // will conatin instance specific configurations.\r\n    //    config,\r\n    freehandMode = false,\r\n    freehandModeDrawStart = false,\r\n    freehandLineColor = 'FFFFFF00',\r\n    freehandLineWidth = 8,\r\n    freehandLineColorOverride,\r\n    freehandLineWidthOverride,\r\n    freehandFeature = new emp.typeLibrary.Feature({\r\n      featureId: \"freehandX\",\r\n      coreId: \"freehandX\",\r\n      name: '',\r\n      format: emp3.api.enums.FeatureTypeEnum.GEO_PATH,\r\n      data: {\r\n        type: 'LineString',\r\n        coordinates: []\r\n      },\r\n      readOnly: true,\r\n      properties: {\r\n        lineColor: freehandLineColor,\r\n        lineWidth: freehandLineWidth\r\n      }\r\n    });\r\n\r\n  // assume it is a javascript file unless it ends with .css\r\n  function checkResourceType(resource) {\r\n    var type = \"js\";\r\n    if (resource.substr(resource.length - 4, 4).toLowerCase() === \".css\") {\r\n      type = \"css\";\r\n    }\r\n    return type;\r\n  }\r\n\r\n  function loadCSS(args) {\r\n    var fileref = document.createElement(\"link\");\r\n    fileref.setAttribute(\"rel\", \"stylesheet\");\r\n    fileref.setAttribute(\"type\", \"text/css\");\r\n    fileref.setAttribute(\"href\", args.url);\r\n\r\n    document.getElementsByTagName(\"head\")[0].appendChild(fileref);\r\n  }\r\n\r\n  function isScriptLoaded(sURL) {\r\n    var iIndex;\r\n    var sAbsUrl = emp.helpers.relToAbs(sURL);\r\n    var script = document.querySelectorAll('script');\r\n\r\n    for (iIndex = 0; iIndex < script.length; iIndex += 1) {\r\n      if (script[iIndex].src === sAbsUrl) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @memberOf emp.map\r\n   * @private\r\n   * @desc This function is used to load a resource such as a javascript file needed for a given map engine.\r\n   It is for internal map use only and is private by closure.\r\n   * @method\r\n   */\r\n  function loadScript(args) {\r\n    var script = document.createElement(\"script\");\r\n\r\n    script.type = \"text/javascript\";\r\n    script.src = args.url;\r\n    if (isScriptLoaded(script.src)) {\r\n      setTimeout(function () {\r\n        args.callback();\r\n      }, 0);\r\n    }\r\n    else {\r\n      if (script.readyState) { //IE\r\n        script.onreadystatechange = function () {\r\n          if (script.readyState === \"loaded\" ||\r\n            script.readyState === \"complete\") {\r\n            script.onreadystatechange = null;\r\n            args.callback();\r\n          }\r\n        };\r\n      }\r\n      else { //Others\r\n        script.onload = function () {\r\n          args.callback();\r\n        };\r\n      }\r\n      document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n    }\r\n  }\r\n\r\n  function getStartupExtent() {\r\n    var initialExtent;\r\n\r\n    if (defaultExtent) {\r\n      if ((defaultExtent.hasOwnProperty('centerLat') && (typeof(defaultExtent.centerLat) === 'number')) &&\r\n        (defaultExtent.hasOwnProperty('centerLon') && (typeof(defaultExtent.centerLon) === 'number')) &&\r\n        ((defaultExtent.hasOwnProperty('range') && (typeof(defaultExtent.range) === 'number')) ||\r\n        (defaultExtent.hasOwnProperty('scale') && (typeof(defaultExtent.scale) === 'number')))) {\r\n        initialExtent = {\r\n          centerLat: defaultExtent.centerLat,\r\n          centerLon: defaultExtent.centerLon\r\n        };\r\n        if (defaultExtent.hasOwnProperty('range') && (typeof(defaultExtent.range) === 'number')) {\r\n          initialExtent.range = defaultExtent.range;\r\n        }\r\n        else {\r\n          initialExtent.scale = defaultExtent.scale;\r\n        }\r\n      }\r\n      else if ((defaultExtent.hasOwnProperty('north') && (typeof(defaultExtent.north) === 'number')) &&\r\n        (defaultExtent.hasOwnProperty('south') && (typeof(defaultExtent.south) === 'number')) &&\r\n        (defaultExtent.hasOwnProperty('east') && (typeof(defaultExtent.east) === 'number')) &&\r\n        (defaultExtent.hasOwnProperty('west') && (typeof(defaultExtent.west) === 'number'))) {\r\n        initialExtent = {\r\n          north: defaultExtent.north,\r\n          south: defaultExtent.south,\r\n          east: defaultExtent.east,\r\n          west: defaultExtent.west\r\n        };\r\n      }\r\n    }\r\n\r\n    return initialExtent;\r\n  }\r\n\r\n  /**\r\n   * @memberOf emp.map\r\n   * @private\r\n   * @desc This function is used to iterate through loading resources needed for a given map engine.\r\n   *  It is for internal map use only and is private by closure.\r\n   * @method\r\n   */\r\n\r\n  function loadNextResource() {\r\n    var currentEngineConfiguration = engineConfig.getCurrentEngineConfiguration();\r\n\r\n    completed += 1;\r\n    if (completed < resourceLen) {\r\n      document.getElementById(mapInstanceId + '_loadingStatus').innerHTML = completed + \" of \" + resourceLen + \" Loaded...\";\r\n      var resource = currentEngineConfiguration.engineBasePath + resources.shift();\r\n\r\n      if (resource) {\r\n        var type = checkResourceType(resource);\r\n        if (type === \"css\") {\r\n          loadCSS({\r\n            url: resource\r\n          });\r\n          // Currently no success event for dynamically loading css, just request and move on\r\n          loadNextResource();\r\n        }\r\n        else {\r\n          loadScript({\r\n            url: resource,\r\n            callback: loadNextResource\r\n          });\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      document.getElementById(mapInstanceId + '_loadingStatus').innerHTML = \"All resources have loaded\";\r\n      // Send an args object with the properties object from the engines configuration\r\n      // This will be an empty object if not provided by the configuration\r\n      var initialExtent = getStartupExtent();\r\n\r\n      loadComplete({\r\n        configProperties: currentEngineConfiguration.properties,\r\n        mapInstance: publicInterface,\r\n        extent: initialExtent\r\n      });\r\n      document.getElementById(mapInstanceId + '_loadingPanel').style.visibility = \"hidden\";\r\n    }\r\n  }\r\n\r\n  function loadResource(args) {\r\n    var type = checkResourceType(args.url);\r\n    if (type === \"css\") {\r\n      loadCSS({\r\n        url: args.url\r\n      });\r\n      // Currently no success event for dynamically loading css, just request and move on\r\n      args.callback();\r\n    }\r\n    else {\r\n      loadScript({\r\n        url: args.url,\r\n        callback: args.callback\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * The manifest file has loaded successfully.  This will occur once per engine.  The\r\n   * manifest file does not get loaded a second time.  Once loaded, the success will\r\n   * call the fnInitialize callback method as set in the manifest when it registered the map\r\n   * engine.  The fnInitialize method should have the javascript resources to load for that engine.\r\n   */\r\n  function manifestSuccess() {\r\n    var oResources,\r\n      currentEngineConfiguration = engineConfig.getCurrentEngineConfiguration(),\r\n      currentMapEngineId = engineConfig.getCurrentMapEngineId(),\r\n      oMapRegistration = emp.instanceManager.getMapEngineRegistration(currentMapEngineId);\r\n\r\n    if (oMapRegistration) {\r\n      oResources = oMapRegistration.fnInitialize({\r\n        engine: currentEngineConfiguration\r\n        // This config parameter may be used in the future when\r\n        // a unique map instance config object is created which\r\n        // will contain instance specific configurations.\r\n        //        config: config,\r\n      });\r\n      publicInterface.engineId = currentMapEngineId;\r\n      if (oResources) {\r\n        //        if (oMapRegistration) {\r\n        oMapRegistration.fnCreateInstance = oResources.fnCreateInstance;\r\n        //        }\r\n        resources = oResources.resourceList;\r\n        resourceLen = resources.length;\r\n        loadComplete = oResources.fnCreateInstance;\r\n        var resource = resources.shift();\r\n        loadResource({\r\n          url: currentEngineConfiguration.engineBasePath + resource,\r\n          callback: loadNextResource\r\n        });\r\n      }\r\n      else {\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n          message: \"Map engine did NOT return resources from its initialize function.\"\r\n        });\r\n      }\r\n    }\r\n    else {\r\n      new emp.typeLibrary.Error({\r\n        level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n        message: \"Map engine registration not found.\"\r\n      });\r\n    }\r\n  }\r\n\r\n  function handlerStatusChange(oTransaction) {\r\n    switch (oTransaction.items[0].status) {\r\n      case emp.map.states.INITIALIZING:\r\n        break;\r\n      case emp.map.states.READY:\r\n        if (bReloadInProgress) {\r\n          publicInterface.eventing.voice.silence(true);\r\n          // Start the set view.\r\n          setMapView();\r\n        }\r\n        else if (bLoadInProgress) {\r\n          // Given that it is the first time we load\r\n          bLoadInProgress = false;\r\n          emp.transactionQueue.run(oTransaction.mapInstanceId);\r\n        }\r\n\r\n        break;\r\n      case emp.map.states.MAP_INSTANCE_INIT_FAILED:\r\n        bLoadInProgress = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  function handleTCDrawEditBegin(oTransaction) {\r\n    if (bReloadInProgress) {\r\n      return;\r\n    }\r\n\r\n    if (sDrawEditTransactionID === oTransaction.transactionId) {\r\n      switch (oTransaction.intent) {\r\n        case emp.intents.control.DRAW_BEGIN:\r\n        case emp.intents.control.EDIT_BEGIN:\r\n          switch (publicInterface.status.get()) {\r\n            case emp.map.states.DRAW:\r\n            case emp.map.states.EDIT:\r\n              sDrawEditIntent = undefined;\r\n              oDrawEditOperation = undefined;\r\n              sDrawEditTransactionID = undefined;\r\n              // Switch state success of failure.\r\n              new publicInterface.eventing.StatusChange({\r\n                status: emp.map.states.READY\r\n              });\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  function handleDrawEditStart(oStartEventTransaction) {\r\n    var oTransaction = oStartEventTransaction.items[0];\r\n    sDrawEditIntent = oTransaction.intent;\r\n\r\n    if (oTransaction.items.length > 0) {\r\n      oDrawEditOperation = oTransaction.items[0];\r\n    }\r\n    sDrawEditTransactionID = oTransaction.transactionId;\r\n\r\n    switch (sDrawEditIntent) {\r\n      case emp.intents.control.DRAW_BEGIN:\r\n        // Set the  new state.\r\n        new publicInterface.eventing.StatusChange({\r\n          status: emp.map.states.DRAW\r\n        });\r\n        break;\r\n      case emp.intents.control.EDIT_BEGIN:\r\n        // Set the  new state.\r\n        new publicInterface.eventing.StatusChange({\r\n          status: emp.map.states.EDIT\r\n        });\r\n        break;\r\n    }\r\n  }\r\n\r\n  function mapSwapSetViewcomplete(oTransaction) {\r\n    if (oTransaction && sMapSwapSetViewTransactionId) {\r\n      if (oTransaction.transactionId === sMapSwapSetViewTransactionId) {\r\n        sMapSwapSetViewTransactionId = undefined;\r\n\r\n        emp.transactionQueue.listener.remove({\r\n          type: emp.intents.control.VIEW_SET,\r\n          mapInstanceId: mapInstanceId,\r\n          callback: mapSwapSetViewcomplete\r\n        });\r\n        emp.storage.reload(mapInstanceId);\r\n      }\r\n    }\r\n  }\r\n\r\n  function setMapView() {\r\n    publicInterface.eventing.voice.silence(false);\r\n\r\n    sMapSwapSetViewTransactionId = emp.helpers.id.newGUID();\r\n\r\n    emp.transactionQueue.listener.add({\r\n      type: emp.intents.control.VIEW_SET,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: mapSwapSetViewcomplete\r\n    });\r\n\r\n    var oView = new emp.typeLibrary.View({\r\n      transactionId: sMapSwapSetViewTransactionId,\r\n      center: oViewCenter,\r\n      range: dViewRange\r\n    });\r\n\r\n    var oTransaction = new emp.typeLibrary.Transaction({\r\n      mapInstanceId: mapInstanceId,\r\n      transactionId: sMapSwapSetViewTransactionId,\r\n      sender: \"CORE\",\r\n      intent: emp.intents.control.VIEW_SET,\r\n      items: [oView]\r\n    });\r\n    oTransaction.run();\r\n  }\r\n\r\n  function storageReloadComplete(oTrans) {\r\n    var oTransaction = new emp.typeLibrary.Transaction({\r\n      mapInstanceId: oTrans.mapInstanceId,\r\n      intent: emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,\r\n      source: emp.core.sources.STORAGE,\r\n      items: []\r\n    });\r\n    oTransaction.run();\r\n    emp.transactionQueue.run(oTrans.mapInstanceId);\r\n    bReloadInProgress = false;\r\n  }\r\n\r\n  function processEngineSwapRequest(mapInstanceId) {\r\n    // First Check if There is a transaction pending.\r\n    // If there is we must wait.\r\n    bDoReload = false;\r\n    if (emp.instanceManager.isMapEngineLoading()) {\r\n      // We start a timer to check again latter.\r\n      setTimeout(function () {\r\n        processEngineSwapRequest(mapInstanceId);\r\n      }, 100);\r\n      return;\r\n    }\r\n    if (emp.transactionQueue.isTransactionOutStanding(mapInstanceId)) {\r\n      // We start a timer to check again latter.\r\n      setTimeout(function () {\r\n        processEngineSwapRequest(mapInstanceId);\r\n      }, 100);\r\n      return;\r\n    }\r\n    new publicInterface.eventing.StatusChange({\r\n      status: emp.map.states.MAP_SWAP_IN_PROGRESS\r\n    });\r\n    emp.transactionQueue.pause(mapInstanceId);\r\n    bReloadInProgress = true;\r\n\r\n    var oTransaction = new emp.typeLibrary.Transaction({\r\n      mapInstanceId: mapInstanceId,\r\n      intent: emp.intents.control.MAP_ENGINE_SWAP_START,\r\n      source: emp.core.sources.STORAGE,\r\n      items: []\r\n    });\r\n    oTransaction.run();\r\n    // perform cleanup of current map engine\r\n    try {\r\n      if (publicInterface.engine.hasOwnProperty('state')) {\r\n        // If a previous swap failed, publicInterface.engine is === {}\r\n        publicInterface.engine.state.destroy();\r\n      }\r\n\r\n      emp.storage.prepForMapSwap(mapInstanceId);\r\n    }\r\n    catch (err) {\r\n      emp.typeLibrary.Error({\r\n        jsError: err,\r\n        message: \"An exception occurred while calling engine.state.destroy before performing a map swap\",\r\n        level: emp.typeLibrary.Error.level.MINOR\r\n      });\r\n      emp.transactionQueue.run(mapInstanceId);\r\n    }\r\n\r\n    // Empty out the map.\r\n    publicInterface.engine = null;\r\n    loadMapEngine();\r\n  }\r\n\r\n  function verifyManifestLoaded() {\r\n    var previousMapEngineId,\r\n      previousMapEngineConfiguration,\r\n      currentMapEngineId = engineConfig.getCurrentMapEngineId(),\r\n      currentEngineConfiguration,\r\n      oMapRegistration = emp.instanceManager.getMapEngineRegistration(currentMapEngineId);\r\n\r\n    if (oMapRegistration) {\r\n      // The manifest loaded.\r\n      publicInterface.engineId = currentMapEngineId;\r\n    }\r\n    else {\r\n      currentEngineConfiguration = engineConfig.getCurrentEngineConfiguration();\r\n      // The manifest did not load.\r\n      if (publicInterface.engines.isMapSwapInProgress()) {\r\n        previousMapEngineId = engineConfig.getPreviousMapEngineId();\r\n        previousMapEngineConfiguration = emp.instanceManager.getMapEngineRegistration(previousMapEngineId).engineConfiguration;\r\n        window.console.error('Map manifest failed to load with config. Attempting to reload previous map.', currentEngineConfiguration);\r\n        document.getElementById(mapInstanceId + '_loadSpinner').style.visibility = \"hidden\";\r\n        document.getElementById(mapInstanceId + '_loadingMessage').style.visibility = \"visible\";\r\n        document.getElementById(mapInstanceId + '_loadingMessage').innerHTML = \"<h3 style='color:coral'>Swap Failed</h3>\";\r\n        document.getElementById(mapInstanceId + '_loadingStatus').innerHTML = '' +\r\n          '<div>The selected map\\'s manifest file failed to load. Attempting to reload previous map.</div>' +\r\n          '<div><span font-size:0.75em>See console for details...</span></div>';\r\n\r\n        var oTransaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          intent: emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,\r\n          source: emp.core.sources.STORAGE,\r\n          items: []\r\n        });\r\n        oTransaction.run();\r\n        // Turn the queue back on.\r\n        emp.transactionQueue.run(mapInstanceId);\r\n        bReloadInProgress = false;\r\n        // Assign something so its not null.\r\n        publicInterface.engine = {};\r\n        setTimeout(function () {\r\n          previousSwapFailed = true;\r\n          publicInterface.engines.load(previousMapEngineConfiguration);\r\n        }, 5000);\r\n      }\r\n      else {\r\n        window.console.error('Map manifest failed to load with config', currentEngineConfiguration);\r\n        document.getElementById(mapInstanceId + '_loadSpinner').style.visibility = \"hidden\";\r\n        document.getElementById(mapInstanceId + '_loadingMessage').innerHTML = \"<h3 style='color:coral'>Map Load Failed</h3>\";\r\n        document.getElementById(mapInstanceId + '_loadingStatus').innerHTML = '' +\r\n          '<div>The selected map\\'s manifest file failed to load.</div>' +\r\n          '<div>Contact your administrator</div>' +\r\n          '<div><span style=\"font-size:0.75em\">See console for details...</span></div>';\r\n      }\r\n    }\r\n  }\r\n\r\n  function loadMapEngine() {\r\n    var currentMapEngineId = engineConfig.getCurrentMapEngineId(),\r\n      currentEngineConfiguration = engineConfig.getCurrentEngineConfiguration();\r\n\r\n    if (!bReloadInProgress) {\r\n      bLoadInProgress = true;\r\n    }\r\n\r\n    if (previousSwapFailed) {\r\n      document.getElementById(mapInstanceId + '_loadingMessage').innerHTML = \"Loading Map\";\r\n      document.getElementById(mapInstanceId + '_loadingSpinner').style.visiblity = \"visible\";\r\n      previousSwapFailed = false;\r\n    }\r\n    document.getElementById(mapInstanceId + '_loadingStatus').innerHTML = \"Fetching map resources...\";\r\n    var mapNode = document.getElementById(mapInstanceId + '_map');\r\n    while (mapNode.firstChild) {\r\n      mapNode.removeChild(mapNode.firstChild);\r\n    }\r\n\r\n    var date = new Date();\r\n    var id = mapInstanceId + \"_\" + date.getTime();\r\n    // set the emp.map private variable to the id for later use\r\n    container = id;\r\n    var d = document.createElement('div');\r\n    d.id = id;\r\n    d.style.width = \"100%\";\r\n    d.style.height = \"100%\";\r\n\r\n    document.getElementById(mapInstanceId + '_map').appendChild(d);\r\n\r\n    setTimeout(function () {\r\n      var oMapRegistration = emp.instanceManager.getMapEngineRegistration(currentMapEngineId);\r\n\r\n      try {\r\n        if (oMapRegistration) {\r\n          var initialExtent = getStartupExtent();\r\n\r\n          // The map engine is already registered.\r\n          // so we can create a new instance.\r\n          document.getElementById(mapInstanceId + '_loadingStatus').innerHTML = \"All resources have loaded!\";\r\n          oMapRegistration.fnCreateInstance({\r\n            configProperties: currentEngineConfiguration.properties,\r\n            mapInstance: publicInterface,\r\n            extent: initialExtent\r\n          });\r\n          publicInterface.engineId = currentMapEngineId;\r\n          document.getElementById(mapInstanceId + '_loadingPanel').style.visibility = \"hidden\";\r\n        }\r\n        else {\r\n          // The map engine has not been loaded yet.\r\n          // So we load the manifest\r\n          completed = 0;\r\n          loadComplete = null;\r\n          loadScript({\r\n            url: currentEngineConfiguration.manifestUrl,\r\n            callback: manifestSuccess\r\n          });\r\n          setTimeout(verifyManifestLoaded, 10000);\r\n        }\r\n      }\r\n      catch (err) {\r\n        emp.instanceManager.mapInstanceStartupFailed(mapInstanceId);\r\n      }\r\n    }, 0);\r\n\r\n    if (bReloadInProgress) {\r\n      document.getElementById(mapInstanceId + '_loadingPanel').style.visiblity = \"visible\";\r\n    }\r\n  }\r\n\r\n  function handleDrawEditEnded() {\r\n  }\r\n\r\n  function handleDrawEditCanceled(oTransaction) {\r\n    if (bDoReload) {\r\n      // Start a timer which will kick off the reload.\r\n      setTimeout(function () {\r\n        processEngineSwapRequest(oTransaction.mapInstanceId);\r\n      }, 1000);\r\n    }\r\n    else if (bExecuteRemove) {\r\n      // Now we can continue the remove.\r\n      var oRTran = oRemoveTransaction;\r\n      // We need to fire this in a timer to ensure that it happens after\r\n      // the feature add generated by the cancel.\r\n      setTimeout(function () {\r\n        oRTran.run();\r\n      }, 50);\r\n      oRemoveTransaction = undefined;\r\n      bExecuteRemove = false;\r\n    }\r\n    else if (oEditDrawTransaction !== null) {\r\n      oEditDrawTransaction.run();\r\n      oEditDrawTransaction = null;\r\n    }\r\n  }\r\n\r\n  function removeListeners(mapInstanceId) {\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.STATUS_CHANGE,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handlerStatusChange\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.DRAW_BEGIN,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleTCDrawEditBegin\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.EDIT_BEGIN,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleTCDrawEditBegin\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.DRAW_START,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleDrawEditStart\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.EDIT_START,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleDrawEditStart\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.DRAW_ENDED,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleDrawEditEnded\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.EDIT_ENDED,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleDrawEditEnded\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.DRAW_CANCEL,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleDrawEditCanceled\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.EDIT_CANCEL,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: handleDrawEditCanceled\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.STORAGE_RELOAD_COMPLETE,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: storageReloadComplete\r\n    });\r\n  }\r\n\r\n  var publicInterface = {\r\n    engineId: \"\",\r\n    mapInstanceId: mapInstanceId,\r\n\r\n\r\n    /**\r\n     * Puts the map instance in freehand mode.  In freehand mode, mouse interaction\r\n     * events will no longer occur.  Instead, when a user mouse downs, it begins\r\n     * creating a line, the mouse moves updates the lines, and the mouse up updateSelectedMap\r\n     * the line.  Events are passed back to the users notifying the positions\r\n     * of the line as it is created, updated and complete.  On the mouse up the\r\n     * line is remove from the map.\r\n     */\r\n    freehandStart: function (args) {\r\n      // lock the map so it is in smart mode.\r\n      var transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.VIEW_LOCK,\r\n        mapInstanceId: mapInstanceId,\r\n        transactionId: \"\",\r\n        sender: \"\",\r\n        source: emp.api.cmapi.SOURCE,\r\n        originChannel: cmapi.channel.names.FREEHAND_START,\r\n        originalMessage: {},\r\n        messageOriginator: \"\",\r\n        originalMessageType: cmapi.channel.names.FREEHAND_START,\r\n        items: [{\r\n          lock: true // this needs to be in smart mode.\r\n        }]\r\n      });\r\n\r\n      this.engine.navigation.enable(transaction);\r\n      freehandMode = true;\r\n\r\n      // override the default freehand style if necessary.\r\n      if (args.freehandStrokeStyle) {\r\n        if (args.freehandStrokeStyle.strokeColor) {\r\n          freehandLineColorOverride = emp.util.convertColorToHexColor(args.freehandStrokeStyle.strokeColor);\r\n        }\r\n        if (args.freehandStrokeStyle.strokeWidth) {\r\n          freehandLineWidthOverride = args.freehandStrokeStyle.strokeWidth;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Gets the map out of freehand mode.\r\n     */\r\n    freehandStop: function () {\r\n      // lock the map so it is in smart mode.\r\n      var transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.VIEW_LOCK,\r\n        mapInstanceId: mapInstanceId,\r\n        transactionId: \"\",\r\n        sender: \"\",\r\n        source: emp.api.cmapi.SOURCE,\r\n        originChannel: cmapi.channel.names.FREEHAND_STOP,\r\n        originalMessage: {},\r\n        messageOriginator: \"\",\r\n        originalMessageType: cmapi.channel.names.FREEHAND_STOP,\r\n        items: [{\r\n          lock: false // this needs to be in smart mode.\r\n        }]\r\n      });\r\n\r\n      this.engine.navigation.enable(transaction);\r\n      freehandMode = false;\r\n      // reset any overrides.\r\n      freehandLineColorOverride = undefined;\r\n      freehandLineWidthOverride = undefined;\r\n    },\r\n\r\n    setFreehandStrokeStyle: function (strokeStyle) {\r\n\r\n      if (strokeStyle.strokeColor) {\r\n        freehandLineColor = emp.util.convertColorToHexColor(strokeStyle.strokeColor);\r\n      }\r\n\r\n      if (strokeStyle.strokeWidth) {\r\n        freehandLineWidth = strokeStyle.strokeWidth;\r\n      }\r\n    },\r\n\r\n\r\n    /**\r\n     * @memberOf emp.map\r\n     * @public\r\n     * @namespace\r\n     * @description This namespace encapsulates the emp.map eventing capabilities defined in publicInterface.\r\n     */\r\n    eventing: {\r\n\r\n      mapDrag: false,\r\n      mapDragStart: null,\r\n\r\n      /**\r\n       * used for core event suppression for toggling map engines\r\n       * @private\r\n       */\r\n      voice: {\r\n        silent: false,\r\n        silence: function (args) {\r\n          this.silent = args;\r\n        }\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This event generates a selection change transaction which will process through core and send out a message to API Handlers and UI components. It must\r\n       * be called by the map engine implementation when a features selection\r\n       * status changes.\r\n       * @param {emp.typeLibrary.Selection.ParameterType[]} args An array of selection parameter objects.\r\n       */\r\n      SelectionChange: function (args) {\r\n        var i,\r\n          len,\r\n          features = [],\r\n          success = false,\r\n          transaction;\r\n        try {\r\n\r\n          if (args.length < 1) {\r\n            features.push(new emp.typeLibrary.Selection({\r\n              \"type\": \"empty\"\r\n            }));\r\n          }\r\n          else {\r\n            len = args.length;\r\n            for (i = 0; i < len; i += 1) {\r\n              features.push(new emp.typeLibrary.Selection(args[i]));\r\n            }\r\n          }\r\n\r\n          transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstanceId,\r\n            intent: emp.intents.control.SELECTION_CHANGE,\r\n            intentParams: \"selected\",\r\n            originChannel: \"map.feature.selected\",\r\n            source: emp.core.sources.MAP,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            items: features\r\n          });\r\n          transaction.run();\r\n          success = true;\r\n        }\r\n        catch (e) {\r\n          success = false;\r\n          // generate en error which will be logged\r\n          emp.typeLibrary.Error({\r\n            message: \"A SelectionChange event created by the map engine threw an error\",\r\n            jsError: e,\r\n            level: 0\r\n          });\r\n        }\r\n        return success;\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a view change event. It must be called by a map engine implementation each\r\n       * time the maps view is changed.\r\n       * @param {emp.typeLibrary.View.ParameterType} viewArgs This parameter contains the data needed to generate the event.\r\n       * @param {emp.typeLibrary.LookAt.ParameterType} lookAtArgs This parameter contains the data needed to generate the lookAt\r\n       * @param {emp3.api.enums.CameraEventType} mapViewEventEnum\r\n       */\r\n      ViewChange: function (viewArgs, lookAtArgs, mapViewEventEnum) {\r\n\r\n        if (!bReloadInProgress) {\r\n          var view = new emp.typeLibrary.View(viewArgs);\r\n          // reverse the enum value\r\n          view.animate = (mapViewEventEnum === emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION ? 1 : 0);\r\n\r\n          var lookAt = new emp.typeLibrary.LookAt(lookAtArgs);\r\n          // reverse the enum value\r\n          lookAt.animate = (mapViewEventEnum === emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION ? 1 : 0);\r\n\r\n          // Set the stored map view for map swaps\r\n          oViewCenter.lat = view.location.lat;\r\n          oViewCenter.lon = view.location.lon;\r\n          dViewRange = view.range;\r\n          oViewBounds.north = view.bounds.north;\r\n          oViewBounds.south = view.bounds.south;\r\n          oViewBounds.east = view.bounds.east;\r\n          oViewBounds.west = view.bounds.west;\r\n\r\n          // Create the transaction for the view change\r\n          var transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstanceId,\r\n            originChannel: \"map.status.view\",\r\n            intent: emp.intents.control.VIEW_CHANGE,\r\n            source: emp.core.sources.MAP,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            items: [view, lookAt]\r\n          });\r\n          transaction.run();\r\n        }\r\n\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a pointer event. It must be called by\r\n       * a map engine implementation each time the maps mouse (Pointer) state changes.\r\n       * @param {emp.typeLibrary.Pointer.ParameterType} args This parameter contain data needed to create the event.\r\n       */\r\n      Pointer: function (args) {\r\n        var pointer = new emp.typeLibrary.Pointer(args),\r\n          intent = emp.intents.control.POINTER,\r\n          transaction,\r\n          fTransaction,\r\n          mapInstance = emp.instanceManager.getInstance(mapInstanceId),\r\n          dragPointer;\r\n\r\n        // retrieve the editingManager in case we are in edit mode.\r\n        var editingManager = mapInstance.editingManager.get();\r\n\r\n        // If we are not in freehand mode.\r\n        if (!freehandMode) {\r\n\r\n          // If the caller does not indicate the type ignore it and exit.\r\n          if (!args.type) {\r\n            return;\r\n          }\r\n\r\n          // First we are going to monitor if any drag events are occurring.\r\n          //   Check to see if this is a mouse down.\r\n          if (args.type === emp.typeLibrary.Pointer.EventType.MOUSEDOWN) {\r\n\r\n            //     Memorize location, if next event comes as a move with button still\r\n            //     down, then this is a drag.\r\n            if (mapInstance.status.get() === emp.map.states.EDIT) {\r\n\r\n              this.mapDragStart = {\r\n                featureId: pointer.featureId,\r\n                startX: pointer.clientX,\r\n                startY: pointer.clientY\r\n              };\r\n\r\n              editingManager.editMouseDown(pointer.featureId);\r\n            } else {\r\n              this.mapDragStart = {};\r\n            }\r\n\r\n          //  Check to see if this is a mouse move\r\n          } else if (args.type === emp.typeLibrary.Pointer.EventType.MOVE) {\r\n\r\n            // if mouse button is still down, start drag\r\n            if (this.mapDragStart && this.mapDrag !== true) {\r\n\r\n              // Were we over a feature when we started dragging?\r\n              if (this.mapDragStart.featureId && mapInstance.status.get() === emp.map.states.EDIT) {\r\n\r\n                this.mapDrag = true;\r\n\r\n                // create a feature drag event.\r\n                args.featureId = this.mapDragStart.featureId;\r\n                args.target = \"feature\";\r\n                args.type = emp.typeLibrary.Pointer.EventType.DRAG;\r\n\r\n                dragPointer = new emp.typeLibrary.Pointer(args);\r\n\r\n                // pass the transaction to the editingManager to determine if this\r\n                // transaction should be run.\r\n\r\n                editingManager.editDragStart(this.mapDragStart.featureId, dragPointer);\r\n\r\n              // We weren't over a feature we were over the map.\r\n              } else {\r\n                this.mapDrag = true;\r\n\r\n                args.type = emp.typeLibrary.Pointer.EventType.DRAG;\r\n                args.coreId = undefined;\r\n                args.featureId = undefined;\r\n                args.target = 'globe';\r\n\r\n                dragPointer = new emp.typeLibrary.Pointer(args);\r\n\r\n                fTransaction = new emp.typeLibrary.Transaction({\r\n                  mapInstanceId: mapInstanceId,\r\n                  intent: intent,\r\n                  originChannel: \"cmapi2.map.view.drag\",\r\n                  source: emp.core.sources.MAP,\r\n                  transactionId: emp.helpers.id.newGUID(),\r\n                  items: [dragPointer]\r\n                });\r\n                fTransaction.run();\r\n              }\r\n            } else if (this.mapDragStart && this.mapDrag === true &&\r\n                this.mapDragStart.featureId && mapInstance.status.get() === emp.map.states.EDIT &&\r\n                this.mapDrag === true) {\r\n              // pass the pointer to editor manager. to decide if\r\n              mapInstance.editingManager.get().editDragMove(\r\n                this.mapDragStart.featureId,\r\n                this.mapDragStart.startX,\r\n                this.mapDragStart.startY,\r\n                pointer);\r\n            }\r\n          //   Check to see if this is a mouse up\r\n          } else if (args.type === emp.typeLibrary.Pointer.EventType.MOUSEUP) {\r\n            //     if this is a mouse up and there was a previous drag,\r\n            //       send the drag complete event.\r\n            if (this.mapDrag) {\r\n\r\n              if (this.mapDragStart.featureId) {\r\n                args.type = emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE;\r\n                args.target = \"feature\";\r\n                args.featureId = this.mapDragStart.featureId;\r\n                dragPointer = new emp.typeLibrary.Pointer(args);\r\n\r\n                // let the editingManager decide if event should be raised.\r\n                mapInstance.editingManager.get().editDragComplete(\r\n                  this.mapDragStart.featureId,\r\n                  this.mapDragStart.startX,\r\n                  this.mapDragStart.startY,\r\n                  dragPointer);\r\n\r\n                this.mapDragStart = null;\r\n                this.mapDrag = false;\r\n              } else {\r\n                args.type = emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE;\r\n                args.coreId = undefined;\r\n                args.featureId = undefined;\r\n                args.target = 'globe';\r\n                dragPointer = new emp.typeLibrary.Pointer(args);\r\n                fTransaction = new emp.typeLibrary.Transaction({\r\n                  mapInstanceId: mapInstanceId,\r\n                  intent: intent,\r\n                  originChannel: \"cmapi2.map.view.dragComplete\",\r\n                  source: emp.core.sources.MAP,\r\n                  transactionId: emp.helpers.id.newGUID(),\r\n                  items: [dragPointer]\r\n                });\r\n                fTransaction.run();\r\n                this.mapDragStart = null;\r\n                this.mapDrag = false;\r\n              }\r\n            }\r\n          }\r\n\r\n          // For transactions we need to separate pointer move events from click events\r\n          // Use the transaction intent for this\r\n          if ((args.type === emp.typeLibrary.Pointer.EventType.SINGLE_CLICK) ||\r\n            (args.type === emp.typeLibrary.Pointer.EventType.DBL_CLICK)) {\r\n            intent = emp.intents.control.CLICK;\r\n            // Check to see if this is a feature click.\r\n            // We will dispatch an additional event for feature clicks\r\n            // in addition to a map click if the click event contains a feature\r\n            if (pointer.target.toLowerCase() === \"feature\") {\r\n              fTransaction = new emp.typeLibrary.Transaction({\r\n                mapInstanceId: mapInstanceId,\r\n                intent: emp.intents.control.FEATURE_CLICK,\r\n                originChannel: \"map.feature.clicked\",\r\n                source: emp.core.sources.MAP,\r\n                transactionId: emp.helpers.id.newGUID(),\r\n                items: [pointer]\r\n              });\r\n              fTransaction.run();\r\n            }\r\n          }\r\n\r\n          transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstanceId,\r\n            intent: intent,\r\n            originChannel: \"map.view.clicked\",\r\n            source: emp.core.sources.MAP,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            items: [pointer]\r\n          });\r\n          transaction.run();\r\n        }\r\n        else {\r\n          // We are in freehand mode\r\n\r\n          // If this is a mouse down start drawing. We need to send out an\r\n          // event that notifies the API that the line draw started.  When\r\n          // the mouse up event occurs, the line draw completes.\r\n          if (args.type === emp.typeLibrary.Pointer.EventType.MOUSEDOWN) {\r\n            freehandModeDrawStart = true;\r\n\r\n            freehandFeature.data.coordinates.push([pointer.lon, pointer.lat]);\r\n            // Assign a parent to the feature.  Why mapInstanceId?  It was\r\n            // available on Cesium as an overlay that was already added, and\r\n            // we did not have to wait for it to be created.   Make this much\r\n            // simpler.\r\n            freehandFeature.overlayId = mapInstanceId;\r\n            freehandFeature.parentCoreId = mapInstanceId;\r\n\r\n            if (freehandLineColorOverride) {\r\n              freehandFeature.properties.lineColor = freehandLineColorOverride;\r\n            } else {\r\n              freehandFeature.properties.lineColor = freehandLineColor;\r\n            }\r\n\r\n            if (freehandLineWidthOverride) {\r\n              freehandFeature.properties.lineWidth = freehandLineWidthOverride;\r\n            } else {\r\n              freehandFeature.properties.lineWidth = freehandLineWidth;\r\n            }\r\n\r\n            // Send out an event that says we started the line draw.\r\n            transaction = new emp.typeLibrary.Transaction({\r\n              mapInstanceId: mapInstanceId,\r\n              intent: emp.intents.control.FREEHAND_LINE_DRAW_START,\r\n              originChannel: \"cmapi2.map.freehand\",\r\n              source: emp.core.sources.MAP,\r\n              transactionId: emp.helpers.id.newGUID(),\r\n              items: [freehandFeature]\r\n            });\r\n            transaction.run();\r\n\r\n          }\r\n          else if (args.type === emp.typeLibrary.Pointer.EventType.MOUSEUP) {\r\n\r\n            // End the line draw.  Remove the line that we put on the map.\r\n            // We call the engines remove call, specifically not sending it\r\n            // throught the queue as to prevent events bubbling up to the API.\r\n            freehandModeDrawStart = false;\r\n            freehandFeature.data.coordinates.push([pointer.lon, pointer.lat]);\r\n\r\n\r\n            // remove the freehand graphic from the map.\r\n            transaction = new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.FEATURE_REMOVE,\r\n              mapInstanceId: mapInstanceId,\r\n              originChannel: cmapi.channel.names.FEATURE_REMOVE,\r\n              source: emp.core.sources.MAP,\r\n              items: [freehandFeature]\r\n            });\r\n\r\n            if (mapInstance && mapInstance.engine) {\r\n              mapInstance.engine.feature.remove(transaction);\r\n            }\r\n\r\n            // Create a freehand line draw end event.\r\n            transaction = new emp.typeLibrary.Transaction({\r\n              mapInstanceId: mapInstanceId,\r\n              intent: emp.intents.control.FREEHAND_LINE_DRAW_END,\r\n              originChannel: \"cmapi2.map.freehand\",\r\n              source: emp.core.sources.MAP,\r\n              transactionId: emp.helpers.id.newGUID(),\r\n              items: [freehandFeature]\r\n            });\r\n            transaction.run();\r\n\r\n            // reset the freehandFeature so that it resets its points.\r\n            freehandFeature.data.coordinates = [];\r\n\r\n          }\r\n          else if (args.type === emp.typeLibrary.Pointer.EventType.MOVE &&\r\n            freehandModeDrawStart) {\r\n\r\n            // add the freehand feature to the map if this is the first time,\r\n            // otherwise this add transaction will update the feature.\r\n            freehandFeature.data.coordinates.push([pointer.lon, pointer.lat]);\r\n\r\n            transaction = new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.FEATURE_ADD,\r\n              mapInstanceId: mapInstanceId,\r\n              originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n              source: emp.core.sources.MAP,\r\n              items: [freehandFeature]\r\n            });\r\n\r\n            if (mapInstance && mapInstance.engine) {\r\n              mapInstance.engine.feature.add(transaction);\r\n            }\r\n\r\n            // now send an event out that notifies of a freenad line draw upate.\r\n            transaction = new emp.typeLibrary.Transaction({\r\n              mapInstanceId: mapInstanceId,\r\n              intent: emp.intents.control.FREEHAND_LINE_DRAW_UPDATE,\r\n              originChannel: \"cmapi2.map.freehand\",\r\n              source: emp.core.sources.MAP,\r\n              transactionId: emp.helpers.id.newGUID(),\r\n              items: [freehandFeature]\r\n            });\r\n            transaction.run();\r\n          }\r\n        }\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a SelectionBox event. It must be called by\r\n       * a map engine implementation at the end of the area selection event.\r\n       * @param {emp.typeLibrary.SelectionBox.ParameterType} args This parameter contain data needed to create the event.\r\n       */\r\n      SelectionBox: function (args) {\r\n        var viewArea = new emp.typeLibrary.SelectionBox(args),\r\n          transaction;\r\n        transaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          source: \"CORE-EVENTING\",\r\n          intent: emp.intents.control.SELECTION_BOX,\r\n          originChannel: \"map.view.area.selected\",\r\n          sender: \"EMP_MAP_CORE\",\r\n          transactionId: emp.helpers.id.newGUID(),\r\n          items: [viewArea]\r\n        });\r\n        transaction.run();\r\n      },\r\n      StaticContent: function (args) {\r\n\r\n        var transaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          intent: emp.intents.control.STATIC_CONTENT,\r\n          transactionId: emp.helpers.id.newGUID(),\r\n          source: emp.core.sources.MAP,\r\n          items: args\r\n        });\r\n        transaction.run();\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates an error event. It must be called by\r\n       * a map engine implementation each time the maps encounters an error condition.\r\n       * @param {emp.typeLibrary.Error.ParameterType} args This parameter contain the data needed to generate the event.\r\n       */\r\n      Error: function (args) {\r\n        var error = emp.typeLibrary.Error(args),\r\n          transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstanceId,\r\n            intent: emp.intents.control.ERROR,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            source: emp.core.sources.MAP,\r\n            items: [error]\r\n          });\r\n        transaction.run();\r\n      },\r\n      /**\r\n       * @public\r\n       * @description Sends a message that the map engine has changed status.\r\n       *  Engines can have any of the states defined in emp.map.states.\r\n       * @param {emp.typeLibrary.Status.ParameterType} args This parameter contains all the data needed to generate the event.\r\n       */\r\n      StatusChange: function (args) {\r\n        var newStatus = new emp.typeLibrary.Status(args),\r\n          transaction = new emp.typeLibrary.Transaction({\r\n            mapInstanceId: mapInstanceId,\r\n            intent: emp.intents.control.STATUS_CHANGE,\r\n            intentParams: \"initialization\",\r\n            originChannel: \"map.status.request\",\r\n            source: emp.core.sources.MAP,\r\n            transactionId: emp.helpers.id.newGUID(),\r\n            items: [newStatus]\r\n          });\r\n\r\n        if ((newStatus.status !== undefined) && (newStatus.status !== null)) {\r\n          publicInterface.status.set(newStatus.status);\r\n        }\r\n        transaction.run();\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a draw start event. It indicates that a draw\r\n       * operation has been started. It must be called by\r\n       * a map engine implementation at the start of the draw operation.\r\n       * @param {object} args This parameter contain the draw start transaction.\r\n       * @param {emp.typeLibrary.Transaction} args.transaction It must contain a reference to the instance of the draw start transaction passed to the map engine.\r\n       */\r\n      DrawStart: function (args) {\r\n        if (args.hasOwnProperty(\"failures\")) {\r\n          args.transaction.fail(args.failures);\r\n        }\r\n        if (publicInterface.eventing.voice.silent) {\r\n          args.transaction.success = [];\r\n        }\r\n        var transaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          intent: emp.intents.control.DRAW_START,\r\n          transactionId: emp.helpers.id.newGUID(),\r\n          source: emp.core.sources.MAP,\r\n          items: [args.transaction]\r\n        });\r\n\r\n        transaction.run();\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a draw end event. It indicates that a draw\r\n       * operation has finished. It must be called by\r\n       * a map engine implementation at the end of the draw operation.\r\n       * @param {object} args This parameter contain the draw start transaction.\r\n       * @param {emp.typeLibrary.Transaction} args.transaction It must contain a reference to the instance of the draw start transaction passed to the map engine.\r\n       * @param {emp.typeLibrary.Error} args.failures Contain a reference to an array of error if the draw is being canceled.\r\n       */\r\n      DrawEnd: function (args) {\r\n\r\n        var oDraw = args.transaction.items[0];\r\n\r\n        if (args.hasOwnProperty(\"failures\")) {\r\n          args.transaction.fail([{\r\n            coreId: oDraw.coreId,\r\n            level: emp.typeLibrary.Error.level.INFO,\r\n            message: \"Operation Canceled.\"\r\n          }]);\r\n\r\n          if (oDraw !== undefined) {\r\n            args.transaction.duplicateItems.push(oDraw);\r\n            oDraw.cancel({\r\n              mapInstanceId: mapInstanceId\r\n            });\r\n          }\r\n        }\r\n        else if (oDraw !== undefined) {\r\n          oDraw.end({\r\n            mapInstanceId: mapInstanceId,\r\n            source: args.transaction.source\r\n          });\r\n        }\r\n\r\n        if (publicInterface.eventing.voice.silent) {\r\n          args.transaction.success = [];\r\n        }\r\n\r\n        var transaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          intent: emp.intents.control.DRAW_ENDED,\r\n          source: emp.core.sources.MAP,\r\n          items: [args.transaction]\r\n        });\r\n\r\n        transaction.run();\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a edit start event. It indicates that an edit\r\n       * operation has been started. It must be called by\r\n       * a map engine implementation at the start of the edit operation.\r\n       * @param {object} args This parameter contain the edit start transaction.\r\n       * @param {emp.typeLibrary.Transaction} args.transaction It must contain a reference to the instance of the edit start transaction passed to the map engine.\r\n       */\r\n      EditStart: function (args) {\r\n        if (args.hasOwnProperty(\"failures\")) {\r\n          args.transaction.fail(args.failures);\r\n        }\r\n        if (publicInterface.eventing.voice.silent) {\r\n          args.transaction.success = [];\r\n        }\r\n\r\n        var transaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          intent: emp.intents.control.EDIT_START,\r\n          transactionId: emp.helpers.id.newGUID(),\r\n          source: emp.core.sources.MAP,\r\n          items: [args.transaction]\r\n        });\r\n\r\n        transaction.run();\r\n      },\r\n      /**\r\n       * @public\r\n       * @description This call generates a edit end event. It indicates that an edit\r\n       * operation has finished. It must be called by\r\n       * a map engine implementation at the end of the edit operation.\r\n       * @param {object} args This parameter contain the edit start transaction.\r\n       * @param {emp.typeLibrary.Transaction} args.transaction It must contain a reference to the instance of the edit start transaction passed to the map engine.\r\n       * @param {emp.typeLibrary.Error} args.failures Contain a reference to an array of error if the edit is being canceled.\r\n       */\r\n      EditEnd: function (args) {\r\n\r\n        var oEdit = args.transaction.items[0];\r\n        if (args.hasOwnProperty(\"failures\")) {\r\n          args.transaction.fail([{\r\n            coreId: oEdit.coreId,\r\n            level: emp.typeLibrary.Error.level.INFO,\r\n            message: \"Operation Canceled.\"\r\n          }]);\r\n        }\r\n        if (publicInterface.eventing.voice.silent) {\r\n          args.transaction.success = [];\r\n        }\r\n\r\n        if (args.hasOwnProperty(\"failures\")) {\r\n          args.transaction.duplicateItems.push(oEdit);\r\n          oEdit.cancel({\r\n            mapInstanceId: mapInstanceId\r\n          });\r\n        }\r\n        else {\r\n          oEdit.end({\r\n            mapInstanceId: mapInstanceId\r\n          });\r\n        }\r\n\r\n        var transaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: mapInstanceId,\r\n          intent: emp.intents.control.EDIT_ENDED,\r\n          source: emp.core.sources.MAP,\r\n          items: [args.transaction]\r\n        });\r\n\r\n        transaction.run();\r\n      }\r\n    },\r\n\r\n    status: {\r\n      get: function () {\r\n        // When a map engine emits a ststus change event, the dispatchEvent function\r\n        // catches it and sets the publicInterface.status object to the current engine status\r\n        return currentStatus.status;\r\n      },\r\n      set: function (args) {\r\n        // When a map engine emits a status change event, the dispatchEvent function\r\n        // catches it and sets the publicInterface.status object to the current engine status\r\n        currentStatus.status = args;\r\n      },\r\n      getViewBounds: function () {\r\n        return oViewBounds;\r\n      },\r\n      getViewCenter: function () {\r\n        return oViewCenter;\r\n      },\r\n      getViewRange: function () {\r\n        return dViewRange;\r\n      },\r\n      getMapLockStatus: function() {\r\n        return currentStatus.mapLockStatus;\r\n      },\r\n      setMapLockStatus: function(status) {\r\n        currentStatus.mapLockStatus = status;\r\n      },\r\n      validateState: function (oTransaction) {\r\n        var bSuccess = true,\r\n          sErrorMsg = \"\",\r\n          //sNewState,\r\n          bConfirmResponse,\r\n          confirmationMessage = \"\";\r\n\r\n        if (oTransaction.intent === emp.intents.control.DRAW_BEGIN) {\r\n          switch (publicInterface.status.get()) {\r\n            case emp.map.states.EDIT:\r\n              confirmationMessage = 'A new draw command has started while in edit mode. Click \"OK\" to cancel the current edit operation and begin drawing a new feature.  Click \"Cancel\" to ignore the new draw command and continue editing the current feature.';\r\n              break;\r\n            case emp.map.states.DRAW:\r\n              confirmationMessage = 'A new draw command has started while in draw mode. Click \"OK\" to cancel the current draw operation and begin drawing a new feature.  Click \"Cancel\" to ignore the new draw command and continue drawing the current feature.';\r\n              break;\r\n            default:\r\n              //sNewState = emp.map.states.DRAW;\r\n              break;\r\n          }\r\n        }\r\n        else if (oTransaction.intent === emp.intents.control.EDIT_BEGIN) {\r\n          switch (publicInterface.status.get()) {\r\n            case emp.map.states.EDIT:\r\n              confirmationMessage = 'A new edit command has started while in edit mode. Click \"OK\" to cancel the current edit operation and begin editing a different feature.  Click \"Cancel\" to ignore the new edit command and continue editing the current feature.';\r\n              break;\r\n            case emp.map.states.DRAW:\r\n              confirmationMessage = 'A new edit command has started while in draw mode. Click \"OK\" to cancel the current draw operation and begin editing a different feature.  Click \"Cancel\" to ignore the new edit command and continue drawing the current feature.';\r\n              break;\r\n            default:\r\n              //sNewState = emp.map.states.EDIT;\r\n              break;\r\n          }\r\n        }\r\n        // check to see if we need to display confirmation window\r\n        // in fo confirmation is needed, the message will be an empty string\r\n        if (confirmationMessage !== \"\") {\r\n          bConfirmResponse = confirm(confirmationMessage);\r\n          if (bConfirmResponse) {\r\n            oEditDrawTransaction = oTransaction;\r\n            oTransaction.pause();\r\n            // Start the cancel on a timer so we have time to return to the paused transaction.\r\n            setTimeout(publicInterface.engines.drawEditCancel(), 100);\r\n          }\r\n          else {\r\n            bSuccess = false;\r\n            sErrorMsg = \"Draw or Edit command cancelled by user due to an existing draw or edit already in progress.\";\r\n          }\r\n        }\r\n        if (!bSuccess) {\r\n          // Fail the request.\r\n          while (oTransaction.items.length > 0) {\r\n            oTransaction.fail([{\r\n              coreId: oTransaction.items[0].coreId,\r\n              level: emp.typeLibrary.Error.level.MINOR,\r\n              message: sErrorMsg\r\n            }]);\r\n          }\r\n        }\r\n\r\n        return true;\r\n      },\r\n      cancelDrawEditForOverlayRemove: function (oTransaction) {\r\n        var oOverlay,\r\n          oParent,\r\n          sParentKey,\r\n          bExecuteCancel = false,\r\n          iIndex;\r\n\r\n        switch (publicInterface.status.get()) {\r\n          case emp.map.states.EDIT:\r\n          case emp.map.states.DRAW:\r\n            // We are in Draw or Edit mode.\r\n            // Check to see if the remove will affect the feature.\r\n            // And if so, cancel the Draw/Edit.\r\n            sParentKey = emp.helpers.id.get.coreParent(oDrawEditOperation);\r\n\r\n            while (!bExecuteCancel && (sParentKey !== emp.storage.getRootGuid(this.mapInstanceId))) {\r\n              for (iIndex = 0; iIndex < oTransaction.items.length; iIndex++) {\r\n                oOverlay = oTransaction.items[iIndex];\r\n\r\n                if (sParentKey === oOverlay.coreId) {\r\n                  // This overlay is a parent of the one being edit/draw.\r\n                  bExecuteCancel = true;\r\n                  break;\r\n                }\r\n              }\r\n\r\n              if (!bExecuteCancel) {\r\n                // Get the features parent\r\n                oParent = emp.storage._storage.get({\r\n                  coreId: sParentKey\r\n                });\r\n\r\n                if (oParent) {\r\n                  sParentKey = oParent.coreParent;\r\n                }\r\n                else {\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n\r\n            if (bExecuteCancel) {\r\n              oTransaction.pause();\r\n              oRemoveTransaction = oTransaction;\r\n              bExecuteRemove = true;\r\n              // Start the cancel on a timer so we have time to return to the paused transaction.\r\n              setTimeout(publicInterface.engines.drawEditCancel(), 100);\r\n            }\r\n            else {\r\n              bExecuteRemove = false;\r\n            }\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n\r\n        return true;\r\n      },\r\n      cancelDrawEditForFeatureRemove: function (oTransaction) {\r\n        var sDrawEditKey,\r\n          bExecuteCancel = false,\r\n          iIndex = 0;\r\n\r\n        switch (publicInterface.status.get()) {\r\n          case emp.map.states.EDIT:\r\n          case emp.map.states.DRAW:\r\n            // We are in Draw or Edit mode.\r\n            // Check to see if the remove will affect the feature.\r\n            // And if so, cancel the Draw/Edit.\r\n\r\n            // Get the key of the feature in Draw/Edit.\r\n            sDrawEditKey = oDrawEditOperation.coreId;\r\n\r\n            for (iIndex = 0; iIndex < oTransaction.items.length; iIndex++) {\r\n\r\n              if (oTransaction.items[iIndex].coreId === sDrawEditKey) {\r\n                // The Feature in Draw/Edit is being removed.\r\n                bExecuteCancel = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (bExecuteCancel) {\r\n              oTransaction.pause();\r\n              oRemoveTransaction = oTransaction;\r\n              bExecuteRemove = true;\r\n              // Start the cancel on a timer so we have time to return to the paused transaction.\r\n              setTimeout(publicInterface.engines.drawEditCancel, 50);\r\n            }\r\n            else {\r\n              bExecuteRemove = false;\r\n            }\r\n            break;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    },\r\n\r\n    configuration: {\r\n      formats: [],\r\n      burstSoftLimit: 200\r\n    },\r\n    engines: {\r\n      isMapSwapInProgress: function () {\r\n        return bReloadInProgress;\r\n      },\r\n      isInitialLoadInProgress: function () {\r\n        return bLoadInProgress;\r\n      },\r\n      validateOverlayRemoval: function (oTransaction) {\r\n        var oOverlay,\r\n          iIndex;\r\n\r\n        for (iIndex = 0; iIndex < oTransaction.items.length; iIndex++) {\r\n          oOverlay = oTransaction.items[iIndex];\r\n\r\n          if (oOverlay.overlayId === publicInterface.engines.getDefaultLayerOverlayID(oTransaction.mapInstanceId)) {\r\n            oTransaction.fail(emp.typeLibrary.Error({\r\n              coreId: oOverlay.coreId,\r\n              level: emp.typeLibrary.Error.level.MINOR,\r\n              message: \"The default layer overlay can not be removed.\"\r\n            }));\r\n          }\r\n          else if (oOverlay.overlayId === emp.wms.manager.getWmsOverlayId(oTransaction.mapInstanceId)) {\r\n            oTransaction.fail(emp.typeLibrary.Error({\r\n              coreId: oOverlay.coreId,\r\n              level: emp.typeLibrary.Error.level.MINOR,\r\n              message: \"The WMS Service overlay can not be removed.\"\r\n            }));\r\n          }\r\n        }\r\n      },\r\n      validateOverlayClear: function (oTransaction) {\r\n        var oOverlay,\r\n          iIndex;\r\n\r\n        for (iIndex = 0; iIndex < oTransaction.items.length; iIndex++) {\r\n          oOverlay = oTransaction.items[iIndex];\r\n\r\n          if (oOverlay.overlayId === publicInterface.engines.getDefaultLayerOverlayID(oTransaction.mapInstanceId)) {\r\n            oTransaction.fail(emp.typeLibrary.Error({\r\n              coreId: oOverlay.coreId,\r\n              level: emp.typeLibrary.Error.level.MINOR,\r\n              message: \"The default layer overlay can not be cleared.\"\r\n            }));\r\n          }\r\n          else if (oOverlay.overlayId === emp.wms.manager.getWmsOverlayId(oTransaction.mapInstanceId)) {\r\n            oTransaction.fail(emp.typeLibrary.Error({\r\n              coreId: oOverlay.coreId,\r\n              level: emp.typeLibrary.Error.level.MINOR,\r\n              message: \"The WMS Service overlay can not be cleared.\"\r\n            }));\r\n          }\r\n        }\r\n      },\r\n      getDefaultLayerOverlayID: function () {\r\n        return sDefaultLayerOverlayID;\r\n      },\r\n      /**\r\n       * @memberOf publicInterface.engines\r\n       * @public\r\n       * @description This function must be called to cancel an outstanding draw or\r\n       * edit operation.\r\n       */\r\n      drawEditCancel: function () {\r\n        emp.transactionQueue.cancel(sDrawEditTransactionID);\r\n      },\r\n\r\n      /**\r\n       * @memberOf publicInterface.engines\r\n       * @public\r\n       * @description This function must be called to complete an outstanding draw or\r\n       * edit operation.\r\n       */\r\n      drawEditComplete: function () {\r\n        emp.transactionQueue.end(sDrawEditTransactionID);\r\n      },\r\n\r\n      /**\r\n       * @memberOf publicInterface.engines\r\n       * @public\r\n       */\r\n      load: function (args) {\r\n        var sTempText = \"\",\r\n          bProceedWithSwap;\r\n\r\n        if (args.hasOwnProperty(\"mapEngineId\") && !emp.helpers.isEmptyString(args.mapEngineId) &&\r\n          args.hasOwnProperty(\"engineBasePath\") && !emp.helpers.isEmptyString(args.engineBasePath)) {\r\n          // Check to make sure manifestName field is populated\r\n          args.manifestName = args.manifestName || \"manifest.js\";\r\n          args.properties = args.properties || {};\r\n          // Check engineBasePath for \"/\" ending character\r\n          args.engineBasePath = args.engineBasePath.substr(args.engineBasePath.length - 1) !== \"/\" ? args.engineBasePath + \"/\" : args.engineBasePath;\r\n        }\r\n        else {\r\n          throw new Error(\"Required engine configuration properties missing.\");\r\n        }\r\n        args.manifestUrl = args.engineBasePath + args.manifestName;\r\n        engineConfig.setCurrentEngineConfiguration(args);\r\n        if (publicInterface.engine !== null) {\r\n          if (publicInterface.status.get() === emp.map.states.DRAW) {\r\n            sTempText = \"Draw\";\r\n          }\r\n          else if (publicInterface.status.get() === emp.map.states.EDIT) {\r\n            sTempText = \"Edit\";\r\n          }\r\n          if ((publicInterface.status.get() === emp.map.states.DRAW) ||\r\n            (publicInterface.status.get() === emp.map.states.EDIT)) {\r\n            bProceedWithSwap = confirm(\"Swapping map engines at this time will cancel the \" +\r\n              sTempText + \" operation.\\nDo you want to cancel the operation and swap the map engines?\");\r\n            if (bProceedWithSwap) {\r\n              // The user said yes. Store the index of the engine to load,\r\n              // set the reload and\r\n              // cancel the operation.\r\n              // Once we get the ended event we continue\r\n              // with the swap.\r\n              bDoReload = true;\r\n              publicInterface.engines.drawEditCancel();\r\n            }\r\n            return;\r\n          }\r\n          // If there is an engine we are swapping.\r\n          processEngineSwapRequest(mapInstanceId);\r\n          publicInterface.engineDirect = engDirectDefault;\r\n        }\r\n        else {\r\n          publicInterface.engineDirect = engDirectDefault;\r\n          loadMapEngine();\r\n        }\r\n      },\r\n      //loadResources() is not used in V3 environment only V2. Maybe delete this code?\r\n      /**\r\n       * @memberOf publicInterface.engines\r\n       * @public\r\n       * @param Manifest - The manifest is a javascript object contained in the map engines manifest.js file.\r\n       * See Tutorial...\r\n       * begin drawing a feature.\r\n       * @desc This function is called by the manifest.js file for a map engine.  When the script loads and parses it should have a call to publicInterface.engines.loadResources(manifest)\r\n       * passing the manifest object so the widget can load the script resources for the given map engine.  Once all scripts are loaded the map will\r\n       * @method\r\n       */\r\n      /* It should be formatted as follows:\r\n       {resources: [\"path to script file here\",\"path to script file here\"], callback: function(){\r\n       initialization code here which calls publicInterface.engines.set(engine) with a new map engine\r\n       }}*/\r\n\r\n      loadResources: function (manifest) {\r\n        var sManifestURL = emp.helpers.relToAbs(sManifestFile);\r\n        var oMapRegistration = emp.instanceManager.getMapEngineRegistration(sManifestURL);\r\n\r\n        if (oMapRegistration) {\r\n          oMapRegistration.fnCreateInstance = manifest.fnCreateInstance;\r\n          publicInterface.engineName = oMapRegistration.name;\r\n        }\r\n        resources = manifest.resourceList;\r\n        resourceLen = resources.length;\r\n        loadComplete = manifest.fnCreateInstance;\r\n        var resource = resources.shift();\r\n        loadResource({\r\n          url: resource,\r\n          callback: loadNextResource\r\n        });\r\n      },\r\n      // Allows the engine provider to be changed to a different map\r\n      // The status of map engine changes to loading\r\n      // Once the load complete event fires the map should be repopulated with data\r\n      set: function (engine) {\r\n        // set to a new map engine\r\n        activeEngine = engine;\r\n        activeEngine.init();\r\n      }\r\n\r\n    },\r\n    editingManager: {\r\n      get:  function() {\r\n        return editingManager;\r\n      }\r\n    },\r\n    container: {\r\n      get: function () {\r\n        return container;\r\n      }\r\n    },\r\n    // backdoor access to the map engines underlying sdk like google earth api, cesium, etc\r\n    // This value must be assigned by map engine in the initSuccess function\r\n    engineDirect: engDirectDefault,\r\n    engine: activeEngine,\r\n    init: function () {\r\n      var oRootOverlay;\r\n\r\n      editingManager = new emp.editingManager({\r\n        mapInstance: this\r\n      });\r\n\r\n      // This config parameter may be used in the future when\r\n      // a unique map instance config object is created which\r\n      // will contain instance specific configurations.\r\n      //      config = args.config;\r\n      //setup our callback for status changes.\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.STATUS_CHANGE,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handlerStatusChange\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.DRAW_BEGIN,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleTCDrawEditBegin\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.EDIT_BEGIN,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleTCDrawEditBegin\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.DRAW_START,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleDrawEditStart\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.EDIT_START,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleDrawEditStart\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.DRAW_ENDED,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleDrawEditEnded\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.EDIT_ENDED,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleDrawEditEnded\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.DRAW_CANCEL,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleDrawEditCanceled\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.EDIT_CANCEL,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: handleDrawEditCanceled\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.STORAGE_RELOAD_COMPLETE,\r\n        mapInstanceId: this.mapInstanceId,\r\n        callback: storageReloadComplete\r\n      });\r\n\r\n      oRootOverlay = emp.storage.findObject(emp.storage.getRootGuid(this.mapInstanceId));\r\n      oTransaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.MI_OVERLAY_ADD,\r\n        mapInstanceId: this.mapInstanceId,\r\n        items: [oRootOverlay.getObjectData(this.mapInstanceId, undefined)]\r\n      });\r\n      oTransaction.queue();\r\n\r\n      sDefaultLayerOverlayID = emp.helpers.id.newGUID();\r\n\r\n      var oDefaultLayerOverlay = new emp.typeLibrary.Overlay({\r\n        overlayId: sDefaultLayerOverlayID,\r\n        name: \"Layers\",\r\n        description: \"This overlay groups all KML, GEOJSON, Image feature urls plotted with no overlay defined.\",\r\n        permissions: true,\r\n        hidden: true\r\n      });\r\n\r\n      var oTransaction = new emp.typeLibrary.Transaction({\r\n        mapInstanceId: this.mapInstanceId,\r\n        intent: emp.intents.control.OVERLAY_ADD,\r\n        source: emp.core.sources.CORE,\r\n        items: [oDefaultLayerOverlay]\r\n      });\r\n\r\n      oTransaction.queue();\r\n    },\r\n    discardInstance: function () {\r\n      removeListeners(this.mapInstanceId);\r\n\r\n      if (publicInterface.engine) {\r\n        publicInterface.engine.state.destroy();\r\n        delete publicInterface.engine;\r\n        publicInterface.engine = undefined;\r\n      }\r\n    }\r\n  }; // End public interface\r\n\r\n  currentStatus = {\r\n    status: emp.map.states.IDLE\r\n  };\r\n  return publicInterface;\r\n\r\n};\r\n\r\n/**\r\n * @memberOf emp.map\r\n * @public\r\n * @readonly\r\n * @enum\r\n * @desc This enumeration contains the constants that represent the different states defined for publicInterface.\r\n */\r\nemp.map.states = {\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the initialization state of the map.\r\n   */\r\n  INITIALIZING: \"init\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map has been initialized and is prepared to process requests.\r\n   */\r\n  READY: \"ready\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing an error state.\r\n   */\r\n  ERROR: \"error\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map has been initialized and is not processing any requests.\r\n   */\r\n  IDLE: \"idle\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map is currently in an edit state.\r\n   */\r\n  EDIT: \"edit\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map is currently in draw mode.\r\n   */\r\n  DRAW: \"draw\",\r\n\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map is currently in freehand draw mode.\r\n   */\r\n  FREEHAND: \"freehand\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map is shutting down.\r\n   */\r\n  TEARDOWN: \"teardown\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map swap is in progress.\r\n   */\r\n  MAP_SWAP_IN_PROGRESS: 'mapswapinprogress',\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map has begun the process of shutting down.\r\n   */\r\n  SHUTDOWN_IN_PROGRESS: 'shutdowninprogress',\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the state in which the map instance initialization failed.\r\n   */\r\n  MAP_INSTANCE_INIT_FAILED: 'mapInstanceInitFailed'\r\n};\r\n\r\n/**\r\n * @memberOf emp.map\r\n * @public\r\n * @readonly\r\n * @enum\r\n * @desc This enumeration contains the constants that represent the different states for the map engine cursor that can be set via engineInterface.cursor.mode.set.\r\n */\r\nemp.map.cursor = {\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the value to tell a map engine to enable the cursor interaction with the map via engineInterface.cursor.mode.set.\r\n   */\r\n  ENABLED: \"enabled\",\r\n  /**\r\n   * @constant\r\n   * @type {string}\r\n   * @desc Constant value representing the value to tell a map engine to enable the cursor interaction with the map via engineInterface.cursor.mode.set.\r\n   */\r\n  DISABLED: \"disabled\"\r\n};\r\n","var emp = window.emp || {};\r\nemp.map = emp.map || {};\r\n\r\n/**\r\n * @version 2.1\r\n * @description This function returns an object with all the namespaces and abstract functions required for a map engine.\r\n * When developing a map engine, the first part of the js file for your map engine should be a call to get a new template for the engine.\r\n * This template is for the public interface that your map engine will expose.\r\n * All of the internal functions and properties of your map engine should not be added to this template\r\n *\r\n * @return {engineInterface}\r\n */\r\nemp.map.createEngineTemplate = function() {\r\n\r\n  var ENGINE_INTERFACE_CN = \"MAP_CORE_ENGINE_INTERFACE\";\r\n  /**\r\n   * @namespace engineInterface\r\n   * @description A public interface is returned as an engineInterface instance when\r\n   * emp.map.createEngineTemplate() is invoked. This is designed to use functional inheritance.\r\n   * Do not use the \"new\" keyword.\r\n   */\r\n  var engineInterface = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Namespace that contains all the implementation information.\r\n   */\r\n  engineInterface.implementation = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @field\r\n   * @description The implementation should provide a proper string\r\n   * that visually identifies the implementation.\r\n   */\r\n  engineInterface.implementation.displayName = \"Map Engine\";\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @field\r\n   * @description The implementation should provide the\r\n   * map engine's implementation version.\r\n   */\r\n  engineInterface.implementation.version = \"1.0\";\r\n\r\n  /**\r\n   * @memberOf engineInterface.implementation\r\n   * @namespace\r\n   * @description Namespace that contains all the implementation help text.\r\n   */\r\n  engineInterface.implementation.help = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.implementation.help\r\n   * @constant\r\n   * @field\r\n   * @description The implementation should provide the\r\n   * map engine's Edit mode help screen. The string shall be displayed\r\n   * in a help window that allows full html. However the engine\r\n   * must escape the text if html is present.\r\n   */\r\n  engineInterface.implementation.help.edit = \"This map engine does not provide a help screen at this time.\";\r\n\r\n  /**\r\n   * @memberOf engineInterface.implementation.help\r\n   * @constant\r\n   * @field\r\n   * @description The implementation should provide the\r\n   * map engine's Draw mode help screen. The string shall be displayed\r\n   * in a help window that allows full html. However the engine\r\n   * must escape the text if html is present.\r\n   */\r\n  engineInterface.implementation.help.draw = \"This map engine does not provide a help screen at this time.\";\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Namespace that contains all the implementation capabilities.\r\n   */\r\n  engineInterface.capabilities = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.capabilities\r\n   * @namespace\r\n   * @description Namespace that contains all the implementation map type.\r\n   */\r\n  engineInterface.capabilities.mapType = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.capabilities\r\n   * @namespace\r\n   * @description Namespace that contains all the maps projection\r\n   * capabilities.\r\n   */\r\n  engineInterface.capabilities.projection = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.capabilities.projection\r\n   * @constant\r\n   * @type boolean\r\n   * @description The map engine implementation that provides map flat projection\r\n   * map must overwrite this field with a value of true.\r\n   */\r\n  engineInterface.capabilities.projection.flat = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface.capabilities.mapType\r\n   * @constant\r\n   * @type boolean\r\n   * @description The map engine implementation that provides a two dimension\r\n   * map must overwrite this field with a value of true.\r\n   */\r\n  engineInterface.capabilities.mapType.type2D = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface.capabilities.mapType\r\n   * @constant\r\n   * @type boolean\r\n   * @description The map engine implementation that provides a 2.5 dimension\r\n   * map must overwrite this field with a value of true.\r\n   * 2.5D refers to a flat map that can be tilted and rotated\r\n   */\r\n  engineInterface.capabilities.mapType.type2_5D = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface.capabilities.mapType\r\n   * @constant\r\n   * @type boolean\r\n   * @description The map engine implementation that provides a three dimension\r\n   * map must overwrite this field with a value of true.\r\n   */\r\n  engineInterface.capabilities.mapType.type3D = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Namespace that contains all the format capabilities supported\r\n   * by the map implementation.\r\n   */\r\n  engineInterface.capabilities.formats = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for geojson single Point, LineString, and Polygon.\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_BASIC = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting simple\r\n   * GEOJSON Point, LineString, and Polygon\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_BASIC.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing of simple\r\n   * GEOJSON Point, LineString, and Polygon\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_BASIC.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editting of simple\r\n   * GEOJSON Point, LineString, and Polygon\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_BASIC.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for full geojson Point, LineString, Polygon, MultiPolygon,\r\n   * Feature, Geometry, \"FeatureCollection\", GeometryCollection, properties, etc...\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_FULL = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * full GEOJSON spec.\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_FULL.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing of\r\n   * full GEOJSON spec.\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_FULL.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editting of\r\n   * full GEOJSON spec.\r\n   */\r\n  engineInterface.capabilities.formats.GEOJSON_FULL.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for displaying maps hosted on a WMS server.\r\n   */\r\n  engineInterface.capabilities.formats.WMS = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports WMS version 1.1.\r\n   */\r\n  engineInterface.capabilities.formats.WMS.version_1_1 = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports WMS version 1.3.\r\n   */\r\n  engineInterface.capabilities.formats.WMS.version_1_3 = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports WMS elevation data\r\n   */\r\n  engineInterface.capabilities.formats.WMS.elevationData = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for displaying maps hosted on a WMTS server.\r\n   */\r\n  engineInterface.capabilities.formats.WMTS = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports WMTS version 1.0.0\r\n   */\r\n  engineInterface.capabilities.formats.WMTS.version_1_0_0 = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for displaying maps with a KML or KMZ link.\r\n   */\r\n  engineInterface.capabilities.formats.KML_LAYER = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for simple geometry KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_BASIC = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * simple KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_BASIC.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing of\r\n   * simple KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_BASIC.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editting of\r\n   * simple KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_BASIC.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for complex KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_COMPLEX = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * complex KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_COMPLEX.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing\r\n   * complex KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_COMPLEX.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editing\r\n   * complex KML data\r\n   */\r\n  engineInterface.capabilities.formats.KML_COMPLEX.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for image data\r\n   */\r\n  engineInterface.capabilities.formats.IMAGE = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * image data\r\n   */\r\n  engineInterface.capabilities.formats.IMAGE.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editing\r\n   * image data\r\n   */\r\n  engineInterface.capabilities.formats.IMAGE.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for MilStd feature data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for MilStd 2525B feature data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525B = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * MilStd 2525B data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525B.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing of\r\n   * MilStd 2525B data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525B.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editing of\r\n   * MilStd 2525B data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525B.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for MilStd 2525C feature data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525C = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * MilStd 2525C data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525C.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing of\r\n   * MilStd 2525C data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525C.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editing\r\n   * MilStd 2525C data.\r\n   */\r\n  engineInterface.capabilities.formats.MILSTD.version2525C.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for 3D airspace feature data.\r\n   */\r\n  engineInterface.capabilities.formats.AIRSPACE = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * 3D airspace data.\r\n   */\r\n  engineInterface.capabilities.formats.AIRSPACE.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing\r\n   * 3D airspace data.\r\n   */\r\n  engineInterface.capabilities.formats.AIRSPACE.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editing\r\n   * 3D airspace data.\r\n   */\r\n  engineInterface.capabilities.formats.AIRSPACE.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support for Area of Interest (AOI) feature data.\r\n   */\r\n  engineInterface.capabilities.formats.AOI = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * Area of Interest (AOI) data.\r\n   */\r\n  engineInterface.capabilities.formats.AOI.plot = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports drawing of\r\n   * Area of Interest (AOI) data.\r\n   */\r\n  engineInterface.capabilities.formats.AOI.draw = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports editing of\r\n   * Area of Interest (AOI) data.\r\n   */\r\n  engineInterface.capabilities.formats.AOI.edit = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports plotting\r\n   * dynamic ArcGIS rest services.\r\n   */\r\n  engineInterface.capabilities.formats.ArcGIS = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports\r\n   * overlay clustering.\r\n   */\r\n  engineInterface.capabilities.overlayClustering = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support setting default parameters.\r\n   */\r\n  engineInterface.capabilities.settings = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Support setting default parameters.\r\n   */\r\n  engineInterface.capabilities.settings.milstd = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports setting\r\n   * a default icon size.\r\n   */\r\n  engineInterface.capabilities.settings.milstd.iconSize = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports setting\r\n   * a default icon labels.\r\n   */\r\n  engineInterface.capabilities.settings.milstd.labelOption = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description An implementation must overwrite this value if it supports setting\r\n   * the .\r\n   */\r\n  engineInterface.capabilities.settings.iconSize = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description Namespace that contains all the engine implementation requirements.\r\n   */\r\n  engineInterface.requirements = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @constant\r\n   * @type boolean\r\n   * @description The engine implementation that requires the capabilities of a WMS\r\n   * service must set this value to true.\r\n   */\r\n  engineInterface.requirements.wmsCapabilities = false;\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates the initialization processing.\r\n   */\r\n  engineInterface.initialize = {};\r\n  /**\r\n   * @memberOf engineInterface.initialize\r\n   * @abstract\r\n   * @public\r\n   * @param {Object} args - The args represent what the particular map engine needs or success it raised.  We will not define this.\r\n   * @desc This methods purpose is to provide a location in which a map implementation can perform post start up\r\n   * processing such as setting default location, loading default layers, and other things that should happen after the\r\n   * map has loaded.  This function should be called internally by the map engine implementation after it knows the map is ready.  If the map\r\n   * engine fails during initialization the function map.engine.initialize.fail should be called instead.\r\n   * <p>\r\n   * Once any post processing is done the implementation should issue a emp.map.eventing.StatusChange event indicating the map is\r\n   * ready.  See {@link emp.map.eventing.StatusChange} for details on generating the status change event.\r\n   *\r\n   * @param {object} [args] A custom parameter that can contain anything needed for post-map-initialization processing. Since the engine\r\n   * is responsible for executing the initialize, this will be populated by the engine.\r\n   *\r\n   * @example An implementation of engineInterface.initialize\r\n   *\r\n   * // This function is launched by the manifest file\r\n   * function mapInitializing() {\r\n   *\r\n   *     // Do some map initialization stuff...\r\n   *\r\n   *     // call the succeed function to indicate the map is ready to\r\n   *     emp.map.engine.initialize.succeed({\r\n   *         map: getMap()    // this can be whatever you want it to pass into succeed.\r\n   *     });\r\n   * }\r\n   *\r\n   * engineInterface.initialize.succeed = function (args) {\r\n   *     // map has finished successfully initializing, set default values for\r\n   *     // view.\r\n   *\r\n   *     // call private function that sets map view.\r\n   *     setDefaultMapView();\r\n   *\r\n   *     // notify the map core that the map is now ready.\r\n   *     new emp.map.eventing.StatusChange({\r\n   *         status: emp.map.states.READY\r\n   *     });\r\n   * }\r\n   *\r\n   *\r\n   */\r\n  engineInterface.initialize.succeed = function(args) { // eslint-disable-line no-unused-vars\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to create an error event indicating this method has not be overridden from its abstract state\r\n    new emp.map.eventing.Error({\r\n      coreId: ENGINE_INTERFACE_CN,\r\n      level: 2,\r\n      message: \"Error: The fail method has not been overridden and is not supported by this map engine instance\"\r\n    });\r\n\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.initialize\r\n   * @abstract\r\n   * @public\r\n   * @param {Object} [args] A custom parameter that can contain anything needed for handling an issue that occurred\r\n   * during initialization. Since the engine is responsible for executing the initialization, this parameter is\r\n   * populated by the engine.\r\n   *\r\n   * @desc The purpose of this method is to provide a location in which a map implementation can perform post start up\r\n   * processing in the event that the map fails to initialize. It should be called by the map engine implementation if the engine\r\n   * fails while initializing. The method should send a new emp.map.eventing.StatusChange event with the newStatus being\r\n   * emp.map.states.ERROR.\r\n   * @method\r\n   *\r\n   * @example\r\n   *\r\n   * function initializeMap() {\r\n   *     try {\r\n   *\r\n   *          // do some map initialization\r\n   *          // if it passes call emp.map.engine.initialize.succeed()\r\n   *\r\n   *     } catch(e) {\r\n   *         // map initialization failed\r\n   *         emp.map.engine.initialize.fail({\r\n   *             exception: e\r\n   *         });\r\n   *     }\r\n   * }\r\n   *\r\n   * engineInterface.initialize.fail = function (args) {\r\n   *\r\n   * }\r\n   */\r\n  engineInterface.initialize.fail = function(args) { // eslint-disable-line no-unused-vars\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to create an error event indicating this method has not be overridden from its abstract state\r\n    new emp.map.eventing.Error({\r\n      coreId: ENGINE_INTERFACE_CN,\r\n      level: 2,\r\n\r\n      message: \"Error: The fail method has not been overridden and is not supported by this map engine instance\"\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all the map engines map preferences.\r\n   */\r\n  engineInterface.map = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.map\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object is required to\r\n   * set the cursor mode\r\n   * @param {Object[]} transaction.items - An array of configuration settings.\r\n   *\r\n   * @param {Array} transaction.items - An array containing a single {@link emp.map.cursor} enumeration string value at position 0.\r\n   * @desc Sets global configuration preferences for the map.  Preferences include\r\n   * the default behavior for MIL-STD-2525 warfighting symbols (labels, size, point vs symbol),\r\n   * to default image sizes for icons.\r\n   *\r\n   */\r\n  engineInterface.map.config = function(transaction) {\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all the map engines cursor functionality.\r\n   */\r\n  engineInterface.cursor = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.cursor\r\n   * @namespace\r\n   * @desc This namespace encapsulates the cursor mode processing functionality.\r\n   */\r\n  engineInterface.cursor.mode = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.cursor.mode\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object is required to\r\n   * set the cursor mode\r\n   * @param {Array} transaction.items - An array containing a single {@link emp.map.cursor} enumeration string value at position 0.\r\n   * @desc This function sets the cursor modes (highlighting verses navigation / selection) functionality.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.cursor.mode.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.cursor.mode\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object is required to\r\n   * get the cursor's mode.\r\n   * @desc This function gets the current mode of the cursor.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.cursor.mode.get = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all screen capture capabilities.\r\n   */\r\n  engineInterface.capture = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.capture\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object is required to\r\n   * get the map status.\r\n   * @desc This function is called to capture a base64 data URI string of a PNG of JPEG of the map if supported.\r\n   * <p>\r\n   * If all processing is completed within this method. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.capture.screenshot = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all status capabilities of the map engine.\r\n   */\r\n  engineInterface.status = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.status\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Status} objects that was\r\n   * retrieved from the map\r\n   * @desc This function gets the map status.If this function is\r\n   * overrode, the {@link Status} object should be created and pushed to the transaction.items prior to\r\n   * completing the transaction.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.status.get = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all state processing.\r\n   */\r\n  engineInterface.state = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.state\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object is required to\r\n   * reset the map.\r\n   * @desc This function removes all map data and puts the map in its initial state.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.state.reset = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.state\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * destroy the state\r\n   * @desc This is the function called when this map is being replaced by a different map engine to do any cleanup required by that engine.\r\n   * This will run synchronously and the map engine swap code will execute immediately following the return of this function.\r\n   * All memory allocations must be freed and the engine implementation left in a known state. This is required\r\n   * due to the javascript files utilized by the implementation are NOT unloaded and can be restarted if the\r\n   * user swaps back to the engine.\r\n   * @method\r\n   */\r\n  engineInterface.state.destroy = function() {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to do nothing.\r\n    new emp.map.eventing.Error({\r\n      coreId: ENGINE_INTERFACE_CN,\r\n      level: 2,\r\n      message: \"Error: The state.destroy method has not been overridden and is not supported by this map engine instance.  This may lead to issues during map swapping.\"\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates the visibility operation for the engine implementation.\r\n   */\r\n  engineInterface.visibility = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.visibility\r\n   * @public\r\n   * @abstract\r\n   * @description This method is called by the core to instruct the map engine to set the visibility of objects.\r\n   * A map engine implementation must implement this method to handle the visibility set operations.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of object instances that can be Overlay, Feature,\r\n   * WMS, or Static.\r\n   */\r\n  engineInterface.visibility.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all overlay processing capabilities\r\n   */\r\n  engineInterface.overlay = {};\r\n\r\n  /**\r\n   * @desc Adds overlays to the map.\r\n   *\r\n   * Transaction.items of type {@link Overlay} are added to the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n   * engineInterface.overlay.add = function(transaction{\r\n   *\r\n   *      for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *          var item = transaction.items[i];\r\n   *\r\n   *\r\n   *\r\n   *          if(!success){\r\n   *              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n   *              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n   *              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n   *          }\r\n   *      }//end for loop\r\n   *      return true;\r\n   * }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Overlay} objects to\r\n   * add to the map.\r\n   *\r\n   *\r\n   * @method\r\n   */\r\n  engineInterface.overlay.add = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @desc Removes overlays from the map.\r\n   *\r\n   * ~Transaction.items~ of type {@link Overlay} are removed from the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.remove = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Overlay} objects to  be\r\n   * removed from the map\r\n   * @method\r\n   */\r\n  engineInterface.overlay.remove = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @desc Updates overlays on the map such as its name, parent.\r\n   *\r\n   * Transaction.items of type {@link Overlay} are updated on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.update = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n  }//end function\r\n   *\r\n   *\r\n   * @memberOf engineInterface.overlay\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Overlay} objects to\r\n   * updated on this map\r\n   * @method\r\n   */\r\n  engineInterface.overlay.update = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @desc Clears contents of existing overlays on the map.\r\n   *\r\n   * Transaction.items of type {@link Overlay} are cleared of their contents on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.clear = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Overlay} objects to\r\n   * be cleared.\r\n   * @method\r\n   */\r\n  engineInterface.overlay.clear = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n  /**\r\n   *\r\n   * @memberOf engineInterface.overlay\r\n   * @namespace\r\n   * @desc Namspace for overlay clustering functions.\r\n   */\r\n  engineInterface.overlay.cluster = {};\r\n  /**\r\n   * @desc Sets the clustering stratgey of an existing overlay on the map.\r\n   *\r\n   * Transaction.items of type {@link Cluster} are applied to the given overlay. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * If all processing is completed within this method, it should return true to allow the transaction to terminate. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pause a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.cluster.set = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n      return true;\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay.cluster\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array with a single {@link Cluster} object at position 0 of the items array to\r\n   * be applied to the given overlay.\r\n   * @method\r\n   */\r\n  engineInterface.overlay.cluster.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"The engineInterface.overlay.cluster.set function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @desc Hides or disables the clustering stratgey of an existing overlay on the map.\r\n   *\r\n   * Transaction.items of type {@link Cluster} are applied to the given overlay. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * If all processing is completed within this method, it should return true to allow the transaction to terminate. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pause a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.cluster.deactivate = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n      return true;\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay.cluster\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array with a single overlayId at position 0 of the items array.\r\n   * @method\r\n   */\r\n  engineInterface.overlay.cluster.deactivate = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"The engineInterface.overlay.cluster.deactivate function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n  /**\r\n   * @desc Shows or activates the clustering stratgey of an existing overlay on the map.\r\n   *\r\n   * Transaction.items of type {@link Cluster} are applied to the given overlay. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * If all processing is completed within this method, it should return true to allow the transaction to terminate. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pause a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.cluster.activate = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n      return true;\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay.cluster\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array with a single overlayId at position 0 of the items array.\r\n   * @method\r\n   */\r\n  engineInterface.overlay.cluster.activate = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"The engineInterface.overlay.cluster.activate function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n  /**\r\n   * @desc Shows or activates the clustering stratgey of an existing overlay on the map.\r\n   *\r\n   * Transaction.items of type {@link Cluster} are applied to the given overlay. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * If all processing is completed within this method, it should return true to allow the transaction to terminate. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pause a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.cluster.show = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n      return true;\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay.cluster\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array with a single overlayId at position 0 of the items array.\r\n   * @method\r\n   */\r\n  engineInterface.overlay.cluster.remove = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"The engineInterface.overlay.cluster.remove function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n  /**\r\n   *\r\n   * @memberOf engineInterface.overlay\r\n   * @namespace\r\n   * @desc This this function has been deprecated.\r\n   */\r\n  engineInterface.overlay.visibility = {};\r\n\r\n  /**\r\n   * @desc Sets the visibility an existing overlay on the map.\r\n   *\r\n   * Transaction.items of type {@link Overlay} change visibility on the map. Items that fail\r\n   * should be stored in an array of objects in the format:\r\n   *\r\n   *     {\r\n   *         cpceId: item.cpceId, //cpceId is a property of the {@link Overlay}\r\n   *         code: \"000x234987\" //a {@link Code} defined by the map engine.\r\n   *         }\r\n   *\r\n   *\r\n   * The end of the function should call transaction.fail with an array of failed objects.\r\n   * If no items failed, transaction.fail should be called with an empty array.\r\n   * A TransactionComplete event should then be issued.\r\n   *\r\n   * @example\r\n   * engineInterface.overlay.visibility.set = function(transaction{\r\n   * var failList = [];//create a list of failed items\r\n   *\r\n   * for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *  var item = transaction.items[i];\r\n   *\r\n   *\r\n   *\r\n   *  if(!success){\r\n   *      failList.push(emp.typeLibrary.Error({cpceId: item.cpceId, code: \"000x234987\"});\r\n   *  }\r\n   * }//end for loop\r\n   * emp.map.eventing.TrasactionComplete({transaction: transaction, failures: failList})\r\n   * }//end function\r\n   *\r\n   * @memberOf engineInterface.overlay.visibility\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Overlay} objects to\r\n   * have their visibility set.\r\n   * @method\r\n   */\r\n  engineInterface.overlay.visibility.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.overlay\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link OverlayStyle} objects.\r\n   * @method\r\n   * @desc called to set the styles of all objects currently contained in the overlays indicated.\r\n   *\r\n   * Transaction.items of type {@link Overlay} are cleared of their contents on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.overlay.style = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n      return true;\r\n  }//end function\r\n   */\r\n  engineInterface.overlay.style = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n\r\n  /**\r\n   * @namespace\r\n   */\r\n  engineInterface.navigation = {};\r\n\r\n  /**\r\n   * Locks or unlocks the map view, preventing the user from interacting with the\r\n   * map.  When the view is locked, nothing can move the map except for an api\r\n   * call to the engine.\r\n   *\r\n   * @param {emp.typeLibrary.Transaction} transaction - Contains a Lock that indicates if the\r\n   * view should be locked or unlocked.\r\n   *\r\n   * @example\r\n   *\r\n   * engineInterface.navigation.enable = function(transaction) {\r\n   *\r\n   *    // typically you will not get more than one item in this transaction.\r\n   *    var item = transaction.items[0];\r\n   *\r\n   *    if (item.lock) {\r\n   *      myMapEngine.lockView();\r\n   *    } else {\r\n   *      myMapEngine.unlockView();\r\n   *    }\r\n   *\r\n   * }\r\n   */\r\n  engineInterface.navigation.enable = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates all map view functionality.\r\n   */\r\n  engineInterface.view = {};\r\n\r\n  /**\r\n   * @desc Sets the view of a view, feature, layer, overlay, or symbol.\r\n   *\r\n   * Transaction.items of type {@link View} are added to the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n  engineInterface.view.set = function(transaction{\r\n\r\n      for (var i = 0; i < transaction.items.length; i += 1) {\r\n          var item = transaction.items[i];\r\n\r\n\r\n\r\n          if(!success){\r\n              // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omited or set to null\r\n              transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n          }\r\n      }//end for loop\r\n  }//end function\r\n   *\r\n   * @memberOf engineInterface.view\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link View} objects\r\n   * @method\r\n   */\r\n  engineInterface.view.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Converts a geographic location in decimal degrees to a pixel location relative\r\n   * to the top left corner of the map.\r\n   *\r\n   * @example\r\n   * engineInterface.view.getXYFromLatLon = function(transaction) {\r\n   *\r\n   *    var item;\r\n   *\r\n   *    for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *        item = transaction.items[i];\r\n   *        var lat = item.lat;\r\n   *        var lon = item.lon;\r\n   *\r\n   *        var result = someConversionMethod(lat, lon);\r\n   *\r\n   *        item.x = result.x;\r\n   *        item.y = result.y;\r\n   *    }\r\n   *\r\n   * };\r\n   *\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   *\r\n   * @param {emp.typeLibrary.Convert[]} transaction.items - The items contains an array of {@link emp.typeLibrary.Convert} objects\r\n   */\r\n  engineInterface.view.getXYFromLatLon = function(transaction) {\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Converts a pixel relative to the top left corner of the map to the\r\n   * geographical location on the map.  If the pixel does not represent an area\r\n   * on a map, the conversion will not return anything.\r\n   *\r\n   * @example\r\n   * engineInterface.view.getLatLonFromXY = function(transaction) {\r\n   *\r\n   *    var item;\r\n   *\r\n   *    for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *        item = transaction.items[i];\r\n   *        var x = item.x;\r\n   *        var y = item.y;\r\n   *\r\n   *        var result = someConversionMethod(x, y);\r\n   *\r\n   *        item.lon = result.x;\r\n   *        item.lat = result.y;\r\n   *    }\r\n   *\r\n   * };\r\n   *\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {emp.typeLibrary.Convert[]} transaction.items - The items contains an array of {@link emp.typeLibrary.Convert} objects\r\n   */\r\n  engineInterface.view.getLatLonFromXY = function(transaction) {\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n     * @desc Gets the current view on the map.\r\n     *\r\n     * A new {@link View} object should be created.\r\n     *\r\n     *\r\n     *     var view = new emp.typeLibrary.View({\r\n     *         overlayId:\r\n     *         featureId:\r\n     *         parentId:\r\n     *         range:\r\n     *         zoom:\r\n     *         location:\r\n     *         pan:\r\n     *         heading:\r\n     *         bounds:\r\n     *         });//these properties are defined in the {@link View} object\r\n     *\r\n     *\r\n     * If creating the view succeeds, the new {@link View} should be pushed to transaction.items array.\r\n     *\r\n     *     transaction.items.push(view);\r\n     *\r\n     *\r\n     * If creating the view fails, a new {@link Error} transaction.fail handling should take place.\r\n     *\r\n     * <p>\r\n     * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n     * halt the processing of the transaction. Once the processing is complete the implementation must\r\n     * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n     * unpredictable behavior of the core components.</p>\r\n     *\r\n     *\r\n     * @example\r\n    engineInterface.view.get = function(transaction){\r\n        var view,\r\n            failures = [],\r\n            error;\r\n\r\n\r\n        view = new emp.typeLibrary.View({\r\n            overlayId: overlayId,\r\n            featureId: featureId,\r\n            parentId: parentId,\r\n            range: range,\r\n            zoom: zoom,\r\n            location: location,\r\n            pan: pan,\r\n            heading: heading,\r\n            bounds: bounds\r\n        });\r\n\r\n        if(success){\r\n            transaction.items.push(view);\r\n        }else if (!success){\r\n            transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n        }\r\n   }//end function\r\n     *\r\n     * @memberOf engineInterface.view\r\n     * @abstract\r\n     * @public\r\n     * @returns {boolean}\r\n     * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n     * The transaction should be included in the TransactionComplete event.\r\n     * @param {Array} transaction.items - The items array will be empty coming into the function. In this function,\r\n     * the items array should be populated with a new {@link View} object.\r\n     */\r\n  engineInterface.view.get = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  engineInterface.lookAt = {};\r\n\r\n  /**\r\n   * Centers the view on a feature or location on the map\r\n   * @memberOf engineInterface.lookAt\r\n   * @abstract\r\n   * @public\r\n   */\r\n  engineInterface.lookAt.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace encapsulates the feature processing capabilities of the engine.\r\n   */\r\n  engineInterface.feature = {};\r\n\r\n  /**\r\n   * @desc Adds features to the map.\r\n   *\r\n   * Transaction.items of type {@link Feature} are added to the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n   * engineInterface.feature.add = function(transaction{\r\n   *\r\n   *  for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *      var item = transaction.items[i];\r\n   *\r\n   *\r\n   *\r\n   *      if(!success){\r\n   *          // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n              // If there is no error object from a try catch block the jsError property can be omited or set to null\r\n   *          transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n   *      }\r\n   *  }//end for loop\r\n   * }//end function\r\n   *\r\n   *\r\n   * @memberOf engineInterface.feature\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link emp.typeLibrary.Feature}\r\n   * objects\r\n   * @method\r\n   * @description The engine implementation MUST NOT alter any feature in the transactions\r\n   * items list. Doing so will yield unpredictable results.\r\n   */\r\n  engineInterface.feature.add = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @desc Removes features from the map.\r\n   *\r\n   * Transaction.items of type {@link Feature} are removed from the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n   * engineInterface.feature.remove = function(transaction{\r\n   *\r\n   *  for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *      var item = transaction.items[i];\r\n   *\r\n   *\r\n   *\r\n   *      if(!success){\r\n   *          // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n   *          // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n   *          transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n   *      }\r\n   *  }//end for loop\r\n   * }//end function\r\n   *\r\n   * @memberOf engineInterface.feature\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Feature}\r\n   * or {@link Symbol} objects\r\n   * @method\r\n   */\r\n  engineInterface.feature.remove = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @desc Updates features to the map, such as its name or parent.\r\n   *\r\n   * Transaction.items of type {@link Feature} are updated on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n   * engineInterface.feature.update = function(transaction{\r\n   *\r\n   *  for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *      var item = transaction.items[i];\r\n   *\r\n   *\r\n   *\r\n   *      if(!success){\r\n   *          // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n   *          // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n   *          transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n   *      }\r\n   *  }//end for loop\r\n   * }//end function\r\n   *\r\n   * @memberOf engineInterface.feature\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Feature}\r\n   * or {@link Symbol} objects\r\n   * @method\r\n   */\r\n  engineInterface.feature.update = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface.feature\r\n   * @namespace\r\n   * @desc This object is the container for feature visibility methods.\r\n   */\r\n  engineInterface.feature.visibility = {};\r\n\r\n  /**\r\n   * @desc Changes the visibility of features on the map.\r\n   *\r\n   * Transaction.items of type {@link Feature} have visibility changed on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.\r\n   *\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * @example\r\n   * engineInterface.feature.visibility.set = function(transaction{\r\n   *\r\n   * for (var i = 0; i < transaction.items.length; i += 1) {\r\n   *  var item = transaction.items[i];\r\n   *\r\n   *\r\n   *\r\n   *  if(!success){\r\n   *    // If the error is due to a try catch block the error provided by the catch should be added as the jsError property of the Error\r\n   *     // If there is no error object from a try catch block the jsError property can be omitted or set to null\r\n   *          transaction.fail([{coreId: item.coreId, level: <i>error level</i> see {@link emp.typeLibrary.Error.level}, message: \"Optional custom error message\", jsError: null}]);\r\n   *  }\r\n   * }//end for loop\r\n   * }//end function\r\n   *\r\n   * @memberOf engineInterface.feature.visibility\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * The transaction should be included in the TransactionComplete event.\r\n   * @param {Array} transaction.items - The items contains an array of {@link Feature}or\r\n   * {@link Symbol} objects\r\n   * @method\r\n   */\r\n  engineInterface.feature.visibility.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description This namespace encapsulates all the settings capabilities.\r\n   */\r\n  engineInterface.settings = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.settings\r\n   * @namespace\r\n   * @description This namespace encapsulates all the MIL-STD-2525 settings capabilities.\r\n   */\r\n  engineInterface.settings.mil2525 = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.settings.mil2525\r\n   * @namespace\r\n   * @description This namespace encapsulates all the MIL-STD-2525 icon settings\r\n   * capabilities.\r\n   */\r\n  engineInterface.settings.mil2525.icon = {};\r\n  /**\r\n   * @memberOf engineInterface.settings.mil2525\r\n   * @namespace\r\n   * @description This namespace encapsulates all the MIL-STD-2525 icon size\r\n   * settings capabilities.\r\n   */\r\n  engineInterface.settings.mil2525.icon.size = {};\r\n  /**\r\n   * @memberOf engineInterface.settings.mil2525.icon\r\n   * @description Set the desired icon size fof MIL-STD-2525 icons in pixel dimensions\r\n   * <p>\r\n   * Transaction.items should be a an array with a single integer value representing the pixel size desired such as [32]\r\n   * <p>\r\n   * If all processing is completed within this method, it should return true to allow the transaction to terminate. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains\r\n   * a number of properties.\r\n   * @param {Array} transaction.items - The items[0] contains an integer value\r\n   * representing the pixel size desired such as [32] or [48]\r\n   * @method\r\n   */\r\n  engineInterface.settings.mil2525.icon.size.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.settings.mil2525.icon\r\n   * @namespace\r\n   * @description This namespace encapsulates all the MIL-STD-2525 icon label settings capabilities.\r\n   */\r\n  engineInterface.settings.mil2525.icon.labels = {};\r\n  /**\r\n   * @memberOf engineInterface.settings.mil2525.icon\r\n   * @description Set the desired icon labels to be displayed for MIL-STD-2525 icons\r\n   * <p>\r\n   * Transaction.items[0] contains an array of string values representing ALL of the\r\n   * labels to be displayed\r\n   * <p>\r\n   * If all processing is completed within this method, it should return true to allow the transaction to terminate. In\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items[0] - The items[0] contains an array of strings\r\n   * representing the labels names to display\r\n   * @method\r\n   */\r\n  engineInterface.settings.mil2525.icon.labels.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description This namespace encapsulates all the WMS service capabilities.\r\n   */\r\n  engineInterface.wms = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.wms\r\n   * @description Add a new WMS service.  The transactions Items will contain emp.typeLibrary.WMS objects.\r\n   * If the same WMS URL has already been added to the map, the core code will call remove\r\n   * Then call add.  this will account for wanting to \"refresh\" the WMS service and make sure the most update to date capabilities\r\n   * has been loaded.\r\n   * <p>\r\n   * Transaction.items of type {@link WMS} have visibility changed on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.</p>\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link emp.typeLibrary.WMS}\r\n   * @method\r\n   */\r\n  engineInterface.wms.add = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.wms\r\n   * @description Remove a WMS service from the map.  The transactions Items will contain emp.typeLibrary.WMS objects.\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link WMS}or\r\n   * @method\r\n   */\r\n  engineInterface.wms.remove = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description This namespace encapsulates all the WMTS service capabilities.\r\n   */\r\n  engineInterface.wmts = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.wmts\r\n   * @description Add a new WMTS service.  The transactions Items will contain emp.typeLibrary.WMTS objects.\r\n   * If the same WMTS URL has already been added to the map, the core code will call remove\r\n   * then call add.\r\n   * <p>\r\n   * Transaction.items of type {@link WMTS} have visibility changed on the map. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.</p>\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link emp.typeLibrary.WMTS}\r\n   * @method\r\n   */\r\n  engineInterface.wmts.add = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.wmts\r\n   * @description Remove a WMTS service from the map.  The transactions Items will contain emp.typeLibrary.WMTS objects.\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link WMTS}\r\n   * @method\r\n   */\r\n  engineInterface.wmts.remove = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @description This namespace encapsulates all the KML link capabilities.\r\n   */\r\n  engineInterface.kmllayer = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.kmllayer\r\n   * @description Add a new KML or KMZ link.  The transactions items will contain emp.typeLibrary.KmlLayer objects.\r\n   * If the same KML link has already been added to the map, the core code will call remove\r\n   * then call add.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link emp.typeLibrary.KmlLayer}\r\n   * @method\r\n   */\r\n  engineInterface.kmllayer.add = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.kmllayer\r\n   * @description Remove a KML or KMZ link from the map. The transactions Items will contain emp.typeLibrary.KmlLayer objects.\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The {@link emp.typeLibrary.Transaction} object contains a number of properties.\r\n   * @param {Array} transaction.items - The items contains an array of {@link KmlLayer}\r\n   * @method\r\n   */\r\n  engineInterface.kmllayer.remove = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /*\r\n   * These will be removed when the new visibility is implemented.\r\n   */\r\n  engineInterface.wms.visibility = {};\r\n  engineInterface.wms.visibility.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This object is the container for feature draw methods\r\n   */\r\n  engineInterface.draw = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.draw\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction class instance identifies the operation.\r\n   * @param {Array} transaction.items This transaction member contains an array of one (1) {@link emp.typeLibrary.Draw}\r\n   * which defines the type of feature which needs drawing.\r\n   * @desc This function is called to start a draw operation. The engine implementation must use\r\n   * the properties provided and place the item on the map in edit mode. Therefore allowing the\r\n   * user to modify the item on the map. The implementation must also issue the DrawStart event (see {@link emp.map.eventing.DrawStart}).\r\n   * <p>\r\n   * The implementation must pause the transaction until the draw is completed via a DrawEnd, Draw Cancel,\r\n   * edit begin transaction or another draw begin.</p>\r\n   * <p>\r\n   * Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause and complete the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   * @example\r\n   * engineInterface.draw.begin = function (oTransaction) {\r\n   *\r\n   *      var oItem = oTransaction.items[0];\r\n   *\r\n   *      if (//Is there another Edit or Draw in progress)\r\n   *      {\r\n   *          // Cancel Edit/Draw in progress.\r\n   *      }\r\n   *\r\n   *      // Use the Draw class instance in oTransaction.items[0] to identify the type of feature.\r\n   *      if (//Drawing of that Feature Type is not supported)\r\n   *      {\r\n   *          oTransaction.fail([{coreId: oItem.coreId, level: {@link emp.typeLibrary.Error.level.MAJOR}, message: \"Draw operation not support for features of this type.\", jsError: null}]);\r\n   *          return;\r\n   *      }\r\n   *\r\n   *      // Save the draw.begin transaction for later use.\r\n   *      oEngineTransactionList.setItem(oTransaction.transactionId, oTransaction);\r\n   *      oTransaction.pause(); // Pause the transaction until draw is done.\r\n   *\r\n   *      // Use the Draw class instance to draw the feature on the map and place it in edit mode.\r\n   *\r\n   *      // Issue the DrawStart event.\r\n   *      new emp.map.eventing.DrawStart({transaction: oTransaction});\r\n   *\r\n   *      // Issue an update event.\r\n   *      oItem.update({\r\n   *          updateEventType = emp.typeLibrary.UpdateEventType.START,\r\n   *          :\r\n   *          :\r\n   *          //see {@link emp.typeLibrary.Draw.update}\r\n   *      });\r\n   *\r\n   * }; // end method\r\n   *\r\n   *  // Each time the feature is changed from user interaction on the map the implementation must\r\n   *  // issue an update.\r\n   *  generateDrawUpdate = function (oDrawBeginTransaction) {\r\n   *\r\n   *      var oItem = oDrawBeginTransaction.items[0];\r\n   *\r\n   *      // Issue an update event.\r\n   *      oItem.update({\r\n   *          updateEventType = emp.typeLibrary.UpdateEventType.UPDATE,\r\n   *          :\r\n   *          // Place new data in the structure.\r\n   *          :\r\n   *          //see {@link emp.typeLibrary.Draw.update}\r\n   *      });\r\n   *\r\n   *  };\r\n   */\r\n  engineInterface.draw.begin = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.draw\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction class instance identifies the operation.\r\n   * @param {Array} transaction.items This transaction member contains an array of one (1) {@link emp.typeLibrary.Draw}\r\n   * which identifies the draw that that must be completed.\r\n   * @desc This function ends the drawing of a feature. The implementation must remove the newly\r\n   * drawn feature from the map. The core will later issue a feature.add to add the newly drawn feature\r\n   * permanently to the map.\r\n   * <p> The implementation must issue the final update and issue the DrawEnd event (see {@link emp.map.eventing.DrawEnd}) prior to\r\n   * completing this transaction.</p>\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * <p>\r\n   * Once the draw is terminated, the original draw.begin transaction must be completed.</p>\r\n   * @method\r\n   * @example\r\n   * engineInterface.draw.end = function (oDrawEndTransaction) {\r\n   *\r\n   *      var oBeginDrawTransaction = //Find original draw.begin transaction.\r\n   *      var oItem = oBeginDrawTransaction.items[0];\r\n   *\r\n   *      // Terminate the edit session on the map.\r\n   *\r\n   *      // Issue final update event.\r\n   *      oItem.update({\r\n   *          updateEventType = emp.typeLibrary.UpdateEventType.COMPLETE,\r\n   *          :\r\n   *          // Place final feature data in the structure.\r\n   *          :\r\n   *          //see {@link emp.typeLibrary.Draw.update}\r\n   *      });\r\n   *\r\n   *      oItem.plotFeature = new emp.typeLibrary.Feature({\r\n   *          :\r\n   *          // Populate the arguments to create the new feature.\r\n   *          // see {@link emp.typeLibrary.Feature}\r\n   *          :\r\n   *      });\r\n   *\r\n   *      // Delete the feature from the map\r\n   *\r\n   *      // Issue the DrawEnd event.\r\n   *      new emp.map.eventing.DrawEnd({\r\n   *          transaction: oBeginDrawTransaction\r\n   *      });\r\n   *\r\n   *      // Allow the original transaction to terminate.\r\n   *      oBeginDrawTransaction.run();\r\n   *\r\n   *      // Return true to complete the oDrawEndTransaction.\r\n   * }; // end method\r\n   */\r\n  engineInterface.draw.end = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.draw\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction class instance identifies the operation.\r\n   * @param {Array} transaction.items This transaction member contains an array of one (1) {@link emp.typeLibrary.Draw}\r\n   * which identifies the draw that that must be canceled.\r\n   * @desc This function cancels the drawing of a feature.\r\n   * <p>\r\n   * The implementation must remove the newly drawn feature from the map. Then call transaction.fail() on the original draw begin transaction for the item\r\n   * indicating a level = emp.typeLibrary.Error.level.INFO and an error message = \"Draw canceled\".\r\n   * The implementation must issue the DrawEnd event (see {@link emp.map.eventing.DrawEnd}) prior to\r\n   * completing this transaction.</p>\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * <p>\r\n   * Once this transaction has been completed, the original draw.begin transaction must be completed.</p>\r\n   * @method\r\n   * @example\r\n   * engineInterface.draw.cancel = function (oDrawCancelTransaction) {\r\n   *\r\n   *      var oBeginDrawTransaction = //Find original draw.begin transaction.\r\n   *      var oItem = oBeginDrawTransaction.items[0];\r\n   *\r\n   *      // Terminate the edit session on the map.\r\n   *\r\n   *      // Delete the feature from the map\r\n   *\r\n   *      // Fail the original transaction\r\n   *      oBeginDrawTransaction.fail({\r\n   *          coreId: oItem.coreId,\r\n   *          level: {@link emp.typeLibrary.Error.level.INFO},\r\n   *          message: \"Draw canceled.\",\r\n   *          jsError: null\r\n   *      });\r\n   *\r\n   *      // Issue the DrawEnd event.\r\n   *      new emp.map.eventing.DrawEnd({\r\n   *          transaction: oBeginDrawTransaction\r\n   *      });\r\n   *\r\n   *      // Allow the original transaction to terminate.\r\n   *      oBeginDrawTransaction.run();\r\n   * }; // end method\r\n   */\r\n  engineInterface.draw.cancel = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace is the container for feature edit methods.\r\n   */\r\n  engineInterface.edit = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.edit\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction class instance identifies the operation.\r\n   * @param {Array} transaction.items This transaction member contains an array of one (1) {@link emp.typeLibrary.Edit}\r\n   * which identifies the feature to edit.\r\n   * @desc This function is called to start an edit operation. The engine implementation must use\r\n   * the properties provided in the items and place the item on the map in edit mode. Therefore allowing the\r\n   * user to modify the item on the map. The implementation must also issue the EditStart event (see {@link emp.map.eventing.EditStart}).\r\n   * <p>\r\n   * The implementation must pause the transaction until the edit is completed via a Edit End, Edit Cancel,\r\n   * draw begin transaction or another edit begin transaction arrives or the feature is removed while in edit mode.</p>\r\n   * <p>\r\n   * Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause and complete the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   * @example\r\n   * engineInterface.edit.begin = function (oTransaction) {\r\n   *\r\n   *      var oItem = oTransaction.items[0];\r\n   *\r\n   *      if (//Is there another Edit or Draw in progress)\r\n   *      {\r\n   *          // Cancel Edit/Draw in progress.\r\n   *      }\r\n   *\r\n   *      // Use the edit class instance in oTransaction.items[0] to identify the feature.\r\n   *      if (//Edit of that Feature is not supported)\r\n   *      {\r\n   *          oTransaction.fail([{coreId: oItem.coreId, level: {@link emp.typeLibrary.Error.level.MAJOR}, message: \"Edit operation not support for features of this type.\", jsError: null}]);\r\n   *            return;\r\n   *      }\r\n   *\r\n   *      // Save the edit.begin transaction for later use.\r\n   *      oEngineTransactionList.setItem(oTransaction.transactionId, oTransaction);\r\n   *      oTransaction.pause(); // Pause the transaction until edit is done.\r\n   *\r\n   *      // Use the Edit class instance to place the feature in edit mode.\r\n   *\r\n   *      // Issue the EditStart event.\r\n   *      new emp.map.eventing.EditStart({transaction: oTransaction});\r\n   *\r\n   *      // Issue an update event.\r\n   *      oItem.update({\r\n   *          updateEventType = emp.typeLibrary.UpdateEventType.START,\r\n   *          :\r\n   *          :\r\n   *          //see {@link emp.typeLibrary.Edit.update}\r\n   *      });\r\n   *\r\n   * }; // end method\r\n   *\r\n   *  // Each time the feature is changed from user interaction on the map the implementation must\r\n   *  // issue an update.\r\n   *  generateEditUpdate = function (oEditBeginTransaction) {\r\n   *\r\n   *      var oItem = oEditBeginTransaction.items[0];\r\n   *\r\n   *      // Issue an update event.\r\n   *      oItem.update({\r\n   *          updateEventType = emp.typeLibrary.UpdateEventType.UPDATE,\r\n   *          :\r\n   *          // Place new data in the structure.\r\n   *          :\r\n   *          //see {@link emp.typeLibrary.Edit.update}\r\n   *      });\r\n   *\r\n   *  };\r\n   */\r\n  engineInterface.edit.begin = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.edit\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction class instance identifies the operation.\r\n   * @param {Array} transaction.items This transaction member contains an array of one (1) {@link emp.typeLibrary.Edit}\r\n   * which identifies the edit that that must be completed.\r\n   * @desc This function ends the editing of a feature.\r\n   * <p> The implementation must issue the final update and issue the EditEnd event (see {@link emp.map.eventing.EditEnd}) prior to\r\n   * completing this transaction.</p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * <p>\r\n   * Once this transaction has been completed, the original edit.begin transaction must be completed.</p>\r\n   * @method\r\n   * @example\r\n   * engineInterface.Edit.end = function (oEditEndTransaction) {\r\n   *\r\n   *      var oEditBeginTransaction = //Find original edit.begin transaction.\r\n   *      var oItem = oEditBeginTransaction.items[0];\r\n   *\r\n   *      // Terminate the edit session on the map.\r\n   *\r\n   *      // Issue final update event.\r\n   *      oItem.update({\r\n   *          updateEventType = emp.typeLibrary.UpdateEventType.COMPLETE,\r\n   *          :\r\n   *          // Place final feature data in the structure.\r\n   *          :\r\n   *          //see {@link emp.typeLibrary.Edit.update}\r\n   *      });\r\n   *\r\n   *      // Issue the EditEnd event.\r\n   *      new emp.map.eventing.EditEnd({\r\n   *          transaction: oEditBeginTransaction\r\n   *      });\r\n   *\r\n   *      // Allow the original transaction to terminate.\r\n   *      oEditBeginTransaction.run();\r\n   * }; // end method\r\n   */\r\n  engineInterface.edit.end = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @memberOf engineInterface.edit\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction class instance identifies the operation.\r\n   * @param {Array} transaction.items This transaction member contains an array of one (1) {@link emp.typeLibrary.Edit}\r\n   * which identifies the edit that that must be canceled.\r\n   * @desc This function cancels the editing of a feature.\r\n   * <p>\r\n   * The implementation must use the originalFeature parameter of the item contained in the original edit.begin transaction\r\n   * to revert the feature to its original state.\r\n   * <p>Once the feature is in its original state the implementation must call transaction.fail() on the original edit begin transaction for the item\r\n   * indicating a level = emp.typeLibrary.Error.level.INFO and an error message = \"Edit canceled\".\r\n   * The implementation must issue the EditEnd event (see {@link emp.map.eventing.EditEnd}) prior to\r\n   * completing this transaction.</p>\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   *\r\n   * <p>\r\n   * Once this transaction has been completed, the original edit.begin transaction must be completed.</p>\r\n   * @method\r\n   * @example\r\n   * engineInterface.edit.cancel = function (oEditCancelTransaction) {\r\n   *\r\n   *      var oEditBeginTransaction = //Find original edit.begin transaction.\r\n   *      var oItem = oEditBeginTransaction.items[0];\r\n   *\r\n   *      // Terminate the edit session on the map.\r\n   *\r\n   *      // Use oItem.originalFeature to revert the feature back to its pre-edit state on the map.\r\n   *\r\n   *      // Fail the original transaction\r\n   *      oEditBeginTransaction.fail({\r\n   *          coreId: oItem.coreId,\r\n   *          level: {@link emp.typeLibrary.Error.level.INFO},\r\n   *          message: \"Edit canceled.\",\r\n   *          jsError: null\r\n   *      });\r\n   *\r\n   *      // Issue the EditEnd event.\r\n   *      new emp.map.eventing.EditEnd({\r\n   *          transaction: oEditBeginTransaction\r\n   *      });\r\n   *\r\n   *      // Allow the original transaction to terminate.\r\n   *      oEditBeginTransaction.run();\r\n   * }; // end method\r\n   */\r\n  engineInterface.edit.cancel = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace is the container for feature selection methods.\r\n   */\r\n  engineInterface.selection = {};\r\n\r\n  /**\r\n   * @memberOf engineInterface.selection\r\n   * @abstract\r\n   * @public\r\n   * @returns {boolean}\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object containing selected features as defined in the type library is required.\r\n   * @desc This function sets which features are selected. Items that fail\r\n   * should be processed with transaction.fail() call. see {@link Transaction.fail}.</p>\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.selection.set = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    while (transaction.items.length > 0) {\r\n\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @memberOf engineInterface\r\n   * @namespace\r\n   * @desc This namespace is the container for projection  methods.\r\n   */\r\n  engineInterface.projection = {};\r\n  engineInterface.projection.enable = {};\r\n\r\n\r\n\r\n  /**\r\n   * @memberOf engineInterface.projection.enable\r\n   * @abstract\r\n   * @public\r\n   * @param {emp.typeLibrary.Transaction} transaction - The transaction object is required to\r\n   * set the projection mode.\r\n   * @param {boolean} transaction.items - The transaction.items[0] contains a boolean\r\n   * value indicating if true to enable a flat map. And false to enable a 3D map.\r\n   * @desc This function sets the current mode of the projection.\r\n   * <p>\r\n   * In the event that the actual processing is done async, this method must call transaction.pause() to\r\n   * halt the processing of the transaction. Once the processing is complete the implementation must\r\n   * call transaction.run() to un-pause the transaction. Failure to un-pausing a transaction can lead to\r\n   * unpredictable behavior of the core components.</p>\r\n   * @method\r\n   */\r\n  engineInterface.projection.enable.flat = function(transaction) {\r\n    // This is an abstract method\r\n    // override this function if supported by your map engine\r\n    // Default behavior is to fail the request.\r\n\r\n    var iIndex;\r\n    for (iIndex = 0; iIndex < transaction.items.length; iIndex++) {\r\n      transaction.fail([{\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"This function is not supported by the map implementation.\"\r\n      }]);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  // return the engineInterface object as a new engineTemplate instance\r\n  return engineInterface;\r\n};\r\n","/*global emp */\r\n\r\n/**\r\n *\r\n * @namespace\r\n * @desc This namespace encapsulates function used to access the environment.\r\n */\r\nemp.environment = (function() {\r\n  var environmentList = [],\r\n    isReady = false,\r\n    readyCallbacks = [],\r\n    shutdownCallbacks = [],\r\n    proxyEnvironment = null,\r\n    readyCount = 0;\r\n\r\n\r\n\r\n  function dispatchReady() {\r\n    isReady = true;\r\n    var i, len;\r\n    len = readyCallbacks.length;\r\n    for (i = 0; i < len; i++) {\r\n      try {\r\n        readyCallbacks[i]();\r\n      }\r\n      catch (Error) {\r\n        emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Environment ready callback function generated and exception. \",\r\n          jsError: Error\r\n        });\r\n      }\r\n    }\r\n    readyCallbacks = [];\r\n  }\r\n\r\n  function checkReady() {\r\n    readyCount++;\r\n    if (readyCount >= environmentList.length) {\r\n      dispatchReady();\r\n    }\r\n  }\r\n\r\n  function checkShutdown() {\r\n    readyCount--;\r\n    if (readyCount <= 0) {\r\n      dispatchShutdown();\r\n    }\r\n  }\r\n\r\n\r\n  function dispatchShutdown() {\r\n    var i, len = shutdownCallbacks.length;\r\n    for (i = 0; i < len; i++) {\r\n      try {\r\n        shutdownCallbacks[i]();\r\n      }\r\n      catch (Error) {\r\n        emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          meesage: \"Environment shutdown callback function generated and exception. \",\r\n          jsError: Error\r\n        });\r\n      }\r\n    }\r\n    shutdownCallbacks = [];\r\n  }\r\n\r\n\r\n  function subscribeAll(args) {\r\n    var i, len = environmentList.length;\r\n    for (i = 0; i < len; i++) {\r\n      environmentList[i].pubSub.subscribe(args);\r\n    }\r\n  }\r\n\r\n  function publishAll(args) {\r\n    var i, len = environmentList.length;\r\n    for (i = 0; i < len; i++) {\r\n      // Filter out mouse move events for all environments except browser for performance reasons\r\n      if (args.channel !== cmapi.channel.names.MAP_VIEW_MOUSEMOVE || environmentList[i] === emp.environment.browser) {\r\n        environmentList[i].pubSub.publish(args);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  var publicInterface = {\r\n    /**\r\n     * @memberOf emp.environment\r\n     * @method\r\n     * @public\r\n     * @description This function is called to set the environment instance.\r\n     * @param {environmentInterface} environment This parameter must be an\r\n     * environment instance based on {@link environmentInterface}.\r\n     */\r\n    set: function(args) {\r\n      var i, env;\r\n\r\n      environmentList = args.environments;\r\n      for (i = 0; i < environmentList.length; i++) {\r\n        env = environmentList[i];\r\n        if (typeof env !== \"string\" && env.hasOwnProperty && env.hasOwnProperty(\"init\")) {\r\n          environmentList[i].init({\r\n            initcallback: checkReady,\r\n            shutdowncallback: checkShutdown,\r\n            mapInstanceId: args.mapInstanceId,\r\n            messageId: args.messageId,\r\n            iwcHost: args.iwcHost\r\n          });\r\n        }\r\n      }\r\n\r\n    },\r\n    /**\r\n     * @method\r\n     * @memberOf emp.environment\r\n     * @public\r\n     * @description This function is called to retrieve the environment instance.\r\n     * @return {environmentInterface} This function returns a reference to\r\n     * the environment instance.\r\n     */\r\n    get: function() {\r\n      if (proxyEnvironment === null) {\r\n        proxyEnvironment = emp.createEnvironmentTemplate();\r\n        proxyEnvironment.pubSub.publish = publishAll;\r\n        proxyEnvironment.pubSub.subscribe = subscribeAll;\r\n      }\r\n      return proxyEnvironment;\r\n    },\r\n    /**\r\n     * @method\r\n     * @memberOf emp.environment\r\n     * @public\r\n     * @description This function is called to set the ready and shutdown callbacks.\r\n     * @param {function=} readyCB This parameter, if provided, must be a\r\n     * function that takes no arguments.  It is called by the environment\r\n     * when its ready to process request.\r\n     * @param {function=} shutdownCB This parameter, if provided, must be a\r\n     * function that takes no arguments.  It is called by the environment\r\n     * before the environment is shutdown.\r\n     */\r\n    setCallbacks: function(readyCB, shutdownCB) {\r\n\r\n      if (readyCB && (typeof readyCB !== 'function')) {\r\n        throw emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Ready callback parameter is not a function.\"\r\n        });\r\n      }\r\n\r\n      if (shutdownCB && (typeof shutdownCB !== 'function')) {\r\n        throw emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Shutdown callback parameter is not a function.\"\r\n        });\r\n      }\r\n\r\n      if (isReady === true) {\r\n        readyCB();\r\n      }\r\n      else {\r\n        readyCallbacks.push(readyCB);\r\n      }\r\n\r\n      if (shutdownCB) {\r\n        shutdownCallbacks.push(shutdownCB);\r\n      }\r\n    }\r\n  };\r\n  return publicInterface;\r\n}());\r\n\r\n/**\r\n * @memberOf emp.environment\r\n * @public\r\n * @typedef {object} toolInfoType\r\n * @description This type defines the structure provided in onSuccess callback\r\n * of the getToolInfo environment call.\r\n * @property {string} toolName This property is the name provided in the call.\r\n * @property {object} toolhandle This property contains the structure\r\n * that must be provided to launchTool call.\r\n */\r\n\r\n\r\n/**\r\n * @memberOf emp.environment\r\n * @public\r\n * @typedef {object} toolErrorType\r\n * @description This type defines the structure provided in onError callback\r\n * of the environment calls.\r\n * @property {string} message This property contains the error message.\r\n * @property {string} statusCode This property contains the error status code.\r\n */\r\n","/*global emp */\r\n/* eslint-disable no-unused-vars */\r\n/**\r\n * @memberOf emp\r\n * @method\r\n * @description This function returns an object with all the namespaces and abstract functions required for an environment.  Environments define the pub/sub mechanism and user preference storage\r\n * When developing an environment, the first part of the js file for your environment should be a call to generate a template.\r\n * This template is for the public interface that your map environment will expose.\r\n * All of the internal functions and properties of your map engine should not be added to this template\r\n *\r\n * @return {environmentInterface}\r\n */\r\nemp.createEnvironmentTemplate = function() {\r\n  //noinspection JSValidateJSDoc\r\n  /**\r\n   * @ignore\r\n   * @namespace environmentInterface\r\n   * @description A public interface is returned as an environmentInterface instance when\r\n   * emp.createEnvironmentTemplate() is invoked. This is designed to use functional inheritance.\r\n   * Do not use the \"new\" keyword.\r\n   */\r\n  var environmentInterface = {\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @abstract\r\n     * @public\r\n     * @returns {boolean} True if initialization completes, false if initialization fails\r\n     * @param {object} args - Optional container for the initialization data\r\n     * @desc This function is used to initialize the environment\r\n     * @method\r\n     */\r\n    init: function(args) {\r\n      // Create ane EMP Error to notify system that this capability has not been implemented\r\n      emp.typeLibrary.Error({\r\n        message: \"The init method has not been implemented by this environment\"\r\n      });\r\n      // Return false as the initialization failed\r\n      return false;\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface.\r\n     * @abstract\r\n     * @public\r\n     * @returns {boolean} Returns true if the cleanup succeeded, false if there was an issue\r\n     * @desc This method is invoked when a new environment is set.  This is to be used to cleanup before it is replaced\r\n     * @method\r\n     */\r\n    destroy: function() {\r\n      // Create ane EMP Error to notify system that this capability has not been implemented\r\n      emp.typeLibrary.Error({\r\n        message: \"The destroy method has not been implemented by this environment\"\r\n      });\r\n      // Return false as the environment could not be destroyed\r\n      return false;\r\n    },\r\n    /**\r\n     * @ignore\r\n     * @memberOf environmentInterface\r\n     * @namespace\r\n     * @description Namespace that contains all the implementation information for pub/sub.\r\n     */\r\n    pubSub: {\r\n      /**\r\n       * @memberOf environmentInterface.pubSub\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} True if the message is successfully published, false if it fails\r\n       * @param {object} args - Container for the message info\r\n       * @param {object} args.message - Object containing an object formatted for a specific message channel\r\n       * @param {string} args.channel - Name for the channel being used to publish the message\r\n       * @param {object} args.sender - Info about the sender of the message\r\n       * @desc This function is used to dispatch message on the given channel\r\n       * @method\r\n       */\r\n      publish: function(args) {\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"pubSub.publish has not been implemented by this environment\"\r\n        });\r\n        // Return false for failure to publish\r\n        return false;\r\n      },\r\n      /**\r\n       * @memberOf environmentInterface.pubSub\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} True if the message is successfully subscribed, false if it fails\r\n       * @param {object} args - Container for the subscription info\r\n       * @param {object} args.callback - Function to be invoked when a message is received on this channel\r\n       * @param {string} args.channel - Name of the messaging channel being subscribed to\r\n       * @desc This function is used to subscribe for incoming messages on a given channel\r\n       * @method\r\n       */\r\n      subscribe: function(args) {\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"pubSub.subscribe has not been implemented by this environment\"\r\n        });\r\n        // Return false for failure to publish\r\n        return false;\r\n      },\r\n      /**\r\n       * @memberOf environmentInterface.pubSub\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} True if the message is successfully unsubscribed, false if it fails\r\n       * @param {object} args - Container for the subscription info\r\n       * @param {object} args.callback - Function to be invoked when a message is received on this channel\r\n       * @param {string} args.channel - Name of the messaging channel being subscribed to\r\n       * @desc This function is used to unsubscribe from incoming messages on a given channel\r\n       * @method\r\n       */\r\n      unsubscribe: function(args) {\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"pubSub.unsubscribe has not been implemented by this environment\"\r\n        });\r\n        // Return false for failure to publish\r\n        return false;\r\n      }\r\n    },\r\n    /**\r\n     * @ignore\r\n     * @memberOf engineInterface\r\n     * @namespace\r\n     * @description Namespace that contains all the implementation information for saving and getting user preferences.\r\n     */\r\n    prefs: {\r\n      /**\r\n       * @memberOf environmentInterface.prefs\r\n       * @abstract\r\n       * @public\r\n       * @returns {object | null} Returns the pref object if found, else returns null\r\n       * @param {object} args - Container for the pref info\r\n       * @param {string} args.key - Function to be invoked when a message is received on this channel\r\n       * @desc This function is used subscribe for incoming messages on a given channel\r\n       * @method\r\n       */\r\n      get: function(args) {\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"prefs.get has not been implemented by this environment\"\r\n        });\r\n        // Return null as the requested pref could not be returned\r\n        return null;\r\n      },\r\n      /**\r\n       * @memberOf environmentInterface.prefs\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} Returns true if the pref is saved, else returns false\r\n       * @param {object} args - Container for the pref info\r\n       * @param {string} args.key - Function to be invoked when a message is received on this channel\r\n       * @desc This function is used subscribe for incoming messages on a given channel\r\n       * @method\r\n       */\r\n      set: function(args) {\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"prefs.set has not been implemented by this environment\"\r\n        });\r\n        // Return null as the requested pref could not be returned\r\n        return false;\r\n      }\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @abstract\r\n     * @public\r\n     * @returns {GUID} Returns the ID of the environment instance.\r\n     * @method\r\n     */\r\n    getInstanceId: function() {\r\n      // Create ane EMP Error to notify system that this capability has not been implemented\r\n      emp.typeLibrary.Error({\r\n        message: \"getInstanceId has not been implemented by this environment\"\r\n      });\r\n      // Return null as the requested pref could not be returned\r\n      return undefined;\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @type string\r\n     * @description Name of the environment.\r\n     */\r\n    name: \"Unnamed Environment\",\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @type string\r\n     * @description Version of the environment.\r\n     */\r\n    version: \"1.0.0\",\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @type object\r\n     * @description Free form object to store properties that may need to be passed to the environment for it to function correctly.\r\n     * \r\n     */\r\n    properties: {},\r\n    sender: {\r\n      id: \"not-set\"\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @abstract\r\n     * @public\r\n     * @param {object} args - This object must contain the correct fields to execute the call.\r\n     * @param {object} args.toolHandle - This object must contain the object which identifies\r\n     * the tool to be launched. It should be obtained by calling getToolInfo.\r\n     * @param {function} args.onSuccess - Function to be invoked when the tools is launched.\r\n     * @param {function} args.onError - This function is called in the event of an error.\r\n     * @desc This function is used to launch a tool.\r\n     * @method\r\n     */\r\n    launchTool: function(args) {\r\n      emp.typeLibrary.Error({\r\n        message: \"launchTool has not been implemented by this environment\"\r\n      });\r\n      if (typeof args.onError === 'function') {\r\n        args.onError({\r\n          message: \"launchTool is not implemented by this environment.\"\r\n        });\r\n      }\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @abstract\r\n     * @public\r\n     * @param {object} args - Container for the call info\r\n     * @param {object} args.toolInfo - This object must contain the info which identifies\r\n     * the tool to retrieve.\r\n     * @param {string} args.toolInfo.toolName This field must contain the name\r\n     * of the tool retrieved via the map config.\r\n     * @param {function} args.onSuccess - Function to be invoked to return the info to the caller. The\r\n     * argument is of type {@link emp.environment.toolInfoType}\r\n     * @param {function} args.onError - This function is called in the event of an error.\r\n     * @desc This function is used to retrieve the environment info of a tool\r\n     * @method\r\n     */\r\n    getToolInfo: function(args) {\r\n      emp.typeLibrary.Error({\r\n        message: \"getToolInfo has not been implemented by this environment\"\r\n      });\r\n      if (typeof args.onError === 'function') {\r\n        args.onError({\r\n          message: \"getToolInfo is not implemented by this environment.\"\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  // returns a copy of the environmentInterface template object that will have\r\n  // its methods and properties overridden by an environment definition\r\n  return environmentInterface;\r\n};\r\n/* eslint-enable no-unused-args */","emp.contextMenuStorageManager = (function () {\r\n  var oContextMenuStorage = {\r\n    globalMenus: {},\r\n//        mapInstanceMenus: {}\r\n    mapInstanceMenus: undefined\r\n  };\r\n\r\n  var getMapMenuStorage = function () {\r\n    return oContextMenuStorage.mapInstanceMenus; //[mapInstanceId];\r\n  };\r\n\r\n  var getMenuListfn = function (mapInstanceId, eType) {\r\n    var mapMenuStorage;\r\n    var oMenuCollection = undefined;\r\n\r\n    switch (eType) {\r\n      case emp.typeLibrary.Menu.Type.MAP_GLOBAL:\r\n        mapMenuStorage = getMapMenuStorage(mapInstanceId);\r\n        if (mapMenuStorage) {\r\n          oMenuCollection = mapMenuStorage.mapMenus;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.Menu.Type.OVERLAY_GLOBAL:\r\n        mapMenuStorage = getMapMenuStorage(mapInstanceId);\r\n        if (mapMenuStorage) {\r\n          oMenuCollection = mapMenuStorage.mapOverlayMenus;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.Menu.Type.FEATURE_GLOBAL:\r\n        mapMenuStorage = getMapMenuStorage(mapInstanceId);\r\n        if (mapMenuStorage) {\r\n          oMenuCollection = mapMenuStorage.mapFeatureMenus;\r\n        }\r\n        break;\r\n      case emp.typeLibrary.Menu.Type.OBJECT_INSTANCE:\r\n      case emp.typeLibrary.Menu.Type.SUBMENU:\r\n        oMenuCollection = oContextMenuStorage.globalMenus;\r\n        break;\r\n    }\r\n\r\n    return oMenuCollection;\r\n  };\r\n\r\n  var publicInterface = {\r\n    newMapInstance: function () {\r\n      /*\r\n       if (!oContextMenuStorage.mapInstanceMenus.hasOwnProperty(mapInstanceId))\r\n       {\r\n       oContextMenuStorage.mapInstanceMenus[mapInstanceId] = {\r\n       mapMenus: {},\r\n       mapFeatureMenus: {},\r\n       mapOverlayMenus: {}\r\n       };\r\n       }\r\n       return oContextMenuStorage.mapInstanceMenus[mapInstanceId];\r\n       */\r\n      if (oContextMenuStorage.mapInstanceMenus === undefined) {\r\n        oContextMenuStorage.mapInstanceMenus = {\r\n          mapMenus: {},\r\n          mapFeatureMenus: {},\r\n          mapOverlayMenus: {}\r\n        };\r\n      }\r\n      return oContextMenuStorage.mapInstanceMenus;\r\n    },\r\n    removeMapInstance: function () {\r\n      /*\r\n       if (oContextMenuStorage.mapInstanceMenus.hasOwnProperty(mapInstanceId))\r\n       {\r\n       delete oContextMenuStorage.mapInstanceMenus[mapInstanceId];\r\n       }\r\n       */\r\n    },\r\n    add: function (oTransaction) {\r\n      var iItemIndex;\r\n      var oItem;\r\n      var oItems = oTransaction.items;\r\n      var oMenuCollection = {};\r\n      var mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n      if (oTransaction.items && oTransaction.originChannel === \"map.menu.create\") {\r\n        for (iItemIndex = 0; iItemIndex < oItems.length;) {\r\n          oItem = oItems[iItemIndex];\r\n          oMenuCollection = getMenuListfn(mapInstanceId, oItem.menuType);\r\n\r\n          if (!oMenuCollection) {\r\n            // We must fail the creation.\r\n            oTransaction.fail([{\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Invalid menu type.\"\r\n            }]);\r\n          }\r\n          else {\r\n            // Check to see if the menu already exist in the collection.\r\n            if (oMenuCollection[oItem.menuId]) {\r\n              // We must fail the creation.\r\n              oTransaction.fail([{\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"A menu with the same ID already exists.\"\r\n              }]);\r\n            } else {\r\n              // create new store, which will also create our items...\r\n              oMenuCollection[oItem.menuId] = new emp.ui.menu.context.model.menu(oItem);\r\n              iItemIndex++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    remove: function (oTransaction) {\r\n      var oItem;\r\n      var iIndex;\r\n      var sMenuId;\r\n      var oMapInstanceMenus;\r\n      var oItems = oTransaction.items;\r\n      var mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n      if (oTransaction.items && oTransaction.originChannel === \"map.menu.remove\") {\r\n        for (iIndex = 0; iIndex < oItems.length;) {\r\n          oItem = oItems[iIndex];\r\n          sMenuId = oItem.menuId;\r\n\r\n          if (oContextMenuStorage.globalMenus.hasOwnProperty(sMenuId)) {\r\n            delete oContextMenuStorage.globalMenus[sMenuId];\r\n            iIndex++;\r\n          }\r\n          else {\r\n            oMapInstanceMenus = getMapMenuStorage(mapInstanceId);\r\n\r\n            if (oMapInstanceMenus) {\r\n              if (oMapInstanceMenus.mapMenus.hasOwnProperty(sMenuId)) {\r\n                delete oMapInstanceMenus.mapMenus[sMenuId];\r\n                iIndex++;\r\n              } else if (oMapInstanceMenus.mapOverlayMenus.hasOwnProperty(sMenuId)) {\r\n                delete oMapInstanceMenus.mapOverlayMenus[sMenuId];\r\n                iIndex++;\r\n              } else if (oMapInstanceMenus.mapFeatureMenus.hasOwnProperty(sMenuId)) {\r\n                delete oMapInstanceMenus.mapFeatureMenus[sMenuId];\r\n                iIndex++;\r\n              }\r\n              else {\r\n                oTransaction.fail([{\r\n                  coreId: oItem.coreId,\r\n                  level: emp.typeLibrary.Error.level.MAJOR,\r\n                  message: \"Menu not found in map instance.\"\r\n                }]);\r\n              }\r\n            }\r\n            else {\r\n              oTransaction.fail([{\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Map instance not found, menu not deleted.\"\r\n              }]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    active: function (oTransaction) {\r\n      var iIndex;\r\n      var iMenuItemIndex;\r\n      var oItem;\r\n      var sMenuItemId;\r\n      var aMenuItems;\r\n      var bVisibility = false;\r\n      var oItems = oTransaction.items;\r\n      var oMapInstanceMenus;\r\n      var mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n      var findMenuItem = function (oMenuCollection, sMenuItemId) {\r\n        var iIndex;\r\n        var aMenuIdList;\r\n        var oMenu;\r\n\r\n        // We need to find the menu Item in the collection of menus.\r\n        if (!emp.helpers.associativeArray.isEmpty(oMenuCollection)) {\r\n          aMenuIdList = emp.helpers.associativeArray.getKeys(oMenuCollection);\r\n\r\n          for (iIndex = 0; iIndex < aMenuIdList.length; iIndex++) {\r\n            oMenu = oMenuCollection[aMenuIdList[iIndex]];\r\n\r\n            if (oMenu.items.hasOwnProperty(sMenuItemId)) {\r\n              // We found an instance of the menu item. Place it on the list.\r\n              aMenuItems.push(oMenu.items[sMenuItemId]);\r\n            }\r\n          }\r\n        }\r\n      };\r\n\r\n      oMapInstanceMenus = getMapMenuStorage(mapInstanceId);\r\n\r\n      for (iIndex = 0; iIndex < oItems.length;) {\r\n        aMenuItems = [];\r\n        oItem = oItems[iIndex];\r\n        sMenuItemId = oItem.menuItemId;\r\n        bVisibility = oItem.visible;\r\n\r\n        // Find all the menu items with the same Id.\r\n        findMenuItem(oContextMenuStorage.globalMenus, sMenuItemId);\r\n        findMenuItem(oMapInstanceMenus.mapMenus, sMenuItemId);\r\n        findMenuItem(oMapInstanceMenus.mapOverlayMenus, sMenuItemId);\r\n        findMenuItem(oMapInstanceMenus.mapFeatureMenus, sMenuItemId);\r\n\r\n        if (aMenuItems.length === 0) {\r\n          oTransaction.fail([{\r\n            coreId: oItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"Menu item not found.\"\r\n          }]);\r\n        }\r\n        else {\r\n          // We found at least 1.\r\n          // Set the visibility of all of them.\r\n          for (iMenuItemIndex = 0; iMenuItemIndex < aMenuItems.length; iMenuItemIndex++) {\r\n            aMenuItems[iMenuItemIndex].visible = bVisibility;\r\n          }\r\n          iIndex++;\r\n        }\r\n      }\r\n    },\r\n    getFeatureMenuIdList: function (mapInstanceId, oFeature) {\r\n      var rObject = {\r\n        feature: [],\r\n        overlay: [],\r\n        parent: []\r\n      };\r\n\r\n      if (!emp.helpers.isEmptyString(oFeature.getMenuId())) {\r\n        rObject.feature.push(oFeature.getMenuId());\r\n      }\r\n      return rObject;\r\n    },\r\n    getMenuList: function (mapInstanceId, eType) {\r\n      return getMenuListfn(mapInstanceId, eType);\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n","/* globals emp */\r\n\r\n/**\r\n * Storage Mechanisms for Core\r\n * @namespace\r\n * @memberof emp\r\n */\r\nemp.storage = (function () {\r\n  /** Hash of instantiated map */\r\n  var instances;\r\n\r\n  var removeMapInstanceFromStorage = function (oInstanceData) {\r\n    var oRootStorageEntry = emp.storage._storage.store[oInstanceData.rootGUID];\r\n\r\n    if (oRootStorageEntry) {\r\n      emp.storage.removeParentFromChildren(oRootStorageEntry);\r\n      emp.storage.deleteObject(oRootStorageEntry);\r\n    }\r\n  };\r\n\r\n  var publicInterface = {\r\n    /**\r\n     * @memberof emp.storage\r\n     * @name emp.storage\r\n     */\r\n    init: function () {\r\n      instances = {};\r\n    },\r\n    /**\r\n     * Where everything is actually stored\r\n     * @memberOf emp.storage\r\n     * @protected\r\n     * @type {Object}\r\n     */\r\n    _storage: {\r\n      /**\r\n       * THE place where everything is stored\r\n       * @type {Object}\r\n       * @memberof emp.storage._storage\r\n       */\r\n      store: {},\r\n      /**\r\n       * Used to directly retrieve stuff from storage\r\n       * @method\r\n       * @param  {object} args\r\n       * @param  {string} args.coreId\r\n       * @return {emp.classLibrary.EmpRenderableObject}\r\n       */\r\n      get: function (args) {\r\n        if (args.coreId) {\r\n          return this.store[args.coreId];\r\n        }\r\n\r\n        return undefined;\r\n      },\r\n      /**\r\n       * Used to put stuff directly in the engine\r\n       * @protected\r\n       * @param {emp.classLibrary.EmpRenderableObject} empObject\r\n       */\r\n      set: function (empObject) {\r\n        if (empObject.getCoreId()) {\r\n          this.store[empObject.getCoreId()] = empObject;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp.storage\r\n     */\r\n    getRootGuid: function (instanceId) {\r\n      if (instances.hasOwnProperty(instanceId)) {\r\n        return instances[instanceId].rootGUID;\r\n      }\r\n      return undefined;\r\n    },\r\n    /**\r\n     * Returns whether the given string is the root overlay for any of the instantiated maps\r\n     * False if not found\r\n     * @param {string} coreId\r\n     * @memberof emp.storage\r\n     * @returns {boolean | object}\r\n     */\r\n    isRoot: function (coreId) {\r\n      for (var instance in instances) {\r\n        if (instances.hasOwnProperty(instance)) {\r\n           if (instances[instance].rootGUID === coreId) {\r\n            return instance;\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n    },\r\n    /**\r\n     * Adds a new map instance to the instances hash and constructs a new root {@link emp.classLibrary.EmpOverlay}\r\n     * to the {@link emp.storage._storage.store}\r\n     *\r\n     * This method will also add the new listeners for {@link emp.transactionQueue}\r\n     *\r\n     * @memberof emp.storage\r\n     *\r\n     * @param {object} args\r\n     * @param {string} args.mapInstanceId\r\n     */\r\n    newMapInstance: function (args) {\r\n      var oRootOverlay = new emp.typeLibrary.Overlay({\r\n        name: \"Root Overlay for Map \" + args.mapInstanceId,\r\n        overlayId: args.mapInstanceId\r\n      });\r\n\r\n      oRootOverlay = new emp.classLibrary.EmpOverlay(oRootOverlay);\r\n      oRootOverlay.setVisibleOnMap(args.mapInstanceId, true);\r\n\r\n      if (instances.hasOwnProperty(args.mapInstanceId)) {\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Storage map instance exists. (\" + args.mapInstanceId + \")\"\r\n        });\r\n        return;\r\n      }\r\n\r\n      var oInstanceData = {\r\n        mapInstanceId: args.mapInstanceId,\r\n        rootGUID: oRootOverlay.getCoreId()\r\n      };\r\n\r\n      instances[args.mapInstanceId] = oInstanceData;\r\n      emp.storage._storage.store[oRootOverlay.getCoreId()] = oRootOverlay;\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.EDIT_UPDATE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.feature.editUpdate\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_SET,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterSet\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_ACTIVATE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterActivate\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterDeactivate\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_REMOVE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterRemove\r\n      });\r\n    },\r\n    /**\r\n     * @memberof emp.storage\r\n     */\r\n    removeMapInstance: function (args) {\r\n      var oInstanceData;\r\n\r\n      if (!instances.hasOwnProperty(args.mapInstanceId)) {\r\n        return;\r\n      }\r\n\r\n      oInstanceData = instances[args.mapInstanceId];\r\n\r\n      removeMapInstanceFromStorage(oInstanceData);\r\n\r\n      emp.transactionQueue.listener.remove({\r\n        type: emp.intents.control.EDIT_UPDATE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.feature.editUpdate\r\n      });\r\n\r\n      emp.transactionQueue.listener.remove({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_SET,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterSet\r\n      });\r\n\r\n      emp.transactionQueue.listener.remove({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_ACTIVATE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterActivate\r\n      });\r\n\r\n      emp.transactionQueue.listener.remove({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterDeactivate\r\n      });\r\n\r\n      emp.transactionQueue.listener.remove({\r\n        type: emp.intents.control.OVERLAY_CLUSTER_REMOVE,\r\n        mapInstanceId: args.mapInstanceId,\r\n        callback: emp.storage.overlay.clusterRemove\r\n      });\r\n\r\n      emp.contextMenuStorageManager.removeMapInstance(args.mapInstanceId);\r\n      delete instances[args.mapInstanceId];\r\n      emp.storage.selection.removeSelectedList(args.mapInstanceId);\r\n    },\r\n    /**\r\n     * @memberof emp.storage\r\n     */\r\n    readOnlyPermission: function (mapInstanceId, oStorageItem) {\r\n      var mapRootGUID = this.getRootGuid(mapInstanceId);\r\n\r\n      var recurseUp = function (oStorageItem, bContinueRecursion) {\r\n        var oParent;\r\n        var sCoreId;\r\n        var oParentList = oStorageItem.getParentRelationshipList();\r\n\r\n        if (oStorageItem.getCoreId() !== mapRootGUID) {\r\n          for (sCoreId in oParentList) {\r\n            if (!oParentList.hasOwnProperty(sCoreId)) {\r\n              continue;\r\n            }\r\n            oParent = oParentList[sCoreId].getParent();\r\n\r\n            if (!oParent.isReadOnly()) {\r\n              return false;\r\n            }\r\n            else if (oParent.hasParents() && bContinueRecursion) {\r\n              return recurseUp(oParent, false);\r\n            }\r\n          }\r\n        }\r\n\r\n        return false;\r\n      };\r\n\r\n      switch (oStorageItem.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.OVERLAY:\r\n          // For overlays we don't look at it self.\r\n          // Its only readOnly if its parent is readOnly.\r\n          if (oStorageItem.hasParents()) {\r\n            return recurseUp(oStorageItem, false);\r\n          }\r\n          break;\r\n        case emp.typeLibrary.types.FEATURE:\r\n          if (oStorageItem.hasParents()) {\r\n            return recurseUp(oStorageItem, false);\r\n          }\r\n          break;\r\n      }\r\n      return false;\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n","/* globals emp, armyc2 */\r\n\r\n/**\r\n * Gets total count of storage engine objects minus root\r\n * @return {number}\r\n */\r\nemp.storage.getPrimaryCount = function() {\r\n  var c = 0;\r\n  for (var k in emp.storage._storage.store) {\r\n    if (emp.storage._storage.store.hasOwnProperty(k)) {\r\n      ++c;\r\n    }\r\n\r\n  }\r\n  return c - 1; // people don't need to know about root.\r\n};\r\n\r\n/**\r\n * This function removes this object from all of its parents by calling {@link emp.classLibrary.EmpRenderableObject#removeFromAllParent}\r\n * @param {string} sCoreId\r\n */\r\nemp.storage.removeFromParent = function(sCoreId) {\r\n\r\n  var oItem = emp.storage._storage.store[sCoreId];\r\n\r\n  if (oItem !== undefined) {\r\n    // Make sure the items is in storage.\r\n    // And remove it from all parents.\r\n    oItem.removeFromAllParent();\r\n  }\r\n};\r\n\r\n/**\r\n * This function adds an object to a parent node by invoking {@link emp.classLibrary.EmpRenderableObject#addChild}\r\n * This establishes the link on the parent object.\r\n * @param {string} sCoreId\r\n */\r\nemp.storage.addToParent = function(sCoreId) {\r\n\r\n  var oParentNode;\r\n  var oItem = emp.storage._storage.store[sCoreId];\r\n\r\n  if (oItem !== undefined) {\r\n    // Make sure the items is in storage.\r\n    // Get the items parent.\r\n    oParentNode = emp.storage._storage.store[oItem.coreParent];\r\n\r\n    if (oParentNode !== undefined) {\r\n      oParentNode.addChild(oItem, oItem.visibilitySetting);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param {string} sCoreId\r\n */\r\nemp.storage.removeChild = function(sCoreId) {\r\n\r\n  /** @type emp.classLibrary.EmpRenderableObject */\r\n  var oItem = emp.storage._storage.store[sCoreId];\r\n\r\n  if (oItem !== undefined) {\r\n    //console.log(\"SE Removing \" + oItem.name + \" (\" + oItem.coreId + \").\");\r\n    // Make sure the items is in storage.\r\n    // Loop while it has children\r\n\r\n    if (oItem.hasChildren()) {\r\n      var aCoreIdList = oItem.getChildrenCoreIds();\r\n      var numChildren = aCoreIdList.length;\r\n      for (var iIndex = 0; iIndex < numChildren; iIndex++) {\r\n        emp.storage.removeChild(aCoreIdList[iIndex]);\r\n      }\r\n    }\r\n\r\n    //Take it off its parents child list.\r\n    oItem.removeFromAllParent();\r\n    // Now delete the child.\r\n    delete emp.storage._storage.store[sCoreId];\r\n    //console.log(\"     DELETED \" + oItem.name + \" (\" + oItem.coreId + \").\");\r\n  }\r\n};\r\n\r\n/**\r\n * Feature actions\r\n *\r\n * @namespace\r\n * @property {function} add Add feature to storage\r\n * @property {function} remove Remove feature from storage\r\n * @property {function} update Update feature from storage\r\n */\r\nemp.storage.feature = {};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} transaction\r\n */\r\nemp.storage.feature.add = function(transaction) {\r\n  var empFeature;\r\n  var parent;\r\n  var item;\r\n  var parentCount;\r\n  var i, j;\r\n  var items = transaction.items;\r\n  var mapList;\r\n  var prevMapList; // A list of maps that a feature was already on.\r\n  var transactions = {}; // A list of transactions being sent out to the\r\n  // map instances\r\n\r\n  for (i = 0; i < items.length; i++) {\r\n    item = items[i];\r\n    prevMapList = [];\r\n\r\n    // See if the feature already exists.\r\n    empFeature = emp.storage.findFeature(item.overlayId, item.featureId);\r\n\r\n    // If the feature exists retrieve the map instances it was on, and\r\n    // update item\r\n    // If the feature doesn't exist, create a new storage entry, EmpFeature,\r\n    // and store it in the storage manager.\r\n    if (empFeature) {\r\n      prevMapList = empFeature.getParentMapInstanceList();\r\n      if (!emp.storage.feature.updateItem(transactions, transaction, empFeature, item)) {\r\n        continue;\r\n      }\r\n    }\r\n    else {\r\n      // This feature is new, so store the feature in the storage manager.\r\n      empFeature = new emp.classLibrary.EmpFeature(item);\r\n      emp.storage.storeObject(empFeature);\r\n    }\r\n\r\n    // if the item has a coreParent, then it came from a addFeature call from\r\n    // an overlay or another feature.  If coreParent has not been defined\r\n    // Feature.apply is being called.  Feature.apply does not notify\r\n    // which parent it is on so some more work needs to be done.\r\n    if (!emp.helpers.isEmptyString(item.coreParent)) {\r\n      parent = emp.storage.get.id({\r\n        id: item.coreParent\r\n      });\r\n      if (parent === undefined) {\r\n        transaction.fail({\r\n          coreId: item.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: 'Unable to create parent overlay of ' + item.name + '.'\r\n        });\r\n        continue;\r\n      }\r\n\r\n      // Check to see if the feature is already on the parent.  If\r\n      // this feature is being added for a second time, like an update,\r\n      // then this would happen.  If it is not already on the parent,\r\n      // add it.\r\n      if (!parent.isParentOf(empFeature.getCoreId())) {\r\n        parent.addChild(empFeature, item.visible);\r\n      }\r\n\r\n      // Get the map instances that the feature's parents are on.\r\n      mapList = empFeature.getParentMapInstanceList();\r\n      emp.storage.processRequest(transactions, prevMapList, mapList, parent, empFeature, item.zoom);\r\n    }\r\n    else {\r\n      // feature plots as an update do not have a parent.\r\n      // so we need to update all of them.\r\n      parentCount = empFeature.parentCount();\r\n\r\n      // Get the map instances that the feature's parents are on.\r\n      mapList = empFeature.getParentMapInstanceList();\r\n\r\n      for (j = 0; j < parentCount; j++) {\r\n        parent = empFeature.getParentByIndex(j);\r\n        emp.storage.processRequest(transactions, prevMapList, mapList, parent, empFeature, item.zoom);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  emp.storage.executeTransactions(transactions);\r\n};\r\n\r\n/**\r\n * @param {emp.classLibrary.EmpFeature} oFeature\r\n * @param sOverlayId\r\n * @private\r\n */\r\nemp.storage.feature._setChildrenOverlay = function(oFeature, sOverlayId) {\r\n  var store = emp.storage._storage.store;\r\n  var oChildItem;\r\n  var oListCopy = oFeature.getChildrenCoreIds();\r\n\r\n  for (var iIndex = 0; iIndex < oListCopy.length; iIndex++) {\r\n    oChildItem = store[oListCopy[iIndex]];\r\n    if (oChildItem) {\r\n      // Change the overlay ID of its children.\r\n      emp.storage.feature._setChildrenOverlay(oChildItem, sOverlayId);\r\n\r\n      // Set the new overlay.\r\n      oChildItem.overlayId = sOverlayId;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param oTransactions\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n * @param oStorageEntry\r\n * @param oNewItem\r\n * @returns {boolean}\r\n */\r\nemp.storage.feature.updateItem = function(oTransactions, oTransaction, oStorageEntry, oNewItem) {\r\n  var oParent;\r\n  var aParentMapList;\r\n  var iMapIndex;\r\n  var oNewParent;\r\n  var sBasicSC1, sBasicSC2;\r\n\r\n  if (oNewItem.hasOwnProperty('format') && (oNewItem.format !== oStorageEntry.getFormat())) {\r\n    oTransaction.fail({\r\n      coreId: oNewItem.coreId,\r\n      level: emp.typeLibrary.Error.level.MAJOR,\r\n      message: \"Feature \" + oStorageEntry.getName() + \" can not be updated from a \" + oStorageEntry.getFormat() + \" to a \" + oNewItem.format + \".\"\r\n    });\r\n    return false;\r\n  }\r\n\r\n  if (oStorageEntry.isInEditMode() &&\r\n    oNewItem.hasOwnProperty('data') &&\r\n    (oStorageEntry.getFormat() === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL)) {\r\n    // Its a milstd. Make sure that the basic Symbol Code does not change.\r\n    sBasicSC1 = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(oStorageEntry.getSymbolCode());\r\n    sBasicSC2 = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(oNewItem.data.symbolCode);\r\n    if (sBasicSC1 !== sBasicSC2) {\r\n      oTransaction.fail({\r\n        coreId: oNewItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Feature \" + oStorageEntry.getName() + \" can not be updated from one symbol type to another while being edited.\"\r\n      });\r\n      return false;\r\n    }\r\n  }\r\n\r\n  if (!emp.helpers.isEmptyString(oNewItem.parentId)) {\r\n    // If it has a parent feature, get it.\r\n    switch (oNewItem.parentId) {\r\n      case emp.constant.parentIds.ALL_PARENTS:\r\n      case emp.constant.parentIds.MAP_ROOT:\r\n        break;\r\n      default:\r\n        oParent = emp.storage.findFeature(oNewItem.overlayId, oNewItem.parentId);\r\n        if (oParent === undefined) {\r\n          oTransaction.fail({\r\n            coreId: oNewItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"Unable to find parent feature of feature \" + oStorageEntry.getName() + \".\"\r\n          });\r\n          return false;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  else if (!emp.helpers.isEmptyString(oNewItem.overlayId)) {\r\n    switch (oNewItem.overlayId) {\r\n      case emp.constant.parentIds.ALL_PARENTS:\r\n        break;\r\n      case emp.constant.parentIds.MAP_ROOT:\r\n        break;\r\n      default:\r\n        oParent = emp.storage.findOverlay(oNewItem.overlayId);\r\n        if (oParent === undefined) {\r\n          if (oNewItem.hasOwnProperty('destOverlayId') ||\r\n            oNewItem.hasOwnProperty('destParentId')) {\r\n            // This is a feature move. But the current parent is not found.\r\n            oTransaction.fail({\r\n              coreId: oNewItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Unable to find parent overlay of feature \" + oStorageEntry.getName() + \". Feature move failed.\"\r\n            });\r\n            return false;\r\n          }\r\n          else {\r\n            // The feature is being added to an overlay that does not yet exists.\r\n            // So we need to create it.\r\n            emp.storage.overlay.createOverlay(oTransaction.mapInstanceId, oNewItem.overlayId, oTransaction.sender);\r\n            oParent = emp.storage.findOverlay(oNewItem.overlayId);\r\n            if (!oParent) {\r\n              oTransaction.fail({\r\n                coreId: oNewItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Unable to create new parent overlay of feature \" + oStorageEntry.getName() + \".\"\r\n              });\r\n              return false;\r\n            }\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  if (oNewItem.destOverlayId || oNewItem.destParentId) {\r\n    if (!oParent) {\r\n      oTransaction.fail({\r\n        coreId: oNewItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Invalid parent of feature \" + oStorageEntry.getName() + \".\"\r\n      });\r\n      return false;\r\n    }\r\n    if (!emp.helpers.isEmptyString(oNewItem.destParentId)) {\r\n      oNewParent = emp.storage.findFeature(oNewItem.destOverlayId, oNewItem.destParentId);\r\n      if (oNewParent === undefined) {\r\n        oTransaction.fail({\r\n          coreId: oNewItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Unable to find new parent feature of feature \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        return false;\r\n      }\r\n    }\r\n    else if (!emp.helpers.isEmptyString(oNewItem.destOverlayId)) {\r\n      oNewParent = emp.storage.findOverlay(oNewItem.destOverlayId);\r\n      if (oNewParent === undefined) {\r\n        oTransaction.fail({\r\n          coreId: oNewItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Unable to find new parent overlay of feature \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        return false;\r\n      }\r\n    }\r\n    // Now remove it from the parent.\r\n    oParent.removeChild(oStorageEntry);\r\n    // Get the map list of the parent.\r\n    aParentMapList = oParent.getParentMapInstanceList();\r\n\r\n    // Now we must send a remove to all the maps the parent is on so they can update their UI.\r\n    for (iMapIndex = 0; iMapIndex < aParentMapList.length; iMapIndex++) {\r\n      emp.storage.addToObjectRemoveTransaction(oTransactions, aParentMapList[iMapIndex], oParent, oStorageEntry);\r\n    }\r\n    oParent = oNewParent;\r\n\r\n  }\r\n\r\n  if (oParent && !oParent.isParentOf(oStorageEntry.getCoreId())) {\r\n    // we have a new parent\r\n    // So we add it to the parent.\r\n    oParent.addChild(oStorageEntry, true);\r\n  }\r\n\r\n  // Now we copy all other fields.\r\n  oStorageEntry.updateFeature(oNewItem);\r\n  return true;\r\n};\r\n\r\n/**\r\n *\r\n * @param  {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.feature.update = function(oTransaction) {\r\n  var oEmpFeature;\r\n  var oItem;\r\n  var iIndex;\r\n  var aMapList, aPrevMapList;\r\n  var oTransactions = {};\r\n  var oParent;\r\n\r\n  for (iIndex = 0; iIndex < oTransaction.items.length;) {\r\n    aMapList = [];\r\n    aPrevMapList = [];\r\n    oItem = oTransaction.items[iIndex];\r\n    oEmpFeature = emp.storage.findFeature(oItem.overlayId, oItem.featureId);\r\n    if (oEmpFeature === undefined) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Feature no found. Update canceled.\"\r\n      });\r\n      continue;\r\n    }\r\n    else {\r\n      aPrevMapList = oEmpFeature.getParentMapInstanceList();\r\n      if (!emp.storage.feature.updateItem(oTransactions, oTransaction, oEmpFeature, oItem)) {\r\n        continue;\r\n      }\r\n    }\r\n    aMapList = oEmpFeature.getParentMapInstanceList();\r\n    oParent = emp.storage.findObject(oItem.coreParent);\r\n    if (oParent === undefined) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Parent not found. Update canceled.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    emp.storage.processRequest(oTransactions, aPrevMapList, aMapList, oParent, oEmpFeature);\r\n\r\n    iIndex++;\r\n  }\r\n\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n\r\nemp.storage.executeTransactions = function(oTransactions) {\r\n  var mapInstanceId;\r\n\r\n  if (oTransactions.hasOwnProperty('oFeatureRemoveFromMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oFeatureRemoveFromMapTransactions) {\r\n      if (oTransactions.oFeatureRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oFeatureRemoveFromMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oWMSRemoveFromMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oWMSRemoveFromMapTransactions) {\r\n      if (oTransactions.oWMSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oWMSRemoveFromMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oWMTSRemoveFromMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oWMTSRemoveFromMapTransactions) {\r\n      if (oTransactions.oWMTSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oWMTSRemoveFromMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oKmlLayerRemoveFromMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oKmlLayerRemoveFromMapTransactions) {\r\n      if (oTransactions.oKmlLayerRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oKmlLayerRemoveFromMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oObjectRemoveTransaction')) {\r\n    for (mapInstanceId in oTransactions.oObjectRemoveTransaction) {\r\n      if (oTransactions.oObjectRemoveTransaction.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oObjectRemoveTransaction[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oObjectAddTransaction')) {\r\n    for (mapInstanceId in oTransactions.oObjectAddTransaction) {\r\n      if (oTransactions.oObjectAddTransaction.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oObjectAddTransaction[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oFeatureAddToMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oFeatureAddToMapTransactions) {\r\n      if (oTransactions.oFeatureAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oFeatureAddToMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oWMSAddToMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oWMSAddToMapTransactions) {\r\n      if (oTransactions.oWMSAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oWMSAddToMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oWMTSAddToMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oWMTSAddToMapTransactions) {\r\n      if (oTransactions.oWMTSAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oWMTSAddToMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oKmlLayerAddToMapTransactions')) {\r\n    for (mapInstanceId in oTransactions.oKmlLayerAddToMapTransactions) {\r\n      if (oTransactions.oKmlLayerAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oKmlLayerAddToMapTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('featureUpdateTransactions')) {\r\n    for (mapInstanceId in oTransactions.featureUpdateTransactions) {\r\n      if (oTransactions.featureUpdateTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.featureUpdateTransactions[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransactions.hasOwnProperty('oObjectUpdatedTransaction')) {\r\n    for (mapInstanceId in oTransactions.oObjectUpdatedTransaction) {\r\n      if (oTransactions.oObjectUpdatedTransaction.hasOwnProperty(mapInstanceId)) {\r\n        oTransactions.oObjectUpdatedTransaction[mapInstanceId].run();\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Removes a features from the store. Any children of the feature will be recursively removed if they no longer have\r\n * any other parent.\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.feature.remove = function(oTransaction) {\r\n  var oStorageEntry;\r\n  var oaItems = oTransaction.items;\r\n  var aMapList, aPrevMapList;\r\n  var oTransactions = {};\r\n  var iIndex;\r\n  var oItem;\r\n  var oParent;\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n    oItem = oaItems[iIndex];\r\n    //console.log(iIndex + \" - coreId: \" + oItem.coreId + \" overlayId: \" + oItem.overlayId);\r\n    oStorageEntry = emp.storage.get.id({\r\n      id: oItem.coreId\r\n    });\r\n\r\n    if (oStorageEntry === undefined) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Feature remove: feature \" + oItem.coreId + \" not found.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    if (!emp.helpers.isEmptyString(oItem.parentId)) {\r\n      // If it has a parent feature, get it.\r\n      oParent = emp.storage.findFeature(oItem.overlayId, oItem.parentId);\r\n      if (oParent === undefined) {\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Unable to find parent feature of feature \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        continue;\r\n      }\r\n    }\r\n    else {\r\n      oParent = emp.storage.findOverlay(oItem.overlayId);\r\n\r\n      if (oParent === undefined) {\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Unable to find parent overlay of feature \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        continue;\r\n      }\r\n    }\r\n\r\n    if (!oParent.isParentOf(oStorageEntry.getCoreId())) {\r\n      // The identified parent is not a parent of the storage object.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: oParent.getName() + \" is not a parent of feature \" + oStorageEntry.getName() + \".\"\r\n      });\r\n      continue;\r\n    }\r\n    aPrevMapList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    if (oStorageEntry.parentCount() === 1) {\r\n      // The storage entry will have no more parents.\r\n      // Delete all children with no other parents.\r\n      emp.storage.removeParentFromChildren(oStorageEntry);\r\n    }\r\n\r\n    oParent.removeChild(oStorageEntry);\r\n\r\n    aMapList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    emp.storage.processRequest(oTransactions, aPrevMapList, aMapList, oParent, oStorageEntry);\r\n\r\n    emp.storage.deleteObject(oStorageEntry);\r\n\r\n  }\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.feature.editUpdate = function(oTransaction) {\r\n  var oEditItem = oTransaction.items[0];\r\n  var store = emp.storage._storage.store;\r\n  var oStorageItem;\r\n\r\n  if (oEditItem.complete ||\r\n    (oEditItem.updateEventType === emp.typeLibrary.UpdateEventType.COMPLETE)) {\r\n    // We only store the data if its finished.\r\n    oStorageItem = store[oEditItem.coreId];\r\n    if (oStorageItem) {\r\n      oStorageItem.updateFeature(oEditItem);\r\n    }\r\n    else {\r\n      new emp.typeLibrary.Error({\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Edited features not found in storage.\"\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param  {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.removeItems = function(oTransaction) {\r\n\r\n  var oItem;\r\n  var store = emp.storage._storage.store;\r\n  var oaItems = oTransaction.items;\r\n\r\n  for (var i = 0; i < oaItems.length; i = i + 1) {\r\n    oItem = store[oaItems[i].coreId];\r\n\r\n    if (oItem === undefined)\r\n      continue;\r\n\r\n    //console.log(\"SE Removing \" + oItem.name + \" (\" + oItem.coreId + \").\");\r\n    if (oItem.hasChildren()) {\r\n      // Go thru the children.\r\n      var aCoreIdList = oItem.getChildrenCoreIds();\r\n\r\n      for (var iIndex = 0; iIndex < aCoreIdList.length; iIndex++) {\r\n        emp.storage.removeChild(aCoreIdList[iIndex]);\r\n      }\r\n    }\r\n\r\n    //Take it off its parents child list.\r\n    oItem.removeFromAllParent();\r\n    // Now delete the item\r\n    delete store[oItem.coreId];\r\n    //console.log(\"   DELETED \" + oItem.name + \" (\" + oItem.coreId + \").\");\r\n  }\r\n};\r\n/**\r\n * Overlay actions\r\n *\r\n * @type {Object}\r\n * @property {method} add Add overlay to storage\r\n * @property {method} remove Remove overlay from storage\r\n * @property {method} update Update overlay in storage\r\n * @property {method} clear Clear children from overlay\r\n */\r\nemp.storage.overlay = {};\r\n\r\nemp.storage.overlay.createOverlay = function(mapInstanceId, overlayId, sender) {\r\n  var oTempTransaction = new emp.typeLibrary.Transaction({\r\n    intent: emp.intents.control.OVERLAY_ADD,\r\n    mapInstanceId: mapInstanceId,\r\n    originChannel: \"map.overlay.create\",\r\n    items: [new emp.typeLibrary.Overlay({\r\n      name: \"Overlay \" + sender,\r\n      overlayId: overlayId\r\n    })]\r\n  });\r\n\r\n  oTempTransaction.run();\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.add = function(oTransaction) {\r\n  var bVisibleSetting;\r\n  var oEmpOverlay;\r\n  var oParentOverlay;\r\n  var oItem;\r\n  var iIndex;\r\n  var oaItems = oTransaction.items;\r\n  var aMapList, aPrevMapList;\r\n  var oTransactions = {};\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length;) {\r\n    oItem = oaItems[iIndex];\r\n    bVisibleSetting = oItem.visible;\r\n    aPrevMapList = [];\r\n    oEmpOverlay = emp.storage.findOverlay(oItem.overlayId);\r\n    oParentOverlay = emp.storage.findObject(oItem.coreParent);\r\n\r\n    if (oEmpOverlay !== undefined) {\r\n      aPrevMapList = oEmpOverlay.getParentMapInstanceList();\r\n      if (!emp.storage.overlay.updateItem(oTransactions, oTransaction, oEmpOverlay, oItem, false)) {\r\n        continue;\r\n      }\r\n    }\r\n    else {\r\n      oEmpOverlay = new emp.classLibrary.EmpOverlay(oItem);\r\n      emp.storage.storeObject(oEmpOverlay);\r\n    }\r\n\r\n    if (!oParentOverlay.isParentOf(oEmpOverlay.getCoreId())) {\r\n      oParentOverlay.addChild(oEmpOverlay, bVisibleSetting);\r\n    }\r\n\r\n    aMapList = oEmpOverlay.getParentMapInstanceList();\r\n\r\n    emp.storage.processRequest(oTransactions, aPrevMapList, aMapList, oParentOverlay, oEmpOverlay);\r\n\r\n    iIndex++;\r\n  }\r\n\r\n  // Now we run all the transaction we created.\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.clear = function(oTransaction) {\r\n  var oOverlay;\r\n  var oChild;\r\n  var iIndex, iMapIndex;\r\n  var aMapList, aPrevMapList;\r\n  var oTransactionList = {\r\n    oObjectUpdatedTransaction: {},\r\n    oObjectRemoveTransaction: {},\r\n    oFeatureRemoveFromMapTransactions: {},\r\n    oWMSRemoveFromMapTransactions: {}\r\n  };\r\n\r\n  for (var i = 0; i < oTransaction.items.length; i = i + 1) {\r\n    oOverlay = emp.storage.findOverlay(oTransaction.items[i].overlayId);\r\n\r\n    if (oOverlay !== undefined) {\r\n      var aChildrenCoreIdList = oOverlay.getChildrenCoreIds();\r\n\r\n      for (iIndex = 0; iIndex < aChildrenCoreIdList.length; iIndex++) {\r\n        oChild = emp.storage.findObject(aChildrenCoreIdList[iIndex]);\r\n        if (oChild) {\r\n          // Get the maps the child is currently on.\r\n          aPrevMapList = oChild.getParentMapInstanceList();\r\n          oOverlay.removeChild(oChild);\r\n\r\n          // Now get the maps that child is still on.\r\n          aMapList = oChild.getParentMapInstanceList();\r\n\r\n          // The map on aPrevMapList that are not on aMapList are the\r\n          // maps the Child must be removed from.\r\n          for (iMapIndex = 0; iMapIndex < aPrevMapList.length; iMapIndex++) {\r\n            if (aMapList.indexOf(aPrevMapList[iMapIndex]) === -1) {\r\n              // Add the remove to the proper transaction.\r\n              emp.storage.processChildrenRemoves(oTransactionList, aPrevMapList[iMapIndex], oChild);\r\n              emp.storage.addToRemoveTransaction(oTransactionList, aPrevMapList[iMapIndex], oOverlay, oChild);\r\n            }\r\n          }\r\n\r\n          // If the child has no more parents delete it from storage.\r\n          if (oChild.parentCount() === 0) {\r\n            emp.storage.deleteObject(oChild);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  emp.storage.executeTransactions(oTransactionList);\r\n};\r\n\r\nemp.storage.overlay.updateItem = function(oTransactions, oTransaction, oStorageEntry, oNewItem, bFromUpdate) {\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n  var oParent, oOldParent;\r\n  var aMapList;\r\n  var iMapIndex;\r\n  var oParentValid;\r\n  var sPropertyField;\r\n\r\n  if (!emp.helpers.isEmptyString(oNewItem.parentId)) {\r\n    // Find the new parent first.\r\n    switch (oNewItem.parentId) {\r\n      case emp.constant.parentIds.ALL_PARENTS:\r\n        oTransaction.fail({\r\n          coreId: oStorageEntry.getCoreId(),\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: 'Invalid parent Id for overlay ' + oStorageEntry.getName() + '.'\r\n        });\r\n\r\n        return false;\r\n      case emp.constant.parentIds.MAP_ROOT:\r\n        oParent = emp.storage.findOverlay(emp.storage.getRootGuid(mapInstanceId));\r\n        break;\r\n      default:\r\n        oParent = emp.storage.findOverlay(oNewItem.parentId);\r\n        break;\r\n    }\r\n\r\n    if (!oParent) {\r\n      oTransaction.fail({\r\n        coreId: oStorageEntry.getCoreId(),\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: 'New parent overlay for overlay ' + oStorageEntry.getName() + ' was not found.'\r\n      });\r\n\r\n      return false;\r\n    }\r\n\r\n    if (bFromUpdate) {\r\n      // Only messages that come from the update channel can do a move.\r\n      // Else its a new parent.\r\n      //\r\n      // If the new parentId is diff,\r\n      // Its being moved.\r\n      if (oStorageEntry.parentCount() > 1) {\r\n        // The overlay has more than 1 parent so we can't move it.\r\n        oTransaction.fail({\r\n          coreId: oStorageEntry.getCoreId(),\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: 'Overlay ' + oStorageEntry.getName() + ' has more than 1 parent. Move of a multi-parent overlay is not supported.'\r\n        });\r\n        return false;\r\n      }\r\n\r\n      oOldParent = oStorageEntry.getParentByIndex(0);\r\n\r\n      if (!oOldParent) {\r\n        oTransaction.fail({\r\n          coreId: oStorageEntry.getCoreId(),\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: 'Unable to find current parent of overlay ' + oStorageEntry.getName() + '.'\r\n        });\r\n        return false;\r\n      }\r\n\r\n      // Check to see if its a valid parent.\r\n      oParentValid = emp.storage.overlay.validateParent(oStorageEntry.getCoreId(), oParent.getCoreId());\r\n      if (oParentValid !== true) {\r\n        oTransaction.fail({\r\n          coreId: oNewItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: oParentValid.errorMsg\r\n        });\r\n        return false;\r\n      }\r\n\r\n      if (oOldParent.getOverlayId() !== oNewItem.parentId) {\r\n        oOldParent.removeChild(oStorageEntry);\r\n        aMapList = oOldParent.getMapInstanceList();\r\n\r\n        for (iMapIndex = 0; iMapIndex < aMapList.length; iMapIndex++) {\r\n          emp.storage.addToObjectUpdateTransaction(oTransactions, aMapList[iMapIndex], oOldParent.getCoreId(), oStorageEntry.getCoreId());\r\n        }\r\n\r\n\r\n      }\r\n    }\r\n\r\n    if (!oParent.isParentOf(oStorageEntry.getCoreId())) {\r\n      // Add it to the parent if and only if is not already AND is a valid parent.\r\n\r\n      if (!bFromUpdate) {\r\n        // Check to see if its a valid parent.\r\n        oParentValid = emp.storage.overlay.validateParent(oStorageEntry.getCoreId(), oParent.getCoreId());\r\n        if (oParentValid !== true) {\r\n          oTransaction.fail({\r\n            coreId: oNewItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: oParentValid.errorMsg\r\n          });\r\n          return false;\r\n        }\r\n      }\r\n\r\n      oParent.addChild(oStorageEntry, (oNewItem.visible !== false));\r\n    }\r\n  }\r\n\r\n  if (!emp.helpers.isEmptyString(oNewItem.name) && (oStorageEntry.getName() !== oNewItem.name)) {\r\n    oStorageEntry.setName(oNewItem.name);\r\n  }\r\n\r\n  if (oNewItem.hasOwnProperty('disabled')) {\r\n    oStorageEntry.setDisabled(oNewItem.disabled);\r\n  }\r\n\r\n  if (oNewItem.hasOwnProperty('properties') && (typeof(oNewItem.properties) === 'object')) {\r\n    for (sPropertyField in oNewItem.properties) {\r\n      if (oNewItem.properties.hasOwnProperty(sPropertyField)) {\r\n        oStorageEntry.setPropertyValue(sPropertyField, oNewItem.properties[sPropertyField]);\r\n      }\r\n    }\r\n  }\r\n\r\n  //if ((oNewItem.properties.disabled !== undefined) &&\r\n  //        (oStoredItem.properties.disabled !== oNewItem.properties.disabled))\r\n  //{\r\n  //    oStoredItem.properties.disabled = oNewItem.properties.disabled;\r\n  //}\r\n\r\n  if (!emp.helpers.isEmptyString(oNewItem.menuId)) {\r\n    oStorageEntry.setMenuId(oNewItem.menuId);\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nemp.storage.addToObjectAddTransaction = function(oTransactionList, mapInstanceId, oParent, oStorageEntry) {\r\n  var oDupItem;\r\n\r\n  // If the transaction list does not exists create it.\r\n  if (!oTransactionList.hasOwnProperty('oObjectAddTransaction')) {\r\n    oTransactionList.oObjectAddTransaction = {};\r\n  }\r\n\r\n  if (!oTransactionList.oObjectAddTransaction.hasOwnProperty(mapInstanceId)) {\r\n    oTransactionList.oObjectAddTransaction[mapInstanceId] =\r\n      new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.STORAGE_OBJECT_ADDED,\r\n        mapInstanceId: mapInstanceId,\r\n        items: []\r\n      });\r\n  }\r\n  // Add this feature to the add transaction items list.\r\n  oDupItem = oStorageEntry.getObjectData(mapInstanceId, oParent.getCoreId());\r\n  oTransactionList.oObjectAddTransaction[mapInstanceId].items.push(oDupItem);\r\n};\r\n\r\nemp.storage.addToObjectRemoveTransaction = function(oTransactionList, mapInstanceId, oParent, oStorageEntry) {\r\n  var oDupItem;\r\n\r\n  // If the transaction list does not exists create it.\r\n  if (!oTransactionList.hasOwnProperty('oObjectRemoveTransaction')) {\r\n    oTransactionList.oObjectRemoveTransaction = {};\r\n  }\r\n\r\n  if (!oTransactionList.oObjectRemoveTransaction.hasOwnProperty(mapInstanceId)) {\r\n    oTransactionList.oObjectRemoveTransaction[mapInstanceId] =\r\n      new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.STORAGE_OBJECT_REMOVED,\r\n        mapInstanceId: mapInstanceId,\r\n        items: []\r\n      });\r\n  }\r\n  // Add this feature to the remove transaction items list.\r\n  oDupItem = oStorageEntry.getObjectData(mapInstanceId, oParent.getCoreId());\r\n  oTransactionList.oObjectRemoveTransaction[mapInstanceId].items.push(oDupItem);\r\n};\r\n\r\nemp.storage.addToObjectUpdateTransaction = function(oTransactionList, mapInstanceId, parentCoreId, childCoreId) {\r\n  if (!oTransactionList.hasOwnProperty('oObjectUpdatedTransaction')) {\r\n    oTransactionList.oObjectUpdatedTransaction = {};\r\n  }\r\n\r\n  // A child needs to be removed from the parent.  Create a transaction with intent\r\n  // to remove a child (STORAGE_OBJECT_CHILD_REMOVED).\r\n  if (!oTransactionList.oObjectUpdatedTransaction.hasOwnProperty(mapInstanceId)) {\r\n    oTransactionList.oObjectUpdatedTransaction[mapInstanceId] =\r\n      new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.STORAGE_OBJECT_CHILD_REMOVED,\r\n        mapInstanceId: mapInstanceId,\r\n        items: []\r\n      });\r\n  }\r\n\r\n  // Now add the parent and child of the item that needs to be removed.\r\n  //oDupItem = oStorageEntry.getObjectData(mapInstanceId, oStorageEntry.getCoreId());\r\n  oTransactionList.oObjectUpdatedTransaction[mapInstanceId].items.push({\r\n    parentCoreId: parentCoreId,\r\n    childCoreId: childCoreId\r\n  });\r\n};\r\n\r\nemp.storage.addToUpdateTransaction = function(transactionList, mapInstanceId, parent, child) {\r\n  var dupItem;\r\n\r\n  switch (child.getCoreObjectType()) {\r\n    case emp.typeLibrary.types.FEATURE:\r\n      // If the transaction list does not exists create it.\r\n      if (!transactionList.hasOwnProperty('featureUpdateTransactions')) {\r\n        transactionList.featureUpdateTransactions = {};\r\n      }\r\n\r\n      // If the map instance does not yet exist on the update transaction, create it.\r\n      if (!transactionList.featureUpdateTransactions.hasOwnProperty(mapInstanceId)) {\r\n        transactionList.featureUpdateTransactions[mapInstanceId] =\r\n          new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.MI_FEATURE_UPDATE,\r\n            mapInstanceId: mapInstanceId,\r\n            items: []\r\n          });\r\n      }\r\n\r\n      // Add this feature to the update transaction items list.\r\n      dupItem = child.getObjectData(mapInstanceId, parent.getCoreId());\r\n      dupItem.visible = child.isVisibleOnMap(mapInstanceId);\r\n      transactionList.featureUpdateTransactions[mapInstanceId].items.push(dupItem);\r\n      break;\r\n  }\r\n};\r\n\r\nemp.storage.addToAddTransaction = function(oTransactionList, mapInstanceId, oParent, oChild, bZoom) {\r\n  var oDupItem;\r\n  var sErrorMsg;\r\n\r\n  switch (oChild.getCoreObjectType()) {\r\n    case emp.typeLibrary.types.FEATURE:\r\n      // The child is a feature.\r\n      // Check to see if the map engine supports plotting the feature.\r\n      if (oChild.canMapEnginePlot(mapInstanceId)) {\r\n        // If the transaction list does not exists create it.\r\n        if (!oTransactionList.hasOwnProperty('oFeatureAddToMapTransactions')) {\r\n          oTransactionList.oFeatureAddToMapTransactions = {};\r\n        }\r\n        // If the transaction does not exists, create it.\r\n        if (!oTransactionList.oFeatureAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n          oTransactionList.oFeatureAddToMapTransactions[mapInstanceId] =\r\n            new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.MI_FEATURE_ADD,\r\n              mapInstanceId: mapInstanceId,\r\n              items: []\r\n            });\r\n        }\r\n        // Add this feature to the add transaction items list.\r\n        oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n        oDupItem.zoom = (bZoom === true);\r\n        oDupItem.visible = oChild.isVisibleOnMap(mapInstanceId);\r\n        oTransactionList.oFeatureAddToMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      }\r\n      else {\r\n        sErrorMsg = emp.instanceManager.getInstance(mapInstanceId).engineName;\r\n        sErrorMsg += \" can't plot a \" + oChild.getFormat() + \" feature (\" + oChild.getName() + \").\";\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.INFO,\r\n          message: sErrorMsg\r\n        });\r\n      }\r\n      break;\r\n    case emp.typeLibrary.types.WMS:\r\n      // The child is a WMS.\r\n      // Check to see if the map engine supports plotting the feature.\r\n      if (oChild.canMapEnginePlot(mapInstanceId)) {\r\n        // If the transaction list does not exists create it.\r\n        if (!oTransactionList.hasOwnProperty('oWMSAddToMapTransactions')) {\r\n          oTransactionList.oWMSAddToMapTransactions = {};\r\n        }\r\n        // Check to see if the transaction exists and create it if not.\r\n        if (!oTransactionList.oWMSAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n          oTransactionList.oWMSAddToMapTransactions[mapInstanceId] =\r\n            new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.MI_WMS_ADD,\r\n              mapInstanceId: mapInstanceId,\r\n              items: []\r\n            });\r\n        }\r\n        oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n        oDupItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n        oTransactionList.oWMSAddToMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      }\r\n      else {\r\n        sErrorMsg = emp.instanceManager.getInstance(mapInstanceId).engineName;\r\n        sErrorMsg += \" can't plot a WMS version \" + oChild.getVersion() + \" map (\" + oChild.getName() + \").\";\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.INFO,\r\n          message: sErrorMsg\r\n        });\r\n      }\r\n      break;\r\n    case emp.typeLibrary.types.KML:\r\n      // The child is a KML link.\r\n      // Check to see if the map engine supports plotting the feature.\r\n      if (oChild.canMapEnginePlot(mapInstanceId)) {\r\n        // If the transaction list does not exists create it.\r\n        if (!oTransactionList.hasOwnProperty('oKmlLayerAddToMapTransactions')) {\r\n          oTransactionList.oKmlLayerAddToMapTransactions = {};\r\n        }\r\n        // Check to see if the transaction exists and create it if not.\r\n        if (!oTransactionList.oKmlLayerAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n          oTransactionList.oKmlLayerAddToMapTransactions[mapInstanceId] =\r\n            new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.MI_KML_LAYER_ADD,\r\n              mapInstanceId: mapInstanceId,\r\n              items: []\r\n            });\r\n        }\r\n        oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n        oDupItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n        oTransactionList.oKmlLayerAddToMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      }\r\n      else {\r\n        sErrorMsg = emp.instanceManager.getInstance(mapInstanceId).engine.implementation.displayName;\r\n        sErrorMsg += \" can't plot a KML \" + oChild.getVersion() + \" link on map (\" + oChild.getName() + \").\";\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.INFO,\r\n          message: sErrorMsg\r\n        });\r\n      }\r\n      break;\r\n    case emp.typeLibrary.types.WMTS:\r\n      // The child is a WMTS.\r\n      // Check to see if the map engine supports plotting the feature.\r\n      if (oChild.canMapEnginePlot(mapInstanceId)) {\r\n        // If the transaction list does not exists create it.\r\n        if (!oTransactionList.hasOwnProperty('oWMTSAddToMapTransactions')) {\r\n          oTransactionList.oWMTSAddToMapTransactions = {};\r\n        }\r\n        // Check to see if the transaction exists and create it if not.\r\n        if (!oTransactionList.oWMTSAddToMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n          oTransactionList.oWMTSAddToMapTransactions[mapInstanceId] =\r\n            new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.MI_WMTS_ADD,\r\n              mapInstanceId: mapInstanceId,\r\n              items: []\r\n            });\r\n        }\r\n        oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n        oDupItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n        oTransactionList.oWMTSAddToMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      }\r\n      else {\r\n        sErrorMsg = emp.instanceManager.getInstance(mapInstanceId).engine.implementation.displayName;\r\n        sErrorMsg += \" can't plot a WMTS version \" + oChild.getVersion() + \" map (\" + oChild.getName() + \").\";\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.INFO,\r\n          message: sErrorMsg\r\n        });\r\n      }\r\n      break;\r\n    case emp.typeLibrary.types.OVERLAY:\r\n      // This child is an overlay\r\n      // If the transaction list does not exists create it.\r\n      if (!oTransactionList.hasOwnProperty('oObjectAddTransaction')) {\r\n        oTransactionList.oObjectAddTransaction = {};\r\n      }\r\n      if (!oTransactionList.oObjectAddTransaction.hasOwnProperty(mapInstanceId)) {\r\n        oTransactionList.oObjectAddTransaction[mapInstanceId] =\r\n          new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.STORAGE_OBJECT_ADDED,\r\n            mapInstanceId: mapInstanceId,\r\n            items: []\r\n          });\r\n      }\r\n      oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n      oTransactionList.oObjectAddTransaction[mapInstanceId].items.push(oDupItem);\r\n      break;\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param {Object} oTransactionList\r\n * @param {string} mapInstanceId\r\n * @param {emp.classLibrary.EmpRenderableObject} oParent\r\n * @param {emp.classLibrary.EmpRenderableObject} oChild\r\n */\r\nemp.storage.addToRemoveTransaction = function(oTransactionList, mapInstanceId, oParent, oChild) {\r\n  var oDupItem;\r\n\r\n  switch (oChild.getCoreObjectType()) {\r\n    case emp.typeLibrary.types.FEATURE:\r\n      // The child is a feature.\r\n      // If the transaction list does not exists create it.\r\n      if (!oTransactionList.hasOwnProperty('oFeatureRemoveFromMapTransactions')) {\r\n        oTransactionList.oFeatureRemoveFromMapTransactions = {};\r\n      }\r\n      // If the remove transaction does not exists, create it.\r\n      if (!oTransactionList.oFeatureRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactionList.oFeatureRemoveFromMapTransactions[mapInstanceId] =\r\n          new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.MI_FEATURE_REMOVE,\r\n            mapInstanceId: mapInstanceId,\r\n            items: []\r\n          });\r\n      }\r\n      // Add this feature to the remove transaction items list.\r\n      oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n      oTransactionList.oFeatureRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      break;\r\n    case emp.typeLibrary.types.WMS:\r\n      // The child is a WMS.\r\n      // If the transaction list does not exists create it.\r\n      if (!oTransactionList.hasOwnProperty('oWMSRemoveFromMapTransactions')) {\r\n        oTransactionList.oWMSRemoveFromMapTransactions = {};\r\n      }\r\n      // Check to see if the remove transaction exists and create it if not.\r\n      if (!oTransactionList.oWMSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactionList.oWMSRemoveFromMapTransactions[mapInstanceId] =\r\n          new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.MI_WMS_REMOVE,\r\n            mapInstanceId: mapInstanceId,\r\n            items: []\r\n          });\r\n      }\r\n      oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n      oDupItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n      oTransactionList.oWMSRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      break;\r\n\r\n    case emp.typeLibrary.types.WMTS:\r\n      // The child is a WMS.\r\n      // If the transaction list does not exists create it.\r\n      if (!oTransactionList.hasOwnProperty('oWMTSRemoveFromMapTransactions')) {\r\n        oTransactionList.oWMTSRemoveFromMapTransactions = {};\r\n      }\r\n      // Check to see if the remove transaction exists and create it if not.\r\n      if (!oTransactionList.oWMTSRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n        oTransactionList.oWMTSRemoveFromMapTransactions[mapInstanceId] =\r\n          new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.MI_WMTS_REMOVE,\r\n            mapInstanceId: mapInstanceId,\r\n            items: []\r\n          });\r\n      }\r\n      oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n      oDupItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n      oTransactionList.oWMTSRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);\r\n      break;\r\n    case emp.typeLibrary.types.KML:\r\n        // The child is a WMS.\r\n        // If the transaction list does not exists create it.\r\n        if (!oTransactionList.hasOwnProperty('oKmlLayerRemoveFromMapTransactions')) {\r\n          oTransactionList.oKmlLayerRemoveFromMapTransactions = {};\r\n        }\r\n        // Check to see if the remove transaction exists and create it if not.\r\n        if (!oTransactionList.oKmlLayerRemoveFromMapTransactions.hasOwnProperty(mapInstanceId)) {\r\n          oTransactionList.oKmlLayerRemoveFromMapTransactions[mapInstanceId] =\r\n            new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.MI_MAP_LAYER_REMOVE,\r\n              mapInstanceId: mapInstanceId,\r\n              items: []\r\n            });\r\n        }\r\n        oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n        oDupItem.parentCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n        oTransactionList.oKmlLayerRemoveFromMapTransactions[mapInstanceId].items.push(oDupItem);\r\n        break;\r\n    case emp.typeLibrary.types.OVERLAY:\r\n      // This child is an overlay\r\n      // If the transaction list does not exists create it.\r\n      if (!oTransactionList.hasOwnProperty('oObjectRemoveTransaction')) {\r\n        oTransactionList.oObjectRemoveTransaction = {};\r\n      }\r\n      if (!oTransactionList.oObjectRemoveTransaction.hasOwnProperty(mapInstanceId)) {\r\n        oTransactionList.oObjectRemoveTransaction[mapInstanceId] =\r\n          new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.STORAGE_OBJECT_REMOVED,\r\n            mapInstanceId: mapInstanceId,\r\n            items: []\r\n          });\r\n      }\r\n      oDupItem = oChild.getObjectData(mapInstanceId, oParent.getCoreId());\r\n      oTransactionList.oObjectRemoveTransaction[mapInstanceId].items.push(oDupItem);\r\n      break;\r\n  }\r\n};\r\n\r\n/**\r\n * This function processes all children removes for the entry. Children\r\n * are only removed frm the map instance if they do not have other parents on the map instance.\r\n *\r\n * @param {object} oTransactions The transaction list object where all the transactions are created.\r\n * @param {string} mapInstanceId The map instance Id the remove will be addressed to.\r\n * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry The entry the operation was performed on.\r\n */\r\nemp.storage.processChildrenRemoves = function(oTransactions, mapInstanceId, oStorageEntry) {\r\n  var iIndex;\r\n  var oChild;\r\n  var aChildrenCoreIdList = oStorageEntry.getChildrenCoreIds();\r\n  var iChildrenCount = aChildrenCoreIdList.length;\r\n\r\n  for (iIndex = 0; iIndex < iChildrenCount; iIndex++) {\r\n    oChild = emp.storage.findObject(aChildrenCoreIdList[iIndex]);\r\n\r\n    if (oChild.parentCount() === 0) {\r\n      // We only remove the child if the parent has no other parents.\r\n      oStorageEntry.removeChild(oChild.getCoreId());\r\n    }\r\n\r\n    if (!oChild.isOnMap(mapInstanceId)) {\r\n      // This child is no longer on that map instance.\r\n      // So we must send the remove to the map instance.\r\n\r\n      // But first process its children.\r\n      if (oChild.hasChildren()) {\r\n        emp.storage.processChildrenRemoves(oTransactions, mapInstanceId, oChild);\r\n      }\r\n      emp.storage.addToRemoveTransaction(oTransactions, mapInstanceId, oStorageEntry, oChild);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * This function processes all children adds for the entry.\r\n *\r\n * @param {object} oTransactions The transaction list object where all the transactions are created.\r\n * @param {string} mapInstanceId The map instance Id the adds will be addressed to.\r\n * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry The entry the operation was performed on.\r\n */\r\nemp.storage.processChildrenAdds = function(oTransactions, mapInstanceId, oStorageEntry) {\r\n  var sCoreId;\r\n  var oChild, oChildFeatures;\r\n\r\n  oChildFeatures = oStorageEntry.getChildrenList();\r\n\r\n  for (sCoreId in oChildFeatures) {\r\n    if (oChildFeatures.hasOwnProperty(sCoreId)) {\r\n      oChild = oChildFeatures[sCoreId];\r\n      if (oChild.isOnMap(mapInstanceId)) {\r\n        // This child is on that map instance.\r\n        // So we must send it to the map instance.\r\n        emp.storage.addToAddTransaction(oTransactions, mapInstanceId, oStorageEntry, oChild);\r\n\r\n        if (oChild.hasChildren()) {\r\n          emp.storage.processChildrenAdds(oTransactions, mapInstanceId, oChild);\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * This function processes a request adding to and/or removing from the proper map instances. It processes all children\r\n * along with the storage entry.\r\n *\r\n * @param {Object.<emp.typeLibrary.Transaction>} transactions The transaction list object where all the transactions\r\n * are created.\r\n * @param {string[]} prevMapList The list of map instance Id's the entry was on prior to the operation.\r\n * @param {string[]} mapList The list of map instance Id's the entry is on after the operation.\r\n * @param {emp.classLibrary.EmpRenderableObject} parent A parent of the entry.\r\n * @param {emp.classLibrary.EmpRenderableObject} storageEntry The actual entry the operation was performed on.\r\n * @param {boolean} [zoom] If its an add operation, this indicates if the zoom is to be set.\r\n */\r\nemp.storage.processRequest = function(transactions, prevMapList, mapList, parent, storageEntry, zoom) {\r\n  var i, iTempIndex;\r\n  var removeFromMapList = [];\r\n  var addToMapList = [];\r\n  var parentMapList;\r\n\r\n  for (i = 0; i < prevMapList.length; i++) {\r\n    // This loop adds map instance that are in prevMapList and not in mapList to removeFromMapList.\r\n    // These are the map instances that the parent is no longer on.\r\n    iTempIndex = mapList.indexOf(prevMapList[i]);\r\n    if (iTempIndex === -1) {\r\n      removeFromMapList.push(prevMapList[i]);\r\n    }\r\n  }\r\n\r\n  if (removeFromMapList.length > 0) {\r\n    // removeFromMapList contains the map instances that the storageEntry is no longer on.\r\n    // So we need to add it to the remove transaction for the maps.\r\n\r\n    for (i = 0; i < removeFromMapList.length; i++) {\r\n      emp.storage.addToRemoveTransaction(transactions, removeFromMapList[i], parent, storageEntry);\r\n      emp.storage.processChildrenRemoves(transactions, removeFromMapList[i], storageEntry);\r\n    }\r\n\r\n    // Get the map list of the parent.\r\n    parentMapList = parent.getParentMapInstanceList();\r\n\r\n    // Now we must send a remove to all the maps the parent is on so they can update their UI.\r\n    for (i = 0; i < parentMapList.length; i++) {\r\n      emp.storage.addToObjectRemoveTransaction(transactions, parentMapList[i], parent, storageEntry);\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < mapList.length; i++) {\r\n    // This loop will find the map instance the storageEntry needs to be added to (if any)\r\n    if (prevMapList.indexOf(mapList[i]) === -1) {\r\n      // This parent needs to be added to the the map instance.\r\n      addToMapList.push(mapList[i]);\r\n    }\r\n  }\r\n\r\n  if (addToMapList.length > 0) {\r\n    // There is at least one new map instance for the storageEntry.\r\n    // So we need to add it to the add transaction for the maps.\r\n\r\n    for (i = 0; i < addToMapList.length; i++) {\r\n      emp.storage.addToAddTransaction(transactions, addToMapList[i], parent, storageEntry, zoom);\r\n      emp.storage.processChildrenAdds(transactions, addToMapList[i], storageEntry);\r\n    }\r\n    // Get the map list of the parent.\r\n    parentMapList = parent.getParentMapInstanceList();\r\n\r\n    // Now we must send an add to all the maps the parent is on so they can update their UI.\r\n    for (i = 0; i < parentMapList.length; i++) {\r\n      emp.storage.addToObjectAddTransaction(transactions, parentMapList[i], parent, storageEntry);\r\n    }\r\n  }\r\n\r\n  if ((removeFromMapList.length === 0) && (addToMapList.length === 0)) {\r\n    // Only do this if there are no removes and no adds.\r\n    // Get the map list of the parent.\r\n    parentMapList = parent.getParentMapInstanceList();\r\n\r\n    // Now we must send an add to all the maps the parent is on so they can update their UI and the maps.\r\n    for (i = 0; i < parentMapList.length; i++) {\r\n      if (parent.isParentOf(storageEntry.getCoreId())) {\r\n        // essentially this is an update.\r\n        emp.storage.addToUpdateTransaction(transactions, parentMapList[i], parent, storageEntry);\r\n      }\r\n      else {\r\n        emp.storage.addToObjectRemoveTransaction(transactions, parentMapList[i], parent, storageEntry);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.update = function(oTransaction) {\r\n  var oOverlayItem, oStorageEntry;\r\n  var iIndex;\r\n  var oaItems = oTransaction.items;\r\n  var oTransactions = {};\r\n  var aPrevMapList, aMapList;\r\n  var iParentCount;\r\n  var iParentIndex;\r\n  var oParent;\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length;) {\r\n    oOverlayItem = oaItems[iIndex];\r\n    oStorageEntry = emp.storage.findOverlay(oOverlayItem.overlayId);\r\n\r\n    if (oStorageEntry === undefined) {\r\n      // The overlay does not exists.\r\n      oTransaction.fail({\r\n        coreId: oStorageEntry.getCoreId(),\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: 'Overlay ' + oOverlayItem.overlayId + ' not found.'\r\n      });\r\n      continue;\r\n    }\r\n\r\n    aPrevMapList = oStorageEntry.getParentMapInstanceList();\r\n    if (!emp.storage.overlay.updateItem(oTransactions, oTransaction, oStorageEntry, oOverlayItem, true)) {\r\n      // The update failed.\r\n      continue;\r\n    }\r\n\r\n    aMapList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    iParentCount = oStorageEntry.parentCount();\r\n    for (iParentIndex = 0; iParentIndex < iParentCount; iParentIndex++) {\r\n      oParent = oStorageEntry.getParentByIndex(iParentIndex);\r\n      emp.storage.processRequest(oTransactions, aPrevMapList, aMapList, oParent, oStorageEntry, false);\r\n    }\r\n    iIndex++;\r\n  }\r\n\r\n  // Now we run all the transaction we created.\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n\r\nemp.storage.overlay.clusterSet = function(oTransaction) {\r\n  var oClusterDef;\r\n  var oOverlay;\r\n\r\n  for (var i = 0; i < oTransaction.items.length; i = i + 1) {\r\n    oClusterDef = oTransaction.items[i];\r\n\r\n    if (oClusterDef) {\r\n      oOverlay = emp.storage.findOverlay(oClusterDef.getOverlayId());\r\n\r\n      if (oOverlay) {\r\n        oOverlay.properties.cluster = oClusterDef;\r\n        oOverlay.properties.bClusterActive = true;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nemp.storage.overlay.clusterActivate = function(oTransaction) {\r\n  var oClusterDef;\r\n  var oOverlay;\r\n\r\n  for (var i = 0; i < oTransaction.items.length; i = i + 1) {\r\n    oClusterDef = oTransaction.items[i];\r\n\r\n    if (oClusterDef) {\r\n      oOverlay = emp.storage.findOverlay(oClusterDef.getOverlayId());\r\n\r\n      if (oOverlay) {\r\n        oOverlay.properties.bClusterActive = true;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nemp.storage.overlay.clusterDeactivate = function(oTransaction) {\r\n  var oClusterDef;\r\n  var oOverlay;\r\n\r\n  for (var i = 0; i < oTransaction.items.length; i = i + 1) {\r\n    oClusterDef = oTransaction.items[i];\r\n\r\n    if (oClusterDef) {\r\n      oOverlay = emp.storage.findOverlay(oClusterDef.getOverlayId());\r\n\r\n      if (oOverlay) {\r\n        oOverlay.properties.bClusterActive = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nemp.storage.overlay.clusterRemove = function(oTransaction) {\r\n  var oClusterDef;\r\n  var oOverlay;\r\n\r\n  for (var i = 0; i < oTransaction.items.length; i = i + 1) {\r\n    oClusterDef = oTransaction.items[i];\r\n\r\n    if (oClusterDef) {\r\n      oOverlay = emp.storage.findOverlay(oClusterDef.getOverlayId());\r\n\r\n      if (oOverlay) {\r\n        if (oOverlay.properties.hasOwnProperty('cluster')) {\r\n          delete oOverlay.properties.cluster;\r\n        }\r\n        if (oOverlay.properties.hasOwnProperty('bClusterActive')) {\r\n          delete oOverlay.properties.bClusterActive;\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Static Actions\r\n * @type {Object}\r\n * @property {method} add\r\n * @property {method} remove\r\n *\r\n */\r\nemp.storage.staticContent = {};\r\nemp.storage.staticContent.add = function(oTransaction) {\r\n  var i;\r\n  var item;\r\n  var EmpStaticContent;\r\n  var oEmpParent;\r\n  var store = emp.storage._storage.store;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n  var sRootGUID = emp.storage.getRootGuid(mapInstanceId);\r\n\r\n  for (i = 0; i < oTransaction.items.length; i = i + 1) {\r\n    item = oTransaction.items[i];\r\n    EmpStaticContent = store[item.coreId];\r\n\r\n    if (EmpStaticContent) {\r\n      //store[item.coreId].visible = item.visible;\r\n    }\r\n    else {\r\n      EmpStaticContent = new emp.classLibrary.EmpStaticContent(item);\r\n\r\n      if (item.coreParent === undefined) {\r\n        if (emp.helpers.isEmptyString(item.parentId)) {\r\n          if (!emp.helpers.isEmptyString(item.overlayId)) {\r\n            item.coreParent = item.overlayId;\r\n          }\r\n          else {\r\n            item.coreParent = sRootGUID;\r\n          }\r\n        }\r\n        else {\r\n          item.coreParent = item.parentId;\r\n        }\r\n      }\r\n\r\n      oEmpParent = store[item.coreParent];\r\n\r\n      if (oEmpParent === undefined) {\r\n        oTransaction.fail({\r\n          coreId: item.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: 'Static content parent of ' + item.name + ' not found in storage.'\r\n        });\r\n      }\r\n      else {\r\n        store[EmpStaticContent.getCoreId()] = EmpStaticContent;\r\n        oEmpParent.addChild(EmpStaticContent, item.visible);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Visibility Actions\r\n * @type {Object}\r\n * @property {function} set\r\n * @property {function} get\r\n */\r\nemp.storage.visibility = {};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.visibility.set = function(oTransaction) {\r\n  var iIndex;\r\n  var oItem;\r\n  var oStorageItem;\r\n  var aoItems = oTransaction.items;\r\n  var oNewItems = [];\r\n  var sCoreId;\r\n  var oParent;\r\n  var oParentList;\r\n  var oStatus;\r\n  var oNewTrans = new emp.typeLibrary.Transaction({\r\n    intent: emp.intents.control.MI_VISIBILITY_SET,\r\n    mapInstanceId: oTransaction.mapInstanceId,\r\n    source: emp.core.sources.CORE,\r\n    items: oNewItems\r\n  });\r\n\r\n  var setChildVisibilityRecursive = function(oParentEntry) {\r\n    var oChild, oChildList;\r\n\r\n    if (oParentEntry.isOnMap(oTransaction.mapInstanceId)) {\r\n      oChildList = oParentEntry.getChildrenList();\r\n      for (sCoreId in oChildList) {\r\n        if (oChildList.hasOwnProperty(sCoreId)) {\r\n          oChild = emp.storage.get.id({\r\n            id: sCoreId\r\n          });\r\n          if (oChild) {\r\n            oChild.visibility(oNewTrans, oParentEntry.getCoreId(), oItem.visible, true);\r\n            if (setChildVisibilityRecursive(oChild)) {\r\n              return true;\r\n            }\r\n          }\r\n          else {\r\n            return false;\r\n          }\r\n\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  var setVisibilityTrans = function(oObject, oParentEntry, bVisibility, bTraceUp) {\r\n    var oParentList;\r\n    var sParentCoreId = oParentEntry.getCoreId();\r\n\r\n    if (oParentEntry.isOnMap(oTransaction.mapInstanceId)) {\r\n\r\n      oObject.visibility(oNewTrans, sParentCoreId, bVisibility, true);\r\n\r\n      if (sParentCoreId === emp.storage.getRootGuid(oTransaction.mapInstanceId)) {\r\n        return true;\r\n      }\r\n\r\n      if (bVisibility && bTraceUp) {\r\n        // Its being made visible so we go up the tree.\r\n        oParentList = oParentEntry.getParentRelationshipList();\r\n        for (sCoreId in oParentList) {\r\n          if (oParentList.hasOwnProperty(sCoreId)) {\r\n            if (setVisibilityTrans(oParentEntry, emp.storage.get.id({\r\n                id: sCoreId\r\n              }), oItem.visible, bTraceUp)) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  if (oTransaction.source === emp.core.sources.CORE) {\r\n    return;\r\n  }\r\n\r\n  for (iIndex = 0; iIndex < aoItems.length;) {\r\n    oItem = aoItems[iIndex];\r\n\r\n    if (emp.helpers.isEmptyString(oItem.featureId)) {\r\n      oStorageItem = emp.storage.findOverlay(oItem.overlayId);\r\n    }\r\n    else {\r\n      oStorageItem = emp.storage.findFeature(oItem.overlayId, oItem.featureId);\r\n    }\r\n\r\n    if (oStorageItem) {\r\n      // Property created for messageComplete message population.\r\n      oItem.targetAttributes = oStorageItem.getObjectData();\r\n      oItem.coreId = oStorageItem.getCoreId();\r\n      if (!oStorageItem.isOnMap(oTransaction.mapInstanceId)) {\r\n        // The item is not on the map instance, so fail it.\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Feature \" + oStorageItem.getName() + \" is not on the map instance provided.\"\r\n        });\r\n        continue;\r\n      }\r\n\r\n      oStatus = emp.storage.findParent(oTransaction.mapInstanceId, oStorageItem.getCoreObjectType(), oItem);\r\n\r\n      if (!oStatus.success) {\r\n        oTransaction.fail({\r\n          coreId: oStatus.oError.coreId,\r\n          level: oStatus.oError.level,\r\n          message: oStatus.oError.message + \" Visibility not set.\"\r\n        });\r\n        continue;\r\n      }\r\n      else {\r\n        oParent = oStatus.parent;\r\n      }\r\n\r\n      if (!oParent) {\r\n        // The parent was not provided so we set the visibility of the\r\n        // object with all its parents.\r\n        oParentList = oStorageItem.getParentRelationshipList();\r\n        for (sCoreId in oParentList) {\r\n          if (oParentList.hasOwnProperty(sCoreId)) {\r\n            oParent = oStorageItem.getParent(sCoreId);\r\n            setVisibilityTrans(oStorageItem, oParent, oItem.visible, true);\r\n          }\r\n        }\r\n        // Property created for messageComplete message population.\r\n        oItem.parentTargetAttributes = null;\r\n        // In this case should the entire list of parents be used?\r\n        oParent = oStorageItem.getParent(Object.keys(oStorageItem.options.parentObjects)[0]);\r\n        // Check for root overlay\r\n        if (!emp.storage.isRoot(oParent.options.coreId) &&\r\n          !emp.wms.manager.isRootWMS(oParent.options.coreId)) {\r\n          oItem.parentTargetAttributes = oParent.getObjectData();\r\n        }\r\n      }\r\n      else {\r\n        // The parent was identified change the visibility\r\n        // of the relationship only.\r\n        if (oParent.isParentOf(oStorageItem.getCoreId())) {\r\n          setVisibilityTrans(oStorageItem, oParent, oItem.visible, false);\r\n          oItem.coreParent = oParent.getCoreId();\r\n          // Property created for messageComplete message population.\r\n          oItem.parentTargetAttributes = oParent.getObjectData();\r\n        }\r\n        else {\r\n          oTransaction.fail({\r\n            coreId: oItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: oParent.getName() + \" is not a parent of \" + oStorageItem.getName() + \". Visibility not set.\"\r\n          });\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (oItem.recurse) {\r\n        setChildVisibilityRecursive(oStorageItem);\r\n      }\r\n    }\r\n    else if (emp.helpers.isEmptyString(oItem.featureId)) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Overlay does not exists.\"\r\n      });\r\n      continue;\r\n    }\r\n    else {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Feature does not exists.\"\r\n      });\r\n      continue;\r\n    }\r\n    iIndex++;\r\n  }\r\n  oNewTrans.run();\r\n};\r\n\r\n/**\r\n * @param {emp.classLibrary.EmpRenderableObject} oParent\r\n * @param {boolean} bVisible\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.visibility.checkChildrenVisibility = function(oParent, bVisible, oTransaction) {\r\n  var oChild;\r\n  var oItem;\r\n  var oaItems = oTransaction.items;\r\n  var store = emp.storage._storage.store;\r\n\r\n  if (oParent.hasChildren()) {\r\n    for (var sCoreId in oParent.nodes) {\r\n      // We need to make sure that this child is not on the list already.\r\n      // To avoid an infinite loop do to parent loops.\r\n      if (emp.helpers.findIndexOf(oaItems, 'coreId', sCoreId) === -1) {\r\n        oChild = store[sCoreId];\r\n        if (oChild.setVisibilityWithParent(oParent.coreId, bVisible)) {\r\n          // Make a duplicate of the storage item.\r\n          switch (oChild.getCoreObjectType()) {\r\n            case emp.typeLibrary.types.FEATURE:\r\n              oItem = oChild.getObjectData(oTransaction.mapInstanceId, oParent.getCoreId());\r\n              oaItems.push(oItem);\r\n              break;\r\n            case emp.typeLibrary.types.OVERLAY:\r\n              oItem = oChild.getObjectData(oTransaction.mapInstanceId, oParent.getCoreId());\r\n              oaItems.push(oItem);\r\n              if (oItem.coreParent !== emp.storage.getRootGuid(oTransaction.mapInstanceId)) {\r\n                // We only send the root parent. All others\r\n                // get placed on the duplicate list.\r\n                oTransaction.duplicate(oItem.coreId);\r\n              }\r\n              break;\r\n            case emp.typeLibrary.types.WMS:\r\n            default:\r\n              // This should never happen.\r\n              continue;\r\n          }\r\n          oItem.visible = bVisible;\r\n          oItem.coreParent = oParent.coreId;\r\n          emp.storage.visibility.checkChildrenVisibility(oChild, bVisible, oTransaction);\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * No longer used.\r\n * @deprecated\r\n * @param {object} args\r\n */\r\nemp.storage.visibility.get = function(args) {\r\n  var i;\r\n  var store = emp.storage._storage.store;\r\n  for (i = 0; i < args.items.length; i = i + 1) {\r\n    args.items[i].visible = store[args.items[i].coreId].visible;\r\n  }\r\n};\r\n\r\n/**\r\n * Retrieve the visibility state of the requested item or item instance.\r\n * An item instance will also carry the parentId in the transaction.  The\r\n * visibility state differs from visibility in that it may also indicate for\r\n * an instance that it is visible, but the parent has been turned off.  At\r\n * the end of the function the visibility state will be set in the transaction\r\n * response.\r\n *\r\n * @param {emp.typeLibrary.Transaction} transaction\r\n */\r\nemp.storage.visibility.getState = function(transaction) {\r\n  var store = emp.storage._storage.store,\r\n    visible,\r\n    parentObjects,\r\n    visibilitySetting,\r\n    visibilityState,\r\n    target,\r\n    parent;\r\n\r\n  // retrieve if the item being queried is visible or not.\r\n  target = store[transaction.items[0].coreId];\r\n\r\n  // if we can't find the target in the storage engine, fail the transaction.\r\n  if (target === undefined) {\r\n    transaction.fail(new emp.typeLibrary.Error({\r\n      coreId: transaction.items[0].coreId,\r\n      level: emp.typeLibrary.Error.level.MINOR,\r\n      message: \"Could not find target on map\"\r\n    }));\r\n  }\r\n  else {\r\n    visible = target.options.visibleOnMap[transaction.mapInstanceId];\r\n\r\n    // if we can't find the target on the map, fail the transaction.\r\n    if (visible === undefined) {\r\n      transaction.fail(new emp.typeLibrary.Error({\r\n        coreId: transaction.items[0].coreId,\r\n        level: emp.typeLibrary.Error.level.MINOR,\r\n        message: \"Could not find target on map\"\r\n      }));\r\n    }\r\n    else {\r\n      // Check to see if the transaction has a parentId parameter.  If it\r\n      // does, then it is checking the visibility state of an instance.\r\n      if (transaction.items[0].parentId) {\r\n\r\n        // retrieve if the item being queried is visible or not.\r\n        parent = store[transaction.items[0].parentId];\r\n\r\n        // if the parent is not on the map raise an error, otherwise\r\n        // check the visibility.\r\n        if (parent) {\r\n\r\n          // If it is not visible, we need to check the visibilitySetting.  the\r\n          // visibilitySetting determines the actual state of the visibility under\r\n          // a specific parent.  You can have an item's visibilityState to true,\r\n          // but the parent is hidden so the feature turns off on the map.\r\n          if (!visible) {\r\n\r\n            parentObjects = store[transaction.items[0].coreId].options.parentObjects;\r\n            visibilitySetting = parentObjects[transaction.items[0].parentId].options.visibilitySetting[transaction.mapInstanceId];\r\n\r\n            // if the visibilitySetting is true, then this item was hidden its parents.\r\n            // if the visibilitySetting is false the item was intentionally hidden.\r\n            if (visibilitySetting === undefined) {\r\n              transaction.fail(new emp.typeLibrary.Error({\r\n                coreId: transaction.items[0].coreId,\r\n                level: emp.typeLibrary.Error.level.MINOR,\r\n                message: \"Could not find parent on map\"\r\n              }));\r\n            }\r\n            else if (visibilitySetting === true) {\r\n              visibilityState = emp3.api.enums.VisibilityStateEnum.VISIBLE_ANCESTOR_HIDDEN;\r\n            }\r\n            else {\r\n              visibilityState = emp3.api.enums.VisibilityStateEnum.HIDDEN;\r\n            }\r\n          }\r\n          else {\r\n            visibilityState = emp3.api.enums.VisibilityStateEnum.VISIBLE;\r\n          }\r\n          transaction.items[0].visible = visibilityState;\r\n        }\r\n        else {\r\n          transaction.fail(new emp.typeLibrary.Error({\r\n            coreId: transaction.items[0].coreId,\r\n            level: emp.typeLibrary.Error.level.MINOR,\r\n            message: \"Could not find parent on map\"\r\n          }));\r\n        }\r\n      }\r\n      else {\r\n        // The query is not asking for instance visibility, so simply check\r\n        // to see if visibility is true or false and return the correct enumeration.\r\n        if (visible) {\r\n          visibilityState = emp3.api.enums.VisibilityStateEnum.VISIBLE;\r\n        }\r\n        else {\r\n          visibilityState = emp3.api.enums.VisibilityStateEnum.HIDDEN;\r\n        }\r\n        transaction.items[0].visible = visibilityState;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Selection Actions\r\n * @type {Object}\r\n * @property {Array} _storage Local storage for selection\r\n * @property {method} set\r\n * @property {method} get\r\n */\r\nemp.storage.selection = {};\r\nemp.storage.selection._selectedList = {};\r\n\r\nemp.storage.selection.getSelectedList = function(mapInstanceId) {\r\n  if (!emp.storage.selection._selectedList.hasOwnProperty(mapInstanceId)) {\r\n    emp.storage.selection._selectedList[mapInstanceId] = [];\r\n  }\r\n\r\n  return emp.storage.selection._selectedList[mapInstanceId];\r\n};\r\n\r\nemp.storage.selection.removeSelectedList = function(mapInstanceId) {\r\n  if (emp.storage.selection._selectedList.hasOwnProperty(mapInstanceId)) {\r\n    delete emp.storage.selection._selectedList[mapInstanceId];\r\n  }\r\n};\r\n\r\nemp.storage.selection.getSelectionIndex = function(mapInstanceId, oSelection) {\r\n  var iIndex;\r\n  var oaSelectionList = emp.storage.selection.getSelectedList(mapInstanceId);\r\n  var bNoSelectedId = emp.helpers.isEmptyString(oSelection.selectedId);\r\n\r\n  for (iIndex = 0; iIndex < oaSelectionList.length; iIndex++) {\r\n    if (oSelection.coreId === oaSelectionList[iIndex].coreId) {\r\n      if (bNoSelectedId && emp.helpers.isEmptyString(oaSelectionList[iIndex].selectedId)) {\r\n        return iIndex;\r\n      }\r\n      if (oSelection.selectedId === oaSelectionList[iIndex].selectedId) {\r\n        return iIndex;\r\n      }\r\n    }\r\n  }\r\n\r\n  return -1;\r\n};\r\n\r\nemp.storage.selection.set = function(oTransaction) {\r\n\r\n  var oaSelectionList = emp.storage.selection.getSelectedList(oTransaction.mapInstanceId);\r\n  var oaItems = oTransaction.items;\r\n  var sCoreID;\r\n  var oSelectionItem;\r\n  var oStorageItem;\r\n  var iIndex;\r\n  var iSelectionIndex;\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n    oSelectionItem = oaItems[iIndex];\r\n    sCoreID = oSelectionItem.coreId;\r\n\r\n    if (sCoreID !== emp.typeLibrary.Selection._NOSELECT) {\r\n      oStorageItem = emp.storage.findObject(sCoreID);\r\n\r\n      if (oStorageItem && (oStorageItem.getCoreObjectType() === emp.typeLibrary.types.FEATURE)) {\r\n        iSelectionIndex = emp.storage.selection.getSelectionIndex(oTransaction.mapInstanceId, oSelectionItem);\r\n        if (oSelectionItem.select) {\r\n          // Its being selected.\r\n          if (iSelectionIndex === -1) {\r\n            // Its not on the selection list.\r\n            oaSelectionList.push(oSelectionItem);\r\n          }\r\n        }\r\n        else {\r\n          // Its being deselected.\r\n          if (iSelectionIndex > -1) {\r\n            // Its on the selection list. So we need to remove it.\r\n            oaSelectionList.splice(iSelectionIndex, 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.selection.selectionChange = function(oTransaction) {\r\n\r\n  var oaSelectionList = emp.storage.selection.getSelectedList(oTransaction.mapInstanceId);\r\n  var oaItems = oTransaction.items;\r\n  var sCoreID;\r\n  var oSelectionItem;\r\n  var oStorageItem;\r\n  var oSelectList = [];\r\n  var oDeselectList = [];\r\n  var oSelectionTransaction;\r\n  var oDeselectionTransaction;\r\n  var iSelectionIndex;\r\n\r\n  for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n    oSelectionItem = oaItems[iIndex];\r\n    sCoreID = oSelectionItem.coreId;\r\n\r\n    if (sCoreID !== emp.typeLibrary.Selection._NOSELECT) {\r\n      oStorageItem = emp.storage.findObject(sCoreID);\r\n\r\n      if (oStorageItem !== undefined) {\r\n        iSelectionIndex = emp.storage.selection.getSelectionIndex(oTransaction.mapInstanceId, oSelectionItem);\r\n        if (oSelectionItem.select) {\r\n          // Its being selected.\r\n          if (iSelectionIndex === -1) {\r\n            // Its not on the selection list.\r\n            oaSelectionList.push(oSelectionItem);\r\n          }\r\n          oSelectList.push(oSelectionItem);\r\n        }\r\n        else {\r\n          // Its being deselected.\r\n          if (iSelectionIndex > -1) {\r\n            // Its on the selection list. So we need to remove it.\r\n            oaSelectionList.splice(iSelectionIndex, 1);\r\n          }\r\n          oDeselectList.push(oSelectionItem);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oSelectList.length > 0) {\r\n    oSelectionTransaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.SELECTION_OUTBOUND,\r\n      mapInstanceId: oTransaction.mapInstanceId,\r\n      source: \"CORE-EVENTING\",\r\n      sender: \"EMP_MAP_CORE\",\r\n      items: oSelectList\r\n    });\r\n    oSelectionTransaction.run();\r\n  }\r\n\r\n  if (oDeselectList.length > 0) {\r\n    oDeselectionTransaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.DESELECTION_OUTBOUND,\r\n      mapInstanceId: oTransaction.mapInstanceId,\r\n      source: \"CORE-EVENTING\",\r\n      sender: \"EMP_MAP_CORE\",\r\n      items: oDeselectList\r\n    });\r\n    oDeselectionTransaction.run();\r\n  }\r\n};\r\n\r\n/**\r\n * Map Action\r\n * @type {Object}\r\n * @property {method} status\r\n */\r\nemp.storage.map = {};\r\nemp.storage.map.status = function() {};\r\n\r\n/**\r\n * View Action\r\n * @type {Object}\r\n * @property {method} set\r\n * @property {method} get\r\n */\r\nemp.storage.view = {};\r\nemp.storage.view.set = function(args) {\r\n  emp.storage._storage.currentView = args.items[0];\r\n};\r\nemp.storage.view.get = function() {};\r\n\r\n/**\r\n * Status Action\r\n * @type {Object}\r\n * @property {method} set\r\n */\r\nemp.storage._status = {};\r\n\r\nemp.storage._status.set = function(args) {\r\n\r\n  if (args === \"replay\") {\r\n    emp.storage.replay();\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.editBegin = function(oTransaction) {\r\n  var sCoreId;\r\n  var oStorageEntry;\r\n\r\n  if (oTransaction.items && (oTransaction.items.length > 0)) {\r\n    sCoreId = oTransaction.items[0].coreId;\r\n    oStorageEntry = emp.storage.get.id({\r\n      id: sCoreId\r\n    });\r\n\r\n    if (oStorageEntry) {\r\n      oStorageEntry.setEditMode(true);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.feature.validateUpdate = function(oTransaction) {\r\n  var sDestOverlay;\r\n  var sDestParentId;\r\n  var oStorageEntry;\r\n  var iIndex;\r\n  var oItem;\r\n  var oNewItem;\r\n  var sErrorMsg;\r\n\r\n  // Remember that this only applies to feature moves.\r\n  // Overlay moves are handled in the validateOverlayUpdate.\r\n  function isMoveValid(oFeature) {\r\n    var oParent;\r\n    var oChild;\r\n    var sDestParentID = oFeature.destCoreParent;\r\n    var oDestParent = emp.storage._storage.get({\r\n      coreId: sDestParentID\r\n    });\r\n\r\n    sErrorMsg = \"\";\r\n\r\n    if (sDestParentID === emp.storage.getRootGuid(oTransaction.mapInstanceId)) {\r\n      if (oFeature.globalType === emp.typeLibrary.types.WMS) {\r\n        oDestParent = emp.storage._storage.get({\r\n          coreId: emp.wms.manager.getWmsOverlayId()\r\n        });\r\n      }\r\n      else {\r\n        sErrorMsg = \"A feature item can not be moved to the root.\";\r\n        return false;\r\n      }\r\n    }\r\n    else if (oDestParent === undefined) {\r\n      // The destination parent does not exists.\r\n      // However if their is a destOverlayId and no destParentId,\r\n      // We can create the new parent overlay.\r\n      if (oFeature.destParentId) {\r\n        sErrorMsg = \"Destination parent does not exists.\";\r\n        return false;\r\n      }\r\n      else {\r\n        oFeature.createDestinationParent();\r\n        oDestParent = emp.storage._storage.get({\r\n          coreId: sDestParentID\r\n        });\r\n      }\r\n      if (oDestParent === undefined) {\r\n        sErrorMsg = \"Destination parent overlay creation failed.\";\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // Now check to see if the feature is a WMS.\r\n    // Its new parent MUST be an overlay.\r\n    if ((oFeature.globalType === emp.typeLibrary.types.WMS) &&\r\n      (oDestParent.globalType !== emp.typeLibrary.types.OVERLAY)) {\r\n      sErrorMsg = \"The parent of a WMS service MUST be an overlay.\";\r\n      return false;\r\n    }\r\n\r\n    // Make sure that the parent does not have a child with the same Id.\r\n    var sCoreId;\r\n    switch (oFeature.globalType) {\r\n      case emp.typeLibrary.types.FEATURE:\r\n        for (sCoreId in oDestParent.nodes) {\r\n          oChild = oDestParent.nodes[sCoreId];\r\n\r\n          if ((oChild.globalType === emp.typeLibrary.types.FEATURE) &&\r\n            (oChild.featureId === oFeature.featureId)) {\r\n            sErrorMsg = \"Move would create a duplicate ID under destination parent.\";\r\n            return false;\r\n          }\r\n          else if ((oChild.globalType === emp.typeLibrary.types.WMS) &&\r\n            (oChild.id === oFeature.featureId)) {\r\n            sErrorMsg = \"Move would create a duplicate ID under destination parent.\";\r\n            return false;\r\n          }\r\n        }\r\n        break;\r\n      case emp.typeLibrary.types.WMS:\r\n        for (sCoreId in oDestParent.nodes) {\r\n          oChild = oDestParent.nodes[sCoreId];\r\n\r\n          if ((oChild.globalType === emp.typeLibrary.types.WMS) &&\r\n            (oChild.id === oFeature.id)) {\r\n            sErrorMsg = \"Move would create a duplicate ID under destination parent.\";\r\n            return false;\r\n          }\r\n          else if ((oChild.globalType === emp.typeLibrary.types.FEATURE) &&\r\n            (oChild.featureId === oFeature.id)) {\r\n            sErrorMsg = \"Move would create a duplicate ID under destination parent.\";\r\n            return false;\r\n          }\r\n\r\n        }\r\n        break;\r\n    }\r\n\r\n    // Make sure that this move does not create a \"paradox\".\r\n    // I.E. the feature does not end up being his own ancestor.\r\n\r\n    oParent = oDestParent;\r\n    switch (oFeature.globalType) {\r\n      case emp.typeLibrary.types.FEATURE:\r\n        while (oParent && (oParent.coreId !== emp.storage.getRootGuid(oTransaction.mapInstanceId))) {\r\n          if ((oParent.globalType === emp.typeLibrary.types.FEATURE) &&\r\n            (oParent.featureId === oFeature.featureId) &&\r\n            (oParent.overlayId === oFeature.destOverlayId)\r\n          ) {\r\n            sErrorMsg = \"Move would cause a parent child loop.\";\r\n            return false;\r\n          }\r\n          oParent = emp.storage._storage.get({\r\n            coreId: oParent.coreParent\r\n          });\r\n        }\r\n        break;\r\n      case emp.typeLibrary.types.WMS:\r\n        while (oParent && (oParent.coreId !== emp.storage.getRootGuid(oTransaction.mapInstanceId))) {\r\n          if ((oParent.globalType === emp.typeLibrary.types.WMS) &&\r\n            (oParent.id === oFeature.id) &&\r\n            (oParent.overlayId === oFeature.destOverlayId)) {\r\n            // This should never happen.\r\n            sErrorMsg = \"Move would cause a parent child loop.\";\r\n            return false;\r\n          }\r\n          oParent = emp.storage._storage.get({\r\n            coreId: oParent.coreParent\r\n          });\r\n        }\r\n        break;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  if (oTransaction.items && (oTransaction.items.length > 0)) {\r\n    for (iIndex = 0; iIndex < oTransaction.items.length;) {\r\n      oItem = oTransaction.items[iIndex];\r\n\r\n      oStorageEntry = emp.storage.get.byIds(oItem);\r\n\r\n      if (oStorageEntry === undefined) {\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Feature does not exists.\"\r\n        });\r\n        continue;\r\n      }\r\n      else {\r\n        sDestOverlay = oItem.destOverlayId;\r\n        sDestParentId = oItem.destParentId;\r\n        switch (oStorageEntry.getCoreObjectType()) {\r\n          case emp.typeLibrary.types.FEATURE:\r\n            if (oStorageEntry.isMultiParentRequired()) {\r\n              oTransaction.fail({\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Operation not supported on multi parented objects.\"\r\n              });\r\n              continue;\r\n            }\r\n            oNewItem = oStorageEntry.getObjectData(oTransaction.mapInstanceId, oItem.coreParent);\r\n\r\n            var oPayload = {\r\n              newOverlayId: oItem.destOverlayId,\r\n              newParentId: oItem.destParentId\r\n            };\r\n\r\n            if (oItem.name) {\r\n              oPayload.name = oItem.name;\r\n            }\r\n\r\n            oNewItem.applyUpdate(oPayload);\r\n\r\n            break;\r\n          case emp.typeLibrary.types.WMS:\r\n            if (sDestParentId) {\r\n              // The user wanted to place this under a feature.\r\n              // We must fail it.\r\n              oTransaction.fail({\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"A WMS can not be a child of a feature.\"\r\n              });\r\n              continue;\r\n            }\r\n            oNewItem = oStorageEntry.getObjectData(oTransaction.mapInstanceId, oItem.coreParent);\r\n\r\n            if (oItem.name !== undefined) {\r\n              oNewItem.name = oItem.name;\r\n            }\r\n\r\n            break;\r\n          default:\r\n            oTransaction.fail({\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Invalid object type retrieved from storage engine.\"\r\n            });\r\n            continue;\r\n        }\r\n        oTransaction.items[iIndex] = oNewItem;\r\n      }\r\n\r\n      if (oStorageEntry && (sDestOverlay || sDestParentId)) {\r\n        // This one is being re-parented.\r\n        // Check to see if its invalid.\r\n        if (oStorageEntry.isInEditMode()) {\r\n          oTransaction.fail([{\r\n            coreId: oNewItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"Update failed, the Feature is being edited.\"\r\n          }]);\r\n        }\r\n        else if (!isMoveValid(oNewItem)) {\r\n          oTransaction.fail({\r\n            coreId: oNewItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: sErrorMsg\r\n          });\r\n        }\r\n        else {\r\n          iIndex++;\r\n        }\r\n      }\r\n      else {\r\n        iIndex++;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {string} sCoreId\r\n * @param {string} coreParentId\r\n * @returns {*}\r\n */\r\nemp.storage.overlay.validateParent = function(sCoreId, coreParentId) {\r\n  // Remember that this only applies to overlay moves.\r\n  // Feature moves are handled in the feature.update.\r\n  var oParentCheck;\r\n  var aParentList;\r\n  var iIndex;\r\n  var oRetStatus = true;\r\n  var oParent = emp.storage.findObject(coreParentId);\r\n\r\n  if (sCoreId === coreParentId) {\r\n    // The overlay can't be its own ancestor.\r\n    return {\r\n      success: false,\r\n      errorMsg: \"An overlay cannot be its own ancestor.\"\r\n    };\r\n  }\r\n\r\n\r\n  if (emp.helpers.isEmptyString(coreParentId)) {\r\n    // We reached the root.\r\n    return true;\r\n  }\r\n\r\n  oParentCheck = oParent.getParent(sCoreId);\r\n\r\n  if (oParentCheck) {\r\n    // The overlay can't be its own ancestor.\r\n    return {\r\n      success: false,\r\n      errorMsg: \"An overlay cannot be its own ancestor.\"\r\n    };\r\n  }\r\n\r\n  aParentList = oParent.getParentCoreIds();\r\n\r\n  for (iIndex = 0; iIndex < aParentList.length; iIndex++) {\r\n    oRetStatus = emp.storage.overlay.validateParent(sCoreId, aParentList[iIndex]);\r\n    if (oRetStatus !== true) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return oRetStatus;\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.validateUpdate = function(oTransaction) {\r\n  var oItem;\r\n  var oNewItem;\r\n  var oStorageItem;\r\n  var oParentValid;\r\n  var oaItems = oTransaction.items;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n  for (var iIndex = 0; iIndex < oaItems.length;) {\r\n    // Go thru all the items and see if any of them are being\r\n    // re-parented.\r\n    oItem = oaItems[iIndex];\r\n    oStorageItem = emp.storage.findOverlay(oItem.overlayId);\r\n\r\n    if (oStorageItem === undefined) {\r\n      // We got an update for something that does not exists.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Overlay does not exists.\"\r\n      });\r\n      continue;\r\n    }\r\n    else if (oStorageItem.getCoreObjectType() !== emp.typeLibrary.types.OVERLAY) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Storage contains an object with the same ID that is not an overlay.\"\r\n      });\r\n      continue;\r\n    }\r\n    else if (!emp.helpers.isEmptyString(oItem.parentId) && (oStorageItem.parentCount() > 1)) {\r\n      // This one is being moved but it has more that 1 parent.\r\n      // Fail it.\r\n      // we do not support re-parenting multi-parent overlays.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Move operation on an overlay with more than 1 parent is not supported.\"\r\n      });\r\n      continue;\r\n    }\r\n    else {\r\n      if (!emp.helpers.isEmptyString(oItem.parentId)) {\r\n        switch (oItem.parentId) {\r\n          case emp.constant.parentIds.ALL_PARENTS:\r\n          case emp.constant.parentIds.MAP_LAYER_PARENT:\r\n            oTransaction.fail({\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Invalid parentId for overlay move. Overlay update canceled.\"\r\n            });\r\n            continue;\r\n          case emp.constant.parentIds.MAP_ROOT:\r\n            oItem.parentId = emp.storage.getRootGuid(mapInstanceId);\r\n            oItem.coreParent = oItem.parentId;\r\n            break;\r\n          default:\r\n            oItem.coreParent = oItem.parentId;\r\n            break;\r\n        }\r\n\r\n        // Check to see if its a valid parent.\r\n        oParentValid = emp.storage.overlay.validateParent(oStorageItem.getCoreId(), oItem.coreParent);\r\n        if (oParentValid !== true) {\r\n          oTransaction.fail({\r\n            coreId: oItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: oParentValid.errorMsg\r\n          });\r\n          continue;\r\n        }\r\n      }\r\n\r\n      oNewItem = oStorageItem.getObjectData(mapInstanceId, oItem.coreParent);\r\n      if (oItem.name) {\r\n        oNewItem.name = oItem.name;\r\n      }\r\n\r\n      if (oItem.hasOwnProperty('properties')) {\r\n        oNewItem.properties = oItem.properties;\r\n\r\n        if (oStorageItem.getProperties().hasOwnProperty('cluster')) {\r\n          oNewItem.properties.cluster = oStorageItem.getProperties().cluster;\r\n          oNewItem.properties.bClusterActive = oStorageItem.getProperties().bClusterActive;\r\n        }\r\n      }\r\n\r\n      if (oItem.hasOwnProperty('menuId')) {\r\n        oNewItem.menuId = oItem.menuId;\r\n      }\r\n\r\n      oaItems[iIndex] = oNewItem;\r\n      oItem = oNewItem;\r\n    }\r\n\r\n    iIndex++;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.editTransCplt = function(oTransaction) {\r\n  var sCoreId, iIndex;\r\n  var oStorageEntry;\r\n\r\n  if (oTransaction.items && (oTransaction.items.length > 0)) {\r\n    for (iIndex = 0; iIndex < oTransaction.items.length; iIndex++) {\r\n      sCoreId = oTransaction.items[iIndex].coreId;\r\n      oStorageEntry = emp.storage.get.id({\r\n        id: sCoreId\r\n      });\r\n\r\n      if (oStorageEntry) {\r\n        oStorageEntry.setEditMode(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (oTransaction.failures && (oTransaction.failures.length > 0)) {\r\n    for (iIndex = 0; iIndex < oTransaction.failures.length; iIndex++) {\r\n\r\n      sCoreId = oTransaction.failures[iIndex].coreId;\r\n      oStorageEntry = emp.storage.get.id({\r\n        id: sCoreId\r\n      });\r\n\r\n      if (oStorageEntry) {\r\n        oStorageEntry.setEditMode(false);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.validateEdit = function(oTransaction) {\r\n  var oStorageEntry;\r\n  var oEditItem;\r\n  var oParent;\r\n\r\n  // We must validate the edit structure.  If the originalFeature is not present,\r\n  // The feature does not exists.\r\n  for (var iIndex = 0; iIndex < oTransaction.items.length;) {\r\n    oEditItem = oTransaction.items[iIndex];\r\n\r\n    oStorageEntry = emp.storage.findFeature(oEditItem.overlayId, oEditItem.featureId);\r\n\r\n    if (oStorageEntry === undefined) {\r\n      oTransaction.fail([{\r\n        coreId: oEditItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Feature does not exist.\"\r\n      }]);\r\n      continue;\r\n    }\r\n    else if (oStorageEntry.isInEditMode()) {\r\n      oTransaction.fail([{\r\n        coreId: oEditItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Feature is already being edited.\"\r\n      }]);\r\n      continue;\r\n    }\r\n    else if (!oStorageEntry.canMapEngineEdit(oTransaction.mapInstanceId)) {\r\n      // The current map can't edit this feature.\r\n      oTransaction.fail([{\r\n        coreId: oEditItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Current map does not support editing a feature of this type.\"\r\n      }]);\r\n      continue;\r\n    }\r\n    oParent = emp.storage.findParentOnMap(oTransaction.mapInstanceId, oStorageEntry);\r\n    oEditItem.originFeature = oStorageEntry.getObjectData(oTransaction.mapInstanceId, oParent.getCoreId());\r\n\r\n    iIndex++;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.validateDraw = function(oTransaction) {\r\n  for (var iIndex = 0; iIndex < oTransaction.items.length; iIndex++) {\r\n    var oDrawItem = oTransaction.items[iIndex];\r\n    var oFeature = emp.storage.findFeature(oDrawItem.overlayId, oDrawItem.featureId);\r\n\r\n    if (oFeature) {\r\n      // There is a feature with this overlay, feature Id.\r\n      switch (oFeature.getFormat()) {\r\n        case emp.typeLibrary.featureFormatType.GEOJSON:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_POINT:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_PATH:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n        case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n          // We must set the draw coreId to the features coreId.\r\n          oDrawItem.coreId = oFeature.coreId;\r\n          oDrawItem.parentCoreId = oFeature.parentCoreId;\r\n          break;\r\n        default:\r\n          oTransaction.fail([{\r\n            coreId: oDrawItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"A draw operation is not supported on feature \" + oFeature.featureId + \" due to it having a format of: \" + oFeature.format + \". Please see documentation for a list of feature formats that support drawing.\"\r\n          }]);\r\n          iIndex--;\r\n          continue;\r\n      }\r\n    }\r\n    else if (!((oDrawItem.overlayId === undefined) ||\r\n        (oDrawItem.overlayId === null))) {\r\n      // They provided an overlayId.\r\n      var oOverlay = emp.storage.findOverlay(oDrawItem.overlayId);\r\n\r\n      if (oOverlay !== undefined) {\r\n        oDrawItem.parentCoreId = oOverlay.coreId;\r\n\r\n        /*\r\n        if (oOverlay.isMultiParentRequired())\r\n        {\r\n            // If the overlay is multi-parent set it to MP.\r\n            oDrawItem.properties.multiParentRequired = true;\r\n            // Its a multi-parent draw make sure that the overlay Id\r\n            // is set to the root MP overlay.\r\n            // And we need to store the original overlay and parent ID.\r\n            oDrawItem.originalOverlayId = oDrawItem.overlayId;\r\n            oDrawItem.parentCoreId = oOverlay.getRootCoreId();\r\n            oDrawItem.overlayId = oDrawItem.parentCoreId;\r\n        }\r\n        else if (oDrawItem.properties.hasOwnProperty('multiParentRequired'))\r\n        {\r\n            // Else remove the property so its not MP.\r\n            delete oDrawItem.properties.multiParentRequired;\r\n        }\r\n        */\r\n      }\r\n      /**\r\n      else if (oDrawItem.properties.hasOwnProperty('multiParentRequired'))\r\n      {\r\n          // Else remove the property so its not MP.\r\n          delete oDrawItem.properties.multiParentRequired;\r\n          oDrawItem.parentCoreId = oFeature.overlayId;\r\n      }\r\n      **/\r\n      else {\r\n        oDrawItem.parentCoreId = oFeature.overlayId;\r\n      }\r\n    }\r\n    /**\r\n    else if (oDrawItem.properties.hasOwnProperty('multiParentRequired'))\r\n    {\r\n        // Else if it has MP remove the property so its not MP.\r\n        delete oDrawItem.properties.multiParentRequired;\r\n    }\r\n    **/\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.remove = function(oTransaction) {\r\n\r\n  var oStorageEntry;\r\n  var oaItems = oTransaction.items;\r\n  var aMapList, aPrevMapList;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n  var iIndex;\r\n  var oItem;\r\n  var oParent;\r\n  var oTransactions = {};\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length;) {\r\n    oItem = oaItems[iIndex];\r\n    oStorageEntry = emp.storage.findOverlay(oItem.overlayId);\r\n\r\n    if (oStorageEntry === undefined) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Overlay remove: overlay \" + oItem.overlayId + \" not found.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    if (!emp.helpers.isEmptyString(oItem.parentId)) {\r\n      // If it has a parent overlay, get it.\r\n      oParent = emp.storage.findOverlay(oItem.parentId);\r\n      if (oParent === undefined) {\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Unable to find parent overlay of overlay \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        continue;\r\n      }\r\n    }\r\n    else {\r\n      oParent = emp.storage.findOverlay(emp.storage.getRootGuid(mapInstanceId));\r\n\r\n      if (oParent === undefined) {\r\n        new emp.typeLibrary.Error({\r\n          level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n          message: \"Unable to find map instance root (\" + emp.storage.getRootGuid(mapInstanceId) + \") for overlay \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Unable to find map root of overlay \" + oStorageEntry.getName() + \".\"\r\n        });\r\n        continue;\r\n      }\r\n    }\r\n\r\n    if (!oParent.isParentOf(oStorageEntry.getCoreId())) {\r\n      // The identified parent is not a parent of the storage object.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: oParent.getName() + \" is not a parent of feature \" + oStorageEntry.getName() + \".\"\r\n      });\r\n      continue;\r\n    }\r\n    aPrevMapList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    oParent.removeChild(oStorageEntry);\r\n\r\n    aMapList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    emp.storage.processRequest(oTransactions, aPrevMapList, aMapList, oParent, oStorageEntry, false);\r\n    /*\r\n            // This next loop will eliminate from aPrevMapList the instances\r\n            // that are in aMapList. Therefore the remaining ones are\r\n            // those map instances that the feature must be removed from.\r\n            for (iMapIndex = 0; iMapIndex < aMapList.length; iMapIndex++) {\r\n                iTempIndex = aPrevMapList.indexOf(aMapList[iMapIndex]);\r\n                if (iTempIndex !== -1) {\r\n                    // Remove the element.\r\n                    aPrevMapList.splice(iTempIndex, 1);\r\n                }\r\n            }\r\n\r\n            // The following loop creates the remove transaction.\r\n            for (iMapIndex = 0; iMapIndex < aPrevMapList.length; iMapIndex++) {\r\n                emp.storage.addToRemoveTransaction(oTransactions, aPrevMapList[iMapIndex], oParent, oStorageEntry);\r\n            }\r\n    */\r\n    if (aMapList.length === 0) {\r\n      // The storage entry has no more parents.\r\n      // Delete all children with no other parents.\r\n      emp.storage.removeParentFromChildren(oStorageEntry);\r\n      // Now delete the item\r\n      emp.storage.deleteObject(oStorageEntry);\r\n    }\r\n\r\n    aMapList = oParent.getParentMapInstanceList();\r\n\r\n    // Loop thru the maps of the parent to send an update so the UI\r\n    // can update.  <--- took this out because remove is already updating the item now.\r\n    /*\r\n    for (iMapIndex = 0; iMapIndex < aMapList.length; iMapIndex++) {\r\n        emp.storage.addToObjectUpdateTransaction(oTransactions, aMapList[iMapIndex], oParent);\r\n    }\r\n    */\r\n\r\n    //console.log(\"   DELETED \" + oItem.name + \" (\" + oItem.coreId + \").\");\r\n    iIndex++;\r\n  }\r\n\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n\r\n/**\r\n * @param {emp.classLibrary.EmpRenderableObject} oParent\r\n */\r\nemp.storage.removeParentFromChildren = function(oParent) {\r\n  var oChild;\r\n\r\n  if (oParent.hasChildren()) {\r\n    // This parent is being removed, so we must take it off of the\r\n    // parent list of all its children.\r\n    var aCoreIdList = oParent.getChildrenCoreIds();\r\n\r\n    for (var iIndex = 0; iIndex < aCoreIdList.length; iIndex++) {\r\n      oChild = oParent.getChild(aCoreIdList[iIndex]);\r\n      oParent.removeChild(oChild);\r\n\r\n      if (!oChild.hasParents()) {\r\n        // This child has no more parents.\r\n        // So before we remove it we must remove all its children.\r\n        emp.storage.removeParentFromChildren(oChild);\r\n        emp.storage.deleteObject(oChild);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * This function validates features adds before they are sent to the map.\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.feature.validateAdd = function(oTransaction) {\r\n  var oItems = oTransaction.items;\r\n  var oStorageEntry;\r\n  var oItem;\r\n  var oParent;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n  for (var iIndex = 0; iIndex < oItems.length;) {\r\n    oItem = oItems[iIndex];\r\n\r\n    // Find the parent.\r\n    oParent = emp.storage.get.id({\r\n      id: oItem.coreParent\r\n    });\r\n\r\n    if (oItem.parentId && (oItem.coreParent === undefined)) {\r\n      // This feature is being add to a parent feature that does not exists.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"The parent feature (\" + oItem.parentId + \") of feature \" + oItem.name + \" does not exists.\"\r\n      });\r\n      continue;\r\n    }\r\n    else if ((oParent !== undefined) && oParent.options.coreId === oItem.coreId) {\r\n      // Attempting to add feature as it's own child\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Cannot set a feature as a child of itself: \" + oItem.name + \".\"\r\n      });\r\n      return false;\r\n    }\r\n    else if ((oParent === undefined) && (oItem.parentId === undefined)) {\r\n      // Specific parent identification was not provided.\r\n      switch (oItem.overlayId) {\r\n        case emp.constant.parentIds.ALL_PARENTS:\r\n        case undefined:\r\n          // This is an update if all parents are being addressed, therefore the feature MUST exists.\r\n          // So we must find the feature in storage or fail the item.\r\n          oStorageEntry = emp.storage.findFeature(undefined, oItem.featureId);\r\n          if (!oStorageEntry) {\r\n            oTransaction.fail({\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Invalid parent for new feature (\" + oItem.name + \").\"\r\n            });\r\n            continue;\r\n          }\r\n          delete oItem['overlayId'];\r\n          delete oItem['parentId'];\r\n          delete oItem['coreParent'];\r\n          break;\r\n        case emp.constant.parentIds.MAP_ROOT:\r\n          oTransaction.fail({\r\n            coreId: oItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"Features can not be added to the root of the map.\"\r\n          });\r\n          continue;\r\n        default:\r\n          // Its a feature added to an overlay that does not exists.\r\n          emp.storage.overlay.createOverlay(mapInstanceId, oItem.overlayId, oTransaction.sender);\r\n          oParent = emp.storage.findObject(oItem.coreParent);\r\n\r\n          if (oParent === undefined) {\r\n            // Failed to create the parent overlay.\r\n            oTransaction.fail({\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Unable to create parent overlay of this feature (\" + oItem.name + \").\"\r\n            });\r\n            continue;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    iIndex++;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.validateAdd = function(oTransaction) {\r\n  // This function validates overlay adds before they are sent to th map.\r\n  var oItems = oTransaction.items;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n  var oItem;\r\n  var oParent;\r\n  var rootCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n\r\n  for (var iIndex = 0; iIndex < oItems.length;) {\r\n    oItem = oItems[iIndex];\r\n\r\n    if (oItem.parentId !== undefined) {\r\n      // If it has a parentId set it.\r\n      oItem.coreParent = oItem.parentId;\r\n      oItem.parentCoreId = oItem.coreParent;\r\n    }\r\n    else {\r\n      oItem.coreParent = rootCoreId;\r\n      oItem.parentCoreId = undefined;\r\n    }\r\n\r\n    if (oItem.coreParent !== rootCoreId) {\r\n      oParent = emp.storage.findObject(oItem.coreParent);\r\n\r\n      if (oParent !== undefined) {\r\n        // The parent exists. Now see if it is visible\r\n        // If the parent is not visible the feature cant be.\r\n        //oItem.visible = (oParent.visible? oItem.visible: false);\r\n      }\r\n      else {\r\n        switch (oItem.overlayId) {\r\n          case emp.constant.parentIds.MAP_ROOT:\r\n            break;\r\n          case emp.constant.parentIds.ALL_PARENTS:\r\n          case undefined:\r\n            break;\r\n          default:\r\n            // The parent does not exists.\r\n            emp.storage.overlay.createOverlay(mapInstanceId, oItem.parentId, oTransaction.sender);\r\n\r\n            // Now it should exists. If not fail.\r\n            oParent = emp.storage.findObject(oItem.parentId);\r\n\r\n            if (oParent === undefined) {\r\n              oTransaction.fail({\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Unable to create parent of this overlay (\" + oItem.name + \").\"\r\n              });\r\n              continue;\r\n            }\r\n            break;\r\n        }\r\n      }\r\n    }\r\n    iIndex++;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.overlay.validateCluster = function(oTransaction) {\r\n  // This function validates overlay adds before they are sent to th map.\r\n  var oItems = oTransaction.items;\r\n  var oItem;\r\n  var oOverlay;\r\n\r\n  for (var iIndex = 0; iIndex < oItems.length; iIndex++) {\r\n    oItem = oItems[iIndex];\r\n    oOverlay = emp.storage.get.id({\r\n      id: oItem.coreId\r\n    });\r\n\r\n    if (!oOverlay) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Cluster Set failed. Overlay does NOT exists.\"\r\n      });\r\n      iIndex--;\r\n    }\r\n    else if (oOverlay.isMultiParentRequired()) {\r\n      if (oOverlay.coreParent !== emp.storage.getRootGuid(oTransaction.mapInstanceId)) {\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Only the root multi-parent overlay can be clustered.\"\r\n        });\r\n        iIndex--;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param mapInstanceId\r\n * @param objectType\r\n * @param oItem\r\n * @returns {{success: boolean, parent: undefined, oError: {coreId: *, level: (emp.typeLibrary.Error.level|number), message: string}}}\r\n */\r\nemp.storage.findParent = function(mapInstanceId, objectType, oItem) {\r\n  var oReturnStatus = {\r\n    success: false,\r\n    parent: undefined,\r\n    oError: {\r\n      coreId: oItem.coreId,\r\n      level: emp.typeLibrary.Error.level.MAJOR,\r\n      message: \"Parent not found.\"\r\n    }\r\n  };\r\n\r\n  if (oItem.hasOwnProperty('parentId')) {\r\n    if (objectType === emp.typeLibrary.types.OVERLAY) {\r\n      switch (oItem.parentId) {\r\n        case emp.constant.parentIds.ALL_PARENTS:\r\n          // For all parents we leave the oParent undefined.\r\n          oReturnStatus.success = true;\r\n          break;\r\n        case emp.constant.parentIds.MAP_ROOT:\r\n          oReturnStatus.success = true;\r\n          oReturnStatus.parent = emp.storage.findOverlay(emp.storage.getRootGuid(mapInstanceId));\r\n          break;\r\n        default:\r\n          if (!emp.helpers.isEmptyString(oItem.parentId)) {\r\n            oReturnStatus.parent = emp.storage.findOverlay(oItem.parentId);\r\n            if (oReturnStatus.parent === undefined) {\r\n              oReturnStatus.oError = {\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Parent overlay \" + oItem.parentId + \" not found.\"\r\n              };\r\n            }\r\n            else {\r\n              oReturnStatus.success = true;\r\n            }\r\n          }\r\n          else {\r\n            oReturnStatus.oError = {\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Invalid parent Id for overlay.\"\r\n            };\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    else if (objectType === emp.typeLibrary.types.FEATURE) {\r\n      switch (oItem.parentId) {\r\n        case emp.constant.parentIds.ALL_PARENTS:\r\n        case emp.constant.parentIds.MAP_ROOT:\r\n          oReturnStatus.success = true;\r\n          break;\r\n        default:\r\n          if (!emp.helpers.isEmptyString(oItem.parentId)) {\r\n            oReturnStatus.parent = emp.storage.findFeature(oItem.overlayId, oItem.parentId);\r\n\r\n            if (oReturnStatus.parent === undefined) {\r\n              oReturnStatus.oError = {\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Parent feature \" + oItem.parentId + \" not found.\"\r\n              };\r\n            }\r\n            else {\r\n              oReturnStatus.success = true;\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n  }\r\n  else if (oItem.hasOwnProperty('overlayId')) {\r\n    if (objectType === emp.typeLibrary.types.FEATURE) {\r\n\r\n      switch (oItem.overlayId) {\r\n        case emp.constant.parentIds.ALL_PARENTS:\r\n          oReturnStatus.success = true;\r\n          break;\r\n        case emp.constant.parentIds.MAP_ROOT:\r\n          oReturnStatus.oError = {\r\n            coreId: oItem.coreId,\r\n            level: emp.typeLibrary.Error.level.MAJOR,\r\n            message: \"Feature \" + oItem.featureId + \" is not at the map root.\"\r\n          };\r\n          break;\r\n        default:\r\n          if (!emp.helpers.isEmptyString(oItem.overlayId)) {\r\n            oReturnStatus.parent = emp.storage.findOverlay(oItem.overlayId);\r\n            if (!oReturnStatus.parent) {\r\n              oReturnStatus.oError = {\r\n                coreId: oItem.coreId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: \"Parent Overlay \" + oItem.overlayId + \" not found.\"\r\n              };\r\n            }\r\n            else {\r\n              oReturnStatus.success = true;\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return oReturnStatus;\r\n};\r\n\r\n/**\r\n * @namespace\r\n * @memberof emp.storage\r\n */\r\nemp.storage.mapservice = {};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.mapservice.validateAdd = function(oTransaction) {\r\n  var oItem;\r\n  var iIndex;\r\n  var oStorageEntry;\r\n  var oaItems = oTransaction.items;\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length;) {\r\n    oItem = oaItems[iIndex];\r\n\r\n    oStorageEntry = emp.storage.get.id({\r\n      id: oItem.coreId\r\n    });\r\n\r\n    if (oStorageEntry &&\r\n      (oStorageEntry.getCoreObjectType() !== emp.typeLibrary.types.WMS)) {\r\n      // The item has an ID which is a duplicate of an item in storage that is not a WMS.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"MapService feature id is duplicate.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    switch (oItem.overlayId) {\r\n      case emp.constant.parentIds.ALL_PARENTS:\r\n        if (!oStorageEntry) {\r\n          // The WMS does not exists so change the overlay ID\r\n          oItem.overlayId = emp.constant.parentIds.MAP_LAYER_PARENT;\r\n        }\r\n        break;\r\n      case emp.constant.parentIds.MAP_ROOT:\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Invalid overlay Id for WMS feature.\"\r\n        });\r\n        continue;\r\n      case emp.constant.parentIds.MAP_LAYER_PARENT:\r\n        break;\r\n      case undefined:\r\n        if (!oStorageEntry) {\r\n          // The WMS does not exists so change the overlay ID\r\n          oItem.overlayId = emp.constant.parentIds.MAP_LAYER_PARENT;\r\n        }\r\n        else {\r\n          // It does exists so we process it as an update.\r\n          oItem.overlayId = emp.constant.parentIds.ALL_PARENTS;\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    iIndex++;\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.mapservice.add = function(oTransaction) {\r\n  var oItem;\r\n  var iIndex;\r\n  var oParent;\r\n  var oStorageEntry;\r\n  var oMapIdList, oPrevMapList;\r\n  var oaItems = oTransaction.items;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n  var oTransactions = {};\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length;) {\r\n    oItem = oaItems[iIndex];\r\n\r\n    oStorageEntry = emp.storage.get.id({\r\n      id: oItem.coreId\r\n    });\r\n\r\n    switch (oItem.overlayId) {\r\n      case emp.constant.parentIds.ALL_PARENTS:\r\n        // Its an update.\r\n        break;\r\n      case emp.constant.parentIds.MAP_LAYER_PARENT:\r\n        oItem.coreParent = emp.wms.manager.getWmsOverlayId(mapInstanceId);\r\n        oParent = emp.storage.findOverlay(emp.wms.manager.getWmsOverlayId(mapInstanceId));\r\n        break;\r\n      default:\r\n        oParent = emp.storage.findOverlay(oItem.overlayId);\r\n\r\n        if (!oParent) {\r\n          // The overlay indicated does not exists.\r\n          // We must create it.\r\n          emp.storage.overlay.createOverlay(mapInstanceId, oItem.overlayId, oTransaction.sender);\r\n          oParent = emp.storage.get.id({\r\n            id: oItem.overlayId\r\n          });\r\n\r\n          if (oParent === undefined) {\r\n            // Failed to create the parent overlay.\r\n            oTransaction.fail({\r\n              coreId: oItem.coreId,\r\n              level: emp.typeLibrary.Error.level.MAJOR,\r\n              message: \"Unable to create parent overlay of WMS feature (\" + oItem.url + \").\"\r\n            });\r\n            continue;\r\n          }\r\n\r\n        }\r\n        oItem.coreParent = oItem.overlayId;\r\n        break;\r\n    }\r\n\r\n    oPrevMapList = [];\r\n\r\n    if (oStorageEntry) {\r\n      oStorageEntry.update(oItem);\r\n      oPrevMapList = oStorageEntry.getParentMapInstanceList();\r\n    }\r\n    else {\r\n      switch (oItem.type) {\r\n        case 'wms':\r\n          oStorageEntry = new emp.classLibrary.EmpWMS(oItem);\r\n          emp.storage._storage.set(oStorageEntry);\r\n          break;\r\n        case 'wmts':\r\n          oStorageEntry = new emp.classLibrary.EmpWMTS(oItem);\r\n          emp.storage._storage.set(oStorageEntry);\r\n          break;\r\n        case 'kml':\r\n          oStorageEntry = new emp.classLibrary.EmpKmlLayer(oItem);\r\n          emp.storage._storage.set(oStorageEntry);\r\n          break;\r\n      }\r\n\r\n    }\r\n\r\n    if (oParent && !oParent.isParentOf(oStorageEntry)) {\r\n\r\n      switch (oItem.type) {\r\n        case 'wms':\r\n          oParent.addChild(oStorageEntry, oItem.visible &&\r\n            (oStorageEntry.hasLayers() || oStorageEntry.hasVisibleLayers()));\r\n          break;\r\n        case 'wmts':\r\n        case 'kml':\r\n          oParent.addChild(oStorageEntry, oItem.visible);\r\n          break;\r\n      }\r\n\r\n    }\r\n\r\n    oMapIdList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    emp.storage.processRequest(oTransactions, oPrevMapList, oMapIdList, oParent, oStorageEntry);\r\n\r\n    iIndex++;\r\n  }\r\n\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n\r\n/**\r\n *\r\n * @param {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.mapservice.remove = function(oTransaction) {\r\n  var oItem;\r\n  var iIndex;\r\n  var oMapIdList, oPrevMapIdList;\r\n  var oStorageEntry;\r\n  var oParent;\r\n  var oaItems = oTransaction.items;\r\n  var mapInstanceId = oTransaction.mapInstanceId;\r\n  var oTransactions = {};\r\n\r\n  for (iIndex = 0; iIndex < oaItems.length;) {\r\n    oItem = oaItems[iIndex];\r\n\r\n    oStorageEntry = emp.storage.get.id({\r\n      id: oItem.coreId\r\n    });\r\n\r\n    if (!oStorageEntry) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"WMS feature not found.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    switch (oItem.overlayId) {\r\n      case emp.constant.parentIds.ALL_PARENTS:\r\n        oTransaction.fail({\r\n          coreId: oItem.coreId,\r\n          level: emp.typeLibrary.Error.level.MAJOR,\r\n          message: \"Invalid overlay id. WMS feature not removed.\"\r\n        });\r\n        continue;\r\n      case emp.constant.parentIds.MAP_LAYER_PARENT:\r\n        oItem.coreParent = emp.wms.manager.getWmsOverlayId(mapInstanceId);\r\n        oParent = emp.storage.findOverlay(oItem.coreParent);\r\n        break;\r\n      default:\r\n        oParent = emp.storage.findOverlay(oItem.overlayId);\r\n        oItem.coreParent = oItem.overlayId;\r\n        break;\r\n    }\r\n\r\n    if (!oParent) {\r\n      // Failed to find the parent overlay.\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MAJOR,\r\n        message: \"Parent overlay not found. WMS feature not removed.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    if (!oParent.isParentOf(oStorageEntry.getCoreId())) {\r\n      oTransaction.fail({\r\n        coreId: oItem.coreId,\r\n        level: emp.typeLibrary.Error.level.MINOR,\r\n        message: \"Overlay \" + oParent.getName() + \" is not a parent of WMS \" + oStorageEntry.getName() + \". WMS feature not removed.\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    oPrevMapIdList = oStorageEntry.getParentMapInstanceList();\r\n    oParent.removeChild(oStorageEntry);\r\n    oMapIdList = oStorageEntry.getParentMapInstanceList();\r\n\r\n    emp.storage.processRequest(oTransactions, oPrevMapIdList, oMapIdList, oParent, oStorageEntry);\r\n\r\n    if (oStorageEntry.parentCount() === 0) {\r\n      // The storage entry has no more parents.\r\n      // Delete all children with no other parents.\r\n      emp.storage.removeParentFromChildren(oStorageEntry);\r\n      // Now delete the item\r\n      emp.storage.deleteObject(oStorageEntry);\r\n    }\r\n\r\n    iIndex++;\r\n  }\r\n\r\n  emp.storage.executeTransactions(oTransactions);\r\n};\r\n","/**\r\n * @constructs emp.storage.searchEngine\r\n * @param sMapInstanceId\r\n * @param {object} oSearchCriteria\r\n * @param {number} oSearchCriteria.maxResults\r\n * @returns {object}\r\n */\r\nemp.storage.searchEngine = function(sMapInstanceId, oSearchCriteria) {\r\n    var mapInstanceId = sMapInstanceId;\r\n    var sRootCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n    var oCriteria = oSearchCriteria;\r\n\r\n    /** This associative array will hold all object that have been searched. This avoids infinite loops. */\r\n    var searchedEntries = {};\r\n\r\n    /**\r\n     * @description This function does a type match search on the children of the storage entry object passed in.\r\n     * @param {Array<emp.classLibrary.EmpRenderableObject>} oCurrentResultSet This\r\n     * parameter is an array of object that satisfy the search.\r\n     * @param {Array<String>} oTypes is an array of strings containing the types to match.\r\n     * @param {number} iMaxResults The maximum number of results the caller wants.\r\n     * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry The parent object to search.\r\n     */\r\n    var searchChildren = function(oCurrentResultSet, oTypes, iMaxResults, oStorageEntry) {\r\n        var sCoreId;\r\n        /** @type {emp.classLibrary.EmpRenderableObject} */\r\n        var oChild;\r\n        var oChildList;\r\n\r\n        if (searchedEntries[oStorageEntry.getCoreId()] !== undefined) {\r\n            // This Entry has been searched.\r\n            return;\r\n        }\r\n\r\n        searchedEntries[oStorageEntry.getCoreId()] = oStorageEntry;\r\n\r\n        if (oStorageEntry.hasChildren()) {\r\n            oChildList = oStorageEntry.getChildrenList();\r\n\r\n            for (sCoreId in oChildList) {\r\n                if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                    continue;\r\n                }\r\n                oChild = oChildList[sCoreId];\r\n\r\n                if (oChild) {\r\n                    if (globalTypeMatch(oChild, oTypes)) {\r\n                        // Its a match, add it if its not on the list.\r\n                        if (oCurrentResultSet.indexOf(oChild) === -1) {\r\n                            if (!emp.storage.isRoot(oChild.options.coreId)) {\r\n                                oCurrentResultSet.push(oChild);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (iMaxResults !== undefined) {\r\n                        // Check to see if we have a max results and if so\r\n                        // Exit the storage loop if we have reached the max requested.\r\n                        if (oCurrentResultSet.length >= iMaxResults) {\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    searchChildren(oCurrentResultSet, oTypes, iMaxResults, oChild);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description This function does a type match search on the children of the storage entry object passed in.\r\n     * @param {Array<emp.classLibrary.EmpRenderableObject>} oCurrentResultSet This\r\n     * parameter is an array of object that satisfy the search.\r\n     * @param {Array<String>} oTypes is an array of strings containing the types to match.\r\n     * @param {number} iMaxResults The maximum number of results the caller wants.\r\n     * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry The parent object to search.\r\n     * @param {boolean} bRecursive True if the search is to be recursive into the children of the children.\r\n     */\r\n    var findChildrenNoFilter = function(oCurrentResultSet, oTypes, iMaxResults, oStorageEntry, bRecursive) {\r\n        var sCoreId;\r\n        var oChild;\r\n        var oChildList;\r\n\r\n        if (searchedEntries[oStorageEntry.getCoreId()] !== undefined) {\r\n            // This Entry has been searched.\r\n            return;\r\n        }\r\n\r\n        searchedEntries[oStorageEntry.getCoreId()] = oStorageEntry;\r\n\r\n        if (oStorageEntry.hasChildren()) {\r\n            oChildList = oStorageEntry.getChildrenList();\r\n\r\n            for (sCoreId in oChildList) {\r\n                if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                    continue;\r\n                }\r\n                oChild = oChildList[sCoreId];\r\n\r\n                if (oChild){\r\n                    if (globalTypeMatch(oChild, oTypes)) {\r\n                        // Its a match, add it if its not on the list.\r\n                        if (oCurrentResultSet.indexOf(oChild) === -1) {\r\n                            if (!emp.storage.isRoot(oChild.options.coreId) &&\r\n                                !emp.wms.manager.isRootWMS(oChild.options.coreId) &&\r\n                                !oChild.options.hidden) {\r\n                                oCurrentResultSet.push(oChild);\r\n                            }\r\n\r\n                            if (iMaxResults !== undefined) {\r\n                                // Check to see if we have a max results and if so\r\n                                // Exit the storage loop if we have reached the max requested.\r\n                                if (oCurrentResultSet.length >= iMaxResults) {\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        if (bRecursive) {\r\n                            findChildrenNoFilter(oCurrentResultSet, oTypes, iMaxResults, oChild, bRecursive);\r\n                        }\r\n                    } else if (bRecursive) {\r\n                        findChildrenNoFilter(oCurrentResultSet, oTypes, iMaxResults, oChild, bRecursive);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description This function does a type and filter match search on the children of the storage entry object passed in.\r\n     * @param {Array<emp.classLibrary.EmpRenderableObject>} oCurrentResultSet This\r\n     * parameter is an array of object that satisfy the search.\r\n     * @param {Array<String>} oTypes is an array of strings containing the types to match.\r\n     * @param {Array<object>} oFilter An array of {property, term} objects to filter the search.\r\n     * @param {number} iMaxResults The maximum number of results the caller wants.\r\n     * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry The parent object to search.\r\n     */\r\n    var searchChildrenWithFilter = function(oCurrentResultSet, oTypes, oFilter, iMaxResults, oStorageEntry) {\r\n        var sCoreId;\r\n        var oChild;\r\n        var oChildList;\r\n\r\n        if (searchedEntries[oStorageEntry.getCoreId()] !== undefined) {\r\n            // This Entry has been searched.\r\n            return;\r\n        }\r\n\r\n        searchedEntries[oStorageEntry.getCoreId()] = oStorageEntry;\r\n\r\n        if (oStorageEntry.hasChildren()) {\r\n            oChildList = oStorageEntry.getChildrenList();\r\n\r\n            for (sCoreId in oChildList) {\r\n                if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                    continue;\r\n                }\r\n                oChild = oChildList[sCoreId];\r\n\r\n                if (oChild) {\r\n                    if (globalTypeMatch(oChild, oTypes)) {\r\n                        if (oFilter.length > 0) {\r\n                            if (passesFilters(oChild, oFilter)) {\r\n                                // Its a match, add it if its not on the list.\r\n                                if (oCurrentResultSet.indexOf(oChild) === -1) {\r\n                                    if (!emp.storage.isRoot(oChild.options.coreId)) {\r\n                                        oCurrentResultSet.push(oChild);\r\n                                    }\r\n                                }\r\n                            }\r\n                        } else {\r\n                            // Its a match, add it if its not on the list.\r\n                            if (oCurrentResultSet.indexOf(oChild) === -1) {\r\n                                if (!emp.storage.isRoot(oChild.options.coreId)) {\r\n                                    oCurrentResultSet.push(oChild);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (iMaxResults !== undefined) {\r\n                        // Check to see if we have a max results and if so\r\n                        // Exit the storage loop if we have reached the max requested.\r\n                        if (oCurrentResultSet.length >= iMaxResults) {\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    searchChildrenWithFilter(oCurrentResultSet, oTypes, oFilter, iMaxResults, oChild);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description This function searches the parents of the feature looking for a parent feature with the given featureId.\r\n     * @param {emp.classLibrary.EmpFeature} oStorageEntry A feature object we need to search the parents.\r\n     * @param {String} sFeatureId The feature Id to compare with.\r\n     * @returns {Boolean}\r\n     */\r\n    var passesFeatureIdFilter = function(oStorageEntry, sFeatureId) {\r\n        var oParent;\r\n        var sParentCoreId;\r\n        var oParentRelationshipList = oStorageEntry.getParentRelationshipList();\r\n\r\n        // Cycle thru all the parents.\r\n        for (sParentCoreId in oParentRelationshipList) {\r\n            if (!oParentRelationshipList.hasOwnProperty(sParentCoreId)) {\r\n                continue;\r\n            }\r\n            oParent = emp.storage.findObject(sParentCoreId);\r\n\r\n            // We are looking for a feature that has the given featureId.\r\n            // This is in case a feature is the child of more than one feature.\r\n            if (oParent.getCoreObjectType() === emp.typeLibrary.types.FEATURE) {\r\n                if (oParent.getFeatureId() === sFeatureId) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @description This function searches for a parents of the Entry for a parent overlay with the given overlay Id.\r\n     * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry an  object we need to search its parents.\r\n     * @param {String} sOverlayId\r\n     * @returns {Boolean}\r\n     */\r\n    var passesOverlayIdFilter = function(oStorageEntry, sOverlayId) {\r\n        var oParent;\r\n        var sParentCoreId;\r\n        var oParentRelationshipList = oStorageEntry.getParentRelationshipList();\r\n\r\n        // Cycle thru all the parents\r\n        for (sParentCoreId in oParentRelationshipList) {\r\n            if (!oParentRelationshipList.hasOwnProperty(sParentCoreId)) {\r\n                continue;\r\n            }\r\n            oParent = emp.storage.findObject(sParentCoreId);\r\n\r\n            // We are looking for an overlay with the given overlayId\r\n            if (oParent.getCoreObjectType() === emp.typeLibrary.types.OVERLAY) {\r\n                if (sOverlayId === undefined) {\r\n                    // If its undefined we are looking for the root.\r\n                    if (oParent.getOverlayId() === sRootCoreId) {\r\n                        return true;\r\n                    }\r\n                } else if (oParent.getOverlayId() === sOverlayId) {\r\n                    return true;\r\n                }\r\n            } else if (oParent.getCoreObjectType() === emp.typeLibrary.types.FEATURE) {\r\n                // If this parent is a feature (which will only happen if the\r\n                // original was a feature, we need to continue up all parents\r\n                // to compare with the first overlay we find up the tree.\r\n                if (passesOverlayIdFilter(oParent, sOverlayId)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    var passesFilter = function(oStorageEntry, oFilter) {\r\n        switch (oStorageEntry.getCoreObjectType()) {\r\n            case emp.typeLibrary.types.FEATURE:\r\n                switch (oFilter.property) {\r\n                    case 'overlayId':\r\n                        return passesOverlayIdFilter(oStorageEntry, oFilter.term);\r\n                    case 'parentId':\r\n                        if (oFilter.term === undefined) {\r\n                            return true;\r\n                        }\r\n                        return passesFeatureIdFilter(oStorageEntry, oFilter.term);\r\n                }\r\n                break;\r\n            case emp.typeLibrary.types.OVERLAY:\r\n                switch (oFilter.property) {\r\n                    case 'parentId':\r\n                        if (oFilter.term === undefined) {\r\n                            return true;\r\n                        }\r\n                        return passesOverlayIdFilter(oStorageEntry, oFilter.term);\r\n                }\r\n                break;\r\n        }\r\n\r\n        return oStorageEntry.compareProperty(mapInstanceId, oFilter.property, oFilter.term);\r\n    };\r\n\r\n    var passesFilters = function(oStorageEntry, aoFilters) {\r\n        var iIndex;\r\n\r\n        if (aoFilters.length === 0) {\r\n            return true;\r\n        }\r\n\r\n        for (iIndex = 0; iIndex < aoFilters.length; iIndex++) {\r\n            if (!passesFilter(oStorageEntry, aoFilters[iIndex])) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {emp.classLibrary.EmpRenderableObject[]} oCurrentResultSet\r\n     * @param {string[]} oTypes\r\n     * @param oaPropertyFilter\r\n     * @param {number} iMaxResults\r\n     * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry\r\n     * @param {boolean} bRecurse\r\n     */\r\n    var searchEntry = function(oCurrentResultSet, oTypes, oaPropertyFilter, iMaxResults, oStorageEntry, bRecurse) {\r\n        var aParentList,\r\n            i;\r\n\r\n        if (globalTypeMatch(oStorageEntry, oTypes)) {\r\n            if (oaPropertyFilter.length > 0) {\r\n                // if there are property filters check if its passes them.\r\n                if (passesFilters(oStorageEntry, oaPropertyFilter)) {\r\n                    if (!emp.storage.isRoot(oStorageEntry.options.coreId)) {\r\n                        oCurrentResultSet.push(oStorageEntry);\r\n                    }\r\n                }\r\n                if (bRecurse) {\r\n                    // Now we check its children.\r\n                    searchChildrenWithFilter(oCurrentResultSet, oTypes, oaPropertyFilter, iMaxResults, oStorageEntry);\r\n                }\r\n            } else {\r\n\r\n                // verify this storage entry is on a specified map.  We can do this by verifying if a map instance was passed\r\n                // into the search\r\n\r\n                if (mapInstanceId) {\r\n                    aParentList = oStorageEntry.getParentMapInstanceList();\r\n\r\n                    for (i = 0; i < aParentList.length; i += 1) {\r\n                        if (aParentList[i] === mapInstanceId) {\r\n                            oCurrentResultSet.push(oStorageEntry);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                } else {\r\n                    if (!emp.storage.isRoot(oStorageEntry.options.coreId)) {\r\n                        oCurrentResultSet.push(oStorageEntry);\r\n                    }\r\n                }\r\n\r\n                if (bRecurse) {\r\n                    // Now we check its children.\r\n                    searchChildren(oCurrentResultSet, oTypes, iMaxResults, oStorageEntry);\r\n                }\r\n            }\r\n        } else if (bRecurse) {\r\n            // Now we check its children.\r\n            searchChildrenWithFilter(oCurrentResultSet, oTypes, oaPropertyFilter, iMaxResults, oStorageEntry);\r\n        }\r\n    };\r\n\r\n    var globalTypeMatch = function (oStorageEntry, oTypes) {\r\n        var iIndex;\r\n\r\n        if (oStorageEntry.getCoreId() === sRootCoreId) {\r\n            return false;\r\n        }\r\n\r\n        for (iIndex = 0; iIndex < oTypes.length; iIndex++)\r\n        {\r\n            if (oStorageEntry.getCoreObjectType() === oTypes[iIndex]) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    //==================================================================================================================\r\n    // Public Interface\r\n    //==================================================================================================================\r\n    return {\r\n        /**\r\n         * Executes a search based off of the search engine params\r\n         * @memberof emp.storage.searchEngine#\r\n         * @returns {Array}\r\n         */\r\n        execute: function () {\r\n            var sCoreId;\r\n            var oChild;\r\n            var oChildList;\r\n            var iIndex;\r\n            var oStorageEntry;\r\n            var oStorageRoot;\r\n            var bLookingForOverlay = false;\r\n            var bLookingForFeature = false;\r\n            var sOverlayId;\r\n            var sFeatureId;\r\n            var sParentId;\r\n            var sChildId;\r\n\r\n            //@todo : SELECT isn't here yet...\r\n\r\n            var filter = oCriteria.filter || []; //Filter is not required.\r\n            //var select = oCriteria.select;\r\n            var types = (oCriteria.types ? oCriteria.types.concat([]) : []);\r\n            var recurse = ((oCriteria.recursive !== false));\r\n            var iMaxResults = oCriteria.maxResults || undefined;\r\n            var currentResultSet = [];\r\n            var oaPropertyFilter = [];\r\n\r\n            searchedEntries = {};\r\n\r\n            // 1 types is required.\r\n            if ((types === undefined) || (types === null) || (types.length === 0)) {\r\n                return currentResultSet;\r\n            }\r\n\r\n            oCriteria.types = types;\r\n            // Search types and translates to singular.\r\n            for (iIndex = 0; iIndex < types.length; iIndex++) {\r\n                switch (types[iIndex]) {\r\n                    case 'overlays':\r\n                        types[iIndex] = 'overlay';\r\n                        bLookingForOverlay = true;\r\n                        break;\r\n                    case 'features':\r\n                        types[iIndex] = 'feature';\r\n                        bLookingForFeature = true;\r\n                        break;\r\n                    case 'overlay':\r\n                        bLookingForOverlay = true;\r\n                        break;\r\n                    case 'feature':\r\n                        bLookingForFeature = true;\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if ((types.indexOf(emp.typeLibrary.types.FEATURE) >= 0) &&\r\n              (types.indexOf(emp.typeLibrary.types.WMS) === -1)) {\r\n                // If there is a feature in the type but there is no WMS.\r\n                // We add the WMS to the list.\r\n                types.push(emp.typeLibrary.types.WMS);\r\n            }\r\n\r\n            if ((types.indexOf(emp.typeLibrary.types.FEATURE) >= 0) &&\r\n              (types.indexOf(emp.typeLibrary.types.WMTS) === -1)) {\r\n                // If there is a feature in the type but there is no WMTS.\r\n                // We add the WMTS to the list.\r\n                types.push(emp.typeLibrary.types.WMTS);\r\n            }\r\n\r\n            if (filter.length > 0) {\r\n                for (iIndex = 0; iIndex < filter.length; iIndex++) {\r\n                    switch (filter[iIndex].property) {\r\n                        case 'overlayId':\r\n                            sOverlayId = filter[iIndex].term;\r\n                            break;\r\n                        case 'featureId':\r\n                            sFeatureId = filter[iIndex].term;\r\n                            break;\r\n                        case 'parentId':\r\n                            sParentId = filter[iIndex].term;\r\n                            break;\r\n                        case 'childId':\r\n                            sChildId = filter[iIndex].term;\r\n                            break;\r\n                        default:\r\n                            oaPropertyFilter.push(filter[iIndex]);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (bLookingForOverlay && sOverlayId !== undefined) {\r\n                // We are looking for a specific overlay.\r\n                oStorageEntry = emp.storage.findOverlay(sOverlayId);\r\n                if (oStorageEntry) {\r\n                    searchEntry(currentResultSet, types, oaPropertyFilter, iMaxResults, oStorageEntry, recurse);\r\n                }\r\n            } else if (bLookingForOverlay && sParentId !== undefined) {\r\n                // We are looking for overlays under the parentId overlay.\r\n                oStorageEntry = emp.storage.findOverlay(sParentId);\r\n                if (oStorageEntry) {\r\n                    searchedEntries[oStorageEntry.getCoreId()] = oStorageEntry;\r\n                    oChildList = oStorageEntry.getChildrenList();\r\n\r\n                    for (sCoreId in oChildList) {\r\n                        if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                            continue;\r\n                        }\r\n                        oChild = oChildList[sCoreId];\r\n\r\n                        searchEntry(currentResultSet, types, oaPropertyFilter, iMaxResults, oChild, recurse);\r\n                    }\r\n                }\r\n            } else if (bLookingForFeature && sFeatureId !== undefined) {\r\n                // We are looking for a specific feature.\r\n                oStorageEntry = emp.storage.findFeature(sOverlayId, sFeatureId);\r\n                if (oStorageEntry) {\r\n                    searchEntry(currentResultSet, types, oaPropertyFilter, iMaxResults, oStorageEntry, recurse);\r\n                }\r\n            } else if (bLookingForFeature && sParentId !== undefined) {\r\n                // We are looking for features under a specific feature.\r\n                oStorageEntry = emp.storage.findFeature(sOverlayId, sParentId);\r\n                if (oStorageEntry) {\r\n                    searchedEntries[oStorageEntry.getCoreId()] = oStorageEntry;\r\n                    oChildList = oStorageEntry.getChildrenList();\r\n\r\n                    for (sCoreId in oChildList) {\r\n                        if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                            continue;\r\n                        }\r\n                        oChild = oChildList[sCoreId];\r\n\r\n                        searchEntry(currentResultSet, types, oaPropertyFilter, iMaxResults, oChild, recurse);\r\n                    }\r\n                }\r\n            } else if (bLookingForFeature && sOverlayId !== undefined) {\r\n                // We are looking for features under a specific overlay.\r\n                oStorageEntry = emp.storage.findOverlay(sOverlayId);\r\n                if (oStorageEntry) {\r\n                    searchedEntries[oStorageEntry.getCoreId()] = oStorageEntry;\r\n                    oChildList = oStorageEntry.getChildrenList();\r\n\r\n                    for (sCoreId in oChildList) {\r\n                        if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                            continue;\r\n                        }\r\n                        oChild = oChildList[sCoreId];\r\n\r\n                        searchEntry(currentResultSet, types, oaPropertyFilter, iMaxResults, oChild, recurse);\r\n                    }\r\n                }\r\n            } else if (sChildId) {\r\n                var storageObject = emp.storage.get.id({id: sChildId});\r\n                for (sCoreId in storageObject.options.parentObjects) {\r\n                    if (storageObject.options.parentObjects.hasOwnProperty(sCoreId)) {\r\n                        if (!emp.storage.isRoot(sCoreId)) {\r\n                            currentResultSet.push(emp.storage.get.id({id: sCoreId}));\r\n                        }\r\n                    }\r\n                }\r\n            } else if (filter.length > 0) {\r\n                // There is at least 1 property filter.\r\n                // Cycle thru the storage to find objects that match the type and the filter.\r\n                oStorageRoot = emp.storage.findOverlay(sRootCoreId);\r\n                oChildList = oStorageRoot.getChildrenList();\r\n\r\n                for (sCoreId in oChildList) {\r\n                    if (!oChildList.hasOwnProperty(sCoreId)) {\r\n                        continue;\r\n                    }\r\n                    oChild = oChildList[sCoreId];\r\n\r\n                    searchEntry(currentResultSet, types, oaPropertyFilter, iMaxResults, oChild, recurse);\r\n\r\n                    if (iMaxResults !== undefined) {\r\n                        // Check to see if we have a max results and if so\r\n                        // Exit the storage loop if we have reached the max requested.\r\n                        if (currentResultSet.length >= iMaxResults) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                // No filter so we start from the Storage Root.\r\n                // Cycle thru the storage root to find objects that match the type.\r\n                oStorageRoot = emp.storage.findOverlay(sRootCoreId);\r\n                findChildrenNoFilter(currentResultSet, types, iMaxResults, oStorageRoot, recurse);\r\n            }\r\n\r\n            if (types.indexOf(emp.typeLibrary.types.WMS) > -1) {\r\n                // Remove WMS from the type list if it is there.\r\n                types.splice(types.indexOf(emp.typeLibrary.types.WMS), 1);\r\n            }\r\n\r\n            if (types.indexOf(emp.typeLibrary.types.WMTS) > -1) {\r\n                // Remove WMS from the type list if it is there.\r\n                types.splice(types.indexOf(emp.typeLibrary.types.WMTS), 1);\r\n            }\r\n\r\n            return currentResultSet;\r\n        }\r\n    };\r\n};\r\n","/* globals emp */\r\n\r\n/**\r\n * Used to query for various items in the storage engine.\r\n * @public\r\n *\r\n * @param  {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.query = function (oTransaction) {\r\n    var iIndex;\r\n    var oTypes = ((oTransaction.items[0].types instanceof Array)? oTransaction.items[0].types: [emp.typeLibrary.types.FEATURE]);\r\n    var oFilters = oTransaction.items[0].filter || [];\r\n    var oSearchEngine;\r\n    var oResultSet;\r\n    var mapInstanceId = oTransaction.mapInstanceId;\r\n\r\n    oTransaction.items[0].filter = oFilters;\r\n    oTransaction.items[0].types = oTypes;\r\n\r\n    oSearchEngine = new emp.storage.searchEngine(mapInstanceId, oTransaction.items[0]);\r\n    oResultSet = oSearchEngine.execute();\r\n\r\n    oTypes = oTransaction.items[0].types;\r\n\r\n    // Make sure that the type field is an array.\r\n    for (iIndex = 0; iIndex < oTypes.length; iIndex++)\r\n    {\r\n        if (!(oTransaction.items[0][oTypes[iIndex]] instanceof Array))\r\n        {\r\n            oTransaction.items[0][oTypes[iIndex]] = [];\r\n        }\r\n    }\r\n\r\n    for (iIndex = 0; iIndex < oResultSet.length; iIndex++)\r\n    {\r\n        switch (oResultSet[iIndex].getCoreObjectType())\r\n        {\r\n            case emp.typeLibrary.types.FEATURE:\r\n            case emp.typeLibrary.types.OVERLAY:\r\n                oTransaction.items[0][oResultSet[iIndex].getCoreObjectType()].push(oResultSet[iIndex].getObjectData(mapInstanceId, undefined));\r\n                break;\r\n            case emp.typeLibrary.types.WMS:\r\n            case emp.typeLibrary.types.WMTS:\r\n                oTransaction.items[0][emp.typeLibrary.types.FEATURE].push(oResultSet[iIndex].getObjectData(mapInstanceId, undefined));\r\n                break;\r\n        }\r\n    }\r\n\r\n    return oResultSet;\r\n};\r\n\r\n/**\r\n *\r\n * @param oTypes\r\n * @param oFilters\r\n * @private\r\n */\r\nemp.storage._checkForRoot = function(oTypes, oFilters)\r\n{\r\n    var bAddRootStartingPoint = true;\r\n\r\n    // if its not an array just return.\r\n    if ((oFilters === undefined) || (oFilters === null) && !(oFilters instanceof Array))\r\n        return;\r\n\r\n    // Loop thru the filters looking for Id.\r\n    for(var iIndex = 0; iIndex < oFilters.length; iIndex++){\r\n        switch (oFilters[iIndex].property)\r\n        {\r\n            case 'overlayId':\r\n            case 'parentId':\r\n            case 'featureId':\r\n                // We found one.\r\n                // Set the starting point so we don't add a filter.\r\n                bAddRootStartingPoint = false;\r\n                break;\r\n        }\r\n    }\r\n    // If we did not find a starting point add a filter with the root\r\n    // if and only if overlay is one of the types.\r\n    if (bAddRootStartingPoint)\r\n    {\r\n        bAddRootStartingPoint = false;\r\n        for (iIndex = 0; iIndex < oTypes.length; iIndex++)\r\n        {\r\n            if (oTypes[iIndex] === \"overlay\")\r\n            {\r\n                bAddRootStartingPoint = true;\r\n                break;\r\n            }\r\n        }\r\n        if (bAddRootStartingPoint)\r\n        {\r\n            // Add the root parent\r\n            oFilters.push({\r\n                term: undefined,\r\n                property: \"parentId\"\r\n            });\r\n        }\r\n    }\r\n};\r\n","/* globals emp */\r\n\r\n/**\r\n * @namespace\r\n * @memberOf emp.storage\r\n * @type {Object}\r\n */\r\nemp.storage.get = {};\r\n\r\n/**\r\n * Used to get id straight from storage\r\n * @param  {object} args\r\n * @returns {emp.typeLibrary.base}\r\n */\r\nemp.storage.get.id = function (args) {\r\n\r\n    return emp.storage._storage.store[args.id];\r\n};\r\n\r\n/**\r\n * Used to get by id straight from storage\r\n * @param  {object} args\r\n * @return {object}\r\n */\r\nemp.storage.get.byIds = function (args) {\r\n\r\n    var sOverlayId = args.overlayId;\r\n    var sFeatureId = args.featureId;\r\n\r\n    if (sFeatureId !== undefined)\r\n    {\r\n        return emp.storage.findFeature(sOverlayId, sFeatureId);\r\n    }\r\n    else\r\n    {\r\n        return emp.storage.findOverlay(sOverlayId);\r\n    }\r\n};\r\n\r\n/**\r\n * Used to get selection from storage engine\r\n * @param  {emp.typeLibrary.Transaction} oTransaction\r\n * @return {void}\r\n */\r\nemp.storage.get.selected = function (oTransaction) {\r\n    var iIndex;\r\n    var oaSelectionList = emp.storage.selection.getSelectedList(oTransaction.mapInstanceId);\r\n    var returnVar = {\r\n        features: []\r\n    };\r\n    if (oaSelectionList.length > 0) {\r\n        for (iIndex = 0; iIndex < oaSelectionList.length; iIndex++) {\r\n            returnVar.features.push(oaSelectionList[iIndex]);\r\n        }\r\n    }\r\n\r\n    oTransaction.items[0].features = returnVar.features;\r\n};\r\n\r\n/**\r\n * @param {emp.classLibrary.EmpFeature} oFeature\r\n * @param sFeatureId\r\n * @returns {*}\r\n */\r\nemp.storage.findFeatureUnderFeature = function(oFeature, sFeatureId)\r\n{\r\n    var oChild;\r\n\r\n    for(var sCoreId in oFeature.nodes)\r\n    {\r\n        oChild = oFeature.nodes[sCoreId];\r\n        switch (oChild.globalType)\r\n        {\r\n            case emp.typeLibrary.types.FEATURE:\r\n                if (oChild.featureId === sFeatureId)\r\n                {\r\n                    // We found it.\r\n                    return oChild;\r\n                }\r\n                else\r\n                {\r\n                    oChild = emp.storage.findFeatureUnderFeature(oChild, sFeatureId);\r\n                    if (oChild)\r\n                    {\r\n                        // We found it.\r\n                        return oChild;\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    return undefined;\r\n};\r\n\r\n/**\r\n * @param {emp.classLibrary.EmpOverlay} oOverlay\r\n * @param {string} sFeatureId\r\n * @returns {*}\r\n */\r\nemp.storage.findFeatureUnderOverlay = function(oOverlay, sFeatureId)\r\n{\r\n/*\r\n    if (oOverlay.featureList[sFeatureId] !== undefined)\r\n    {\r\n        return oOverlay.featureList[sFeatureId].feature;\r\n    }\r\n    return undefined;\r\n*/\r\n    return emp.storage._storage.store[sFeatureId];\r\n};\r\n\r\n/**\r\n * Retrieves the feature stored in the {@link emp.storage._storage.store} by its coreId\r\n * @param {string} sOverlayId unused\r\n * @param {string} sFeatureId coreId of the feature\r\n * @returns {emp.classLibrary.EmpRenderableObject}\r\n */\r\nemp.storage.findFeature = function(sOverlayId, sFeatureId)\r\n{\r\n/*\r\n    var oOverlay = emp.storage.findOverlay(sOverlayId);\r\n\r\n    if (oOverlay)\r\n    {\r\n        var oFeature = emp.storage.findFeatureUnderOverlay(oOverlay, sFeatureId);\r\n        return oFeature;\r\n    }\r\n*/\r\n    return emp.storage._storage.store[sFeatureId];\r\n};\r\n\r\n/**\r\n * Retrieves the overlay stored in the {@link emp.storage._storage.store} by its coreId\r\n * @param {string} sOverlayId coreId to search for\r\n * @returns {emp.classLibrary.EmpRenderableObject}\r\n */\r\nemp.storage.findOverlay = function(sOverlayId)\r\n{\r\n    return emp.storage._storage.store[sOverlayId];\r\n};\r\n\r\n/**\r\n * Retrieves the object stored in the {@link emp.storage._storage.store} by its coreId\r\n * @param {string} sCoreId coreId to search for\r\n * @returns {emp.classLibrary.EmpRenderableObject}\r\n */\r\nemp.storage.findObject = function(sCoreId)\r\n{\r\n    return emp.storage._storage.store[sCoreId];\r\n};\r\n\r\n/**\r\n * Stores an object in the {@link emp.storage._storage.store}, indexed by its coreId\r\n * @param {emp.classLibrary.EmpRenderableObject} oEmpObject\r\n */\r\nemp.storage.storeObject = function(oEmpObject)\r\n{\r\n    emp.storage._storage.store[oEmpObject.getCoreId()] = oEmpObject;\r\n};\r\n\r\n/**\r\n * Deletes an entry in the {@link emp.storage._storage.store}. You must clean up parent and child references in other\r\n * objects before using this method.\r\n * @param {emp.classLibrary.EmpRenderableObject} oEmpObject\r\n */\r\nemp.storage.deleteObject = function(oEmpObject)\r\n{\r\n    if (emp.storage._storage.store.hasOwnProperty(oEmpObject.getCoreId()))\r\n    {\r\n        delete emp.storage._storage.store[oEmpObject.getCoreId()];\r\n    }\r\n};\r\n\r\n/**\r\n *\r\n * @param sMapInstanceId\r\n * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry\r\n * @returns {*}\r\n */\r\nemp.storage.findParentOnMap = function(sMapInstanceId, oStorageEntry) {\r\n    var oParent;\r\n    var iParentIndex = 0;\r\n    var iParentCnt = oStorageEntry.parentCount();\r\n\r\n    oParent = oStorageEntry.getParentByIndex(iParentIndex);\r\n    while (iParentIndex < iParentCnt) {\r\n        if  (oParent.isOnMap(sMapInstanceId)) {\r\n            return oParent;\r\n        }\r\n        iParentIndex++;\r\n        oParent = oStorageEntry.getParentByIndex(iParentIndex);\r\n    }\r\n\r\n    return undefined;\r\n};\r\n\r\n/**\r\n * @param {string} sMapInstanceId\r\n * @param {emp.classLibrary.EmpRenderableObject} oStorageEntry\r\n * @returns {*}\r\n */\r\nemp.storage.findParentOverlayOnMap = function(sMapInstanceId, oStorageEntry) {\r\n    var oParent;\r\n    var iParentIndex = 0;\r\n    var iParentCnt = oStorageEntry.parentCount();\r\n    var oEntry = oStorageEntry;\r\n\r\n    while (iParentIndex < iParentCnt) {\r\n        oParent = oEntry.getParentByIndex(iParentIndex);\r\n        // Find a parent that is on this map instance.\r\n        if (!oParent.isOnMap(sMapInstanceId)) {\r\n            iParentIndex++;\r\n            continue;\r\n        }\r\n        // Find a parent that is an overlay.\r\n        if (oParent.getCoreObjectType() === emp.typeLibrary.types.OVERLAY) {\r\n            return oParent;\r\n        } else {\r\n            // Its not an overlay.\r\n            // Get its parent and check again.\r\n            oEntry = oParent;\r\n            iParentCnt = oEntry.parentCount();\r\n            iParentIndex = 0;\r\n        }\r\n    }\r\n\r\n    return undefined;\r\n};\r\n","/* globals emp */\r\n/**\r\n * Used to replay storage to the engine after a swap has occurred.\r\n * \r\n * @type {Object}\r\n * @protected\r\n * @property {method} structure Used to generate the right order of objects\r\n * @property {method} fire Start lobbing objects at the engine\r\n * @property {method} start Used to swap target on intent workflows\r\n * @property {method} stop Used to swap target back on replay end\r\n * \r\n */\r\nemp.storage._replay = {};\r\n\r\nemp.storage.MapReload = function(InstanceId) {\r\n    var _struct = [];\r\n    var mapInstanceId = InstanceId;\r\n    var iItemsSent = 0;\r\n    var iItemsCompleted = 0;\r\n    var iMaxItemsPerIteration = 100;\r\n    var hReloadTimer = null;\r\n\r\n    var publicInterface = {\r\n        /**\r\n         * @memberof emp.storage.MapReload#\r\n         */\r\n        startFireTimer: function() {\r\n            var oThis = this;\r\n            \r\n            setTimeout(function(){ oThis.fire();}, 50);\r\n        },\r\n        /**\r\n         * @memberof emp.storage.MapReload#\r\n         */\r\n        structure: function() {\r\n            var oaLevels = [],\r\n                currentCoreId,\r\n                iCurrentLevel = 0;\r\n            var oDupItem;\r\n            var rootCoreId = emp.storage.getRootGuid(mapInstanceId);\r\n            var oRootOverlay = emp.storage.findObject(rootCoreId);\r\n            var oRootFeatureList = oRootOverlay.getChildrenList();\r\n\r\n            oaLevels[iCurrentLevel] = {\r\n                    overlays: [],\r\n                    features: [],\r\n                    wms:[]\r\n            };\r\n            oDupItem = oRootOverlay.getObjectData(mapInstanceId, undefined);\r\n            oDupItem.parentCoreId = undefined;\r\n            oaLevels[iCurrentLevel].overlays.push(oDupItem);\r\n\r\n            iCurrentLevel++;\r\n\r\n            var buildStructure = function (iLevel, oFeatureList) {\r\n                var oStorageEntry;\r\n\r\n                if (!oaLevels[iLevel]) {\r\n                    oaLevels[iLevel] = {\r\n                        overlays: [],\r\n                        features: [],\r\n                        wms:[]\r\n                    };\r\n                }\r\n\r\n                for (currentCoreId in oFeatureList) {\r\n                    if (!oFeatureList.hasOwnProperty(currentCoreId))\r\n                    {\r\n                        continue;\r\n                    }\r\n\r\n                    oStorageEntry = oFeatureList[currentCoreId];\r\n\r\n                    if (!oStorageEntry.isDisabled()) {\r\n                        switch (oStorageEntry.getCoreObjectType()) {\r\n                            case emp.typeLibrary.types.OVERLAY:\r\n                                // Only the top level overlay is sent to the map instance.\r\n                                break;\r\n                            case emp.typeLibrary.types.FEATURE:\r\n                                if (emp.helpers.canMapEnginePlotFeature(mapInstanceId, oStorageEntry))\r\n                                {\r\n                                    // Send it to the map if it can plot it.\r\n                                    oDupItem = oStorageEntry.getObjectData(mapInstanceId, rootCoreId);\r\n                                    oDupItem.parentCoreId = rootCoreId;\r\n                                    oaLevels[iLevel].features.push(oDupItem);\r\n                                }\r\n                                break;\r\n                            case emp.typeLibrary.types.WMS:\r\n                                if (emp.helpers.canMapEnginePlotFeature(mapInstanceId, oStorageEntry))\r\n                                {\r\n                                    // Send it to the map if it can plot it.\r\n                                    var sWMSParentID = rootCoreId;\r\n                                    var oWMSParent = oStorageEntry.getParentByIndex(0);\r\n                                    var sWMSOverlayId = emp.wms.manager.getWmsOverlayId(mapInstanceId);\r\n\r\n                                    if (sWMSOverlayId === oWMSParent.getCoreId()) {\r\n                                        sWMSParentID = sWMSOverlayId;\r\n                                    }\r\n                                    oDupItem = oStorageEntry.getObjectData(mapInstanceId, sWMSParentID);\r\n                                    oDupItem.parentCoreId = rootCoreId;\r\n                                    oaLevels[iLevel].wms.push(oDupItem);\r\n                                }\r\n                                break;\r\n                        }\r\n                        buildStructure(iLevel + 1, oStorageEntry.getChildrenList());\r\n                    }\r\n                }\r\n                \r\n                if ((oaLevels[iLevel].overlays.length === 0)\r\n                        && (oaLevels[iLevel].features.length === 0)\r\n                        &&(oaLevels[iLevel].wms.length === 0)) {\r\n                    oaLevels.splice(iLevel, 1);\r\n                }\r\n            };\r\n\r\n            buildStructure(iCurrentLevel, oRootFeatureList);\r\n            _struct = oaLevels;\r\n        },\r\n        /**\r\n         * @memberof emp.storage.MapReload#\r\n         */\r\n        fire: function () {\r\n            var oTransaction;\r\n            var oFeatures;\r\n            var oItem;\r\n            var data = _struct;\r\n            var itemCount = 0;\r\n            var sPreviousType = \"\";\r\n            var sCurrentType;\r\n            var sTransID = emp.helpers.id.newGUID();\r\n            var rootId = emp.storage.getRootGuid(mapInstanceId);\r\n            var oThis = this;\r\n\r\n            if ((data === undefined) || (data === null) || (data.length === 0))\r\n            {\r\n                if (iItemsSent === iItemsCompleted)\r\n                {\r\n                    clearTimeout(hReloadTimer);\r\n                    this.stop();\r\n                }\r\n                else\r\n                {\r\n                    hReloadTimer = setTimeout(function(){ oThis.fire();}, 100);\r\n                }\r\n                return;\r\n            }\r\n            else\r\n            {\r\n                for (var i = 0; i < data.length;) {\r\n                    var oOverlays = [],\r\n                        wmsServices = [];\r\n                    oFeatures = [];\r\n\r\n                    while (((data[i].overlays.length > 0) ||\r\n                            (data[i].features.length > 0) ||\r\n                            (data[i].wms.length > 0)) &&\r\n                            (itemCount < iMaxItemsPerIteration)) {\r\n                        if (data[i].overlays.length > 0) {\r\n                            oItem = data[i].overlays[0];\r\n                            sCurrentType = emp.typeLibrary.types.OVERLAY;\r\n                        } else if (data[i].features.length > 0) {\r\n                            oItem = data[i].features[0];\r\n                            sCurrentType = emp.typeLibrary.types.FEATURE;\r\n                        } else {\r\n                            oItem = data[i].wms[0];\r\n                            sCurrentType = emp.typeLibrary.types.WMS;\r\n                        }\r\n\r\n                        if ((sPreviousType !== \"\") &&\r\n                                (sPreviousType !== sCurrentType))\r\n                        {\r\n                            // If the previous one we sent is not of the same type\r\n                            // stop and wait for the completion.\r\n                            // we can only have 1 transaction outstanding.\r\n                            break;\r\n                        }\r\n\r\n                        sPreviousType = sCurrentType;\r\n                        itemCount++;\r\n\r\n                        switch (sCurrentType) {\r\n                            case  emp.typeLibrary.types.FEATURE:\r\n                                oItem.zoom = false;\r\n                                oFeatures.push(oItem);\r\n                                oItem.parentCoreId = rootId;\r\n                                data[i].features.splice(0, 1); // Remove the first value\r\n                                break;\r\n                            case emp.typeLibrary.types.OVERLAY:\r\n                                oOverlays.push(oItem);\r\n                                data[i].overlays.splice(0, 1); // Remove the first value\r\n                                break;\r\n                            case emp.typeLibrary.types.WMS:\r\n                                wmsServices.push(oItem);\r\n                                data[i].wms.splice(0, 1); // Remove the first value\r\n                                break;\r\n                        }\r\n                    }\r\n\r\n                    if (oOverlays.length > 0) {\r\n                        oTransaction = new emp.typeLibrary.Transaction({\r\n                            intent: emp.intents.control.MI_OVERLAY_ADD,\r\n                            mapInstanceId: mapInstanceId,\r\n                            source: emp.core.sources.STORAGE,\r\n                            transactionId: sTransID,\r\n                            items: oOverlays\r\n                        });\r\n                        iItemsSent += oOverlays.length;\r\n                        //console.log(\"SE reload Overlays \" + itemCount + \" fire Sent:\" + emp.storage._replay.iItemsSent + \". Completed:\" + emp.storage._replay.iItemsCompleted);\r\n                        oTransaction.run();\r\n                    }\r\n\r\n                    if (oFeatures.length > 0)\r\n                    {\r\n                        oTransaction  = new emp.typeLibrary.Transaction({\r\n                            intent: emp.intents.control.MI_FEATURE_ADD,\r\n                            mapInstanceId: mapInstanceId,\r\n                            source: emp.core.sources.STORAGE,\r\n                            transactionId: sTransID,\r\n                            items: oFeatures\r\n                        });\r\n                        iItemsSent += oFeatures.length;\r\n                        //console.log(\"SE reload Feature \" + itemCount + \" fire Sent:\" + emp.storage._replay.iItemsSent + \". Completed:\" + emp.storage._replay.iItemsCompleted);\r\n                        oTransaction.run();\r\n                    }\r\n\r\n                    if (wmsServices.length > 0)\r\n                    {\r\n                        oTransaction  = new emp.typeLibrary.Transaction({\r\n                            intent: emp.intents.control.MI_WMS_ADD,\r\n                            mapInstanceId: mapInstanceId,\r\n                            source: emp.core.sources.STORAGE,\r\n                            transactionId: sTransID,\r\n                            items: wmsServices\r\n                        });\r\n                        iItemsSent += wmsServices.length;\r\n                        //console.log(\"SE reload WMS \" + itemCount + \" fire Sent:\" + emp.storage._replay.iItemsSent + \". Completed:\" + emp.storage._replay.iItemsCompleted);\r\n                        oTransaction.run();\r\n                    }\r\n\r\n                    if ((data[i].overlays.length === 0) &&\r\n                            (data[i].features.length === 0) &&\r\n                            (data[i].wms.length === 0))\r\n                    {\r\n                        //console.log(\"Drop a level\");\r\n                        data.splice(i, 1); //Remove the index.\r\n                        if (itemCount === 0)\r\n                        {\r\n                            if ((iItemsSent === iItemsCompleted) && (i >= data.length))\r\n                            {\r\n                                clearTimeout(hReloadTimer);\r\n                                this.stop();\r\n                            }\r\n                            continue;\r\n                        }\r\n                    }\r\n                    break; // exit and wait for transaction completes.\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * @memberof emp.storage.MapReload#\r\n         */\r\n        start: function () {\r\n            // Reset the transaction count.\r\n            iItemsCompleted = 0;\r\n            iItemsSent = 0;\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.MI_OVERLAY_ADD,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: emp.storage.processTransactionComplete\r\n            });\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.MI_FEATURE_ADD,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: emp.storage.processTransactionComplete\r\n            });\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.MI_WMS_ADD,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: emp.storage.processTransactionComplete\r\n            });\r\n        },\r\n        /**\r\n         * @memberof emp.storage.MapReload#\r\n         */\r\n        stop: function () {\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.MI_OVERLAY_ADD,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: emp.storage.processTransactionComplete\r\n            });\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.MI_FEATURE_ADD,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: emp.storage.processTransactionComplete\r\n            });\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.MI_WMS_ADD,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: emp.storage.processTransactionComplete\r\n            });\r\n\r\n            var oTransaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.STORAGE_RELOAD_COMPLETE,\r\n                mapInstanceId: mapInstanceId,\r\n                source: emp.core.sources.STORAGE,\r\n                items: []\r\n            });\r\n            oTransaction.run();\r\n            \r\n            delete emp.storage._replay[mapInstanceId];\r\n        },\r\n        /**\r\n         * @memberof emp.storage.MapReload#\r\n         */\r\n        processTransactionComplete: function (oTransaction) {\r\n            var oErrorInfo;\r\n            var oStorageEntry;\r\n            var oThis = this;\r\n\r\n            switch (oTransaction.intent) {\r\n                case emp.intents.control.MI_FEATURE_ADD:\r\n                case emp.intents.control.MI_OVERLAY_ADD:\r\n                case emp.intents.control.MI_WMS_ADD:\r\n                    clearTimeout(hReloadTimer);\r\n                    if ((oTransaction.failures !== undefined) &&\r\n                            (oTransaction.failures !== null) &&\r\n                            (oTransaction.failures.length > 0))\r\n                    {\r\n                        while (oTransaction.failures.length > 0)\r\n                        {\r\n                            // if the map returns a failure (which should be in our array)\r\n                            // we take that failure and put it back in the list and mark it as\r\n                            // disabled.\r\n                            oErrorInfo = oTransaction.failures.splice(0,1)[0];\r\n                            if (oErrorInfo.coreId) {\r\n                                oStorageEntry = emp.storage.get.id({id: oErrorInfo.coreId});\r\n                                oStorageEntry.setDisabled(true);\r\n                                iItemsCompleted++;\r\n                            }\r\n                        }\r\n                    }\r\n                    iItemsCompleted += (oTransaction.items.length);\r\n                    //console.log(\"SE TC Sent:\" + emp.storage._replay.iItemsSent + \". Completed:\" + emp.storage._replay.iItemsCompleted);\r\n\r\n                    if (iItemsSent === iItemsCompleted)\r\n                    {\r\n                        hReloadTimer = setTimeout(function(){oThis.fire();}, 100);\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    \r\n    return publicInterface;\r\n};\r\n\r\n\r\n/**\r\n * Used to catch all transaction completes during\r\n * reload.\r\n * @param  {emp.typeLibrary.Transaction} oTransaction\r\n */\r\nemp.storage.processTransactionComplete = function (oTransaction) {\r\n    if (emp.storage._replay.hasOwnProperty(oTransaction.mapInstanceId))\r\n    {\r\n        emp.storage._replay[oTransaction.mapInstanceId].processTransactionComplete(oTransaction);\r\n    }\r\n};\r\n\r\n/**\r\n * Main entry for replay\r\n * @public\r\n */\r\nemp.storage.reload = function (instanceId) {\r\n    if (!emp.storage._replay.hasOwnProperty(instanceId))\r\n    {\r\n        emp.storage._replay[instanceId] = new emp.storage.MapReload(instanceId);\r\n    }\r\n\r\n    emp.storage._replay[instanceId].start();\r\n    emp.storage._replay[instanceId].structure();\r\n    emp.storage._replay[instanceId].startFireTimer();\r\n};\r\n\r\nemp.storage._dropStaticContent = function(oStorageEntry) {\r\n    var oChildEntry;\r\n    var iIndex;\r\n    var aChildCoreIdList = oStorageEntry.getChildrenCoreIds();\r\n    \r\n    for (iIndex = 0; iIndex < aChildCoreIdList.length; iIndex++)\r\n    {\r\n        oChildEntry = emp.storage.findObject(aChildCoreIdList[iIndex]);\r\n\r\n        if (oChildEntry)\r\n        {\r\n            emp.storage._dropStaticContent(oChildEntry);\r\n\r\n            if (oChildEntry.getCoreObjectType() === emp.typeLibrary.types.STATIC)\r\n            {\r\n                //Take it off its parents child list.\r\n                oChildEntry.removeFromAllParent();\r\n                // Now delete the item\r\n                emp.storage.deleteObject(oChildEntry);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nemp.storage.prepForMapSwap = function(instanceId) {\r\n\r\n    var oStore = emp.storage._storage.store;\r\n    var oStorageEntry = oStore[emp.storage.getRootGuid(instanceId)];\r\n\r\n    emp.storage._dropStaticContent(oStorageEntry);\r\n};\r\n","emp.editors = {} || emp.editors;\r\n\r\n/**\r\n * Controls the vertices on the map during an edit or draw and the animation\r\n * of those graphics.\r\n *\r\n * @param {Object} args All parmaters are members of the args object.\r\n * @param {string} args.feature The featureId of the item we are editing.\r\n * @param {string} args.mapInstanceId The id of the mapInstance to which the\r\n * editing is occurring.\r\n */\r\nemp.editors.EditorBase = function(args) {\r\n\r\n  this.controlPoints = [];\r\n\r\n  // make a copy of feature as we do not want to change the feature passed in.\r\n  this.featureCopy = emp.helpers.copyObject(args.feature);\r\n\r\n  // Retrieve the mapInstance used for this feature.\r\n  this.mapInstance = args.mapInstance;\r\n\r\n};\r\n\r\n\r\n/**\r\n * Adds the control points to the map for an edit or a draw.\r\n */\r\nemp.editors.EditorBase.prototype.addControlPoints = function() {\r\n  var i,\r\n    controlPoint,\r\n    transaction,\r\n    length,\r\n    coordinates,\r\n    controlPointFeatureId;\r\n\r\n  // normalize the geojson coordinates so we only have\r\n  // to write one for loop.\r\n  if (this.featureCopy.data.type === 'LineString') {\r\n    length = this.featureCopy.data.coordinates.length;\r\n    coordinates = this.featureCopy.data.coordinates;\r\n  } else if (this.featureCopy.data.type === 'Polygon') {\r\n    length = this.featureCopy.data.coordinates[0].length;\r\n    coordinates = this.featureCopy.data.coordinates[0];\r\n  } else if (this.featureCopy.data.type === 'Point') {\r\n    length = 1;\r\n    coordinates = [this.featureCopy.data.coordinates];\r\n  }\r\n\r\n  // default implementation: add a control point at every vertex.\r\n  for (i = 0; i < length; i++) {\r\n\r\n    controlPointFeatureId = emp3.api.createGUID();\r\n    // create a feature for each of these coordinates.\r\n    controlPoint = new emp.typeLibrary.Feature({\r\n        overlayId: \"vertices\",\r\n        featureId: controlPointFeatureId,\r\n        format: emp3.api.enums.FeatureTypeEnum.GEO_POINT,\r\n        data: {\r\n          coordinates: coordinates[i],\r\n          type: 'Point'\r\n        }\r\n    });\r\n\r\n    this.controlPoints[controlPointFeatureId] = controlPoint;\r\n  }\r\n\r\n  transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_ADD,\r\n      mapInstanceId: this.mapInstance.mapInstanceId,\r\n      transactionId: null,\r\n      sender: this.mapInstance.mapInstanceId,\r\n      originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n      source: emp.api.cmapi.SOURCE,\r\n      messageOriginator: this.mapInstance.mapInstanceId,\r\n      originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n      items: this.controlPoints\r\n  });\r\n\r\n  transaction.run();\r\n\r\n};\r\n\r\n\r\nemp.editors.EditorBase.prototype.removeControlPoints = function() {\r\n  var transaction;\r\n\r\n  transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,\r\n      mapInstanceId: this.mapInstance.mapInstanceId,\r\n      transactionId: null,\r\n      sender: this.mapInstance.mapInstanceId,\r\n      originChannel: cmapi.channel.names.MAP_FEATURE_UNPLOT,\r\n      source: emp.api.cmapi.SOURCE,\r\n      messageOriginator: this.mapInstance.mapInstanceId,\r\n      originalMessageType: cmapi.channel.names.MAP_FEATURE_UNPLOT,\r\n      items: this.controlPoints\r\n  });\r\n\r\n  transaction.run();\r\n\r\n  this.controlPoints = [];\r\n\r\n};\r\n\r\n/**\r\n * Determine if the featureId is a controlPoint or if it is a feature.\r\n * This is useful for determining if a featureDrag event should be staticContent\r\n * out or not.\r\n */\r\nemp.editors.EditorBase.prototype.isControlPoint = function(featureId) {\r\n  var result = false;\r\n\r\n  if (this.controlPoints[featureId]) {\r\n    result = true;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * Return true if the featureId passed in is the feature that is\r\n * being edited.\r\n */\r\nemp.editors.EditorBase.prototype.isFeature = function(featureId) {\r\n  var result = false;\r\n\r\n  if (this.featureCopy.featureId === featureId) {\r\n    result = true;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * Moves control point passed in to the new location provided.\r\n * Also updates the control point and the feature with the change.\r\n */\r\nemp.editors.EditorBase.prototype.moveControlPoint = function(featureId, x, y, pointer) {\r\n\r\n  var controlPoint,\r\n    transaction;\r\n\r\n  controlPoint = this.controlPoints[featureId];\r\n  controlPoint.data.coordinates = [pointer.lon, pointer.lat];\r\n\r\n  transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_ADD,\r\n      mapInstanceId: this.mapInstance.mapInstanceId,\r\n      transactionId: null,\r\n      sender: this.mapInstance.mapInstanceId,\r\n      originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n      source: emp.api.cmapi.SOURCE,\r\n      messageOriginator: this.mapInstance.mapInstanceId,\r\n      originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n      items: [controlPoint]\r\n  });\r\n\r\n  transaction.run();\r\n\r\n};\r\n\r\n/**\r\n * Moves the entire feature, offsetting from the starting position.\r\n */\r\nemp.editors.EditorBase.prototype.moveFeature = function(startX, startY, pointer) {\r\n  var transaction,\r\n    item;\r\n\r\n  // Get the original feature, change it's coordinates.\r\n  //var deltaX,\r\n  //  deltaY;\r\n\r\n  //deltaX = pointer.clientX - startX;\r\n  //deltaY = pointer.clientY - startY;\r\n\r\n  if (this.featureCopy.data.type === 'Point') {\r\n    this.featureCopy.data.coordinates = [pointer.lon, pointer.lat];\r\n\r\n    item = new emp.typeLibrary.Feature({\r\n        overlayId: this.featureCopy.overlayId,\r\n        featureId: this.featureCopy.featureId,\r\n        format: this.featureCopy.format,\r\n        data: this.featureCopy.data,\r\n        properties: this.featureCopy.properties\r\n    });\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        mapInstanceId: this.mapInstance.mapInstanceId,\r\n        transactionId: null,\r\n        sender: this.mapInstance.mapInstanceId,\r\n        originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        source: emp.api.cmapi.SOURCE,\r\n        messageOriginator: this.mapInstance.mapInstanceId,\r\n        originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        items: [item]\r\n    });\r\n\r\n    transaction.run();\r\n  } //else if (featureCopy.data.type === 'LineString') {\r\n\r\n  //} else if (featureCopy.data.type === 'Polygon') {\r\n\r\n//  }\r\n\r\n};\r\n","emp.editors.Point = function(args) {\r\n\r\n  emp.editors.EditorBase.call(this, args);\r\n};\r\n\r\nemp.editors.Point.prototype = Object.create(emp.editors.EditorBase.prototype);\r\nemp.editors.Point.prototype.constructor = emp.editors.Point;\r\n\r\n/**\r\n * Adds the control points to the map for an edit or a draw.\r\n */\r\nemp.editors.Point.prototype.addControlPoints = function() {\r\n  // do nothing.\r\n};\r\n\r\nemp.editors.Point.prototype.removeControlPoints = function() {\r\n  // do nothing\r\n};\r\n\r\n/**\r\n * Determine if the featureId is a controlPoint or if it is a feature.\r\n * This is useful for determining if a featureDrag event should be staticContent\r\n * out or not.\r\n */\r\nemp.editors.Point.prototype.isControlPoint = function() {\r\n  // there is no control points, never return true.\r\n  return false;\r\n};\r\n\r\n/**\r\n * Moves control point passed in to the new location provided.\r\n * Also updates the control point and the feature with the change.\r\n */\r\nemp.editors.Point.prototype.moveControlPoint = function() {\r\n\r\n  // do nothing, there are no control points.\r\n},\r\n\r\n/**\r\n * Moves the entire feature, offsetting from the starting position.\r\n */\r\nemp.editors.Point.prototype.moveFeature = function(startX, startY, pointer) {\r\n  var transaction,\r\n    item,\r\n    updateData = {},\r\n    coordinateUpdate,\r\n    oldCoordinates,\r\n    newCoordinates,\r\n    altitude;\r\n\r\n  // We need to notify the caller of the changes we are making.  These\r\n  // changes will be sent as an update.\r\n\r\n  // we need to see if we need to preserve the altitude of the feature.\r\n  oldCoordinates = this.featureCopy.data.coordinates;\r\n\r\n  if (oldCoordinates.length > 2) {\r\n    altitude = oldCoordinates[2];\r\n    this.featureCopy.data.coordinates = [pointer.lon, pointer.lat, altitude];\r\n    newCoordinates = [{\r\n      lat: pointer.lat,\r\n      lon: pointer.lon,\r\n      alt: altitude\r\n    }];\r\n  } else {\r\n    this.featureCopy.data.coordinates = [pointer.lon, pointer.lat];\r\n    newCoordinates = [{\r\n      lat: pointer.lat,\r\n      lon: pointer.lon\r\n    }];\r\n  }\r\n\r\n  // Update the feature, only internally -- we don't want events sent out\r\n  // from this.\r\n  item = new emp.typeLibrary.Feature({\r\n      overlayId: this.featureCopy.overlayId,\r\n      featureId: this.featureCopy.featureId,\r\n      format: this.featureCopy.format,\r\n      data: this.featureCopy.data,\r\n      properties: this.featureCopy.properties\r\n  });\r\n\r\n  transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_ADD,\r\n      mapInstanceId: this.mapInstance.mapInstanceId,\r\n      transactionId: null,\r\n      sender: this.mapInstance.mapInstanceId,\r\n      originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n      source: emp.api.cmapi.SOURCE,\r\n      messageOriginator: this.mapInstance.mapInstanceId,\r\n      originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n      items: [item]\r\n  });\r\n\r\n  transaction.run();\r\n\r\n  // Create the return object.  This will tell you which index was changed,\r\n  // the locations of the new indeces, and the type of change it was.\r\n  coordinateUpdate = {\r\n      type: emp.typeLibrary.CoordinateUpdateType.UPDATE,\r\n      indices: [0],\r\n      coordinates: newCoordinates\r\n  };\r\n\r\n  updateData.coordinateUpdate = coordinateUpdate;\r\n  updateData.properties = this.featureCopy.properties;\r\n\r\n  return updateData;\r\n};\r\n","/*global emp, Ozone, cmapi, window */\r\nvar OWF = OWF || {};\r\n\r\nemp.environment.owf = (function () {\r\n  var template = emp.createEnvironmentTemplate(),\r\n\r\n    /**\r\n     * Widget State\r\n     * @method\r\n     * @memberOf emp.environment.owf\r\n     * @type {String}\r\n     * @private\r\n     */\r\n    widgetState = null,\r\n    /**\r\n     * Widget Eventing Controller Container\r\n     * @method\r\n     * @memberOf emp.environment.owf\r\n     * @type {object}\r\n     * @private\r\n     */\r\n    widgetEventingController = null,\r\n    // function that will be invoked once the OWF environment is done initializing following the .init() invocation\r\n    initCallback,\r\n    shutdownCallback,\r\n    subscribedCallbacks = {},\r\n    owfLoadAttempted = false,\r\n    // Track if this instance of map was launched by a widget to be used privately\r\n    isPrivateInstance = false,\r\n    // If this is a private map we need to track the ownerId as the senderId provided in the launchData\r\n    // and only listen to and send to this widget\r\n    ownerId;\r\n\r\n  function loadScript(args) {\r\n\r\n    // The above code is simple but does not generate an error\r\n    // if the request generates the \"Blocked loading mixed active content \" error.\r\n    var script = document.createElement(\"script\");\r\n    script.type = \"text/javascript\";\r\n\r\n    if (script.readyState) { //IE\r\n      script.onreadystatechange = function () {\r\n        script.intervalCount = 50;\r\n        script.timer = setInterval(function () {\r\n          if (script.readyState === 'loaded' || script.readyState === 'complete') {\r\n            // IE does not report error.\r\n            // So if the object does not exists we wait\r\n            // for a few cycles before failing.\r\n            if (window[args.objectToLoad] === undefined) {\r\n              script.intervalCount--;\r\n              if (script.intervalCount === 0) {\r\n                clearInterval(script.timer);\r\n                args.failedcallback();\r\n              }\r\n            } else {\r\n              clearInterval(script.timer);\r\n              args.callback();\r\n            }\r\n          } else {\r\n            script.intervalCount--;\r\n            if (script.intervalCount === 0) {\r\n              clearInterval(script.timer);\r\n              args.failedcallback();\r\n            }\r\n          }\r\n\r\n        }, 100);\r\n        script.onreadystatechange = null;\r\n      };\r\n    } else { //Others\r\n      script.onerror = function () {\r\n        args.failedcallback();\r\n      };\r\n      script.onload = function () {\r\n        // We need to make sure the object is there.\r\n        // The server may have sent an html page with\r\n        // error text on it.\r\n        if (window[args.objectToLoad] === undefined) {\r\n          args.failedcallback();\r\n        } else {\r\n          args.callback();\r\n        }\r\n      };\r\n    }\r\n    script.src = args.url;\r\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n  }\r\n\r\n  function checkSender(sender) {\r\n    if (typeof sender === \"string\") {\r\n      try {\r\n        sender = JSON.parse(sender);\r\n      } catch (err) {\r\n        sender = {\r\n          id: emp.helpers.id.newGUID()\r\n        };\r\n        emp.typeLibrary.Error({\r\n          message: \"Sender was a string for the OWF widget intent, but it was not valid JSON. A default sender object with a random ID was generated.\"\r\n        });\r\n      }\r\n    }\r\n    return sender;\r\n  }\r\n\r\n  /**\r\n   * Register OWF Widget Intents\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   * @protected\r\n   * @return {void}\r\n   */\r\n\r\n  function plotIntentKml(sender, intent, data) {\r\n    var payload = {},\r\n      oItem,\r\n      cmap,\r\n      transaction;\r\n\r\n    sender = checkSender(sender);\r\n    // check for common_map metadata\r\n    if (data.hasOwnProperty(\"common_map\")) {\r\n      cmap = data.common_map;\r\n      if (cmap.hasOwnProperty(\"overlayId\")) {\r\n        payload.overlayId = cmap.overlayId;\r\n      } else {\r\n        payload.overlayId = sender.id;\r\n      }\r\n      if (cmap.hasOwnProperty(\"featureId\")) {\r\n        payload.featureId = cmap.featureId;\r\n      } else {\r\n        payload.featureId = emp.helpers.id.newGUID();\r\n      }\r\n      if (cmap.hasOwnProperty(\"name\")) {\r\n        payload.name = cmap.name;\r\n      }\r\n      if (cmap.hasOwnProperty(\"zoom\")) {\r\n        payload.zoom = cmap.zoom;\r\n      }\r\n      payload.feature = data.data;\r\n      payload.format = \"kml\";\r\n      oItem = new emp.typeLibrary.Feature(payload);\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        transactionId: \"\",\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: payload,\r\n        messageOriginator: sender.id,\r\n        originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        items: [oItem]\r\n      });\r\n      transaction.queue();\r\n    }\r\n  }\r\n\r\n\r\n  function loadIntentKml(sender, intent, data) {\r\n    var payload = {},\r\n      item,\r\n      cmap,\r\n      transaction,\r\n      i,\r\n      len,\r\n      items = [];\r\n\r\n    sender = checkSender(sender);\r\n    // check for common_map metadata\r\n    len = data.data.length;\r\n    for (i = 0; i < len; i++) {\r\n      payload.url = data.data[i];\r\n      payload.format = \"kml\";\r\n      payload.visible = true;\r\n      payload.save = false;\r\n      payload.params = {};\r\n      payload.transactionId = emp.helpers.id.newGUID();\r\n      if (data.hasOwnProperty(\"common_map\")) {\r\n        cmap = data.common_map;\r\n      } else {\r\n        cmap = {};\r\n      }\r\n      if (cmap.hasOwnProperty(\"overlayId\")) {\r\n        payload.overlayId = cmap.overlayId;\r\n      } else {\r\n        payload.overlayId = sender.id;\r\n      }\r\n      if (cmap.hasOwnProperty(\"featureId\")) {\r\n        payload.featureId = cmap.featureId;\r\n      } else {\r\n        payload.featureId = emp.helpers.id.newGUID();\r\n      }\r\n      if (cmap.hasOwnProperty(\"name\")) {\r\n        payload.name = cmap.name;\r\n      } else {\r\n        payload.name = \"Untitled\";\r\n      }\r\n      if (cmap.hasOwnProperty(\"zoom\")) {\r\n        payload.zoom = cmap.zoom;\r\n      }\r\n\r\n      item = new emp.typeLibrary.Feature(payload);\r\n      items.push(item);\r\n    }\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_ADD,\r\n      transactionId: payload.transactionId,\r\n      sender: sender.id,\r\n      originChannel: cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n      source: emp.api.cmapi.SOURCE,\r\n      originalMessage: payload,\r\n      messageOriginator: sender.id,\r\n      originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n      items: items\r\n    });\r\n    transaction.queue();\r\n  }\r\n\r\n  function plotIntentJson(sender, intent, data) {\r\n    var payload = {},\r\n      oItem,\r\n      cmap,\r\n      transaction;\r\n\r\n    sender = checkSender(sender);\r\n    // check for common_map metadata\r\n    if (data.hasOwnProperty(\"common_map\")) {\r\n      cmap = data.common_map;\r\n      if (cmap.hasOwnProperty(\"overlayId\")) {\r\n        payload.overlayId = cmap.overlayId;\r\n      } else {\r\n        payload.overlayId = sender.id;\r\n      }\r\n      if (cmap.hasOwnProperty(\"featureId\")) {\r\n        payload.featureId = cmap.featureId;\r\n      } else {\r\n        payload.featureId = emp.helpers.id.newGUID();\r\n      }\r\n      if (cmap.hasOwnProperty(\"name\")) {\r\n        payload.name = cmap.name;\r\n      } else {\r\n        payload.name = \"Untitled\";\r\n      }\r\n      if (cmap.hasOwnProperty(\"zoom\")) {\r\n        payload.zoom = cmap.zoom;\r\n      }\r\n      payload.feature = data.data;\r\n      payload.format = \"geojson\";\r\n      oItem = new emp.typeLibrary.Feature(payload);\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        transactionId: \"\",\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: payload,\r\n        messageOriginator: sender.id,\r\n        originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        items: [oItem]\r\n      });\r\n      transaction.queue();\r\n    }\r\n  }\r\n\r\n  function loadIntentJson(sender, intent, data) {\r\n    var payload = {},\r\n      item,\r\n      cmap,\r\n      transaction,\r\n      i,\r\n      len;\r\n\r\n    function getJsonSuccess(data) {\r\n\r\n      payload.feature = data;\r\n      payload.format = \"geojson\";\r\n      item = new emp.typeLibrary.Feature(payload);\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FEATURE_ADD,\r\n        transactionId: emp.helpers.emp.helpers.id.newGUID(),\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: payload,\r\n        messageOriginator: sender.id,\r\n        originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        items: [item]\r\n      });\r\n      transaction.queue();\r\n    }\r\n\r\n\r\n    function getJsonFailure() {\r\n      emp.typeLibrary.Error({\r\n        message: \"error loading GeoJSON from URL with uri-list/geo+json\"\r\n      });\r\n    }\r\n\r\n    sender = checkSender(sender);\r\n    // check for common_map metadata\r\n    if (data.hasOwnProperty(\"common_map\")) {\r\n      cmap = data.common_map;\r\n      if (cmap.hasOwnProperty(\"overlayId\")) {\r\n        payload.overlayId = cmap.overlayId;\r\n      } else {\r\n        payload.overlayId = sender.id;\r\n      }\r\n      if (cmap.hasOwnProperty(\"featureId\")) {\r\n        payload.featureId = cmap.featureId;\r\n      } else {\r\n        payload.featureId = emp.helpers.id.newGUID();\r\n      }\r\n      if (cmap.hasOwnProperty(\"name\")) {\r\n        payload.name = cmap.name;\r\n      } else {\r\n        payload.name = \"Untitled\";\r\n      }\r\n      if (cmap.hasOwnProperty(\"zoom\")) {\r\n        payload.zoom = cmap.zoom;\r\n      }\r\n      len = data.data.length;\r\n      // check for common_map metadata\r\n\r\n      for (i = 0; i < len; i++) {\r\n        $.getJSON(data.data[i], getJsonSuccess).fail(getJsonFailure);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  // Handle the intent request for map bounds and send a map.status.view event with current map bounds\r\n  function populateBounds(sender, intent, data) { // eslint-disable-line no-unused-vars\r\n\r\n    var payload = new emp.typeLibrary.View({\r\n      sender: sender.id\r\n    });\r\n\r\n    var transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.VIEW_GET,\r\n      sendTransactionComplete: false,\r\n      sender: sender.id,\r\n      messageOriginator: sender.id,\r\n      originalMessageType: cmapi.channel.names.MAP_STATUS_REQUEST,\r\n      items: [payload]\r\n    });\r\n\r\n    transaction.queue();\r\n  }\r\n\r\n\r\n  /*\r\n   function loadIntentJson(sender, intent, data) {\r\n   var payload = {},\r\n   item,\r\n   cmap,\r\n   transaction,\r\n   i,\r\n   len,\r\n   payloadItem,\r\n   items = [];\r\n   // check for common_map metadata\r\n   len = data.data.length;\r\n   // check for common_map metadata\r\n   for (i = 0; i < len; i++) {\r\n   payload.url = data.data[i];\r\n   payload.format = \"geojson\";\r\n   payload.visible = true;\r\n   if (data.hasOwnProperty(\"common_map\")) {\r\n   cmap = data.common_map;\r\n   } else {\r\n   cmap = {};\r\n   }\r\n   if (cmap.hasOwnProperty(\"overlayId\")) {\r\n   payload.overlayId = cmap.overlayId;\r\n   }\r\n   if (cmap.hasOwnProperty(\"featureId\")) {\r\n   payload.featureId = cmap.featureId;\r\n   } else {\r\n   payload.featureId = emp.helpers.id.newGUID();\r\n   }\r\n   if (cmap.hasOwnProperty(\"name\")) {\r\n   payload.name = cmap.name;\r\n   } else {\r\n   payload.name = \"Untitled\";\r\n   }\r\n   if (cmap.hasOwnProperty(\"zoom\")) {\r\n   payload.zoom = cmap.zoom;\r\n   }\r\n\r\n   item = new emp.typeLibrary.Feature(payload);\r\n   items.push(item);\r\n   }\r\n   );\r\n   */\r\n\r\n  function registerWidgetIntents() {\r\n    if (OWF.Intents) {\r\n      // This is a custom intent to support the RedDisk / DCGS-A custom dashboards\r\n      OWF.Intents.receive({\r\n          action: 'SwitchWorkspaceView',\r\n          dataType: 'GEOINT'\r\n        },\r\n        function () {\r\n          widgetState = new Ozone.state.WidgetState();\r\n          widgetState.activateWidget();\r\n        }\r\n      );\r\n      // CMAPI 1.2 Widget Intents Extension\r\n      OWF.Intents.receive({\r\n          action: 'pick',\r\n          dataType: 'application/vnd.owf.common-map-1.0'\r\n        },\r\n        function () {\r\n          //Do nothing as per CMAPI spec\r\n          return;\r\n        }\r\n      );\r\n\r\n      OWF.Intents.receive({\r\n          action: 'pick',\r\n          dataType: 'application/vnd.owf.common-map-1.1'\r\n        },\r\n        function () {\r\n          //Do nothing as per CMAPI spec\r\n          return;\r\n        }\r\n      );\r\n\r\n      OWF.Intents.receive({\r\n          action: 'pick',\r\n          dataType: 'application/vnd.owf.common-map-1.2'\r\n        },\r\n        function () {\r\n          //Do nothing as per CMAPI spec\r\n          return;\r\n        }\r\n      );\r\n\r\n      // Custom Intent from JC2-CUI / GCCS-J\r\n      OWF.Intents.receive({\r\n          action: 'pick',\r\n          dataType: 'application/json+common-map-bounds'\r\n        },\r\n        function (sender, intent, data) {\r\n          populateBounds(sender, intent, data);\r\n        }\r\n      );\r\n\r\n      OWF.Intents.receive({\r\n          action: 'plot',\r\n          dataType: 'application/vnd.google-earth.kml+xml'\r\n        },\r\n        function (sender, intent, data) {\r\n          plotIntentKml(sender, intent, data);\r\n        });\r\n\r\n      OWF.Intents.receive({\r\n          action: 'plot',\r\n          dataType: 'application/geo+json'\r\n        },\r\n        function (sender, intent, data) {\r\n          plotIntentJson(sender, intent, data);\r\n        });\r\n      OWF.Intents.receive({\r\n          action: 'plot',\r\n          dataType: 'uri-list/geo+json'\r\n        },\r\n        function (sender, intent, data) {\r\n          loadIntentJson(sender, intent, data);\r\n        });\r\n\r\n      OWF.Intents.receive({\r\n          action: 'view',\r\n          dataType: 'application/vnd.google-earth.kml+xml'\r\n        },\r\n        function (sender, intent, data) {\r\n          plotIntentKml(sender, intent, data);\r\n        });\r\n\r\n      OWF.Intents.receive({\r\n          action: 'view',\r\n          dataType: 'uri-list/vnd.google-earth.kml+xml'\r\n        },\r\n        function (sender, intent, data) {\r\n          loadIntentKml(sender, intent, data);\r\n        });\r\n\r\n      OWF.Intents.receive({\r\n          action: 'view',\r\n          dataType: 'application/geo+json'\r\n        },\r\n        function (sender, intent, data) {\r\n          plotIntentJson(sender, intent, data);\r\n        });\r\n      OWF.Intents.receive({\r\n          action: 'view',\r\n          dataType: 'uri-list/geo+json'\r\n        },\r\n        function (sender, intent, data) {\r\n          loadIntentJson(sender, intent, data);\r\n        });\r\n    }\r\n  }\r\n\r\n  var hViewChgTimer;\r\n\r\n  function viewChangeHdlr() {\r\n    if (hViewChgTimer) {\r\n      clearTimeout(hViewChgTimer);\r\n    }\r\n    /*\r\n     TODO - We need to rethink this given that there can be more than one map.\r\n     hViewChgTimer = setTimeout(function() {\r\n     hViewChgTimer = undefined;\r\n\r\n     // Store the view center and range.\r\n     emp.environment.get().prefs.put({\r\n     key: \"currentView\",\r\n     value: JSON.stringify({\r\n     center: emp.map.status.getViewCenter(),\r\n     range: emp.map.status.getViewRange()\r\n     })\r\n     });\r\n     }, 10000);\r\n     */\r\n  }\r\n\r\n  /**\r\n   * Changes state event handling\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   * @param  {String} sender\r\n   * @param  {String} msg\r\n   */\r\n  function handleStateEvent(sender, msg) {\r\n    // Overrides the map close, first sends out event, then closes the\r\n    // map.\r\n    if (msg.eventName === \"beforeclose\") {\r\n      if (shutdownCallback) {\r\n        shutdownCallback();\r\n      }\r\n\r\n      widgetState.removeStateEventOverrides({\r\n        events: ['beforeclose'],\r\n        callback: function () {\r\n          widgetState.closeWidget();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function owf35Unload() {\r\n    if (shutdownCallback) {\r\n      shutdownCallback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initalized Widget to OWF\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   * @return {void}\r\n   */\r\n  function mapInit() {\r\n    var event,\r\n      bInstallViewChangeListener = false,\r\n      widgetGuid,\r\n      launchData,\r\n      launchDataStr,\r\n      transactionMessage;\r\n\r\n    // Check to see what version of Ozone we are running.  If\r\n    // we are running an older version of Ozone, we need to map the\r\n    // old calls to the new function calls.\r\n    switch (template.version) {\r\n      case \"3.5.0-GA\":\r\n      case \"3.6.0-GA\":\r\n      case \"3.7.0-GA\":\r\n      case \"3.8.0-GA\":\r\n      case \"3.8.1-GA\":\r\n        widgetEventingController = new Ozone.eventing.Widget(template.properties.rpcRelayPath);\r\n\r\n        // These version do not have OWF defined.\r\n        OWF = Ozone;\r\n        OWF.Eventing = widgetEventingController;\r\n        OWF.getInstanceId = function () {\r\n          return JSON.parse(widgetEventingController.getWidgetId()).id;\r\n        };\r\n\r\n        if (OWF.BrowserDetect.browser === \"Firefox\") {\r\n          // The onload works but FF does not support it.\r\n          // So we need to install a view change listener\r\n          // to store the view data.\r\n          bInstallViewChangeListener = true;\r\n        } else {\r\n          window.addEventListener(\"unload\", owf35Unload);\r\n        }\r\n\r\n        widgetGuid = OWF.getInstanceId();\r\n        OWF.pref.PrefServer.getWidget({\r\n          widgetId: widgetGuid,\r\n          onSuccess: function (results) {\r\n            template.properties.widgetName = results.value.originalName;\r\n            template.properties.universalName = results.value.universalName;\r\n            template.name = results.value.namespace;\r\n          },\r\n          onFailure: function () {\r\n            template.properties.widgetName = \"\";\r\n            template.properties.universalName = \"\";\r\n          }\r\n        });\r\n\r\n        break;\r\n      case \"4.0.0-GA\":\r\n        widgetEventingController = new Ozone.eventing.Widget(template.properties.rpcRelayPath);\r\n\r\n        // These version do not have OWF defined.\r\n        OWF = Ozone;\r\n        OWF.Eventing = widgetEventingController;\r\n        OWF.getInstanceId = function () {\r\n          return OWF.Widget.getInstanceId();\r\n        };\r\n\r\n        widgetState = Ozone.state.WidgetState.getInstance({\r\n          widgetEventingController: widgetEventingController,\r\n          autoInit: true,\r\n          onStateEventReceived: handleStateEvent\r\n        });\r\n        // Override the widget state event handler beforeclose event.  This\r\n        // will prevent the map from closing when a user clicks to close the map.\r\n        // We want to intercept the event and send out a proper close instead.\r\n        widgetState.addStateEventOverrides({\r\n          events: [\"beforeclose\"]\r\n        });\r\n\r\n        widgetGuid = OWF.Widget.getWidgetGuid();\r\n        OWF.pref.PrefServer.getWidget({\r\n          widgetId: widgetGuid,\r\n          onSuccess: function (results) {\r\n            template.properties.widgetName = results.value.originalName;\r\n            template.properties.universalName = results.value.universalName;\r\n            template.name = results.value.namespace;\r\n          },\r\n          onFailure: function () {\r\n            template.properties.widgetName = \"\";\r\n            template.properties.universalName = \"\";\r\n          }\r\n        });\r\n\r\n        break;\r\n\r\n      default:\r\n\r\n\r\n        OWF.relayFile = this.rpcRelayPath;\r\n        widgetEventingController = new Ozone.eventing.Widget(this.rpcRelayPath);\r\n\r\n        widgetState = Ozone.state.WidgetState.getInstance({\r\n          widgetEventingController: widgetEventingController,\r\n          autoInit: true,\r\n          onStateEventReceived: handleStateEvent\r\n        });\r\n        // Override the widget state event handler beforeclose event.  This\r\n        // will prevent the map from closing when a user clicks to close the map.\r\n        // We want to intercept the event and send out a proper close instead.\r\n        widgetState.addStateEventOverrides({\r\n          events: [\"beforeclose\"]\r\n        });\r\n        // This is the unique widget instanceId\r\n        widgetGuid = OWF.getWidgetGuid();\r\n        // Check if this instance of the widget was launched as a private map\r\n        launchDataStr = OWF.Launcher.getLaunchData();\r\n        if (launchDataStr != null) {\r\n          launchData = Ozone.util.parseJson(launchDataStr);\r\n          if (launchData != null) {\r\n            if (launchData.hasOwnProperty('senderId') && launchData.hasOwnProperty('messageId')) {\r\n              ownerId = {\r\n                senderId: launchData.senderId\r\n              };\r\n              isPrivateInstance = true;\r\n              transactionMessage = {\r\n                messageId: launchData.messageId,\r\n                originatingChannel: \"\",\r\n                status: \"success\",\r\n                details: {},\r\n                failures: []\r\n              };\r\n              template.pubSub.publish(\"map.transaction.complete\", transactionMessage, ownerId);\r\n            }\r\n          }\r\n        }\r\n        // Retrieve the name and universal name of this widget.\r\n        OWF.Preferences.getWidget({\r\n          widgetId: widgetGuid,\r\n          onSuccess: function (results) {\r\n            template.properties.widgetName = results.value.originalName;\r\n            template.properties.universalName = results.value.universalName;\r\n            template.name = results.value.namespace;\r\n          },\r\n          onFailure: function () {\r\n            template.properties.widgetName = \"\";\r\n            template.properties.universalName = \"\";\r\n          }\r\n        });\r\n\r\n        break;\r\n    }\r\n    // Register handlers the supported widget intents\r\n    registerWidgetIntents();\r\n\r\n    event = {};\r\n    event.type = \"mapLoading\";\r\n    event.eventData = {};\r\n    //emp.api.cmapi._init();\r\n    //emp.api.core._init();\r\n    //var payload = {};\r\n    //payload.status = \"ready\";\r\n    //OWF.Eventing.publish(\"map.status.initialization\", JSON.stringify(payload));\r\n\r\n    initCallback({\r\n      success: true\r\n    });\r\n\r\n    if (bInstallViewChangeListener) {\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.VIEW_CHANGE,\r\n        mapInstanceId: \"0\", //TODO get a value from somewhere.\r\n        callback: viewChangeHdlr\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  function initialize() {\r\n\r\n    if (window.OWF !== undefined) {\r\n      template.version = OWF.getContainerVersion();\r\n      OWF.ready(mapInit);\r\n    } else if (window.Ozone !== undefined) {\r\n      Ozone.pref.PrefServer.getServerVersion({\r\n        onSuccess: function (version) {\r\n          template.version = version.serverVersion;\r\n          mapInit();\r\n        }\r\n      });\r\n    } else if (owfLoadAttempted === false &&\r\n      emp.configManager.config.owfJsLocation !== undefined &&\r\n      emp.configManager.config.owfJsLocation !== null &&\r\n      emp.configManager.config.owfJsLocation !== \"\" &&\r\n      // Should this be in V3 core?\r\n      emp.appSetup.environment === \"owf\") {\r\n      owfLoadAttempted = true;\r\n      loadScript({\r\n        objectToLoad: \"Ozone\",\r\n        url: emp.configManager.config.owfJsLocation,\r\n        callback: initialize,\r\n        failedcallback: function () {\r\n          emp.typeLibrary.Error({\r\n            message: \"The OWF javascript Library failed to load from: \" + emp.configManager.config.owfJsLocation,\r\n            level: emp.typeLibrary.Error.level.CATASTROPHIC\r\n          });\r\n        }\r\n      });\r\n    } else {\r\n      emp.typeLibrary.Error({\r\n        message: \"The OWF javascript Library does not appear to be included on the page and the application cannot initialize\",\r\n        level: emp.typeLibrary.Error.level.CATASTROPHIC\r\n      });\r\n      initCallback({\r\n        success: false\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  template.name = \"Ozone Widget Framework\";\r\n\r\n  template.init = function (args) {\r\n    initCallback = args.initcallback;\r\n    shutdownCallback = args.shutdowncallback;\r\n    initialize();\r\n  };\r\n\r\n\r\n  template.pubSub.publish = function (args) {\r\n    var success = false;\r\n\r\n    /*\r\n     * In the emps browser environment the object args.sender will have a forwardMsg property set to allow communication between two browser environments.\r\n     * As a result if a message is sent from the browser environment to the OWF environment the args.sender will have a defined value.\r\n     * This will need to be reset back to a undefined value since no sender was defined with the original message.\r\n     */\r\n    if (args.sender && typeof args.sender.forwardMsg !== \"undefined\") {\r\n      args.sender = undefined;\r\n    }\r\n    // if this is a private map instance make sure we route to owner\r\n    if (isPrivateInstance === true) {\r\n      args.sender = ownerId;\r\n    }\r\n\r\n    try {\r\n      if (args.sender) {\r\n        OWF.Eventing.publish(args.channel, JSON.stringify(args.message), args.sender);\r\n        success = true;\r\n      } else {\r\n        OWF.Eventing.publish(args.channel, JSON.stringify(args.message));\r\n        success = true;\r\n      }\r\n    } catch (e) {\r\n      if (window.console) {\r\n        if (window.console.hasOwnProperty(\"log\")) {\r\n          //cannot use typeLibrary.error because it will cause an infinite loop of errors\r\n          console.error(\"An error occurred while attempting to publish a message on \" + args.channel + \" in the EMP OWF environment. \" + e.toString());\r\n        }\r\n      }\r\n      //cannot use typeLibrary.error because it will cause an infinite loop of errors\r\n      /*\r\n       emp.typeLibrary.Error({\r\n       message: \"An error occurred while attempting to publish a message on \" + args.channel + \" in the EMP OWF environment\",\r\n       jsError: e\r\n       });\r\n       */\r\n    }\r\n    return success;\r\n  };\r\n\r\n  // Default path for the OWF rpc relay file needed for corss domain data transfer between widgets\r\n  template.properties.rpcRelayPath = 'rpc_relay.uncompressed.html';\r\n\r\n\r\n  template.pubSub.subscribe = function (args) {\r\n    var success = false;\r\n    try {\r\n      OWF.Eventing.subscribe(args.channel, args.callback);\r\n      success = true;\r\n      subscribedCallbacks[args.channel] = args.callback;\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"An error occurred while attempting to subscribe to the \" + args.channel + \" channel in the EMP OWF environment\",\r\n        jsError: e\r\n      });\r\n    }\r\n    return success;\r\n  };\r\n\r\n  template.pubSub.unsubscribe = function (args) {\r\n    var success = false;\r\n    try {\r\n      OWF.Eventing.unsubscribe(args.channel);\r\n      success = true;\r\n      delete subscribedCallbacks[args.channel];\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"An error occured while attempting to unsubscribe to the \" + args.channel + \" channel in the EMP OWF environment\",\r\n        jsError: e\r\n      });\r\n    }\r\n    return success;\r\n  };\r\n\r\n  /**\r\n   * Forward all subscribed messages to EMP on a separate\r\n   * window. Call stopForwarding() to revert this option.\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   * @protected\r\n   * @param  {Window} Window object for forwarding messages to. Assumed\r\n   *   to have EMP available to call.\r\n   * @return {boolean}\r\n   */\r\n  template.pubSub.forwardSubscribeMessages = function (win) {\r\n    var success = false,\r\n      channel;\r\n\r\n    function channelCallback(sender, msg, channel) {\r\n      if (win && !win.closed && win.emp) {\r\n        win.emp.environment.get().pubSub.publish({\r\n          channel: channel,\r\n          message: msg,\r\n          sender: sender\r\n        });\r\n      } else {\r\n        console.error('Failed to forward message ' + channel);\r\n      }\r\n    }\r\n\r\n    try {\r\n\r\n      // Start off making sure that win just exists and we can\r\n      // publish to it.\r\n      if (win && !win.closed && win.emp && win.emp.environment.get().pubSub) {\r\n\r\n        // Unsubscribe from all current messages.\r\n        for (channel in subscribedCallbacks) {\r\n          OWF.Eventing.unsubscribe(channel);\r\n        }\r\n\r\n        // Resubscribe with a forwarding callback.\r\n        for (channel in subscribedCallbacks) {\r\n          OWF.Eventing.subscribe(channel, channelCallback);\r\n        }\r\n\r\n        success = true;\r\n      }\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"An error occured while attempting to forward subscriptions in the EMP OWF environment\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n    return success;\r\n  };\r\n\r\n  /**\r\n   * Stop forwarding messages to a seperate window.\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   * @public\r\n   * @return {void}\r\n   */\r\n  template.pubSub.stopForwardingSubscribe = function () {\r\n    var channel;\r\n    try {\r\n\r\n      // Unsubscribe from all current messages to stop\r\n      // forwarding.\r\n      for (channel in subscribedCallbacks) {\r\n        OWF.Eventing.unsubscribe(channel);\r\n      }\r\n\r\n      // Restore original callbacks.\r\n      for (channel in subscribedCallbacks) {\r\n        OWF.Eventing.subscribe(channel, subscribedCallbacks[channel]);\r\n      }\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"An error occured while attempting to stop forwarding in the EMP OWF environment\",\r\n        jsError: e\r\n      });\r\n    }\r\n  };\r\n\r\n\r\n  // Default path for the OWF rpc relay file needed for corss domain data transfer between widgets\r\n  template.properties.rpcRelayPath = 'rpc_relay.uncompressed.html';\r\n\r\n  template.prefs.get = function (args) {\r\n    var successCallback = args.onSuccess;\r\n    var failureCallback = args.onError;\r\n    var onSuccess = function (args) {\r\n      if (successCallback) {\r\n        successCallback({\r\n          value: args.value\r\n        });\r\n      }\r\n    };\r\n\r\n    var onFailure = function (error) {\r\n      if (failureCallback) {\r\n        failureCallback({\r\n          error: error\r\n        });\r\n      }\r\n    };\r\n\r\n    switch (template.version) {\r\n      case \"3.5.0-GA\":\r\n      case \"3.6.0-GA\":\r\n      case \"3.7.0-GA\":\r\n      case \"3.8.0-GA\":\r\n      case \"3.8.1-GA\":\r\n        OWF.pref.PrefServer.setUserPreference({\r\n          namespace: 'mil.army.sec.emp',\r\n          name: args.key,\r\n          value: args.value,\r\n          onSuccess: onSuccess,\r\n          onFailure: onFailure\r\n        });\r\n        break;\r\n      case \"4.0.0-GA\":\r\n        OWF.pref.PrefServer.setUserPreference({\r\n          namespace: 'mil.army.sec.emp',\r\n          name: args.key,\r\n          value: args.value,\r\n          onSuccess: onSuccess,\r\n          onFailure: onFailure\r\n        });\r\n        break;\r\n      default:\r\n        OWF.Preferences.setUserPreference({\r\n          namespace: 'mil.army.sec.emp',\r\n          name: args.key,\r\n          value: args.value,\r\n          onSuccess: onSuccess,\r\n          onFailure: onFailure\r\n        });\r\n        break;\r\n    }\r\n  };\r\n\r\n  template.prefs.put = function (args) {\r\n    var successCallback = args.onSuccess;\r\n    var failureCallback = args.onError;\r\n    var onSuccess = function (args) {\r\n      if (successCallback) {\r\n        successCallback({\r\n          value: args.value\r\n        });\r\n      }\r\n    };\r\n\r\n    var onFailure = function (error) {\r\n      if (failureCallback) {\r\n        failureCallback({\r\n          error: error\r\n        });\r\n      }\r\n    };\r\n\r\n    switch (template.version) {\r\n      case \"3.5.0-GA\":\r\n      case \"3.6.0-GA\":\r\n      case \"3.7.0-GA\":\r\n      case \"3.8.0-GA\":\r\n      case \"3.8.1-GA\":\r\n        OWF.pref.PrefServer.setUserPreference({\r\n          namespace: 'mil.army.sec.emp',\r\n          name: args.key,\r\n          value: args.value,\r\n          onSuccess: onSuccess,\r\n          onFailure: onFailure\r\n        });\r\n        break;\r\n      case \"4.0.0-GA\":\r\n        OWF.pref.PrefServer.setUserPreference({\r\n          namespace: 'mil.army.sec.emp',\r\n          name: args.key,\r\n          value: args.value,\r\n          onSuccess: onSuccess,\r\n          onFailure: onFailure\r\n        });\r\n        break;\r\n      default:\r\n        OWF.Preferences.setUserPreference({\r\n          namespace: 'mil.army.sec.emp',\r\n          name: args.key,\r\n          value: args.value,\r\n          onSuccess: onSuccess,\r\n          onFailure: onFailure\r\n        });\r\n        break;\r\n    }\r\n  };\r\n\r\n  template.getInstanceId = function () {\r\n    return OWF.getInstanceId();\r\n  };\r\n\r\n  template.launchTool = function (args) {\r\n    var launchCallback = function (callbackArgs) {\r\n      var onSuccess = args.onSuccess;\r\n      var onError = args.onError;\r\n\r\n      if (callbackArgs.error) {\r\n        if (typeof onError === 'function') {\r\n          onError({\r\n            message: \"The current user does not have permissions to run this tool.\",\r\n            statusCode: \"Failed\"\r\n          });\r\n        }\r\n      } else {\r\n        if (typeof onSuccess === 'function') {\r\n          onSuccess();\r\n        }\r\n      }\r\n    };\r\n\r\n    switch (template.version) {\r\n      case \"3.5.0-GA\":\r\n      case \"3.6.0-GA\":\r\n      case \"3.7.0-GA\":\r\n      case \"3.8.0-GA\":\r\n      case \"3.8.1-GA\":\r\n      case \"4.0.0-GA\":\r\n        var widgetLauncher = new OWF.launcher.WidgetLauncher(widgetEventingController);\r\n\r\n        widgetLauncher.launchWidget({\r\n          guid: args.toolHandle.path,\r\n          launchOnlyIfClosed: true\r\n        });\r\n        break;\r\n      default:\r\n        OWF.Launcher.launch({\r\n          guid: args.toolHandle.path,\r\n          launchOnlyIfClosed: true\r\n        }, launchCallback);\r\n        break;\r\n    }\r\n  };\r\n\r\n  template.getToolInfo = function (args) {\r\n    var getToolInfoSuccess = function (widgets) {\r\n      var onSuccess = args.onSuccess,\r\n        onError = args.onError,\r\n        toolName = args.toolInfo.toolName,\r\n        iIndex,\r\n        toolInfo,\r\n        oErrorInfo;\r\n\r\n      switch (template.version) {\r\n        case \"3.5.0-GA\":\r\n        case \"3.6.0-GA\":\r\n        case \"3.7.0-GA\":\r\n        case \"3.8.0-GA\":\r\n        case \"3.8.1-GA\":\r\n          if (widgets.success && (widgets.rows.length > 0)) {\r\n            // We need to scan what we get back because 3.5 returns\r\n            // A list of eveything even if it did not match the search.\r\n\r\n            for (iIndex = 0; iIndex < widgets.rows.length; iIndex++) {\r\n              if (widgets.rows[iIndex].value.namespace === toolName) {\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (iIndex < widgets.rows.length) {\r\n              // We can't do a get because in 3.5 it doesn't work.\r\n              toolInfo = {\r\n                toolName: widgets.rows[iIndex].value.namespace,\r\n                toolhandle: widgets.rows[iIndex]\r\n              };\r\n\r\n              onSuccess(toolInfo);\r\n            } else if (typeof onError === 'function') {\r\n              oErrorInfo = {\r\n                message: \"Widget (\" + toolName + \") not found.\",\r\n                statusCode: \"404\"\r\n              };\r\n              onError(oErrorInfo);\r\n            }\r\n          } else if (typeof onError === 'function') {\r\n            oErrorInfo = {\r\n              message: \"Widget (\" + toolName + \") not found.\",\r\n              statusCode: \"404\"\r\n            };\r\n            onError(oErrorInfo);\r\n          }\r\n          break;\r\n        case \"4.0.0-GA\":\r\n          if (widgets.length > 0) {\r\n            // We can't do a get because in 4.0 it doesn't work.\r\n            toolInfo = {\r\n              toolName: widgets[0].value.namespace,\r\n              toolhandle: widgets[0]\r\n            };\r\n\r\n            onSuccess(toolInfo);\r\n          } else if (typeof onError === 'function') {\r\n            oErrorInfo = {\r\n              message: \"Widget (\" + toolName + \") not found.\",\r\n              statusCode: \"404\"\r\n            };\r\n            onError(oErrorInfo);\r\n          }\r\n          break;\r\n        default:\r\n          if (widgets.length > 0) {\r\n            setTimeout(function () {\r\n              var widgetID = widgets[0].path;\r\n              var getToolName = toolName;\r\n\r\n              OWF.Preferences.getWidget({\r\n                widgetId: widgetID,\r\n                onSuccess: function (getWidgetArgs) {\r\n                  var toolInf = {\r\n                    toolName: getToolName,\r\n                    toolhandle: getWidgetArgs\r\n                  };\r\n\r\n                  onSuccess(toolInf);\r\n                },\r\n                onFailure: function () {\r\n                  if (typeof onError === 'function') {\r\n                    var errInfo = {\r\n                      message: \"The current user does not have permissions to run this tool (\" + getToolName + \").\",\r\n                      statusCode: \"Failed\"\r\n                    };\r\n                    onError(errInfo);\r\n                  }\r\n                }\r\n              });\r\n            }, 50);\r\n          } else if (typeof onError === 'function') {\r\n            oErrorInfo = {\r\n              message: \"Widget (\" + toolName + \") not found.\",\r\n              statusCode: \"404\"\r\n            };\r\n            onError(oErrorInfo);\r\n          }\r\n          break;\r\n      }\r\n    };\r\n\r\n    var getToolInfoError = function (errorArgs) {\r\n      var onError = args.onError;\r\n\r\n      if (onError) {\r\n        var oErrorInfo = {\r\n          message: errorArgs.message,\r\n          statusCode: errorArgs.statusCode\r\n        };\r\n        onError(oErrorInfo);\r\n      }\r\n    };\r\n\r\n    var searchConfig = {\r\n      searchParams: {\r\n        widgetName: args.toolInfo.toolName,\r\n        widgetNameExactMatch: true\r\n      },\r\n      onSuccess: getToolInfoSuccess,\r\n      onFailure: getToolInfoError\r\n    };\r\n\r\n    if (typeof args.onSuccess !== 'function') {\r\n      throw emp.typeLibrary.Error({\r\n        message: \"The onSuccess callback parameter is required.\",\r\n        level: emp.typeLibrary.Error.level.MAJOR\r\n      });\r\n    }\r\n    switch (template.version) {\r\n      case \"3.5.0-GA\":\r\n      case \"3.6.0-GA\":\r\n      case \"3.7.0-GA\":\r\n      case \"3.8.0-GA\":\r\n      case \"3.8.1-GA\":\r\n      case \"4.0.0-GA\":\r\n        OWF.pref.PrefServer.findWidgets(searchConfig);\r\n        break;\r\n      default:\r\n        OWF.Preferences.findWidgets(searchConfig);\r\n        break;\r\n    }\r\n  };\r\n\r\n  return template;\r\n}());\r\n","/*global emp */\r\n\r\nemp.environment.browser = (function() {\r\n\r\n  var template = emp.createEnvironmentTemplate(),\r\n    /**\r\n     * forwardMsgWindow will be used to hold the value of a new window for messages to be forwarded too.\r\n     * @memberOf emp.environment.browser\r\n     * @type {object}\r\n     * @private\r\n     */\r\n    forwardMsgWindow,\r\n    senderId = emp.helpers.id.newGUID();\r\n\r\n  template.name = \"Browser\";\r\n\r\n  /**\r\n   * Subscribed Callbacks\r\n   * @memberOf emp.environment.browser\r\n   * @type {object}\r\n   * @private\r\n   * @property {string} channel The channel for a subscribed callback.\r\n   * @property {function} callback The callback function for a subscription.\r\n   */\r\n  var subscribedCallbacks = {};\r\n\r\n  template.init = function(args) {\r\n    var transactionMessage;\r\n    if (args) {\r\n      if (args.hasOwnProperty(\"initcallback\")) {\r\n        args.initcallback();\r\n      }\r\n      if (args.hasOwnProperty(\"mapInstanceId\") &&\r\n        args.mapInstanceId !== undefined &&\r\n        args.mapInstanceId !== null &&\r\n        args.hasOwnProperty(\"messageId\") &&\r\n        args.messageId !== undefined &&\r\n        args.messageId !== null) {\r\n        transactionMessage = {\r\n          messageId: args.messageId,\r\n          originatingChannel: \"\",\r\n          status: \"success\",\r\n          details: {},\r\n          failures: []\r\n        };\r\n        template.pubSub.publish({\r\n          channel: \"map.message.complete\",\r\n          message: transactionMessage,\r\n          sender: {\r\n            id: args.mapInstanceId\r\n          }\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @param {object} args\r\n   * @param {string} args.channel\r\n   * @param {object} args.message\r\n   * @param {*} [args.sender]\r\n   * @returns {boolean}\r\n   */\r\n  template.pubSub.publish = function(args) {\r\n    var success = false,\r\n      fwdMsg = true;\r\n    if (args.sender) {\r\n      if (args.sender.hasOwnProperty(\"id\")) {\r\n        senderId = args.sender.id;\r\n      }\r\n      if (args.sender.hasOwnProperty(\"forwardMsg\") && args.sender.forwardMsg !== null) {\r\n        fwdMsg = args.sender.forwardMsg;\r\n      }\r\n    }\r\n\r\n    // If we are forwarding send it on to the new window. Only do this for messages originating from this application (sender not specified).\r\n    if (forwardMsgWindow && !args.sender) {\r\n      args.sender = {\r\n        forwardMsg: false\r\n      };\r\n      forwardMsgWindow.emp.environment.get().pubSub.publish(args);\r\n      success = true;\r\n    }\r\n    else {      \r\n      emp.environment.browser.mediator.publish({\r\n        channel: args.channel,\r\n        message: args.message,\r\n        sender: {\r\n          id: senderId,\r\n          forwardMsg: fwdMsg // Boolean to determine whether to use standard callback or forward callback.\r\n        }\r\n      });\r\n      success = true;\r\n    }\r\n    return success;\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @param args\r\n   * @returns {boolean}\r\n   */\r\n  template.pubSub.subscribe = function(args) {\r\n    var success = false;\r\n\r\n    emp.environment.browser.mediator.subscribe({\r\n      channel: args.channel,\r\n      callback: args.callback,\r\n      senderId: args.mapInstanceId\r\n    });\r\n    subscribedCallbacks[args.channel] = args.callback;\r\n    success = true;\r\n\r\n    return success;\r\n  };\r\n\r\n  template.pubSub.unsubscribe = function(args) {\r\n    var success = false;\r\n\r\n    emp.environment.browser.mediator.unsubscribe({\r\n      channel: args.channel,\r\n      callback: args.callback\r\n    });\r\n    delete subscribedCallbacks[args.channel];\r\n    success = true;\r\n\r\n    return success;\r\n  };\r\n\r\n  /**\r\n   * Forward all subscribed messages to EMP on a separate\r\n   * window. Call stopForwarding() to revert this option.\r\n   * @method\r\n   * @memberOf emp.environment.browser\r\n   * @protected\r\n   * @param  {Window} Window object for forwarding messages to. Assumed\r\n   *   to have EMP available to call.\r\n   * @return {boolean}\r\n   */\r\n  template.pubSub.forwardSubscribeMessages = function(win) {\r\n    var success = false,\r\n      channel;\r\n\r\n    try {\r\n\r\n      // Start off making sure that win just exists and we can\r\n      // publish to it.\r\n      if (win && !win.closed && win.emp && win.emp.environment.get().pubSub) {\r\n\r\n        // Unsubscribe from all current messages.\r\n        for (channel in subscribedCallbacks) {\r\n          emp.environment.browser.mediator.unsubscribe({\r\n            channel: channel,\r\n            callback: subscribedCallbacks[channel]\r\n          });\r\n        }\r\n\r\n        // If sender.forwardMsg was set to true then resubscribe with a forwarding callback. If it was not set or it was false, call original callback.\r\n        for (channel in subscribedCallbacks) {\r\n          emp.environment.browser.mediator.subscribe({\r\n            channel: channel,\r\n            callback: function(sender, msg, channel) {\r\n              if (sender.forwardMsg) {\r\n                if (win && !win.closed && win.emp) {\r\n                  win.emp.environment.get().pubSub.publish({\r\n                    channel: channel,\r\n                    message: msg,\r\n                    sender: senderId\r\n                  });\r\n                }\r\n                else {\r\n                  console.error('Failed to forward message ' + channel);\r\n                }\r\n              }\r\n              else {\r\n                subscribedCallbacks[channel](sender, msg, channel);\r\n              }\r\n            }\r\n          });\r\n        }\r\n        success = true;\r\n      }\r\n    }\r\n    catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"An error occurred while attempting to forward subscriptions in the EMP Browser environment\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n    return success;\r\n  };\r\n\r\n  /**\r\n   * Stop forwarding subscribed messages to a separate window.\r\n   * @method\r\n   * @memberOf emp.environment.browser\r\n   * @public\r\n   * @return {void}\r\n   */\r\n  template.pubSub.stopForwardingSubscribe = function() {\r\n    var channel,\r\n      args;\r\n    try {\r\n      // Unsubscribe from all current messages to stop forwarding.\r\n      for (channel in subscribedCallbacks) {\r\n        args = {\r\n          channel: channel,\r\n          callback: subscribedCallbacks[channel]\r\n        };\r\n        emp.environment.browser.mediator.unsubscribe(args);\r\n      }\r\n\r\n      // Restore original callbacks.\r\n      for (channel in subscribedCallbacks) {\r\n        args = {\r\n          channel: channel,\r\n          callback: subscribedCallbacks[channel]\r\n        };\r\n        emp.environment.browser.mediator.subscribe(args);\r\n      }\r\n    }\r\n    catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"An error occurred while attempting to stop forwarding in the EMP Browser environment\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Removes value from variable forwardMsgWindow. This will result in stopping the forwarding of published messages to a separate window.\r\n   * @method\r\n   * @memberOf emp.environment.browser\r\n   * @public\r\n   * @return {void}\r\n   */\r\n  template.pubSub.stopForwardingPublish = function() {\r\n    forwardMsgWindow = undefined;\r\n  };\r\n\r\n  /**\r\n   * Sets a new window object as a value for forwardMsgWindow variable. This will start forwarding published messages to a separate window.\r\n   * @method\r\n   * @memberOf emp.environment.browser\r\n   * @public\r\n   * @param  {Window} Window object for forwarding messages to. Assumed\r\n   *   to have EMP available to call.\r\n   * @return {void}\r\n   */\r\n  template.pubSub.forwardPublishedMessages = function(win) {\r\n    // Make sure that win exists and we can publish to it.\r\n    if (win && win.emp && win.emp.environment.get().pubSub) {\r\n      forwardMsgWindow = win;\r\n    }\r\n  };\r\n\r\n  return template;\r\n}());\r\n","/*global emp */\r\n\r\n/**\r\n * @ignore\r\n */\r\n\r\n/**\r\n * @class\r\n */\r\nemp.environment.browser.mediator = (function() {\r\n  var listeners = new emp.utilities.Hash();\r\n  var publicInterface = {\r\n\r\n    /**\r\n     * @method\r\n     * @public\r\n     * @memberOf emp.transactionQueue.listener\r\n     * @see emp.intents.control enumeration for a list of the intents types you can register for\r\n     * @param {object} listenerInfo\r\n     */\r\n    subscribe: function(listenerInfo) {\r\n      if (listeners.getItem(listenerInfo.channel) !== null && listeners.getItem(listenerInfo.channel) !== undefined) {\r\n        listeners.getItem(listenerInfo.channel).push({\r\n          callback: listenerInfo.callback,\r\n          senderId: listenerInfo.senderId\r\n        });\r\n      } else {\r\n        var callbacks = [];\r\n        callbacks.push({callback: listenerInfo.callback, senderId: listenerInfo.senderId});\r\n        listeners.setItem(listenerInfo.channel, callbacks);\r\n      }\r\n    },\r\n    /**\r\n     * @method\r\n     * @public\r\n     * @memberOf emp.transactionQueue.listener\r\n     * @param  {object} listenerInfo\r\n     * @return {boolean}\r\n     */\r\n    unsubscribe: function(listenerInfo) {\r\n      var callbackArray,\r\n        len,\r\n        i;\r\n\r\n      if (listeners.getItem(listenerInfo.channel) !== null && listeners.getItem(listenerInfo.channel) !== undefined) {\r\n        callbackArray = listeners.getItem(listenerInfo.channel);\r\n        len = callbackArray.length;\r\n\r\n        for (i = 0; i < len; i += 1) {\r\n          if (callbackArray[i].callback === listenerInfo.callback) {\r\n            callbackArray.splice(i, 1);\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n    /**\r\n     *\r\n     * @param {object} message\r\n     * @param {string} message.channel\r\n     * @param {object|string} message.message\r\n     * @param {object} [message.dest]\r\n     * @param {string} [message.dest.id]\r\n     * @param {object} message.sender\r\n     * @param {string} message.sender.id\r\n     * @param {function} message.sender.forwardMsg\r\n     * @returns {{success: boolean, message: string}}\r\n     */\r\n    publish: function(message) {\r\n      var callbacks = listeners.getItem(message.channel),\r\n        len,\r\n        i,\r\n        errorMessages = [],\r\n        success = {\r\n          success: false,\r\n          message: \"An unanticipated error has occurred in emp.environment.browser.mediator.dispatch\"\r\n        };\r\n\r\n      try {\r\n        if (typeof(message.message) === \"string\") {\r\n          message.message = JSON.parse(message.message);\r\n        }\r\n\r\n        if (callbacks !== null && callbacks !== undefined) {\r\n          len = callbacks.length;\r\n          for (i = 0; i < len; i += 1) {\r\n            if (callbacks[i] !== null) {\r\n              try {\r\n                if (message.hasOwnProperty(\"dest\") &&\r\n                  (message.dest !== null) &&\r\n                  (message.dest !== \"\") && !emp.helpers.isEmptyString(message.dest.id)) {\r\n                  if (message.dest.id === callbacks[i].senderId) {\r\n                    try {\r\n                      callbacks[i].callback(message.sender, message.message, message.channel);\r\n                    } catch (err) {\r\n                      emp.errorHandler.log({\r\n                        level: emp.typeLibrary.Error.level.MINOR,\r\n                        jsError: err,\r\n                        message: \"An error occurred in emp.environment.browser.mediator.js\"\r\n                      });\r\n                      errorMessages.push(err.message);\r\n                    }\r\n                  }\r\n                } else if (emp.helpers.isEmptyString(callbacks[i].senderId)) {\r\n                  try {\r\n                    callbacks[i].callback(message.sender, message.message, message.channel);\r\n                  } catch (err) {\r\n                    emp.errorHandler.log({\r\n                      level: emp.typeLibrary.Error.level.MINOR,\r\n                      jsError: err,\r\n                      message: \"An error occurred in emp.environment.browser.mediator.js\"\r\n                    });\r\n                    errorMessages.push(err.message);\r\n                  }\r\n                }\r\n              } catch (err) {\r\n                emp.errorHandler.log({\r\n                  level: emp.typeLibrary.Error.level.MINOR,\r\n                  jsError: err,\r\n                  message: \"An error occurred in emp.environment.browser.mediator.js\"\r\n                });\r\n                emp.typeLibrary.Error({\r\n                  level: emp.typeLibrary.Error.level.INFO,\r\n                  jsError: err,\r\n                  message: \"An error occurred in emp.transactionQueue.dispatch while attempting to invoke a callback function\"\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch (err2) {\r\n        errorMessages.push(err2.message);\r\n\r\n        emp.errorHandler.log({\r\n          level: emp.typeLibrary.Error.level.MINOR,\r\n          jsError: err2,\r\n          message: \"An error occurred in emp.transactionQueue.dispatch while attempting to invoke a callback function\"\r\n        });\r\n        success = {\r\n          success: false,\r\n          message: err2.toString()\r\n        };\r\n      }\r\n      if (errorMessages.length === 0) {\r\n        success = {\r\n          success: true\r\n        };\r\n      } else {\r\n        success = {\r\n          success: false,\r\n          message: \"An unanticipated error has occurred in emp.environment.browser.mediator.dispatch: \" + JSON.stringify(errorMessages)\r\n        };\r\n      }\r\n      return success;\r\n    },\r\n\r\n    /**\r\n     * Method to call for all synchronous methods types.  Does not create a transaction\r\n     * simply calls the engines directly.\r\n     * @param {object} args\r\n     * @param {string} args.mapId\r\n     * @param {object} args.message\r\n     * @param {object} args.message.conversionType\r\n     * @param {object} args.message.cmd\r\n     * @param {object} args.originalMessage\r\n     */\r\n    publishSynch: function(args) {\r\n\r\n      var result,\r\n        storageObject,\r\n        engineTemplate,\r\n        transaction,\r\n        items = [];\r\n\r\n      // get the correct map instance to call,\r\n      engineTemplate = emp.instanceManager.getInstance(args.mapId);\r\n\r\n      if (args.message) {\r\n\r\n        // check the method to call\r\n        switch (args.message.cmd) {\r\n          case \"Container.hasChildren\":\r\n            try {\r\n              // Direct storage access, be very careful\r\n              storageObject = emp.storage.get.id({id: args.message.container.geoId});\r\n              if (!storageObject || !storageObject.options || !storageObject.options.childObjects) {\r\n                result = {\r\n                  success: true,\r\n                  hasChildren: false\r\n                };\r\n              }\r\n\r\n              for (var child in storageObject.options.childObjects) {\r\n                if (storageObject.options.childObjects.hasOwnProperty(child)) {\r\n                  result = {\r\n                    success: true,\r\n                    hasChildren: true\r\n                  };\r\n                  return result;\r\n                }\r\n              }\r\n\r\n              result = {\r\n                success: true,\r\n                hasChildren: false\r\n              };\r\n            } catch (err) {\r\n              result = {\r\n                success: false,\r\n                hasChildren: false,\r\n                message: err.message\r\n              };\r\n            }\r\n\r\n            break;\r\n          case \"map.convert\":\r\n            if (!engineTemplate) {\r\n              break;\r\n            }\r\n            // Currently just kept using transactions.  This isn't the greatest way of doing this\r\n            // but initially wrote this with transactions in an asynchronous manner using the\r\n            // transactionQueue.  However, we needed it synchronous, so we kept the objects\r\n            // that were being passed by the engines.  Keeping it this way will allow us\r\n            // to be able to maybe implement sync and async version of the method in the future.\r\n\r\n\r\n            // look at message and determine which conversion needs to be made.\r\n            if (args.message.conversionType === \"offsetPixelToDecimalDegrees\") {\r\n              // create a typelib object to be added to a transaction\r\n              oItem = new emp.typeLibrary.Convert({\r\n                y: args.message.y,\r\n                x: args.message.x\r\n              });\r\n              // transactions take arrays of items, push it to an array.\r\n              items.push(oItem);\r\n\r\n              // We don't really need all this transaction info, but\r\n              // just filling it in to be correct.\r\n\r\n              transaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.GET_LATLON_FROM_XY,\r\n                mapInstanceId: args.mapId,\r\n                transactionId: \"\",\r\n                sender: \"\",\r\n                source: emp.api.cmapi.SOURCE,\r\n                originChannel: cmapi.channel.names.MAP_CONVERT,\r\n                originalMessage: args.message,\r\n                messageOriginator: \"\",\r\n                originalMessageType: cmapi.channel.names.MAP_CONVERT,\r\n                items: items\r\n              });\r\n\r\n              engineTemplate.engine.view.getLatLonFromXY(transaction);\r\n\r\n              if (transaction.items[0].invalid) {\r\n                result = null;\r\n              } else {\r\n                result = new emp3.api.GeoPosition({\r\n                  latitude: transaction.items[0].lat,\r\n                  longitude: transaction.items[0].lon\r\n                });\r\n              }\r\n\r\n            } else if (args.message.conversionType === \"decimalDegreesToOffsetPixel\") {\r\n\r\n              oItem = new emp.typeLibrary.Convert({\r\n                lat: args.message.y,\r\n                lon: args.message.x\r\n              });\r\n\r\n              items.push(oItem);\r\n\r\n              // We don't really need all this transaction info, but\r\n              // just filling it in to be correct.\r\n              transaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.GET_XY_FROM_LATLON,\r\n                mapInstanceId: args.mapInstanceId,\r\n                transactionId: \"\",\r\n                sender: \"\",\r\n                source: emp.api.cmapi.SOURCE,\r\n                originChannel: cmapi.channel.names.MAP_CONVERT,\r\n                originalMessage: args.originalMessage,\r\n                messageOriginator: \"\",\r\n                originalMessageType: cmapi.channel.names.MAP_CONVERT,\r\n                items: items\r\n              });\r\n\r\n              engineTemplate.engine.view.getXYFromLatLon(transaction);\r\n\r\n              if (transaction.items.length === 0 || transaction.items[0].invalid) {\r\n                window.console.error(transaction.failures);\r\n                result = null;\r\n              } else {\r\n                result = {\r\n                  x: transaction.items[0].x,\r\n                  y: transaction.items[0].y\r\n                };\r\n              }\r\n            }\r\n            break;\r\n          case \"map.view.lock\":\r\n            if (!engineTemplate) {\r\n              break;\r\n            }\r\n\r\n            var oItem = new emp.typeLibrary.Lock({\r\n              lock: args.message.lock\r\n            });\r\n\r\n            items.push(oItem);\r\n\r\n            transaction = new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.VIEW_LOCK,\r\n              mapInstanceId: args.mapInstanceId,\r\n              transactionId: \"\",\r\n              sender: \"\",\r\n              source: emp.api.cmapi.SOURCE,\r\n              originChannel: cmapi.channel.names.MAP_CONVERT,\r\n              originalMessage: args.originalMessage,\r\n              messageOriginator: \"\",\r\n              originalMessageType: cmapi.channel.names.MAP_CONVERT,\r\n              items: items\r\n            });\r\n\r\n            engineTemplate.engine.navigation.enable(transaction);\r\n            break;\r\n          default:\r\n            // do nothing\r\n            break;\r\n        }\r\n\r\n      }\r\n\r\n      return result;\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n","/*global emp, com */\r\n\r\nemp.environment.starfish = (function() {\r\n    var template = emp.createEnvironmentTemplate(),\r\n        nerve;\r\n\r\n    template.name = \"Starfish\";\r\n    \r\n\r\n    template.init = function(args) {\r\n        nerve = new com.octabits.starfish.Nerve();\r\n        template.sender.id = nerve.id;\r\n        if (args) {\r\n            if (args.hasOwnProperty(\"initcallback\")) {\r\n                args.initcallback();\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    template.pubSub.publish = function(args) {\r\n        var success = false;\r\n\r\n        nerve.publish({\r\n            channel: args.channel,\r\n            message: args.message\r\n        });\r\n        success = true;\r\n\r\n        return success;\r\n    };\r\n\r\n    template.pubSub.subscribe = function(args) {\r\n        var success = false;\r\n\r\n        nerve.subscribe({\r\n            channel: args.channel,\r\n            callback: args.callback\r\n        });\r\n        success = true;\r\n\r\n        return success;\r\n    };\r\n\r\n    template.pubSub.unsubscribe = function(args) {\r\n        var success = false;\r\n\r\n        nerve.unsubscribe({\r\n            channel: args.channel,\r\n            callback: args.callback\r\n        });\r\n        success = true;\r\n\r\n        return success;\r\n    };\r\n\r\n     template.getInstanceId = function (){\r\n        return nerve.id;\r\n    };\r\n\r\n    return template;\r\n}());\r\n","/*global emp, ozpIwc */\r\n\r\nemp.environment.iwc = (function() {\r\n\r\n    var template = emp.createEnvironmentTemplate();\r\n    var iwcClient;\r\n    var channelLookup = {};\r\n    var callbackLookup = {};\r\n    var adjustChannelName = function(channelName) {\r\n        return \"/cmapi_\" + channelName.replace(/\\./g, '_');\r\n    };\r\n     var revertChannelName = function(channelName){\r\n        channelName = channelName.replace(\"/cmapi_\", \"\");\r\n        return channelName.replace(/\\_/g,'.');\r\n    };\r\n    var recieveMessage = function(event) {\r\n        var msg = event.newValue,\r\n            callback,\r\n            callbackList;\r\n\r\n        if (msg.sender.id !== template.sender.id) {\r\n            callbackList = callbackLookup[msg.channel];\r\n            for (callback in callbackList) {\r\n                if (callbackList.hasOwnProperty(callback) && typeof callbackList[callback] === \"function\") {\r\n                    callbackList[callback](msg.sender,msg.msg,  revertChannelName(msg.channel));\r\n                }\r\n            }\r\n        }\r\n\r\n    };\r\n    template.name = \"Ozone Platform Inter Widget Communication (IWC)\";\r\n\r\n    template.version = \"1.0.0\";\r\n\r\n    template.properties = {};\r\n    template.sender = { id: \"broadcast\" };\r\n    template.iwcHost = \"vendor/iwc/\";\r\n\r\n    template.init = function(args) {\r\n        var transactionMessage;\r\n        var success = false;\r\n        if (ozpIwc !== undefined && ozpIwc !== null && typeof ozpIwc.hasOwnProperty === \"function\" && ozpIwc.hasOwnProperty(\"Client\")) {\r\n            iwcClient = new ozpIwc.Client(this.iwcHost);\r\n            var closureArgs = args;\r\n            var that = this;\r\n            iwcClient.connect().then(function() {\r\n\r\n                closureArgs.initcallback({\r\n                    success: true\r\n                });\r\n                template.sender.id = 'broadcast'; //iwcClient.address;\r\n                if (closureArgs.messageId !== undefined &&\r\n                    closureArgs.messageId !== null) {\r\n                    transactionMessage = {\r\n                        messageId: closureArgs.messageId,\r\n                        originatingChannel: \"\",\r\n                        status: \"success\",\r\n                        details: {},\r\n                        failures: []\r\n                    };\r\n                    template.pubSub.publish({\r\n                        channel: \"map.message.complete\",\r\n                        message: transactionMessage,\r\n                        sender: {\r\n                            id: 'broadcast'\r\n                        }\r\n                    });\r\n                }\r\n            }).catch(function(err) {\r\n                console.error(\"IWC Client failed to connect to \" + that.iwcHost + \" :\", err);\r\n            });\r\n            success = true;\r\n\r\n        } else {\r\n\r\n            console.error(\"The Ozone Platform IWC JavaScript ozpIwc object was not found on this page.  Please ensure that the path to ozpIwc-client.js in your app is correct\");\r\n\r\n            args.initcallback({\r\n                success: false\r\n            });\r\n        }\r\n        return success;\r\n\r\n    };\r\n\r\n    /**\r\n     * Adds an instance of the map into a div specified by user.  The map\r\n     * in turn will send a message back to the caller indicating the instanceId\r\n     * of the map.\r\n     */\r\n    template.createInstance = function(args) {\r\n        var result = false;\r\n\r\n        // Make sure all the required arguments are passed in.\r\n        if (args) {\r\n            if (args.hasOwnProperty(\"containerId\") &&\r\n                args.hasOwnProperty(\"messageId\")) {\r\n\r\n                // Instantiate the map in the container specified.\r\n                emp.instanceManager.createInstance({\r\n                    instanceDomId: args.containerId,\r\n                    messageId: args.messageId,\r\n                    config: args.config,\r\n                    extent: args.extent,\r\n                    environment: template,\r\n                    startMapEngineId: args.startMapEngineId\r\n                });\r\n\r\n                // Indicate the an attempt to instantiate the map\r\n                // was made without error.\r\n                result = true;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    template.destroyInstance = function(args) {\r\n        var result = false;\r\n\r\n        // Make sure all the required arguments are passed in.\r\n        if (args) {\r\n            if (args.hasOwnProperty(\"id\")) {\r\n\r\n                // Destroy the map with the specified id.\r\n                emp.instanceManager.destroyInstance({\r\n                    mapInstanceId: args.id,\r\n                    messageId: args.messageId\r\n                });\r\n\r\n                result = true;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    function getChannel(achannel) {\r\n        var channel = channelLookup[achannel];\r\n        if (channel === undefined || channel === null) {\r\n            channelLookup[achannel] = new iwcClient.data.Reference(achannel, { \"lifespan\": \"Bound\", \"respondOn\": \"all\" });\r\n            channel = channelLookup[achannel];\r\n        }\r\n        return channel;\r\n    }\r\n\r\n    template.pubSub.publish = function(args) {\r\n        var cName = adjustChannelName(args.channel);\r\n        var channel = getChannel(cName);\r\n        channel.set({\r\n            msg: args.message,\r\n            channel: cName,\r\n            sender: {\r\n                id: 'broadcast'\r\n            }\r\n        }).catch(function(err) {\r\n            console.error(\"ERROR publishing core message: \" + cName + \" - \" + JSON.stringify(err));\r\n        });\r\n        return true;\r\n    };\r\n\r\n    template.pubSub.subscribe = function(args) {\r\n        var cName = adjustChannelName(args.channel);\r\n        var channel = getChannel(cName);\r\n        if (callbackLookup[cName] !== undefined) {\r\n            callbackLookup[cName][args.callback] = args.callback;\r\n        } else {\r\n            callbackLookup[cName] = {};\r\n            callbackLookup[cName][args.callback] = args.callback;\r\n        }\r\n        channel.watch(recieveMessage);\r\n    };\r\n\r\n    template.pubSub.unsubscribe = function(args) {\r\n        var cName = adjustChannelName(args.channel);\r\n        var channel = getChannel(cName);\r\n        if (callbackLookup[cName] !== undefined) {\r\n            delete callbackLookup[cName][args.callback];\r\n        }\r\n        channel.unwatch(cName);\r\n        return true; //success;\r\n    };\r\n\r\n    return template;\r\n}());\r\n","/*global emp */\r\n\r\n/**\r\n * @namespace\r\n */\r\nemp.wms = emp.wms || {};\r\n\r\n/**\r\n * Self instantiating singleton for emp.wms.manager\r\n */\r\nemp.wms.manager = (function () {\r\n  // Object returned to emp.wms.manager namespace for other components to interface with\r\n  // Function closure gives this object private access to all function level variables\r\n  var publicInterface,\r\n    instanceData = {};\r\n\r\n  publicInterface = {\r\n    /**\r\n     * @param {string} mapInstanceId\r\n     * @returns {undefined|string}\r\n     */\r\n    getWmsOverlayId: function(mapInstanceId)\r\n    {\r\n        if (instanceData.hasOwnProperty(mapInstanceId))\r\n        {\r\n            return instanceData[mapInstanceId].wmsOverlayId;\r\n        }\r\n        return undefined;\r\n    },\r\n    /**\r\n     * Checks if the given ID belongs to a root WMS layer\r\n     * @memberof emp.wms.manager\r\n     * @param {string} id\r\n     * @returns {boolean}\r\n     */\r\n    isRootWMS: function(id) {\r\n        for (var instance in instanceData) {\r\n          if (instanceData.hasOwnProperty(instance)) {\r\n            if (instanceData[instance].wmsOverlayId === id) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n        return false;\r\n    },\r\n    /**\r\n     *\r\n     * @param args\r\n     */\r\n    newMapInstance: function(args)\r\n    {\r\n        var oData,\r\n            wmsOverlay,\r\n            overlayTransaction,\r\n            wmsOverlayId = emp.helpers.id.newGUID();\r\n\r\n        wmsOverlay = new emp.typeLibrary.Overlay({\r\n            name: \"WMS Map Layers\",\r\n            overlayId: wmsOverlayId\r\n        });\r\n\r\n        oData = {\r\n            instanceId: args.mapInstanceId,\r\n            wmsOverlayId: wmsOverlayId,\r\n            overlay: wmsOverlay\r\n        };\r\n        instanceData[args.mapInstanceId] = oData;\r\n\r\n        overlayTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_ADD,\r\n            mapInstanceId: args.mapInstanceId,\r\n            source: emp.core.sources.CORE,\r\n            items: [wmsOverlay]\r\n        });\r\n\r\n        overlayTransaction.queue();\r\n    },\r\n    /**\r\n     * Deletes a WMS instance from the emp.wms store\r\n     * @param {object} args\r\n     * @param {string} args.mapInstanceId\r\n     */\r\n    removeMapInstance: function(args){\r\n        if (instanceData.hasOwnProperty(args.mapInstanceId))\r\n        {\r\n            delete instanceData[args.mapInstanceId];\r\n        }\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n","/*global emp */\r\n/**\r\n * Controller for register APIs\r\n * @memberof emp\r\n * @private\r\n * @namespace\r\n */\r\nemp.api = {\r\n\tsources: [],\r\n\tcheckApiSource: function( source ){\r\n\t\tvar isApiSource = false,\r\n\t\ti,\r\n\t\tlen = emp.api.sources.length;\r\n\r\n\t\tfor(i=0; i<len; i++){\r\n\t\t\tif(source === emp.api.sources[i] ){\r\n\t\t\t\tisApiSource = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isApiSource;\r\n\t}\r\n};\r\n","/*global emp, cmapi */\r\n\r\n/**\r\n * emp Name Space\r\n * @namespace  emp\r\n * @type {Object}\r\n */\r\n\r\n/**\r\n * emp.intents Name Space\r\n * @namespace emp.intents\r\n * @memberOf emp\r\n * @type {Object}\r\n */\r\nemp.intents = {};\r\n\r\n/**\r\n * Enum emp.intents.control\r\n * @readonly\r\n * @memberOf emp.intents\r\n * @enum {object}\r\n */\r\n\r\nemp.intents.control = {\r\n  /**\r\n   * @constant\r\n   * @desc Intent used when requesting the map's status.\r\n   */\r\n  STATUS: \"status\",\r\n  STATUS_RESET: \"status.reset\",\r\n  STATUS_DESTROY: \"status.destroy\",\r\n  MODE_GET: \"mode.get\",\r\n  MODE_SET: \"mode.set\",\r\n  CAPTURE_SCREENSHOT: \"capture.screenshot\",\r\n  FEATURE_ADD: \"feature.add\",\r\n  MP_FEATURE_ADD: \"multiparent.feature.add\",\r\n  FREEHAND_START: \"freehand.start\",\r\n  FREEHAND_STOP: \"freehand.stop\",\r\n  FREEHAND_LINE_DRAW_START: \"freehand.linedraw.start\",\r\n  FREEHAND_LINE_DRAW_END: \"freehand.linedraw.end\",\r\n  FREEHAND_LINE_DRAW_UPDATE: \"freehand.linedraw.update\",\r\n  MAP_SERVICE_ADD: \"mapservice.add\",\r\n  MAP_SERVICE_REMOVE: \"mapservice.remove\",\r\n  WMS_ADD: \"wms.add\",\r\n  WMS_REMOVE: \"wms.remove\",\r\n  WMTS_ADD: \"wmts.add\",\r\n  WMTS_REMOVE: \"wmts.remove\",\r\n  KMLLAYER_ADD: \"kmllayer.add\",\r\n  KMLLAYER_REMOVE: \"kmllayer.remove\",\r\n  FEATURE_OUTBOUND_PLOT: \"feature.outbound.plot\",\r\n  FEATURE_REMOVE: \"feature.remove\",\r\n  MP_FEATURE_REMOVE: \"multiparent.feature.remove\",\r\n  FEATURE_UPDATE: \"feature.update\",\r\n  MAP_CONFIG: \"map.config\",\r\n  DRAW_BEGIN: \"draw.begin\",\r\n  DRAW_CANCEL: \"draw.cancel\",\r\n  DRAW_COMPLETE: \"draw.complete\",\r\n  EDIT_BEGIN: \"edit.begin\",\r\n  EDIT_CANCEL: \"edit.cancel\",\r\n  EDIT_END: \"edit.end\",\r\n  EDIT_ENDED: \"edit.ended\",\r\n  SELECTION_GET: \"selection.get\",\r\n  SELECTION_SET: \"selection.set\",\r\n  SELECTION_CLEAR: \"selection.clear\",\r\n  GET_LATLON_FROM_XY: \"getLatLonFromXY\",\r\n  GET_XY_FROM_LATLON: \"getXYFromLatLon\",\r\n  /**\r\n   * @description Internal constant used to directed selection events out the selection channel.\r\n   */\r\n  SELECTION_OUTBOUND: \"selection-outbound\",\r\n  /**\r\n   * @description Internal constant used to directed deselection events out the deselection channel.\r\n   */\r\n  DESELECTION_OUTBOUND: \"deselection-outbound\",\r\n  OVERLAY_ADD: \"overlay.add\",\r\n  OVERLAY_REMOVE: \"overlay.remove\",\r\n  OVERLAY_UPDATE: \"overlay.update\",\r\n  OVERLAY_CLEAR: \"overlay.clear\",\r\n  OVERLAY_STYLE: \"overlay.style\",\r\n  MP_OVERLAY_ADD: \"multiparent.overlay.add\",\r\n  MP_OVERLAY_REMOVE: \"multiparent.overlay.remove\",\r\n  VISIBILITY_SET: \"visibility.set\",\r\n  MI_VISIBILITY_SET: \"map.instance.visibility.set\",\r\n  VISIBILITY_GET: \"visibility.get\",\r\n  LAYER_ADD: \"layer.add\",\r\n  LAYER_REMOVE: \"layer.remove\",\r\n  LAYER_UPDATE: \"layer.update\",\r\n  LAYER_GET: \"layer.get\",\r\n  VIEW_LOCK: \"view.lock\",\r\n  VIEW_SET: \"view.set\",\r\n  VIEW_GET: \"view.get\",\r\n  LOOKAT_SET: \"lookAt.set\",\r\n  //STATIC_ADD: \"staticContent.add\",\r\n  GET: \"map.get\",\r\n  EDIT_UPDATE: \"edit.update\",\r\n  DRAW_UPDATE: \"draw.update\",\r\n  EVENT_MAP_CLICK: \"map.click\",\r\n  MIL_ICON_SIZE_SET: \"mil.icon.size\",\r\n  MIL_ICON_LABELS_SET: \"mil.icon.labels.set\",\r\n  PROJECTION_ENABLE_FLAT: \"projection.enable.Flat\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.Error events.\r\n   */\r\n  ERROR: \"error\",\r\n  /**\r\n   * @description Register for emp.map.eventing.MapStateChangeEvent events.\r\n   * Anytime the state of the map engine changes an event to indicate the current status will be dispatched.\r\n   * Status indicate if the map is initializing, failed to initialize (catastrophic failure, ready to receive data\r\n   */\r\n  STATUS_CHANGE: \"status-change\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.CLICK events.\r\n   */\r\n  CLICK: \"click\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.CLICK events.\r\n   */\r\n  FEATURE_CLICK: \"feature.click\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.POINTER events.\r\n   */\r\n  POINTER: \"pointer\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.SELECTION_BOX events.\r\n   */\r\n  SELECTION_BOX: \"selection.box\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.VIEW_CHANGE events.\r\n   */\r\n  VIEW_CHANGE: \"view-change\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.SELECTION_CHANGE events.\r\n   */\r\n  SELECTION_CHANGE: \"selection-change\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.STATIC_CONTENT events.\r\n   */\r\n  STATIC_CONTENT: \"static-content\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.DRAW_ENDED events.\r\n   */\r\n  DRAW_ENDED: \"draw.ended\",\r\n  /**\r\n   * @description Constant used to have the ME end the drawing.\r\n   */\r\n  DRAW_END: \"draw.end\",\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.DRAW_START events.\r\n   */\r\n  DRAW_START: \"draw.start\",\r\n\r\n  /**\r\n   * @description Constant used to register for emp.map.eventing.EDIT_START events.\r\n   */\r\n  EDIT_START: \"edit.start\",\r\n  /**\r\n   * @description Constant used to register for notification when the underlying environment is ready.\r\n   */\r\n  ENVIRONMENT_READY: \"environment.ready\",\r\n  /**\r\n   * @private\r\n   * @description his is a catch all intent only used of the transactionQueue to event out every transaction that completes.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  TRANSACTION_COMPLETE: \"transaction.complete\",\r\n  /**\r\n   * @private\r\n   * @description this is a catch all intent only used for the transactionQueue to event out every transaction that has progress events like drawing and editing.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  TRANSACTION_PROGRESS: \"transaction.progress\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used internally to generate the response of the\r\n   * map status request about.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  STATUS_RESPONSE_ABOUT: \"status.response.about\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used internally to generate the response of the\r\n   * map status request format.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  STATUS_RESPONSE_FORMAT: \"status.response.format\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used internally to generate the response of the\r\n   * map status request selected.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  STATUS_RESPONSE_SELECTED: \"status.response.selected\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used internally to generate the response of the\r\n   * map status request init.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  STATUS_RESPONSE_INIT: \"status.response.init\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used to generate a screen shot request to the mpa engine..\r\n   */\r\n  STATUS_REQUEST_SCREENSHOT: \"status.request.screenshot\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used internally to generate the response of the\r\n   * map status request coordinate system.\r\n   * This value SHALL NOT be used for an actual transaction intent\r\n   */\r\n  STATUS_RESPONSE_COORD_SYSTEM: \"status.response.coordinatesystem\",\r\n  VIEW_COORDINATESYSTEM: \"view.coordinatesystem\",\r\n  OVERLAY_CLUSTER_SET: \"overlay.cluster.set\",\r\n  OVERLAY_CLUSTER_ACTIVATE: \"overlay.cluster.activate\",\r\n  OVERLAY_CLUSTER_DEACTIVATE: \"overlay.cluster.deactivate\",\r\n  OVERLAY_CLUSTER_REMOVE: \"overlay.cluster.remove\",\r\n  MAP_CURSOR_MODE_SET: \"map.cursor.mode.set\",\r\n\r\n\r\n  /**\r\n   * @private\r\n   * @description This intent is used to indicate that a map engine swap has started.\r\n   */\r\n  MAP_ENGINE_SWAP_START: \"map.engine.swap.start\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used to indicate that a map engine swap has completed.\r\n   */\r\n  MAP_ENGINE_SWAP_COMPLETE: \"map.engine.swap.complete\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used to indicate that a map engine swap has been requested.\r\n   */\r\n  MAP_SWAP: \"map.swap\",\r\n  /**\r\n   * @private\r\n   * @description This intent is used to indicate that he storage engine reload has completed.\r\n   */\r\n  STORAGE_RELOAD_COMPLETE: \"storage.reload.complete\",\r\n  /**\r\n   *\r\n   * @private\r\n   */\r\n  CMAPI_GENERIC_FEATURE_REMOVE: \"cmapi.generic.feature.remove\",\r\n  EMP_UI_INSTANCE_INIT: \"emp.ui.instance.init\",\r\n\r\n  MI_OVERLAY_ADD: \"map.instance.overlay.add\",\r\n\r\n  MI_FEATURE_ADD: \"map.instance.feature.add\",\r\n  MI_FEATURE_UPDATE: \"map.instance.feature.update\",\r\n  MI_FEATURE_REMOVE: \"map.instance.feature.remove\",\r\n\r\n  MI_WMS_ADD: \"map.instance.wms.add\",\r\n  MI_WMS_REMOVE: \"map.instance.wms.remove\",\r\n\r\n  MI_WMTS_ADD: \"map.instance.wmts.add\",\r\n  MI_WMTS_REMOVE: \"map.instance.wmts.remove\",\r\n\r\n  MI_KML_LAYER_ADD: \"map.instance.kml.add\",\r\n  MI_KML_LAYER_REMOVE: \"map.instance.kml.remove\",\r\n\r\n  STORAGE_OBJECT_ADDED: \"storage.object.added\",\r\n  STORAGE_OBJECT_REMOVED: \"storage.object.removed\",\r\n  STORAGE_OBJECT_UPDATED: \"storage.object.updated\",\r\n  STORAGE_OBJECT_CHILD_REMOVED: \"storage.object.child.removed\"\r\n};\r\n\r\n/**\r\n * Control handler for Map swapping\r\n * @protected\r\n * @memberOf emp.intents.control\r\n * @type {Object}\r\n */\r\nemp.intents.control._func = {\r\n  SE: \"store\",\r\n  API: \"normal\"\r\n};\r\n/**\r\n * Used to modify control components\r\n * @param  {object} args\r\n * @return {void}\r\n */\r\nemp.intents.control.register = function(args) {\r\n  emp.intents.control._func[args.component] = args.func;\r\n};\r\n\r\nemp.intents.control.storageHandleSuccess = function(args) {\r\n  var fnStorageHandler = emp.storage[emp.intents.control._func.SE];\r\n\r\n  if (fnStorageHandler) {\r\n    fnStorageHandler(args);\r\n  }\r\n};\r\n\r\nemp.intents.control.transactionComplete = function(args) {\r\n  switch (emp.intents.control._func.API) {\r\n    case \"normal\":\r\n      //emp.transactionQueue._complete(args);\r\n      emp.transactionQueue._complete(args);\r\n      break;\r\n    case \"reload\":\r\n      emp.storage.processTransactionComplete(args);\r\n      break;\r\n  }\r\n};\r\n\r\n/**\r\n * This is a temporary function used to determine if we should use new core\r\n * editing or the old editing.  Once the full transtion to the new editing is\r\n * done remove this.\r\n */\r\nemp.intents.control.useNewEditing = function(args) {\r\n  var result = false;\r\n\r\n  // At this point we need to decide if we are doing this the\r\n  // old way or new way.  Until all the editors or done, we must\r\n  // support both.\r\n  //\r\n  // In this case we need the format and drawCategory (if it's a MILSymbol)\r\n  // This will tell me if this is something the new core editors\r\n  // handle\r\n  //\r\n  // remove this code after all core editors have been complete.\r\n  var originalFeature = args.items[0].originFeature;\r\n  var symbol;\r\n  var symbolCode;\r\n  var standard;\r\n  var basicCode;\r\n  var symbolDef;\r\n  var unitDef;\r\n  var drawCategory;\r\n\r\n  // Determine if this is a MIL Symbol.  The mil symbol categories can greatly\r\n  // vary, so we need to know the symbol code and standard for this.\r\n  if (originalFeature.format === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL) {\r\n    symbol = true;\r\n\r\n    // get the symbolCode of the MIL Std feature\r\n    symbolCode = originalFeature.data.symbolCode;\r\n\r\n    // Get which standard the symbol is using, by default it is MIL-STD-2525C.\r\n    if (originalFeature.properties && originalFeature.properties.modifiers) {\r\n      standard = originalFeature.properties.modifiers.standard || 1;\r\n    }\r\n\r\n    basicCode = armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(symbolCode, standard);\r\n\r\n    // Determine the draw category.  We do this using our renderer's utility\r\n    // methods.  The draw category tells us what type of editor to use.\r\n    if (armyc2.c2sd.renderer.utilities.SymbolDefTable.hasSymbolDef(basicCode, standard)) {\r\n      symbolDef = armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicCode, standard);\r\n      if (symbolDef) {\r\n        drawCategory = symbolDef.drawCategory;\r\n      }\r\n    } else {\r\n      unitDef = armyc2.c2sd.renderer.utilities.UnitDefTable.getUnitDef(basicCode, standard);\r\n      if (unitDef) {\r\n        drawCategory = unitDef.drawCategory;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (originalFeature.format === emp3.api.enums.FeatureTypeEnum.GEO_POINT ||\r\n    (symbol && drawCategory === armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_POINT)) {\r\n    result = true;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nemp.intents.control.intentSequenceMapper = (function() {\r\n  /*\r\n   * This var contains the intent sequence mapping.\r\n   */\r\n  var intentSequenceMapper = [];\r\n\r\n  intentSequenceMapper[emp.intents.control.ERROR] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Error]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.SELECTION_OUTBOUND] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.DESELECTION_OUTBOUND] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.EDIT_UPDATE] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.DRAW_UPDATE] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MAP_CURSOR_MODE_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engines.isMapSwapInProgress()) {\r\n              args.queue();\r\n            }\r\n            else if (oMapInstance.engine) {\r\n              oMapInstance.engine.cursor.mode.set(args);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.GET_LATLON_FROM_XY] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.view.getLatLonFromXY(args);\r\n            }\r\n          }\r\n          return undefined;\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.GET_XY_FROM_LATLON] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.view.getXYFromLatLon(args);\r\n            }\r\n          }\r\n          return undefined;\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.FREEHAND_START] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          var item = args.items[0];\r\n\r\n          if (oMapInstance) {\r\n            oMapInstance.freehandStart(item);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.FREEHAND_STOP] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.freehandStop();\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MAP_CONFIG] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.map.config(args);\r\n            }\r\n\r\n            // some properties are not handled by the engines.\r\n            // check for these properties and route them appropriately.\r\n            var item = args.items[0];\r\n            if (item && item.freehandStrokeStyle) {\r\n              oMapInstance.setFreehandStrokeStyle(item.freehandStrokeStyle);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.SELECTION_CHANGE] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.selection.selectionChange\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Selection]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.CLICK] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Click]\r\n    };\r\n  };\r\n  /*\r\n  LEGACY, remove if this comment does not cause issue\r\n  intentSequenceMapper[emp.intents.control.STATUS] = function(args)\r\n  {\r\n      return {\r\n        forward: [\r\n          emp.status.get\r\n        ],\r\n        exit: [\r\n          emp.intents.control.transactionComplete\r\n        ],\r\n        constructor: [emp.typeLibrary.Status]\r\n      };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.STATUS_RESET] = function(args)\r\n  {\r\n      return {\r\n        forward: [\r\n          emp.status.get\r\n        ],\r\n        exit: [\r\n          emp.intents.control.transactionComplete\r\n        ]\r\n      };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.STATUS_DESTROY] = function(args)\r\n  {\r\n      return {\r\n        forward: [\r\n          emp.status.get\r\n        ],\r\n        exit: [\r\n          emp.intents.control.transactionComplete\r\n        ]\r\n      };\r\n  };\r\n  */\r\n  intentSequenceMapper[emp.intents.control.CAPTURE_SCREENSHOT] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MI_FEATURE_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.feature.add(args);\r\n            }\r\n          }\r\n          return undefined;\r\n        },\r\n        function(transaction) {\r\n          // This raises a feature added event to the API.  Notifies callers\r\n          // a map instance has successfully added a number of items.\r\n          var oMapInstance = emp.instanceManager.getInstance(transaction.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            var publisher = cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD];\r\n            if (publisher) {\r\n              publisher.process(transaction);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MI_FEATURE_UPDATE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          // Updates features on the map engine.\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.feature.add(args);\r\n            }\r\n          }\r\n          return undefined;\r\n        },\r\n        function(transaction) {\r\n          // This raises a feature updated event to the API.  Notifies callers\r\n          // a map instance has successfully updated a number of items.\r\n          var oMapInstance = emp.instanceManager.getInstance(transaction.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            var publisher = cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE];\r\n            if (publisher) {\r\n              publisher.process(transaction);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MI_FEATURE_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          // removes features from map engine.\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            oMapInstance.status.cancelDrawEditForFeatureRemove(args);\r\n          }\r\n        },\r\n        function(args) {\r\n          // Sends out an event back to the api that items have been removed\r\n          // from the map.\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.feature.remove(args);\r\n            }\r\n          }\r\n        },\r\n        function(transaction) {\r\n          var oMapInstance = emp.instanceManager.getInstance(transaction.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            var publisher = cmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE];\r\n            if (publisher) {\r\n              publisher.process(transaction);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.FEATURE_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.feature.validateAdd,\r\n        emp.storage.feature.add\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MAP_SERVICE_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.mapservice.validateAdd,\r\n        emp.storage.mapservice.add\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MAP_SERVICE_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.mapservice.remove\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MI_WMS_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.wms.add(args);\r\n            }\r\n          }\r\n\r\n          // Since this is processed by only the map instance\r\n          // console.error all the failures that occur so the developer\r\n          // will have\r\n          if (args.failures.length > 0) {\r\n            for (var i = 0; i < args.failures.length; i++) {\r\n              console.error(args.failures[i].message);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MI_WMTS_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.wmts.add(args);\r\n            }\r\n          }\r\n\r\n          // Since this is processed by only the map instance\r\n          // console.error all the failures that occur so the developer\r\n          // will have\r\n          if (args.failures.length > 0) {\r\n            for (var i = 0; i < args.failures.length; i++) {\r\n              console.error(args.failures[i].message);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MI_WMS_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.wms.remove(args);\r\n            }\r\n          }\r\n\r\n          // Since this is processed by only the map instance\r\n          // console.error all the failures that occur so the developer\r\n          // will have\r\n          if (args.failures.length > 0) {\r\n            for (var i = 0; i < args.failures.length; i++) {\r\n              console.error(args.failures[i].message);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MI_KML_LAYER_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.kmllayer.add(args);\r\n            }\r\n          }\r\n\r\n          // Since this is processed by only the map instance\r\n          // console.error all the failures that occur so the developer\r\n          // will have\r\n          if (args.failures.length > 0) {\r\n            for (var i = 0; i < args.failures.length; i++) {\r\n              console.error(args.failures[i].message);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MI_KML_LAYER_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.kmllayer.remove(args);\r\n            }\r\n          }\r\n\r\n          // Since this is processed by only the map instance\r\n          // console.error all the failures that occur so the developer\r\n          // will have\r\n          if (args.failures.length > 0) {\r\n            for (var i = 0; i < args.failures.length; i++) {\r\n              console.error(args.failures[i].message);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.MI_WMTS_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engine) {\r\n              oMapInstance.engine.wmts.remove(args);\r\n            }\r\n          }\r\n\r\n          // Since this is processed by only the map instance\r\n          // console.error all the failures that occur so the developer\r\n          // will have\r\n          if (args.failures.length > 0) {\r\n            for (var i = 0; i < args.failures.length; i++) {\r\n              console.error(args.failures[i].message);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.FEATURE_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.feature.remove\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.FEATURE_UPDATE] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.feature.validateUpdate,\r\n        emp.storage.feature.update\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.VISIBILITY_GET] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.visibility.getState\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.VISIBILITY_SET] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.visibility.set\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MI_VISIBILITY_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.visibility.set(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.Feature]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.DRAW_BEGIN] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.validateDraw,\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.status.validateState(args);\r\n          }\r\n        },\r\n        emp.storage.editBegin,\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.draw.begin(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.storage.editTransCplt,\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Draw]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.DRAW_END] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.draw.end(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.Draw]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.DRAW_CANCEL] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.draw.cancel(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.Draw]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.EDIT_BEGIN] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.validateEdit,\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.status) {\r\n            oMapInstance.status.validateState(args);\r\n          }\r\n        },\r\n        emp.storage.editBegin,\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n          var useNewEditing;\r\n\r\n          // Check to see if we are using the new editing for this feature.\r\n          useNewEditing = emp.intents.control.useNewEditing(args);\r\n\r\n          if (useNewEditing) {\r\n            // new editing.\r\n            if (oMapInstance && oMapInstance.editingManager) {\r\n              oMapInstance.editingManager.get().edit(args);\r\n            }\r\n          } else {\r\n              // old editing.\r\n            if (oMapInstance && oMapInstance.engine) {\r\n              oMapInstance.engine.edit.begin(args);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.storage.editTransCplt,\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Edit]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.EDIT_END] = function() {\r\n    return {\r\n      forward: [\r\n\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          // Check to see if we are using the new editing for this feature.\r\n          var useNewEditing = emp.intents.control.useNewEditing(args);\r\n\r\n          if (useNewEditing) {\r\n            if (oMapInstance && oMapInstance.status) {\r\n              oMapInstance.editingManager.get().complete(args);\r\n            }\r\n          } else {\r\n            if (oMapInstance && oMapInstance.engine) {\r\n              oMapInstance.engine.edit.end(args);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.Edit]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.EDIT_CANCEL] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          // Check to see if we are using the new editing for this feature.\r\n          var useNewEditing = emp.intents.control.useNewEditing(args);\r\n\r\n          if (useNewEditing) {\r\n            if (oMapInstance && oMapInstance.status) {\r\n              oMapInstance.editingManager.get().cancel(args);\r\n            }\r\n          } else {\r\n            if (oMapInstance && oMapInstance.engine) {\r\n              oMapInstance.engine.edit.cancel(args);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.Edit]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.SELECTION_GET] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.get.selected\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Selection]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.SELECTION_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.selection.set(args);\r\n          }\r\n        },\r\n        emp.storage.selection.set\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Selection]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.SELECTION_CLEAR] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Selection]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MI_OVERLAY_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.overlay.add(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.Overlay]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_ADD] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.overlay.validateAdd,\r\n        emp.storage.overlay.add\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Overlay]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engines.validateOverlayRemoval(args);\r\n          }\r\n        },\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.status) {\r\n            oMapInstance.status.cancelDrawEditForOverlayRemove(args);\r\n          }\r\n        },\r\n        emp.storage.overlay.remove\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Overlay]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_UPDATE] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.overlay.validateUpdate,\r\n        emp.storage.overlay.update\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Overlay]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_CLEAR] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engines.validateOverlayClear(args);\r\n          }\r\n        },\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.status.cancelDrawEditForOverlayRemove(args);\r\n          }\r\n        },\r\n        emp.storage.overlay.clear\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.Overlay]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.VIEW_LOCK] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.navigation.enable(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.VIEW_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.view.set(args);\r\n          }\r\n        },\r\n        emp.storage.view.set\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.View]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.VIEW_GET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.view.get(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.transactionQueue._custom\r\n      ],\r\n      constructor: [emp.typeLibrary.View]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.LOOKAT_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var mapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n          if (mapInstance && mapInstance.engine) {\r\n            mapInstance.engine.lookAt.set(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: []\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.VIEW_COORDINATESYSTEM] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [\r\n        emp.intents.control.transactionComplete\r\n      ],\r\n      constructor: [emp.typeLibrary.View]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.GET] = function() {\r\n    return {\r\n      forward: [emp.storage.query],\r\n      exit: [emp.intents.control.transactionComplete],\r\n      constructor: [emp.typeLibrary.Status]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_STYLE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.overlay.style(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete],\r\n      constructor: [emp.typeLibrary.Overlay]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MIL_ICON_LABELS_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.settings.mil2525.icon.labels.set(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MIL_ICON_SIZE_SET] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.settings.mil2525.icon.size.set(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_SET] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.overlay.validateCluster,\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.overlay.cluster.set(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_ACTIVATE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.overlay.cluster.activate(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.overlay.cluster.deactivate(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.OVERLAY_CLUSTER_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.overlay.cluster.remove(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.PROJECTION_ENABLE_FLAT] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.projection.enable.flat(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.STATUS_REQUEST_SCREENSHOT] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance && oMapInstance.engine) {\r\n            oMapInstance.engine.capture.screenshot(args);\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n\r\n  intentSequenceMapper[emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE] = function() {\r\n    return {\r\n      forward: [\r\n        cmapi.channel.support.genericFeatureRemove\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.EMP_UI_INSTANCE_INIT] = function() {\r\n    return {\r\n      forward: [],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.STATIC_CONTENT] = function() {\r\n    return {\r\n      forward: [\r\n        emp.storage.staticContent.add\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.STATUS_CHANGE] = function() {\r\n    return {\r\n      forward: [\r\n        emp.instanceManager.statusChangeHdlr\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.MAP_SWAP] = function() {\r\n    return {\r\n      forward: [\r\n        function(args) {\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n\r\n          if (oMapInstance) {\r\n            if (oMapInstance.engines.isMapSwapInProgress()) {\r\n              args.fail({\r\n                coreId: args.items[0].mapId,\r\n                level: emp.typeLibrary.Error.level.MAJOR,\r\n                message: 'Previous map engine swap execution is still in progress.'\r\n              });\r\n            }\r\n            else {\r\n              oMapInstance.engines.load(args.items[0].engine);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      exit: [emp.intents.control.transactionComplete]\r\n    };\r\n  };\r\n  intentSequenceMapper[emp.intents.control.POINTER] = function() {\r\n    return {\r\n      forward: [  /*\r\n        function(transaction) {\r\n\r\n          // check to see if we are in edit mode, if not exit.\r\n          var oMapInstance = emp.instanceManager.getInstance(args.mapInstanceId);\r\n          var pointer = transaction.items[0];\r\n\r\n          if (oMapInstance && oMapInstance.editingManager) {\r\n            if (pointer.type === emp.typeLibrary.Pointer.EventType.DRAG) {\r\n\r\n            }\r\n          }\r\n\r\n          // is it a feature drag event?\r\n          //\r\n          //   if so is it an editing feature?\r\n          //\r\n          //\r\n        }*/\r\n      ],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  };\r\n  return intentSequenceMapper;\r\n}());\r\n\r\n/**\r\n * Used to retrieve the work flow for specific intent enumeration from emp.intents.control\r\n * @param {object} args\r\n * @param {string} args.intent\r\n */\r\nemp.intents.getSequence = function(args) {\r\n  var response;\r\n  var fnResponse = emp.intents.control.intentSequenceMapper[args.intent];\r\n\r\n  if (fnResponse === undefined) {\r\n    // emp.intents.control.DRAW_START:\r\n    // emp.intents.control.DRAW_ENDED:\r\n    // emp.intents.control.EDIT_START:\r\n    // emp.intents.control.STATUS_RESPONSE_ABOUT:\r\n    // emp.intents.control.STATUS_RESPONSE_FORMAT:\r\n    // emp.intents.control.STATUS_RESPONSE_SELECTED:\r\n    // emp.intents.control.STATUS_RESPONSE_INIT:\r\n    // emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM:\r\n    // emp.intents.control.VIEW_COORDINATESYSTEM:\r\n    // emp.intents.control.FEATURE_OUTBOUND_PLOT:\r\n    // emp.intents.control.FEATURE_CLICK\r\n    // emp.intents.control.CLICK\r\n    // emp.intents.control.VIEW_CHANGE\r\n    // emp.intents.control.MAP_ENGINE_SWAP_STARTED\r\n    // emp.intents.control.MAP_ENGINE_SWAP_COMPLETE\r\n    // emp.intents.control.STORAGE_RELOAD_COMPLETE\r\n    // emp.intents.control.STORAGE_OBJECT_ADDED\r\n    // emp.intents.control.STORAGE_OBJECT_REMOVED\r\n    // emp.intents.control.STORAGE_OBJECT_UPDATED\r\n    // emp.intents.control.STORAGE_OBJECT_CHILD_REMOVED\r\n    // emp.intents.control.FREEHAND_LINE_DRAW_START\r\n    // emp.intents.control.FREEHAND_LINE_DRAW_END\r\n    // emp.intents.control.FREEHAND_LINE_DRAW_UPDATE\r\n\r\n    response = {\r\n      forward: [],\r\n      exit: [emp.transactionQueue._custom]\r\n    };\r\n  }\r\n  else {\r\n    response = fnResponse(args);\r\n  }\r\n\r\n  return response;\r\n};\r\n","/*global Storage, localStorage */\r\n\r\n/**\r\n * @private\r\n * @namespace\r\n */\r\nemp.prefs = (function() {\r\n\r\n  /**\r\n   *\r\n   * @param args\r\n   * @returns {*}\r\n   */\r\n  function getPref(args) {\r\n    var value = null,\r\n      raw;\r\n    try {\r\n      if (typeof Storage !== \"undefined\") {\r\n\r\n        raw = localStorage[args.key];\r\n        if (raw !== undefined && raw !== null) {\r\n          value = JSON.parse(raw);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      emp.typeLibrary.Error({\r\n        jsError: err,\r\n        level: emp.typeLibrary.Error.MINOR,\r\n        message: \"emp.prefs was unable to retrieve the value of: '\" + args.key + \"'. Please see the jsError for more details\"\r\n      });\r\n    }\r\n\r\n    return value;\r\n  }\r\n  /**\r\n   * @protected\r\n   * @memberOf emp.prefs\r\n   * @param  {object} args\r\n   * @return {void}\r\n   */\r\n  function savePref(args) {\r\n    var success = false;\r\n    try {\r\n      if (typeof Storage !== \"undefined\") {\r\n\r\n        localStorage[args.key] = JSON.stringify(args.value);\r\n        success = true;\r\n      }\r\n    } catch (err) {\r\n      emp.typeLibrary.Error({\r\n        jsError: err,\r\n        level: emp.typeLibrary.Error.MINOR,\r\n        message: \"emp.prefs was unable to save the value of: '\" + args.key + \"'. Please see the jsError for more details\"\r\n      });\r\n    }\r\n    return success;\r\n  }\r\n  /**\r\n   * @memberOf emp.prefs\r\n   * @protected\r\n   * @param  {void} args\r\n   * @return {void}\r\n   */\r\n  function clearPref(args) {\r\n    try {\r\n      if (typeof Storage !== \"undefined\") {\r\n\r\n        delete localStorage[args.key];\r\n      }\r\n    } catch (err) {\r\n      emp.typeLibrary.Error({\r\n        jsError: err,\r\n        level: emp.typeLibrary.Error.MINOR,\r\n        message: \"emp.prefs was unable to clear the value of: '\" + args.key + \"'. Please see the jsError for more details\"\r\n      });\r\n    }\r\n  }\r\n\r\n  var publicInterface = {\r\n    /**\r\n     * @memberOf emp.prefs\r\n     * @public\r\n     * @namespace  engine\r\n     * @type {Object}\r\n     */\r\n    engine: {\r\n      /**\r\n       * @memberOf emp.prefs.engine\r\n       * @param {string} engine\r\n       */\r\n      set: function(engine) {\r\n        savePref({\r\n          key: \"engine\",\r\n          value: engine\r\n        });\r\n      },\r\n      /**\r\n       * @memberOf emp.prefs.engine\r\n       * @return {object}\r\n       */\r\n      get: function() {\r\n        return getPref({\r\n          key: \"engine\"\r\n        });\r\n      },\r\n      /**\r\n       * @memberOf emp.prefs.engine\r\n       * @return {void}\r\n       */\r\n      clear: function() {\r\n        clearPref({\r\n          key: \"engine\"\r\n        });\r\n        alert(\"Your default map engine selection has been cleared.  You will be asked to choose an engine the next time the map is restarted\");\r\n      }\r\n    }\r\n\r\n  };\r\n  return publicInterface;\r\n\r\n}());\r\n","// Define cmapi namespaces\r\nvar cmapi = cmapi || {};\r\ncmapi.channel = cmapi.channel || {};\r\ncmapi.channel.schema = cmapi.channel.schema || {};\r\ncmapi.channel.handler = cmapi.channel.handler || {};\r\ncmapi.channel.publisher = cmapi.channel.publisher || {};\r\ncmapi.channel.support = cmapi.channel.support || {};\r\n\r\n\r\ncmapi.typeLibrary = cmapi.typeLibrary || {};\r\n\r\ncmapi.map = cmapi.map || {};\r\ncmapi.map.message = cmapi.map.message || {};\r\ncmapi.map.message.complete = cmapi.map.message.complete || {};\r\ncmapi.map.message.complete.builder = cmapi.map.message.complete.builder || {};\r\ncmapi.map.message.progress = cmapi.map.message.progress || {};\r\ncmapi.map.message.progress.builder = cmapi.map.message.progress.builder || {};\r\n","/*global cmapi */\r\n\r\n/**\r\n * @memberOf cmapi.channel\r\n * @enum\r\n * @readonly\r\n */\r\ncmapi.channel.names = {\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    CMAPI2_VISIBILITY_GET: \"cmapi2.visibility.get\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    CMAPI2_MAP_CONFIG: \"cmapi2.map.config\",\r\n    CMAPI2_FEATURE_EVENT_ADD: \"cmapi2.map.feature.event.add\",\r\n    CMAPI2_FEATURE_EVENT_REMOVE: \"cmapi2.map.feature.event.remove\",\r\n    CMAPI2_FEATURE_EVENT_UPDATE: \"cmapi2.map.feature.event.update\",\r\n    CMAPI2_FREEHAND_START: \"cmapi2.map.freehand.start\",\r\n    CMAPI2_FREEHAND_STOP: \"cmapi2.map.freehand.stop\",\r\n    CMAPI2_FREEHAND_LINE_DRAW: \"cmapi2.map.freehand.linedraw\",\r\n    CMAPI2_MAP_DRAG: \"cmapi2.map.view.drag\",\r\n    CMAPI2_MAP_DRAG_COMPLETE: \"cmapi2.map.view.dragComplete\",\r\n    CMAPI2_FEATURE_DRAG: \"cmapi2.map.feature.drag\",\r\n    CMAPI2_FEATURE_DRAG_COMPLETE: \"cmapi2.map.feature.dragComplete\",\r\n\r\n\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_SHUTDOWN: \"map.shutdown\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_CONVERT: \"map.convert\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_SWAP: \"map.swap\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MESSAGE_COMPLETE: \"map.message.complete\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MESSAGE_PROGRESS: \"map.message.progress\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MESSAGE_CANCEL: \"map.message.cancel\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_CREATE: \"map.overlay.create\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_REMOVE: \"map.overlay.remove\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_HIDE: \"map.overlay.hide\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_SHOW: \"map.overlay.show\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_UPDATE: \"map.overlay.update\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_STYLE: \"map.overlay.style\",\r\n        /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_CLUSTER_SET: \"map.overlay.cluster.set\",\r\n            /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_CLUSTER_ACTIVATE: \"map.overlay.cluster.activate\",\r\n            /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_CLUSTER_DEACTIVATE: \"map.overlay.cluster.deactivate\",\r\n            /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_CLUSTER_REMOVE: \"map.overlay.cluster.remove\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_OVERLAY_CLEAR: \"map.overlay.clear\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_DESELECTED: \"map.feature.deselected\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_SELECTED: \"map.feature.selected\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_PLOT: \"map.feature.plot\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_PLOT_URL: \"map.feature.plot.url\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_UNPLOT: \"map.feature.unplot\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_HIDE: \"map.feature.hide\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_SHOW: \"map.feature.show\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_UPDATE: \"map.feature.update\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_EDIT: \"map.feature.edit\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_DRAW: \"map.feature.draw\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_CLICKED: \"map.feature.clicked\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_MOUSEUP: \"map.feature.mouseup\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_MOUSEDOWN: \"map.feature.mousedown\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    //MAP_SYMBOL_FEATURE_PLOT: \"mil.symbology.feature.plot\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    //MAP_SYMBOL_FEATURE_DRAW: \"mil.symbology.feature.draw\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_ZOOM: \"map.view.zoom\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_CENTER_OVERLAY: \"map.view.center.overlay\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_CENTER_FEATURE: \"map.view.center.feature\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_CENTER_LOCATION: \"map.view.center.location\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_CENTER_BOUNDS: \"map.view.center.bounds\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_LOCK: \"map.view.lock\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_CLICKED: \"map.view.clicked\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_MOUSEUP: \"map.view.mouseup\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_MOUSEDOWN: \"map.view.mousedown\",\r\n        /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_MOUSEMOVE: \"map.view.mousemove\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n     MAP_VIEW_AREA_SELECTED: \"map.view.area.selected\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_COORDINATESYSTEM: \"map.view.coordinatesystem\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_GET: \"map.get\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_CREATE: \"map.menu.create\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_CLICKED: \"map.menu.clicked\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_REMOVE: \"map.menu.remove\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_ACTIVE: \"map.menu.active\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_REQUEST: \"map.status.request\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_INITIALIZATION: \"map.status.initialization\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_VIEW: \"map.status.view\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_FORMAT: \"map.status.format\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_ABOUT: \"map.status.about\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_COORDINATESYSTEM: \"map.status.coordinatesystem\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_SCREENSHOT: \"map.status.screenshot\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_SELECTED: \"map.status.selected\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_ERROR: \"map.error\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_TRANSACTION_COMPLETE: \"map.transaction.complete\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_REQUEST_OVERLAYS: \"map.status.request.overlays\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_REQUEST_OVERLAY: \"map.status.request.overlay\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_REQUEST_FEATURE: \"map.status.request.feature\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_REQUEST_FEATURES: \"map.status.request.features\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_OVERLAYS: \"map.status.overlays\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_OVERLAY: \"map.status.overlay\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_FEATURE: \"map.status.feature\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_STATUS_FEATURES: \"map.status.features\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_DRAWING_COMPLETE: \"map.menu.drawing.complete\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_DRAWING_CREATE: \"map.menu.drawing.create\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_MENU_DRAWING_REMOVE: \"map.menu.drawing.remove\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_PLOT_BATCH: \"map.feature.plot.batch\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_UNPLOT_BATCH: \"map.feature.unplot.batch\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_SELECTED_BATCH: \"map.feature.selected.batch\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_FEATURE_DESELECTED_BATCH: \"map.feature.deselected.batch\",\r\n    /**\r\n     * @constant\r\n     * @type string\r\n     */\r\n    MAP_VIEW_LOOKAT_LOCATION: \"map.view.lookat.location\"\r\n};\r\n","/*global emp, cmapi*/\r\n\r\n/**\r\n * Common Map Widget API - See Specification for details\r\n *\r\n * @private\r\n * @namespace\r\n *\r\n */\r\nemp.api.cmapi = emp.api.cmapi || {};\r\nemp.api.cmapi.publisher = emp.api.cmapi.publisher || {};\r\n\r\n/**\r\n * SOURCE Tag\r\n * @protected\r\n * @constant\r\n * @type {string}\r\n */\r\n\r\nemp.api.cmapi.SOURCE = \"emp-api-cmapi\";\r\nemp.api.sources.push(emp.api.cmapi.SOURCE);\r\n\r\nemp.api.cmapiMapInstanceInterface = function(args)\r\n{\r\n\r\n    var mapInstanceId = args.mapInstanceId;\r\n    var _widgetId;\r\n    var channels = [\r\n        cmapi.channel.names.MAP_CONVERT,\r\n        cmapi.channel.names.MAP_OVERLAY_CREATE,\r\n        cmapi.channel.names.MAP_OVERLAY_REMOVE,\r\n        cmapi.channel.names.MAP_OVERLAY_HIDE,\r\n        cmapi.channel.names.MAP_OVERLAY_SHOW,\r\n        cmapi.channel.names.MAP_OVERLAY_UPDATE,\r\n        cmapi.channel.names.MAP_OVERLAY_STYLE,\r\n        cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n        cmapi.channel.names.MAP_FEATURE_UNPLOT,\r\n        cmapi.channel.names.MAP_FEATURE_HIDE,\r\n        cmapi.channel.names.MAP_FEATURE_SHOW,\r\n        cmapi.channel.names.MAP_FEATURE_DESELECTED,\r\n        cmapi.channel.names.MAP_FEATURE_SELECTED,\r\n        cmapi.channel.names.MAP_FEATURE_UPDATE,\r\n        cmapi.channel.names.MAP_FEATURE_EDIT,\r\n        cmapi.channel.names.MAP_FEATURE_DRAW,\r\n        cmapi.channel.names.MAP_VIEW_LOCK,\r\n        cmapi.channel.names.MAP_VIEW_ZOOM,\r\n        cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY,\r\n        cmapi.channel.names.MAP_VIEW_CENTER_FEATURE,\r\n        cmapi.channel.names.MAP_VIEW_CENTER_LOCATION,\r\n        cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS,\r\n        cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,\r\n        cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION,\r\n        cmapi.channel.names.MAP_GET,\r\n        cmapi.channel.names.MAP_SWAP,\r\n        cmapi.channel.names.MAP_STATUS_REQUEST,\r\n        cmapi.channel.names.MAP_MESSAGE_CANCEL,\r\n        cmapi.channel.names.MAP_MESSAGE_COMPLETE,\r\n        cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,\r\n        cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,\r\n        cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH,\r\n        cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH,\r\n        cmapi.channel.names.CMAPI2_VISIBILITY_GET,\r\n        cmapi.channel.names.CMAPI2_MAP_CONFIG,\r\n        cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD,\r\n        cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE,\r\n        cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE,\r\n        cmapi.channel.names.CMAPI2_FREEHAND_START,\r\n        cmapi.channel.names.CMAPI2_FREEHAND_STOP\r\n\r\n    ];\r\n\r\n    var messageHandler = function(sender, msg, channel) {\r\n        var handler = cmapi.channel.handler[channel];\r\n        var message = {};\r\n        var oSender = typeof sender === \"string\" ? JSON.parse(sender) : sender;\r\n        var item;\r\n\r\n        if (oSender.id === _widgetId) {\r\n            // We sent this message so we dump it.\r\n            return;\r\n        }\r\n\r\n        if ((msg === undefined) || (msg === null) || (msg === \"\")) {\r\n            emp.typeLibrary.Error({\r\n              \"level\": 2,\r\n              \"message\": \"[CMAPI] Inbound Message was empty\",\r\n              \"coreId\": \"UNKNOWN\"\r\n            });\r\n\r\n            return;\r\n        }\r\n        message.payload = (typeof msg === \"string\" ? JSON.parse(msg) : msg);\r\n        if (Array.isArray(message.payload)) {\r\n            // For messages with an array of payloads we need to use the same messageId\r\n            // Pull the messageId from the first payload\r\n            item = message.payload[0];\r\n            if (item !== undefined &&\r\n                item !== null &&\r\n                item.hasOwnProperty(\"messageId\") &&\r\n                item.messageId !== null &&\r\n                item.messageId.length > 0) {\r\n                message.messageId = item.messageId;\r\n            }\r\n        } else if (message.payload.messageId !== undefined &&\r\n            message.payload.messageId !== null) {\r\n            message.messageId = message.payload.messageId;\r\n        }\r\n\r\n        if (handler) {\r\n            // If a channel definition was found pass the message to it to\r\n            handler.process({\r\n                message: message,\r\n                sender: oSender,\r\n                mapInstanceId: mapInstanceId,\r\n                originalMessage: typeof msg === \"string\" ? msg : JSON.stringify(msg)\r\n            });\r\n        } else {\r\n            emp.typeLibrary.Error({\r\n                message: \"Received a message with no handler over channel \" + channel + \".\"\r\n            });\r\n        }\r\n    };\r\n\r\n    var callPublisher = function(args) {\r\n        var publisher;\r\n        var channel = emp.api.cmapi.publisher.intentChannelMap[args.intent];\r\n\r\n        if (channel) {\r\n            publisher = cmapi.channel.publisher[channel];\r\n\r\n            if (publisher) {\r\n                publisher.process(args);\r\n            } else {\r\n                emp.typeLibrary.Error({\r\n                    level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n                    message: \"Intent \" + args.intent + \" has no publisher defined. callPublisher.\"\r\n                });\r\n            }\r\n        } else {\r\n            emp.typeLibrary.Error({\r\n                level: emp.typeLibrary.Error.level.CATASTROPHIC,\r\n                message: \"Intent \" + args.intent + \" has no channel defined. callPublisher.\"\r\n            });\r\n        }\r\n    };\r\n\r\n    var transactionComplete = function(oTransaction) {\r\n        var channel;\r\n        var publisher;\r\n        var sOriginChannel = oTransaction.originChannel;\r\n\r\n        if (oTransaction.source !== emp.api.cmapi.SOURCE) {\r\n            switch (oTransaction.intent) {\r\n                case emp.intents.control.FEATURE_ADD:\r\n                    if (oTransaction.items.length > 1) {\r\n                        oTransaction.originChannel = cmapi.channel.names.MAP_FEATURE_PLOT_BATCH;\r\n                    } else if ((oTransaction.items.length > 0) &&\r\n                            (oTransaction.items[0].url)) {\r\n                        oTransaction.originChannel = cmapi.channel.names.MAP_FEATURE_PLOT_URL;\r\n                    } else {\r\n                        oTransaction.originChannel = cmapi.channel.names.MAP_FEATURE_PLOT;\r\n                    }\r\n                    oTransaction.sendTransactionComplete = true;\r\n                    break;\r\n                case emp.intents.control.FEATURE_REMOVE:\r\n                    if (oTransaction.items.length > 1) {\r\n                        oTransaction.originChannel = cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH;\r\n                    } else {\r\n                        oTransaction.originChannel = cmapi.channel.names.MAP_FEATURE_UNPLOT;\r\n                    }\r\n                    oTransaction.sendTransactionComplete = true;\r\n                    break;\r\n                case emp.intents.control.OVERLAY_ADD:\r\n                    oTransaction.originChannel = cmapi.channel.names.MAP_OVERLAY_CREATE;\r\n                    oTransaction.sendTransactionComplete = true;\r\n                    break;\r\n                case emp.intents.control.OVERLAY_REMOVE:\r\n                    oTransaction.originChannel = cmapi.channel.names.MAP_OVERLAY_REMOVE;\r\n                    oTransaction.sendTransactionComplete = true;\r\n                    break;\r\n                case emp.intents.control.EDIT_BEGIN:\r\n                    oTransaction.originChannel = cmapi.channel.names.MAP_FEATURE_EDIT;\r\n                    oTransaction.sendTransactionComplete = true;\r\n                    break;\r\n                default:\r\n                    // A transaction with a source not equal the cmapi.\r\n                    // So we don't need to send a completion.\r\n                    return;\r\n            }\r\n        }\r\n\r\n        channel = emp.api.cmapi.publisher.intentChannelMap[emp.intents.control.TRANSACTION_COMPLETE];\r\n        publisher = cmapi.channel.publisher[channel];\r\n\r\n        if (publisher) {\r\n            publisher.process(oTransaction);\r\n        } else {\r\n            emp.typeLibrary.Error({\r\n                message: \"Intent \" + oTransaction.intent + \" has no publisher defined.\"\r\n            });\r\n        }\r\n\r\n        if (oTransaction.hasOwnProperty(\"failures\") &&\r\n                (oTransaction.failures.length > 0)) {\r\n            // There are errors.\r\n            // Process them thru the error channel.\r\n            publisher = cmapi.channel.publisher[cmapi.channel.names.MAP_ERROR];\r\n            publisher.process(oTransaction);\r\n        }\r\n\r\n        oTransaction.originChannel = sOriginChannel;\r\n    };\r\n\r\n    var statusChangeHdlr = function(oTrans)\r\n    {\r\n      var oTransaction;\r\n//console.log('Status Chg :' + oTrans.items[0].status + ' from:' + oTrans.mapInstanceId + ' process by:' + mapInstanceId + '.');\r\n      switch (oTrans.items[0].status) {\r\n          case emp.map.states.INITIALIZING:\r\n          case emp.map.states.READY:\r\n          case emp.map.states.SHUTDOWN_IN_PROGRESS:\r\n          case emp.map.states.TEARDOWN:\r\n          case emp.map.states.MAP_SWAP_IN_PROGRESS:\r\n          case emp.map.states.MAP_INSTANCE_INIT_FAILED:\r\n              oTransaction = new emp.typeLibrary.Transaction({\r\n                  intent: emp.intents.control.STATUS_RESPONSE_INIT,\r\n                  mapInstanceId: oTrans.mapInstanceId,\r\n                  sendTransactionComplete: false,\r\n                  source: emp.api.cmapi.SOURCE,\r\n                  items: oTrans.items\r\n              });\r\n\r\n              oTransaction.run();\r\n              break;\r\n      }\r\n    };\r\n\r\n    var publicInterface = {\r\n        init: function()\r\n        {\r\n            var i,\r\n                len,\r\n                environment = emp.environment.get();\r\n\r\n            // TODO this function is not implemented in the browser env.\r\n            _widgetId = environment.getInstanceId() || mapInstanceId;\r\n\r\n            len = channels.length;\r\n\r\n            for (i = 0; i < len; i++) {\r\n                environment.pubSub.subscribe({\r\n                    channel: channels[i],\r\n                    callback: messageHandler,\r\n                    mapInstanceId: mapInstanceId\r\n                });\r\n            }\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.TRANSACTION_COMPLETE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: transactionComplete\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_RESPONSE_ABOUT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_RESPONSE_FORMAT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_RESPONSE_INIT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_RESPONSE_SELECTED,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_REQUEST_SCREENSHOT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.EDIT_UPDATE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.DRAW_UPDATE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.FEATURE_CLICK,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.SELECTION_OUTBOUND,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.DESELECTION_OUTBOUND,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.FEATURE_OUTBOUND_PLOT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.SYMBOL_OUTBOUND_PLOT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.POINTER,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.CLICK,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.SELECTION_BOX,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.MENU_CONTEXT_CLICK,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.ERROR,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.MENU_DRAW_FEATURE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.FEATURE_REMOVE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.OVERLAY_REMOVE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.VIEW_CHANGE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.VIEW_GET,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.STATUS_CHANGE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: statusChangeHdlr\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.FREEHAND_LINE_DRAW_START,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.FREEHAND_LINE_DRAW_END,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.add({\r\n                type: emp.intents.control.FREEHAND_LINE_DRAW_UPDATE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n        },\r\n        destroy: function()\r\n        {\r\n            var i,\r\n                len,\r\n                environment = emp.environment.get();\r\n\r\n            len = channels.length;\r\n\r\n            for (i = 0; i < len; i++) {\r\n                environment.pubSub.unsubscribe({\r\n                    channel: channels[i],\r\n                    callback: messageHandler,\r\n                    mapInstanceId: mapInstanceId\r\n                });\r\n            }\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.TRANSACTION_COMPLETE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: transactionComplete\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_RESPONSE_ABOUT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_RESPONSE_FORMAT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_RESPONSE_INIT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_RESPONSE_SELECTED,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_REQUEST_SCREENSHOT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.EDIT_UPDATE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.DRAW_UPDATE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.FEATURE_CLICK,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.SELECTION_OUTBOUND,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.DESELECTION_OUTBOUND,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.FEATURE_OUTBOUND_PLOT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.SYMBOL_OUTBOUND_PLOT,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.POINTER,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.CLICK,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.SELECTION_BOX,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.MENU_CONTEXT_CLICK,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.ERROR,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.MENU_DRAW_FEATURE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.FEATURE_REMOVE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.OVERLAY_REMOVE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.VIEW_CHANGE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.VIEW_GET,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: callPublisher\r\n            });\r\n\r\n            emp.transactionQueue.listener.remove({\r\n                type: emp.intents.control.STATUS_CHANGE,\r\n                mapInstanceId: mapInstanceId,\r\n                callback: statusChangeHdlr\r\n            });\r\n        },\r\n        processMessage: function(sender, msg, channel)\r\n        {\r\n            messageHandler(sender, msg, channel);\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n\r\nemp.api.cmapiInterface = function()\r\n{\r\n    var sFirstMapInstanceId = \"\";\r\n    var mapInstanceData = {};\r\n    //var environment;\r\n    var broadcastChannels = [\r\n        cmapi.channel.names.MAP_OVERLAY_CREATE,\r\n        cmapi.channel.names.MAP_OVERLAY_REMOVE,\r\n        cmapi.channel.names.MAP_OVERLAY_UPDATE,\r\n        cmapi.channel.names.MAP_OVERLAY_STYLE,\r\n        cmapi.channel.names.MAP_OVERLAY_CLEAR,\r\n        cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET,\r\n        cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE,\r\n        cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE,\r\n        cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE,\r\n        cmapi.channel.names.MAP_FEATURE_PLOT,\r\n        cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n        cmapi.channel.names.MAP_FEATURE_UNPLOT,\r\n        cmapi.channel.names.MAP_FEATURE_UPDATE,\r\n        cmapi.channel.names.MAP_GET,\r\n        //cmapi.channel.names.MAP_MENU_DRAWING_CREATE,\r\n        //cmapi.channel.names.MAP_MENU_DRAWING_REMOVE,\r\n        cmapi.channel.names.MAP_STATUS_REQUEST,\r\n        cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,\r\n        cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,\r\n        cmapi.channel.names.MAP_MENU_CREATE,\r\n        cmapi.channel.names.MAP_MENU_REMOVE,\r\n        cmapi.channel.names.MAP_MENU_ACTIVE\r\n    ];\r\n\r\n    var setFirstInstanceId = function()\r\n    {\r\n        var aKeyList = emp.helpers.associativeArray.getKeys(mapInstanceData);\r\n\r\n        if (aKeyList.length > 0)\r\n        {\r\n            sFirstMapInstanceId = aKeyList[0];\r\n        }\r\n        else\r\n        {\r\n            sFirstMapInstanceId = \"\";\r\n        }\r\n    };\r\n\r\n    /*\r\n     * This message handler handles the messages that are broadcasts.\r\n     * It send the messages to one of the map instances.\r\n     */\r\n    var messageHandler = function(sender, msg, channel)\r\n    {\r\n        if (!emp.helpers.isEmptyString(sFirstMapInstanceId))\r\n        {\r\n            if (mapInstanceData[sFirstMapInstanceId] === undefined)\r\n            {\r\n                setFirstInstanceId();\r\n                if (emp.helpers.isEmptyString(sFirstMapInstanceId) ||\r\n                        (mapInstanceData[sFirstMapInstanceId] === undefined))\r\n                {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            mapInstanceData[sFirstMapInstanceId].processMessage(sender, msg, channel);\r\n        }\r\n    };\r\n\r\n    var setupFeatureProcessing = function()\r\n    {\r\n        var iIndex,\r\n            len,\r\n            environment = emp.environment.get();\r\n\r\n        len = broadcastChannels.length;\r\n\r\n        for (iIndex = 0; iIndex < len; iIndex++) {\r\n            environment.pubSub.subscribe({\r\n                channel: broadcastChannels[iIndex],\r\n                callback: messageHandler,\r\n                mapInstanceId: \"\"\r\n            });\r\n        }\r\n    };\r\n\r\n    var stopFeatureProcessing = function()\r\n    {\r\n        var iIndex,\r\n            len,\r\n            environment = emp.environment.get();\r\n\r\n        len = broadcastChannels.length;\r\n\r\n        for (iIndex = 0; iIndex < len; iIndex++) {\r\n            environment.pubSub.unsubscribe({\r\n                channel: broadcastChannels[iIndex],\r\n                callback: messageHandler,\r\n                mapInstanceId: \"\"\r\n            });\r\n        }\r\n    };\r\n\r\n    var publicInterface = {\r\n        init: function() {},\r\n        createMapInstance: function(args)\r\n        {\r\n            var iMapInstanceCnt;\r\n            var cmapiMapInterface = emp.api.cmapiMapInstanceInterface(args);\r\n\r\n            cmapiMapInterface.init(args);\r\n            mapInstanceData[args.mapInstanceId] = cmapiMapInterface;\r\n            iMapInstanceCnt = emp.helpers.associativeArray.size(mapInstanceData);\r\n            setFirstInstanceId();\r\n            if (iMapInstanceCnt === 1)\r\n            {\r\n                //environment = args.environment;\r\n                setupFeatureProcessing();\r\n            }\r\n        },\r\n        destroyMapInstance: function(args)\r\n        {\r\n            var iMapInstanceCnt;\r\n            if (mapInstanceData.hasOwnProperty(args.instanceId))\r\n            {\r\n                mapInstanceData[args.instanceId].destroy();\r\n                delete mapInstanceData[args.instanceId];\r\n                setFirstInstanceId();\r\n                iMapInstanceCnt = emp.helpers.associativeArray.size(mapInstanceData);\r\n                if (iMapInstanceCnt === 0)\r\n                {\r\n                    stopFeatureProcessing();\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n","/* global emp, cmapi */\r\n\r\nemp.api.cmapi.publisher.intentChannelMap = (function(){\r\n    var mapping = {};\r\n\r\n    mapping[emp.intents.control.TRANSACTION_COMPLETE] = cmapi.channel.names.MAP_MESSAGE_COMPLETE;\r\n\r\n    // Error event.\r\n    mapping[emp.intents.control.ERROR] = cmapi.channel.names.MAP_ERROR;\r\n\r\n    // Edit events.\r\n    mapping[emp.intents.control.EDIT_UPDATE] = cmapi.channel.names.MAP_MESSAGE_PROGRESS;\r\n\r\n    // Draw Events.\r\n    mapping[emp.intents.control.DRAW_UPDATE] = cmapi.channel.names.MAP_MESSAGE_PROGRESS;\r\n    mapping[emp.intents.control.FEATURE_OUTBOUND_PLOT] = cmapi.channel.names.MAP_FEATURE_PLOT;\r\n    mapping[emp.intents.control.SYMBOL_OUTBOUND_PLOT] = cmapi.channel.names.MAP_SYMBOL_FEATURE_PLOT;\r\n\r\n    // Map events.\r\n    mapping[emp.intents.control.POINTER] = cmapi.channel.names.MAP_VIEW_CLICKED;\r\n    mapping[emp.intents.control.CLICK] = cmapi.channel.names.MAP_VIEW_CLICKED;\r\n    mapping[emp.intents.control.FEATURE_CLICK] = cmapi.channel.names.MAP_FEATURE_CLICKED;\r\n    mapping[emp.intents.control.SELECTION_OUTBOUND] = cmapi.channel.names.MAP_FEATURE_SELECTED;\r\n    mapping[emp.intents.control.DESELECTION_OUTBOUND] = cmapi.channel.names.MAP_FEATURE_DESELECTED;\r\n    mapping[emp.intents.control.VIEW_CHANGE] = cmapi.channel.names.MAP_STATUS_VIEW;\r\n    mapping[emp.intents.control.SELECTION_BOX] = cmapi.channel.names.MAP_VIEW_AREA_SELECTED;\r\n\r\n    // Map status request responses.\r\n    mapping[emp.intents.control.STATUS_RESPONSE_ABOUT] = cmapi.channel.names.MAP_STATUS_ABOUT;\r\n    mapping[emp.intents.control.STATUS_RESPONSE_FORMAT] = cmapi.channel.names.MAP_STATUS_FORMAT;\r\n    mapping[emp.intents.control.VIEW_GET] = cmapi.channel.names.MAP_STATUS_VIEW;\r\n    mapping[emp.intents.control.STATUS_RESPONSE_SELECTED] = cmapi.channel.names.MAP_STATUS_SELECTED;\r\n    mapping[emp.intents.control.STATUS_RESPONSE_INIT] = cmapi.channel.names.MAP_STATUS_INITIALIZATION;\r\n    mapping[emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM] = cmapi.channel.names.MAP_STATUS_COORDINATESYSTEM;\r\n    mapping[emp.intents.control.STATUS_REQUEST_SCREENSHOT] = cmapi.channel.names.MAP_STATUS_SCREENSHOT;\r\n\r\n    // Delete events.\r\n    mapping[emp.intents.control.FEATURE_REMOVE] = cmapi.channel.names.MAP_FEATURE_UNPLOT;\r\n    mapping[emp.intents.control.OVERLAY_REMOVE] = cmapi.channel.names.MAP_OVERLAY_REMOVE;\r\n\r\n    mapping[emp.intents.control.FREEHAND_LINE_DRAW_START] = cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW;\r\n    mapping[emp.intents.control.FREEHAND_LINE_DRAW_END] = cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW;\r\n    mapping[emp.intents.control.FREEHAND_LINE_DRAW_UPDATE] = cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW;\r\n\r\n    return mapping;\r\n}());\r\n","cmapi.typeLibrary.msgComplete = cmapi.typeLibrary.msgComplete || {};\r\n/**\r\n * \r\n * @enum\r\n * @description This type enumerates the possible values of the message complete status field.\r\n */\r\ncmapi.typeLibrary.msgComplete.status =\r\n{\r\n    SUCCESS: \"success\",\r\n    MIXED: \"mixed\",\r\n    FAILURE: \"failure\",\r\n    CANCELLED: \"cancelled\"\r\n};\r\n\r\n","/**\r\n * @memberOf cmapi.typeLibrary\r\n * @class\r\n * @desc Used to create a message completion.\r\n */\r\ncmapi.typeLibrary.MessageComplete = function (oTransaction) {\r\n\r\n    var publicInterface = {\r\n        messageId: oTransaction.transactionId,\r\n        status: cmapi.typeLibrary.msgComplete.status.SUCCESS,\r\n        originatingChannel: oTransaction.originChannel,\r\n        details: {},\r\n        failures: []\r\n    };\r\n    \r\n    if (oTransaction.failures.length > 0)\r\n    {\r\n        if (oTransaction.items.length > 0)\r\n        {\r\n            publicInterface.status = cmapi.typeLibrary.msgComplete.status.MIXED;\r\n        }\r\n        else\r\n        {\r\n            publicInterface.status = cmapi.typeLibrary.msgComplete.status.FAILURE;\r\n        }\r\n    }\r\n\r\n    var oFailure;\r\n    var oFailRec;\r\n    \r\n    for (var iIndex = 0; iIndex < oTransaction.failures.length; iIndex++)\r\n    {\r\n        oFailure = oTransaction.failures[iIndex];\r\n        \r\n        oFailRec = {\r\n            payload: {},\r\n            message: \"\"\r\n        };\r\n        \r\n        if (iIndex === 0)\r\n        {\r\n            oFailRec.payload = oTransaction.originalMessage;\r\n        }\r\n\r\n        oFailRec.message = oFailure.message;\r\n\r\n        publicInterface.failures.push(oFailRec);\r\n    }\r\n\r\n    return publicInterface;\r\n};\r\n","/**\r\n * @memberOf cmapi.typeLibrary\r\n * @class\r\n * @desc Used to create a message progress.\r\n */\r\ncmapi.typeLibrary.MessageProgress = function (oTransaction) {\r\n\r\n    var publicInterface = {\r\n        messageId: oTransaction.transactionId,\r\n        originatingChannel: oTransaction.originChannel,\r\n        details: {}\r\n    };\r\n\r\n    return publicInterface;\r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_ERROR] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.error\",\r\n  \"description\":\"Map Widget reports errors occurred when attempting to process any message.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"sender\":{\r\n      \"type\":\"string\",\r\n      \"default\":\" \",\r\n      \"description\":\"Sender ID of message that caused error.\"\r\n    },\r\n    \"type\":{\r\n      \"type\":\"string\",\r\n      \"default\":\" \",\r\n      \"description\":\"Type of message that caused error.\"\r\n    },\r\n    \"msg\":{\r\n      \"type\":\"object\",\r\n      \"default\":\" \",\r\n      \"description\":\"The message that caused error.\"\r\n    },\r\n    \"error\":{\r\n      \"type\":\"string\",\r\n      \"default\":\" \",\r\n      \"description\":\"A description of the error.\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"sender\",\r\n    \"type\",\r\n    \"msg\",\r\n    \"error\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.deselected.batch\",\r\n  \"description\":\"De-Select, or report that a collection of feature objects were de-selected.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"payloads\":{\r\n      \"description\":\"An array of map.feature.deSelected payload objects.  See map.feature.deSelected for the object format and schema\",\r\n      \"type\":\"Array\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The default overlayId to be applied to all map.feature.deSelected objects in the payloads array that don't include an overlayId. I.e., similar behavior to CSS.  See map.feature.deSelected for more details\",\r\n      \"type\":\"string\",\r\n      \"default\":\"\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.\",\r\n      \"type\":\"string\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"payloads\"\r\n  ]  \r\n};","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_DESELECTED] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.deselected\",\r\n  \"description\":\"De-Select, or report that object was de-selected.\",\r\n  \"properties\":{\r\n    \"deSelectedId\":{\r\n      \"description\":\"The ID of the object to be de-selected (may be a sub-feature contained within the aggregate feature data with the given featureId).\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"deSelectedName\":{\r\n      \"description\":\"The name of the de-selected object.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature that contains the de-selected object.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay which contains the de-selected object. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_HIDE] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.hide\",\r\n  \"description\":\"Hide existing feature on the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay where the feature to be hidden is found. If no overlayId is included, default overlay with ID equal to sending widget's ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature to be hidden.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[\"map.feature.plot.batch\"] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.plot.batch\",\r\n  \"description\":\"Plots a batch of feature data on the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"features\":{\r\n      \"description\":\"An array of map.feature.plot payloads minus the messageId property.  See map.feature.plot for the object format and schema\",\r\n      \"type\":\"Array\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The default overlayId to be applied to all feature objects in the features array that dont include an overlayId. I.e., similar behavior to CSS.  See map.feature.plot for more details\",\r\n      \"type\":\"string\",\r\n      \"default\":\"\"\r\n    },\r\n    \"format\":{\r\n      \"description\":\"The default format to be applied to all feature objects in the features array that dont include a format value. I.e., similar behavior to CSS.  See map.feature.plot for definition of format property.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"\"\r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"Whether the map should zoom to the newly loaded feature data.  See map.feature.plot for definition of format property.\",\r\n      \"type\":\"boolean\",\r\n      \"default\":\"\"\r\n    },\r\n    \"readOnly\":{\r\n      \"description\":\"The default value for readOnly to be applied to all feature objects in the features array that dont include a readOnly value. I.e., similar behavior to CSS.  See map.feature.plot for definition of readOnly property.\",\r\n      \"type\":\"boolean\",\r\n      \"default\":\"\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.\",\r\n      \"type\":\"string\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    },\r\n    \"menuId\":{\r\n      \"description\":\"The default format to be applied to all feature objects in the features array that dont include a menuId value. I.e., similar behaviour to CSS.  See map.feature.plot for definition of menuId property.\",\r\n      \"type\":\"string\",\r\n      \"extension\":\"User Manipulation - Context Menus\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"features\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_PLOT] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.plot\",\r\n  \"description\":\"Plots feature data on the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay this feature should be loaded into. If an overlay with this ID already exists, the new feature is merged into existing overlay; otherwise, a new overlay is created. If no overlayId is included, default overlay with ID equal to sending widget's ID is used. If an overlay exists, it will retain its status (whether visible or hidden). If an overlay is created, it will be made visible.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"Unique identifier for the given feature data. Note that feature IDs MUST be unique within a given overlay. Reusing a feature ID will be considered a reload, with the original feature data being removed and replaced by the new feature data.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"name\":{\r\n      \"description\":\"Name for the given feature data. Note that feature names do not have to be unique and are intended for display purposes only.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"format\":{\r\n      \"description\":\"Data format of the given feature. All map implementations MUST support kml and geojson.  If no format is specified, the format defaults to kml. A list of formats supported by a particular map implementation may be obtained by querying the map using the map.status channel (see map.status).\",\r\n      \"type\":\"string\",\r\n      \"default\":\"kml\"\r\n    },\r\n    \"feature\":{\r\n      \"description\":\"Feature data to be loaded into the map.   See Appendix A for additional information on required KML support, Appendix B for information on required GeoJSON, and Appendix C for information on Area of Interest (AOI) support.\",\r\n      \"type\":[\r\n        \"object\",\r\n        \"string\"\r\n      ],\r\n      \"additionalProperties\":true,\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"true if map should zoom to newly loaded feature data, false if not. Default is false.\",\r\n      \"type\":\"boolean\",\r\n      \"default\":false\r\n    },\r\n    \"readOnly\":{\r\n      \"description\":\"Valid values are true or false. If true, then the end user MUST NOT be able to edit the feature from the maps user interface, if false the end user MAY edit the feature from the maps user interface. Default value is true.   If an edit takes place, the map SHOULD dispatch a map.feature.plot with the updated feature to ensure other widgets are aware that a change took place.\",\r\n      \"type\":\"boolean\",\r\n      \"default\":true\r\n    },\r\n    \"properties\":{\r\n      \"additionalProperties\":true,\r\n      \"description\":\"A free form object that can contain any additional JSON objects or elements to send with this message. This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.\",\r\n      \"type\":\"object\",\r\n      \"status\":\"new\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    },\r\n    \"menuId\":{\r\n      \"description\":\"The id of a context menu. If populated, the context menu MUST have already been pre-registered via the map.menu.create channel. If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu. If no menuId is assigned, the feature will not have a context menu associated when right-clicked.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Context Menus\"\r\n    }\r\n  },\r\n  \"required\":[\r\n    \"featureId\",\r\n    \"feature\"\r\n  ]\r\n};\r\n","\r\ncmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_PLOT_URL] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.plot.url\",\r\n  \"description\":\"Have the map plot feature data from a Uniform Resource Locator (URL).\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay this feature should be loaded into. If an overlay with this ID already exists, new feature is merged into existing overlay; otherwise, a new overlay will be created. If no overlayId is included, default overlay with ID equal to sending widget's ID is used. If overlay exists, it will retain its status (whether visible or hidden). If overlay is created, it will be made visible.\",\r\n      \"required\":false,\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"Unique identifier for the given feature data. Note that feature ids must be unique within a given overlay. Reusing a feature id will be considered a reload with the original feature data being removed and replaced by the new feature data.\",\r\n      \"required\":true,\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"name\":{\r\n      \"description\":\"Name for the given feature data. Note that feature names do not have to be unique and are intended for display purposes only.\",\r\n      \"required\":false,\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"format\":{\r\n      \"description\":\"Data format of the given feature. If no format is specified, the format defaults to kml. A list of formats supported by a particular map implementation can be obtained by querying the map using the map.status channel (see map.status). Note that for this version of the Common Map Widget API, all map implementations MUST support KML, GeoJSON, and WMS (GetMap only).\",\r\n      \"required\":false,\r\n      \"type\":\"string\",\r\n      \"default\":\"kml\"\r\n    },\r\n    \"url\":{\r\n      \"description\":\"URL from which to retrieve the feature data to load onto the map\",\r\n      \"required\":true,\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"params\":{\r\n      \"description\":\"A JSON object containing a list of parameters to be passed to the server along with the URL when loading WMS data. Params object is ignored unless format is set to wms.  Note that request, exceptions, SRS/CRS, width, height, and bbox params should not be passed in as they are determined by the map as needed and will be ignored if passed. Params as passed will be concatenated to the URL and are expected to follow the WMS specification.   All parameters passed in must not be URL encoded (the map widget implementation will URL encode all passed in params).\",\r\n      \"type\":\"object\",\r\n      \"required\":[\r\n        \r\n      ],\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"true if map should zoom to newly loaded feature data, false if not. Default is false.  Ignored when loading WMS data.\",\r\n      \"required\":false,\r\n      \"type\":\"boolean\",\r\n      \"default\":false\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\",\r\n    \"url\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.selected.batch\",\r\n  \"description\":\"Select, or report that a collection of feature objects were selected.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"payloads\":{\r\n      \"description\":\"An array of map.feature.selected payload objects.  See map.feature.selected for the object format and schema\",\r\n      \"type\":\"Array\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The default overlayId to be applied to all map.feature.selected objects in the payloads array that don't include an overlayId. I.e., similar behavior to CSS.  See map.feature.selected for more details\",\r\n      \"type\":\"string\",\r\n      \"default\":\"\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.\",\r\n      \"type\":\"string\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"payloads\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.selected\",\r\n  \"description\":\"Select, or report that object was selected.\",\r\n  \"properties\":{\r\n    \"selectedId\":{\r\n      \"description\":\"The ID of the object to be selected (may be a sub-feature contained within the aggregate feature data with the given featureId).\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"selectedName\":{\r\n      \"description\":\"The name of the selected object.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature that contains the selected object.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay which contains the selected object. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[\"map.feature.show\"] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.show\",\r\n  \"description\":\"Have the map show previously hidden feature data.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay where the feature to be shown is found. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature to be shown.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"true if map should zoom to the shown feature, false if not. Default is false.\",\r\n      \"type\":\"boolean\",\r\n      \"default\":false\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.unplot.batch\",\r\n  \"description\":\"Remove collection of features from the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"payloads\":{\r\n      \"description\":\"An array of map.feature.unplot payloads minus the messageId.  See map.feature.unplot for the object format and schema\",\r\n      \"type\":\"Array\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"when included at the array level, this value will be applied to all map.feature.unplot objects in the features array that don't include an overlayID. I.e., similar behavior to CSS.  See map.feature.unplot for definition of this property\",\r\n      \"type\":\"string\",\r\n      \"default\":\"\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message batch.  If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of the message batch.\",\r\n      \"type\":\"string\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"payloads\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UNPLOT] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.unplot\",\r\n  \"description\":\"Removes feature data from the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay where the feature to be removed is found. If no overlayId is included, default overlay with an ID equal to sending widget's ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature to be removed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UPDATE] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.feature.update\",\r\n  \"description\":\"Update an existing feature on the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay where the feature to be updated is currently found. If no overlayId is included, default overlay with ID equal to sending widget's ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature to be updated\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"name\":{\r\n      \"description\":\"If the name provided differs from the feature's current name, the display value will be changed to show the new value.  If no value is provided, the feature name will remain unchanged.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"newOverlayId\":{\r\n      \"description\":\"This represents the ID of an overlay to move the feature to.  If this attribute is provided, the feature MUST be removed from its current overlay and added to the overlay with this ID.  If an overlay with an ID of newOverlayId does not exist, a new overlay will be created with an ID of newOverlayId, and the feature to be updated will be moved to the overlay identified by newOverlayId.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"properties\":{\r\n      \"additionalProperties\":true,\r\n      \"description\":\"A free form object that can contain any additional JSON objects or elements to send with this message. This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.\",\r\n      \"type\":\"object\",\r\n      \"status\":\"new\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    },\r\n    \"menuId\":{\r\n      \"description\":\"The id of a context menu. If populated, the context menu MUST have already been pre-registered via the map.menu.create channel. If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu. If no menuId is assigned, the feature will not have a context menu associated when right-clicked.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Context Menus\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[\"map.overlay.create\"] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.overlay.create\",\r\n  \"description\":\"Create an overlay into which data can be aggregated.\",\r\n  \"properties\":{\r\n    \"name\":{\r\n      \"description\":\"The name of the overlay. If not included, the ID is used as the name. Note that overlay names do not have to be unique and are intended for display purposes only.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The unique ID of the new overlay. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed. If an overlay with the given ID already exists, this message will have no effect. Note that overlay IDs must be unique even across multiple parent overlays.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"parentId\":{\r\n      \"description\":\"The ID of the parent overlay in which to create this overlay. If an overlay with an ID of parentId does not exist, a new overlay will be created with an ID of parentId, and the parentage of the overlay identified by overlayId will be set to the newly created parent overlay.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"properties\":{\r\n      \"description\":\"A free form object that can contain any additional JSON objects or elements to send with this message.  This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.\",\r\n      \"type\":\"object\",\r\n      \"status\":\"new\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    },\r\n    \"menuId\":{\r\n      \"description\":\"The id of a context menu.  If populated, the context menu MUST have already been pre-registered via the map.menu.create channel.  If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu.  If no menuId is assigned, the feature will not have a context menu associated when right-clicked.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Context Menus\"\r\n    }\r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};\r\n","cmapi.channel.schema[\"map.overlay.hide\"] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.overlay.hide\",\r\n  \"description\":\"Hide existing overlay on the map.\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay to be hidden. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed. \",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};\r\n","cmapi.channel.schema[\"map.overlay.remove\"] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.overlay.remove\",\r\n  \"description\":\"Remove entire overlay from the map.\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay to be removed. If no overlayId is included, default overlay with ID equal to sending widget's ID is assumed. \",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};\r\n","cmapi.channel.schema[\"map.overlay.show\"] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.overlay.show\",\r\n  \"description\":\"Show existing overlay on the map.\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay to be shown. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_UPDATE] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.overlay.update\",\r\n  \"description\":\"Update an existing overlay.\",\r\n  \"properties\":{\r\n    \"name\":{\r\n      \"description\":\"The new name of the overlay. Note that overlay names do not have to be unique and are intended for display purposes only.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"overlayId\":{\r\n      \"description\":\"The unique ID of the overlay being updated. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed. If an overlay with the given ID already exists, this message will update that overlay. If an overlay with the given ID does not exist, an error is generated.  Note that overlay IDs MUST be unique even across multiple parent overlays.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"parentId\":{\r\n      \"description\":\"The ID of the parent overlay that is associated with this overlay.  If no ID is provided, the overlay will keep its existing parentage.  If a parentId is provided, the parentage of the overlay will be changed to the new parentId.  If an overlay with an ID of parentId does not exist, a new overlay will be created and the parentage of the overlay identified by overlayId will be changed to the newly created parent overlay.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"properties\":{\r\n      \"description\":\"A free form object that can contain any additional JSON objects or elements to send with this message. This allows for extending this channel's message without inadvertently corrupting the CMAPI specified payload of the message.\",\r\n      \"type\":\"object\",\r\n      \"status\":\"new\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    },\r\n    \"menuId\":{\r\n      \"description\":\"The id of a context menu. If populated, the context menu MUST have already been pre-registered via the map.menu.create channel. If populated, the context menu associated with this id will appear when the feature is 'right-clicked', allowing the user to invoke actions on the feature which will be handled by the widget which originally registered the context menu. If no menuId is assigned, the feature will not have a context menu associated when right-clicked.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Context Menus\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_ABOUT] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.status.about\",\r\n  \"description\":\"Send out static information about the map implementation\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"version\":{\r\n      \"type\":\"string\",\r\n      \"default\":\" \",\r\n      \"description\":\"A comma delimited list of the version numbers of the Common Map Widget API that this map widget supports.\"\r\n    },\r\n    \"type\":{\r\n      \"enum\":[\r\n        \"2-D\",\r\n        \"3-D\",\r\n        \"other\"\r\n      ],\r\n      \"default\":\" \",\r\n      \"description\":\"The type of map in the map widget.  Allowable values are 2-D, 3-D, or other.\"\r\n    },\r\n    \"widgetName\":{\r\n      \"type\":\"string\",\r\n      \"default\":\" \",\r\n      \"description\":\"The registered name of the map widget which is consistent across all version of OWF and cannot change during a user's session. \"\r\n    },\r\n    \"instanceName\":{\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\",\r\n      \"description\":\"The name of the widget on the users dashboard.  This name can be changed by the end user and by the widget developer in code so this name may change during a user's session.  \"\r\n    },\r\n    \"universalName\":{\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\",\r\n      \"description\":\"The universal name of the map widget set in the widget registration.  This is not available in all versions of OWF.\"\r\n    },\r\n    \"extensions\":{\r\n      \"description\":\"An array of optional extensions that the widget supports.  Allowable values are intents, clustering, and userManipulation.  If no extensions are supported, then an empty array SHALL be sent.\",\r\n      \"type\":[\r\n        \"array\",\r\n        \"enum\"\r\n      ],\r\n      \"default\":\"N/A\",\r\n      \"uniqueItems\":true,\r\n      \"items\":{\r\n        \"anyOf\":[\r\n          \"intents\",\r\n          \"clustering\",\r\n          \"userManipulation\",\r\n          \"selected\",\r\n          null\r\n        ]        \r\n      }      \r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"version\",\r\n    \"type\",\r\n    \"widgetName\",\r\n    \"extensions\"\r\n  ]  \r\n};","cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_FORMAT] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.status.format\",\r\n  \"description\":\"Send out the list of data formats that the map widget supports; in other words, this map implementation supports the following feature data formats.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"formats\":{\r\n      \"description\":\"An array of the formats that this map supports. Note that for this version of the Common Map Widget API, all map implementations MUST support 'kml', 'geojson' and 'wms'.  Additional map formats MAY be supported.\",\r\n      \"type\":\"array\",\r\n      \"uniqueItems\":true,\r\n      \"default\":[\r\n        \"kml\"\r\n      ],\r\n      \"items\":{\r\n        \"anyOf\":[\r\n          \"kml\",\r\n          \"geojson\",\r\n          \"wms\"\r\n        ]        \r\n      }      \r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"formats\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_INITIALIZATION] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.status.initialization\",\r\n  \"description\":\"To receive notification of map events including the readiness, initialization and teardown of the map.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"status\":{\r\n      \"description\":\"Indicates the current state of the map.  This can be one of the following options: init, ready, teardown. 1.init - means the map has been launched but is not ready to begin accepting commands. 2.ready -  means the map is ready to begin accepting commands.  A map will be ready once it has finished loading. 3.teardown - indicates the user has closed the map and it is no longer available to use. 4.mapswapinprogress - A map swap process has started. A 'ready' status is issued when the process completes.\",\r\n      \"enum\":[\r\n        \"init\",\r\n        \"ready\",\r\n        \"teardown\",\r\n        \"mapswapinprogress\"\r\n      ]      \r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"status\"\r\n  ]  \r\n};\r\n","cmapi.channel.mapStatusRequest = {\r\n    requestTypes: {\r\n      STATUS_REQUEST_ABOUT: \"about\",\r\n      STATUS_REQUEST_FORMAT: \"format\",\r\n      STATUS_REQUEST_VIEW: \"view\",\r\n      STATUS_REQUEST_SELECTED: \"selected\",\r\n      STATUS_REQUEST_SCREENSHOT: \"screenshot\",\r\n      STATUS_REQUEST_INIT: \"initialization\",\r\n      STATUS_REQUEST_COORD_SYSTEM: \"coordinatesystem\"\r\n    }\r\n};\r\n\r\ncmapi.channel.schema[cmapi.channel.names.MAP_STATUS_REQUEST] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.status.request\",\r\n  \"description\":\"Request current status from the map. Map will send out requested map.status.xyz messages in response.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"types\":{\r\n      \"description\":\"An array of status types being requested. Map widgets MUST support status types of 'about', 'format', 'selected', 'view', and 'initialization' and MUST respond with the applicable status message (e.g., map.status.about, map.status.format, map.status.selected, map.status.view, and/or map.status.initialization). If the types attribute is not included, all status messages MUST be generated.\",\r\n      \"type\":\"array\",\r\n      \"items\":{\r\n        \"enum\":[\r\n          \"view\",\r\n          \"format\",\r\n          \"selected\",\r\n          \"about\",\r\n          \"initialization\"\r\n        ]        \r\n      }      \r\n    }    \r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_SELECTED] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.status.selected\",\r\n  \"description\":\"Send out the list of currently selected features.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"type\":\"string\",\r\n      \"default\":\" \",\r\n      \"description\":\"The ID of the overlay which contains the selected objects.\"\r\n    },\r\n    \"selectedFeatures\":{\r\n      \"description\":\"An array of features from the identified overlay that are currently selected.\",\r\n      \"type\":\"array\",\r\n      \"default\":\" \",\r\n      \"properties\":{\r\n        \"selectedFeature\":{\r\n          \"description\":\"Individual selected feature object\",\r\n          \"type\":\"object\",\r\n          \"properties\":{\r\n            \"featureId\":{\r\n              \"type\":\"string\",\r\n              \"description\":\"The ID of the feature that contains the selected object.\"\r\n            },\r\n            \"selectedId\":{\r\n              \"type\":\"string\",\r\n              \"description\":\"The ID of the actual selected object (may be a sub-feature contained within the aggregate feature data with the given featureId).\"\r\n            },\r\n            \"selectedName\":{\r\n              \"type\":\"string\",\r\n              \"description\":\"The name of the selected object.\"\r\n            }            \r\n          },\r\n          \"required\":[\r\n            \"featureId\"\r\n          ]          \r\n        }        \r\n      }      \r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"overlayId\",\r\n    \"selectedFeatures\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_VIEW] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.status.view\",\r\n  \"description\":\"Send out the current status of the map view\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"bounds\":{\r\n      \"description\":\"Bounding box of area visible on map.\",\r\n      \"type\":\"object\",\r\n      \"default\":\" \",\r\n      \"properties\":{\r\n        \"southWest\":{\r\n          \"description\":\"Bottom right of the bounds\",\r\n          \"type\":\"object\",\r\n          \"properties\":{\r\n            \"lat\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The latitude value of the point\",\r\n              \"minimum\":\"-90\",\r\n              \"maximum\":\"90\"\r\n            },\r\n            \"lon\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The longitude value of the point\",\r\n              \"minimum\":\"-180\",\r\n              \"maximum\":\"180\"\r\n            }            \r\n          },\r\n          \"required\":[\r\n            \"lat\",\r\n            \"lon\"\r\n          ]          \r\n        },\r\n        \"northEast\":{\r\n          \"description\":\"Top left of the bounds\",\r\n          \"type\":\"object\",\r\n          \"properties\":{\r\n            \"lat\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The latitude value of the point\",\r\n              \"minimum\":\"-90\",\r\n              \"maximum\":\"90\"\r\n            },\r\n            \"lon\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The longitude value of the point\",\r\n              \"minimum\":\"-180\",\r\n              \"maximum\":\"180\"\r\n            }            \r\n          },\r\n          \"required\":[\r\n            \"lat\",\r\n            \"lon\"\r\n          ]          \r\n        }        \r\n      },\r\n      \"required\":[\r\n        \"southWest\",\r\n        \"northEast\"\r\n      ]      \r\n    },\r\n    \"center\":{\r\n      \"type\":\"object\",\r\n      \"default\":\" \",\r\n      \"description\":\"The current center of the map\",\r\n      \"properties\":{\r\n        \"lat\":{\r\n          \"type\":\"number\",\r\n          \"description\":\"The latitude of the location that was clicked\",\r\n          \"minimum\":\"-90\",\r\n          \"maximum\":\"90\"\r\n        },\r\n        \"lon\":{\r\n          \"type\":\"number\",\r\n          \"description\":\"The longitude of the location that was clicked\",\r\n          \"minimum\":\"-180\",\r\n          \"maximum\":\"180\"\r\n        }        \r\n      },\r\n      \"required\":[\r\n        \"lat\",\r\n        \"lon\"\r\n      ]      \r\n    },\r\n    \"range\":{\r\n      \"description\":\"The current distance, in meters, map is zoomed out\",\r\n      \"type\":\"number\"\r\n    },\r\n    \"requester\":{\r\n      \"description\":\"ID of client that requested this status message be sent (if any).  If no requester, message is being sent due to a map view change\",\r\n      \"type\":\"string\",\r\n      \"status\":\"updated\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"bounds\",\r\n    \"center\",\r\n    \"range\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.center.bounds\",\r\n  \"description\":\"Center the map on a particular bounding box. The map may also be zoomed to show the entire bounds (if possible) or to show a given range.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"bounds\":{\r\n      \"description\":\"Bounding box of area to be centered in map.\",\r\n      \"type\":\"object\",\r\n      \"default\":\" \",\r\n      \"properties\":{\r\n        \"southWest\":{\r\n          \"description\":\"Bottom right of the bounds\",\r\n          \"type\":\"object\",\r\n          \"properties\":{\r\n            \"lat\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The latitude value of the point\",\r\n              \"minimum\":\"-90\",\r\n              \"maximum\":\"90\"\r\n            },\r\n            \"lon\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The longitude value of the point\",\r\n              \"minimum\":\"-180\",\r\n              \"maximum\":\"180\"\r\n            }            \r\n          },\r\n          \"required\":[\r\n            \"lat\",\r\n            \"lon\"\r\n          ]          \r\n        },\r\n        \"northEast\":{\r\n          \"description\":\"Top left of the bounds\",\r\n          \"type\":\"object\",\r\n          \"properties\":{\r\n            \"lat\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The latitude value of the point\",\r\n              \"minimum\":\"-90\",\r\n              \"maximum\":\"90\"\r\n            },\r\n            \"lon\":{\r\n              \"type\":\"number\",\r\n              \"description\":\"The longitude value of the point\",\r\n              \"minimum\":\"-180\",\r\n              \"maximum\":\"180\"\r\n            }            \r\n          },\r\n          \"required\":[\r\n            \"lat\",\r\n            \"lon\"\r\n          ]          \r\n        }        \r\n      },\r\n      \"required\":[\r\n        \"southWest\",\r\n        \"northEast\"\r\n      ]      \r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"Attribute that defines the zoom behaviour of the map. If auto, map will adjust to zoom as close as possible to the given location in the user's viewable area. If a number, map will zoom to specified range in meters. If no zoom attribute is included, no zoom is performed.\",\r\n      \"type\":[\r\n        \"string\",\r\n        \"number\"\r\n      ],\r\n      \"default\":\" \"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"bounds\"\r\n  ]  \r\n};","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_FEATURE] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.center.feature\",\r\n  \"description\":\"Center the map on a particular feature. The map may also be zoomed to show the entire feature (if possible) or to show a given range.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay overlay where the feature to be centered on is found. If no overlayId is included, default overlay with ID equal to sending widget ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"featureId\":{\r\n      \"description\":\"The ID of the feature to center on\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"Attribute that defines the zoom behaviour of the map. If auto, map will adjust to best fit the feature in the user's viewable area. If a number, map will zoom to specified range in meters. If no zoom attribute is included, no zoom is performed.\",\r\n      \"type\":[\r\n        \"string\",\r\n        \"number\"\r\n      ],\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"featureId\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.center.location\",\r\n  \"description\":\"Center the map on a particular location. The map may also be zoomed as close as possible to the location or to a given range\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"location\":{\r\n      \"description\":\"Location to be centered in map.\",\r\n      \"default\":\"N/A\",\r\n      \"type\":\"object\",\r\n      \"properties\":{\r\n        \"lat\":{\r\n          \"type\":\"number\",\r\n          \"description\":\"The latitude value of the point\",\r\n          \"minimum\":\"-90\",\r\n          \"maximum\":\"90\"\r\n        },\r\n        \"lon\":{\r\n          \"type\":\"number\",\r\n          \"description\":\"The longitude value of the point\",\r\n          \"minimum\":\"-180\",\r\n          \"maximum\":\"180\"\r\n        }        \r\n      },\r\n      \"required\":[\r\n        \"lat\",\r\n        \"lon\"\r\n      ]      \r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"If auto, map will adjust to zoom as close as possible to the given location in the user's viewable area. If a number, map will zoom to specified range in meters. If no zoom attribute is included, no zoom is performed.\",\r\n      \"type\":[\r\n        \"string\",\r\n        \"number\"\r\n      ],\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"location\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.center.overlay\",\r\n  \"description\":\"Center the map on a particular overlay. The map may also be zoomed to show the entire overlay (if possible) or to show a given range\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"overlayId\":{\r\n      \"description\":\"The ID of the overlay to center on. If no overlayId is included, default overlay with ID equal to sending widgets ID is assumed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"sending widget's ID\"\r\n    },\r\n    \"zoom\":{\r\n      \"description\":\"Attribute that defines the zoom behaviour of the map. If auto, zoom will adjust to best fit the overlay in the user's viewable area.  If a number, map will zoom to specified range in meters.  If no zoom attribute is included, no zoom is performed.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \r\n  ]  \r\n};","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION] = {\r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.lookat.location\",\r\n  \"description\":\"Centers the camera on a particular location.\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"latitude\":{\r\n      \"type\":\"number\",\r\n      \"description\":\"The latitude value of the location\",\r\n      \"minimum\":\"-90\",\r\n      \"maximum\":\"90\",\r\n      \"default\": \"0\"\r\n    },\r\n    \"longitude\":{\r\n      \"type\":\"number\",\r\n      \"description\":\"The longitude value of the location\",\r\n      \"minimum\":\"-180\",\r\n      \"maximum\":\"180\",\r\n      \"default\": \"0\"\r\n    },\r\n    \"altitude\": {\r\n      \"type\":\"number\",\r\n      \"description\":\"The altitude value of the location\",\r\n      \"default\": \"0\"\r\n    },\r\n    \"heading\":{\r\n      \"type\": \"number\",\r\n      \"description\": \"Direction (that is, North, South, East, West), in degrees. Default=0(North)\",\r\n      \"minimum\":\"0\",\r\n      \"maximum\":\"360\",\r\n      \"default\":\"0\"\r\n    },\r\n    \"tilt\":{\r\n      \"type\": \"number\",\r\n      \"description\": \"Angle between the direction of the LookAt position and the normal to the surface of the Earth. A value of -90 indicates viewing directly down from above while 0 looks directly  at the horizon\",\r\n      \"minimum\": \"-90\",\r\n      \"maximum\": \"90\",\r\n      \"default\":\"-90\"\r\n    },\r\n    \"range\":{\r\n      \"description\":\"Distance in meters from the location specified\",\r\n      \"type\":\"number\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"altitudeMode\":{\r\n      \"description\":\"Specifies how the <altitude> specified for the LookAt point is interpreted.\",\r\n      \"type\":\"string\",\r\n      \"default\":\"clampToGround\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }\r\n  },\r\n  \"required\":[\r\n    \"range\"\r\n  ]\r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CLICKED] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.clicked\",\r\n  \"description\":\"'Click', or report that map was clicked\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"lat\":{\r\n      \"type\":\"number\",\r\n      \"description\":\"The latitude of the location that was clicked\",\r\n      \"default\":\"N/A\",\r\n      \"minimum\":\"-90\",\r\n      \"maximum\":\"90\"\r\n    },\r\n    \"lon\":{\r\n      \"type\":\"number\",\r\n      \"description\":\"The longitude of the location that was clicked\",\r\n      \"default\":\"N/A\",\r\n      \"minimum\":\"-180\",\r\n      \"maximum\":\"180\"\r\n    },\r\n    \"button\":{\r\n      \"description\":\"Which mouse button was clicked.  Allowable values are right, left, and middle.  For backwards compatibility, if this attribute is not populated it MUST be treated as a left mouse click the same as if it were populated with left.\",\r\n      \"type\":[\r\n        \"string\",\r\n        \"enum\"\r\n      ],\r\n      \"enum\":[\r\n        \"left\",\r\n        \"middle\",\r\n        \"right\"\r\n      ],\r\n      \"default\":\"left\"\r\n    },\r\n    \"type\":{\r\n      \"description\":\"The type of click event. Allowable values are single and double.  For backwards compatibility, if this attribute is not populated it MUST be assumed to be a single mouse click and treated the same as if it were populated with single.\",\r\n      \"type\":[\r\n        \"string\",\r\n        \"enum\"\r\n      ],\r\n      \"enum\":[\r\n        \"single\",\r\n        \"double\"\r\n      ],\r\n      \"default\":\"single\"\r\n    },\r\n    \"keys\":{\r\n      \"description\":\"An array of keys pressed during the click event.  Allowable values are alt, ctrl, shift, and none. For backwards compatibility, if this attribute is not populated it MUST be assumed that no additional keys were pressed and behave the same way as if it were populated with none.\",\r\n      \"type\":\"array\",\r\n      \"uniqueItems\":true,\r\n      \"default\":[\r\n        \"none\"\r\n      ],\r\n      \"items\":{\r\n        \"enum\":[\r\n          \"shift\",\r\n          \"alt\",\r\n          \"ctrl\",\r\n          \"none\"\r\n        ]        \r\n      }      \r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"lat\",\r\n    \"lon\",\r\n    \"button\",\r\n    \"keys\",\r\n    \"type\"\r\n  ]  \r\n};\r\n","cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_ZOOM] = { \r\n  \"$schema\":\"http://json-schema.org/draft-04/schema#\",\r\n  \"title\":\"map.view.zoom\",\r\n  \"description\":\"Zoom the map to a particular range\",\r\n  \"type\":\"object\",\r\n  \"properties\":{\r\n    \"range\":{\r\n      \"description\":\"The distance in meters from the map (note that most 2-D map renderers do not support infinite zoom and the range will be translated into the nearest supported zoom level).\",\r\n      \"type\":\"number\",\r\n      \"default\":\"N/A\"\r\n    },\r\n    \"messageId\":{\r\n      \"description\":\"A globally unique ID that identifies this particular message. If the messageId property is populated, maps that support the user manipulation extension MUST use this messageId in the map.message.complete, map.message.progress, and map.message.cancel messages as defined in the User Manipulation extension to indicate progress and either completion or cancellation (as appropriate) of this message request.\",\r\n      \"type\":\"string\",\r\n      \"status\":\"new\",\r\n      \"extension\":\"User Manipulation - Message Complete\"\r\n    }    \r\n  },\r\n  \"required\":[\r\n    \"range\"\r\n  ]  \r\n};","/**\r\n * Handles message sent over the CMAPI2_VISIBILITY_GET channel and creates\r\n * the appropriate transaction for the core map.  getVisibility messages\r\n * are not sent to the engine, as all checks need to be done to the storage\r\n * engine.\r\n *\r\n * (this channel does not exist in CMAPI 1.3 and is called out as such,\r\n *  eventually should be moved to a CMAPI 2.0 set of handlers.)\r\n *\r\n */\r\ncmapi.channel.handler[cmapi.channel.names.CMAPI2_VISIBILITY_GET] = {\r\n  // args will have a message and sender property\r\n  process: function (args) {\r\n      var oTransaction;\r\n      var message = args.message;\r\n      var sender = args.sender;\r\n\r\n      // If the message is not an array, create an array out of it\r\n      // so we can blanket handle all messages sent that way.\r\n      if (!Array.isArray(message.payload)) {\r\n        message.payload = [message.payload];\r\n      }\r\n\r\n      // Create a VISIBILITY_GET transaction,  There is no type in the\r\n      // typeLibrary that corresponds to VISIBILITY_GET, so we just make up\r\n      // the object on the fly and send it to the transactionQueue.\r\n      oTransaction = new emp.typeLibrary.Transaction({\r\n          intent: emp.intents.control.VISIBILITY_GET,\r\n          mapInstanceId: args.mapInstanceId,\r\n          transactionId: message.messageId,\r\n          sender: sender.id,\r\n          originChannel: cmapi.channel.names.CMAPI2_VISIBILITY_GET,\r\n          source: emp.api.cmapi.SOURCE,\r\n          originalMessage: args.originalMessage,\r\n          messageOriginator: sender.id,\r\n          originalMessageType: cmapi.channel.names.CMAPI2_VISIBILITY_GET,\r\n          items: [{\r\n            coreId: message.payload[0].targetId,\r\n            parentId: message.payload[0].parentId,\r\n            visible: undefined\r\n          }]\r\n      });\r\n      oTransaction.queue();\r\n  }\r\n};\r\n","/**\r\n * Handles message sent over the CMAPI2_MAP_CONFIG channel and creates\r\n * the appropriate transaction for the core map.\r\n *\r\n * (this channel does not exist in CMAPI 1.3 and is called out as such,\r\n *  eventually should be moved to a CMAPI 2.0 set of handlers.)\r\n *\r\n */\r\ncmapi.channel.handler[cmapi.channel.names.CMAPI2_MAP_CONFIG] = {\r\n\r\n  /**\r\n   * @param args\r\n   * @param args.message\r\n   * @param {Number} args.message.midDistanceThreshold The altitude at which\r\n   * non-labeled MIL-STD-2525 symbols start displaying labels.\r\n   * @param {Number} args.message.farDistanceThreshold The altitude MIL-STD-2525\r\n   * warfighting symbols stop displaying as dots and start displaying as symbols.\r\n   * @param {emp3.api.enums.IconSizeEnum} args.message.iconSize The size of\r\n   * all single point icons.\r\n   * @param {emp3.api.enums.MilStdLabelSettingEnum} args.message.milStdLabels\r\n   * Which labels should be turned on for MIL-STD-2525 warfighting symbols\r\n   * @param {Object} selectionStyle - what selection should look like when\r\n   * feature have been selected.\r\n   * @param {IGeoStrokeStyle} freehandStrokeStyle - The style of the lines drawn\r\n   * when in freehand mode.\r\n   *\r\n   * @param {Object} args.sender\r\n   * @param {string} args.sender.id  The id of the map that sent the message.\r\n   */\r\n  process: function (args) {\r\n      var configTransaction;\r\n      var labelTransaction;\r\n      var message = args.message;\r\n      var sender = args.sender;\r\n      var labels;\r\n      var labelItem;\r\n      var configItem = {};\r\n\r\n      // If the message is not an array, create an array out of it\r\n      // so we can blanket handle all messages sent that way.\r\n      if (!Array.isArray(message.payload)) {\r\n        message.payload = [message.payload];\r\n      }\r\n\r\n      // Create a MAP_CONFIG transaction,  There is no type in the\r\n      // typeLibrary that corresponds to MAP_CONFIG, so we just make up\r\n      // the object on the fly and send it to the transactionQueue.\r\n      configTransaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.MAP_CONFIG,\r\n        mapInstanceId: args.mapInstanceId,\r\n        transactionId: message.messageId,\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.CMAPI2_MAP_CONFIG,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: args.originalMessage,\r\n        messageOriginator: sender.id,\r\n        items: [],\r\n        originalMessageType: cmapi.channel.names.CMAPI2_MAP_CONFIG\r\n      });\r\n\r\n      // Also create a labelTransaction.  EMPv2 had a very different way of\r\n      // handling global config settings.  In order to keep v2 working, parse\r\n      // out all label settings into a separate transaction.  If we don't\r\n      // have a label setting we do not use this transaction.\r\n      labelTransaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.MIL_ICON_LABELS_SET,\r\n        mapInstanceId: args.mapInstanceId,\r\n        transactionId: message.messageId,\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.CMAPI2_MAP_CONFIG,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: args.originalMessage,\r\n        messageOriginator: sender.id,\r\n        items: [],\r\n        originalMessageType: cmapi.channel.names.CMAPI2_MAP_CONFIG\r\n      });\r\n\r\n      // copy all the properties from the config object and just pass\r\n      // it to the engine.  The engine will know what to do with it.\r\n      // If it is a label transaction, retrieve the labels used for that\r\n      // transaction.  Send over the labels.\r\n      for (var prop in message.payload[0]) {\r\n        if (prop === \"milStdLabels\") {\r\n          labels = this.getMilStdLabelList(message.payload[0][prop]);\r\n          labelItem = labels;\r\n        } else {\r\n          configItem[prop] = message.payload[0][prop];\r\n        }\r\n      }\r\n\r\n      if (labelItem) {\r\n        labelTransaction.items.push(labelItem);\r\n        labelTransaction.queue();\r\n      }\r\n\r\n      if (configItem) {\r\n        configTransaction.items.push(configItem);\r\n        configTransaction.queue();\r\n      }\r\n  },\r\n\r\n  getMilStdLabelList: function (labelOption) {\r\n    var labels = [];\r\n\r\n    // Base Labels\r\n    labels.push(\"V\");\r\n    labels.push(\"L\");\r\n    labels.push(\"S\");\r\n    labels.push(\"AA\");\r\n    labels.push(\"AB\");\r\n    labels.push(\"AC\");\r\n    // Common Labels\r\n    if (labelOption === emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS) {\r\n      labels.push(\"H\");\r\n      labels.push(\"M\");\r\n      labels.push(\"T\");\r\n      labels.push(\"T1\");\r\n      labels.push(\"CN\");\r\n    }\r\n    // All Labels\r\n    if (labelOption === emp3.api.enums.MilStdLabelSettingEnum.ALL_LABELS) {\r\n      labels.push(\"H\");\r\n      labels.push(\"M\");\r\n      labels.push(\"T\");\r\n      labels.push(\"T1\");\r\n      labels.push(\"CN\");\r\n      labels.push(\"C\");\r\n      labels.push(\"F\");\r\n      labels.push(\"G\");\r\n      labels.push(\"H1\");\r\n      labels.push(\"H2\");\r\n      labels.push(\"J\");\r\n      labels.push(\"K\");\r\n      labels.push(\"N\");\r\n      labels.push(\"P\");\r\n      labels.push(\"W\");\r\n      labels.push(\"W1\");\r\n      labels.push(\"X\");\r\n      labels.push(\"Y\");\r\n      labels.push(\"Z\");\r\n    }\r\n\r\n    return labels;\r\n  }\r\n};\r\n","/**\r\n * Handles message sent over the CMAPI2_FREEHAND_START channel and creates\r\n * the appropriate transaction for the core map.\r\n *\r\n * (this channel does not exist in CMAPI 1.3 and is called out as such,\r\n *  eventually should be moved to a CMAPI 2.0 set of handlers.)\r\n *\r\n */\r\ncmapi.channel.handler[cmapi.channel.names.CMAPI2_FREEHAND_START] = {\r\n\r\n  /**\r\n   * @param args\r\n   * @param args.message\r\n   * @param {Number} args.message.strokeStyle The style for the lines\r\n   * that will draw in freehand mode.\r\n   * @param {String} args.message.messageId The transaction id used for\r\n   * tracking who sent the message and used to match responses to requests.\r\n   * @param {Object} args.sender\r\n   * @param {string} args.sender.id  The id of the map that sent the message.\r\n   */\r\n  process: function (args) {\r\n      var transaction;\r\n      var message = args.message;\r\n      var sender = args.sender;\r\n      var item;\r\n\r\n      // Create a transaction,  There is no type in the\r\n      // typeLibrary that corresponds to CMAPI2_FREEHAND_START, so we just make up\r\n      // the object on the fly and send it to the transactionQueue.\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FREEHAND_START,\r\n        mapInstanceId: args.mapInstanceId,\r\n        transactionId: message.messageId,\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.CMAPI2_FREEHAND_START,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: args.originalMessage,\r\n        messageOriginator: sender.id,\r\n        items: [],\r\n        originalMessageType: cmapi.channel.names.CMAPI2_FREEHAND_START\r\n      });\r\n\r\n      item = {\r\n        freehandStrokeStyle: args.message.payload.strokeStyle\r\n      };\r\n\r\n      transaction.items.push(item);\r\n\r\n      transaction.queue();\r\n  }\r\n};\r\n","/**\r\n * Handles message sent over the CMAPI2_FREEHAND_STOP channel and creates\r\n * the appropriate transaction for the core map.\r\n *\r\n * (this channel does not exist in CMAPI 1.3 and is called out as such,\r\n *  eventually should be moved to a CMAPI 2.0 set of handlers.)\r\n *\r\n */\r\ncmapi.channel.handler[cmapi.channel.names.CMAPI2_FREEHAND_STOP] = {\r\n\r\n  /**\r\n   * @param args\r\n   * @param args.message\r\n   * @param {String} args.message.messageId The transaction id used for\r\n   * tracking who sent the message and used to match responses to requests.\r\n   * @param {Object} args.sender\r\n   * @param {string} args.sender.id  The id of the map that sent the message.\r\n   */\r\n  process: function (args) {\r\n      var transaction;\r\n      var message = args.message;\r\n      var sender = args.sender;\r\n\r\n      // Create a transaction,  There is no items for CMAPI2_FREEHAND_STOP, so\r\n      // we just queue this transaction.\r\n      transaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.FREEHAND_STOP,\r\n        mapInstanceId: args.mapInstanceId,\r\n        transactionId: message.messageId,\r\n        sender: sender.id,\r\n        originChannel: cmapi.channel.names.CMAPI2_FREEHAND_STOP,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originalMessage: args.originalMessage,\r\n        messageOriginator: sender.id,\r\n        items: [{}], // need at least one item or it doesn't get processed by intents.\r\n        originalMessageType: cmapi.channel.names.CMAPI2_FREEHAND_STOP\r\n      });\r\n\r\n      transaction.queue();\r\n  }\r\n};\r\n","cmapi.channel.handler[cmapi.channel.names.MAP_CONVERT] = {\r\n\r\n  process: function(args) {\r\n    var xyTransaction,\r\n      latlonTransaction,\r\n      message = args.message,\r\n      sender = args.sender,\r\n      payload,\r\n      oItem,\r\n      //oStorageItem,\r\n      xyToLatlonItems = [],\r\n      latlonToXYItems = [];\r\n\r\n\r\n    // get schema for this channel\r\n    // can use for channel specific validation\r\n    if (!Array.isArray(message.payload)) {\r\n      message.payload = [message.payload];\r\n    }\r\n\r\n    for (var iIndex = 0, iLength = message.payload.length; iIndex < iLength; iIndex++) {\r\n\r\n      payload = message.payload[iIndex];\r\n\r\n      if (!payload.conversionType) {\r\n        payload.conversionType = \"offsetPixelToDecimalDegrees\";\r\n      }\r\n\r\n      switch (payload.conversionType) {\r\n        case \"offsetPixelToDecimalDegrees\":\r\n          oItem = new emp.typeLibrary.Convert({\r\n            y: payload.y,\r\n            x: payload.x\r\n          });\r\n\r\n          xyToLatlonItems.push(oItem);\r\n          break;\r\n        case \"decimalDegreesToOffsetPixel\":\r\n          oItem = new emp.typeLibrary.Convert({\r\n            lat: payload.y,\r\n            lon: payload.x\r\n          });\r\n\r\n          latlonToXYItems.push(oItem);\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (xyToLatlonItems.length > 0) {\r\n      xyTransaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.GET_LATLON_FROM_XY,\r\n        mapInstanceId: args.mapInstanceId,\r\n        transactionId: message.messageId,\r\n        sender: sender.id,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originChannel: cmapi.channel.names.MAP_CONVERT,\r\n        originalMessage: args.originalMessage,\r\n        messageOriginator: sender.id,\r\n        originalMessageType: cmapi.channel.names.MAP_CONVERT,\r\n        items: xyToLatlonItems\r\n      });\r\n      xyTransaction.queue();\r\n    }\r\n\r\n    if (latlonToXYItems.length > 0) {\r\n      latlonTransaction = new emp.typeLibrary.Transaction({\r\n        intent: emp.intents.control.GET_XY_FROM_LATLON,\r\n        mapInstanceId: args.mapInstanceId,\r\n        transactionId: message.messageId,\r\n        sender: sender.id,\r\n        source: emp.api.cmapi.SOURCE,\r\n        originChannel: cmapi.channel.names.MAP_CONVERT,\r\n        originalMessage: args.originalMessage,\r\n        messageOriginator: sender.id,\r\n        originalMessageType: cmapi.channel.names.MAP_CONVERT,\r\n        items: latlonToXYItems\r\n      });\r\n      latlonTransaction.queue();\r\n    }\r\n  }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_CLEAR\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_CLEAR] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            oStorageItem,\r\n            oItems = [];\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_CLEAR];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oStorageItem = emp.storage.get.byIds(payload);\r\n\r\n            if (oStorageItem === undefined) {\r\n                // The object is not in storage.\r\n                // Pass it as a feature and let the engine fail it.\r\n                oItem = new emp.typeLibrary.Feature({\r\n                    overlayId: payload.overlayId,\r\n                    parentId: payload.parentId,\r\n                    featureId: payload.featureId\r\n                });\r\n                oItems.push(oItem);\r\n            } else {\r\n                switch (oStorageItem.globalType) {\r\n                case emp.typeLibrary.types.WMS:\r\n                    // A WMS service does not have a parentId.\r\n                    oItem = oStorageItem.createDuplicate();\r\n                    oItems.push(oItem);\r\n                    break;\r\n                case emp.typeLibrary.types.FEATURE:\r\n                default:\r\n                    oItem = oStorageItem.createDuplicate();\r\n                    oItems.push(oItem);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_CLEAR,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_CLEAR,\r\n            items: oItems\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH] = {\r\n    // args will have a message and sender property\r\n    process: function(args) {\r\n        var featureTransaction,\r\n            i,\r\n            len,\r\n            featureItems = [],\r\n            cmapiBatchMsg = args.message.payload,\r\n            sender = args.sender,\r\n            oaBatchPayload = cmapiBatchMsg.features,\r\n            payload,\r\n            item,\r\n            sOverlayId;\r\n\r\n\r\n        featureTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.SELECTION_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: cmapiBatchMsg.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_DESELECTED_BATCH,\r\n            items: featureItems\r\n        });\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH];\r\n\r\n        if (cmapiBatchMsg.hasOwnProperty('overlayId'))\r\n        {\r\n            sOverlayId = cmapiBatchMsg.overlayId;\r\n        }\r\n        \r\n        len = oaBatchPayload.length;\r\n\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = oaBatchPayload[i];\r\n            item = {};\r\n            \r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                if (sOverlayId)\r\n                {\r\n                    payload.overlayId = sOverlayId;\r\n                }\r\n                else\r\n                {\r\n                    payload.overlayId = sender.id;\r\n                }\r\n            }\r\n\r\n            item = new emp.typeLibrary.Selection({\r\n                overlayId: payload.overlayId,\r\n                featureId: payload.featureId,\r\n                parentId: payload.parentId,\r\n                selectedId: payload.selectedId,\r\n                selectedName: payload.selectedName,\r\n                select: false,\r\n                transactionId: featureTransaction.transactionId\r\n            });\r\n            \r\n            featureItems.push(item);\r\n        }\r\n        \r\n        featureTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for map.feature.deselected\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_DESELECTED] = {\r\n    // args will have a message and sender property\r\n    process: function(args) {\r\n        var featureTransaction,\r\n            i,\r\n            len,\r\n            featureItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            //schema,\r\n            item;\r\n\r\n\r\n        featureTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.SELECTION_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_DESELECTED,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_DESELECTED,\r\n            items: featureItems\r\n        });\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_DESELECTED];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        len = message.payload.length;\r\n\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = message.payload[i];\r\n            item = {};\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            item = new emp.typeLibrary.Selection({\r\n                overlayId: payload.overlayId,\r\n                featureId: payload.featureId,\r\n                parentId: payload.parentId,\r\n                selectedId: payload.deSelectedId,\r\n                selectedName: payload.deSelectedName,\r\n                select: false,\r\n                transactionId: featureTransaction.transactionId\r\n            });\r\n\r\n            featureItems.push(item);\r\n        }\r\n\r\n        featureTransaction.queue();\r\n    }\r\n};\r\n","// Register a channel handler for MAP_FEATURE_DRAW\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_DRAW] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            oItems = [];\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_DRAW];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Draw({\r\n                overlayId: payload.overlayId,\r\n                parentId: payload.parentId,\r\n                featureId: payload.featureId,\r\n                type: payload.type,\r\n                name: payload.name,\r\n                symbolCode: payload.symbolCode,\r\n                coordinates: payload.coordinates,\r\n                properties: payload.properties,\r\n                menuId: payload.menuId\r\n            });\r\n            oItem.source = emp.api.cmapi.SOURCE;\r\n            oItem.transactionId = message.messageId;\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.DRAW_BEGIN,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_DRAW,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_DRAW,\r\n            items: oItems\r\n        });\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_EDIT\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_EDIT] = {\r\n\r\n  // args will have a message and sender property\r\n  process: function(args) {\r\n    var transaction;\r\n    var message = args.message,\r\n      sender = args.sender,\r\n      payload,\r\n      item,\r\n      items = [];\r\n\r\n\r\n    if (!Array.isArray(message.payload)) {\r\n      message.payload = [message.payload];\r\n    }\r\n\r\n    for (var i = 0, length = message.payload.length; i < length; i++) {\r\n      payload = message.payload[i];\r\n\r\n      if ((payload.overlayId === undefined) || (payload.overlayId === null)) {\r\n        payload.overlayId = sender.id;\r\n      }\r\n\r\n      item = new emp.typeLibrary.Edit(payload);\r\n      item.transactionId = message.messageId;\r\n      items.push(item);\r\n    }\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.EDIT_BEGIN,\r\n      mapInstanceId: args.mapInstanceId,\r\n      transactionId: message.messageId,\r\n      sender: sender.id,\r\n      originChannel: cmapi.channel.names.MAP_FEATURE_EDIT,\r\n      source: emp.api.cmapi.SOURCE,\r\n      originalMessage: args.originalMessage,\r\n      messageOriginator: sender.id,\r\n      originalMessageType: cmapi.channel.names.MAP_FEATURE_EDIT,\r\n      items: items\r\n    });\r\n\r\n    transaction.queue();\r\n  }\r\n};\r\n","/* globals emp, cmapi */\r\n\r\n/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_HIDE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_HIDE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            oItem,\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload;\r\n            //schema;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_HIDE];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VISIBILITY_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_HIDE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_HIDE,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if (emp.helpers.isEmptyString(payload.overlayId))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = {\r\n                overlayId: payload.overlayId,\r\n                featureId: payload.featureId,\r\n                visible: false,\r\n                zoom: false\r\n            };\r\n\r\n            if (!emp.helpers.isEmptyString(payload.parentId))\r\n            {\r\n                oItem.parentId = payload.parentId;\r\n            }\r\n\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_PLOT\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT_BATCH] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload = message.payload,\r\n            feature,\r\n            oItem,\r\n            iLength,\r\n            iIndex,\r\n            oItems = [];\r\n        var sOverlayId = payload.overlayId;\r\n        var sParentId = payload.parentId;\r\n        var sFormat = payload.format;\r\n        var bZoom = (payload.zoom === true)? true: false;\r\n        var bReadOnly = (payload.readOnly === true)? true: false;\r\n        var sMenuId = payload.menuId;\r\n\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.FEATURE_ADD,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: payload.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT_BATCH,\r\n            items: oItems\r\n        });\r\n\r\n        for (iIndex = 0, iLength = payload.features.length;\r\n                iIndex < iLength; iIndex++) {\r\n            feature = payload.features[iIndex];\r\n\r\n            if (emp.helpers.isEmptyString(feature.overlayId))\r\n            {\r\n                if (sOverlayId)\r\n                {\r\n                    feature.overlayId = sOverlayId;\r\n                }\r\n                else\r\n                {\r\n                    feature.overlayId = sender.id;\r\n                }\r\n            }\r\n\r\n            if (emp.helpers.isEmptyString(feature.parentId))\r\n            {\r\n                if (sParentId)\r\n                {\r\n                    feature.parentId = sParentId;\r\n                }\r\n            }\r\n\r\n            if (emp.helpers.isEmptyString(feature.format))\r\n            {\r\n                if (sFormat)\r\n                {\r\n                    feature.format = sFormat;\r\n                }\r\n            }\r\n\r\n            if ((feature.zoom === undefined) || (feature.zoom === null))\r\n            {\r\n                feature.zoom = bZoom;\r\n            }\r\n\r\n            if ((feature.readOnly === undefined) || (feature.readOnly === null))\r\n            {\r\n                feature.readOnly = bReadOnly;\r\n            }\r\n\r\n            if (emp.helpers.isEmptyString(feature.menuId))\r\n            {\r\n                if (sMenuId)\r\n                {\r\n                    feature.menuId = sMenuId;\r\n                }\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Feature({\r\n                overlayId: feature.overlayId,\r\n                parentId: feature.parentId,\r\n                featureId: feature.featureId,\r\n                name: feature.name,\r\n                format: feature.format,\r\n                data: feature.feature,\r\n                zoom: feature.zoom,\r\n                readOnly: feature.readOnly,\r\n                menuId: feature.menuId,\r\n                properties: feature.properties,\r\n                visible: feature.visible\r\n            });\r\n\r\n            if (oItem.format === emp.typeLibrary.featureFormatType.GEOJSON ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_POINT ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_POLYGON ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_SQUARE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_TEXT)\r\n            {\r\n                cmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT].mergeGeoJSONStyles(oItem);\r\n            }\r\n\r\n            oItem.validate();\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_PLOT\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            iLength,\r\n            iIndex,\r\n            oItems = [];\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_PLOT];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.FEATURE_ADD,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT,\r\n            items: oItems\r\n        });\r\n\r\n        for (iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Feature({\r\n                overlayId: payload.overlayId,\r\n                parentId: payload.parentId,\r\n                featureId: payload.featureId,\r\n                name: payload.name,\r\n                format: payload.format,\r\n                data: payload.feature,\r\n                zoom: payload.zoom,\r\n                readOnly: payload.readOnly,\r\n                menuId: payload.menuId,\r\n                properties: payload.properties,\r\n                visible: payload.visible\r\n            });\r\n\r\n            if (oItem.format === emp.typeLibrary.featureFormatType.GEOJSON ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_POINT ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_POLYGON ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_SQUARE ||\r\n              oItem.format === emp3.api.enums.FeatureTypeEnum.GEO_TEXT)\r\n            {\r\n                this.mergeGeoJSONStyles(oItem);\r\n            }\r\n\r\n            oItem.validate();\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    },\r\n\r\n    mergeGeoJSONStyles: function(oFeature) {\r\n      if (oFeature.hasOwnProperty('properties')) {\r\n        if (oFeature.properties.hasOwnProperty('iconUrl')) {\r\n          //It has an icon url defined.\r\n          return;\r\n        }\r\n      } else {\r\n        oFeature.properties = {};\r\n      }\r\n\r\n      if (!oFeature.hasOwnProperty('data')) {\r\n        return;\r\n      }\r\n\r\n      var geojson = oFeature.data;\r\n      if (typeof oFeature.data === \"string\") {\r\n        try {\r\n          geojson = JSON.parse(oFeature.data);\r\n        } catch (oError) {\r\n          // Its not geojson data.\r\n          return;\r\n        }\r\n      }\r\n      // The type must be feature.\r\n      if (!geojson.hasOwnProperty('type')) {\r\n        return;\r\n      }\r\n\r\n      if (geojson.type.toLowerCase() !== 'feature') {\r\n        return;\r\n      }\r\n\r\n      // The feature must have a properties attribute.\r\n      if (!geojson.hasOwnProperty('properties')) {\r\n        return;\r\n      }\r\n\r\n      // See if the properties has a style attribute.\r\n      if (!geojson.properties.hasOwnProperty('style')) {\r\n        return;\r\n      }\r\n\r\n      // See if the style has a iconStyle attribute.\r\n      if (!geojson.properties.style.hasOwnProperty('iconStyle')) {\r\n        return;\r\n      }\r\n\r\n      // See if the iconStyle has a url attribute.\r\n      if (!geojson.properties.style.iconStyle.hasOwnProperty('url')) {\r\n        return;\r\n      }\r\n\r\n      oFeature.properties.iconUrl = geojson.properties.style.iconStyle.url;\r\n    }\r\n\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_FEATURE_PLOT_URL.\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_PLOT_URL] = {\r\n\r\n  // args will have a message and sender property\r\n    process: function (args) {\r\n        var featureTransaction,\r\n          mapServiceTransaction,\r\n          i,\r\n          len,\r\n          mapServiceItems = [],\r\n          featureItems = [],\r\n          message = args.message,\r\n          sender = args.sender,\r\n          payload,\r\n          //schema,\r\n          item,\r\n          visible,\r\n          layers,\r\n          bUseProxy;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        // schema = cmapi.channel.schema[\"map.feature.plot.url\"];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        len = message.payload.length;\r\n        // plot.url can load kml, geojson, and WMS.\r\n        //\r\n        // We need to handle WMS differently that kml and geojson\r\n        // kml and geoJSON will use the typeLibrary.Feature\r\n        // WMS will use typeLibrary.WMS\r\n        // If the message has an array of payload we will check to see if it is mixed between\r\n        // WMS and others.  This is an edge case, but is valid according to CMAPI\r\n        //\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = message.payload[i];\r\n            item = {};\r\n            visible = true;\r\n            layers = [];\r\n\r\n            // determine if we need to use the proxy.\r\n            bUseProxy = payload.useProxy;\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            visible = true;\r\n            if (payload.visible !== undefined && payload.visible === false) {\r\n              visible = false;\r\n            }\r\n\r\n            if (!payload.hasOwnProperty('format'))\r\n            {\r\n                payload.format = 'kml';\r\n            }\r\n\r\n            switch (payload.format.toLowerCase()) {\r\n            case \"wms\":\r\n\r\n              if (payload.hasOwnProperty(\"params\")) {\r\n                if (payload.params.hasOwnProperty(\"layers\")) {\r\n                  if (!emp.util.isEmptyString(payload.params.layers)) {\r\n                    layers = payload.params.layers.split(\",\");\r\n                    // We  need to remove the layers parameter.\r\n                    delete payload.params[\"layers\"];\r\n                  } else if (Array.isArray(payload.params.layers)) {\r\n                    layers = payload.params.layers;\r\n                    delete payload.params.layers;\r\n                  }\r\n                }\r\n              }\r\n\r\n              item = new emp.typeLibrary.WMS({\r\n                id: payload.featureId,\r\n                overlayId: payload.overlayId,\r\n                visible: visible,\r\n                layers: layers,\r\n                zoom: payload.zoom,\r\n                name: payload.name,\r\n                format: payload.format,\r\n                url: payload.url,\r\n                useProxy: bUseProxy,\r\n                params: payload.params,\r\n                transactionId: message.messageId,\r\n                messageId: payload.messageId,\r\n                intent: emp.intents.control.MAP_SERVICE_ADD\r\n              });\r\n              mapServiceItems.push(item);\r\n\r\n              break;\r\n            case \"wmts\":\r\n\r\n              item = new emp.typeLibrary.WMTS({\r\n                id: payload.featureId,\r\n                overlayId: payload.overlayId,\r\n                visible: visible,\r\n                name: payload.name,\r\n                layer: payload.layer,\r\n                format: payload.format,\r\n                url: payload.url,\r\n                useProxy: bUseProxy,\r\n                params: payload.params,\r\n                transactionId: message.messageId,\r\n                messageId: payload.messageId,\r\n                intent: emp.intents.control.MAP_SERVICE_ADD\r\n              });\r\n\r\n              mapServiceItems.push(item);\r\n              break;\r\n            case \"kmllayer\":\r\n              item = new emp.typeLibrary.KmlLayer({\r\n                id: payload.featureId,\r\n                overlayId: payload.overlayId,\r\n                visible: visible,\r\n                name: payload.name,\r\n                kmlData: payload.kmlString,\r\n                format: payload.format,\r\n                url: payload.url,\r\n                useProxy: bUseProxy,\r\n                transactionId: message.messageId,\r\n                messageId: payload.messageId,\r\n                intent: emp.intents.control.MAP_SERVICE_ADD\r\n              });\r\n\r\n              mapServiceItems.push(item);\r\n              break;\r\n            case \"geojson\":\r\n            default:\r\n              item = new emp.typeLibrary.Feature({\r\n                featureId: payload.featureId,\r\n                parentId: payload.parentId,\r\n                overlayId: payload.overlayId,\r\n                visible: visible,\r\n                zoom: payload.zoom,\r\n                name: payload.name,\r\n                format: payload.format,\r\n                url: payload.url,\r\n                params: payload.params,\r\n                properties: payload.properties\r\n              });\r\n              item.validate();\r\n              featureItems.push(item);\r\n              break;\r\n            }\r\n        }\r\n        if (featureItems.length > 0) {\r\n            featureTransaction = new emp.typeLibrary.Transaction({\r\n              intent: emp.intents.control.FEATURE_ADD,\r\n              mapInstanceId: args.mapInstanceId,\r\n              transactionId: message.messageId,\r\n              sender: sender.id,\r\n              originChannel: cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n              source: emp.api.cmapi.SOURCE,\r\n              originalMessage: args.originalMessage,\r\n              messageOriginator: sender.id,\r\n              originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n              items: featureItems\r\n            });\r\n            featureTransaction.queue();\r\n        }\r\n\r\n        if (mapServiceItems.length > 0) {\r\n          mapServiceTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.MAP_SERVICE_ADD,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_PLOT_URL,\r\n            items: mapServiceItems\r\n          });\r\n\r\n          mapServiceTransaction.queue();\r\n        }\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_SELECTED_BATCH\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH] = {\r\n    // args will have a message and sender property\r\n    process: function(args) {\r\n        var featureTransaction,\r\n            i,\r\n            len,\r\n            featureItems = [],\r\n            cmapiBatchMsg = args.message.payload,\r\n            sender = args.sender,\r\n            oaBatchPayload = cmapiBatchMsg.features,\r\n            payload,\r\n            item,\r\n            sOverlayId;\r\n\r\n\r\n        featureTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.SELECTION_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: cmapiBatchMsg.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH,\r\n            items: featureItems\r\n        });\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED_BATCH];\r\n\r\n        if (cmapiBatchMsg.hasOwnProperty('overlayId'))\r\n        {\r\n            sOverlayId = cmapiBatchMsg.overlayId;\r\n        }\r\n        \r\n        len = oaBatchPayload.length;\r\n\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = oaBatchPayload[i];\r\n            item = {};\r\n            \r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                if (sOverlayId)\r\n                {\r\n                    payload.overlayId = sOverlayId;\r\n                }\r\n                else\r\n                {\r\n                    payload.overlayId = sender.id;\r\n                }\r\n            }\r\n\r\n            item = new emp.typeLibrary.Selection({\r\n                overlayId: payload.overlayId,\r\n                featureId: payload.featureId,\r\n                parentId: payload.parentId,\r\n                selectedId: payload.selectedId,\r\n                selectedName: payload.selectedName,\r\n                select: true,\r\n                transactionId: featureTransaction.transactionId\r\n            });\r\n            \r\n            featureItems.push(item);\r\n        }\r\n        \r\n        featureTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for map.feature.selected\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_SELECTED] = {\r\n    // args will have a message and sender property\r\n    process: function(args) {\r\n        var featureTransaction,\r\n            i,\r\n            len,\r\n            featureItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            //schema,\r\n            item;\r\n\r\n\r\n        featureTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.SELECTION_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_SELECTED,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_SELECTED,\r\n            items: featureItems\r\n        });\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SELECTED];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        len = message.payload.length;\r\n\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = message.payload[i];\r\n            item = {};\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            item = new emp.typeLibrary.Selection({\r\n                overlayId: payload.overlayId,\r\n                featureId: payload.featureId,\r\n                parentId: payload.parentId,\r\n                selectedId: payload.selectedId,\r\n                selectedName: payload.selectedName,\r\n                select: true,\r\n                transactionId: featureTransaction.transactionId\r\n            });\r\n\r\n            featureItems.push(item);\r\n        }\r\n\r\n        featureTransaction.queue();\r\n    }\r\n};\r\n","/* globals emp, cmapi */\r\n\r\n/* global cmapi */\r\n\r\n// Register a channel handler for MAP_FEATURE_SHOW\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_SHOW] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            //schema,\r\n            bZoomTo,\r\n            oItem;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_SHOW];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VISIBILITY_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_SHOW,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_SHOW,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            bZoomTo = ((payload.zoom === true) && (message.payload.length === 1));\r\n\r\n            if (emp.helpers.isEmptyString(payload.overlayId))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = {\r\n                overlayId: payload.overlayId,\r\n                featureId: payload.featureId,\r\n                visible: true,\r\n                zoom: bZoomTo\r\n            };\r\n\r\n            if (!emp.helpers.isEmptyString(payload.parentId))\r\n            {\r\n                oItem.parentId = payload.parentId;\r\n            }\r\n\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* global emp, cmapi */\r\n\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var featureTransaction,\r\n            i,\r\n            len,\r\n            featureItems = [],\r\n            message = args.message.payload,\r\n            oaFeatures = message.features,\r\n            sender = args.sender,\r\n            payload,\r\n            //item,\r\n            sOverlayId;\r\n\r\n        if (message.hasOwnProperty('overlayId'))\r\n        {\r\n            // Check to see if there is a global overlayId.\r\n            sOverlayId = message.overlayId;\r\n        }\r\n\r\n        len = oaFeatures.length;\r\n\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = oaFeatures[i];\r\n            //item = {};\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                // If it has no overlayId see if there is a global one else use the sender id.\r\n                if (sOverlayId)\r\n                {\r\n                    payload.overlayId = sOverlayId;\r\n                }\r\n                else\r\n                {\r\n                    payload.overlayId = sender.id;\r\n                }\r\n            }\r\n\r\n            featureItems.push({\r\n                    overlayId: payload.overlayId,\r\n                    parentId: payload.parentId,\r\n                    featureId: payload.featureId\r\n                });\r\n        }\r\n\r\n        featureTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_UNPLOT_BATCH,\r\n            items: featureItems\r\n        });\r\n\r\n        featureTransaction.queue();\r\n    }\r\n};\r\n","/* globals emp, cmapi */\r\n\r\n// Register a channel handler for map.feature.unplot\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_UNPLOT] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var featureTransaction,\r\n            i,\r\n            len,\r\n            featureItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload;\r\n            //item,\r\n            //itemInStorage;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_FEATURE_UNPLOT];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        len = message.payload.length;\r\n\r\n        for (i = 0; i < len; i = i + 1) {\r\n            payload = message.payload[i];\r\n            //item = {};\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            featureItems.push({\r\n                    overlayId: payload.overlayId,\r\n                    parentId: payload.parentId,\r\n                    featureId: payload.featureId\r\n                });\r\n        }\r\n\r\n        featureTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.CMAPI_GENERIC_FEATURE_REMOVE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_FEATURE_UNPLOT,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_FEATURE_UNPLOT,\r\n            items: featureItems\r\n        });\r\n\r\n        featureTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_FEATURE_UPDATE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_FEATURE_UPDATE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var oaItems = [];\r\n        var message = args.message;\r\n        var oSender = args.sender;\r\n        var oItem;\r\n        //var oStorageItem;\r\n        //var bFoundMultiParent = false;\r\n        var oPayload;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        // schema = cmapi.channel.schema[\"map.feature.update\"];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.FEATURE_UPDATE,\r\n                mapInstanceId: args.mapInstanceId,\r\n                transactionId: message.messageId,\r\n                sender: oSender.id,\r\n                originChannel: cmapi.channel.names.MAP_FEATURE_UPDATE,\r\n                source: emp.api.cmapi.SOURCE,\r\n                originalMessage: args.originalMessage,\r\n                messageOriginator: oSender.id,\r\n                originalMessageType: cmapi.channel.names.MAP_FEATURE_UPDATE,\r\n                items: oaItems\r\n            });\r\n\r\n        // Build the tranasction\r\n        for (var iIndex = 0, iLength = message.payload.length; iIndex < iLength; iIndex++)\r\n        {\r\n            oPayload = message.payload[iIndex];\r\n\r\n            if ((oPayload.overlayId === undefined) || (oPayload.overlayId === null))\r\n            {\r\n                oPayload.overlayId = oSender.id;\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Feature({\r\n                featureId: oPayload.featureId,\r\n                parentId: oPayload.parentId,\r\n                overlayId: oPayload.overlayId,\r\n                name: oPayload.name\r\n            });\r\n            oItem.parentId = oPayload.parentId;\r\n\r\n            if (oPayload.hasOwnProperty(\"name\"))\r\n            {\r\n                oItem.name = oPayload.name;\r\n            }\r\n            else\r\n            {\r\n                oItem.name = undefined;\r\n            }\r\n\r\n            if (oPayload.hasOwnProperty(\"newOverlayId\"))\r\n            {\r\n                oItem.destOverlayId = oPayload.newOverlayId;\r\n            }\r\n\r\n            if (oPayload.hasOwnProperty(\"newParentId\"))\r\n            {\r\n                oItem.destParentId = oPayload.newParentId;\r\n            }\r\n            oaItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_GET\r\ncmapi.channel.handler[cmapi.channel.names.MAP_GET] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_GET];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.GET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_GET,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_GET,\r\n            items: [new emp.typeLibrary.Status(message.payload[0])]\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\ncmapi.channel.handler[cmapi.channel.names.MAP_MESSAGE_CANCEL] = {\r\n\tprocess: function (args) {\r\n\t\tvar message = args.message,\r\n\t\t\tlen,\r\n\t\t\ttransactionId,\r\n\t\t\ti;\r\n\r\n\t\t// Put the payload in a consistent format.  \r\n\t\t// Some payloads can be arrays, others can be\r\n\t\t// objects.  By making this an array we can handle\r\n\t\t// it one way.\r\n\t\tif (!Array.isArray(message.payload)) {\r\n\t\t\tmessage.payload = [message.payload];\r\n\t\t}\r\n\r\n\t\tlen = message.payload.length;\r\n\r\n\t\t// Loop through each message and attempt to cancel \r\n\t\t// the transaction with the associated transactionIds.\r\n\t\t// If the transaction already occurred, nothing bad will\r\n\t\t// happen.  \r\n\t\tfor (i = 0; i < len; i += 1) {\r\n\t\t\tif (message.payload[i].messageId) {\r\n\t\t\t\ttransactionId = message.payload[i].messageId;\r\n\t\t\t\temp.transactionQueue.cancel(transactionId);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n};","/*global emp, cmapi */\r\ncmapi.channel.handler[cmapi.channel.names.MAP_MESSAGE_COMPLETE] = {\r\n\tprocess: function (args) {\r\n\t\tvar message = args.message,\r\n\t\t\tlen,\r\n\t\t\ttransactionId,\r\n\t\t\ti;\r\n\r\n\t\t// Put the payload in a consistent format.  \r\n\t\t// Some payloads can be arrays, others can be\r\n\t\t// objects.  By making this an array we can handle\r\n\t\t// it one way.\r\n\t\tif (!Array.isArray(message.payload)) {\r\n\t\t\tmessage.payload = [message.payload];\r\n\t\t}\r\n\r\n\t\tlen = message.payload.length;\r\n\r\n\t\t// Loop through each message and attempt to cancel \r\n\t\t// the transaction with the associated transactionIds.\r\n\t\t// If the transaction already occurred, nothing bad will\r\n\t\t// happen.  \r\n\t\tfor (i = 0; i < len; i += 1) {\r\n\t\t\tif (message.payload[i].messageId) {\r\n\t\t\t\ttransactionId = message.payload[i].messageId;\r\n\t\t\t\temp.transactionQueue.end(transactionId);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n};","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_CLEAR\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLEAR] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            //bFoundMultiParent = false,\r\n            oItems = [];\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_REMOVE];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_CLEAR,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_CLEAR,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_CLEAR,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Overlay({\r\n                overlayId: payload.overlayId\r\n            });\r\n            oItems.push(oItem);\r\n\r\n            if (!emp.storage.findOverlay(payload.overlayId))\r\n            {\r\n                oTransaction.fail({\r\n                    coreId: oItem.coreId,\r\n                    level: emp.typeLibrary.Error.level.MAJOR,\r\n                    message: \"Overlay does not exist.\"\r\n                });\r\n            }\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_CLUSTER_ACTIVATE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            i,\r\n            len;\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (i = 0, len = message.payload.length;\r\n                i < len; i++) {\r\n            payload = message.payload[i];\r\n\r\n            oItem = new emp.typeLibrary.Overlay.Cluster({\r\n                overlayId: payload.overlayId || sender.id\r\n            });\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_CLUSTER_ACTIVATE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE,\r\n            sender: sender.id,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_CLUSTER_ACTIVATE,\r\n            items: oItems\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_CLUSTER_DEACTIVATE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            i,\r\n            len;\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (i = 0, len = message.payload.length;\r\n                i < len; i++) {\r\n            payload = message.payload[i];\r\n\r\n            oItem = new emp.typeLibrary.Overlay.Cluster({\r\n                overlayId: payload.overlayId || sender.id\r\n            });\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_CLUSTER_DEACTIVATE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE,\r\n            sender: sender.id,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_CLUSTER_DEACTIVATE,\r\n            items: oItems\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n\r\n// Register a channel handler for map.feature.unplot\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            i,\r\n            len;\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (i = 0, len = message.payload.length;\r\n                i < len; i++) {\r\n            payload = message.payload[i];\r\n\r\n            oItem = new emp.typeLibrary.Overlay.Cluster({\r\n                overlayId: payload.overlayId || sender.id\r\n            });\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_CLUSTER_REMOVE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_CLUSTER_REMOVE,\r\n            items: oItems\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_CLUSTER_SET\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            i,\r\n            len;\r\n\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (i = 0, len = message.payload.length;\r\n                i < len; i++) {\r\n            payload = message.payload[i];\r\n\r\n            oItems.push(new emp.typeLibrary.Overlay.Cluster({\r\n                overlayId: payload.overlayId || sender.id,\r\n                threshold: payload.threshold,\r\n                distance: payload.distance,\r\n                clusterStyle: payload.clusterStyle\r\n            }));\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_CLUSTER_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_CLUSTER_SET,\r\n            items: oItems\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_CREATE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_CREATE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            oItems = [];\r\n        var sDescription;\r\n        //var sIconUrl;\r\n        var bReadOnly;\r\n        var bVisible;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_CREATE];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_ADD,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_CREATE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_CREATE,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length; iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            sDescription = undefined;\r\n            //sIconUrl = undefined;\r\n            bReadOnly = false;\r\n            bVisible = true;\r\n\r\n            if (payload.hasOwnProperty('description'))\r\n            {\r\n                sDescription = payload.description;\r\n            }\r\n            if (payload.hasOwnProperty('readOnly'))\r\n            {\r\n                bReadOnly = (payload.readOnly === true);\r\n            }\r\n            if (payload.hasOwnProperty('visible'))\r\n            {\r\n                bVisible = (payload.visible !== false);\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Overlay({\r\n                overlayId: payload.overlayId,\r\n                parentId: payload.parentId,\r\n                name: payload.name,\r\n                properties: payload.properties,\r\n                description: sDescription,\r\n                readOnly: bReadOnly,\r\n                visible: bVisible\r\n            });\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* globals emp, cmapi */\r\n\r\n/* global cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_HIDE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_HIDE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            //schema,\r\n            oItem;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_HIDE];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VISIBILITY_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_HIDE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_HIDE,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            oItem = {\r\n                overlayId: payload.overlayId,\r\n                visible: false,\r\n                zoom: false,\r\n                recurse: payload.recurse\r\n            };\r\n\r\n            if (!emp.helpers.isEmptyString(payload.parentId))\r\n            {\r\n                oItem.parentId = payload.parentId;\r\n            }\r\n            else\r\n            {\r\n                oItem.parentId = emp.constant.parentIds.ALL_PARENTS;\r\n            }\r\n\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_REMOVE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_REMOVE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            oItems = [];\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_REMOVE];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_REMOVE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_REMOVE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_REMOVE,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.Overlay({\r\n                overlayId: payload.overlayId,\r\n                parentId: payload.parentId\r\n            });\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/* globals emp, cmapi */\r\n\r\n/* global cmapi */\r\n\r\n// Register a channel handler for MAP_OVERLAY_SHOW\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_SHOW] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n            oItems = [],\r\n            message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            //schema,\r\n            oItem;\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_SHOW];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VISIBILITY_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_SHOW,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_SHOW,\r\n            items: oItems\r\n        });\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            oItem = {\r\n                overlayId: payload.overlayId,\r\n                visible: true,\r\n                zoom: false,\r\n                recurse: payload.recurse\r\n            };\r\n\r\n            if (!emp.helpers.isEmptyString(payload.parentId))\r\n            {\r\n                oItem.parentId = payload.parentId;\r\n            }\r\n            else\r\n            {\r\n                oItem.parentId = emp.constant.parentIds.ALL_PARENTS;\r\n            }\r\n\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","// Register a channel handler for MAP_OVERLAY_STYLE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_STYLE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            oItems = [];\r\n\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //schema = cmapi.channel.schema[cmapi.channel.names.MAP_OVERLAY_STYLE];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (var iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n            payload = message.payload[iIndex];\r\n\r\n            if ((payload.overlayId === undefined) || (payload.overlayId === null))\r\n            {\r\n                payload.overlayId = sender.id;\r\n            }\r\n\r\n            oItem = new emp.typeLibrary.OverlayStyle(payload);\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.OVERLAY_STYLE,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_OVERLAY_STYLE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_OVERLAY_STYLE,\r\n            items: oItems\r\n        });\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_OVERLAY_UPDATE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_OVERLAY_UPDATE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var oaItems = [];\r\n        var message = args.message;\r\n        var oSender = args.sender;\r\n        var oItem;\r\n        //var oStorageItem;\r\n        var oPayload;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        // schema = cmapi.channel.schema[\"map.feature.update\"];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.OVERLAY_UPDATE,\r\n                mapInstanceId: args.mapInstanceId,\r\n                transactionId: message.messageId,\r\n                sender: oSender.id,\r\n                originChannel: cmapi.channel.names.MAP_OVERLAY_UPDATE,\r\n                source: emp.api.cmapi.SOURCE,\r\n                originalMessage: args.originalMessage,\r\n                messageOriginator: oSender.id,\r\n                originalMessageType: cmapi.channel.names.MAP_OVERLAY_UPDATE,\r\n                items: oaItems\r\n            });\r\n\r\n        // Build the tranasction\r\n        for (var iIndex = 0, iLength = message.payload.length; iIndex < iLength; iIndex++)\r\n        {\r\n            oPayload = message.payload[iIndex];\r\n\r\n            // All the validation will happen prior to execution.\r\n            oItem = {\r\n                coreId: oPayload.overlayId,\r\n                overlayId: oPayload.overlayId,\r\n                name: oPayload.name\r\n            };\r\n\r\n            if (oPayload.hasOwnProperty('parentId'))\r\n            {\r\n                oItem.parentId = oPayload.parentId;\r\n            }\r\n\r\n            if (oPayload.hasOwnProperty('properties'))\r\n            {\r\n                oItem.properties = oPayload.properties;\r\n            }\r\n\r\n            oaItems.push(oItem);\r\n        }\r\n\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for map.status.request\r\ncmapi.channel.handler[cmapi.channel.names.MAP_STATUS_REQUEST] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n        var asTypes = [];\r\n        var payload;\r\n        var sIntent;\r\n        var sTrasnID;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_STATUS_REQUEST];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        asTypes = message.payload[0].types;\r\n\r\n        if (message.messageId)\r\n        {\r\n            sTrasnID = message.messageId;\r\n        }\r\n\r\n        if (!asTypes || asTypes.length === 0)\r\n        {\r\n            asTypes = [\r\n                cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_INIT,\r\n                cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_ABOUT,\r\n                cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_FORMAT,\r\n                cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_VIEW,\r\n                cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_SELECTED,\r\n                cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_COORD_SYSTEM\r\n            ];\r\n        }\r\n\r\n        for (var iIndex = 0; iIndex < asTypes.length; iIndex++) {\r\n            payload = {};\r\n            switch (asTypes[iIndex]) {\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_ABOUT:\r\n                sIntent = emp.intents.control.STATUS_RESPONSE_ABOUT;\r\n                break;\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_FORMAT:\r\n                sIntent = emp.intents.control.STATUS_RESPONSE_FORMAT;\r\n                break;\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_VIEW:\r\n                sIntent = emp.intents.control.VIEW_GET;\r\n                payload = new emp.typeLibrary.View({\r\n                        sender: sender.id\r\n                    });\r\n                break;\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_SELECTED:\r\n                sIntent = emp.intents.control.STATUS_RESPONSE_SELECTED;\r\n                break;\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_SCREENSHOT:\r\n                sIntent = emp.intents.control.STATUS_REQUEST_SCREENSHOT;\r\n                payload = new emp.typeLibrary.View({\r\n                        screenshot: true\r\n                    });\r\n                break;\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_INIT:\r\n                sIntent = emp.intents.control.STATUS_RESPONSE_INIT;\r\n                break;\r\n            case cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_COORD_SYSTEM:\r\n                sIntent = emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM;\r\n                break;\r\n            default:\r\n                continue;\r\n            }\r\n\r\n            payload.transactionId = sTrasnID;\r\n            oTransaction = new emp.typeLibrary.Transaction({\r\n                intent: sIntent,\r\n                mapInstanceId: args.mapInstanceId,\r\n                transactionId: sTrasnID,\r\n                sender: sender.id,\r\n                intentParams: asTypes[iIndex],\r\n                source: emp.api.cmapi.SOURCE,\r\n                originChannel: cmapi.channel.names.MAP_STATUS_REQUEST,\r\n                originalMessage: args.originalMessage,\r\n                messageOriginator: sender.id,\r\n                originalMessageType: cmapi.channel.names.MAP_STATUS_REQUEST,\r\n                items: [payload]\r\n            });\r\n            oTransaction.queue();\r\n\r\n            sTrasnID = undefined;\r\n        }\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_SWAP\r\ncmapi.channel.handler[cmapi.channel.names.MAP_SWAP] = {\r\n  // args will have a message and sender property\r\n  process: function (args) {\r\n    var oTransaction,\r\n      message = args.message,\r\n      sender = args.sender,\r\n      oItems = [];\r\n\r\n    if (!Array.isArray(message.payload)) {\r\n      message.payload = [message.payload];\r\n    }\r\n    oItems.push({\r\n      mapId: message.payload[0].mapId,\r\n      engine: message.payload[0].engine\r\n    });\r\n    oTransaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.MAP_SWAP,\r\n      mapInstanceId: args.mapInstanceId,\r\n      transactionId: message.messageId,\r\n      sender: sender.id,\r\n      originChannel: cmapi.channel.names.MAP_SWAP,\r\n      source: emp.api.cmapi.SOURCE,\r\n      originalMessage: args.originalMessage,\r\n      messageOriginator: sender.id,\r\n      originalMessageType: cmapi.channel.names.MAP_SWAP,\r\n      items: oItems\r\n    });\r\n    oTransaction.queue();\r\n  }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel handler for MAP_VIEW_LOCK\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_LOCK] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message,\r\n            sender = args.sender,\r\n            payload,\r\n            oItem,\r\n            oItems = [],\r\n            iIndex,\r\n            iLength;\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n            message.payload = [message.payload];\r\n        }\r\n\r\n        for (iIndex = 0, iLength = message.payload.length;\r\n                iIndex < iLength; iIndex++) {\r\n\r\n            payload = message.payload[iIndex];\r\n\r\n            oItem = new emp.typeLibrary.Lock({\r\n                lock: payload.lock\r\n            });\r\n\r\n            oItems.push(oItem);\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_LOCK,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_LOCK,\r\n            items: oItems\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_CENTER_BOUNDS\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_CENTER_BOUNDS,\r\n            items: [new emp.typeLibrary.View({\r\n                    //overlayId: message.payload[0].overlayId,\r\n                    //featureId: message.payload[0].featureId,\r\n                    //parentId: message.payload[0].parentId,\r\n                    //range: message.payload[0].range,\r\n                    zoom: message.payload[0].zoom,\r\n                    //tilt: message.payload[0].tilt,\r\n                    //pan: message.payload[0].pan,\r\n                    //heading: message.payload[0].heading,\r\n                    //location: {\r\n                    //    lat: message.payload[0].location.lat,\r\n                    //    lon: message.payload[0].location.lon\r\n                    //},\r\n                    bounds: message.payload[0].bounds,\r\n                    animate: message.payload[0].animate\r\n                })]\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_CENTER_FEATURE\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_FEATURE] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction,\r\n          message = args.message,\r\n          sender = args.sender,\r\n          bounds,\r\n          feature,\r\n          maxExtent,\r\n          featureExtent,\r\n          item;\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        for (var i = 0, len = message.payload.length; i < len; i++) {\r\n          // For the first parameter we pass null, findFeature no longer\r\n          // uses the first parameter, so it's ok.\r\n          feature = emp.storage.findFeature(null, message.payload[i].featureId);\r\n\r\n          if (!maxExtent) {\r\n            maxExtent = feature.getMapExtent();\r\n          } else {\r\n            featureExtent = feature.getMapExtent();\r\n          }\r\n\r\n          if (featureExtent && !featureExtent.isEmpty()) {\r\n            maxExtent.addCoordinate(featureExtent.getNorthEast());\r\n            maxExtent.addCoordinate(featureExtent.getSouthWest());\r\n          }\r\n        }\r\n\r\n        bounds = {\r\n            west: maxExtent.getWest(),\r\n            east: maxExtent.getEast(),\r\n            south: maxExtent.getSouth(),\r\n            north: maxExtent.getNorth()\r\n        };\r\n\r\n        // if the bounds are a single point, just pass the feature to the\r\n        // transaction and let the map engine do the calculations.\r\n        if (bounds.west === bounds.east &&\r\n          bounds.north === bounds.south) {\r\n\r\n          feature = emp.storage.findFeature(null, message.payload[0].featureId);\r\n          item = new emp.typeLibrary.Feature({\r\n            featureId: feature.options.featureId,\r\n            coreId: feature.options.coreId,\r\n            overlayId: feature.options.overlayId,\r\n            parentId: feature.options.parentId,\r\n            data: feature.options.data,\r\n            properties: feature.options.properties,\r\n            format: feature.options.format\r\n          });\r\n\r\n        } else {\r\n          item = new emp.typeLibrary.View({\r\n                  bounds: bounds,\r\n                  zoom: message.payload[0].zoom\r\n          });\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_CENTER_FEATURE,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_CENTER_FEATURE,\r\n            items: []\r\n        });\r\n\r\n        oTransaction.items.push(item);\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_CENTER_LOCATION\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_LOCATION] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_LOCATION];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_CENTER_LOCATION,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_CENTER_LOCATION,\r\n            items: [new emp.typeLibrary.View({\r\n                    //range: message.payload[0].range,\r\n                    zoom: message.payload[0].zoom,\r\n                    tilt: message.payload[0].tilt,\r\n                    roll: message.payload[0].roll,\r\n                    heading: message.payload[0].heading,\r\n                    location: {\r\n                        lat: message.payload[0].location.lat,\r\n                        lon: message.payload[0].location.lon\r\n                    },\r\n                    animate: message.payload[0].animate\r\n                })]\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_CENTER_OVERLAY\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n        var oPayload;\r\n        var oOverlay;\r\n        var oMapExtent;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oPayload = message.payload[0];\r\n\r\n        if ((oPayload.overlayId === undefined) || (oPayload.overlayId === null))\r\n        {\r\n            oPayload.overlayId = sender.id;\r\n        }\r\n\r\n        oOverlay = emp.storage.findOverlay(oPayload.overlayId);\r\n\r\n        if (oOverlay) {\r\n            oMapExtent = oOverlay.getMapExtent();\r\n\r\n            if (oMapExtent && !oMapExtent.isEmpty()) {\r\n                oPayload.bounds = {\r\n                    west: oMapExtent.getWest(),\r\n                    east: oMapExtent.getEast(),\r\n                    south: oMapExtent.getSouth(),\r\n                    north: oMapExtent.getNorth()\r\n                };\r\n            }\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_CENTER_OVERLAY,\r\n            items: [new emp.typeLibrary.View({\r\n                    bounds: oPayload.bounds,\r\n                    zoom: oPayload.zoom\r\n            })]\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_COORDINATESYSTEM\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n        var asTypes = [];\r\n        var sTrasnID;\r\n        var sCoordsystem = \"dd\";\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        if (message.payload[0] && message.payload[0].coordinateSystem)\r\n        {\r\n            sCoordsystem = message.payload[0].coordinateSystem;\r\n            emp.ui.coordinates.setFormat(sCoordsystem);\r\n        }\r\n\r\n        if (message.messageId)\r\n        {\r\n            sTrasnID = message.messageId;\r\n        }\r\n\r\n        asTypes = [\r\n            cmapi.channel.mapStatusRequest.requestTypes.STATUS_REQUEST_COORD_SYSTEM\r\n        ];\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_COORDINATESYSTEM,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: sTrasnID,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,\r\n            items: [new emp.typeLibrary.Status(message.payload[0])]\r\n        });\r\n        oTransaction.queue();\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.STATUS_RESPONSE_COORD_SYSTEM,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_COORDINATESYSTEM,\r\n            source: emp.api.cmapi.SOURCE,\r\n            items: asTypes\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_LOOKAT_LOCATION\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION] = {\r\n\r\n  // args will have a message and sender property\r\n  process: function(args) {\r\n    var transaction;\r\n    var message = args.message;\r\n    var sender = args.sender;\r\n    var payload = message.payload;\r\n\r\n    if (!payload.overlayId) {\r\n      payload.overlayId = sender.id;\r\n    }\r\n\r\n    transaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.LOOKAT_SET,\r\n      mapInstanceId: args.mapInstanceId,\r\n      transactionId: message.messageId,\r\n      sender: sender.id,\r\n      originChannel: cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION,\r\n      source: emp.api.cmapi.SOURCE,\r\n      originalMessage: args.originalMessage,\r\n      messageOriginator: sender.id,\r\n      originalMessageType: cmapi.channel.names.MAP_VIEW_LOOKAT_LOCATION,\r\n      items: [new emp.typeLibrary.LookAt({\r\n        overlayId: payload.overlayId,\r\n        latitude: payload.latitude,\r\n        longitude: payload.longitude,\r\n        altitude: payload.altitude,\r\n        range: payload.range,\r\n        tilt: payload.tilt,\r\n        heading: payload.heading,\r\n        animate: payload.animate\r\n      })]\r\n    });\r\n    transaction.queue();\r\n  }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel handler for MAP_VIEW_ZOOM\r\ncmapi.channel.handler[cmapi.channel.names.MAP_VIEW_ZOOM] = {\r\n\r\n    // args will have a message and sender property\r\n    process: function (args) {\r\n        var oTransaction;\r\n        var message = args.message;\r\n        var sender = args.sender;\r\n\r\n        // get schema for this channel\r\n        // can use for channel specific validation\r\n        //var schema = cmapi.channel.schema[cmapi.channel.names.MAP_VIEW_ZOOM];\r\n\r\n        if (!Array.isArray(message.payload)) {\r\n          message.payload = [message.payload];\r\n        }\r\n\r\n        oTransaction = new emp.typeLibrary.Transaction({\r\n            intent: emp.intents.control.VIEW_SET,\r\n            mapInstanceId: args.mapInstanceId,\r\n            transactionId: message.messageId,\r\n            sender: sender.id,\r\n            originChannel: cmapi.channel.names.MAP_VIEW_ZOOM,\r\n            source: emp.api.cmapi.SOURCE,\r\n            originalMessage: args.originalMessage,\r\n            messageOriginator: sender.id,\r\n            originalMessageType: cmapi.channel.names.MAP_VIEW_ZOOM,\r\n            items: [new emp.typeLibrary.View({\r\n                    range: message.payload[0].range\r\n            })]\r\n        });\r\n        oTransaction.queue();\r\n    }\r\n};\r\n","// Register a channel publisher for the feature add event\r\ncmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD] = {\r\n\r\n  process: function(transaction) {\r\n    try {\r\n      var message = {\r\n          features: []\r\n        },\r\n        features = transaction.items,\r\n        feature;\r\n\r\n      // create a message to send back to CMAPI.\r\n      // {features: [{\r\n      //   geoId:\r\n      //   name:\r\n      //\r\n      // }]}\r\n\r\n      for (var i = 0, len = transaction.items.length; i < len; i++) {\r\n        feature = features[i];\r\n        var featureToAdd = {\r\n            featureId: feature.featureId,\r\n            name: feature.name,\r\n            feature: feature.data,\r\n            properties: feature.properties\r\n        };\r\n\r\n        // some features may have a symbolCode.   Add this if it is available.\r\n        if (feature.symbolCode) {\r\n          featureToAdd.symbolCode = feature.symbolCode;\r\n        }\r\n\r\n        message.features.push(featureToAdd);\r\n      }\r\n      emp.environment.get().pubSub.publish({\r\n        message: message,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD\r\n      });\r\n\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.CMAPI2_FEATURE_EVENT_ADD + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for the feature add event\r\ncmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE] = {\r\n\r\n  process: function(transaction) {\r\n    try {\r\n      var message = {\r\n          features: []\r\n        },\r\n        features = transaction.items,\r\n        feature;\r\n\r\n      // create a message to send back to CMAPI.\r\n      // {features: [{\r\n      //   geoId:\r\n      //   name:\r\n      //\r\n      // }]}\r\n\r\n      for (var i = 0, len = transaction.items.length; i < len; i++) {\r\n        feature = features[i];\r\n        var featureToAdd = {\r\n            featureId: feature.featureId,\r\n            name: feature.name,\r\n            feature: feature.data,\r\n            properties: feature.properties\r\n        };\r\n\r\n        // some features may have a symbolCode.   Add this if it is available.\r\n        if (feature.symbolCode) {\r\n          featureToAdd.symbolCode = feature.symbolCode;\r\n        }\r\n\r\n        message.features.push(featureToAdd);\r\n      }\r\n      emp.environment.get().pubSub.publish({\r\n        message: message,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE\r\n      });\r\n\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.CMAPI2_FEATURE_EVENT_REMOVE + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for the feature add event\r\ncmapi.channel.publisher[cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE] = {\r\n\r\n  process: function(transaction) {\r\n    try {\r\n      var message = {\r\n          features: []\r\n        },\r\n        features = transaction.items,\r\n        feature;\r\n\r\n      // create a message to send back to CMAPI.\r\n      // {features: [{\r\n      //   geoId:\r\n      //   name:\r\n      //\r\n      // }]}\r\n\r\n      for (var i = 0, len = transaction.items.length; i < len; i++) {\r\n        feature = features[i];\r\n        var featureToAdd = {\r\n            featureId: feature.featureId,\r\n            name: feature.name,\r\n            feature: feature.data,\r\n            properties: feature.properties\r\n        };\r\n\r\n        // some features may have a symbolCode.   Add this if it is available.\r\n        if (feature.symbolCode) {\r\n          featureToAdd.symbolCode = feature.symbolCode;\r\n        }\r\n\r\n        message.features.push(featureToAdd);\r\n      }\r\n      emp.environment.get().pubSub.publish({\r\n        message: message,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE\r\n      });\r\n\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.CMAPI2_FEATURE_EVENT_UPDATE + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for the feature add event\r\ncmapi.channel.publisher[cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW] = {\r\n\r\n  process: function(transaction) {\r\n    try {\r\n\r\n      var item = transaction.items[0];\r\n      var message = {\r\n        feature: item.data\r\n      };\r\n\r\n      var strokeStyle;\r\n      if (item.properties && item.properties.lineColor) {\r\n        if (!strokeStyle) {\r\n          strokeStyle = {};\r\n        }\r\n        strokeStyle.strokeColor = emp.util.convertHexToColor(item.properties.lineColor);\r\n      }\r\n\r\n      if (item.properties && item.properties.lineWidth) {\r\n        if (!strokeStyle) {\r\n          strokeStyle = {};\r\n        }\r\n        strokeStyle.strokeWidth = item.properties.lineWidth;\r\n      }\r\n\r\n      message.strokeStyle = strokeStyle;\r\n\r\n      if (transaction.intent === emp.intents.control.FREEHAND_LINE_DRAW_START) {\r\n        message.type = emp3.api.enums.MapFreehandEventEnum.MAP_FREEHAND_LINE_DRAW_START;\r\n      } else if (transaction.intent === emp.intents.control.FREEHAND_LINE_DRAW_END) {\r\n        message.type = emp3.api.enums.MapFreehandEventEnum.MAP_FREEHAND_LINE_DRAW_END;\r\n      } else if (transaction.intent === emp.intents.control.FREEHAND_LINE_DRAW_UPDATE) {\r\n        message.type = emp3.api.enums.MapFreehandEventEnum.MAP_FREEHAND_LINE_DRAW_UPDATE;\r\n      }\r\n      emp.environment.get().pubSub.publish({\r\n        message: message,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW\r\n      });\r\n\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.CMAPI2_FREEHAND_LINE_DRAW + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.MAP_ERROR\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_ERROR] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var sErrorMessage = \"\";\r\n      var bErrorsPresent = false;\r\n\r\n      for (var iIndex = 0; iIndex < transaction.failures.length; iIndex++) {\r\n        if (transaction.failures[iIndex].hasOwnProperty(\"level\") &&\r\n          (transaction.failures[iIndex].level === emp.typeLibrary.Error.level.INFO)) {\r\n          // Its not an error so skip it.\r\n          continue;\r\n        }\r\n\r\n        bErrorsPresent = true;\r\n\r\n        if (transaction.failures[iIndex].hasOwnProperty(\"message\")) {\r\n          if (sErrorMessage.length > 0) {\r\n            sErrorMessage += \"\\n\";\r\n          }\r\n          sErrorMessage += transaction.failures[iIndex].message;\r\n        }\r\n      }\r\n\r\n      if (!bErrorsPresent) {\r\n        // There were no errors > emp.typeLibrary.Error.level.INFO\r\n        // so don't send the error message.\r\n        return;\r\n      }\r\n\r\n      var payload = {\r\n        sender: transaction.messageOriginator,\r\n        type: transaction.originalMessageType,\r\n        msg: transaction.originalMessage,\r\n        error: sErrorMessage\r\n      };\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_ERROR\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_ERROR + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.MAP_FEATURE_CLICKED\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_CLICKED] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var oPointer = transaction.items[0];\r\n      var oFeature = emp.storage.findFeature(oPointer.overlayId, oPointer.featureId);\r\n      var feature;\r\n\r\n      var payload = {\r\n        overlayId: oPointer.overlayId,\r\n        featureId: oPointer.featureId,\r\n        button: oPointer.button,\r\n        type: oPointer.type,\r\n        mgrs: oPointer.mgrs,\r\n        keys: oPointer.keys,\r\n        clientX: oPointer.clientX,\r\n        clientY: oPointer.clientY,\r\n        screenX: oPointer.screenX,\r\n        screenY: oPointer.screenY,\r\n        width: oPointer.width,\r\n        height: oPointer.height,\r\n        zoom: oPointer.range,\r\n        scale: oPointer.scale\r\n      };\r\n\r\n      if (oFeature !== undefined) {\r\n        // If the feature exists we need to retrieve additional\r\n        // properties so the api can create it on the receiving end.\r\n        feature = oFeature.getObjectData(null, null);\r\n\r\n        if (feature) {\r\n          payload.properties = feature.properties;\r\n          payload.format = feature.format;\r\n          payload.feature = feature.data;\r\n          payload.name = feature.name;\r\n          payload.menuId = feature.menuId;\r\n        }\r\n      }\r\n\r\n      if (!emp.util.isEmptyString(oPointer.parentId)) {\r\n        payload.parentId = oPointer.parentId;\r\n      }\r\n\r\n      if ((oPointer.bounds !== undefined) &&\r\n        (oPointer.bounds !== null)) {\r\n        payload.bounds = {\r\n          northEast: {\r\n            lat: oPointer.bounds.north,\r\n            lon: oPointer.bounds.east\r\n          },\r\n          southWest: {\r\n            lat: oPointer.bounds.south,\r\n            lon: oPointer.bounds.west\r\n          }\r\n        };\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_FEATURE_CLICKED\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel publisher for map.status.MAP_FEATURE_DESELECTED\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_DESELECTED] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var oSelectItems = transaction.items,\r\n        payload = [];\r\n\r\n      for (var iIndex = 0; iIndex < oSelectItems.length; iIndex++) {\r\n        payload.push({\r\n          featureId: oSelectItems[iIndex].featureId,\r\n          deSelectedId: oSelectItems[iIndex].selectedId,\r\n          deSelectedName: oSelectItems[iIndex].selectedName\r\n        });\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_FEATURE_DESELECTED\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_DESELECTED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel publisher for map.status.MAP_FEATURE_PLOT\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_PLOT] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n        var oFeature = transaction.items[0],\r\n          payload = {};\r\n\r\n        if (transaction.source === emp.api.cmapi.SOURCE) {\r\n            // Dont generate message if it came from the cmapi channel.\r\n            return;\r\n        }\r\n\r\n        payload.overlayId = oFeature.overlayId;\r\n        payload.featureId = oFeature.featureId;\r\n      \r\n        if (!emp.helpers.isEmptyString(oFeature.parentId))\r\n        {\r\n            payload.parentId = oFeature.parentId;\r\n        }\r\n        payload.name = oFeature.name;\r\n        payload.format = oFeature.format;\r\n        payload.feature = oFeature.data;\r\n        payload.properties = oFeature.properties;\r\n        payload.messageId = transaction.transactionId;\r\n        payload.menuId = oFeature.menuId;\r\n\r\n        emp.environment.get().pubSub.publish({\r\n            message: payload,\r\n            sender: {\r\n              id: transaction.mapInstanceId\r\n            },\r\n            channel: cmapi.channel.names.MAP_FEATURE_PLOT\r\n        });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_PLOT + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel publisher for map.status.MAP_FEATURE_PLOT_URL\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_PLOT_URL] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var oFeature = transaction.items[0],\r\n        payload = {};\r\n\r\n      if (transaction.source === emp.api.cmapi.SOURCE) {\r\n        // Dont generate message if it came from the cmapi channel.\r\n        return;\r\n      }\r\n\r\n      payload.overlayId = oFeature.overlayId;\r\n      payload.featureId = oFeature.featureId;\r\n\r\n      if (!emp.util.isEmptyString(oFeature.parentId)) {\r\n        payload.parentId = oFeature.parentId;\r\n      }\r\n\r\n      payload.name = oFeature.name;\r\n      payload.format = oFeature.format;\r\n      payload.properties = oFeature.properties;\r\n      payload.url = oFeature.url;\r\n      payload.params = oFeature.params;\r\n      payload.transactionId = transaction.transactionId;\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_FEATURE_PLOT_URL\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_PLOT_URL + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","/*global cmapi, emp */\r\n// Register a channel publisher for map.status.MAP_FEATURE_SELECTED\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_SELECTED] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    var oSelectItems,\r\n      i,\r\n      payload;\r\n    try {\r\n      oSelectItems = transaction.items;\r\n      payload = [];\r\n\r\n      for (i = 0; i < oSelectItems.length; i++) {\r\n        payload.push({\r\n          featureId: oSelectItems[i].featureId,\r\n          selectedId: oSelectItems[i].selectedId,\r\n          selectedName: oSelectItems[i].selectedName\r\n        });\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_FEATURE_SELECTED\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_SELECTED + \" failed due to an error. \",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel publisher for MAP_FEATURE_UNPLOT\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_FEATURE_UNPLOT] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    var oFeatures = transaction.items,\r\n      payload = [],\r\n      i,\r\n      oData;\r\n    try {\r\n      oFeatures = transaction.items;\r\n      payload = [];\r\n\r\n      if (transaction.source === emp.api.cmapi.SOURCE) {\r\n        // Dont generate message if it came from the cmapi channel.\r\n        return;\r\n      }\r\n\r\n      for (i = 0; i < oFeatures.length; i++) {\r\n        oData = {\r\n          overlayId: oFeatures[i].overlayId,\r\n          featureId: oFeatures[i].featureId          \r\n        };\r\n        \r\n        if (!emp.util.isEmptyString(oFeatures[i].parentId)) {\r\n            oData.parentId = oFeatures[i].parentId;\r\n        }\r\n        payload.push(oData);\r\n      }\r\n\r\n      if (payload.length === 0) {\r\n        //No features where deleted.\r\n        return;\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_FEATURE_UNPLOT\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_UNPLOT + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.MAP_MESSAGE_COMPLETE\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_MESSAGE_COMPLETE] = {\r\n\r\n  // oTransaction will have a transaction property\r\n  process: function(oTransaction) {\r\n    try {\r\n      var oMessage;\r\n      var oMsgBuilder;\r\n\r\n\r\n      if (oTransaction.sendTransactionComplete === true) {\r\n        // This transaction wants a TC.\r\n        oMsgBuilder = cmapi.map.message.complete.builder[oTransaction.intent];\r\n        if (oMsgBuilder) {\r\n          oMessage = oMsgBuilder.build(oTransaction);\r\n        } else {\r\n          // If there is no builder we create the default\r\n          // completion message.\r\n          oMessage = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        }\r\n        emp.environment.get().pubSub.publish({\r\n          message: oMessage,\r\n          sender: {\r\n            id: oTransaction.mapInstanceId\r\n          },\r\n          channel: cmapi.channel.names.MAP_MESSAGE_COMPLETE\r\n        });\r\n      }\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + oTransaction.intent + \" on channel \" + cmapi.channel.names.MAP_MESSAGE_COMPLETE + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.MAP_MESSAGE_PROGRESS\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_MESSAGE_PROGRESS] = {\r\n\r\n  // oTransaction will have a transaction property\r\n  process: function(oTransaction) {\r\n    try {\r\n      var oMessage;\r\n      var oMsgBuilder;\r\n\r\n      oMsgBuilder = cmapi.map.message.progress.builder[oTransaction.intent];\r\n      if (oMsgBuilder) {\r\n        oMessage = oMsgBuilder.build(oTransaction);\r\n        emp.environment.get().pubSub.publish({\r\n          message: oMessage,\r\n          sender: {\r\n            id: oTransaction.mapInstanceId\r\n          },\r\n          channel: cmapi.channel.names.MAP_MESSAGE_PROGRESS\r\n        });\r\n      } else {\r\n        emp.typeLibrary.Error({\r\n          message: \"No cmapi.map.message.progress.builder for intent \" + oTransaction.intent + \".\"\r\n        });\r\n      }\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing progress for intent \" + oTransaction.intent + \" on channel \" + cmapi.channel.names.MAP_MESSAGE_PROGRESS + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel publisher for MAP_OVERLAY_REMOVE\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_OVERLAY_REMOVE] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var oOveralys = transaction.items,\r\n        payload = [],\r\n        oData;\r\n\r\n      if (transaction.source === emp.api.cmapi.SOURCE) {\r\n        // Dont generate message if it came from the cmapi channel.\r\n        return;\r\n      }\r\n\r\n      for (var iIndex = 0; iIndex < oOveralys.length; iIndex++) {\r\n        oData = {\r\n          overlayId: oOveralys[iIndex].overlayId\r\n        };\r\n        \r\n        if (!emp.util.isEmptyString(oOveralys[iIndex].parentId)) {\r\n            oData.parentId = oOveralys[iIndex].parentId;\r\n        }\r\n        payload.push(oData);\r\n      }\r\n\r\n      if (payload.length === 0) {\r\n        //No overlays where deleted.\r\n        return;\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_OVERLAY_REMOVE\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_OVERLAY_REMOVE + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.about\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_ABOUT] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var payload = {};\r\n      var oaformats = [],\r\n        mapInstance = emp.instanceManager.getInstance(transaction.mapInstanceId);\r\n\r\n      //payload.messageId = oData.transactionId;\r\n      payload.version = emp.version;\r\n\r\n      if (mapInstance.engine.capabilities.mapType.type2D) {\r\n        payload.type = \"2D\";\r\n      } else if (mapInstance.engine.capabilities.mapType.type3D) {\r\n        payload.type = \"3D\";\r\n      } else {\r\n        payload.type = \"unknown\";\r\n      }\r\n\r\n      payload.widgetName = emp.environment.get().name;\r\n      payload.instanceName = emp.environment.get().properties.widgetName;\r\n      payload.universalName = emp.environment.get().properties.universalName;\r\n      payload.extensions = [];\r\n\r\n      if (mapInstance.engine.implementation) {\r\n        if (mapInstance.engine.implementation.displayName) {\r\n          payload.extensions.push({\r\n            engineName: mapInstance.engine.implementation.displayName\r\n          });\r\n        }\r\n        if (mapInstance.engine.implementation.version) {\r\n          payload.extensions.push({\r\n            sprint: mapInstance.engine.implementation.version\r\n          });\r\n        }\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.GEOJSON_BASIC.plot ||\r\n        mapInstance.engine.capabilities.formats.GEOJSON_FULL) {\r\n        oaformats.push(\"geojson\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.WMS.version_1_1 ||\r\n        mapInstance.engine.capabilities.formats.WMS.version_1_3) {\r\n        oaformats.push(\"wms\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.KML_BASIC ||\r\n        mapInstance.engine.capabilities.formats.KML_COMPLEX) {\r\n        oaformats.push(\"kml\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.IMAGE.plot) {\r\n        oaformats.push(\"image\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot ||\r\n        mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot) {\r\n        oaformats.push(\"milstd\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.AIRSPACE.plot) {\r\n        oaformats.push(\"airspace\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.AOI.plot) {\r\n        oaformats.push(\"aoi\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.ArcGIS) {\r\n        oaformats.push(\"arc\");\r\n      }\r\n\r\n      payload.extensions.push({\r\n        formats: oaformats\r\n      });\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_STATUS_ABOUT\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n};\r\n","// Register a channel publisher for map.status.coordinatesystem\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_COORDINATESYSTEM] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var payload = {};\r\n\r\n      //payload.messageId = oData.transactionId;\r\n      payload.displayedCoordinateSystem = emp.ui.coordinates.currentFormat();\r\n      payload.coordinateSystem = emp.ui.coordinates.currentFormat();\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_STATUS_COORDINATESYSTEM\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.format\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_FORMAT] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var payload = {};\r\n      var oaformats = [],\r\n        mapInstance = emp.instanceManager.getInstance(transaction.mapInstanceId);\r\n\r\n      //payload.messageId = oData.transactionId;\r\n\r\n      if (mapInstance.engine.capabilities.formats.GEOJSON_BASIC.plot ||\r\n        mapInstance.engine.capabilities.formats.GEOJSON_FULL) {\r\n        oaformats.push(\"geojson\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.WMS.version_1_1 ||\r\n        mapInstance.engine.capabilities.formats.WMS.version_1_3) {\r\n        oaformats.push(\"wms\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.KML_BASIC ||\r\n        mapInstance.engine.capabilities.formats.KML_COMPLEX) {\r\n        oaformats.push(\"kml\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.IMAGE.plot) {\r\n        oaformats.push(\"image\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.MILSTD.version2525B.plot ||\r\n        mapInstance.engine.capabilities.formats.MILSTD.version2525C.plot) {\r\n        oaformats.push(\"milstd\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.AIRSPACE.plot) {\r\n        oaformats.push(\"airspace\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.AOI.plot) {\r\n        oaformats.push(\"aoi\");\r\n      }\r\n\r\n      if (mapInstance.engine.capabilities.formats.ArcGIS) {\r\n        oaformats.push(\"arc\");\r\n      }\r\n\r\n      payload.formats = oaformats;\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_STATUS_FORMAT\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a channel publisher for map.status.initialization\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_INITIALIZATION] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var payload = {},\r\n        sField,\r\n        mapInstance = emp.instanceManager.getInstance(transaction.mapInstanceId);\r\n\r\n      payload = {\r\n        status: \"ready\",\r\n        engineId: mapInstance.engineId,\r\n        types: []\r\n      };\r\n\r\n      if (transaction.items.length > 0) {\r\n        //payload.messageId = transaction.items[0].transactionId;\r\n\r\n        if (transaction.items[0].hasOwnProperty(\"status\")) {\r\n          payload.status = transaction.items[0].status;\r\n        }\r\n      }\r\n\r\n      if (payload.status === \"ready\") {\r\n        for (sField in cmapi.channel.mapStatusRequest.requestTypes) {\r\n          payload.types.push(cmapi.channel.mapStatusRequest.requestTypes[sField]);\r\n        }\r\n\r\n        payload.defaultWMSOverlayId = emp.wms.manager.getWmsOverlayId(transaction.mapInstanceId);\r\n        payload.defaultLayerOverlayId = mapInstance.engines.getDefaultLayerOverlayID(transaction.mapInstanceId);\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n            id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_STATUS_INITIALIZATION\r\n      });\r\n      if (payload.status === \"teardown\") {\r\n        emp.environment.get().pubSub.publish({\r\n          message: {\r\n            type: \"MAP_CLOSE\"\r\n          },\r\n          channel: \"MapChannel\"\r\n        });\r\n      }\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_STATUS_INITIALIZATION + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","// Register a channel publisher for map.status.coordinatesystem\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_SCREENSHOT] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var oData = transaction.items[0],\r\n        payload = {};\r\n\r\n      //payload.messageId = transaction.transactionId;\r\n\r\n      if (oData) {\r\n        payload.dataUrl = oData.dataUrl;\r\n      }\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_STATUS_SCREENSHOT\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n  }\r\n};\r\n","\r\n/* global cmapi */\r\n\r\n// Register a channel publisher for map.status.selected\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_SELECTED] = {\r\n\r\n    // args will have a transaction property\r\n    process: function(transaction) {\r\n        try {\r\n\r\n            var feature;\r\n            var selection;\r\n            var selectedFeatures = [];\r\n            var payload;\r\n            var selectedList = emp.storage.selection.getSelectedList(transaction.mapInstanceId); // Get list of selected features from storage engine.\r\n\r\n            for (var iIndex = 0; iIndex < selectedList.length; iIndex++) {\r\n                selection = selectedList[iIndex];\r\n                feature = emp.storage.findObject(selection.coreId);\r\n\r\n                if (feature) {\r\n                  selectedFeatures.push({\r\n                    name: feature.options.name,\r\n                    featureId: feature.options.featureId,\r\n                    feature: feature.options.data,\r\n                    format: feature.options.format,\r\n                    properties: feature.options.properties\r\n                  });\r\n                }\r\n            }\r\n\r\n            payload = {\r\n              messageId: transaction.items[0].transactionId,\r\n              selectedFeatures: selectedFeatures\r\n            };\r\n\r\n            emp.environment.get().pubSub.publish({\r\n                message: payload,\r\n                sender: {\r\n                  id: transaction.mapInstanceId\r\n                },\r\n                channel: cmapi.channel.names.MAP_STATUS_SELECTED\r\n            });\r\n        } catch (e) {\r\n            emp.typeLibrary.Error({\r\n              message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n              jsError: e\r\n            });\r\n        }\r\n    }\r\n};\r\n","// Register a channel publisher for map.status.view\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_STATUS_VIEW] = {\r\n\r\n  /**\r\n   *\r\n   * @param {emp.typeLibrary.Transaction} transaction\r\n   */\r\n  process: function(transaction) {\r\n    try {\r\n      var view = transaction.items[0],\r\n          lookAt = transaction.items[1],\r\n          payload = {};\r\n\r\n      if (transaction.intent !== emp.intents.control.VIEW_CHANGE) {\r\n        // Don't add a transaction ID when its a view change\r\n        // event.\r\n        //payload.messageId = view.transactionId;\r\n      }\r\n      if (transaction.hasOwnProperty('sender')) {\r\n        payload.requester = transaction.sender;\r\n      }\r\n\r\n      if (typeof view.bounds === \"object\") {\r\n        payload.bounds = {\r\n          southWest: {\r\n            lat: view.bounds.south,\r\n            lon: view.bounds.west\r\n          },\r\n          northEast: {\r\n            lat: view.bounds.north,\r\n            lon: view.bounds.east\r\n          }\r\n        };\r\n      }\r\n\r\n      if (typeof view.location === \"object\") {\r\n        payload.center = {\r\n          lat: view.location.lat,\r\n          lon: view.location.lon\r\n        };\r\n      }\r\n\r\n      payload.altitude = view.altitude;\r\n      payload.heading = view.heading;\r\n      payload.tilt = view.tilt;\r\n      payload.roll = view.roll;\r\n      payload.range = view.range;\r\n      payload.animate = view.animate;\r\n\r\n      payload.lookAt = lookAt;\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_STATUS_VIEW\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_STATUS_VIEW + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel publisher for map.view.clicked\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_VIEW_AREA_SELECTED] = {\r\n\r\n  // args will have a transaction property\r\n  process: function(transaction) {\r\n    try {\r\n      var pointer = transaction.items[0],\r\n        payload,\r\n        bounds;\r\n\r\n      if ((pointer.bounds !== undefined) && (pointer.bounds !== null)) {\r\n        bounds = {\r\n          northEast: {\r\n            lat: pointer.bounds.north,\r\n            lon: pointer.bounds.east\r\n          },\r\n          southWest: {\r\n            lat: pointer.bounds.south,\r\n            lon: pointer.bounds.west\r\n          }\r\n        };\r\n      }\r\n\r\n      payload = {\r\n        button: pointer.button,\r\n        keys: pointer.keys,\r\n        bounds: bounds,\r\n        zoom: pointer.zoom,\r\n        scale: pointer.scale\r\n      };\r\n\r\n      emp.environment.get().pubSub.publish({\r\n        message: payload,\r\n        sender: {\r\n          id: transaction.mapInstanceId\r\n        },\r\n        channel: cmapi.channel.names.MAP_VIEW_AREA_SELECTED\r\n      });\r\n    } catch (e) {\r\n      emp.typeLibrary.Error({\r\n        message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_VIEW_AREA_SELECTED + \" failed due to an error.\",\r\n        jsError: e\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n};\r\n","/*global emp, cmapi */\r\n// Register a channel publisher for map.view.clicked\r\ncmapi.channel.publisher[cmapi.channel.names.MAP_VIEW_CLICKED] = {\r\n\r\n    // args will have a transaction property\r\n    process: function(transaction) {\r\n        try {\r\n            var pointer = transaction.items[0],\r\n                payload,\r\n                bounds,\r\n                oFeature,\r\n                feature;\r\n\r\n            if (pointer.type === emp.typeLibrary.Pointer.EventType.MOVE && !isNaN(pointer.lat) && !isNaN(pointer.lon)) {\r\n\r\n                payload = {\r\n                    latitude: pointer.lat,\r\n                    longitude: pointer.lon,\r\n                    type: pointer.type,\r\n                    clientX: pointer.clientX,\r\n                    clientY: pointer.clientY,\r\n                    screenX: pointer.screenX,\r\n                    screenY: pointer.screenY,\r\n                    keys: pointer.keys\r\n                };\r\n\r\n                emp.environment.get().pubSub.publish({\r\n                    message: payload,\r\n                    sender: {\r\n                        id: transaction.mapInstanceId\r\n                    },\r\n                    channel: cmapi.channel.names.MAP_VIEW_MOUSEMOVE\r\n                });\r\n\r\n\r\n            } else {\r\n\r\n                if ((pointer.bounds !== undefined) && (pointer.bounds !== null)) {\r\n                    bounds = {\r\n                        northEast: {\r\n                            lat: pointer.bounds.north,\r\n                            lon: pointer.bounds.east\r\n                        },\r\n                        southWest: {\r\n                            lat: pointer.bounds.south,\r\n                            lon: pointer.bounds.west\r\n                        }\r\n                    };\r\n                }\r\n\r\n                payload = {\r\n                    lat: pointer.lat,\r\n                    lon: pointer.lon,\r\n                    mgrs: pointer.mgrs,\r\n                    button: pointer.button,\r\n                    type: pointer.type,\r\n                    keys: pointer.keys,\r\n                    bounds: bounds,\r\n                    clientX: pointer.clientX,\r\n                    clientY: pointer.clientY,\r\n                    screenX: pointer.screenX,\r\n                    screenY: pointer.screenY,\r\n                    width: pointer.width,\r\n                    height: pointer.height,\r\n                    zoom: pointer.range,\r\n                    scale: pointer.scale,\r\n                    overlayId: pointer.overlayId,\r\n                    featureId: pointer.featureId,\r\n                    parentId: pointer.parentId\r\n                };\r\n\r\n                if (pointer.target.toLowerCase() === \"feature\") {\r\n\r\n                    oFeature = emp.storage.findFeature(pointer.overlayId, pointer.featureId);\r\n                    if (oFeature !== undefined) {\r\n                        // If the feature exists we need to retrieve additional\r\n                        // properties so the api can create it on the receiving end.\r\n                        feature = oFeature.getObjectData(null, null);\r\n\r\n                        if (feature) {\r\n                          payload.properties = feature.properties;\r\n                          payload.format = feature.format;\r\n                          payload.feature = feature.data;\r\n                          payload.name = feature.name;\r\n                          payload.menuId = feature.menuId;\r\n                        }\r\n                    }\r\n\r\n                    switch (pointer.type) {\r\n                        case emp.typeLibrary.Pointer.EventType.MOUSEDOWN:\r\n                            emp.environment.get().pubSub.publish({\r\n                                message: payload,\r\n                                sender: {\r\n                                    id: transaction.mapInstanceId\r\n                                },\r\n                                channel: cmapi.channel.names.MAP_FEATURE_MOUSEDOWN\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.Pointer.EventType.MOUSEUP:\r\n                            emp.environment.get().pubSub.publish({\r\n                                message: payload,\r\n                                sender: {\r\n                                    id: transaction.mapInstanceId\r\n                                },\r\n                                channel: cmapi.channel.names.MAP_FEATURE_MOUSEUP\r\n                            });\r\n                            break;\r\n                        case emp.typeLibrary.Pointer.EventType.DRAG:\r\n                            emp.environment.get().pubSub.publish({\r\n                                message: payload,\r\n                                sender: {\r\n                                    id: transaction.mapInstanceId\r\n                                },\r\n                                channel: cmapi.channel.names.CMAPI2_FEATURE_DRAG\r\n                            });\r\n                            //console.log(\"FEAUTRE DRAG YO!\");\r\n                            break;\r\n\r\n                        case emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE:\r\n                            emp.environment.get().pubSub.publish({\r\n                                message: payload,\r\n                                sender: {\r\n                                    id: transaction.mapInstanceId\r\n                                },\r\n                                channel: cmapi.channel.names.CMAPI2_FEATURE_DRAG_COMPLETE\r\n                            });\r\n                            //console.log(\"FEAUTRE DRAG COMPLETE YO!\");\r\n                            break;\r\n                        default:\r\n                            // feature click and Dbl click are handled elsewhere.\r\n                            break;\r\n                    }\r\n                }\r\n\r\n                delete payload.overlayId;\r\n                delete payload.featureId;\r\n                delete payload.parentId;\r\n                if (feature) {\r\n                    delete payload.properties;\r\n                    delete payload.format;\r\n                    delete payload.feature;\r\n                    delete payload.menuId;\r\n                }\r\n\r\n                switch (pointer.type) {\r\n                    case emp.typeLibrary.Pointer.EventType.MOUSEDOWN:\r\n                        emp.environment.get().pubSub.publish({\r\n                            message: payload,\r\n                            sender: {\r\n                                id: transaction.mapInstanceId\r\n                            },\r\n                            channel: cmapi.channel.names.MAP_VIEW_MOUSEDOWN\r\n                        });\r\n                        break;\r\n                    case emp.typeLibrary.Pointer.EventType.MOUSEUP:\r\n                        emp.environment.get().pubSub.publish({\r\n                            message: payload,\r\n                            sender: {\r\n                                id: transaction.mapInstanceId\r\n                            },\r\n                            channel: cmapi.channel.names.MAP_VIEW_MOUSEUP\r\n                        });\r\n                        break;\r\n                    case emp.typeLibrary.Pointer.EventType.DRAG:\r\n                        emp.environment.get().pubSub.publish({\r\n                            message: payload,\r\n                            sender: {\r\n                                id: transaction.mapInstanceId\r\n                            },\r\n                            channel: cmapi.channel.names.CMAPI2_MAP_DRAG\r\n                        });\r\n                        //console.log(\"MAP DRAG YO!\");\r\n                        break;\r\n\r\n                    case emp.typeLibrary.Pointer.EventType.DRAG_COMPLETE:\r\n                        emp.environment.get().pubSub.publish({\r\n                            message: payload,\r\n                            sender: {\r\n                                id: transaction.mapInstanceId\r\n                            },\r\n                            channel: cmapi.channel.names.CMAPI2_MAP_DRAG_COMPLETE\r\n                        });\r\n                        //console.log(\"MAP DRAG COMPLETE YO!\");\r\n                        break;\r\n                    case emp.typeLibrary.Pointer.EventType.SINGLE_CLICK:\r\n                    case emp.typeLibrary.Pointer.EventType.DBL_CLICK:\r\n                        emp.environment.get().pubSub.publish({\r\n                            message: payload,\r\n                            sender: {\r\n                                id: transaction.mapInstanceId\r\n                            },\r\n                            channel: cmapi.channel.names.MAP_VIEW_CLICKED\r\n                        });\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            emp.typeLibrary.Error({\r\n                message: \"Publishing \" + transaction.intent + \" on channel \" + cmapi.channel.names.MAP_FEATURE_CLICKED + \" failed due to an error.\",\r\n                jsError: e\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n};\r\n","/* global cmapi, emp */\r\n\r\n// Register a message completion builder for DRAW_BEGIN\r\ncmapi.map.message.complete.builder[emp.intents.control.DRAW_BEGIN] = {\r\n\r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n        var oDetail;\r\n        var oFeature;\r\n        var sFormat;\r\n        var oDraw = oTransaction.items[0];\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n\r\n        if (oTransaction.failures.length > 0)\r\n        {\r\n            if (oTransaction.failures[0].level === emp.typeLibrary.Error.level.INFO)\r\n            {\r\n                // Its being cancelled.\r\n                oMsgCompletion.status = cmapi.typeLibrary.msgComplete.status.CANCELLED;\r\n            }\r\n        }\r\n\r\n        if (oDraw)\r\n        {\r\n            oFeature = oDraw.plotFeature;\r\n\r\n            if (oFeature)\r\n            {\r\n                oDetail = {\r\n                    overlayId: oFeature.overlayId,\r\n                    parentId: oFeature.parentId,\r\n                    featureId: oFeature.featureId,\r\n                    type: oDraw.type,\r\n                    name: oFeature.name,\r\n                    format: oFeature.format,\r\n                    feature: oFeature.data,\r\n                    properties: oFeature.properties,\r\n                    menuId: oFeature.menuId,\r\n                    coordinates: ((oDraw.updates && oDraw.updates.coordinates)? oDraw.updates.coordinates: [])\r\n                };\r\n            }\r\n            else\r\n            {\r\n                sFormat = '';\r\n\r\n                switch (oDraw.type.toLowerCase())\r\n                {\r\n                    case 'point':\r\n                    case 'line':\r\n                    case 'polygon':\r\n                        sFormat = emp.typeLibrary.featureFormatType.GEOJSON;\r\n                        break;\r\n                    case 'milstd':\r\n                        sFormat = emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL;\r\n                        break;\r\n                    case 'airspace':\r\n                        sFormat = emp3.api.enums.FeatureTypeEnum.GEO_ACM;\r\n                        break;\r\n                }\r\n                oDetail = {\r\n                    overlayId: oDraw.overlayId,\r\n                    parentId: oDraw.parentId,\r\n                    featureId: oDraw.featureId,\r\n                    type: oDraw.type,\r\n                    format: sFormat,\r\n                    name: oDraw.name,\r\n                    properties: oDraw.properties,\r\n                    coordinates: ((oDraw.updates && oDraw.updates.coordinates)? oDraw.updates.coordinates: [])\r\n                };\r\n            }\r\n            oMsgCompletion.details = oDetail;\r\n        }\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi, emp */\r\n\r\n// Register a message completion builder for EDIT_BEGIN\r\ncmapi.map.message.complete.builder[emp.intents.control.EDIT_BEGIN] = {\r\n\r\n    // transaction will have a transaction property\r\n    build: function (transaction) {\r\n\r\n        var feature;\r\n        var detail;\r\n        var messageComplete = new cmapi.typeLibrary.MessageComplete(transaction);\r\n\r\n        if (transaction.failures.length > 0)\r\n        {\r\n            if (transaction.failures[0].level === emp.typeLibrary.Error.level.INFO)\r\n            {\r\n                // Its being cancelled.\r\n                messageComplete.status = cmapi.typeLibrary.msgComplete.status.CANCELLED;\r\n                feature = transaction.items[0].originFeature;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            feature = transaction.items[0].updatedFeature;\r\n        }\r\n\r\n        if (feature)\r\n        {\r\n            detail = {\r\n                overlayId: feature.overlayId,\r\n                parentId: feature.parentId,\r\n                featureId: feature.featureId,\r\n                name: feature.name,\r\n                format: feature.format,\r\n                feature: feature.data,\r\n                properties: feature.properties,\r\n                menuId: feature.menuId\r\n            };\r\n\r\n            messageComplete.details = detail;\r\n        }\r\n        return messageComplete;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for FEATURE_ADD\r\ncmapi.map.message.complete.builder[emp.intents.control.FEATURE_ADD] = {\r\n  build: function (oTransaction) {\r\n    var oFeature,\r\n      oDetail,\r\n      iIndex,\r\n      oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction),\r\n      oFeatures = oTransaction.items,\r\n      empParent,\r\n      oDetails = {\r\n        features: []\r\n      };\r\n\r\n    for (iIndex = 0; iIndex < oFeatures.length; iIndex++) {\r\n      oFeature = oFeatures[iIndex];\r\n      switch (oTransaction.originChannel) {\r\n        case cmapi.channel.names.MAP_FEATURE_PLOT:\r\n        case cmapi.channel.names.MAP_FEATURE_PLOT_BATCH:\r\n          oDetail = {\r\n            overlayId: oFeature.overlayId,\r\n            parentId: oFeature.parentId,\r\n            featureId: oFeature.featureId,\r\n            name: oFeature.name,\r\n            format: oFeature.format,\r\n            feature: oFeature.data,\r\n            properties: oFeature.properties,\r\n            menuId: oFeature.menuId\r\n          };\r\n          break;\r\n        case cmapi.channel.names.MAP_FEATURE_PLOT_URL:\r\n          // If the feature being added is a map service populate necessary properties\r\n          oDetail = {\r\n            overlayId: oFeature.overlayId,\r\n            parentId: oFeature.parentId,\r\n            featureId: oFeature.featureId,\r\n            name: oFeature.name,\r\n            format: oFeature.format,\r\n            url: oFeature.url,\r\n            params: oFeature.params\r\n          };\r\n          break;\r\n      }\r\n      // Check for a parentId. If it exists it means the immediate parent is a feature.\r\n      // Otherwise, it must be an overlay.\r\n      if (oFeature.parentId) {\r\n        // parentInfo added to pass relevant parent information\r\n        // for the purposes of re-building overlay or feature\r\n        // objects for the client\r\n        empParent = emp.storage.get.id({id: oFeature.parentId}).options;\r\n        oDetail.parentInfo = {\r\n          featureId: empParent.featureId,\r\n          name: empParent.name,\r\n          format: empParent.format,\r\n          feature: empParent.data,\r\n          properties: emp.helpers.copyObject(empParent.properties),\r\n          menuId: empParent.menuId\r\n        };\r\n      } else {\r\n        empParent = emp.storage.get.id({id: oFeature.overlayId}).options;\r\n        oDetail.parentInfo = {\r\n          name: empParent.name,\r\n          overlayId: empParent.overlayId,\r\n          properties: emp.helpers.copyObject(empParent.properties),\r\n          menuId: empParent.menuId,\r\n          description: empParent.description\r\n        };\r\n      }\r\n      oDetails.features.push(oDetail);\r\n    }\r\n    oMsgCompletion.details = oDetails;\r\n\r\n    return oMsgCompletion;\r\n  }\r\n};\r\n","// Register a message completion builder for FEATURE_HIDE\r\ncmapi.map.message.complete.builder[emp.intents.control.FEATURE_HIDE] = {\r\n    \r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n        var oFeature;\r\n        var oDetail;\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oFeatures = oTransaction.items;\r\n        var payload;\r\n        var oDetails = {\r\n            features: []\r\n        };\r\n\r\n        for (var iIndex = 0; iIndex < oFeatures.length; iIndex++)\r\n        {\r\n            oFeature = oFeatures[iIndex];\r\n            payload = oTransaction.message.payload[iIndex];\r\n            oDetail = {\r\n                overlayId: oFeature.overlayId,\r\n                parentId: oFeature.parentId,\r\n                featureId: oFeature.featureId || oFeature.id,\r\n                recurse: payload.recurse\r\n            };\r\n            \r\n            oDetails.features.push(oDetail);\r\n        }\r\n        \r\n        oMsgCompletion.details = oDetails;\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for FEATURE_REMOVE\r\ncmapi.map.message.complete.builder[emp.intents.control.FEATURE_REMOVE] = {\r\n  build: function (oTransaction) {\r\n    var oFeature,\r\n      oDetail,\r\n      empParent,\r\n      iIndex;\r\n\r\n    var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n    var oFeatures = oTransaction.items;\r\n    var oDetails = {\r\n      features: []\r\n    };\r\n\r\n    for (iIndex = 0; iIndex < oFeatures.length; iIndex++) {\r\n      oFeature = oFeatures[iIndex];\r\n      oDetail = {\r\n        overlayId: oFeature.overlayId,\r\n        parentId: oFeature.parentId,\r\n        featureId: oFeature.featureId,\r\n        name: oFeature.name,\r\n        format: oFeature.format,\r\n        feature: oFeature.data,\r\n        properties: oFeature.properties,\r\n        menuId: oFeature.menuId\r\n      };\r\n      // If the feature being removed is a map service populate necessary properties\r\n      if (oFeature.url) {\r\n        oDetail.url = oFeature.url;\r\n        oDetail.params = oFeature.params;\r\n        delete oDetail.feature;\r\n        delete oDetail.properties;\r\n        delete oDetail.menuId;\r\n      }\r\n      // Check for a parentId. If it exists it means the immediate parent is a feature.\r\n      // Otherwise, it must be an overlay.\r\n      if (oFeature.parentId) {\r\n        // parentInfo added to pass relevant parent information\r\n        // for the purposes of re-building overlay or feature\r\n        // objects for the client\r\n        empParent = emp.storage.get.id({id: oFeature.parentId}).options;\r\n        oDetail.parentInfo = {\r\n          featureId: empParent.featureId,\r\n          name: empParent.name,\r\n          format: empParent.format,\r\n          feature: empParent.data,\r\n          properties: emp.helpers.copyObject(empParent.properties),\r\n          menuId: empParent.menuId\r\n        };\r\n      } else {\r\n        empParent = emp.storage.get.id({id: oFeature.overlayId}).options;\r\n        oDetail.parentInfo = {\r\n          name: empParent.name,\r\n          overlayId: empParent.overlayId,\r\n          properties: emp.helpers.copyObject(empParent.properties),\r\n          menuId: empParent.menuId,\r\n          description: empParent.description\r\n        };\r\n      }\r\n      oDetails.features.push(oDetail);\r\n    }\r\n    oMsgCompletion.details = oDetails;\r\n\r\n    return oMsgCompletion;\r\n  }\r\n};\r\n","// Register a message completion builder for SELECTION_SET\r\ncmapi.map.message.complete.builder[emp.intents.control.SELECTION_SET] = {\r\n\r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oFeatures = oTransaction.items;\r\n        var oDetails = {\r\n            features: []\r\n        };\r\n        var feature;\r\n\r\n        for (var iIndex = 0; iIndex < oFeatures.length; iIndex++)\r\n        {\r\n            if (oFeatures[iIndex].featureId) {\r\n              feature = emp.storage.findObject(oFeatures[iIndex].coreId);\r\n\r\n              if (feature) {\r\n                oDetails.features.push({\r\n                  featureId: feature.options.featureId,\r\n                  name: feature.options.name,\r\n                  format: feature.options.format,\r\n                  feature: feature.options.data,\r\n                  properties: feature.options.properties,\r\n                  symbolCode: feature.options.symbolCode\r\n                });\r\n              }\r\n            }\r\n        }\r\n\r\n        oMsgCompletion.details = oDetails;\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","// Register a message completion builder for FEATURE_SHOW\r\ncmapi.map.message.complete.builder[emp.intents.control.FEATURE_SHOW] = {\r\n    \r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n        var oFeature;\r\n        var oDetail;\r\n        var payload;\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oFeatures = oTransaction.items;\r\n        var oDetails = {\r\n            features: []\r\n        };\r\n\r\n        for (var iIndex = 0; iIndex < oFeatures.length; iIndex++)\r\n        {\r\n            oFeature = oFeatures[iIndex];\r\n            payload = oTransaction.message.payload[iIndex];\r\n            \r\n            oDetail = {\r\n                overlayId: oFeature.overlayId,\r\n                parentId: oFeature.parentId,\r\n                featureId: oFeature.featureId || oFeature.id,\r\n                recurse: payload.recurse\r\n            };\r\n            \r\n            oDetails.features.push(oDetail);\r\n        }\r\n        \r\n        oMsgCompletion.details = oDetails;\r\n        \r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","// Register a message completion builder for FEATURE_UPDATE\r\ncmapi.map.message.complete.builder[emp.intents.control.FEATURE_UPDATE] = {\r\n    \r\n    build: function (oTransaction) {\r\n        var oFeature;\r\n        var oDetail;\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oFeatures = oTransaction.items;\r\n        var oDetails = {\r\n            features: []\r\n        };\r\n\r\n        for (var iIndex = 0; iIndex < oFeatures.length; iIndex++)\r\n        {\r\n            oFeature = emp.storage.get.id({id: oFeatures[iIndex].coreId});\r\n            \r\n            if (oFeature.url !== undefined)\r\n            {\r\n                oDetail = {\r\n                    overlayId: oFeature.overlayId,\r\n                    parentId: oFeature.parentId,\r\n                    featureId: oFeature.featureId,\r\n                    name: oFeature.name, \r\n                    format: oFeature.format,\r\n                    feature: oFeature.data, \r\n                    properties: oFeature.properties, \r\n                    menuId: oFeature.menuId\r\n                };\r\n            }\r\n            else\r\n            {\r\n                oDetail = {\r\n                    overlayId: oFeature.overlayId,\r\n                    parentId: oFeature.parentId,\r\n                    featureId: oFeature.featureId,\r\n                    name: oFeature.name, \r\n                    format: oFeature.format,\r\n                    url: oFeature.url,\r\n                    params: oFeature.params\r\n                };\r\n            }\r\n            \r\n            oDetails.features.push(oDetail);\r\n        }\r\n        \r\n        oMsgCompletion.details = oDetails;\r\n        \r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for GET_LATLON_FROM_XY\r\ncmapi.map.message.complete.builder[emp.intents.control.GET_LATLON_FROM_XY] = {\r\n\r\n  // oTransaction will have a transaction property\r\n  build: function (oTransaction) {\r\n    var convert;\r\n    var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n\r\n    if (oMsgCompletion.failures.length > 0) {\r\n      return oMsgCompletion;\r\n    }\r\n\r\n    convert = oTransaction.items[0];\r\n    oMsgCompletion.details.x = convert.lon;\r\n    oMsgCompletion.details.y = convert.lat;\r\n    oMsgCompletion.details.invalid = convert.invalid;\r\n\r\n    return oMsgCompletion;\r\n  }\r\n};\r\n\r\n\r\n// Register a message completion builder for GET_XY_FROM_LATLON\r\ncmapi.map.message.complete.builder[emp.intents.control.GET_XY_FROM_LATLON] = {\r\n\r\n  // oTransaction will have a transaction property\r\n  build: function (oTransaction) {\r\n    var convert;\r\n    var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n\r\n    if (oMsgCompletion.failures.length > 0) {\r\n      return oMsgCompletion;\r\n    }\r\n\r\n    convert = oTransaction.items[0];\r\n    oMsgCompletion.details.x = convert.x;\r\n    oMsgCompletion.details.y = convert.y;\r\n    oMsgCompletion.details.invalid = convert.invalid;\r\n\r\n    return oMsgCompletion;\r\n  }\r\n};\r\n","// Register a message completion builder for GET\r\ncmapi.map.message.complete.builder[emp.intents.control.GET] = {\r\n    \r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n\r\n        if (oTransaction.items && (oTransaction.items.length > 0))\r\n        {\r\n            // Latter we may want to clean up whats returned.\r\n            oMsgCompletion.details.successes = {\r\n                feature: oTransaction.items[0].feature,\r\n                overlay: oTransaction.items[0].overlay\r\n            };\r\n        }\r\n        \r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for OVERLAY_ADD\r\ncmapi.map.message.complete.builder[emp.intents.control.OVERLAY_ADD] = {\r\n  build: function (oTransaction) {\r\n    var oOverlay,\r\n      oDetail,\r\n      oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction),\r\n      oOverlays = oTransaction.items,\r\n      instanceRootId = emp.storage.getRootGuid(oTransaction.mapInstanceId),\r\n      i,\r\n      empParentOverlayProperties,\r\n      empParentOverlay;\r\n\r\n    if (oOverlays.length === 1) {\r\n      oOverlay = oOverlays[0];\r\n      // Check to make sure a parent id exists and that it is not equal to the map instance\r\n      // root id\r\n      if (oOverlay.parentId && instanceRootId && instanceRootId !== oOverlay.parentId) {\r\n        empParentOverlay = emp.storage.get.id({id: oOverlay.parentId}).options;\r\n        empParentOverlayProperties = emp.helpers.copyObject(empParentOverlay.properties);\r\n      }\r\n      oDetail = {\r\n        name: oOverlay.name,\r\n        overlayId: oOverlay.overlayId,\r\n        parentId: oOverlay.parentId,\r\n        properties: oOverlay.properties,\r\n        description: oOverlay.description\r\n      };\r\n      // parentInfo added to pass relevant parent information\r\n      // for the purposes of re-building overlay objects for the client\r\n      if (empParentOverlay) {\r\n        oDetail.parentInfo = {\r\n          name: empParentOverlay.name,\r\n          overlayId: empParentOverlay.overlayId,\r\n          properties: empParentOverlayProperties,\r\n          menuId: empParentOverlay.menuId,\r\n          description: empParentOverlay.description\r\n        };\r\n      }\r\n      oMsgCompletion.details = oDetail;\r\n    } else {\r\n      // This may be breaking CMAPI standard since overlay_add does not have a batch form\r\n      oMsgCompletion.details = [];\r\n\r\n      for (i = 0; i < oOverlays.length; i++) {\r\n        oOverlay = oOverlays[i];\r\n        // Check to make sure a parent id exists and that it is not equal to the map instance\r\n        // root id\r\n        if (oOverlay.parentId && instanceRootId && instanceRootId !== oOverlay.parentId) {\r\n          empParentOverlay = emp.storage.get.id({id: oOverlay.parentId}).options;\r\n          empParentOverlayProperties = emp.helpers.copyObject(empParentOverlay.properties);\r\n        }\r\n        oDetail = {\r\n          name: oOverlay.name,\r\n          overlayId: oOverlay.overlayId,\r\n          parentId: oOverlay.parentId,\r\n          properties: oOverlay.properties,\r\n          description: oOverlay.description\r\n        };\r\n        // parentInfo added to pass relevant parent information\r\n        // for the purposes of re-building overlay objects for the client\r\n        if (empParentOverlay) {\r\n          oDetail.parentInfo = {\r\n            name: empParentOverlay.name,\r\n            overlayId: empParentOverlay.overlayId,\r\n            properties: empParentOverlayProperties,\r\n            menuId: empParentOverlay.menuId,\r\n            description: empParentOverlay.description\r\n          };\r\n        }\r\n        oMsgCompletion.details.push(oDetail);\r\n      }\r\n    }\r\n\r\n    return oMsgCompletion;\r\n  }\r\n};\r\n","// Register a message completion builder for OVERLAY_HIDE\r\ncmapi.map.message.complete.builder[emp.intents.control.OVERLAY_HIDE] = {\r\n    \r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oOverlay = oTransaction.items[0];\r\n        \r\n        if (oOverlay)\r\n        {\r\n            var oDetails = {\r\n                overlayId: oOverlay.overlayId\r\n            };\r\n\r\n            oMsgCompletion.details = oDetails;\r\n        }\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for OVERLAY_REMOVE\r\ncmapi.map.message.complete.builder[emp.intents.control.OVERLAY_REMOVE] = {\r\n  build: function (oTransaction) {\r\n    var oOverlay,\r\n      oDetail,\r\n      oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction),\r\n      oOverlays = oTransaction.items,\r\n      instanceRootId = emp.storage.getRootGuid(oTransaction.mapInstanceId),\r\n      i,\r\n      empParentOverlayProperties,\r\n      empParentOverlay;\r\n\r\n    if (oOverlays.length === 1) {\r\n      oOverlay = oOverlays[0];\r\n      // Check to make sure a parent id exists and that it is not equal to the map instance\r\n      // root id\r\n      if (oOverlay.parentId && instanceRootId && instanceRootId !== oOverlay.parentId) {\r\n        empParentOverlay = emp.storage.get.id({id: oOverlay.parentId}).options;\r\n        empParentOverlayProperties = emp.helpers.copyObject(empParentOverlay.properties);\r\n      }\r\n      oDetail = {\r\n        name: oOverlay.name,\r\n        overlayId: oOverlay.overlayId,\r\n        parentId: oOverlay.parentId,\r\n        properties: oOverlay.properties,\r\n        description: oOverlay.description\r\n      };\r\n      // parentInfo added to pass relevant parent information\r\n      // for the purposes of re-building overlay objects for the client\r\n      if (empParentOverlay) {\r\n        oDetail.parentInfo = {\r\n          name: empParentOverlay.name,\r\n          overlayId: empParentOverlay.overlayId,\r\n          properties: empParentOverlayProperties,\r\n          description: empParentOverlay.description\r\n        };\r\n      }\r\n      oMsgCompletion.details = oDetail;\r\n    } else {\r\n      // This may be breaking CMAPI standard since overlay_add does not have a batch form\r\n      oMsgCompletion.details = [];\r\n      for (i = 0; i < oOverlays.length; i++) {\r\n        oOverlay = oOverlays[i];\r\n        // Check to make sure a parent id exists and that it is not equal to the map instance\r\n        // root id\r\n        if (oOverlay.parentId && instanceRootId && instanceRootId !== oOverlay.parentId) {\r\n          empParentOverlay = emp.storage.get.id({id: oOverlay.parentId}).options;\r\n          empParentOverlayProperties = emp.helpers.copyObject(empParentOverlay.properties);\r\n        }\r\n        oDetail = {\r\n          name: oOverlay.name,\r\n          overlayId: oOverlay.overlayId,\r\n          parentId: oOverlay.parentId,\r\n          properties: oOverlay.properties,\r\n          menuId: oOverlay.menuId,\r\n          description: oOverlay.description\r\n        };\r\n        // parentInfo added to pass relevant parent information\r\n        // for the purposes of re-building overlay objects for the client\r\n        if (empParentOverlay) {\r\n          oDetail.parentInfo = {\r\n            name: empParentOverlay.name,\r\n            overlayId: empParentOverlay.overlayId,\r\n            properties: empParentOverlayProperties,\r\n            description: empParentOverlay.description\r\n          };\r\n        }\r\n        oMsgCompletion.details.push(oDetail);\r\n      }\r\n    }\r\n    return oMsgCompletion;\r\n  }\r\n};","// Register a message completion builder for OVERLAY_SHOW\r\ncmapi.map.message.complete.builder[emp.intents.control.OVERLAY_SHOW] = {\r\n    \r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oOverlay = oTransaction.items[0];\r\n        \r\n        if (oOverlay)\r\n        {\r\n            var oDetails = {\r\n                overlayId: oOverlay.overlayId\r\n            };\r\n\r\n            oMsgCompletion.details = oDetails;\r\n        }\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","// Register a message completion builder for OVERLAY_UPDATE\r\ncmapi.map.message.complete.builder[emp.intents.control.OVERLAY_UPDATE] = {\r\n    \r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oOverlay = oTransaction.items[0];\r\n        \r\n        if (oOverlay)\r\n        {\r\n            var oDetails = {\r\n                name: oOverlay.name,\r\n                overlayId: oOverlay.overlayId,\r\n                parentId: oOverlay.parentId,\r\n                properties: oOverlay.properties,\r\n                menuId: oOverlay.menuId\r\n            };\r\n\r\n            oMsgCompletion.details = oDetails;\r\n        }\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for VIEW_SET\r\ncmapi.map.message.complete.builder[emp.intents.control.VIEW_SET] = {\r\n\r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n        var oView;\r\n        var oBounds;\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n\r\n        if (oMsgCompletion.failures.length > 0)\r\n        {\r\n            return oMsgCompletion;\r\n        }\r\n\r\n        oView = oTransaction.items[0];\r\n\r\n        if (oView.bounds) {\r\n            oBounds = {\r\n                northEast: {\r\n                    lat: oView.bounds.north,\r\n                    lon: oView.bounds.east\r\n                },\r\n                southWest: {\r\n                    lat: oView.bounds.south,\r\n                    lon: oView.bounds.west\r\n                }\r\n            };\r\n            oMsgCompletion.details.bounds = oBounds;\r\n        }\r\n\r\n        oMsgCompletion.details.range = oView.range;\r\n        oMsgCompletion.details.center = oView.location;\r\n        oMsgCompletion.details.tilt = oView.tilt;\r\n        oMsgCompletion.details.heading = oView.heading;\r\n        oMsgCompletion.details.roll = oView.roll;\r\n        oMsgCompletion.details.overlayId = oView.overlayId;\r\n        oMsgCompletion.details.parentId = oView.parentId;\r\n        oMsgCompletion.details.featureId = oView.featureId;\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for VIEW_GET\r\ncmapi.map.message.complete.builder[emp.intents.control.VISIBILITY_GET] = {\r\n\r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var item;\r\n\r\n        if (oMsgCompletion.failures.length > 0)\r\n        {\r\n            return oMsgCompletion;\r\n        }\r\n\r\n        item = oTransaction.items[0];\r\n\r\n        oMsgCompletion.details = {\r\n          visible: item.visible,\r\n          targetId: item.coreId,\r\n          parentId: item.parentId\r\n        };\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for VIEW_SET\r\ncmapi.map.message.complete.builder[emp.intents.control.VISIBILITY_SET] = {\r\n  // oTransaction will have a transaction property\r\n  build: function (oTransaction) {\r\n    var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction),\r\n        item,\r\n        i;\r\n\r\n    if (oMsgCompletion.failures.length > 0) {\r\n        return oMsgCompletion;\r\n    }\r\n    oMsgCompletion.details = [];\r\n    for (i = 0; i < oTransaction.items.length; i = i + 1) {\r\n      item = oTransaction.items[i];\r\n      oMsgCompletion.details.push({\r\n        // emp.storage.controller.visibility.getState() doesn't need to be called\r\n        // to get the visibilityState because during a setVisibility() operation \r\n        // the target's instance visibility can never be ANCESTOR_HIDDEN. Only\r\n        // VISIBLE or HIDDEN could occur and these values would be assigned based\r\n        // on the visible value sent in to the setVisibility() operation. Therefore,\r\n        // the transaction item's \"visible\" property is also the visibility state for\r\n        // the visibility events.\r\n        visibilityState: item.visible ? emp3.api.enums.VisibilityStateEnum.VISIBLE : emp3.api.enums.VisibilityStateEnum.HIDDEN,\r\n        targetAttributes: item.targetAttributes,\r\n        parentTargetAttributes: item.parentTargetAttributes\r\n      });\r\n    }\r\n    return oMsgCompletion;\r\n  }\r\n};","// Register a message completion builder for WMS_ADD\r\ncmapi.map.message.complete.builder[emp.intents.control.MAP_SERVICE_ADD] = {\r\n\r\n    build: function (oTransaction) {\r\n        var oWMS;\r\n        var oDetail;\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oWMSs = oTransaction.items;\r\n        var oDetails = {\r\n            features: []\r\n        };\r\n\r\n        for (var iIndex = 0; iIndex < oWMSs.length; iIndex++)\r\n        {\r\n            oWMS = oWMSs[iIndex];\r\n            \r\n            switch (oTransaction.originChannel)\r\n            {\r\n                case cmapi.channel.names.MAP_FEATURE_PLOT_URL:\r\n                    oDetail = {\r\n                        overlayId: oWMS.overlayId,\r\n                        featureId: oWMS.id,\r\n                        name: oWMS.name,\r\n                        format: emp.typeLibrary.featureFormatType.WMS,\r\n                        url: oWMS.url,\r\n                        params: oWMS.params\r\n                    };\r\n\r\n                    oDetails.features.push(oDetail);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        oMsgCompletion.details = oDetails;\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","// Register a message completion builder for WMS_REMOVE\r\ncmapi.map.message.complete.builder[emp.intents.control.MAP_SERVICE_REMOVE] = {\r\n\r\n    // oTransaction will have a transaction property\r\n    build: function (oTransaction) {\r\n        var oFeature;\r\n        var oDetail;\r\n        var oMsgCompletion = new cmapi.typeLibrary.MessageComplete(oTransaction);\r\n        var oFeatures = oTransaction.items;\r\n        var oDetails = {\r\n            features: []\r\n        };\r\n\r\n        for (var iIndex = 0; iIndex < oFeatures.length; iIndex++)\r\n        {\r\n            oFeature = oFeatures[iIndex];\r\n\r\n            oDetail = {\r\n                overlayId: oFeature.overlayId,\r\n                featureId: oFeature.id\r\n            };\r\n\r\n            oDetails.features.push(oDetail);\r\n        }\r\n\r\n        oMsgCompletion.details = oDetails;\r\n\r\n        return oMsgCompletion;\r\n    }\r\n};\r\n","// Register a message completion builder for DRAW_UPDATE\r\ncmapi.map.message.progress.builder[emp.intents.control.DRAW_UPDATE] = {\r\n    \r\n    build: function (oTransaction) {\r\n\r\n        var oFeature = oTransaction.items[0];\r\n        var oMsgProgress = new cmapi.typeLibrary.MessageProgress(oTransaction);\r\n        \r\n        var oDetails = {\r\n            overlayId: oFeature.overlayId,\r\n            parentId: oFeature.parentId,\r\n            featureId: oFeature.featureId,\r\n            name: oFeature.name,\r\n            type: oFeature.type,\r\n            properties: oFeature.properties,\r\n            format: oFeature.format,\r\n            feature: oFeature.data,\r\n            menuId: oFeature.menuId\r\n        };\r\n        \r\n        switch (oFeature.updateEventType)\r\n        {\r\n            case emp.typeLibrary.UpdateEventType.START:\r\n                oDetails.status = \"start\";\r\n                break;\r\n            case emp.typeLibrary.UpdateEventType.UPDATE:\r\n                oDetails.status = \"update\";\r\n                oDetails.updates = {\r\n                    type: oFeature.updates.type,\r\n                    indices: oFeature.updates.indices,\r\n                    coordinates: oFeature.updates.coordinates\r\n                };\r\n                break;\r\n            case emp.typeLibrary.UpdateEventType.COMPLETE:\r\n                oDetails.status = \"complete\";\r\n                oDetails.updates = {\r\n                    type: oFeature.updates.type,\r\n                    indices: oFeature.updates.indices,\r\n                    coordinates: oFeature.updates.coordinates\r\n                };\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        \r\n        oMsgProgress.details = oDetails;\r\n        oMsgProgress.messageId = oFeature.transactionId;\r\n        oMsgProgress.originatingChannel = cmapi.channel.names.MAP_FEATURE_DRAW;\r\n        \r\n        return oMsgProgress;\r\n    }\r\n};\r\n","/* global cmapi */\r\n\r\n// Register a message completion builder for EDIT_UPDATE\r\ncmapi.map.message.progress.builder[emp.intents.control.EDIT_UPDATE] = {\r\n    \r\n    build: function (oTransaction) {\r\n\r\n        var oFeature = oTransaction.items[0];\r\n        var oMsgProgress = new cmapi.typeLibrary.MessageProgress(oTransaction);\r\n        \r\n        var oDetails = {\r\n            overlayId: oFeature.overlayId,\r\n            parentId: oFeature.parentId,\r\n            featureId: oFeature.featureId,\r\n            properties: oFeature.properties,\r\n            format: oFeature.format,\r\n            feature: oFeature.data,\r\n            menuId: oFeature.menuId\r\n        };\r\n        \r\n        switch (oFeature.updateEventType)\r\n        {\r\n            case emp.typeLibrary.UpdateEventType.START:\r\n                oDetails.status = \"start\";\r\n                break;\r\n            case emp.typeLibrary.UpdateEventType.UPDATE:\r\n                oDetails.status = \"update\";\r\n                oDetails.updates = {\r\n                    type: oFeature.updates.type,\r\n                    indices: oFeature.updates.indices,\r\n                    coordinates: oFeature.updates.coordinates\r\n                };\r\n                break;\r\n            case emp.typeLibrary.UpdateEventType.COMPLETE:\r\n                oDetails.status = \"complete\";\r\n                oDetails.updates = {\r\n                    type: oFeature.updates.type,\r\n                    indices: oFeature.updates.indices,\r\n                    coordinates: oFeature.updates.coordinates\r\n                };\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n\r\n        oMsgProgress.details = oDetails;\r\n        oMsgProgress.messageId = oFeature.transactionId;\r\n        oMsgProgress.originatingChannel = cmapi.channel.names.MAP_FEATURE_EDIT;\r\n        \r\n        return oMsgProgress;\r\n    }\r\n};\r\n","cmapi.channel.support.genericFeatureRemove = function(oTransaction) {\r\n  var oItem;\r\n  var oFeature;\r\n  var itemInStorage;\r\n  var oaItems = oTransaction.items;\r\n  var mapServiceItems = [];\r\n  var featureItems = [];\r\n\r\n\r\n  for (var iIndex = 0; iIndex < oaItems.length; iIndex++) {\r\n    oItem = oaItems[iIndex];\r\n\r\n    itemInStorage = emp.storage.findFeature(oItem.overlayId, oItem.featureId);\r\n\r\n    if (itemInStorage === undefined) {\r\n      // The object is not in storage.\r\n      // Pass it as a feature and let the engine fail it.\r\n      oFeature = new emp.typeLibrary.Feature({\r\n        overlayId: oItem.overlayId,\r\n        parentId: oItem.parentId,\r\n        featureId: oItem.featureId\r\n      });\r\n      featureItems.push(oFeature);\r\n    }\r\n    else {\r\n      switch (itemInStorage.getCoreObjectType()) {\r\n        case emp.typeLibrary.types.WMS:\r\n          // A WMS service does not have a parentId.\r\n          oFeature = new emp.typeLibrary.WMS({\r\n            overlayId: oItem.overlayId,\r\n            id: oItem.featureId\r\n          });\r\n          mapServiceItems.push(oFeature);\r\n          break;\r\n        case emp.typeLibrary.types.WMTS:\r\n          // A WMS service does not have a parentId.\r\n          oFeature = new emp.typeLibrary.WMTS({\r\n            overlayId: oItem.overlayId,\r\n            id: oItem.featureId\r\n          });\r\n          mapServiceItems.push(oFeature);\r\n          break;\r\n        case emp.typeLibrary.types.KML:\r\n          // A WMS service does not have a parentId.\r\n          oFeature = new emp.typeLibrary.KmlLayer({\r\n            overlayId: oItem.overlayId,\r\n            id: oItem.featureId\r\n          });\r\n          mapServiceItems.push(oFeature);\r\n          break;\r\n        case emp.typeLibrary.types.FEATURE:\r\n        default:\r\n          oFeature = new emp.typeLibrary.Feature({\r\n            overlayId: oItem.overlayId,\r\n            parentId: oItem.parentId,\r\n            featureId: oItem.featureId\r\n          });\r\n          featureItems.push(oFeature);\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (featureItems.length > 0) {\r\n    var featureTransaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.FEATURE_REMOVE,\r\n      mapInstanceId: oTransaction.mapInstanceId,\r\n      transactionId: oTransaction.transactionId,\r\n      sender: oTransaction.sender,\r\n      originChannel: oTransaction.originChannel,\r\n      source: oTransaction.source,\r\n      originalMessage: oTransaction.originalMessage,\r\n      messageOriginator: oTransaction.messageOriginator,\r\n      originalMessageType: oTransaction.originalMessageType,\r\n      items: featureItems\r\n    });\r\n\r\n    setTimeout(function() {\r\n      featureTransaction.run();\r\n    }, 0);\r\n  }\r\n\r\n  if (mapServiceItems.length > 0) {\r\n    var mapServiceTransaction = new emp.typeLibrary.Transaction({\r\n      intent: emp.intents.control.MAP_SERVICE_REMOVE,\r\n      mapInstanceId: oTransaction.mapInstanceId,\r\n      transactionId: oTransaction.transactionId,\r\n      sender: oTransaction.sender,\r\n      originChannel: oTransaction.originChannel,\r\n      source: oTransaction.source,\r\n      originalMessage: oTransaction.originalMessage,\r\n      messageOriginator: oTransaction.messageOriginator,\r\n      originalMessageType: oTransaction.originalMessageType,\r\n      items: mapServiceItems\r\n    });\r\n    setTimeout(function() {\r\n      mapServiceTransaction.run();\r\n    }, 0);\r\n  }\r\n};\r\n","/*globals emp, OWF*/\r\n\r\nemp.api.core = {};\r\nemp.api.core.SOURCE = 'emp-core-api-core';\r\nemp.api.sources.push(emp.api.core.SOURCE);\r\nemp.api.core._widgetId = '';\r\nemp.api.core._isOzoneInitialized = false;\r\n\r\nemp.api.core._init = function () {\r\n\r\n        var fixture = emp.api.core.fixture.channels;\r\n        for (var i in fixture) {\r\n            if (fixture[i].direction === \"inbound\" || fixture[i].direction === \"bidirectional\") {\r\n                emp.environment.get().pubSub.subscribe({channel:i, callback: emp.api.core.handleMessage});\r\n            }\r\n        }\r\n        var environment = emp.environment.get();\r\n        if (environment === emp.environment.owf) {\r\n            this._widgetId = OWF.getInstanceId();\r\n            this._isOzoneInitialized = true;\r\n        }\r\n\r\n\temp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.CLICK,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.publish(args);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\temp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.FEATURE_CLICK,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.publish(args);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\temp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.VIEW_CHANGE,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.publish(args);\r\n\t\t}\r\n\t});\r\n\r\n        emp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.STATUS_CHANGE,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.publish(args);\r\n\t\t}\r\n\t});\r\n\r\n\temp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.FEATURE_REMOVE,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.updateHash(args);\r\n\t\t}\r\n\t});\r\n\r\n\temp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.OVERLAY_REMOVE,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.updateHash(args);\r\n\t\t}\r\n\t});\r\n\r\n        emp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.DRAW_UPDATE,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.publish(args);\r\n\t\t}\r\n\t});\r\n\r\n        emp.transactionQueue.listener.add({\r\n\t\ttype: emp.intents.control.EDIT_UPDATE,\r\n\t\tcallback: function (args) {\r\n\t\t\temp.api.core.publish(args);\r\n\t\t}\r\n\t});\r\n\r\n        emp.transactionQueue.listener.add({\r\n            type: emp.intents.control.TRANSACTION_COMPLETE,\r\n            callback: function (args) {\r\n                    emp.api.core.transactionQueue.transCompleteHandler(args);\r\n                }\r\n        });\r\n};","var emp = emp || {};\r\nemp.api = emp.api || {};\r\nemp.api.core = emp.api.core || {};\r\n\r\nemp.api.core.fixture = {\r\n\t\"title\": \"Core Map API Payload Specification\",\r\n\t\"version\": \"13.11\",\r\n\t\"channels\": {\r\n\t\t\"Bcw.Map.Broadcast\": {\r\n\t\t\t\"purpose\": \"Receives all incoming core-map-api traffic\",\r\n\t\t\t\"extension\": false,\r\n\t\t\t\"direction\": \"inbound\"\r\n\t\t},\r\n\t\t\"BcwMapBrokerChannel\": {\r\n\t\t\t\"purpose\": \"sends outgoing events to core-map-api widgets\",\r\n\t\t\t\"extension\": false,\r\n\t\t\t\"direction\": \"outbound\"\r\n\t\t}\r\n\t}\r\n};\r\n\r\nemp.api.core.channel = {};\r\n\r\nemp.api.core.channel.names = {\r\n    MAP_BROADCAST: \"Bcw.Map.Broadcast\",\r\n    MAP_BROKER: \"BcwMapBrokerChannel\",\r\n    GRAPHICS_DRAW_EVENT: \"core.api.graphics.drawing\",\r\n    GRAPHIC_EVENT: \"core.api.graphics.eventing\",\r\n    MAP_EVENT: \"core.api.map.eventing\"\r\n};\r\n\r\nemp.api.core.EventType = {\r\n    GRAPHIC_UPDATE: \"graphicUpdate\",\r\n    GRAPHIC_CLICK: \"graphicClick\",\r\n    GRAPHIC_DBL_CLICK: \"graphicDoubleClick\",\r\n    DRAW_COMPLETE: \"drawComplete\",\r\n    MAP_MOVE: \"mapMove\",\r\n    MAP_READY: \"mapReady\",\r\n    MAP_CLICKED: \"mapClick\",\r\n    MAP_DBL_CLICKED: \"mapDoubleClick\"\r\n};\r\n\r\nemp.api.core.DataType = {\r\n    MIL_STD_SYMBOL: \"milStdSymbol\",\r\n    POINT: \"point\",\r\n    LINE: \"line\",\r\n    POLYGON: \"polygon\",\r\n    MIL_STD_MULTI_POINT: \"MilStdMultiPoint\",\r\n    AIRSPACE: \"3DShape\",\r\n    UNKNOWN: \"unknown\"\r\n};\r\n    ","/*globals emp, jQuery */\r\n\r\n\r\n\r\nemp.api.core._featureHash = [];\r\nemp.api.core._overlayHash = [];\r\nemp.api.core.scaleMultiplier = 10.5;\r\n\r\n\r\nemp.api.core.transactionQueue = (function() {\r\n  var oWaitTimer;\r\n  var iWaittime = 5000;\r\n  var tranQueue = [];\r\n  var oOutstandingTransaction = null;\r\n\r\n  function transactionWaitTimeout() {\r\n    if (oOutstandingTransaction) {\r\n      // We have waited for the transaction to complete.\r\n      emp.typeLibrary.Error({\r\n        level: emp.typeLibrary.Error.level.MINOR,\r\n        message: \"V1 \" + oOutstandingTransaction.intent + \" transaction with \" +\r\n          (oOutstandingTransaction.items.length + oOutstandingTransaction.failures.length) +\r\n          \" items timed out (\" + (iWaittime / 1000) + \" sec). V1 queue released.\"\r\n      });\r\n      oOutstandingTransaction = null;\r\n    }\r\n  }\r\n\r\n  function runQueue() {\r\n    if ((tranQueue.length > 0) &&\r\n      (oOutstandingTransaction === null)) {\r\n      // get the oldest item in the queue\r\n      var transaction = tranQueue.shift();\r\n\r\n      switch (transaction.intent) {\r\n        case emp.intents.control.DRAW_BEGIN:\r\n          // draws just let thru.\r\n          break;\r\n        case emp.intents.control.EDIT_BEGIN:\r\n          // edit just let thru.\r\n          // But we need to get the original feature.\r\n          transaction.items[0].originFeature = emp.storage.get.id({\r\n            id: transaction.items[0].coreId\r\n          });\r\n          break;\r\n        default:\r\n          oOutstandingTransaction = transaction;\r\n          // Start the wait timer.\r\n          oWaitTimer = setTimeout(transactionWaitTimeout, iWaittime);\r\n          break;\r\n      }\r\n      // queue the transaction in the main transaction Q.\r\n      emp.transactionQueue.add(transaction);\r\n    }\r\n    // repeat with break in between code execution to avoid locking thread\r\n    // with back to back calls in a loop\r\n    setTimeout(runQueue, 50);\r\n  }\r\n\r\n  var publicInterface = {\r\n    add: function(transaction) {\r\n      tranQueue.push(transaction);\r\n    },\r\n    transCompleteHandler: function(oTransaction) {\r\n      if (oOutstandingTransaction) {\r\n        if (oTransaction.transactionId === oOutstandingTransaction.transactionId) {\r\n          clearTimeout(oWaitTimer);\r\n          oOutstandingTransaction = null;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  runQueue();\r\n  return publicInterface;\r\n}());\r\n\r\n\r\n/**\r\n * Listen to adds, updates, deletes and update our featureHash.  This handles\r\n * events from publisher for things like map removes which the core-api would\r\n * not receive.\r\n * @param  {transaction} args The transaction that occurred.\r\n */\r\nemp.api.core.updateHash = function(args) {\r\n  var i,\r\n    id;\r\n\r\n  // Make sure we have a transaction.\r\n  if (args) {\r\n    // Make sure there are items in the transaction\r\n    if (args.items && args.items.length > 0) {\r\n      // Loop through the transaction and depending on what the transaction is\r\n      // update the hash table appropriately\r\n      for (i = 0; i < args.items.length; i += 1) {\r\n\r\n        // If it's a feature remove transaction, just call removeFeature to update\r\n        // the hash tables.\r\n        if (args.intent === emp.intents.control.FEATURE_REMOVE) {\r\n          // translate the id to remove any special characters that were added in.\r\n          id = emp.api.core.recurseStrFixOutbound(args.items[i].featureId);\r\n          emp.api.core.removeFeature(id);\r\n          // if it's a overly remove transaction call the removeOverlay to update the\r\n          // overlay hash table.\r\n        } else if (args.intent === emp.intents.control.OVERLAY_REMOVE) {\r\n          // translate the id to remove any special characters that were added in.\r\n          id = emp.api.core.recurseStrFixOutbound(args.items[i].overlayId);\r\n          emp.api.core.removeOverlay(id);\r\n        }\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * Checks to see if the item is a known feature.\r\n * @param  {string}  id The id of the feature you are checking\r\n * @return {Boolean}    true if the id belongs to feature, false if it is an overlay.\r\n */\r\n\r\nemp.api.core.isFeature = function(id) {\r\n  if (emp.api.core._featureHash[id]) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Checks to see if the item is a known overlay\r\n * @param  {string}  id The id of the overlay being checked.\r\n * @return {Boolean}    true if the id is an overlay, false if it is not.\r\n */\r\n\r\nemp.api.core.isOverlay = function(id) {\r\n  if (emp.api.core._overlayHash[id]) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Retrieves the overlayId that a feature belongs to.\r\n *\r\n * @param  {string} id The id of the feature being inquired\r\n * @return {string}    The overlay id that the feature is on.\r\n */\r\n\r\nemp.api.core.getOverlayId = function(id) {\r\n  if (emp.api.core._featureHash[id]) {\r\n    return emp.api.core._featureHash[id].overlayId;\r\n  } else {\r\n    return undefined;\r\n  }\r\n};\r\n\r\nemp.api.core.removeFeature = function(id) {\r\n  if (emp.api.core._featureHash[id]) {\r\n    delete emp.api.core._featureHash[id];\r\n  }\r\n\r\n};\r\n\r\nemp.api.core.removeOverlay = function(id) {\r\n\r\n  var i;\r\n\r\n  if (emp.api.core._overlayHash[id]) {\r\n    for (i = 0; i < emp.api.core._overlayHash[id].length; i += 1) {\r\n      emp.api.core.removeFeature(emp.api.core._overlayHash[id][i]);\r\n    }\r\n    delete emp.api.core._overlayHash[id];\r\n  }\r\n};\r\n\r\nemp.api.core.addOverlay = function(id) {\r\n  if (!emp.api.core._overlayHash[id]) {\r\n    emp.api.core._overlayHash[id] = [];\r\n  }\r\n};\r\n\r\n/**\r\n * Checks to see if an id is an overlay or a feature\r\n * and then appopriately adds the information to the typeLibraryArguments\r\n * and the hash tables.\r\n * @param {object} typeLibraryArgs\r\n * @param {string} overlayId\r\n */\r\nemp.api.core.addParent = function(typeLibraryArgs, overlayId) {\r\n\r\n  // First find out if it is a feature by looking it up\r\n  // in our feature hash.  If it is there, then it is a feature.\r\n  if (emp.api.core.isFeature(overlayId)) {\r\n    typeLibraryArgs.parentId = overlayId;\r\n    typeLibraryArgs.overlayId = emp.api.core.getOverlayId(overlayId);\r\n    emp.api.core._featureHash[typeLibraryArgs.featureId] = {\r\n      overlayId: typeLibraryArgs.overlayId,\r\n      parentId: typeLibraryArgs.parentId\r\n    };\r\n\r\n\r\n    // If it's not a feature it is an overlay or the overlay doesn't exist.\r\n    // Either way set the overlayId. Then if it's not in the overlay hash, add it in.\r\n  } else {\r\n    typeLibraryArgs.overlayId = overlayId;\r\n    emp.api.core._featureHash[typeLibraryArgs.featureId] = {\r\n      overlayId: typeLibraryArgs.overlayId\r\n    };\r\n\r\n    // if the overlay does not already exist, add it to the _overlayHash, as it will\r\n    // be created by the map.  If it already exists, add the children ids to the overlay.\r\n    if (!emp.api.core.isOverlay(overlayId)) {\r\n      emp.api.core._overlayHash[overlayId] = [typeLibraryArgs.featureId];\r\n    } else {\r\n      emp.api.core._overlayHash[overlayId].push(typeLibraryArgs.featureId);\r\n    }\r\n  }\r\n};\r\n\r\nemp.api.core.translateToFeature = function(sender, oArgs) {\r\n  /*\r\n      oArgs = {\r\n          overlayId: args[1],\r\n          parentId: args[2],\r\n          name: args[0],\r\n          properties: {\r\n              readOnly: readOnly,\r\n              description: args[4],\r\n              iconUrl: args[5]\r\n          }\r\n   */\r\n  /*\r\n      var sPayload = \"\";\r\n      \r\n          sPayload = '\"' + oArgs.name + '\",';\r\n          sPayload += '\"' + oArgs.overlayId + '\",';\r\n          sPayload += '\"sourceId\",';\r\n          sPayload += '\"' + oArgs.parentId + '\",';\r\n          sPayload += '0.0,';\r\n          sPayload += '0.0,';\r\n          sPayload += '0.0,';\r\n          sPayload += '\"' + escape(\"\") + '\",';\r\n          sPayload += '\"img/empty.png\",';\r\n          sPayload += '\"clampToGround\"';\r\n          var modifiersObject = {};\r\n          modifiersObject.modifiers = {xOffset: \"0\", yOffset: \"0\"};\r\n          var modString = JSON.stringify(modifiersObject);\r\n          modString = escape(modString);\r\n          sPayload += ',\"' + modString + '\"';\r\n\r\n          emp.api.core.addPoint(sender, sPayload);\r\n  */\r\n  var payloads = [];\r\n  var sKML = \"\";\r\n\r\n  sKML += '<Folder id=\"' + oArgs.overlayId + '\">';\r\n  sKML += '<name>' + oArgs.name + '</name>';\r\n  sKML += '<Placemark></Placemark></Folder>';\r\n\r\n  var typeLibraryArgs = {\r\n    name: oArgs.name,\r\n    featureId: oArgs.overlayId,\r\n    format: 'kml',\r\n    feature: sKML,\r\n    v1type: emp.api.core.DataType.POINT\r\n  };\r\n\r\n  typeLibraryArgs.properties = {};\r\n  typeLibraryArgs.properties.readOnly = true;\r\n  typeLibraryArgs.properties.description = \"\";\r\n  typeLibraryArgs.properties.altitudeMode = \"clampToGround\";\r\n  typeLibraryArgs.properties.modifiers = {};\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, oArgs.parentId);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addEffort = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    args,\r\n    readOnly,\r\n    payloads = [];\r\n  // Split string into values and remove double qoutes\r\n  args = emp.api.core.splitArgs(payload);\r\n  // Decode any uri encoded strings for json transmission\r\n  emp.api.core.decodeParameters(args);\r\n\r\n  // args[3] is the editable flag.\r\n  // readonly is the opposite of of editable, reverse if set.\r\n  // otherwise set it to true.\r\n  if (args[3] === 'true') {\r\n    readOnly = false;\r\n  } else {\r\n    readOnly = true;\r\n  }\r\n\r\n  typeLibraryArgs = {\r\n    overlayId: args[1],\r\n    parentId: args[2],\r\n    name: args[0],\r\n    properties: {\r\n      readOnly: readOnly,\r\n      description: args[4],\r\n      iconUrl: args[5]\r\n    }\r\n  };\r\n\r\n  if (typeLibraryArgs.parentId && emp.api.core.isFeature(typeLibraryArgs.parentId)) {\r\n    emp.api.core.translateToFeature(sender, typeLibraryArgs);\r\n  } else {\r\n    emp.api.core.addOverlay(typeLibraryArgs.overlayId);\r\n\r\n    payloads.push(typeLibraryArgs);\r\n    emp.api.core.recurseStrFixInbound(payloads);\r\n\r\n    emp.api.core.createTransaction(sender.id, \"Overlay\", emp.intents.control.OVERLAY_ADD, payloads);\r\n  }\r\n};\r\n\r\nemp.api.core.translateToRemoveGraphic = function(sender, oArgs) {\r\n  var sPayload = \"\";\r\n\r\n  sPayload += '\"' + oArgs.overlayId + '\",';\r\n  sPayload += '\"unused\",';\r\n  sPayload += '\"' + emp.api.core._featureHash[oArgs.overlayId].parentId + '\",';\r\n\r\n  emp.api.core.removeGraphic(sender, sPayload);\r\n};\r\n\r\nemp.api.core.removeEffort = function(sender, payload) {\r\n\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n  emp.api.core.decodeParameters(args);\r\n\r\n  typeLibraryArgs = {\r\n    overlayId: args[0]\r\n  };\r\n\r\n  if (typeLibraryArgs.overlayId && emp.api.core.isFeature(typeLibraryArgs.overlayId)) {\r\n    emp.api.core.translateToRemoveGraphic(sender, typeLibraryArgs);\r\n  } else {\r\n    emp.api.core.removeOverlay(typeLibraryArgs.overlayId);\r\n\r\n    payloads.push(typeLibraryArgs);\r\n    emp.api.core.recurseStrFixInbound(payloads);\r\n\r\n    emp.api.core.createTransaction(sender.id, \"Overlay\", emp.intents.control.OVERLAY_REMOVE, payloads);\r\n  }\r\n};\r\n\r\nemp.api.core.addPoint = function(sender, payload) {\r\n  var args,\r\n    modifiers,\r\n    kml,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n\r\n  // CoreAPI -\r\n  // addPoint: function (name, id, sourceId, overlayId, lat, lon, altitude, description, iconURL, altitudeMode, modifiers)                    \r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n  emp.api.core.decodeParameters(args);\r\n  modifiers = {};\r\n\r\n  // Modifiers may not come over in message\r\n  if (args.length === 11) {\r\n    modifiers = JSON.parse(args[10]).modifiers;\r\n    if (modifiers.hasOwnProperty('xOffset')) {\r\n      if (typeof modifiers.xOffset === 'string') {\r\n        modifiers.xOffset = parseInt(modifiers.xOffset);\r\n      }\r\n    }\r\n    if (modifiers.hasOwnProperty('yOffset')) {\r\n      if (typeof modifiers.yOffset === 'string') {\r\n        modifiers.yOffset = parseInt(modifiers.yOffset);\r\n      }\r\n    }\r\n  }\r\n\r\n  kml = emp.api.core.getPointKml({\r\n    name: args[0],\r\n    lat: args[4],\r\n    lon: args[5],\r\n    iconUrl: args[8],\r\n    modifiers: modifiers\r\n  });\r\n\r\n  typeLibraryArgs = {\r\n    name: args[0],\r\n    featureId: args[1],\r\n    format: 'kml',\r\n    feature: kml,\r\n    v1type: emp.api.core.DataType.POINT\r\n  };\r\n\r\n  // If any of these properties are defined add the properties field.\r\n  if (typeof args[7] !== 'undefined' || typeof args[8] !== 'undefined' || typeof args[9] !== 'undefined' ||\r\n    typeof args[10] !== 'undefined') {\r\n\r\n    typeLibraryArgs.properties = {};\r\n\r\n    // check to see if a description is present\r\n    if (typeof args[7] !== 'undefined') {\r\n      typeLibraryArgs.properties.description = args[7];\r\n    }\r\n\r\n    if (typeof args[8] !== 'undefined') {\r\n      typeLibraryArgs.properties.iconUrl = args[8];\r\n    }\r\n\r\n    if (typeof args[9] !== 'undefined') {\r\n      typeLibraryArgs.properties.altitudeMode = args[9];\r\n    }\r\n\r\n    if (typeof args[10] !== 'undefined') {\r\n      emp.api.core.addCoreModifiersToProperties(modifiers, typeLibraryArgs.properties);\r\n    }\r\n\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addPointBatch = function(sender, payload) {\r\n  // CoreAPI -\r\n  // addPointBatch: function (batch) \r\n  // \r\n  // batch:\r\n  // {\r\n  //      name:\"Helicopter 1\", \r\n  //      id:\"e8403351-8478-41cb-994e-0c98ba1e896b\", \r\n  //      sourceId:\"fakeId\", \r\n  //      overlayId:\"overlay id from addOverlay\", \r\n  //      lat:37.6543, \r\n  //      lon:44.5876, \r\n  //      altitude:1000, \r\n  //      description: \"emp.api.core is a great description!\",\r\n  //      url: \"http://cdn1.iconfinder.com/data/icons/mapicons/icons/helicopter.png\", \r\n  //      altitudeMode:CoreMapAPI.ALTITUDE_RELATIVE_TO_GROUND, \r\n  //      visibility:true, \r\n  //      modifiers:null\r\n  //  }\r\n\r\n  var batch,\r\n    i,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = emp.api.core.formatJSON(payload);\r\n  batch = JSON.parse(payload);\r\n\r\n  for (i = 0; i < batch.length; i += 1) {\r\n    typeLibraryArgs = {};\r\n\r\n    if (batch[i].name) {\r\n      typeLibraryArgs.name = batch[i].name;\r\n    }\r\n\r\n    if (batch[i].id) {\r\n      typeLibraryArgs.featureId = batch[i].id;\r\n    }\r\n\r\n\r\n    typeLibraryArgs.format = 'kml';\r\n    typeLibraryArgs.v1type = emp.api.core.DataType.POINT;\r\n\r\n    typeLibraryArgs.feature = emp.api.core.getPointKml({\r\n      name: batch[i].name,\r\n      lat: batch[i].lat,\r\n      lon: batch[i].lon,\r\n      altitude: batch[i].altitude,\r\n      iconUrl: batch[i].url\r\n    });\r\n\r\n\r\n    if (batch[i].description || batch[i].url || batch[i].altitudeMode) {\r\n      typeLibraryArgs.properties = {};\r\n\r\n      if (batch[i].description) {\r\n        typeLibraryArgs.properties.description = batch[i].description;\r\n      }\r\n\r\n      if (batch[i].url) {\r\n        typeLibraryArgs.properties.iconUrl = batch[i].url;\r\n      }\r\n\r\n      if (batch[i].altitudeMode) {\r\n        typeLibraryArgs.properties.altitudeMode = batch[i].altitudeMode;\r\n      }\r\n\r\n      if (batch[i].modifiers) {\r\n        emp.api.core.addCoreModifiersToProperties(batch[i].modifiers, typeLibraryArgs.properties);\r\n      }\r\n\r\n      if (batch[i].overlayId) {\r\n        emp.api.core.addParent(typeLibraryArgs, batch[i].overlayId);\r\n        payloads.push(typeLibraryArgs);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (payloads.length > 0) {\r\n    emp.api.core.recurseStrFixInbound(payloads);\r\n    emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n  }\r\n\r\n};\r\n\r\nemp.api.core.addMilStdPoint = function(sender, payload) {\r\n  // addMilStdPoint: function (name, id, sourceId, overlayId, symbolCode, lat, lon, altitude, description, altitudeMode, modifiers)\r\n\r\n  var args,\r\n    modifiers,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n  emp.api.core.decodeParameters(args);\r\n\r\n  modifiers = null;\r\n  // Modifiers may not come over in message\r\n  if (args.length === 11) {\r\n    modifiers = args[10];\r\n  }\r\n\r\n  typeLibraryArgs = emp.api.core.createMilStdPointParams({\r\n    id: args[1],\r\n    name: args[0],\r\n    symbolCode: args[4],\r\n    lat: args[5],\r\n    lon: args[6],\r\n    altitude: args[7],\r\n    description: args[8],\r\n    altitudeMode: args[9],\r\n    modifiers: modifiers\r\n  });\r\n\r\n  if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode, 0)) {\r\n    typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n  } else {\r\n    typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_SYMBOL;\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  // map the featureId to an overlayId so we can retrieve it later for\r\n  // setVisibility\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n\r\n\r\n};\r\n\r\nemp.api.core.addMilStdPointBatch = function(sender, payload) {\r\n\r\n  var typeLibraryArgs,\r\n    batch,\r\n    i,\r\n    payloads = [];\r\n\r\n  payload = emp.api.core.formatJSON(payload);\r\n  batch = JSON.parse(payload);\r\n\r\n  for (i = 0; i < batch.length; i += 1) {\r\n\r\n    typeLibraryArgs = emp.api.core.createMilStdPointParams({\r\n      id: batch[i].id,\r\n      name: decodeURIComponent(batch[i].name),\r\n      symbolCode: batch[i].symbolCode,\r\n      description: decodeURIComponent(batch[i].description),\r\n      lat: batch[i].lat,\r\n      lon: batch[i].lon,\r\n      altitude: batch[i].altitude,\r\n      altitudeMode: batch[i].altitudeMode,\r\n      modifiers: decodeURIComponent(batch[i].modifiers)\r\n    });\r\n\r\n    if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode, 0)) {\r\n      typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n    } else {\r\n      typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_SYMBOL;\r\n    }\r\n\r\n    if (batch[i].overlayId) {\r\n      emp.api.core.addParent(typeLibraryArgs, batch[i].overlayId);\r\n      payloads.push(typeLibraryArgs);\r\n    }\r\n  }\r\n\r\n  if (payloads.length > 0) {\r\n    emp.api.core.recurseStrFixInbound(payloads);\r\n    emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n  }\r\n};\r\n\r\nemp.api.core.addMilStdSymbol = function(sender, payload) {\r\n\r\n  var args,\r\n    args2,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  args = payload.split('\\\",\\\"');\r\n\r\n\r\n  if (args.length === 7) {\r\n    args2 = args[6].split(',');\r\n\r\n    // if (args2[2] === 'false') {\r\n    //   visible = false;\r\n    // }\r\n\r\n  } else {\r\n    args2 = args[7].split(',');\r\n    args2.splice(0, 0, args[6]);\r\n    // visible = true;\r\n    // if (args2[2] === 'false') {\r\n    //   visible = false;\r\n    // }\r\n  }\r\n\r\n  emp.api.core.decodeParameters(args);\r\n  emp.api.core.decodeParameters(args2);\r\n\r\n  // args2 [0] = description\r\n  // args2 [1] = modifiers\r\n  // args2 [2] = visibility\r\n  // args2 [3] = altitudeMode\r\n  // addMilStdMultiPoint: function (name, id, sourceId, overlayId, symbolCode, coordinates, description, modifiers, visibility, altitudeMode) {\r\n\r\n  typeLibraryArgs = emp.api.core.createMilStdMultiPointParams({\r\n    name: args[0].replace(/\\\"/g, ''),\r\n    id: args[1],\r\n    symbolCode: args[4],\r\n    coordinates: args[5],\r\n    description: args2[0],\r\n    modifiers: ((args2[1] === \"null\") ? null : args2[1]),\r\n    altitudeMode: args2[3]\r\n  });\r\n\r\n  if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode, 0)) {\r\n    typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n  } else {\r\n    typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_SYMBOL;\r\n  }\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n\r\n};\r\n\r\nemp.api.core.addMilStdMultiPointBatch = function(sender, payload) {\r\n  var batch,\r\n    i,\r\n    typeLibraryArgs,\r\n    payloads = [],\r\n    len;\r\n\r\n  payload = emp.api.core.formatJSON(payload);\r\n  batch = JSON.parse(payload);\r\n  len = batch.length;\r\n  for (i = 0; i < len; i += 1) {\r\n\r\n    typeLibraryArgs = emp.api.core.createMilStdMultiPointParams({\r\n      id: batch[i].id,\r\n      name: decodeURIComponent(batch[i].name),\r\n      symbolCode: batch[i].symbolCode,\r\n      description: decodeURIComponent(batch[i].description),\r\n      coordinates: batch[i].coordinates,\r\n      altitudeMode: batch[i].altitudeMode,\r\n      modifiers: decodeURIComponent(batch[i].modifiers)\r\n    });\r\n\r\n    if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(typeLibraryArgs.data.symbolCode, 0)) {\r\n      typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n    } else {\r\n      typeLibraryArgs.v1type = emp.api.core.DataType.MIL_STD_SYMBOL;\r\n    }\r\n\r\n    if (batch[i].overlayId) {\r\n      emp.api.core.addParent(typeLibraryArgs, batch[i].overlayId);\r\n    }\r\n    payloads.push(typeLibraryArgs);\r\n  }\r\n\r\n  if (payloads.length > 0) {\r\n    emp.api.core.recurseStrFixInbound(payloads);\r\n    emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n  }\r\n};\r\n\r\nemp.api.core.add3DShape = function(sender, payload) {\r\n  var args,\r\n    overlayId,\r\n    altitudeMode,\r\n    attributes,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // CoreAPI\r\n  // add3DShape: function (name, id, sourceId, overlayId, shapeType, description, altitudeMode, coordinates, color, attributes)\r\n\r\n  args = payload.split('\\\",\\\"');\r\n  emp.api.core.decodeParameters(args);\r\n\r\n  attributes = args[9];\r\n  while (attributes[attributes.length - 1] === '\"') {\r\n    attributes = attributes.substr(0, attributes.length - 1);\r\n  }\r\n  attributes = JSON.parse(attributes);\r\n\r\n  altitudeMode = args[6].replace(/\\\"/g, '');\r\n  if (altitudeMode === '') {\r\n    altitudeMode = emp.typeLibrary.featureAltitudeModeType.RELATIVE_TO_GROUND;\r\n  }\r\n\r\n  for (var iIndex = 0; iIndex < attributes.attributes.length; iIndex++) {\r\n    if (attributes.attributes[iIndex].altitudeMode === undefined) {\r\n      attributes.attributes[iIndex].altitudeMode = altitudeMode;\r\n    }\r\n  }\r\n\r\n  overlayId = args[3].replace(/\\\"/g, '');\r\n  if ((overlayId === undefined) || (overlayId === null)) {\r\n    overlayId = args[2].replace(/\\\"/g, '');\r\n  }\r\n\r\n  typeLibraryArgs = emp.api.core.createMilStdMultiPointParams({\r\n    name: args[0].replace(/\\\"/g, ''),\r\n    id: args[1].replace(/\\\"/g, ''),\r\n    format: 'airspace',\r\n    symbolCode: args[4].replace(/\\\"/g, ''),\r\n    coordinates: args[7].replace(/\\\"/g, ''),\r\n    properties: {\r\n      lineColor: args[8].replace(/\\\"/g, ''),\r\n      fillColor: args[8].replace(/\\\"/g, ''),\r\n      attributes: attributes.attributes\r\n    },\r\n    v1type: emp.api.core.DataType.AIRSPACE\r\n  });\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, overlayId);\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addLine = function(sender, payload) {\r\n  // addLine: function (name, id, sourceId, overlayId, coordinates, description, lineColor, lineThickness, altitudeMode, extrude, modifiers) {\r\n  var args,\r\n    args2,\r\n    extrude,\r\n    kml,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = emp.api.core.formatJSON(payload);\r\n  args = payload.split('\\\",\\\"');\r\n  args2 = args[6].split(',');\r\n  emp.api.core.decodeParameters(args);\r\n  emp.api.core.decodeParameters(args2);\r\n\r\n  extrude = false;\r\n  if (args2[2] === 'true') {\r\n    extrude = true;\r\n  }\r\n\r\n  kml = emp.api.core.getLineKml({\r\n    name: args[0],\r\n    coordinates: args[4],\r\n    extrude: extrude\r\n  });\r\n\r\n  typeLibraryArgs = {\r\n    name: args[0].replace(/\\\"/g, ''),\r\n    featureId: args[1],\r\n    format: 'kml',\r\n    feature: kml,\r\n    properties: {\r\n      lineColor: args2[0],\r\n      lineWidth: parseInt(args2[1]),\r\n      altitudeMode: args2[2]\r\n    },\r\n    v1type: emp.api.core.DataType.LINE\r\n  };\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addPolygon = function(sender, payload) {\r\n  var args,\r\n    args2,\r\n    extrude,\r\n    kml,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // CoreAPI - \r\n  //addPolygon: function (name, id, sourceId, overlayId, coordinates, description, fillColor, lineColor, lineThickness, altitudeMode, extrude, modifiers) \r\n\r\n  args = payload.split('\\\",\\\"');\r\n  args2 = args[7].split(',');\r\n\r\n  emp.api.core.decodeParameters(args);\r\n  emp.api.core.decodeParameters(args2);\r\n\r\n  extrude = false;\r\n  if (args2[3] === 'true') {\r\n    extrude = true;\r\n  }\r\n\r\n  kml = emp.api.core.getPolygonKml({\r\n    name: args[0],\r\n    coordinates: args[4],\r\n    extrude: extrude\r\n  });\r\n\r\n  typeLibraryArgs = {\r\n    name: args[0].replace(/\\\"/g, ''),\r\n    featureId: args[1],\r\n    format: 'kml',\r\n    feature: kml,\r\n    properties: {\r\n      description: args[5],\r\n      fillColor: args[6],\r\n      lineColor: args2[0],\r\n      lineWidth: parseInt(args2[1]),\r\n      altitudeMode: args2[2]\r\n    },\r\n    v1type: emp.api.core.DataType.POLYGON\r\n  };\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addKmlStringToOverlay = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  // addKmlStringToOverlay: function (kmlString, name, id, overlayId, referenceLat, referenceLon, iconUrl)\r\n  // \r\n  // we won't need args 4 and 5, they are lat/lon and were used to locate the kml,\r\n  // that is no longer done, as the data explorer locates the item now.\r\n  // we also won't need args[6] was iconUrl which is not currently supported by data explorer.\r\n  typeLibraryArgs = {\r\n    name: args[1],\r\n    featureId: args[2],\r\n    format: 'kml',\r\n    feature: decodeURIComponent(args[0]),\r\n    v1type: emp.api.core.DataType.UNKNOWN\r\n  };\r\n\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n\r\n};\r\n\r\nemp.api.core.setVisibilityBatch = function(sender, payload) {\r\n  var batch,\r\n    i,\r\n    typeLibraryArgs,\r\n    payloads = [],\r\n    payloads2 = [],\r\n    overlayId;\r\n\r\n  // We need to drop the first and last ' character.\r\n  payload = payload.substr(1);\r\n  payload = payload.substr(0, payload.length - 1);\r\n  payload = unescape(payload);\r\n\r\n  // setVisibilityBatch: function (batch)\r\n  // [{id:graphicIdHere,visibility:true},{id:anotherGraphicIdHere,visibility:false}]\r\n  //payload = payload.replace(/\\\"/g, '');\r\n  batch = JSON.parse(payload);\r\n\r\n  // loop through batch and seperate payloads into hide or show.\r\n  for (i = 0; i < batch.length; i += 1) {\r\n\r\n    // Check to make sure we can get an overlay that\r\n    // is associated with emp.api.core id.  emp.api.core is one of the rare functions\r\n    // that requires only a feature id.\r\n    overlayId = emp.api.core.getOverlayId(batch[i].id);\r\n\r\n\r\n    // If it does have an overlayId, we then need to check\r\n    // to see if it has a parentId as well (that means the item is a feature\r\n    // and that feature Id needs to be included)\r\n    if (overlayId) {\r\n      typeLibraryArgs = {\r\n        featureId: batch[i].id\r\n      };\r\n\r\n      if (emp.api.core._featureHash[batch[i].id].parentId) {\r\n        typeLibraryArgs.parentId = emp.api.core._featureHash[batch[i].id].parentId;\r\n      }\r\n\r\n      if (batch[i].visibility) {\r\n        payloads.push(typeLibraryArgs);\r\n      } else {\r\n        payloads2.push(typeLibraryArgs);\r\n      }\r\n    }\r\n  }\r\n\r\n  // if there is any shows send the show message, if there are any hides send the\r\n  // hide message.  There may be the case where both can be sent.\r\n  if (payloads.length > 0) {\r\n    emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.VISIBILITY_SET, payloads);\r\n  }\r\n\r\n  if (payloads2.length > 0) {\r\n    emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.VISIBILITY_SET, payloads);\r\n  }\r\n};\r\n\r\nemp.api.core.removeGraphic = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // removeGraphic: function (id, sourceId, overlayId)\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n  emp.api.core.decodeParameters(args);\r\n\r\n  typeLibraryArgs = {\r\n    featureId: args[0]\r\n  };\r\n\r\n  if (emp.api.core._featureHash[args[2]]) {\r\n    typeLibraryArgs.overlayId = emp.api.core._featureHash[args[2]].overlayId;\r\n    typeLibraryArgs.parentId = args[2];\r\n  } else {\r\n    typeLibraryArgs.overlayId = args[2];\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_REMOVE, payloads);\r\n};\r\n\r\nemp.api.core.removeGraphicBatch = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    i,\r\n    payloads = [],\r\n    batch;\r\n\r\n  // removeGraphicBatch: function (graphicInfos) \r\n  // [{id:12345,sourceId:4t56ew,overlayId:4hgjks8sjr85j}]\r\n\r\n  // We need to drop the first and last \" character.\r\n  payload = payload.substr(1);\r\n  payload = payload.substr(0, payload.length - 1);\r\n  payload = unescape(payload);\r\n  //payload = emp.api.core.formatJSON(payload);\r\n  batch = JSON.parse(payload);\r\n\r\n  for (i = 0; i < batch.graphics.length; i += 1) {\r\n\r\n    // determine if overlayId is a feature or an overlay.\r\n    typeLibraryArgs = {\r\n      featureId: batch.graphics[i].id\r\n    };\r\n\r\n    if (emp.api.core._featureHash[batch.graphics[i].overlayId]) {\r\n      typeLibraryArgs.overlayId = emp.api.core._featureHash[batch.graphics[i].overlayId].overlayId;\r\n      typeLibraryArgs.parentId = batch.graphics[i].overlayId;\r\n    } else {\r\n      typeLibraryArgs.overlayId = batch.graphics[i].overlayId;\r\n    }\r\n\r\n    payloads.push(typeLibraryArgs);\r\n  }\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_REMOVE, payloads);\r\n};\r\n\r\nemp.api.core.removeWMS = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    payloads = [];\r\n\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n\r\n  typeLibraryArgs = {\r\n    overlayId: emp.wms.manager.getWmsOverlayId(),\r\n    id: payload,\r\n    coreId: payload\r\n  };\r\n\r\n  //emp.api.core.addParent(typeLibraryArgs, emp.wms.manager.getWmsOverlayId());\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"WMS\", emp.intents.control.WMS_REMOVE, payloads);\r\n};\r\n\r\nemp.api.core.removeUrl = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    payloads = [];\r\n\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n\r\n  typeLibraryArgs = {\r\n    coreId: payload,\r\n    overlayId: emp.api.core.getOverlayId(payload),\r\n    featureId: payload\r\n  };\r\n\r\n  //emp.api.core.addParent(typeLibraryArgs, emp.api.core.getOverlayId(payload));\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.WMS_REMOVE, payloads);\r\n};\r\n\r\nemp.api.core.addKml = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [],\r\n    mapInstance = emp.instanceManager.getInstance(sender.id);\r\n  // addKml: function (url, name)\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    coreId: args[0],\r\n    featureId: args[0],\r\n    name: args[1],\r\n    url: args[0],\r\n    format: 'kml',\r\n    v1type: emp.api.core.DataType.UNKNOWN\r\n  };\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, mapInstance.engines.getDefaultLayerOverlayID());\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addImageOverlay = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  //addImageOverlay: function (url, left, bottom, right, top) \r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    featureId: args[0],\r\n    name: 'Image',\r\n    format: 'image',\r\n    url: args[0],\r\n    params: {\r\n      left: args[1],\r\n      bottom: args[2],\r\n      right: args[3],\r\n      top: args[4]\r\n    },\r\n    v1type: emp.api.core.DataType.UNKNOWN\r\n  };\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, emp.wms.manager.getWmsOverlayId());\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nemp.api.core.addKmlFromString = function(sender, payload) {\r\n\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // addKmlFromString: function (kmlString, name, id)\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    featureId: args[2],\r\n    name: args[1],\r\n    feature: args[0],\r\n    format: 'kml',\r\n    v1type: emp.api.core.DataType.UNKNOWN\r\n  };\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"Feature\", emp.intents.control.FEATURE_ADD, payloads);\r\n};\r\n\r\nvar iWMSCount = 1;\r\nemp.api.core.addWms = function(sender, payload) {\r\n  // addWms: function (url)\r\n  var typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n\r\n  typeLibraryArgs = {\r\n    id: payload,\r\n    coreId: payload,\r\n    name: 'V1 WMS Service ' + iWMSCount,\r\n    url: payload,\r\n    format: 'wms',\r\n    v1type: emp.api.core.DataType.UNKNOWN\r\n  };\r\n\r\n  iWMSCount++;\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, emp.wms.manager.getWmsOverlayId());\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"WMS\", emp.intents.control.WMS_ADD, payloads);\r\n};\r\n\r\nemp.api.core.editFeature = function(sender, payload) {\r\n  // editGraphic: function (editCompleteCallback, id, sourceId, overlayId)\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n  emp.api.core.decodeParameters(args);\r\n\r\n  typeLibraryArgs = {\r\n    featureId: args[0]\r\n  };\r\n\r\n  if (emp.api.core._featureHash[args[2]]) {\r\n    typeLibraryArgs.overlayId = emp.api.core._featureHash[args[2]].overlayId;\r\n    typeLibraryArgs.parentId = args[2];\r\n  } else {\r\n    typeLibraryArgs.overlayId = args[2];\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n\r\n  emp.api.core.createTransaction(sender.id, \"Edit\", emp.intents.control.EDIT_BEGIN, payloads);\r\n};\r\n\r\nemp.api.core.gotoLocation = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // goToLocationWithRange: function (lat, lon, range)\r\n  // \r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    location: {\r\n      lat: parseFloat(args[0]),\r\n      lon: parseFloat(args[1])\r\n    }\r\n  };\r\n\r\n  if (args[2]) {\r\n    typeLibraryArgs.zoom = parseFloat(args[2]);\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"View\", emp.intents.control.VIEW_SET, payloads);\r\n};\r\n\r\nemp.api.core.goToLocationWithScale = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n  // goToLocationWithScale: function (lat, lon, scale)\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    location: {\r\n      lat: parseFloat(args[0]),\r\n      lon: parseFloat(args[1])\r\n    }\r\n  };\r\n\r\n  if (args[2]) {\r\n    typeLibraryArgs.zoom = parseFloat(args[2]) * emp.api.core.scaleMultiplier;\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"View\", emp.intents.control.VIEW_SET, payloads);\r\n};\r\n\r\nemp.api.core.setScale = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n\r\n  typeLibraryArgs = {\r\n    range: parseFloat(payload) * emp.api.core.scaleMultiplier\r\n  };\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.createTransaction(sender.id, \"View\", emp.intents.control.VIEW_SET, payloads);\r\n};\r\n\r\nemp.api.core.setView = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // setView: function (view)\r\n  // view = {\r\n  //      latitude,\r\n  //      longitude\r\n  //      altitude,\r\n  //      altitudeMode,\r\n  //      heading,\r\n  //      tilt\r\n  // }\r\n  payload = JSON.parse(payload);\r\n\r\n  typeLibraryArgs = {\r\n    location: {\r\n      lat: payload.latitude,\r\n      lon: payload.longitude\r\n    },\r\n    range: payload.altitude,\r\n    tilt: payload.tilt,\r\n    heading: payload.heading\r\n  };\r\n\r\n  // to do: set altitudeMode, heading, and tilt\r\n  payloads.push(typeLibraryArgs);\r\n\r\n  emp.api.core.createTransaction(sender.id, \"View\", emp.intents.control.VIEW_SET, payloads);\r\n};\r\n\r\nemp.api.core.goToLocationById = function(sender, payload) {\r\n  var typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // goToLocationById: function (id)\r\n  payload = payload.replace(/\\\"/g, '');\r\n\r\n  typeLibraryArgs = {\r\n    featureId: payload,\r\n    overlayId: emp.api.core.getOverlayId(payload)\r\n  };\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"View\", emp.intents.control.VIEW_SET, payloads);\r\n};\r\n\r\nemp.api.core.drawPolygon = function(sender, payload) {\r\n  var payloads = [],\r\n    args,\r\n    typeLibraryArgs;\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    name: args[0],\r\n    featureId: args[1],\r\n    v1type: emp.api.core.DataType.POLYGON,\r\n    type: 'polygon'\r\n  };\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Draw\", emp.intents.control.DRAW_BEGIN, payloads);\r\n};\r\n\r\nemp.api.core.drawLine = function(sender, payload) {\r\n  var args,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n\r\n  typeLibraryArgs = {\r\n    name: args[0],\r\n    featureId: args[1],\r\n    v1type: emp.api.core.DataType.LINE,\r\n    type: 'line'\r\n  };\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Draw\", emp.intents.control.DRAW_BEGIN, payloads);\r\n};\r\n\r\nemp.api.core.drawMil2525Symbol = function(sender, payload) {\r\n  var args,\r\n    sType = emp.api.core.DataType.UNKNOWN,\r\n    typeLibraryArgs,\r\n    payloads = [];\r\n\r\n  // drawMilStdMultipoint: function (drawCompleteCallback, name, id, sourceId, overlayId, symbolCode, modifiers, autoPopulate) {\r\n  payload = payload.replace(/\\\"/g, '');\r\n  args = payload.split(',');\r\n  // var autoPopulate = false;\r\n  // if (args.length === 7 && args[6] === 'true') {\r\n  //   autoPopulate = true;\r\n  // }\r\n\r\n  if (emp.helpers.isAirspaceSymbol(args[4])) {\r\n    sType = emp.api.core.DataType.AIRSPACE;\r\n  } else if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(args[4], 0)) {\r\n    sType = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n  } else {\r\n    sType = emp.api.core.DataType.MIL_STD_SYMBOL;\r\n  }\r\n\r\n\r\n  typeLibraryArgs = {\r\n    name: args[0],\r\n    featureId: args[1],\r\n    symbolCode: args[4],\r\n    v1type: sType,\r\n    type: 'milstd'\r\n  };\r\n\r\n  emp.api.core.addParent(typeLibraryArgs, args[3]);\r\n\r\n  // Check to see if modifiers were added in.  If so, modify the modifiers\r\n  // so they can be sent over.\r\n  if (args[5]) {\r\n    typeLibraryArgs.properties = {};\r\n    typeLibraryArgs.properties.modifiers = emp.api.core.createModifiers(args[5]);\r\n  }\r\n\r\n  payloads.push(typeLibraryArgs);\r\n  emp.api.core.recurseStrFixInbound(payloads);\r\n  emp.api.core.createTransaction(sender.id, \"Draw\", emp.intents.control.DRAW_BEGIN, payloads);\r\n};\r\n\r\n/**\r\n * Formats a JSON string to have quotes around all property names, and replaces nulls\r\n * and undefines with empty strings.\r\n *\r\n * @param  {string} input A string that represents a JSON object.\r\n * @return {string}       The formated string.\r\n */\r\n\r\nemp.api.core.formatJSON = function(input) {\r\n  // Add double qoutes around property names\r\n  var exp = /\\,\\s*([a-zA-Z0-9]*)\\s*\\:/g;\r\n  // Add Double qoutes around first property name\r\n  var exp2 = /\\{\\s*([a-zA-Z0-9]*)\\s*\\:/g;\r\n  // check for null and undefined properties and add double qoutes\r\n  var exp3 = /\\:\\s*(undefined|null)\\s*\\,/g;\r\n\r\n\r\n  input = input.replace(exp, function(match, capture) {\r\n    return ', \"' + capture + '\" : ';\r\n  });\r\n  input = input.replace(exp2, function(match, capture) {\r\n    return '{ \"' + capture + '\" : ';\r\n  });\r\n  input = input.replace(exp3, function(match, capture) {\r\n    return ': \"' + capture + '\" ,';\r\n  });\r\n  return input;\r\n};\r\n\r\n/**\r\n * Takes a coreMapAPI symbology modifiers object and returns\r\n * a CMW-A modifiers object.\r\n * @param  {object} oldModifiers The coreMapAPI modifiers object\r\n * @return {object} a new CMW-A modifiers object.\r\n */\r\n\r\nemp.api.core.createModifiers = function(oldModifiers) {\r\n  var modifiers = {};\r\n  if (oldModifiers !== undefined && oldModifiers !== null) {\r\n\r\n    while (oldModifiers[oldModifiers.length - 1] === '\"') {\r\n      oldModifiers = oldModifiers.substr(0, oldModifiers.length - 1);\r\n    }\r\n\r\n    //console.log(\"Modifier: \" + oldModifiers);\r\n    oldModifiers = JSON.parse(oldModifiers);\r\n\r\n    if (oldModifiers) {\r\n      modifiers = oldModifiers.modifiers;\r\n    } else {\r\n      modifiers = undefined;\r\n    }\r\n\r\n\r\n  } else {\r\n    modifiers = undefined;\r\n  }\r\n\r\n  return modifiers;\r\n};\r\n\r\n/**\r\n * Takes in an array of parameters and runs decodeURIComponent\r\n * on each of the items if it is a string.  Returns the decoded\r\n * array.\r\n *\r\n * @param  {array} array An array of items.\r\n * @return {array} The array with any strings that were encoded decoded\r\n */\r\n\r\nemp.api.core.decodeParameters = function(array) {\r\n  var i;\r\n\r\n  for (i = 0; i < array.length; i++) {\r\n    if (jQuery.type(array[i] === 'string')) {\r\n      array[i] = decodeURIComponent(array[i]);\r\n\r\n      // remove any extra quotes.\r\n      //array[i] = array[i].replace(/\\\"/g, '');\r\n\r\n      // just in case an 'undefined' got in there, convert\r\n      // that back into a real undefined.\r\n      if (array[i] === 'undefined' || array[i] === '\\\"undefined\\\"') {\r\n        array[i] = undefined;\r\n      }\r\n    }\r\n\r\n  }\r\n};\r\n\r\nemp.api.core.strFix = function(args) {\r\n  var sPattern1 = /\\./g;\r\n\r\n  if (sPattern1.test(args)) {\r\n    args = 'FIX_DONE' + args.replace(sPattern1, '-A_PERIOD-');\r\n  }\r\n  return args;\r\n};\r\n\r\nemp.api.core.strDeFix = function(args) {\r\n  var sPattern1 = /^FIX\\x5FDONE/;\r\n  var sPattern2 = /\\x2DA\\x5FPERIOD\\x2D/g;\r\n\r\n  if (sPattern1.test(args)) {\r\n    args = args.replace(sPattern1, '');\r\n\r\n    if (sPattern2.test(args)) {\r\n      args = args.replace(sPattern2, '.');\r\n    }\r\n  }\r\n\r\n  return args;\r\n};\r\n\r\n/**\r\n * Due to CMAPI inconsistances we are going to vary painfully scan\r\n * every payload in and out to make sure all Id's are fixed and unfixed.\r\n *\r\n */\r\n\r\nemp.api.core.recurseStrFixInbound = function(args) {\r\n  /*\r\n      // inbound - cmapi-payload... \r\n      var e;\r\n      //all payloads are arrays... might as well as start there...\r\n      if (typeof (args) === 'array') {\r\n          //cycle array\r\n          for (e = 0; e < args.length; e = e + 1) {\r\n              // is args[e] an object\r\n              if (typeof (args[e]) === 'object') {\r\n                  // now we are getting some where... \r\n                  for (var i in args[e]) {\r\n                      //check to make sure it's a string not another array or object\r\n                      if (typeof (args[e][i]) === 'string') {\r\n\r\n                          if (i === 'overlayId' || i === 'featureId' || i === 'parentId') {\r\n                              args[e][i] = emp.api.core.strFix(args[e][i]);\r\n                          }\r\n\r\n                      } else if (typeof (args[i]) === 'array' || typeof (args[e][i]) === 'object') {\r\n                          // le sigh...\r\n                          args[e][i] = emp.api.core.recurseStrFixInbound(args[e][i]);\r\n                      }\r\n                  }\r\n              } else if (typeof (args[e]) === 'array') {\r\n                  // what has the world come too... \r\n                  args[e] = emp.api.core.recurseStrFixInbound(args);\r\n              }\r\n          }\r\n\r\n      } else if (typeof (args) === 'object') {\r\n\r\n          for (e in args) {\r\n\r\n              if (typeof (args[e]) === 'string') {\r\n\r\n                  if (e === 'overlayId' || e === 'featureId' || e === 'parentId') {\r\n                      args[e] = emp.api.core.strFix(args[e]);\r\n                  }\r\n                  if (e === 'property' && args[e] === 'overlayId') {\r\n                      args.term = emp.api.core.strFix(args.term);\r\n                  } else if (e === 'property' && args[e] === 'featureId') {\r\n                      args.term = emp.api.core.strFix(args.term);\r\n                  } else if (e === 'property' && args[e] === 'parentId') {\r\n                      args.term = emp.api.core.strFix(args.term);\r\n                  }\r\n\r\n              } else if (typeof (args[e]) === 'object' || typeof (args[e] === 'array')) {\r\n\r\n                  args[e] = emp.api.core.recurseStrFixInbound(args[e]);\r\n              }\r\n          }\r\n\r\n      } else {\r\n          // strings or numbers...\r\n          return args;\r\n      }\r\n  */\r\n  return args;\r\n};\r\n\r\nemp.api.core.recurseStrFixOutbound = function(args) {\r\n  /*\r\n      var e;\r\n      //all payloads are arrays... might as well as start there...\r\n      if (typeof (args) === 'array') {\r\n          //cycle array\r\n          for (e = 0; e < args.length; e = e + 1) {\r\n              // is args[e] an object\r\n              if (typeof (args[e]) === 'object') {\r\n                  // now we are getting some where... \r\n                  for (var i in args[e]) {\r\n                      //check to make sure it's a string not another array or object\r\n                      if (typeof (args[e][i]) === 'string') {\r\n\r\n                          if (i === 'overlayId' || i === 'featureId' || i === 'parentId') {\r\n                              args[e][i] = emp.api.core.strDeFix(args[e][i]);\r\n                          }\r\n\r\n                      } else if (typeof (args[i]) === 'array' || typeof (args[e][i]) === 'object') {\r\n                          // le sigh...\r\n                          args[e][i] = emp.api.core.recurseStrFixOutbound(args[e][i]);\r\n                      }\r\n                  }\r\n              } else if (typeof (args[e]) === 'array') {\r\n                  // what has the world come too... \r\n                  args[e] = emp.api.core.recurseStrFixOutbound(args);\r\n              }\r\n          }\r\n\r\n      } else if (typeof (args) === 'object') {\r\n\r\n          for (e in args) {\r\n\r\n              if (typeof (args[e]) === 'string') {\r\n\r\n                  if (e === 'overlayId' || e === 'featureId' || e === 'parentId') {\r\n                      args[e] = emp.api.core.strDeFix(args[e]);\r\n                  }\r\n\r\n              } else if (typeof (args[e]) === 'object' || typeof (args[e] === 'array')) {\r\n\r\n                  args[e] = emp.api.core.recurseStrFixOutbound(args[e]);\r\n              }\r\n          }\r\n\r\n      } else if (typeof (args) === 'string') {\r\n          args = emp.api.core.strDeFix(args);\r\n      }\r\n  */\r\n  return args;\r\n};\r\n\r\n\r\n\r\n/**\r\n * Takes modifiers from coreMapAPI and populates the properties\r\n * object of the Type Library.\r\n *\r\n * @param {object} oldModifiers A coreMapAPI modifiers object\r\n * @param {object} properties A EMP TypeLibrary properties object.\r\n * @return {object} The new properties object.  emp.api.core function also modifies the original\r\n * properties object.\r\n */\r\n\r\nemp.api.core.addCoreModifiersToProperties = function(oldModifiers, properties) {\r\n\r\n  //xOffset, yOffset, xUnits, and yUnits\r\n  if (oldModifiers.xOffset !== undefined) {\r\n    properties.xOffset = oldModifiers.xOffset;\r\n  }\r\n\r\n  if (oldModifiers.yOffset !== undefined) {\r\n    properties.yOffset = oldModifiers.yOffset;\r\n  }\r\n\r\n  if (oldModifiers.xUnits) {\r\n    properties.xUnits = oldModifiers.xUnits;\r\n  }\r\n\r\n  if (oldModifiers.yUnits) {\r\n    properties.yUnits = oldModifiers.yUnits;\r\n  }\r\n\r\n  return properties;\r\n\r\n};\r\n\r\nemp.api.core.createMilStdPointParams = function(args) {\r\n  var modifiers,\r\n    typeLibraryArgs = {\r\n      name: args.name,\r\n      featureId: args.id,\r\n      data: {\r\n        type: \"Point\",\r\n        coordinates: [args.lon, args.lat],\r\n        symbolCode: args.symbolCode\r\n      },\r\n      format: 'milstd',\r\n      type: emp.api.core.DataType.MIL_STD_SYMBOL\r\n    };\r\n\r\n  // if there is an altitude, add it on to the end of the coordinates.\r\n  if (args.altitude) {\r\n    typeLibraryArgs.data.coordinates.push(args.altitude);\r\n  }\r\n\r\n  if (args.modifiers || args.description) {\r\n\r\n    typeLibraryArgs.properties = {};\r\n\r\n    // If there are modifiers, abstract them, unescape and parse them.\r\n    if (args.modifiers) {\r\n\r\n      modifiers = emp.api.core.createModifiers(args.modifiers);\r\n\r\n      if (modifiers) {\r\n        typeLibraryArgs.properties.modifiers = modifiers;\r\n      }\r\n\r\n      if (modifiers.fillColor) {\r\n        var sColor = modifiers.fillColor.substr(2);\r\n        typeLibraryArgs.properties.fillColor = sColor;\r\n        sColor = modifiers.fillColor.substr(0, 2);\r\n        typeLibraryArgs.properties.fillOpacity = parseInt(\"0x\" + sColor) / 255;\r\n      }\r\n    }\r\n\r\n    if (args.description) {\r\n      typeLibraryArgs.properties.description = args.description;\r\n    }\r\n\r\n  }\r\n\r\n  return typeLibraryArgs;\r\n\r\n};\r\n\r\nemp.api.core.createMilStdMultiPointParams = function(args) {\r\n  var coordinates = [],\r\n    coordinatesStringArray,\r\n    coordinateComponents,\r\n    coordinate,\r\n    typeLibraryArgs = {\r\n      name: args.name,\r\n      featureId: args.id,\r\n      overlayId: args.overlayId,\r\n      data: {\r\n        symbolCode: args.symbolCode\r\n      },\r\n      format: args.format || 'milstd',\r\n      properties: args.properties || {},\r\n      type: emp.api.core.DataType.MIL_STD_MULTI_POINT\r\n    };\r\n\r\n  if (args.description || args.modifiers) {\r\n\r\n    if (args.description) {\r\n      typeLibraryArgs.properties.description = args.description;\r\n    }\r\n\r\n    // If there are modifiers, abstract them, unescape and parse them.\r\n    if (args.modifiers) {\r\n      typeLibraryArgs.properties.modifiers = emp.api.core.createModifiers(args.modifiers);\r\n    }\r\n  }\r\n\r\n  // Create the geojson string used for the mil-std symbol.\r\n  if (args.coordinates) {\r\n\r\n    // Separate the coordinates into individual coordinates\r\n    coordinatesStringArray = args.coordinates.split(' ');\r\n\r\n    // loop through each coordinate to create an array of arrays.  emp.api.core is the\r\n    // standard format for linestring in geojson.\r\n    for (var iIndex = 0; iIndex < coordinatesStringArray.length; iIndex++) {\r\n      coordinateComponents = coordinatesStringArray[iIndex].split(',');\r\n\r\n      if (coordinateComponents.length >= 2) {\r\n        coordinate = new Array();\r\n\r\n        // add the lon and lat components.\r\n        coordinate.push(parseFloat(coordinateComponents[0]));\r\n        coordinate.push(parseFloat(coordinateComponents[1]));\r\n\r\n        // if there is an altitude component add it.\r\n        if (coordinateComponents >= 3) {\r\n          coordinate.push(parseFloat(coordinateComponents[2]));\r\n        }\r\n\r\n        coordinates.push(coordinate);\r\n      }\r\n    }\r\n\r\n    if (coordinates.length === 1) {\r\n      typeLibraryArgs.data.coordinates = coordinate;\r\n      typeLibraryArgs.data.type = \"Point\";\r\n    } else {\r\n      typeLibraryArgs.data.coordinates = coordinates;\r\n      typeLibraryArgs.data.type = \"LineString\";\r\n    }\r\n  }\r\n  return typeLibraryArgs;\r\n};\r\n\r\n/**\r\n * Create a KML Point.\r\n *\r\n * @param {string} args.name            The name given to the kml\r\n * @param  {number} args.latitude       The latitude of the point\r\n * @param  {number} args.longitude      The longitude of the point\r\n * @param {number} args.altitude        The altitude of the point\r\n * @param {string} args.iconUrl      The icon that should show for this point\r\n *\r\n * @return {string}                The kml that makes up emp.api.core object.\r\n */\r\n\r\nemp.api.core.getPointKml = function(args) {\r\n  var hotSpotX = 32,\r\n    hotSpotY = 1,\r\n    xUnits = 'pixels',\r\n    yUnits = 'pixels',\r\n    iconUrl = 'http://maps.google.com/mapfiles/kml/paddle/wht-blank.png',\r\n    kmlString;\r\n\r\n  if (args.hasOwnProperty('modifiers')) {\r\n    if (args.modifiers.hasOwnProperty('xOffset')) {\r\n      hotSpotX = args.modifiers.xOffset;\r\n    }\r\n    if (args.modifiers.hasOwnProperty('yOffset')) {\r\n      hotSpotY = args.modifiers.yOffset;\r\n    }\r\n  }\r\n\r\n  kmlString = '<Placemark>' +\r\n    '<name>' + args.name + '</name>' +\r\n    '<Style>' + '<IconStyle>' +\r\n    '<Icon>';\r\n\r\n  if (args.iconUrl) {\r\n    kmlString += '<href>' + args.iconUrl + '</href>';\r\n  } else {\r\n    kmlString += '<href>' + iconUrl + '</href>';\r\n  }\r\n\r\n  kmlString += '</Icon>';\r\n\r\n  kmlString += '<hotSpot x=\"' + hotSpotX + '\" y=\"' + hotSpotY + '\" xunits=\"' + xUnits + '\" yunits=\"' + yUnits + '\"/>';\r\n\r\n  kmlString += '</IconStyle>' +\r\n    '</Style>' +\r\n    '<Point>' +\r\n    '<coordinates>' + args.lon + ',' + args.lat;\r\n\r\n  if (args.altitude !== undefined) {\r\n    kmlString += ',' + args.altitude;\r\n  }\r\n\r\n  kmlString += '</coordinates>' +\r\n    '</Point>' +\r\n    '</Placemark>';\r\n\r\n  return kmlString;\r\n};\r\n\r\n/**\r\n * Create a KML LineString.\r\n *\r\n * @param {object} args Contains the parameter for emp.api.core function\r\n * @param {string} args.name            The name given to the kml\r\n * @param  {number} args.coordinate     A KML formated coordinate string.\r\n *\r\n * @return {string}                The kml that makes up emp.api.core object.\r\n */\r\n\r\nemp.api.core.getLineKml = function(args) {\r\n  var kmlString;\r\n\r\n  kmlString = '<Placemark>' +\r\n    '<name>' + args.name + '</name>' +\r\n    '<LineString>' +\r\n    '<coordinates>' + args.coordinates + '</coordinates>' +\r\n    '</LineString>' +\r\n    '</Placemark>';\r\n\r\n  return kmlString;\r\n};\r\n\r\n/**\r\n * Create a KML Polygon\r\n * @param  {object} args Contains the parameters for emp.api.core function\r\n * @return {string} The kml that makes up emp.api.core object.\r\n */\r\n\r\nemp.api.core.getPolygonKml = function(args) {\r\n\r\n  var kmlString,\r\n    firstCoordinate;\r\n\r\n  firstCoordinate = args.coordinates.substr(0, args.coordinates.indexOf(' '));\r\n\r\n  kmlString = '<Placemark>' +\r\n    '<name>' + args.name + '</name>' +\r\n\r\n    '<Polygon>' +\r\n    '<outerBoundaryIs>' +\r\n    '<LinearRing>' +\r\n    '<coordinates>' + args.coordinates + ' ' + firstCoordinate + '</coordinates>' +\r\n    '</LinearRing>' +\r\n    '</outerBoundaryIs>' +\r\n    '</Polygon>' +\r\n    '</Placemark>';\r\n\r\n  return kmlString;\r\n};\r\n\r\n\r\nemp.api.core.handleMessage = function(sender, msg) {\r\n  var functionName,\r\n    payload;\r\n\r\n  functionName = msg.substring(0, msg.indexOf('('));\r\n  payload = msg.substring(msg.indexOf('(') + 1, msg.lastIndexOf(')'));\r\n  sender = JSON.parse(sender);\r\n\r\n\r\n  emp.api.core._callbackHash[functionName](sender, payload);\r\n\r\n};\r\n\r\nemp.api.core.splitArgs = function(payload) {\r\n  var args = payload.match(/(\".*?\"|[^\",\\s]+)(?=\\s*,|\\s*$)/g),\r\n    len = args.length,\r\n    i;\r\n\r\n  for (i = 0; i < len; i++) {\r\n    args[i] = args[i].replace(/\\\"/g, \"\");\r\n  }\r\n  return args;\r\n};\r\n\r\n/**\r\n * Creates a transaction for each request to the core library.  Core library\r\n * only comes in through one channel, so there was no way to identify based\r\n * on the channel what type to convert to.   Instead, we convert each payload\r\n * into a cmw-a payload, and submit it to the cmw-a fixture to generate the\r\n * correct object from the type library.  emp.api.core will then send to the queue\r\n * @param  {string} channel  The channel name that would be used for an\r\n * equivalent cmw-a request.\r\n * @param  {string} senderId The id of the widget that sent the request.\r\n * @param  {array} payloads An array of payload objects that correspond to the\r\n * correct format of the channel\r\n */\r\nemp.api.core.createTransaction = function(senderId, sGlobalType, sIntent, payloads) {\r\n  var transaction,\r\n    i,\r\n    oItems = [],\r\n    oItem,\r\n    sTransID = emp.helpers.id.newGUID();\r\n\r\n\r\n  for (i = 0; i < payloads.length; i += 1) {\r\n    //payloads[i].transactionId = sTransID;\r\n    //payloads[i].sender = senderId;\r\n\r\n    payloads[i].intent = sIntent;\r\n    //payloads[i].source = emp.api.core.SOURCE;\r\n    oItem = new emp.typeLibrary[sGlobalType](payloads[i]);\r\n\r\n    switch (sIntent) {\r\n      case emp.intents.control.DRAW_BEGIN:\r\n      case emp.intents.control.FEATURE_ADD:\r\n        oItem.v1Type = payloads[i].v1type;\r\n        break;\r\n    }\r\n    oItems.push(oItem);\r\n  }\r\n\r\n  transaction = new emp.typeLibrary.Transaction({\r\n    intent: sIntent,\r\n    transactionId: sTransID,\r\n    sender: senderId,\r\n    source: emp.api.core.SOURCE,\r\n    items: oItems\r\n  });\r\n\r\n  emp.api.core.transactionQueue.add(transaction);\r\n};\r\n\r\nemp.api.core._callbackHash = {\r\n  addMilStdPointBatch: emp.api.core.addMilStdPointBatch,\r\n  addMilStdPoint: emp.api.core.addMilStdPoint,\r\n  addMilStdMultiPointBatch: emp.api.core.addMilStdMultiPointBatch,\r\n  addMilStdSymbol: emp.api.core.addMilStdSymbol,\r\n  addEffort: emp.api.core.addEffort,\r\n  removeEffort: emp.api.core.removeEffort,\r\n  addKmlStringToOverlay: emp.api.core.addKmlStringToOverlay,\r\n  addPoint: emp.api.core.addPoint,\r\n  addPointBatch: emp.api.core.addPointBatch,\r\n  addLine: emp.api.core.addLine,\r\n  add3DShape: emp.api.core.add3DShape,\r\n  addPolygon: emp.api.core.addPolygon,\r\n  addImageOverlay: emp.api.core.addImageOverlay,\r\n  removeImageOverlay: emp.api.core.removeUrl,\r\n  removeKml: emp.api.core.removeUrl,\r\n  removeWms: emp.api.core.removeWMS,\r\n  goToLocationWithRange: emp.api.core.gotoLocation,\r\n  goToLocation: emp.api.core.gotoLocation,\r\n  goToLocationWithScale: emp.api.core.goToLocationWithScale,\r\n  setScale: emp.api.core.setScale,\r\n  addKml: emp.api.core.addKml,\r\n  addKmlFromString: emp.api.core.addKmlFromString,\r\n  addWms: emp.api.core.addWms,\r\n  setVisibilityBatch: emp.api.core.setVisibilityBatch,\r\n  goToLocationById: emp.api.core.goToLocationById,\r\n  editFeature: emp.api.core.editFeature,\r\n  drawPolygon: emp.api.core.drawPolygon,\r\n  drawLine: emp.api.core.drawLine,\r\n  drawMil2525Symbol: emp.api.core.drawMil2525Symbol,\r\n  removeGraphicBatch: emp.api.core.removeGraphicBatch,\r\n  removeGraphic: emp.api.core.removeGraphic,\r\n  setView: emp.api.core.setView\r\n};\r\n","/* globals emp */\r\n\r\nemp.api.core.publish = function (args) {\r\n    var channel,\r\n        payload;\r\n    var button,\r\n        ctrlKey = false,\r\n        shiftKey = false,\r\n        altKey = false,\r\n        i,\r\n        index,\r\n        lon,\r\n        lat,\r\n        type,\r\n        dataType,\r\n        oItem,\r\n        oFeature;\r\n    var eventData = {};\r\n\r\n    var getKMLCoordinateString = function(sKML) {\r\n        var sStrCoordinate = \"\";\r\n        var oKMLDoc = emp.util.parseXML(sKML);\r\n        emp.util.each(oKMLDoc.getElementsByTagName(\"coordinates\"), function (node) {\r\n            if (sStrCoordinate.length > 0) {\r\n                sStrCoordinate += \" \";\r\n            }\r\n            sStrCoordinate += node.childNodes[0].nodeValue;\r\n        });\r\n\r\n        return sStrCoordinate;\r\n    };\r\n\r\n    if (args) {\r\n        if (args.items && args.items.length > 0) {\r\n\r\n            oItem = args.items[0];\r\n\r\n            switch (args.intent)\r\n            {\r\n                case emp.intents.control.VIEW_CHANGE:\r\n                    channel = emp.api.core.channel.names.MAP_EVENT;\r\n\r\n                    payload = {\r\n                        type: emp.api.core.EventType.MAP_MOVE,\r\n                        eventData: {\r\n                            lat: args.items[0].location.lat,\r\n                            lon: args.items[0].location.lon,\r\n                            altitude: args.items[0].range,\r\n                            scale: args.items[0].range / emp.api.core.scaleMultiplier,\r\n                            left: args.items[0].bounds.west,\r\n                            bottom: args.items[0].bounds.south,\r\n                            right: args.items[0].bounds.east,\r\n                            top: args.items[0].bounds.north\r\n                        }\r\n\r\n                    };\r\n                    break;\r\n                case emp.intents.control.STATUS_CHANGE:\r\n                    channel = emp.api.core.channel.names.MAP_EVENT;\r\n\r\n                    if (args.items[0].status === 'ready') {\r\n                        payload = {\r\n                            type: emp.api.core.EventType.MAP_READY,\r\n                            eventData: {\r\n                                lat: undefined,\r\n                                lon: undefined,\r\n                                altitude: undefined,\r\n                                scale: undefined,\r\n                                left: undefined,\r\n                                bottom: undefined,\r\n                                right: undefined,\r\n                                top: undefined\r\n                            }\r\n                        };\r\n                    }\r\n                    break;\r\n                case emp.intents.control.FEATURE_CLICK:\r\n                    channel = emp.api.core.channel.names.GRAPHIC_EVENT;\r\n\r\n                    if (oItem.type === 'single') {\r\n                        type = emp.api.core.EventType.GRAPHIC_CLICK;\r\n                    } else if (oItem.type === 'double') {\r\n                        type = emp.api.core.EventType.GRAPHIC_DBL_CLICK;\r\n                    }\r\n                    else\r\n                    {\r\n                        // ignore all other types.\r\n                        return;\r\n                    }\r\n\r\n                    switch (oItem.button) {\r\n                    case 'left':\r\n                        button = 0;\r\n                        break;\r\n                    case 'middle':\r\n                        button = 1;\r\n                        break;\r\n                    case 'right':\r\n                        button = 2;\r\n                        break;\r\n                    }\r\n\r\n                    for (i = 0; i < oItem.keys.length; i += 1) {\r\n                        if (oItem.keys[i] === 'ctrl') {\r\n                            ctrlKey = true;\r\n                        } else if (oItem.keys[i] === 'shift') {\r\n                            shiftKey = true;\r\n                        } else if (oItem.keys[i] === 'alt') {\r\n                            altKey = true;\r\n                        }\r\n                    }\r\n\r\n                    oFeature = emp.storage.findFeature(oItem.overlayId, oItem.featureId);\r\n\r\n                    payload = {\r\n                        type: type,\r\n                        eventData: {\r\n                            id: oItem.featureId,\r\n                            overlayId: oItem.overlayId,\r\n                            name: oItem.name,\r\n                            lat: oItem.lat,\r\n                            lon: oItem.lon,\r\n                            mgrs: oItem.mgrs,\r\n                            altitude: oItem.elevation,\r\n                            button: button,\r\n                            clientX: oItem.clientX,\r\n                            clientY: oItem.clientY,\r\n                            screenX: oItem.screenX,\r\n                            screenY: oItem.screenY,\r\n                            altKey: altKey,\r\n                            ctrlKey: ctrlKey,\r\n                            shiftKey: shiftKey\r\n                        }\r\n                    };\r\n\r\n                    if (oFeature)\r\n                    {\r\n                        switch (oFeature.v1Type)\r\n                        {\r\n                            case emp.api.core.DataType.MIL_STD_SYMBOL:\r\n                                payload.eventData.dataType = \"milStdPoint\";\r\n                                payload.eventData.symbolCode = oFeature.data.symbolCode;\r\n                                payload.eventData.coordinates = emp.helpers.coordinatesToString(oFeature.data);\r\n                                break;\r\n                            case emp.api.core.DataType.POINT:\r\n                                payload.eventData.dataType = emp.api.core.DataType.POINT;\r\n                                payload.eventData.coordinates = getKMLCoordinateString(oFeature.data);\r\n                                break;\r\n                            case emp.api.core.DataType.LINE:\r\n                                payload.eventData.dataType = emp.api.core.DataType.LINE;\r\n                                payload.eventData.coordinates = getKMLCoordinateString(oFeature.data);\r\n                                break;\r\n                            case emp.api.core.DataType.POLYGON:\r\n                                payload.eventData.dataType = emp.api.core.DataType.POLYGON;\r\n\r\n                                // Get the string and remove the last coordinate.\r\n                                var sStrCoord = getKMLCoordinateString(oFeature.data);\r\n                                payload.eventData.coordinates = sStrCoord.slice(0, sStrCoord.lastIndexOf(' '));\r\n                                break;\r\n                            case emp.api.core.DataType.MIL_STD_MULTI_POINT:\r\n                                payload.eventData.dataType = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n                                payload.eventData.symbolCode = oFeature.data.symbolCode;\r\n                                payload.eventData.coordinates = emp.helpers.coordinatesToString(oFeature.data);\r\n                                break;\r\n                            case emp.api.core.DataType.AIRSPACE:\r\n                                payload.eventData.dataType = emp.api.core.DataType.AIRSPACE;\r\n                                payload.eventData.symbolCode = oFeature.data.symbolCode;\r\n                                payload.eventData.coordinates = emp.helpers.coordinatesToString(oFeature.data);\r\n                                break;\r\n                        }\r\n                    }\r\n                    break;\r\n                case emp.intents.control.CLICK:\r\n                    channel = emp.api.core.channel.names.MAP_EVENT;\r\n\r\n                    if (args.items[0].type === 'single') {\r\n                        type = emp.api.core.EventType.MAP_CLICKED;\r\n                    } else if (args.items[0].type === 'double') {\r\n                        type = emp.api.core.EventType.MAP_DBL_CLICKED;\r\n                    }\r\n                    else\r\n                    {\r\n                        // ignore all other types.\r\n                        return;\r\n                    }\r\n\r\n                    switch (args.items[0].button) {\r\n                    case 'left':\r\n                        button = 0;\r\n                        break;\r\n                    case 'middle':\r\n                        button = 1;\r\n                        break;\r\n                    case 'right':\r\n                        button = 2;\r\n                        break;\r\n                    }\r\n\r\n                    for (i = 0; i < args.items[0].keys.length; i += 1) {\r\n                        if (args.items[0].keys[i] === 'ctrl') {\r\n                            ctrlKey = true;\r\n                        } else if (args.items[0].keys[i] === 'shift') {\r\n                            shiftKey = true;\r\n                        } else if (args.items[0].keys[i] === 'alt') {\r\n                            altKey = true;\r\n                        }\r\n                    }\r\n\r\n                    payload = {\r\n                        type: type,\r\n                        eventData: {\r\n                            lat: args.items[0].lat,\r\n                            lon: args.items[0].lon,\r\n                            mgrs: args.items[0].mgrs,\r\n                            altitude: args.items[0].elevation,\r\n                            button: button,\r\n                            clientX: args.items[0].clientX,\r\n                            clientY: args.items[0].clientY,\r\n                            screenX: args.items[0].screenX,\r\n                            screenY: args.items[0].screenY,\r\n                            // hitGlobe: '',  Don't have a current equivalent to this.\r\n                            altKey: altKey,\r\n                            ctrlKey: ctrlKey,\r\n                            shiftKey: shiftKey\r\n                        }\r\n                    };\r\n                    break;\r\n                case emp.intents.control.DRAW_UPDATE:\r\n                case emp.intents.control.EDIT_UPDATE:\r\n                    channel = emp.api.core.channel.names.GRAPHICS_DRAW_EVENT;\r\n                    oFeature = args.items[0];\r\n\r\n                    if (args.intent === emp.intents.control.EDIT_UPDATE)\r\n                    {\r\n                        channel = emp.api.core.channel.names.GRAPHIC_EVENT;\r\n                    }\r\n\r\n                    switch (oFeature.v1Type)\r\n                    {\r\n                        case emp.api.core.DataType.UNKNOWN:\r\n                        case undefined:\r\n                            switch (oFeature.format)\r\n                            {                                \r\n                                case emp.typeLibrary.featureFormatType.IMAGE:\r\n                                    // This shouldn't happen.\r\n                                    break;\r\n                                case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:\r\n                                    {\r\n                                        var iStdVersion = emp.typeLibrary.featureMilStdVersionType.convertToNumeric(oFeature.properties.standard);\r\n\r\n                                        if (armyc2.c2sd.renderer.utilities.SymbolDefTable.isMultiPoint(oFeature.data.symbolCode, iStdVersion))\r\n                                        {\r\n                                            dataType = emp.api.core.DataType.MIL_STD_MULTI_POINT;\r\n                                        }\r\n                                        else\r\n                                        {\r\n                                            dataType = emp.api.core.DataType.MIL_STD_SYMBOL;\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                case emp3.api.enums.FeatureTypeEnum.GEO_ACM:\r\n                                    dataType = emp.api.core.DataType.AIRSPACE;\r\n                                    break;\r\n                                case emp.typeLibrary.featureFormatType.GEOJSON:\r\n                                case emp.typeLibrary.featureFormatType.KML:\r\n                                    switch (oFeature.data.type)\r\n                                    {\r\n                                        case \"Point\":\r\n                                            dataType = emp.api.core.DataType.POINT;\r\n                                            break;\r\n                                        case \"LineString\":\r\n                                            dataType = emp.api.core.DataType.LINE;\r\n                                            break;\r\n                                        case \"Polygon\":\r\n                                            dataType = emp.api.core.DataType.POLYGON;\r\n                                            break;\r\n                                    }\r\n                                    break;\r\n                            }\r\n                            break;\r\n                        default:\r\n                            dataType = oFeature.v1Type;\r\n                            break;\r\n                    }\r\n\r\n                    if (oFeature.updates &&\r\n                            oFeature.updates.indices &&\r\n                            (oFeature.updates.indices.length > 0))\r\n                    {\r\n                        index = oFeature.updates.indices[0];\r\n                        lon = oFeature.updates.coordinates[0].lon;\r\n                        lat = oFeature.updates.coordinates[0].lat;\r\n                    }\r\n                    else\r\n                    {\r\n                        index = -1;\r\n                        lon = 0.0;\r\n                        lat = 0.0;\r\n                    }\r\n\r\n                    eventData = {\r\n                        isComplete: oFeature.complete,\r\n                        dataType: dataType,\r\n                        description: oFeature.description,\r\n                        id: oFeature.featureId,\r\n                        name: oFeature.name,\r\n                        coordinates: emp.helpers.coordinatesToString(oFeature.data),\r\n                        index: index,\r\n                        lat: lat,\r\n                        lon: lon\r\n                    };\r\n\r\n                    payload = {\r\n                            type: (oFeature.complete? emp.api.core.EventType.DRAW_COMPLETE:\r\n                                emp.api.core.EventType.GRAPHIC_UPDATE),\r\n                            eventData: eventData\r\n                        };\r\n                    break;\r\n            }\r\n\r\n            if ((channel !== undefined) && (payload !== undefined))\r\n            {\r\n                emp.environment.get().pubSub.publish({\r\n                            message: payload,\r\n                            channel: channel\r\n                        });\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n\r\n\r\n/*\r\n\r\npublishMessage: function (message) {\r\n            if (_isOzoneInitialized) {\r\n                this.widgetEventingController.publish('BcwMapBrokerChannel', message);\r\n            }\r\n        },\r\n        publishMapEvent: function (eventMessage) {\r\n            if (_isOzoneInitialized) {\r\n                widgetEventingController.publish('core.api.map.eventing', eventMessage);\r\n            }\r\n        },\r\n        publishDataEvent: function (eventMessage) {\r\n            var oldEvent = JSON.parse(eventMessage),\r\n                newEvent = {},\r\n                coordinateString = '',\r\n                i;\r\n\r\n            if (_isOzoneInitialized) {\r\n\r\n                // We need to convert these messages types back to v1 language.\r\n                if (oldEvent.type === 'graphicUpdate' ||\r\n                    oldEvent.type === 'graphicTempUpdate') {\r\n\r\n                    // Create a coordinate string for this event.\r\n                    for (i = 0; i < oldEvent.eventData.updates.coordinates.length; i += 1) {\r\n                        coordinateString += oldEvent.eventData.updates.coordinates[i].lon + ',' +\r\n                            oldEvent.eventData.updates.coordinates[i].lat;\r\n\r\n                        if (oldEvent.eventData.updates.coordinates[i].alt !== undefined) {\r\n                            coordinateString += ',' + oldEvent.eventData.updates.coordinates[i].alt + ' ';\r\n                        } else {\r\n                            coordinateString += ' ';\r\n                        }\r\n                    }\r\n\r\n\r\n                    newEvent = {\r\n                        type: 'graphicUpdate',\r\n                        eventData: {\r\n                            isComplete: (oldEvent.type === 'graphicUpdate') ? true : false,\r\n                            dataType: oldEvent.eventData.dataType,\r\n                            description: oldEvent.eventData.description,\r\n                            id: oldEvent.eventData.featureId,\r\n                            name: oldEvent.eventData.name,\r\n                            coordinates: coordinateString\r\n                        }\r\n                    };\r\n\r\n                    if (oldEvent.eventData.updates.indices) {\r\n                        newEvent.eventData.index = oldEvent.eventData.updates.indices[0];\r\n                    }\r\n\r\n                    eventMessage = JSON.stringify(newEvent);\r\n                }\r\n\r\n                widgetEventingController.publish('core.api.graphics.eventing',\r\n                    eventMessage);\r\n            }\r\n        },\r\n        publishDrawEvent: function (eventMessage) {\r\n\r\n            var oldEvent = JSON.parse(eventMessage),\r\n                newEvent = {},\r\n                coordinateString = '',\r\n                i;\r\n\r\n\r\n            // we need to parse the message so it's back in v1 language.\r\n            if (oldEvent.type === 'drawComplete') {\r\n\r\n                // Create a coordinate string for this event.\r\n                for (i = 0; i < oldEvent.eventData.updates.coordinates.length; i += 1) {\r\n                    coordinateString += oldEvent.eventData.updates.coordinates[i].lon + ',' +\r\n                        oldEvent.eventData.updates.coordinates[i].lat;\r\n\r\n                    if (oldEvent.eventData.updates.coordinates[i].alt !== undefined) {\r\n                        coordinateString += ',' + oldEvent.eventData.updates.coordinates[i].alt + ' ';\r\n                    } else {\r\n                        coordinateString += ' ';\r\n                    }\r\n                }\r\n\r\n                newEvent = {\r\n                    type: oldEvent.type,\r\n                    eventData: {\r\n                        dataType: oldEvent.eventData.dataType,\r\n                        id: oldEvent.eventData.featureId,\r\n                        overlayId: oldEvent.eventData.overlayId,\r\n                        name: oldEvent.eventData.name,\r\n                        coordinates: coordinateString\r\n                    }\r\n                };\r\n\r\n                eventMessage = JSON.stringify(newEvent);\r\n\r\n                if (_isOzoneInitialized) {\r\n                    widgetEventingController.publish('core.api.graphics.drawing',\r\n                        eventMessage);\r\n                }\r\n            }\r\n        },\r\n\r\n        */\r\n","/*global armyc2, cmapi */\r\nvar emp = window.emp || {};\r\n\r\n/**\r\n * @private\r\n * @class\r\n * Map instance manager\r\n */\r\nemp.instanceManager = (function () {\r\n  var bInitialLoadInProgress = false,\r\n    bMapSwapInProgress = false,\r\n    oPendingMapInstanceCreateList = [],\r\n    instances = {},\r\n    oRegisteredMapEngines = {},\r\n    cmapiInterface = emp.api.cmapiInterface(),\r\n    hCheckPendingTimer;\r\n\r\n  var initialize = function (args) {\r\n    var environment = args.environment,\r\n      clientCallback = args.callback,\r\n      clientShutdownCB = args.shutdownCallback,\r\n      map = args.map,\r\n      readyCallback = function () {\r\n\r\n        cmapiInterface.createMapInstance({\r\n          mapInstanceId: map.mapInstanceId\r\n        });\r\n        if (clientCallback) {\r\n          clientCallback(map.mapInstanceId);\r\n        }\r\n      },\r\n      shutdownCallback = function () {\r\n        var payload = {\r\n          status: emp.map.states.TEARDOWN\r\n        };\r\n        var oTransaction = new emp.typeLibrary.Transaction({\r\n          mapInstanceId: map.instanceId,\r\n          intent: emp.intents.control.STATUS_RESPONSE_INIT,\r\n          source: emp.core.sources.CORE,\r\n          items: [payload]\r\n        });\r\n        oTransaction.run();\r\n        if (clientShutdownCB) {\r\n          clientShutdownCB();\r\n        }\r\n      };\r\n\r\n    if (args) {\r\n      // These three may not be needed anymore. The original config\r\n      // parameters in the emp.util.config.js did not have these listed\r\n      if (args.hasOwnProperty(\"relayPath\")) {\r\n        emp.environment.owf.properties.rpcRelayPath = args.rpcRelayPath;\r\n      }\r\n      if (args.hasOwnProperty(\"logLevel\")) {\r\n        emp.errorHandler.set(args.logLevel);\r\n      }\r\n      if (args.hasOwnProperty(\"validate\")) {\r\n        if (args.validate === true) {\r\n          emp.validate = true;\r\n        } else if (args.validate === false) {\r\n          emp.validate = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    emp.environment.setCallbacks(readyCallback, shutdownCallback);\r\n    if (environment !== emp.environment.browser) {\r\n      emp.environment.set({\r\n        environments: [environment, emp.environment.browser],\r\n        mapInstanceId: args.map.mapInstanceId,\r\n        messageId: args.messageId\r\n      });\r\n    } else {\r\n      emp.environment.set({\r\n        environments: [emp.environment.browser],\r\n        mapInstanceId: args.map.mapInstanceId,\r\n        messageId: args.messageId\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * For creating a new instance of a map with a unique id and dom element to render into.\r\n   * @method\r\n   * @memberof emp.instanceManager#\r\n   * @public\r\n   * @param  {object} args\r\n   * @param  {string} args.instanceId GUID representing the unique identity of this map instance\r\n   * @param  {string} args.instanceDomId GUID representing the unique DOM div element for the map instance to render its UI into\r\n   * @param  {object} args.config config object containing the values for the map to use for initialization and connections to services\r\n   * @param {object} args.extent\r\n   * @param {string} args.engine\r\n   * @param {string} args.environment\r\n   * @param {string} args.messageId\r\n   * @return {emp.map}\r\n   */\r\n  var buildInstance = function (args) {\r\n    var instanceDomId = args.instanceDomId,\r\n      instanceId = args.instanceId,\r\n      initEngine,\r\n      environment,\r\n      map;\r\n\r\n    // needs the args.domContainer and args.instanceId;\r\n    // Sets up the html and adds the divs for the map.  Show the loading screen.\r\n    instanceDomId = emp.ui.renderContainer({\r\n      instanceId: instanceId,\r\n      domContainer: instanceDomId,\r\n      recorder: args.recorder\r\n    });\r\n\r\n    map = emp.map({\r\n      mapInstanceId: instanceId,\r\n      extent: args.extent\r\n    });    \r\n\r\n    instances[instanceId] = {\r\n      map: map,\r\n      domContainer: instanceDomId\r\n    };\r\n    // This sets up the transaction queue for the new map.\r\n    emp.transactionQueue.newMapInstance({\r\n      mapInstanceId: instanceId\r\n    });\r\n    emp.storage.newMapInstance({\r\n      mapInstanceId: instanceId\r\n    });\r\n    emp.wms.manager.newMapInstance({\r\n      mapInstanceId: instanceId\r\n    });\r\n    // subscribes the map to listening for the transaction queue,\r\n    // adds default overlays like Layers.\r\n    map.init();\r\n    map.uiComponents = {};\r\n    initEngine = function () {\r\n      setTimeout(function () {\r\n        try {\r\n          // Send out INITIALIZING map status event.\r\n          new map.eventing.StatusChange({\r\n            status: emp.map.states.INITIALIZING\r\n          });\r\n          map.engines.load(args.engine);\r\n        } catch (err) {\r\n          console.error(\"Map instance startup failed.\" + \"\\n  name:\" + err.name + \"\\n  message:\" + err.message + \"\\n  stack:\" + err.stack);\r\n          emp.instanceManager.mapInstanceStartupFailed(instanceId);\r\n        }\r\n      }, 0);\r\n    };\r\n    environment = emp.util.validateEnvironment(args.environment);\r\n    // Initialize emp core\r\n    initialize({\r\n      callback: initEngine,\r\n      environment: environment,\r\n      map: map,\r\n      instanceId: instanceId,\r\n      instanceDomId: instanceDomId,\r\n      messageId: args.messageId\r\n    });\r\n\r\n    return map;\r\n  };\r\n\r\n  cmapiInterface.init();\r\n  emp.storage.init();\r\n\r\n  var storageReloadStart = function () {\r\n    bMapSwapInProgress = true;\r\n  };\r\n\r\n  var storageReloadComplete = function () {\r\n    bMapSwapInProgress = false;\r\n  };\r\n\r\n  var attempts = 10;\r\n\r\n  var checkRendererFontsLoaded = function () {\r\n    if ((armyc2 === undefined) ||\r\n      (armyc2.c2sd === undefined) ||\r\n      (armyc2.c2sd.renderer === undefined) ||\r\n      (armyc2.c2sd.renderer.utilities === undefined) ||\r\n      (armyc2.c2sd.renderer.utilities.RendererUtilities === undefined)) {\r\n      setTimeout(checkRendererFontsLoaded, 1000);\r\n      return;\r\n    }\r\n\r\n    if (armyc2.c2sd.renderer.utilities.RendererUtilities.fontsLoaded()) {\r\n      return true;\r\n    } else if (attempts > 0) {\r\n      attempts -= 1;\r\n      setTimeout(checkRendererFontsLoaded, 1000);\r\n      //sometimes font won't register until after a render attempt\r\n      armyc2.c2sd.renderer.MilStdIconRenderer.Render(\"SHAPWMSA-------\", {});\r\n    } else {\r\n      console.error(\"MIL-SYM-JS 2525 Rendering fonts failed to load.  Please ensure that the mil-symjs JavaScript and CSS files are included on the application correctly\");\r\n    }\r\n  };\r\n\r\n  function cleanupInstance(mapInstanceId, bDumpQ) {\r\n    var oInstance;\r\n    var oKeyList;\r\n    var iIndex;\r\n    var oUIComponent;\r\n    var domContainerId;\r\n\r\n    oInstance = instances[mapInstanceId].map;\r\n    domContainerId = instances[mapInstanceId].domContainer;\r\n\r\n    if (bDumpQ) {\r\n      emp.transactionQueue.dumpMapQueue(mapInstanceId);\r\n    } else {\r\n      emp.transactionQueue.purgeMapQueue(mapInstanceId);\r\n    }\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.MAP_ENGINE_SWAP_START,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: storageReloadStart\r\n    });\r\n\r\n    emp.transactionQueue.listener.remove({\r\n      type: emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,\r\n      mapInstanceId: mapInstanceId,\r\n      callback: storageReloadComplete\r\n    });\r\n\r\n    if (oInstance.uiComponents !== undefined) {\r\n      // Destroy the UI components of the instance.\r\n      oKeyList = emp.helpers.associativeArray.getKeys(oInstance.uiComponents);\r\n\r\n      for (iIndex = 0; iIndex < oKeyList.length; iIndex += 1) {\r\n        oUIComponent = oInstance.uiComponents[oKeyList[iIndex]];\r\n\r\n        if (oUIComponent && (typeof(oUIComponent.destroy) === 'function')) {\r\n          oUIComponent.destroy();\r\n        }\r\n\r\n        delete oInstance.uiComponents[oKeyList[iIndex]];\r\n      }\r\n    }\r\n\r\n    emp.wms.manager.removeMapInstance({\r\n      mapInstanceId: mapInstanceId\r\n    });\r\n\r\n    new oInstance.eventing.StatusChange({\r\n      status: emp.map.states.TEARDOWN\r\n    });\r\n    oInstance.discardInstance();\r\n\r\n    cmapiInterface.destroyMapInstance({\r\n      instanceId: mapInstanceId\r\n    });\r\n\r\n    emp.storage.removeMapInstance({\r\n      mapInstanceId: mapInstanceId\r\n    });\r\n\r\n    emp.transactionQueue.removeMapInstance(mapInstanceId);\r\n\r\n    delete instances[mapInstanceId];\r\n\r\n    var container = document.getElementById(domContainerId);\r\n    while (container.firstChild) {\r\n      container.removeChild(container.firstChild);\r\n    }\r\n  }\r\n\r\n  var publicInterface = {\r\n    /**\r\n     * Gets the instance with the specified id\r\n     * @param {string} instanceId\r\n     * @returns {emp.map}\r\n     */\r\n    getInstance: function (instanceId) {\r\n      if (!instances[instanceId]) {\r\n        return undefined;\r\n      }\r\n      return instances[instanceId].map;\r\n    },\r\n    /**\r\n     *\r\n     * @param {Object} args\r\n     * @param {String} args.instanceDomId The ID of the HTML div the map instance is to be placed in.\r\n     * @param {String} args.messageId The message ID of the create instance message.\r\n     * @param {Object} args.engine A map engine configuration object.\r\n     * @param {Object} args.extent The extent of the default view the map should start at.\r\n     * @returns {String} The map instance ID.\r\n     */\r\n    createInstance: function (args) {\r\n\r\n      if (emp.helpers.associativeArray.size(instances) === 0) {\r\n        checkRendererFontsLoaded();\r\n      }\r\n      args.instanceId = emp.helpers.id.newGUID();\r\n      oPendingMapInstanceCreateList.push(args);\r\n      this.startNextPendingMapInstance();\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.MAP_ENGINE_SWAP_START,\r\n        mapInstanceId: args.instanceId,\r\n        callback: storageReloadStart\r\n      });\r\n\r\n      emp.transactionQueue.listener.add({\r\n        type: emp.intents.control.MAP_ENGINE_SWAP_COMPLETE,\r\n        mapInstanceId: args.instanceId,\r\n        callback: storageReloadComplete\r\n      });\r\n      return args.instanceId;\r\n    },\r\n    destroyInstance: function (args) {\r\n\r\n      if (!instances.hasOwnProperty(args.mapInstanceId)) {\r\n        return;\r\n      }\r\n\r\n      // Check to make sure that while we are destroying the map,\r\n      // we are not loading another map.  If we are we want to wait\r\n      // a bit until that finishes loading.  Try again in a bit.\r\n      if (this.isMapEngineLoading()) {\r\n        setTimeout(function () {\r\n          publicInterface.destroyInstance(args);\r\n        }, 50);\r\n      } else {\r\n\r\n        // Send out a SHUTDOWN_IN_PROGRESS.  This is part of the map\r\n        // status events.  Eventually, the map will indicate that it is\r\n        // fully shut down.\r\n        new publicInterface.getInstance(args.mapInstanceId).eventing.StatusChange({\r\n          status: emp.map.states.SHUTDOWN_IN_PROGRESS\r\n        });\r\n        cleanupInstance(args.mapInstanceId, false);\r\n\r\n        // This will respond to the request to remove the map\r\n        // with a message complete so the user knows it has received\r\n        // the request to shutdown.\r\n        setTimeout(function () {\r\n          var transactionMessage = {\r\n            messageId: args.messageId,\r\n            originatingChannel: cmapi.channel.names.MAP_SHUTDOWN,\r\n            status: \"success\",\r\n            details: {},\r\n            failures: []\r\n          };\r\n\r\n          emp.environment.get().pubSub.publish({\r\n            channel: cmapi.channel.names.MAP_MESSAGE_COMPLETE,\r\n            message: transactionMessage,\r\n            sender: {\r\n              id: args.mapInstanceId\r\n            }\r\n          });\r\n\r\n        }, 50);\r\n      }\r\n    },\r\n    isMapEngineLoading: function () {\r\n      return bMapSwapInProgress || bInitialLoadInProgress;\r\n    },\r\n    startNextPendingMapInstance: function () {\r\n      var oInstanceArgs;\r\n\r\n      if (hCheckPendingTimer) {\r\n        clearTimeout(hCheckPendingTimer);\r\n        hCheckPendingTimer = undefined;\r\n      }\r\n      if (oPendingMapInstanceCreateList.length > 0) {\r\n        if (!this.isMapEngineLoading()) {\r\n          bInitialLoadInProgress = true;\r\n          oInstanceArgs = oPendingMapInstanceCreateList.shift();\r\n          // This function is used to initialize the configuration\r\n          // object which gets referenced in various places. All\r\n          // existing properties are global as of right now. Meaning\r\n          // every instance references the same global configuration\r\n          // object. However, in the future this will change at which\r\n          // point this function will be modified to return a\r\n          // specific configuration object for each unique instance\r\n          // in order to allow for instance specific configuration\r\n          // objects. When this change occurs this function will get\r\n          // moved back to the buildInstance() function where it\r\n          // originally resided.\r\n          emp.util.config.getConfigObject();\r\n          buildInstance(oInstanceArgs);\r\n        } else {\r\n          hCheckPendingTimer = setTimeout(function () {\r\n            hCheckPendingTimer = undefined;\r\n            emp.instanceManager.startNextPendingMapInstance();\r\n          }, 1000);\r\n        }\r\n      }\r\n    },\r\n    statusChangeHdlr: function (oTrans) {\r\n      var oMapEngine;\r\n      var oTransaction;\r\n      var oSettings;\r\n      var asLabels;\r\n\r\n      if (instances.hasOwnProperty(oTrans.mapInstanceId)) {\r\n        oMapEngine = instances[oTrans.mapInstanceId].map;\r\n        oSettings = oMapEngine.uiComponents.settings;\r\n      }\r\n\r\n      switch (oTrans.items[0].status) {\r\n        case emp.map.states.INITIALIZING:\r\n          break;\r\n        case emp.map.states.READY:\r\n        case emp.map.states.MAP_SWAP_IN_PROGRESS:\r\n          if (oMapEngine &&\r\n            oMapEngine.engines.isMapSwapInProgress()) {\r\n            // We want to issue icon size and label options\r\n            // if and only if we are swapping map engines.\r\n\r\n            if (oSettings !== undefined) {\r\n              // We need to run them and not queue them so\r\n              // the reload icons are the right size to begin with\r\n              // and not having to redraw them once they are loaded.\r\n              oTransaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.MIL_ICON_SIZE_SET,\r\n                mapInstanceId: oTrans.mapInstanceId,\r\n                source: emp.core.sources.CORE,\r\n                items: [oSettings.iconSizeOption]\r\n              });\r\n\r\n              oTransaction.run();\r\n\r\n              asLabels = oSettings.getMilStdLabelList();\r\n              oTransaction = new emp.typeLibrary.Transaction({\r\n                intent: emp.intents.control.MIL_ICON_LABELS_SET,\r\n                mapInstanceId: oTrans.mapInstanceId,\r\n                source: emp.core.sources.CORE,\r\n                items: [asLabels]\r\n              });\r\n\r\n              oTransaction.run();\r\n\r\n              if (oMapEngine && oMapEngine.engine.capabilities.projection.flat) {\r\n                // This we send if and only if its supported by the engine.\r\n                oTransaction = new emp.typeLibrary.Transaction({\r\n                  intent: emp.intents.control.PROJECTION_ENABLE_FLAT,\r\n                  mapInstanceId: oTrans.mapInstanceId,\r\n                  items: [oSettings.mapProjectionFlat]\r\n                });\r\n                oTransaction.run();\r\n              }\r\n            }\r\n          } else if (oMapEngine && bInitialLoadInProgress) {\r\n            if (oSettings !== undefined) {\r\n              if (oMapEngine && oMapEngine.engine.capabilities.projection.flat) {\r\n                // This we send if and only if its supported by the engine.\r\n                oTransaction = new emp.typeLibrary.Transaction({\r\n                  intent: emp.intents.control.PROJECTION_ENABLE_FLAT,\r\n                  mapInstanceId: oTrans.mapInstanceId,\r\n                  items: [oSettings.mapProjectionFlat]\r\n                });\r\n                oTransaction.queue();\r\n              }\r\n            }\r\n            bInitialLoadInProgress = false;\r\n          }\r\n          hCheckPendingTimer = setTimeout(function () {\r\n            emp.instanceManager.startNextPendingMapInstance();\r\n          }, 50);\r\n          break;\r\n        case emp.map.states.MAP_INSTANCE_INIT_FAILED:\r\n          if (oMapEngine) {\r\n            // The map instance fail to initialize.\r\n            emp.instanceManager.mapInstanceStartupFailed(oTrans.mapInstanceId);\r\n          }\r\n          break;\r\n      }\r\n    },\r\n    /**\r\n     * @description This function must be called by each map manifest file when its loaded.\r\n     * It registers the map engine with the cores instance manager.\r\n     * @param {object} args\r\n     * @param {string} args.name Must contain the name of the map engine.\r\n     * @param {string} args.mapEngineId Must contains the map engine's unique identifier.\r\n     * The unique Id can be added to emp.constant.mapEngineId in /lib/emp.constant.js\r\n     * @param {mapEngineInitializecb} args.fnInitialize Must contain a function reference to\r\n     * the maps initialization function. The function is called with one argument.\r\n     * The argument is defines as follows:\r\n     * args = {\r\n         *      config: {@see @link emp.util.configType},\r\n         *      mapInstance: {\r\n         *          mapInstanceId: xyz, // The map instance ID\r\n         *          configProperties: {}, // As provided in the properties.\r\n         *          engines: {\r\n         *          }\r\n         *          eventing: {\r\n         *              SelectionChange: function(args){},\r\n         *              ViewChange: function(args) {},\r\n         *              Pointer: function(args) {},\r\n         *              SelectionBox: function(args) {},\r\n         *              StaticContent: function(args) {},\r\n         *              Error: function(args) {},\r\n         *              StatusChange: function(args) {},\r\n         *              DrawStart: function(args) {},\r\n         *              DrawEnd: function(args) {},\r\n         *              EditStart: function(args) {},\r\n         *              EditEnd: function(args) {}\r\n         *          },\r\n         *          engine: map instance, // The map instance must be placed here.\r\n         *      }\r\n         * }\r\n     *\r\n     * The maps initialization function MUST return\r\n     *\r\n     * @param {Array} args.resources An array of string indicating the relative URL of the resources need by the map engine.\r\n     * @param {function} args.fnCreateInstance A function of the for function(args)\r\n     * which is called to create a map instance. Where the args is defined as follows.\r\n     */\r\n    registerMapEngine: function (args) {\r\n      var currentEngineConfiguration = emp.util.config.getCurrentEngineConfiguration();\r\n      oRegisteredMapEngines[emp.util.config.getCurrentMapEngineId()] = {\r\n        fnInitialize: args.fnInitialize,\r\n        engineConfiguration: currentEngineConfiguration\r\n      };\r\n    },\r\n    getMapEngineRegistration: function (mapEngineId) {\r\n      return oRegisteredMapEngines[mapEngineId];\r\n    },\r\n    getPreviousMapEngineId: function () {\r\n      return oRegisteredMapEngines.previousMapEngineId;\r\n    },\r\n    getCurrentMapEngineId: function () {\r\n      return oRegisteredMapEngines.currentMapEngineId;\r\n    },\r\n    mapInstanceStartupFailed: function (mapInstanceId) {\r\n      if (bInitialLoadInProgress) {\r\n        // The map instance fail to initialize.\r\n        setTimeout(function () {\r\n          cleanupInstance(mapInstanceId, true);\r\n          bInitialLoadInProgress = false;\r\n          emp.instanceManager.startNextPendingMapInstance();\r\n        }, 50);\r\n      }\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n\r\n/**\r\n * @callback mapEngineInitializecb\r\n * @param {Object} args This parameter is an object containing all initialization parameters\r\n * @param {Object} args.config Object containing the main configuration parameters.\r\n * @param {boolean} args.config.debug If true the map engine should load a debug version of itself.\r\n * If false it should load a release version of itself.\r\n * @param {String} args.config.urlProxy Contains the url of the emp proxy.\r\n * @returns {mapEngineResourceType} The returned object must contains the list of resources required by the map engine.\r\n */\r\n\r\n/**\r\n * @typedef {Object} mapEngineResourceType\r\n * @property {Array<String>} resourceList An array of url of the required resources.\r\n * @property {createInstanceCB} fnCreateInstance A reference to the map engine create instance function.\r\n */\r\n\r\n/**\r\n * @callback createInstanceCB\r\n * @param {Object} args.configProperties This parameter contains the map instance\r\n * configuration parameters provided in the properties of the mapEngines config structure.\r\n * @param {Object} args.mapInstance An EMP map instance structure.\r\n * @param {String} args.mapInstance.mapInstanceId Value which uniquely identifies the map instances.\r\n * @param {Object} args.mapInstance.eventing Object contain all eventing functions.\r\n * @param {function} args.mapInstance.eventing.SelectionChange Function to generate a selection change event from the map instance.\r\n * @param {function} args.mapInstance.eventing.ViewChange Function to generate a view change event from the map instance.\r\n * @param {function} args.mapInstance.eventing.Pointer Function to generate a pointer event from the map instance.\r\n * @param {function} args.mapInstance.eventing.SelectionBox Function to generate a SelectionBox event from the map instance.\r\n * @param {function} args.mapInstance.eventing.StaticContent Function to generate a StaticContent event from the map instance.\r\n * @param {function} args.mapInstance.eventing.Error Function to generate an Error event from the map instance.\r\n * @param {function} args.mapInstance.eventing.StatusChange Function to generate a Status Change event from the map instance.\r\n * @param {function} args.mapInstance.eventing.DrawStart Function to generate a Draw Start event from the map instance.\r\n * @param {function} args.mapInstance.eventing.DrawEnd Function to generate a Draw End event from the map instance.\r\n * @param {function} args.mapInstance.eventing.EditStart Function to generate a Edit Start event from the map instance.\r\n * @param {function} args.mapInstance.eventing.EditEnd Function to generate a Edit End event from the map instance.\r\n * @param {function} args.mapInstance.engine Location where the function MUST place a reference to the newly created map instance.\r\n */\r\n","var emp = window.emp || {};\r\n\r\n/**\r\n * Namespace used by all UI components\r\n * @namespace ui\r\n * @memberof emp\r\n */\r\nemp.ui = emp.ui || {};\r\nemp.ui.consts = {\r\n  IFRAME_SHIM: '<iframe class=\"emp_iframeshim\" frameborder=\"0\" scrolling=\"no\"><html><head></head><body></body></html></iframe>'\r\n};\r\n\r\n/**\r\n * Renders the map background prior to the map loading, also setting the div default style for the map.\r\n *\r\n * @param {Object} args Parameters are passed as members of the args object.\r\n * @param {String} args.instanceId The map's instance id that this will set up.\r\n * @param {String} args.domContainer The map's div id.\r\n * @param {boolean} args.record Whether or not to show the recording buttons.\r\n */\r\nemp.ui.renderContainer = function (args) {\r\n  var domCont,\r\n    instanceId = args.instanceId,\r\n    domTargetId = args.domContainer,\r\n    instanceContainer;\r\n\r\n  var styleStrings = {\r\n    loadingPanel: \"height:100%;overflow: hidden;z-index: 9989;display:flex;align-items: center; justify-content: center;\",\r\n    emp: 'color: #FFFFFF;text-align:center;',\r\n    loader: '',\r\n    absmax: ';position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px; overflow: hidden;',\r\n    instanceStyle: \"position:relative;width:100%; height:100%;overflow: hidden; background-color:#616161\",\r\n    containerStyle: '@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }' +\r\n    '.circle { width: 100px; height: 100px; position: absolute; top: 200px; left: 0; bottom: 0; right: 0; margin: auto; background-color: #717171; border-radius: 50%; }' +\r\n    '.inner-circle { width: 92%; height: 92%; background: #616161; border-radius: 50%; margin: auto; vertical-align: middle; position: absolute; top: 0; left: 0; bottom: 0; right: 0; }' +\r\n    '.spinner { height: 0; width: 0; border-radius: 50%; border: 50px solid transparent; border-right-color: rgba(255, 255, 255, 0.3); -webkit-animation: spin 1.6s infinite;' +\r\n    ' -moz-animation: spin 1.6s infinite; -o-animation: spin 1.6s infinite; animation: spin 1.6s infinite; }',\r\n    recorder: \"position: absolute; top: 35px; left: 100px; overflow: hidden; width: 100px height: 100px z-index: 10500; background-color: yellow\"\r\n  };\r\n\r\n  instanceContainer = document.createElement('div');\r\n  instanceContainer.id = instanceId;\r\n  instanceContainer.setAttribute(\"style\", styleStrings.instanceStyle);\r\n\r\n  var loadingPanel, flexStart, flexEnd, loadingPanelStatus, messageHolder, spinner, innerSpinner, innerCircle,\r\n    loadingMessageSpan, loadingStatus, styleTag, instanceMap, head;\r\n\r\n  head = document.head || document.getElementsByTagName('head')[0];\r\n  styleTag = document.createElement('style');\r\n\r\n  styleTag.type = 'text/css';\r\n  if (styleTag.styleSheet) {\r\n    styleTag.setAttribute(\"style\", styleStrings.containerStyle);\r\n  } else {\r\n    styleTag.appendChild(document.createTextNode(styleStrings.containerStyle));\r\n  }\r\n\r\n  head.appendChild(styleTag);\r\n\r\n  // Create a panel to display the loading progress of EMP\r\n  loadingPanel = document.createElement('div');\r\n  loadingPanel.id = instanceId + '_loadingPanel';\r\n  loadingPanel.setAttribute(\"style\", styleStrings.loadingPanel);\r\n\r\n  // Flex start\r\n  flexStart = document.createElement(\"div\");\r\n  flexStart.style.alignSelf = \"flex-start\";\r\n\r\n  // Create the status display panel\r\n  loadingPanelStatus = document.createElement(\"div\");\r\n  loadingPanelStatus.id = instanceId + \"_loadingPanelStatus\";\r\n\r\n  messageHolder = document.createElement(\"div\");\r\n  messageHolder.id = instanceId + '_messageHolder';\r\n  messageHolder.setAttribute(\"style\", styleStrings.emp);\r\n\r\n  loadingMessageSpan = document.createElement('span');\r\n  loadingMessageSpan.id = instanceId + \"_loadingMessage\";\r\n\r\n  loadingStatus = document.createElement('div');\r\n  loadingStatus.id = instanceId + \"_loadingStatus\";\r\n\r\n  // Create the spinner\r\n  spinner = document.createElement(\"div\");\r\n  spinner.id = instanceId + \"_loadSpinner\";\r\n  spinner.className = \"circle\";\r\n\r\n  innerSpinner = document.createElement(\"div\");\r\n  innerSpinner.className = \"spinner\";\r\n\r\n  innerCircle = document.createElement(\"div\");\r\n  innerCircle.className = \"inner-circle\";\r\n\r\n  // Flex end\r\n  flexEnd = document.createElement(\"div\");\r\n  flexEnd.style.alignSelf = \"flex-end\";\r\n\r\n  // Map container itself\r\n  instanceMap = document.createElement(\"div\");\r\n  instanceMap.id = instanceId + \"_map\";\r\n  instanceMap.setAttribute(\"style\", styleStrings.absmax);\r\n\r\n  // Assemble the page\r\n  instanceContainer.appendChild(loadingPanel);\r\n    loadingPanel.appendChild(flexStart);\r\n    loadingPanel.appendChild(loadingPanelStatus);\r\n      loadingPanelStatus.appendChild(messageHolder);\r\n        messageHolder.appendChild(loadingMessageSpan);\r\n          loadingMessageSpan.appendChild(document.createTextNode(\"Loading Map\"));\r\n        messageHolder.appendChild(document.createElement('br'));\r\n        messageHolder.appendChild(loadingStatus);\r\n          loadingStatus.appendChild(document.createTextNode(\"Fetching configuration...\"));\r\n      loadingPanelStatus.appendChild(spinner);\r\n        spinner.appendChild(innerSpinner);\r\n        spinner.appendChild(innerCircle);\r\n    loadingPanel.appendChild(flexEnd);\r\n  instanceContainer.appendChild(instanceMap);\r\n\r\n  // only show the debugging recorder if the recorder parameter is set.\r\n  if (args.recorder) {\r\n    emp.recorder.record();\r\n\r\n    var recorder = document.createElement(\"div\");\r\n    recorder.setAttribute(\"style\", styleStrings.recorder);\r\n\r\n    var recordButton = document.createElement(\"button\");\r\n    recordButton.id = \"emp_record\";\r\n    recordButton.disabled = true;\r\n    recordButton.onclick = emp.ui.record;\r\n    recordButton.style.backgroundColor = \"green\";\r\n    recordButton.appendChild(document.createTextNode(\"RECORD\"));\r\n    \r\n    var stopButton = document.createElement(\"button\");\r\n    stopButton.id = \"emp_stop\";\r\n    stopButton.onclick = emp.ui.stop;\r\n    stopButton.style.backgroundColor = \"red\";\r\n    stopButton.appendChild(document.createTextNode(\"STOP\"));\r\n    \r\n    var saveButton = document.createElement(\"button\");\r\n    saveButton.id = \"emp_save\";\r\n    saveButton.onclick = emp.ui.save;\r\n    saveButton.style.backgroundColor = \"blue\";\r\n    saveButton.appendChild(document.createTextNode(\"SAVE\"));\r\n    \r\n    var clearButton = document.createElement(\"button\");\r\n    clearButton.id = \"emp_clear\";\r\n    clearButton.onclick = emp.ui.clear;\r\n    clearButton.style.backgroundColor = \"yellow\";\r\n    clearButton.appendChild(document.createTextNode(\"CLEAR\"));\r\n\r\n    var saveAnchor = document.createElement('a');\r\n    saveAnchor.href = \"#\";\r\n    saveAnchor.id = \"recorderElem\";\r\n\r\n    recorder.appendChild(recordButton);\r\n    recorder.appendChild(stopButton);\r\n    recorder.appendChild(saveButton);\r\n    recorder.appendChild(clearButton);\r\n    recorder.appendChild(saveAnchor);\r\n\r\n    instanceContainer.appendChild(recorder);\r\n  }\r\n\r\n  if (domTargetId) {\r\n    domCont = document.getElementById(domTargetId);\r\n  }\r\n\r\n  if (domCont) {\r\n    domCont.appendChild(instanceContainer);\r\n  } else {\r\n    document.body.appendChild(instanceContainer);\r\n  }\r\n\r\n  return instanceId;\r\n};\r\n\r\n/**\r\n * Begins recording calls\r\n */\r\nemp.ui.record = function () {\r\n  var record = document.getElementById('emp_record');\r\n  var stop = document.getElementById('emp_stop');\r\n  record.disabled = true;\r\n  stop.disabled = false;\r\n\r\n  emp.recorder.record();\r\n};\r\n\r\n/**\r\n * Stops recording calls\r\n */\r\nemp.ui.stop = function () {\r\n  var record = document.getElementById('emp_record');\r\n  var stop = document.getElementById('emp_stop');\r\n  record.disabled = false;\r\n  stop.disabled = true;\r\n  emp.recorder.stop();\r\n};\r\n\r\n/**\r\n * Exports calls to the downloads folder\r\n */\r\nemp.ui.save = function () {\r\n  emp.recorder.save();\r\n};\r\n\r\n/**\r\n * Clears the existing calls from the record stack\r\n */\r\nemp.ui.clear = function () {\r\n  emp.recorder.clear();\r\n};\r\n\r\n/**\r\n * Source Tag for all UI originated transactions\r\n * @type {String}\r\n * @constant\r\n */\r\nemp.ui.SOURCE = \"emp-core-ui\";\r\nemp.ui.config = {};\r\nemp.ui.config.lang = \"enUS\";\r\n","if (!window.emp) {\r\n    window.emp = {};\r\n}\r\n\r\n/**\r\n * Mechanism for recording all calls made and exporting them for playback or debugging purposes.\r\n */\r\nemp.recorder = (function() {\r\n  var log = [];\r\n  var recording = false;\r\n\r\n  var publicInterface = {\r\n\r\n    /**\r\n     * Starts recording messages sent to the recorder.\r\n     */\r\n    record: function() {\r\n      recording = true;\r\n    },\r\n\r\n    /**\r\n     * Stops recording messages sent to the recorder.\r\n     */\r\n    stop: function() {\r\n      recording = false;\r\n    },\r\n\r\n    /**\r\n     * Log a message to be recorded.\r\n     *\r\n     * @param entry A single message.\r\n     * @param entry.timeStamp The time the message was recorded.\r\n     * @param entry.message The message that was recorded.\r\n     */\r\n    log: function(entry) {\r\n\r\n      if (recording) {        \r\n        log.push(entry);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Saves recorded messages to a file.\r\n     */\r\n    save: function() {\r\n      var dataStr = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify({results:log}, 0, 2));\r\n      var recorderElem = document.getElementById('recorderElem');\r\n      recorderElem.setAttribute(\"href\", dataStr);\r\n      recorderElem.setAttribute(\"download\", \"results.json\");\r\n      recorderElem.click();\r\n    },\r\n\r\n    /**\r\n     * Clears recorded messages.\r\n     */\r\n    clear: function() {\r\n      log = [];\r\n    }\r\n  };\r\n\r\n  return publicInterface;\r\n}());\r\n","/**\r\n * @namespace\r\n */\r\ncmapi = cmapi || {};\r\n/**\r\n * @namespace\r\n */\r\ncmapi.enums = {\r\n  /**\r\n   * @readonly\r\n   * @enum {string}\r\n   */\r\n  altitudeMode: {\r\n    CLAMP_TO_GROUND: \"CLAMP_TO_GROUND\",\r\n    RELATIVE_TO_GROUND: \"RELATIVE_TO_GROUND\",\r\n    ABSOLUTE: \"ABSOLUTE\"\r\n  },\r\n  /**\r\n   * @readonly\r\n   * @enum {string}\r\n   */\r\n  fillPattern: {\r\n    solid: \"solid\",\r\n    hatched: \"hatched\",\r\n    crossHatched: \"crossHatched\"\r\n  },\r\n  /**\r\n   * @readonly\r\n   * @enum {string}\r\n   */\r\n  justification: {\r\n    LEFT: \"LEFT\",\r\n    CENTER: \"CENTER\",\r\n    RIGHT: \"RIGHT\"\r\n  },\r\n  /**\r\n   * @readonly\r\n   * @enum {string}\r\n   */\r\n  typeface: {\r\n    REGULAR: \"REGULAR\",\r\n    BOLD: \"BOLD\",\r\n    ITALIC: \"ITALIC\",\r\n    BOLDITALIC: \"BOLDITALIC\"\r\n  },\r\n  /**\r\n   * @readonly\r\n   * @enum {string}\r\n   */  symbolStandard: {\r\n    MIL_STD_2525C: \"2525c\",\r\n    MIL_STD_2525B: \"2525b\"\r\n  },\r\n  /**\r\n   * @readonly\r\n   * @enum {string}\r\n   */\r\n  acmType: {\r\n    ROUTE: \"ROUTE----------\",\r\n    CYLINDER: \"CYLINDER-------\",\r\n    ORBIT: \"ORBIT----------\",\r\n    POLYGON: \"POLYGON--------\",\r\n    RADARC: \"RADARC---------\",\r\n    POLYARC: \"POLYARC--------\",\r\n    TRACK: \"TRACK----------\",\r\n    CURTAIN: \"CURTAIN--------\"\r\n  }\r\n};\r\n\r\n/**\r\n * @interface\r\n * @param {object} [args]\r\n */\r\ncmapi.IGeoAltitudeMode = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  var _altitudeMode;\r\n  /**\r\n   * @type {cmapi.enums.altitudeMode}\r\n   * @name cmapi.IGeoAltitudeMode#altitudeMode\r\n   */\r\n  Object.defineProperty(this, \"altitudeMode\", {\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitudeMode;\r\n    },\r\n    set: function(value) {\r\n      _altitudeMode = value;\r\n    }\r\n  });\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Defines a range in time that represents a beginning and end.  This can be used to describe things such as availability, visibility, active/inactive for provided periods of time.  From a filtering point of view, if a time filter is applied a feature would only be visible on a map view within the defined timespan(s)\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoTimeSpan} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoTimeSpan = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _begin;\r\n  /**\r\n   * @type {string}\r\n   * @name cmapi.IGeoTimeSpan#begin\r\n   */\r\n  Object.defineProperty(this, \"begin\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _begin;\r\n    },\r\n\r\n    set: function(value) {\r\n      _begin = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _end;\r\n  /**\r\n   * @type {string}\r\n   * @name cmapi.IGeoTimeSpan#end\r\n   */\r\n  Object.defineProperty(this, \"end\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _end;\r\n    },\r\n\r\n    set: function(value) {\r\n      _end = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Defines a specific geospatial position derived using WGS-84 latitude longitude\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoPosition} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoPosition = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _latitude = 0;\r\n  /**\r\n   * Latitude value in degrees decimal (i.e. 23.4567) derived from WGS-84\r\n   * @type {number}\r\n   * @name cmapi.IGeoPosition#latitude\r\n   */\r\n  Object.defineProperty(this, \"latitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _latitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _latitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _longitude = 0;\r\n  /**\r\n   * Longitude value in degrees decimal (i.e. 23.4567) derived from WGS-84\r\n   * @type {number}\r\n   * @name cmapi.IGeoPosition#longitude\r\n   */\r\n  Object.defineProperty(this, \"longitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _longitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _longitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _altitude = 0;\r\n  /**\r\n   * A value in meters representing the altitude of the associated position.  This will be interpreted base on the altitudeMode provided in the IGeoAltitudeMode enumeration\r\n   * @type {number}\r\n   * @name cmapi.IGeoPosition#altitude\r\n   */\r\n  Object.defineProperty(this, \"altitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _altitude = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * An ordered list of positions representing a 1 or more positions with an associated IGeoAltitudeMode to interpret the altitude values.  In the case of a point, a single position will create a single icon, wheras mulitple positions will create the same icon at multiple positions to be interpreted as a composite feature. For consistency, and IGeoRenderables use an IGeoPositionGroup even when only containing a single position\r\n * @interface\r\n * @augments cmapi.IGeoAltitudeMode\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoPositionGroup} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoPositionGroup = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoAltitudeMode(), this);\r\n\r\n  var _positions;\r\n  /**\r\n   * An ordered list of IGeoPosition objects representing a 1 or more positions with an associated IGeoAltitudeMode to interpret the altitude values.  In the case of a point, a single position will create a single icon, wheras mulitple positions will create the same icon at multiple positions to be interpreted as a composite feature. For consistency, and IGeoRenderables use an IGeoPositionGroup even when only containing a single positions\r\n   * @type {IGeoPosition[]}\r\n   * @name cmapi.IGeoPositionGroup#positions\r\n   */\r\n  Object.defineProperty(this, \"positions\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _positions;\r\n    },\r\n\r\n    set: function(value) {\r\n      _positions = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _timeStamp;\r\n  /**\r\n   * Defines a point in time that something occurred, was created, or was last updated time value as defined by http://tools.ietf.org/html/rfc3339\r\n   * @type {string}\r\n   * @name cmapi.IGeoPositionGroup#timeStamp\r\n   */\r\n  Object.defineProperty(this, \"timeStamp\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _timeStamp;\r\n    },\r\n\r\n    set: function(value) {\r\n      _timeStamp = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _timeSpans;\r\n  /**\r\n   * Defines one or more periods of time something occurred, or was active.\r\n   * @type {cmapi.IGeoTimeSpan[]}\r\n   * @name cmapi.IGeoPositionGroup#timeSpans\r\n   */\r\n  Object.defineProperty(this, \"timeSpans\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _timeSpans;\r\n    },\r\n    set: function(value) {\r\n      _timeSpans = value;\r\n    }\r\n  });\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * An ordered collection of IGeoPositionGroup objects\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoPositionHistory} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoPositionHistory = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _positionHistory;\r\n  /**\r\n   * @type {cmapi.IGeoPositionGroup[]}\r\n   * @name cmapi.IGeoPositionHistory#positionHistory\r\n   */\r\n  Object.defineProperty(this, \"positionHistory\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _positionHistory;\r\n    },\r\n    set: function(value) {\r\n      _positionHistory = value;\r\n    }\r\n  });\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Defines the virtual camera that views the scene. This element defines the position of the camera relative to the Earth's surface as well as the viewing direction of the camera. The camera position is defined by <longitude>, <latitude>, <altitude>, and either <altitudeMode>. The viewing direction of the camera is defined by <azimuth>, <tilt>, and <roll>. An IGeoCamera provides full six-degrees-of-freedom control over the view, so you can position the Camera in space and then rotate it around the X, Y, and Z axes. Most importantly, you can tilt the camera view so that you're looking above the horizon into the sky. The order of rotation is important. By default, the camera is looking straight down the Z axis toward the Earth. Before rotations are performed, the camera is translated along the Z axis to <altitude>. The order of transformations is as follows: <altitude> - translate along the Z axis to <altitude><azimuth> - rotate around the Z axis.<tilt> - rotate around the X axis.<roll> - rotate around the Z axis (again). Note that each time a rotation is applied, two of the camera axes change their orientation.\r\n * @interface\r\n * @augments cmapi.IGeoBase\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoCamera} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoCamera = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoBase(), this);\r\n\r\n  var _altitudeMode;\r\n  /**\r\n   * Enumeration of altitude modes to define how the altitude value in an IGeoPosition alt (altitude) property will be interpreted\r\n   * @type {cmapi.enums.altitudeMode}\r\n   * @name cmapi.IGeoCamera#altitudeMode\r\n   */\r\n  Object.defineProperty(this, \"altitudeMode\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitudeMode;\r\n    },\r\n\r\n    set: function(value) {\r\n      _altitudeMode = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _latitude = 0;\r\n  /**\r\n   * Latitude value in degrees decimal (i.e. 23.4567) derived from WGS-84\r\n   * @type {number}\r\n   * @name cmapi.IGeoCamera#latitude\r\n   */\r\n  Object.defineProperty(this, \"latitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _latitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _latitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _longitude = 0;\r\n  /**\r\n   * Longitude value in degrees decimal (i.e. 23.4567) derived from WGS-84\r\n   * @type {number}\r\n   * @name cmapi.IGeoCamera#longitude\r\n   */\r\n  Object.defineProperty(this, \"longitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _longitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _longitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _altitude = 0;\r\n  /**\r\n   * A value in meters representing the altitude of the associated position.  This will be interpreted base on the altitudeMode provided in the IGeoAltitudeMode enumeration\r\n   * @type {number}\r\n   * @name cmapi.IGeoCamera#altitude\r\n   */\r\n  Object.defineProperty(this, \"altitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _altitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _tilt = 0;\r\n  /**\r\n   * Rotation, in degrees, of the camera around the X axis. A value of 0 indicates that the view is aimed straight down toward the earth (the most common case). A value for 90 for <tilt> indicates that the view is aimed toward the horizon. Values greater than 90 indicate that the view is pointed up into the sky. Values for <tilt> are clamped at +180 degrees\r\n   * @type {number}\r\n   * @name cmapi.IGeoCamera#tilt\r\n   */\r\n  Object.defineProperty(this, \"tilt\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _tilt;\r\n    },\r\n\r\n    set: function(value) {\r\n      _tilt = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _roll = 0;\r\n  /**\r\n   * Rotation, in degrees, of the camera around the Z axis. Values range from 180 to +180 degrees\r\n   * @type {number}\r\n   * @name cmapi.IGeoCamera#roll\r\n   */\r\n  Object.defineProperty(this, \"roll\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _roll;\r\n    },\r\n\r\n    set: function(value) {\r\n      _roll = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _heading = 0;\r\n  /**\r\n   * Direction (that is, North, South, East, West), in degrees. Default=0 (North). Values range from 0 to 360 degrees\r\n   * @type {number}\r\n   * @name cmapi.IGeoCamera#heading\r\n   */\r\n  Object.defineProperty(this, \"heading\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _heading;\r\n    },\r\n\r\n    set: function(value) {\r\n      _heading = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * The LookAt element positions the 'camera' in relation to the IGeoPosition that is being viewed\r\n * @interface\r\n * @augments cmapi.IGeoBase\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoLookAt} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoLookAt = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoBase(), this);\r\n\r\n  var _altitudeMode;\r\n  /**\r\n   * Enumeration of altitude modes to define how the altitude value in an IGeoPosition alt (altitude) property will be interpreted\r\n   * @type {cmapi.enums.altitudeMode}\r\n   * @name cmapi.IGeoLookAt#altitudeMode\r\n   */\r\n  Object.defineProperty(this, \"altitudeMode\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitudeMode;\r\n    },\r\n\r\n    set: function(value) {\r\n      _altitudeMode = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _latitude = 0;\r\n  /**\r\n   * Latitude value in degrees decimal (i.e. 23.4567) derived from WGS-84\r\n   * @type {number}\r\n   * @name cmapi.IGeoLookAt#latitude\r\n   */\r\n  Object.defineProperty(this, \"latitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _latitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _latitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _longitude = 0;\r\n  /**\r\n   * Longitude value in degrees decimal (i.e. 23.4567) derived from WGS-84\r\n   * @type {number}\r\n   * @name cmapi.IGeoLookAt#longitude\r\n   */\r\n  Object.defineProperty(this, \"longitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _longitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _longitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _altitude = 0;\r\n  /**\r\n   * A value in meters representing the altitude of the associated position.  This will be interpreted base on the altitudeMode provided in the IGeoAltitudeMode enumeration\r\n   * @type {number}\r\n   * @name cmapi.IGeoLookAt#altitude\r\n   */\r\n  Object.defineProperty(this, \"altitude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _altitude = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _tilt = 0;\r\n  /**\r\n   * Rotation, in degrees, of the camera around the X axis. A value of 0 indicates that the view is aimed straight down toward the earth (the most common case). A value for 90 for <tilt> indicates that the view is aimed toward the horizon. Values greater than 90 indicate that the view is pointed up into the sky. Values for <tilt> are clamped at +180 degrees.\r\n   * @type {number}\r\n   * @name cmapi.IGeoLookAt#tilt\r\n   */\r\n  Object.defineProperty(this, \"tilt\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _tilt;\r\n    },\r\n\r\n    set: function(value) {\r\n      _tilt = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _heading = 0;\r\n  /**\r\n   * Direction (that is, North, South, East, West), in degrees. Default=0 (North). Values range from 0 to 360 degrees\r\n   * @type {number}\r\n   * @name cmapi.IGeoLookAt#heading\r\n   */\r\n  Object.defineProperty(this, \"heading\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _heading;\r\n    },\r\n\r\n    set: function(value) {\r\n      _heading = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _range = 1000000;\r\n  /**\r\n   * Distance in meters from the point specified by IGeoPosition to the LookAt position\r\n   * @type {number}\r\n   * @name cmapi.IGeoLookAt#range\r\n   */\r\n  Object.defineProperty(this, \"range\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _range;\r\n    },\r\n\r\n    set: function(value) {\r\n      _range = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoBounds} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoBounds = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _west;\r\n  /**\r\n   * @type {number}\r\n   * @name cmapi.IGeoBounds#west\r\n   */\r\n  Object.defineProperty(this, \"west\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _west;\r\n    },\r\n\r\n    set: function(value) {\r\n      _west = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _east;\r\n  /**\r\n   * @type {number}\r\n   * @name cmapi.IGeoBounds#east\r\n   */\r\n  Object.defineProperty(this, \"east\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _east;\r\n    },\r\n\r\n    set: function(value) {\r\n      _east = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _north;\r\n  /**\r\n   * @type {number}\r\n   * @name cmapi.IGeoBounds#north\r\n   */\r\n  Object.defineProperty(this, \"north\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _north;\r\n    },\r\n\r\n    set: function(value) {\r\n      _north = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _south;\r\n  /**\r\n   * @type {number}\r\n   * @name cmapi.IGeoBounds#south\r\n   */\r\n  Object.defineProperty(this, \"south\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _south;\r\n    },\r\n\r\n    set: function(value) {\r\n      _south = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoView} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoView = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _camera;\r\n  /**\r\n   * @type {cmapi.IGeoCamera}\r\n   * @name cmapi.IGeoView#camera\r\n   */\r\n  Object.defineProperty(this, \"camera\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _camera;\r\n    },\r\n\r\n    set: function(value) {\r\n      _camera = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _lookAt;\r\n  /**\r\n   * @type {cmapi.IGeoLookAt}\r\n   * @name cmapi.IGeoView#lookAt\r\n   */\r\n  Object.defineProperty(this, \"lookAt\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _lookAt;\r\n    },\r\n\r\n    set: function(value) {\r\n      _lookAt = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _bounds;\r\n  /**\r\n   * @type {cmapi.IGeoBounds}\r\n   * @name cmapi.IGeoView#bounds\r\n   */\r\n  Object.defineProperty(this, \"bounds\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _bounds;\r\n    },\r\n\r\n    set: function(value) {\r\n      _bounds = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _scale;\r\n  /**\r\n   * Approximate map scale of current view\r\n   * @type {number}\r\n   * @name cmapi.IGeoView#scale\r\n   */\r\n  Object.defineProperty(this, \"scale\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _scale;\r\n    },\r\n\r\n    set: function(value) {\r\n      _scale = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Object containing three color channels for red, green, and blue as well as an alpha channel for opacity\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoColor} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoColor = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _red = 0;\r\n  /**\r\n   * Value for red color channel. Integer ranging between 0 and 255\r\n   * @type {number}\r\n   * @name cmapi.IGeoColor#red\r\n   */\r\n  Object.defineProperty(this, \"red\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _red;\r\n    },\r\n\r\n    set: function(value) {\r\n      _red = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _green = 0;\r\n  /**\r\n   * Value for green color channel. Integer ranging between 0 and 255\r\n   * @type {number}\r\n   * @name cmapi.IGeoColor#green\r\n   */\r\n  Object.defineProperty(this, \"green\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _green;\r\n    },\r\n\r\n    set: function(value) {\r\n      _green = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _blue = 0;\r\n  /**\r\n   * Value for blue color channel. Integer ranging between 0 and 255\r\n   * @type {number}\r\n   * @name cmapi.IGeoColor#blue\r\n   */\r\n  Object.defineProperty(this, \"blue\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _blue;\r\n    },\r\n\r\n    set: function(value) {\r\n      _blue = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _alpha = 0.8;\r\n  /**\r\n   * Value for alpha channel to control opacity. Decimal ranging from 0 to 1\r\n   * @type {number}\r\n   * @name cmapi.IGeoColor#alpha\r\n   */\r\n  Object.defineProperty(this, \"alpha\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _alpha;\r\n    },\r\n\r\n    set: function(value) {\r\n      _alpha = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoStrokeStyle} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoStrokeStyle = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _strokeColor;\r\n  /**\r\n   * Color of a path, or outline color of a feature such as a polygon or circle.  The fill and stroke can be set separately to create a contract between the stroke and fill of any feature\r\n   * @type {cmapi.IGeoColor}\r\n   * @name cmapi.IGeoStrokeStyle#strokeColor\r\n   */\r\n  Object.defineProperty(this, \"strokeColor\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _strokeColor;\r\n    },\r\n\r\n    set: function(value) {\r\n      _strokeColor = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default stippling pattern\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _stipplingPattern = 0;\r\n  /**\r\n   * Specifies a number whose lower 16 bits define a pattern of which pixels in the image are white and which are transparent. Each bit corresponds to a pixel, and the pattern repeats after every n*16 pixels, where n is the factor. For example, if the factor is 3, each bit in the pattern is repeated three times before using the next bit\r\n   * @type {number}\r\n   * @name cmapi.IGeoStrokeStyle#stipplingPattern\r\n   */\r\n  Object.defineProperty(this, \"stipplingPattern\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _stipplingPattern;\r\n    },\r\n\r\n    set: function(value) {\r\n      _stipplingPattern = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default stipplingFactor\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _stipplingFactor = 0;\r\n  /**\r\n   * Specifies the number of times each bit in the pattern is repeated before the next bit is used. For example, if the factor is 3, each bit is repeated three times before using the next bit. The specified factor must be either 0 or an integer greater than 0. A factor of 0 indicates no stippling\r\n   * @type {number}\r\n   * @name cmapi.IGeoStrokeStyle#stipplingFactor\r\n   */\r\n  Object.defineProperty(this, \"stipplingFactor\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _stipplingFactor;\r\n    },\r\n\r\n    set: function(value) {\r\n      _stipplingFactor = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default stroke width\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _strokeWidth = 3;\r\n  /**\r\n   * Width of the stroke on the screen in pixels\r\n   * @type {number}\r\n   * @name cmapi.IGeoStrokeStyle#strokeWidth\r\n   */\r\n  Object.defineProperty(this, \"strokeWidth\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _strokeWidth;\r\n    },\r\n\r\n    set: function(value) {\r\n      _strokeWidth = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Style properties for the fill of a feature.  this can either be the interior of a shape such as a polygon or circle, or can also be applied to the fill of an a MIL-STD-2525 Icon to override the default affiliation color\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoFillStyle} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoFillStyle = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _description;\r\n  /**\r\n   * @type {string}\r\n   * @name cmapi.IGeoFillStyle#description\r\n   */\r\n  Object.defineProperty(this, \"description\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _description;\r\n    },\r\n\r\n    set: function(value) {\r\n      _description = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _fillColor;\r\n  /**\r\n   * @type {cmapi.IGeoColor}\r\n   * @name cmapi.IGeoFillStyle#fillColor\r\n   */\r\n  Object.defineProperty(this, \"fillColor\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _fillColor;\r\n    },\r\n\r\n    set: function(value) {\r\n      _fillColor = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _fillPattern = \"solid\";\r\n  /**\r\n   * Fill patterns allow for alternatives to a solid fill color\r\n   * @type {cmapi.enums.fillPattern}\r\n   * @name cmapi.IGeoFillStyle#fillPattern\r\n   */\r\n  Object.defineProperty(this, \"fillPattern\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _fillPattern;\r\n    },\r\n\r\n    set: function(value) {\r\n      _fillPattern = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoIconStyle} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoIconStyle = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Default size\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _size = 32;\r\n  /**\r\n   * Size in pixels.  If the icon is not square, the size will represent the larger value of the rectangle\r\n   * @type {number}\r\n   * @name cmapi.IGeoIconStyle#size\r\n   */\r\n  Object.defineProperty(this, \"size\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _size;\r\n    },\r\n\r\n    set: function(value) {\r\n      _size = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default x offset\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _offSetX = 0;\r\n  /**\r\n   * X Offset of icon in pixels derived from the lower left point of the icon\r\n   * @type {number}\r\n   * @name cmapi.IGeoIconStyle#offSetX\r\n   */\r\n  Object.defineProperty(this, \"offSetX\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _offSetX;\r\n    },\r\n\r\n    set: function(value) {\r\n      _offSetX = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default y offset\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _offSetY = 0;\r\n  /**\r\n   * Y Offset of icon in pixels derived from the lower right point of the icon\r\n   * @type {number}\r\n   * @name cmapi.IGeoIconStyle#offSetY\r\n   */\r\n  Object.defineProperty(this, \"offSetY\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _offSetY;\r\n    },\r\n\r\n    set: function(value) {\r\n      _offSetY = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Style properties for the optional text labels that may display next to feature data on a map\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoLabelStyle} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoLabelStyle = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Default size\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _size = 12;\r\n  /**\r\n   * Size of the font in pixels assuming 96 ppi. If the system rendering the text is running at a screen resolution other than 96 ppi, a translation should be done to make the text larger of smaller to represent the same amount of physical space as if the screen were at 96 ppi.  For example if the screen resolution of the target device rednering the text is 126 ppi, you would use the following formula to get a proper pixel value: ( devicePixelsPerInch / 96 ) x IGeoLabelStyle.size = ActualPixelSize or ( 126 / 96 ) * 12 = 16\r\n   * @type {number}\r\n   * @name cmapi.IGeoLabelStyle#size\r\n   */\r\n  Object.defineProperty(this, \"size\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _size;\r\n    },\r\n\r\n    set: function(value) {\r\n      _size = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _color;\r\n  /**\r\n   * The fill color for the text\r\n   * @type {cmapi.IGeoColor}\r\n   * @name cmapi.IGeoLabelStyle#color\r\n   */\r\n  Object.defineProperty(this, \"color\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _color;\r\n    },\r\n\r\n    set: function(value) {\r\n      _color = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _outlineColor;\r\n  /**\r\n   * The outline color for the text\r\n   * @type {cmapi.IGeoColor}\r\n   * @name cmapi.IGeoLabelStyle#outlineColor\r\n   */\r\n  Object.defineProperty(this, \"outlineColor\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _outlineColor;\r\n    },\r\n\r\n    set: function(value) {\r\n      _outlineColor = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default justification\r\n   * @type {cmapi.enums.justification}\r\n   * @private\r\n   */\r\n  var _justification = \"LEFT\";\r\n  /**\r\n   * Position to align text in relation to the associated geospatial coordinate\r\n   * @type {string}\r\n   * @name cmapi.IGeoLabelStyle#justification\r\n   */\r\n  Object.defineProperty(this, \"justification\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _justification;\r\n    },\r\n\r\n    set: function(value) {\r\n      _justification = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _fontFamily;\r\n  /**\r\n   * Name of the font family to be used.  In the case that the system rendering this text does not have the font family, it shall use a default font and still display the text\r\n   * @type {string}\r\n   * @name cmapi.IGeoLabelStyle#fontFamily\r\n   */\r\n  Object.defineProperty(this, \"fontFamily\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _fontFamily;\r\n    },\r\n\r\n    set: function(value) {\r\n      _fontFamily = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default typeface\r\n   * @type {cmapi.enums.typeface}\r\n   * @private\r\n   */\r\n  var _typeface = cmapi.enums.typeface.REGULAR;\r\n  /**\r\n   * @type {string}\r\n   * @name cmapi.IGeoLabelStyle#typeface\r\n   */\r\n  Object.defineProperty(this, \"typeface\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _typeface;\r\n    },\r\n\r\n    set: function(value) {\r\n      _typeface = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * This is the base object all containers and features are derived from\r\n * @interface\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoBase} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoBase = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  var _name = \"\";\r\n  /**\r\n   * Name is used to display text labels alongside to a feature and can be used in user interfaces that manage the data on the map\r\n   * @type {string}\r\n   * @name cmapi.IGeoBase#name\r\n   */\r\n  Object.defineProperty(this, \"name\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _name;\r\n    },\r\n\r\n    set: function(value) {\r\n      _name = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _geoId = cmapi.randomUUID();\r\n  /**\r\n   * The id value should be a UUID @see {@link https://www.ietf.org/rfc/rfc4122.txt} to avoid conflict of data from multiple sources.  All id values SHALL be unique regardless of type and conflicting id values will be treated as the same element.  Once this ID is set, it should not be changed to avoid refernces by ID to break.  The setter is provided so that an item can be deserialized from an object with an exisitng ID or provided an exisiting ID immediately after instantiation.\r\n   * @type {string}\r\n   * @name cmapi.IGeoBase#geoId\r\n   */\r\n  Object.defineProperty(this, \"geoId\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _geoId;\r\n    },\r\n\r\n    set: function(value) {\r\n      _geoId = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _dataProviderId;\r\n  /**\r\n   * This is a free form string that can represent an ID specific to this piece of data as it is tracked uniquely by the system providing this data.  This is different from GeoId as the GeoId is of type UUID.  Some systems may use IDs formatted in a way that it cannot be stored in a UUID.  In this case, this property can be used by the system to track this psece of data by the ID they use internally.  The GeoID proerty will be used by CMAPI as the unique ID and this ID is for the benefit of the system providing the data.\r\n   * @type {string}\r\n   * @name cmapi.IGeoBase#dataProviderId\r\n   */\r\n  Object.defineProperty(this, \"dataProviderId\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _dataProviderId;\r\n    },\r\n\r\n    set: function(value) {\r\n      _dataProviderId = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _description = \"\";\r\n  /**\r\n   * A simple string, or HTML formatted string that can be displayed to describe the IGeoBase.  In the case of a feature the description property can be used to store the content that should display in a pop up window after clicking on a feature.\r\n   * @type {string}\r\n   * @name cmapi.IGeoBase#description\r\n   */\r\n  Object.defineProperty(this, \"description\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _description;\r\n    },\r\n\r\n    set: function(value) {\r\n      _description = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _properties;\r\n  /**\r\n   * A key value pair where both the key and value where the key is a unique string and the value is an object that can be stored as and read from a string.  In cases where an IGeoBase will be serialized all of the values will be serialized using the objects toString() method.  It is the resposibility of the applications accessing values stored in the properties hash map to determine if the value is in a string format and convert back to whatever object type the string was derived from.  The object should not contain any references to other objects where that relationship is expected to exist beyond copying a current value of a simple type as the relationship will not be properly restored when deserialization occurs.  CMAPI will not use the properties hash for any internal purpose, it will simply allow 3rd party data to pass additional attributes that will stay associated with the CMAPI object as it moves between applications and systems.\r\n   * @type {object}\r\n   * @name cmapi.IGeoBase#properties\r\n   */\r\n  Object.defineProperty(this, \"properties\", {\r\n    enumerable: true,\r\n    get: function() {\r\n      return _properties;\r\n    }\r\n  });\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Geo containers are designed to be a base interface for anything that can contain a children list of IGeoBase objects.  This facilitates the concept of Containers such as overlays, as well as features such as a point that can contain child features.\r\n * @interface\r\n * @augments cmapi.IGeoBase\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoContainer} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoContainer = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoBase(), this);\r\n\r\n  var _readOnly = false;\r\n  /**\r\n   * Indicates if the object is intended to be read only (true) or allow changes to the values ot its properties (false)\r\n   * @type {boolean}\r\n   * @name cmapi.IGeoContainer#readOnly\r\n   */\r\n  Object.defineProperty(this, \"readOnly\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _readOnly;\r\n    },\r\n\r\n    set: function(value) {\r\n      _readOnly = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoContainer\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoRenderable} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoRenderable = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoContainer(), this);\r\n\r\n  var _altitudeMode;\r\n  /**\r\n   * Enumeration of altitude modes to define how the altitude value in an IGeoPosition alt (altitude) property will be interpreted\r\n   * @type {cmapi.enums.altitudeMode}\r\n   * @name cmapi.IGeoRenderable#altitudeMode\r\n   */\r\n  Object.defineProperty(this, \"altitudeMode\", {\r\n    enumerable: true,\r\n    get: function() {\r\n      return _altitudeMode;\r\n    },\r\n    set: function(value) {\r\n      _altitudeMode = value;\r\n    }\r\n  });\r\n\r\n  var _positions;\r\n  /**\r\n   * @type {cmapi.IGeoPosition[]}\r\n   * @name cmapi.IGeoRenderable#positions\r\n   */\r\n  Object.defineProperty(this, \"positions\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _positions;\r\n    },\r\n    set: function(value) {\r\n      _positions = value;\r\n    }\r\n  });\r\n\r\n  var _timeStamp;\r\n  /**\r\n   * @type {string}\r\n   * @name cmapi.IGeoRenderable#timeStamp\r\n   */\r\n  Object.defineProperty(this, \"timeStamp\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _timeStamp;\r\n    },\r\n\r\n    set: function(value) {\r\n      _timeStamp = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _timeSpans;\r\n  /**\r\n   * Defines one or more periods of time something occurred, or was active.\r\n   * @type {cmapi.IGeoTimeSpan[]}\r\n   * @name cmapi.IGeoRenderable#timeSpans\r\n   */\r\n  Object.defineProperty(this, \"timeSpans\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _timeSpans;\r\n    },\r\n\r\n    set: function(value) {\r\n      _timeSpans = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _labelStyle;\r\n  /**\r\n   * @type {cmapi.IGeoLabelStyle}\r\n   * @name cmapi.IGeoRenderable#labelStyle\r\n   */\r\n  Object.defineProperty(this, \"labelStyle\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _labelStyle;\r\n    },\r\n\r\n    set: function(value) {\r\n      _labelStyle = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _strokeStyle;\r\n  /**\r\n   * @type {cmapi.IGeoStrokeStyle}\r\n   * @name cmapi.IGeoRenderable#strokeStyle\r\n   */\r\n  Object.defineProperty(this, \"strokeStyle\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _strokeStyle;\r\n    },\r\n\r\n    set: function(value) {\r\n      _strokeStyle = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _fillStyle;\r\n  /**\r\n   * @type {cmapi.IGeoFillStyle}\r\n   * @name cmapi.IGeoRenderable#fillStyle\r\n   */\r\n  Object.defineProperty(this, \"fillStyle\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _fillStyle;\r\n    },\r\n\r\n    set: function(value) {\r\n      _fillStyle = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _extrude = false;\r\n  /**\r\n   * A curtain is formed below each point or line segment and extends to the ground\r\n   * @type {boolean}\r\n   * @name cmapi.IGeoRenderable#extrude\r\n   */\r\n  Object.defineProperty(this, \"extrude\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _extrude;\r\n    },\r\n\r\n    set: function(value) {\r\n      _extrude = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default tessellate\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  var _tessellate = true;\r\n  /**\r\n   * Value determines if the item will follow the terrain and drape, or follow a straight plane cutting through terrain\r\n   * above the altitude of the line segment.  This property is ignored for single position items.\r\n   * @type {boolean}\r\n   * @name cmapi.IGeoRenderable#tessellate\r\n   */\r\n  Object.defineProperty(this, \"tessellate\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _tessellate;\r\n    },\r\n\r\n    set: function(value) {\r\n      _tessellate = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default buffer\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _buffer = 0;\r\n  /**\r\n   * Indicates if a buffer object in meters can be applied to a single, or list of positions as an extension outwards from the original position(s)\r\n   * @type {number}\r\n   * @name cmapi.IGeoRenderable#buffer\r\n   */\r\n  Object.defineProperty(this, \"buffer\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _buffer;\r\n    },\r\n\r\n    set: function(value) {\r\n      _buffer = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _azimuth = 0;\r\n  /**\r\n   * @type {number}\r\n   * @name cmapi.IGeoRenderable#azimuth\r\n   */\r\n  Object.defineProperty(this, \"azimuth\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _azimuth;\r\n    },\r\n\r\n    set: function(value) {\r\n      _azimuth = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoPoint} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoPoint = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  var _iconStyle;\r\n  /**\r\n   * @type {cmapi.IGeoIconStyle}\r\n   * @name cmapi.IGeoPoint#iconStyle\r\n   */\r\n  Object.defineProperty(this, \"iconStyle\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _iconStyle;\r\n    },\r\n\r\n    set: function(value) {\r\n      _iconStyle = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _iconURI;\r\n  /**\r\n   * Indicates the URL to request the icon image image or dataURI encoding of the icon image embedded as the value defined by RFC 2397 (see https://tools.ietf.org/html/rfc2397)\r\n   * @type {string}\r\n   * @name cmapi.IGeoPoint#iconURI\r\n   */\r\n  Object.defineProperty(this, \"iconURI\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _iconURI;\r\n    },\r\n\r\n    set: function(value) {\r\n      _iconURI = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoText} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoText = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoPolygon} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoPolygon = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoPath} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoPath = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * A circular based forms single geospatial location as the center with a radius in meters\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoCircle} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoCircle = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  /**\r\n   * Default radius\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _radius = 100;\r\n\r\n  /**\r\n   * Radius of the circle in meters\r\n   * @type {number}\r\n   * @name cmapi.IGeoCircle#radius\r\n   */\r\n  Object.defineProperty(this, \"radius\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _radius;\r\n    },\r\n\r\n    set: function(value) {\r\n      _radius = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoEllipse} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoEllipse = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  /**\r\n   * Default semiMajor\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _semiMajor = 150;\r\n  /**\r\n   * The magnitude of the semi-major axis - Radius of the ellipse in meters on the x axis (width)\r\n   * @type {number}\r\n   * @name cmapi.IGeoEllipse#semiMajor\r\n   */\r\n  Object.defineProperty(this, \"semiMajor\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _semiMajor;\r\n    },\r\n\r\n    set: function(value) {\r\n      _semiMajor = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default semiMinor\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _semiMinor = 75;\r\n  /**\r\n   * The magnitude of the semi-minor axis - Radius of the ellipse in meters on the y axis (height)\r\n   * @property {number}\r\n   * @name cmapi.IGeoEllipse#semiMinor\r\n   */\r\n  Object.defineProperty(this, \"semiMinor\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _semiMinor;\r\n    },\r\n\r\n    set: function(value) {\r\n      _semiMinor = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoRectangle} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoRectangle = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  /**\r\n   * Default width\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _width = 150;\r\n  /**\r\n   * Width of the rectangle in meters on the x axis\r\n   * @type {number}\r\n   * @name cmapi.IGeoRectangle#width\r\n   */\r\n  Object.defineProperty(this, \"width\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _width;\r\n    },\r\n\r\n    set: function(value) {\r\n      _width = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default height\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _height = 75;\r\n  /**\r\n   * Height of the rectangle in meters on the y axis\r\n   * @type {number}\r\n   * @name cmapi.IGeoRectangle#height\r\n   */\r\n  Object.defineProperty(this, \"height\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _height;\r\n    },\r\n\r\n    set: function(value) {\r\n      _height = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoSquare} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoSquare = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  /**\r\n   * Default width\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  var _width = 100;\r\n  /**\r\n   * Width of the square in meters on the x axis\r\n   * @type {number}\r\n   * @name cmapi.IGeoSquare#width\r\n   */\r\n  Object.defineProperty(this, \"width\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _width;\r\n    },\r\n\r\n    set: function(value) {\r\n      _width = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoImageOverlay} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoImageOverlay = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  var _imageURI;\r\n  /**\r\n   * Indicates the URL to request the image or dataURI encoding of the icon image embedded as the value defined by RFC 2397 (see https://tools.ietf.org/html/rfc2397)\r\n   * @type {string}\r\n   * @name cmapi.IGeoImageOverlay#imageURI\r\n   */\r\n  Object.defineProperty(this, \"imageURI\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _imageURI;\r\n    },\r\n\r\n    set: function(value) {\r\n      _imageURI = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n *\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoMilSymbol} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoMilSymbol = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  /**\r\n   * Default symbolStandard\r\n   * @type {cmapi.enums.symbolStandard}\r\n   * @private\r\n   */\r\n  var _symbolStandard = \"2525c\";\r\n  /**\r\n   * Version of the MIL-STD-2525 standard to use\r\n   * @type {string}\r\n   * @name cmapi.IGeoMilSymbol#symbolStandard\r\n   */\r\n  Object.defineProperty(this, \"symbolStandard\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _symbolStandard;\r\n    },\r\n\r\n    set: function(value) {\r\n      _symbolStandard = value;\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Default symbolCode\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  var _symbolCode = \"SUGP-----------\";\r\n  /**\r\n   * Symbol code as defined by MIL-STD-2525\r\n   * @type {string}\r\n   * @name cmapi.IGeoMilSymbol#symbolCode\r\n   */\r\n  Object.defineProperty(this, \"symbolCode\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _symbolCode;\r\n    },\r\n\r\n    set: function(value) {\r\n      _symbolCode = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  /**\r\n   * Contains the symbol modifiers for a MIL-STD-2525 object.  Symbol modifiers\r\n   * usually are labels, but some may actually modify the shape or meaning of a MIL-STD-2525 object.\r\n   * Some symbols may require modifiers. Please consult the\r\n   * MIL-STD-2525Bch2 or MIL-STD-2525C documents supplemented with the most current\r\n   * USAS extension to determine format, length, and required modifiers for each\r\n   * symbol.  The MIL-STD-2525 also has more detailed descriptions of each of the modifiers\r\n   * purpose.\r\n   *\r\n   * @typedef {Object} cmapi.modifiers\r\n   *\r\n   * @property {number} [heading] Controls the rotation for single point icons.  Can be a number between -360 to 360.\r\n   * @property {String} [additionalInfo1]\r\n   * @property {String} [additionalInfo2]\r\n   * @property {String} [additionalInfo3]\r\n   * @property {Array}  [altitudeDepth] An array of numbers\r\n   * @property {Array}  [azimuth] An array of numbers indicating an angle in degrees or mils depending on the\r\n   *      MIL-STD-2525 and USAS\r\n   * @property {String} [combatEffectiveness]\r\n   * @property {String} [dateTimeGroup1] A date/time in format of 'DDHHMMSSZMONYYYY'\r\n   * @property {String} [dateTimeGroup2] A date/time in format of 'DDHHMMSSZMONYYYY'\r\n   * @property {String} [directionOfMovement]  A string of the numbers in the range of 0-360\r\n   * @property {Array}  [distance] An array of numbers\r\n   * @property {String} [equipmentType]\r\n   * @property {String} [evaluationRating] A 2-character string.  [A-F][1-6]\r\n   * @property {String} [higherFormation]\r\n   * @property {String} [hostile] Always use 'ENY'\r\n   * @property {String} [iffSiff]\r\n   * @property {String} [location] The location of the symbol--this is just a label and does not affect the actual location of the symbol</i>\r\n   * @property {String} [offsetIndicator]\r\n   * @property {String} [quantity]\r\n   * @property {String} [reinforcedOrReduced] R = reinforce, D = reduced, RD = reinforced and reduced\r\n   * @property {String} [signatureEquipment] Always use '!'\r\n   * @property {String} [specialC2Headquarters]\r\n   * @property {String} [speed]\r\n   * @property {String} [staffComments]\r\n   * @property {String} [uniqueDesignation1]\r\n   * @property {String} [uniqueDesignation2]\r\n   *\r\n   */\r\n  var _modifiers;\r\n  /**\r\n   * @type {cmapi.modifiers}\r\n   * @name cmapi.IGeoMilSymbol#modifiers\r\n   */\r\n  Object.defineProperty(this, \"modifiers\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _modifiers;\r\n    },\r\n\r\n    set: function(value) {\r\n      _modifiers = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * Air control measures (ACM) represent a three dimensional volume in the air above earth used to indicate where aircraft should stay within, or stay out of\r\n * @interface\r\n * @augments cmapi.IGeoRenderable\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoAirControlMeasure} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoAirControlMeasure = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  var _acmType;\r\n  /**\r\n   * Type of air control measure to create\r\n   * @type {cmapi.enums.acmType}\r\n   * @name cmapi.IGeoAirControlMeasure#acmType\r\n   */\r\n  Object.defineProperty(this, \"acmType\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _acmType;\r\n    },\r\n\r\n    set: function(value) {\r\n      _acmType = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _attributes;\r\n  /**\r\n   * @type {cmapi.attributes}\r\n   * @name cmapi.IGeoAirControlMeasure#attributes\r\n   */\r\n  Object.defineProperty(this, \"attributes\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _attributes;\r\n    },\r\n\r\n    set: function(value) {\r\n      _attributes = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n/**\r\n * File containing geospatial feature data in a known format such as KML or GeoJSON\r\n * @interface\r\n * @augments cmapi.IGeoBase\r\n * @param {object} [args] - An optional object containing any mixture of the properties that belong to {@link cmapi.IGeoDocument} or the parent classes it inherits properties from.  Any properties in the args object that are not known properties will be ignored\r\n */\r\ncmapi.IGeoDocument = function(args) {\r\n\r\n  \"use strict\";\r\n\r\n  cmapi.inherit(new cmapi.IGeoBase(), this);\r\n\r\n  var _documentURI;\r\n  /**\r\n   * URL the document should be loaded from, or a dataURI encoding of the resource embedded as the value defined by RFC 2397 (see https://tools.ietf.org/html/rfc2397)\r\n   * @type {string}\r\n   * @name cmapi.IGeoDocument#documentURI\r\n   */\r\n  Object.defineProperty(this, \"documentURI\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _documentURI;\r\n    },\r\n\r\n    set: function(value) {\r\n      _documentURI = value;\r\n    }\r\n\r\n  });\r\n\r\n  var _documentMIMEType;\r\n  /**\r\n   * MIME Type of document.  Common Types are KML (application/vnd.google-earth.kml+xml), and GeoJSON (application/vnd.geo+json)\r\n   * @type {string}\r\n   * @name cmapi.IGeoDocument#documentMIMEType\r\n   */\r\n  Object.defineProperty(this, \"documentMIMEType\", {\r\n\r\n    enumerable: true,\r\n    get: function() {\r\n      return _documentMIMEType;\r\n    },\r\n\r\n    set: function(value) {\r\n      _documentMIMEType = value;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  this.patchProps = function(update) {\r\n    var prop,\r\n      propVal;\r\n    for (prop in update) {\r\n      propVal = update[prop];\r\n      if (propVal !== undefined && propVal !== 'undefined') {\r\n        this[prop] = propVal;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (args) {\r\n    this.patchProps(args);\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * Copies properties from the target to the source\r\n * @ignore\r\n * @param source\r\n * @param target\r\n */\r\ncmapi.inherit = function(source, target) {\r\n  var prop;\r\n  for (prop in source) {\r\n    target[prop] = source[prop];\r\n  }\r\n};\r\n\r\n/**\r\n * @see {@link https://www.ietf.org/rfc/rfc4122.txt}\r\n * @returns {string} UUID\r\n */\r\ncmapi.randomUUID = function() {\r\n  function s(n) {\r\n    return h((Math.random() * (1 << (n << 2))) ^ Date.now()).slice(-n);\r\n  }\r\n\r\n  function h(n) {\r\n    return (n | 0).toString(16);\r\n  }\r\n\r\n  return [\r\n    s(4) + s(4), s(4),\r\n    '4' + s(3), // UUID version 4\r\n    h(8 | (Math.random() * 4)) + s(3), // {8|9|A|B}xxx\r\n    // s(4) + s(4) + s(4),\r\n    Date.now().toString(16).slice(-10) + s(2) // Use timestamp to avoid collisions\r\n  ].join('-');\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.enums) {\r\n  emp3.api.enums = {};\r\n}\r\n\r\n/**\r\n * Indicates if the view is currently in motion or if it\r\n * stopped.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.CameraEventEnum = {\r\n  /**\r\n   * The map is currently moving. The camera contains only the state of the\r\n   * map while it was in motion, which may not be a reliable indication of\r\n   * the current status of the camera.\r\n   */\r\n  CAMERA_IN_MOTION: 0,\r\n  /**\r\n   * The map is currently in a stable position.\r\n   */\r\n  CAMERA_MOTION_STOPPED: 1\r\n};\r\n\r\n/**\r\n * Indicates which operation occurred on a container.  Containers usually have\r\n * items added or removed.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.ContainerEventEnum = {\r\n  /**\r\n   * An object has been added to the container.\r\n   */\r\n  OBJECT_ADDED: 0,\r\n  /**\r\n   * An object has been removed from the container.\r\n   */\r\n  OBJECT_REMOVED: 1\r\n};\r\n\r\n/**\r\n * Specifies which phase a draw operation is in.  When a successful draw occurs\r\n * it will go through 3 phases in this order: start, update, complete.  A cancel\r\n * can occur in between any of the phases.  A cancel will end a draw without\r\n * committing the draw.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.FeatureDrawEventEnum = {\r\n  /**\r\n   * The draw operation was cancelled.\r\n   */\r\n  DRAW_CANCELLED: \"cancel\",\r\n  /**\r\n   * The draw operation has been completed.\r\n   */\r\n  DRAW_COMPLETE: \"complete\",\r\n  /**\r\n   * The draw operation has started.\r\n   */\r\n  DRAW_START: \"start\",\r\n  /**\r\n   * The user has modified the feature that was being drawn.\r\n   */\r\n  DRAW_UPDATE: \"update\"\r\n};\r\n\r\n/**\r\n * Specifies which phase an edit operation is in.  An edit will begin with the\r\n * start phase, at which point a complete, cancel, or update can occur.  An edit\r\n * can go through multiple updates.  A cancel indicates the feature should\r\n * return to the previous state it was in prior to the edit.   A complete\r\n * confirms the edit.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.FeatureEditEventEnum = {\r\n  /**\r\n   * The edit operation was cancelled.\r\n   */\r\n  EDIT_CANCELLED: \"cancel\",\r\n  /**\r\n   * The edit operation has been completed.\r\n   */\r\n  EDIT_COMPLETE: \"complete\",\r\n  /**\r\n   * The edit operation has started.\r\n   */\r\n  EDIT_START: \"start\",\r\n  /**\r\n   * The user has modified a property of the feature.  This can only occur\r\n   * after an EDIT_START, but before a EDIT_COMPLETE or an EDIT_CANCEL.\r\n   */\r\n  EDIT_UPDATE: \"update\"\r\n};\r\n\r\n/**\r\n * Indicates how a feature was edited during the update phase of the edit.\r\n * During a feature edit, the feature can be modified in various ways.  coordinates\r\n * of the feature can be added, updated, or removed.  In addition to coordinates\r\n * some feature classes contain properties that can be modified that do affect\r\n * the appearance of the feature but may not necessarily be coordinates.  for\r\n * instance, a circle has a radius property.  The radius is a distance, by\r\n * changing that the whole circle changes.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.FeatureEditUpdateType = {\r\n  /**\r\n   * An attribute associated with air control measures has been changed.\r\n   * ACM attributes examples are min alt, max alt, radius.  These are usually\r\n   * only associated with AirControlMeasure features.\r\n   */\r\n  ACM_ATTRIBUTE_UPDATED: \"acm\",\r\n  /**\r\n   * A coordinate has been added to the feature during an edit operation.\r\n   */\r\n  COORDINATE_ADDED: \"add\",\r\n  /**\r\n   * A coordinate has been modified on a feature during an edit operation.\r\n   */\r\n  COORDINATE_MOVED: \"update\",\r\n  /**\r\n   * A coordinate has been removed from a feature during an edit operation.\r\n   */\r\n  COORDINATE_DELETED: \"remove\",\r\n\r\n  /**\r\n   * A property was modified on the feature.\r\n   */\r\n  FEATURE_PROPERTY_UPDATED: \"property\",\r\n\r\n  /**\r\n   * An attribute associated with the MIL-STD-2525 has been modified.  These\r\n   * attributes control the position of the feature, but may not be associated\r\n   * with a coordinate.  Examples of attributes are the azimuth symbol modifier\r\n   * (AN) and the distance modifier (AM) of the MIL-STD-2525C\r\n   */\r\n  MILSTD_MODIFIER_UPDATED: \"modifier\",\r\n\r\n  /**\r\n   * The entire feature was moved to a new location.\r\n   */\r\n  POSITION_UPDATED: \"moved\"\r\n};\r\n\r\n/**\r\n * Indicates the selection state of a feature.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.FeatureEventEnum = {\r\n  /**\r\n   * Indicates a feature is deselected\r\n   */\r\n  FEATURE_DESELECTED: 0,\r\n  /**\r\n   * Indicates a feature is selected\r\n   */\r\n  FEATURE_SELECTED: 1\r\n};\r\n\r\n/**\r\n * Specifies a specific type of feature.\r\n * @readonly\r\n * @enum {string}\r\n */\r\nemp3.api.enums.FeatureTypeEnum = {\r\n  /**\r\n   * An air control measure.\r\n   */\r\n  GEO_ACM: 'airspace',\r\n  /**\r\n   * A Circle\r\n   */\r\n  GEO_CIRCLE: 'circle',\r\n  /**\r\n   * An ellipse\r\n   */\r\n  GEO_ELLIPSE: 'ellipse',\r\n  /**\r\n   * A MIL-STD-2525 symbol.\r\n   */\r\n  GEO_MIL_SYMBOL: 'milstd',\r\n  /**\r\n   * A path\r\n   */\r\n  GEO_PATH: 'path',\r\n  /**\r\n   * A point\r\n   */\r\n  GEO_POINT: 'point',\r\n  /**\r\n   * Polygon\r\n   */\r\n  GEO_POLYGON: 'polygon',\r\n  /**\r\n   * A rectangle\r\n   */\r\n  GEO_RECTANGLE: 'rectangle',\r\n  /**\r\n   * A square\r\n   */\r\n  GEO_SQUARE: 'square',\r\n  /**\r\n   * Free text on the map.\r\n   */\r\n  GEO_TEXT: 'text',\r\n  /**\r\n   * KML\r\n   */\r\n  KML: 'kml',\r\n  /**\r\n   * GeoJSON\r\n   */\r\n  GEOJSON: 'geojson'\r\n};\r\n\r\n/**\r\n * @readonly\r\n * @enum {string}\r\n */\r\nemp3.api.enums.IconSizeEnum = {\r\n  /**\r\n   * 1.8 x size original icon\r\n   */\r\n  LARGE: 'large',\r\n  /**\r\n   * 1.4 x size original\r\n   */\r\n  MEDIUM: 'medium',\r\n  /**\r\n   * original size\r\n   */\r\n  SMALL: 'small',\r\n  /**\r\n   * \"Smallest size possible\"\r\n   */\r\n  TINY: 'tiny'\r\n};\r\n\r\n/**\r\n * Indicates a state change occurred on the map.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.MapEventEnum = {\r\n  STATE_CHANGE: 0\r\n};\r\n\r\n/**\r\n * Specifies one of the 5 phases of the freehand draw mode available for a map container. Lines can be drawn on the map when\r\n * a map container enters into freehand draw mode. Each line begin and end has a state where it begins by a mouse down\r\n * or press and ends with a mouse up or release.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.MapFreehandEventEnum = {\r\n  /**\r\n   * The map is in freehand draw mode.  The map will allow lines to be\r\n   * drawn like a pen on top of it.\r\n   */\r\n  MAP_ENTERED_FREEHAND_DRAW_MODE: 0,\r\n  /**\r\n   * The map has exited freehand draw mode.  The map is now in normal\r\n   * operation.\r\n   */\r\n  MAP_EXIT_FREEHAND_DRAW_MODE: 1,\r\n  /**\r\n   * The map is in freehand draw mode and the user has completed drawing a\r\n   * line.\r\n   */\r\n  MAP_FREEHAND_LINE_DRAW_END: 2,\r\n  /**\r\n   * The map is already in freehand draw mode and the user has begun\r\n   * to draw a line.\r\n   */\r\n  MAP_FREEHAND_LINE_DRAW_START: 3,\r\n  /**\r\n   * The map is already in freehand draw mode and the user has updated\r\n   * the line.\r\n   */\r\n  MAP_FREEHAND_LINE_DRAW_UPDATE: 4\r\n};\r\n\r\n/**\r\n * Specifies the various user interface lock states of a map.  The map's screen\r\n * can be locked at various times to prevent user interaction.  The map can\r\n * prevent a zoom in or a pan, or prevent all motion altogether.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.MapMotionLockEnum = {\r\n  /**\r\n   * Prevents panning and zooming through both user interaction and map api\r\n   * commands.\r\n   */\r\n  NO_MOTION: 0,\r\n  /**\r\n   * The user cannot pan the map but may zoom in and out.\r\n   */\r\n  NO_PAN: 1,\r\n  /**\r\n   * The user cannot zoom in or out but may pan the map.\r\n   */\r\n  NO_ZOOM: 2,\r\n  /**\r\n   * The map cannot zoom or pan through user interaction\r\n   */\r\n  NO_ZOOM_NO_PAN: 3,\r\n  /**\r\n   * Map cannot zoom, will pan if you get close to edges.\r\n   */\r\n  SMART_MOTION: 4,\r\n  /**\r\n   * The user can interact with the map.\r\n   */\r\n  UNLOCKED: 5\r\n};\r\n\r\n\r\n/**\r\n * Specifies the readiness state of the map.   A map indicating it is ready\r\n * may begin accepting commands to process (but may not necessarily be displaying\r\n * the map yet.)\r\n *\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.MapStateEnum = {\r\n  // Should there be an INIT_FAIL enumeration value\r\n  /**\r\n   * Occurs before a MAP_READY.\r\n   */\r\n  INIT_IN_PROGRESS: 0,\r\n  /**\r\n   * The default state of map.  From here it will launch into INIT_IN_PROGRESS.\r\n   */\r\n  MAP_NEW: 1,\r\n\r\n  /**\r\n   * The map is ready to begin accepting api commands.\r\n   */\r\n  MAP_READY: 2,\r\n\r\n  /**\r\n   * The map is swapping to a new map engine.  Commands will be queued during\r\n   * this phase.\r\n   */\r\n  MAP_SWAP_IN_PROGRESS: 3,\r\n\r\n  /**\r\n   * The map has completed shutting down and can no longer be used.\r\n   */\r\n  SHUTDOWN: 4,\r\n\r\n  /**\r\n   * The map has begun the process of shutting down.\r\n   */\r\n  SHUTDOWN_IN_PROGRESS: 5\r\n};\r\n\r\n/**\r\n * Indicates if the view is currently in motion or if it\r\n * stopped.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.MapViewEventEnum = {\r\n\r\n\r\n  /**\r\n   * The map is currently moving.  The view contains only the state of the\r\n   * map while it was in motion, which may not be a reliable indication of\r\n   * the current status of the camera.\r\n   */\r\n  VIEW_IN_MOTION: 'viewInMotion',\r\n  /**\r\n   * The map is currently in a stable position.\r\n   */\r\n  VIEW_MOTION_STOPPED: 'viewStopped'\r\n};\r\n\r\n/**\r\n * Specifies a state for which labels should show for MIL-STD-2525 symbols.\r\n * @readonly\r\n * @enum {string}\r\n */\r\nemp3.api.enums.MilStdLabelSettingEnum = {\r\n  /**\r\n   * When the map renders a MIL-STD-2525 single point, it renders\r\n   * all symbol modifiers found in the MIL-STD-2525 if available.\r\n   */\r\n  ALL_LABELS: \"all\",\r\n  /**\r\n   * When the map renders a MIL-STD-2525 single point, it renders only\r\n   * unique designation, name, higher headquarters.\r\n   */\r\n  COMMON_LABELS: \"common\",\r\n  /**\r\n   * Labels required to be valid\r\n   */\r\n  REQUIRED_LABELS: \"required\"\r\n};\r\n\r\n/**\r\n * Specifies a state for device interaction.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.UserInteractionEventEnum = {\r\n  /**\r\n   * A click action occurred.\r\n   */\r\n  CLICKED: \"single\",\r\n  /**\r\n   * A double-click action occurred.\r\n   */\r\n  DOUBLE_CLICKED: \"double\",\r\n  /**\r\n   * For touch screens, a long press occurred.\r\n   */\r\n  LONG_PRESS: \"press\",\r\n  /**\r\n   * A mouse down action occurred.\r\n   */\r\n  MOUSE_DOWN: \"mouseDown\",\r\n  /**\r\n   * A mouse up action occurred.\r\n   */\r\n  MOUSE_UP: \"mouseUp\",\r\n  /**\r\n   * A mouse move action occurred.\r\n   */\r\n  MOUSE_MOVE: \"move\",\r\n\r\n  /**\r\n   * The map or a feature was dragged.\r\n   */\r\n  DRAG: \"drag\",\r\n\r\n  /**\r\n   * The drag was complete.\r\n   */\r\n  DRAG_COMPLETE: \"dragComplete\"\r\n};\r\n\r\n/**\r\n * Specifies the mouse button used for device interaction.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.UserInteractionMouseButtonEventEnum = {\r\n  /**\r\n   * Left mouse button interaction.\r\n   */\r\n  LEFT: 0,\r\n  /**\r\n   * Middle mouse button interaction.\r\n   */\r\n  MIDDLE: 1,\r\n  /**\r\n   * Right mouse button interaction.\r\n   */\r\n  RIGHT: 2\r\n};\r\n\r\n/**\r\n * Specifies the key used for device interaction.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.UserInteractionKeyEventEnum = {\r\n  /**\r\n   * Ctrl key interaction.\r\n   */\r\n  CTRL: 0,\r\n  /**\r\n   * Alt key interaction.\r\n   */\r\n  ALT: 1,\r\n  /**\r\n   * Shift key interaction.\r\n   */\r\n  SHIFT: 2\r\n};\r\n\r\n/**\r\n * Specifies a desired end state for changing the visibility of a container.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.VisibilityActionEnum = {\r\n  /**\r\n   * Hide everything underneath in a container, turning off visibility state\r\n   * for anything beneath it.\r\n   */\r\n  HIDE_ALL: 0,\r\n  /**\r\n   * Show everything in a container, regardless of the visibility state of\r\n   * its descendants visibility state.\r\n   */\r\n  SHOW_ALL: 1,\r\n  /**\r\n   * Hides everything under a container, but maintains the visibility state of\r\n   * its descendants.\r\n   */\r\n  TOGGLE_OFF: 2,\r\n  /**\r\n   * Toggles the visibility state of a container, adhering to the saved visibility\r\n   * state of its descendants prior to toggling off.  If it was off prior to\r\n   * toggling off it will be off when toggled on.\r\n   */\r\n  TOGGLE_ON: 3\r\n};\r\n\r\n/**\r\n * Specifies the current visibility of any container.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.VisibilityStateEnum = {\r\n  /**\r\n   * The item is not visible.\r\n   */\r\n  HIDDEN: 0,\r\n  /**\r\n   * The item is visible.\r\n   */\r\n  VISIBLE: 1,\r\n  /**\r\n   * The items is not visible because one of its parents is not visible.\r\n   */\r\n  VISIBLE_ANCESTOR_HIDDEN: 2\r\n};\r\n\r\n/**\r\n * Specifies a WMS version number.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nemp3.api.enums.WMSVersionEnum = {\r\n  /**\r\n   * WMS version 1.1\r\n   */\r\n  VERSION_1_1: \"1.1\",\r\n  /**\r\n   * WMS version 1.1.1\r\n   */\r\n  VERSION_1_1_1: \"1.1.1\",\r\n  /**\r\n   * WMS version 1.3\r\n   */\r\n  VERSION_1_3: \"1.3.0\"\r\n};\r\n\r\n/**\r\n * Identifies a specific event type than can occur on the map.\r\n * @enum {string}\r\n */\r\nemp3.api.enums.EventType = {\r\n  /**\r\n   * @desc Identifies a camera event type which any of the following types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   * - {@link emp3.api.Camera}\r\n   *\r\n   * A subscription to this event type, will cause an event object of type:\r\n   * - {@link emp3.api.events.CameraEvent}\r\n   *\r\n   * to generate in response to the {@link emp3.api.enums.CameraEventEnum} state change that occurred and passed to\r\n   * the registered callback function(s) that pertain to the subscribed types.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   * If multiple camera objects exist on a map container, changing the view of the map container will generate a\r\n   * {@link emp3.api.events.CameraEvent} to be passed to the registered callback function(s) for ONLY\r\n   * the currently set camera object if it has subscribed to this event. In this case even if other camera objects on\r\n   * the map container are subscribed to this event type, events will not be generated for them and their registered\r\n   * callbacks will not be executed because only one camera can be set on a map container at a time.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, changing the view\r\n   *  of the map container with {@link emp3.api.Map#zoomTo|emp3.api.Map.zoomTo()}\r\n   *  or {@link emp3.api.Map#setBounds|emp3.api.Map.setBounds()} will generate a {@link emp3.api.events.CameraEvent}'\r\n   *  to be passed to the registered callback function(s) that pertain to the subscribed map container.</li>\r\n   *  <li>If a camera object is subscribed to this event type, changing the view of the map container with\r\n   *  {@link emp3.api.Map#zoomTo|emp3.api.Map.zoomTo()} or {@link emp3.api.Map#setBounds|emp3.api.Map.setBounds()}\r\n   *  will generate a {@link emp3.api.events.CameraEvent} to be passed to the registered callback function(s) that\r\n   *  pertain to the subscribed camera object if it is currently set on the map container.</li>\r\n   * </ul>\r\n   */\r\n  CAMERA_EVENT: \"emp3.api.events.CameraEvent\",\r\n  /**\r\n   * @desc Identifies a container event type which any of the following types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   * - {@link emp3.api.Overlay}\r\n   * - {@link emp3.api.Feature}\r\n   *\r\n   * If a container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.ContainerEvent}\r\n   *\r\n   * will be generated in response to the {@link emp3.api.enums.ContainerEventEnum} action that occurred and passed to\r\n   * the registered callback function(s) that pertain to the subscribed container types.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, adding an overlay\r\n   *  container with {@link emp3.api.Map#addOverlay|emp3.api.Map.addOverlay()},\r\n   *  {@link emp3.api.Map#addOverlays|emp3.api.Map.addOverlays()},\r\n   *  {@link emp3.api.Overlay#addOverlay|emp3.api.Overlay.addOverlay()}, or\r\n   *  {@link emp3.api.Overlay#addOverlays|emp3.api.Overlay.addOverlays()}\r\n   *  to the map container will generate a {@link emp3.api.events.ContainerEvent} to be passed to\r\n   *  the registered callback function(s) that pertain to the subscribed map container.</li>\r\n   *  <li>If a map container currently has an overlay added to it and is subscribed to this event type, removing an\r\n   *  overlay container with {@link emp3.api.Map#removeOverlay|emp3.api.Map.removeOverlay()},\r\n   *  {@link emp3.api.Map#removeOverlays|emp3.api.Map.removeOverlays()},\r\n   *  {@link emp3.api.Overlay#removeOverlay|emp3.api.Overlay.removeOverlay()}, or\r\n   *  {@link emp3.api.Overlay#removeOverlays|emp3.api.Overlay.removeOverlays()} from the map container will generate a\r\n   *  {@link emp3.api.events.ContainerEvent} to be passed to the registered callback function(s) that pertain to the\r\n   *  subscribed map container.</li>\r\n   *  <li>If an overlay container is subscribed to this event type, adding an overlay container or a feature container\r\n   *  to the overlay container with {@link emp3.api.Overlay#addOverlay|emp3.api.Overlay.addOverlay()},\r\n   *  {@link emp3.api.Overlay#addOverlays|emp3.api.Overlay.addOverlays()},\r\n   *  {@link emp3.api.Feature#addFeature|emp3.api.Feature.addFeature()}, or\r\n   *  {@link emp3.api.Feature#addFeatures|emp3.api.Feature.addFeatures()} will generate a\r\n   *  {@link emp3.api.events.ContainerEvent} to be passed to the registered callback function(s) that pertain to the\r\n   *  subscribed overlay container.</li>\r\n   *  <li>If a feature container is subscribed to this event type, adding a feature container to the feature container\r\n   *  with {@link emp3.api.Feature#addFeature|emp3.api.Feature.addFeature()}, or\r\n   *  {@link emp3.api.Feature#addFeatures|emp3.api.Feature.addFeatures()} will generate a\r\n   *  {@link emp3.api.events.ContainerEvent} to be passed to the registered callback function(s) that pertain to the\r\n   *  subscribed feature container.</li>\r\n   * </ul>\r\n   */\r\n  CONTAINER: \"emp3.api.events.ContainerEvent\",\r\n  /**\r\n   * @desc Identifies a feature draw event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Feature}\r\n   *\r\n   * If a feature container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.FeatureDrawEvent}\r\n   *\r\n   * will be generated in response to the various {@link emp3.api.enums.FeatureDrawEventEnum} phases that can occur and\r\n   * passed to the registered callback function(s) that pertain to the subscribed feature container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a feature container is subscribed to this event type, performing a\r\n   *  {@link emp3.api.Map#drawFeature|emp3.api.Map.drawFeature()}, as well as any phase encountered during a\r\n   *  draw operation will generate a {@link emp3.api.events.FeatureDrawEvent} to be passed to the registered\r\n   *  callback function(s) that pertain to the subscribed feature container.</li>\r\n   * </ul>\r\n   */\r\n  FEATURE_DRAW: \"emp3.api.events.FeatureDrawEvent\",\r\n  /**\r\n   * @desc Identifies a feature edit event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Feature}\r\n   *\r\n   * If a feature container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.FeatureEditEvent}\r\n   *\r\n   * will be generated in response to the various {@link emp3.api.enums.FeatureEditEventEnum} phases that can occur and\r\n   * passed to the registered callback function(s) that pertain to the subscribed feature container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a feature container is subscribed to this event type, performing a\r\n   *  {@link emp3.api.Map#editFeature|emp3.api.Map.editFeature()}, as well as any phase encountered during an\r\n   *  edit operation will generate a {@link emp3.api.events.FeatureEditEvent} to be passed to the registered\r\n   *  callback function(s) that pertain to the subscribed feature container.</li>\r\n   * </ul>\r\n   */\r\n  FEATURE_EDIT: \"emp3.api.events.FeatureEditEvent\",\r\n  /**\r\n   * @desc Identifies a feature selection event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Feature}\r\n   *\r\n   * If a feature container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.FeatureEvent}\r\n   *\r\n   * will be generated in response to the various {@link emp3.api.enums.FeatureEventEnum} actions that can occur\r\n   * on the feature container and passed to the registered callback function(s) that pertain to the subscribed feature\r\n   * container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a feature container is subscribed to this event type, performing a\r\n   *  {@link emp3.api.Map#selectFeature|emp3.api.Map.selectFeature()},\r\n   *  {@link emp3.api.Map#selectFeatures|emp3.api.Map.selectFeatures()},\r\n   *  {@link emp3.api.Map#deselectFeature|emp3.api.Map.deselectFeature()},\r\n   *  {@link emp3.api.Map#deselectFeatures|emp3.api.Map.deselectFeatures()} will generate a\r\n   *  {@link emp3.api.events.FeatureEvent} to be passed to the registered callback function(s) that pertain to\r\n   *  the subscribed feature container.</li>\r\n   * </ul>\r\n   */\r\n  FEATURE_EVENT: \"emp3.api.events.FeatureEvent\",\r\n  /**\r\n   * @desc Identifies a feature interaction event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Feature}\r\n   *\r\n   * If a feature container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.FeatureUserInteractionEvent}\r\n   *\r\n   * will be generated in response to the various {@link emp3.api.enums.UserInteractionEventEnum} actions that can occur\r\n   * on the feature container and passed to the registered callback function(s) that pertain to the subscribed feature\r\n   * container.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   *  All {@link emp3.api.enums.UserInteractionEventEnum} actions will cause a\r\n   * {@link emp3.api.events.FeatureUserInteractionEvent} to generate with the exception of\r\n   * {@link emp3.api.enums.UserInteractionEventEnum|emp3.api.enums.UserInteractionEventEnum.MOUSE_MOVE} which is only\r\n   * relevant when subscribing to the {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_INTERACTION} event\r\n   * type.\r\n   */\r\n  FEATURE_INTERACTION: \"emp3.api.events.FeatureInteractionEvent\",\r\n  /**\r\n   * @desc Identifies a look at event type which any of the following types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   * - {@link emp3.api.LookAt}\r\n   *\r\n   * A subscription to this event type, will cause an event object of type:\r\n   * - {@link emp3.api.events.LookAtEvent}\r\n   *\r\n   * to generate in response to the {@link emp3.api.enums.LookAtEventEnum} state that occurred and passed to\r\n   * the registered callback function(s) that pertain to the subscribed types.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   * If multiple look at objects exist on a map container, changing the view of the map container will generate a\r\n   * {@link emp3.api.events.LookAtEvent} to be passed to the registered callback function(s) for ONLY\r\n   * the currently set look at object if it has subscribed to this event. In this case even if other look at objects on\r\n   * the map container are subscribed to this event type, events will not be generated for them and their registered\r\n   * callbacks will not be executed because only one look at can be set on a map container at a time.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, changing the view\r\n   *  of the map container will generate a {@link emp3.api.events.LookAtEvent} to be passed to the registered callback\r\n   *  function(s) that pertain to the subscribed map container.</li>\r\n   *  <li>If a look at object is subscribed to this event type, changing the view of the map container will generate a\r\n   *  {@link emp3.api.events.LookAtEvent} to be passed to the registered callback function(s) that pertain to the\r\n   *  subscribed look at object if it is currently set on the map container.</li>\r\n   * </ul>\r\n   */\r\n  LOOKAT_EVENT: \"emp3.api.events.LookAtEvent\",\r\n  /**\r\n   * @desc Identifies a map cursor move event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, a standard JSON object will be generated in response to the\r\n   * {@link emp3.api.enums.UserInteractionEventEnum|emp3.api.enums.UserInteractionEventEnum.MOUSE_MOVE} action that\r\n   * can occur on the map container and passed to the registered callback function(s) that pertain to the subscribed\r\n   * map container.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   * The {@link emp3.api.events.MapCursorMoveEvent} type is not currently generated for mouse move events. As mentioned,\r\n   * a standard JSON object is used instead.\r\n   */\r\n  MAP_CURSOR_MOVE: \"emp3.api.events.MapCursorMoveEvent\",\r\n  /**\r\n   * @desc Identifies a map interaction event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapFeatureAddedEvent}\r\n   *\r\n   * will be generated in response to a feature container being added to a map container and passed to the\r\n   * registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type and an overlay container\r\n   *  resides on it, performing a {@link emp3.api.Overlay#addFeature|emp3.api.Overlay.addFeature()}, or\r\n   *  {@link emp3.api.Overlay#addFeatures|emp3.api.Overlay.addFeatures()} on the overlay container will generate a\r\n   *  {@link emp3.api.events.MapFeatureAddedEvent} to be passed to the registered callback function(s) that pertain to\r\n   *  the subscribed map container.</li>\r\n   *  <li>If a map container is subscribed to this event having an overlay container residing on it as well as a feature\r\n   *  container residing on the overlay container, performing a {@link emp3.api.Feature#addFeature|emp3.api.Feature.addFeature()},\r\n   *  {@link emp3.api.Feature#addFeatures|emp3.api.Feature.addFeatures()} on the feature container will generate a\r\n   *  {@link emp3.api.events.MapFeatureAddedEvent} to be passed to the registered callback function(s) that pertain to\r\n   *  the subscribed map container.</li>\r\n   * </ul>\r\n   */\r\n  MAP_FEATURE_ADDED: \"emp3.api.events.MapFeatureAddedEvent\",\r\n  /**\r\n   * @desc Identifies a map interaction event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapFeatureUpdatedEvent}\r\n   *\r\n   * will be generated in response to a feature container being updated on a map container and passed to the\r\n   * registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, has an overlay container\r\n   *  residing on it which has a feature container residing on it, performing a\r\n   *  {@link emp3.api.Feature#apply|emp3.api.Feature.apply()} will generate a\r\n   *  {@link emp3.api.events.MapFeatureUpdatedEvent} to be passed to the registered callback function(s) that\r\n   *  pertain to the subscribed map container.</li>\r\n   * </ul>\r\n   */\r\n  MAP_FEATURE_UPDATED: \"emp3.api.events.MapFeatureUpdatedEvent\",\r\n  /**\r\n   * @desc Identifies a map interaction event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapFeatureRemovedEvent}\r\n   *\r\n   * will be generated in response to a feature container being removed from a map container and passed to the\r\n   * registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type and an overlay container\r\n   *  resides on it, performing a {@link emp3.api.Overlay#removeFeature|emp3.api.Overlay.removeFeature()}, or\r\n   *  {@link emp3.api.Overlay#removeFeatures|emp3.api.Overlay.removeFeatures()} on the overlay container will generate a\r\n   *  {@link emp3.api.events.MapFeatureRemovedEvent} to be passed to the registered callback function(s) that pertain to\r\n   *  the subscribed map container.</li>\r\n   * </ul>\r\n   */\r\n  MAP_FEATURE_REMOVED: \"emp3.api.events.MapFeatureRemovedEvent\",\r\n  /**\r\n   * @desc Identifies a map interaction event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapUserInteractionEvent}\r\n   *\r\n   * will be generated in response to the various {@link emp3.api.enums.UserInteractionEventEnum} actions that can occur\r\n   * on the map container and passed to the registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   * This event type pertains to the {@link emp3.api.enums.UserInteractionEventEnum} actions that occur specifically on\r\n   * a map container. If these listed actions occur on a feature container residing on the map container and the feature\r\n   * container has not subscribed to {@link emp3.api.events.FeatureInteractionEvent}, no callback(s) will execute.\r\n   */\r\n  MAP_INTERACTION: \"emp3.api.events.MapInteractionEvent\",\r\n  /**\r\n   * @desc Identifies a map free hand draw event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapFreehandEvent}\r\n   *\r\n   * will be generated in response to the various {@link emp3.api.enums.MapFreehandEventEnum} phases that can occur and\r\n   * passed to the registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, performing a\r\n   *  {@link emp3.api.Map#drawFreehand|emp3.api.Map.drawFreehand()}, or\r\n   *  {@link emp3.api.Map#drawFreehandExit|emp3.api.Map.drawFreehandExit()} as well as any phase encountered during the\r\n   *  free hand draw operation will generate a {@link emp3.api.events.MapFreehandEvent} to be passed to the registered\r\n   *  callback function(s) that pertain to the subscribed map container.</li>\r\n   * </ul>\r\n   */\r\n  MAP_FREEHAND_DRAW_EVENT: \"emp3.api.events.MapFreehandDrawEvent\",\r\n  /**\r\n   * @desc Identifies a map state change event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapStateChangeEvent}\r\n   *\r\n   * will be generated in response to the {@link emp3.api.enums.MapStateEnum} state change that occurred and passed\r\n   * to the registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   * The lifecycle of a map container consists of 6 stages represented by the {@link emp3.api.enums.MapStateEnum}\r\n   * values.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, performing a\r\n   *  {@link emp3.api.Map#purge|emp3.api.Map.purge()}, or {@link emp3.api.Map#swapMapEngine|emp3.api.Map.swapMapEngine()}\r\n   *  will generate {@link emp3.api.events.MapStateChangeEvent} for each state encountered during execution of these\r\n   *  map container operations to be passed to the registered callback function(s) that pertain to the subscribed map\r\n   *  container.</li>\r\n   * </ul>\r\n   */\r\n  MAP_STATE_CHANGE: \"emp3.api.events.MapStateChangeEvent\",\r\n  /**\r\n   * @desc Identifies a map view change event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   *\r\n   * If a map container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.MapViewChangeEvent}\r\n   *\r\n   * will be generated in response to the {@link emp3.api.enums.MapViewEventEnum} state change that occurred and passed\r\n   * to the registered callback function(s) that pertain to the subscribed map container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, moving the map\r\n   *  container with any of its various view change functions eg. {@link emp3.api.Map#zoomTo|emp3.api.Map.zoomTo()}\r\n   *  or {@link emp3.api.Map#setBounds|emp3.api.Map.setBounds()} will generate a\r\n   *  {@link emp3.api.events.MapViewChangeEvent} to be passed to the registered callback function(s) that pertain to\r\n   *  the subscribed map container.</li>\r\n   * </ul>\r\n   */\r\n  MAP_VIEW_CHANGE: \"emp3.api.events.MapViewChangeEvent\",\r\n  /**\r\n   * @desc Identifies an overlay change event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Overlay}\r\n   *\r\n   * If an overlay container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.OverlayUpdatedEvent}\r\n   *\r\n   * will be generated in response to the update that occurred on the to the registered callback function(s) that\r\n   * pertain to the subscribed overlay container.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If an overlay container is subscribed to this event type, updating the\r\n   *  description or the name on the overlay container with {@link emp3.api.Overlay#apply|emp3.api.Overlay.apply()}\r\n   *  will generate a {@link emp3.api.events.OverlayUpdatedEvent} to be passed to the registered callback function(s)\r\n   *  that pertain to the subscribed overlay container.</li>\r\n   * </ul>\r\n   */\r\n  OVERLAY_CHANGE: \"emp3.api.events.OverlayChangeEvent\",\r\n  /**\r\n   * @desc Identifies a visibility event type which any of the following container types can subscribe to:\r\n   * - {@link emp3.api.Map}\r\n   * - {@link emp3.api.Overlay}\r\n   * - {@link emp3.api.Feature}\r\n   *\r\n   * If a container subscribes to this event type, an event object of type:\r\n   * - {@link emp3.api.events.VisibilityEvent}\r\n   *\r\n   * will be generated in response to the {@link emp3.api.enums.VisibilityStateEnum} state change that occurred and\r\n   * passed to the registered callback function(s) that pertain to the subscribed container types.\r\n   *\r\n   * <u><i>Notes:</i></u>\r\n   * Since multiple instances of a unique overlay container and its unique child containers can reside on multiple\r\n   * unique map containers, there are two options available when subscribing to events of this type for overlay\r\n   * containers or feature containers. The first is overlay/feature container specific while the second is map\r\n   * container specific:\r\n   *\r\n   * 1) A unique overlay container or any of its unique child containers can subscribe directly to this event type in which\r\n   * case any instance of the overlay container or its child containers having a visibility change occur while residing\r\n   * on ANY map container will trigger the relevant callback(s) passed in during initial subscription to execute.\r\n   * This provides the convenience of having the unique overlay container or child container subscribe once to this event\r\n   * type regardless of the number of instances residing on unique map containers instead of these unique map containers\r\n   * each requiring a subscription to this event type.\r\n   *\r\n   * 2) A unique map container can subscribe directly to this event type in order to execute the callback(s) passed in\r\n   * during initial subscription when a visibility change occurs on ANY container residing on this unique map container.\r\n   * This provides convenience from the map container perspective by requiring only one subscription to this event type\r\n   * instead of requiring a subscription to this event type from every unique container residing on this map container.\r\n   *\r\n   * It should be noted that it is possible to subscribe to this event type on an overlay/feature container AND on the\r\n   * map container that these overlay/feature containers reside on. If this occurs, both callbacks that pertain to the\r\n   * subscribed overlay/feature and map containers will execute. These callbacks will receive duplicate\r\n   * {@link emp3.api.events.VisibilityEvent} items.\r\n   *\r\n   * <u><i>Sample Scenarios:</i></u>\r\n   * <ul style=\"list-style-type:circle\"><li>If a map container is subscribed to this event type, has an overlay container\r\n   *  added to it, and a feature container added to the overlay container, performing a\r\n   *  {@link emp3.api.Map#setVisibility|emp3.api.Map.setVisibility()} on the overlay container or the feature container\r\n   *  will generate a {@link emp3.api.events.VisibilityEvent} to be passed to the registered callback function(s) that\r\n   *  pertain to the subscribed map container.</li>\r\n   *  <li>If an overlay container is subscribed to this event type, has a feature container added to it that is also\r\n   *  subscribed to this event type, and resides on any number of map containers, performing a\r\n   *  {@link emp3.api.Map#setVisibility|emp3.api.Map.setVisibility()} on the overlay container or the feature container\r\n   *  will generate a {@link emp3.api.events.VisibilityEvent} to be passed to the registered callback function(s) that\r\n   *  pertain to the subscribed overlay container or feature container.</li>\r\n   * </ul>\r\n   */\r\n  VISIBILITY: \"emp3.api.events.VisibilityEvent\"\r\n};\r\n\r\n/**\r\n *\r\n * @readonly\r\n * @enum {string}\r\n */\r\nemp3.api.enums.messageCompletionStatus = {\r\n  FAILURE: \"failure\",\r\n  MIXED: \"mixed\",\r\n  SUCCESS: \"success\",\r\n  CANCELLED: \"cancelled\"\r\n};\r\n\r\n/**\r\n * @readonly\r\n * @enum {string}\r\n */\r\nemp3.api.enums.channel = {\r\n  mapShutdown: \"map.shutdown\",\r\n  convert: \"map.convert\",\r\n  swap: \"map.swap\",\r\n  convertResponse: \"map.convert.response\",\r\n  removeOverlay: \"map.overlay.remove\",\r\n  createOverlay: \"map.overlay.create\",\r\n  hideOverlay: \"map.overlay.hide\",\r\n  showOverlay: \"map.overlay.show\",\r\n  styleOverlay: \"map.overlay.style\",\r\n  updateOverlay: \"map.overlay.update\",\r\n  clearFeatures: \"map.overlay.clear\",\r\n  overlayClusterSet: \"map.overlay.cluster.set\",\r\n  overlayClusterActivate: \"map.overlay.cluster.activate\",\r\n  overlayClusterDeactivate: \"map.overlay.cluster.deactivate\",\r\n  overlayClusterRemove: \"map.overlay.cluster.remove\",\r\n  plotFeature: \"map.feature.plot\",\r\n  plotFeatureBatch: \"map.feature.plot.batch\",\r\n  draw: \"map.feature.draw\",\r\n  featureEdit: \"map.feature.edit\",\r\n  plotUrl: \"map.feature.plot.url\",\r\n  unplotFeature: \"map.feature.unplot\",\r\n  unplotFeatureBatch: \"map.feature.unplot.batch\",\r\n  hideFeature: \"map.feature.hide\",\r\n  showFeature: \"map.feature.show\",\r\n  updateFeature: \"map.feature.update\",\r\n  featureSelected: \"map.feature.selected\",\r\n  featureSelectedBatch: \"map.feature.selected.batch\",\r\n  featureDeselected: \"map.feature.deselected\",\r\n  featureDeselectedBatch: \"map.feature.deselected.batch\",\r\n  featureClicked: \"map.feature.clicked\",\r\n  featureMouseDown: \"map.feature.mousedown\",\r\n  featureMouseUp: \"map.feature.mouseup\",\r\n  get: \"map.get\",\r\n  clearMap: \"map.clear\",\r\n  statusScreenshot: \"map.status.screenshot\",\r\n  menuCreate: \"map.menu.create\",\r\n  menuClicked: \"map.menu.clicked\",\r\n  menuRemove: \"map.menu.remove\",\r\n  menuSetVisible: \"map.menu.active\",\r\n  zoom: \"map.view.zoom\",\r\n  centerOnOverlay: \"map.view.center.overlay\",\r\n  centerOnFeature: \"map.view.center.feature\",\r\n  centerOnLocation: \"map.view.center.location\",\r\n  centerOnBounds: \"map.view.center.bounds\",\r\n  lookAtLocation: \"map.view.lookat.location\",\r\n  coordinateSystem: \"map.view.coordinatesystem\",\r\n  lockView: \"map.view.lock\",\r\n  clicked: \"map.view.clicked\",\r\n  mouseup: \"map.view.mouseup\",\r\n  mousedown: \"map.view.mousedown\",\r\n  mousemove: \"map.view.mousemove\",\r\n  statusRequest: \"map.status.request\",\r\n  statusInitialization: \"map.status.initialization\",\r\n  statusView: \"map.status.view\",\r\n  statusFormat: \"map.status.format\",\r\n  statusAbout: \"map.status.about\",\r\n  statusCoordinateSystem: \"map.status.coordinatesystem\",\r\n  statusSelected: \"map.status.selected\",\r\n  error: \"map.error\",\r\n  transactionComplete: \"map.message.complete\",\r\n  cancel: \"map.message.cancel\",\r\n  messageProgress: \"map.message.progress\",\r\n  menuDrawingCreate: \"map.menu.drawing.create\",\r\n  menuDrawingComplete: \"map.menu.drawing.complete\",\r\n  menuDrawingRemove: \"map.menu.drawing.remove\",\r\n  getVisibility: \"cmapi2.visibility.get\",\r\n  config: \"cmapi2.map.config\",\r\n  featureAddEvent: \"cmapi2.map.feature.event.add\",\r\n  featureUpdateEvent: \"cmapi2.map.feature.event.update\",\r\n  featureRemoveEvent: \"cmapi2.map.feature.event.remove\",\r\n  freehandDrawStart: \"cmapi2.map.freehand.start\",\r\n  freehandDrawExit: \"cmapi2.map.freehand.stop\",\r\n  freehandLineDraw: \"cmapi2.map.freehand.linedraw\",\r\n  drag: \"cmapi2.map.view.drag\",\r\n  dragComplete: \"cmapi2.map.view.dragComplete\",\r\n  featureDrag: \"cmapi2.map.feature.drag\",\r\n  featureDragComplete: \"cmapi2.map.feature.dragComplete\"\r\n};\r\n\r\n/**\r\n * @deprecated\r\n * Predefined update Event Types generated by new map engines.\r\n * @private\r\n */\r\nemp3.api.enums.updateEventType = {\r\n  UPDATE: \"update\",\r\n  COMPLETE: \"complete\",\r\n  START: \"start\"\r\n};\r\n\r\nemp3.api.enums.version = \"ER1 Sprint 10\";\r\n\r\n/**\r\n *\r\n * @type {string}\r\n */\r\nemp3.api.enums.defaultMilStdLabelSetting = emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS;\r\n/**\r\n *\r\n * @type {number}\r\n */\r\nemp3.api.enums.defaultMidDistanceThreshold = 20000;\r\n/**\r\n *\r\n * @type {number}\r\n */\r\nemp3.api.enums.defaultFarDistanceThreshold = 600000;\r\n/**\r\n *\r\n * @type {string}\r\n */\r\nemp3.api.enums.defaultIconSize = emp3.api.enums.IconSizeEnum.SMALL;\r\n\r\n/**\r\n *\r\n * @type {{WMS: undefined, Layers: undefined}}\r\n */\r\nemp3.api.enums.defaultOverlayId = {\r\n  WMS: undefined,\r\n  Layers: undefined\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @interface\r\n * @augments cmapi.IGeoContainer\r\n * @classdesc This interface defines the method for all containers.\r\n */\r\nemp3.api.Container = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoContainer(), this);\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n/**\r\n * Adds an event listener to the container for a specific type. Not all container implementations support the same\r\n * types.\r\n *\r\n * Callbacks will need to support additional breakdown of types depending on which general\r\n * {@link emp3.api.enums.EventType} is being handled.\r\n *\r\n * Map supported events:\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.CONTAINER}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_CURSOR_MOVE}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_FEATURE_ADDED}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_FEATURE_UPDATED}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_FEATURE_REMOVED}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_INTERACTION}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_STATE_CHANGE}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.MAP_VIEW_CHANGE}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.VISIBILITY}\r\n *\r\n * Overlay supported events:\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.CONTAINER}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.OVERLAY_CHANGE}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.VISIBILITY}\r\n *\r\n * Feature supported events:\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.CONTAINER}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.FEATURE_DRAW}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.FEATURE_EDIT}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.FEATURE_EVENT}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.FEATURE_INTERACTION}\r\n * - {@link emp3.api.enums.EventType|emp3.api.enums.EventType.VISIBILITY}\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.EventType} args.eventType The event to attach to.  The callback will be called when this event occurs.\r\n * @param {function} args.callback Function to call when an event is received from the container.\r\n * @returns {function} The listener function that was installed.  This is used for removing the event listener.\r\n *\r\n * @example <caption>Adding a container event to a map</caption>\r\n * var added = map.addEventListener({\r\n *    eventType: emp3.api.enums.EventType.CONTAINER\r\n *    callback: myListener\r\n * });\r\n *\r\n * function myListener(event e) {\r\n *     // e is an OverlayAddedEvent in this case.\r\n *     console.log(e.overlay.name);\r\n * }\r\n *\r\n * @example <caption>Adding an overlay change event listener to an overlay</caption>\r\n * overlay.addEventListener({\r\n *   event: emp3.api.enums.EventType.CONTAINER\r\n *   callback: function(event) {\r\n *     // do something with the event\r\n *   }\r\n *  });\r\n *\r\n * @example <caption>Adding a feature interaction event listener to a feature</caption>\r\n * feature.addEventListener({\r\n *   event: emp3.api.EventType.FEATURE_INTERACTION\r\n *   callback: function(event) {\r\n *     switch (event.type) {\r\n *       case emp3.api.enums.UserInteractionEventEnum.LONG_PRESS:\r\n *         // handle long press\r\n *         break;\r\n *       default:\r\n *         // do nothing\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.Container.prototype.addEventListener = function (args) {\r\n  args = args || {};\r\n\r\n  if (!args.callback) {\r\n    throw new Error(\"Missing argument: callback\");\r\n  }\r\n\r\n  if (!args.eventType) {\r\n    throw new Error(\"Missing argument: eventType\");\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().addEventListener({\r\n    id: this.geoId,\r\n    event: args.eventType,\r\n    callback: args.callback\r\n  });\r\n\r\n  return args.callback;\r\n};\r\n\r\n/**\r\n * Removes an event listener from the container.  Event listeners must be removed\r\n * before destroying map instances to prevent a memory leak.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.EventType} args.eventType The event to remove.\r\n * @param {function} args.callback Function to remove, this will be returned from the initial call to addEventListener\r\n *\r\n * @example <caption>Adding a container event listener to a map</caption>\r\n * var map = new emp3.api.Map(...);\r\n *\r\n * var added = map.addEventListener({\r\n *   event: emp3.api.enums.EventType.CONTAINER,\r\n *   callback: function() {\r\n *     // do something;\r\n *   }\r\n * });\r\n *\r\n * map.removeEventListener({\r\n *   event: emp3.api.enums.EventType.CONTAINER,\r\n *   callback: added\r\n * });\r\n * */\r\nemp3.api.Container.prototype.removeEventListener = function (args) {\r\n  args = args || {};\r\n\r\n  if (!args.eventType) {\r\n    throw new Error(\"Missing argument: eventType\");\r\n  }\r\n\r\n  if (!args.callback) {\r\n    throw new Error(\"Missing argument: callback\");\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().removeEventListener({\r\n    id: this.geoId,\r\n    event: args.eventType,\r\n    callback: args.callback\r\n  });\r\n\r\n  return args.callback;\r\n};\r\n\r\n\r\n/**\r\n * This method removes all children from this container.\r\n */\r\nemp3.api.Container.prototype.clearContainer = function () {\r\n  throw new Error('clearContainer has not been implemented by this class');\r\n};\r\n\r\n/**\r\n * This method returns a list of parents of this container.\r\n */\r\nemp3.api.Container.prototype.getParents = function () {\r\n  throw new Error('getParents has not been implemented by this class');\r\n};\r\n\r\n/**\r\n * This method returns a list of parents of this container.\r\n */\r\nemp3.api.Container.prototype.getChildren = function () {\r\n  throw new Error('getChildren has not been implemented by this class');\r\n};\r\n\r\n/**\r\n * This method checks if the container has children.\r\n * This is a synchronous function.\r\n *\r\n * @returns {boolean}\r\n */\r\nemp3.api.Container.prototype.hasChildren = function () {\r\n  return emp3.api.MessageHandler.getInstance().hasChildren(this);\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * The camera manager stores the camera for maps externally from the core storage\r\n * The instance of the API manages the cameras as they are not shared with other clients\r\n * @ignore\r\n */\r\nemp3.api.CameraManager = (function () {\r\n  var INVALID_CAMERA_TYPE_ERROR = 'Invalid argument: expected camera to be emp3.api.Camera or geoId string';\r\n  var INVALID_MAP_TYPE_ERROR = 'Invalid argument: expected map to be emp3.api.Map or geoId string';\r\n\r\n  /**\r\n   * Map to Current Camera associations\r\n   * one to one relationship\r\n   * {mapId: camera}\r\n   */\r\n  var _mapToCamera = {};\r\n\r\n  function init() {\r\n    _mapToCamera = {};\r\n  }\r\n\r\n  /**\r\n   * Stores the camera for a map.\r\n   *\r\n   * @throws Will throw an error if arguments are missing\r\n   * @throws Will throw an error if the camera is not of type {@link emp3.api.Camera}\r\n   *\r\n   * @param {object} args\r\n   * @param {emp3.api.Camera} args.camera The Camera\r\n   * @param {emp3.api.Map | string} args.map The map or geoId of the map\r\n   */\r\n  function setCameraForMap(args) {\r\n    args = args || {};\r\n\r\n    if (!args.camera) {\r\n      throw new Error('Missing argument: camera');\r\n    } else if (!(args.camera instanceof emp3.api.Camera)) {\r\n      throw new TypeError('Invalid argument: camera is not of type emp3.api.Camera');\r\n    }\r\n\r\n    if (!args.map) {\r\n      throw new Error('Missing argument: map');\r\n    }\r\n\r\n    var mapId;\r\n    if (typeof args.map === 'string') {\r\n      mapId = args.map;\r\n    } else if (args.map instanceof emp3.api.Map) {\r\n      mapId = args.map.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_MAP_TYPE_ERROR);\r\n    }\r\n\r\n    _mapToCamera[mapId] = args.camera;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the current camera for a map\r\n   *\r\n   * @throws Will throw an error if arguments are missing\r\n   * @throws Will throw an error if the map is not {emp3.api.Map | string}\r\n   *\r\n   * @param {object} args\r\n   * @param {emp3.api.Map | string} args.map A map object or the geoId of the map\r\n   * @returns {emp3.api.Camera}\r\n   */\r\n  function getCameraForMap(args) {\r\n    args = args || {};\r\n\r\n    if (!args.map) {\r\n      throw new Error('Missing argument: map');\r\n    }\r\n    var mapId;\r\n    if (typeof args.map === 'string') {\r\n      mapId = args.map;\r\n    } else if (args.map instanceof emp3.api.Map) {\r\n      mapId = args.map.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_MAP_TYPE_ERROR);\r\n    }\r\n\r\n    return _mapToCamera[mapId];\r\n  }\r\n\r\n  /**\r\n   * Retrieves any maps associated with a camera\r\n   *\r\n   * @throws Will throw an error if arguments are missing\r\n   * @throws Will throw an error if the camera is not {string | emp3.api.Camera}\r\n   *\r\n   * @param {object} args\r\n   * @param {string|emp3.api.Camera} args.camera The camera or the camera's geoId\r\n   * @returns {string[]} The associated maps geoIds associated with the camera\r\n   */\r\n  function getMapsForCamera(args) {\r\n    args = args || {};\r\n\r\n    if (!args.camera) {\r\n      throw new Error('Missing argument: camera');\r\n    }\r\n\r\n    var cameraId;\r\n    if (typeof args.camera === 'string') {\r\n      cameraId = args.camera;\r\n    } else if (args.camera instanceof emp3.api.Camera) {\r\n      cameraId = args.camera.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_CAMERA_TYPE_ERROR);\r\n    }\r\n\r\n    var maps = [];\r\n    for (var map in _mapToCamera) {\r\n      if (_mapToCamera[map].geoId === cameraId) {\r\n        maps.push(map);\r\n      }\r\n    }\r\n    return maps;\r\n  }\r\n\r\n  /**\r\n   * Removes a map-to-camera association\r\n   *\r\n   * @throws Error if no args are setCamera\r\n   * @throws Error if the map is not of type {string|emp3.api.Map}\r\n   *\r\n   * @param {object} args\r\n   * @param {emp3.api.Map | string} args.map\r\n   */\r\n  function removeCameraForMap(args) {\r\n    args = args || {};\r\n\r\n    if (!args.map) {\r\n      throw new Error('Missing argument: map');\r\n    }\r\n    var mapId;\r\n    if (typeof args.map === 'string') {\r\n      mapId = args.map;\r\n    } else if (args.map instanceof emp3.api.Map) {\r\n      mapId = args.map.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_MAP_TYPE_ERROR);\r\n    }\r\n\r\n    delete _mapToCamera[mapId];\r\n  }\r\n\r\n  // ===========================================================================\r\n  // Public Interface\r\n  // ===========================================================================\r\n  return {\r\n    init: init,\r\n    setCameraForMap: setCameraForMap,\r\n    getCameraForMap: getCameraForMap,\r\n    getMapsForCamera: getMapsForCamera,\r\n    removeCameraForMap: removeCameraForMap\r\n  };\r\n})();\r\n","if (!window.emp3) {\r\n  window.emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  window.emp3.api = {};\r\n}\r\n\r\n/**\r\n * The lookAt manager stores the lookAt for maps externally from the core storage\r\n * The instance of the API manages the lookAts as they are not shared with other clients\r\n * @ignore\r\n */\r\nemp3.api.LookAtManager = (function () {\r\n  var INVALID_LOOKAT_TYPE_ERROR = 'Invalid argument: expected lookAt to be emp3.api.LookAt or geoId string';\r\n  var INVALID_MAP_TYPE_ERROR = 'Invalid argument: expected map to be emp3.api.Map or geoId string';\r\n\r\n  /**\r\n   * Map to Current lookAt associations\r\n   * one to one relationship\r\n   * {mapId: lookAt}\r\n   */\r\n  var _mapToLookAt = {};\r\n\r\n  function init() {\r\n    _mapToLookAt = {};\r\n  }\r\n\r\n  /**\r\n   * Stores the lookAt for a map.\r\n   *\r\n   * @throws Will throw an error if arguments are missing\r\n   * @throws Will throw an error if the lookAt is not {emp3.api.lookAt}\r\n   *\r\n   * @param {object} args\r\n   * @param {emp3.api.LookAt} args.lookAt The lookAt\r\n   * @param {emp3.api.Map | string} args.map The map or geoId of the map\r\n   */\r\n  function setLookAtForMap(args) {\r\n    args = args || {};\r\n\r\n    if (!args.lookAt) {\r\n      throw new Error('Missing argument: lookAt');\r\n    } else if (!(args.lookAt instanceof emp3.api.LookAt)) {\r\n      throw new TypeError('Invalid argument: lookAt is not of type emp3.api.LookAt');\r\n    }\r\n\r\n    if (!args.map) {\r\n      throw new Error('Missing argument: map');\r\n    }\r\n\r\n    var mapId;\r\n    if (typeof args.map === 'string') {\r\n      mapId = args.map;\r\n    } else if (args.map instanceof emp3.api.Map) {\r\n      mapId = args.map.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_MAP_TYPE_ERROR);\r\n    }\r\n\r\n    _mapToLookAt[mapId] = args.lookAt;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the current lookAt for a map\r\n   *\r\n   * @throws Will throw an error if arguments are missing\r\n   * @throws Will throw an error if the map is not {emp3.api.Map | string}\r\n   *\r\n   * @param {object} args\r\n   * @param {emp3.api.Map | string} args.map A map object or the geoId of the map\r\n   * @returns {emp3.api.LookAt}\r\n   */\r\n  function getLookAtForMap(args) {\r\n    args = args || {};\r\n\r\n    if (!args.map) {\r\n      throw new Error('Missing argument: map');\r\n    }\r\n    var mapId;\r\n    if (typeof args.map === 'string') {\r\n      mapId = args.map;\r\n    } else if (args.map instanceof emp3.api.Map) {\r\n      mapId = args.map.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_MAP_TYPE_ERROR);\r\n    }\r\n\r\n    return _mapToLookAt[mapId];\r\n  }\r\n\r\n  /**\r\n   * Retrieves any maps associated with a lookAt\r\n   *\r\n   * @throws Will throw an error if arguments are missing\r\n   * @throws Will throw an error if the lookAt is not {string | emp3.api.lookAt}\r\n   *\r\n   * @param {object} args\r\n   * @param {string|emp3.api.LookAt} args.lookAt The lookAt or the lookAt's geoId\r\n   * @returns {string[]} The associated maps geoIds associated with the lookAt\r\n   */\r\n  function getMapsForLookAt(args) {\r\n    args = args || {};\r\n\r\n    if (!args.lookAt) {\r\n      throw new Error('Missing argument: lookAt');\r\n    }\r\n\r\n    var lookAtId;\r\n    if (typeof args.lookAt === 'string') {\r\n      lookAtId = args.lookAt;\r\n    } else if (args.lookAt instanceof emp3.api.LookAt) {\r\n      lookAtId = args.lookAt.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_LOOKAT_TYPE_ERROR);\r\n    }\r\n\r\n    var maps = [];\r\n    for (var map in _mapToLookAt) {\r\n      if (_mapToLookAt[map].geoId === lookAtId) {\r\n        maps.push(map);\r\n      }\r\n    }\r\n    return maps;\r\n  }\r\n\r\n  /**\r\n   * Removes a map-to-lookAt association\r\n   *\r\n   * @throws Error if no args are set\r\n   * @throws Error if the map is not of type {string|emp3.api.Map}\r\n   *\r\n   * @param {object} args\r\n   * @param {emp3.api.Map | string} args.map\r\n   */\r\n  function removeLookAtForMap(args) {\r\n    args = args || {};\r\n\r\n    if (!args.map) {\r\n      throw new Error('Missing argument: map');\r\n    }\r\n    var mapId;\r\n    if (typeof args.map === 'string') {\r\n      mapId = args.map;\r\n    } else if (args.map instanceof emp3.api.Map) {\r\n      mapId = args.map.geoId;\r\n    } else {\r\n      throw new TypeError(INVALID_MAP_TYPE_ERROR);\r\n    }\r\n\r\n    delete _mapToLookAt[mapId];\r\n  }\r\n\r\n  // ===========================================================================\r\n  // Public Interface\r\n  // ===========================================================================\r\n  return {\r\n    init: init,\r\n    setLookAtForMap: setLookAtForMap,\r\n    getLookAtForMap: getLookAtForMap,\r\n    getMapsForLookAt: getMapsForLookAt,\r\n    removeLookAtForMap: removeLookAtForMap\r\n  };\r\n})();\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @ignore\r\n * @constructor\r\n * @param {object} args\r\n * @param {string} args.id\r\n * @param {string} args.mapId\r\n * @param {string} args.geoId\r\n */\r\nemp3.api.Transaction = function (args) {\r\n  args = args || {};\r\n  if (!args.id) {\r\n    throw new Error(\"Missing parameter: id has not been set\");\r\n  }\r\n\r\n  this.id = args.id;\r\n  this.mapId = args.mapId;\r\n  this.geoId = args.geoId;\r\n};\r\n\r\n/**\r\n * Cancels the transaction\r\n */\r\nemp3.api.Transaction.prototype.cancel = function () {\r\n  var cmd;\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.cancel,\r\n    transaction: this\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.mapId,\r\n    source: this,\r\n    method: \"Transaction.cancel\",\r\n    args: {}\r\n  });\r\n};\r\n\r\n/**\r\n * Completes the transaction\r\n */\r\nemp3.api.Transaction.prototype.complete = function () {\r\n  var cmd;\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.transactionComplete,\r\n    transaction: this\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.mapId,\r\n    source: this,\r\n    method: \"Transaction.complete\",\r\n    args: {}\r\n  });\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * If args.camera is set, the constructor creates the Camera with the Camera encapsulated within.\r\n * @class\r\n * @augments cmapi.IGeoCamera\r\n * @classdesc This class provides the Camera functionality. It encapsulates a GeoCamera.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoCamera}.\r\n *\r\n * @example\r\n * var cam = new emp3.api.Camera({\r\n *  latitude: 37.5,\r\n *  longitude: 18.2,\r\n *  altitude: 1000,\r\n *  heading: 47\r\n * });\r\n */\r\nemp3.api.Camera = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoCamera(args), this);\r\n\r\n  args = args || {};\r\n\r\n  if (typeof args.latitude !== 'undefined' && typeof args.latitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected latitude to be a number');\r\n  } else if (args.latitude > 90.0 || args.latitude < -90.0) {\r\n    throw new Error('Invalid latitude: latitude must be between 90.0 and -90.0');\r\n  }\r\n\r\n  if (typeof args.longitude !== 'undefined' && typeof args.longitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected longitude to be a number');\r\n  } else if (args.longitude > 180.0 || args.longitude < -180.0) {\r\n    throw new Error('Invalid longitude: longitude must be between 180.0 and -180.0');\r\n  }\r\n\r\n  if (typeof args.altitude !== 'undefined' && typeof args.altitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected altitude to be a number');\r\n  }\r\n  if (typeof args.roll !== 'undefined' && typeof args.roll !== 'number') {\r\n    throw new TypeError('Invalid argument: expected roll to be a number');\r\n  }\r\n  if (typeof args.heading !== 'undefined' && typeof args.heading !== 'number') {\r\n    throw new TypeError('Invalid argument: expected heading to be a number');\r\n  }\r\n  if (typeof args.tilt !== 'undefined' && typeof args.tilt !== 'number') {\r\n    throw new TypeError('Invalid argument: expected tilt to be a number');\r\n  }\r\n  if (typeof args.altitudeMode !== 'undefined') {\r\n    var validMode = false;\r\n    for (var mode in cmapi.enums.altitudeMode) {\r\n      if (args.altitudeMode === cmapi.enums.altitudeMode[mode]) {\r\n        validMode = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!validMode) {\r\n      throw new Error('Invalid Argument: altitudeMode is not valid');\r\n    }\r\n  } else {\r\n    // set altitudeMode to absolute if not set.\r\n    args.altitudeMode = cmapi.enums.altitudeMode.ABSOLUTE;\r\n  }\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n/**\r\n * This method adds an event listener to the camera.\r\n * @param {object} args\r\n * @param {function} args.callback\r\n * @param args.eventType\r\n */\r\nemp3.api.Camera.prototype.addCameraEventListener = function (args) {\r\n  args = args || {};\r\n\r\n  if (!args.callback) {\r\n    throw new Error(\"Missing argument: callback\");\r\n  }\r\n\r\n  if (typeof args.eventType === 'undefined') {\r\n    throw new Error(\"Missing argument: eventType\");\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().addEventListener({\r\n    id: this.geoId,\r\n    event: args.eventType,\r\n    callback: args.callback\r\n  });\r\n\r\n  return args.callback;\r\n};\r\n\r\n/**\r\n * This method must be used to remove the registration from the system\r\n * @param {object} args\r\n * @param {function} args.callback\r\n * @param args.eventType\r\n */\r\nemp3.api.Camera.prototype.removeEventListener = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.eventType === 'undefined') {\r\n    throw new Error(\"Missing argument: eventType\");\r\n  }\r\n\r\n  if (!args.callback) {\r\n    throw new Error(\"Missing argument: callback\");\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().removeEventListener({\r\n    id: this.geoId,\r\n    event: args.eventType,\r\n    callback: args.callback\r\n  });\r\n\r\n  return args.callback;\r\n};\r\n\r\n/**\r\n * This method causes any changes done with the camera settings to be applied to any maps using the camera.\r\n */\r\nemp3.api.Camera.prototype.apply = function () {\r\n  if (this.latitude > 90.0 || this.latitude < -90.0) {\r\n    throw new Error('Invalid latitude: latitude must be between 90.0 and -90.0');\r\n  }\r\n  if (this.longitude > 180.0 || this.longitude < -180.0) {\r\n    throw new Error('Invalid longitude: longitude must be between 180.0 and -180.0');\r\n  }\r\n\r\n  var maps = emp3.api.CameraManager.getMapsForCamera({camera: this});\r\n\r\n  for (var mapIt in maps) {\r\n    var map = emp3.api.MessageHandler.getInstance().lookupMap(maps[mapIt]);\r\n    if (map.getCamera().geoId === this.geoId) {\r\n      var cmd = {\r\n        cmd: emp3.api.enums.channel.centerOnLocation,\r\n        camera: this\r\n      };\r\n\r\n      emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n        mapId: map.geoId,\r\n        source: this,\r\n        method: \"Camera.apply\",\r\n        args: this\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * This method copies all settings from the camera object provided\r\n * This will exclude geoId\r\n *\r\n * @param {emp3.api.Camera} camera\r\n */\r\nemp3.api.Camera.prototype.copySettingsFrom = function (camera) {\r\n  if (typeof camera === 'undefined') {\r\n    throw new Error('Missing argument: camera');\r\n  }\r\n  if (!(camera instanceof emp3.api.Camera)) {\r\n    throw new TypeError('Invalid argument: camera is not of type emp3.api.Camera');\r\n  }\r\n\r\n  for (var prop in camera) {\r\n    if (camera.hasOwnProperty(prop) && prop !== 'geoId') {\r\n      this[prop] = camera[prop];\r\n    }\r\n  }\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @extends {cmapi.IGeoLookAt}\r\n *\r\n * This class defines a virtual camera which will focus on a location. The locations position is described with latitude,\r\n * longitude, and altitude. The camera will be placed according to three parameters: range, tilt, and heading.\r\n * @class\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoLookAt}.\r\n * @param {boolean} [args.animate] Animate the transition to the point or go directly there\r\n *\r\n * @example <caption>View the Eiffel Tower from the East from half a kilometer</caption>\r\n * var eiffelTower = new emp3.api.LookAt({\r\n *  latitude: 48.8584,\r\n *  longitude: 2.2945,\r\n *  altitude: 300,\r\n *  heading: 90,\r\n *  tilt: 15,\r\n *  range: 500\r\n * });\r\n *\r\n * map.setLookAt({\r\n *  lookAt: eiffelTower,\r\n *  onSuccess: function() {\r\n *\r\n *  }\r\n * });\r\n */\r\nemp3.api.LookAt = function (args) {\r\n  args = args || {};\r\n\r\n  cmapi.inherit(new cmapi.IGeoLookAt(args), this);\r\n\r\n  if (typeof args.latitude !== 'undefined' && typeof args.latitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected latitude to be a number');\r\n  } else if (args.latitude > 90.0 || args.latitude < -90.0) {\r\n    throw new Error('Invalid argument: expected latitude to be between 90.0 and -90.0');\r\n  }\r\n\r\n  if (typeof args.longitude !== 'undefined' && typeof args.longitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected longitude to be a number');\r\n  } else if (args.longitude > 180.0 || args.longitude < -180.0) {\r\n    throw new Error('Invalid argument: expected longitude to be between 180.0 and -180.0');\r\n  }\r\n\r\n  if (typeof args.altitude !== 'undefined' && typeof args.altitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected altitude to be a number');\r\n  }\r\n  if (typeof args.range !== 'undefined' && typeof args.range !== 'number') {\r\n    throw new TypeError('Invalid argument: expected range to be a number');\r\n  }\r\n  if (typeof args.heading !== 'undefined' && typeof args.heading !== 'number') {\r\n    throw new TypeError('Invalid argument: expected heading to be a number');\r\n  }\r\n  if (typeof args.tilt !== 'undefined') {\r\n    if (typeof args.tilt !== 'number') {\r\n      throw new TypeError('Invalid argument: expected tilt to be a number');\r\n    } else if (args.tilt < 0.0 || args.tilt > 180.0) {\r\n      throw new Error('Invalid argument: valid tilt values are between 0.0 and 180.0');\r\n    }\r\n  }\r\n\r\n  if (typeof args.altitudeMode !== 'undefined') {\r\n    var validMode = false;\r\n    for (var mode in cmapi.enums.altitudeMode) {\r\n      if (cmapi.enums.altitudeMode.hasOwnProperty(mode)){\r\n        if (args.altitudeMode === cmapi.enums.altitudeMode[mode]) {\r\n          validMode = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (!validMode) {\r\n      throw new Error('Invalid Argument: altitudeMode is not valid');\r\n    }\r\n  } else {\r\n    // if no value is set for altitudeMode set value to absolute.\r\n    args.altitudeMode = cmapi.enums.altitudeMode.ABSOLUTE;\r\n  }\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n/**\r\n * This method causes any changes done to the LookAt settings to be applied to any map or object that it may be\r\n * associated with.\r\n */\r\nemp3.api.LookAt.prototype.apply = function() {\r\n\r\n  if (this.tilt < 0.0 || this.tilt > 180.0) {\r\n    throw new Error('Invalid tilt value: expected tilt to be between 0.0 and 180.0');\r\n  }\r\n\r\n  if (this.latitude > 90.0 || this.latitude < -90.0) {\r\n    throw new Error('Invalid latitude: expected latitude to be between 90.0 and -90.0');\r\n  }\r\n\r\n  if (this.longitude > 180 || this.longitude < -180.0) {\r\n    throw new Error('Invalid longitude: expected longitude to be between 180.0 and -180.0');\r\n  }\r\n\r\n  var maps = emp3.api.LookAtManager.getMapsForLookAt({lookAt:this});\r\n\r\n  for (var mapIt in maps) {\r\n    var map = emp3.api.MessageHandler.getInstance().lookupMap(maps[mapIt]);\r\n    if (map.getLookAt().geoId === this.geoId) {\r\n      var cmd = {\r\n          cmd: emp3.api.enums.channel.lookAtLocation,\r\n          lookAt: this\r\n      };\r\n\r\n      emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n        mapId: map.geoId,\r\n        source: this,\r\n        method: \"LookAt.apply\",\r\n        args: this\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * This method copies all settings from the LookAt object provided.\r\n * This will exclude geoId\r\n *\r\n * @param {emp3.api.LookAt} lookAt\r\n */\r\nemp3.api.LookAt.prototype.copySettingsFrom = function(lookAt) {\r\n  if (!lookAt) {\r\n   throw new Error('Missing Argument: lookAt');\r\n  }\r\n\r\n  if (!(lookAt instanceof emp3.api.LookAt)) {\r\n    throw new TypeError('Invalid Argument: Expected emp3.api.LookAt');\r\n  }\r\n\r\n  for (var prop in lookAt) {\r\n    if (lookAt.hasOwnProperty(prop) && prop !== 'geoId') {\r\n      this[prop] = lookAt[prop];\r\n    }\r\n  }\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @extends emp3.api.Container\r\n * @classdesc Creates and displays Map instance.  Creating a map will initialize and\r\n * display the map engine.  The Map object allows you to control the view,\r\n * add features, overlays, and map services, draw, edit\r\n * existing data, query available data as well as number of other things.\r\n * <p>\r\n * A map displays features, overlays, and map services.  To add features to the map\r\n * you must first create and add an overlay. Overlays allow users to create groups of related\r\n * features together.  Overlays can be turned on or off to display or hide\r\n * its contained features.  Once the overlay is on the map, features can be added\r\n * into the overlay.  Overlays can contain features or other overlays. Features\r\n * cannot be added to the map directly, they must be added directly to an\r\n * overlay object.\r\n * <p>\r\n * To create a map you will first need to know which map engine you want to load.\r\n * There are a number of map engines included with this distribution.\r\n * The map currently is packaged with Cesium, Leaflet, and\r\n * WebWorldwind. The map engine displayed is entirely up to you.  When\r\n * you create the map you are required to enter an 'engine' parameter. The engine\r\n * parameter takes a emp3.api.MapEngine object.  For the engine parameter you will need to\r\n * make sure the map engine source code was deployed on your web server.  Depending on\r\n * your distribution, you may have a directory called emp3-cesium or a war file\r\n * called emp3-cesium.war (or emp3-leaflet or emp3-worldwind).  In the map constructor, set the\r\n * engine.engineBasePath to the relative location of the engine you are using. For instance, if\r\n * emp3-cesium directory is inside your application, set the engineBasePath to './emp3-cesium'.\r\n * You are also required to give your map engine a unique id.  This can be something\r\n * as simple as 'cesium'.  You will use this id only if you ever switch to\r\n * a different map engine.\r\n * <p>\r\n * The engine parameter also has two additional optional properties: 'manifestFileName' and 'properties'.\r\n * The 'manifestFileName' parameter allows you to configure which file is initially\r\n * loaded when the engine is called. The manifest file should bootstrap the loading\r\n * of the javascript files which loads up the map engine.\r\n * By default, this will loads the file 'manifest.js'.  Normally, you will not\r\n * have to set this, but there are a few edge cases you may want to change manifests.\r\n * <p>\r\n * Finally engine.properties sets some unique map engine specific properties.  These\r\n * properties differ from engine to engine.\r\n * <p>\r\n * The default behavior of the map, is to add the map as an embedded component\r\n * into a web application. This default\r\n * behavior is known as the \"environment\" of the map.  The default environment for map\r\n * is \"browser\". When using the \"browser\" environment, you need to\r\n * create an HTML div element and give it an id.  The id of that div should be\r\n * entered into the 'container' parameter of the constructor.\r\n * <p>\r\n * The map will also let you bypass the default environment settings and rather than\r\n * displaying the map as an embedded component it can be a stand-alone app\r\n * in some third party frameworks.  To change the default environment settings,\r\n * set the 'environment' parameter of the constructor to 'iwc' (OZP inter widget\r\n * communication), 'owf' (Ozone Widget Framework), 'starfish'.  Some environments\r\n * may require additional constructor parameters to be set.  For example, if the\r\n * environment is 'iwc' you must set the 'iwchost'.\r\n * <p>\r\n * The map's methods will not operate until it has negotiated a handshake\r\n * with its underlying map engine. Once it detects the map is \"ready\" (emp3.api.enums.MapStateEnum.MAP_READY),\r\n * you may begin calling the map object's methods.  If a call\r\n * is made prior to the map being ready, you will receive an exception.\r\n * Use the onSuccess callback to determine that the map has finished\r\n * initializing and is ready to start receiving commands.\r\n * <p>\r\n * The map object created should not be destroyed or go out of scope. Without\r\n * the map object you cannot control the map.\r\n * <p>\r\n *\r\n * @example <caption>Embedded HTML</caption>\r\n *\r\n * // Create a new Map and embed it on your web page.\r\n * // Start by configuring EMP.\r\n * emp3.api.global.configuration.urlProxy = \"../../urlproxy.jsp\";\r\n *\r\n * // Then construct a map with the cesium map engine.\r\n * var map1 = new emp3.api.Map({\r\n *    container: \"map-container\",\r\n *    engine: {\r\n *      \"engineBasePath\": \"./emp3-cesium\",\r\n *      \"mapEngineId\": 'cesiumMapEngine'\r\n *      }\r\n *    },\r\n *    onSuccess: function() {\r\n *      // load initial data...\r\n *    }\r\n * });\r\n *\r\n *\r\n * <p>\r\n *\r\n * @constructor\r\n *\r\n * @param {Object} args The constructor arguments for the map.\r\n *\r\n * @param {MapEngine} args.engine A map engine configuration object.\r\n *\r\n * @param {String} [args.environment='browser'] The environment for which the\r\n * map instance will interact with.  Either 'browser', 'iwc', 'owf', or 'starfish'\r\n *\r\n * @param {String} [args.container] The id of a div element in the HTML.  This is for embedding\r\n * the map directly in HTML.  This is a required parameter if the environment is set to\r\n * 'browser' which is the default value.\r\n *\r\n * @param {String} [args.iwcHost] The iwc host for which the map instance will communicate with.  Required\r\n * if the environment parameter is set to 'iwc'.\r\n *\r\n * @param {Bounds} [args.bounds] The location the map will start at.  Can be specified by passing in max north,\r\n * south, east, west bounds or by a center and a range or scale value. The map will do its best to center\r\n * on the bounds provided but it may not be the exact bounds.  This is because the map's aspect ration may\r\n * be different then the aspect ration of the map, or because the map may be 3D and the view may not easily\r\n * conform to exact specifications of bounds and scales.  If not set, the map will default to\r\n * the engines default position.\r\n *\r\n * @param {emp3.api.enums.IconSizeEnum} [args.iconSize = {@link emp3.api.enums.IconSizeEnum|SMALL}]\r\n * Default size for MIL-STD-2525 icons.\r\n *\r\n * @param {Number} [args.backgroundBrightness = 50] Lightens or darkens the background map.  Value can be\r\n * 0-100 with 50 as default. At 50, the map background is displayed without any\r\n * modifications.  Below 50 the map background will get darker and above 50 the\r\n * map background will get lighter. At zero the map background is fully black.  At 100\r\n * the map is fully white.\r\n *\r\n * @param {emp3.api.enums.MilStdLabelSettingEnum} [args.milStdLabels = {@link emp3.api.enums.MilStdLabelSettingEnum|COMMON_LABELS}]\r\n * Sets which labels will display for single point MIL-STD-2525 symbols.  By default,\r\n * the map will only display the common labels: unique designation, higher formation,\r\n * additional information and common name.\r\n *\r\n * @param {Number} [args.farDistanceThreshold = 600000] Sets the altitude (in meters)\r\n * at which point MIL-STD-2525 warfighting symbols\r\n * will display as dots. Below this\r\n * altitude the warfighting symbols will show normally (without labels) until\r\n * it hits the mid-distance threshold. At the mid-distance threshold,\r\n * the MIL-STD-2525 symbols will display with\r\n * labels according to {@link emp3.api.Map#getMilStdLabels|Map.getMilStdLabels}.\r\n *\r\n * @param {Number} [args.midDistanceThreshold = 20000] Sets the altitude in\r\n * meters at which point MIL-STD-2525 warfighting symbols\r\n * will show labels.\r\n * Above this altitude the MIL-STD-2525 symbols will not show labels.\r\n * To always\r\n * show labels, set the mid-distance threshold {@link emp3.api.Map#setMidDistanceThreshold|Map.setMidDistanceThreshold}\r\n * to be equal to {@link emp3.api.Map#setFarDistanceThreshold|Map.setFarDistanceThreshold}.\r\n *\r\n * @param {bool} [args.recorder = false] A debugging tool that records all the messages\r\n * coming into the map.  The recording can be saved and sent to the map developers.\r\n * When recorder is set to true, the map will display recording tools (record, stop, save and clear).\r\n *\r\n * @param {SuccessCallback} [args.onSuccess]\r\n * Function to call after the map has been initialized.\r\n *\r\n * @param {ErrorCallback} [args.onError] Function to call when an error occurs.\r\n */\r\nemp3.api.Map = function(args) {\r\n  var callInfo,\r\n    mhInstance,\r\n    urlEnv;\r\n\r\n  args = args || {};\r\n\r\n  // Use args parameter or if it is not present set it to browser\r\n  this.environment = args.environment || \"browser\";\r\n\r\n  // Check for an override of the environment in the URL query string\r\n  urlEnv = emp.util.getParameterByName('empenv');\r\n  if (urlEnv !== null) {\r\n    switch (urlEnv) {\r\n      case \"iwc\":\r\n        this.environment = \"iwc\";\r\n        break;\r\n      case \"starfish\":\r\n        this.environment = \"starfish\";\r\n        break;\r\n      case \"owf\":\r\n        this.environment = \"owf\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  // Verify container/environment is correct.\r\n  if (!args.container && this.environment === \"browser\" && args.container !== '') {\r\n    throw new Error(\"The container argument must be populated if environment is set to 'browser'\");\r\n  }\r\n\r\n  // Check for an override of the IWC Host URL in the URL query string. If not present, use args parameter.\r\n  args.iwcHost = emp.util.getParameterByName('iwchost') || args.iwcHost;\r\n  // This needs to stay here so it is properly set before trying to initialize the environment\r\n  emp.environment.iwc.iwcHost = args.iwcHost;\r\n\r\n\r\n  // Verify iwc/environment is correct.\r\n  if (!args.iwcHost && this.environment === \"iwc\") {\r\n    throw new Error(\"No iwcHost attribute was provided in emp3.api.Map args object nor an iwchost parameter present \" +\r\n      \"in the URL querystring. EMP cannot use the IWC environment without a specified iwchost pointing to the \" +\r\n      \"IWC location to be used by all participating applications.\");\r\n  }\r\n\r\n  // The readiness state of the map.  If not set to ready, then the map cannot\r\n  // be used yet.\r\n  this.status = emp3.api.enums.MapStateEnum.MAP_NEW;\r\n\r\n  // The instance ID of the map set by the Map API, will be populated after the map is\r\n  // instantiated.\r\n  this.geoId = undefined;\r\n\r\n  // The current map bounds. This is set by the getBounds call.  Do not set\r\n  // the bounds by changing this field.\r\n  this.bounds = {};\r\n\r\n  // Stores the engine information to be used with this map instance.\r\n  this.engine = args.engine;\r\n\r\n  // Stores the callbacks for success and failure.\r\n  args.onSuccess = args.onSuccess || function() {};\r\n  args.onError = args.onError || function() {};\r\n\r\n  // holds current transactions for editing and drawing.  When\r\n  // not drawing or editing these should be null.\r\n  this.drawTransaction = null;\r\n  this.editTransaction = null;\r\n\r\n  // If a default bounds was passed in, verify the values.\r\n  if (args.bounds) {\r\n    if (args.bounds.north === undefined || args.bounds.south === undefined || args.bounds.east === undefined || args.bounds.west === undefined) {\r\n      throw new Error(\"Invalid parameter bounds: bounds must contain at least north, east, south, and west\");\r\n    }\r\n  }\r\n\r\n  // Verify engine argument is correct.\r\n  if (!args.engine) {\r\n    throw new Error(\"An 'engine' argument must be populated\");\r\n  }\r\n  if (!args.engine.engineBasePath) {\r\n    throw new Error(\"An 'engineBasePath' argument must be populated\");\r\n  }\r\n  if (!args.engine.mapEngineId) {\r\n    throw new Error(\"An 'mapEngineId' argument must be populated\");\r\n  }\r\n\r\n  // if engine instance properties have not been created, set them.\r\n  if (!args.engine.properties) {\r\n    args.engine.properties = {};\r\n  }\r\n\r\n  // if engine is defined, pass the map engine properties to the engine\r\n  // if not already set.\r\n  // set the default icon size\r\n  if (args.iconSize !== undefined) {\r\n    this.iconSize = args.iconSize;\r\n  } else {\r\n    this.iconSize = emp3.api.enums.defaultIconSize;\r\n  }\r\n  args.engine.properties.iconSize = this.iconSize;\r\n\r\n  // set the default MIL-STD-2525 label settings.\r\n  if (args.milStdLabels !== undefined) {\r\n    this.milStdLabels = args.milStdLabels;\r\n  } else {\r\n    this.milStdLabels = emp3.api.enums.defaultMilStdLabelSetting;\r\n  }\r\n  args.engine.properties.milStdLabels = this.milStdLabels;\r\n\r\n\r\n  if (args.backgroundBrightness !== undefined) {\r\n    this.brightness = args.backgroundBrightness;\r\n  } else {\r\n    this.brightness = args.backgroundBrightness;\r\n  }\r\n  args.engine.properties.brightness = this.brightness;\r\n\r\n  // Turn on or off rendering optimization for MIL-STD-2525 warfighting symbols.\r\n  if (args.renderingOptimization !== undefined) {\r\n    this.renderingOptimization = args.renderingOptimization;\r\n  } else {\r\n    this.renderingOptimization = true;\r\n  }\r\n  args.engine.properties.renderingOptimization = this.renderingOptimization;\r\n\r\n  // set the default threshold values for MIL-STD-2525 warfighting symbols\r\n  if (args.midDistanceThreshold !== undefined) {\r\n    this.midDistanceThreshold = args.midDistanceThreshold;\r\n  } else {\r\n    this.midDistanceThreshold = emp3.api.enums.defaultMidDistanceThreshold;\r\n  }\r\n  args.engine.properties.midDistanceThreshold = this.midDistanceThreshold;\r\n\r\n  if (args.farDistanceThreshold !== undefined) {\r\n    this.farDistanceThreshold = args.farDistanceThreshold;\r\n  } else {\r\n    this.farDistanceThreshold = emp3.api.enums.defaultFarDistanceThreshold;\r\n  }\r\n  args.engine.properties.farDistanceThreshold = args.farDistanceThreshold;\r\n\r\n  // Set the default string for the manifestName property if needed.\r\n  args.engine.manifestName = args.engine.manifestName || \"manifest.js\";\r\n\r\n  var oThis = this;\r\n\r\n  // Retrieve the message handler\r\n  mhInstance = emp3.api.MessageHandler.getInstance({\r\n    environment: this.environment,\r\n    iwcHost: args.iwcHost,\r\n    container: args.container\r\n  });\r\n\r\n  // This callback will be called after the map is instantiated.\r\n  // After it is instantiated we want to determine if the map is ready. to\r\n  // be added.\r\n  var mapInstantiatedSuccess = function(cbArgs) {\r\n    // Retrieve the map's instance id from the arguments.  This will\r\n    // be passed back and can only be generated by the map.\r\n    oThis.geoId = cbArgs.id;\r\n    oThis.status = emp3.api.enums.MapStateEnum.MAP_READY;\r\n    // Notify the user when the map returns.\r\n    callInfo = {\r\n      mapId: oThis.geoId,\r\n      source: oThis,\r\n      method: \"Map\",\r\n      args: args\r\n    };\r\n    // SHOULD NOT HAVE TO DO THIS HERE --- ISN'T THERE A BETTER WAY?\r\n    // register the map with the message handler.\r\n    mhInstance.registerMap(oThis);\r\n    args.onSuccess({\r\n      callInfo: callInfo,\r\n      source: callInfo.source,\r\n      args: callInfo.args,\r\n      failures: cbArgs.failures\r\n    });\r\n    // TODO need to get the initial bounds\r\n  };\r\n\r\n  // If a container is provided, load the map into the container.\r\n  if (args.container && args.container !== \"\") {\r\n    //  The div that will contain the map.\r\n    this.container = args.container;\r\n    // setTimeout() is used to allow the map to finish construction before spawnMap() executes\r\n    setTimeout(function() {\r\n      mhInstance.spawnMap({\r\n        map: oThis,\r\n        defaultExtent: args.bounds,\r\n        container: args.container,\r\n        engine: oThis.engine,\r\n        environment: oThis.environment,\r\n        recorder: args.recorder,\r\n        onSuccess: mapInstantiatedSuccess,\r\n        onError: function(args) {\r\n          window.console.error(args);\r\n        }\r\n      });\r\n    }, 0);\r\n  }\r\n  else if (args.spawnMap) {\r\n    // if spawn map has been set, then we are in an Ozone environment,\r\n    // containerId will contain the name of the widget we want to launch.\r\n    // setTimeout() is used to allow the map to finish construction before spawnMap() executes\r\n    setTimeout(function() {\r\n      mhInstance.spawnMap({\r\n        map: this,\r\n        defaultExtent: args.bounds,\r\n        container: args.mapWidgetName || 'CPCE Map',\r\n        engine: this.engine,\r\n        environment: oThis.environment,\r\n        onSuccess: mapInstantiatedSuccess,\r\n        onError: function(args) {\r\n          window.console.error(args);\r\n        }\r\n      });\r\n    }.bind(this), 0);\r\n  }\r\n  else {\r\n    // Set the map's id to \"broadcast\".\r\n    // This indicates the map is not meant for a specific\r\n    // map instance and broadly will add to any map\r\n    // that is also a broadcast map.  This is how the\r\n    // Map API behaved prior to v3.\r\n    //\r\n    // For backwards compatibility for CPCE\r\n    // v2 behavior.\r\n    this.geoId = \"broadcast\";\r\n    // this.status = emp3.api.enums.MapStateEnum.MAP_READY;\r\n    mhInstance.registerMap(this);\r\n    // just wait for the map ready event.\r\n    // Notify the user when the map returns.\r\n    callInfo = {\r\n      mapId: this.geoId,\r\n      source: this,\r\n      method: \"Map\",\r\n      args: args\r\n    };\r\n\r\n    mhInstance.notifyOnReady({\r\n      callInfo: callInfo,\r\n      args: {\r\n        id: this.geoId,\r\n        onSuccess: function() {\r\n          oThis.status = emp3.api.enums.MapStateEnum.MAP_READY;\r\n          args.onSuccess({\r\n            callInfo: callInfo,\r\n            source: callInfo.source,\r\n            args: callInfo.args,\r\n            failures: []\r\n          });\r\n        },\r\n        onError: function(args) {\r\n          window.console.error(args);\r\n        }\r\n      }\r\n    });\r\n    this.status = emp3.api.enums.MapStateEnum.MAP_READY;\r\n  }\r\n};\r\n\r\n// Extend container\r\nemp3.api.Map.prototype = new emp3.api.Container();\r\n\r\n/**\r\n * @typedef {Object} MapEngine Configuration settings for a map engine.\r\n *\r\n * @property {String} engineBasePath A relative or full URL specifying the location\r\n * of a map engine.\r\n * @property {String} mapEngineId Unique identifier for the map engine to be loaded.\r\n * @property {String} [manifestName] The name of the map engine's manifest file. Each\r\n * map engine has a manifest file associated with it. This manifest file\r\n * bootstraps the engine.\r\n * @property {CesiumProperties | LeafletProperties | WorldwindProperties} [properties]\r\n * A JSON object containing additional configuration\r\n * properties for the map engine to be loaded. These properties may vary from engine to engine.\r\n */\r\n\r\n/**\r\n * @typedef {Object} CesiumProperties The configurable properties for the\r\n * Cesium map engine. This should be used for the the MapEngine.properties field.\r\n *\r\n * @property {String} [defaultImageryUrl] A URL to a WMS server that will provide\r\n * the default globe background for Cesium.  If no url is provided, Cesium\r\n * provides its own.\r\n * @property {Object} [cesiumNavigation] Contains the options to display the\r\n * Cesium navigation tools.\r\n * @property {boolean} [cesiumNavigation.enableCompass] Displays the compass\r\n * that shows the which direction the map is aligned.  Clicking on north will\r\n * reset the globe's direction back to north.\r\n * @property {boolean} [cesiumNavigation.enableZoomControls] Displays the\r\n * \"plus\" and \"minus\" zoom out and zoom in buttons that zoom at a fixed distance.\r\n * @property {boolean} [cesiumNavigation.distanceLegend] Shows the distance legend\r\n * that estimates the measurements of the distance on the map for a fixed width\r\n * @property {boolean} [renderingOptimization] Turns on or off rendering optimization\r\n * for drawing MIL-STD-2525 single point graphics.  When rendering optimization is\r\n * turned on, MIL-STD-2525 single points will render as dots when the camera goes\r\n * higher than a specified altitude.  Below the far threshold, the single points\r\n * will display in their correct appearance, but with no labels.  When they zoom\r\n * past the midpoint threshold, they will display normal with labels.  This\r\n * greatly increases the number of symbols and ability for the map to\r\n * Rendering optimization\r\n * @property {number} [midDistanceThreshold] The\r\n * altitude at which below single point MIL-STD-2525 symbols will display with\r\n * labels, and above, they will display without labels.\r\n * @property {number} [farDistanceThreshold] The\r\n * altitude at which above single point MIL-STD-2525 symbols will display as colored\r\n * dots.\r\n * @property {boolean} [debug] Set to true to avoid using the minified version\r\n * of the Cesium engine files.\r\n */\r\n\r\n/**\r\n * @typedef {Object} LeafletProperties\r\n *\r\n * @property {Object} [data] Specifies the default background for Leaflet.\r\n * Without specifying the default background Leaflet will show a plain grey\r\n * background.\r\n * @property {String} [data.Default_Tile_Map_Server_URL] A Tile Layer URL in the\r\n * format of a Leaflet URL template object ({@link http://leafletjs.com/reference.html#url-template}).\r\n * Details of tile layer format can be found at {@link http://doc.arcgis.com/EN/ARCGIS-ONLINE/REFERENCE/tile-layers.htm}.\r\n * @property {number} [data.Minimum_Zoom_Level] Minimum zoom level of the map.\r\n * @property {number} [data.Maximum_Zoom_Level] Maximum zoom level of the map.\r\n * @property {boolean} [data.Use_Proxy_For_Default_Map_Request = false] Determines\r\n * if the map's proxy will be used to request the map specified in Default_Tile_Map_Server_URL.\r\n * You would only use this if the map was not reachable because it is cross domain\r\n * and there isn't a viable proxy that can be used.\r\n * @property {boolean} [renderingOptimization] Turns on or off rendering optimization\r\n * for drawing MIL-STD-2525 single point graphics.  When rendering optimization is\r\n * turned on, MIL-STD-2525 single points will render as dots when the camera goes\r\n * higher than a specified altitude.  Below the far threshold, the single points\r\n * will display in their correct appearance, but with no labels.  When they zoom\r\n * past the midpoint threshold, they will display normal with labels.  This\r\n * greatly increases the number of symbols and ability for the map to\r\n * Rendering optimization\r\n * @property {number} [midDistanceThreshold] The\r\n * altitude at which below single point MIL-STD-2525 symbols will display with\r\n * labels, and above, they will display without labels.\r\n * @property {number} [farDistanceThreshold] The\r\n * altitude at which above single point MIL-STD-2525 symbols will display as colored\r\n * dots.\r\n * @property {boolean} [debug] Set to true to avoid using the minified version\r\n * of the Leaflet engine files.\r\n *\r\n */\r\n\r\n/**\r\n * @typedef {Object} WorldwindProperties\r\n *\r\n * @property {Object} layers Contains the options to display the Web\r\n * Worldwind navigation tools.\r\n * @property {boolean} [layers.controls = false] Set to true to display the\r\n * navigation controls for the map.\r\n * @property {boolean} [layers.compass = false] Displays the compass\r\n * that shows the which direction the map is aligned.  Clicking on north will\r\n * reset the globe's direction back to north.\r\n * @property {boolean} [layers.coordinates = false] Displays the coordinates\r\n * of where the mouse is.\r\n * @property {boolean} [debug] Set to true to avoid using the minified version\r\n * of the Web Worldwind engine files.\r\n */\r\n\r\n/**\r\n * @typedef {Object} Bounds Represents the view of a map.  The map bounds can be represented\r\n * by either specifying the max bounds of the view, or by specifying the center and range or scale.\r\n *\r\n * @property {Number} north The north-most bounds of the extent\r\n * @property {Number} south The south-most bounds of the extent\r\n * @property {Number} east The east-most bounds of the extent\r\n * @property {Number} west The west-most bounds of the extent\r\n */\r\n\r\n/**\r\n * A callback indicating success in an operation involving a {@link emp3.api.MapService|MapService}\r\n * @callback onSuccessMapServiceCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n * @param {emp3.api.MapService} cbArgs.mapService The map service that was added\r\n * or removed.\r\n *\r\n */\r\n\r\n/**\r\n * A callback indicating success in returning a group of Overlays.\r\n *\r\n * @callback onSuccessOverlaysCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays - An array of emp3.api.Overlay objects.\r\n *\r\n * @param {Array} cbArgs.failures - Any failures that occurred while executing the call.\r\n *\r\n */\r\n\r\n/**\r\n * A callback indicating success in returning a group of Features.\r\n *\r\n * @callback onSuccessFeaturesCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {emp3.api.Feature[]} cbArgs.features - An array of emp3.api.Feature objects.\r\n *\r\n * @param {Array} cbArgs.failures - Any failures that occurred while executing the call.\r\n *\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Map~clearContainerCallback\r\n */\r\n\r\n/**\r\n * A callback indicating success in returning a group of Layers.\r\n *\r\n * @callback onSuccessMapServicesCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {emp3.api.MapService[]} cbArgs.services - An array of emp3.api.MapService objects.\r\n */\r\n\r\n/**\r\n * A callback indicating a function successfully altered the Map's camera position.\r\n *\r\n * @callback onSuccessCameraCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {emp3.api.Camera} cbArgs.camera The camera containing the settings after\r\n * it has been changed.\r\n */\r\n\r\n\r\n/**\r\n * A callback indicating a function successfully executed and returned an extent.\r\n *\r\n * @callback onSuccessBoundsCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {Bounds} cbArgs.newBounds The new bounds of the map.\r\n */\r\n\r\n/**\r\n * A callback indicating a screenshot was successfully taken by the map.\r\n * The callback will contain a base64 image of the map as encoded by the HTML canvas.getDataURL\r\n * function.\r\n *\r\n * @callback onGetScreenshotSuccessCallback\r\n *\r\n * @param {Object} cbArgs The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {Object} cbArgs.dataUrl A base64 encoded image of the map.\r\n */\r\n\r\n/**\r\n * A callback returning the visibility status of a Container or the visibility status of\r\n * an instance.\r\n * @callback onSuccessVisibilityCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {Container} cbArgs.target The container to which the visibility status pertains to.\r\n * @param {Container} [cbArgs.parent] A parent container if the target pertains to a specific instance\r\n * @param {emp3.api.enums.VisibilityStateEnum} cbArgs.visible The current visibility\r\n * state of the specified feature if no parent has been specified, this can be\r\n * either HIDDEN or VISIBLE.  If cbArgs.parent\r\n * has been specified, returns the visibility state in relation to that specified\r\n * parent.  This can be HIDDEN, VISIBLE or VISIBLE_ANCESTOR_HIDDEN.  VISIBLE_ANCESTOR_HIDDEN\r\n * indicates that the symbol itself has not been set to be invisible, but one of its\r\n * ancestors has been set to not be visible.\r\n */\r\n\r\n/**\r\n * A callback indicating a function successfully executed its call.\r\n *\r\n * @callback SuccessCallback\r\n */\r\n\r\n/**\r\n * @typedef {Object} Failure A identifier for an object that fails\r\n * to execute correctly on the map.  A failure is generated at the result of\r\n * operating on a number of items, but failing the entire operation would be\r\n * the wrong thing to do.   A failure will identify which item failed.\r\n *\r\n * @param {String} featureId The id of the item if a Feature.\r\n * @param {String} overlayId The id of the item if an Overlay or the parent Overlay\r\n * if featureId is not defined.\r\n * @param {String} parentId The parent Container id of the Overlay or Feature.\r\n * For a Feature this may be the same as overlayId.\r\n */\r\n\r\n/**\r\n *\r\n * A callback indicating a function successfully executed its call, but\r\n * 0 or more items could have failed.  The list of items is included in\r\n * the callback parameters.\r\n\r\n * @callback BatchSuccessCallback\r\n *\r\n * @param {Failure[]} failures - A list of ids of the items that failed.\r\n */\r\n\r\n/**\r\n * A callback to be invoked when the selection operation has been completed.\r\n * @callback emp3.api.Map~selectFeaturesCallback\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Feature[]} cbArgs.target Array of features that were selected\r\n */\r\n\r\n/**\r\n * A callback to be invoked when th deselection operation has been completed\r\n * @callback emp3.api.Map~deselectFeaturesCallback\r\n */\r\n\r\n/**\r\n * A callback indicating the method did not execute as intended.  The\r\n * reason for the error can be found in cbArgs.errorMessage.\r\n *\r\n * @callback ErrorCallback\r\n *\r\n * @param {Object} cbArgs - The parameters are passed in as members of the args\r\n * object.\r\n *\r\n * @param {String} cbArgs.errorMessage - A message describing the error that\r\n * occurred.\r\n *\r\n * @param {Object} cbArgs.callInfo - An object that contains information about the\r\n * API object and arguments that were used to call this method.\r\n *\r\n * @param {Object} cbArgs.source - The API object on which this method was invoked.\r\n *\r\n * @param {Object} cbArgs.args - The arguments that were provided to this method when\r\n * it was invoked.\r\n */\r\n\r\n/**\r\n * Adds a {@link emp3.api.MapService|MapService} to this map. mapServices\r\n * are treated like map backgrounds.  The only interaction you can have with a\r\n * map services is whether or not they are visible.  Items on a map service\r\n * are not selectable, nor do they raise user interaction events.\r\n * <p>\r\n * Use this method to add additional background data to the map.  A typical use\r\n * case for a map service is to add a WMS service to the map immediately after\r\n * the map has loaded.\r\n *\r\n * @example <caption>Loading a WMS background after the map has loaded</caption>\r\n *\r\n * var map1 = new emp3.api.Map({\r\n *   container: \"map-container\",\r\n *   engine: {\r\n *      \"engineBasePath\": \"./emp3-cesium\",\r\n *      \"mapEngineId\": 'cesium'\r\n *   },\r\n *   onSuccess: function() {\r\n *     var wms = new emp3.api.WMS({\r\n *       name: 'Dark Earth',\r\n *       geoId: 'darkEarth1',\r\n *       url: 'http://worldwind25.arc.nasa.gov/wms',\r\n *       layers: 'earthatnight'\r\n *     });\r\n *     map1.addMapService({\r\n *       mapService: wms\r\n *     });\r\n *   }\r\n * });\r\n *\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param  {emp3.api.MapService} args.mapService A web service that provides\r\n * remote map data.\r\n * @param {onSuccessMapServiceCallback} args.onSuccess\r\n * @param {ErrorCallback} [args.onError]\r\n */\r\nemp3.api.Map.prototype.addMapService = function(args) {\r\n\r\n  var cmd;\r\n\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.mapService) {\r\n    throw new Error(\"Missing argument: mapService\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.plotUrl,\r\n    mapService: args.mapService,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.addMapService\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Adds an overlay to the root level of the Map. onError will be called if the\r\n * overlay fails to add.\r\n * <p>\r\n * An overlay is a folder, used to group emp3.api.Feature objects that are\r\n * related together.  Overlays can be added into other overlays to build a hierarchy.\r\n * Overlays can be added multiple times to a map, provided they have different\r\n * parents.\r\n * <p>\r\n * Adding an overlay to the map does not usually display anything on the map,\r\n * unless the overlay was already created on a different map and is not being\r\n * added to this one.  That will be the only time the map will show something\r\n * after an overlay add.\r\n * <p>\r\n * Add data to overlays only after they have been added to\r\n * the map.  Currently, overlays do not support calling Overlay.addFeature without first\r\n * being on the map.\r\n *\r\n * @example\r\n * var map = new emp3.api.Map();\r\n * var myOverlay = new emp3.api.Overlay({\r\n *   name: \"myOverlay\"\r\n * });\r\n *\r\n * var processAdd = function(cbArgs) {\r\n *   alert( \"overlay ID \" + cbArgs.overlays[0].geoId + \" was added to the map\" );\r\n * }\r\n *\r\n * map.addOverlay({\r\n *    overlay: myOverlay,\r\n *    onSuccess: processAdd\r\n * });\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {emp3.api.Overlay} args.overlay The emp3.api.Overlay Object to add to\r\n * the map.\r\n *\r\n * @param {Boolean} args.visible The visibility state of the overlay when\r\n * added to the map.\r\n *\r\n * @param {onSuccessOverlaysCallback} [args.onSuccess]\r\n * Function to call when the overlay\r\n * has been added to the Map Widget.\r\n *\r\n * @param {ErrorCallback} [args.onError]  Function to\r\n * call when an error occurs.\r\n *\r\n */\r\nemp3.api.Map.prototype.addOverlay = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.overlay) {\r\n    throw new Error(\"Missing argument: overlay\");\r\n  }\r\n\r\n  this.addOverlays({\r\n    overlays: [args.overlay],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  });\r\n};\r\n\r\n/**\r\n * Adds overlays to the root level of the Map. If at least one add is successful,\r\n * the onSuccess callback will be called. onError will be called if all the\r\n * overlays failed to add.\r\n * <p>\r\n * An overlay is a folder, used to group emp3.api.Feature objects that are\r\n * related together.  Overlays can be added into other overlays to build a hierarchy.\r\n * Overlays can be added multiple times to a map, provided they have different\r\n * parents.\r\n * <p>\r\n * Adding an overlay to the map does not usually display anything on the map,\r\n * unless the overlay was already created on a different map and is not being\r\n * added to this one.  That will be the only time the map will show something\r\n * after an overlay add.\r\n * <p>\r\n * Add data to the overlays only after they have been added to\r\n * the map.  Currently, overlays do not support Overlay.addFeature without first\r\n * being on the map.\r\n *\r\n * @example\r\n * var map = new emp3.api.Map();\r\n * var myOverlay = new emp3.api.Overlay({\r\n *   geoId: \"myOverlay\",\r\n *   name: \"myOverlay\"\r\n * });\r\n * var myOverlay2 = new emp3.api.Overlay({\r\n *   geoId: \"myOverlay2\",\r\n *   name: \"myOverlay2\"\r\n * });\r\n *\r\n * map.addOverlays({\r\n *    overlays: [myOverlay, myOverlay2],\r\n *    onSuccess: processAdd\r\n * });\r\n *\r\n * function processAdd( cbArgs ) {\r\n *   for (var i = 0; i < cbArgs.overlays.length; i++) {\r\n *     console.log( \"overlay ID \" + cbArgs.overlays[i].geoId + \" was added to the map\");\r\n *   }\r\n * }\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {emp3.api.Overlay[]} args.overlays An array of emp3.api.Overlay\r\n * objects to add to the map.\r\n *\r\n * @param {onSuccessOverlaysCallback} [args.onSuccess]\r\n * Function to call when the overlays\r\n * have been added to the Map Widget.\r\n *\r\n * @param {ErrorCallback} [args.onError]  Function to\r\n * call when an error occurs.\r\n *\r\n */\r\nemp3.api.Map.prototype.addOverlays = function(args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.overlays) {\r\n    throw new Error(\"Missing argument: overlays\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.createOverlay,\r\n    overlays: args.overlays,\r\n    parentId: this.geoId,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.addOverlays\",\r\n    args: args\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Cancels any current draw operation. (See {@link emp3.api.Map#drawFeature|Map.drawFeature})\r\n * When a draw is cancelled, clicks on the map will no longer add vertices to\r\n * the feature that was being drawn, and it will end the draw without calling the\r\n * Map.drawFeature onDrawComplete callback. The onDrawCancel callback\r\n * will be called instead.\r\n * <p>\r\n * If no draw operation is occurring the map ignores this call.\r\n *\r\n * @example\r\n *\r\n * // Draw a Path\r\n *\r\n * // Create the feature that you want to draw, give it any default properties\r\n * // you want it to have.\r\n * var path = new emp3.api.Path({\r\n *   name: \"my path\"\r\n * });\r\n *\r\n * // Issue the command to draw on the map.  At this point you need to click\r\n * // on the map to begin drawing.\r\n * map.drawFeature({\r\n *  feature: path,\r\n *  onDrawCancel: function(args) {   // called when the draw is cancelled.\r\n *    console.log(\"Draw cancelled.\");\r\n *  }\r\n * });\r\n * .\r\n * . // do some other stuff.\r\n * .\r\n * map.cancelDraw();  // this will trigger the onDrawCancel callback of the drawFeature call.\r\n *\r\n */\r\nemp3.api.Map.prototype.cancelDraw = function() {\r\n\r\n  if (this.drawTransaction) {\r\n    this.drawTransaction.cancel();\r\n    this.drawTransaction = null;\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * Cancels any current edit operation. (See {@link emp3.api.Map#editFeature|Map.editFeature})\r\n * The feature that being edited will return to the original positions prior\r\n * to the Map.editFeature operation.  The map will be taken out of edit mode.\r\n * After the edit has been cancelled, the Map.editFeature onEditCancel callback\r\n * will be called.\r\n * <p>\r\n * If no edit operation is occurring the Map will ignore this call.\r\n *\r\n * @example\r\n *\r\n * var feature1 = new emp3.api.MilStdSymbol({\r\n *   geoId: 'myBoundary',\r\n *   name: 'myBoundary',\r\n *   positions: [{\r\n *     latitude: 40,\r\n *     longitude: 40\r\n *   },{\r\n *     latitude: 41,\r\n *     longitude: 41\r\n *   }],\r\n *   symbolCode: 'GFGPGLB----I--X'\r\n * });\r\n *\r\n * // assume overlay1 has already been added to the map.\r\n * overlay1.addFeatures({\r\n *   features: [feature1],\r\n *   onSuccess: function() {\r\n *     map0.editFeature({feature: feature1});  // This puts the feature in edit mode\r\n *                                             // after it is added to the map.\r\n *   }\r\n * });\r\n * .\r\n * .\r\n * .\r\n * . // do some stuff\r\n * .\r\n * map0.cancelEdit(); // This will cancel the current edit.\r\n *\r\n */\r\nemp3.api.Map.prototype.cancelEdit = function() {\r\n  if (this.editTransaction) {\r\n    this.editTransaction.cancel();\r\n    this.editTransaction = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Completes any current draw operation.  (See {@link emp3.api.Map#drawFeature|Map.drawFeature})\r\n * Completing the draw operation will take the map out of draw mode, removing the\r\n * drawn graphic.  After the draw is complete, the Map.drawFeature onDrawComplete\r\n * callback will fire.  The onDrawComplete\r\n * callback will contain the completed Feature needed to show on the map.\r\n * To permanently display the drawing,\r\n * you must add the completed drawing returned in the onDrawComplete callback\r\n * to an Overlay as a Feature.\r\n * <p>\r\n * Sometimes double-clicking or clicking on the map during a draw operation will\r\n * also complete the drawing depending on the Feature type of the max number of\r\n * points the drawn Feature is allowed to have.\r\n * <p>\r\n * If no draw operation is occurring it the map will ignore this call.\r\n *\r\n * @example\r\n *\r\n * // Draw a Path\r\n *\r\n * // Create the feature that you want to draw, give it any default properties\r\n * // you want it to have.\r\n * var path = new emp3.api.Path({\r\n *   name: \"my path\"\r\n * });\r\n *\r\n * var overlay = new emp3.api.Overlay({\r\n *   name: \"overlay1\",\r\n *   id: \"ov1\"\r\n * });\r\n *\r\n * map.addOverlay({\r\n *   overlay: overlay,\r\n *   onSuccess: overlayAdded\r\n * });\r\n *\r\n *\r\n * function overlayAdded() {\r\n *   // Issue the command to draw on the map.  At this point you need to click\r\n *   // on the map to begin drawing.\r\n *   map.drawFeature({\r\n *     feature: path,\r\n *     onDrawComplete: function(args) {   // called when the draw is completed.\r\n *        overlay.addFeature({\r\n *          feature: args.feature\r\n *        });\r\n *     }\r\n *   });\r\n * }\r\n * .\r\n * .\r\n * . // do some stuff\r\n * .\r\n * map.drawComplete();  // this will call the onCompleteCallback specified\r\n *                      // in the map.drawFeature call.  Remember, a double-click\r\n *                      // on the map will also issue a Map.drawComplete\r\n *\r\n *\r\n */\r\nemp3.api.Map.prototype.completeDraw = function() {\r\n  if (this.drawTransaction) {\r\n    this.drawTransaction.complete();\r\n    this.drawTransaction = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Completes the current edit operation.   (See {@link emp3.api.Map#editFeature|Map.editFeature})\r\n * This will permanently save the changes made during the edit.  After the changes\r\n * are made the Map.editFeature onEditComplete callback will be called.  Calling\r\n * completeEdit is the only way to end an edit operation.\r\n * <p>\r\n * If no edit operation is occurring it ignores this call.\r\n *\r\n * @example\r\n *\r\n * var feature1 = new emp3.api.Path({\r\n *   geoId: 'myPath',\r\n *   name: 'myPath',\r\n *   positions: [{\r\n *     latitude: 40,\r\n *     longitude: 40\r\n *   },{\r\n *     latitude: 41,\r\n *     longitude: 41\r\n *   }]\r\n * });\r\n *\r\n * // assume overlay1 has already been added to the map.\r\n * overlay1.addFeatures({\r\n *   features: [feature1],\r\n *   onSuccess: function() {\r\n *     map0.editFeature({\r\n *       feature: feature1, // This puts the feature in edit mode after it is added to the map.\r\n *       onEditComplete: function() {\r\n *         console.log(\"Editing complete\"); // This will get called after completeEdit is called.\r\n *       }\r\n *     });\r\n *   }\r\n * });\r\n * .\r\n * .\r\n * .\r\n * . // do some stuff\r\n * .\r\n * map0.completeEdit(); // This will complete the current edit and end the editing.\r\n *\r\n */\r\nemp3.api.Map.prototype.completeEdit = function() {\r\n  if (this.editTransaction) {\r\n    this.editTransaction.complete();\r\n    this.editTransaction = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Callback made when the drawing first begins on the map.\r\n * This will occur when the user first interacts with the map, but prior to\r\n * any Map.drawFeature onDrawUpdate callbacks.  Subsequent interactions on the\r\n * map in draw mode will call the Map.drawFeature onDrawUpdate.\r\n *\r\n * @callback DrawStartCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map) args.map The map the draw occurred on.\r\n */\r\n\r\n/**\r\n * Callback made when the editFeature begins on the map.  This occurs after\r\n * the map finishes adding any handles onto the map for the feature that is\r\n * being edited.\r\n *\r\n * @callback EditStartCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map) args.map The map the edit occurred on.\r\n * @param {emp3.api.Feature} args.feature The feature that was passed into the\r\n * Map.drawFeature call, updated with the first coordinate clicked.\r\n */\r\n\r\n/**\r\n * Callback occurs after each time the user\r\n * updates the item being drawn.  This can occur during property changes\r\n * as well.  For instance, for MilStdSymbol, a circular target range could\r\n * get updated by modifying the MilStdSymbol.distance property.  If that\r\n * occurs, this will fire.\r\n *\r\n * @callback DrawUpdateCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.map The map the draw occurred on.\r\n * @param {emp3.api.Feature} args.feature The feature containing the current\r\n * positions and other properties at the time of this callback.\r\n * @param {EditUpdateData[]} args.updateList An array of changes that occurred.\r\n */\r\n\r\n/**\r\n * Callback occurs after each time the user\r\n * updates the item during an edit.  This can occur during property changes\r\n * as well.  Certain MIL-STD-2525 symbols can be edited by modifying the\r\n * altitude/depth, azimuth, or distance fields.  Air control measures can\r\n * be edited by changing attributes.\r\n *\r\n * @callback EditUpdateCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.map The map the edit occurred on.\r\n * @param {emp3.api.Feature} args.feature The feature containing the current\r\n * positions and other properties at the time of this callback.\r\n * @param {EditUpdateData[]} args.updateList An array of changes that occurred.\r\n */\r\n\r\n/**\r\n * Occurs after the draw has been completed by the emp3.api.Map.completeDraw\r\n * method.  The callback returns an\r\n * emp3.api.Feature which can be added to an Overlay to complete the draw.\r\n *\r\n * @callback DrawCompleteCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.map The map the draw occurred on.\r\n * @param {emp3.api.Feature} args.feature The completed feature that was drawn.\r\n * This feature is passed in on the original emp3.api.Map.drawFeature call\r\n * and returned with the updated positions and attributes that occurred after\r\n * the draw.  The feature should be ready to add to the map.\r\n */\r\n\r\n/**\r\n * Occurs after the edit has been completed by the emp3.api.Map.completeEdit\r\n * method.  The callback returns an\r\n * emp3.api.Feature which represents the changed Feature.  After the completeEdit\r\n * occurs, the Feature is already modified on the map and does not need to\r\n * be updated.\r\n *\r\n * @callback EditCompleteCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.map The map the edit occurred on.\r\n * @param {emp3.api.Feature} args.feature The completed feature that was edited.\r\n * This feature is passed in on the original emp3.api.Map.editFeature call\r\n * and returned with the updated positions and attributes that occurred after\r\n * the edit.  The feature will already be modified on the map and does not need\r\n * an update.\r\n */\r\n\r\n/**\r\n * Occurs if a cancel occurs during drawing a Feature on the map, usually\r\n * as a result of the emp3.api.Map.cancelDraw method.  The map will return\r\n * the feature as it originally was sent in the emp3.api.Map.drawFeature\r\n * method.\r\n *\r\n * @callback DrawCancelCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.map The map the draw occurred on.\r\n * @param {emp3.api.Feature} args.feature The emp3.api.Feature that was passed\r\n * to the emp3.api.Map.drawFeature method.  The feature will be returned in the\r\n * state that it was prior to the draw.\r\n */\r\n\r\n/**\r\n * Occurs if a cancel occurs during editing a Feature on the map,\r\n * as a result of the emp3.api.Map.cancelEdit method.  The map will return\r\n * the feature as it originally was sent prior to the in the\r\n * emp3.api.Map.editFeature method.\r\n *\r\n * @callback EditCancelCallback\r\n *\r\n * @param {object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.map The map the edit occurred on.\r\n * @param {emp3.api.Feature} args.feature The emp3.api.Feature that was passed\r\n * to the emp3.api.Map.editFeature method.  The feature will be returned in the\r\n * state that it was prior to the edit.\r\n */\r\n\r\n/**\r\n * @typedef {Object} EditUpdateData A change that can occur to a feature during a\r\n * draw or an edit operation.  Each change indicates what type of change it is:\r\n * an add, update, or delete to the coordinates or a change to one of its\r\n * properties or the original feature.\r\n *\r\n * @property {cmapi.enums.geoAirControlMeasure.Attribute} changedAttribute\r\n * An attribute that was changed specifically for an Air Control Measure.\r\n * Only usable by emp3.api.AirControlMeasure.\r\n * @property {cmapi.enums.geoMilSymbol.Modifier} changedModifier A symbol\r\n * modifier that was updated on a emp3.api.MilStdSymbol object.  Only usable\r\n * on emp3.api.MilStdSymbol object.\r\n * @property {number[]} coordinateIndexes The indices of the coordinate that\r\n * were modified.  Used in conjunction with the updateType property which\r\n * explains how it was modified.\r\n * @property {emp3.api.enums.FeatureEditUpdateType} updateType Indicates what\r\n * type of change this is.\r\n */\r\n\r\n\r\n/**\r\n * Puts the map in draw mode and draws the type of feature passed in.  If the\r\n * feature contains coordinates in the feature, the draw will begin with those\r\n * coordinates already added on the map.  The feature will draw according to the\r\n * style settings found in the feature.  After the draw is complete the feature\r\n * does not remain on the map.  It is passed back to the caller, via the\r\n * onDrawComplete callback, and the caller\r\n * should add their feature to the map.\r\n * <p>\r\n * Map.drawFeature contains a number of callbacks that will be issued during\r\n * the draw.  onDrawStart is called after the first click is made.  It indicates\r\n * the user's first interaction with the map since Map.drawFeature was called.\r\n * Subsequent map clicks will call the onDrawUpdate callback; once for each\r\n * point added for a feature, or when the feature's position or properties\r\n * change.  The onDrawComplete method will be called either\r\n * when Map.drawComplete has been called, when a user double-clicks, or when\r\n * some features have reached their maximum allowable points.  onDrawCancel is\r\n * issued when Map.drawCancel is called.  Once a drawCancel has been called,\r\n * a onDrawComplete will not be called.\r\n *\r\n *\r\n * @example\r\n *\r\n * // Draw a Path -- assume \"map\" is a emp3.api.Map and \"overlay\" is an emp3.api.Overlay\r\n * // already added to the map.\r\n *\r\n * // Create the feature that you want to draw, give it any default properties\r\n * // you want it to have.\r\n * var path = new emp3.api.Path({\r\n *   name: \"my path\"\r\n * });\r\n *\r\n * // Issue the command to draw on the map.  At this point you need to click\r\n * // on the map to begin drawing.\r\n * map.drawFeature({\r\n *  feature: path,\r\n *  onDrawComplete: function(args) {   // called when the draw is complete.\r\n *    // add the returned drawn feature to the map.\r\n *    overlay.addFeature({\r\n *      feature: args.feature\r\n *    });\r\n *  }\r\n * });\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature} args.feature A feature that will be drawn.  If\r\n * the feature contains coordinates, the feature will draw starting those\r\n * coordinates.\r\n * @param {DrawCancelCallback} [args.onDrawCancel] The callback function to be executed if a\r\n * drawing is cancelled\r\n * @param {DrawCompleteCallback} [args.onDrawComplete] The callback function to be executed if a\r\n * drawing is finished\r\n * @param {ErrorCallback} [args.onDrawError] The callback function to call if an error occurs\r\n * during the draw\r\n * @param {DrawStartCallback} [args.onDrawStart] The callback function to be executed when the\r\n * drawing starts.\r\n * @param {DrawUpdateCallback} [args.onDrawUpdate] The callback function called when the drawing\r\n * symbols updates with an add or removal of a point.\r\n *\r\n */\r\nemp3.api.Map.prototype.drawFeature = function(args) {\r\n\r\n  var type;\r\n\r\n  this.readyCheck();\r\n\r\n  args = args || {};\r\n\r\n  // verify if required parameters are available.\r\n  if (!args.feature) {\r\n    throw new Error(\"Missing argument: feature\");\r\n  }\r\n\r\n  type = args.feature.featureType;\r\n  if (!type) {\r\n    throw new Error(\"Cannot draw a feature of type emp3.map.Feature\");\r\n  }\r\n\r\n  // Pass in the style from the arguments as an object literal\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.draw,\r\n    feature: args.feature,\r\n    onError: args.onDrawError,\r\n    startCallback: args.onDrawStart || \"\",\r\n    updateCallback: args.onDrawUpdate || \"\",\r\n    completeCallback: args.onDrawComplete || \"\",\r\n    cancelCallback: args.onDrawCancel || \"\"\r\n\r\n  };\r\n\r\n  this.drawTransaction = emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.drawFeature\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Called when the map enters freehand mode, updates a line in freehand mode,\r\n * finishes drawing a line in freehand mode, or exits freehand mode.  you\r\n * can determine the event type by calling args.\r\n *\r\n * @callback MapFreehandCallback\r\n *\r\n * @param {emp3.api.events.MapFreehandEvent} event The freehand draw event that occurred\r\n * on the map.  Call event.type to retrieve what type of freehand event\r\n * occurred.\r\n */\r\n\r\n/**\r\n * Puts the map in \"freehand\" draw mode, where you can draw on top of the\r\n * map like you are using a pen.  A line will begin drawing when you mouse down,\r\n * and when you mouse up, the line will be disappear.  The line does not persist\r\n * on the map.  If you would like the line to persist, you may\r\n * create a feature and add it to an overlay. Instead of persisting to the map,\r\n * a MapFreehandEvent will be raised notifying that a line\r\n * has been drawn on the map.  This event can be subscribe to by calling\r\n * {@link emp3.api.Map.addEventListener|Map.addEventListener} or by using the\r\n * onFreehandEvent callback parameter of this method.\r\n *\r\n * <p>\r\n * The line style for the lines displayed by the map for freehand draw mode may\r\n * be set by calling {@link emp3.api.Map#setFreehandStyle|Map.setFreehandStyle} or\r\n * by setting the initialStyle parameter of this method.\r\n * <p>\r\n * Map.drawFreehandExit must be called to take the map out of \"freehand\" draw mode.\r\n * <p>\r\n * The order of events for drawFreehand are the following:\r\n *\r\n * When entering freehand mode:\r\n * 1) - The map is locked in \"smart lock\" mode.  The map will not pan in this mode,\r\n * nor will it generate {@link emp3.api.events.MapUserInteractionEvent} or {@link emp3.api.events.FeatureUserInteractionEvent} events\r\n * 2) - A {@link emp3.api.events.MapFreehandEvent} with event set to {@link emp3.api.enums.MapFreehandEventEnum|MAP_ENTERED_FREEHAND_DRAW_MODE}\r\n * is generated. (get args.event to determine the type of MapFreehandEvent)\r\n * 3) - At the first drag gesture a MapFreehandEvent with event\r\n * {@link emp3.api.enums.MapFreehandEventEnum|MAP_FREEHAND_LINE_DRAW_START} is generated when the user does a mouse down on the map. As the\r\n * mouse moves while the mouse button is down, a line is displayed on the map.\r\n * 4) - A MapFreehandEvent with event {@link emp3.api.enums.MapFreehandEventEnum|MAP_FREEHAND_LINE_DRAW_UPDATE}\r\n * is generated as the user continues the drag gesture.\r\n * 5) - When the user ends the drag gesture (on mouse up), a MapFreehandEvent\r\n * with event {@link emp3.api.enums.MapFreehandEventEnum|MAP_FREEHAND_LINE_DRAW_END} is generated. The event\r\n * contains a list of geospatial coordinates of the line drawn. Once the\r\n * event returns, the line is removed from the map and the list of coordinates\r\n * are deleted.  At this point, to make the line persist, a feature must be created and added to an\r\n * overlay.\r\n * 6) - The user may choose to initiate a new drag gesture to generate a new\r\n * line therefore returning to step # 3.\r\n * 7) - When {@link emp3.api.Map.drawFreehandExit|Map.drawFreehandExit} is called a MapFreehandEvent with event type\r\n * {@link emp3.api.enums.MapFreehandEventEnum|MAP_EXIT_FREEHAND_DRAW_MODE} is generated, the map is unlocked,\r\n * and the map exits freehand draw mode.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {cmapi.IGeoStrokeStyle} [args.strokeStyle] Determines the color, transparency,\r\n * and width of the lines.  This overrides, but does not set the freehand stroke style\r\n * settings for the map. To set the stroke style settings call the method\r\n * Map.setFreehandStyle.\r\n * @param {MapFreehandCallback} [args.onFreehandEvent] An optional callback used to handle MapFreehandEvents.\r\n * Use this as an alternative to calling Map.addEventListener.\r\n *\r\n * @example\r\n *\r\n * map0.addEventListener({\r\n *  eventType: emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT,\r\n *  callback: function(args) {\r\n *    console.log(\"Freehand lines are drawing!\");\r\n *  }\r\n * });\r\n *\r\n * map0.drawFreehand();  // at this point, click and drag on the map.\r\n *\r\n */\r\nemp3.api.Map.prototype.drawFreehand = function(args) {\r\n  this.readyCheck();\r\n\r\n  args = args || {};\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.freehandDrawStart,\r\n    strokeStyle: args.strokeStyle,\r\n    freehandCallback: args.onFreehandEvent\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.drawFreehand\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Takes the map out of \"freehand\" draw mode. See {@link emp3.api.Map#drawFreehand}  When a map is taken out of\r\n * freehand draw mode, a {@link emp3.api.event.MapFreehandEvent|MapFreehandEvent} is raised with event\r\n * {@link emp3.api.enums.MapFreehandEventEnum|MAP_EXIT_FREEHAND_DRAW_MODE}.  At this point, the map will begin\r\n * sending MapUserInteractionEvents and FeatureUserInteractionEvent events again\r\n * as well as responding to user input to pan the map.\r\n * <p>\r\n * Map.drawFreehandExit must be called to take the map out of \"freehand\" draw mode.\r\n *\r\n * @example\r\n *\r\n *\r\n * map.drawFreehand();  // at this point, click and drag on the map.  We\r\n *                      // will be able to do this for 5 seconds once we set the timer\r\n *\r\n * setTimeout(function() {   // after 5 seconds take ourselves out of freehand mode.\r\n *   map.drawFreehandExit();\r\n * }, 5000);\r\n */\r\nemp3.api.Map.prototype.drawFreehandExit = function() {\r\n  this.readyCheck();\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.freehandDrawExit\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.drawFreehandExit\"\r\n  });\r\n};\r\n\r\n/**\r\n * Sets the line style for the {@link emp3.api.Map#drawFreehand|Map.drawFreehand}\r\n * call.  This allows you to change the default line style when drawing lines in\r\n * freehand mode.  To enter freehand\r\n * mode, call {@link emp3.api.Map#drawFreehand|Map.drawFreehand}.  To exit freehand mode,\r\n * call {@link emp3.api.Map#drawFreehandExit|Map.drawFreehandExit}.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {cmapi.org.IGeoStrokeStyle} [args.initialStyle] Determines the color, transparency,\r\n * and width of the lines.\r\n *\r\n * @example\r\n *\r\n * // change the default settings for freehand lines to a\r\n * // thick red line.\r\n * map.setFreehandStyle({\r\n *   initialStyle: {\r\n *     strokeColor: {\r\n *       red: 255,\r\n *       green: 0,\r\n *       blue: 0\r\n *     },\r\n *     strokeWidth: 10\r\n *   }\r\n * });\r\n *\r\n * // enter into freehand mode.\r\n * map.drawFreehand();  // at this point, click and drag on the map.  We\r\n *                      // will be able to do this for 10 seconds once we set the timer\r\n *\r\n *\r\n * setTimeout(function() {   // after 10 seconds take ourselves out of freehand mode.\r\n *   map.drawFreehandExit();\r\n * }, 10000);\r\n */\r\nemp3.api.Map.prototype.setFreehandStyle = function(args) {\r\n  this.readyCheck();\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    freehandStrokeStyle: args.initialStyle\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setFreehandStyle\"\r\n  });\r\n};\r\n\r\n/**\r\n * Places the given feature in edit mode on the map.  When the map goes into\r\n * edit mode, the map\r\n * will show editing handles for the feature being edited.  The feature's\r\n * vertices can then be moved. The map will not zoom to the location prior to\r\n * the edit, so make sure to place the feature in focus\r\n * prior to calling edit.  The feature will remain in edit mode until\r\n * Map.completeEdit or Map.cancelEdit is called.  Calling Map.completeEdit\r\n * will commit the changes to the map.  Map.cancelEdit will undo any changes\r\n * to the feature in edit mode.\r\n * <p>\r\n * Changes can be received by using the callback parameters to the Map.editFeature\r\n * method.  onEditStart is called immediately after calling editFeature after\r\n * the map acknowledges it is in edit mode.  For each change that occurs, onEditUpdate\r\n * will get called, returning an updated Feature along with information about\r\n * what changed.  onEditComplete is called when {@link emp3.api.Map.completeEdit|Map.completeEdit}\r\n * is called.  If {@link emp3.api.Map.cancelEdit|Map.cancelEdit} is called, then\r\n * the onEditCancel callback with be invoked.\r\n *\r\n * @example\r\n * // adds a polygon, puts it in edit mode and allows you\r\n * // to edit for 10 seconds, then completes the edit.\r\n *\r\n * function editStart(args) {\r\n *   console.log(\"Editing started\");\r\n * }\r\n *\r\n * function editUpdate(args) {\r\n *   console.log(\"Feature updated during an edit\");\r\n * }\r\n *\r\n * function editComplete(args) {\r\n *   console.log(\"Finished editing the feature.\");\r\n * }\r\n *\r\n * var overlay = new emp3.api.Overlay({\r\n *   geoId: 'yo'\r\n * });\r\n *\r\n * var addFeature = function() {\r\n *   var polygon = new emp3.api.Polygon({\r\n *     geoId: \"polygon\",\r\n *     positions: [{\r\n *       latitude: 40,\r\n *       longitude: 40\r\n *     }, {\r\n *       latitude: 41,\r\n *       longitude: 41\r\n *     }, {\r\n *       latitude: 40,\r\n *       longitude: 42\r\n *     }]\r\n *   });\r\n *\r\n *   // This a callback used for the onSuccess call for adding the feature.\r\n *   var editFeature = function() {\r\n *     map0.editFeature({\r\n *       feature: polygon,\r\n *       onEditStart: editStart,\r\n *       onEditUpdate: editUpdate,\r\n *       onEditComplete: editComplete,\r\n *       onEditError: function(err) {\r\n *         alert(err.errorMessage);\r\n *         window.console.error(err);\r\n *       }\r\n *     });\r\n *\r\n *     // Set a timer for 10 seconds, allow editing during that\r\n *     // period.  After 10 seconds expires we complete the edit.\r\n *     // You typically would not do it this way, this is just a demo.\r\n *     setTimeout(function() {\r\n *        map0.completeEdit();\r\n *     }, 10000);\r\n *  };\r\n *\r\n *  // Add the polygon to the overlay, and put it into edit mode.\r\n *  overlay.addFeature({\r\n *    feature: polygon,\r\n *    onSuccess: editFeature\r\n *  });\r\n * };\r\n *\r\n * map0.addOverlay({\r\n *   overlay: overlay,\r\n *   onSuccess: addFeature\r\n * });\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {Feature} args.feature The feature that will be put into edit mode.\r\n * @param {EditStartCallback} [args.onEditStart] A callback that will be called prior to the feature going into edit mode.\r\n * @param {EditUpdateCallback} [args.onEditUpdate] A callback that is called each time the feature is modified during editing.\r\n * @param {EditCompleteCallback} [args.onEditComplete] A callback that is called when the user has completed editing by calling Map.completeEdit.\r\n * @param {EditCancelCallback} [args.onEditCancel] A callback that is called if the feature cancels the edit by calling Map.cancelCallback.\r\n * @param {ErrorCallback} [args.onEditError] The method that will be called if an error occurs\r\n * during the transaction.\r\n */\r\nemp3.api.Map.prototype.editFeature = function(args) {\r\n\r\n  args = args || {};\r\n\r\n  // Throw an error if we do not have feature passed in.\r\n  if (!args.feature) {\r\n    throw new Error(\"Missing argument: feature\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.featureEdit,\r\n    feature: args.feature,\r\n    startCallback: args.onEditStart || \"\",\r\n    updateCallback: args.onEditUpdate || \"\",\r\n    completeCallback: args.onEditComplete || \"\",\r\n    cancelCallback: args.onEditCancel || \"\",\r\n    onError: args.onEditError\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.editFeature\",\r\n    args: args\r\n  };\r\n\r\n  // If the feature is already being edited, we don't want to do anything\r\n  // except call the errorCallback.\r\n  if (this.editTransaction && this.editTransaction.geoId === args.feature.geoId) {\r\n    // Make sure the user actually defined an error callback.\r\n    if (args.onEditError) {\r\n      var msg = \"Feature is already in edit mode\";\r\n\r\n      args.onEditError({\r\n        errorMessage: msg,\r\n        callInfo: callInfo,\r\n        source: this,\r\n        args: args\r\n      });\r\n    }\r\n  }\r\n  else {\r\n    // if this is a different feature being edited, proceed with the edit.\r\n    this.editTransaction = emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n  }\r\n};\r\n\r\n/**\r\n * Retrieves the altitude in meters at which point above MIL-STD-2525 warfighting symbols\r\n * will display as dots to declutter the map.\r\n * Above this altitude the MIL-STD-2525 warfighting symbols will show as dots.\r\n * Below this altitude the warfighting symbols will show normally (but without labels).\r\n * This function is meant to help\r\n * fine tune performance systems with large numbers of warfighting symbols.\r\n *\r\n * @return {number} The altitude at which MIL-STD-2525 warfighting symbols will\r\n * no longer display as dots.\r\n */\r\nemp3.api.Map.prototype.getFarDistanceThreshold = function() {\r\n  return this.farDistanceThreshold;\r\n};\r\n\r\n/**\r\n * Retrieves the current icon size for single point MIL-STD-2525 symbols.  See\r\n * {@link emp3.api.Map#setIconSize|Map.setIconSize}.\r\n *\r\n * @return {emp3.api.enums.IconSizeEnum} The size of the icons.\r\n */\r\nemp3.api.Map.prototype.getIconSize = function() {\r\n\r\n  return this.iconSize;\r\n};\r\n\r\n\r\n/**\r\n * Retrieves the altitude in meters at which point below MIL-STD-2525 warfighting symbols begin to\r\n * show labels according to the settings specified in {@link emp3.api.Map#getMilStdLabels|Map.getMilStdLabels}.\r\n * Above this altitude the MIL-STD-2525 symbols will not show labels. To always\r\n * show labels, set {@link emp3.api.Map#setMidDistanceThreshold|Map.setMidDistanceThreshold}\r\n * to be equal to {@link emp3.api.Map#setFarDistanceThreshold|Map.setFarDistanceThreshold}.\r\n * Remember that showing labels costs additional performance.  This function is meant to help\r\n * fine tune performance systems with large numbers of warfighting symbols.\r\n *\r\n * @return {number} The altitude at which MIL-STD-2525 warfighting symbols will\r\n * begin to display labels.\r\n */\r\nemp3.api.Map.prototype.getMidDistanceThreshold = function() {\r\n  return this.midDistanceThreshold;\r\n};\r\n\r\n/**\r\n * Sets the altitude (in meters)\r\n * at which point MIL-STD-2525 warfighting symbols\r\n * will display as dots. Below this\r\n * altitude the warfighting symbols will show normally (without labels) until\r\n * it hits the mid-distance threshold. At the mid-distance threshold,\r\n * the MIL-STD-2525 symbols will display with\r\n * labels according to {@link emp3.api.Map#getMilStdLabels|Map.getMilStdLabels}.\r\n * <p>\r\n * This function is meant to help fine tune performance for systems displaying a\r\n * large numbers of warfighting symbols.\r\n * <p>\r\n * <i>Note: This capability is disabled by default for the Cesium map engine. It\r\n * must be first turned on using renderingOptimization.enabled=true when creating\r\n * the map. See {@link CesiumProperties}</i>\r\n *\r\n * @param {number} threshold The altitude in meters at which above MIL-STD-2525\r\n * warfighting symbols will display as dots.\r\n */\r\nemp3.api.Map.prototype.setFarDistanceThreshold = function(threshold) {\r\n\r\n  if (typeof(threshold) !== 'number') {\r\n    throw new Error(\"Type Error: Cannot set threshold to non-number.\");\r\n  }\r\n\r\n  if (threshold < this.midDistanceThreshold) {\r\n    throw new Error(\"Range Error: Cannot set far-distance threshold lower than the mid-distance threshold.\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    farDistanceThreshold: threshold\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setFarDistanceThreshold\",\r\n    args: {\r\n      threshold: threshold\r\n    }\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n\r\n  this.farDistanceThreshold = threshold;\r\n};\r\n\r\n/**\r\n * Sets the base size the map should display MIL-STD-2525 icons.  This will\r\n * not affect regular emp3.api.Point icons.  Icon size is specified by using\r\n * {@link emp3.api.enums.IconSizeEnum} which lists four preset sizes.  actual\r\n * sizes may differ depending on which map engine you are looking at.\r\n *\r\n * @param {emp3.api.enums.IconSizeEnum} size The size of the base icon.\r\n *\r\n * @example\r\n *\r\n * map.setIconSize(emp3.api.enums.IconSizeEnum.LARGE);\r\n */\r\nemp3.api.Map.prototype.setIconSize = function(size) {\r\n\r\n  if (size !== emp3.api.enums.IconSizeEnum.TINY &&\r\n    size !== emp3.api.enums.IconSizeEnum.SMALL &&\r\n    size !== emp3.api.enums.IconSizeEnum.MEDIUM &&\r\n    size !== emp3.api.enums.IconSizeEnum.LARGE) {\r\n    throw new Error(\"Type Error: Cannot set icon size to be anything other than emp3.api.enums.IconSizeEnum.\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    iconSize: size\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setIconSize\",\r\n    args: {\r\n      size: size\r\n    }\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n\r\n  this.iconSize = size;\r\n};\r\n\r\n\r\n/**\r\n * Sets the altitude in meters at which point MIL-STD-2525 warfighting symbols\r\n * will show labels.\r\n * Above this altitude the MIL-STD-2525 symbols will not show labels.\r\n * To always\r\n * show labels, set the mid-distance threshold {@link emp3.api.Map#setMidDistanceThreshold|Map.setMidDistanceThreshold}\r\n * to be equal to {@link emp3.api.Map#setFarDistanceThreshold|Map.setFarDistanceThreshold}.\r\n * <p>\r\n * Remember, showing labels costs additional performance.  This function is meant to help\r\n * fine tune performance systems with large numbers of warfighting symbols.\r\n * <p>\r\n * <i>Note: This capability is disabled by default for the Cesium map engine. It\r\n * must be first turned on using renderingOptimization.enabled=true when creating\r\n * the map. See {@link CesiumProperties}</i>\r\n *\r\n * @param {number} threshold An altitude in meters which will serve as the threshold\r\n * for turning on labels for MIL-STD-2525 warfighting symbols.\r\n */\r\nemp3.api.Map.prototype.setMidDistanceThreshold = function(threshold) {\r\n\r\n  if (typeof(threshold) !== 'number') {\r\n    throw new Error(\"Type Error: Cannot set threshold to non-number.\");\r\n  }\r\n\r\n  if (threshold > this.farDistanceThreshold) {\r\n    throw new Error(\"Range Error: Cannot set mid-distance threshold greater than the far-distance threshold.\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    midDistanceThreshold: threshold\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    method: \"Map.setMidDistanceThreshold\",\r\n    args: {\r\n      threshold: threshold\r\n    }\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n\r\n  this.midDistanceThreshold = threshold;\r\n};\r\n\r\n/**\r\n * Retrieves the current MIL-STD-2525 label settings.  See {emp3.api.Map#setMilStdLabels|Map.setMilStdLabels}\r\n *\r\n * @return {emp3.api.enums.MilStdLabelSettingEnum} Returns a setting that indicates\r\n * which set of labels are turned off.\r\n *\r\n * @example\r\n *\r\n * // retrieves the label settings and shows a dialog that tells you\r\n * // which settings are being used.\r\n * var labelSettings = map.getMilStdLabels();\r\n *\r\n * if (labelSettings === emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS) {\r\n *   alert(\"common\");\r\n * } else if (labelSettings === emp3.api.enums.MilStdLabelSettingEnum.REQUIRED_LABELS) {\r\n *   alert(\"required\");\r\n * } else if (labelSettings === emp3.api.enums.MilStdLabelSettingEnum.ALL_LABELS) {\r\n *   alert(\"all\");\r\n * }\r\n */\r\nemp3.api.Map.prototype.getMilStdLabels = function() {\r\n  return this.milStdLabels;\r\n};\r\n\r\n/**\r\n * Retrieves the visibility state or instance visibility state of a target\r\n * object on a map instance.  Two types of visibility requests can be made:\r\n * visibility and instance visibility. A basic visibility check is a binary check\r\n * if the item can be seen by the user or not. An instance visibility is a bit more\r\n * complicated. An item can appear on the map in multiple places and each time it\r\n * appears under a {@link emp3.api.Container|Container} it is called an \"instance.\"\r\n * When doing an instance visibility check, you need to provide the parent container\r\n * of the item you are checking.  This will tell you not only if the item is considered visible, but\r\n * it also indicates if it was hidden because a parent has hidden it.  For instance,\r\n * if a Feature fell under an Overlay, but the Overlay's visibility was set to false,\r\n * checking the instance visibility of that feature under that overlay would indicate\r\n * that the feature was hidden by its ancestor.  This state is called VISIBLE_ANCESTOR_HIDDEN.\r\n * See the returned visibility enum sent by the callback. {@link emp3.api.enums.VisibilityStateEnum}\r\n * <p>\r\n * If either the target or parent (for instance visibility checks) cannot be\r\n * found on the map, the onError callback is called.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {IGeoContainer} args.target The object of which the visibility state is\r\n * requested.\r\n * @param {IGeoContainer} [args.parent] A parent of the target object.  Optional, used\r\n * for determining the visibility state of an object instance.\r\n * @param {onSuccessVisibilityCallback} args.onSuccess called after getVisibility returns with\r\n * the result.\r\n * @param {ErrorCallback} [args.onError] Function to call when an error occurs.\r\n *\r\n * @example <caption>Get the visibility of a Feature</caption>\r\n *\r\n * // Get the visibility of a feature on the map.\r\n *\r\n * map0.getVisibility({\r\n *  target: feature,\r\n *  onSuccess: function(cbArgs) {\r\n *    console.log(cbArgs.visible);  // show whether or not it's HIDDEN or VISIBLE.\r\n *  }\r\n * });\r\n *\r\n * @example <caption>Get the visibility of an Overlay instance</caption>\r\n * // Assume overlay is a child of overlayParent.\r\n * map0.getVisibility({\r\n *  target: overlay,\r\n *  parent: overlayParent,\r\n *  onSuccess: function(cbArgs) {\r\n *    console.log(cbArgs.visible);  // show whether or not it's HIDDEN, VISIBLE, or VISIBLE_ANCESTOR_HIDDEN\r\n *  }\r\n * });\r\n *\r\n */\r\nemp3.api.Map.prototype.getVisibility = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.target) {\r\n    throw new Error(\"Missing argument: target\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.getVisibility,\r\n    target: args.target,\r\n    parent: args.parent,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.getVisibility\",\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n/**\r\n * Indicates which MIL-STD-2525 labels to display for the single point warfighting\r\n * symbols as per Appendix A of the MIL-STD-2525. See TABLE IV in MIL-STD-2525C\r\n * for explanation of MIL-STD-2525 label modifiers.\r\n * <p>\r\n * {@link emp3.api.enums.MilStdLabelSettingEnum|REQUIRED_LABELS} will only turn on\r\n * Signature Equipment (l), Type (V), Special C2 Headquarters (AA), plus graphic\r\n * modifiers Symbol Icon (A), Echelon (B), Task Force Indicator (D), Frame Shape\r\n * Modifier (E), Staff Comments (G), Headquarters Staff Indicator (S), Feint/Dummy\r\n * Indicator (AB), Installation (AC), Auxiliary Equipment Indicator (AG).\r\n * <p>\r\n * {@link emp3.api.enums.MilStdLabelSettingEnum|COMMON_LABELS} will turn on all REQUIRED_LABELS\r\n * plus Additional Information (H), Higher Formation (M), Unique Designation (T),\r\n * and the common name (Feature.name property, not part of MIL-STD-2525.  This\r\n * displays to the right of the unique designation label, or replaces it if no unique\r\n * designation label is found).\r\n * <p>\r\n * {@link emp3.api.enums.MilStdLabelSettingEnum|ALL_LABELS} will show all the remaining labels.\r\n * <i>There are some labels that may not supported in 3D due to technical issues.\r\n * Direction of movement (Q) is currently on of them.</i>\r\n * <p>\r\n * If rendering optimization is turned on, labels will only be seen if you are\r\n * below the mid distance threshold altitude. See {@link emp3.api.Map#setMidDistanceThreshold|Map.setMidDistanceThreshold}\r\n *\r\n * @param {emp3.api.enums.MilStdLabelSettingEnum} labelSetting The label preferences for single point\r\n * MIL-STD-2525 graphics.\r\n *\r\n * @example\r\n * // this will turn all labels on.\r\n * map.setMilStdLabels(emp3.api.enums.MilStdLabelSettingEnum.ALL_LABELS);\r\n */\r\nemp3.api.Map.prototype.setMilStdLabels = function(labelSetting) {\r\n\r\n  if (labelSetting !== emp3.api.enums.MilStdLabelSettingEnum.COMMON_LABELS &&\r\n    labelSetting !== emp3.api.enums.MilStdLabelSettingEnum.REQUIRED_LABELS &&\r\n    labelSetting !== emp3.api.enums.MilStdLabelSettingEnum.ALL_LABELS) {\r\n    throw new Error(\"Type Error: Cannot set MilStdLabels to be anything other than emp3.api.enums.MilStdLabelSettingEnum.\");\r\n  }\r\n\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    milStdLabels: labelSetting\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setMilStdLabels\",\r\n    args: {\r\n      labelSetting: labelSetting\r\n    }\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n\r\n  this.milStdLabels = labelSetting;\r\n};\r\n\r\n/**\r\n * Modifies the visibility state of a container.  Works with Features and Overlays.\r\n * Set the action parameter to determine if the target should be hidden or visible.  The action\r\n * passed in can either simply toggle the visibility of the target, or set the visibility\r\n * of the target and any contained children, making it a recursive visibility set.\r\n * <p>\r\n * There are four enumerations for action: HIDE_ALL, SHOW_ALL, TOGGLE_ON, and TOGGLE_OFF.\r\n * There is a slight difference between \"TOGGLE\" and \"HIDE\".  When you TOGGLE_OFF,\r\n * you are only turning the visibility state for the target. The visibility \"state\"\r\n * of the children will remain what they were before they were hidden although any of the target's children\r\n * would still be hidden on the map.  When you TOGGLE_ON, only the state of the target is\r\n * turned on--it's children's state remained the same as they were when they were toggled off.\r\n * However, when set the action to HIDE_ALL, the visibility\r\n * state for each of the children will also be set as well.  The target get set to hidden, and\r\n * also all of it's children.  Like TOGGLE_OFF, the target and\r\n * children will not show on the map. If you were to set the action to TOGGLE_ON\r\n * instead of SHOW_ALL, then the target would show, but the children's state\r\n * would be set to hidden so they wouldn't show. If you called SHOW_ALL, the target\r\n * and children's visibility state would be set to display and all would show.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {IGeoContainer | IGeoContainer[] | String | String[]} args.target The object(s), a or id(s)\r\n * of the object to perform the action on.\r\n * @param {IGeoContainer | String } [args.parent] The parent object of the target that the action will\r\n * If not set it will apply to all the instances of the object.\r\n * be applied to.\r\n * @param {emp3.api.enums.VisibilityActionEnum} args.action The action to perform.\r\n * @param {BatchSuccessCallback} [args.onSuccess] Function to call after action occurs\r\n * @param {ErrorCallback} [args.onError] Function to call when error occurs\r\n *\r\n * @example <caption>Hiding a single feature</caption>\r\n *\r\n * // This example hides the feature that is added to the map.\r\n * var overlay = new emp3.api.Overlay({\r\n *  geoId: 'overlay1'\r\n * });\r\n *\r\n * // Add the overlay to the map.\r\n * map0.addOverlay({\r\n *   overlay: overlay,\r\n *   onSuccess: addFeature\r\n * });\r\n *\r\n * // After we add this overlay, call this method\r\n * // to add the polygon to the map.\r\n * var addFeature = function() {\r\n *   var polygon = new emp3.api.Polygon({\r\n *     geoId: \"polygon\",\r\n *     positions: [{\r\n *       latitude: 40,\r\n *       longitude: 40\r\n *     }, {\r\n *       latitude: 41,\r\n *       longitude: 41\r\n *     }, {\r\n *       latitude: 40,\r\n *       longitude: 42\r\n *     }]\r\n *   });\r\n *\r\n *   overlay.addFeature({\r\n *     feature: polygon,\r\n *     onSuccess: addFeatureSuccess\r\n *   });\r\n * };\r\n *\r\n * // After the feature is added, set the feature's visibility to hidden.\r\n * var addFeatureSuccess = function(args) {\r\n *   // get the first feature, it will be the only feature returned\r\n *   var feature = args.features[0];\r\n *\r\n *   map0.setVisibility({\r\n *     target: feature,\r\n *     action: emp3.api.enums.VisibilityActionEnum.TOGGLE_OFF\r\n *   });\r\n * };\r\n *\r\n * @example <caption>Hides the Overlay and any of its children</caption>\r\n * // assume overlay has been added to map already.\r\n *\r\n * map.setVisibility({\r\n *   target: overlay,\r\n *   action: emp3.api.enums.VisibilityActionEnum.HIDE_ALL\r\n * });\r\n *\r\n * @example <caption>Makes multiple features viewable</caption>\r\n *\r\n * map0.setVisibility({\r\n *   target: [feature1, feature2, feature3],\r\n *   action: emp3.api.enums.VisibilityActionEnum.TOGGLE_ON\r\n * });\r\n */\r\nemp3.api.Map.prototype.setVisibility = function(args) {\r\n  var featureIds = [],\r\n    overlayIds = [],\r\n    parentId,\r\n    cmd;\r\n\r\n  args = args || {};\r\n\r\n  // Make sure map is created before trying to\r\n  // attempt to set visibility.\r\n  this.readyCheck();\r\n\r\n  // First we need to check what types have been passed in by user\r\n  // We ultimately need to create a separate list of overlayIds and featureIds,\r\n  // because there are 2 separate channels that are called for changing\r\n  // the visibility of a feature or an overlay.\r\n  //\r\n  // Check to see if this is an array first\r\n  if (typeof args.target === 'undefined') {\r\n    args.target = [];\r\n  }\r\n\r\n  if (emp3.api.isArray(args.target)) {\r\n    for (var target in args.target) {\r\n      if (args.target.hasOwnProperty(target)) {\r\n        if (emp3.api.isOverlay(args.target[target])) {\r\n          overlayIds.push(args.target[target].geoId);\r\n        } else {\r\n          featureIds.push(args.target[target].geoId);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  else if (emp3.api.isOverlay(args.target)) {\r\n    overlayIds.push(args.target.geoId);\r\n  }\r\n  else {\r\n    featureIds.push(args.target.geoId);\r\n  }\r\n\r\n  // Determine if parent is set.  If it is\r\n  // we will need to determine if user passed in a string\r\n  // or an object.\r\n  if (args.parent) {\r\n    // If this is a string, store it as the id of the parent container.\r\n    if (emp3.api.isString(args.parent)) {\r\n      parentId = args.parent;\r\n    }\r\n    else {\r\n      // the parent property, if it is set, it probably is an geoContainer.\r\n      // Check geoId property.  If it has it, it most likely is\r\n      // the correct id of the parent.\r\n      parentId = args.parent.geoId;\r\n    }\r\n  }\r\n\r\n  //TODO: This code is no good -- need to not follow CMAPI here -- otherwise\r\n  // we have to send two separate requests; one only after the response of\r\n  // the first one.    Better if CMAPI channel changed to be agnostic of\r\n  // features, map services, overlays.\r\n  // ALSO CMAPI does not support the different enumerations for toggling.\r\n\r\n  if (!args.onSuccess) {\r\n    args.onSuccess = function() {};\r\n  }\r\n\r\n  if (!args.onError) {\r\n    args.onError = function() {};\r\n  }\r\n\r\n  var featureCallbacks = {\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var overlayCallbacks = {\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  // If there is a mix, ensure the callbacks are not fired twice. Precedence goes to the overlay visibility callback\r\n  if (overlayIds.length > 0 && featureIds.length > 0) {\r\n    featureCallbacks = {\r\n      onSuccess: function() {},\r\n      onError: function() {}\r\n    };\r\n  }\r\n\r\n  var recurse = (args.action === emp3.api.enums.VisibilityActionEnum.SHOW_ALL) || (args.action === emp3.api.enums.VisibilityActionEnum.HIDE_ALL);\r\n\r\n  if (featureIds.length > 0) {\r\n    // Since we may be changing overlays or features and each\r\n    // are controlled by different channels, we need to combine messages.\r\n    // First turn on/off all features.  After we receive that response, then\r\n    // we turn on/off each overlay.  Combine transaction responses.\r\n\r\n    cmd = {\r\n      features: featureIds,\r\n      parent: parentId,\r\n      recurse: recurse,\r\n      onSuccess: featureCallbacks.onSuccess,\r\n      onError: featureCallbacks.onError\r\n    };\r\n\r\n    if (args.action === emp3.api.enums.VisibilityActionEnum.SHOW_ALL ||\r\n      args.action === emp3.api.enums.VisibilityActionEnum.TOGGLE_ON) {\r\n      cmd.cmd = emp3.api.enums.channel.showFeature;\r\n    }\r\n    else if (args.action === emp3.api.enums.VisibilityActionEnum.HIDE_ALL ||\r\n      args.action === emp3.api.enums.VisibilityActionEnum.TOGGLE_OFF) {\r\n      cmd.cmd = emp3.api.enums.channel.hideFeature;\r\n    }\r\n\r\n    emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n      mapId: this.geoId,\r\n      source: this,\r\n      method: \"Map.setVisibility\",\r\n      args: args\r\n    });\r\n  }\r\n\r\n  if (overlayIds.length > 0) {\r\n    // Since we may be changing overlays or features and each\r\n    // are controlled by different channels, we need to combine messages.\r\n    // First turn on/off all features.  After we receive that response, then\r\n    // we turn on/off each overlay.  Combine transaction responses.\r\n\r\n    cmd = {\r\n      overlays: overlayIds,\r\n      parent: parentId,\r\n      recurse: recurse,\r\n      onSuccess: overlayCallbacks.onSuccess,\r\n      onError: overlayCallbacks.onError\r\n    };\r\n\r\n    if (args.action === emp3.api.enums.VisibilityActionEnum.SHOW_ALL ||\r\n      args.action === emp3.api.enums.VisibilityActionEnum.TOGGLE_ON) {\r\n      cmd.cmd = emp3.api.enums.channel.showOverlay;\r\n    }\r\n    else if (args.action === emp3.api.enums.VisibilityActionEnum.HIDE_ALL ||\r\n      args.action === emp3.api.enums.VisibilityActionEnum.TOGGLE_OFF) {\r\n      cmd.cmd = emp3.api.enums.channel.hideOverlay;\r\n    }\r\n    else {\r\n      throw new Error('Invalid Visibility Action ' + args.action);\r\n    }\r\n\r\n    emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n      mapId: this.geoId,\r\n      source: this,\r\n      method: \"Map.setVisibility\",\r\n      args: args\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Retrieves all the overlays of a given map.  This includes any children\r\n * overlays of the overlays at the root level of the map.\r\n *\r\n * @example\r\n *\r\n * // Get the overlays\r\n * map.getAllOverlays({\r\n *      onSuccess: processOverlays\r\n * });\r\n *\r\n * // In the response, print the names of the overlays.\r\n * function processOverlays(cbArgs) {\r\n *\r\n *      console.log( cbArgs.overlays.length + ' overlays returned' );\r\n *\r\n *      console.log(\"These are the overlay names\");\r\n *\r\n *      for (var i = 0; i < cbArgs.overlays.length; i++) {\r\n *          console.log(cbArgs.overlays[i].name);\r\n *      }\r\n *\r\n * }\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {onSuccessOverlaysCallback} [args.onSuccess] Function to call when overlays have been\r\n * successfully retrieved from the map widget.\r\n * @param {ErrorCallback} [args.onError] Function to call when an error occurs.\r\n */\r\nemp3.api.Map.prototype.getAllOverlays = function(args) {\r\n  args = args || {};\r\n\r\n  var recursive = true;\r\n\r\n  this.readyCheck();\r\n\r\n  if (typeof args.onSuccess !== \"function\") {\r\n    throw new Error(\"onSuccess argument is required, and must be a function.\");\r\n  }\r\n\r\n  // Create a get query that retrieves all overlays.\r\n  // We'll check to see if we need to start searching from a parent overlay later.\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"overlay\"],\r\n    select: [\"overlayId\", \"name\", \"properties\", \"parentId\"],\r\n    recursive: recursive,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.getOverlays\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Retrieves a list of map services that are being used by the map.  Map services\r\n * are used as backgrounds for the map.  See {@link emp3.api.MapService}\r\n *\r\n *\r\n * @example\r\n *\r\n * map.getMapServices({\r\n *   onSuccess: processServices\r\n * });\r\n *\r\n * // prints out the name of all the services on the map.\r\n * function processServices( cbArgs ){\r\n *   alert( cbArgs.services.length + \" services returned\" );\r\n *   ...\r\n *   for( var i in cbArgs.mapServices ) {\r\n *      var mapService = cbArgs.services[i];\r\n *      alert(mapService.name);\r\n *      ...\r\n *   }\r\n * }\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {onSuccessMapServicesCallback} args.onSuccess Function to call when\r\n * layers are successfully retrieved from the Map Widget.\r\n * @param {ErrorCallback} [args.onError] Function to call when an error\r\n * occurs.\r\n */\r\nemp3.api.Map.prototype.getMapServices = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (typeof args.onSuccess !== \"function\") {\r\n    throw new Error(\"onSuccess argument is required, and must be a function.\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"feature\"],\r\n    select: [\"name\", \"description\", \"featureId\", \"url\", \"format\", \"params\"],\r\n    recursive: true,\r\n    filter: [{\r\n      property: \"overlayId\",\r\n      term: emp3.api.enums.defaultOverlayId.WMS\r\n    }],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.getMapServices\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Retrieves all the features currently plotted on the map.  This includes\r\n * features that are hidden through visibility, and features embedded within\r\n * other features.\r\n *\r\n * @example\r\n *\r\n * // print the ids of all the features on the map.\r\n * map.getAllFeatures({\r\n *  onSuccess: processFeatures\r\n * });\r\n *\r\n * function processFeatures( cbArgs ) {\r\n *   alert( cbArgs.features.length + 'features are on the map ' );\r\n *   var ids = [];\r\n *   for (var i = 0; i < cbArgs.features.length; i++) {\r\n *    ids.push(cbArgs.features[i].geoId);\r\n *   }\r\n *   console.log(ids);\r\n * }\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {onSuccessFeaturesCallback} args.onSuccess Function to call when the\r\n * features have been retrieved\r\n * @param {ErrorCallback} [args.onError] Function to call when an error\r\n * occurs.\r\n */\r\nemp3.api.Map.prototype.getAllFeatures = function(args) {\r\n  var cmd;\r\n  //var includeVisibleFeaturesOnly;\r\n\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (typeof args.onSuccess !== \"function\") {\r\n    throw new Error(\"Missing argument: onSuccess\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"feature\"],\r\n    select: [\"featureId\", \"format\", \"overlayId\", \"name\", \"properties\"],\r\n    recursive: true,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.getFeatures\",\r\n    args: args\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Gets the map bounds which represents the current map viewport. Note: some engines\r\n * may return a bounds slightly larger than the actual map shown, especially in a\r\n * 3D engine where distinguishing a bounds is somewhat ambiguous.\r\n *\r\n * @example\r\n *\r\n * var map = new emp3.api.Map();\r\n * var bounds = map.getBounds();\r\n *\r\n * @return {Bounds} Retrieves the current bounds of the map viewport.\r\n */\r\nemp3.api.Map.prototype.getBounds = function() {\r\n  return {\r\n    north: this.bounds.north,\r\n    south: this.bounds.south,\r\n    east: this.bounds.east,\r\n    west: this.bounds.west\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Retrieves the position of the camera for a 3D map.  The camera\r\n * specifies the 3D location in space and the current alignment.  See\r\n * {@link emp3.api.Camera} for details.\r\n * @return {emp3.api.Camera} retrieves the map's current camera.\r\n */\r\nemp3.api.Map.prototype.getCamera = function() {\r\n  return emp3.api.CameraManager.getCameraForMap({\r\n    map: this\r\n  });\r\n};\r\n\r\n/**\r\n * Requests a screen capture from the map and returns a base64 image of the\r\n * map.  The image will be a snapshot of what was displayed on the map at\r\n * the time it was received.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {onGetScreenshotSuccessCallback} [args.onSuccess] Function to call\r\n * when a screenshot of the current view displayed on the map has been captured.\r\n * @param {ErrorCallback} [args.onError]\r\n * Function to call when an error occurs.\r\n */\r\nemp3.api.Map.prototype.getScreenCapture = function(args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (typeof args.onSuccess !== \"function\") {\r\n    throw new Error(\"onSuccess argument is required, and must be a function.\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.statusRequest,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.getScreenshot\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Retrieves the current status of the map that determines its readiness.\r\n * Map state\r\n * will either be MAP_NEW, INIT_IN_PROGRESS, MAP_READY,\r\n * MAP_SWAP_IN_PROGRESS, SHUTDOWN, or SHUTDOWN_IN_PROGRESS.\r\n * <p>The Map starts out with the MAP_NEW status.  MAP_NEW indicates\r\n * the map object has just been instantiated but the process of loading the map\r\n * has not started yet.  This is the default state of the map.  Since map loading\r\n * occurs the minute the constructor is called, you will probably never receive this state.\r\n * <p>From MAP_NEW, the map will then go into the INIT_IN_PROGRESS state.  INIT_IN_PROGRESS\r\n * indicates the map engine is loading.  During this period\r\n * the map engine is initializing.  The map is not usable in this state.  The map\r\n * goes into this state almost immediately after the constructor is called.\r\n * <p>After the map engine initializes, the map engine will notify that it is ready.\r\n * When this occurs the map is in the MAP_READY state and at this point it is\r\n * ready to receive commands.  Calling any of the methods on the Map object\r\n * prior to it being ready will result in an exception being thrown.  The\r\n * Map will stay in the MAP_READY state until it is either purged or the map\r\n * engine is swapped out.\r\n * <p>If you want to destroy the map and remove it from the application you\r\n * can call the {@link emp3.api.Map#purge|Map.purge} method.  When purge is called,\r\n * the map changes state to SHUTDOWN_IN_PROGRESS as it releases its resources.\r\n * Once released, the map will go into SHUTDOWN state.  At this point the map\r\n * should no longer be used.\r\n * <p>If you are using a map engine and want to swap engines while running, the\r\n * map will go from MAP_READY to MAP_SWAP_IN_PROGRESS while it releases the resources\r\n * of the old map engine, and readys the resources for the new map engine.  Again,\r\n * after this occurs the map goes back into the MAP_READY state.\r\n *\r\n *\r\n * @example\r\n * var map = new emp3.api.Map(); {\r\n * var status = map.getStatus();\r\n *\r\n * @returns {emp3.api.enums.MapStateEnum} An enumeration containing the current\r\n * status of the map.  Will be either INIT_IN_PROGRESS, MAP_NEW, MAP_READY,\r\n * MAP_SWAP_IN_PROGRESS, SHUTDOWN, or SHUTDOWN_IN_PROGRESS.\r\n */\r\nemp3.api.Map.prototype.getState = function() {\r\n  // replaces getStatus\r\n  return this.status;\r\n};\r\n\r\n/**\r\n * When running in the browser environment, purge properly removes the map from\r\n * the DOM container.  The map is considered destroyed at the end state the object\r\n * should not be used again.\r\n * <p>\r\n * This method can only be used when the map is created with\r\n * the environment parameter set to \"browser\".  If this method is called in any\r\n * other map environment, this method will raise an exception.\r\n *\r\n * @example\r\n *\r\n * // Make sure you've created the map in browser environment.\r\n * var map1 = new emp3.api.Map({\r\n *   container: \"map-container\",\r\n *   environment: \"browser\", // this is the default value for 'environment'\r\n *   engine: {\r\n *      \"engineBasePath\": \"./emp3-cesium\",\r\n *      \"mapEngineId\": 'cesium'\r\n *   }\r\n * });\r\n * // do some stuff\r\n * .\r\n * .\r\n * .\r\n * map1.purge({\r\n *   onSuccess: function() {\r\n *     console.log(\"Map destroyed\");\r\n *   }\r\n * });\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {SuccessCallback} args.onSuccess - Occurs when the map has successfully\r\n * been removed.\r\n * @param {ErrorCallback} args.onError - Occurs if an error occurred during\r\n * shutdown of the map.\r\n */\r\nemp3.api.Map.prototype.purge = function(args) {\r\n  var cmd;\r\n\r\n  if ((typeof(this.geoId) !== 'string') || (this.geoId.length === 0)) {\r\n    //throw new Error(\"This map has already been purged.\");\r\n    return;\r\n  }\r\n\r\n  if (this.environment !== 'browser') {\r\n    throw new Error(\"Wrong environment: The map must be in the browser environment to call this method.  You are in environment \" + this.environment);\r\n  }\r\n\r\n  args = args || {};\r\n\r\n  args.onSuccess = args.onSuccess || function() {};\r\n  args.onError = args.onError || function() {};\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.mapShutdown,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    map: this,\r\n    source: this,\r\n    method: \"Map.shutdown\",\r\n    args: args\r\n  });\r\n\r\n  emp3.api.CameraManager.removeCameraForMap({\r\n    map: this\r\n  });\r\n};\r\n\r\n/**\r\n * Performs a check to ensure the map is ready to receive requests.\r\n * @private\r\n * @throws An error if the map status is not emp3.api.enums.MapStateEnum.MAP_READY\r\n */\r\nemp3.api.Map.prototype.readyCheck = function() {\r\n  if (this.status !== emp3.api.enums.MapStateEnum.MAP_READY) {\r\n    throw new Error(\"Map is not ready. The Map object has not received a notification that it is ready to begin accepting requests\");\r\n  }\r\n};\r\n\r\n/**\r\n * Sets the map bounds which represents the current map viewport. You can set\r\n * either the bounds of an area or by using a center lat/lon pair and a scale.  Setting the center\r\n * will keep the current zoom level unless changed by the range parameter. Whether or not the exact bounds provided can be set\r\n * will depend on the aspect ratio of the map widget and the aspect ratio of the bounds\r\n * passed in.  In most cases, it will\r\n * not be possible to set the bounds as requested and the map will use best fit. In these cases the smallest\r\n * bounds that contains the requested bounds will be set.  The actual bounds used\r\n * will be returned in the onSuccess callback.\r\n * @example\r\n *\r\n * var map = new emp3.api.Map();\r\n * map.setBounds({\r\n *      north: 40,\r\n *      south: 30,\r\n *      east: 50,\r\n *      west: 40,\r\n *      onSuccess: mapBoundsSet\r\n *  });\r\n *\r\n * function mapBoundsSet ( cbArgs ) {\r\n *   // read the map bounds that was actually set\r\n *   var upperLeftLatitude = cbArgs.north;\r\n *   var upperLeftLongitude = cbArgs.west;\r\n *   var lowerRightLatitude = cbArgs.south;\r\n *   var lowerRightLongitude = cbArgs.east;\r\n *   ...\r\n * }\r\n *\r\n * @param {Bounds} args The new bounds of the map.\r\n *\r\n * @param {Boolean} [args.animate=true] Tells the map whether the map should fly to the new location or if it should\r\n * just \"teleport\" there.\r\n *\r\n * @param {onSuccessBoundsCallback} [args.onSuccess]\r\n * Function to call when the map bounds have been set by the Map Widget.  Reports\r\n * the new bounds which may not necessarily be the same as the bounds passed in.\r\n *\r\n * @param {ErrorCallback} [args.onError] Function to call when an error occurs.\r\n */\r\nemp3.api.Map.prototype.setBounds = function(args) {\r\n\r\n  var cmd;\r\n\r\n  this.readyCheck();\r\n\r\n  args = args || {};\r\n\r\n  // Check bounds were set correctly\r\n  if (typeof args.north !== 'number') {\r\n    throw new TypeError('Invalid bounds: expected north to be a number');\r\n  }\r\n  if (typeof args.south !== 'number') {\r\n    throw new TypeError('Invalid bounds: expected south to be a number');\r\n  }\r\n  if (typeof args.east !== 'number') {\r\n    throw new TypeError('Invalid bounds: expected east to be a number');\r\n  }\r\n  if (typeof args.west !== 'number') {\r\n    throw new TypeError('Invalid bounds: expected west to be a number');\r\n  }\r\n\r\n  // Validate the bounds\r\n  if (args.north > 90.0 || args.north < -90.0) {\r\n    throw new Error('Invalid bounds: north must be between 90.0 and -90.0');\r\n  }\r\n  else if (args.south > 90.0 || args.south < -90.0) {\r\n    throw new Error('Invalid bounds: south must be between 90.0 and  -90.0');\r\n  }\r\n  else if (args.south > args.north) {\r\n    throw new Error('Invalid bounds: southern bounds must be below northern bounds');\r\n  }\r\n  else if (args.east > 180.0 || args.east < -180.0) {\r\n    throw new Error('Invalid bounds: east must be be between -180.0 and 180.0');\r\n  }\r\n  else if (args.west > 180.0 || args.west < -180.0) {\r\n    throw new Error('Invalid bounds: west must be be between -180.0 and 180.0');\r\n  }\r\n  else if (args.east < args.west) {\r\n    // Possibly on the IDL, ignore\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.centerOnBounds,\r\n    north: args.north,\r\n    south: args.south,\r\n    east: args.east,\r\n    west: args.west,\r\n    animate: args.animate,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setBounds\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Sets the map \"camera\" (only used in 3D maps) which represents the positioning\r\n * of the camera above a globe in 3D space.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {emp3.api.Camera} args.camera A camera object specifying the new location\r\n * of the camera.\r\n *\r\n * @param {boolean} [args.animate = false] Animate the move or not, defaults to false\r\n *\r\n * @param {onSuccessCameraCallback} [args.onSuccess]\r\n * Function to call when the map camera have been set by the Map.\r\n *\r\n * @param {ErrorCallback} [args.onError] Function to call when an error occurs.\r\n */\r\nemp3.api.Map.prototype.setCamera = function(args) {\r\n  var cmd;\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.camera) {\r\n    throw new Error(\"Missing argument(s): camera\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.centerOnLocation,\r\n    camera: args.camera,\r\n    animate: args.animate || false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setCamera\",\r\n    args: args\r\n  });\r\n\r\n  emp3.api.CameraManager.setCameraForMap({\r\n    camera: args.camera,\r\n    map: this.geoId\r\n  });\r\n};\r\n\r\n/**\r\n * This will change the map center to focus on a new location. Normal movement will of the map will now center around\r\n * the new location, which will be kept in the center of the view.\r\n *\r\n * If normal movement is desired after centering the map on a LookAt call getCamera after the move and call setCamera with the\r\n * new camera object. However, due to the asynchronous behavior of the map you must only do this in the onSuccess callback\r\n * passed in with a setLookAt command.\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.LookAt} args.lookAt LookAt describing the location and camera angle to set the Map view to\r\n * @param {boolean} [args.animate=false] Animate the map while updating the view\r\n * @param {SuccessCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n *\r\n * @example <caption>Look at a LAX on the map</caption>\r\n * var laxLookAt = new emp3.api.LookAt({\r\n *   latitude: 33.9416,\r\n *   longitude: -118.4085,\r\n *   altitude: 100,\r\n *   range 5000,\r\n *   tilt: 34\r\n * });\r\n *\r\n * map.setLookAt({\r\n *   lookAt: laxLookAt,\r\n *   animate: true,\r\n *   onSuccess: function() {\r\n *     var camera = map.getCamera();\r\n *     map.setCamera({camera:camera});\r\n *   }\r\n * });\r\n */\r\nemp3.api.Map.prototype.setLookAt = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.lookAt) {\r\n    throw new Error('Missing argument: lookAt');\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.lookAtLocation,\r\n    lookAt: args.lookAt,\r\n    animate: args.animate,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setLookAt\",\r\n    args: args\r\n  });\r\n\r\n  emp3.api.LookAtManager.setLookAtForMap({\r\n    lookAt: args.lookAt,\r\n    map: this\r\n  });\r\n};\r\n\r\n/**\r\n * Returns the current emp3.api.LookAt for the map\r\n * @returns {emp3.api.LookAt}\r\n */\r\nemp3.api.Map.prototype.getLookAt = function() {\r\n  return emp3.api.LookAtManager.getLookAtForMap({\r\n    map: this\r\n  });\r\n};\r\n\r\n/**\r\n * Removes an overlay instance from the root of the map.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Overlay} args.overlay An Overlay object that will be removed from the root of the map.\r\n * @param {onSuccessOverlaysCallback} args.onSuccess Function to call when the\r\n * map succeeds at removing the overlay.\r\n * @param {ErrorCallback} [args.onError] Function to call when an error\r\n * occurs.\r\n *\r\n */\r\nemp3.api.Map.prototype.removeOverlay = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.overlay) {\r\n    throw new Error(\"Missing required parameter: overlay\");\r\n  }\r\n\r\n  this.removeOverlays({\r\n    overlays: [args.overlay],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  });\r\n};\r\n\r\n/**\r\n * Removes multiple overlay instances from the root of the map.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Overlay[]} args.overlays An array of Overlay objects.  The Overlays will be removed in the sequence\r\n * they are arranged in the array.\r\n * @param {onSuccessOverlaysCallback} args.onSuccess Function to call when the map succeeds at removing the overlay.\r\n * @param {ErrorCallback} [args.onError] Function to call when an error occurs.\r\n */\r\nemp3.api.Map.prototype.removeOverlays = function(args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.overlays) {\r\n    throw new Error(\"Missing required parameter: overlays\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.removeOverlay,\r\n    parentId: this.geoId,\r\n    overlays: args.overlays,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.removeOverlays\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Removes a map service from the map.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n *\r\n * @param {emp3.api.MapService} args.mapService The map service to be removed.\r\n * @param {onSuccessMapServiceCallback} [args.onSuccess] Called after the MapService\r\n * is removed from the map.\r\n * @param {ErrorCallback} [args.onError] Function to call when an error\r\n * occurs.\r\n */\r\nemp3.api.Map.prototype.removeMapService = function(args) {\r\n  args = args || {};\r\n\r\n  if (!args.mapService) {\r\n    throw new Error(\"missing argument: mapService\");\r\n  }\r\n\r\n  var services = [];\r\n  if (Array.isArray(args.mapService)) {\r\n    for (var service in args.mapService) {\r\n      if (args.mapService.hasOwnProperty(service)) {\r\n        services.push(args.mapService[service].geoId);\r\n      }\r\n    }\r\n  }\r\n  else {\r\n    services = [args.mapService];\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.unplotFeature,\r\n    overlayId: emp3.api.enums.defaultOverlayId.WMS,\r\n    features: services,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.removeMapService\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Calculates the bounding box of an overlay, a feature, or set of features and alters the\r\n * map's viewing area to contain the bounding box.  The zoomTo method takes\r\n * one of three parameters: feature, overlay, or featureList.  One of the three\r\n * parameters must be populated, otherwise zoomTo will not work.  When the map\r\n * zooms and it is a 3D map, the map will be oriented directly over top of the\r\n * bounding area with heading set to north.  This method will do nothing if the\r\n * feature does not contain any coordinates, or the overlay contains no features.\r\n *\r\n * @example <caption>Zooming to an overlay.</caption>\r\n *\r\n * // Adds 3 features to an overlay, then zooms to the overlay\r\n * // bounds.\r\n * overlay1.addFeatures({\r\n *  features: [feature1, feature2, feature3]\r\n *  onSuccess: function() {\r\n *    map1.zoomTo({\r\n *      overlay: overlay1\r\n *    });\r\n *  }\r\n * });\r\n *\r\n * @example <caption>Zooming to a feature.</caption>\r\n *\r\n * // Adds a feature to the overlay, then zooms to the feature added.\r\n * overlay1.addFeatures({\r\n *  features: [feature1]\r\n *  onSuccess: function() {\r\n *    map1.zoomTo({\r\n *      feature: feature1\r\n *    });\r\n *  }\r\n * });\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature} [args.feature] Zooms the map to the bounding area of this feature.\r\n * @param {emp3.api.Overlay} [args.overlay] Zooms the map the the bounding area of this overlay.\r\n * @param {emp3.api.Feature[]} [args.featureList] Zooms the map to the bounding area of this feature array.\r\n */\r\nemp3.api.Map.prototype.zoomTo = function(args) {\r\n  var cmd,\r\n    featureIds = [];\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.feature && !args.overlay && !args.featureList) {\r\n    throw new Error(\"Missing parameter: feature, overlay or featureList\");\r\n  }\r\n\r\n  if (args.featureList) {\r\n    if (emp3.api.isArray(args.featureList)) {\r\n      // verify that each item is a feature, and make an array of ids.\r\n      for (var i = 0, j = args.featureList.length; i < j; i += 1) {\r\n        if (!emp3.api.isFeature(args.featureList[i])) {\r\n          console.error(\"Type error: args.featureList contains an object that is not a feature.\");\r\n        }\r\n        featureIds.push(args.featureList[i].geoId);\r\n      }\r\n\r\n      cmd = {\r\n        cmd: emp3.api.enums.channel.centerOnFeature,\r\n        featureIds: featureIds\r\n      };\r\n    }\r\n  }\r\n  else if (args.overlay) {\r\n    if (emp3.api.isOverlay(args.overlay)) {\r\n      cmd = {\r\n        cmd: emp3.api.enums.channel.centerOnOverlay,\r\n        overlayId: args.overlay.geoId\r\n      };\r\n    }\r\n    else {\r\n      console.error(\"Type error: args.featureList contains an object that is not an overlay.\");\r\n    }\r\n  }\r\n  else if (args.feature) {\r\n\r\n    if (emp3.api.isFeature(args.feature)) {\r\n      cmd = {\r\n        cmd: emp3.api.enums.channel.centerOnFeature,\r\n        featureId: args.feature.geoId\r\n      };\r\n    }\r\n    else {\r\n      console.error(\"Type error: args.feature contains an object that is not a feature.\");\r\n    }\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.zoomTo\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Give an x/y pixel location, retrieve the lat/lon location of the map.\r\n * The top left pixel of the map is considered to be 0, 0.\r\n *\r\n * _This is a synchronous call._\r\n *\r\n * @param  {Object} args Parameters are provided as members of the args object.\r\n * @param  {Number} args.x The x coordinate of the pixel\r\n * @param  {Number} args.y The y coordinate of the pixel\r\n * @returns {emp3.api.GeoPosition}\r\n */\r\nemp3.api.Map.prototype.containerToGeo = function(args) {\r\n\r\n  args = args || {};\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.convert,\r\n    conversionType: \"offsetPixelToDecimalDegrees\",\r\n    x: args.x,\r\n    y: args.y\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"map.convert\",\r\n    args: args\r\n  };\r\n\r\n  return emp3.api.MessageHandler.getInstance().convert(callInfo, cmd);\r\n};\r\n\r\n/**\r\n * Give a pixel location relative to the top left of the map (being 0,0), retrieve the lat/lon\r\n * in decimal degrees that corresponds to that location.  If on a 3D map, and the pixel location\r\n * is over sky or space, the value returned will be null.\r\n *\r\n * _This is a synchronous call._\r\n *\r\n * @param {Object|emp3.api.GeoPosition} args Parameters are provided as members of the args object.\r\n * @param {number} args.latitude\r\n * @param {number} args.longitude\r\n * @returns {{x:number, y:number}}\r\n */\r\nemp3.api.Map.prototype.geoToContainer = function(args) {\r\n\r\n  args = args || {};\r\n\r\n  if (typeof args.latitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected latitude to be a number');\r\n  }\r\n  if (typeof args.longitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected longitude to be a number');\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.convert,\r\n    conversionType: \"decimalDegreesToOffsetPixel\",\r\n    x: args.longitude,\r\n    y: args.latitude\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.getXYFromLatLon\",\r\n    args: args\r\n  };\r\n\r\n  var containerOffset = emp3.api.MessageHandler.getInstance().convert(callInfo, cmd);\r\n\r\n  // Pixels can only be whole numbers\r\n  containerOffset.x = Math.round(containerOffset.x);\r\n  containerOffset.y = Math.round(containerOffset.y);\r\n\r\n  return containerOffset;\r\n};\r\n\r\n\r\n/**\r\n * Give an x/y pixel location, retrieve the lat/lon location of the map.\r\n * The top left pixel of the screen is considered to be 0, 0.\r\n *\r\n * _This is a synchronous call._\r\n *\r\n * @param {object} args\r\n * @param {number} args.x Absolute screen x-position\r\n * @param {number} args.y Absolute screen y-position\r\n * @returns {emp3.api.GeoPosition}\r\n */\r\nemp3.api.Map.prototype.screenToGeo = function(args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.x !== 'number') {\r\n    throw new TypeError('Invalid argument: expected x to be a number');\r\n  }\r\n\r\n  if (typeof args.y !== 'number') {\r\n    throw new TypeError('Invalid argument: expected y to be a number');\r\n  }\r\n\r\n  var container = document.getElementById(this.container),\r\n    box = container.getBoundingClientRect();\r\n\r\n  var offset = {\r\n    top: box.top + (window.pageYOffset || container.scrollTop) - (container.clientTop || 0),\r\n    left: box.left + (window.pageXOffset || container.scrollLeft) - (container.clientLeft || 0)\r\n  };\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.convert,\r\n    conversionType: \"offsetPixelToDecimalDegrees\",\r\n    x: args.x - offset.left,\r\n    y: args.y - offset.top\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"map.convert\",\r\n    args: args\r\n  };\r\n\r\n  return emp3.api.MessageHandler.getInstance().convert(callInfo, cmd);\r\n};\r\n\r\n/**\r\n * Give a latitude and longitude, retrieve the x/y offset of the screen.\r\n * The top left pixel of the screen is considered to be 0, 0.\r\n *\r\n * _This is a synchronous call._\r\n *\r\n * @param {Object|emp3.api.GeoPosition} args\r\n * @param {number} args.latitude\r\n * @param {number} args.longitude\r\n * @returns {{x:Number, y: Number}}\r\n */\r\nemp3.api.Map.prototype.geoToScreen = function(args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.latitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected latitude to be a number');\r\n  }\r\n\r\n  if (typeof args.longitude !== 'number') {\r\n    throw new TypeError('Invalid argument: expected longitude to be a number');\r\n  }\r\n\r\n  var container = document.getElementById(this.container),\r\n    box = container.getBoundingClientRect();\r\n\r\n  var offset = {\r\n    top: box.top + (window.pageYOffset || container.scrollTop) - (container.clientTop || 0),\r\n    left: box.left + (window.pageXOffset || container.scrollLeft) - (container.clientLeft || 0)\r\n  };\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.convert,\r\n    conversionType: \"decimalDegreesToOffsetPixel\",\r\n    x: args.longitude,\r\n    y: args.latitude\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"map.convert\",\r\n    args: args\r\n  };\r\n\r\n  // Get the container offset\r\n  var containerOffset = emp3.api.MessageHandler.getInstance().convert(callInfo, cmd);\r\n\r\n  // Adjust for the container within the parent window\r\n  containerOffset.x += offset.left;\r\n  containerOffset.y += offset.top;\r\n\r\n  // Can only give pixels in whole numbers\r\n  containerOffset.x = Math.round(containerOffset.x);\r\n  containerOffset.y = Math.round(containerOffset.y);\r\n\r\n  return containerOffset;\r\n};\r\n\r\n/**\r\n * Locks or unlocks the map's view in place so the user can or cannot change the bounds of the map. You can change the\r\n * degree to which the view can be controlled, allowing or disallowing api calls to change the bounds.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.MapMotionLockEnum} args.mode The degree of control the map has on changing the map bounds.\r\n */\r\nemp3.api.Map.prototype.setMotionLockMode = function(args) {\r\n  args = args || {};\r\n  this.readyCheck();\r\n\r\n  if (args.mode === undefined) {\r\n    throw new Error('Missing Argument: mode');\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.lockView,\r\n    lock: args.mode\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setMotionLockMode\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Swaps the current map engine with a new one. This is for maps that have been set up with multiple map engines like Cesium and Leaflet. If you\r\n * default your map to start using the Cesium engine in 3D and your user wants to view the map in a 2D mode you can call swapMapEngine to change\r\n * which engine is viewed.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {MapEngine} args.engine A map engine configuration object.\r\n * @param {SuccessCallback} [args.onSuccess] Called after the map has successfully swapped map engines, and the map is ready.\r\n * @param {ErrorCallback} [args.onError] Called after the map has failed to swap map engines.\r\n */\r\nemp3.api.Map.prototype.swapMapEngine = function(args) {\r\n  this.readyCheck();\r\n  args = args || {};\r\n\r\n  if (!args.engine) {\r\n    throw new Error(\"An 'engine' argument must be populated\");\r\n  }\r\n  if (!args.engine.engineBasePath) {\r\n    throw new Error(\"An 'engineBasePath' argument must be populated\");\r\n  }\r\n  if (!args.engine.mapEngineId) {\r\n    throw new Error(\"An 'mapEngineId' argument must be populated\");\r\n  }\r\n  args.engine.manifestName = args.engine.manifestName || \"manifest.js\";\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.swap,\r\n    engine: args.engine,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Map.swapMapEngine\",\r\n    mapId: this.geoId,\r\n    map: this,\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n/**\r\n * Retrieves the direct children of the map. Maps cannot have features as direct children so this will only return\r\n * overlays and WMS layers.\r\n *\r\n * @param {object} args Arguments object\r\n * @param {emp3.api.Map~getChildrenSuccess} args.onSuccess Success callback\r\n * @param {ErrorCallback} [args.onError] Error callback\r\n */\r\nemp3.api.Map.prototype.getChildren = function(args) {\r\n  this.readyCheck();\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  }\r\n  else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"overlay\"],\r\n    select: [\"overlayId\", \"name\", \"properties\", \"parentId\"],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    method: \"Map.getChildren\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n/**\r\n * This callback is called when getChildren successfully retrieves children from the storage engine\r\n * @callback Map~getChildrenSuccess\r\n * @param {emp3.api.Overlay[]} children\r\n */\r\n\r\n/**\r\n * Maps do not have parents and this function will not return anything.\r\n * @returns undefined\r\n */\r\nemp3.api.Map.prototype.getParents = function() {\r\n  // This returns nothing on purpose\r\n};\r\n\r\n/**\r\n * Returns the visibility state of child. This is specific to the map instance\r\n * Note: {@link emp3.api.Overlay} may not be children of {@link emp3.api.Feature}.\r\n * This is a synchronous call.\r\n *\r\n * The parent referenced must be a direct parent of the child, nested visibility is not supported in this call.\r\n *\r\n * @throws {Error} Will throw if the parent-child relationship is invalid\r\n * @param {emp3.api.Map|emp3.api.Overlay|emp3.api.Feature} parent\r\n * @param {emp3.api.Overlay|emp3.api.Feature} child\r\n * @returns {emp3.api.enums.VisibilityStateEnum}\r\n *\r\n * @example <caption>Adding to a UI widget</caption>\r\n * var visibilityState = map.getInstanceVisibility(overlay, child);\r\n * if (visibilityState === emp3.api.enums.VisibilityStateEnum.SHOWN) {\r\n *   myTreeChildren.append(child);\r\n * }\r\n */\r\nemp3.api.Map.prototype.getInstanceVisibility = function(parent, child) {\r\n  this.readyCheck();\r\n  var mapGeoId = this.geoId;\r\n\r\n  if (!(parent instanceof emp3.api.Map) && !(parent instanceof emp3.api.Overlay) && !(parent instanceof emp3.api.Feature)) {\r\n    throw new TypeError('Invalid argument: parent should be a map, overlay, or feature');\r\n  }\r\n  if (!(child instanceof emp3.api.Overlay) && !(child instanceof emp3.api.Feature)) {\r\n    throw new TypeError('Invalid argument: child should be an overlay or feature');\r\n  }\r\n\r\n  // Don't bother checking an impossible relationship\r\n  if (parent instanceof emp3.api.Feature && child instanceof emp3.api.Overlay) {\r\n    throw new Error('Invalid argument: a feature may not be the parent of an overlay');\r\n  }\r\n\r\n  var getVisibilityTransaction = new emp.typeLibrary.Transaction({\r\n    intent: emp.intents.control.VISIBILITY_GET,\r\n    mapInstanceId: mapGeoId,\r\n    transactionId: emp3.api.createGUID(),\r\n    sender: mapGeoId,\r\n    originChannel: cmapi.channel.names.CMAPI2_VISIBILITY_GET,\r\n    source: emp.api.cmapi.SOURCE,\r\n    messageOriginator: mapGeoId,\r\n    originalMessageType: cmapi.channel.names.CMAPI2_VISIBILITY_GET,\r\n    items: [{\r\n      coreId: child.geoId,\r\n      parentId: parent.geoId,\r\n      visible: undefined\r\n    }]\r\n  });\r\n\r\n  // Note: directly accessing the core here\r\n  var state;\r\n  try {\r\n    emp.storage.visibility.getState(getVisibilityTransaction);\r\n    state = getVisibilityTransaction.items[0].visible;\r\n  }\r\n  catch (err) {\r\n    console.error(err);\r\n  }\r\n  return state;\r\n};\r\n\r\n/**\r\n * Determines the look of a Feature when a it is selected.  The color affects\r\n * all multipoint graphics, and will be applied as a mask to single point graphics,\r\n * while the scale only apples to any single point graphics.  When selected, the\r\n * single point graphics will grow according to the scale passed in.  For example,\r\n * 1.5 will increase the size of a symbol by 50% (1 keeps the scale at its original\r\n * size).\r\n\r\n * You do not have to set both values when calling setSelectionStyle.  You can\r\n * change the color, the scale, or both.\r\n *\r\n * Setting the selection style will take affect for anything selected af\r\n *\r\n * @example\r\n * // Change the style of selected items to green, and change the size of\r\n * // selected icons to be 1.5 times larger than they should be.\r\n * map.setSelectionStyle({\r\n *   color: 'FF00FF00',\r\n *   scale: 1.5\r\n * });\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {String} [args.color] The color of the highlight of the feature\r\n * @param {Number} [args.scale] The scale of a selected icon.  Only valid\r\n * for single point Features.\r\n */\r\nemp3.api.Map.prototype.setSelectionStyle = function(args) {\r\n  var color,\r\n    scale;\r\n\r\n  color = args.color;\r\n  scale = args.scale;\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    color: color,\r\n    scale: scale\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setSelectionStyle\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Gets the id objects of the features that are currently are selected on the map.  Selected features are any\r\n * highlighted features on the map that have been denoted as selected by calling the {@link emp3.api.Map#selectFeature|selectFeature}\r\n * or {@link emp3.api.Map#selectFeatures|selectFeatures}.\r\n *\r\n * _This function is synchronous_\r\n *\r\n * @returns {emp3.api.Feature[]} An array of selected features\r\n *\r\n * @example\r\n *\r\n *  var selectedFeatures = map.getSelected();\r\n *\r\n *  console.log( \"These are the ids of the features that are selected: \"\r\n *  for (var i = 0; i < selectedFeatures.length; i++) {\r\n *    window.console.log( selectedFeatures[i].geoId );\r\n *  }\r\n */\r\nemp3.api.Map.prototype.getSelected = function() {\r\n  this.readyCheck();\r\n  return emp3.api.MessageHandler.getInstance().getSelected(this.geoId);\r\n};\r\n\r\n/**\r\n * Determines if a feature is selected on the map.  A feature is selected if a developer has called\r\n * {@link emp3.api.Map#selectFeature|selectFeature(s)} on it.  Selected features appear highlighted on the map.\r\n *\r\n * _This function is synchronous_\r\n *\r\n * @example\r\n *\r\n * var feature = new emp3.api.Point({\r\n *   geoId: 'point1',\r\n *   name: 'point1',\r\n *   position: {\r\n *    latitude: 40,\r\n *    longitude: 40\r\n *   }\r\n * });\r\n *\r\n * var selected = map.isSelected({\r\n *   feature: feature\r\n * });\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature} args.feature The feature being queried.\r\n * @return {boolean} true if the feature is selected, false if it is not selected or it cannot be found.\r\n */\r\nemp3.api.Map.prototype.isSelected = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.feature) {\r\n    throw new Error('Missing argument: feature');\r\n  }\r\n\r\n  return emp3.api.MessageHandler.getInstance().isSelected(this.geoId, args.feature.geoId);\r\n};\r\n\r\n/**\r\n * Removes the highlight from a selected Feature on the map.  The feature's\r\n * selection style is removed and the feature will return to its ordinary look\r\n * prior to selection.  If feature is not found, map will ignore the call.\r\n *\r\n * @example\r\n *\r\n * // adds feature1 to overlay1.\r\n * overlay1.addFeature({\r\n *  feature: feature1,\r\n *  onSuccess: function() {\r\n *    map1.selectFeature({\r\n *      feature: feature1\r\n *    });\r\n *\r\n *    // after 5 seconds, this timeout will deselect the feature.\r\n *    setTimeout(function() {\r\n *        // deselects the feature that was selected\r\n *        map1.deselectFeature({\r\n *          feature: feature1\r\n *        });\r\n *    }, 5000);\r\n *  }\r\n * });\r\n *\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature} args.feature The feature that is being deselected.\r\n *    exist on map and be selected.\r\n * @param {emp3.api.Map~deselectFeaturesCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n */\r\nemp3.api.Map.prototype.deselectFeature = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.feature) {\r\n    throw new Error(\"Missing argument: feature\");\r\n  }\r\n\r\n  this.deselectFeatures({\r\n    features: [args.feature],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  });\r\n};\r\n\r\n/**\r\n * Removes the highlight from a selected Feature on the map.  The feature's\r\n * selection style is removed and the feature will return to its ordinary look\r\n * prior to selection.  If feature is not found, the map ignores the call.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature[]} args.features The feature that is being deselected.\r\n *    exist on map and be selected.\r\n * @param {emp3.api.Map~deselectFeaturesCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n */\r\nemp3.api.Map.prototype.deselectFeatures = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.features) {\r\n    throw new Error(\"Missing argument: features\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.featureDeselectedBatch,\r\n    features: args.features,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.deselectFeatures\",\r\n    args: args\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Selects a feature on the map. Any selected features will show on the map as a highlighted graphic.  Selected features are used to give a\r\n * user context for future actions.  For example, you can select a number of features on the map, and at a later time (say maybe in response to a context\r\n * menu click) program the map to delete the selected features.\r\n *\r\n * To remove the highlight from a feature you can use {@link emp3.api.Map#clearSelected|clearSelected},\r\n * {@link emp3.api.Map#deselectFeature|deselectFeature} or {@link emp3.api.Map#deselectFeatures|deselectFeatures}.\r\n *\r\n * {@link emp3.api.Map#clearSelected|clearSelected} de-selects all selected Features, while {@link emp3.api.Map#deselectFeature|deselectFeatures(s)}\r\n * de-selects given features.\r\n *\r\n * The default selection highlight will change line colors to yellow, additionally if the feature is a single point (Points, single point MilStdFeature)\r\n * it will increase the scale by 1.2. The selection style can be altered by calling Map.setSelectionStyle.\r\n *\r\n * It is important to note that selection is not automatically enabled by\r\n *\r\n * the map user interface.  Clicking on a feature does not select the feature automatically. To allow users to select\r\n * on a feature-click you must add the selectFeature(s) call in response to a {@link emp3.api.events.FeatureUserInteractionEvent|FeatureUserInteractionEvent}.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature} args.feature The features to select.\r\n * @param {emp3.api.Map~selectFeaturesCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n *\r\n * @example <caption>Select a symbol when it is clicked by a user.</caption>\r\n *\r\n * map1.addEventListener({\r\n *  eventType: emp3.api.enums.EventType.FEATURE_INTERACTION,\r\n *  callback: featureClickListener\r\n * });\r\n *\r\n * function featureClickListener ( cbArgs ) {\r\n *   if (cbArgs.event === emp3.api.enums.UserInteractionEventEnum.CLICKED) {\r\n *     map.selectFeature({\r\n *       feature: cbArgs.target[0]\r\n *     });\r\n *   }\r\n * }\r\n */\r\nemp3.api.Map.prototype.selectFeature = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.feature) {\r\n    throw new Error(\"Missing argument: feature\");\r\n  }\r\n\r\n  this.selectFeatures({\r\n    features: [args.feature],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  });\r\n};\r\n\r\n/**\r\n * Selects multiple features on the map. Any selected features will show on the map as a highlighted graphic.  Selected\r\n * features are used to give a user context for future actions.  For example, you can select a number of features on\r\n * the map, and at a later time (say maybe in response to a context menu click) program the map to delete the selected\r\n * features.\r\n *\r\n * To de-select a feature you can use {@link emp3.api.Map#clearSelected|clearSelected},\r\n * {@link emp3.api.Map#deselectFeature|deselectFeature} or {@link emp3.api.Map#deselectFeatures|deselectFeatures}.\r\n * {emp3.api.Map#clearSelected|clearSelected} de-select any selected Features, while Map.deselectFeature(s) de-select\r\n * one or more features.\r\n *\r\n * The default selection highlight will change line colors to yellow.\r\n * The selection style can be altered by calling {@link emp3.api.Map#setSelectionStyle|setSelectionStyle}\r\n *\r\n * It is important to note that selection is not automatically enabled by the map user interface.\r\n * To allow users to highlight on a feature-click you must add the selectFeature(s) call in response to a {@link emp3.api.events.FeatureUserInteractionEvent}.\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object.\r\n * @param {emp3.api.Feature[]} args.features The features to select.\r\n * @param {emp3.api.Map~selectFeaturesCallback} args.onSuccess\r\n * @param {ErrorCallback} [args.onError]\r\n *\r\n * @example <caption>Select features</caption>\r\n * map0.selectFeatures({\r\n *   features: [feature1, feature2, feature3],\r\n *   onSuccess: function() {\r\n *     // Further notification or alerting other parts of the application\r\n *   }\r\n * });\r\n */\r\nemp3.api.Map.prototype.selectFeatures = function(args) {\r\n  args = args || {};\r\n\r\n  this.readyCheck();\r\n\r\n  if (!args.features) {\r\n    throw new Error(\"Missing argument: features\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.featureSelectedBatch,\r\n    features: args.features,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.selectFeatures\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Clears the current feature selection on the map. This function universally deselects all features, whether they were\r\n * selected by you or by another program.\r\n *\r\n * @example\r\n *\r\n * map.selectFeatures({\r\n *   features: [feature1, feature2, feature3]\r\n * });\r\n *\r\n * // Later after completing any tasks with the selection clear the selection\r\n * map.clearSelected();\r\n */\r\nemp3.api.Map.prototype.clearSelected = function() {\r\n  this.readyCheck();\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.featureDeselected,\r\n    mapId: this.geoId\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.clearSelected\",\r\n    args: {}\r\n  });\r\n};\r\n\r\n/**\r\n * Lightens or darkens the background map.  Value can be\r\n * 0-100 with 50 as default. At 50, the map background is displayed without any\r\n * modifications.  Below 50 the map background will get darker and above 50 the\r\n * map background will get lighter. At zero the map background is fully black.  At 100\r\n * the map is fully white.\r\n * <p>\r\n * Values above 100 will set the value of 100 and below 0 will set the value to 0.\r\n *\r\n * @param {Number} brightness A value between 0 and 100.\r\n *\r\n */\r\nemp3.api.Map.prototype.setBackgroundBrightness = function(brightness) {\r\n  if (brightness === undefined) {\r\n    brightness = 50;\r\n  }\r\n\r\n  if (brightness > 100) {\r\n    brightness = 100;\r\n  } else if (brightness < 0) {\r\n    brightness = 0;\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.config,\r\n    brightness: brightness\r\n  };\r\n\r\n  var callInfo = {\r\n    mapId: this.geoId,\r\n    source: this,\r\n    method: \"Map.setBackgroundBrightness\",\r\n    args: {\r\n      brightness: brightness\r\n    }\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n\r\n  this.brightness = brightness;\r\n};\r\n\r\n/**\r\n * This function should not be called to clear all classes. It is preferable to remove individual overlays as necessary.\r\n *\r\n * @param args\r\n * @param {emp3.api.Map~clearContainerCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n */\r\nemp3.api.Map.prototype.clearContainer = function(args) {\r\n  args = args || {};\r\n\r\n  // Format the request\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.clearMap,\r\n    overlay: this,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Map.clearContainer\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Retrieves the background brightness setting from the map.  See {@link emp3.api.Map#setBackgroundBrightness|Map.setBackgroundBrightness}\r\n *\r\n * @return {Number} The brightness of the map.  A number between 0-100.\r\n */\r\nemp3.api.Map.prototype.getBackgroundBrightness = function() {\r\n  return this.brightness;\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * This default constructor creates an Overlay and its encapsulated GeoContainer.\r\n *\r\n * @extends {emp3.api.Container}\r\n * @constructor\r\n * @classdesc This class handles all operations on a Geo Container object or Overlay.\r\n *\r\n * @param [args] Arguments object\r\n * @param {string} [args.name]\r\n * @param {string} [args.description]\r\n * @param {string} [args.geoId] This default constructor creates an Overlay and its encapsulated GeoContainer and assigns it\r\n * the id provided. If args.geoId is specified to not specify args.container.\r\n *\r\n * @example <caption>A basic overlay using defaults</caption>\r\n * var overlay = new emp3.api.Overlay();\r\n *\r\n * @example <caption>With a name and definite geoId</caption>\r\n * var unitsOverlay = new emp3.api.Overlay({\r\n *   name: \"Hostile Ground Units\",\r\n *   geoId: \"hgu_1_12271500Z2016\",\r\n *   description: \"Hostile ground units positions on 12/27/2016 as of 1500Z\"\r\n * });\r\n */\r\nemp3.api.Overlay = function (args) {\r\n\r\n  // Initialize the args object to the default.\r\n  args = args || {};\r\n\r\n  this.type = \"overlay\";\r\n\r\n  // The ID of the overlay set by the Map API\r\n  this.geoId = args.geoId || emp3.api.createGUID();\r\n  /**\r\n   * The name of the overlay.\r\n   * @type String\r\n   */\r\n  this.name = args.name || \"untitled overlay\";\r\n\r\n  /**\r\n   * The properties of the overlay.\r\n   * @type Object\r\n   */\r\n  this.properties = args.properties || {};\r\n};\r\n\r\nemp3.api.Overlay.prototype = new emp3.api.Container();\r\n// =====================================================================================================================\r\n/**\r\n * @callback emp3.api.Overlay~addFeaturesCallback\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Feature[]} cbArgs.features Array of features added to the overlay\r\n * @param {emp3.api.Feature[]} cbArgs.failures Array of features which failed to be added\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~addOverlaysCallback\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays Array of overlays added to the overlay\r\n * @param {emp3.api.Overlay[]} cbArgs.failures Array of overlays which failed to be added\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~applyCallback\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Overlay} cbArgs.overlay The updated overlay\r\n * @param {emp3.api.Overlay[]} cbArgs.failures Array of overlays which failed to update\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~getChildrenCallback\r\n * @param {object} cbArgs Arguments object\r\n * @param {emp3.api.Feature[]} cbArgs.features List of the child features\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays List of the child overlays\r\n * @param {emp3.api.Feature[]|emp3.api.Overlay[]} cbArgs.failures List of failures\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~getFeaturesCallback\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Feature[]} cbArgs.features List of child features\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~getOverlaysCallback\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays List of child overlays\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~removeFeaturesCallback\r\n * @param {object} cbArgs\r\n * @param {FeatureIdentifier[]} args.featureIds\r\n * @param {FeatureIdentifier[]} args.failures\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~removeOverlaysCallback\r\n *\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays\r\n * @param {emp3.api.Overlay[]} cbArgs.failures\r\n */\r\n\r\n/**\r\n * Called when the overlay has been cleared\r\n * @callback emp3.api.Overlay~clearContainerCallback\r\n *\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Feature[]|emp3.api.Overlay[]} cbArgs.failures Any features or overlays that failed to be removed\r\n */\r\n\r\n/**\r\n * Returns with the parents of the overlay\r\n * @callback emp3.api.Overlay~getParentsCallback\r\n *\r\n * @param {object} cbArgs\r\n * @param {emp3.api.Overlay} cbArgs.overlay List of overlays which are direct parents of the overlay\r\n */\r\n\r\n/**\r\n * @callback emp3.api.Overlay~errorCallback\r\n */\r\n// =====================================================================================================================\r\n\r\n/**\r\n * This method adds a feature to this overlay.\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Feature} args.feature The feature to add\r\n * @param {boolean} [args.visible=true] Whether the feature will be visible on the overlay\r\n * @param {emp3.api.Overlay~addFeaturesCallback} [args.onSuccess] Any successful adds will invoke this callback\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError] If all adds fail this will be invoked\r\n *\r\n * @example <caption>Adding a single feature</caption>\r\n * overlay.addFeature({\r\n *   feature: myFeature,\r\n *   onSuccess: function() {\r\n *     alert();\r\n *   }\r\n * });\r\n *\r\n * @example <caption>Adding a feature with it being hidden</caption>\r\n * overlay.addFeature({\r\n *   feature: myFeature,\r\n *   visible: false,\r\n *   onSuccess: function() {\r\n *     alert();\r\n *   }\r\n * });\r\n */\r\nemp3.api.Overlay.prototype.addFeature = function (args) {\r\n  args = args || {};\r\n\r\n  if (!args.feature) {\r\n    throw new Error(\"Missing argument: feature\");\r\n  }\r\n\r\n  if (Array.isArray(args.feature)) {\r\n    args.features = args.feature;\r\n  } else {\r\n    args.features = [args.feature];\r\n  }\r\n\r\n  // Simply call the plural version of this method.\r\n  this.addFeatures({\r\n    features: args.features,\r\n    visible: args.visible,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  });\r\n};\r\n\r\n/**\r\n * This method adds one or more features to this overlay.\r\n * @param {Object} args Parameters are provided as members of the args object\r\n * @param {emp3.api.Feature[]} args.features The features to add\r\n * @param {boolean} [args.visible=true] Whether the features are visible\r\n * @param {emp3.api.Overlay~addFeaturesCallback} [args.onSuccess] Any successful adds will invoke this callback\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError] If all adds fail this will be invoked\r\n *\r\n * @example <caption>Adding many features</caption>\r\n * var featuresArray = [];\r\n * ...\r\n * featuresArray.push(feature9872)\r\n * ...\r\n * overlay.addFeatures({\r\n *   features: featuresArray,\r\n *   onSuccess: function(cbArgs) {\r\n *     cbArgs.features.forEach(function(feat) {\r\n *       window.console.log(feat.name, feat.geoId);\r\n *     })\r\n *   }\r\n * });\r\n */\r\nemp3.api.Overlay.prototype.addFeatures = function (args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n  if (!args.features) {\r\n    throw new Error(\"Missing argument: features\");\r\n  } else if (!Array.isArray(args.features)) {\r\n    throw new TypeError(\"Invalid Argument: expected features to be an array\");\r\n  }\r\n\r\n  if (args.features.length > 0) {\r\n    cmd = {\r\n      cmd: emp3.api.enums.channel.plotFeature,\r\n      overlayId: this.geoId,\r\n      visible: args.visible,\r\n      features: args.features,\r\n      onSuccess: args.onSuccess,\r\n      onError: args.onError\r\n    };\r\n\r\n    emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n      source: this,\r\n      method: \"Overlay.addFeatures\",\r\n      args: args\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * This method adds a child overlay to this overlay.\r\n * @param {Object} args Parameters are provided as members of the args object\r\n * @param {emp3.api.Overlay} args.overlay The overlay to add\r\n * @param {emp3.api.Overlay~addOverlaysCallback} [args.onSuccess] Callback to be invoked if any overlays are successfully added\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError] Callback to be invoked if all adds fail\r\n */\r\nemp3.api.Overlay.prototype.addOverlay = function (args) {\r\n  args = args || {};\r\n  if (!args.overlay) {\r\n    throw new Error(\"Missing argument: overlay\");\r\n  }\r\n\r\n  if (Array.isArray(args.overlay)) {\r\n    args.overlays = args.overlay;\r\n  } else {\r\n    args.overlays = [args.overlay];\r\n  }\r\n\r\n  this.addOverlays(args);\r\n};\r\n\r\n/**\r\n * This method adds one or more child overlays to this overlay.\r\n * @param {object} args\r\n * @param {emp3.api.Overlay[]} args.overlays The overlays to add\r\n * @param {emp3.api.Overlay~addOverlaysCallback} [args.onSuccess] Callback to be invoked if any overlays are successfully added\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError] Callback to be invoked if all adds fail\r\n */\r\nemp3.api.Overlay.prototype.addOverlays = function (args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n  if (!args.overlays) {\r\n    throw new Error(\"Missing argument: overlays\");\r\n  } else if (!Array.isArray(args.overlays)) {\r\n    throw new TypeError(\"Invalid Argument: expected overlays to be an array\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.createOverlay,\r\n    overlays: args.overlays,\r\n    parentId: this.geoId,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.addOverlays\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * This method triggers an update of the overlay.\r\n * The only properties which may be updated in the fashion are the name and description.\r\n * Changing the properties locally without calling apply will cause updates to be lost.\r\n *\r\n * @param {object} [args]\r\n * @param {emp3.api.Overlay~applyCallback} [args.onSuccess]\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n *\r\n * @example <caption>Renaming an overlay</caption>\r\n * var weatherOverlay = new emp3.api.Overlay({name: 'wetter map', geoId: 'weatherMap'});\r\n * map.addOverlay({\r\n *   overlay: weatherOverlay,\r\n *   onSuccess: function() {\r\n *     // fix spelling of name\r\n *     weatherOverlay.name = \"weather map\";\r\n *     weatherOverlay.apply();\r\n *   }\r\n * });\r\n */\r\nemp3.api.Overlay.prototype.apply = function (args) {\r\n  args = args || {};\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.updateOverlay,\r\n    overlay: this,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.apply\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * This method retrieves the immediate children of the overlay.\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Overlay~getChildrenCallback} args.onSuccess\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n *\r\n * @example\r\n * overlay.getChildren({\r\n *   onSuccess: function(cbArgs) {\r\n *     cbArgs.features.forEach(function(feature) {\r\n *       window.console.log(feature);\r\n *     });\r\n *     cbArgs.overlays.forEach(function(overlay) {\r\n *       window.console.log(overlay);\r\n *     });\r\n *   }\r\n * });\r\n */\r\nemp3.api.Overlay.prototype.getChildren = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  } else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"overlay\", \"feature\"],\r\n    select: [\"overlayId\", \"featureId\", \"name\", \"properties\", \"parentId\"],\r\n    filter: [\r\n      {\r\n        property: \"parentId\",\r\n        term: this.geoId\r\n      }\r\n    ],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Overlay.getChildren\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n/**\r\n * This method retrieves all child features of this overlay.\r\n *\r\n * @param {object} args\r\n * @param {boolean} [args.includeVisibleFeaturesOnly=false]\r\n * @param {emp3.api.Overlay~getFeaturesCallback} args.onSuccess\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n *\r\n * @example\r\n * overlay.getFeatures({\r\n *   onSuccess: function(args) {\r\n *     args.features.forEach(function(feature) {\r\n *       window.console.debug(feature);\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.Overlay.prototype.getFeatures = function (args) {\r\n  args = args || {};\r\n\r\n  var includeVisibleFeaturesOnly = false,\r\n    cmd;\r\n\r\n  if (typeof args.onSuccess !== \"function\") {\r\n    throw new Error(\"onSuccess argument is required, and must be a function.\");\r\n  }\r\n\r\n  // Check to see if user passed in the includeVisibleFeaturesOnly parameter.\r\n  // If not defined it will be set to false so all features are returned.\r\n  if (typeof args.includeVisibleFeaturesOnly !== 'undefined' &&\r\n    args.includeVisibleFeaturesOnly !== null) {\r\n    includeVisibleFeaturesOnly = args.includeVisibleFeaturesOnly;\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    recursive: false,\r\n    types: [\"feature\"],\r\n    select: [\"featureId\", \"overlayId\", \"parentId\", \"name\", \"properties\", \"format\", \"feature\"],\r\n    filter: [{\r\n      property: \"overlayId\",\r\n      term: this.geoId\r\n    }],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  if (includeVisibleFeaturesOnly) {\r\n    cmd.filter.push({\r\n      property: \"visible\",\r\n      term: true\r\n    });\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.getFeatures\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * This method retrieves a list of this overlay's immediate child overlays.\r\n * @param {object} args\r\n * @param {emp3.api.Overlay~getOverlaysCallback} args.onSuccess Success callback\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError] Error callback\r\n *\r\n * @example\r\n * overlay.getOverlays({\r\n *   onSuccess: function(args) {\r\n *     args.overlays.forEach(function(overlay) {\r\n *       window.console.debug(overlay);\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.Overlay.prototype.getOverlays = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess !== \"function\") {\r\n    throw new Error(\"onSuccess argument is required, and must be a function.\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    recursive: false,\r\n    types: [\"overlay\"],\r\n    select: [\"overlayId\", \"parentId\", \"name\", \"properties\"],\r\n    filter: [{\r\n      property: \"parentId\",\r\n      term: this.geoId\r\n    }],\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.getOverlays\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * This method removes a child feature from this overlay.\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Feature} args.feature\r\n * @param {emp3.api.Overlay~removeFeaturesCallback} [args.onSuccess]\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n */\r\nemp3.api.Overlay.prototype.removeFeature = function (args) {\r\n  args = args || {};\r\n\r\n  if (!args.feature) {\r\n    throw new Error('Missing argument: feature');\r\n  } else if (!(args.feature instanceof emp3.api.Feature)) {\r\n    throw new TypeError('Invalid argument: expected feature to be of type emp3.api.Feature');\r\n  }\r\n\r\n  // Call the plural of this method\r\n  args.features = [args.feature];\r\n  this.removeFeatures(args);\r\n};\r\n\r\n/**\r\n * This method an array of child features from this overlay\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Feature[]} args.features\r\n * @param {string[]} args.featureIds\r\n * @param {emp3.api.Overlay~removeFeaturesCallback} [args.onSuccess]\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n */\r\nemp3.api.Overlay.prototype.removeFeatures = function (args) {\r\n  args = args || {};\r\n  if (!args.features && !args.featureIds) {\r\n    throw new Error(\"missing argument: featureIds or features must be set\");\r\n  }\r\n\r\n  if (!Array.isArray(args.features)) {\r\n    throw new TypeError(\"Invalid argument: featureId is not an array\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.unplotFeatureBatch,\r\n    overlayId: this.geoId,\r\n    features: args.features,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.removeFeatures\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * This method removes a child overlay from this overlay\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Overlay} args.overlay The overlay to remove\r\n * @param {emp3.api.Overlay~removeOverlaysCallback} [args.onSuccess] Success callback\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError] Error callback\r\n */\r\nemp3.api.Overlay.prototype.removeOverlay = function (args) {\r\n  args = args || {};\r\n  if (!args.overlay) {\r\n    throw new Error('Missing argument: overlay');\r\n  } else if (!(args.overlay instanceof emp3.api.Overlay)) {\r\n    throw new TypeError('Invalid argument: overlay should be of type emp3.api.Overlay');\r\n  }\r\n\r\n  // Use the plural of this method\r\n  this.removeOverlays({\r\n    overlays: [args.overlay],\r\n    onSuccess: args.onSuccess || function () {\r\n    },\r\n    onError: args.onError || function () {\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * This method removes an array of overlays\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Overlay[]} args.overlays\r\n * @param {emp3.api.Overlay~removeOverlaysCallback} [args.onSuccess]\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n */\r\nemp3.api.Overlay.prototype.removeOverlays = function (args) {\r\n  args = args || {};\r\n  if (!args.overlays) {\r\n    throw new Error(\"Missing argument: overlays\");\r\n  } else if (!Array.isArray(args.overlays)) {\r\n    throw new TypeError(\"Invalid argument: overlays is not an array\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.removeOverlay,\r\n    parentId: this.geoId,\r\n    overlays: args.overlays,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.removeOverlays\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * Removes all immediate children from the overlay\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Overlay~clearContainerCallback} [args.onSuccess]\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n */\r\nemp3.api.Overlay.prototype.clearContainer = function (args) {\r\n  args = args || {};\r\n\r\n  // Format the request\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.clearFeatures,\r\n    overlay: this,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Overlay.clearContainer\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/*\r\n // TODO leave this in\r\n emp3.api.Overlay.prototype.clusterActivate = function (args) {\r\n var newName,\r\n cmd;\r\n\r\n args = args || {};\r\n if (!this.geoId || this.geoId.length < 1) {\r\n throw new Error(\"This overlay does not have an ID. Has it been added \" +\r\n \"to the map yet?\");\r\n }\r\n\r\n args.overlay = this;\r\n\r\n // Format the request\r\n cmd = {\r\n cmd: emp3.api.enums.channel.overlayClusterActivate,\r\n overlay: this,\r\n onSuccess: args.onSuccess,\r\n onError: args.onError\r\n };\r\n\r\n emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n source: this,\r\n method: \"Overlay.clusterActivate\",\r\n args: args\r\n });\r\n };\r\n */\r\n\r\n/*\r\n // TODO leave this in\r\n emp3.api.Overlay.prototype.clusterDeactivate = function (args) {\r\n var newName,\r\n cmd;\r\n\r\n args = args || {};\r\n if (!this.geoId || this.geoId.length < 1) {\r\n throw new Error(\"This overlay does not have an ID. Has it been added \" +\r\n \"to the map yet?\");\r\n }\r\n\r\n args.overlay = this;\r\n\r\n // Format the request\r\n cmd = {\r\n cmd: emp3.api.enums.channel.overlayClusterDeactivate,\r\n overlay: this,\r\n onSuccess: args.onSuccess,\r\n onError: args.onError\r\n };\r\n\r\n emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n source: this,\r\n method: \"Overlay.clusterDeactivate\",\r\n args: args\r\n });\r\n };\r\n */\r\n\r\n/*\r\n // TODO leave this in\r\n emp3.api.Overlay.prototype.clusterRemove = function (args) {\r\n var newName,\r\n cmd;\r\n\r\n args = args || {};\r\n if (!this.geoId || this.geoId.length < 1) {\r\n throw new Error(\"This overlay does not have an ID. Has it been added \" +\r\n \"to the map yet?\");\r\n }\r\n\r\n args.overlay = this;\r\n\r\n // Format the request\r\n cmd = {\r\n cmd: emp3.api.enums.channel.overlayClusterRemove,\r\n overlay: this,\r\n onSuccess: args.onSuccess,\r\n onError: args.onError\r\n };\r\n\r\n emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n source: this,\r\n method: \"Overlay.clusterRemove\",\r\n args: args\r\n });\r\n };\r\n */\r\n\r\n/**\r\n * @param {object} args\r\n * @param {emp3.api.Overlay~getParentsCallback} args.onSuccess\r\n * @param {emp3.api.Overlay~errorCallback} [args.onError]\r\n */\r\nemp3.api.Overlay.prototype.getParents = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  } else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"overlay\"],\r\n    select: [\"overlayId\", \"name\", \"properties\", \"parentId\"],\r\n    filter: [\r\n      {\r\n        property: \"childId\",\r\n        term: this.geoId\r\n      }\r\n    ],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Overlay.getParents\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n","if (!window.emp3) {\r\n  window.emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @interface\r\n * @classdesc This interface class defines the interface to all Map Services.\r\n * Map Services provide the backgrounds for the map.  Typically they are web\r\n * mapping services such as WMS, WMTS, etc, but they could be static data like\r\n * KML and KML links.  See {@link emp3.api.WMS}, {@link emp3.api.WMTS}, {@link emp3.api.KMLLayer}\r\n * for implementations of this interface.\r\n *\r\n * @param {object} [args] An optional object containing any mixture of the properties.  Any properties in the args\r\n * object that are not known properties will be ignored\r\n *\r\n * @see {@link emp3.api.KMLLayer}\r\n * @see {@link emp3.api.WMS}\r\n * @see {@link emp3.api.WMTS}\r\n */\r\nemp3.api.MapService = function(args) {\r\n  if (typeof args === 'undefined' || args === null || typeof args !== 'object') {\r\n    args = {\r\n      name: 'untitled map service',\r\n      description: '',\r\n      geoId: cmapi.randomUUID(),\r\n      url: ''\r\n    };\r\n  } else {\r\n    if (typeof args.name === 'undefined' || typeof args.name !== 'string') {\r\n      args.name = 'untitled map service';\r\n    }\r\n    if (typeof args.description === 'undefined' || typeof args.description !== 'string') {\r\n      args.description = '';\r\n    }\r\n    if (typeof args.geoId === 'undefined' || (typeof args.geoId !== 'string' && typeof args.geoId !== 'number')) {\r\n      args.geoId = cmapi.randomUUID();\r\n    }\r\n    if (typeof args.url === 'undefined' || typeof args.url !== 'string') {\r\n      args.url = undefined;\r\n    }\r\n  }\r\n\r\n  var _description = args.description;\r\n  /**\r\n   * Description of the service\r\n   * @name emp3.api.MapService#description\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"description\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _description;\r\n    },\r\n    set: function (value) {\r\n      _description = value;\r\n    }\r\n  });\r\n\r\n  var _geoId = args.geoId;\r\n  /**\r\n   * Unique identifier for the service\r\n   * @name emp3.api.MapService#geoId\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"geoId\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _geoId;\r\n    },\r\n    set: function (value) {\r\n      _geoId = value;\r\n    }\r\n  });\r\n\r\n  var _name = args.name;\r\n  /**\r\n   * Name of the service\r\n   * @name emp3.api.MapService#name\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"name\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _name;\r\n    },\r\n    set: function (value) {\r\n      _name = value;\r\n    }\r\n  });\r\n\r\n  var _url = args.url;\r\n  /**\r\n   * URL for the service data location\r\n   * @name emp3.api.MapService#url\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"url\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _url;\r\n    },\r\n    set: function (value) {\r\n      _url = value;\r\n    }\r\n  });\r\n\r\n  var _useProxy = args.useProxy;\r\n  /**\r\n   * Have the map use its configured web proxy.  This will be needed if the service is on a different domain than the map.\r\n   * @name emp3.api.MapService#useProxy\r\n   * @type {boolean}\r\n   */\r\n  Object.defineProperty(this, \"useProxy\", {\r\n    enumerable: false,\r\n    get: function () {\r\n      return _useProxy;\r\n    },\r\n    set: function (value) {\r\n      _useProxy = value;\r\n    }\r\n  });\r\n};\r\n//======================================================================================================================\r\n/**\r\n * @callback emp3.api.MapService~setVisibleCallback\r\n */\r\n\r\n/**\r\n * @callback emp3.api.MapService~removeCallback\r\n */\r\n//======================================================================================================================\r\n/**\r\n * Removes this layer from the map\r\n * @param {object} args\r\n * @param {emp3.api.MapService~removeCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n */\r\nemp3.api.MapService.prototype.remove = function(args) {\r\n  if (!this.id || this.id.length < 1) {\r\n    throw new Error(\"This layer does not have an ID. Has it been added \" +\r\n      \"to the map yet?\");\r\n  }\r\n  args = args || {};\r\n  var cmd = {\r\n    cmd: emp3.api.channels.unplotFeature,\r\n    feature: this,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"MapService.remove\",\r\n    args: args\r\n  });\r\n  this.overlay = undefined;\r\n};\r\n\r\n/**\r\n * Sets the Service and all associated layers hidden or shown\r\n * @param {object} args\r\n * @param {boolean} args.visible\r\n * @param {emp3.api.MapService~setVisibleCallback} [args.onSuccess]\r\n * @param {ErrorCallback} [args.onError]\r\n */\r\nemp3.api.MapService.prototype.setVisible = function(args) {\r\n  args = args || {};\r\n  if (!this.id || this.id.length < 1) {\r\n    throw new Error(\"This layer does not have an ID. Has it been added to the map yet?\");\r\n  }\r\n  var visible = true;\r\n  if (typeof args.visible == 'boolean') {\r\n    visible = args.visible;\r\n    this.properties.visible = args.visible;\r\n  }\r\n  // Format the request\r\n  var cmd = {\r\n    cmd: visible ? emp3.api.channels.showFeature : emp3.api.channels.hideFeature,\r\n    layer: this,\r\n    visible: visible,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Layer.setVisible\",\r\n    args: args\r\n  });\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * @extends {emp3.api.MapService}\r\n * @classdesc This class defines the interface to WMS.\r\n *\r\n * A WMS object allows someone to add a service as a map background to the map.\r\n * The WMS and its content is not 'selectable', it serves a way to supplement the\r\n * existing map with additional background images.  Once the WMS has been added\r\n * to the map you can control whether the WMS is visible or hidden.\r\n * <p>\r\n * To add or remove layers from the map, re-add the WMS using emp3.api.Map.addMapService\r\n * with updated layer parameters.\r\n *\r\n * @param {Object} args Arguments object\r\n * @param {String} args.layers A comma separated list of layer names that you\r\n * want displayed for this service. The layer names can be retrieved by making a\r\n * call to the WMS service GetCapabilities call.\r\n * @param {String} [args.version='1.3'] WMS version\r\n * @param {String} [args.tileFormat='image/png'] Image format\r\n * @param {boolean} [args.transparent=false] Whether the layers will be transparent or not\r\n *\r\n * @example <caption>Creating a WMS service and adding it to a map</caption>\r\n *\r\n * var noaaWMS = new emp3.api.WMS({\r\n *   url: 'http://idpgis.ncep.noaa.gov/arcgis/services/NWS_Observations/radar_base_reflectivity/MapServer/WMSServer',\r\n *   name: 'NOAA Conus Base Reflectivity',\r\n *   description: 'NWS Doppler Radar base reflectivity for CONUS.',\r\n *   layers: '1,2,3',\r\n *   version: '1.3'\r\n *  });\r\n *\r\n * map.addMapService({\r\n *   mapService: noaaWMS,\r\n *   onSuccess: function() {\r\n *     // callbacks or notification of complete\r\n *   }\r\n * });\r\n *\r\n * @example <caption>Updating the WMS service with additional layers. </caption>\r\n *\r\n * var wms = new emp3.api.WMS({\r\n *   name: 'Dark Earth',\r\n *   geoId: 'darkEarth1',\r\n *   url: 'http://worldwind25.arc.nasa.gov/wms',\r\n *   layers: 'earthatnight'\r\n * });\r\n *\r\n * map1.addMapService({\r\n *   mapService: wms\r\n * });\r\n * .\r\n * . // do some other stuff\r\n * .\r\n * .\r\n * wms.layers = 'earthatnight,FAAChart';  // update the layer parameters with the new addition of FAAChart layer.\r\n * map1.addMapService({\r\n *   mapService: wms\r\n * });\r\n */\r\nemp3.api.WMS = function(args) {\r\n\r\n  if (typeof args === 'undefined' || args === null || typeof args !== 'object') {\r\n    args = {\r\n      version: '1.3',\r\n      transparent: false,\r\n      layers: [],\r\n      tileFormat: 'image/png'\r\n    };\r\n  } else {\r\n    if (typeof args.version === 'undefined' || typeof args.version !== 'string') {\r\n      args.version = '1.3';\r\n    }\r\n    if (typeof args.transparent === 'undefined' || typeof args.version !== 'boolean') {\r\n      args.transparent = false;\r\n    }\r\n    if (typeof args.tileFormat === 'undefined' || typeof args.tileFormat !== 'string') {\r\n      args.tileFormat = 'image/png';\r\n    }\r\n    if (typeof args.layers === 'undefined' || !Array.isArray(args.layers)) {\r\n      if (typeof args.layers === 'string') {\r\n        args.layers = args.layers.split(',');\r\n      } else {\r\n        args.layers = [];\r\n      }\r\n    }\r\n  }\r\n\r\n  emp3.api.MapService.call(this, args);\r\n\r\n  /**\r\n   * @default wms\r\n   * @name emp3.api.WMS#format\r\n   * @const\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, 'format', {\r\n    enumerable: true,\r\n    writable: false,\r\n    value: 'wms'\r\n  });\r\n\r\n  var _version = args.version;\r\n  /**\r\n   * @name emp3.api.WMS#version\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"version\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _version;\r\n    },\r\n    set: function (value) {\r\n      _version = value;\r\n    }\r\n  });\r\n\r\n  var _layers = args.layers;\r\n  /**\r\n   * A comma delimited string of layers\r\n   * @name emp3.api.WMS#layers\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"layers\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _layers;\r\n    },\r\n    set: function (value) {\r\n      _layers = value;\r\n    }\r\n  });\r\n\r\n  var _tileFormat = args.tileFormat;\r\n  /**\r\n   * @name emp3.api.WMS#tileFormat\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"tileFormat\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _tileFormat;\r\n    },\r\n    set: function (value) {\r\n      _tileFormat = value;\r\n    }\r\n  });\r\n\r\n  var _transparent = args.transparent;\r\n  /**\r\n   * @name emp3.api.WMS#transparent\r\n   * @type {boolean}\r\n   */\r\n  Object.defineProperty(this, \"transparent\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _transparent;\r\n    },\r\n    set: function (value) {\r\n      _transparent = value;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.MapService\r\nemp3.api.WMS.prototype = new emp3.api.MapService({\r\n  type: \"wms\",\r\n  format: \"wms\",\r\n  url: \"\"\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * @extends {emp3.api.MapService}\r\n * @classdesc This class defines the interface to a Web Map Tile Service (WMTS).\r\n * A WMTS Service may be set up on a server.  WMTS Service may provide a one or\r\n * more layers that may be added to the map.  To add a WMTS Service onto the map you\r\n * must know the layer id of the layer from the WMTS Service.  A list of layers\r\n * and layer ids can be provided by the WMTS service by a call to its\r\n * GetCapabilities method. Unlike WMS, WMTS does not allow a singleton\r\n * request that merges multiple layers in a single call.  To add more than\r\n * one layer, you must add multiple WMTS services.\r\n * <p>\r\n * The map will manage which tiles should be requested for display on the\r\n * screen at any given\r\n * time.\r\n * <p>\r\n * The WMTS will default the version to 1.0.0, the tile format to the image/png\r\n * mime type, and the setting the style id to 'default'.  You may override these\r\n * defaults with your own.\r\n *\r\n *\r\n * @param {Object} args Arguments members are provided as part of the args object\r\n * @param {String} args.url The url of the WMTS map service\r\n * @param {String} args.layer The id of the layer from the WMTS service\r\n * @param {String} [args.name] A name for display to the user.\r\n * @param {String} [args.description] A short description of what the service\r\n * is showing.  For use to display to the user.\r\n * @param {String} [args.version='1.0.0'] A string specifying the version of the\r\n * WMTS service being used.\r\n * @param {String} [args.tileFormat='image/png'] A mime type specifying the image\r\n * format of the response of the service.\r\n * @param {String} [args.style='default'] The style id for the layer.  this\r\n * should match one of the styles returned in the GetCapabilities response.\r\n * @param {Object} [args.sampleDimensions] A JSON object that contains key value pairs\r\n * of parameters that can be set for the service.  These parameters map be unique to a WMTS service\r\n * and are defined in the GetCapabilities response.  Sample properties are\r\n * 'elevation' and 'time'.\r\n * @param {boolean} [args.useProxy = false] Specifies if the the map uses its\r\n * configured web proxy.  This will be needed if the service is on a different\r\n * domain than the map.\r\n *\r\n * @example\r\n *\r\n * var wmts = new emp3.api.WMTS({\r\n *   url: 'http://mymapserve/wmts',\r\n *   name: 'JOGA FT DRUM',\r\n *   description: '1:250K Map of Fort Drum',\r\n *   layer: '1',\r\n *  });\r\n *\r\n *  map.addMapService({\r\n *    mapService: wmts,\r\n *    onSuccess: function() {\r\n *      // callbacks or notification of complete\r\n *    }\r\n *  });\r\n */\r\nemp3.api.WMTS = function(args) {\r\n\r\n\r\n  if (typeof args === 'undefined' || args === null || typeof args !== 'object') {\r\n    args = {\r\n      version: '1.0.0',\r\n      tileFormat: 'image/png',\r\n      style: 'default'\r\n    };\r\n  } else {\r\n    if (typeof args.version === 'undefined' || typeof args.version !== 'string') {\r\n      args.version = '1.0.0';\r\n    }\r\n    if (typeof args.tileFormat === 'undefined' || typeof args.tileFormat !== 'string') {\r\n      args.tileFormat = 'image/png';\r\n    }\r\n    if (typeof args.style === 'undefined' || typeof args.style !== 'string') {\r\n      args.style = 'default';\r\n    }\r\n  }\r\n\r\n  emp3.api.MapService.call(this, args);\r\n\r\n  /**\r\n   * @default wmts\r\n   * @name emp3.api.WMTS#format\r\n   * @const\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, 'format', {\r\n    enumerable: true,\r\n    writable: false,\r\n    value: 'wmts'\r\n  });\r\n\r\n  var _version = args.version;\r\n  /**\r\n   * @name emp3.api.WMTS#version\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"version\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _version;\r\n    },\r\n    set: function (value) {\r\n      _version = value;\r\n    }\r\n  });\r\n\r\n  var _style = args.style;\r\n  /**\r\n   * @name emp3.api.WMTS#style\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"style\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _style;\r\n    },\r\n    set: function (value) {\r\n      _style = value;\r\n    }\r\n  });\r\n\r\n  var _tileFormat = args.tileFormat;\r\n  /**\r\n   * @name emp3.api.WMTS#tileFormat\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"tileFormat\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _tileFormat;\r\n    },\r\n    set: function (value) {\r\n      _tileFormat = value;\r\n    }\r\n  });\r\n\r\n  var _layer = args.layer;\r\n  /**\r\n   * @name emp3.api.WMTS#layer\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"layer\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _layer;\r\n    },\r\n    set: function (value) {\r\n      _layer = value;\r\n    }\r\n  });\r\n\r\n  var _sampleDimensions = args.sampleDimensions;\r\n  /**\r\n   * @name emp3.api.WMTS#version\r\n   * @type {object}\r\n   */\r\n  Object.defineProperty(this, \"sampleDimensions\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _sampleDimensions;\r\n    },\r\n    set: function (value) {\r\n      _sampleDimensions = value;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.MapService\r\nemp3.api.WMS.prototype = new emp3.api.MapService({\r\n  type: \"wmts\",\r\n  format: \"wmts\",\r\n  url: \"\"\r\n});\r\n","if (!window.emp3) {\r\n    emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n    emp3.api = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * @extends {emp3.api.MapService}\r\n * @constructor\r\n * @classdesc This class defines the interface to a KML Layer. It requires a\r\n * url that points to a KML data source, a KMZ data source or a blob of KML data.\r\n * The data that shows on the map from a KMLLayer cannot be selected, edited, or modified. This KML\r\n * data will not raise emp3.api.events.FeatureUserInteractionEvent events.\r\n * It becomes a map background.  To create selectable, editable KML data, use the emp3.api.KML\r\n * Feature class.\r\n * <p>\r\n * The KMLLayer will check the url property first to see if it has been defined.\r\n * If it hasn't been defined, then it will check the kmlString property.\r\n *\r\n * @param {Object} args Arguments members are provided as part of the args object\r\n *\r\n * @example <caption>Creating 2 KML Layers and adding them to a map</caption>\r\n * var kmlLayer1 = new emp3.api.KMLLayer({\r\n *   name: 'Pentagon',\r\n *   description: 'KML displaying Pentagon.',\r\n *   kmlString: \"<kml>\r\n *                 <Document>\r\n *                    <Placemark id=\"f2\">\r\n *                      <name>\r\n *                        Feature Collection Test 1\r\n *                      </name>\r\n *                      <description>\r\n *                        <![CDATA[<br/><table border=\\\"1\\\" cellpadding=\\\"2\\\" cellspacing=\\\"0\\\" width=100%><tr ><td><b>lineColor</b></td><td>7f00ffff</td></tr><tr  bgcolor=\\\"#F0F0F0\\\"><td><b>lineThickness</b></td><td>5</td></tr></table>]]>\r\n *                      </description>\r\n *                      <Style id=\"geomcollection\">\r\n *                        <LineStyle>\r\n *                          <color>7fffff00</color>\r\n *                          <width>5</width>\r\n *                        </LineStyle>\r\n *                        <PolyStyle>\r\n *                          <color>88000000</color>\r\n *                        </PolyStyle>\r\n *                        <LabelStyle>\r\n *                          <color>FFFFFFFF</color>\r\n *                        </LabelStyle>\r\n *                        <IconStyle>\r\n *                          <color>00000000</color>\r\n *                        </IconStyle>\r\n *                      </Style>\r\n *                      <MultiGeometry>\r\n *                        <LineString>\r\n *                          <tessellate>1</tessellate>\r\n *                          <coordinates>102,0 103,1 104,0 105,1</coordinates>\r\n *                        </LineString>\r\n *                        <Point>\r\n *                          <coordinates>103.5,0.5</coordinates>\r\n *                        </Point>\r\n *                      </MultiGeometry>\r\n *                    </Placemark>\r\n *                </Document>\r\n *             </kml>\"\"\r\n *   }\r\n * });\r\n *\r\n * var kmlLayer2 = new emp3.api.KMLLayer({\r\n *   url: 'https://developers.google.com/maps/documentation/javascript/examples/kml/westcampus.kml',\r\n *   name: 'Google west campus',\r\n *   description: 'KML displaying Google's west campus.',\r\n *   useProxy: false\r\n *  });\r\n *\r\n *  map.addMapService({\r\n *    mapService: kmlLayer1,\r\n *    onSuccess: function() {\r\n *      // callbacks or notification of complete\r\n *    }\r\n *  });\r\n *\r\n *  map.addMapService({\r\n *    mapService: kmlLayer2,\r\n *    onSuccess: function() {\r\n *      // callbacks or notification of complete\r\n *    }\r\n *  });\r\n */\r\nemp3.api.KMLLayer = function (args) {\r\n  // Initialize the args object to the default.\r\n  args = args || {};\r\n  \r\n  emp3.api.MapService.call(this, args);\r\n\r\n  // Should URL supersede data blob?\r\n  var _kmlString = args.url === undefined ? args.kmlString : undefined;\r\n  /**\r\n   * @name emp3.api.KMLLayer#kmlString\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"kmlString\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _kmlString;\r\n    },\r\n    set: function (value) {\r\n      _kmlString = value;\r\n    }\r\n  });\r\n\r\n  /**\r\n   * @name emp3.api.KMLLayer#format\r\n   * @const\r\n   * @default kmlLayer\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, 'format', {\r\n    enumerable: true,\r\n    writable: false,\r\n    value: 'kmlLayer'\r\n  });\r\n};\r\n\r\n// Extend emp3.api.MapService\r\nemp3.api.KMLLayer.prototype = Object.create(emp3.api.MapService.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @interface\r\n * @augments {emp3.api.Container}\r\n * @augments {cmapi.IGeoRenderable}\r\n *\r\n * @classdesc This class represents the root class for all inherited feature classes in EMP3\r\n *\r\n * Implemented by:\r\n * - {@link emp3.api.AirControlMeasure}\r\n * - {@link emp3.api.Circle}\r\n * - {@link emp3.api.Ellipse}\r\n * - {@link emp3.api.MilStdSymbol}\r\n * - {@link emp3.api.Path}\r\n * - {@link emp3.api.Point}\r\n * - {@link emp3.api.Polygon}\r\n * - {@link emp3.api.Rectangle}\r\n * - {@link emp3.api.Square}\r\n * - {@link emp3.api.Text}\r\n */\r\nemp3.api.Feature = function (args) {\r\n  var _featureType = null;\r\n  cmapi.inherit(new cmapi.IGeoRenderable(), this);\r\n\r\n  // Make sure that there is an args object.\r\n  args = args || {};\r\n\r\n  // The geoJSON type of the feature.  This is always \"Feature\".  The type must be specified\r\n  // so that these objects are valid geoJSON.\r\n  this.type = \"Feature\";\r\n\r\n  this.data = args.data;\r\n\r\n  this.properties = args.properties || {};\r\n\r\n  this.readOnly = args.readOnly;\r\n\r\n  // Validate position coordinates\r\n  if (args.position) {\r\n    if (typeof args.position.latitude === 'number' &&\r\n      (args.position.latitude > 90.0 || args.position.latitude < -90.0)) {\r\n      throw new Error('Invalid latitude: latitude must be between 90.0 and -90.0');\r\n    }\r\n\r\n    if (typeof args.position.longitude === 'number' &&\r\n      (args.position.longitude > 180.0 || args.position.longitude < -180.0)) {\r\n      throw new Error('Invalid longitude: longitude must be between 180.0 and -180.0');\r\n    }\r\n  } else if (args.positions) {\r\n    var coords = args.positions.length;\r\n    for (var idx = 0; idx < coords; idx++) {\r\n      if (args.positions[idx].latitude > 90.0 || args.positions[idx].latitude < -90.0) {\r\n        throw new Error('Invalid latitude: latitude must be between 90.0 and -90.0');\r\n      }\r\n\r\n      if (args.positions[idx].longitude > 180.0 || args.positions[idx].longitude < -180.0) {\r\n        throw new Error('Invalid longitude: longitude must be between 180.0 and -180.0');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The type of feature this represents.\r\n   * @name emp3.api.Feature#featureType\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _featureType;\r\n    },\r\n    set: function (value) {\r\n      _featureType = value;\r\n    }\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\nemp3.api.Feature.prototype = new emp3.api.Container();\r\n\r\n// =====================================================================================================================\r\n// Function Callbacks ==================================================================================================\r\n\r\n/**\r\n * This callback is invoked after any successful addFeature or addFeatures call\r\n * @callback emp3.api.Feature~addFeaturesSuccessCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {emp3.api.Feature[]} cbArgs.features The feature that was added\r\n * @param {emp3.api.Feature[]} cbArgs.failures Any failures that occurred\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * This callback is invoked once all child features have been returned\r\n * @callback emp3.api.Feature~getChildrenSuccessCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {emp3.api.Feature[]} cbArgs.features List of the child features\r\n * @param {emp3.api.Feature[]} cbArgs.failures List of failures\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * This callback is invoked after successfully removing a child feature\r\n * This function will be replaced in future versions to return objects instead of strings\r\n *\r\n * @callback emp3.api.Feature~removeFeaturesSuccessCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {FeatureIdentifier[]} cbArgs.featureIds List of features that were removed\r\n * @param {string[]} cbArgs.failures Any failures which resulted in features not being removed\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * @typedef {object} FeatureIdentifier\r\n * Collection of unique identifiers for removing features\r\n *\r\n * @property {string} featureId ID of the feature\r\n * @property {string} overlayId ID of the overlay the feature was on\r\n * @property {string} parentId ID of the parent of the feature\r\n */\r\n\r\n/**\r\n * This callback is invoked after successfully retrieving all parents of the feature\r\n * @callback emp3.api.Feature~getParentsSuccessCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {emp3.api.Feature[]} cbArgs.features All parent features of the feature\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays All parent overlays of the feature\r\n * @param {emp3.api.Overlay[]|emp3.api.Feature[]} cbArgs.failures Combined list of any failures\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * This callback is invoked after successfully retrieving all parent features of the feature\r\n * @callback emp3.api.Feature~getParentFeaturesSuccessCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {emp3.api.Feature[]} cbArgs.features All parent features of the feature\r\n * @param {emp3.api.Feature[]} cbArgs.failures List of any failures\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * This callback is invoked after successfully retrieving all parent features of the feature\r\n * @callback emp3.api.Feature~getParentOverlaysSuccessCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {emp3.api.Overlay[]} cbArgs.overlays All parent overlays of the feature\r\n * @param {emp3.api.Overlay[]} cbArgs.failures List of any failures\r\n * @param {emp3.api.Feature} cbArgs.source The feature which invoked the call\r\n */\r\n\r\n/**\r\n * A callback indicating the method did not execute as intended.\r\n * @callback emp3.api.Feature~onErrorCallback\r\n *\r\n * @param {object} cbArgs Arguments object\r\n * @param {string} cbArgs.errorMessage Message detailing the error\r\n */\r\n\r\n// =====================================================================================================================\r\n// Feature prototypical functions ======================================================================================\r\n\r\n/**\r\n * Updates this feature on the map.  To update this feature you can set the\r\n * properties of the feature first (such as feature.name and feature.strokeStyle). The change\r\n * will not be registered until apply is called;\r\n *\r\n * Certain properties will not be affected by apply depending on the feature type.\r\n *\r\n * @example <caption>Change the name and position of a feature</caption>\r\n * var circle = new emp3.api.Circle({\r\n *   name: 'circle',\r\n *   position: {latitude: 0, longitude: 0},\r\n *   radius: 10000\r\n * });\r\n *\r\n * circle.name = 'updatedCircle';\r\n * circle.position = {latitude: 5, longitude, 0};\r\n * circle.apply();\r\n */\r\nemp3.api.Feature.prototype.apply = function () {\r\n\r\n  // Validate properties\r\n  if (this.positions) {\r\n    var numPositions = this.positions.length;\r\n    for (var idx = 0; idx < numPositions; idx++) {\r\n      if (this.positions[idx].latitude > 90.0 || this.positions[idx].latitude < -90.0) {\r\n        throw new Error('Invalid latitude: latitude must be between 90.0 and -90.0');\r\n      }\r\n      if (this.positions[idx].longitude > 180.0 || this.positions[idx].longitude < -180.0) {\r\n        throw new Error('Invalid longitude: longitude must be between 180.0 and -180.0');\r\n      }\r\n    }\r\n  }\r\n\r\n  emp3.api.MessageHandler.getInstance().apply(this);\r\n};\r\n\r\n/**\r\n * This will group features together on the map as if this feature is an overlay.  When this feature's visibility is\r\n * changed the map will set the visibility of its children.  This function allows users to build composite\r\n * graphics from a collection of Features.\r\n *\r\n * The parent feature must already exist on an overlay before children can be added.\r\n *\r\n * <p>\r\n * Not supported in CMA 1.2\r\n *\r\n * @see emp3.api.Feature#addFeatures\r\n *\r\n * @param {Object} args Parameters are provided as members of the arg object.\r\n * @param {emp3.api.Feature} args.feature A emp3.api.Feature object to associate with this Feature.\r\n * @param {boolean} [args.visible=true] Sets if the feature should be visible initially when added to the map.\r\n * @param {emp3.api.Feature~addFeaturesSuccessCallback} [args.onSuccess] Function to be called if the add is successful.\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Function to be called if an error occurs.\r\n *\r\n * @example <caption>One nested child</caption>\r\n * var circle = new emp3.api.Circle({\r\n * name: 'parent',\r\n *  position: {latitude: 45, longitude: 44},\r\n *  radius: 100000\r\n * });\r\n *\r\n * var childCircle = new emp3.api.Circle({\r\n *  name: 'child',\r\n *  position: {latitude: 45, longitude: 44},\r\n *  radius: 500000\r\n * });\r\n *\r\n * overlay.addFeatures({\r\n *  features: [circle, childCircle],\r\n *  onSuccess: function () {\r\n *    circle.addFeature({\r\n *     feature: childCircle,\r\n *     onSuccess: function (cbArgs) {\r\n *       window.console.log(cbArgs.source.name + ' added child ' + cbArgs.features[0].name);\r\n *     }\r\n *   });\r\n *  }\r\n * });\r\n */\r\nemp3.api.Feature.prototype.addFeature = function (args) {\r\n  args = args || {};\r\n  if (!args.feature) {\r\n    throw new Error('Missing argument: feature');\r\n  } else if (Array.isArray(args.feature)) {\r\n    args.features = args.feature;\r\n  } else {\r\n    args.features = [args.feature];\r\n  }\r\n  if (!args.visible) {\r\n    args.visible = true;\r\n  }\r\n\r\n  this.addFeatures(args);\r\n};\r\n\r\n/**\r\n * @summary Adds a feature or a group of features as children.\r\n *\r\n * This will group features together on the map as if this feature is an overlay.  When this feature's visibility is\r\n * changed the map will set the visibility of its children.  This function allows users to build composite\r\n * graphics from a collection of Features.\r\n *\r\n * @see emp3.api.Feature#addFeature\r\n *\r\n * @param {Object} args Parameters are provided as members of the arg object.\r\n * @param {emp3.api.Feature[]} args.features An array of Feature objects to associate with this Feature.\r\n * @param {boolean} [args.visible=true] Sets if the features should be visible initially when added to the map.\r\n * @param {emp3.api.Feature~addFeaturesSuccessCallback} [args.onSuccess] Function to be called if the add is successful.i\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Function to be called if an error occurs.\r\n */\r\nemp3.api.Feature.prototype.addFeatures = function (args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n  if (!args.features && Object.prototype.toString.call(args.features) === \"[object Array]\") {\r\n    throw new Error(\"Missing argument: features\");\r\n  }\r\n\r\n  args.visible = (typeof args.visible === 'boolean') ? args.visible : true;\r\n  args.zoom = (typeof args.zoom === 'boolean') ? args.zoom : false;\r\n\r\n  if (args.features.length > 0) {\r\n    cmd = {\r\n      cmd: emp3.api.enums.channel.plotFeature,\r\n      parentId: this.geoId,\r\n      features: args.features,\r\n      visible: args.visible,\r\n      onSuccess: args.onSuccess,\r\n      onError: args.onError\r\n    };\r\n\r\n    emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n      source: this,\r\n      method: \"Feature.addFeatures\",\r\n      args: args\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Retrieves a list of all the feature's child features.\r\n * @param {Object} args\r\n * @param {emp3.api.Feature~getChildrenSuccessCallback} args.onSuccess All features contained by this feature.\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Function to be called if an error occurs.\r\n */\r\nemp3.api.Feature.prototype.getChildFeatures = function (args) {\r\n  this.getChildren(args);\r\n};\r\n\r\n/**\r\n * Removes a single feature from this feature.\r\n *\r\n * @see emp3.api.Feature#removeFeatures\r\n *\r\n * @param {Object} args Parameters are provided as members of the arg object.\r\n * @param {emp3.api.Feature} args.feature A Feature object to remove from this Feature.\r\n * @param {emp3.api.Feature~removeFeaturesSuccessCallback} [args.onSuccess] Function to be called if the add is successful.\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Function to be called if an error occurs.\r\n *\r\n * @example\r\n * var parent = new emp3.api.Square(...);\r\n * var child = new emp3.api.Text(...);\r\n *\r\n * var removeFeatureCB = function() {\r\n *   parent.removeFeature({\r\n *     feature: child,\r\n *     onSuccess: function() {\r\n *       alert();\r\n *     }\r\n * };\r\n *\r\n * var addChildCB = function() {\r\n *   parent.addFeature({\r\n *     feature: child,\r\n *     onSuccess: removeFeatureCB\r\n *   });\r\n * };\r\n *\r\n * overlay.addFeatures({\r\n *   features: [parent, child],\r\n *   onSuccess: addChildCB\r\n * });\r\n */\r\nemp3.api.Feature.prototype.removeFeature = function (args) {\r\n  args = args || {};\r\n\r\n  if (!args.feature) {\r\n    throw new Error('Missing argument: feature');\r\n  } else if (Array.isArray(args.feature)) {\r\n    args.features = args.feature;\r\n  } else {\r\n    args.features = [args.feature];\r\n  }\r\n\r\n  this.removeFeatures(args);\r\n};\r\n\r\n/**\r\n * Removes an array of features from this feature.\r\n *\r\n * @see emp3.api.Feature#removeFeature\r\n *\r\n * @param {Object} args Parameters are provided as members of the arg object.\r\n * @param {emp3.api.Feature[]} args.features An array of Feature objects to remove from this Feature.\r\n * @param {emp3.api.Feature~removeFeaturesSuccessCallback} [args.onSuccess] Function to be called if the add is successful.\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Function to be called if an error occurs.\r\n */\r\nemp3.api.Feature.prototype.removeFeatures = function (args) {\r\n  var cmd;\r\n\r\n  args = args || {};\r\n  if (!args.features || !Array.isArray(args.features)) {\r\n    throw new Error(\"Missing argument: features\");\r\n  }\r\n\r\n  cmd = {\r\n    cmd: emp3.api.enums.channel.unplotFeatureBatch,\r\n    parentId: this.geoId,\r\n    features: args.features,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n    source: this,\r\n    method: \"Feature.removeFeatures\",\r\n    args: args\r\n  });\r\n};\r\n\r\n/**\r\n * This method removes all children from this container.\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Feature~removeFeaturesSuccessCallback} [args.onSuccess]\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError]\r\n *\r\n * @example <caption>With a callback</caption>\r\n * parentFeature.clearContainer({\r\n *   onSuccess: function() { alert(); }\r\n * });\r\n *\r\n * @example <caption>No callback</caption>\r\n * parentFeature.clearContainer();\r\n */\r\nemp3.api.Feature.prototype.clearContainer = function (args) {\r\n  args = args || {};\r\n\r\n  var parent = this;\r\n  this.getChildFeatures({\r\n    onSuccess: function (cbArgs) {\r\n      var cmd = {\r\n        cmd: emp3.api.enums.channel.unplotFeatureBatch,\r\n        features: cbArgs.features,\r\n        parentId: parent.geoId,\r\n        onSuccess: args.onSuccess,\r\n        onError: args.onError\r\n      };\r\n      emp3.api.MessageHandler.getInstance().sendMessage(cmd, {\r\n        method: 'Feature.clearContainer',\r\n        source: this,\r\n        args: args\r\n      });\r\n    }.bind(this)\r\n  });\r\n};\r\n\r\n/**\r\n * This method retrieves the immediate children of the feature.\r\n *\r\n * @param {object} args\r\n * @param {emp3.api.Feature~getChildrenSuccessCallback} args.onSuccess\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError]\r\n *\r\n * @example\r\n * myFeature.getChildren({\r\n *   onSuccess: function(cbArgs) {\r\n *     for (var idx in cbArgs.features) {\r\n *       window.console.log(cbArgs.features[idx]);\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.Feature.prototype.getChildren = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  } else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"feature\"],\r\n    select: [\"parentId\", \"overlayId\", \"name\", \"properties\"],\r\n    filter: [\r\n      {\r\n        property: \"parentId\",\r\n        term: this.geoId\r\n      }\r\n    ],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Feature.getChildren\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n/**\r\n * This retrieves the parents of a feature. These can be either {@link emp3.api.Feature} or {@link emp3.api.Overlay}\r\n * @param {object} args\r\n * @param {emp3.api.Feature~getParentsSuccessCallback} args.onSuccess Success callback\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Error callback\r\n *\r\n * @example <caption>Add a feature to two parents</caption>\r\n * var parent1Feature = new emp3.api.Circle(...)\r\n * var parent2Feature = new emp3.api.Rectangle(...);\r\n * var childFeature = new emp3.api.Square(...);\r\n *\r\n * // Callback to get the parent\r\n * var getParentsCB = function() {\r\n *   childFeature.getParents({\r\n *     onSuccess: function(cbArgs) {\r\n *       window.console.log(cbArgs.features, cbArgs.overlays);\r\n *     }\r\n *   })\r\n * };\r\n *\r\n * // Add the child to both parents\r\n * var addChild = function () {\r\n *   parent1Feature.addFeature({\r\n *     feature: childFeature,\r\n *     onSuccess: function() {\r\n *       parent2Feature.addFeature({\r\n *         feature: childFeature,\r\n *         onSuccess: getParentsCB\r\n *       });\r\n *     }\r\n *   });\r\n * }\r\n *\r\n * // Add the parents to the overlay and invoke the other callbacks\r\n * overlay.addFeatures({\r\n *   features: [parent1Feature, parent2Feature],\r\n *   onSuccess: addChild\r\n * });\r\n *\r\n */\r\nemp3.api.Feature.prototype.getParents = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  } else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"overlay\", \"feature\"],\r\n    select: [\"overlayId\", \"featureId\", \"name\", \"properties\", \"parentId\"],\r\n    filter: [\r\n      {\r\n        property: \"childId\",\r\n        term: this.geoId\r\n      }\r\n    ],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Feature.getParents\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n/**\r\n * This retrieves the parent {@link emp3.api.Feature} features of a feature.\r\n * @param {object} args\r\n * @param {emp3.api.Feature~getParentFeaturesSuccessCallback} args.onSuccess Success callback\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Error callback\r\n */\r\nemp3.api.Feature.prototype.getParentFeatures = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  } else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"feature\"],\r\n    select: [\"featureId\", \"name\", \"properties\", \"parentId\"],\r\n    filter: [\r\n      {\r\n        property: \"childId\",\r\n        term: this.geoId\r\n      }\r\n    ],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Feature.getParentFeatures\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n/**\r\n * This retrieves the parent {@link emp3.api.Overlay} overlays of a feature.\r\n * @param {object} args\r\n * @param {emp3.api.Feature~getParentOverlaysSuccessCallback} args.onSuccess Success callback\r\n * @param {emp3.api.Feature~onErrorCallback} [args.onError] Error callback\r\n */\r\nemp3.api.Feature.prototype.getParentOverlays = function (args) {\r\n  args = args || {};\r\n\r\n  if (typeof args.onSuccess === 'undefined') {\r\n    throw new Error(\"Missing Argument: onSuccess\");\r\n  } else if (typeof args.onSuccess !== \"function\") {\r\n    throw new TypeError(\"Invalid Argument: expected onSuccess to be a function\");\r\n  }\r\n\r\n  var cmd = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: [\"overlay\"],\r\n    select: [\"overlayId\", \"name\", \"properties\", \"parentId\"],\r\n    filter: [\r\n      {\r\n        property: \"childId\",\r\n        term: this.geoId\r\n      }\r\n    ],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    method: \"Feature.getParentOverlays\",\r\n    source: this,\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(cmd, callInfo);\r\n};\r\n\r\n// =====================================================================================================================\r\n// Feature Mixins and other virtual docs ===============================================================================\r\n/**\r\n * This is the list of classes which inherit from {@link emp3.api.Feature}\r\n *\r\n * @see {@link emp3.api.AirControlMeasure}\r\n * @see {@link emp3.api.Circle}\r\n * @see {@link emp3.api.Ellipse}\r\n * @see {@link emp3.api.MilStdSymbol}\r\n * @see {@link emp3.api.Path}\r\n * @see {@link emp3.api.Point}\r\n * @see {@link emp3.api.Polygon }\r\n * @see {@link emp3.api.Rectangle}\r\n * @see {@link emp3.api.Square}\r\n * @see {@link emp3.api.Text}\r\n *\r\n * @mixin Feature\r\n */\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * The constructor arguments are mutually exclusive. If an object is set, type will be ignored.\r\n * @class\r\n * @augments {emp3.api.Feature}\r\n * @augments {cmapi.IGeoAirControlMeasure}\r\n *\r\n * @classdesc This class Implements an air control measure or airspace.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoAirControlMeasure}.\r\n *\r\n * @example\r\n * var acm = new emp3.api.AirControlMeasure({\r\n *   acmType: cmapi.enums.acmType.TRACK,\r\n *   name: \"acm_track\",\r\n *   fillStyle: {\r\n *     fillColor: {\r\n *       red: 255,\r\n *       green: 0,\r\n *       blue: 0,\r\n *       alpha: 1\r\n *     }\r\n *   },\r\n *   positions: [\r\n *     {latitude: 0, longitude: -30},\r\n *     {latitude: 30, longitude: -30},\r\n *     {latitude: 30, longitude: 0}\r\n *   ],\r\n *   attributes: [{\r\n *     minAlt: 1000,\r\n *     maxAlt: 50000,\r\n *     leftWidth: 5000,\r\n *     rightWidth: 98000\r\n *   }, {\r\n *     minAlt: 10000,\r\n *     maxAlt: 50000,\r\n *     leftWidth: 15000,\r\n *     rightWidth: 8000\r\n *   }]\r\n * });\r\n *\r\n * overlay.addFeature({\r\n *   feature: acm,\r\n *   onSuccess: function () {\r\n *     window.console.log('ACM added');\r\n *   }\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.AirControlMeasure = function (args) {\r\n\r\n  args = args || {};\r\n\r\n  cmapi.inherit(new cmapi.IGeoAirControlMeasure(), this);\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  var _acmType = cmapi.enums.acmType.CYLINDER;\r\n\r\n  /**\r\n   * @property {string}\r\n   * @name emp3.api.AirControlMeasure#acmType\r\n   */\r\n  Object.defineProperty(this, \"acmType\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _acmType;\r\n    },\r\n    set: function (value) {\r\n      _acmType = value;\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Holder for the attributes\r\n   * @private\r\n   */\r\n  var _attributes = [{\r\n    minAlt: 10000,\r\n    maxAlt: 20000,\r\n    radius: 5000\r\n  }];\r\n\r\n  /**\r\n   * Array of attributes. Associated attributes will vary depending on the acmType\r\n   * @property {Object[]}\r\n   * @name emp3.api.AirControlMeasure#attributes\r\n   */\r\n  Object.defineProperty(this, \"attributes\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _attributes;\r\n    },\r\n    set: function (value) {\r\n\r\n      if (!emp3.api.isArray(_attributes)) {\r\n        throw new Error(\"Type Error: attributes is not an array of emp3.api.enums.IGeoAirControlMeasure.Attribute\");\r\n      }\r\n      _attributes = value;\r\n    }\r\n  });\r\n\r\n  if (!args.positions) {\r\n    args.positions = [{\r\n      latitude: 0,\r\n      longitude: 0\r\n    }];\r\n  }\r\n\r\n  /**\r\n   * Feature Type for AirControlMeasures\r\n   * @name emp3.api.AirControlMeasure#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_ACM\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\", {\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_ACM\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.AirControlMeasure.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @implements cmapi.IGeoPoint\r\n * @classdesc This class implements the Point feature that encapsulates a GeoPoint object.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the args object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoPoint}.\r\n * @param {cmapi.IGeoPosition} [args.position] Position of the point\r\n *\r\n * @example <caption>A generic point</caption>\r\n * var point1 = new emp3.api.Point({\r\n * \tposition: {\r\n *    latitude: 41,\r\n *    longitude: -71\r\n *  }\r\n * });\r\n *\r\n * @example <caption>Point using your own icon, and elevated above the earth at 300 meters sea level.</caption>\r\n *\r\n * var point2 = new emp3.api.Point({\r\n * \tposition: {\r\n *    latitude: 57.3,\r\n *    longitude: 36.8,\r\n *    altitude: 300\r\n *  },\r\n *  altitudeMode: cmapi.enums.ABSOLUTE,\r\n *  iconURI: 'http://mydomain.com/myicon.png'\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Point = function (args) {\r\n\r\n  cmapi.inherit(new cmapi.IGeoPoint(), this);\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n  /**\r\n   * The geospatial position representing the location of the point\r\n   * @name emp3.api.Point#position\r\n   * @type {emp3.api.GeoPosition}\r\n   */\r\n  Object.defineProperty(this, \"position\", {\r\n    enumerable: true,\r\n    get: function () { return this.positions[0]; },\r\n    set: function (value) { this.positions[0] = value; }\r\n  });\r\n\r\n  // Sterilize the inputs\r\n  if (typeof args === 'undefined' || args === null || typeof args !== 'object') {\r\n    args = {\r\n      position: new emp3.api.GeoPosition({\r\n        latitude: 0,\r\n        longitude: 0\r\n      })\r\n    };\r\n  } else {\r\n\r\n    // verify that position or positions have been set.  If they have not been set, create a default position\r\n    // for them.\r\n    if ((typeof args.position === 'undefined' || args.position === null || typeof args.position !== 'object') &&\r\n      (typeof args.positions === 'undefined' || args.positions === null)) {\r\n\r\n      args.position = new emp3.api.GeoPosition({\r\n        latitude: 0,\r\n        longitude: 0\r\n      });\r\n    } else if (args.position) {\r\n      // If the position has been set, verify that lat/lon/alt are all correct\r\n      // type, if not set default values.\r\n      if (typeof args.position.latitude !== 'number') {\r\n        args.position.latitude = new emp3.api.GeoPosition().latitude;\r\n      }\r\n      if (typeof args.position.longitude !== 'number') {\r\n        args.position.longitude = new emp3.api.GeoPosition().longitude;\r\n      }\r\n      if (typeof args.position.altitude !== 'number') {\r\n        args.position.altitude = new emp3.api.GeoPosition().altitude;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @name emp3.api.Point#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_POINT\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\", {\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_POINT\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Point.prototype = new emp3.api.Feature();\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @augments cmapi.IGeoPolygon\r\n * @classdesc This class implements a polygon. It requires 3 or more geographic coordinates.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoPolygon}.\r\n *\r\n * @example\r\n * var polygon = new emp3.api.Polygon({\r\n *   positions: [{\r\n *      latitude: 41,\r\n *      longitude: -71,\r\n *      altitude: 500\r\n *   },{\r\n *      latitude: 42,\r\n *      longitude: -69.9,\r\n *      altitude: 500\r\n *   },{\r\n *      latitude: 39.2,\r\n *      longitude: -70.3,\r\n *      altitude: 500\r\n *   }]\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Polygon = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoPolygon(), this);\r\n\r\n  // Sterilize the inputs\r\n  if (!(typeof args === 'undefined' || args === null || typeof args !== 'object')) {\r\n    if (typeof args.positions === 'undefined' || args.positions === null || !Array.isArray(args.positions)) {\r\n      args.positions = [];\r\n    } else {\r\n      //TODO determine how strictly fail\r\n      var badArgFound = false;\r\n      for (var idx = 0; idx < args.positions.length; idx++) {\r\n        if (typeof args.positions[idx].latitude !== 'undefined' && typeof args.positions[idx].latitude !== 'number') {\r\n          badArgFound = true;\r\n          break;\r\n        }\r\n        if (typeof args.positions[idx].longitude !== 'undefined' && typeof args.positions[idx].longitude !== 'number') {\r\n          badArgFound = true;\r\n          break;\r\n        }\r\n        if (typeof args.positions[idx].altitude !== 'undefined' && typeof args.positions[idx].altitude !== 'number') {\r\n          badArgFound = true;\r\n          break;\r\n        }\r\n      }\r\n      if (badArgFound) {\r\n        args.positions = [];\r\n      }\r\n    }\r\n  } else {\r\n    args = {\r\n      positions: []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @name emp3.api.Polygon#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_POLYGON\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_POLYGON\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Polygon.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Polygon'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * Constructs a new emp3.api.Circle object.\r\n * @class\r\n * @augments {cmapi.IGeoCircle}\r\n * @augments {emp3.api.Feature}\r\n *\r\n * @classdesc This class implements a Circle feature. It requires a single coordinate that indicates the geographic\r\n * position of the center of the circle with a radius in meters to determine size\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoCircle}.\r\n * @param {cmapi.IGeoPosition} [args.position] Position of the center of the circle.\r\n *\r\n * @example\r\n * var circle = new emp3.api.Circle({\r\n *    position: {\r\n *       latitude: 41,\r\n *       longitude: -71\r\n *    },\r\n *    radius: 31415,\r\n *    name: \"My Circle\"\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Circle = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoCircle(), this);\r\n\r\n  args = args || {};\r\n  // Sterilize the inputs\r\n  // If args.position is null or not an object, make it the\r\n  // default position.  This is so args.position doesn't overwrite this.positions.\r\n  if (args.position !== undefined && (args.position === null || typeof args.position !== 'object')) {\r\n    args.position = new cmapi.IGeoPosition();\r\n    // If args.position is defined, and it is an object, check each value of the object\r\n    // to make sure it is valid.  If it isn't defined, that's ok, it's already set.\r\n  } else if (args.position !== undefined && typeof args.position === 'object') {\r\n\r\n    if (typeof args.position.latitude !== 'number') {\r\n      args.position.latitude = new cmapi.IGeoPosition().latitude;\r\n    }\r\n    if (typeof args.position.longitude !== 'number') {\r\n      args.position.longitude = new cmapi.IGeoPosition().longitude;\r\n    }\r\n    if (typeof args.position.altitude !== 'number') {\r\n      args.position.altitude = new cmapi.IGeoPosition().altitude;\r\n    }\r\n  }\r\n\r\n  if (typeof args.radius !== 'number') {\r\n    args.radius = new cmapi.IGeoCircle().radius;\r\n  }\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n\r\n  /**\r\n   * Center of the circle\r\n   * @property {cmapi.IGeoPosition}\r\n   * @name emp3.api.Circle#position\r\n   */\r\n  Object.defineProperty(this, \"position\", {\r\n    enumerable: true,\r\n    get: function () { return this.positions[0]; },\r\n    set: function (value) { this.positions[0] = value; }\r\n  });\r\n\r\n  /**\r\n   * @name emp3.api.Circle#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\", {\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE\r\n  });\r\n\r\n\r\n  this.patchProps(args);\r\n\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Circle.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point',\r\n    symbolCode: emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @augments cmapi.IGeoRectangle\r\n * @classdesc This class implements the EMP rectangle feature. It accepts one (1) geographic coordinate that places\r\n * the center of the rectangle. The rectangle's width and height are centered at the coordinate.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoRectangle}.\r\n * @param {cmapi.IGeoPosition} [args.position] Position of the center of the rectangle.\r\n *\r\n * @example\r\n * var rectangle = new emp3.api.Rectangle({\r\n *    position: {\r\n *      latitude: 40,\r\n *      longitude: 31\r\n *    },\r\n *    height: 100,\r\n *    width: 40\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Rectangle = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoRectangle(), this);\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n  /**\r\n   * The geospatial position representing the center of the rectangle\r\n   * @name emp3.api.Rectangle#position\r\n   * @type {emp3.api.GeoPosition}\r\n   */\r\n  Object.defineProperty(this,\"position\",{\r\n    enumerable: true,\r\n    get: function() { return this.positions[0]; },\r\n    set: function(value) { this.positions[0] = value; }\r\n  });\r\n\r\n  // Sterilize the inputs\r\n  args = args || {};\r\n  // Sterilize the inputs\r\n  // If args.position is null or not an object, make it the\r\n  // default position.  This is so args.position doesn't overwrite this.positions.\r\n  if (args.position !== undefined && (args.position === null || typeof args.position !== 'object')) {\r\n     args.position = new cmapi.IGeoPosition();\r\n  // If args.position is defined, and it is an object, check each value of the object\r\n  // to make sure it is valid.  If it isn't defined, that's ok, it's already set.\r\n  } else if (args.position !== undefined && typeof args.position === 'object') {\r\n\r\n      if (typeof args.position.latitude !== 'number') {\r\n        args.position.latitude = new cmapi.IGeoPosition().latitude;\r\n      }\r\n      if (typeof args.position.longitude !== 'number') {\r\n        args.position.longitude = new cmapi.IGeoPosition().longitude;\r\n      }\r\n      if (typeof args.position.altitude !== 'number') {\r\n        args.position.altitude = new cmapi.IGeoPosition().altitude;\r\n      }\r\n  }\r\n\r\n  if (typeof args.height !== 'number') {\r\n    args.height = new cmapi.IGeoRectangle().height;\r\n  }\r\n  if (typeof args.width !== 'number') {\r\n    args.width = new cmapi.IGeoRectangle().width;\r\n  }\r\n\r\n\r\n  /**\r\n   * @name emp3.api.Rectangle#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Rectangle.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point',\r\n    symbolCode: emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @augments cmapi.IGeoSquare\r\n * @classdesc This class implements the EMP square feature. It accepts one (1) geographic coordinate that places the\r\n * center of the square. The square's length of all sides is set with the setWidth method. And the square is centered\r\n * at the coordinate.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoSquare}.\r\n * @param {cmapi.GeoPosition} [args.position] Position of the center of the square.\r\n *\r\n * @example\r\n * var square = new emp3.api.Square({\r\n *    position: {\r\n *      latitude: 40,\r\n *      longitude: 31\r\n *    },\r\n *    width: 300,\r\n *    name: \"My Square\"\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Square = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoSquare(), this);\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n  /**\r\n   * The geospatial position representing the center of the square\r\n   * @name emp3.api.Square#position\r\n   * @type {emp3.api.GeoPosition}\r\n   */\r\n  Object.defineProperty(this,\"position\",{\r\n    enumerable: true,\r\n    get: function() { return this.positions[0]; },\r\n    set: function(value) { this.positions[0] = value; }\r\n  });\r\n\r\n  // Sterilize the inputs\r\n  args = args || {};\r\n  // Sterilize the inputs\r\n  // If args.position is null or not an object, make it the\r\n  // default position.  This is so args.position doesn't overwrite this.positions.\r\n  if (args.position !== undefined && (args.position === null || typeof args.position !== 'object')) {\r\n     args.position = new cmapi.IGeoPosition();\r\n  // If args.position is defined, and it is an object, check each value of the object\r\n  // to make sure it is valid.  If it isn't defined, that's ok, it's already set.\r\n  } else if (args.position !== undefined && typeof args.position === 'object') {\r\n\r\n      if (typeof args.position.latitude !== 'number') {\r\n        args.position.latitude = new cmapi.IGeoPosition().latitude;\r\n      }\r\n      if (typeof args.position.longitude !== 'number') {\r\n        args.position.longitude = new cmapi.IGeoPosition().longitude;\r\n      }\r\n      if (typeof args.position.altitude !== 'number') {\r\n        args.position.altitude = new cmapi.IGeoPosition().altitude;\r\n      }\r\n  }\r\n\r\n  if (typeof args.width !== 'number') {\r\n    args.width = new cmapi.IGeoSquare().width;\r\n  }\r\n\r\n  /**\r\n   * @name emp3.api.Square#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_SQUARE\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_SQUARE\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Square.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * Constructs a new emp3.api.Text object. The name of the object is the text that will appear\r\n *\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @extends cmapi.IGeoText\r\n * @classdesc This class positions text on the map at a specific coordinate. The name of the object is the text that\r\n * will appear. To update the text update the name and use the apply method.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoText}.\r\n * @param {cmapi.GeoPosition} [args.position] Position of the text.\r\n *\r\n * @example\r\n * var text = new emp3.api.Text({\r\n *   name:\"George Washington Bridge\",\r\n *   location: {\r\n *     latitude: 40.8517,\r\n *     longitude: -73.9527\r\n *   }\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Text = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoText(), this);\r\n\r\n  var _fontSize = '';\r\n  /**\r\n   * @name emp3.api.Text#fontSize\r\n   * @type {number}\r\n   */\r\n  Object.defineProperty(this,\"fontSize\",{\r\n    enumerable: true,\r\n    get: function() { return _fontSize; },\r\n    set: function(value) { _fontSize = value; }\r\n  });\r\n  \r\n  var _fontFamily = '';\r\n  /**\r\n   * @name emp3.api.Text#fontFamily\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this,\"fontFamily\",{\r\n    enumerable: true,\r\n    get: function() { return _fontFamily; },\r\n    set: function(value) { _fontFamily = value; }\r\n  });\r\n  \r\n  var _typeFaceStyle = '';\r\n  /**\r\n   * @name emp3.api.Text#typeFaceStyle\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this,\"typeFaceStyle\",{\r\n    enumerable: true,\r\n    get: function() { return _typeFaceStyle; },\r\n    set: function(value) { _typeFaceStyle = value; }\r\n  });\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n  /**\r\n   * @name emp3.api.Text#position\r\n   * @type {emp3.api.GeoPosition}\r\n   */\r\n  Object.defineProperty(this,\"position\",{\r\n    enumerable: true,\r\n    get: function() { return this.positions[0]; },\r\n    set: function(value) { this.positions[0] = value; }\r\n  });\r\n\r\n  // Sterilize the inputs\r\n  args = args || {};\r\n  // Sterilize the inputs\r\n  // If args.position is null or not an object, make it the\r\n  // default position.  This is so args.position doesn't overwrite this.positions.\r\n  if (args.position !== undefined && (args.position === null || typeof args.position !== 'object')) {\r\n     args.position = new cmapi.IGeoPosition();\r\n  // If args.position is defined, and it is an object, check each value of the object\r\n  // to make sure it is valid.  If it isn't defined, that's ok, it's already set.\r\n  } else if (args.position !== undefined && typeof args.position === 'object') {\r\n\r\n      if (typeof args.position.latitude !== 'number') {\r\n        args.position.latitude = new cmapi.IGeoPosition().latitude;\r\n      }\r\n      if (typeof args.position.longitude !== 'number') {\r\n        args.position.longitude = new cmapi.IGeoPosition().longitude;\r\n      }\r\n      if (typeof args.position.altitude !== 'number') {\r\n        args.position.altitude = new cmapi.IGeoPosition().altitude;\r\n      }\r\n  }\r\n\r\n  if (typeof args.text !== 'string') {\r\n    args.text = '';\r\n  }\r\n\r\n\r\n  /**\r\n   * @const\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_TEXT\r\n   * @name emp3.api.Text#featureType\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_TEXT\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Text.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * Constructs a new emp3.api.Ellipse feature.\r\n * @class\r\n * @augments {emp3.api.Feature}\r\n * @augments {cmapi.IGeoEllipse}\r\n * @classdesc This class implements an ellipse feature. It requires a single coordinate that indicates the geographic\r\n * position of the center of the ellipse.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoEllipse}.\r\n * @param {cmapi.IGeoPosition} [args.position]\r\n *\r\n * @example\r\n * var ellipse = new emp3.api.Ellipse({\r\n *    position: {\r\n *       lat: 41,\r\n *       lon: -71\r\n *    },\r\n *    semiMajor: 25,\r\n *    semiMinor: 33\r\n * });\r\n *\r\n * @mixes Feature\r\n */\r\nemp3.api.Ellipse = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoEllipse(args), this);\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n  /**\r\n   * The geospatial position representing the center of the ellipse\r\n   * @name emp3.api.Ellipse#position\r\n   * @type {emp3.api.GeoPosition}\r\n   */\r\n  Object.defineProperty(this, \"position\",{\r\n    enumerable: true,\r\n    get: function() { return this.positions[0]; },\r\n    set: function(value) { this.positions[0] = value; }\r\n  });\r\n\r\n  // Sterilize the inputs\r\n  args = args || {};\r\n  // Sterilize the inputs\r\n  // If args.position is null or not an object, make it the\r\n  // default position.  This is so args.position doesn't overwrite this.positions.\r\n  if (args.position !== undefined && (args.position === null || typeof args.position !== 'object')) {\r\n     args.position = new cmapi.IGeoPosition();\r\n  // If args.position is defined, and it is an object, check each value of the object\r\n  // to make sure it is valid.  If it isn't defined, that's ok, it's already set.\r\n  } else if (args.position !== undefined && typeof args.position === 'object') {\r\n\r\n      if (typeof args.position.latitude !== 'number') {\r\n        args.position.latitude = new cmapi.IGeoPosition().latitude;\r\n      }\r\n      if (typeof args.position.longitude !== 'number') {\r\n        args.position.longitude = new cmapi.IGeoPosition().longitude;\r\n      }\r\n      if (typeof args.position.altitude !== 'number') {\r\n        args.position.altitude = new cmapi.IGeoPosition().altitude;\r\n      }\r\n  }\r\n\r\n  if (typeof args.semiMajor !== 'number') {\r\n    args.semiMajor = new cmapi.IGeoEllipse().semiMajor;\r\n  }\r\n  if (typeof args.semiMinor !== 'number') {\r\n    args.semiMinor = new cmapi.IGeoEllipse().semiMinor;\r\n  }\r\n\r\n  /**\r\n   * @name emp3.api.Ellipse#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Ellipse.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @extends {cmapi.IGeoPath}\r\n * @classdesc This class implements the Path (Multi segment line) feature. It accepts a list of coordinates where each\r\n * adjacent pair of coordinates identifies a line segment.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoPositionGroup}.\r\n *\r\n * @mixes Feature\r\n *\r\n * @example\r\n * var path = new emp3.api.Path({\r\n *   name: 'A path',\r\n *   geoId: 'testPath',\r\n *   positions: [\r\n *     {latitude: 23.62, longitude: 12.232},\r\n *     {latitude: 24.62, longitude: 12.255},\r\n *     {latitude: 23.92, longitude: 13.132},\r\n *     {latitude: 24.41, longitude: 13.103}\r\n *   ]\r\n * });\r\n */\r\nemp3.api.Path = function (args) {\r\n  cmapi.inherit(new cmapi.IGeoPath(), this);\r\n\r\n  if (typeof args === 'undefined' || args === null || typeof args !== 'object') {\r\n    args = {\r\n      positions: [],\r\n      timeStamp: new Date(),\r\n      timeSpans: []\r\n    };\r\n  } else {\r\n    if (typeof args.positions === 'undefined' || args.positions === null || !Array.isArray(args.positions)) {\r\n      args.positions = [];\r\n    } else {\r\n      //TODO determine how strictly fail\r\n      var badArgFound = false;\r\n      for (var idx = 0; idx < args.positions.length; idx++) {\r\n        if (typeof args.positions[idx].latitude !== 'undefined' && typeof args.positions[idx].latitude !== 'number') {\r\n          badArgFound = true;\r\n          break;\r\n        }\r\n        if (typeof args.positions[idx].longitude !== 'undefined' && typeof args.positions[idx].longitude !== 'number') {\r\n          badArgFound = true;\r\n          break;\r\n        }\r\n        if (typeof args.positions[idx].altitude !== 'undefined' && typeof args.positions[idx].altitude !== 'number') {\r\n          badArgFound = true;\r\n          break;\r\n        }\r\n      }\r\n      if (badArgFound) {\r\n        args.positions = [];\r\n      }\r\n    }\r\n\r\n    if (typeof args.timeStamp !== 'string') {\r\n      args.timeStamp = new Date();\r\n    }\r\n\r\n    if (typeof args.timeSpans === 'undefined' || typeof args.timeSpans !== 'object' || !Array.isArray(args.timeSpans)) {\r\n      args.timeSpans = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @name emp3.api.Path#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_PATH\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_PATH\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.Path.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'LineString'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @constructor\r\n * @classdesc This class implements a KML feature. It requires a valid KML string that can be parsed.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here.\r\n * @param {String} [args.KMLString] String containing valid KML to be parsed.\r\n *\r\n * @example\r\n * var KMLFeature = new emp3.api.KML({\r\n *   KMLString: \"<kml>\r\n                  <Document>\r\n                    <Placemark id=\"f2\">\r\n                      <name>\r\n                        Feature Collection Test 1\r\n                      </name>\r\n                      <description>\r\n                        <![CDATA[<br/><table border=\\\"1\\\" cellpadding=\\\"2\\\" cellspacing=\\\"0\\\" width=100%><tr ><td><b>lineColor</b></td><td>7f00ffff</td></tr><tr  bgcolor=\\\"#F0F0F0\\\"><td><b>lineThickness</b></td><td>5</td></tr></table>]]>\r\n                      </description>\r\n                      <Style id=\"geomcollection\">\r\n                        <LineStyle>\r\n                          <color>7fffff00</color>\r\n                          <width>5</width>\r\n                        </LineStyle>\r\n                        <PolyStyle>\r\n                          <color>88000000</color>\r\n                        </PolyStyle>\r\n                        <LabelStyle>\r\n                          <color>FFFFFFFF</color>\r\n                        </LabelStyle>\r\n                        <IconStyle>\r\n                          <color>00000000</color>\r\n                        </IconStyle>\r\n                      </Style>\r\n                      <MultiGeometry>\r\n                        <LineString>\r\n                          <tessellate>1</tessellate>\r\n                          <coordinates>102,0 103,1 104,0 105,1</coordinates>\r\n                        </LineString>\r\n                        <Point>\r\n                          <coordinates>103.5,0.5</coordinates>\r\n                        </Point>\r\n                      </MultiGeometry>\r\n                    </Placemark>\r\n                  </Document>\r\n                </kml>\"\"\r\n *   }\r\n * });\r\n */\r\nemp3.api.KML = function (args) {\r\n  args = args || {};\r\n  emp3.api.Feature.call(this, args);\r\n\r\n  var _KMLString = args.KMLString;\r\n  /**\r\n   * @name emp3.api.KML#KMLString\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"KMLString\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _KMLString;\r\n    },\r\n    set: function (value) {\r\n      _KMLString = value;\r\n    }\r\n  });\r\n\r\n  /**\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.KML\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  this.featureType = emp3.api.enums.FeatureTypeEnum.KML;\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.KML.prototype = Object.create(emp3.api.Feature.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @constructor\r\n * @classdesc This class implements a GeoJSON feature. It requires a valid GeoJSON data structure.\r\n *\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here.\r\n * @param {Object} [args.GeoJSONData] Object containing a valid GeoJSON data structure.\r\n *\r\n * @example\r\n * var GeoJSONFeature = new emp3.api.GeoJSON({\r\n    GeoJSONData: {\r\n      \"type\": \"FeatureCollection\",\r\n      \"features\": [\r\n        { \"type\": \"Feature\",\r\n           \"geometry\": {\r\n             \"type\": \"Polygon\",\r\n             \"coordinates\": [[[99.0, 0.0], [45.0, 0.0], [44.0, 1.0], [67.0, 1.0], [50.0, 0.0]]]\r\n           },\r\n           \"properties\": {\r\n             \"first\": \"firstValue\",\r\n             \"second\": \"secondValue\"\r\n           }\r\n        }\r\n        { \"type\": \"Feature\",\r\n          \"geometry\": {\"type\": \"Point\", \"coordinates\": [54.0, 0.75]},\r\n          \"properties\": {\"first\": \"firstValue\",}\r\n        },\r\n        { \"type\": \"Feature\",\r\n          \"geometry\": {\r\n            \"type\": \"LineString\",\r\n            \"coordinates\": [[34.0, 0.0], [32.0, 1.0], [35.0, 0.0], [36.0, 1.0]]\r\n          },\r\n          \"properties\": {\r\n            \"first\": \"firstValue\",\r\n            \"second\": \"secondValue\"\r\n          }\r\n        },\r\n      ]\r\n    } \r\n*});\r\n*/\r\nemp3.api.GeoJSON = function (args) {\r\n  args = args || {};\r\n  emp3.api.Feature.call(this, args);\r\n\r\n  var _GeoJSONData = args.GeoJSONData;\r\n  /**\r\n   * @name emp3.api.GeoJSON#GeoJSONData\r\n   * @type {string}\r\n   */\r\n  Object.defineProperty(this, \"GeoJSONData\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _GeoJSONData;\r\n    },\r\n    set: function (value) {\r\n      _GeoJSONData = value;\r\n    }\r\n  });\r\n\r\n  /**\r\n   * @const\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEOJSON\r\n   */\r\n  this.featureType = emp3.api.enums.FeatureTypeEnum.GEOJSON;\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.GeoJSON.prototype = Object.create(emp3.api.Feature.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @class\r\n * @extends {cmapi.IGeoPosition}\r\n * @classdesc This class represents a {@link cmapi.IGeoPosition}\r\n * @param {Object} [args] Parameters are provided as members of the arg object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoPosition}.\r\n */\r\nemp3.api.GeoPosition = function (args) {\r\n  args = args || {};\r\n  cmapi.inherit(new cmapi.IGeoPosition(), this);\r\n\r\n  if (typeof args.latitude !== 'number') {\r\n    args.latitude = new cmapi.IGeoPosition().latitude;\r\n  } else if (args.latitude > 90.0 || args.latitude < -90.0) {\r\n    throw new Error('Invalid latitude: latitude must be between 90.0 and -90.0');\r\n  }\r\n\r\n  if (typeof args.longitude !== 'number') {\r\n    args.longitude = new cmapi.IGeoPosition().longitude;\r\n  } else if (args.longitude > 180.0 || args.longitude < -180.0) {\r\n    throw new Error('Invalid longitude: longitude must be between 180.0 and -90.0');\r\n  }\r\n\r\n  if (typeof args.altitude !== 'number') {\r\n    args.altitude = new cmapi.IGeoPosition().altitude;\r\n  }\r\n\r\n  this.patchProps(args);\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * Constructs a new emp3.api.MilStdSymbol object.\r\n *\r\n * @class\r\n * @extends {emp3.api.Feature}\r\n * @extends cmapi.IGeoMilSymbol\r\n * @classdesc The MilStdSymbol class represents a military symbology map feature.\r\n * Symbols are based on the MIL-STD-2525Bch2 (USAS)\r\n * or MIL-STD-2525C specifications. Use {@link emp3.api.Overlay} addFeatures method\r\n * to add the symbol onto the map that has that overlay assigned to it.\r\n *\r\n * @mixes Feature\r\n *\r\n * @param {Object} args Parameters are provided as members of the args object and may contain any properties listed\r\n * here or inherited from {@link cmapi.IGeoMilSymbol}.\r\n *\r\n * @param {cmapi.IGeoPosition} [args.position] Position of the MilStdSymbol if it is a single icon.  this will be\r\n * ignored in the case of a multi position  symbol such as a tactical graphic\r\n *\r\n * @return A new emp3.api.MilStdSymbol object\r\n *\r\n * @example\r\n *\r\n * // Creating a new single point MilStdSymbol with some symbol modifiers.\r\n *\r\n * var sym = new emp3.api.MilStdSymbol({\r\n *     name: \"Example Unit\",\r\n *     position: {\r\n *         latitude: 40,\r\n *         longitude: 40\r\n *     },\r\n *    symbolCode: \"SFGPUCI----K---\", // Friendly Infantry symbol code from MIL-STD-2525\r\n *    fillStyle: {\r\n *         fillColor: { // green - optional, no color is needed, but this can override the default affiliation color\r\n *            red: 0,\r\n *            green: 255,\r\n *            blue: 0,\r\n *            alpha: 1\r\n *         }\r\n *     },\r\n *     modifiers: {\r\n *        uniqueDesignation1: '1BCT', // see MIL-STD-2525 for meaning of modifiers\r\n *        higherFormation: '3ID'\r\n *    }\r\n * });\r\n *\r\n * @example\r\n *\r\n * // Creating a boundary line with some modifiers\r\n *\r\n * var sym = new emp3.api.MilStdSymbol({\r\n *     name: \"Example Boundary\",\r\n *     positions:[ {\r\n *         latitude: 31,\r\n *         longitude: -97\r\n *     },\r\n *     {\r\n *         latitude: 32,\r\n *         longitude: -97\r\n *     },\r\n *     {\r\n *         latitude: 32,\r\n *         longitude: -98\r\n *     }],\r\n *    symbolCode: \"SFFPGLB----K---\"  // Boundary line symbol code from MIL-STD-2525\r\n *    strokeStyle: {\r\n *         strokeColor: { // blue - optional no color is needed, but this can override the default affiliation color\r\n *             red: 0,\r\n *             green: 0,\r\n *             blue: 255,\r\n *             alpha: 1\r\n *         }\r\n *     },\r\n *     modifiers: {\r\n *        uniqueDesignation1: '1BCT', // see MIL-STD-2525 for meaning of modifiers\r\n *        higherFormation: '3ID'\r\n *    }\r\n * });\r\n *\r\n */\r\nemp3.api.MilStdSymbol = function(args) {\r\n\r\n  cmapi.inherit(new cmapi.IGeoMilSymbol(), this);\r\n\r\n\r\n  // Sterilize the inputs\r\n  if (typeof args === 'undefined' || args === null || typeof args !== 'object') {\r\n    args = {\r\n      position: new emp3.api.GeoPosition({\r\n        latitude: 0,\r\n        longitude: 0})\r\n    };\r\n  } else {\r\n    if (typeof args.positions === 'undefined' &&\r\n       (typeof args.position === 'undefined' || args.position === null || typeof args.position !== 'object')) {\r\n      args.position = new emp3.api.GeoPosition({\r\n        latitude: 0,\r\n        longitude: 0\r\n      });\r\n    } else {\r\n      if (args.hasOwnProperty('position')) {\r\n        if (typeof args.position.latitude !== 'number') {\r\n          args.position.latitude = new emp3.api.GeoPosition().latitude;\r\n        }\r\n        if (typeof args.position.longitude !== 'number') {\r\n          args.position.longitude = new emp3.api.GeoPosition().longitude;\r\n        }\r\n        if (typeof args.position.altitude !== 'number') {\r\n          args.position.altitude = new emp3.api.GeoPosition().altitude;\r\n        }\r\n      } else {\r\n        // TODO sterilize positions\r\n      }\r\n    }\r\n  }\r\n\r\n  // provide the positions property inherited from cmapi.IGeoPoint with a default location of 0,0\r\n  this.positions = [new cmapi.IGeoPosition()];\r\n  if (args.hasOwnProperty('positions')) {\r\n    this.positions = args.positions;\r\n  }\r\n\r\n  /**\r\n   * @name emp3.api.MilStdSymbol#position\r\n   * @type {emp3.api.GeoPosition}\r\n   */\r\n  Object.defineProperty(this, \"position\", {\r\n    enumerable: true,\r\n    get: function () { return this.positions[0]; },\r\n    set: function (value) { this.positions[0] = value; }\r\n  });\r\n\r\n  /**\r\n   * @name emp3.api.MilStdSymbol#featureType\r\n   * @const\r\n   * @default emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL\r\n   * @type {emp3.api.enums.FeatureTypeEnum}\r\n   */\r\n  Object.defineProperty(this, \"featureType\",{\r\n    enumerable: true,\r\n    writable: false,\r\n    value: emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL\r\n  });\r\n\r\n  this.patchProps(args);\r\n};\r\n\r\n// Extend emp3.api.Feature\r\nemp3.api.MilStdSymbol.prototype = new emp3.api.Feature({\r\n  format: 'geojson',\r\n  data: {\r\n    type: 'Point'\r\n  }\r\n});\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @ignore\r\n * @typedef {object} CallInfo\r\n * @property {string} method\r\n * @property {emp3.api.Map} map\r\n * @property {string} mapId\r\n * @property {object} source\r\n * @property {object} args\r\n * @property {Array} remainingPayload\r\n * @property {Array} successes\r\n * @property {Array} failures\r\n */\r\n\r\n/**\r\n * A dispatcher class that manages pub/sub communications using the CMAPI interface using an underlying framework. The\r\n * framework used is called the \"environment.\"  In order to use, the environment needs to first instantiate the\r\n * environment and subscribe to channels specified by the CMAPI specification.  This class is used internally by the\r\n * map API and should not be used directly by an API developer.\r\n *\r\n * This class implements a singleton pattern.  It is generally accessed as\r\n * follows:\r\n *\r\n *      emp3.api.MessageHandler.getInstance()\r\n *\r\n * Messages sent to the message handler prior to the map environment being ready will be queued until the environment\r\n * finishes the initialization process.\r\n *\r\n * The environment being ready does not mean the EMP map is ready.\r\n *\r\n * @ignore\r\n */\r\nemp3.api.MessageHandler = (function() {\r\n\r\n  // Singleton instance of this class.\r\n  var instance = null,\r\n    missingMessageError = \"Message received from map is missing its payload.\",\r\n    missingParameterError = \"Message received from map is missing a required parameter.\",\r\n    drawListenerCallbackHash = new emp3.api.Hash(),\r\n    mapHash = new emp.utilities.Hash(),\r\n    selectionHash = [],\r\n    queue = [], // holds any messages sent to the messageHandler before the environment is ready.\r\n    updates = [],\r\n    updateTimer,\r\n    updateTime = 0;\r\n\r\n\r\n  /**\r\n   * Given transaction complete messages from multiple requests on the same channel,\r\n   * combine the transaction complete details together to make it seem as though\r\n   * it was a single message.\r\n   *\r\n   * @return An array of the new details containing the joined messages.\r\n   *\r\n   */\r\n  function joinDetails(details, originChannel) {\r\n\r\n    var i,\r\n      len,\r\n      features = [];\r\n\r\n    len = details.length;\r\n\r\n    // Made this a switch statement in case we started adding more\r\n    // channels.  All the current batch channel transaction details\r\n    // contain a single property called 'features'.\r\n\r\n    switch (originChannel) {\r\n\r\n      case emp3.api.enums.channel.plotFeatureBatch:\r\n      case emp3.api.enums.channel.unplotFeatureBatch:\r\n      case emp3.api.enums.channel.featureSelectedBatch:\r\n      case emp3.api.enums.channel.featureDeselectedBatch:\r\n\r\n        for (i = 0; i < len; i += 1) {\r\n          features = features.concat(details[i].features);\r\n        }\r\n\r\n        details.features = features;\r\n\r\n        break;\r\n    }\r\n\r\n    return details;\r\n\r\n  }\r\n\r\n  // Constructs the MessageHandler\r\n  /**\r\n   * Instantiates the MessageHandler. Only one message handler is created\r\n   * for the map api.\r\n   * @ignore\r\n   * @constructor\r\n   * @name emp3.api.MessageHandler\r\n   */\r\n  function PrivateConstructor(args) {\r\n    var environment,\r\n      that = this;\r\n\r\n    this.isEnvironmentReady = false; // tracks when message can be sent out.  This will be set to true after environment is ready.\r\n    this.messageCallbackHash = new emp3.api.Hash();\r\n    this.statusRequestPendingList = {\r\n      about: [],\r\n      format: [],\r\n      view: [],\r\n      selected: [],\r\n      screenshot: [],\r\n      initialization: [],\r\n      coordinatesystem: []\r\n    };\r\n    this.mapReadyCallback = [];\r\n\r\n    // The event listener functions\r\n    this.eventListeners = [];\r\n    this.mapWidgetName = \"CPCE Map\";\r\n    // If we have an args.containerId parameter populated then we MUST use the browser environment for messageHandler as we are dealing with a local map instance\r\n    // We must still pass the environment value into the spawnMap function so that the local map instance can listen to remote IWC, OWF, etc API instance,\r\n    // but this instance of messageHandler is on the same page as the map instance so it must use browser environment\r\n    if (args && args.environment && (!args.container || args.container === \"\")) {\r\n      switch (args.environment) {\r\n        case \"starfish\":\r\n        case emp3.api.environment.starfish:\r\n          environment = emp3.api.environment.starfish;\r\n          break;\r\n        case \"owf\":\r\n        case emp3.api.environment.owf:\r\n          environment = emp3.api.environment.owf;\r\n          break;\r\n        case \"iwc\":\r\n        case emp3.api.environment.iwc:\r\n          emp3.api.environment.iwc.iwcHost = args.iwcHost;\r\n\r\n          environment = emp3.api.environment.iwc;\r\n          break;\r\n        default:\r\n          environment = emp3.api.environment.browser;\r\n          break;\r\n      }\r\n    }\r\n    else {\r\n      // We have a local map instance so we MUST use browser, see comments above switch statement for further explanation\r\n      environment = emp3.api.environment.browser;\r\n    }\r\n\r\n\r\n    /**\r\n     * Returns a JavaScript array of event listener functions mapped by event type\r\n     */\r\n    this.getEventListeners = function() {\r\n      return this.eventListeners;\r\n    };\r\n\r\n\r\n    /**\r\n     * Adds an event listener onto the event callback hash.  The event callback\r\n     * hash will check if the event pertains to an object, then invoke the\r\n     * correct callback associated with the event.\r\n     * @param {Object} args Parameters are provided as members of the args object.\r\n     * @param {String} args.id The geoId of a emp3.api.Map\r\n     * @param {emp3.api.enums.EventType} args.event the type of event being added.\r\n     * @param {Function} args.callback The method to call after the event occurs.\r\n     */\r\n    this.addEventListener = function(args) {\r\n      var eventListeners,\r\n        that = this;\r\n\r\n      // First check to see if we know what object we are adding the\r\n      // event to.\r\n      if (args.id) {\r\n\r\n        // Now check to see if there were any events associated with\r\n        // this id before.  If not, create an array for it.\r\n        if (!this.eventListeners[args.id]) {\r\n          this.eventListeners[args.id] = [];\r\n        }\r\n\r\n        // Retrieve the list of event listeners assigned to this object.\r\n        eventListeners = this.eventListeners[args.id];\r\n\r\n        // If we know what event we are subscribing to continue on.\r\n        if (args.event) {\r\n\r\n          // If there are not callbacks hooked up to this object event\r\n          // add an array to hold them.\r\n          if (!eventListeners[args.event]) {\r\n            eventListeners[args.event] = [];\r\n            // Because so many of these events are dispatched, we only subscribe to\r\n            // events if a client component needs these events.\r\n            // Otherwise it is too much traffic for an unused capability\r\n            if (args.event === emp3.api.enums.EventType.MAP_CURSOR_MOVE) {\r\n              environment.pubSub.subscribe({\r\n                channel: emp3.api.enums.channel.mousemove,\r\n                callback: that.handleMapCursorMove.bind(that)\r\n              });\r\n            }\r\n            else if (args.event === emp3.api.enums.EventType.MAP_VIEW_CHANGE) {\r\n              environment.pubSub.subscribe({\r\n                channel: emp3.api.enums.channel.statusView,\r\n                callback: function(sender, msg) {\r\n                  that.handleStatusView(sender, msg);\r\n                }\r\n              });\r\n            }\r\n          }\r\n\r\n          // Add the callback to the associated event.  Do not overwrite\r\n          // it as we would like to be able to assign multiple callbacks to\r\n          // an event.\r\n          if (args.callback) {\r\n            eventListeners[args.event].push(args.callback);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Removes an event handler for an event\r\n     * @param  {Object} args Parameters are provided as members of the args object.\r\n     */\r\n    this.removeEventListener = function(args) {\r\n      var eventListeners,\r\n        eventListener,\r\n        i;\r\n\r\n      // Make sure this is object we are target\r\n      if (args.id && args.callback && args.event) {\r\n\r\n        // Grab the event listener for this id.\r\n        eventListeners = this.eventListeners[args.id];\r\n\r\n        // Make sure that an item was found, if not don't try to remove it.\r\n        if (eventListeners) {\r\n\r\n          // Find the event that we are trying to remove.\r\n          eventListener = eventListeners[args.event];\r\n\r\n          // If we don't find the event just ignore.\r\n          if (eventListener) {\r\n\r\n            // If we find the callback, remove it, otherwise, remove them all.\r\n            if (args.callback) {\r\n\r\n              // Remove any callbacks matching the one passed associated\r\n              // with this event.\r\n              for (i = 0; i < eventListener.length; i++) {\r\n                if (eventListener[i] === args.callback) {\r\n                  eventListener.splice(i, 1);\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              delete eventListeners[args.event];\r\n            }\r\n\r\n            // clean up\r\n\r\n            // Check to see if there are any more listeners for\r\n            // this event.  If not delete the event listener\r\n            if (eventListener.length === 0) {\r\n              delete eventListeners[args.event];\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * This function check if there is at least one map ready\r\n     * @return {boolean} True if there is a map ready, false otherwise.\r\n     *\r\n     */\r\n    this.isAMapReady = function() {\r\n      var mapId;\r\n\r\n      for (mapId in mapHash.items) {\r\n        if (mapHash.items.hasOwnProperty(mapId)) {\r\n          if (mapHash.items[mapId].status === emp3.api.enums.MapStateEnum.MAP_READY) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * Sends the provided message to the Common Map Widget\r\n     * @param {object} message - The message to send to the CMW\r\n     * @param {CallInfo} callInfo - Information about the message which includes source object,\r\n     * arguments to the source object's method, user data\r\n     */\r\n    this.sendMessage = function(message, callInfo) {\r\n\r\n      var transaction;\r\n\r\n      // Check to see if we are waiting for a map to spawn.  If we\r\n      // are not, then just send the message.  Otherwise the message is\r\n      // queued already and will be sent after the map status changes.\r\n\r\n      // If the call info has a map, it for a specific map.\r\n      if (callInfo.hasOwnProperty(\"map\")) {\r\n        // Now check to see if that map is ready.\r\n        if (callInfo.map.status === emp3.api.enums.MapStateEnum.MAP_READY) {\r\n          transaction = this.publish(message, callInfo);\r\n        }\r\n      }\r\n      // else check to see if any map is ready.\r\n      else if (this.isAMapReady()) {\r\n        transaction = this.publish(message, callInfo);\r\n      }\r\n      else {\r\n        throw new Error('There is no map engine available to publish messages to');\r\n      }\r\n\r\n      return transaction;\r\n    };\r\n\r\n    /**\r\n     * Executes the messages sent to the message handler.\r\n     * @param  {object} message  The message to send.\r\n     * @param  {CallInfo} callInfo Information about the original callers and its parameters.\r\n     */\r\n    this.publish = function(message, callInfo) {\r\n      var transactionId,\r\n        transaction,\r\n        returnedTransaction;\r\n\r\n      // In order to track callbacks in response to specific messages, we need to keep\r\n      // track of which message this call is.  Create an id to represent this\r\n      // message so that later we can identify it and associate a callback with it.\r\n      //\r\n      // The following callbacks will require a transactionId, so we can identify it later.\r\n      // For now lets create the transaction always.\r\n      //if (message.onSuccess || message.onError || message.startCallback || message.updateCallback || message.completeCallback || message.cancelCallback) {\r\n\r\n      transactionId = emp3.api.createGUID();\r\n\r\n      // pass all of the original parameters into the message.\r\n      transaction = {\r\n        mapId: callInfo.mapId,\r\n        transactionId: transactionId,\r\n        callInfo: callInfo,\r\n        source: callInfo.source,\r\n        args: callInfo.args,\r\n        data: message\r\n      };\r\n\r\n      // We only care about tracking the messages if a user passes in a\r\n      // success or failure callback.  If the user doesn't pass a callback in\r\n      // that would be responsible for cleaning up the messageCallbackHash, we\r\n      // provide the clean up.\r\n\r\n      // The onSuccess callback needs to clean up the messageCallbackHash.  If it doesn't exist, but\r\n      // the function is successful, the messageCallbackHash still needs to clean up.  We provide a\r\n      // default function to do this.\r\n      if (message.onSuccess) {\r\n        transaction.onSuccess = message.onSuccess;\r\n      }\r\n      else {\r\n        transaction.onSuccess = function() {\r\n          emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId);\r\n        };\r\n      }\r\n\r\n      // The onError callback needs to clean up the messageCallbackHash if an error occurs.\r\n      // If it doesn't exist, but the function does not succeed, the messageCallbackHash still needs to clean up.  We provide a\r\n      // default function to do this.\r\n      if (message.onError) {\r\n        transaction.onError = message.onError;\r\n      }\r\n      else {\r\n        transaction.onError = function() {\r\n          emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId);\r\n        };\r\n      }\r\n\r\n      // The completeCallback callback needs to clean up the messageCallbackHash once a draw or edit completes.\r\n      // This function is only used in draws and edits.\r\n      // If it isn't defined, the messageCallbackHash still needs to clean up.  We provide a\r\n      // default function to do this in case the draw finishes and user did not pass this callback in.\r\n      if (message.completeCallback) {\r\n        transaction.completeCallback = message.completeCallback;\r\n      }\r\n      else {\r\n        transaction.completeCallback = function() {\r\n          emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId);\r\n        };\r\n      }\r\n\r\n      // The cancelCallback callback needs to clean up the messageCallbackHash once a user cancels out of\r\n      // a draw or edit.  If the user doesn't define a callback for the cancel, the messageCallbackHash\r\n      // still needs to clean up.  We provide a\r\n      // default function to do this in case the user cancels out of a draw or edit and did not pass\r\n      // this cancel callback in.\r\n      if (message.cancelCallback) {\r\n        transaction.cancelCallback = message.cancelCallback;\r\n      }\r\n      else {\r\n        transaction.cancelCallback = function() {\r\n          emp3.api.MessageHandler.getInstance().messageCallbackHash.removeItem(transactionId);\r\n        };\r\n      }\r\n\r\n      if (message.startCallback) {\r\n        transaction.startCallback = message.startCallback;\r\n      }\r\n\r\n      if (message.updateCallback) {\r\n        transaction.updateCallback = message.updateCallback;\r\n      }\r\n\r\n      this.messageCallbackHash.setItem(transactionId, transaction);\r\n\r\n      // Create appropriate channel payload constructor\r\n      var payload = emp3.api.MessageFactory.constructPayload(message, callInfo, transactionId);\r\n      if (payload) {\r\n        validatePayload(payload, callInfo); // This also publishes it\r\n        return payload.transaction();\r\n      }\r\n\r\n      // Handle cases not yet converted and synchronous calls\r\n      switch (message.cmd) {\r\n        case emp3.api.enums.channel.convert:\r\n          this.convert(callInfo, message); // Synchronous call, does not need transactionId\r\n          break;\r\n        case emp3.api.enums.channel.overlayClusterSet:\r\n          this.overlayClusterSet(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.overlayClusterActivate:\r\n          this.overlayClusterActivate(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.overlayClusterDeactivate:\r\n          this.overlayClusterDeactivate(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.overlayClusterRemove:\r\n          this.overlayClusterRemove(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.menuRemove:\r\n          // TODO delete this\r\n          //this.menuRemove(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.menuSetVisible:\r\n          // TODO delete this\r\n          //this.menuSetVisible(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.centerOnLocation:\r\n          this.centerOnLocation(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.centerOnBounds:\r\n          this.centerOnBounds(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.lookAtLocation:\r\n          this.lookAtLocation(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.featureEdit:\r\n          returnedTransaction = this.featureEdit(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.styleOverlay:\r\n          this.styleOverlay(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.zoom:\r\n          this.zoom(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.centerOnOverlay:\r\n          this.centerOnOverlay(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.centerOnFeature:\r\n          this.centerOnFeature(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.hideFeature:\r\n          this.hideFeature(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.showFeature:\r\n          this.showFeature(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.clearFeatures:\r\n          this.clearFeatures(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.statusRequest:\r\n          this.statusRequest(callInfo, transaction, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.menuDrawingCreate:\r\n          // TODO delete this\r\n          //returnedTransaction = this.menuDrawingCreate(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.menuDrawingRemove:\r\n          // TODO delete this\r\n          //returnedTransaction = this.menuDrawingRemove(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.clearMap:\r\n          this.clearMap(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.lockView:\r\n          this.lockView(callInfo, message);\r\n          break;\r\n        case emp3.api.enums.channel.get:\r\n          this.get(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.cancel:\r\n          this.cancel(callInfo, message);\r\n          break;\r\n        case emp3.api.enums.channel.transactionComplete:\r\n          this.complete(callInfo, message);\r\n          break;\r\n        case emp3.api.enums.channel.mapShutdown:\r\n          this.mapShutdown(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.getVisibility:\r\n          this.getVisibility(callInfo, message, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.swap:\r\n          this.mapSwap(callInfo, message, transactionId);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      return returnedTransaction;\r\n    };\r\n\r\n    /**\r\n     * Determines if this message is valid to send.  Checks size of message,\r\n     * and count of messages being sent.   If the message is too large\r\n     * we raise an error and send it back.  If it has too many items, we split\r\n     * it into smaller packets and reassemble them later.\r\n     *\r\n     * @param {String|emp3.api.enums.channel} channel The CMAPI channel used to send the data to the map.\r\n     * @param {Object} message The message in the format corresponding the CMAPI channel\r\n     * we are using.\r\n     * @param {CallInfo} callInfo The information regarding the caller of the function.  This\r\n     * is used to store remaining payloads not sent if the message is too big.\r\n     */\r\n    this.validate = function(channel, message, callInfo) {\r\n      var tempArray,\r\n        splitPayload,\r\n        queuedMessage,\r\n        publishData;\r\n\r\n      if (channel === emp3.api.enums.channel.plotFeatureBatch ||\r\n        channel === emp3.api.enums.channel.unplotFeatureBatch) {\r\n\r\n        // If it is a batch channel, determine how many items are in the request.\r\n        // If we have more than 500 items, we need to break the requests down into chunks.\r\n        // Pull the first 500 out, and then add the remaining on the callInfo stack.\r\n        // When the first 500 are complete and come back in handleTransactionComplete, that\r\n        // function will send the remaining items.\r\n\r\n        splitPayload = message.features.splice(0, 500);\r\n\r\n\r\n        // Store the remaining items to be processed as well as their\r\n        // returned values.\r\n        tempArray = message.features;\r\n        callInfo.remainingPayload = tempArray;\r\n        callInfo.successes = [];\r\n        callInfo.failures = [];\r\n\r\n        // Change the message to only include the items that we are processing.\r\n        // In the case of these batch channels, we just change the size of the\r\n        // features property.\r\n        message.features = splitPayload;\r\n      }\r\n\r\n      publishData = {\r\n        channel: channel,\r\n        message: message\r\n      };\r\n\r\n      if (callInfo.hasOwnProperty('mapId') && (typeof(callInfo.mapId) === 'string') && (callInfo.mapId.length > 0)) {\r\n        publishData.dest = {\r\n          id: callInfo.mapId\r\n        };\r\n      }\r\n\r\n      // Make sure the environment is ready before sending out any messages.   If it isn't,\r\n      // stick the messages in a queue and wait for the environment to return\r\n      if (this.isEnvironmentReady) {\r\n\r\n        // If the environment is ready, and there is anything in the queue,\r\n        // empty out the queue first, then proceed to the message to send.\r\n        // we want to make sure the messages get sent in order that they\r\n        // are received.\r\n        // IMPORTANT: Also, just because the environment is ready, does not\r\n        // mean that the map is necessarily ready.  Remember when debugging.\r\n        if (queue.length > 0) {\r\n\r\n          // Empty out the queue.\r\n          while (queue.length > 0) {\r\n\r\n            queuedMessage = queue.shift();\r\n            environment.pubSub.publish({\r\n              dest: queuedMessage.sender,\r\n              channel: queuedMessage.channel,\r\n              message: queuedMessage.message\r\n            });\r\n          }\r\n        }\r\n\r\n        // Send out the data, waiting for the response before sending the next chunk.\r\n        // The response will be handled in handleTransactionComplete\r\n        environment.pubSub.publish(publishData);\r\n      }\r\n      else {\r\n        queue.push(publishData);\r\n      }\r\n    };\r\n\r\n    this.getEnvironment = function() {\r\n      return environment;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @param {emp3.api.Message} payload\r\n     * @param {CallInfo} callInfo\r\n     */\r\n    var validatePayload = function(payload, callInfo) {\r\n      var queuedMessage,\r\n        publishData,\r\n        splitPayload,\r\n        tempArray;\r\n\r\n      if (payload.channel === emp3.api.enums.channel.plotFeatureBatch ||\r\n        payload.channel === emp3.api.enums.channel.unplotFeatureBatch) {\r\n\r\n        // If it is a batch channel, determine how many items are in the request.\r\n        // If we have more than 500 items, we need to break the requests down into chunks.\r\n        // Pull the first 500 out, and then add the remaining on the callInfo stack.\r\n        // When the first 500 are complete and come back in handleTransactionComplete, that\r\n        // function will send the remaining items.\r\n\r\n        splitPayload = payload.payload.features.splice(0, 500);\r\n\r\n        // Store the remaining items to be processed as well as their returned values.\r\n        tempArray = payload.payload.features;\r\n        callInfo.remainingPayload = tempArray;\r\n        callInfo.successes = [];\r\n        callInfo.failures = [];\r\n\r\n        // Change the message to only include the items that we are processing.\r\n        // In the case of these batch channels, we just change the size of the\r\n        // features property.\r\n        payload.payload.features = splitPayload;\r\n      }\r\n\r\n      publishData = {\r\n        channel: payload.channel,\r\n        message: payload.payload\r\n      };\r\n\r\n      if (callInfo.hasOwnProperty('mapId') && (typeof(callInfo.mapId) === 'string') && (callInfo.mapId.length > 0)) {\r\n        publishData.dest = {\r\n          id: callInfo.mapId\r\n        };\r\n      }\r\n\r\n      // Make sure the environment is ready before sending out any messages.   If it isn't,\r\n      // stick the messages in a queue and wait for the environment to return\r\n      if (this.isEnvironmentReady) {\r\n\r\n        // If the environment is ready, and there is anything in the queue,\r\n        // empty out the queue first, then proceed to the message to send.\r\n        // we want to make sure the messages get sent in order that they\r\n        // are received.\r\n        // IMPORTANT: Also, just because the environment is ready, does not\r\n        // mean that the map is necessarily ready.  Remember when debugging.\r\n        if (queue.length > 0) {\r\n\r\n          // Empty out the queue.\r\n          while (queue.length > 0) {\r\n\r\n            queuedMessage = queue.shift();\r\n            environment.pubSub.publish({\r\n              dest: queuedMessage.sender,\r\n              channel: queuedMessage.channel,\r\n              message: queuedMessage.message\r\n            });\r\n          }\r\n        }\r\n\r\n        // Send out the data, waiting for the response before sending the next chunk.\r\n        // The response will be handled in handleTransactionComplete\r\n        environment.pubSub.publish(publishData);\r\n      }\r\n      else {\r\n        queue.push(publishData);\r\n      }\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Registers a map with the messageHandler.  The maps are maintained\r\n     * so that eventing can be routed to proper map.\r\n     *\r\n     * @param {emp3.api.Map} map A Map object.\r\n     */\r\n    this.registerMap = function(map) {\r\n      if (!mapHash.hasItem(map.geoId)) {\r\n        mapHash.setItem(map.geoId, map);\r\n      }\r\n    };\r\n\r\n    this.lookupMap = function(mapId) {\r\n      if (mapId && typeof mapId === 'string') {\r\n        return mapHash.getItem(mapId);\r\n      }\r\n    };\r\n\r\n    this.unregisterMap = function(map) {\r\n      mapHash.removeItem(map.geoId);\r\n    };\r\n\r\n    /**\r\n     * Will notify the caller when the map is ready to receive events.\r\n     *\r\n     * @param {object} message\r\n     * @param {CallInfo} message.callInfo - Information about the caller.\r\n     * @param {object} message.args - The arguments passed in from the caller.\r\n     * @param {function} message.args.onSuccess\r\n     * @param {function} message.args.onError\r\n     */\r\n    this.notifyOnReady = function(message) {\r\n      var payload = {},\r\n        messageRef = message;\r\n\r\n      function checkEnvReady() {\r\n        if (that.isEnvironmentReady === true) {\r\n          // Send out a blind check to see if the map is already up\r\n          // and ready. If it is the map will respond, otherwise it won't\r\n          // and we'll wait for the notification.\r\n          that.validate(emp3.api.enums.channel.statusRequest, payload, messageRef.callInfo);\r\n        }\r\n        else {\r\n          setTimeout(checkEnvReady, 500);\r\n        }\r\n      }\r\n\r\n      // This will check the onSuccess and onFailure callbacks\r\n      // and let the caller know when the map is ready by calling\r\n      // one of the corresponding functions.\r\n      if (message.args.onSuccess) {\r\n\r\n        // Send out an immediate status check, in case the map\r\n        // is up.  If the map is not ready to receive messages this\r\n        // message will get lost, so we'll queue the message to process\r\n        // when the map finally loads.\r\n        payload.types = [\"initialization\"];\r\n\r\n        // Save the callback just in case the map isn't already up.\r\n        this.mapReadyCallback.push({\r\n          onSuccess: message.args.onSuccess,\r\n          onError: message.args.onError\r\n        });\r\n\r\n        // Check if the map's environment is ready to proceed\r\n        checkEnvReady();\r\n\r\n        //this.validate(emp3.api.enums.channel.statusView, payload, message.callInfo);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Launches an instance of the EMP map.  Depending on the environment the\r\n     * actual result of this function differs.  The map will respond by sending\r\n     * an instance id after the map has successfully instantiated.\r\n     *\r\n     * @param  {Object} args [description]\r\n     * @param  {String} args.containerId A unique id telling the environment how or\r\n     * where to spawn the map.\r\n     * @param args.onSuccess\r\n     * @param args.onError\r\n     * @param {emp3.api.Map} args.map\r\n     * @param {object} args.defaultExtent\r\n     * @param {object} args.engine A map engine configuration object.\r\n     */\r\n    this.spawnMap = function(args) {\r\n      var messageId = emp3.api.createGUID(),\r\n        transaction,\r\n        callInfo = {};\r\n\r\n      if (!args) {\r\n        throw new Error(\"Missing args.\");\r\n      }\r\n      if (!args.onSuccess) {\r\n        throw new Error(\"emp3.api.MessageHandler.spawnMap missing args: onSuccess\");\r\n      }\r\n      if (!args.onError) {\r\n        throw new Error(\"emp3.api.MessageHandler.spawnMap missing args: onError\");\r\n      }\r\n      if (!args.container) {\r\n        //throw new Error(\"emp3.api.MessageHandler.spawnMap missing args: container\");\r\n      }\r\n      if (!args.map) {\r\n        throw new Error(\"emp3.api.MessageHandler.spawnMap missing args: map\");\r\n      }\r\n      if (!args.engine) {\r\n        throw new Error(\"emp3.api.MessageHandler.spawnMap missing args: engine\");\r\n      }\r\n\r\n      // Create a transaction and store it in our transaction hash like we are waiting for a response\r\n      // when the environment is ready, the messageHandler will receive a transaction complete message.\r\n      // This callInfo will then be received and the onSuccess handler will be called.\r\n      args.messageId = messageId;\r\n\r\n      callInfo = {\r\n        source: this,\r\n        method: \"MessageHandler.spawnMap\",\r\n        args: args\r\n      };\r\n\r\n      callInfo.map = args.map;\r\n\r\n      transaction = {\r\n        transactionId: messageId,\r\n        callInfo: callInfo,\r\n        source: args.map,\r\n        args: callInfo.args,\r\n        onSuccess: args.onSuccess,\r\n        onError: args.onError\r\n      };\r\n\r\n      // store the transaction in the hash.\r\n      this.messageCallbackHash.setItem(messageId, transaction);\r\n\r\n      environment.createInstance({\r\n        containerId: args.container,\r\n        messageId: messageId,\r\n        extent: args.defaultExtent,\r\n        engine: args.engine,\r\n        farDistanceThreshold: args.farDistanceThreshold,\r\n        midDistanceThreshold: args.midDistanceThreshold,\r\n        brightness: args.brightness,\r\n        recorder: args.recorder,\r\n        environment: args.environment\r\n      });\r\n    };\r\n\r\n    this.mapShutdown = function(callInfo, message, transactionId) {\r\n      // Before we shut it down let make sure it exists.\r\n      if (!mapHash.hasItem(callInfo.map.geoId)) {\r\n        // It does not exists.\r\n        this.messageCallbackHash.removeItem(transactionId);\r\n        message.onError({\r\n          errorMessage: \"Map with id \" + callInfo.map.geoId + \" does not exist.\",\r\n          callInfo: callInfo,\r\n          source: callInfo.source,\r\n          args: callInfo.args\r\n        });\r\n      }\r\n      else if (environment.name.toLowerCase() === 'browser') {\r\n        environment.destroyInstance({\r\n          id: callInfo.map.geoId,\r\n          messageId: transactionId\r\n        });\r\n      }\r\n      else {\r\n        // We need to figure out what to do for other environments.\r\n      }\r\n    };\r\n\r\n    this.handleMapShutdownTransactionComplete = function(callbacks) {\r\n      try {\r\n        callbacks.onSuccess();\r\n      }\r\n      catch (err) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + err.name + \"\\n  message:\" + err.message + \"\\n  stack:\" + err.stack);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handles the getVisibility transaction complete response form the map and calls the onSuccess method.\r\n     *\r\n     * @param {Object} callbacks Information about the original method call,\r\n     * including the callback methods to call when the method succeeds.\r\n     * @param {Object} details The returned values from the core.\r\n     * @param {Array} failures An array of failures that occurred during\r\n     * the operation in the core.  Just report this back to user in case\r\n     * it occurred.\r\n     */\r\n    this.handleGetVisibilityTransactionComplete = function(callbacks, details, failures) {\r\n      try {\r\n\r\n        // Simply call the onSuccess method stored in the callback hash.  The\r\n        // onSuccess should pass the original target and parent (if available)\r\n        // back to the user as well as the visibility status.\r\n        //\r\n        // onError callbacks are handled by the calling method handleTransactionComplete\r\n        callbacks.onSuccess({\r\n          target: callbacks.args.target,\r\n          parent: callbacks.args.parent,\r\n          visible: details.visible,\r\n          failures: failures\r\n        });\r\n      }\r\n      catch (err) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + err.name + \"\\n  message:\" + err.message + \"\\n  stack:\" + err.stack);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * This function is called after a change to the map state occurs or a\r\n     * request for status map initialization.\r\n     * The change occurs on the map.status.initialization channel.\r\n     * The api listens for the ready event and calls the mapReadyCallback\r\n     * for anyone listening for when the map finishes loading.  This handler\r\n     * also listens for the map heartbeat, and sets the last time the api\r\n     * heard back from the map.  The function will also raise a map closed\r\n     * event when the map is closed.\r\n     *\r\n     * @private\r\n     * @param {object} sender - object containing information about the ozone\r\n     * widget that sent the message.\r\n     * @param {object} msg - the object containing the payload sent over\r\n     * the map.status.initialization channel.\r\n     */\r\n    this.handleMapStatus = function(sender, msg) {\r\n      var payload,\r\n        event,\r\n        i, j,\r\n        callbacks,\r\n        callInfo,\r\n        source,\r\n        args,\r\n        map,\r\n        previousState,\r\n        removeSuccess = false;\r\n\r\n      // First make sure there is a payload\r\n      if (msg) {\r\n        // make sure the the payload is an object.\r\n        payload = typeof msg === \"string\" ? JSON.parse(msg) : msg;\r\n        // Find the map with the id associated with it.\r\n        map = mapHash.getItem(sender.id);\r\n        if (map === undefined) {\r\n          // We got a message for a map we know nothing about or it was removed from the hash.\r\n          // However we may want to add it to the hash. It can be a map that was opened\r\n          // by another client.\r\n          map = mapHash.getItem(\"broadcast\");\r\n          if (map === undefined) {\r\n            return;\r\n          }\r\n        }\r\n        previousState = map.getState();\r\n        map.status = emp3.api.convertStatusType(payload.status);\r\n\r\n        map.engineId = payload.engineId;\r\n        // Now we need to raise a map state change event\r\n        if (map) {\r\n          if (this.eventListeners[map.geoId] && this.eventListeners[map.geoId][emp3.api.enums.EventType.MAP_STATE_CHANGE]) {\r\n            callbacks = this.eventListeners[map.geoId][emp3.api.enums.EventType.MAP_STATE_CHANGE];\r\n            event = new emp3.api.events.MapStateChangeEvent({\r\n              event: emp3.api.enums.MapEventEnum.STATE_CHANGE,\r\n              target: map,\r\n              previousState: previousState\r\n            });\r\n            for (i = 0; i < callbacks.length; i++) {\r\n              try {\r\n                callbacks[i](event);\r\n              }\r\n              catch (e) {\r\n                console.error(\"Event callback generated an exception. \" + e.message);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        switch (map.status) {\r\n          case emp3.api.enums.MapStateEnum.MAP_READY:\r\n            emp3.api.enums.defaultOverlayId.WMS = payload.defaultWMSOverlayId;\r\n            emp3.api.enums.defaultOverlayId.Layers = payload.defaultLayerOverlayId;\r\n            // The mapReadyCallback contains any callback functions that are waiting to respond\r\n            // to the onSuccess of the Map constructor.  The messageHandler holds those requests\r\n            // until the actual map responds to the caller by telling it is ready.\r\n            //\r\n            // Once we receive a ready event, we need to loop through any waiting map callbacks\r\n            // and check to see if the source of the callback matches the sending map.  If it is\r\n            // that means the map is ready and we should call the callback.\r\n            for (i = 0; i < this.mapReadyCallback.length; i += 1) {\r\n              // Retrieve information from the message\r\n              callInfo = this.mapReadyCallback[i].callInfo;\r\n              source = this.mapReadyCallback[i].source;\r\n              args = this.mapReadyCallback[i].args;\r\n              // Check to see if the sending map matches this particular source of the callback.\r\n              // If it matches, call the onSuccess function.\r\n              if (sender.id === source.geoId || source.geoId === \"broadcast\") {\r\n                try {\r\n                  this.mapReadyCallback[i].onSuccess();\r\n                }\r\n                catch (e) {\r\n                  console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n                }\r\n                removeSuccess = true;\r\n                break;\r\n              }\r\n            }\r\n            // remove the mapReadyCallback this was pertaining to.  If we did this inside the\r\n            // loop we'd change the size of the array, and mess it up.\r\n            if (removeSuccess) {\r\n              this.mapReadyCallback.splice(i, 1);\r\n            }\r\n            break;\r\n          case emp3.api.enums.MapStateEnum.SHUTDOWN:\r\n            // Event listeners must be removed to prevent memory leak\r\n            for (i in this.eventListeners[map.geoId]) {\r\n              for (j in this.eventListeners[map.geoId][i]) {\r\n                map.removeEventListener({\r\n                  eventType: i,\r\n                  callback: this.eventListeners[map.geoId][i][j]\r\n                });\r\n              }\r\n            }\r\n            this.unregisterMap(map);\r\n            break;\r\n          case \"mapInstanceInitFailed\":\r\n            // The mapReadyCallback contains any callback functions that are waiting to respond\r\n            // to the onSuccess or onError of the Map constructor.  The messageHandler holds those requests\r\n            // until the actual map responds to the caller by telling it is ready.\r\n            //\r\n            // Once we receive the event, we need to loop through any waiting map callbacks\r\n            // and check to see if the source of the callback matches the sending map.  If it is\r\n            // that means the map failed to initialize and we should call the callback.\r\n            for (i = 0; i < this.mapReadyCallback.length; i += 1) {\r\n              // Retrieve information from the message\r\n              callInfo = this.mapReadyCallback[i].callInfo;\r\n              source = this.mapReadyCallback[i].source;\r\n              args = this.mapReadyCallback[i].args;\r\n              // Check to see if the sending map matches this particular source of the callback.\r\n              // If it matches, call the onError function.\r\n              if (sender.id === source.geoId) {\r\n                this.mapReadyCallback[i].onError({\r\n                  source: source,\r\n                  callInfo: callInfo,\r\n                  args: args,\r\n                  failures: payload.failures\r\n                });\r\n                this.mapReadyCallback.splice(i, 1);\r\n                break;\r\n              }\r\n            }\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * This function handles the transaction complete for conversion methods.\r\n     * @param {object} callbacks\r\n     * @param {object} details\r\n     * @param {array} failures\r\n     */\r\n    this.handleMapConvert = function(callbacks, details) {\r\n\r\n      switch (callbacks.callInfo.method) {\r\n        case \"Map.getLatLonFromXY\":\r\n          try {\r\n            callbacks.onSuccess({\r\n              lat: details.y,\r\n              lon: details.x,\r\n              invalid: details.invalid\r\n            });\r\n          }\r\n          catch (e) {\r\n            console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n          }\r\n          break;\r\n        case \"Map.getXYFromLatLon\":\r\n          try {\r\n            callbacks.onSuccess({\r\n              x: details.x,\r\n              y: details.y,\r\n              invalid: details.invalid\r\n            });\r\n          }\r\n          catch (e) {\r\n            console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n          }\r\n          break;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Message progress handler used to call functions related to operations\r\n     * that have intermediate stages.\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {string} msg - The payload sent over the map.message.progress channel.\r\n     */\r\n    this.handleMessageProgress = function(sender, msg) {\r\n      var oMessage;\r\n      var oDetails;\r\n      var sOriginalChannel;\r\n      var transactionId;\r\n\r\n      // First make sure there is a payload\r\n      if (msg === undefined || msg === null) {\r\n        return;\r\n      }\r\n\r\n      oMessage = typeof msg === \"string\" ? JSON.parse(msg) : msg;\r\n      sOriginalChannel = oMessage.originatingChannel;\r\n      oDetails = oMessage.details;\r\n\r\n      // Get the transactionId of the message.  We will pull the callback\r\n      // functions that are associated with this transactionId.\r\n      transactionId = oMessage.messageId;\r\n\r\n      switch (sOriginalChannel) {\r\n        case emp3.api.enums.channel.featureEdit:\r\n          this.handleEdit(sender, oDetails, transactionId);\r\n          break;\r\n        case emp3.api.enums.channel.draw:\r\n          this.handleDraw(sender, oDetails, transactionId);\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handles events related to adding features.\r\n     *\r\n     * @param {Object} callingObject - The object containing information about\r\n     * the api function invocation leading to event generation.\r\n     */\r\n    this.generateFeatureAddEvents = function(sender, payload) {\r\n      var parentId,\r\n        event = {},\r\n        details,\r\n        parentInfo,\r\n        i,\r\n        j;\r\n\r\n      details = Array.isArray(payload.details.features) ? payload.details.features : [payload.details.features];\r\n      // Traverse payload details to collect event arguments and generate the event properties.\r\n      for (i = 0; i < details.length; i += 1) {\r\n        // Check for the existence of an event subscription for each unique parent Id.\r\n        // If none exists then skip to the next item. The parentInfo property can be used\r\n        // here because a feature will always have a parent. This is not the case with\r\n        // overlays that reside on the map's root level. The parentInfo property will not exist\r\n        // in this case.\r\n        parentInfo = details[i].parentInfo;\r\n        if (parentInfo) {\r\n          parentId = parentInfo.featureId || parentInfo.overlayId;\r\n        }\r\n        if (parentId && this.eventListeners[parentId] && this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]) {\r\n          // Check to see if the id resides in the hash. If it does not, create a new object.\r\n          event[parentId] = event[parentId] || {};\r\n          // Retrieve any callbacks associated with this parentId. In this case the parentId could\r\n          // pertain to a feature or an overlay\r\n          if (!event[parentId].callbacks) {\r\n            event[parentId].callbacks = this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER];\r\n            // Check to see if the parentInfo object contains a \"featureId\" property. If it does, then\r\n            // the parent is a feature and a new target Feature object has to be built\r\n            if (parentInfo.hasOwnProperty(\"featureId\")) {\r\n              event[parentId].target = {\r\n                geoId: parentInfo.featureId,\r\n                name: parentInfo.name,\r\n                type: parentInfo.format,\r\n                properties: parentInfo.properties,\r\n                description: parentInfo.description\r\n              };\r\n              switch (event[parentId].target.type) {\r\n                case emp3.api.enums.FeatureTypeEnum.KML:\r\n                  event[parentId].target.KMLString = parentInfo.feature;\r\n                  break;\r\n                case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n                  event[parentId].target.GeoJSONData = parentInfo.feature;\r\n                  break;\r\n                default:\r\n                  event[parentId].target.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(parentInfo.feature);\r\n                  break;\r\n              }\r\n              // Add a symbol code if available\r\n              if (event[parentId].target.type === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL) {\r\n                event[parentId].target.symbolCode = parentInfo.feature.symbolCode;\r\n              }\r\n              // Must build a feature for the target since the parent is a feature.\r\n              event[parentId].target = emp3.api.buildFeature(event[parentId].target);\r\n            } else {\r\n              // Build a new target Overlay object based on parentInfo parameters from payload\r\n              event[parentId].target = emp3.api.buildOverlay({\r\n                geoId: parentId,\r\n                name: parentInfo.name,\r\n                dataProviderId: parentInfo.dataProviderId,\r\n                description: parentInfo.description,\r\n                properties: parentInfo.properties,\r\n                children: parentInfo.children,\r\n                readOnly: parentInfo.properties.readOnly\r\n              });\r\n            }\r\n            // Create the affectedChildren array to send into the Container\r\n            // event object.\r\n            event[parentId].affectedChildren = [];\r\n            event[parentId].containerEvent = new emp3.api.events.ContainerEvent({\r\n              event: emp3.api.enums.ContainerEventEnum.OBJECT_ADDED,\r\n              target: event[parentId].target,\r\n              affectedChildren: event[parentId].affectedChildren\r\n            });\r\n          }\r\n          event[parentId].affectedChild = {\r\n            geoId: details[i].featureId,\r\n            name: details[i].name,\r\n            type: details[i].format,\r\n            properties: details[i].properties,\r\n            description: details[i].description\r\n          };\r\n          switch (event[parentId].affectedChild.type) {\r\n            case emp3.api.enums.FeatureTypeEnum.KML:\r\n              event[parentId].affectedChild.KMLString = details[i].feature;\r\n              break;\r\n            case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n              event[parentId].affectedChild.GeoJSONData = details[i].feature;\r\n              break;\r\n            default:\r\n              event[parentId].affectedChild.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(details[i].feature);\r\n              break;\r\n          }\r\n          // Check to see if the child's type is a symbol and if it is send the symbol code into\r\n          // the constructor\r\n          if (event[parentId].affectedChild.type === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL) {\r\n            event[parentId].affectedChild.symbolCode = details[i].feature.symbolCode;\r\n          }\r\n          // Push the built Features on the array list\r\n          event[parentId].affectedChildren.push(emp3.api.buildFeature(event[parentId].affectedChild));\r\n        }\r\n      }\r\n      // If we have callbacks then we need to generate the event.\r\n      for (i in event) {\r\n        for (j = 0; j < event[i].callbacks.length; j += 1) {\r\n          try {\r\n            event[i].callbacks[j](event[i].containerEvent);\r\n          } catch (e) {\r\n            console.error(\"Event callback generated an exception. \" + e.message);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handles events related to removing features.\r\n     *\r\n     * @param {Object} mHCallingObject - The object containing information about\r\n     * the api function invocation leading to event generation.\r\n     */\r\n    this.generateFeatureDeletedEvents = function(sender, payload) {\r\n      var parentId,\r\n        event = {},\r\n        details,\r\n        parentInfo,\r\n        i,\r\n        j;\r\n\r\n      details = Array.isArray(payload.details.features) ? payload.details.features : [payload.details.features];\r\n      // Traverse payload details to collect event arguments and generate the event properties.\r\n      for (i = 0; i < details.length; i += 1) {\r\n        // Check for the existence of an event subscription for each unique parent Id.\r\n        // If none exists then skip to the next item. The parentInfo property can be used\r\n        // here because a feature will always have a parent. This is not the case with\r\n        // overlays that reside on the map's root level. The parentInfo property will not exist\r\n        // in this case.\r\n        parentInfo = details[i].parentInfo;\r\n        if (parentInfo) {\r\n          parentId = parentInfo.featureId || parentInfo.overlayId;\r\n        }\r\n        if (parentId && this.eventListeners[parentId] && this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]) {\r\n          // Check to see if the id resides in the hash. If it does not, create a new object.\r\n          event[parentId] = event[parentId] || {};\r\n          // Retrieve any callbacks associated with this parentId. In this case the parentId could\r\n          // pertain to a feature or an overlay\r\n          if (!event[parentId].callbacks) {\r\n            event[parentId].callbacks = this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER];\r\n            // Check to see if the parentInfo object contains a \"featureId\" property. If it does, then\r\n            // the parent is a feature and a new target Feature object has to be built\r\n            if (parentInfo.hasOwnProperty(\"featureId\")) {\r\n              event[parentId].target = {\r\n                geoId: parentInfo.featureId,\r\n                name: parentInfo.name,\r\n                type: parentInfo.format,\r\n                properties: parentInfo.properties,\r\n                description: parentInfo.description\r\n              };\r\n              switch (event[parentId].target.type) {\r\n                case emp3.api.enums.FeatureTypeEnum.KML:\r\n                  event[parentId].target.KMLString = parentInfo.feature;\r\n                  break;\r\n                case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n                  event[parentId].target.GeoJSONData = parentInfo.feature;\r\n                  break;\r\n                default:\r\n                  event[parentId].target.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(parentInfo.feature);\r\n                  break;\r\n              }\r\n              // Add a symbol code if available\r\n              if (event[parentId].target.type === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL) {\r\n                event[parentId].target.symbolCode = parentInfo.feature.symbolCode;\r\n              }\r\n              // Must build a feature for the target since the parent is a feature.\r\n              event[parentId].target = emp3.api.buildFeature(event[parentId].target);\r\n            } else {\r\n              // Build a new target Overlay object based on parentInfo parameters from payload\r\n              event[parentId].target = emp3.api.buildOverlay({\r\n                geoId: parentId,\r\n                name: parentInfo.name,\r\n                dataProviderId: parentInfo.dataProviderId,\r\n                description: parentInfo.description,\r\n                properties: parentInfo.properties,\r\n                children: parentInfo.children,\r\n                readOnly: parentInfo.properties.readOnly\r\n              });\r\n            }\r\n            // Create the affectedChildren array to send into the Container\r\n            // event object.\r\n            event[parentId].affectedChildren = [];\r\n            event[parentId].containerEvent = new emp3.api.events.ContainerEvent({\r\n              event: emp3.api.enums.ContainerEventEnum.OBJECT_REMOVED,\r\n              target: event[parentId].target,\r\n              affectedChildren: event[parentId].affectedChildren\r\n            });\r\n          }\r\n          event[parentId].affectedChild = {\r\n            geoId: details[i].featureId,\r\n            name: details[i].name,\r\n            type: details[i].format,\r\n            properties: details[i].properties,\r\n            description: details[i].description\r\n          };\r\n          switch (event[parentId].affectedChild.type) {\r\n            case emp3.api.enums.FeatureTypeEnum.KML:\r\n              event[parentId].affectedChild.KMLString = details[i].feature;\r\n              break;\r\n            case emp3.api.enums.FeatureTypeEnum.GEOJSON:\r\n              event[parentId].affectedChild.GeoJSONData = details[i].feature;\r\n              break;\r\n            default:\r\n              event[parentId].affectedChild.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(details[i].feature);\r\n              break;\r\n          }\r\n          // Check to see if the child's type is a symbol and if it is send the symbol code into\r\n          // the constructor\r\n          if (event[parentId].affectedChild.type === emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL) {\r\n            event[parentId].affectedChild.symbolCode = details[i].feature.symbolCode;\r\n          }\r\n          // Push the built Features on the array list\r\n          event[parentId].affectedChildren.push(emp3.api.buildFeature(event[parentId].affectedChild));\r\n        }\r\n      }\r\n      // If we have callbacks then we need to generate the event.\r\n      for (i in event) {\r\n        for (j = 0; j < event[i].callbacks.length; j += 1) {\r\n          try {\r\n            event[i].callbacks[j](event[i].containerEvent);\r\n          } catch (e) {\r\n            console.error(\"Event callback generated an exception. \" + e.message);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.generateOverlayUpdatedEvents = function(callbacks) {\r\n      var i,\r\n          j,\r\n          overlay,\r\n          overlays = [],\r\n          event,\r\n          eventHandlers;\r\n\r\n      if (callbacks.data.overlay) {\r\n        overlays = [callbacks.data.overlay];\r\n      } else if (callbacks.data.overlays) {\r\n        overlays = callbacks.data.overlays;\r\n      }\r\n\r\n      for (i = 0; i < overlays.length; i++) {\r\n        overlay = overlays[i];\r\n        if (this.eventListeners[overlay.geoId]) {\r\n          eventHandlers = this.eventListeners[overlay.geoId][emp3.api.enums.EventType.OVERLAY_CHANGE];\r\n        }\r\n        if (eventHandlers) {\r\n          event = new emp3.api.events.OverlayUpdatedEvent({\r\n            target: overlay\r\n          });\r\n          for (j = 0; j < eventHandlers.length; j++) {\r\n            try {\r\n              eventHandlers[j](event);\r\n            } catch (e) {\r\n              console.error(\"Event callback generated an exception. \" + e.message);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handles events related to the adding overlays.\r\n     *\r\n     * @param {Object} mHCallingObject - The object containing information about\r\n     * the api function invocation leading to event generation.\r\n     */\r\n    this.generateOverlayAddEvents = function(sender, payload) {\r\n      var parentId,\r\n        event = {},\r\n        details,\r\n        parentInfo,\r\n        i,\r\n        j;\r\n\r\n      details = Array.isArray(payload.details) ? payload.details : [payload.details];\r\n      // Traverse payload details to collect event arguments and generate the event properties.\r\n      for (i = 0; i < details.length; i += 1) {\r\n        // Check for the existence of an event subscription for each unique parentId.\r\n        // If none exists then the parent is a map.\r\n        parentId = details[i].parentId;\r\n\r\n        if (parentId && this.eventListeners[parentId] &&\r\n          this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]) {\r\n\r\n          // Check to see if the id resides in the hash. If it does not, create a new object.\r\n          event[parentId] = event[parentId] || {};\r\n          // Retrieve any callbacks associated with this parentId. In this case the parentId could\r\n          // pertain to a map or an overlay\r\n          if (!event[parentId].callbacks) {\r\n            event[parentId].callbacks = this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER];\r\n            // Check to see if the parentId pertains to a map or an overlay. If it is a map,\r\n            // retrieve the map object as the target\r\n            if (parentId === sender.id) {\r\n              event[parentId].target = mapHash.getItem(parentId);\r\n            } else {\r\n              // Build a new target Overlay object based on parentInfo parameters from payload\r\n              parentInfo = details[i].parentInfo;\r\n              event[parentId].target = emp3.api.buildOverlay({\r\n                geoId: parentId,\r\n                name: parentInfo.name,\r\n                dataProviderId: parentInfo.dataProviderId,\r\n                description: parentInfo.description,\r\n                properties: parentInfo.properties,\r\n                children: parentInfo.children,\r\n                readOnly: parentInfo.properties.readOnly\r\n              });\r\n            }\r\n            // Create the affectedChildren array to send into the Container\r\n            // event object\r\n            event[parentId].affectedChildren = [];\r\n            event[parentId].containerEvent = new emp3.api.events.ContainerEvent({\r\n              event: emp3.api.enums.ContainerEventEnum.OBJECT_ADDED,\r\n              target: event[parentId].target,\r\n              affectedChildren: event[parentId].affectedChildren\r\n            });\r\n          }\r\n          // Push the built Overlays on the array list\r\n          event[parentId].affectedChildren.push(emp3.api.buildOverlay({\r\n            geoId: details[i].overlayId,\r\n            name: details[i].name,\r\n            dataProviderId: details[i].dataProviderId,\r\n            description: details[i].description,\r\n            properties: details[i].properties,\r\n            children: details[i].children,\r\n            readOnly: details[i].properties.readOnly\r\n          }));\r\n        }\r\n      }\r\n      // If we have callbacks then we need to generate the event.\r\n      for (i in event) {\r\n        for (j = 0; j < event[i].callbacks.length; j += 1) {\r\n          try {\r\n            event[i].callbacks[j](event[i].containerEvent);\r\n          } catch (e) {\r\n            console.error(\"Event callback generated an exception. \" + e.message);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handles events related to removing overlays\r\n     *\r\n     * @param {Object} mHCallingObject - The object containing information about\r\n     * the api function invocation leading to event generation.\r\n     */\r\n    this.generateOverlayDeletedEvents = function(sender, payload) {\r\n      var parentId,\r\n        event = {},\r\n        details,\r\n        parentInfo,\r\n        i,\r\n        j;\r\n\r\n      details = Array.isArray(payload.details) ? payload.details : [payload.details];\r\n      // Traverse payload details to collect event arguments and generate the event properties.\r\n      for (i = 0; i < details.length; i += 1) {\r\n        // Check for the existence of an event subscription for each unique parentId.\r\n        // If none exists then the parent is a map.\r\n        parentId = details[i].parentId;\r\n\r\n        if (parentId && this.eventListeners[parentId] &&\r\n          this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER]) {\r\n          // Check to see if the id resides in the hash. If it does not, create a new object.\r\n          event[parentId] = event[parentId] || {};\r\n          // Retrieve any callbacks associated with this parentId. In this case the parentId could\r\n          // pertain to a map or an overlay\r\n          if (!event[parentId].callbacks) {\r\n            event[parentId].callbacks = this.eventListeners[parentId][emp3.api.enums.EventType.CONTAINER];\r\n            // Check to see if the parentId pertains to a map or an overlay. If it is a map,\r\n            // retrieve the map object as the target\r\n            if (parentId === sender.id) {\r\n              event[parentId].target = mapHash.getItem(parentId);\r\n            } else {\r\n\r\n              parentInfo = details[i].parentInfo;\r\n              // Build a new target Overlay object based on parentInfo parameters from payload\r\n              event[parentId].target = emp3.api.buildOverlay({\r\n                geoId: parentId,\r\n                name: parentInfo.name,\r\n                dataProviderId: parentInfo.dataProviderId,\r\n                description: parentInfo.description,\r\n                properties: parentInfo.properties,\r\n                children: parentInfo.children,\r\n                readOnly: parentInfo.properties.readOnly\r\n              });\r\n            }\r\n            // Create the affectedChildren array to send into the Container\r\n            // event object\r\n            event[parentId].affectedChildren = [];\r\n            event[parentId].containerEvent = new emp3.api.events.ContainerEvent({\r\n              event: emp3.api.enums.ContainerEventEnum.OBJECT_REMOVED,\r\n              target: event[parentId].target,\r\n              affectedChildren: event[parentId].affectedChildren\r\n            });\r\n          }\r\n          // Push the built Overlays on the array list\r\n          event[parentId].affectedChildren.push(emp3.api.buildOverlay({\r\n            geoId: details[i].overlayId,\r\n            name: details[i].name,\r\n            dataProviderId: details[i].dataProviderId,\r\n            description: details[i].description,\r\n            properties: details[i].properties,\r\n            children: details[i].children,\r\n            readOnly: details[i].properties.readOnly\r\n          }));\r\n        }\r\n      }\r\n      // If we have callbacks then we need to generate the event.\r\n      for (i in event) {\r\n        for (j = 0; j < event[i].callbacks.length; j += 1) {\r\n          try {\r\n            event[i].callbacks[j](event[i].containerEvent);\r\n          } catch (e) {\r\n            console.error(\"Event callback generated an exception. \" + e.message);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @desc This function generates the visibility change event.\r\n     *\r\n     * @param {object} sender Contains information about the widget that sent the message.\r\n     * @param {object} payload The response payload. The response payload may differ\r\n     * depending on the originating channel of the message.\r\n     */\r\n    this.generateVisibilityEvent = function(sender, payload) {\r\n      var map,\r\n        containers = payload.details,\r\n        parentTargetAttributes,\r\n        parentContainer,\r\n        targetAttributes,\r\n        targetContainer,\r\n        visibilityState,\r\n        visibilityEvent,\r\n        callbacks = [],\r\n        i,\r\n        j;\r\n\r\n      if (sender.id) {\r\n        map = mapHash.getItem(sender.id);\r\n        // Check to see if there are any callbacks registered to any map containers. This is executed here instead of\r\n        // inside the loop because we only want to have one instance of the map level callbacks contained in the\r\n        // callbacks array.\r\n        if (this.eventListeners[sender.id] && this.eventListeners[sender.id][emp3.api.enums.EventType.VISIBILITY]) {\r\n          callbacks.push(this.eventListeners[sender.id][emp3.api.enums.EventType.VISIBILITY]);\r\n        }\r\n      }\r\n      for (i = 0; i < containers.length; i = i + 1) {\r\n        visibilityState = containers[i].visibilityState;\r\n        parentTargetAttributes = containers[i].parentTargetAttributes;\r\n        targetAttributes = containers[i].targetAttributes;\r\n        // Should only be \"null\" if the target is at the root.\r\n        if (parentTargetAttributes !== null) {\r\n          switch (parentTargetAttributes.globalType) {\r\n            case \"overlay\":\r\n              parentTargetAttributes.geoId = parentTargetAttributes.overlayId;\r\n              if (parentTargetAttributes.properties.hasOwnProperty(\"readOnly\")) {\r\n                parentTargetAttributes.readOnly = parentTargetAttributes.properties.readOnly;\r\n                delete parentTargetAttributes.properties.readOnly;\r\n              }\r\n              parentContainer = emp3.api.buildOverlay(parentTargetAttributes);\r\n              break;\r\n            case \"feature\":\r\n              parentTargetAttributes.geoId = parentTargetAttributes.featureId;\r\n              parentTargetAttributes.type = parentTargetAttributes.format;\r\n              parentTargetAttributes.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(parentTargetAttributes.data);\r\n              parentContainer = emp3.api.buildFeature(parentTargetAttributes);\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n        } else {\r\n          // target is at root and therefore the map container is the parent.\r\n          parentContainer = map;\r\n        }\r\n        switch (targetAttributes.globalType) {\r\n          case \"overlay\":\r\n            targetAttributes.geoId = targetAttributes.overlayId;\r\n            if (targetAttributes.properties.hasOwnProperty(\"readOnly\")) {\r\n              targetAttributes.readOnly = targetAttributes.properties.readOnly;\r\n              delete targetAttributes.properties.readOnly;\r\n            }\r\n            targetContainer = emp3.api.buildOverlay(targetAttributes);\r\n            break;\r\n          case \"feature\":\r\n            targetAttributes.geoId = targetAttributes.featureId;\r\n            targetAttributes.type = targetAttributes.format;\r\n            targetAttributes.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(targetAttributes.data);\r\n            targetContainer = emp3.api.buildFeature(targetAttributes);\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n        // Check to see if there are any overlay or feature level callbacks registered for visibility eventing. If so,\r\n        // a visibility event must be generated for each of these callbacks. If the client has registered a map along\r\n        // with an overlay or feature on that map for visibility events, all callbacks pertaining to each container\r\n        // type will be executed. The events sent to these registered callbacks will be the same.\r\n        if (this.eventListeners[targetAttributes.geoId] && this.eventListeners[targetAttributes.geoId][emp3.api.enums.EventType.VISIBILITY]) {\r\n          callbacks.push(this.eventListeners[targetAttributes.geoId][emp3.api.enums.EventType.VISIBILITY]);\r\n        }\r\n        visibilityEvent = new emp3.api.events.VisibilityEvent({\r\n          event: visibilityState,\r\n          target: targetContainer,\r\n          parent: parentContainer,\r\n          map: map\r\n        });\r\n        if (callbacks.length > 0) {\r\n          // If the length is 2 it means that the client has subscribed to visibility eventing on the map AND the target\r\n          // overlay OR feature. If this is the case, only 2 shift operations are necessary to place all relevant callbacks\r\n          // into one array for execution. Otherwise, only 1 shift operation is needed.\r\n          if (callbacks.length === 2) {\r\n            callbacks = callbacks.concat(callbacks.shift(), callbacks.shift());\r\n          } else {\r\n            callbacks = callbacks.concat(callbacks, callbacks.shift());\r\n          }\r\n          for (j = callbacks.length; j > 0; j = j - 1) {\r\n            callbacks.shift()(visibilityEvent);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handles the result from all transaction complete channel and forwards to the appropriate\r\n     * onSuccess handler.\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {string} msg - The message payload of the response. The response payload may differ\r\n     * depending on the originating channel of the message.\r\n     */\r\n    this.handleTransactionComplete = function(sender, msg) {\r\n      var payload,\r\n        transactionId,\r\n        callbacks,\r\n        eventArgs,\r\n        originChannel,\r\n        failures,\r\n        details,\r\n        drawEventCallbacks,\r\n        editEventCallbacks,\r\n        i,\r\n        event,\r\n        handleCallback = false;\r\n\r\n      // First make sure there is a payload\r\n      if (msg === undefined || msg === null) {\r\n        throw new Error(missingMessageError);\r\n      }\r\n\r\n      // make sure the the payload is an object.\r\n      payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n      // Get the originating channel that generated the transaction.  We\r\n      // will use this to modify the responses as the data in the\r\n      // successes parameter will differ depending on the origin of the\r\n      // channel.\r\n      originChannel = payload.originatingChannel;\r\n\r\n      // Get the transactionId of the message.  We will pull the callback\r\n      // functions that are associated with this transactionId.\r\n      transactionId = payload.messageId;\r\n\r\n      // Retrieve all the failures from the transaction.\r\n      if (payload.failures) {\r\n        failures = payload.failures;\r\n      }\r\n\r\n      // Retrieve all the success information about the transaction.\r\n      if (payload.details) {\r\n        details = payload.details;\r\n      }\r\n\r\n      // find information about the calling function in the lookup table.\r\n      callbacks = this.messageCallbackHash.getItem(transactionId);\r\n\r\n      // If a cancel has been called, abandon the transaction.\r\n      if (payload.status === emp3.api.enums.messageCompletionStatus.CANCELLED) {\r\n        // Its a cancelled transaction. We need to see if it was a draw or an edit.\r\n        // These are the only items that can currently be cancelled.\r\n        if (originChannel === emp3.api.enums.channel.draw ||\r\n          originChannel === emp3.api.enums.channel.featureEdit &&\r\n          (sender && sender.id)) {\r\n          // We need to see if there is a draw/edit cancel listener.\r\n          eventArgs = this.handleCancel(sender, payload);\r\n          // Since both edits and draws have their own cancel events, we must\r\n          // place a condition that checks for both\r\n          switch (originChannel) {\r\n            case emp3.api.enums.channel.draw:\r\n              // Get any draw event callbacks that are registered\r\n              drawEventCallbacks = this.eventListeners[sender.id] ? this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_DRAW] : null;\r\n              if (drawEventCallbacks) {\r\n                event = new emp3.api.events.FeatureDrawEvent({\r\n                  event: emp3.api.enums.FeatureDrawEventEnum.DRAW_CANCELLED,\r\n                  target: eventArgs.feature,\r\n                  map: eventArgs.map\r\n                });\r\n                for (i = 0; i < drawEventCallbacks.length; i += 1) {\r\n                  try {\r\n                    drawEventCallbacks[i](event);\r\n                  } catch (e) {\r\n                    console.error(\"Event callback generated an exception. \" + e.message);\r\n                  }\r\n                }\r\n              }\r\n              break;\r\n            case emp3.api.enums.channel.featureEdit:\r\n              // Get any edit event callbacks that are registered\r\n              editEventCallbacks = this.eventListeners[sender.id] ? this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_EDIT] : null;\r\n              if (editEventCallbacks) {\r\n                event = new emp3.api.events.FeatureEditEvent({\r\n                  event: emp3.api.enums.FeatureEditEventEnum.EDIT_CANCELLED,\r\n                  target: eventArgs.feature,\r\n                  map: eventArgs.map\r\n                });\r\n                for (i = 0; i < editEventCallbacks.length; i += 1) {\r\n                  try {\r\n                    editEventCallbacks[i](event);\r\n                  } catch (e) {\r\n                    console.error(\"Event callback generated an exception. \" + e.message);\r\n                  }\r\n                }\r\n              }\r\n              break;\r\n          }\r\n        }\r\n      } else if (payload.status !== emp3.api.enums.messageCompletionStatus.FAILURE) {\r\n        // There are some or all successes.\r\n        // Now lets process any completion that generates an event.\r\n        switch (originChannel) {\r\n          case emp3.api.enums.channel.plotFeature:\r\n          case emp3.api.enums.channel.plotFeatureBatch:\r\n            this.generateFeatureAddEvents(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.unplotFeature:\r\n          case emp3.api.enums.channel.unplotFeatureBatch:\r\n            this.generateFeatureDeletedEvents(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.createOverlay:\r\n            this.generateOverlayAddEvents(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.removeOverlay:\r\n            this.generateOverlayDeletedEvents(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.updateOverlay:\r\n            this.generateOverlayUpdatedEvents(callbacks);\r\n            break;\r\n          case emp3.api.enums.channel.hideFeature:\r\n          case emp3.api.enums.channel.showFeature:\r\n          case emp3.api.enums.channel.hideOverlay:\r\n          case emp3.api.enums.channel.showOverlay:\r\n            this.generateVisibilityEvent(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.featureDeselected:\r\n          case emp3.api.enums.channel.featureDeselectedBatch:\r\n            this.manageDeselection(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.featureSelected:\r\n          case emp3.api.enums.channel.featureSelectedBatch:\r\n            this.manageSelection(sender, payload);\r\n            break;\r\n          case emp3.api.enums.channel.freehandDrawStart:\r\n          case emp3.api.enums.channel.freehandDrawExit:\r\n            this.handleFreehand(sender, msg);\r\n            break;\r\n        }\r\n      }\r\n      // Check to make sure a callback has been found.  If no callback has been\r\n      // found then just exit out, we don't care about this message as the user\r\n      // will just carry on without a response.\r\n      if (!callbacks) {\r\n        return;\r\n      }\r\n\r\n      // Check to see if there are remaining any messages left to be sent before handling\r\n      // the transaction.  Do not respond to the transaction until there are no remaining\r\n      // transactions.\r\n      if (callbacks.callInfo &&\r\n        callbacks.callInfo.remainingPayload) {\r\n\r\n        // The original message was too big to send.  It had to be split up.\r\n        // Now we must send the next part.\r\n        // but first let save the success and failures.\r\n        callbacks.callInfo.failures = callbacks.callInfo.failures.concat(failures);\r\n        callbacks.callInfo.successes = callbacks.callInfo.successes.concat(details);\r\n\r\n        // In this case, it is one of the batch functions, AND there are\r\n        // more features to send.\r\n        if ((originChannel === emp3.api.enums.channel.plotFeatureBatch ||\r\n          originChannel === emp3.api.enums.channel.unplotFeatureBatch) &&\r\n          callbacks.callInfo.remainingPayload.length > 0) {\r\n\r\n          // This was a batch channel message\r\n          var splitPayload = callbacks.callInfo.remainingPayload.splice(0, 500);\r\n          var msgPayload = {\r\n            messageId: callbacks.transactionId,\r\n            features: splitPayload\r\n          };\r\n\r\n          environment.pubSub.publish({\r\n            channel: originChannel,\r\n            message: msgPayload\r\n          });\r\n          // It is one of the batch channels, AND there are no more features to send.\r\n        }\r\n        else if ((originChannel === emp3.api.enums.channel.plotFeatureBatch ||\r\n          originChannel === emp3.api.enums.channel.unplotFeatureBatch) &&\r\n          callbacks.callInfo.remainingPayload.length === 0) {\r\n\r\n          // now join successes together into a single success.\r\n          payload.details = joinDetails(callbacks.callInfo.successes, originChannel);\r\n\r\n          // join errors together.\r\n          callbacks.callInfo.failures = callbacks.callInfo.failures.concat(failures);\r\n\r\n          // mark this message to respond to the callback.\r\n          handleCallback = true;\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // mark this message to respond to the callback.\r\n        handleCallback = true;\r\n      }\r\n\r\n      // Check to make sure we have clearance to process the transaction response.  We will only\r\n      // get this once the entire message has been processed.  If only part of the message was\r\n      // process because the original transaction was split, we should not return the success or\r\n      // failure of the transaction.\r\n      if (handleCallback) {\r\n\r\n        // Remove transactionId from hash.  We want to do this regardless if we\r\n        // have a onSuccess handler or not, and we want it to be first in case an\r\n        // error occurs later.\r\n        this.messageCallbackHash.removeItem(transactionId);\r\n\r\n        // If there are no successes, but we have failures, call onError.\r\n        // Report the first error.  If there are more that is fine, but\r\n        // the callback only supports one message at a time.\r\n        if ((payload.status === emp3.api.enums.messageCompletionStatus.FAILURE) &&\r\n          (originChannel !== emp3.api.enums.channel.draw &&\r\n          originChannel !== emp3.api.enums.channel.featureEdit)) {\r\n          try {\r\n            callbacks.onError({\r\n              callInfo: callbacks.callInfo,\r\n              source: callbacks.source,\r\n              args: callbacks.args,\r\n              errorMessage: failures[0].message\r\n            });\r\n          }\r\n          catch (e) {\r\n            console.error(\"onError function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n          }\r\n        }\r\n        else {\r\n\r\n          if (originChannel) {\r\n\r\n            // Grab the appropriate channel response broker\r\n            var broker = emp3.api.ResponseBrokerFactory.getBroker(originChannel);\r\n            if (broker) {\r\n              try {\r\n                broker.process(callbacks, payload.details, failures);\r\n              }\r\n              catch (err) {\r\n                console.error(\"Callback function generated an exception.\" + \"\\n  name:\" + err.name + \"\\n  message:\" + err.message + \"\\n  stack:\" + err.stack);\r\n              }\r\n              return;\r\n            }\r\n\r\n            // There are some successes so finish through the transaction.\r\n            switch (originChannel) {\r\n              case emp3.api.enums.channel.centerOnBounds:\r\n                this.handleCenterOnBoundsTransactionComplete(callbacks, payload.details);\r\n                break;\r\n              case emp3.api.enums.channel.zoom:\r\n                this.handleZoomTransactionComplete(callbacks, payload.details);\r\n                break;\r\n              case emp3.api.enums.channel.centerOnFeature:\r\n                this.handleCenterOnFeatureTransactionComplete(callbacks, payload.details);\r\n                break;\r\n              case emp3.api.enums.channel.centerOnLocation:\r\n                this.handleCenterOnLocationTransactionComplete(callbacks, payload.details);\r\n                break;\r\n              case emp3.api.enums.channel.lookAtLocation:\r\n                this.handleLookAtLocationTransactionComplete(callbacks, payload.details);\r\n                break;\r\n              case emp3.api.enums.channel.unplotFeature:\r\n              case emp3.api.enums.channel.unplotFeatureBatch:\r\n                this.handleUnplotFeatureTransactionComplete(callbacks, payload.details, failures);\r\n                break;\r\n              case emp3.api.enums.channel.draw:\r\n              case emp3.api.enums.channel.featureEdit:\r\n                this.handleDrawEditTransactionComplete(callbacks, payload, failures);\r\n                break;\r\n              case emp3.api.enums.channel.convert:\r\n                this.handleMapConvert(callbacks, payload.details);\r\n                break;\r\n              case emp3.api.enums.channel.mapShutdown:\r\n                this.handleMapShutdownTransactionComplete(callbacks);\r\n                break;\r\n              case emp3.api.enums.channel.getVisibility:\r\n                this.handleGetVisibilityTransactionComplete(callbacks, payload.details, failures);\r\n                break;\r\n              case emp3.api.enums.channel.setVisibility:\r\n                try {\r\n                  callbacks.onSuccess({\r\n                    failures: failures\r\n                  });\r\n                }\r\n                catch (e) {\r\n                  console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n                }\r\n                break;\r\n              default:\r\n                try {\r\n                  callbacks.onSuccess();\r\n                }\r\n                catch (e) {\r\n                  console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n                }\r\n\r\n                break;\r\n            }\r\n          }\r\n          else {\r\n            // if there is no origin channel, then this is a map instantiation.  This\r\n            // is not a normal message.  It will come with no origin channel.  This occurs\r\n            // when the map is created and the map needs an id to complete its instantiation.\r\n            // The map receives its id from the map core.  A request is made to the map using\r\n            // environment.createInstance, and we expect a transaction response in return.\r\n            try {\r\n              callbacks.onSuccess({\r\n                id: sender.id\r\n              });\r\n            }\r\n            catch (e) {\r\n              console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     Handles the error messages from a CMAPI map.\r\n\r\n     @param {string} sender - the widget instance id of the map sending the error response.\r\n     @param {object} msg - the message payload of the error.\r\n     */\r\n    this.handleError = function(sender, msg) {\r\n\r\n      var payload,\r\n        transactionId,\r\n        callbacks,\r\n        i;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n\r\n        // get message id from response.\r\n\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        if ((payload.sender !== undefined && payload.sender !== null) &&\r\n          (payload.type !== undefined && payload.type !== null) &&\r\n          (payload.msg !== undefined && payload.msg !== null)) {\r\n\r\n          // If the payload is not meant for this message handler\r\n          // then exit out immediately.\r\n          if (payload.sender !== environment.sender.id) {\r\n            return;\r\n          }\r\n\r\n          //var type = payload.type;\r\n\r\n          if (Array.isArray(payload.msg)) {\r\n            for (i = 0; i < payload.msg.length; i += 1) {\r\n              if (payload.msg[i].transactionId !== undefined && payload.msg[i].transactionId !== null) {\r\n                transactionId = payload.msg[i].transactionId;\r\n\r\n                // find message id in lookup table.\r\n                callbacks = this.messageCallbackHash.getItem(transactionId);\r\n\r\n                // Check to make sure a callback has been found.\r\n                if (callbacks !== undefined && callbacks !== null) {\r\n\r\n                  // Remove transactionId from hash.\r\n                  this.messageCallbackHash.removeItem(transactionId);\r\n\r\n                  //call the error function associated with that lookup id\r\n                  //format the data based on the type of message.\r\n                  callbacks.onError({\r\n                    callInfo: callbacks.callInfo,\r\n                    source: callbacks.source,\r\n                    args: callbacks.args,\r\n                    errorMessage: payload.error\r\n                  });\r\n                }\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            // get the message id, type of message.\r\n            if (payload.msg.transactionId !== undefined && payload.msg.transactionId !== null) {\r\n              transactionId = payload.msg.transactionId;\r\n\r\n              // find message id in lookup table.\r\n              callbacks = this.messageCallbackHash.getItem(transactionId);\r\n\r\n              // Check to make sure a callback has been found.\r\n              if (callbacks !== undefined && callbacks !== null) {\r\n\r\n                //call the error function associated with that lookup id\r\n                //format the data based on the type of message.\r\n                callbacks.onError({\r\n                  callInfo: callbacks.callInfo,\r\n                  source: callbacks.source,\r\n                  args: callbacks.args,\r\n                  errorMessage: payload.error\r\n                });\r\n\r\n                // Remove transactionId from hash.\r\n                this.messageCallbackHash.removeItem(transactionId);\r\n              }\r\n            }\r\n          }\r\n\r\n          // Report the error for debugging tools.\r\n          if (window.hasOwnProperty(\"console\")) {\r\n            console.error(payload.error);\r\n            console.info(msg); // eslint-disable-line no-console\r\n          }\r\n\r\n        }\r\n        else {\r\n          throw new Error(missingParameterError);\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    /**\r\n     Receives a message when a request has been made to get the current\r\n     bounds of the map.\r\n     */\r\n    this.handleStatusView = function(sender, msg) {\r\n      var payload,\r\n        map,\r\n        camera,\r\n        lookAt,\r\n        mapViewCallbacks,\r\n        cameraCallbacks,\r\n        lookAtCallbacks,\r\n        executeCallbacks,\r\n        cameraEvent,\r\n        lookAtEvent,\r\n        mapViewEvent,\r\n        extent;\r\n\r\n      if (sender && sender.id) {\r\n        // Retrieve the payload\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n        // Retrieve the map.  We will need to set it's extent.\r\n        // A call from the map means the extent change.  Updating\r\n        // the map will allow developers to have latest extent\r\n        map = mapHash.getItem(sender.id);\r\n        extent = {\r\n          north: payload.bounds.northEast.lat,\r\n          west: payload.bounds.southWest.lon,\r\n          south: payload.bounds.southWest.lat,\r\n          east: payload.bounds.northEast.lon,\r\n          range: payload.range,\r\n          altitude: payload.altitude,\r\n          scale: payload.scale,\r\n          centerLat: payload.center.lat,\r\n          centerLon: payload.center.lon,\r\n          roll: payload.roll,\r\n          heading: payload.heading,\r\n          tilt: payload.tilt\r\n        };\r\n        if (map) {\r\n          //Set the new map extents\r\n          map.bounds = extent;\r\n\r\n          camera = map.getCamera();\r\n          if (!camera) {\r\n            camera = new emp3.api.Camera();\r\n            emp3.api.CameraManager.setCameraForMap({\r\n              camera: camera,\r\n              map: map\r\n            });\r\n          }\r\n          camera.latitude = extent.centerLat;\r\n          camera.longitude = extent.centerLon;\r\n          camera.altitude = extent.altitude;\r\n          camera.roll = extent.roll;\r\n          camera.tilt = extent.tilt;\r\n          camera.heading = extent.heading;\r\n\r\n          lookAt = map.getLookAt();\r\n          if (!lookAt) {\r\n            lookAt = new emp3.api.LookAt();\r\n            emp3.api.LookAtManager.setLookAtForMap({\r\n              lookAt: lookAt,\r\n              map: map\r\n            });\r\n          }\r\n\r\n          lookAt.latitude = payload.lookAt.latitude;\r\n          lookAt.longitude = payload.lookAt.longitude;\r\n          lookAt.altitude = payload.lookAt.altitude;\r\n          lookAt.range = payload.lookAt.range;\r\n          lookAt.tilt = payload.lookAt.tilt;\r\n          lookAt.heading = payload.lookAt.heading;\r\n          lookAt.altitudeMode = cmapi.enums.altitudeMode.CLAMP_TO_GROUND;\r\n        }\r\n        // Send out the extent changed event if needed.\r\n        // Make sure this is coming from map--from somebody.  We'll then\r\n        // check if there is callbacks associated with it.  If there are\r\n        // callbacks, then call them at this point.  There is a try catch\r\n        // block around callbacks in case the callback has an error.  If an\r\n        // error occurred, the rest of the callbacks would not fire.\r\n        if (this.eventListeners[sender.id]) {\r\n          executeCallbacks = function(args) {\r\n            for (var i = 0; i < args.callbacksArray.length; i += 1) {\r\n              try {\r\n                args.callbacksArray[i](args.event);\r\n              }\r\n              catch (e) {\r\n                console.error(\"Event callback generated an exception. \" + e.message);\r\n              }\r\n            }\r\n          };\r\n          // get the camera with extent values previously assigned to the map\r\n          camera = map.getCamera();\r\n          cameraEvent = new emp3.api.events.CameraEvent({\r\n            event: payload.animate !== 0 ? emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION : emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED,\r\n            target: camera\r\n          });\r\n          // if this is our first time the extent was set, make the old extent the same\r\n          // as the new.\r\n          //              if (latestExtent) {\r\n          //TODO:  This is wrong, latestExtent picks up from all maps, will have map extents from\r\n          //multiple maps in this.\r\n          //                latestExtent.oldExtent = latestExtent.extent;\r\n          //                latestExtent.extent = extent;\r\n          //              } else {\r\n          mapViewEvent = new emp3.api.events.MapViewChangeEvent({\r\n            event: payload.animate || emp3.api.enums.MapViewEventEnum.VIEW_MOTION_STOPPED,\r\n            target: map\r\n          });\r\n          //              }\r\n          mapViewCallbacks = this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_VIEW_CHANGE];\r\n          cameraCallbacks = this.eventListeners[sender.id][emp3.api.enums.EventType.CAMERA_EVENT];\r\n          if (mapViewCallbacks) {\r\n            try {\r\n              executeCallbacks({\r\n                callbacksArray: mapViewCallbacks,\r\n                event: mapViewEvent\r\n              });\r\n            }\r\n            catch (e) {\r\n              console.error(\"Event callback generated an exception. \" + e.message);\r\n            }\r\n          }\r\n          if (cameraCallbacks) {\r\n            try {\r\n              executeCallbacks({\r\n                callbacksArray: cameraCallbacks,\r\n                event: cameraEvent\r\n              });\r\n            }\r\n            catch (e) {\r\n              console.error(\"Event callback generated an exception. \" + e.message);\r\n            }\r\n          }\r\n          if (lookAtCallbacks) {\r\n            try {\r\n              executeCallbacks({\r\n                callbacksArray: lookAtCallbacks,\r\n                event: lookAtEvent\r\n              });\r\n            }\r\n            catch (e) {\r\n              console.error(\"Event callback generated an exception. \" + e.message);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.handleStatusAboutResponse = function(sender, msg) {\r\n      var payload,\r\n        callbacks;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        while (this.statusRequestPendingList.about.length > 0) {\r\n          callbacks = this.statusRequestPendingList.about[0];\r\n          // Send the about information back to the user.\r\n          if (callbacks !== undefined && callbacks !== null) {\r\n            if (typeof callbacks.onSuccess === \"function\") {\r\n              try {\r\n                callbacks.onSuccess(payload);\r\n              }\r\n              catch (e) {\r\n                console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n              }\r\n            }\r\n          }\r\n          this.statusRequestPendingList.about.splice(0, 1);\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    this.handleStatusFormatResponse = function(sender, msg) {\r\n      var payload,\r\n        callbacks;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        while (this.statusRequestPendingList.format.length > 0) {\r\n          callbacks = this.statusRequestPendingList.format[0];\r\n          // Send the about information back to the user.\r\n          if (callbacks !== undefined && callbacks !== null) {\r\n            if (typeof callbacks.onSuccess === \"function\") {\r\n              try {\r\n                callbacks.onSuccess(payload);\r\n              }\r\n              catch (e) {\r\n                console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n              }\r\n            }\r\n          }\r\n\r\n          this.statusRequestPendingList.format.splice(0, 1);\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    this.handleStatusScreenshot = function(sender, msg) {\r\n      var payload,\r\n        callbacks;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        if (this.statusRequestPendingList.screenshot.length > 0) {\r\n          callbacks = this.statusRequestPendingList.screenshot[0];\r\n\r\n          if (callbacks !== undefined && callbacks !== null) {\r\n            if (typeof callbacks.onSuccess === \"function\") {\r\n              try {\r\n                callbacks.onSuccess({\r\n                  dataUrl: payload.dataUrl\r\n                });\r\n              }\r\n              catch (e) {\r\n                console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n              }\r\n            }\r\n          }\r\n          this.statusRequestPendingList.screenshot.splice(0, 1);\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    /**\r\n     Receives a message from the overlays status channel which occurs after an overlays\r\n     request is made.\r\n     */\r\n    this.handleOverlaysStatus = function(sender, msg) {\r\n\r\n      var payload,\r\n        transactionId,\r\n        map,\r\n        overlays,\r\n        overlayArray,\r\n        callbacks;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        if (payload.overlays !== undefined && payload.overlay !== null) {\r\n          overlays = payload.overlays;\r\n        }\r\n\r\n        // get the message id if available.\r\n        if (payload.messageId !== undefined && payload.messageId !== null) {\r\n\r\n          transactionId = payload.messageId;\r\n\r\n          // find message id in lookup table.\r\n          callbacks = this.messageCallbackHash.getItem(transactionId);\r\n\r\n          // Check to make sure a callback has been found.\r\n          if (callbacks !== undefined && callbacks !== null) {\r\n\r\n            map = callbacks.source;\r\n            map.overlays = {};\r\n            overlayArray = [];\r\n\r\n            overlayArray = this.buildOverlayArray(overlays, overlayArray, map);\r\n\r\n            try {\r\n              callbacks.onSuccess({\r\n                overlays: overlayArray\r\n              });\r\n            }\r\n            catch (e) {\r\n              console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n            }\r\n\r\n            // Remove transactionId from hash.\r\n            this.messageCallbackHash.removeItem(transactionId);\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Helper method for handleOverlaysStatus, recursively retrieves all\r\n     * overlays and child overlays\r\n     * @returns {Array} overlayArray\r\n     */\r\n    this.buildOverlayArray = function(overlays, overlayArray, map) {\r\n      var overlayId,\r\n        obj,\r\n        overlay;\r\n      for (overlayId in overlays) {\r\n        if (overlays.hasOwnProperty(overlayId)) {\r\n          overlay = overlays[overlayId];\r\n\r\n          obj = new emp3.api.Overlay({\r\n            id: overlay.id,\r\n            name: overlay.name,\r\n            parentId: overlay.parentId,\r\n            owner: overlay.owner,\r\n            description: overlay.description,\r\n            iconUrl: overlay.iconUrl,\r\n            isVisible: overlay.visible,\r\n            permissions: {\r\n              readonly: overlay.readonly\r\n            },\r\n            map: map\r\n          });\r\n\r\n          map.overlays[overlay.id] = obj;\r\n          overlayArray.push(obj);\r\n\r\n          if (overlay.children) {\r\n            overlayArray = this.buildOverlayArray(overlay.children, overlayArray, map);\r\n          }\r\n        }\r\n      }\r\n      return overlayArray;\r\n    };\r\n\r\n    /**\r\n     Receives a message from the overlay status channel which occurs after a single overlay\r\n     request is made.\r\n     */\r\n    this.handleOverlayStatus = function(sender, msg) {\r\n\r\n      var payload,\r\n        transactionId,\r\n        map,\r\n        overlay,\r\n        callbacks;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        // get the message id if available.\r\n        if (payload.messageId !== undefined && payload.messageId !== null) {\r\n\r\n          transactionId = payload.messageId;\r\n\r\n          // find message id in lookup table.\r\n          callbacks = this.messageCallbackHash.getItem(transactionId);\r\n\r\n          // Check to make sure a callback has been found.\r\n          if (callbacks !== undefined && callbacks !== null) {\r\n\r\n            map = callbacks.source;\r\n            overlay = new emp3.api.Overlay({\r\n              id: payload.id,\r\n              name: payload.name,\r\n              owner: payload.owner,\r\n              isVisible: payload.isVisible,\r\n              permissions: {\r\n                readonly: payload.readonly\r\n              },\r\n              map: map\r\n            });\r\n\r\n            overlay.parentId = payload.parentId;\r\n\r\n            //map.overlays[overlay.id] = overlay;\r\n            try {\r\n              callbacks.onSuccess({\r\n                overlay: overlay\r\n              });\r\n            }\r\n            catch (e) {\r\n              console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n            }\r\n\r\n            // Remove transactionId from hash.\r\n            this.messageCallbackHash.removeItem(transactionId);\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    /**\r\n     Called when message handler intercepts a message over\r\n     the map.status.selected channel. If msg has a message id, this function\r\n     will fetch the proper callback and invoke the onSuccess(args) function\r\n     associated with the corresponding method that is using the\r\n     map.status.selected channel.\r\n\r\n     @private\r\n     @param {string} sender - object containing information about the ozone\r\n     widget that sent the message.\r\n     @param {object} msg - object containing the payload sent over\r\n     the map.status.selected channel\r\n     **/\r\n    this.handleStatusSelected = function(sender, msg) {\r\n\r\n      var callbacks;\r\n      var args;\r\n      var selectedFeature;\r\n      var payload;\r\n      var i;\r\n      var transactionId;\r\n      var feature;\r\n\r\n      // First make sure there is a payload\r\n      if (msg) {\r\n\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        if (payload) {\r\n\r\n          // find message id in lookup table.\r\n          transactionId = payload.messageId;\r\n          callbacks = this.messageCallbackHash.getItem(transactionId);\r\n\r\n          // Check to make sure a callback has been found.  If none\r\n          // is found, this widget probably did not make the call so\r\n          // skip returning anything.\r\n          if (callbacks) {\r\n            // Use callbacks only if it exists.\r\n            args = {\r\n              failures: payload.failures\r\n            };\r\n\r\n            switch (callbacks.callInfo.method) {\r\n              case \"Map.getSelected\":\r\n\r\n                args.features = [];\r\n\r\n                for (i = 0; i < payload.selectedFeatures.length; i++) {\r\n                  selectedFeature = payload.selectedFeatures[i];\r\n\r\n                  feature = emp3.api.buildFeature({\r\n                    type: selectedFeature.properties.featureType,\r\n                    geoId: selectedFeature.featureId,\r\n                    name: selectedFeature.name,\r\n                    coordinates: emp3.api.convertLocationArrayToCMAPI(selectedFeature.feature.coordinates),\r\n                    properties: selectedFeature.properties\r\n                  });\r\n\r\n                  args.features.push(feature);\r\n                }\r\n                break;\r\n            }\r\n\r\n            if (typeof callbacks.onSuccess === \"function\") {\r\n              // Make sure the onSuccess exists.\r\n              try {\r\n                callbacks.onSuccess(args);\r\n              }\r\n              catch (e) {\r\n                console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Cancel handler used to execute drawCancel/editCancel callback(s).\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {object} message - The object containing the payload sent over\r\n     * the map.message.complete channel.\r\n     * @return {object} Object containing map and feature information.\r\n     */\r\n    this.handleCancel = function(sender, message) {\r\n      var messageId,\r\n        callbacks,\r\n        args = {};\r\n\r\n      // retrieve the messageId associated with the cancel.\r\n      messageId = message.messageId;\r\n      // retrieve the callbacks associated with the original\r\n      // Map.drawFeature/Map.editFeature call.\r\n      callbacks = this.messageCallbackHash.getItem(messageId);\r\n      args.map = mapHash.getItem(sender.id);\r\n      if (callbacks) {\r\n        args.feature = callbacks.data.feature;\r\n        // If callbacks are defined for this message we must call it.\r\n        if (callbacks.cancelCallback) {\r\n          callbacks.cancelCallback(args);\r\n        }\r\n      }\r\n      return args;\r\n    };\r\n\r\n    /**\r\n     * Draw handler used to call the start, update, or complete operations.\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {object} message - The object containing the payload sent over\r\n     * the map.message.progress channel.\r\n     * @param {string} messageId - The transaction id related to the message.\r\n     */\r\n    this.handleDraw = function(sender, message, messageId) {\r\n      var eventArgs,\r\n        event,\r\n        i,\r\n        drawEventCallbacks;\r\n\r\n      if (message && message.status && sender && sender.id) {\r\n        // Get any draw event callbacks that are registered\r\n        drawEventCallbacks = this.eventListeners[sender.id] ? this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_DRAW] : null;\r\n        switch (message.status) {\r\n          case emp3.api.enums.FeatureDrawEventEnum.DRAW_START:\r\n            eventArgs = this.handleStart(sender, message, messageId);\r\n            if (drawEventCallbacks) {\r\n              event = new emp3.api.events.FeatureDrawEvent({\r\n                event: emp3.api.enums.FeatureDrawEventEnum.DRAW_START,\r\n                target: eventArgs.feature,\r\n                map: eventArgs.map\r\n              });\r\n              for (i = 0; i < drawEventCallbacks.length; i += 1) {\r\n                try {\r\n                  drawEventCallbacks[i](event);\r\n                }\r\n                catch (e) {\r\n                  console.error(\"Event callback generated an exception. \" + e.message);\r\n                }\r\n              }\r\n            }\r\n            break;\r\n          case emp3.api.enums.FeatureDrawEventEnum.DRAW_UPDATE:\r\n            eventArgs = this.handleUpdate(sender, message, messageId);\r\n            if (drawEventCallbacks) {\r\n              event = new emp3.api.events.FeatureDrawEvent({\r\n                event: emp3.api.enums.FeatureDrawEventEnum.DRAW_UPDATE,\r\n                target: eventArgs.feature,\r\n                map: eventArgs.map,\r\n                updateList: eventArgs.updateList\r\n              });\r\n              for (i = 0; i < drawEventCallbacks.length; i += 1) {\r\n                try {\r\n                  drawEventCallbacks[i](event);\r\n                }\r\n                catch (e) {\r\n                  console.error(\"Event callback generated an exception. \" + e.message);\r\n                }\r\n              }\r\n            }\r\n            break;\r\n          case emp3.api.enums.FeatureDrawEventEnum.DRAW_COMPLETE:\r\n            eventArgs = this.handleComplete(sender, message, messageId);\r\n            if (drawEventCallbacks) {\r\n              event = new emp3.api.events.FeatureDrawEvent({\r\n                event: emp3.api.enums.FeatureDrawEventEnum.DRAW_COMPLETE,\r\n                target: eventArgs.feature,\r\n                map: eventArgs.map\r\n              });\r\n              for (i = 0; i < drawEventCallbacks.length; i += 1) {\r\n                try {\r\n                  drawEventCallbacks[i](event);\r\n                }\r\n                catch (e) {\r\n                  console.error(\"Event callback generated an exception. \" + e.message);\r\n                }\r\n              }\r\n            }\r\n            break;\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Start handler used to execute drawStart/editStart callback(s).\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {object} message - The object containing the payload sent over\r\n     * the map.message.progress channel.\r\n     * @param {string} messageId - The transaction id related to the message.\r\n     * @return {object} Object containing map and feature information.\r\n     */\r\n    this.handleStart = function(sender, message, messageId) {\r\n      var callbacks,\r\n        args = {};\r\n\r\n      // retrieve the callbacks associated with the original\r\n      // Map.drawFeature/Map.editFeature call.\r\n      callbacks = this.messageCallbackHash.getItem(messageId);\r\n      args.map = mapHash.getItem(sender.id);\r\n      // make sure message.properties.featureType is defined -- if not we\r\n      // won't know what to build.\r\n      if (message.properties && message.properties.featureType && message.feature) {\r\n        args.feature = emp3.api.buildFeature({\r\n          type: message.properties.featureType,\r\n          geoId: message.featureId,\r\n          name: message.name,\r\n          coordinates: emp3.api.convertGeoJsonToCMAPIPositions(message.feature),\r\n          properties: message.properties\r\n        });\r\n      }\r\n      if (callbacks) {\r\n        // If callbacks are defined for this message we must call it.\r\n        if (callbacks.startCallback) {\r\n          callbacks.startCallback(args);\r\n        }\r\n      }\r\n      return args;\r\n    };\r\n\r\n    /**\r\n     * Update handler used to execute drawUpdate/editUpdate callback(s).\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {object} message - The object containing the payload sent over\r\n     * the map.message.progress channel.\r\n     * @param {string} messageId - The transaction id related to the message.\r\n     * @return {object} Object containing map and feature information.\r\n     */\r\n    this.handleUpdate = function(sender, message, messageId) {\r\n      var callbacks,\r\n        args = {};\r\n\r\n      // retrieve the callbacks associated with the original\r\n      // Map.drawFeature/Map.editFeature call.\r\n      callbacks = this.messageCallbackHash.getItem(messageId);\r\n      args.map = mapHash.getItem(sender.id);\r\n      // the update callback sends back 3 args, map,\r\n      // the new feature, and updates object.\r\n      // create the updated feature.\r\n      args.updateList = [];\r\n      if (message.updates) {\r\n        // make sure message.properties.featureType is defined -- if not we\r\n        // won't know what to build.\r\n        if (message.properties && message.properties.featureType) {\r\n          args.feature = emp3.api.buildFeature({\r\n            type: message.properties.featureType,\r\n            geoId: message.featureId,\r\n            name: message.name,\r\n            coordinates: emp3.api.convertLocationArrayToCMAPI(message.updates.coordinates),\r\n            properties: message.properties\r\n          });\r\n        }\r\n        args.updateList.push({\r\n          changedAttribute: undefined,\r\n          changedModifier: undefined,\r\n          coordinateIndexes: message.updates.indices,\r\n          updateType: message.updates.type\r\n        });\r\n      }\r\n      if (callbacks) {\r\n        // If callbacks are defined for this message we must call it.\r\n        if (callbacks.updateCallback) {\r\n          callbacks.updateCallback(args);\r\n        }\r\n      }\r\n      return args;\r\n    };\r\n\r\n    /**\r\n     * Complete handler used to execute drawComplete/editComplete callback(s).\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {object} message - The object containing the payload sent over\r\n     * the map.message.progress channel.\r\n     * @param {string} messageId - The transaction id related to the message.\r\n     * @return {object} Object containing map and feature information.\r\n     */\r\n    this.handleComplete = function(sender, message, messageId) {\r\n      var callbacks,\r\n        args = {};\r\n\r\n      // retrieve the callbacks associated with the original\r\n      // Map.drawFeature/Map.editFeature call.\r\n      callbacks = this.messageCallbackHash.getItem(messageId);\r\n      args.map = mapHash.getItem(sender.id);\r\n      // make sure message.properties.featureType is defined -- if not we\r\n      // won't know what to build.\r\n      if (message.updates && message.properties && message.properties.featureType) {\r\n        args.feature = emp3.api.buildFeature({\r\n          type: message.properties.featureType,\r\n          geoId: message.featureId,\r\n          name: message.name,\r\n          coordinates: emp3.api.convertLocationArrayToCMAPI(message.updates.coordinates),\r\n          properties: message.properties\r\n        });\r\n      }\r\n      if (callbacks) {\r\n        // If callbacks are defined for this message we must call it.\r\n        if (callbacks.completeCallback) {\r\n          callbacks.completeCallback(args);\r\n        }\r\n      }\r\n      return args;\r\n    };\r\n\r\n    /**\r\n     * Edit handler used to call the start, update, or complete operations.\r\n     *\r\n     * @private\r\n     * @param {object} sender - Contains information about the widget that sent the message.\r\n     * @param {object} message - The object containing the payload sent over\r\n     * the map.message.progress channel.\r\n     * @param {string} messageId - The transaction id related to the message.\r\n     */\r\n    this.handleEdit = function(sender, message, messageId) {\r\n      var eventArgs,\r\n        event,\r\n        i,\r\n        editEventCallbacks;\r\n\r\n      if (message && message.status && sender && sender.id) {\r\n        // Get any edit event callbacks that are registered\r\n        editEventCallbacks = this.eventListeners[sender.id] ? this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_EDIT] : null;\r\n        switch (message.status) {\r\n          case emp3.api.enums.FeatureEditEventEnum.EDIT_START:\r\n            eventArgs = this.handleStart(sender, message, messageId);\r\n            if (editEventCallbacks) {\r\n              event = new emp3.api.events.FeatureEditEvent({\r\n                event: emp3.api.enums.FeatureEditEventEnum.EDIT_START,\r\n                target: eventArgs.feature,\r\n                map: eventArgs.map\r\n              });\r\n              for (i = 0; i < editEventCallbacks.length; i += 1) {\r\n                try {\r\n                  editEventCallbacks[i](event);\r\n                }\r\n                catch (e) {\r\n                  console.error(\"Event callback generated an exception. \" + e.message);\r\n                }\r\n              }\r\n            }\r\n            break;\r\n          case emp3.api.enums.FeatureEditEventEnum.EDIT_UPDATE:\r\n            eventArgs = this.handleUpdate(sender, message, messageId);\r\n            if (editEventCallbacks) {\r\n              event = new emp3.api.events.FeatureEditEvent({\r\n                event: emp3.api.enums.FeatureEditEventEnum.EDIT_UPDATE,\r\n                target: eventArgs.feature,\r\n                map: eventArgs.map,\r\n                updateList: eventArgs.updateList\r\n              });\r\n              for (i = 0; i < editEventCallbacks.length; i += 1) {\r\n                try {\r\n                  editEventCallbacks[i](event);\r\n                }\r\n                catch (e) {\r\n                  console.error(\"Event callback generated an exception. \" + e.message);\r\n                }\r\n              }\r\n            }\r\n            break;\r\n          case emp3.api.enums.FeatureEditEventEnum.EDIT_COMPLETE:\r\n            eventArgs = this.handleComplete(sender, message, messageId);\r\n            if (editEventCallbacks) {\r\n              event = new emp3.api.events.FeatureEditEvent({\r\n                event: emp3.api.enums.FeatureEditEventEnum.EDIT_COMPLETE,\r\n                target: eventArgs.feature,\r\n                map: eventArgs.map\r\n              });\r\n              for (i = 0; i < editEventCallbacks.length; i += 1) {\r\n                try {\r\n                  editEventCallbacks[i](event);\r\n                }\r\n                catch (e) {\r\n                  console.error(\"Event callback generated an exception. \" + e.message);\r\n                }\r\n              }\r\n            }\r\n            break;\r\n        }\r\n      }\r\n    };\r\n\r\n    this.handleMapCursorMove = function(sender, msg) {\r\n      var callbacks,\r\n          payload,\r\n          mapCursorMoveEvent = {},\r\n          keys = [],\r\n          i;\r\n\r\n      if (sender.id && this.eventListeners[sender.id]) {\r\n        callbacks = this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_CURSOR_MOVE];\r\n        // If we have any callbacks to call loop through them\r\n        // and call them.\r\n        if (callbacks) {\r\n          // make sure there is a payload\r\n          if (msg !== undefined && msg !== null) {\r\n            // make sure the the payload is an object.\r\n            payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n            mapCursorMoveEvent.type = emp3.api.enums.EventType.MAP_CURSOR_MOVE;\r\n            mapCursorMoveEvent.event = emp3.api.enums.UserInteractionEventEnum.MOUSE_MOVE;\r\n            mapCursorMoveEvent.target = mapHash.getItem(sender.id);\r\n            mapCursorMoveEvent.point = {\r\n              x: payload.clientX,\r\n              y: payload.clientY\r\n            };\r\n            mapCursorMoveEvent.position = {\r\n              latitude: payload.latitude,\r\n              longitude: payload.longitude,\r\n              altitude: payload.altitude\r\n            };\r\n            for (i in payload.keys) {\r\n              switch (payload.keys[i]) {\r\n                case \"ctrl\":\r\n                  keys.push(emp3.api.enums.UserInteractionKeyEventEnum.CTRL);\r\n                  break;\r\n                case \"shift\":\r\n                  keys.push(emp3.api.enums.UserInteractionKeyEventEnum.SHIFT);\r\n                  break;\r\n                case \"alt\":\r\n                  keys.push(emp3.api.enums.UserInteractionKeyEventEnum.ALT);\r\n                  break;\r\n              }\r\n            }\r\n            mapCursorMoveEvent.keys = keys;\r\n            // There is no button used during a mouse move. The value passed back is \"mousemove\"\r\n            // This value does not correspond to a mouse button value.\r\n            for (i = 0; i < callbacks.length; i += 1) {\r\n              try {\r\n                // Instead of instantiating an object of the emp3.api.events.MapCursorMoveEvent\r\n                // class type, a generic object with relevant information is passed back to the client\r\n                callbacks[i](mapCursorMoveEvent);\r\n              }\r\n              catch (e) {\r\n                console.error(\"Event callback generated an exception. \" + e.message);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.handleMapClick = function(sender, msg) {\r\n      var keys,\r\n        clickType,\r\n        event,\r\n        payload,\r\n        callbacks,\r\n        i;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n        keys = [];\r\n        for (i in payload.keys) {\r\n          switch (payload.keys[i]) {\r\n            case \"ctrl\":\r\n              keys.push(emp3.api.enums.UserInteractionKeyEventEnum.CTRL);\r\n              break;\r\n            case \"shift\":\r\n              keys.push(emp3.api.enums.UserInteractionKeyEventEnum.SHIFT);\r\n              break;\r\n            case \"alt\":\r\n              keys.push(emp3.api.enums.UserInteractionKeyEventEnum.ALT);\r\n              break;\r\n          }\r\n        }\r\n        switch (payload.type) {\r\n          case \"single\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.CLICKED;\r\n            break;\r\n          case \"double\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.DOUBLE_CLICKED;\r\n            break;\r\n          case \"mouseDown\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.MOUSE_DOWN;\r\n            break;\r\n          case \"mouseUp\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.MOUSE_UP;\r\n            break;\r\n          case \"drag\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.DRAG;\r\n            break;\r\n          case \"dragComplete\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.DRAG_COMPLETE;\r\n            break;\r\n          default:\r\n            clickType = payload.type;\r\n            break;\r\n        }\r\n        switch (payload.button) {\r\n          case \"left\":\r\n            payload.button = emp3.api.enums.UserInteractionMouseButtonEventEnum.LEFT;\r\n            break;\r\n          case \"right\":\r\n            payload.button = emp3.api.enums.UserInteractionMouseButtonEventEnum.RIGHT;\r\n            break;\r\n          case \"middle\":\r\n            payload.button = emp3.api.enums.UserInteractionMouseButtonEventEnum.MIDDLE;\r\n            break;\r\n          default:\r\n          // do nothing\r\n        }\r\n        if (sender.id && this.eventListeners[sender.id]) {\r\n          callbacks = this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_INTERACTION];\r\n          event = new emp3.api.events.MapUserInteractionEvent({\r\n            event: clickType,\r\n            target: mapHash.getItem(sender.id),\r\n            point: {\r\n              x: payload.clientX,\r\n              y: payload.clientY\r\n            },\r\n            position: new emp3.api.GeoPosition({\r\n              latitude: payload.lat,\r\n              longitude: payload.lon,\r\n              altitude: payload.alt\r\n            }),\r\n            button: payload.button,\r\n            keys: keys\r\n          });\r\n          // If we have any callbacks to call loop through them and call them.\r\n          if (callbacks) {\r\n            for (i = 0; i < callbacks.length; i += 1) {\r\n              try {\r\n                callbacks[i](event);\r\n              }\r\n              catch (e) {\r\n                console.error(\"Event callback generated an exception. \" + e.message);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    this.handleFeatureClick = function(sender, msg) {\r\n      var event,\r\n        keys,\r\n        clickType,\r\n        payload,\r\n        features = [],\r\n        feature,\r\n        callbacks,\r\n        i;\r\n\r\n      // First make sure there is a payload\r\n      if (msg !== undefined && msg !== null) {\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n        keys = [];\r\n        for (i in payload.keys) {\r\n          switch (payload.keys[i]) {\r\n            case \"ctrl\":\r\n              keys.push(emp3.api.enums.UserInteractionKeyEventEnum.CTRL);\r\n              break;\r\n            case \"shift\":\r\n              keys.push(emp3.api.enums.UserInteractionKeyEventEnum.SHIFT);\r\n              break;\r\n            case \"alt\":\r\n              keys.push(emp3.api.enums.UserInteractionKeyEventEnum.ALT);\r\n              break;\r\n          }\r\n        }\r\n        switch (payload.type) {\r\n          case \"single\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.CLICKED;\r\n            break;\r\n          case \"double\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.DOUBLE_CLICKED;\r\n            break;\r\n          case \"mouseDown\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.MOUSE_DOWN;\r\n            break;\r\n          case \"mouseUp\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.MOUSE_UP;\r\n            break;\r\n          case \"drag\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.DRAG;\r\n            break;\r\n          case \"dragComplete\":\r\n            clickType = emp3.api.enums.UserInteractionEventEnum.DRAG_COMPLETE;\r\n            break;\r\n          default:\r\n            clickType = payload.type;\r\n            break;\r\n        }\r\n        switch (payload.button) {\r\n          case \"left\":\r\n            payload.button = emp3.api.enums.UserInteractionMouseButtonEventEnum.LEFT;\r\n            break;\r\n          case \"right\":\r\n            payload.button = emp3.api.enums.UserInteractionMouseButtonEventEnum.RIGHT;\r\n            break;\r\n          case \"middle\":\r\n            payload.button = emp3.api.enums.UserInteractionMouseButtonEventEnum.MIDDLE;\r\n            break;\r\n          default:\r\n            payload.button = payload.button;\r\n            break;\r\n        }\r\n        // If there is an event listener for this feature find the feature callbacks\r\n        // and call them.\r\n        if (sender.id && this.eventListeners[sender.id]) {\r\n          callbacks = this.eventListeners[sender.id][emp3.api.enums.EventType.FEATURE_INTERACTION];\r\n          // If there are callbacks to call, create the feature click\r\n          // event; otherwise, don't bother.\r\n          if (callbacks) {\r\n            // check to make sure we are not getting an array back.\r\n            if (Object.prototype.toString.call(payload) === \"[object Array]\") {\r\n              for (i = 0; i < payload.length; i += 1) {\r\n\r\n                feature = emp3.api.buildFeature({\r\n                  type: payload[i].format,\r\n                  geoId: payload[i].featureId,\r\n                  name: payload[i].name,\r\n                  coordinates: emp3.api.convertGeoJsonToCMAPIPositions(payload[i].feature),\r\n                  properties: payload[i].properties,\r\n                  symbolCode: payload[i].feature.symbolCode\r\n                });\r\n\r\n                features.push(feature);\r\n              }\r\n            }\r\n            else {\r\n              feature = emp3.api.buildFeature({\r\n                type: payload.format,\r\n                geoId: payload.featureId,\r\n                name: payload.name,\r\n                coordinates: emp3.api.convertGeoJsonToCMAPIPositions(payload.feature),\r\n                properties: payload.properties,\r\n                symbolCode: payload.feature.symbolCode\r\n              });\r\n\r\n              features.push(feature);\r\n            }\r\n\r\n            event = new emp3.api.events.FeatureUserInteractionEvent({\r\n              event: clickType,\r\n              target: features,\r\n              point: {\r\n                x: payload.clientX,\r\n                y: payload.clientY\r\n              },\r\n              position: new emp3.api.GeoPosition({\r\n                latitude: payload.lat,\r\n                longitude: payload.lon,\r\n                altitude: payload.alt\r\n              }),\r\n              map: mapHash.getItem(sender.id),\r\n              button: payload.button,\r\n              keys: keys\r\n            });\r\n            for (i = 0; i < callbacks.length; i += 1) {\r\n              try {\r\n                callbacks[i](event);\r\n              }\r\n              catch (e) {\r\n                console.error(\"Event callback generated an exception. \" + e.message);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        throw new Error(missingMessageError);\r\n      }\r\n    };\r\n\r\n    this.handleConvertResponse = function(sender, msg) {\r\n      var callbacks;\r\n\r\n      // First make sure there is a payload\r\n      if (msg) {\r\n        var payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        // find message id in lookup table.\r\n        callbacks = this.messageCallbackHash.getItem(msg.messageId);\r\n\r\n        // Check to make sure a callback has been found.\r\n        if (callbacks) {\r\n\r\n          try {\r\n            callbacks.onSuccess({\r\n              x: payload.x,\r\n              y: payload.y\r\n            });\r\n          }\r\n          catch (e) {\r\n            console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.handleDrawEditTransactionComplete = function(callbacks, payload, failures) {\r\n      // The only time we should get here on a transaction complete for an edit\r\n      // or draw, is if this is an error or cancel.  There is no onSuccess for edits\r\n      // or draws.\r\n      // If we get a transaction complete, but there is a failure;\r\n      // Check the failure.  If there is only one and the level is 0,\r\n      // It was an actual cancel that occurred\r\n      if (failures && failures.length > 0) {\r\n        // If we have a cancel, it will be one and only one error, with a level of 0.\r\n        // Don't do anything if the edit was cancelled\r\n        if (payload.status !== emp3.api.enums.messageCompletionStatus.CANCELLED) {\r\n          callbacks.onError({\r\n            callInfo: callbacks.callInfo,\r\n            source: callbacks.source,\r\n            args: callbacks.args,\r\n            errorMessage: failures[0].message\r\n          });\r\n        }\r\n      }\r\n    };\r\n\r\n    this.handleUnplotFeatureTransactionComplete = function(callbacks, details, failures) {\r\n      switch (callbacks.callInfo.method) {\r\n        case \"Map.removeMapService\":\r\n          try {\r\n            callbacks.onSuccess({\r\n              mapService: callbacks.data.features[0],\r\n              failures: failures\r\n            });\r\n          }\r\n          catch (e) {\r\n            console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n          }\r\n          break;\r\n        default:\r\n          this.handleRemoveFeatureTransactionComplete(callbacks, details, failures);\r\n          break;\r\n      }\r\n\r\n    };\r\n\r\n    /**\r\n     * The transaction complete handler for centering on a location.  Will call the callbacks\r\n     * associated with the calling function.  Since the centerOnLocation is used for multiple\r\n     * APIs, we need to route to the the correct handler, formatting the onSuccess\r\n     * args for the original caller.\r\n     *\r\n     * @param {Object} callbacks Contains information about the calling method,\r\n     * its, arguments, and the callbacks assigned to it.\r\n     * @param {Object} details Contains the response from the map for the calling\r\n     * method.\r\n     */\r\n    this.handleCenterOnLocationTransactionComplete = function(callbacks, details) {\r\n      try {\r\n\r\n        // Determine who originally called the center on view.\r\n        if (callbacks.callInfo.method === \"Map.setCamera\") {\r\n\r\n          // If the original call was Map.setCamera, return\r\n          // a Camera object back to the calling method.\r\n          callbacks.onSuccess({\r\n            camera: new emp3.api.Camera({\r\n              geoId: callbacks.callInfo.args.camera.geoId,\r\n              name: callbacks.callInfo.args.camera.name,\r\n              latitude: details.center.lat,\r\n              longitude: details.center.lon,\r\n              altitude: details.range,\r\n              tilt: details.tilt,\r\n              roll: details.roll,\r\n              heading: details.heading\r\n            })\r\n          });\r\n        }\r\n      }\r\n      catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    };\r\n\r\n    this.handleCenterOnFeatureTransactionComplete = function(callbacks, details) {\r\n      try {\r\n        callbacks.onSuccess({\r\n          centerLat: details.center.lat,\r\n          centerLon: details.center.lon,\r\n          north: details.bounds.northEast.lat,\r\n          east: details.bounds.northEast.lon,\r\n          south: details.bounds.southWest.lat,\r\n          west: details.bounds.southWest.lon,\r\n          range: details.range\r\n        });\r\n      }\r\n      catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    };\r\n\r\n    this.handleCenterOnBoundsTransactionComplete = function(callbacks, details) {\r\n      try {\r\n        callbacks.onSuccess({\r\n          centerLat: details.center.lat,\r\n          centerLon: details.center.lon,\r\n          north: details.bounds.northEast.lat,\r\n          east: details.bounds.northEast.lon,\r\n          south: details.bounds.southWest.lat,\r\n          west: details.bounds.southWest.lon,\r\n          range: details.range\r\n        });\r\n      }\r\n      catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    };\r\n\r\n    this.handleLookAtLocationTransactionComplete = function(callbacks, details) {\r\n      try {\r\n        callbacks.onSuccess({\r\n          latitude: details.latitude,\r\n          longitude: details.longitude,\r\n          altitude: details.altitude,\r\n          altitudeMode: details.altitudeMode,\r\n          range: details.range,\r\n          tilt: details.tilt,\r\n          heading: details.heading\r\n        });\r\n      }\r\n      catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    };\r\n\r\n    this.handleZoomTransactionComplete = function(callbacks, details) {\r\n      try {\r\n        callbacks.onSuccess({\r\n          centerLat: details.center.lat,\r\n          centerLon: details.center.lon,\r\n          north: details.bounds.northEast.lat,\r\n          east: details.bounds.northEast.lon,\r\n          south: details.bounds.southWest.lat,\r\n          west: details.bounds.southWest.lon,\r\n          range: details.range\r\n        });\r\n      }\r\n      catch (e) {\r\n        console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n      }\r\n    };\r\n\r\n    this.handleRemoveFeatureTransactionComplete = function(callbacks, details, failures) {\r\n      // raise feature added event.\r\n      var featureIds = [],\r\n        successes = details.features,\r\n        i;\r\n\r\n      // send only the successful items back from the transaction.\r\n      // This should only ever contain one item.\r\n      for (i = 0; i < successes.length; i += 1) {\r\n        featureIds.push({\r\n          featureId: successes[i].featureId,\r\n          overlayId: successes[i].overlayId,\r\n          parentId: successes[i].parentId\r\n        });\r\n      }\r\n\r\n      if (callbacks.callInfo.method === \"Overlay.removeFeatures\" ||\r\n        callbacks.callInfo.method === \"Feature.removeFeature\" ||\r\n        callbacks.callInfo.method === \"Feature.removeFeatures\" ||\r\n        callbacks.callInfo.method === \"Feature.clearContainer\") {\r\n        try {\r\n          callbacks.onSuccess({\r\n            featureIds: featureIds,\r\n            failures: failures\r\n          });\r\n        }\r\n        catch (e) {\r\n          console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n        }\r\n      }\r\n      else if (callbacks.callInfo.method === \"Map.removeMapService\") {\r\n        try {\r\n          callbacks.onSuccess({\r\n            layerIds: featureIds,\r\n            failures: failures\r\n          });\r\n        }\r\n        catch (e) {\r\n          console.error(\"onSuccess function generated an exception.\" + \"\\n  name:\" + e.name + \"\\n  message:\" + e.message + \"\\n  stack:\" + e.stack);\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * This method is a direct call to the map engine. It is not asynchronous.\r\n     *\r\n     * @param {CallInfo} callInfo\r\n     * @param {object} message\r\n     * @returns {*}\r\n     */\r\n    this.convert = function(callInfo, message) {\r\n      return emp.environment.browser.mediator.publishSynch({\r\n        mapId: callInfo.mapId,\r\n        message: message\r\n      });\r\n    };\r\n\r\n    this.overlayClusterSet = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      if (callInfo.method === \"Overlay.clusterSet\") {\r\n        payload = {\r\n          overlayId: callInfo.args.overlay.id,\r\n          threshold: callInfo.args.cluster.threshold,\r\n          distance: callInfo.args.cluster.distance,\r\n          clusterStyle: callInfo.args.cluster.clusterStyle,\r\n          messageId: transactionId\r\n        };\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.overlayClusterSet, payload);\r\n    };\r\n\r\n    this.overlayClusterActivate = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      if (callInfo.method === \"Overlay.clusterActivate\") {\r\n        payload = {\r\n          overlayId: callInfo.args.overlay.id,\r\n          messageId: transactionId\r\n        };\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.overlayClusterActivate, payload);\r\n    };\r\n\r\n    this.overlayClusterDeactivate = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      if (callInfo.method === \"Overlay.clusterDeactivate\") {\r\n        payload = {\r\n          overlayId: callInfo.args.overlay.id,\r\n          messageId: transactionId\r\n        };\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.overlayClusterDeactivate, payload);\r\n    };\r\n\r\n    this.overlayClusterRemove = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      if (callInfo.method === \"Overlay.clusterRemove\") {\r\n        payload = {\r\n          overlayId: callInfo.args.overlay.id,\r\n          messageId: transactionId\r\n        };\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.overlayClusterRemove, payload);\r\n    };\r\n\r\n\r\n    /**\r\n     * Sends an edit message to the map.  This puts the map\r\n     * in edit mode.  The user will be able to modify the vertices of\r\n     * the graphic.\r\n     */\r\n    this.featureEdit = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        featureId: message.feature.geoId,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.featureEdit, payload, callInfo);\r\n\r\n      return new emp3.api.Transaction({\r\n        id: transactionId,\r\n        mapId: callInfo.mapId,\r\n        geoId: message.feature.geoId\r\n      });\r\n    };\r\n\r\n    this.centerOnBounds = function(callInfo, message, transactionId) {\r\n      var payload,\r\n        bounds,\r\n        southWest,\r\n        northEast,\r\n        zoom;\r\n\r\n      bounds = {};\r\n      southWest = {};\r\n      northEast = {};\r\n      northEast.lat = message.north;\r\n      southWest.lon = message.west;\r\n      southWest.lat = message.south;\r\n      northEast.lon = message.east;\r\n      bounds.southWest = southWest;\r\n      bounds.northEast = northEast;\r\n      zoom = message.range || \"auto\";\r\n\r\n      payload = {\r\n        bounds: bounds,\r\n        zoom: zoom,\r\n        animate: message.animate,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.centerOnBounds, payload, callInfo);\r\n    };\r\n\r\n    this.centerOnLocation = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        location: {\r\n          lat: message.camera.latitude,\r\n          lon: message.camera.longitude\r\n        },\r\n        zoom: message.camera.altitude,\r\n        altitudeMode: message.camera.altitudeMode,\r\n        heading: message.camera.heading,\r\n        tilt: message.camera.tilt,\r\n        roll: message.camera.roll,\r\n        animate: message.animate,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.centerOnLocation, payload, callInfo);\r\n    };\r\n\r\n    this.lookAtLocation = function(callInfo, message, transactionId) {\r\n      var payload = {\r\n        messageId: transactionId,\r\n        animate: message.animate,\r\n        range: message.lookAt.range,\r\n        tilt: message.lookAt.tilt,\r\n        heading: message.lookAt.heading,\r\n        latitude: message.lookAt.latitude,\r\n        longitude: message.lookAt.longitude,\r\n        altitude: message.lookAt.altitude,\r\n        altitudeMode: message.lookAt.altitudeMode\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.lookAtLocation, payload, callInfo);\r\n    };\r\n\r\n    this.styleOverlay = function(callInfo, message, transactionId) {\r\n      var payload = {},\r\n        multiPointStyle,\r\n        pointStyle,\r\n        lineStyle,\r\n        polygonStyle;\r\n\r\n      switch (callInfo.method) {\r\n        case \"styleMultiPoints\":\r\n          payload.properties = {};\r\n          if (message.multiPointStyle.mark.fill !== undefined) {\r\n            payload.properties.fillColor = message.multiPointStyle.mark.fill.color;\r\n          }\r\n          if (message.multiPointStyle.mark.stroke !== undefined) {\r\n            payload.properties.lineColor = message.multiPointStyle.mark.stroke.color;\r\n            payload.properties.lineWidth = message.multiPointStyle.mark.stroke.width;\r\n          }\r\n          if (message.multiPointStyle.mark.wellKnownName !== undefined) {\r\n            payload.properties.iconUrl = message.multiPointStyle.mark.wellKnownName;\r\n          }\r\n          if (message.multiPointStyle.mark.graphicHeight !== undefined) {\r\n            payload.properties.graphicHeight = message.multiPointStyle.mark.graphicHeight;\r\n          }\r\n          if (message.multiPointStyle.mark.graphicWidth !== undefined) {\r\n            payload.properties.graphicWidth = message.multiPointStyle.mark.graphicWidth;\r\n          }\r\n          payload.type = \"multigeometry\";\r\n          payload.messageId = transactionId;\r\n          payload.overlayId = message.overlayId;\r\n          break;\r\n        case \"stylePolygons\":\r\n          payload.properties = {};\r\n          if (message.polygonStyle.mark.fill !== undefined) {\r\n            payload.properties.fillColor = message.polygonStyle.mark.fill.color;\r\n          }\r\n          if (message.polygonStyle.mark.stroke !== undefined) {\r\n            payload.properties.lineColor = message.polygonStyle.mark.stroke.color;\r\n            payload.properties.lineWidth = message.polygonStyle.mark.stroke.width;\r\n          }\r\n          if (message.polygonStyle.mark.wellKnownName !== undefined) {\r\n            payload.properties.iconUrl = message.polygonStyle.mark.wellKnownName;\r\n          }\r\n          payload.type = \"polygon\";\r\n          payload.messageId = transactionId;\r\n          payload.overlayId = message.overlayId;\r\n          break;\r\n        case \"styleLines\":\r\n          payload.properties = {};\r\n          if (message.lineStyle.mark.fill !== undefined) {\r\n            payload.properties.fillColor = message.lineStyle.mark.fill.color;\r\n          }\r\n          if (message.lineStyle.mark.stroke !== undefined) {\r\n            payload.properties.lineColor = message.lineStyle.mark.stroke.color;\r\n            payload.properties.lineWidth = message.lineStyle.mark.stroke.width;\r\n          }\r\n          if (message.lineStyle.mark.wellKnownName !== undefined) {\r\n            payload.properties.iconUrl = message.lineStyle.mark.wellKnownName;\r\n          }\r\n          payload.type = \"line\";\r\n          payload.messageId = transactionId;\r\n          payload.overlayId = message.overlayId;\r\n          break;\r\n        case \"stylePoints\":\r\n          payload.properties = {};\r\n          if (message.pointStyle.mark.fill !== undefined) {\r\n            payload.properties.fillColor = message.pointStyle.mark.fill.color;\r\n          }\r\n          if (message.pointStyle.mark.stroke !== undefined) {\r\n            payload.properties.lineColor = message.pointStyle.mark.stroke.color;\r\n            payload.properties.lineWidth = message.pointStyle.mark.stroke.width;\r\n          }\r\n          if (message.pointStyle.mark.wellKnownName !== undefined) {\r\n            payload.properties.iconUrl = message.pointStyle.mark.wellKnownName;\r\n          }\r\n          if (message.pointStyle.mark.graphicHeight !== undefined) {\r\n            payload.properties.graphicHeight = message.pointStyle.mark.graphicHeight;\r\n          }\r\n          if (message.pointStyle.mark.graphicWidth !== undefined) {\r\n            payload.properties.graphicWidth = message.pointStyle.mark.graphicWidth;\r\n          }\r\n          payload.type = \"point\";\r\n          payload.messageId = transactionId;\r\n          payload.overlayId = message.overlayId;\r\n          break;\r\n        case \"styleOverlay\":\r\n          payload = [];\r\n          multiPointStyle = {};\r\n          multiPointStyle.properties = {};\r\n          pointStyle = {};\r\n          pointStyle.properties = {};\r\n          lineStyle = {};\r\n          lineStyle.properties = {};\r\n          polygonStyle = {};\r\n          polygonStyle.properties = {};\r\n\r\n          if (message.pointStyle.mark.fill !== undefined) {\r\n            pointStyle.properties.fillColor = message.pointStyle.mark.fill.color;\r\n          }\r\n          if (message.pointStyle.mark.stroke !== undefined) {\r\n            pointStyle.properties.lineColor = message.pointStyle.mark.stroke.color;\r\n            pointStyle.properties.lineWidth = message.pointStyle.mark.stroke.width;\r\n          }\r\n          if (message.pointStyle.mark.wellKnownName !== undefined) {\r\n            pointStyle.properties.iconUrl = message.pointStyle.mark.wellKnownName;\r\n          }\r\n          if (message.pointStyle.mark.graphicHeight !== undefined) {\r\n            pointStyle.properties.graphicHeight = message.pointStyle.mark.graphicHeight;\r\n          }\r\n          if (message.pointStyle.mark.graphicWidth !== undefined) {\r\n            pointStyle.properties.graphicWidth = message.pointStyle.mark.graphicWidth;\r\n          }\r\n          pointStyle.type = \"point\";\r\n          pointStyle.overlayId = message.overlayId;\r\n\r\n          if (message.multiPointStyle.mark.fill !== undefined) {\r\n            multiPointStyle.properties.fillColor = message.multiPointStyle.mark.fill.color;\r\n          }\r\n          if (message.multiPointStyle.mark.stroke !== undefined) {\r\n            multiPointStyle.properties.lineColor = message.multiPointStyle.mark.stroke.color;\r\n            multiPointStyle.properties.lineWidth = message.multiPointStyle.mark.stroke.width;\r\n          }\r\n          if (message.multiPointStyle.mark.wellKnownName !== undefined) {\r\n            multiPointStyle.properties.iconUrl = message.multiPointStyle.mark.wellKnownName;\r\n          }\r\n          multiPointStyle.type = \"multigeometry\";\r\n          multiPointStyle.overlayId = message.overlayId;\r\n\r\n          if (message.lineStyle.mark.fill !== undefined) {\r\n            lineStyle.properties.fillColor = message.lineStyle.mark.fill.color;\r\n          }\r\n          if (message.lineStyle.mark.stroke !== undefined) {\r\n            lineStyle.properties.lineColor = message.lineStyle.mark.stroke.color;\r\n            lineStyle.properties.lineWidth = message.lineStyle.mark.stroke.width;\r\n          }\r\n          if (message.lineStyle.mark.wellKnownName !== undefined) {\r\n            lineStyle.properties.iconUrl = message.lineStyle.mark.wellKnownName;\r\n          }\r\n          lineStyle.type = \"line\";\r\n          lineStyle.overlayId = message.overlayId;\r\n\r\n          if (message.polygonStyle.mark.fill !== undefined) {\r\n            polygonStyle.properties.fillColor = message.polygonStyle.mark.fill.color;\r\n          }\r\n          if (message.polygonStyle.mark.stroke !== undefined) {\r\n            polygonStyle.properties.lineColor = message.polygonStyle.mark.stroke.color;\r\n            polygonStyle.properties.lineWidth = message.polygonStyle.mark.stroke.width;\r\n          }\r\n          if (message.polygonStyle.mark.wellKnownName !== undefined) {\r\n            polygonStyle.properties.iconUrl = message.polygonStyle.mark.wellKnownName;\r\n          }\r\n          polygonStyle.type = \"polygon\";\r\n          polygonStyle.overlayId = message.overlayId;\r\n\r\n          pointStyle.messageId = transactionId;\r\n          lineStyle.messageId = transactionId;\r\n          polygonStyle.messageId = transactionId;\r\n          multiPointStyle.messageId = transactionId;\r\n\r\n          payload.push(pointStyle);\r\n          payload.push(lineStyle);\r\n          payload.push(polygonStyle);\r\n          payload.push(multiPointStyle);\r\n          break;\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.styleOverlay, payload, callInfo);\r\n    };\r\n\r\n    this.zoom = function(callInfo, message, transactionId) {\r\n      var payload,\r\n        range;\r\n\r\n      if (message.altitude !== undefined) {\r\n        range = message.altitude;\r\n      }\r\n\r\n      payload = {\r\n        range: range,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.zoom, payload, callInfo);\r\n    };\r\n\r\n    this.centerOnOverlay = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        overlayId: message.overlayId,\r\n        zoom: message.range || \"auto\",\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.centerOnOverlay, payload, callInfo);\r\n    };\r\n\r\n    this.centerOnFeature = function(callInfo, message, transactionId) {\r\n      var payload;\r\n      var multiPayload = [];\r\n\r\n      // Check if an array of features was sent.\r\n      if (message.featureIds) {\r\n        for (var i = 0; i < message.featureIds.length; i += 1) {\r\n          payload = {\r\n            featureId: message.featureIds[i],\r\n            zoom: message.range || \"auto\",\r\n            messageId: transactionId\r\n          };\r\n          multiPayload.push(payload);\r\n        }\r\n\r\n        this.validate(emp3.api.enums.channel.centerOnFeature, multiPayload, callInfo);\r\n      }\r\n      else {\r\n        payload = {\r\n          featureId: message.featureId,\r\n          zoom: message.range || \"auto\",\r\n          messageId: transactionId\r\n        };\r\n        this.validate(emp3.api.enums.channel.centerOnFeature, payload, callInfo);\r\n      }\r\n    };\r\n\r\n    this.hideFeature = function(callInfo, message, transactionId) {\r\n      var payload,\r\n        i;\r\n\r\n      payload = [];\r\n\r\n      for (i = 0; i < message.features.length; i += 1) {\r\n        payload.push({\r\n          featureId: message.features[i],\r\n          overlayId: message.parent || emp.constant.parentIds.ALL_PARENTS,\r\n          messageId: transactionId\r\n        });\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.hideFeature, payload, callInfo);\r\n\r\n    };\r\n\r\n    this.showFeature = function(callInfo, message, transactionId) {\r\n      var payload,\r\n        i;\r\n\r\n      payload = [];\r\n\r\n      for (i = 0; i < message.features.length; i += 1) {\r\n        payload.push({\r\n          featureId: message.features[i],\r\n          overlayId: message.parent || emp.constant.parentIds.ALL_PARENTS,\r\n          messageId: transactionId\r\n        });\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.showFeature, payload, callInfo);\r\n    };\r\n\r\n    this.statusRequest = function(callInfo, transaction, transactionId) {\r\n      var payload;\r\n\r\n      switch (transaction.callInfo.method) {\r\n\r\n        case \"Map.getScreenshot\":\r\n          payload = {\r\n            types: [\"screenshot\"],\r\n            messageId: transactionId\r\n          };\r\n          this.statusRequestPendingList.screenshot.push(transaction);\r\n          break;\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.statusRequest, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {string} mapId\r\n     * @param {string} featureId GeoId of the feature\r\n     * @returns {boolean}\r\n     */\r\n    this.isSelected = function(mapId, featureId) {\r\n      var selected = false;\r\n\r\n      if (selectionHash[mapId]) {\r\n        if (selectionHash[mapId][featureId]) {\r\n          selected = true;\r\n        }\r\n      }\r\n\r\n      return selected;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param mapId\r\n     * @returns {emp3.api.Feature[]}\r\n     */\r\n    this.getSelected = function(mapId) {\r\n      var featureId,\r\n        selected = [];\r\n      if (selectionHash[mapId]) {\r\n        for (featureId in selectionHash[mapId]) {\r\n          selected.push(selectionHash[mapId][featureId]);\r\n        }\r\n      }\r\n\r\n      return selected;\r\n    };\r\n\r\n\r\n    /**\r\n     * Retrieves the requested data for the API using the map.get channel.\r\n     *\r\n     * @private\r\n     * @param  {object} message       The message to send\r\n     * @param  {string} transactionId The id of the transaction created for this message.\r\n     */\r\n    this.get = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        types: message.types,\r\n        recursive: message.recursive,\r\n        select: message.select,\r\n        filter: message.filter,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.get, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     * Keep tracks of the items that are selected.  Called when a selection\r\n     * transaction complete occurs.  Stores selected items\r\n     * in a selectionHash maintained by the MessageHandler.  Each mapId\r\n     * contains a separate list of selected items.\r\n     *\r\n     * @param {object} sender - Contains the CMAPI sender object.\r\n     * @param {string} sender.id - the id of the map that sent the selection\r\n     * transaction complete.\r\n     * @param {object} msg - the transaction complete response\r\n     * @param {object} msg.details - contains the successes and errors\r\n     * of the transaction complete response.\r\n     * @param {emp3.api.Feature[]} msg.detail.features - contains the features\r\n     * that were selected on this map.\r\n     */\r\n    this.manageSelection = function(sender, msg) {\r\n      var mapId,\r\n        payload,\r\n        featureId,\r\n        feature;\r\n\r\n      if (sender && sender.id && msg) {\r\n\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        // retrieve the map id that sent this message.\r\n        mapId = sender.id;\r\n\r\n        // Check to see if we have an instance of the map in our selectionHash\r\n        // If not create an entry\r\n        if (!selectionHash[mapId]) {\r\n          selectionHash[mapId] = [];\r\n        }\r\n\r\n        for (var i = 0, len = payload.details.features.length; i < len; i++) {\r\n          featureId = payload.details.features[i].featureId;\r\n          feature = emp3.api.buildFeature({\r\n            type: payload.details.features[i].properties.featureType,\r\n            geoId: payload.details.features[i].featureId,\r\n            name: payload.details.features[i].name,\r\n            coordinates: emp3.api.convertGeoJsonToCMAPIPositions(payload.details.features[i].feature),\r\n            properties: payload.details.features[i].properties,\r\n            symbolCode: payload.details.features[i].symbolCode\r\n          });\r\n\r\n\r\n          if (featureId && feature) {\r\n            if (!selectionHash[mapId][featureId]) {\r\n              selectionHash[mapId][featureId] = feature;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Keep tracks of the items that are deselected.  Fires off of\r\n     * a transaction complete message.  Removes selected items\r\n     * from a selectionHash maintained by the MessageHandler.  Each mapId\r\n     * contains a separate list of selected items.\r\n     *\r\n     * @param {object} sender - Contains the CMAPI sender object.\r\n     * @param {string} sender.id - the id of the map that sent the selection\r\n     * transaction complete.\r\n     * @param {object} msg - the transaction complete response\r\n     * @param {object} msg.details - contains the successes and errors\r\n     * of the transaction complete response.\r\n     * @param {emp3.api.Feature[]} msg.detail.features - contains the features\r\n     * that were deselected on this map.\r\n     */\r\n    this.manageDeselection = function(sender, msg) {\r\n      var mapId,\r\n        payload,\r\n        featureIds = [];\r\n\r\n      if (sender && sender.id && msg) {\r\n\r\n        // make sure the the payload is an object.\r\n        payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n        // retrieve the map id that sent this message.\r\n        mapId = sender.id;\r\n\r\n        if (payload.details && payload.details.features) {\r\n\r\n          for (var i = 0, len = payload.details.features.length; i < len; i++) {\r\n            featureIds.push(payload.details.features[i].featureId);\r\n          }\r\n\r\n          this.removeSelection(mapId, featureIds);\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Removes features from the selection Hash.  This is separated out\r\n     * so other methods can remove items.\r\n     *\r\n     * @param {String} mapId the id of the map the item is on.\r\n     * @param {String} featureIds An array of featuresIds of items to remove.\r\n     */\r\n    this.removeSelection = function(mapId, featureIds) {\r\n      var featureId,\r\n        features;\r\n\r\n      // Check to see if we have an instance of the map in our selectionHash\r\n      // if we do, check each deselected item and remove from the hash.\r\n      if (selectionHash[mapId]) {\r\n        for (var i = 0, len = featureIds.length; i < len; i++) {\r\n          featureId = featureIds[i];\r\n          features = selectionHash[mapId];\r\n\r\n          // Delete the item from the hash if it's here.\r\n          if (features[featureId]) {\r\n            delete features[featureId];\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Adds a series of callbacks to perform on an overlay if a draw occurs on the map.\r\n     *\r\n     * @param {Object} args  Parameters are provided as members of the arg object.\r\n     * @param {String} args.overlayId The id of the overlay we are listening to for draws.  If a draw is done on a different\r\n     * overlay, it will not call the callback functions.\r\n     * @param {StartDrawCallback} [args.startDrawCallback] The callback function to be executed if a drawing starts\r\n     * @param {DrawCallback} [args.drawCallback] The callback function to be executed when a drawing has started\r\n     * @param {CompleteDrawCallback} [args.completeDrawCallback] The callback function to be executed if a drawing is finished\r\n     * @param {CancelDrawCallback} [args.cancelDrawCallback] The callback function to be executed if a drawing is cancelled\r\n     * @param {onErrorCallback} [args.errorDrawCallback] The callback function to be executed if an error has occurred in edit\r\n     */\r\n    this.setDrawCallbackHash = function(args) {\r\n\r\n      // If a drawCallback listener was already added for this overlay, overwrite it.\r\n      // The way we defined the API would not allow us to remove a particular draw\r\n      // listener, so we are just moving towards one draw listener per overlay.\r\n      drawListenerCallbackHash.setItem(args.overlayId, {\r\n        startDrawCallback: args.startDrawCallback,\r\n        drawCallback: args.drawCallback,\r\n        completeDrawCallback: args.completeDrawCallback,\r\n        cancelDrawCallback: args.cancelDrawCallback,\r\n        errorDrawCallback: args.errorDrawCallback\r\n      });\r\n    };\r\n\r\n    /**\r\n     * Completely clear the map of all layers, features, and overlays.\r\n     * @private\r\n     */\r\n    this.clearMap = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        messageId: transactionId\r\n      };\r\n      this.validate(emp3.api.enums.channel.updateFeature, payload, callInfo);\r\n    };\r\n\r\n    this.clearFeatures = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        overlayId: message.overlay.geoId,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.clearFeatures, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     * Synchronous call to see whether or not a container has any children\r\n     * @param {emp3.api.Map|emp3.api.Overlay|emp3.api.Feature} container\r\n     * @returns boolean\r\n     */\r\n    this.hasChildren = function(container) {\r\n      if (!container || !container.geoId) {\r\n        return false;\r\n      }\r\n\r\n      var publishData = {\r\n        message: {\r\n          cmd: 'Container.hasChildren',\r\n          container: container\r\n        }\r\n      };\r\n\r\n      var rc = environment.pubSub.publishSync(publishData);\r\n      return rc.hasChildren;\r\n    };\r\n\r\n    /**\r\n     * Retrieves the visibility state of a container or container instance.\r\n     */\r\n    this.getVisibility = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        targetId: message.target.geoId,\r\n        parentId: (message.parent) ? message.parent.geoId : undefined,\r\n        messageId: transactionId\r\n      };\r\n\r\n      this.validate(emp3.api.enums.channel.getVisibility, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     * Sends the message required to swap a map engine.\r\n     *\r\n     * @private\r\n     * @param {object} callInfo - Object containing information related to the original call.\r\n     * @param {string} message - Object containing information for the payload\r\n     * being sent over the emp3.api.enums.channel.swap channel\r\n     */\r\n    this.mapSwap = function(callInfo, message, transactionId) {\r\n      var payload;\r\n\r\n      payload = {\r\n        mapId: callInfo.mapId,\r\n        engine: message.engine,\r\n        messageId: transactionId\r\n      };\r\n      this.validate(emp3.api.enums.channel.swap, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     * Locks or unlocks map view synchronously\r\n     *\r\n     * @param {object} callInfo\r\n     * @param {object} message\r\n     */\r\n    this.lockView = function(callInfo, message) {\r\n      return emp.environment.browser.mediator.publishSynch({\r\n        mapId: callInfo.mapId,\r\n        message: message\r\n      });\r\n    };\r\n\r\n    /**\r\n     * Attempts to cancel a transaction before it finishes.  If the\r\n     * transaction has already been processed, no action occurs.  If the map\r\n     * cannot cancel it, not action occurs.  If the map can cancel\r\n     * the transaction the calling function associated with the transaction\r\n     * should handle any cancel responses\r\n     * in a callback.\r\n     *\r\n     * @param {object} callInfo\r\n     * @param {object} message\r\n     *\r\n     */\r\n    this.cancel = function(callInfo, message) {\r\n      var payload;\r\n\r\n      if (message && message.transaction && message.transaction.id) {\r\n        payload = {\r\n          messageId: message.transaction.id\r\n        };\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.cancel, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     * Attempts to complete a transaction before user does.  If the\r\n     * transaction has already been processed, no action occurs.  If the map\r\n     * cannot complete the transaction,  no action occurs.  If the map can complete\r\n     * the transaction the calling function associated with the transaction\r\n     * should handle any complete responses\r\n     * in a callback.\r\n     *\r\n     * @param {object} callInfo\r\n     * @param {object} message\r\n     */\r\n    this.complete = function(callInfo, message) {\r\n      var payload;\r\n\r\n      if (message && message.transaction && message.transaction.id) {\r\n        payload = {\r\n          messageId: message.transaction.id\r\n        };\r\n      }\r\n\r\n      this.validate(emp3.api.enums.channel.transactionComplete, payload, callInfo);\r\n    };\r\n\r\n    /**\r\n     * Stores updates and sends them out only if other updates don't come\r\n     * in within a certain interval.\r\n     * @param {emp3.api.Feature} feature\r\n     */\r\n    this.apply = function(feature) {\r\n\r\n      var payload;\r\n      var that;\r\n\r\n      var convertedFeature = emp3.api.convertFeatureToGeoJSON(feature);\r\n      var properties = emp3.api.getProperties(feature);\r\n      var timeElapsedSinceLastUpdate = Date.now() - updateTime;\r\n\r\n      payload = {\r\n        overlayId: emp.constant.parentIds.ALL_PARENTS,\r\n        featureId: feature.geoId,\r\n        format: feature.featureType,\r\n        feature: convertedFeature,\r\n        name: feature.name,\r\n        readOnly: feature.readOnly,\r\n        properties: properties\r\n      };\r\n\r\n      updates.push(payload);\r\n\r\n\r\n      if (updateTimer && timeElapsedSinceLastUpdate < 100 && updates.length < 500) {\r\n        clearTimeout(updateTimer);\r\n      }\r\n\r\n      // If we have 500 updates or we have had an update in 50 ms then\r\n      // send the updates in one shot.\r\n      updateTime = Date.now();\r\n      that = this;\r\n      updateTimer = setTimeout(function() {\r\n        that.validate(emp3.api.enums.channel.plotFeature, updates, {});\r\n        updates = [];\r\n      }, 50);\r\n\r\n    };\r\n\r\n    /**\r\n     * Called when features are added to a map instance.  Will be called once\r\n     * for each map instance the newly added feature is on.\r\n     *\r\n     * @param {object} sender contains the id of the map that the event\r\n     * occurred on.\r\n     *\r\n     * @param msg\r\n     */\r\n    this.handleFeatureAdd = function(sender, msg) {\r\n      this.handleFeatureEvent(emp3.api.enums.EventType.MAP_FEATURE_ADDED, sender, msg);\r\n    };\r\n\r\n    /**\r\n     * Called when features are updated on a map instance.  Will be called once\r\n     * for each map instance the feature is updated on.\r\n     *\r\n     * @param {object} sender contains the id of the map that the event\r\n     * occurred on.\r\n     */\r\n    this.handleFeatureUpdate = function(sender, msg) {\r\n      this.handleFeatureEvent(emp3.api.enums.EventType.MAP_FEATURE_UPDATED, sender, msg);\r\n    };\r\n\r\n    /**\r\n     * Called when features are removed from a map instance.  Will be called once\r\n     * for each map instance the newly added feature is on.\r\n     *\r\n     * @param {object} sender contains the id of the map that the event\r\n     * occurred on.\r\n     * @param {object} msg\r\n     */\r\n    this.handleFeatureRemove = function(sender, msg) {\r\n      this.handleFeatureEvent(emp3.api.enums.EventType.MAP_FEATURE_REMOVED, sender, msg);\r\n    };\r\n\r\n    /**\r\n     * Creates events and calls the callbacks associated to those events\r\n     * for feature added, feature removed and feature updated events.\r\n     *\r\n     * @param {emp3.api.enums.EventType} eventType should be\r\n     * MAP_FEATURE_REMOVED, MAP_FEATURE_ADDED, or MAP_FEATURE_UPDATED.\r\n     * @param {object} sender An object containing the map instance id that raised the event.\r\n     * @param {object} msg cmapi2 temp holder for a feature event message.\r\n     * Made up until cmapi2 comes out.\r\n     */\r\n    this.handleFeatureEvent = function(eventType, sender, msg) {\r\n      var payload,\r\n        cmapiFeature,\r\n        feature,\r\n        features = [],\r\n        featureIds = [],\r\n        callbacks,\r\n        i,\r\n        len,\r\n        myevent;\r\n\r\n      // First make sure there is a payload\r\n      if (msg === undefined || msg === null) {\r\n        throw new Error(missingMessageError);\r\n      }\r\n\r\n      // If there is an event listener for this map updated event,\r\n      // then do the logic.  We don't want to waste cycles convertLocationArrayToString\r\n      // cmapi messages to feature messages.\r\n      if (sender.id && this.eventListeners[sender.id]) {\r\n        callbacks = this.eventListeners[sender.id][eventType];\r\n        if (callbacks) {\r\n\r\n          // make sure the the payload is an object.\r\n          payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n          // convert cmapi messages to Feature objects.\r\n          if (payload.features) {\r\n            for (i = 0, len = payload.features.length; i < len; i++) {\r\n              cmapiFeature = payload.features[i];\r\n              if (cmapiFeature.properties && cmapiFeature.properties.featureType) {\r\n                feature = {\r\n                  type: cmapiFeature.properties.featureType,\r\n                  geoId: cmapiFeature.featureId,\r\n                  name: cmapiFeature.name,\r\n                  properties: cmapiFeature.properties,\r\n                  symbolCode: cmapiFeature.symbolCode\r\n                };\r\n                switch (feature.type) {\r\n                  case emp3.api.enums.FeatureTypeEnum.KML:\r\n                    feature.KMLString = cmapiFeature.feature;\r\n                    break;\r\n                  default:\r\n                    feature.coordinates = emp3.api.convertGeoJsonToCMAPIPositions(cmapiFeature.feature);\r\n                    break;\r\n                }\r\n                feature = emp3.api.buildFeature(feature);\r\n                if (feature) {\r\n                  features.push(feature);\r\n                  featureIds.push(feature.geoId);\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          if (eventType === emp3.api.enums.EventType.MAP_FEATURE_REMOVED) {\r\n            // if an item is being removed from map, we also need to\r\n            // update the selection hash.\r\n            this.removeSelection(sender.id, featureIds);\r\n          }\r\n\r\n          // For each callback subscribed, create a new MapFeatureAddedEvent.\r\n          for (i = 0, len = callbacks.length; i < len; i++) {\r\n\r\n            switch (eventType) {\r\n              case emp3.api.enums.EventType.MAP_FEATURE_REMOVED:\r\n                myevent = new emp3.api.events.MapFeatureRemovedEvent({\r\n                  target: mapHash.getItem(sender.id),\r\n                  features: features\r\n                });\r\n\r\n                break;\r\n              case emp3.api.enums.EventType.MAP_FEATURE_ADDED:\r\n                myevent = new emp3.api.events.MapFeatureAddedEvent({\r\n                  target: mapHash.getItem(sender.id),\r\n                  features: features\r\n                });\r\n                break;\r\n              case emp3.api.enums.EventType.MAP_FEATURE_UPDATED:\r\n                myevent = new emp3.api.events.MapFeatureUpdatedEvent({\r\n                  target: mapHash.getItem(sender.id),\r\n                  features: features\r\n                });\r\n                break;\r\n            }\r\n\r\n            // always put a try around user callbacks so it doesn't\r\n            // break map code.\r\n            try {\r\n              callbacks[i](myevent);\r\n            }\r\n            catch (e) {\r\n              console.error(\"Event callback generated an exception. \" + e.message);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.handleFreehand = function(sender, msg) {\r\n      var event,\r\n        payload,\r\n        callbacks,\r\n        j,\r\n        i,\r\n        coordinateArray,\r\n        geoPositions = [];\r\n\r\n      // First make sure there is a payload\r\n      if (msg === undefined || msg === null) {\r\n        throw new Error(missingMessageError);\r\n      }\r\n\r\n      payload = typeof(msg) === \"string\" ? JSON.parse(msg) : msg;\r\n\r\n      // If there is an event listener for the freehand line draw event,\r\n      // then raise the event.\r\n      if (sender.id && this.eventListeners[sender.id]) {\r\n        callbacks = this.eventListeners[sender.id][emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT];\r\n        if (callbacks) {\r\n          for (i in callbacks) {\r\n\r\n            // messages can come from two different places.  Entering and existing\r\n            // freehand mode comes from transactionComplete channel.  If it is\r\n            // transactionComplete we need to format the event slightly different.\r\n            if (payload.details) {\r\n              if (payload.originatingChannel === emp3.api.enums.channel.freehandDrawStart) {\r\n                event = new emp3.api.events.MapFreehandEvent({\r\n                  event: emp3.api.enums.MapFreehandEventEnum.MAP_ENTERED_FREEHAND_DRAW_MODE,\r\n                  target: mapHash.items[sender.id]\r\n                });\r\n              }\r\n              else if (payload.originatingChannel === emp3.api.enums.channel.freehandDrawExit) {\r\n                event = new emp3.api.events.MapFreehandEvent({\r\n                  event: emp3.api.enums.MapFreehandEventEnum.MAP_EXIT_FREEHAND_DRAW_MODE,\r\n                  target: mapHash.items[sender.id]\r\n                });\r\n              }\r\n            }\r\n            else {\r\n              coordinateArray = emp3.api.convertGeoJsonToCMAPIPositions(payload.feature);\r\n              for (j in coordinateArray) {\r\n                geoPositions.push(new emp3.api.GeoPosition({\r\n                  latitude: coordinateArray[j].latitude,\r\n                  longitude: coordinateArray[j].longitude,\r\n                  altitude: coordinateArray[j].altitude\r\n                }));\r\n              }\r\n              event = new emp3.api.events.MapFreehandEvent({\r\n                event: payload.type,\r\n                target: mapHash.items[sender.id],\r\n                positionGroup: {\r\n                  positions: geoPositions\r\n                },\r\n                style: payload.strokeStyle\r\n              });\r\n            }\r\n\r\n            if (event) {\r\n              try {\r\n                callbacks[i](event);\r\n              }\r\n              catch (e) {\r\n                console.error(\"Event callback generated an exception. \" + e.message);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Subscribe to all the channels required to listen for\r\n    // events and return calls.\r\n    environment.init({\r\n      initcallback: function(args) {\r\n        if (args.success === true) {\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.transactionComplete,\r\n            callback: that.handleTransactionComplete.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.messageProgress,\r\n            callback: that.handleMessageProgress.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.statusView,\r\n            callback: that.handleStatusView.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.statusAbout,\r\n            callback: that.handleStatusAboutResponse.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.statusFormat,\r\n            callback: that.handleStatusFormatResponse.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.statusScreenshot,\r\n            callback: that.handleStatusScreenshot.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.statusSelected,\r\n            callback: that.handleStatusSelected.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.statusInitialization,\r\n            callback: that.handleMapStatus.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.clicked,\r\n            callback: that.handleMapClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.freehandLineDraw,\r\n            callback: that.handleFreehand.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.mouseup,\r\n            callback: that.handleMapClick.bind(that)\r\n          });\r\n          /*\r\n           environment.pubSub.subscribe({\r\n           channel: emp3.api.enums.channel.mousemove,\r\n           callback: that.handleMapCursorMove.bind(that)\r\n           });\r\n           */\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.mousedown,\r\n            callback: that.handleMapClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.drag,\r\n            callback: that.handleMapClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.dragComplete,\r\n            callback: that.handleMapClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureDrag,\r\n            callback: that.handleFeatureClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureDragComplete,\r\n            callback: that.handleFeatureClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureClicked,\r\n            callback: that.handleFeatureClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureMouseDown,\r\n            callback: that.handleFeatureClick.bind(that)\r\n          });\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureMouseUp,\r\n            callback: that.handleFeatureClick.bind(that)\r\n          });\r\n\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.convertResponse,\r\n            callback: that.handleConvertResponse.bind(that)\r\n          });\r\n\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureAddEvent,\r\n            callback: that.handleFeatureAdd.bind(that)\r\n          });\r\n\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureRemoveEvent,\r\n            callback: that.handleFeatureRemove.bind(that)\r\n          });\r\n\r\n          environment.pubSub.subscribe({\r\n            channel: emp3.api.enums.channel.featureUpdateEvent,\r\n            callback: that.handleFeatureUpdate.bind(that)\r\n          });\r\n\r\n          that.isEnvironmentReady = true;\r\n        }\r\n        else {\r\n          if (console) {\r\n            console.error(\"An error occurred while initializing the \" + environment.name + \" environment for the CPCE Map API and will not be able to communicate with the map.\");\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n  } // PrivateConstructor\r\n\r\n  /////////////////////////////////////////////////////////////////////////////\r\n  // Exposes the getInstance method ///////////////////////////////////////////\r\n  /////////////////////////////////////////////////////////////////////////////\r\n  return {\r\n    /**\r\n     * @memberof emp3.api.MessageHandler\r\n     * Destroys the instance\r\n     */\r\n    destroyInstance: function() {\r\n      instance = null;\r\n    },\r\n    /**\r\n     * Method to get the singleton implementation of this class.\r\n     * @memberof emp3.api.MessageHandler\r\n     *\r\n     * @example\r\n     * var mh = emp3.api.MessageHandler.getInstance();\r\n     *\r\n     * @param {object} [args]\r\n     * @param {object} [args.spawnWidget] The name of the widget being spawned.\r\n     * @returns {emp3.api.MessageHandler}\r\n     */\r\n    getInstance: function(args) {\r\n      if (instance === null) {\r\n        instance = new PrivateConstructor(args);\r\n        instance.constructor = null;\r\n      }\r\n\r\n      return instance;\r\n    }\r\n  };\r\n\r\n})();\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @namespace\r\n * @memberof emp3.api\r\n * @desc Contains global settings properties and utility functions for EMP.\r\n\r\n * @property {Object} configuration Contains configuration properties for EMP.\r\n * @property {String} configuration.urlProxy Specifies the location of a proxy for outgoing\r\n * requests of the map.  The proxy will be used for WMS, fetching images,\r\n * and other map service related requests.\r\n */\r\nemp3.api.global = emp3.api.global || {\r\n    /**\r\n     * @name emp3.api.global#configuration\r\n     */\r\n    configuration: (function() {\r\n      var _urlProxy = \"../urlproxy.jsp\";\r\n\r\n      /**\r\n       * @name emp3.api.global.configuration#urlProxy\r\n       * @type {string}\r\n       */\r\n      Object.defineProperty(this, \"urlProxy\", {\r\n        enumerable: true,\r\n        get: function() {\r\n          return _urlProxy;\r\n        },\r\n        set: function(value) {\r\n          if (typeof value === \"string\") {\r\n            _urlProxy = value;\r\n          } else {\r\n            throw new Error(\"Invalid value type, property urlProxy must be a string\");\r\n          }\r\n        }\r\n      });\r\n      return this;\r\n    }())\r\n  };\r\n\r\n/**\r\n * Searches globally for an {@link emp3.api.Overlay}\r\n *\r\n * @param {object} args\r\n * @param {string} args.uuid Id of the feature to search for\r\n * @param {global~findOverlaySuccess} args.onSuccess Success callback to be invoked on a successful query.\r\n * @param {ErrorCallback} [args.onError] The error callback will fire only if there was an error performing the query.\r\n *\r\n * @example\r\n * emp3.api.global.findOverlay({\r\n *   uuid: '71d6f802-16cb47c0-b08806e9-29ae1a3e',\r\n *   onSuccess: function(cbArgs) {\r\n *     if (cbArgs.overlay) {\r\n *       window.console.debug('Overlay found', cbArgs.overlay.name);\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.global.findOverlay = function(args) {\r\n  var message = {},\r\n    callInfo = {};\r\n\r\n  message.cmd = emp3.api.enums.channel.get;\r\n  message.filter = [{\r\n    property: \"overlayId\",\r\n    term: args.uuid\r\n  }];\r\n  message.types = [\"overlay\"];\r\n  message.select = [\"overlayId\", \"name\", \"description\", \"properties\"];\r\n  message.recursive = false;\r\n  message.onSuccess = args.onSuccess;\r\n  message.onError = args.onError;\r\n\r\n  callInfo.source = \"global\";\r\n  callInfo.method = \"global.findOverlay\";\r\n  callInfo.args = args;\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(message, callInfo);\r\n};\r\n\r\n/**\r\n * Searches globally for a {@link emp3.api.Feature}\r\n * @param {object} args\r\n * @param {string} args.uuid Id of the feature to search for\r\n * @param {global~findOverlaySuccess} args.onSuccess Success callback to be invoked on a successful query\r\n * @param {ErrorCallback} [args.onError] The error callback will fire only if there was an error performing the query.\r\n *\r\n * @example\r\n * emp3.api.global.findFeature({\r\n *   uuid: '71d6f802-16cb47c0-b08806e9-29ae1a3e',\r\n *   onSuccess: function(cbArgs) {\r\n *     if (cbArgs.feature) {\r\n *       window.console.log('Feature found', cbArgs.feature.name);\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.global.findFeature = function(args) {\r\n  var message = {},\r\n    callInfo = {};\r\n\r\n  message.cmd = emp3.api.enums.channel.get;\r\n  message.filter = [{\r\n    property: \"featureId\",\r\n    term: args.uuid\r\n  }];\r\n  message.types = [\"feature\"];\r\n  message.select = [\"featureId\", \"name\", \"description\", \"properties\"];\r\n  message.recursive = false;\r\n  message.onSuccess = args.onSuccess;\r\n  message.onError = args.onError;\r\n\r\n  callInfo.source = \"global\";\r\n  callInfo.method = \"global.findFeature\";\r\n  callInfo.args = args;\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(message, callInfo);\r\n};\r\n\r\n/**\r\n * Finds a container on any instantiated map. It will not find Map objects.\r\n *\r\n * @param {object} args\r\n * @param {string} args.uuid Id of the container to search for\r\n * @param {global~findContainerSuccess} args.onSuccess The success callback will fire even if no container with the\r\n *     given uuid is found.\r\n * @param {ErrorCallback} [args.onError] The error callback will fire only if there was an error performing the query.\r\n *\r\n * @example\r\n * emp3.api.global.findContainer({\r\n *   uuid: '3404301c-6d8c4695-be359d80-cf7b5003',\r\n *   onSuccess: function(cbArgs) {\r\n *     if (cbArgs.container) {\r\n *       window.console.debug(instanceof cbArgs === emp3.api.Overlay ? 'Overlay found' : 'Feature Found');\r\n *     }\r\n *   }\r\n * });\r\n */\r\nemp3.api.global.findContainer = function(args) {\r\n  args = args || {};\r\n  if (!args.onSuccess) {\r\n    throw new Error('Missing argument: onSuccess');\r\n  }\r\n\r\n  if (!args.uuid) {\r\n    throw new Error('Missing argument: uuid');\r\n  } else if (typeof args.uuid !== 'string') {\r\n    throw new TypeError('Invalid type: expected uuid to be a string');\r\n  }\r\n\r\n  var message = {\r\n    cmd: emp3.api.enums.channel.get,\r\n    types: ['feature', 'overlay'],\r\n    select: ['featureId', 'overlayId', 'name', 'description', 'properties'],\r\n    filter: [{\r\n      property: 'featureId',\r\n      term: args.uuid\r\n    }, {\r\n      property: 'overlayId',\r\n      term: args.uuid\r\n    }],\r\n    recursive: false,\r\n    onSuccess: args.onSuccess,\r\n    onError: args.onError\r\n  };\r\n\r\n  var callInfo = {\r\n    source: 'global',\r\n    method: 'global.findContainer',\r\n    args: args\r\n  };\r\n\r\n  emp3.api.MessageHandler.getInstance().sendMessage(message, callInfo);\r\n};\r\n\r\n//======================================================================================================================\r\n// Callbacks\r\n//======================================================================================================================\r\n/**\r\n * This callback will container an {@link emp3.api.Overlay} in the overlay property if one has been found.\r\n *\r\n * @callback global~findOverlaySuccess\r\n * @param {object} cbArgs\r\n * @param {undefined|emp3.api.Overlay} cbArgs.overlay\r\n */\r\n\r\n/**\r\n * This callback will container an {@link emp3.api.Feature} in the feature property if one has been found.\r\n *\r\n * @callback global~findFeatureSuccess\r\n * @param {object} cbArgs\r\n * @param {undefined|emp3.api.Feature} cbArgs.feature\r\n */\r\n\r\n/**\r\n * This callback will contain either an {@link emp3.api.Overlay} or {@link emp3.api.Feature} in the container property\r\n * of the callback object.\r\n *\r\n * @callback global~findContainerSuccess\r\n * @param {object} cbArgs\r\n * @param {undefined|emp3.api.Feature|emp3.api.Overlay} cbArgs.container\r\n */\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\nemp3.api.MessageFactory = (function () {\r\n  /**\r\n   * Message hash\r\n   * @private\r\n   */\r\n  var _messageHash = {};\r\n\r\n  return {\r\n    /**\r\n     * @memberof emp3.api.MessageFactory\r\n     *\r\n     * Generates a payload\r\n     * @param message\r\n     * @param callInfo\r\n     * @param transactionId\r\n     */\r\n    constructPayload: function (message, callInfo, transactionId) {\r\n      if (_messageHash[message.cmd]) {\r\n        return new _messageHash[message.cmd](message, callInfo, transactionId);\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp3.api.MessageFactory\r\n     *\r\n     * @param {string|string[]} channels\r\n     * @param {function} message Constructor\r\n     */\r\n    registerMessage: function (channels, message) {\r\n      if (Array.isArray(channels)) {\r\n        for (var channel in channels) {\r\n          if (channels.hasOwnProperty(channel)) {\r\n            _messageHash[channels[channel]] = message;\r\n          }\r\n        }\r\n      } else {\r\n        _messageHash[channels] = message;\r\n      }\r\n    }\r\n  };\r\n})();\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @ignore\r\n * @constructor\r\n * @param {emp3.api.enums.channel} channel\r\n * @param {string} [transactionId]\r\n */\r\nemp3.api.Message = function(channel, transactionId) {\r\n  /** @member {string} */\r\n  this.channel = channel;\r\n\r\n  /** @member {string} */\r\n  this.transactionId = transactionId || emp3.api.createGUID();\r\n\r\n  /** @member {object|Array} */\r\n  this.payload = {};\r\n};\r\n\r\n/**\r\n * Returns a transaction object only if the message specifically requires it\r\n * @returns {emp3.api.Transaction|undefined}\r\n */\r\nemp3.api.Message.prototype.transaction = function() {};\r\n\r\n/**\r\n * Serializes the message payload\r\n * Note:For any subclasses which override this for a custom serialization the channel field must be injected into\r\n * the payload manually.\r\n * @returns {string} Serialized representation of the message payload\r\n */\r\nemp3.api.Message.prototype.serialize = function() {\r\n  this.payload.channel = this.channel;\r\n  return JSON.stringify(this.payload);\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n\r\n/**\r\n * @classdesc ResponseBroker Factory\r\n * @ignore\r\n */\r\nemp3.api.ResponseBrokerFactory = (function () {\r\n  /**\r\n   * ResponseBroker hash\r\n   * @private\r\n   */\r\n  var _responseBrokers = {};\r\n\r\n  return {\r\n    /**\r\n     * @memberof emp3.api.ResponseBrokerFactory\r\n     *\r\n     * Returns the broker based on the origin channel of the message\r\n     * @param {string} channel\r\n     * @returns {emp3.api.ResponseBroker}\r\n     */\r\n    getBroker: function (channel) {\r\n      if (_responseBrokers[channel]) {\r\n        return _responseBrokers[channel];\r\n      }\r\n    },\r\n    /**\r\n     * @memberof emp3.api.ResponseBrokerFactory\r\n     *\r\n     * Registers a response broker to handle an array of CMAPI channels\r\n     * @param {string|string[]} channels\r\n     * @param {emp3.api.ResponseBroker} broker\r\n     */\r\n    registerBroker: function (channels, broker) {\r\n      if (Array.isArray(channels)) {\r\n        for (var channel in channels) {\r\n          if (channels.hasOwnProperty(channel)) {\r\n            _responseBrokers[channels[channel]] = broker;\r\n          }\r\n        }\r\n      } else {\r\n        _responseBrokers[channels] = broker;\r\n      }\r\n    }\r\n  };\r\n})();\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\n/**\r\n * @ignore\r\n * @classdesc The response broker handles messages returned from the core. Specific CMAPI channels must have their own\r\n * specific sub-classed broker described for each channel.  The same broker may be used to support multiple channels\r\n * but each channel may have only one response broker.\r\n */\r\nemp3.api.ResponseBroker = function() {};\r\n\r\n/**\r\n * @abstract\r\n * @param callbacks\r\n * @param details\r\n * @param failures\r\n */\r\nemp3.api.ResponseBroker.prototype.process = function(callbacks, details, failures) {\r\n  window.console.log(callbacks, details, failures);\r\n  throw new Error('Process has not been implemented by this broker');\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @ignore\r\n * @class\r\n * @classdesc Base class for all event classes.\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {Event.enum} args.event - The enumeration value that identifies the specific action/option associated with the event.\r\n * @param {emp3.api.Container} args.target - The container object the event was generated on.\r\n */\r\nemp3.api.events.Event = function(args) {\r\n  args = args || {};\r\n  /** @private */\r\n  var _event = args.event,\r\n      /** @private */\r\n      _target = args.target,\r\n      /** @private */\r\n      _type = args.type;\r\n\r\n  /**\r\n   * An enumeration value specifying the type of event. The type is determined by the instantiated sub-classed\r\n   * event.\r\n   * @const\r\n   * @type {emp3.api.enums.EventType}\r\n   * @name emp3.api.events.Event#type\r\n   */\r\n  Object.defineProperty(this, \"type\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _type; // Determined by the sub-classed event\r\n    }\r\n  });\r\n  /**\r\n   * The enumeration value that identifies the specific action/option associated with the event.\r\n   * @type {Event.enum}\r\n   * @name emp3.api.events.Event#event\r\n   */\r\n  // Although this property is inherited in all subclasses, the documentation will be as well. This means that some subclasses\r\n  // which should display more defined types than what is mentioned in this base class will not unless this property\r\n  // is included in the subclass. Even though functionally it is not required to be included in the subclass.\r\n  Object.defineProperty(this, \"event\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _event;\r\n    }\r\n  });\r\n  /**\r\n   * The container object the event was generated on.\r\n   * @type {emp3.api.Container}\r\n   * @name emp3.api.events.Event#target\r\n   */\r\n  // Although this property is inherited in all subclasses, the documentation will be as well. This means that some subclasses\r\n  // which should display more defined types than what is mentioned in this base class will not unless this property\r\n  // is included in the subclass. Even though functionally it is not required to be included in the subclass.\r\n  Object.defineProperty(this, \"target\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _target;\r\n    }\r\n  });\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Base class for user interaction events on a {@link emp3.api.Map} or {@link emp3.api.Feature}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.UserInteractionEventEnum} args.event - The enumeration value that identifies the type of mouse\r\n * input associated with this event.\r\n * @param {emp3.api.Container} args.target - The container object this event was generated on.\r\n * @param {ScreenCoord} args.point - The x,y coordinate of the screen location where this event occurred.\r\n * @param {emp3.api.GeoPosition} args.position - The geographic coordinate of the location where this event occurred.\r\n * @param {emp3.api.enums.UserInteractionMouseButtonEventEnum} args.button - The enumeration value that identifies the\r\n * mouse button associated with this event.\r\n * @param {emp3.api.enums.UserInteractionKeyEventEnum[]} args.keys - The enumeration values that identify the keyboard\r\n * buttons associated with this event.\r\n */\r\nemp3.api.events.UserInteractionEvent = function(args) {\r\n  args = args || {};\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _keys = args.keys,\r\n      /** @private */\r\n      _button = args.button,\r\n      /** @private */\r\n      _position= args.position,\r\n      /** @private */\r\n      _point= args.point;\r\n\r\n  /**\r\n   * An enumeration value specifying the type of event. The type is determined by the type of interaction\r\n   * and subsequent instantiated sub-classed event.\r\n   * @const\r\n   * @type {emp3.api.enums.EventType}\r\n   * @name emp3.api.events.UserInteractionEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the type of mouse input associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionEventEnum}\r\n   * @name emp3.api.events.UserInteractionEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The container object the event was generated on.\r\n   * @type {emp3.api.Container}\r\n   * @name emp3.api.events.UserInteractionEvent#target\r\n   */\r\n  this.target;\r\n\r\n  /**\r\n   * The x,y coordinate of the screen location where this event occurred.\r\n   * @type {ScreenCoord}\r\n   * @name emp3.api.events.UserInteractionEvent#point\r\n   */\r\n  Object.defineProperty(this, \"point\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _point;\r\n    }\r\n  });\r\n  /**\r\n   * The geographic coordinate of the location where this event occurred.\r\n   * @type {emp3.api.GeoPosition}\r\n   * @name emp3.api.events.UserInteractionEvent#position\r\n   */\r\n  Object.defineProperty(this, \"position\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _position;\r\n    }\r\n  });\r\n  /**\r\n   * The enumeration value that identifies the mouse button associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionMouseButtonEventEnum}\r\n   * @name emp3.api.events.UserInteractionEvent#button\r\n   */\r\n  Object.defineProperty(this, \"button\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _button;\r\n    }\r\n  });\r\n  /**\r\n   * The enumeration values that identify the keyboard buttons associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionKeyEventEnum[]}\r\n   * @name emp3.api.events.UserInteractionEvent#keys\r\n   */\r\n  Object.defineProperty(this, \"keys\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _keys;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.UserInteractionEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n\r\n/**\r\n * @typedef {object} ScreenCoord\r\n * @property {number} x\r\n * @property {number} y\r\n */","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when the user interacts with a {@link emp3.api.Map}.\r\n * @extends emp3.api.events.UserInteractionEvent\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.UserInteractionEventEnum} args.event - The enumeration value that identifies the type of mouse\r\n * input associated with this event.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {ScreenCoord} args.point - The x,y coordinate of the screen location where this event occurred.\r\n * @param {emp3.api.GeoPosition} args.position - The geographic coordinate of the location where this event occurred.\r\n * @param {emp3.api.enums.UserInteractionMouseButtonEventEnum} args.button - The enumeration value that identifies the\r\n * mouse button associated with this event.\r\n * @param {emp3.api.enums.UserInteractionKeyEventEnum[]} args.keys - The enumeration values that identify the keyboard\r\n * buttons associated with this event.\r\n */\r\nemp3.api.events.MapUserInteractionEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_INTERACTION;\r\n  emp3.api.events.UserInteractionEvent.call(this, args);\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_INTERACTION specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_INTERACTION\r\n   * @type {emp3.api.enums.EventType.MAP_INTERACTION}\r\n   * @name emp3.api.events.MapUserInteractionEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the type of mouse input associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionEventEnum}\r\n   * @name emp3.api.events.MapUserInteractionEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapUserInteractionEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The x,y coordinate of the screen location where this event occurred.\r\n   * @type {ScreenCoord}\r\n   * @name emp3.api.events.MapUserInteractionEvent#point\r\n   */\r\n  this.point;\r\n  /**\r\n   * The geographic coordinate of the location where this event occurred.\r\n   * @type {emp3.api.GeoPosition}\r\n   * @name emp3.api.events.MapUserInteractionEvent#position\r\n   */\r\n  this.position;\r\n  /**\r\n   * The enumeration value that identifies the mouse button associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionMouseButtonEventEnum}\r\n   * @name emp3.api.events.MapUserInteractionEvent#button\r\n   */\r\n  this.button;\r\n  /**\r\n   * The enumeration values that identify the keyboard buttons associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionKeyEventEnum[]}\r\n   * @name emp3.api.events.MapUserInteractionEvent#keys\r\n   */\r\n  this.keys;\r\n};\r\n\r\n// Extend emp3.api.events.UserInteractionEvent\r\nemp3.api.events.MapUserInteractionEvent.prototype = Object.create(emp3.api.events.UserInteractionEvent.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when the user moves the mouse on a {@link emp3.api.Map}. Class is\r\n * currently not being instantiated when mouse move occurs. Instead a JSON object\r\n * with relevant information is used.\r\n * @extends emp3.api.events.MapUserInteractionEvent\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.UserInteractionEventEnum} args.event - The enumeration value of\r\n * emp3.api.enums.UserInteractionEventEnum.MOUSE_MOVE that identifies the type of mouse input associated with this event.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {ScreenCoord} args.point - The x,y coordinate of the screen location where this event occurred.\r\n * @param {emp3.api.GeoPosition} args.position - The geographic coordinate of the location where this event occurred.\r\n * @param {emp3.api.enums.UserInteractionMouseButtonEventEnum} args.button - The enumeration value that identifies the\r\n * mouse button associated with this event.\r\n * @param {emp3.api.enums.UserInteractionKeyEventEnum[]} args.keys - The enumeration values that identify the keyboard\r\n * buttons associated with this event.\r\n */\r\nemp3.api.events.MapCursorMoveEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_CURSOR_MOVE;\r\n  emp3.api.events.MapUserInteractionEvent.call(this, args);\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_CURSOR_MOVE specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_CURSOR_MOVE\r\n   * @type {emp3.api.enums.EventType.MAP_CURSOR_MOVE}\r\n   * @name emp3.api.events.MapCursorMoveEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value of emp3.api.enums.UserInteractionEventEnum.MOUSE_MOVE that identifies the type of mouse\r\n   * input associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionEventEnum}\r\n   * @name emp3.api.events.MapCursorMoveEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapCursorMoveEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The x,y coordinate of the screen location where this event occurred.\r\n   * @type {ScreenCoord}\r\n   * @name emp3.api.events.MapCursorMoveEvent#point\r\n   */\r\n  this.point;\r\n  /**\r\n   * The geographic coordinate of the location where this event occurred.\r\n   * @type {emp3.api.GeoPosition}\r\n   * @name emp3.api.events.MapCursorMoveEvent#position\r\n   */\r\n  this.position;\r\n  /**\r\n   * The enumeration value that identifies the mouse button associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionMouseButtonEventEnum}\r\n   * @name emp3.api.events.MapCursorMoveEvent#button\r\n   */\r\n  this.button;\r\n  /**\r\n   * The enumeration values that identify the keyboard buttons associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionKeyEventEnum[]}\r\n   * @name emp3.api.events.MapCursorMoveEvent#keys\r\n   */\r\n  this.keys;\r\n};\r\n\r\n// Extend emp3.api.events.MapUserInteractionEvent\r\nemp3.api.events.MapCursorMoveEvent.prototype = Object.create(emp3.api.events.MapUserInteractionEvent.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated during various phases of a freehand draw operation.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.MapFreehandEventEnum} args.event - The enumeration value identifying the phase of freehand\r\n * draw mode that is associated with this event.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {cmapi.IGeoPositionGroup} args.positionGroup - The ordered list of positions from the free hand drawing operation.\r\n * @param {cmapi.IGeoStrokeStyle} args.style - The style used during the free hand drawing operation.\r\n */\r\nemp3.api.events.MapFreehandEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _style = args.style,\r\n      /** @private */\r\n      _positionGroup = args.positionGroup;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT\r\n   * @type {emp3.api.enums.EventType.MAP_FREEHAND_DRAW_EVENT}\r\n   * @name emp3.api.events.MapFreehandEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value identifying the phase of freehand draw mode that is associated with this event.\r\n   * @type {emp3.api.enums.MapFreehandEventEnum}\r\n   * @name emp3.api.events.MapFreehandEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapFreehandEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The ordered list of positions from the free hand drawing operation.\r\n   * @type {cmapi.IGeoPositionGroup}\r\n   * @name emp3.api.events.MapFreehandEvent#positionGroup\r\n   */\r\n  Object.defineProperty(this, \"positionGroup\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _positionGroup;\r\n    }\r\n  });\r\n  /**\r\n   * The style used during the free hand drawing operation.\r\n   * @type {cmapi.IGeoStrokeStyle}\r\n   * @name emp3.api.events.MapFreehandEvent#style\r\n   */\r\n  Object.defineProperty(this, \"style\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _style;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.MapFreehandEvent.prototype = Object.create(emp3.api.events.Event.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when the user interacts with a {@link emp3.api.Feature} on a {@link emp3.api.Map}.\r\n * @extends emp3.api.events.UserInteractionEvent\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.UserInteractionEventEnum} args.event - The enumeration value that identifies the type of mouse\r\n * input associated with this event.\r\n * @param {emp3.api.Feature[]} args.target - The feature(s) on which this event was triggered.\r\n * @param {ScreenCoord} args.point - The x,y coordinate of the screen location where this event occurred.\r\n * @param {emp3.api.GeoPosition} args.position - The geographic coordinate of the location where this event occurred.\r\n * @param {emp3.api.Map} args.map - The map on which this event was triggered.\r\n * @param {emp3.api.enums.UserInteractionMouseButtonEventEnum} args.button - The enumeration value that identifies the\r\n * mouse button associated with this event.\r\n * @param {emp3.api.enums.UserInteractionKeyEventEnum[]} args.keys - The enumeration values that identify the keyboard\r\n * buttons associated with this event.\r\n */\r\nemp3.api.events.FeatureUserInteractionEvent = function (args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.FEATURE_INTERACTION;\r\n  emp3.api.events.UserInteractionEvent.call(this, args);\r\n  /** @private */\r\n  var _map = args.map;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.FEATURE_INTERACTION specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.FEATURE_INTERACTION\r\n   * @type {emp3.api.enums.EventType.FEATURE_INTERACTION}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the type of mouse input associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionEventEnum}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The feature(s) on which this event was triggered.\r\n   * @type {emp3.api.Feature[]}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The x,y coordinate of the screen location where this event occurred.\r\n   * @type {ScreenCoord}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#point\r\n   */\r\n  this.point;\r\n  /**\r\n   * The geographic coordinate of the location where this event occurred.\r\n   * @type {emp3.api.GeoPosition}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#position\r\n   */\r\n  this.position;\r\n  /**\r\n   * The enumeration value that identifies the mouse button associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionMouseButtonEventEnum}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#button\r\n   */\r\n  this.button;\r\n  /**\r\n   * The enumeration values that identify the keyboard buttons associated with this event.\r\n   * @type {emp3.api.enums.UserInteractionKeyEventEnum[]}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#keys\r\n   */\r\n  this.keys;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.FeatureUserInteractionEvent#map\r\n   */\r\n  Object.defineProperty(this, \"map\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _map;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.UserInteractionEvent\r\nemp3.api.events.FeatureUserInteractionEvent.prototype = Object.create(emp3.api.events.UserInteractionEvent.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Camera} is associated with a {@link emp3.api.Map} and the map's view changes.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.CameraEventEnum} args.event - The enumeration value that identifies the camera state associated\r\n * with this event.\r\n * @param {emp3.api.Camera} args.target - The camera object this event was generated on.\r\n */\r\nemp3.api.events.CameraEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.CAMERA_EVENT;\r\n  emp3.api.events.Event.call(this, args);\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.CAMERA_EVENT specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.CAMERA_EVENT\r\n   * @type {emp3.api.enums.EventType.CAMERA_EVENT}\r\n   * @name emp3.api.events.CameraEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the camera state associated with this event.\r\n   * @type {emp3.api.enums.CameraEventEnum}\r\n   * @name emp3.api.events.CameraEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The camera object this event was generated on.\r\n   * @type {emp3.api.Camera}\r\n   * @name emp3.api.events.CameraEvent#target\r\n   */\r\n  this.target;\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.CameraEvent.prototype = Object.create(emp3.api.events.Event.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Map} view changes.\r\n * @extends emp3.api.events.Event\r\n\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.MapViewEventEnum} args.event - The enumeration value that identifies the map view's\r\n * state associated with this event.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n */\r\nemp3.api.events.MapViewChangeEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_VIEW_CHANGE;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _bounds = this.target.getBounds(),\r\n      /** @private */\r\n      _lookAt = this.target.getLookAt(),\r\n      /** @private */\r\n      _camera = this.target.getCamera();\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_VIEW_CHANGE specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_VIEW_CHANGE\r\n   * @type {emp3.api.enums.EventType.MAP_VIEW_CHANGE}\r\n   * @name emp3.api.events.MapViewChangeEvent#type\r\n   */\r\n\r\n  /**\r\n   * The enumeration value that identifies the map view's state associated with this event.\r\n   * @type {emp3.api.enums.MapViewEventEnum}\r\n   * @name emp3.api.events.MapViewChangeEvent#event\r\n   */\r\n\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapViewChangeEvent#target\r\n   */\r\n\r\n  /**\r\n   * The map's bounds after the event.\r\n   * @type {Bounds}\r\n   * @name emp3.api.events.MapViewChangeEvent#bounds\r\n   */\r\n  Object.defineProperty(this, \"bounds\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _bounds;\r\n    }\r\n  });\r\n  /**\r\n   * The updated lookAt object after the event.\r\n   * @type {emp3.api.LookAt}\r\n   * @name emp3.api.events.MapViewChangeEvent#lookAt\r\n   */\r\n  Object.defineProperty(this, \"lookAt\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _lookAt;\r\n    }\r\n  });\r\n  /**\r\n   * The updated camera object after the event.\r\n   * @type {emp3.api.Camera}\r\n   * @name emp3.api.events.MapViewChangeEvent#camera\r\n   */\r\n  Object.defineProperty(this, \"camera\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _camera;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.MapViewChangeEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when an action occurs on a {@link emp3.api.Container}.\r\n * @extends emp3.api.events.Event\r\n * \r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.ContainerEventEnum} args.event - The enumeration value that identifies the container action associated with this event.\r\n * @param {emp3.api.Container} args.target - The container object this event was generated on.\r\n * @param {emp3.api.Overlay[]|emp3.api.Feature[]} args.affectedChildren - The list of affected child container objects that\r\n * the {@link emp3.api.enums.ContainerEventEnum} action refers to.\r\n */\r\nemp3.api.events.ContainerEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.CONTAINER;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _affectedChildren = args.affectedChildren;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.CONTAINER specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.CONTAINER\r\n   * @type {emp3.api.enums.EventType.CONTAINER}\r\n   * @name emp3.api.events.ContainerEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the container action associated with this event.\r\n   * @type {emp3.api.enums.ContainerEventEnum}\r\n   * @name emp3.api.events.ContainerEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The container object this event was generated on.\r\n   * @type {emp3.api.Container}\r\n   * @name emp3.api.events.ContainerEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The list of affected child container objects.\r\n   * @type {emp3.api.Overlay[]|emp3.api.Feature[]}\r\n   * @name emp3.api.events.ContainerEvent#affectedChildren\r\n   */\r\n  Object.defineProperty(this, \"affectedChildren\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _affectedChildren;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.ContainerEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n\r\n/**\r\n * Returns true if the target container is a {@link emp3.api.Feature}\r\n * @returns {boolean}\r\n */\r\nemp3.api.events.ContainerEvent.prototype.targetIsFeature = function() {\r\n  return emp3.api.isFeature(this.target);\r\n};\r\n\r\n/**\r\n * Returns true if the target container is an {@link emp3.api.Overlay}\r\n * @returns {boolean}\r\n */\r\nemp3.api.events.ContainerEvent.prototype.targetIsOverlay = function() {\r\n  return emp3.api.isOverlay(this.target);\r\n};\r\n\r\n/**\r\n * Returns true if the target container is a {@link emp3.api.Map}\r\n * @returns {boolean}\r\n */\r\nemp3.api.events.ContainerEvent.prototype.targetIsMap = function() {\r\n  return (this.target instanceof emp3.api.Map);\r\n};\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Map} changes state.\r\n * @extends emp3.api.events.Event\r\n\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {emp3.api.enums.MapEventEnum} args.event - The enumeration value indicating the state of\r\n * the map has changed.\r\n * @param {emp3.api.enums.MapStateEnum} args.previousState - The state of the map prior to this event.\r\n */\r\nemp3.api.events.MapStateChangeEvent = function (args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_STATE_CHANGE;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _previousState = args.previousState;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_STATE_CHANGE specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_STATE_CHANGE\r\n   * @type {emp3.api.enums.EventType.MAP_STATE_CHANGE}\r\n   * @name emp3.api.events.MapStateChangeEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value of emp3.api.enums.MapEventEnum.STATE_CHANGE indicating the state of the map\r\n   * has changed.\r\n   * @type {emp3.api.enums.MapEventEnum.STATE_CHANGE}\r\n   * @name emp3.api.events.MapStateChangeEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapStateChangeEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The state of the map at the time this event was generated.\r\n   * @type {emp3.api.enums.MapStateEnum}\r\n   * @name emp3.api.events.MapStateChangeEvent#newState\r\n   */\r\n  Object.defineProperty(this, \"newState\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return this.target.getState();\r\n    }\r\n  });\r\n  /**\r\n   * The state of the map prior to this event.\r\n   * @type {emp3.api.enums.MapStateEnum}\r\n   * @name emp3.api.events.MapStateChangeEvent#previousState\r\n   */\r\n  Object.defineProperty(this, \"previousState\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _previousState;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.MapStateChangeEvent.prototype = Object.create(emp3.api.events.Event.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n *\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Feature} selection state changes.\r\n * @extends {emp3.api.events.Event}\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.FeatureEventEnum} args.event - The enumeration value that identifies the selection state\r\n * associated with this event.\r\n * @param {emp3.api.Feature} args.target - The feature object this event was generated on.\r\n */\r\nemp3.api.events.FeatureEvent = function (args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.FEATURE_EVENT;\r\n  emp3.api.events.Event.call(this, args);\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.FEATURE_EVENT specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.FEATURE_EVENT\r\n   * @type {emp3.api.enums.EventType.FEATURE_EVENT}\r\n   * @name emp3.api.events.FeatureEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the selected state associated with this event.\r\n   * @type {emp3.api.enums.FeatureEventEnum}\r\n   * @name emp3.api.events.FeatureEventEnum#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The feature object being edited that this event was generated on.\r\n   * @type {emp3.api.Feature}\r\n   * @name emp3.api.events.FeatureEvent#target\r\n   */\r\n  this.target;\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.FeatureEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated during the process of drawing a {@link emp3.api.Feature}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.FeatureDrawEventEnum} args.event - The enumeration value that identifies the draw state\r\n * associated with this event.\r\n * @param {emp3.api.Feature} args.target - The feature object being drawn that this event was generated on.\r\n * @param {emp3.api.Map} args.map - The map on which this draw event was triggered.\r\n * @param {Object[]} args.updateList - The list of objects that identifies what was updated in the feature. This only\r\n * applies when the event enumeration value is of type emp3.api.enums.FeatureDrawEventEnum.DRAW_UPDATE.\r\n */\r\nemp3.api.events.FeatureDrawEvent = function (args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.FEATURE_DRAW;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _updateList = args.updateList,\r\n      /** @private */\r\n      _map = args.map;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.FEATURE_DRAW specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.FEATURE_DRAW\r\n   * @type {emp3.api.enums.EventType.FEATURE_DRAW}\r\n   * @name emp3.api.events.FeatureDrawEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the draw state associated with this event.\r\n   * @type {emp3.api.enums.FeatureDrawEventEnum}\r\n   * @name emp3.api.events.FeatureDrawEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The feature object being drawn that this event was generated on.\r\n   * @type {emp3.api.Feature}\r\n   * @name emp3.api.events.FeatureDrawEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The map on which this draw event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.FeatureDrawEvent#map\r\n   */\r\n  Object.defineProperty(this, \"map\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _map;\r\n    }\r\n  });\r\n  /**\r\n   * The list of objects that identifies what was updated in the feature. This property is only populated\r\n   * when the event enumeration value of this event is of type emp3.api.enums.FeatureDrawEventEnum.DRAW_UPDATE.\r\n   * @type {Object[]}\r\n   * @name emp3.api.events.FeatureDrawEvent#updateList\r\n   */\r\n  Object.defineProperty(this, \"updateList\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _updateList;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.FeatureDrawEvent.prototype = Object.create(emp3.api.events.Event.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated during the process of editing a {@link emp3.api.Feature}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.FeatureEditEventEnum} args.event - The enumeration value that identifies the edit state\r\n * associated with this event.\r\n * @param {emp3.api.Feature} args.target - The feature object being edited that this event was generated on.\r\n * @param {emp3.api.Map} args.map - The map on which this edit event was triggered.\r\n * @param {Object[]} args.updateList - The list of objects that identifies what was updated in the feature. This only\r\n * applies when the event enumeration value is of type emp3.api.enums.FeatureEditEventEnum.EDIT_UPDATE.\r\n */\r\nemp3.api.events.FeatureEditEvent = function (args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.FEATURE_EDIT;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _updateList = args.updateList,\r\n      /** @private */\r\n      _map = args.map;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.FEATURE_EDIT specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.FEATURE_EDIT\r\n   * @type {emp3.api.enums.EventType.FEATURE_EDIT}\r\n   * @name emp3.api.events.FeatureEditEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the edit state associated with this event.\r\n   * @type {emp3.api.enums.FeatureEditEventEnum}\r\n   * @name emp3.api.events.FeatureEditEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The feature object being edited that this event was generated on.\r\n   * @type {emp3.api.Feature}\r\n   * @name emp3.api.events.FeatureEditEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The map on which this edit event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.FeatureEditEvent#map\r\n   */\r\n  Object.defineProperty(this, \"map\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _map;\r\n    }\r\n  });\r\n  /**\r\n   * The list of objects that identifies what was updated in the feature. This property is only populated\r\n   * when the event enumeration value of this event is of type emp3.api.enums.FeatureEditEventEnum.EDIT_UPDATE.\r\n   * @type {Object[]}\r\n   * @name emp3.api.events.FeatureEditEvent#updateList\r\n   */\r\n  Object.defineProperty(this, \"updateList\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _updateList;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.FeatureEditEvent.prototype = Object.create(emp3.api.events.Event.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when an update occurs on an {@link emp3.api.Overlay}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.Overlay} args.target - The overlay on which this event was triggered.\r\n */\r\nemp3.api.events.OverlayUpdatedEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.OVERLAY_CHANGE;\r\n  emp3.api.events.Event.call(this, args);\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.OVERLAY_CHANGE specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.OVERLAY_CHANGE\r\n   * @type {emp3.api.enums.EventType.OVERLAY_CHANGE}\r\n   * @name emp3.api.events.OverlayUpdatedEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the specific action/option associated with the event.\r\n   * @type {Event.enum}\r\n   * @name emp3.api.events.OverlayUpdatedEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The overlay on which this event was triggered.\r\n   * @type {emp3.api.Overlay}\r\n   * @name emp3.api.events.OverlayUpdatedEvent#target\r\n   */\r\n  this.target;\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.OverlayUpdatedEvent.prototype = Object.create(emp3.api.events.Event.prototype);","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Feature} has been added to a {@link emp3.api.Map}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {emp3.api.Feature[]} args.features - The features that were added to the map.\r\n */\r\nemp3.api.events.MapFeatureAddedEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_FEATURE_ADDED;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _features = args.features;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_FEATURE_ADDED specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_FEATURE_ADDED\r\n   * @type {emp3.api.enums.EventType.MAP_FEATURE_ADDED}\r\n   * @name emp3.api.events.MapFeatureAddedEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the specific action/option associated with the event.\r\n   * @type {Event.enum}\r\n   * @name emp3.api.events.MapFeatureAddedEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapFeatureAddedEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The features that were added to the map.\r\n   * @type {emp3.api.Feature[]}\r\n   * @name emp3.api.events.MapFeatureAddedEvent#features\r\n   */\r\n  Object.defineProperty(this, \"features\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _features;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.MapFeatureAddedEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Feature} has been removed from a {@link emp3.api.Map}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {emp3.api.Feature[]} args.features - The features that were removed from the map.\r\n */\r\nemp3.api.events.MapFeatureRemovedEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_FEATURE_REMOVED;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _features = args.features;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_FEATURE_REMOVED specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_FEATURE_REMOVED\r\n   * @type {emp3.api.enums.EventType.MAP_FEATURE_REMOVED}\r\n   * @name emp3.api.events.MapFeatureRemovedEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the specific action/option associated with the event.\r\n   * @type {Event.enum}\r\n   * @name emp3.api.events.MapFeatureRemovedEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapFeatureRemovedEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The features that were added to the map.\r\n   * @type {emp3.api.Feature[]}\r\n   * @name emp3.api.events.MapFeatureRemovedEvent#features\r\n   */\r\n  Object.defineProperty(this, \"features\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _features;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.MapFeatureRemovedEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when a {@link emp3.api.Feature} has been updated on a {@link emp3.api.Map}.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.Map} args.target - The map on which this event was triggered.\r\n * @param {emp3.api.Feature[]} args.features - The features that were updated on the map.\r\n */\r\nemp3.api.events.MapFeatureUpdatedEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.MAP_FEATURE_UPDATED;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _features = args.features;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.MAP_FEATURE_UPDATED specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.MAP_FEATURE_UPDATED\r\n   * @type {emp3.api.enums.EventType.MAP_FEATURE_UPDATED}\r\n   * @name emp3.api.events.MapFeatureUpdatedEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the specific action/option associated with the event.\r\n   * @type {Event.enum}\r\n   * @name emp3.api.events.MapFeatureUpdatedEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The map on which this event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.MapFeatureUpdatedEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The features that were added to the map.\r\n   * @type {emp3.api.Feature[]}\r\n   * @name emp3.api.events.MapFeatureUpdatedEvent#features\r\n   */\r\n  Object.defineProperty(this, \"features\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _features;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.MapFeatureUpdatedEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n","if (!window.emp3) {\r\n  emp3 = {};\r\n}\r\nif (!window.emp3.api) {\r\n  emp3.api = {};\r\n}\r\nif (!window.emp3.api.events) {\r\n  emp3.api.events = {};\r\n}\r\n/**\r\n * @class\r\n * @classdesc Generated when an {@link emp3.api.Overlay} or {@link emp3.api.Feature}\r\n * visibility is altered on a specific map.\r\n * @extends emp3.api.events.Event\r\n *\r\n * @param {Object} args - Parameters are provided as members of the args object.\r\n * @param {emp3.api.enums.VisibilityStateEnum} args.event - The enumeration value that identifies the visibility state associated with this event.\r\n * @param {emp3.api.Overlay|emp3.api.Feature} args.target - The container object this event was generated on.\r\n * @param {emp3.api.Map|emp3.api.Overlay|emp3.api.Feature} args.parent - The parent container that contains the target container.\r\n * @param {emp3.api.Map} args.map - The map on which the visibility event was triggered.\r\n */\r\nemp3.api.events.VisibilityEvent = function(args) {\r\n  args = args || {};\r\n  args.type = emp3.api.enums.EventType.VISIBILITY;\r\n  emp3.api.events.Event.call(this, args);\r\n  /** @private */\r\n  var _map = args.map,\r\n      /** @private */\r\n      _parent = args.parent;\r\n\r\n  /**\r\n   * An enumeration value of emp3.api.enums.EventType.VISIBILITY specifying the type of event.\r\n   * @const\r\n   * @default emp3.api.enums.EventType.VISIBILITY\r\n   * @type {emp3.api.enums.EventType.VISIBILITY}\r\n   * @name emp3.api.events.VisibilityEvent#type\r\n   */\r\n  this.type;\r\n  /**\r\n   * The enumeration value that identifies the visibility state associated with this event.\r\n   * @type {emp3.api.enums.VisibilityStateEnum}\r\n   * @name emp3.api.events.VisibilityEvent#event\r\n   */\r\n  this.event;\r\n  /**\r\n   * The container object this event was generated on.\r\n   * @type {emp3.api.Overlay|emp3.api.Feature}\r\n   * @name emp3.api.events.VisibilityEvent#target\r\n   */\r\n  this.target;\r\n  /**\r\n   * The parent container that contains the target container.\r\n   * @type {emp3.api.Map|emp3.api.Overlay|emp3.api.Feature}\r\n   * @name emp3.api.events.VisibilityEvent#parent\r\n   */\r\n  Object.defineProperty(this, \"parent\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _parent;\r\n    }\r\n  });\r\n  /**\r\n   * The map on which the visibility event was triggered.\r\n   * @type {emp3.api.Map}\r\n   * @name emp3.api.events.VisibilityEvent#map\r\n   */\r\n  Object.defineProperty(this, \"map\", {\r\n    enumerable: true,\r\n    get: function () {\r\n      return _map;\r\n    }\r\n  });\r\n};\r\n\r\n// Extend emp3.api.events.Event\r\nemp3.api.events.VisibilityEvent.prototype = Object.create(emp3.api.events.Event.prototype);\r\n\r\n/**\r\n * Returns true if the target container is a {@link emp3.api.Feature}.\r\n * @returns {boolean}\r\n */\r\nemp3.api.events.VisibilityEvent.prototype.targetIsFeature = function() {\r\n  return emp3.api.isFeature(this.target);\r\n};\r\n\r\n/**\r\n * Returns true if the target container is an {@link emp3.api.Overlay}.\r\n * @returns {boolean}\r\n */\r\nemp3.api.events.VisibilityEvent.prototype.targetIsOverlay = function() {\r\n  return emp3.api.isOverlay(this.target);\r\n};","var emp3 = emp3 || {};\r\nemp3.api = emp3.api || {};\r\n\r\n/**\r\n * @memberOf emp\r\n * @method\r\n * @description This function returns an object with all the namespaces and abstract functions required for an environment.  Environments define the pub/sub mechanism and user preference storage\r\n * When developing an environment, the first part of the js file for your environment should be a call to generate a template.\r\n * This template is for the public interface that your map environment will expose.\r\n * All of the internal functions and properties of your map engine should not be added to this template\r\n *\r\n * @return {environmentInterface}\r\n */\r\nemp3.api.createEnvironmentTemplate = function() {\r\n\r\n  /**\r\n   * @ignore\r\n   * @namespace environmentInterface\r\n   * @description A public interface is returned as an environmentInterface instance when\r\n   * emp.createEnvironmentTemplate() is invoked. This is designed to use functional inheritance.\r\n   * Do not use the \"new\" keyword.\r\n   */\r\n  var environmentInterface = {\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @abstract\r\n     * @public\r\n     * @returns {boolean} True if initialization completes, false if initialization fails\r\n     * @param {object} [args] - Optional container for the initialization data\r\n     * @desc This function is used to initialize the environment\r\n     * @method\r\n     */\r\n    init: function(args) { // eslint-disable-line no-unused-vars\r\n      // Create ane EMP Error to notify system that this capability has not been implemented\r\n      emp.typeLibrary.Error({\r\n        message: \"The init method has not been implemented by this environment\"\r\n      });\r\n      // Return false as the initialization failed\r\n      return false;\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface.\r\n     * @abstract\r\n     * @public\r\n     * @returns {boolean} Returns true if the cleanup succeeded, false if there was an issue\r\n     * @desc This method is invoked when a new environment is set.  This is to be used to cleanup before it is replaced\r\n     * @method\r\n     */\r\n    destroy: function() {\r\n      // Create ane EMP Error to notify system that this capability has not been implemented\r\n      emp.typeLibrary.Error({\r\n        message: \"The destroy method has not been implemented by this environment\"\r\n      });\r\n      // Return false as the environment could not be destroyed\r\n      return false;\r\n    },\r\n    /**\r\n     *\r\n     * @param {object} args\r\n     * @returns {boolean}\r\n     */\r\n    createInstance: function(args) { // eslint-disable-line no-unused-vars\r\n      // Create ane EMP Error to notify system that this capability has not been implemented\r\n      emp.typeLibrary.Error({\r\n        message: \"The createInstance method has not been implemented by this environment\"\r\n      });\r\n      // Return false as the environment could not be destroyed\r\n      return false;\r\n    },\r\n    /**\r\n     * @ignore\r\n     * @memberOf environmentInterface\r\n     * @namespace\r\n     * @description Namespace that contains all the implementation information for pub/sub.\r\n     */\r\n    pubSub: {\r\n      /**\r\n       * @memberOf environmentInterface.pubSub\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} True is the message is successfully published, false if it fails\r\n       * @param {object} args - Container for the message info\r\n       * @param {object} args.message - Object containing an object formatted for a specific message channel\r\n       * @param {string} args.channel - Name for the channel being used to publish the message\r\n       * @param {object} args.sender - Info about the sender of the message\r\n       * @desc This function is used to dispatch message on the given channel\r\n       * @method\r\n       */\r\n      publish: function(args) { // eslint-disable-line no-unused-vars\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"pubSub.publish has not been implemented by this environment\"\r\n        });\r\n        // Return false for failure to publish\r\n        return false;\r\n      },\r\n      /**\r\n       * This function is used to dispatch message on the given channel synchronously. Not all calls may be supported\r\n       * in a synchronous fashion.\r\n       * @memberof environmentInterface.pubSub\r\n       * @abstract\r\n       * @public\r\n       * @param args\r\n       * @returns {boolean}\r\n       */\r\n      publishSync: function (args) {// eslint-disable-line no-unused-vars\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"pubSub.publishSync has not been implemented by this environment\"\r\n        });\r\n        // Return false for failure to publish\r\n        return false;\r\n      },\r\n      /**\r\n       * @memberOf environmentInterface.pubSub\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} True is the message is successfully subscribed, false if it fails\r\n       * @param {object} args - Container for the subscription info\r\n       * @param {object} args.callback - Function to be invoked when a message is received on this channel\r\n       * @param {string} args.channel - Name of the messaging channel being subscribed to\r\n       * @desc This function is used subscribe for incoming messages on a given channel\r\n       * @method\r\n       */\r\n      subscribe: function(args) { // eslint-disable-line no-unused-vars\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"pubSub.subscribe has not been implemented by this environment\"\r\n        });\r\n        // Return false for failure to publish\r\n        return false;\r\n      }\r\n    },\r\n    /**\r\n     * @ignore\r\n     * @memberOf engineInterface\r\n     * @namespace\r\n     * @description Namespace that contains all the implementation information for saving and getting user preferences.\r\n     */\r\n    prefs: {\r\n      /**\r\n       * @memberOf environmentInterface.prefs\r\n       * @abstract\r\n       * @public\r\n       * @returns {object | null} Returns the pref object if found, else returns null\r\n       * @param {object} args - Container for the pref info\r\n       * @param {string} args.key - Function to be invoked when a message is received on this channel\r\n       * @desc This function is used subscribe for incoming messages on a given channel\r\n       * @method\r\n       */\r\n      get: function(args) { // eslint-disable-line no-unused-vars\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"prefs.get has not been implemented by this environment\"\r\n        });\r\n        // Return null as the requested pref could not be returned\r\n        return null;\r\n      },\r\n      /**\r\n       * @memberOf environmentInterface.prefs\r\n       * @abstract\r\n       * @public\r\n       * @returns {boolean} Returns true if the pref is saved, else returns false\r\n       * @param {object} args - Container for the pref info\r\n       * @param {string} args.key - Function to be invoked when a message is received on this channel\r\n       * @desc This function is used subscribe for incoming messages on a given channel\r\n       * @method\r\n       */\r\n      set: function(args) { // eslint-disable-line no-unused-vars\r\n        // Create ane EMP Error to notify system that this capability has not been implemented\r\n        emp.typeLibrary.Error({\r\n          message: \"prefs.set has not been implemented by this environment\"\r\n        });\r\n        // Return null as the requested pref could not be returned\r\n        return false;\r\n      }\r\n    },\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @type string\r\n     * @description Name of the environment.\r\n     */\r\n    name: \"Unnamed Environment\",\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @type string\r\n     * @description Version of the environment.\r\n     */\r\n    version: \"1.0.0\",\r\n    /**\r\n     * @memberOf environmentInterface\r\n     * @type object\r\n     * @description Free form object to store properties that may need to be passed to the environment for it to function correctly.\r\n     *\r\n     */\r\n    properties: {},\r\n    sender: {\r\n      id: \"not-set\"\r\n    }\r\n  };\r\n\r\n  // returns a copy of the environmentInterface template object that will have\r\n  // its methods and properties overridden by an environment definition\r\n  return environmentInterface;\r\n};\r\n","/*global mil, OWF, Ozone */\r\n/* eslint-disable no-console */\r\nemp3.api.environment = emp3.api.environment || {};\r\nemp3.api.environment.owf = (function() {\r\n  var template = emp3.api.createEnvironmentTemplate(),\r\n    owfJsLocation = \"/owf/js-min/owf-widget-min.js\",\r\n\r\n    /**\r\n     * Widget State\r\n     * @method\r\n     * @memberOf emp.environment.owf\r\n     * @type {String}\r\n     * @private\r\n     */\r\n    widgetState = null,\r\n    /**\r\n     * Widget Eventing Controller Container\r\n     * @method\r\n     * @memberOf emp.environment.owf\r\n     * @type {object}\r\n     * @private\r\n     */\r\n    widgetEventingController = null,\r\n    // function that will be invoked once the OWF environment is done initializing following the .int() invocation\r\n    initCallback,\r\n    shutdownCallback,\r\n    owfReadyCallbackQueue = [];\r\n\r\n  function addToOWFQueue(callback) {\r\n    if (console) {\r\n      console.log(\"Callback added to OWF queue\");\r\n    }\r\n    owfReadyCallbackQueue.push(callback);\r\n  }\r\n  // OWF does not exist on page and needs to be loaded\r\n  // Create temporary namespace\r\n  if (!window.hasOwnProperty(\"OWF\")) {\r\n    window.OWF = {};\r\n  }\r\n  // If OWF.ready is called between now and the time ozone loads,\r\n  // it will be redirected to this function.  Once Ozone loads, Ozone will\r\n  // take over.  In the meantime, we will store all the callbacks passed in\r\n  // and pass them over to Ozone after it loads.\r\n  if (!window.OWF.hasOwnProperty(\"ready\")) {\r\n    window.OWF.ready = addToOWFQueue;\r\n  }\r\n\r\n  function loadScript(args) {\r\n\r\n    // The above code is simple but does not generate an error\r\n    // if the request generates the \"Blocked loading mixed active content \" error.\r\n    var script = document.createElement(\"script\");\r\n    script.type = \"text/javascript\";\r\n\r\n    if (script.readyState) { //IE\r\n      script.onreadystatechange = function() {\r\n        script.intervalCount = 50;\r\n        script.timer = setInterval(function() {\r\n          if (script.readyState === 'loaded' || script.readyState === 'complete') {\r\n            // IE does not report error.\r\n            // So if the object does not exists we wait\r\n            // for a few cycles before failing.\r\n            if (window[args.objectToLoad] === undefined) {\r\n              script.intervalCount--;\r\n              if (script.intervalCount === 0) {\r\n                clearInterval(script.timer);\r\n                args.failedcallback();\r\n              }\r\n            } else {\r\n              clearInterval(script.timer);\r\n              args.callback();\r\n            }\r\n          } else {\r\n            script.intervalCount--;\r\n            if (script.intervalCount === 0) {\r\n              clearInterval(script.timer);\r\n              args.failedcallback();\r\n            }\r\n          }\r\n\r\n        }, 100);\r\n        script.onreadystatechange = null;\r\n      };\r\n    } else { //Others\r\n      script.onerror = function() {\r\n        console.error(\"An error was found loading the script: \" + args.url);\r\n        args.failedcallback();\r\n      };\r\n      script.onload = function() {\r\n        // We need to make sure the object is there.\r\n        // The server may have sent an html page with\r\n        // error text on it.\r\n        if (window[args.objectToLoad] === undefined) {\r\n          console.error(\"An error was found loading the script: \" + args.url);\r\n          args.failedcallback();\r\n        } else {\r\n          args.callback();\r\n        }\r\n      };\r\n    }\r\n    script.src = args.url;\r\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n  }\r\n\r\n  /**\r\n   * Calls the map configuration service and determines how the map is set up.\r\n   * The configuration is returned to the caller.\r\n   */\r\n  function getConfig(args) {\r\n    var xhr, data;\r\n    // If config data has already been set up, use that.  Otherwise\r\n    // continue on and pull from the config service.  \r\n    if (console && console.hasOwnProperty(\"log\")) {\r\n      console.log(\"Loading map config to get path for OWF from: \" + args.path);\r\n    }\r\n    if (emp3.api.environment.appSetup.configData) {\r\n      emp3.api.environment.appSetup.config = emp3.api.environment.appSetup.configData;\r\n      args.callback();\r\n    } else {\r\n\r\n      xhr = new XMLHttpRequest();\r\n      xhr.open('GET', encodeURI(args.path));\r\n      xhr.onload = function() {\r\n        try {\r\n          if (xhr.status === 200) {\r\n            data = JSON.parse(xhr.responseText);\r\n            emp3.api.environment.appSetup.config = data;\r\n            args.callback();\r\n          } else {\r\n            args.fail(args);\r\n          }\r\n        } catch (e) {\r\n          if (console && console.hasOwnProperty(\"log\")) {\r\n            console.log(\"CP CE Map API: An error occurred while trying to load the OWF js file from: \" + args.path + \"  Error: \" + e.message);\r\n          }\r\n          args.fail(args);\r\n        }\r\n      };\r\n      xhr.send();\r\n\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes state event handling\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   * @param  {String} sender\r\n   * @param  {String} msg\r\n   */\r\n  function handleStateEvent(sender, msg) {\r\n    // Overrides the map close, first sends out event, then closes the \r\n    // map.        \r\n    if (msg.eventName === \"beforeclose\") {\r\n      if (shutdownCallback) {\r\n        shutdownCallback();\r\n      }\r\n      widgetState.removeStateEventOverrides({\r\n        events: ['beforeclose'],\r\n        callback: function() {\r\n          widgetState.closeWidget();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initalized Widget to OWF\r\n   * @method\r\n   * @memberOf emp.environment.owf\r\n   */\r\n  function mapInit() {\r\n    var i,\r\n      widgetLauncher;\r\n\r\n    // Check to see what version of Ozone we are running.  If\r\n    // we are running an older version of Ozone, we need to map the\r\n    // old calls to the new function calls.\r\n    switch (template.version) {\r\n      case \"3.5.0-GA\":\r\n      case \"3.6.0-GA\":\r\n      case \"3.7.0-GA\":\r\n      case \"3.8.0-GA\":\r\n      case \"3.8.1-GA\":\r\n        widgetEventingController = new Ozone.eventing.Widget(template.properties.rpcRelayPath);\r\n\r\n        // These version do not have OWF defined.\r\n        window.OWF = Ozone;\r\n        OWF.Eventing = widgetEventingController;\r\n        OWF.getInstanceId = function() {\r\n          return JSON.parse(widgetEventingController.getWidgetId()).id;\r\n        };\r\n\r\n        // We also need to get the instanceName, widgetName and universalName of the widget as shown below in \r\n        // the default case.  Did not put this in yet, waiting for 3.5 backwards compatibility.\r\n        template.sender.id = JSON.parse(widgetEventingController.getWidgetId()).id;\r\n        OWF.Preferences = Ozone.pref.PrefServer;\r\n        widgetLauncher = new Ozone.launcher.WidgetLauncher(this.widgetEventingController);\r\n        OWF.Launcher = {};\r\n        OWF.Launcher.launch = widgetLauncher.launchWidget;\r\n\r\n        break;\r\n      case \"4.0.0-GA\":\r\n        widgetEventingController = new Ozone.eventing.Widget(template.properties.rpcRelayPath);\r\n\r\n        // These version do not have OWF defined.\r\n        window.OWF = Ozone.Widget;\r\n        OWF.Eventing = widgetEventingController;\r\n        OWF.getInstanceId = function() {\r\n          return JSON.parse(widgetEventingController.getWidgetId()).id;\r\n        };\r\n\r\n        template.sender.id = JSON.parse(widgetEventingController.getWidgetId()).id;\r\n        OWF.Preferences = Ozone.pref.PrefServer;\r\n        widgetLauncher = new Ozone.launcher.WidgetLauncher(this.widgetEventingController);\r\n        OWF.Launcher = {};\r\n        OWF.Launcher.launch = widgetLauncher.launchWidget;\r\n\r\n        // We also need to get the instanceName, widgetName and universalName of the widget as shown below in \r\n        // the default case.  Did not put this in yet, waiting for 3.5 backwards compatibility.\r\n\r\n        break;\r\n\r\n      default:\r\n        OWF.relayFile = this.rpcRelayPath;\r\n        widgetEventingController = new Ozone.eventing.Widget(this.rpcRelayPath);\r\n\r\n        widgetState = Ozone.state.WidgetState.getInstance({\r\n          widgetEventingController: widgetEventingController,\r\n          autoInit: true,\r\n          onStateEventReceived: handleStateEvent\r\n        });\r\n        // Override the widget state event handler beforeclose event.  This\r\n        // will prevent the map from closing when a user clicks to close the map.\r\n        // We want to intercept the event and send out a proper close instead.\r\n        widgetState.addStateEventOverrides({\r\n          events: [\"beforeclose\"]\r\n        });\r\n\r\n        var widgetGuid = OWF.getWidgetGuid();\r\n        // used for sender id comparisons to ignore messages we send\r\n        template.sender.id = OWF.getInstanceId();\r\n\r\n        // Retrieve the name and universal name of this widget.\r\n        OWF.Preferences.getWidget({\r\n          widgetId: widgetGuid,\r\n          onSuccess: function(results) {\r\n            template.properties.widgetName = results.value.originalName;\r\n            template.properties.universalName = results.value.universalName;\r\n          },\r\n          onFailure: function() {\r\n            template.properties.widgetName = \"\";\r\n            template.properties.universalName = \"\";\r\n          }\r\n        });\r\n\r\n        break;\r\n    }\r\n\r\n    if (initCallback !== undefined && initCallback !== null) {\r\n      initCallback({\r\n        success: true\r\n      });\r\n    }\r\n    // Ozone loaded, but if users tried to access the OWF.ready\r\n    // event, we need to pass our queue of callbacks to Ozone.\r\n\r\n    for (i = 0; i < owfReadyCallbackQueue.length; i += 1) {\r\n      OWF.ready(owfReadyCallbackQueue[i]);\r\n    }\r\n  }\r\n\r\n  function initialize() {\r\n\r\n    var scriptLoadAttempt = false;\r\n\r\n    if (window.OWF !== undefined &&\r\n      OWF.ready &&\r\n      OWF.getContainerVersion) {\r\n      if (console) {\r\n        console.log(\"CP CE Map API: OWF already exits no need to load OWf JS file\");\r\n      }\r\n      template.version = OWF.getContainerVersion();\r\n\r\n      OWF.ready(mapInit);\r\n    } else if (window.Ozone !== undefined) {\r\n      if (console) {\r\n        console.log(\"CP CE Map API: Running under Ozone namespace no need to load OWF JS file\");\r\n      }\r\n      Ozone.pref.PrefServer.getServerVersion({\r\n        onSuccess: function(version) {\r\n          template.version = version.serverVersion;\r\n\r\n          mapInit();\r\n        }\r\n      });\r\n    } else if (!scriptLoadAttempt) {\r\n      if (console) {\r\n        console.log(\"CP CE Map API: OWF does not already exist attempting to load OWF JS file\");\r\n      }\r\n      scriptLoadAttempt = true;\r\n      if (emp3.api.environment.hasOwnProperty(\"appSetup\") &&\r\n        emp3.api.environment.appSetup.hasOwnProperty(\"config\") &&\r\n        emp3.api.environment.appSetup.config.hasOwnProperty(\"owfJsLocation\")) {\r\n        owfJsLocation = emp3.api.environment.appSetup.config.owfJsLocation;\r\n      }\r\n\r\n      loadScript({\r\n        objectToLoad: \"Ozone\",\r\n        url: owfJsLocation,\r\n        failedcallback: function() {\r\n          if (console) {\r\n            console.log(\"The OWF javaScript file was not included on the page and was not able to load from the URL: \" + owfJsLocation + \". Please correct the URL to point to a valid location for this file in the CPCE Map Configuration Page.\");\r\n          }\r\n          initCallback({\r\n            success: false\r\n          });\r\n        },\r\n        callback: function() {\r\n          if (console) {\r\n            console.log(\"The OWF javaScript file successfully loaded from the URL: \" + owfJsLocation);\r\n          }\r\n          initialize();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n\r\n  template.name = \"Ozone Widget Framework\";\r\n\r\n  template.init = function(args) {\r\n\r\n    if (args !== undefined && args !== null) {\r\n      initCallback = args.initcallback;\r\n      shutdownCallback = args.shutdowncallback;\r\n    }\r\n\r\n    // Ensure the emp3.api.envrionemnt.appSetup namespace exists\r\n    if (!emp3.api.environment.hasOwnProperty(\"appSetup\")) {\r\n      emp3.api.environment.appSetup = {};\r\n    }\r\n    // Ensure a value for emp3.api.environment.appSetup.configLocation exists\r\n    if (!emp3.api.environment.appSetup.hasOwnProperty(\"configLocation\")) {\r\n      emp3.api.environment.appSetup.configLocation = \"/cpce-map/config/getMapConfiguration\";\r\n    }\r\n    // OWF exists on page so dont try to load the OWF JavaScript file\r\n    if ((window.OWF !== undefined &&\r\n        OWF.ready &&\r\n        OWF.getContainerVersion) || window.Ozone !== undefined) {\r\n      initialize();\r\n    } else {\r\n\r\n      getConfig({\r\n        path: emp3.api.environment.appSetup.configLocation,\r\n        callback: initialize,\r\n        fail: function() {\r\n          if (window.console && window.console.hasOwnProperty(\"error\")) {\r\n            console.error(\"Could not find map configuration service at : \" + emp3.api.environment.appSetup.configLocation + \".  Loading OWF js file from default location.\");\r\n          }\r\n          // Still attempt to load from default location, but report an error.\r\n          initialize();\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Spawns EMP as a map widget in the Ozone environment.\r\n   * @param  {Object} args Parameters are passed in as part of the args object\r\n   * @param  {String} args.id The id of the widget being launched\r\n   */\r\n  template.createInstance = function(args) {\r\n\r\n    var transactionId = emp3.api.createGUID(),\r\n      senderId;\r\n\r\n    if (args) {\r\n\r\n      if (args.hasOwnProperty(\"containerId\")) {\r\n\r\n        // This only applies to Ozone.  If Ozone is not defined\r\n        // than we cannot do anything.\r\n        if (window.OWF) {\r\n\r\n          // handle a case where user doesn't pass in anything\r\n          // for arguments\r\n          args = args || {};\r\n\r\n          senderId = OWF.getInstanceId();\r\n\r\n          if (senderId) {\r\n\r\n            if (OWF.hasOwnProperty(\"Preferences\")) {\r\n              OWF.Preferences.findWidgets({\r\n                searchParams: {\r\n                  widgetName: args.containerId,\r\n                  widgetNameExactMatch: true\r\n                },\r\n                onSuccess: function(result) {\r\n                  // extra code to handle Ozone 3.5-4.0\r\n                  if (result.rows !== undefined) {\r\n                    OWF.Launcher.launch({\r\n                        data: JSON.stringify({\r\n                          senderId: transactionId\r\n                        }),\r\n                        guid: result.rows[0].path,\r\n                        launchOnlyIfClosed: true\r\n                      },\r\n                      function() {\r\n                        if (window.hasOwnProperty(\"console\")) {\r\n                          console.log(\"OWF.Launcher.launch succeeded\");\r\n                        }\r\n                      },\r\n                      function() {\r\n                        if (window.hasOwnProperty(\"console\")) {\r\n                          console.log(\"OWF.Launcher.launch failed\");\r\n                        }\r\n                      });\r\n                  } else {\r\n                    OWF.Launcher.launch({\r\n                        data: JSON.stringify({\r\n                          senderId: transactionId\r\n                        }),\r\n                        guid: result[0].id,\r\n                        launchOnlyIfClosed: true\r\n                      },\r\n                      function() {});\r\n                  }\r\n                },\r\n                onFailure: function() {}\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  template.pubSub.publish = function(args) {\r\n    var success = false;\r\n    try {\r\n      if (args.sender) {\r\n        OWF.Eventing.publish(args.channel, args.message, args.sender);\r\n        success = true;\r\n      } else {\r\n        OWF.Eventing.publish(args.channel, args.message);\r\n        success = true;\r\n      }\r\n    } catch (ignore) {\r\n      // do nothing\r\n    }\r\n    return success;\r\n  };\r\n\r\n  template.pubSub.subscribe = function(args) {\r\n    var success = false;\r\n    try {\r\n      OWF.Eventing.subscribe(args.channel, args.callback);\r\n      success = true;\r\n    } catch (ignore) {\r\n      // do nothing\r\n    }\r\n    return success;\r\n  };\r\n  // Default path for the OWF rpc relay file needed for corss domain data transfer between widgets\r\n  template.properties.rpcRelayPath = 'rpc_relay.uncompressed.html';\r\n\r\n  return template;\r\n\r\n\r\n}());\r\n/* eslint-enable no-console */\r\n","/*global mil, emp, emp3 */\r\nemp3.api.environment = emp3.api.environment || {};\r\nemp3.api.environment.browser = (function() {\r\n  var template = emp3.api.createEnvironmentTemplate(),\r\n    senderId = emp3.api.createGUID();\r\n  template.sender = {\r\n    id: senderId\r\n  };\r\n\r\n  template.name = \"Browser\";\r\n\r\n  template.init = function(args) {\r\n    if (args) {\r\n      if (args.hasOwnProperty(\"initcallback\")) {\r\n        args.success = true;\r\n        args.initcallback(args);\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Adds an instance of the map into a div specified by user.  The map\r\n   * in turn will send a message back to the caller indicating the instanceId\r\n   * of the map.\r\n   */\r\n  template.createInstance = function(args) {\r\n    var result = false;\r\n\r\n    // Make sure all the required arguments are passed in.\r\n    if (args) {\r\n      if (args.hasOwnProperty(\"containerId\") &&\r\n        args.hasOwnProperty(\"messageId\")) {\r\n\r\n        // Instantiate the map in the container specified.\r\n        emp.instanceManager.createInstance({\r\n          instanceDomId: args.containerId,\r\n          messageId: args.messageId,\r\n          extent: args.extent,\r\n          engine: args.engine,\r\n          recorder: args.recorder,\r\n          environment: args.environment\r\n        });\r\n\r\n        // Indicate the an attempt to instantiate the map\r\n        // was made without error.\r\n        result = true;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  template.destroyInstance = function(args) {\r\n    var result = false;\r\n\r\n    // Make sure all the required arguments are passed in.\r\n    if (args) {\r\n      if (args.hasOwnProperty(\"id\")) {\r\n\r\n        // Destroy the map with the specified id.\r\n        emp.instanceManager.destroyInstance({\r\n          mapInstanceId: args.id,\r\n          messageId: args.messageId\r\n        });\r\n\r\n        result = true;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  template.pubSub.publish = function(args) {\r\n    var message = {\r\n      channel: args.channel,\r\n      message: args.message,\r\n      sender: template.sender\r\n    };\r\n\r\n    emp.recorder.log({\r\n      timestamp: Date.now(),\r\n      logEntry: args      \r\n    });\r\n\r\n    if(args.hasOwnProperty(\"dest\")){\r\n      message.dest = args.dest;\r\n    }\r\n    var rc = emp.environment.browser.mediator.publish(message);\r\n    if (rc.success) {\r\n      return true;\r\n    } else {\r\n      throw new Error(rc.message);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Synchronous calls publishing\r\n   * @param {object} args\r\n   */\r\n  template.pubSub.publishSync = function (args) {\r\n    var message = {\r\n      channel: args.channel,\r\n      message: args.message,\r\n      sender: template.sender\r\n    };\r\n\r\n    emp.recorder.log({\r\n      timestamp: Date.now(),\r\n      logEntry: args\r\n    });\r\n\r\n    if(args.hasOwnProperty(\"dest\")){\r\n      message.dest = args.dest;\r\n    }\r\n\r\n    return emp.environment.browser.mediator.publishSynch(message);\r\n  };\r\n\r\n  template.pubSub.subscribe = function(args) {\r\n    var success = false;\r\n\r\n    emp.environment.browser.mediator.subscribe({\r\n      channel: args.channel,\r\n      callback: args.callback\r\n    });\r\n    success = true;\r\n\r\n    return success;\r\n  };\r\n\r\n  return template;\r\n}());\r\n","/*global mil, com */\r\n/* eslint-disable */\r\nemp3.api.environment = emp3.api.environment || {};\r\nemp3.api.environment.starfish = (function () {\r\n  var template = emp3.api.createEnvironmentTemplate(),\r\n    nerve,\r\n    scriptLoadAttempt = false,\r\n    starfishjslocation = \"js/environment/starfish/com.octabits.starfish.js\";\r\n\r\n  template.name = \"Starfish\";\r\n\r\n\r\n  function loadScript(args) {\r\n\r\n    // The above code is simple but does not generate an error\r\n    // if the request generates the \"Blocked loading mixed active content \" error.\r\n    var script = document.createElement(\"script\");\r\n    script.type = \"text/javascript\";\r\n\r\n    if (script.readyState) { //IE\r\n      script.onreadystatechange = function () {\r\n        script.intervalCount = 50;\r\n        script.timer = setInterval(function () {\r\n          if (script.readyState === 'loaded' || script.readyState === 'complete') {\r\n            // IE does not report error.\r\n            // So if the object does not exists we wait\r\n            // for a few cycles before failing.\r\n            if (window[args.objectToLoad] === undefined) {\r\n              script.intervalCount--;\r\n              if (script.intervalCount === 0) {\r\n                clearInterval(script.timer);\r\n                args.failedcallback();\r\n              }\r\n            } else {\r\n              clearInterval(script.timer);\r\n              args.callback();\r\n            }\r\n          } else {\r\n            script.intervalCount--;\r\n            if (script.intervalCount === 0) {\r\n              clearInterval(script.timer);\r\n              args.failedcallback();\r\n            }\r\n          }\r\n\r\n        }, 100);\r\n        script.onreadystatechange = null;\r\n      };\r\n    } else { //Others\r\n      script.onerror = function () {\r\n        console.log(\"An error was found loading the script\");\r\n        args.failedcallback();\r\n      };\r\n      script.onload = function () {\r\n        // We need to make sure the object is there.\r\n        // The server may have sent an html page with\r\n        // error text on it.\r\n        console.log(\"Script loaded successfully.\");\r\n        if (window[args.objectToLoad] === undefined) {\r\n          args.failedcallback();\r\n        } else {\r\n          args.callback();\r\n        }\r\n      };\r\n    }\r\n    script.src = args.url;\r\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n  }\r\n\r\n  function initialize() {\r\n    if (window.com !== undefined &&\r\n      window.com.octabits !== undefined &&\r\n      window.com.octabits.starfish !== undefined) {\r\n      nerve = new com.octabits.starfish.Nerve();\r\n      template.sender.id = nerve.id;\r\n      initCallback({\r\n            success: true\r\n          });\r\n    } else if (!scriptLoadAttempt) {\r\n      scriptLoadAttempt = true;\r\n      loadScript({\r\n        objectToLoad: \"com\",\r\n        url: starfishjslocation,\r\n        failedcallback: function () {\r\n          initCallback({\r\n            success: false\r\n          });\r\n        },\r\n        callback: function () {\r\n          initialize();\r\n        }\r\n      });\r\n    }\r\n  }\r\n  template.init = function (args) {\r\n\r\n\r\n    if (args) {\r\n      if (args.hasOwnProperty(\"initcallback\")) {\r\n        initCallback = args.initcallback;\r\n      }\r\n    }\r\n    initialize();\r\n  };\r\n\r\n  template.pubSub.publish = function (args) {\r\n    var success = false;\r\nif(nerve !== undefined){\r\n    nerve.publish({\r\n      channel: args.channel,\r\n      message: args.message\r\n    });\r\n}\r\n    success = true;\r\n\r\n    return success;\r\n  };\r\n\r\n  template.pubSub.subscribe = function (args) {\r\n    var success = false;\r\n\r\n    nerve.subscribe({\r\n      channel: args.channel,\r\n      callback: args.callback\r\n    });\r\n    success = true;\r\n\r\n    return success;\r\n  };\r\n\r\n  return template;\r\n}());\r\n/* eslint-enable */\r\n","/*global emp3, ozpIwc */\r\nemp3.api.environment = emp3.api.environment || {};\r\nemp3.api.environment.iwc = (function() {\r\n    var template = emp3.api.createEnvironmentTemplate();\r\n    var iwcClient;\r\n    var channelLookup = {};\r\n    var callbackLookup = {};\r\n    var adjustChannelName = function(channelName) {\r\n        return \"/cmapi_\" + channelName.replace(/\\./g, '_');\r\n    };\r\n    var revertChannelName = function(channelName) {\r\n        channelName = channelName.replace(\"/cmapi_\", \"\");\r\n        return channelName.replace(/\\_/g, '.');\r\n    };\r\n    var receiveMessage = function(event) {\r\n        var msg = event.newValue,\r\n            callback,\r\n            callbackList;\r\n        if (msg.sender.id !== iwcClient.address) {\r\n            callbackList = callbackLookup[msg.channel];\r\n            for (callback in callbackList) {\r\n                if (callbackList.hasOwnProperty(callback) && typeof callbackList[callback] === \"function\") {\r\n                    callbackList[callback](msg.sender, msg.msg, revertChannelName(msg.channel));\r\n                }\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    template.name = \"Ozone Platform Inter Widget Communication (IWC)\";\r\n\r\n    template.version = \"1.0.0\";\r\n\r\n    template.properties = {};\r\n    template.sender = { id: \"not-set\" };\r\n    template.iwcHost = \"vendor/iwc/\";\r\n\r\n    template.init = function(args) {\r\n        var success = false;\r\n        if (ozpIwc !== undefined && ozpIwc !== null && typeof ozpIwc.hasOwnProperty === \"function\" && ozpIwc.hasOwnProperty(\"Client\")) {\r\n            iwcClient = new ozpIwc.Client(this.iwcHost);\r\n            var closureArgs = args;\r\n            iwcClient.connect().then(function() {\r\n                console.log(\"emp3 IWC Environment instance connected: \"+iwcClient.address); // eslint-disable-line no-console\r\n                closureArgs.initcallback({\r\n                    success: true\r\n                });\r\n                template.sender.id = iwcClient.address;\r\n\r\n            }).catch(function(err) {\r\n                console.error(\"IWC Client failed to connect:\", err);\r\n            });\r\n            success = true;\r\n\r\n        } else {\r\n            console.error(\"The Ozone Platform IWC JavaScript was not found on this page.  Please ensure that the path to ozpIwc-client.js on your app is correct\");\r\n\r\n            args.initcallback({\r\n                success: false\r\n            });\r\n        }\r\n        return success;\r\n    };\r\n\r\n    template.destroy = function() {\r\n        iwcClient.disconnect();\r\n\r\n        return true;\r\n    };\r\n    template.createInstance = function() {\r\n\r\n        return true;\r\n    };\r\n\r\n    function getChannel(achannel) {\r\n        var channel = channelLookup[achannel];\r\n        if (channel === undefined || channel === null) {\r\n            // Setting lifespan to Bound makes sure the data at this reference is removed once all active IWC refs are removed\r\n            channelLookup[achannel] = new iwcClient.data.Reference(achannel, { \"lifespan\": \"Bound\", \"respondOn\": \"all\" });\r\n            channel = channelLookup[achannel];\r\n        }\r\n        return channel;\r\n    }\r\n\r\n    template.pubSub.publish = function(args) {\r\n        var cName = adjustChannelName(args.channel);\r\n        var channel = getChannel(cName);\r\n        channel.set({\r\n            msg: args.message,\r\n            channel: cName,\r\n            sender: {\r\n                id: iwcClient.address\r\n            }\r\n        }).catch(function(err) {\r\n            console.error(\"ERROR publishing core message: \" + cName + \" - \" + JSON.stringify(err));\r\n        });\r\n        return true;\r\n    };\r\n\r\n    template.pubSub.subscribe = function(args) {\r\n        var cName = adjustChannelName(args.channel);\r\n        var channel = getChannel(cName);\r\n        if (callbackLookup[cName] !== undefined) {\r\n            callbackLookup[cName][args.callback] = args.callback;\r\n        } else {\r\n            callbackLookup[cName] = {};\r\n            callbackLookup[cName][args.callback] = args.callback;\r\n        }\r\n        channel.watch(receiveMessage);\r\n    };\r\n\r\n    return template;\r\n}());\r\n"]}