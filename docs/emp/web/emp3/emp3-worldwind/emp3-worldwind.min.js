/*! emp3-web-sdk 2.6.0 30-06-2017 */

var EMPWorldWind=window.EMPWorldWind||{};var emp=window.emp||{};emp.engineDefs=emp.engineDefs||{};emp.engineDefs.worldWindMapEngine=function(args){var empMapInstance=args.mapInstance;var empWorldWind;var engineInterface=emp.map.createEngineTemplate(),mapEngineExposed=engineInterface;engineInterface.implementation.displayName="WorldWind Map Engine";engineInterface.implementation.version="1.0.0";engineInterface.capabilities.mapType.type3D=true;engineInterface.capabilities.mapType.type2_5D=true;engineInterface.capabilities.mapType.type3D=true;engineInterface.capabilities.formats.GEOJSON_BASIC.plot=true;engineInterface.capabilities.formats.GEOJSON_BASIC.draw=true;engineInterface.capabilities.formats.GEOJSON_BASIC.edit=true;engineInterface.capabilities.formats.GEOJSON_FULL.plot=true;engineInterface.capabilities.formats.GEOJSON_FULL.edit=true;engineInterface.capabilities.formats.WMS.version_1_1=true;engineInterface.capabilities.formats.WMS.version_1_3=true;engineInterface.capabilities.formats.WMS.elevationData=true;engineInterface.capabilities.formats.KML_BASIC.plot=true;engineInterface.capabilities.formats.KML_BASIC.draw=true;engineInterface.capabilities.formats.KML_BASIC.edit=true;engineInterface.capabilities.formats.KML_COMPLEX.plot=true;engineInterface.capabilities.formats.IMAGE.plot=true;engineInterface.capabilities.formats.MILSTD.version2525B.plot=true;engineInterface.capabilities.formats.MILSTD.version2525B.draw=true;engineInterface.capabilities.formats.MILSTD.version2525B.edit=true;engineInterface.capabilities.formats.MILSTD.version2525C.plot=true;engineInterface.capabilities.formats.MILSTD.version2525C.draw=true;engineInterface.capabilities.formats.MILSTD.version2525C.edit=true;engineInterface.capabilities.formats.AIRSPACE.plot=true;engineInterface.capabilities.formats.AIRSPACE.draw=true;engineInterface.capabilities.formats.AIRSPACE.edit=true;engineInterface.capabilities.formats.AOI.plot=true;engineInterface.capabilities.formats.AOI.draw=true;engineInterface.capabilities.formats.AOI.edit=true;engineInterface.capabilities.settings.milstd.iconSize=true;engineInterface.capabilities.settings.milstd.labelOption=true;engineInterface.requirements.wmsCapabilities=true;engineInterface.capabilities.projection.flat=false;engineInterface.initialize.succeed=function(empWorldWindInstance){try{empWorldWind=empWorldWindInstance;empWorldWind.mapEngineExposed=mapEngineExposed;emp.map.engineDirect={name:"worldwind",ref:empWorldWind};empMapInstance.eventing.StatusChange({status:emp.map.states.READY})}catch(err){window.console.error("Error initializing WorldWind ",err)}};engineInterface.initialize.fail=function(){empMapInstance.eventing.StatusChange({status:emp.map.states.MAP_INSTANCE_INIT_FAILED})};engineInterface.view.set=function(transaction){var args,altitude,bottomLeft,topRight,feature,bufferScale,t1,t2,toRad=Math.PI/180;switch(transaction.items[0].globalType){case"view":if(transaction.items[0].location){args={latitude:transaction.items[0].location.lat,longitude:transaction.items[0].location.lon,altitude:transaction.items[0].altitude,tilt:transaction.items[0].tilt,roll:transaction.items[0].roll,heading:transaction.items[0].heading}}else if(transaction.items[0].bounds){bottomLeft={lat:transaction.items[0].bounds.west*toRad,lon:transaction.items[0].bounds.south*toRad};topRight={lat:transaction.items[0].bounds.east*toRad,lon:transaction.items[0].bounds.north*toRad};t1=Math.pow(Math.sin((topRight.lat-bottomLeft.lat)/2),2);t2=Math.pow(Math.sin((topRight.lon-bottomLeft.lon)/2),2);altitude=2*WorldWind.EARTH_RADIUS*Math.asin(Math.sqrt(t1+Math.cos(topRight.lat)*Math.cos(bottomLeft.lat)*t2));args={latitude:(transaction.items[0].bounds.north+transaction.items[0].bounds.south)/2,longitude:(transaction.items[0].bounds.east+transaction.items[0].bounds.west)/2,altitude:altitude,tilt:0,roll:0,heading:0}}break;case"feature":bufferScale=2.25;feature=transaction.items[0];switch(feature.format){case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:altitude=feature.properties.radius*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:altitude=Math.max(feature.properties.semiMajor,feature.properties.semiMinor)*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:altitude=Math.max(feature.properties.width,feature.properties.height)*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:altitude=feature.properties.width*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:default:altitude=1e4}args={latitude:transaction.items[0].coordinates[1],longitude:transaction.items[0].coordinates[0],altitude:altitude,tilt:0,roll:0,heading:0};break;default:transaction.failures.push(transaction.items[0])}if(transaction.items[0].animate===true){transaction.pause();args.animate=true;args.animateCB=function(){transaction.items[0].location={lat:empWorldWind.getCenter().latitude,lon:empWorldWind.getCenter().longitude};transaction.items[0].bounds=empWorldWind.getBounds();transaction.run();EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}}EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION);empWorldWind.centerOnLocation(args);transaction.items[0].location={lat:empWorldWind.getCenter().latitude,lon:empWorldWind.getCenter().longitude};transaction.items[0].bounds=empWorldWind.getBounds()};engineInterface.lookAt.set=function(transaction){var args={latitude:transaction.items[0].latitude,longitude:transaction.items[0].longitude,altitude:transaction.items[0].altitude,range:transaction.items[0].range,tilt:transaction.items[0].tilt,heading:transaction.items[0].heading};if(transaction.items[0].animate===true){transaction.pause();args.animate=true;args.animateCB=function(){transaction.run();EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}}EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION);empWorldWind.lookAt(args)};engineInterface.wms.add=function(transaction){emp.util.each(transaction.items,function(wms){empWorldWind.addWMS(wms)})};engineInterface.wms.remove=function(transaction){emp.util.each(transaction.items,function(wms){empWorldWind.removeWMS(wms)})};engineInterface.feature.add=function(transaction){var feature,itemsCount=transaction.items.length;transaction.pause();while(itemsCount){feature=transaction.items[--itemsCount];empWorldWind.plotFeature(feature,function(featureCount,cbArgs){if(!cbArgs.success){transaction.fail(new emp.typeLibrary.Error({feature:cbArgs.feature}))}if(featureCount===0){transaction.run()}}.bind(this,itemsCount))}};engineInterface.feature.remove=function(transaction){var rc;emp.util.each(transaction.items,function(feature){rc=empWorldWind.unplotFeature(feature);if(!rc.success){transaction.fail(new emp.typeLibrary.Error({message:rc.message}))}})};engineInterface.settings.mil2525.icon.labels.set=function(transaction){empWorldWind.setLabelStyle(transaction.items[0])};engineInterface.view.getLatLonFromXY=function(transaction){for(var i=0;i<transaction.items.length;i+=1){var item=transaction.items[i];var pickPoint=new WorldWind.Vec2(item.x,item.y);var terrainObject=empWorldWind.worldWindow.pickTerrain(pickPoint).terrainObject();item.lat=terrainObject?terrainObject.position.latitude:undefined;item.lon=terrainObject?terrainObject.position.longitude:undefined}};engineInterface.view.getXYFromLatLon=function(transaction){var bResult=false;for(var i=0;i<transaction.items.length;i+=1){var item=transaction.items[i];var pointVec3=new WorldWind.Vec3(0,0,0);empWorldWind.worldWindow.globe.computePointFromPosition(item.lat,item.lon,0,pointVec3);if(!pointVec3){continue}var screenVec3=new WorldWind.Vec3(0,0,0);bResult=empWorldWind.worldWindow.drawContext.navigatorState.project(pointVec3,screenVec3);if(bResult){item.x=screenVec3[0];item.y=screenVec3[1];item.z=screenVec3[2]}else{item.x=undefined;item.y=undefined;item.z=undefined}}return transaction};engineInterface.visibility.set=function(transaction){emp.util.each(transaction.items,function(feature){if(feature.featureId in empWorldWind.features){empWorldWind.features[feature.featureId].setVisible(feature.visible)}});empWorldWind.refresh()};engineInterface.map.config=function(transaction){var bRangeChanged;var configHandlers={brightness:function(value){empWorldWind.setContrast(value)},milStdIconLabels:function(value){empWorldWind.setLabelStyle(value)},renderingOptimization:function(value){if(EMPWorldWind.utils.defined(value)&&value!==empWorldWind.enableRenderingOptimization){bRangeChanged=true;empWorldWind.enableRenderingOptimization=value}},midDistanceThreshold:function(value){if(EMPWorldWind.utils.defined(value)&&value!==empWorldWind.singlePointAltitudeRanges.mid){bRangeChanged=true;empWorldWind.singlePointAltitudeRanges.mid=value}},farDistanceThreshold:function(value){if(EMPWorldWind.utils.defined(value)&&value!==empWorldWind.singlePointAltitudeRanges.high){bRangeChanged=true;empWorldWind.singlePointAltitudeRanges.high=value}},selectionScale:function(value){empWorldWind.setSelectionScale(value)},selectionColor:function(value){empWorldWind.setSelectionColor(value)},iconSize:function(value){empWorldWind.setIconSize(value)}};emp.util.each(transaction.items,function(config){var prop,value;for(prop in config){if(config.hasOwnProperty(prop)){if(prop==="messageId"){continue}value=config[prop];if(configHandlers.hasOwnProperty(prop)){configHandlers[prop](value)}else{transaction.fail(new emp.typeLibrary.Error({message:"Config property "+prop+" is not supported by this engine"}))}if(bRangeChanged){empWorldWind.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(empWorldWind.worldWindow.navigator.range,empWorldWind.singlePointAltitudeRanges);empWorldWind.refresh()}}}})};engineInterface.navigation.enable=function(transaction){empWorldWind.setLockState(transaction.items[0])};engineInterface.selection.set=function(transaction){var rc=empWorldWind.selectFeatures(transaction.items);transaction.failures=rc.failed};engineInterface.capture.screenshot=function(transaction){return transaction.items[0].dataUrl=empWorldWind.screenshot()};engineInterface.state.destroy=function(){if(empWorldWind){empWorldWind.shutdown();empWorldWind=undefined}};engineInterface.kmllayer.add=function(transaction){var items=transaction.items.length;var _complete=function(args){items--;if(!args.success){transaction.failures.push(new emp.typeLibrary.Error({message:args.message,coreId:args.id}))}if(items>0){return}transaction.run()};transaction.pause();emp.util.each(transaction.items,function(kmlLayer){empWorldWind.addKML(kmlLayer,_complete)})};engineInterface.kmllayer.remove=function(transaction){emp.util.each(transaction.items,function(kmlLayer){empWorldWind.removeKML(kmlLayer)})};engineInterface.wmts.add=function(transaction){var itemCount=transaction.items.length;transaction.pause();while(itemCount--){empWorldWind.addWmtsToMap(transaction.items[itemCount],function(count,cbArgs){if(!cbArgs.success){transaction.fail(new emp.typeLibrary.Error(cbArgs))}if(count===0){transaction.run()}}.bind(this,itemCount))}};engineInterface.wmts.remove=function(transaction){var failures=[];emp.util.each(transaction.items,function(wmts){var rc=empWorldWind.removeWmtsFromMap(wmts);if(!rc.success){failures.push(wmts)}});transaction.failures=failures};return engineInterface};var EMPWorldWind={};EMPWorldWind.isV2Core=false;EMPWorldWind.Map=function(wwd){this.worldWindow=wwd;this.layers={};this.rootLayer=undefined;this.features={};this.services={};this.state={pixelSize:1,drawing:false,editing:false,dragging:false,lastInteractionEvent:undefined,lockState:emp3.api.enums.MapMotionLockEnum.UNLOCKED,lastRender:{bounds:{north:0,south:0,east:0,west:0},altitude:0},selectionStyle:{scale:1,lineColor:"#FFFF00",fillColor:undefined},autoPanning:{state:String(EMPWorldWind.constants.PAN_STATE.HALTED),step:.5,up:false,down:false,left:false,right:false},iconSize:EMPWorldWind.constants.IconSize.medium,labelStyles:{V:false,L:false,S:false,AA:false,AB:false,AC:true,H:false,M:false,T:false,T1:false,CN:false,C:false,F:false,G:false,H1:false,H2:false,J:false,K:false,N:false,P:false,W:false,W1:false,X:false,Y:false,Z:false}};this.singlePointAltitudeRanges={};this.singlePointAltitudeRanges.mid=6e5;this.singlePointAltitudeRanges.high=12e5;this.singlePointAltitudeRangeMode=EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE;this.empSelections={};this.optimizationMapMoveEpsilon=EMPWorldWind.Math.EPSILON5;this.lastNavigator={};this.shapesInViewArea=undefined;this.bounds=undefined;this.secRendererWorker={};this.secRendererWorker.A=undefined;this.secRendererWorker.B=undefined;this.secRendererWorker.lastSelected=EMPWorldWind.constants.RendererWorker.B;this.throttleAddMultiPointRedraws=undefined};EMPWorldWind.Map.prototype=function(){function _redrawAllFeatures(){emp.util.each(Object.keys(this.features),function(featureKey){var feature=this.features[featureKey];this.plotFeature(feature)}.bind(this))}return{initialize:function(args){this.empMapInstance=args.mapInstance;var _createContrastLayers=function(){var blackContrastLayer=new WorldWind.SurfaceSector(WorldWind.Sector.FULL_SPHERE,null);blackContrastLayer.attributes.interiorColor=new WorldWind.Color(0,0,0,0);blackContrastLayer.attributes.drawOutline=false;var whiteContrastLayer=new WorldWind.SurfaceSector(WorldWind.Sector.FULL_SPHERE,null);whiteContrastLayer.attributes.interiorColor=new WorldWind.Color(1,1,1,0);whiteContrastLayer.attributes.drawOutline=false;this.contrastLayer=new WorldWind.RenderableLayer("contrast layer");this.contrastLayer.pickEnabled=false;this.worldWindow.addLayer(this.contrastLayer);this.contrastLayer.addRenderable(whiteContrastLayer);this.contrastLayer.addRenderable(blackContrastLayer)}.bind(this);var _addEventHandlers=function(){var eventClass,eventHandler;for(eventClass in EMPWorldWind.eventHandlers){if(EMPWorldWind.eventHandlers.hasOwnProperty(eventClass)){eventClass=EMPWorldWind.eventHandlers[eventClass];for(eventHandler in eventClass){if(eventClass.hasOwnProperty(eventHandler)){this.worldWindow.addEventListener(eventHandler,eventClass[eventHandler].bind(this))}}}}}.bind(this);var _setInitialExtent=function(extent){var alt;extent=extent||{centerLat:44,centerLon:44};if(!isNaN(extent.north)&&!isNaN(extent.south)&&!isNaN(extent.east)&&!isNaN(extent.west)){alt=Math.PI*WorldWind.EARTH_RADIUS*WorldWind.Location.greatCircleDistance(new WorldWind.Location(extent.north,extent.west),new WorldWind.Location(extent.south,extent.east));this.centerOnLocation({latitude:(extent.north+extent.south)/2,longitude:(extent.east+extent.west)/2,altitude:alt})}else if(!isNaN(extent.centerLat)&&!isNaN(extent.centerLon)){this.centerOnLocation({latitude:extent.centerLat,longitude:extent.centerLon,altitude:1e7})}}.bind(this);var _applyConfigProperties=function(config){config=config||{};if(EMPWorldWind.utils.defined(config.midDistanceThreshold)){this.singlePointAltitudeRanges.mid=config.midDistanceThreshold}if(EMPWorldWind.utils.defined(config.farDistanceThreshold)){this.singlePointAltitudeRanges.far=config.farDistanceThreshold}if(EMPWorldWind.utils.defined(config.brightness)){this.setContrast(config.brightness)}}.bind(this);var _initializeWebWorkers=function(){this.secRendererWorker.A=new Worker(WorldWind.configuration.baseUrl+"renderer/MPCWorker.js");this.secRendererWorker.B=new Worker(WorldWind.configuration.baseUrl+"renderer/MPCWorker.js");this.secRendererWorker.A.onerror=function(error){armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("MPWorker A","postMessage",error)};this.secRendererWorker.onMessage=function(e){var rendererData=[];if(e.data.id){rendererData.push=e.data.result}else{rendererData=e.data.result}emp.util.each(rendererData,function(rendererItem){if(!EMPWorldWind.utils.defined(rendererItem)||typeof rendererItem==="string"){return}var i,wwFeature=this.features[rendererItem.id],shapes=[],data=rendererItem.geojson;emp.util.each(data.features,function(componentFeature){var lineCount;componentFeature.properties.strokeWidth=1;componentFeature.properties.strokeWeight=1;switch(componentFeature.geometry.type){case"MultiLineString":lineCount=componentFeature.geometry.coordinates.length;for(i=0;i<lineCount;i++){var subGeoJSON={properties:componentFeature.properties,coordinates:componentFeature.geometry.coordinates[i]};shapes.push(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolylineFromGeoJSON(subGeoJSON,this.state.selectionStyle))}break;case"LineString":shapes.push(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolylineFromGeoJSON(componentFeature,this.state.selectionStyle));break;case"Point":shapes.push(EMPWorldWind.editors.primitiveBuilders.constructTextFromGeoJSON(componentFeature,this.state.selectionStyle));break;case"Polygon":shapes.push(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolygonFromGeoJSON(componentFeature,this.state.selectionStyle));break;default:window.console.error("Unable to render symbol with type "+componentFeature.geometry.type)}}.bind(this));if(wwFeature){this.rootLayer.removeFeature(wwFeature);wwFeature.clearShapes();wwFeature.addShapes(shapes);this.rootLayer.addFeature(wwFeature);wwFeature.feature.range=this.worldWindow.navigator.range;wwFeature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;wwFeature.selected=this.isFeatureSelected(wwFeature.id)}}.bind(this));this.worldWindow.redraw()}.bind(this);this.secRendererWorker.A.onmessage=this.secRendererWorker.onMessage;this.secRendererWorker.B.onerror=function(error){armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("MPWorker B","postMessage",error)};this.secRendererWorker.B.onmessage=this.secRendererWorker.onMessage}.bind(this);_createContrastLayers();this.rootLayer=new EMPWorldWind.data.EmpLayer("RootLayer for "+args.mapInstance.mapInstanceId);this.worldWindow.addLayer(this.rootLayer.layer);this.goToAnimator=new WorldWind.GoToAnimator(this.worldWindow);this.dragRecognizer=new WorldWind.DragRecognizer(this.worldWindow.canvas,function(event){if(event.state in EMPWorldWind.eventHandlers.drag){EMPWorldWind.eventHandlers.drag[event.state].call(this,event)}}.bind(this));_addEventHandlers();_setInitialExtent(args.extent);if(this.worldWindow.navigator){this.lastNavigator.range=this.worldWindow.navigator.range;this.lastNavigator.tilt=this.worldWindow.navigator.tilt;this.lastNavigator.roll=this.worldWindow.navigator.roll;this.lastNavigator.heading=this.worldWindow.navigator.heading;this.lastNavigator.lookAtLocation=emp.helpers.copyObject(this.worldWindow.navigator.lookAtLocation)}_applyConfigProperties(args.configProperties);EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED);_initializeWebWorkers();this.throttleAddMultiPointRedraws=EMPWorldWind.utils.MultiPointRateLimit(EMPWorldWind.editors.EditorController.redrawMilStdSymbols,200)},centerOnLocation:function(args){var position;function _getLocation(args){if(typeof args.altitude==="number"){return new WorldWind.Position(args.latitude,args.longitude,args.altitude)}else{return new WorldWind.Location(args.latitude,args.longitude)}}position=_getLocation(args);this.worldWindow.navigator.heading=args.heading||0;this.worldWindow.navigator.roll=args.roll||0;this.worldWindow.navigator.tilt=args.tilt||0;var _goToCompleteCallback=function(){EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED);if(typeof args.animateCB==="function"){return args.animateCB()}}.bind(this);this.goToAnimator.travelTime=args.animate?EMPWorldWind.constants.globeMoveTime:0;this.goToAnimator.goTo(position,_goToCompleteCallback)},lookAt:function(args){if(args.range!==0){args.range=args.range||this.worldWindow.navigator.range}var position=new WorldWind.Position(args.latitude,args.longitude,args.range);function _completeLookAtMotion(){this.worldWindow.navigator.lookAtLocation.latitude=args.latitude;this.worldWindow.navigator.lookAtLocation.longitude=args.longitude;this.worldWindow.navigator.range=args.range;this.worldWindow.navigator.tilt=args.tilt;this.worldWindow.navigator.heading=args.heading;if(args.animateCB){args.animateCB()}this.worldWindow.redraw()}this.goToAnimator.travelTime=args.animate?EMPWorldWind.constants.globeMoveTime:0;this.goToAnimator.goTo(position,_completeLookAtMotion.bind(this))},plotFeature:function(feature,callback){var _callback=function(cbArgs){if(cbArgs.success){this.rootLayer.addFeature(cbArgs.feature);if(!(cbArgs.feature.id in this.features)){this.features[cbArgs.feature.id]=cbArgs.feature}this.worldWindow.redraw()}if(typeof callback==="function"){return callback(cbArgs)}}.bind(this);if(feature instanceof EMPWorldWind.data.EmpFeature){feature=feature.feature}if(!(feature.featureId in this.features)){EMPWorldWind.editors.EditorController.plotFeature.call(this,feature,_callback)}else{EMPWorldWind.editors.EditorController.updateFeature.call(this,this.features[feature.featureId],feature,_callback)}},unplotFeature:function(feature){var rc={success:false,message:""};var _handleKMLFeature=function(){if(feature.coreId in this.layers){this.worldWindow.removeLayer(this.layers[feature.coreId]);delete this.layers[feature.coreId];delete this.features[feature.coreId];this.worldWindow.redraw();rc.success=true}return rc}.bind(this);var _handleDefaultFeature=function(){this.rootLayer.removeFeature(feature);this.removeFeatureSelection(feature.coreId);delete this.features[feature.coreId];rc.success=true;this.worldWindow.redraw();return rc}.bind(this);if(feature.format==="kml"){return _handleKMLFeature()}return _handleDefaultFeature()},selectFeatures:function(empSelections){var selected=[],failed=[];emp.util.each(empSelections,function(selectedFeature){var feature=this.features[selectedFeature.featureId];if(feature){feature.selected=selectedFeature.select;feature.selected?this.storeFeatureSelection(selectedFeature.featureId):this.removeFeatureSelection(selectedFeature.featureId)}else{failed.push(selectedFeature.featureId)}}.bind(this));this.worldWindow.redraw();return{success:selected.length!==0,selected:selected,failed:failed}},getLayer:function(id){if(this.layers.hasOwnProperty(id)){return this.layers[id]}},layerExists:function(layer){return this.layers.hasOwnProperty(layer.id)},addWMS:function(wms){var wmsLayer;wmsLayer=this.getLayer(wms.coreId);if(wmsLayer){this.removeWMS(wmsLayer)}wmsLayer=new EMPWorldWind.data.EmpWMSLayer(wms);this.layers[wmsLayer.id]=wmsLayer;this.worldWindow.addLayer(wmsLayer.layer);this.worldWindow.redraw()},removeWMS:function(wms){var layer,id=wms.coreId||wms.id;layer=this.getLayer(id);if(layer){this.worldWindow.removeLayer(layer.layer);delete this.layers[layer.id];this.worldWindow.redraw()}},addKML:function(kml,cb){var kmlFilePromise,kmlLayer=new EMPWorldWind.data.EmpKMLLayer(kml);kmlFilePromise=new WorldWind.KmlFile(kmlLayer.url);kmlFilePromise.then(function(kmlFile){var kmlRenderableLayer=new WorldWind.RenderableLayer(kmlLayer.id);kmlLayer.layer=kmlRenderableLayer;kmlRenderableLayer.addRenderable(kmlFile);this.worldWindow.addLayer(kmlRenderableLayer);this.worldWindow.redraw();this.layers[kmlLayer.id]=kmlLayer;if(typeof cb==="function"){return cb({success:true})}}.bind(this)).catch(function(){return cb({success:false,message:"Failed to add KML Layer"})})},removeKML:function(kml,cb){if(kml.coreId in this.layers){this.worldWindow.removeLayer(this.layers[kml.coreId].layer);delete this.layers[kml.coreId];this.worldWindow.redraw()}if(typeof cb==="function"){return cb({success:true})}},isFeatureSelected:function(id){return Boolean(this.empSelections.hasOwnProperty(id))},getFeatureSelection:function(id){if(this.isFeatureSelected(id)){return this.empSelections[id]}return null},addWmtsToMap:function(empWMTS,callback){var rc={success:false,message:""},tileMatrixSet="GoogleMapsCompatible";var xhr,url,async=true;var _createWMTSLayer=function(xmlDom){var wmtsCapabilities,wmtsLayerCapabilities,wmtsConfig,index;wmtsCapabilities=new WorldWind.WmtsCapabilities(xmlDom);wmtsLayerCapabilities=wmtsCapabilities.getLayer(empWMTS.layer);wmtsConfig=WorldWind.WmtsLayer.formLayerConfiguration(wmtsLayerCapabilities);for(index=0;index<wmtsLayerCapabilities.capabilities.contents.tileMatrixSet.length;index++){if(wmtsLayerCapabilities.capabilities.contents.tileMatrixSet[index].identifier===tileMatrixSet){wmtsConfig.tileMatrixSet=wmtsLayerCapabilities.capabilities.contents.tileMatrixSet[index];break}}return new WorldWind.WmtsLayer(wmtsConfig)};var xhrSuccess=function(){var wmtsLayer;if(xhr.status===200){try{wmtsLayer=_createWMTSLayer(xhr.responseXML);this.worldWindow.addLayer(wmtsLayer);this.services[empWMTS.coreId]=wmtsLayer;this.worldWindow.redraw();rc.success=true}catch(err){rc.message=err.message}if(typeof callback==="function"){return callback(rc)}}}.bind(this);var xhrError=function(){callback({success:false,message:xhr.statusText})};try{url=empWMTS.url+"?SERVICE=WMTS&REQUEST=GetCapabilities&VERSION=1.0.0";xhr=new XMLHttpRequest;xhr.open("GET",url,async);xhr.callback=callback;xhr.onload=xhrSuccess;xhr.onerror=xhrError;tileMatrixSet=empWMTS.tileMatrixSet?empWMTS.tileMatrixSet:tileMatrixSet;xhr.send();rc.success=true}catch(err){rc.message=err.message}return rc},removeWmtsFromMap:function(empWMTS){var rc={success:false,message:""};if(empWMTS.coreId in this.services){this.worldWindow.removeLayer(this.services[empWMTS.coreId]);rc.success=true;this.worldWindow.redraw()}else{rc.message="No such service exists on the map"}return rc},storeFeatureSelection:function(id){this.empSelections[id]=id},removeFeatureSelection:function(id){if(this.empSelections.hasOwnProperty(id)){delete this.empSelections[id];return true}return false},getSelections:function(){return this.empSelections},isFeaturePresent:function(id){return Boolean(this.features.hasOwnProperty(id))},isMultiPointPresent:function(id){return Boolean(this.multiPointCollection.hasOwnProperty(id))},getMultiPoint:function(id){if(this.isMultiPointPresent(id)){return this.multiPointCollection[id]}return null},storeMultiPoint:function(multiPoint){this.multiPointCollection[multiPoint.id]=multiPoint},removeMultiPoint:function(id){if(this.multiPointCollection.hasOwnProperty(id)){delete this.multiPointCollection[id];return true}return false},isAirspacePresent:function(id){return Boolean(this.airspaceCollection.hasOwnProperty(id))},getAirspace:function(id){if(this.isAirspacePresent(id)){return this.airspaceCollection[id]}return null},storeAirspace:function(airspace){this.airspaceCollection[airspace.id||airspace.coreId]=airspace},removeAirspace:function(id){if(this.airspaceCollection.hasOwnProperty(id)){delete this.airspaceCollection[id];return true}return false},getSinglePoints:function(){return this.singlePointCollection},isSinglePointPresent:function(id){return Boolean(this.singlePointCollection.hasOwnProperty(id))},getSinglePoint:function(id){if(this.isSinglePointPresent(id)){return this.singlePointCollection[id]}return null},storeSinglePoint:function(singlePoint){this.singlePointCollection[singlePoint.id]=singlePoint},removeSinglePoint:function(id){if(this.isSinglePointPresent(id)){delete this.singlePointCollection[id];return true}return false},getSinglePointCount:function(){if(this.defined(this.singlePointCollection)){return Object.keys(this.singlePointCollection).length}else{return 0}},isSinglePointIdOnHoldPresent:function(id){return Boolean(this.singlePointCollectionIdOnHold.hasOwnProperty(id))},getSinglePointIdOnHold:function(id){if(this.isSinglePointIdOnHoldPresent(id)){return this.singlePointCollectionOnHold[id]}return null},storeSinglePointIdOnHold:function(singlePointId){this.singlePointCollectionIdOnHold[singlePointId]=singlePointId},removeSinglePointIdOnHold:function(id){if(this.isSinglePointIdOnHoldPresent(id)){delete this.singlePointCollectionIdOnHold[id];return true}return false},getSinglePointsIdOnHold:function(){return this.singlePointCollectionIdOnHold},getSinglePointsIdOnHoldCount:function(){if(this.defined(this.singlePointCollectionIdOnHold)){return Object.keys(this.singlePointCollectionIdOnHold).length}else{return 0}},setLabelStyle:function(styles){var style,featureId,feature;for(style in this.state.labelStyles){if(this.state.labelStyles.hasOwnProperty(style)){this.state.labelStyles[style]=styles.includes(style)}}for(featureId in this.features){if(this.features.hasOwnProperty(featureId)){feature=this.features[featureId];EMPWorldWind.editors.EditorController.updateFeatureLabelStyle.call(this,feature)}}this.worldWindow.redraw()},refresh:function(){EMPWorldWind.eventHandlers.triggerRenderUpdate.call(this);this.worldWindow.redraw()},setContrast:function(contrast){if(contrast>100){contrast=100}else if(contrast<0){contrast=0}if(contrast>=50){this.contrastLayer.renderables[EMPWorldWind.constants.WHITE_CONTRAST].attributes.interiorColor=new WorldWind.Color(1,1,1,(contrast-50)/50);this.contrastLayer.renderables[EMPWorldWind.constants.BLACK_CONTRAST].attributes.interiorColor=new WorldWind.Color(0,0,0,0)}else{this.contrastLayer.renderables[EMPWorldWind.constants.WHITE_CONTRAST].attributes.interiorColor=new WorldWind.Color(1,1,1,0);this.contrastLayer.renderables[EMPWorldWind.constants.BLACK_CONTRAST].attributes.interiorColor=new WorldWind.Color(0,0,0,(50-contrast)/50)}this.worldWindow.redraw()},setLockState:function(lockState){if(lockState.lock===this.state.lockState){return}else if(lockState.lock!==emp3.api.enums.MapMotionLockEnum.SMART_MOTION){this.spinGlobe(false)}this.state.lockState=lockState.lock},spinGlobe:function(pan){var step=this.worldWindow.navigator.range/WorldWind.EARTH_RADIUS;var _getVerticalPan=function(){if(this.state.autoPanning.up){return step}else if(this.state.autoPanning.down){return-step}else{return 0}}.bind(this);var _getHorizontalPan=function(){if(this.state.autoPanning.left){return-step}else if(this.state.autoPanning.right){return step}else{return 0}}.bind(this);var _cleanPanArgs=function(pan){if(pan&&pan.hasOwnProperty("state")){delete pan["state"]}return pan};var _allowPan=function(){return this.state.autoPanning.up||this.state.autoPanning.left||this.state.autoPanning.down||this.state.autoPanning.right}.bind(this);var _notifyEMPPointer=function(){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,this.state.lastInteractionEvent);coords.type=emp.typeLibrary.Pointer.EventType.MOVE;if(coords.lat!==undefined){this.empMapInstance.eventing.Pointer(coords)}}.bind(this);var _panMap=function(){var vertical,horizontal,goToPosition,travelTime=250;vertical=_getVerticalPan();horizontal=_getHorizontalPan();goToPosition=new WorldWind.Position(this.worldWindow.navigator.lookAtLocation.latitude+vertical,this.worldWindow.navigator.lookAtLocation.longitude+horizontal,this.worldWindow.navigator.range);this.goToAnimator.travelTime=travelTime;this.state.autoPanning.state=EMPWorldWind.constants.PAN_STATE.PANNING;EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION);this.goToAnimator.goTo(goToPosition,function(){_notifyEMPPointer();this.state.autoPanning.state=EMPWorldWind.constants.PAN_STATE.COMPLETE;if(_allowPan()){_panMap()}else{this.state.autoPanning.state=EMPWorldWind.constants.PAN_STATE.HALTED;EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}}.bind(this))}.bind(this);if(pan===false){this.goToAnimator.cancel();this.state.autoPanning=Object.assign({},EMPWorldWind.constants.NO_PANNING);return}pan=_cleanPanArgs(pan);this.state.autoPanning=Object.assign({},this.state.autoPanning,pan);if(this.state.autoPanning.state===EMPWorldWind.constants.PAN_STATE.PANNING||this.state.lockState!==emp3.api.enums.MapMotionLockEnum.SMART_MOTION){return}if(_allowPan()){_panMap()}},screenshot:function(){this.worldWindow.drawFrame();return this.worldWindow.canvas.toDataURL()},getBounds:function(){var topRight,bottomLeft;topRight=this.worldWindow.pickTerrain(new WorldWind.Vec2(this.worldWindow.viewport.width-1,1)).terrainObject();
bottomLeft=this.worldWindow.pickTerrain(new WorldWind.Vec2(1,this.worldWindow.viewport.height-1)).terrainObject();if(!topRight){topRight={position:WorldWind.Location.linearLocation(this.worldWindow.navigator.lookAtLocation,this.worldWindow.navigator.heading+45,Math.PI/3,new WorldWind.Location)}}if(!bottomLeft){bottomLeft={position:WorldWind.Location.linearLocation(this.worldWindow.navigator.lookAtLocation,this.worldWindow.navigator.heading+45,-Math.PI/3,new WorldWind.Location)}}return{north:topRight.position.latitude,south:bottomLeft.position.latitude,east:topRight.position.longitude,west:bottomLeft.position.longitude}},getCenter:function(){return this.worldWindow.navigator.lookAtLocation},shutdown:function(){this.features={};this.layers={};this.worldWindow=undefined},isMapMoving:function(){return!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.lookAtLocation.latitude,this.lastNavigator.lookAtLocation.latitude,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.lookAtLocation.longitude,this.lastNavigator.lookAtLocation.longitude,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.range,this.lastNavigator.range,EMPWorldWind.Math.EPSILON1)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.tilt,this.lastNavigator.tilt,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.roll,this.lastNavigator.roll,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.heading,this.lastNavigator.heading,this.optimizationMapMoveEpsilon)},pickShapesInViewRegion:function(){var shapes;var canvasCoordinates=this.worldWindow.canvasCoordinates(0,0);var boundRectangle=new WorldWind.Rectangle(canvasCoordinates[0],canvasCoordinates[1],5e3,4e3);shapes=this.worldWindow.pickShapesInRegion(boundRectangle);return shapes},isMilStdMultiPointShapeInViewRegion:function(empFeature){var p,coordinate,coords=empFeature.coordinates.length;if(!this.bounds){this.bounds=this.getBounds()}var _boundsContainsPoint=function(coordinate,bounds){return coordinate[0]<=bounds.east&&coordinate[0]>=bounds.west&&(coordinate[1]>bounds.south&&coordinate[1]<bounds.north)};for(p=0;p<coords;p++){coordinate=empFeature.coordinates[p];if(_boundsContainsPoint(coordinate,this.bounds)){return true}}return false},setSelectionColor:function(color){function _validateColor(color){return color||this.state.selectionStyle.lineColor}function _prefixColorString(color){if(!color.startsWith("#")){return"#"+color}return color}color=_validateColor(color);color=_prefixColorString(color);this.state.selectionStyle.lineColor=color;_redrawAllFeatures.call(this)},setSelectionScale:function(scale){this.state.selectionStyle.scale=scale;_redrawAllFeatures.call(this)},setIconSize:function(size){if(typeof size==="string"){if(size in EMPWorldWind.constants.IconSize){size=EMPWorldWind.constants.IconSize[size]}else{size=1}}else if(typeof size!=="number"){size=1}if(this.state.iconSize!==size){this.state.iconSize=size;this.state.stateChanged=true;_redrawAllFeatures.call(this);this.state.stateChanged=false}}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data={};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpLayer=function(overlayName){this.features={};this.name=overlayName;var _layer=new WorldWind.RenderableLayer(overlayName);Object.defineProperty(this,"layer",{enumerable:true,value:_layer});var _featureIsPresent=function(feature){if(feature){return(feature.id||feature.coreId)in this.features}return false}.bind(this);var _getFeature=function(id){return this.features[id]}.bind(this);this.addFeature=function(feature){if(!_featureIsPresent(feature)){emp.util.each(feature.shapes,function(shape){this.layer.addRenderable(shape)}.bind(this));this.features[feature.id||feature.coreId]=feature}};this.addFeatures=function(features){emp.util.each(features,function(feature){this.addFeature(feature)}.bind(this))};this.removeFeatures=function(features){emp.util.each(features,function(feature){this.removeFeature(feature)}.bind(this))};this.removeFeature=function(feature){if(_featureIsPresent(feature)){var wwFeature=_getFeature(feature.id||feature.coreId);emp.util.each(wwFeature.shapes,function(shape){this.layer.removeRenderable(shape)}.bind(this));delete this.features[wwFeature.id]}};this.removeFeatureById=function(id){if(id in this.features){this.removeFeature(this.features[id])}}};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpWMSLayer=function(wms){var layerNames,config,url;this.id=wms.coreId;var _wms=wms;Object.defineProperty(this,"wms",{enumerable:true,value:_wms});layerNames=wms.activeLayers.join();if(wms.useProxy){url=emp3.api.global.configuration.urlProxy+"?url="+wms.url}else{url=wms.url}config={service:url,layerNames:layerNames,sector:WorldWind.Sector.FULL_SPHERE,levelZeroDelta:new WorldWind.Location(36,36),numLevels:15,format:"image/png",size:256};var timeString="";var _wmsLayer=new WorldWind.WmsLayer(config,timeString);Object.defineProperty(this,"layer",{enumerable:true,value:_wmsLayer})};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpKMLLayer=function(kml){this.id=kml.coreId;this.kml=kml;function _buildURL(kml){if(kml.useProxy){return emp3.api.global.configuration.urlProxy+"?url="+kml.url}return kml.url}this.url=_buildURL(kml);this.layer=new WorldWind.RenderableLayer(this.id)};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpFeature=function(feature){this.shapes=[];this.feature=feature;var _id=feature.coreId;Object.defineProperty(this,"id",{enumerable:true,value:_id});var _altitudeMode=WorldWind.CLAMP_TO_GROUND;Object.defineProperty(this,"altitudeMode",{enumerable:true,get:function(){return _altitudeMode},set:function(altMode){var shapesCount=this.shapesCount();for(var i=0;i<shapesCount;i++){this.shapes[i].altitudeMode=altMode}_altitudeMode=altMode}});var _selected=false;Object.defineProperty(this,"selected",{enumerable:true,get:function(){return _selected},set:function(value){var shapesCount=this.shapesCount();for(var i=0;i<shapesCount;i++){this.shapes[i].highlighted=value}_selected=value}})};EMPWorldWind.data.EmpFeature.prototype.shapesCount=function(){return this.shapes.length};EMPWorldWind.data.EmpFeature.prototype.addShapes=function(primitives){if(!Array.isArray(primitives)){if(primitives instanceof WorldWind.RenderableLayer){primitives.renderables[0].userProperties.id=this.id}else{primitives.userProperties.id=this.id}this.shapes.push(primitives)}else{emp.util.each(primitives,function(primitive){primitive.userProperties.id=this.id;this.shapes.push(primitive)}.bind(this))}};EMPWorldWind.data.EmpFeature.prototype.clearShapes=function(){this.shapes=[]};EMPWorldWind.data.EmpFeature.prototype.setVisible=function(visible){emp.util.each(this.shapes,function(shape){shape.enabled=visible})};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.constants={view:{MAX_HEIGHT:1e7}};EMPWorldWind.constants.globeWasMoving=false;EMPWorldWind.constants.globeWasZooming=false;EMPWorldWind.constants.globeMoveTime=2e3;EMPWorldWind.constants.extentBufferFactor=.4;EMPWorldWind.constants.USE_DATA_SOURCE=false;EMPWorldWind.constants.WHITE_CONTRAST=0;EMPWorldWind.constants.BLACK_CONTRAST=1;EMPWorldWind.constants.IconSize={verySmall:.5,tiny:.5,small:.75,medium:1,large:1.5,extraLarge:1.75};EMPWorldWind.constants.PAN_STATE={HALTED:"halted",PANNING:"panning",COMPLETE:"complete"};EMPWorldWind.constants.NO_PANNING={state:String(EMPWorldWind.constants.PAN_STATE.HALTED),step:0,up:false,down:false,right:false,left:false};EMPWorldWind.constants.METERS_PER_INCH=.0254;EMPWorldWind.constants.SCALE_LINE_LENGTH=50;EMPWorldWind.constants.propertyDefaults={FILL_COLOR_HEX:"ffffff",LINE_COLOR_HEX:"000000",LINE_WIDTH:1};EMPWorldWind.constants.selectionProperties={COLOR_HEX:"FFFF00",WIDTH:2,SCALE:.5};EMPWorldWind.constants.FeatureType={ENTITY:"entity",RENDERABLE:"renderable",PRIMITIVE:"primitive",GROUND_PRIMITIVE:"ground_primitive",DATA_SOURCE:"dataSource",COMPOUND_ENTITY:"compoundEntity",PRIMITIVE_COLLECTION:"primitiveCollection"};EMPWorldWind.constants.LayerType={OVERLAY_LAYER:"overlay",WMS_LAYER:"wms",IMAGE_LAYER:"image",BING_LAYER:"bing",ARCGIS_93_REST_LAYER:"arcgis93rest",OSM_LAYER:"osm",TMS_LAYER:"tms",TERRAIN_LAYER:"terrain",WMTS_LAYER:"wmts"};EMPWorldWind.constants.EntityType={BILLBOARD:"billboard",BOX:"box",CORRIDOR:"corridor",CYLINDER:"cylinder",DESCRIPTION:"description",ELLIPSE:"ellipse",ELLIPSOID:"ellipsoid",LABEL:"label",MODEL:"model",ORIENTATION:"orientation",PATH:"path",POLYGON:"polygon",POLYLINE:"polyline",POLYLINE_VOLUME:"polylineVolume",POSITION:"position",RECTANGLE:"rectangle",VIEW_FROM:"viewFrom",WALL:"wall",KML:"kml"};EMPWorldWind.constants.MultiPointRenderType={KML:0,JSON:1,GEOJSON:2,DATA_URL:4,CANVAS:3,CANVAS_LABEL_ONLY:5,SVG:6,SVG_LABEL_ONLY:7};EMPWorldWind.constants.SinglePointAltitudeRangeMode={LOW_RANGE:0,MID_RANGE:1,HIGHEST_RANGE:2};EMPWorldWind.constants.RendererWorker={A:1,B:2,C:3,D:4};EMPWorldWind.constants.LabelStyle={REQUIRED_LABELS:"required_labels",COMMON_LABELS:"common_labels",ALL_LABELS:"all_labels"};EMPWorldWind.constants.AllLabels={V:true,L:true,S:true,AA:true,AB:true,AC:true,H:true,M:true,T:true,T1:true,CN:true,C:true,F:true,G:true,H1:true,H2:true,J:true,K:true,N:true,P:true,W:true,W1:true,X:true,Y:true,Z:true};EMPWorldWind.constants.RendererSettings={};EMPWorldWind.constants.RendererSettings.standard={Symbology_2525Bch2_USAS_13_14:0,Symbology_2525C:1};EMPWorldWind.constants.RendererSettings.modifierLookup={QUANTITY:"quantity",REDUCED_OR_REINFORCED:"reinforcedOrReduced",STAFF_COMMENTS:"staffComments",ADDITIONAL_INFO_1:"additionalInfo1",ADDITIONAL_INFO_2:"additionalInfo2",ADDITIONAL_INFO_3:"additionalInfo3",EVALUATION_RATING:"evaluationRating",COMBAT_EFFECTIVENESS:"combatEffectiveness",SIGNATURE_EQUIPMENT:"signatureEquipment",HIGHER_FORMATION:"higherFormation",HOSTILE:"hostile",IFF_SIF:"iffSiff",DIRECTION_OF_MOVEMENT:"directionOfMovement",OFFSET_INDICATOR:"offsetIndicator",UNIQUE_DESIGNATOR_1:"uniqueDesignation1",UNIQUE_DESIGNATOR_2:"uniqueDesignation2",EQUIPMENT_TYPE:"equipmentType",DATE_TIME_GROUP:"dateTimeGroup1",DATE_TIME_GROUP_2:"dateTimeGroup2",ALTITUDE_DEPTH:"altitudeDepth",LOCATION:"location",SPEED:"speed",SPECIAL_C2_HEADQUARTERS:"specialC2Headquarters",DISTANCE:"distance",AZIMUTH:"azimuth",FILL_COLOR:"fillColor",LINE_COLOR:"lineColor",TEXT_COLOR:"textColor",X_OFFSET:"xOffset",X_UNITS:"xUnits",Y_OFFSET:"yOffset",Y_UNITS:"yUnits",NAME:"name",STANDARD:"standard"};EMPWorldWind.constants.highAltitudeRangeImage={};EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageRed="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle  cx="12" cy="12"  r="3" fill="red" stroke="red" stroke-width="1"  /></g></svg>');EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageBlue="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle cx="12" cy="12"  r="3" fill="blue" stroke="blue" stroke-width="1"  /></g></svg>');EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageGreen="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle  cx="12" cy="12" r="3" fill="green" stroke="green" stroke-width="1"  /></g></svg>');EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageYellow="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle  cx="12" cy="12" r="3" fill="yellow" stroke="yellow" stroke-width="1"  /></g></svg>');var EMPWorldWind=EMPWorldWind||{};(function(){EMPWorldWind.utils={};EMPWorldWind.utils.getEventCoordinates=function(event){var pickPoint=this.worldWindow.canvasCoordinates(event.clientX,event.clientY);var terrainObject=this.worldWindow.pickTerrain(pickPoint).terrainObject();return{lat:terrainObject?terrainObject.position.latitude:undefined,lon:terrainObject?terrainObject.position.longitude:undefined,clientX:event.clientX,clientY:event.clientY,screenX:event.screenX,screenY:event.screenY}};EMPWorldWind.utils.defined=function(value){return value!==undefined&&value!==null};EMPWorldWind.utils.milstd={};EMPWorldWind.utils.milstd.updateModifierLabels=function(properties,name,iconLabels,iconPixelSize){var mod,modifiedModifiers={},property,size;for(property in properties){if(properties.hasOwnProperty(property)){switch(property){case"labelColor":modifiedModifiers["textColor"]=properties[property];break;case"fillColor":modifiedModifiers["fillColor"]=properties[property];break;case"lineColor":modifiedModifiers["lineColor"]=properties[property];break;case"modifiers":for(mod in properties[property]){if(properties[property].hasOwnProperty(mod)){switch(mod){case"quantity":if(iconLabels.C&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["quantity"]=properties[property][mod]}break;case"reinforcedOrReduced":if(iconLabels.F&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["reinforcedOrReduced"]=properties[property][mod]}break;case"staffComments":if(iconLabels.G&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["staffComments"]=properties[property][mod]}break;case"additionalInfo1":if(iconLabels.H&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["additionalInfo1"]=properties[property][mod]}break;case"additionalInfo2":if(iconLabels.H1&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["additionalInfo2"]=properties[property][mod]}break;case"additionalInfo3":if(iconLabels.H2&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["additionalInfo3"]=properties[property][mod]}break;case"evaluationRating":if(iconLabels.J&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["evaluationRating"]=properties[property][mod]}break;case"combatEffectiveness":if(iconLabels.K&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["combatEffectiveness"]=properties[property][mod]}break;case"signatureEquipment":if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["signatureEquipment"]=properties[property][mod]}break;case"higherFormation":if(iconLabels.M&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["higherFormation"]=properties[property][mod]}break;case"hostile":if(iconLabels.N&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["hostile"]=properties[property][mod]}break;case"iffSif":if(iconLabels.P&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["iffSif"]=properties[property][mod]}break;case"offsetIndicator":if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["offsetIndicator"]=properties[property][mod]}break;case"uniqueDesignation1":if(iconLabels.T&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["uniqueDesignation1"]=properties[property][mod]}break;case"uniqueDesignation2":if(iconLabels.T1&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["uniqueDesignation2"]=properties[property][mod]}break;case"equipmentType":if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["equipmentType"]=properties[property][mod]}break;case"dateTimeGroup1":if(iconLabels.W&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["dateTimeGroup1"]=properties[property][mod]}break;case"dateTimeGroup2":if(iconLabels.W1&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["dateTimeGroup2"]=properties[property][mod]}break;case"altitudeDepth":if(iconLabels.X){modifiedModifiers["altitudeDepth"]=properties[property][mod]}break;case"location":if(iconLabels.Y&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["location"]=properties[property][mod]}break;case"speed":if(iconLabels.Z&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["speed"]=properties[property][mod]}break;case"specialC2Headquarters":if(iconLabels.AA&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["specialC2Headquarters"]=properties[property][mod]}break;case"distance":modifiedModifiers["distance"]=properties[property][mod];break;case"azimuth":modifiedModifiers["azimuth"]=properties[property][mod];break;case"standard":modifiedModifiers["standard"]=properties[property][mod];break;case"size":size=properties[property][mod];if(!size){size=iconPixelSize}modifiedModifiers["size"]=size;break;default:if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers[mod]=properties[property][mod]}break}}}break}}}if(iconLabels.CN){modifiedModifiers["name"]=name}return modifiedModifiers};EMPWorldWind.utils.milstd.convertModifierStringTo2525=function(modifiers,showModLabels){var standardModifiers={};if(modifiers!==undefined&&modifiers!==null){for(var sModifier in modifiers){if(modifiers.hasOwnProperty(sModifier)){var modValue=modifiers[sModifier];if(modValue!==null&&modValue!=="null"&&modValue!==0){switch(sModifier){case EMPWorldWind.constants.RendererSettings.modifierLookup.QUANTITY:if(showModLabels){standardModifiers["C"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.REDUCED_OR_REINFORCED:if(showModLabels){standardModifiers["F"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.STAFF_COMMENTS:if(showModLabels){standardModifiers["G"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ADDITIONAL_INFO_1:if(showModLabels){standardModifiers["H"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ADDITIONAL_INFO_2:if(showModLabels){standardModifiers["H1"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ADDITIONAL_INFO_3:if(showModLabels){standardModifiers["H2"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.EVALUATION_RATING:if(showModLabels){standardModifiers["J"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.COMBAT_EFFECTIVENESS:if(showModLabels){standardModifiers["K"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.SIGNATURE_EQUIPMENT:if(showModLabels){standardModifiers["L"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.HIGHER_FORMATION:if(showModLabels){standardModifiers["M"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.HOSTILE:if(showModLabels){standardModifiers["N"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.IFF_SIF:if(showModLabels){standardModifiers["P"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.OFFSET_INDICATOR:standardModifiers["S"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.UNIQUE_DESIGNATOR_1:if(showModLabels){standardModifiers["T"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.UNIQUE_DESIGNATOR_2:if(showModLabels){standardModifiers["T1"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.EQUIPMENT_TYPE:if(showModLabels){standardModifiers["V"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.DATE_TIME_GROUP:if(showModLabels){standardModifiers["W"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.DATE_TIME_GROUP_2:if(showModLabels){standardModifiers["W1"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ALTITUDE_DEPTH:if(showModLabels){standardModifiers["X"]=JSON.parse(JSON.stringify(modValue))}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.LOCATION:if(showModLabels){standardModifiers["Y"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.SPEED:if(showModLabels){standardModifiers["Z"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.SPECIAL_C2_HEADQUARTERS:if(showModLabels){standardModifiers["AA"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.DISTANCE:standardModifiers["AM"]=JSON.parse(JSON.stringify(modValue));break;case EMPWorldWind.constants.RendererSettings.modifierLookup.AZIMUTH:standardModifiers["AN"]=JSON.parse(JSON.stringify(modValue));break;case EMPWorldWind.constants.RendererSettings.modifierLookup.FILL_COLOR:standardModifiers["FILLCOLOR"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.LINE_COLOR:standardModifiers["LINECOLOR"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.TEXT_COLOR:standardModifiers["TEXTCOLOR"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.STANDARD:standardModifiers[emp.typeLibrary.utils.milstd.Modifiers.STANDARD]=EMPWorldWind.utils.convertSymbolStandardToRendererFormat(modifiers);break;case EMPWorldWind.constants.RendererSettings.modifierLookup.NAME:case"CN":if(showModLabels){standardModifiers["CN"]=modValue}break;default:standardModifiers[sModifier]=modValue;break}}}}}return standardModifiers};EMPWorldWind.utils.milstd.checkForRequiredModifiers=function(item){var result={},symbolCode,properties={},modifiers={},oAM=[],oAN=[],basicSymbolCode,standard,symbolDef,i,lonDistance,overrides={};if(item.data&&item.data.symbolCode){symbolCode=item.data.symbolCode}else if(item.symbolCode){symbolCode=item.symbolCode}if(item.properties){properties=item.properties;if(properties.modifiers){modifiers=properties.modifiers}else{properties.modifiers={};modifiers=properties.modifiers}}else{item.properties={modifiers:{}};modifiers=item.properties.modifiers}basicSymbolCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(symbolCode);standard=EMPWorldWind.utils.milstd.checkSymbolStandard(item.properties.modifiers);symbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicSymbolCode,standard);if(symbolDef===undefined||symbolDef===null){return result}if(modifiers.hasOwnProperty("distance")){if(modifiers.distance instanceof Array){oAM=modifiers.distance}}if(modifiers.hasOwnProperty("azimuth")){if(modifiers.azimuth instanceof Array){oAN=modifiers.azimuth}}switch(symbolDef.drawCategory){case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>0){oAM=oAM.slice(0,1)}else{oAM[0]=5e3}overrides={distance:oAM};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>=2&&typeof oAM[0]==="number"&&typeof oAM[1]==="number"){oAM=oAM.slice(0,2)}else{if(oAM[0]===undefined||typeof oAM[0]!=="number"){oAM[0]=1e4}if(oAM[1]===undefined||typeof oAM[1]!=="number"){oAM[1]=5e3}oAM=oAM.slice(0,2)}if(oAN!==null&&oAN.length>=1&&typeof oAN[1]==="number"){oAN=oAN.slice(0,1)}else{if(oAN[0]===undefined||typeof oAN[0]!=="number"){oAN[0]=0}oAN=oAN.slice(0,1)}overrides={distance:oAM,azimuth:oAN};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>=2){for(i=0;i<oAM.length;){if(typeof oAM[i]!=="number"){oAM.splice(i,1)}else{i++}}}if(oAM.length>1){for(i=0;i<oAM.length;i++){if(oAM[i]===undefined){oAM[i]=i===0?2e3:oAM[i-1]+2e3}}}else{if(oAM[0]===undefined){oAM[0]=2e3}}if(oAN.length===0){oAN.push(315);oAN.push(45)}else if(oAN.length===1){var newVal=oAN[0]+90;if(newVal>360){newVal=newVal-360}oAN.push(newVal)}overrides={distance:oAM,azimuth:oAN};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:if(oAM!==null&&oAM.length>0){for(i=0;i<oAM.length;){if(typeof oAM[i]!=="number"){oAM.splice(i,1)}else{i++}}}if(oAM.length<2){for(i=0;i<2;i++){if(oAM[i]===undefined){oAM[i]=i===0?2e3:oAM[i-1]+2e3}}}overrides={distance:oAM};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>0){if(typeof oAM[0]!=="number"){oAM[0]=5e3}oAM=oAM.slice(0,1)}else{oAM[0]=5e3}overrides={distance:oAM};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_LINE:if(oAM===null||oAM.length===0||oAM.length>0&&(isNaN(oAM[0])||oAM[0]===null)){if(item.data&&item.data.coordinates&&item.data.coordinates.length>1){var coord0=item.data.coordinates[0];var coord1=item.data.coordinates[1];var pointCartographic0=new WorldWind.Location(coord0[0],coord0[1]);var pointCartographic1=new WorldWind.Location(coord1[0],coord1[1]);var dist=WorldWind.Location.greatCircleDistance(pointCartographic0,pointCartographic1);lonDistance=dist/4}else{lonDistance=lonDistance/34}oAM[0]=lonDistance;overrides={distance:oAM}}else{overrides={distance:oAM}}break}return overrides};EMPWorldWind.utils.milstd.checkSymbolStandard=function(modifiers){var standard=1,modifiersCopy,modValue;try{if(modifiers!==undefined&&modifiers!==null&&modifiers!==""){modifiersCopy=typeof modifiers==="string"?JSON.parse(modifiers):emp.helpers.copyObject(modifiers);if(modifiersCopy.hasOwnProperty("modifiers")){modifiersCopy=modifiersCopy.modifiers}if(modifiersCopy.hasOwnProperty("renderer")){modValue=modifiersCopy.renderer;if(modValue!==undefined&&modValue!==null&&modValue!==0){if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}else{standard=modValue}}}else if(modifiersCopy.hasOwnProperty("standard")){modValue=modifiersCopy.standard;if(modValue!==undefined&&modValue!==null&&modValue!==0){if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else if(modValue.toLowerCase().indexOf(emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase())>-1){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}else if(modValue.toLowerCase().indexOf(emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B.toLowerCase())>-1){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}else{standard=modValue}}}}}catch(err){window.console.log("Error getting symbol standard")}return standard};EMPWorldWind.utils.convertSymbolStandardToRendererFormat=function(modifiers){var standard,modValue;modValue=modifiers.standard;if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else{standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}return standard};function _hex6ToRGBA(hex){hex=hex.replace("#","");var r,g,b;r=parseInt(hex.substring(0,2),16);g=parseInt(hex.substring(2,4),16);b=parseInt(hex.substring(4,6),16);return{red:r,green:g,blue:b,alpha:1}}function _hex8ToRGBA(hex){var r,g,b,a;a=parseInt(hex.substring(0,2),16)/256;r=parseInt(hex.substring(2,4),16);g=parseInt(hex.substring(4,6),16);b=parseInt(hex.substring(6,8),16);return{red:r,green:g,blue:b,alpha:a}}EMPWorldWind.utils.hexToRGBA=function(hex,alpha,normalize){var newHex;if(!hex){return{red:0,green:0,blue:0,alpha:1}}normalize=EMPWorldWind.utils.defined(normalize)?normalize:true;alpha=EMPWorldWind.utils.defined(alpha)?alpha:1;if(hex.length===8){newHex=_hex8ToRGBA(hex)}else{newHex=_hex6ToRGBA(hex);newHex.alpha=alpha}if(normalize){newHex.red=newHex.red/256;newHex.green=newHex.green/256;newHex.blue=newHex.blue/256}return newHex};EMPWorldWind.utils.normalizeRGBAColor=function(color){var normalize,normalColor=Object.assign({},color);normalize=color.red.toString().indexOf(".")===-1||color.green.toString().indexOf(".")===-1||color.blue.toString().indexOf(".")===-1;if(normalize){normalColor.red=color.red/256;normalColor.green=color.green/256;normalColor.blue=color.blue/256}return normalColor};EMPWorldWind.utils.boundsWidth=function(bounds){return WorldWind.EARTH_RADIUS*WorldWind.Location.greatCircleDistance(new WorldWind.Location(0,bounds.west),new WorldWind.Location(0,bounds.east))};EMPWorldWind.utils.boundsHeight=function(bounds){return WorldWind.EARTH_RADIUS*WorldWind.Location.greatCircleDistance(new WorldWind.Location(bounds.south,0),new WorldWind.Location(bounds.north,0))};EMPWorldWind.utils.selectHighAltitudeRangeImage=function(symbolCode){var affiliationLetter,highAltitudeRangeImage;if(!EMPWorldWind.utils.defined(symbolCode)){return EMPWorldWind.constants.highAltitudeRangeImage.highScaleImageYellow}affiliationLetter=symbolCode.substring(1,2);switch(affiliationLetter.toLowerCase()){case"h":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageRed;break;case"f":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageBlue;break;case"n":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageGreen;break;case"u":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageYellow;break;default:highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageYellow;break}return highAltitudeRangeImage};EMPWorldWind.utils.getSinglePointAltitudeRangeMode=function(CameraAltitude,singlePointAltitudeRanges){if(CameraAltitude<singlePointAltitudeRanges.mid){return EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE}else if(CameraAltitude>=singlePointAltitudeRanges.mid&&CameraAltitude<singlePointAltitudeRanges.high){return EMPWorldWind.constants.SinglePointAltitudeRangeMode.MID_RANGE}else if(CameraAltitude>=singlePointAltitudeRanges.high){return EMPWorldWind.constants.SinglePointAltitudeRangeMode.HIGHEST_RANGE}else{return EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE}};EMPWorldWind.utils.getFontInfo=function(name,size,style){var _ModifierFont;var _ModifierFontStyle=size;if(style!=="bold"||style!=="normal"){_ModifierFontStyle=style}else{_ModifierFontStyle="bold"}_ModifierFont=_ModifierFontStyle+" "+size+"pt "+name;var measurements=armyc2.c2sd.renderer.utilities.RendererUtilities.measureFont(_ModifierFont);return{name:name,size:size,style:style,measurements:measurements}};EMPWorldWind.utils.MultiPointRateLimit=function(fn,delay,context){var queue=[],timer=null;function processQueue(){var index=0;var items=[];while(index<50){var item=queue.shift();if(item&&item.context.isFeaturePresent(item.arguments.id||item.arguments.coreId)){items.push(item.arguments)}if(queue.length===0){break}index=index+1}if(items.length>0){fn.apply(item.context,[items])}if(items.length>0){}if(queue.length===0)clearInterval(timer),timer=null}return function limited(){queue=[];for(var index=0;index<arguments[0].length;index++){var feature=arguments[0][index];queue.push({context:context||this,arguments:feature})}if(!timer){processQueue();timer=setInterval(processQueue,delay)}}};EMPWorldWind.Math={};EMPWorldWind.Math.equalsEpsilon=function(left,right,relativeEpsilon,absoluteEpsilon){absoluteEpsilon=EMPWorldWind.Math.defaultValue(absoluteEpsilon,relativeEpsilon);var absDiff=Math.abs(left-right);return absDiff<=absoluteEpsilon||absDiff<=relativeEpsilon*Math.max(Math.abs(left),Math.abs(right))};EMPWorldWind.Math.defaultValue=function(a,b){if(a!==undefined){return a}return b};EMPWorldWind.Math.EPSILON1=.1;
EMPWorldWind.Math.EPSILON2=.01;EMPWorldWind.Math.EPSILON3=.001;EMPWorldWind.Math.EPSILON4=1e-4;EMPWorldWind.Math.EPSILON5=1e-5;EMPWorldWind.Math.EPSILON6=1e-6;EMPWorldWind.Math.EPSILON7=1e-7;EMPWorldWind.Math.EPSILON8=1e-8;EMPWorldWind.Math.EPSILON9=1e-9;EMPWorldWind.Math.EPSILON10=1e-10;EMPWorldWind.Math.EPSILON11=1e-11;EMPWorldWind.Math.EPSILON12=1e-12;EMPWorldWind.Math.EPSILON13=1e-13;EMPWorldWind.Math.EPSILON14=1e-14;EMPWorldWind.Math.EPSILON15=1e-15;EMPWorldWind.Math.EPSILON16=1e-16;EMPWorldWind.Math.EPSILON17=1e-17;EMPWorldWind.Math.EPSILON18=1e-18;EMPWorldWind.Math.EPSILON19=1e-19;EMPWorldWind.Math.EPSILON20=1e-20;EMPWorldWind.Math.GRAVITATIONALPARAMETER=3986004418e5;EMPWorldWind.Math.SOLAR_RADIUS=6955e5;EMPWorldWind.Math.LUNAR_RADIUS=1737400;EMPWorldWind.Math.SIXTY_FOUR_KILOBYTES=64*1024;EMPWorldWind.Math.sign=function(value){if(value>0){return 1}if(value<0){return-1}return 0};EMPWorldWind.Math.signNotZero=function(value){return value<0?-1:1}})();var EMPWorldWind=window.EMPWorldWind||{};EMPWorldWind.editors=EMPWorldWind.editors||{};EMPWorldWind.editors.primitiveBuilders=function(){var builderMap={};function constructAirControlMeasure(feature,selectionStyle){var primitivePolygon,boundaries,attributes,highlightAttributes,i,selectedFillColor,len=feature.data.coordinates.length;attributes=new WorldWind.ShapeAttributes;highlightAttributes=new WorldWind.ShapeAttributes;if(selectionStyle.fillColor){selectedFillColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.fillColor);highlightAttributes.interiorColor=new WorldWind.Color(selectedFillColor.red,selectedFillColor.green,selectedFillColor.blue,selectedFillColor.alpha)}else{highlightAttributes.interiorColor=WorldWind.Color.YELLOW}boundaries=[];for(i=0;i<len;i++){boundaries.push(new WorldWind.Position(feature.data.coordinates[i][1],feature.data.coordinates[i][0],feature.properties.attributes[0].maxAlt))}primitivePolygon=new WorldWind.Polygon(boundaries,attributes);primitivePolygon.altitudeMode=WorldWind.ABSOLUTE;primitivePolygon.extrude=true;primitivePolygon.highlightAttributes=new WorldWind.ShapeAttributes(highlightAttributes);return primitivePolygon}function constructMilStdSymbol(feature,selectionStyle){var modifiers,shapes=[];function _constructSinglePointMilStdSymbol(feature,modifiers,selectionStyle){var placemark,attributes,highlightAttributes,position,imageInfo,imageCenter,imageBounds,imageOffset,selectedImage,symbolCode,selectedModifiers,eyeDistanceScaling=false;attributes=new WorldWind.PlacemarkAttributes;attributes.drawLeaderLine=feature.properties.extrude||false;attributes.leaderLineAttributes.outlineColor=WorldWind.Color.BLACK;if(feature.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.HIGHEST_RANGE){attributes.imageScale=1;attributes.imageSource=EMPWorldWind.utils.selectHighAltitudeRangeImage(feature.symbolCode);attributes.imageOffset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5);highlightAttributes=new WorldWind.PlacemarkAttributes;highlightAttributes.imageColor=WorldWind.Color.WHITE;highlightAttributes.imageSource=attributes.imageSource}else{if(this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.MID_RANGE&&feature.symbolCode){symbolCode=feature.symbolCode.substr(0,12)+"--"+feature.symbolCode.substr(14)}else{symbolCode=feature.symbolCode}imageInfo=armyc2.c2sd.renderer.MilStdIconRenderer.Render(symbolCode,modifiers);imageCenter=imageInfo.getCenterPoint();imageBounds=imageInfo.getImageBounds();imageOffset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,imageCenter.x/imageBounds.width,WorldWind.OFFSET_FRACTION,1-imageCenter.y/imageBounds.height);attributes.imageScale=this.state.iconSize;attributes.imageOffset=imageOffset;attributes.imageSource=imageInfo.toDataUrl();highlightAttributes=new WorldWind.PlacemarkAttributes(attributes);highlightAttributes.imageColor=WorldWind.Color.WHITE;highlightAttributes.imageOffset=imageOffset;highlightAttributes.imageScale=this.state.selectionStyle.scale;selectedModifiers=Object.assign({},modifiers);selectedModifiers.LINECOLOR=selectionStyle.lineColor;selectedModifiers.FILLCOLOR=selectionStyle.fillColor;selectedImage=armyc2.c2sd.renderer.MilStdIconRenderer.Render(feature.symbolCode,selectedModifiers).toDataUrl();highlightAttributes.imageSource=selectedImage}position=new WorldWind.Position(feature.data.coordinates[1],feature.data.coordinates[0],EMPWorldWind.utils.defined(feature.data.coordinates[2])?feature.data.coordinates[2]:0);placemark=new WorldWind.Placemark(position,eyeDistanceScaling);placemark.alwaysOnTop=true;placemark.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;placemark.attributes=new WorldWind.PlacemarkAttributes(attributes);placemark.highlightAttributes=new WorldWind.PlacemarkAttributes(highlightAttributes);return placemark}if(feature.data.type==="Point"){modifiers=EMPWorldWind.editors.primitiveBuilders.processModifiers.call(this,feature);shapes.push(_constructSinglePointMilStdSymbol.call(this,feature,modifiers,selectionStyle))}else if(feature.data.type==="LineString"){shapes=shapes.concat(EMPWorldWind.editors.primitiveBuilders.constructMultiPointMilStdFeatures.call(this,[feature]))}else{window.console.error("Unhandled feature type: "+feature.data.type+" in EMPWorldWind")}return shapes}function constructSurfaceCircle(feature,selectionStyle){var attributes,location,circlePrimitive;attributes=createShapeAttributes(feature,selectionStyle);location=new WorldWind.Location(feature.coordinates[1],feature.coordinates[0]);circlePrimitive=new WorldWind.SurfaceCircle(location,feature.properties.radius,attributes.attributes);circlePrimitive.displayName=feature.name;circlePrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;circlePrimitive.highlightAttributes=attributes.highlightAttributes;return circlePrimitive}function constructSurfaceEllipse(feature,selectionStyle){var attributes,location,ellipsePrimitive;attributes=createShapeAttributes(feature,selectionStyle);location=new WorldWind.Location(feature.coordinates[1],feature.coordinates[0]);ellipsePrimitive=new WorldWind.SurfaceEllipse(location,feature.properties.semiMajor,feature.properties.semiMinor,feature.properties.azimuth,attributes.attributes);ellipsePrimitive.displayName=feature.name;ellipsePrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;ellipsePrimitive.highlightAttributes=attributes.highlightAttributes;return ellipsePrimitive}function constructSurfacePolyline(feature,selectionStyle){var i,pathPrimitive,attributes,len=feature.data.coordinates.length,locations=[];attributes=createShapeAttributes(feature,selectionStyle);for(i=0;i<len;i++){locations.push(new WorldWind.Location(feature.data.coordinates[i][1],feature.data.coordinates[i][0]))}pathPrimitive=new WorldWind.SurfacePolyline(locations,attributes.attributes);pathPrimitive.displayName=feature.name;pathPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;pathPrimitive.highlightAttributes=attributes.highlightAttributes;pathPrimitive.pathType=WorldWind.RHUMB_LINE;return pathPrimitive}function constructPlacemark(feature,selectionStyle){var position,placemark,attributes,eyeDistanceScaling=false;attributes=createShapeAttributes.call(this,feature,selectionStyle);position=new WorldWind.Position(feature.data.coordinates[1],feature.data.coordinates[0],feature.data.coordinates[2]||0);placemark=new WorldWind.Placemark(position,eyeDistanceScaling,attributes.attributes);placemark.alwaysOnTop=true;placemark.label=feature.name;placemark.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;placemark.highlightAttributes=new WorldWind.PlacemarkAttributes(attributes.highlightAttributes);return placemark}function constructSurfacePolygon(feature,selectionStyle){var polygonPrimitive,attributes,boundaryLen,i,j,boundaries=[],numBounds=feature.data.coordinates.length;attributes=createShapeAttributes(feature,selectionStyle);for(i=0;i<numBounds;i++){boundaryLen=feature.data.coordinates[i].length;var subBoundary=[];for(j=0;j<boundaryLen;j++){subBoundary.push(new WorldWind.Location(feature.data.coordinates[i][j][1],feature.data.coordinates[i][j][0]))}boundaries.push(subBoundary)}polygonPrimitive=new WorldWind.SurfacePolygon(boundaries,attributes.attributes);polygonPrimitive.displayName=feature.name;polygonPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;polygonPrimitive.highlightAttributes=attributes.highlightAttributes;polygonPrimitive.pathType=WorldWind.RHUMB_LINE;return polygonPrimitive}function constructSurfaceRectangle(feature,selectionStyle){var attributes,location,width,height,rectPrimitive;attributes=createShapeAttributes(feature,selectionStyle);location=new WorldWind.Location(feature.coordinates[1],feature.coordinates[0]);if(feature.format===emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE){width=feature.properties.width;height=feature.properties.height}else{width=feature.properties.width;height=feature.properties.width}rectPrimitive=new WorldWind.SurfaceRectangle(location,width,height,feature.properties.azimuth,attributes.attributes);rectPrimitive.displayName=feature.name;rectPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;rectPrimitive.highlightAttributes=attributes.highlightAttributes;rectPrimitive.pathType=WorldWind.RHUMB_LINE;return rectPrimitive}function constructText(feature,selectionStyle){var attributes,position,textPrimitive;attributes=createShapeAttributes(feature,selectionStyle);position=new WorldWind.Position(feature.coordinates[1],feature.coordinates[0],feature.coordinates[2]?feature.coordinates[2]:0);textPrimitive=new WorldWind.GeographicText(position,feature.name);textPrimitive.attributes=attributes.attributes;textPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;textPrimitive.highlightAttributes=attributes.highlightAttributes;return textPrimitive}function createTextAttributes(feature){var textColor,size,attributes=new WorldWind.TextAttributes;attributes.offset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,(-.05),WorldWind.OFFSET_FRACTION,.5);attributes.depthTest=false;if(feature.properties.labelStyle&&feature.properties.labelStyle.color){textColor=EMPWorldWind.utils.normalizeRGBAColor(feature.properties.labelStyle.color)}else if(feature.properties.fontColor){textColor=EMPWorldWind.utils.hexToRGBA(feature.properties.fontColor)}else{textColor=EMPWorldWind.utils.hexToRGBA(EMPWorldWind.constants.propertyDefaults.FILL_COLOR_HEX)}attributes.color=new WorldWind.Color(textColor.red,textColor.green,textColor.blue,textColor.alpha);if(feature.properties.labelStyle&&feature.properties.labelStyle.family){attributes.font.family=feature.properties.labelStyle.family}else if(feature.properties.fontFamily){attributes.font.family=feature.properties.fontFamily}if(feature.properties.labelStyle&&feature.properties.labelStyle.justification){attributes.font.horizontalAlignment=feature.properties.labelStyle.justification}else if(feature.properties.labelAlign){attributes.font.horizontalAlignment=feature.properties.labelAlign}if(feature.properties.labelStyle&&feature.properties.labelStyle.size){attributes.font.size=feature.properties.labelStyle.size}else if(feature.properties.fontSize){size=feature.properties.fontSize;size=size.substring(0,size.length-2);if(!isNaN(size)){attributes.font.size=parseInt(feature.properties.fontSize)}}if(feature.properties.labelStyle&&feature.properties.labelStyle.scale){attributes.scale=feature.properties.labelStyle.scale}return attributes}function createShapeAttributes(feature,selectionStyle){var attributes;function _createTextAttributes(feature,selectionStyle){var attributes,highlightAttributes,selectedLabelColor;attributes=createTextAttributes(feature);highlightAttributes=new WorldWind.TextAttributes(attributes);if(selectionStyle.lineColor){selectedLabelColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.color=new WorldWind.Color(selectedLabelColor.red,selectedLabelColor.green,selectedLabelColor.blue,selectedLabelColor.alpha)}else{highlightAttributes.color=WorldWind.Color.YELLOW}return{attributes:attributes,highlightAttributes:highlightAttributes}}function _createPlacemarkAttributes(feature,selectionStyle){var attributes,highlightAttributes,selectedLineColor;attributes=new WorldWind.PlacemarkAttributes;attributes.drawLeaderLine=feature.properties.extrude||false;if(feature.properties.iconUrl){attributes.imageSource=feature.properties.iconUrl;if(feature.properties.useProxy){attributes.imageSource=emp3.api.global.configuration.urlProxy+"?url="+attributes.imageSource}}else{attributes.imageSource=WorldWind.configuration.baseUrl+"images/emp-default-icon.png"}attributes.imageScale=this.state.iconSize;attributes.labelAttributes=createTextAttributes(feature);highlightAttributes=new WorldWind.PlacemarkAttributes(attributes);highlightAttributes.labelAttributes=new WorldWind.TextAttributes(attributes.labelAttributes);if(selectionStyle.scale){highlightAttributes.imageScale=selectionStyle.scale}if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.imageColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.imageColor=WorldWind.Color.YELLOW}highlightAttributes.labelAttributes.offset=attributes.labelAttributes.offset;highlightAttributes.labelAttributes.color=highlightAttributes.imageColor;return{attributes:attributes,highlightAttributes:highlightAttributes}}function _createSurfaceShapeAttributes(feature,selectionStyle){var attributes,highlightAttributes,lineColor,fillColor,selectedLineColor,selectedFillColor;attributes=new WorldWind.ShapeAttributes;if(feature.properties.strokeStyle&&feature.properties.strokeStyle.strokeColor){lineColor=EMPWorldWind.utils.normalizeRGBAColor(feature.properties.strokeStyle.strokeColor);attributes.outlineColor=new WorldWind.Color(lineColor.red,lineColor.green,lineColor.blue,lineColor.alpha)}else{attributes.outlineColor=WorldWind.Color.BLACK}if(feature.properties.fillColor){fillColor=EMPWorldWind.utils.hexToRGBA(feature.properties.fillColor);attributes.interiorColor=new WorldWind.Color(fillColor.red,fillColor.green,fillColor.blue,fillColor.alpha)}else{attributes.drawInterior=false}if(feature.properties.strokeStyle&&feature.properties.strokeStyle.strokeWidth){attributes.outlineWidth=!isNaN(parseInt(feature.properties.strokeStyle.strokeWidth))?parseInt(feature.properties.strokeStyle.strokeWidth):EMPWorldWind.constants.propertyDefaults.LINE_WIDTH;attributes.outlineWidth*=.3}else if(feature.properties.strokeWidth||feature.properties.lineWidth){attributes.outlineWidth=parseInt(feature.properties.strokeWidth)||parseInt(feature.properties.lineWidth);attributes.outlineWidth*=.3}if(feature.properties.strokeStyle&&feature.properties.strokeStyle.stippleFactor){attributes.outlineStippleFactor=parseInt(feature.properties.strokeStyle.stippleFactor)}else{attributes.outlineStippleFactor=parseInt(feature.properties.stippleFactor)||parseInt(attributes.outlineStippleFactor)}if(feature.properties.strokeStyle&&feature.properties.strokeStyle.stipplePattern){attributes.outlineStipplePattern=feature.properties.strokeStyle.stipplePattern}else{attributes.outlineStipplePattern=feature.properties.stipplePattern||attributes.outlineStipplePattern}highlightAttributes=new WorldWind.ShapeAttributes(attributes);if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.outlineColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.outlineColor=WorldWind.Color.YELLOW}if(selectionStyle.fillColor){selectedFillColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.fillColor);highlightAttributes.interiorColor=new WorldWind.Color(selectedFillColor.red,selectedFillColor.green,selectedFillColor.blue,selectedFillColor.alpha)}else{highlightAttributes.drawInterior=false}return{attributes:attributes,highlightAttributes:highlightAttributes}}switch(feature.format){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:attributes=_createPlacemarkAttributes.call(this,feature,selectionStyle);break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:attributes=_createTextAttributes.call(this,feature,selectionStyle);break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:attributes=_createSurfaceShapeAttributes(feature,selectionStyle);break;default:attributes=_createSurfaceShapeAttributes(feature,selectionStyle)}return attributes}builderMap[emp3.api.enums.FeatureTypeEnum.GEO_ACM]=constructAirControlMeasure;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE]=constructSurfaceCircle;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE]=constructSurfaceEllipse;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL]=constructMilStdSymbol;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_PATH]=constructSurfacePolyline;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_POINT]=constructPlacemark;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_POLYGON]=constructSurfacePolygon;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE]=constructSurfaceRectangle;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_SQUARE]=constructSurfaceRectangle;builderMap[emp3.api.enums.FeatureTypeEnum.GEO_TEXT]=constructText;return{getPrimitiveBuilderForFeature:function(empFeature){if(empFeature.format in builderMap){return builderMap[empFeature.format]}},constructMultiPointMilStdFeatures:function(features){var bbox,bounds,scale,featureCoords,data={};bounds=this.getBounds();bbox=bounds.west+","+bounds.south+","+bounds.east+","+bounds.north;data.bbox=bbox;data.batch=[];scale=EMPWorldWind.utils.boundsWidth(bounds)>>2;data.scale=scale;data.format=EMPWorldWind.constants.MultiPointRenderType.GEOJSON;data.pixelHeight=this.worldWindow.canvas.clientHeight;data.pixelWidth=this.worldWindow.canvas.clientWidth;data.fontInfo=EMPWorldWind.utils.getFontInfo("arial",10,"bold");emp.util.each(features,function(feature){var i,modifiers,batchObject={},positions="";modifiers=EMPWorldWind.editors.primitiveBuilders.processModifiers.call(this,feature);featureCoords=feature.data.coordinates.join().split(",");for(i=0;i<featureCoords.length;i+=2){positions+=featureCoords[i]+","+featureCoords[i+1]+" "}positions=positions.trim();modifiers[armyc2.c2sd.renderer.utilities.MilStdAttributes.GeoJSONFormat]=1;var basicSymbolId=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(feature.symbolCode);var symbolDefTable=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicSymbolId,1);if(featureCoords.length/2>=symbolDefTable.minPoints){batchObject.id=feature.coreId;batchObject.name=feature.name;batchObject.description=unescape(feature.description);batchObject.symbolID=feature.symbolCode;batchObject.scale=scale;batchObject.bbox=data.bbox;batchObject.modifiers=modifiers;batchObject.format=EMPWorldWind.constants.MultiPointRenderType.GEOJSON;batchObject.symstd=1;batchObject.fontInfo=EMPWorldWind.utils.getFontInfo("arial",10,"bold");batchObject.altMode=WorldWind.CLAMP_TO_GROUND;batchObject.points=positions;data.batch.push(batchObject)}}.bind(this));if(this.secRendererWorker.lastSelected===EMPWorldWind.constants.RendererWorker.B){this.secRendererWorker.A.postMessage(data);this.secRendererWorker.lastSelected=EMPWorldWind.constants.RendererWorker.A}else{this.secRendererWorker.B.postMessage(data);this.secRendererWorker.lastSelected=EMPWorldWind.constants.RendererWorker.B}return[]},processModifiers:function(feature){var modifiers,enhancedModifiers,override,lowRangeMode,showLabels;lowRangeMode=feature.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE;if(feature.data.type==="Point"){modifiers=EMPWorldWind.utils.milstd.updateModifierLabels(feature.properties,feature.name,this.state.labelStyles,this.state.pixelSize);showLabels=this.state.labelStyles.CN===true&&lowRangeMode}else{modifiers=EMPWorldWind.utils.milstd.updateModifierLabels(feature.properties,feature.name,EMPWorldWind.constants.AllLabels,this.state.pixelSize);showLabels=true}modifiers=EMPWorldWind.utils.milstd.convertModifierStringTo2525(modifiers,showLabels);enhancedModifiers=EMPWorldWind.utils.milstd.checkForRequiredModifiers(feature);for(override in enhancedModifiers){if(enhancedModifiers.hasOwnProperty(override)){modifiers[override]=enhancedModifiers[override]}}return modifiers},constructSurfacePolylineFromGeoJSON:function(geoJSON,selectionStyle){var i,color,attributes,highlightAttributes,polylinePrimitive,selectedLineColor,len=geoJSON.coordinates.length,locations=[];attributes=new WorldWind.ShapeAttributes;if(geoJSON.properties.strokeColor){color=EMPWorldWind.utils.hexToRGBA(geoJSON.properties.strokeColor,geoJSON.properties.lineOpacity);attributes.outlineColor=new WorldWind.Color(color.red,color.green,color.blue,color.alpha)}else{attributes.outlineColor=WorldWind.Color.BLACK}attributes.outlineWidth=geoJSON.properties.strokeWidth||attributes.outlineWidth;for(i=0;i<len;i++){locations.push(new WorldWind.Location(geoJSON.coordinates[i][1],geoJSON.coordinates[i][0]))}highlightAttributes=new WorldWind.ShapeAttributes;if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.outlineColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.outlineColor=WorldWind.Color.YELLOW}polylinePrimitive=new WorldWind.SurfacePolyline(locations,attributes);polylinePrimitive.altitudeMode=geoJSON.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;polylinePrimitive.highlightAttributes=new WorldWind.ShapeAttributes(highlightAttributes);polylinePrimitive.pathType=WorldWind.RHUMB_LINE;return polylinePrimitive},constructSurfacePolygonFromGeoJSON:function(geoJSON,selectionStyle){var attributes,interiorColor,outlineColor,boundaryLen,polygonPrimitive,selectedLineColor,selectedFillColor,highlightAttributes,i,j,boundaries=[],numBounds=geoJSON.geometry.coordinates.length;for(i=0;i<numBounds;i++){boundaryLen=geoJSON.geometry.coordinates[i].length;var subBoundary=[];for(j=0;j<boundaryLen;j++){subBoundary.push(new WorldWind.Location(geoJSON.geometry.coordinates[i][j][1],geoJSON.geometry.coordinates[i][j][0]))}boundaries.push(subBoundary)}attributes=new WorldWind.ShapeAttributes;if(geoJSON.properties.strokeColor){outlineColor=EMPWorldWind.utils.hexToRGBA(geoJSON.properties.strokeColor);attributes.outlineColor=new WorldWind.Color(outlineColor.red,outlineColor.green,outlineColor.blue,outlineColor.alpha)}else{attributes.outlineColor=WorldWind.Color.BLACK}if(geoJSON.properties.fillColor){interiorColor=EMPWorldWind.utils.hexToRGBA(geoJSON.properties.fillColor);attributes.interiorColor=new WorldWind.Color(interiorColor.red,interiorColor.green,interiorColor.blue,interiorColor.alpha)}else{attributes.drawInterior=false}attributes.outlineWidth=geoJSON.properties.strokeWidth||attributes.outlineWidth;attributes.outlineStippleFactor=geoJSON.properties.stippleFactor||attributes.outlineStippleFactor;attributes.outlineStipplePattern=geoJSON.properties.stipplePattern||attributes.outlineStipplePattern;highlightAttributes=new WorldWind.ShapeAttributes;if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.outlineColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.outlineColor=WorldWind.Color.YELLOW}if(selectionStyle.fillColor){selectedFillColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.fillColor);highlightAttributes.interiorColor=new WorldWind.Color(selectedFillColor.red,selectedFillColor.green,selectedFillColor.blue,selectedFillColor.alpha)}else{highlightAttributes.drawInterior=false}polygonPrimitive=new WorldWind.SurfacePolygon(boundaries,attributes);polygonPrimitive.altitudeMode=geoJSON.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;polygonPrimitive.displayName=geoJSON.properties.name;polygonPrimitive.highlightAttributes=new WorldWind.ShapeAttributes(highlightAttributes);polygonPrimitive.pathType=WorldWind.RHUMB_LINE;return polygonPrimitive},constructTextFromGeoJSON:function(geoJSON,selectionStyle){var textPrimitive,attributes,highlightAttributes,selectedColor,position;attributes=createTextAttributes(geoJSON);highlightAttributes=new WorldWind.TextAttributes(attributes);if(selectionStyle.lineColor){selectedColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.color=new WorldWind.Color(selectedColor.red,selectedColor.green,selectedColor.blue,selectedColor.alpha)}else{highlightAttributes.color=WorldWind.Color.YELLOW}position=new WorldWind.Position(geoJSON.geometry.coordinates[1],geoJSON.geometry.coordinates[0],geoJSON.geometry.coordinates[2]?geoJSON.geometry.coordinates[0]:0);textPrimitive=new WorldWind.GeographicText(position,geoJSON.properties.label);textPrimitive.attributes=attributes;textPrimitive.altitudeMode=geoJSON.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;textPrimitive.highlightAttributes=highlightAttributes;return textPrimitive}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.editors=EMPWorldWind.editors||{};EMPWorldWind.editors.EditorController=function(){function asyncPlotKMLFeature(feature,callback){var url,kmlFilePromise,kmlLayer,wwFeature,rc={success:false};url="data:text/xml,"+encodeURIComponent(feature.data);kmlFilePromise=new WorldWind.KmlFile(url);kmlFilePromise.then(function(kmlFile){kmlLayer=new WorldWind.RenderableLayer(feature.coreId);kmlLayer.addRenderable(kmlFile);this.worldWindow.addLayer(kmlLayer);wwFeature=new EMPWorldWind.data.EmpFeature(feature);wwFeature.addShapes(kmlLayer);this.layers[feature.coreId]=kmlLayer;rc.success=true;rc.feature=wwFeature;callback(rc)}.bind(this))}return{plotFeature:function(empFeature,callback){var wwFeature,primitiveBuilder,shapes,rc={message:"",success:true,feature:undefined};if(empFeature.format===emp3.api.enums.FeatureTypeEnum.KML){return asyncPlotKMLFeature.call(this,empFeature,callback)}else{primitiveBuilder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(empFeature);if(!primitiveBuilder){rc.success=false;rc.message="Missing feature constructor for format: "+empFeature.format;return callback(rc)}}wwFeature=new EMPWorldWind.data.EmpFeature(empFeature);wwFeature.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(this.worldWindow.navigator.range,this.singlePointAltitudeRanges);empFeature.singlePointAltitudeRangeMode=wwFeature.singlePointAltitudeRangeMode;empFeature.range=this.worldWindow.navigator.range;shapes=primitiveBuilder.call(this,empFeature,this.state.selectionStyle);wwFeature.addShapes(shapes);rc.feature=wwFeature;return callback(rc)},updateFeature:function(wwFeature,empFeature,callback){var primitiveBuilder,rc={success:true,message:"",feature:wwFeature};var _handleMilStdUpdate=function(){var builder;var _featureIsSame=function(oldfeature,newFeature){return oldfeature.symbolCode===newFeature.symbolCode&&JSON.stringify(oldfeature.properties.modifiers)===JSON.stringify(newFeature.properties.modifiers)&&!this.state.stateChanged};if(empFeature.data.type==="Point"){if(_featureIsSame.call(this,empFeature,wwFeature.feature)&&!empFeature.bCallRenderer){wwFeature.shapes[0].position=new WorldWind.Position(empFeature.data.coordinates[1],empFeature.data.coordinates[0],empFeature.data.coordinates[2]||0);wwFeature.feature=empFeature}else{builder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(empFeature);this.rootLayer.removeFeature(wwFeature);wwFeature.clearShapes();wwFeature.addShapes(builder.call(this,empFeature,this.state.selectionStyle));this.rootLayer.addFeature(wwFeature);wwFeature.feature=empFeature;wwFeature.bCallRenderer=false;empFeature.bCallRenderer=false}}else if(empFeature.data.type==="LineString"){wwFeature.feature=empFeature;builder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(empFeature);builder.call(this,empFeature)}else{}};var _handlePointUpdate=function(){var builder;if(JSON.stringify(wwFeature.feature.properties)===JSON.stringify(empFeature.properties)){wwFeature.shapes[0].position=new WorldWind.Position(empFeature.data.coordinates[1],empFeature.data.coordinates[0],empFeature.data.coordinates[2]||0);wwFeature.feature=empFeature}else{builder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(empFeature);this.rootLayer.removeFeature(wwFeature);wwFeature.clearShapes();wwFeature.addShapes(builder.call(this,empFeature,this.state.selectionStyle));this.rootLayer.addFeature(wwFeature);wwFeature.feature=empFeature}};var _handleDefaultUpdate=function(){var builder;builder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(empFeature);this.rootLayer.removeFeature(wwFeature);wwFeature.clearShapes();wwFeature.addShapes(builder.call(this,empFeature,this.state.selectionStyle));this.rootLayer.addFeature(wwFeature);wwFeature.feature=empFeature};if(empFeature.format===emp3.api.enums.FeatureTypeEnum.KML){this.worldWindow.removeLayer(this.layers[empFeature.coreId]);return asyncPlotKMLFeature.call(this,empFeature,callback)}else if(empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL){_handleMilStdUpdate.call(this)}else if(empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_POINT){_handlePointUpdate.call(this)}else if(empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_PATH||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_ACM||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_POLYGON||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_SQUARE||empFeature.format===emp3.api.enums.FeatureTypeEnum.GEO_TEXT){_handleDefaultUpdate.call(this)}else{primitiveBuilder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(empFeature);if(!primitiveBuilder){rc.success=false;rc.message="Missing feature constructor for format: "+empFeature.format;return callback(rc)}}empFeature.singlePointAltitudeRangeMode=wwFeature.singlePointAltitudeRangeMode;return callback(rc)},updateFeatureLabelStyle:function(wwFeature){var shapes,builder;switch(wwFeature.feature.format){case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:this.rootLayer.removeFeature(wwFeature);wwFeature.clearShapes();builder=EMPWorldWind.editors.primitiveBuilders.getPrimitiveBuilderForFeature(wwFeature.feature);shapes=builder.call(this,wwFeature.feature,this.state.selectionStyle);wwFeature.addShapes(shapes);this.rootLayer.addFeature(wwFeature);break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:default:}},redrawMilStdSymbols:function(features){EMPWorldWind.editors.primitiveBuilders.constructMultiPointMilStdFeatures.call(this,features)}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.throttle=function(fn,threshold,scope){threshold=threshold||20;var last,deferTimer;return function(){var context=scope||this;var now=+new Date,args=arguments;
if(last&&now<last+threshold){clearTimeout(deferTimer);deferTimer=setTimeout(function(){last=now;fn.apply(context,args)},threshold)}else{last=now;fn.apply(context,args)}}};EMPWorldWind.eventHandlers.notifyViewChange=function(viewEventType){var bounds=this.getBounds();var view={range:this.worldWindow.navigator.range,tilt:this.worldWindow.navigator.tilt,roll:this.worldWindow.navigator.roll,heading:this.worldWindow.navigator.heading,altitude:this.worldWindow.navigator.range,location:{lat:this.worldWindow.navigator.lookAtLocation.latitude,lon:this.worldWindow.navigator.lookAtLocation.longitude},bounds:bounds};var lookAt={range:this.worldWindow.navigator.range,tilt:this.worldWindow.navigator.tilt,heading:this.worldWindow.navigator.heading,altitude:this.worldWindow.navigator.lookAtLocation.altitude||0,latitude:this.worldWindow.navigator.lookAtLocation.latitude,longitude:this.worldWindow.navigator.lookAtLocation.longitude};if(viewEventType===emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED){this.lastNavigator.range=this.worldWindow.navigator.range;this.lastNavigator.tilt=this.worldWindow.navigator.tilt;this.lastNavigator.roll=this.worldWindow.navigator.roll;this.lastNavigator.heading=this.worldWindow.navigator.heading;this.lastNavigator.lookAtLocation=emp.helpers.copyObject(this.worldWindow.navigator.lookAtLocation);EMPWorldWind.eventHandlers.triggerRenderUpdate.call(this)}else if(this.isMapMoving()){this.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(this.worldWindow.navigator.range,this.singlePointAltitudeRanges);EMPWorldWind.eventHandlers.triggerRenderUpdate.call(this)}this.empMapInstance.eventing.ViewChange(view,lookAt,viewEventType);this.bounds=bounds};EMPWorldWind.eventHandlers.triggerRenderUpdate=function(){var featuresToRedraw=[];if(this.state.dragging){return}this.state.lastRender.bounds=this.getBounds();this.state.lastRender.altitude=this.worldWindow.navigator.range;function _handleMidOrLowRange(feature){feature.isHighAltitudeRangeImage=false;feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.singlePointAltitudeRangeChanged=false}function _handleHighRange(feature){feature.isHighAltitudeRangeImage=true;feature.shapes[0].attributes._imageSource=EMPWorldWind.utils.selectHighAltitudeRangeImage(feature.feature.symbolCode);feature.shapes[0].attributes.imageOffset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5);feature.shapes[0].highlightAttributes._imageSource=feature.shapes[0].attributes._imageSource;feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.singlePointAltitudeRangeChanged=false}function _handleMultiPoint(features){this.throttleAddMultiPointRedraws.call(this,features)}function _handleSinglePoint(feature){feature.singlePointAltitudeRangeChanged=feature.singlePointAltitudeRangeMode!==this.singlePointAltitudeRangeMode;if(feature.singlePointAltitudeRangeChanged){if(this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE&&this.iconLabelOption!=="none"||this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.MID_RANGE){feature.bCallRenderer=true;feature.feature.bCallRenderer=true;_handleMidOrLowRange.call(this,feature)}else if(this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.HIGHEST_RANGE){_handleHighRange.call(this,feature)}}this.plotFeature(feature)}emp.util.each(Object.keys(this.features),function(featureId){var feature=this.features[featureId];if(feature.feature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&feature.feature.data.type==="LineString"){if(this.isMilStdMultiPointShapeInViewRegion(feature.feature)&&(!EMPWorldWind.Math.equalsEpsilon(feature.feature.range,this.lastNavigator.range,EMPWorldWind.Math.EPSILON1)||feature.feature.wasClipped)){featuresToRedraw.push(feature.feature)}}else if(feature.feature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&feature.feature.data.type==="Point"){_handleSinglePoint.call(this,feature)}}.bind(this));if(featuresToRedraw.length>0){_handleMultiPoint.call(this,featuresToRedraw)}this.worldWindow.redraw()};EMPWorldWind.eventHandlers.extractFeatureFromEvent=function(mouseEvent,empEventingArgs){var obj,i,pickList=this.worldWindow.pick(this.worldWindow.canvasCoordinates(mouseEvent.clientX,mouseEvent.clientY)),len=pickList.objects.length;for(i=len-1;i>=0;i--){obj=pickList.objects[i];if(!obj.isTerrain){if(obj.userObject.userProperties&&obj.userObject.userProperties.id){empEventingArgs.coreId=obj.userObject.userProperties.id;empEventingArgs.target="feature";break}}}};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.mouse=function(){var throttleTime=50;var _notifyEMPPointing=EMPWorldWind.eventHandlers.throttle(function(event){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event);coords.type=emp.typeLibrary.Pointer.EventType.MOVE;if(coords.lat!==undefined){this.empMapInstance.eventing.Pointer(coords)}},throttleTime);var _notifyEMPViewChanged=EMPWorldWind.eventHandlers.throttle(function(state){EMPWorldWind.eventHandlers.notifyViewChange.call(this,state)},throttleTime);var _isDuplicateEvent=function(a,b){if(!a||!b){return false}return a.clientX===b.clientX&&a.clientY===b.clientY&&a.buttons===b.buttons};return{click:function(event){var clickEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);clickEvent.type=emp.typeLibrary.Pointer.EventType.SINGLE_CLICK;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,clickEvent);this.empMapInstance.eventing.Pointer(clickEvent)},dblclick:function(event){var dblClickEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);dblClickEvent.type=emp.typeLibrary.Pointer.EventType.DBL_CLICK;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,dblClickEvent);this.empMapInstance.eventing.Pointer(dblClickEvent)},wheel:function(event){var deltaY=event.wheelDeltaY||-event.deltaY||0;if(deltaY<0&&this.worldWindow.navigator.range>EMPWorldWind.constants.view.MAX_HEIGHT){this.worldWindow.navigator.range=EMPWorldWind.constants.view.MAX_HEIGHT;event.preventDefault()}var preventDefaultLockStates=[emp3.api.enums.MapMotionLockEnum.NO_MOTION,emp3.api.enums.MapMotionLockEnum.NO_ZOOM_NO_PAN,emp3.api.enums.MapMotionLockEnum.NO_ZOOM];if(preventDefaultLockStates.includes(this.state.lockState)){event.preventDefault()}EMPWorldWind.eventHandlers.notifyViewChange.call(this)},mousedown:function(event){if(_isDuplicateEvent(event,this.state.lastInteractionEvent)){return}else{this.state.lastInteractionEvent=event}var mousedownEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);mousedownEvent.type=emp.typeLibrary.Pointer.EventType.MOUSEDOWN;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,mousedownEvent);this.empMapInstance.eventing.Pointer(mousedownEvent)},mouseup:function(event){if(_isDuplicateEvent(event,this.state.lastInteractionEvent)){return}else{this.state.lastInteractionEvent=event}var mouseupEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);mouseupEvent.type=emp.typeLibrary.Pointer.EventType.MOUSEUP;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,mouseupEvent);if(this.state.dragging){this.state.dragging=false;EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}this.empMapInstance.eventing.Pointer(mouseupEvent)},mousemove:function(event){var _handleSmartMotion=function(){var smartAreaBuffer=.05,element=event.srcElement||event.originalTarget,elementBounds=element.getBoundingClientRect(),pan={up:false,down:false,left:false,right:false};pan.left=event.offsetX<elementBounds.width*smartAreaBuffer;pan.right=event.offsetX>elementBounds.width-elementBounds.width*smartAreaBuffer;pan.up=event.offsetY<elementBounds.height*smartAreaBuffer;pan.down=event.offsetY>elementBounds.height-elementBounds.height*smartAreaBuffer;if(pan.up||pan.down||pan.left||pan.right){this.spinGlobe(pan)}else{this.spinGlobe(false)}}.bind(this);var _checkForPreventDefault=function(){var preventDefault=[emp3.api.enums.MapMotionLockEnum.NO_MOTION,emp3.api.enums.MapMotionLockEnum.NO_PAN,emp3.api.enums.MapMotionLockEnum.NO_ZOOM_NO_PAN,emp3.api.enums.MapMotionLockEnum.SMART_MOTION];if(preventDefault.includes(this.state.lockState)){event.preventDefault()}}.bind(this);_checkForPreventDefault();if(_isDuplicateEvent(event,this.state.lastInteractionEvent)){return}else{this.state.lastInteractionEvent=event}if(this.state.lockState===emp3.api.enums.MapMotionLockEnum.SMART_MOTION){_handleSmartMotion()}if(this.state.lockState===emp3.api.enums.MapMotionLockEnum.NO_PAN){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event);coords.type=emp.typeLibrary.Pointer.EventType.MOVE;if(coords.lat!==undefined){this.empMapInstance.eventing.Pointer(coords)}}else{_notifyEMPPointing.call(this,event)}if(event.buttons!==0&&event.buttons<3){this.state.dragging=true;_notifyEMPViewChanged.call(this,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION)}else{this.state.dragging=false}}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.touch=function(){return{touchstart:function(event){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event.touches[0]);coords.type=emp.typeLibrary.Pointer.EventType.MOUSEDOWN;this.state.lastInteractionEvent=event;this.empMapInstance.eventing.Pointer(coords)},touchend:function(){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,this.state.lastInteractionEvent.touches[0]);coords.type=emp.typeLibrary.Pointer.EventType.MOUSEUP;this.empMapInstance.eventing.Pointer(coords)},touchcancel:function(){},touchmove:function(event){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event.touches[0]);coords.type=emp.typeLibrary.Pointer.EventType.MOVE;if(coords.lat!==undefined){this.empMapInstance.eventing.Pointer(coords)}this.state.lastInteractionEvent=event;EMPWorldWind.eventHandlers.notifyViewChange.call(this)}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.drag=function(){return{began:function(){},changed:function(){},ended:function(){}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.pointer=function(){return{pointerdown:EMPWorldWind.eventHandlers.mouse.mousedown,pointerup:EMPWorldWind.eventHandlers.mouse.mouseup,pointermove:EMPWorldWind.eventHandlers.mouse.mousemove}}();
//# sourceMappingURL=emp3-worldwind.min.js.map