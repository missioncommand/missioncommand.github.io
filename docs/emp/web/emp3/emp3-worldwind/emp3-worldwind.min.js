/*! emp3-web-sdk 2.2.0 29-03-2017 */

var EMPWorldWind=window.EMPWorldWind||{};var emp=window.emp||{};emp.engineDefs=emp.engineDefs||{};emp.engineDefs.worldWindMapEngine=function(args){var empMapInstance=args.mapInstance;var empWorldWind;var engineInterface=emp.map.createEngineTemplate(),mapEngineExposed=engineInterface;engineInterface.implementation.displayName="WorldWind Map Engine";engineInterface.implementation.version="1.0.0";engineInterface.capabilities.mapType.type3D=true;engineInterface.capabilities.mapType.type2_5D=true;engineInterface.capabilities.mapType.type3D=true;engineInterface.capabilities.formats.GEOJSON_BASIC.plot=true;engineInterface.capabilities.formats.GEOJSON_BASIC.draw=true;engineInterface.capabilities.formats.GEOJSON_BASIC.edit=true;engineInterface.capabilities.formats.GEOJSON_FULL.plot=true;engineInterface.capabilities.formats.GEOJSON_FULL.edit=true;engineInterface.capabilities.formats.WMS.version_1_1=true;engineInterface.capabilities.formats.WMS.version_1_3=true;engineInterface.capabilities.formats.WMS.elevationData=true;engineInterface.capabilities.formats.KML_BASIC.plot=true;engineInterface.capabilities.formats.KML_BASIC.draw=true;engineInterface.capabilities.formats.KML_BASIC.edit=true;engineInterface.capabilities.formats.KML_COMPLEX.plot=true;engineInterface.capabilities.formats.IMAGE.plot=true;engineInterface.capabilities.formats.MILSTD.version2525B.plot=true;engineInterface.capabilities.formats.MILSTD.version2525B.draw=true;engineInterface.capabilities.formats.MILSTD.version2525B.edit=true;engineInterface.capabilities.formats.MILSTD.version2525C.plot=true;engineInterface.capabilities.formats.MILSTD.version2525C.draw=true;engineInterface.capabilities.formats.MILSTD.version2525C.edit=true;engineInterface.capabilities.formats.AIRSPACE.plot=true;engineInterface.capabilities.formats.AIRSPACE.draw=true;engineInterface.capabilities.formats.AIRSPACE.edit=true;engineInterface.capabilities.formats.AOI.plot=true;engineInterface.capabilities.formats.AOI.draw=true;engineInterface.capabilities.formats.AOI.edit=true;engineInterface.capabilities.settings.milstd.iconSize=true;engineInterface.capabilities.settings.milstd.labelOption=true;engineInterface.requirements.wmsCapabilities=true;engineInterface.capabilities.projection.flat=false;engineInterface.initialize.succeed=function(empWorldWindInstance){try{empWorldWind=empWorldWindInstance;empWorldWind.mapEngineExposed=mapEngineExposed;emp.map.engineDirect={name:"worldwind",ref:empWorldWind};empMapInstance.eventing.StatusChange({status:emp.map.states.READY})}catch(err){window.console.error("Error initializing WorldWind ",err)}};engineInterface.initialize.fail=function(){empMapInstance.eventing.StatusChange({status:emp.map.states.MAP_INSTANCE_INIT_FAILED})};engineInterface.view.set=function(transaction){var args,altitude,bottomLeft,topRight,feature,bufferScale,t1,t2,toRad=Math.PI/180;switch(transaction.items[0].globalType){case"view":if(transaction.items[0].location){args={latitude:transaction.items[0].location.lat,longitude:transaction.items[0].location.lon,altitude:transaction.items[0].altitude,tilt:transaction.items[0].tilt,roll:transaction.items[0].roll,heading:transaction.items[0].heading}}else if(transaction.items[0].bounds){bottomLeft={lat:transaction.items[0].bounds.west*toRad,lon:transaction.items[0].bounds.south*toRad};topRight={lat:transaction.items[0].bounds.east*toRad,lon:transaction.items[0].bounds.north*toRad};t1=Math.pow(Math.sin((topRight.lat-bottomLeft.lat)/2),2);t2=Math.pow(Math.sin((topRight.lon-bottomLeft.lon)/2),2);altitude=2*WorldWind.EARTH_RADIUS*Math.asin(Math.sqrt(t1+Math.cos(topRight.lat)*Math.cos(bottomLeft.lat)*t2));args={latitude:(transaction.items[0].bounds.north+transaction.items[0].bounds.south)/2,longitude:(transaction.items[0].bounds.east+transaction.items[0].bounds.west)/2,altitude:altitude,tilt:0,roll:0,heading:0}}break;case"feature":bufferScale=2.25;feature=transaction.items[0];switch(feature.format){case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:altitude=feature.properties.radius*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:altitude=Math.max(feature.properties.semiMajor,feature.properties.semiMinor)*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:altitude=Math.max(feature.properties.width,feature.properties.height)*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:altitude=feature.properties.width*bufferScale;break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:default:altitude=1e4}args={latitude:transaction.items[0].coordinates[1],longitude:transaction.items[0].coordinates[0],altitude:altitude,tilt:0,roll:0,heading:0};break;default:transaction.failures.push(transaction.items[0])}if(transaction.items[0].animate===true){transaction.pause();args.animate=true;args.animateCB=function(){transaction.items[0].location={lat:empWorldWind.getCenter().latitude,lon:empWorldWind.getCenter().longitude};transaction.items[0].bounds=empWorldWind.getBounds();transaction.run();EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}}EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION);empWorldWind.centerOnLocation(args);transaction.items[0].location={lat:empWorldWind.getCenter().latitude,lon:empWorldWind.getCenter().longitude};transaction.items[0].bounds=empWorldWind.getBounds()};engineInterface.lookAt.set=function(transaction){var args={latitude:transaction.items[0].latitude,longitude:transaction.items[0].longitude,altitude:transaction.items[0].altitude,range:transaction.items[0].range,tilt:transaction.items[0].tilt,heading:transaction.items[0].heading};if(transaction.items[0].animate===true){transaction.pause();args.animate=true;args.animateCB=function(){transaction.run();EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}}EMPWorldWind.eventHandlers.notifyViewChange.call(empWorldWind,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION);empWorldWind.lookAt(args)};engineInterface.overlay.add=function(transaction){var rc,failList=[];emp.util.each(transaction.items,function(overlay){rc=empWorldWind.addLayer(overlay);if(!rc.success){failList.push(new emp.typeLibrary.Error({coreId:overlay.coreId,message:rc.message,level:emp.typeLibrary.Error.level.MINOR}))}});transaction.fail(failList)};engineInterface.overlay.remove=function(transaction){var rc={},failList=[];emp.util.each(transaction.items,function(overlay){rc=empWorldWind.removeLayer(overlay.overlayId);if(!rc.success){failList.push(new emp.typeLibrary.Error({coreId:overlay.coreId,message:rc.message}))}}.bind(this));transaction.fail(failList)};engineInterface.wms.add=function(transaction){emp.util.each(transaction.items,function(wms){empWorldWind.addWMS(wms)}.bind(this))};engineInterface.wms.remove=function(transaction){emp.util.each(transaction.items,function(wms){empWorldWind.removeWMS(wms)}.bind(this))};engineInterface.feature.add=function(transaction){var feature,itemsCount=transaction.items.length;transaction.pause();while(itemsCount){feature=transaction.items[--itemsCount];empWorldWind.plotFeature(feature,function(featureCount,cbArgs){if(!cbArgs.success){transaction.fail(new emp.typeLibrary.Error({feature:cbArgs.feature}))}if(featureCount===0){transaction.run()}}.bind(this,itemsCount))}};engineInterface.feature.remove=function(transaction){var rc;emp.util.each(transaction.items,function(feature){rc=empWorldWind.unplotFeature(feature);if(!rc.success){transaction.fail(new emp.typeLibrary.Error({message:rc.message}))}}.bind(this))};engineInterface.settings.mil2525.icon.labels.set=function(transaction){empWorldWind.setLabelStyle(transaction.items[0])};engineInterface.view.getLatLonFromXY=function(transaction){var pickPoint=new WorldWind.Vec2(transaction.items[0].x,transaction.items[0].y);var terrainObject=empWorldWind.worldWindow.pickTerrain(pickPoint).terrainObject();transaction.items[0].lat=terrainObject?terrainObject.position.latitude:undefined;transaction.items[0].lon=terrainObject?terrainObject.position.longitude:undefined};engineInterface.visibility.set=function(transaction){emp.util.each(transaction.items,function(feature){if(feature.featureId in empWorldWind.features){empWorldWind.features[feature.featureId].setVisible(feature.visible)}}.bind(this));empWorldWind.refresh()};engineInterface.map.config=function(transaction){var bRangeChanged;emp.util.each(transaction.items,function(config){var prop,value;for(prop in config){if(config.hasOwnProperty(prop)){if(prop==="messageId"){continue}value=config[prop];switch(prop.toLowerCase()){case"brightness":empWorldWind.setContrast(value);break;case"milstdlabels":empWorldWind.setLabelStyle(value);break;case"renderingOptimization":if(EMPWorldWind.utils.defined(value)&&value!==empWorldWind.enableRenderingOptimization){bRangeChanged=true;empWorldWind.enableRenderingOptimization=value}break;case"midDistanceThreshold":if(EMPWorldWind.utils.defined(value)&&value!==empWorldWind.singlePointAltitudeRanges.mid){bRangeChanged=true;empWorldWind.singlePointAltitudeRanges.mid=value}break;case"farDistanceThreshold":if(EMPWorldWind.utils.defined(value)&&value!==empWorldWind.singlePointAltitudeRanges.high){bRangeChanged=true;empWorldWind.singlePointAltitudeRanges.high=value}break;default:transaction.fail(new emp.typeLibrary.Error({message:"Config property "+prop+" is not supported by this engine"}))}if(bRangeChanged){empWorldWind.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(empWorldWind.worldWind.navigator.range,empWorldWind.singlePointAltitudeRanges);empWorldWind.refresh()}}}}.bind(this))};engineInterface.navigation.enable=function(transaction){empWorldWind.setLockState(transaction.items[0])};engineInterface.selection.set=function(transaction){var rc=empWorldWind.selectFeatures(transaction.items);transaction.failures=rc.failed};engineInterface.capture.screenshot=function(transaction){return transaction.items[0].dataUrl=empWorldWind.screenshot()};engineInterface.state.destroy=function(){if(empWorldWind){empWorldWind.shutdown();empWorldWind=undefined}};return engineInterface};var EMPWorldWind={};EMPWorldWind.isV2Core=false;EMPWorldWind.map=function(wwd){this.worldWindow=wwd;this.layers={};this.features={};this.state={pixelSize:1,drawing:false,editing:false,dragging:false,lastInteractionEvent:undefined,lockState:emp3.api.enums.MapMotionLockEnum.UNLOCKED,lastRender:{bounds:{north:0,south:0,east:0,west:0},altitude:0},selectionStyle:{scale:1,lineColor:"#FFFF00",fillColor:undefined},autoPanning:{step:.5,up:false,down:false,left:false,right:false},labelStyles:{V:false,L:false,S:false,AA:false,AB:false,AC:true,H:false,M:false,T:false,T1:false,CN:false,C:false,F:false,G:false,H1:false,H2:false,J:false,K:false,N:false,P:false,W:false,W1:false,X:false,Y:false,Z:false}};this.singlePointAltitudeRanges={};this.singlePointAltitudeRanges.mid=6e5;this.singlePointAltitudeRanges.high=12e5;this.singlePointAltitudeRangeMode=EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE;this.empSelections={};this.optimizationMapMoveEpsilon=EMPWorldWind.Math.EPSILON7;this.lastNavigator={};this.shapesInViewArea;this.bounds};EMPWorldWind.map.prototype.initialize=function(args){this.empMapInstance=args.mapInstance;var blackContrastLayer=new WorldWind.SurfaceSector(WorldWind.Sector.FULL_SPHERE,null);blackContrastLayer.attributes.interiorColor=new WorldWind.Color(0,0,0,0);blackContrastLayer.attributes.drawOutline=false;var whiteContrastLayer=new WorldWind.SurfaceSector(WorldWind.Sector.FULL_SPHERE,null);whiteContrastLayer.attributes.interiorColor=new WorldWind.Color(1,1,1,0);whiteContrastLayer.attributes.drawOutline=false;this.contrastLayer=new WorldWind.RenderableLayer("contrast layer");this.contrastLayer.pickEnabled=false;this.worldWindow.addLayer(this.contrastLayer);this.contrastLayer.addRenderable(whiteContrastLayer);this.contrastLayer.addRenderable(blackContrastLayer);this.goToAnimator=new WorldWind.GoToAnimator(this.worldWindow);this.dragRecognizer=new WorldWind.DragRecognizer(this.worldWindow.canvas,function(event){if(event.state in EMPWorldWind.eventHandlers.drag){EMPWorldWind.eventHandlers.drag[event.state].call(this,event)}}.bind(this));var throttleValue=50;var eventClass,eventHandler;for(eventClass in EMPWorldWind.eventHandlers){if(EMPWorldWind.eventHandlers.hasOwnProperty(eventClass)){eventClass=EMPWorldWind.eventHandlers[eventClass];for(eventHandler in eventClass){if(eventClass.hasOwnProperty(eventHandler)){this.worldWindow.addEventListener(eventHandler,EMPWorldWind.eventHandlers.throttle(eventClass[eventHandler].bind(this),throttleValue,this))}}}}if(args.extent){if(!isNaN(args.extent.north)&&!isNaN(args.extent.south)&&!isNaN(args.extent.east)&&!isNaN(args.extent.west)){var alt=Math.PI*WorldWind.EARTH_RADIUS*WorldWind.Location.greatCircleDistance(new WorldWind.Location(args.extent.north,args.extent.west),new WorldWind.Location(args.extent.south,args.extent.east));this.centerOnLocation({latitude:(args.extent.north+args.extent.south)/2,longitude:(args.extent.east+args.extent.west)/2,altitude:alt})}else if(!isNaN(args.extent.centerLat)&&!isNaN(args.extent.centerLon)){this.centerOnLocation({latitude:args.extent.centerLat,longitude:args.extent.centerLon,altitude:1e7})}}if(this.worldWindow.navigator){this.lastNavigator.range=this.worldWindow.navigator.range;this.lastNavigator.tilt=this.worldWindow.navigator.tilt;this.lastNavigator.roll=this.worldWindow.navigator.roll;this.lastNavigator.heading=this.worldWindow.navigator.heading;this.lastNavigator.lookAtLocation=emp.helpers.copyObject(this.worldWindow.navigator.lookAtLocation)}if(EMPWorldWind.utils.defined(args.configProperties.midDistanceThreshold)){this.singlePointAltitudeRanges.mid=args.configProperties.midDistanceThreshold}if(EMPWorldWind.utils.defined(args.configProperties.farDistanceThreshold)){this.singlePointAltitudeRanges.far=args.configProperties.farDistanceThreshold}if(EMPWorldWind.utils.defined(args.configProperties.brightness)){this.setContrast(args.configProperties.brightness)}EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)};EMPWorldWind.map.prototype.addLayer=function(empOverlay){var layer,rc={success:false,message:""};if(empOverlay.overlayId in this.layers){rc={success:false,message:"An overlay with this id ("+empOverlay.overlayId+") already exists"};return rc}layer=new EMPWorldWind.data.EmpLayer(empOverlay);this.rootOverlayId=empOverlay.overlayId;this.worldWindow.addLayer(layer.layer);this.layers[layer.id]=layer;this.worldWindow.redraw();rc.success=true;return rc};EMPWorldWind.map.prototype.removeLayer=function(layer){var featureKey,id,result={success:false,message:""};id=layer.id||layer.coreId;layer=this.getLayer(id);if(layer){for(featureKey in layer.featureKeys){if(layer.featureKeys.hasOwnProperty(featureKey)){this.removeFeatureSelection(featureKey)}}this.worldWindow.removeLayer(layer.layer);this.worldWindow.redraw();delete this.layers[layer.id];result.success=true}else{result.message="No layer found with the id "+id}return result};EMPWorldWind.map.prototype.centerOnLocation=function(args){var position;if(typeof args.altitude==="number"){position=new WorldWind.Position(args.latitude,args.longitude,args.altitude)}else{position=new WorldWind.Location(args.latitude,args.longitude)}this.worldWindow.navigator.heading=args.heading||0;this.worldWindow.navigator.roll=args.roll||0;this.worldWindow.navigator.tilt=args.tilt||0;if(args.animate){this.goToAnimator.travelTime=EMPWorldWind.constants.globeMoveTime;this.goToAnimator.goTo(position,args.animateCB||function(){})}else{this.goToAnimator.travelTime=0;this.goToAnimator.goTo(position)}};EMPWorldWind.map.prototype.lookAt=function(args){if(args.range!==0){args.range=args.range||this.worldWindow.navigator.range}var position=new WorldWind.Position(args.latitude,args.longitude,args.range);function _completeLookAtMotion(){this.worldWindow.navigator.lookAtLocation.latitude=args.latitude;this.worldWindow.navigator.lookAtLocation.longitude=args.longitude;this.worldWindow.navigator.range=args.range;this.worldWindow.navigator.tilt=args.tilt;this.worldWindow.navigator.heading=args.heading;if(args.animateCB){args.animateCB()}this.worldWindow.redraw()}this.goToAnimator.travelTime=args.animate?EMPWorldWind.constants.globeMoveTime:0;this.goToAnimator.goTo(position,_completeLookAtMotion.bind(this))};EMPWorldWind.map.prototype.plotFeature=function(feature,callback){var _callback=function(cbArgs){this.worldWindow.redraw();if(cbArgs.success){if(!(cbArgs.feature.id in this.features)){this.features[cbArgs.feature.id]=cbArgs.feature}}if(callback){callback(cbArgs)}}.bind(this);if(feature instanceof EMPWorldWind.data.EmpFeature){feature=feature.feature}if(feature.featureId in this.features){EMPWorldWind.editors.EditorController.updateFeature.call(this,this.features[feature.featureId],feature,_callback)}else{EMPWorldWind.editors.EditorController.plotFeature.call(this,feature,_callback)}};EMPWorldWind.map.prototype.unplotFeature=function(feature){var layer,rc={success:false,message:""};layer=this.getLayer(feature.parentCoreId);if(layer){layer.removeFeatureById(feature.coreId);this.removeFeatureSelection(feature.coreId);this.worldWindow.redraw();rc.success=true}else{rc.messge="Could not find the parent overlay"}return rc};EMPWorldWind.map.prototype.selectFeatures=function(empSelections){var selected=[],failed=[];emp.util.each(empSelections,function(selectedFeature){var feature=this.features[selectedFeature.featureId];if(feature){feature.selected=selectedFeature.select;feature.selected?this.storeFeatureSelection(selectedFeature.featureId):this.removeFeatureSelection(selectedFeature.featureId)}else{failed.push(selectedFeature.featureId)}}.bind(this));this.worldWindow.redraw();return{success:selected.length!==0,selected:selected,failed:failed}};EMPWorldWind.map.prototype.getLayer=function(id){if(this.layers.hasOwnProperty(id)){return this.layers[id]}};EMPWorldWind.map.prototype.enableLayer=function(layer,enable){var id,subLayer;if(this.layerExists(layer)){layer.enabled=enable;for(id in layer.subLayers){if(layer.subLayers.hasOwnProperty(id)){subLayer=layer.getSubLayer(id);if(subLayer){this.enableLayer(subLayer,enable)}}}if(layer.globalType===EMPWorldWind.constants.layerType.ARCGIS_93_REST_LAYER||layer.globalType===EMPWorldWind.constants.layerType.BING_LAYER||layer.globalType===EMPWorldWind.constants.layerType.IMAGE_LAYER||layer.globalType===EMPWorldWind.constants.layerType.OSM_LAYER||layer.globalType===EMPWorldWind.constants.layerType.TMS_LAYER||layer.globalType===EMPWorldWind.constants.layerType.WMS_LAYER||layer.globalType===EMPWorldWind.constants.layerType.WMTS_LAYER){if(!enable){this.worldWindow.removeLayer(layer)}}}};EMPWorldWind.map.prototype.layerExists=function(layer){return this.layers.hasOwnProperty(layer.id)};EMPWorldWind.map.prototype.addWMS=function(wms){var wmsLayer;wmsLayer=this.getLayer(wms.coreId);if(wmsLayer){this.removeWMS(wmsLayer)}wmsLayer=new EMPWorldWind.data.EmpWMSLayer(wms);this.layers[wmsLayer.id]=wmsLayer;this.worldWindow.addLayer(wmsLayer.layer);this.worldWindow.redraw()};EMPWorldWind.map.prototype.removeWMS=function(wms){var layer,id=wms.coreId||wms.id;layer=this.getLayer(id);if(layer){this.worldWindow.removeLayer(layer.layer);delete this.layers[layer.id];this.worldWindow.redraw()}};EMPWorldWind.map.prototype.isFeatureSelected=function(id){return!!this.empSelections.hasOwnProperty(id)};EMPWorldWind.map.prototype.getFeatureSelection=function(id){if(this.isFeatureSelected(id)){return this.empSelections[id]}return null};EMPWorldWind.map.prototype.storeFeatureSelection=function(id){this.empSelections[id]=id};EMPWorldWind.map.prototype.removeFeatureSelection=function(id){if(this.empSelections.hasOwnProperty(id)){delete this.empSelections[id];return true}return false};EMPWorldWind.map.prototype.getSelections=function(){return this.empSelections};EMPWorldWind.map.prototype.isMultiPointPresent=function(id){return!!this.multiPointCollection.hasOwnProperty(id)};EMPWorldWind.map.prototype.getMultiPoint=function(id){if(this.isMultiPointPresent(id)){return this.multiPointCollection[id]}return null};EMPWorldWind.map.prototype.storeMultiPoint=function(multiPoint){this.multiPointCollection[multiPoint.id]=multiPoint};EMPWorldWind.map.prototype.removeMultiPoint=function(id){if(this.multiPointCollection.hasOwnProperty(id)){delete this.multiPointCollection[id];return true}return false};EMPWorldWind.map.prototype.isAirspacePresent=function(id){return!!this.airspaceCollection.hasOwnProperty(id)};EMPWorldWind.map.prototype.getAirspace=function(id){if(this.isAirspacePresent(id)){return this.airspaceCollection[id]}return null};EMPWorldWind.map.prototype.storeAirspace=function(airspace){this.airspaceCollection[airspace.id||airspace.coreId]=airspace};EMPWorldWind.map.prototype.removeAirspace=function(id){if(this.airspaceCollection.hasOwnProperty(id)){delete this.airspaceCollection[id];return true}return false};EMPWorldWind.map.prototype.getSinglePoints=function(){return this.singlePointCollection};EMPWorldWind.map.prototype.isSinglePointPresent=function(id){return!!this.singlePointCollection.hasOwnProperty(id)};EMPWorldWind.map.prototype.getSinglePoint=function(id){if(this.isSinglePointPresent(id)){return this.singlePointCollection[id]}return null};EMPWorldWind.map.prototype.storeSinglePoint=function(singlePoint){this.singlePointCollection[singlePoint.id]=singlePoint};EMPWorldWind.map.prototype.removeSinglePoint=function(id){if(this.isSinglePointPresent(id)){delete this.singlePointCollection[id];return true}return false};EMPWorldWind.map.prototype.getSinglePoints=function(){return this.singlePointCollection};EMPWorldWind.map.prototype.getSinglePointCount=function(){if(this.defined(this.singlePointCollection)){return Object.keys(this.singlePointCollection).length}else{return 0}};EMPWorldWind.map.prototype.isSinglePointIdOnHoldPresent=function(id){return!!this.singlePointCollectionIdOnHold.hasOwnProperty(id)};EMPWorldWind.map.prototype.getSinglePointIdOnHold=function(id){if(this.isSinglePointIdOnHoldPresent(id)){return this.singlePointCollectionOnHold[id]}return null};EMPWorldWind.map.prototype.storeSinglePointIdOnHold=function(singlePointId){this.singlePointCollectionIdOnHold[singlePointId]=singlePointId};EMPWorldWind.map.prototype.removeSinglePointIdOnHold=function(id){if(this.isSinglePointIdOnHoldPresent(id)){delete this.singlePointCollectionIdOnHold[id];return true}return false};EMPWorldWind.map.prototype.getSinglePointsIdOnHold=function(){return this.singlePointCollectionIdOnHold};EMPWorldWind.map.prototype.getSinglePointsIdOnHoldCount=function(){if(this.defined(this.singlePointCollectionIdOnHold)){return Object.keys(this.singlePointCollectionIdOnHold).length}else{return 0}};EMPWorldWind.map.prototype.setLabelStyle=function(styles){var style,featureId,feature;for(style in this.state.labelStyles){if(this.state.labelStyles.hasOwnProperty(style)){this.state.labelStyles[style]=styles.includes(style)}}for(featureId in this.features){if(this.features.hasOwnProperty(featureId)){feature=this.features[featureId];EMPWorldWind.editors.EditorController.updateFeatureLabelStyle.call(this,feature)}}this.worldWindow.redraw()};EMPWorldWind.map.prototype.refresh=function(){EMPWorldWind.eventHandlers.triggerRenderUpdate.call(this);this.worldWindow.redraw()};EMPWorldWind.map.prototype.setContrast=function(contrast){if(contrast>100){contrast=100}else if(contrast<0){contrast=0}if(contrast>=50){this.contrastLayer.renderables[EMPWorldWind.constants.WHITE_CONTRAST].attributes.interiorColor=new WorldWind.Color(1,1,1,(contrast-50)/50);this.contrastLayer.renderables[EMPWorldWind.constants.BLACK_CONTRAST].attributes.interiorColor=new WorldWind.Color(0,0,0,0)}else{this.contrastLayer.renderables[EMPWorldWind.constants.WHITE_CONTRAST].attributes.interiorColor=new WorldWind.Color(1,1,1,0);this.contrastLayer.renderables[EMPWorldWind.constants.BLACK_CONTRAST].attributes.interiorColor=new WorldWind.Color(0,0,0,(50-contrast)/50)}this.worldWindow.redraw()};EMPWorldWind.map.prototype.setLockState=function(lockState){this.state.lockState=lockState.lock};EMPWorldWind.map.prototype.spinGlobe=function(){var vertical=0,horizontal=0;var step=this.worldWindow.navigator.range/WorldWind.EARTH_RADIUS;if(this.state.autoPanning.up){vertical=step}else if(this.state.autoPanning.down){vertical=-step}if(this.state.autoPanning.left){horizontal=-step}else if(this.state.autoPanning.right){horizontal=step}var position=new WorldWind.Position(this.worldWindow.navigator.lookAtLocation.latitude+vertical,this.worldWindow.navigator.lookAtLocation.longitude+horizontal,this.worldWindow.navigator.range);this.goToAnimator.travelTime=500;if(this.state.autoPanning.up||this.state.autoPanning.left||this.state.autoPanning.down||this.state.autoPanning.right){this.goToAnimator.goTo(position);EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_IN_MOTION);setTimeout(this.spinGlobe.bind(this),250)}else{EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}};EMPWorldWind.map.prototype.screenshot=function(){this.worldWindow.drawFrame();return this.worldWindow.canvas.toDataURL()};EMPWorldWind.map.prototype.getBounds=function(){var topRight,bottomLeft;topRight=this.worldWindow.pickTerrain(new WorldWind.Vec2(this.worldWindow.viewport.width-1,1)).terrainObject();bottomLeft=this.worldWindow.pickTerrain(new WorldWind.Vec2(1,this.worldWindow.viewport.height-1)).terrainObject();if(!topRight){topRight={position:WorldWind.Location.linearLocation(this.worldWindow.navigator.lookAtLocation,this.worldWindow.navigator.heading+45,Math.PI/3,new WorldWind.Location)}}if(!bottomLeft){bottomLeft={position:WorldWind.Location.linearLocation(this.worldWindow.navigator.lookAtLocation,this.worldWindow.navigator.heading+45,-Math.PI/3,new WorldWind.Location)}}return{north:topRight.position.latitude,south:bottomLeft.position.latitude,east:topRight.position.longitude,west:bottomLeft.position.longitude}};EMPWorldWind.map.prototype.getCenter=function(){return this.worldWindow.navigator.lookAtLocation};EMPWorldWind.map.prototype.shutdown=function(){this.features={};this.layers={};this.worldWindow=undefined};EMPWorldWind.map.prototype.isMapMoving=function(){if(!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.lookAtLocation.latitude,this.lastNavigator.lookAtLocation.latitude,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.lookAtLocation.longitude,this.lastNavigator.lookAtLocation.longitude,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.range,this.lastNavigator.range,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.tilt,this.lastNavigator.tilt,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.roll,this.lastNavigator.roll,this.optimizationMapMoveEpsilon)||!EMPWorldWind.Math.equalsEpsilon(this.worldWindow.navigator.heading,this.lastNavigator.heading,this.optimizationMapMoveEpsilon)){return true}else{return false}};EMPWorldWind.map.prototype.pickShapesInViewRegion=function(){var shapes;var canvasCoordinates=this.worldWindow.canvasCoordinates(0,0);var boundRectangle=new WorldWind.Rectangle(canvasCoordinates[0],canvasCoordinates[1],5e3,4e3);shapes=this.worldWindow.pickShapesInRegion(boundRectangle);return shapes};EMPWorldWind.map.prototype.isMilStdMultiPointShapeInViewRegion=function(empFeature){var p,inView=false;if(!this.bounds){this.bounds=this.getBounds()}for(p=0;p<empFeature.coordinates.length;p++){var coordinate=empFeature.coordinates[p];if(coordinate[0]<=this.bounds.east&&coordinate[0]>=this.bounds.west&&(coordinate[1]>this.bounds.south&&coordinate[1]<this.bounds.north)){inView=true;break}}return inView};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data={};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpLayer=function(overlay){this.subLayers={};this.featureKeys={};this.name=overlay.name||undefined;this.description=overlay.description;this.id=overlay.overlayId;this.parentId=overlay.parentId;this.globalType=overlay.globalType||"vector";var _overlay=overlay;Object.defineProperty(this,"overlay",{enumerable:true,value:_overlay});var _layer=new WorldWind.RenderableLayer(this.id);Object.defineProperty(this,"layer",{enumerable:true,value:_layer});this.enabled=true};EMPWorldWind.data.EmpLayer.prototype.addFeature=function(feature){if(!this.isFeaturePresent(feature)){emp.util.each(feature.shapes,function(shape){this.layer.addRenderable(shape)}.bind(this));this.featureKeys[feature.id]={id:feature.id,type:EMPWorldWind.constants.FeatureType.RENDERABLE,feature:feature};feature.overlayId=this.id}else{this.updateFeature(feature)}};EMPWorldWind.data.EmpLayer.prototype.refresh=function(){this.layer.refresh()};EMPWorldWind.data.EmpLayer.prototype.addFeatures=function(features){emp.util.each(features,function(feature){this.addFeature(feature)}.bind(this))};EMPWorldWind.data.EmpLayer.prototype.addFeatureChild=function(entity,childEntity){if(this.isFeaturePresent(entity)){if(!this.isFeatureChildPresent(entity,childEntity)){if(!this.isFeaturePresent(childEntity)){childEntity.parentFeature=entity;childEntity.overlayId=this.id;this.addFeature(childEntity);if(entity.childrenFeatureKeys===undefined){entity.childrenFeatureKeys={}}entity.childrenFeatureKeys[childEntity.id]=childEntity.id}}}};EMPWorldWind.data.EmpLayer.prototype.allocateFeatureChild=function(entity,childEntity){if(this.isFeaturePresent(entity)){if(!this.isFeatureChildPresent(entity,childEntity)){if(this.isFeaturePresent(childEntity)){childEntity.parentFeature=entity;childEntity.overlayId=this.id;if(entity.childrenFeatureKeys===undefined){entity.childrenFeatureKeys={}}entity.childrenFeatureKeys[childEntity.id]=childEntity.id}}}};EMPWorldWind.data.EmpLayer.prototype.isFeatureChildPresent=function(parentEntity,childEntity){if(parentEntity&&childEntity){if(parentEntity.childrenFeatureKeys){return childEntity.id in parentEntity.childrenFeatureKeys}else{return false}}};EMPWorldWind.data.EmpLayer.prototype.addSubLayer=function(subLayer){if(!this.isSubLayerPresent(subLayer.id)){subLayer.parentId=this.id;this.subLayers[subLayer.id]=subLayer}};EMPWorldWind.data.EmpLayer.prototype.isLayerEmpty=function(){return this.featuresLength()+this.subOverlaysLength()<=0};EMPWorldWind.data.EmpLayer.prototype.getFeature=function(id){if(this.isFeaturePresentById(id)){var empFeature=this.featureKeys[id];return empFeature.feature}};EMPWorldWind.data.EmpLayer.prototype.isPrimitive=function(id){var isPrimitive=false;if(this.isFeaturePresentById(id)){var empFeature=this.featureKeys[id];if(empFeature.type===EMPWorldWind.constants.FeatureType.PRIMITIVE||empFeature.type===EMPWorldWind.constants.FeatureType.PRIMITIVE_COLLECTION){isPrimitive=true}}return isPrimitive};EMPWorldWind.data.EmpLayer.prototype.isDataSource=function(id){var isDataSource=false;if(this.isFeaturePresentById(id)){var empFeature=this.featureKeys[id];if(empFeature.type===EMPWorldWind.constants.FeatureType.DATA_SOURCE){isDataSource=true}}return isDataSource};EMPWorldWind.data.EmpLayer.prototype.getFeatures=function(){var features=[],id;for(id in this.featureKeys){if(id&&this.featureKeys.hasOwnProperty(id)){features.push(this.getFeature(id))}}return features};EMPWorldWind.data.EmpLayer.prototype.getSubLayer=function(id){var subLayer=undefined;if(this.isSubLayerPresent(id)){subLayer=this.subLayers[id]}return subLayer};EMPWorldWind.data.EmpLayer.prototype.getSubLayers=function(id){var layers=[];for(id in this.subLayers){if(this.subLayers.hasOwnProperty(id)){layers.push(this.getSubLayer(id))}}return layers};EMPWorldWind.data.EmpLayer.prototype.removeFeatures=function(){for(var id in this.featureKeys){if(this.featureKeys.hasOwnProperty(id)){var entity=this.getFeature(id);this.removeFeature(entity);
}}};EMPWorldWind.data.EmpLayer.prototype.removeFeatureSelections=function(){for(var id in this.featureKeys){if(this.featureKeys.hasOwnProperty(id)){}}};EMPWorldWind.data.EmpLayer.prototype.showFeatures=function(visibility){for(var id in this.featureKeys){if(this.featureKeys.hasOwnProperty(id)){var entity=this.getFeature(id);if(entity){this.showFeature(entity.id,visibility)}}}};EMPWorldWind.data.EmpLayer.prototype.showFeature=function(id,visibility){var oMultiPoint,childrenFeatureId,childrenEntity,feature=this.getFeature(id);if(!feature){return}if(feature.featureType===EMPWorldWind.constants.FeatureType.ENTITY){feature.show=visibility;if(feature.billboard!==undefined){if(feature.reRenderBillboardRequired&&visibility){feature.reRenderBillboardRequired=undefined;feature.show=visibility;feature.billboard.show=visibility;this.updateFeature(feature)}feature.billboard.show=visibility}if(feature.path!==undefined){feature.path.show=visibility}if(feature.polyline!==undefined){feature.polyline.show=visibility}if(feature.polygon!==undefined){feature.polygon.show=visibility}if(feature.label!==undefined){feature.label.show=visibility}if(feature.rectangle!==undefined){feature.show=visibility;if(this.empCesium.isMultiPointPresent(id)){oMultiPoint=this.empCesium.getMultiPoint(id);if(oMultiPoint){oMultiPoint.visible=visibility}}}if(feature.childrenFeatureKeys!==undefined){for(childrenFeatureId in feature.childrenFeatureKeys){if(feature.childrenFeatureKeys.hasOwnProperty(childrenFeatureId)){childrenEntity=this.getFeature(childrenFeatureId);if(childrenEntity){this.showFeature(childrenEntity.id,visibility)}}}}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.COMPOUND_ENTITY){feature.show=visibility;if(feature.childrenFeatureKeys!==undefined){for(childrenFeatureId in feature.childrenFeatureKeys){if(feature.childrenFeatureKeys.hasOwnProperty(childrenFeatureId)){childrenEntity=this.getFeature(childrenFeatureId);if(childrenEntity){this.showFeature(childrenEntity.id,visibility)}}}}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.PRIMITIVE){feature.show=visibility;var airspaceLabelPresent=this.empCesium.isMultiPointPresent(id+"_label");if(airspaceLabelPresent){var airspaceLabel=this.getFeature(id+"_label");if(airspaceLabel){airspaceLabel.show=visibility}}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.PRIMITIVE_COLLECTION){if(feature.length>0){feature.get(0).show=visibility}if(this.empCesium.isAirspacePresent(id)){var oAirspace=this.empCesium.getAirspace(id);if(oAirspace){oAirspace.visible=visibility}}else if(this.empCesium.isSinglePointPresent(id)){var oSinglePoint=this.empCesium.getSinglePoint(id);if(oSinglePoint){oSinglePoint.visible=visibility}}}};EMPWorldWind.data.EmpLayer.prototype.removeSubLayers=function(){for(var id in this.subLayers){if(this.subLayers.hasOwnProperty(id)){var subLayer=this.getSubLayer(id);if(subLayer){subLayer.removeFeatures();subLayer.removeSubLayers();delete this.subLayers[id]}}}};EMPWorldWind.data.EmpLayer.prototype.showSubLayers=function(visibility){for(var id in this.subLayers){if(this.subLayers.hasOwnProperty(id)){var subLayer=this.getSubLayer(id);if(subLayer){subLayer.visibility=visibility;subLayer.showFeatures(visibility);subLayer.showSubLayers(visibility)}}}};EMPWorldWind.data.EmpLayer.prototype.clearLayer=function(){switch(this.globalType){case EMPWorldWind.constants.LayerType.ARCGIS_93_REST_LAYER:case EMPWorldWind.constants.LayerType.BING_LAYER:case EMPWorldWind.constants.LayerType.IMAGE_LAYER:case EMPWorldWind.constants.LayerType.OSM_LAYER:case EMPWorldWind.constants.LayerType.WMS_LAYER:case EMPWorldWind.constants.LayerType.TMS_LAYER:case EMPWorldWind.constants.LayerType.WMTS_LAYER:this.enabled=false;break;default:}this.removeFeatureSelections();this.removeFeatures();this.removeSubLayers()};EMPWorldWind.data.EmpLayer.prototype.showLayer=function(isVisible){this.showFeatures(isVisible);this.showSubLayers(isVisible)};EMPWorldWind.data.EmpLayer.prototype.removeFeature=function(feature){if(this.isFeaturePresent(feature)){if(feature.childrenFeatureKeys!==undefined){for(var id in feature.childrenFeatureKeys){if(feature.childrenFeatureKeys.hasOwnProperty(id)){var childrenEntity=this.getFeature(id);if(childrenEntity){this.removeFeature(childrenEntity)}}}}if(EMPWorldWind.utils.defined(feature.parentFeature)){this.deallocateFeatureChild(feature.parentFeature,feature)}emp.util.each(feature.shapes,function(shape){if(shape instanceof WorldWind.RenderableLayer){this.worldwind.removeLayer(shape)}else{this.layer.removeRenderable(shape)}}.bind(this));delete this.featureKeys[feature.id]}};EMPWorldWind.data.EmpLayer.prototype.updateFeature=function(feature){var renderable;if(feature.id&&feature.id!==null){renderable=this.getFeature(feature.id);feature.childrenFeatureKeys=renderable.childrenFeatureKeys;feature.parentFeature=renderable.parentFeature;this.layer.removeRenderable(renderable);this.layer.addRenderable(feature);this.featureKeys[feature.id].feature=feature;feature.overlayId=this.id}};EMPWorldWind.data.EmpLayer.prototype.deallocateFeature=function(entity){if(this.isFeaturePresent(entity)){if(entity.childrenFeatureKeys!==undefined){for(var id in entity.childrenFeatureKeys){if(entity.childrenFeatureKeys.hasOwnProperty(id)){var childrenEntity=this.getFeature(id);if(childrenEntity){this.deallocateFeature(childrenEntity)}}}}entity.overlayId=undefined;delete this.featureKeys[entity.id]}};EMPWorldWind.data.EmpLayer.prototype.allocateFeature=function(feature){if(!this.isFeaturePresent(feature)){if(feature.featureType===EMPWorldWind.constants.FeatureType.ENTITY){this.featureKeys[feature.id]={id:feature.id,type:EMPWorldWind.constants.FeatureType.ENTITY}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.COMPOUND_ENTITY){this.featureKeys[feature.id]={id:feature.id,type:EMPWorldWind.constants.FeatureType.COMPOUND_ENTITY}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.PRIMITIVE){this.featureKeys[feature.id]={id:feature.id,type:EMPWorldWind.constants.FeatureType.PRIMITIVE}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.PRIMITIVE_COLLECTION){this.featureKeys[feature.id]={id:feature.id,type:EMPWorldWind.constants.FeatureType.PRIMITIVE_COLLECTION}}else if(feature.featureType===EMPWorldWind.constants.FeatureType.DATA_SOURCE){this.featureKeys[feature.id]={id:feature.id,type:EMPWorldWind.constants.FeatureType.DATA_SOURCE}}var featureChildrenLength=this.featureChildrenLength(feature);if(featureChildrenLength>0){var childrenFeatures=this.getFeatureChildrenEntityArray(feature);for(var index=0;index<featureChildrenLength;index++){var childrenFeature=childrenFeatures[index];this.allocateFeature(childrenFeature)}}feature.overlayId=this.id}};EMPWorldWind.data.EmpLayer.prototype.clearFeature=function(entity){if(this.isFeaturePresent(entity)){if(entity.childrenFeatureKeys!==undefined){for(var id in entity.childrenFeatureKeys){if(entity.childrenFeatureKeys.hasOwnProperty(id)){var childrenEntity=this.getFeature(id);if(childrenEntity){this.removeFeature(childrenEntity)}}}entity.childrenFeatureKeys=undefined}}};EMPWorldWind.data.EmpLayer.prototype.removeFeatureChild=function(parentEntity,childEntity){if(this.isFeaturePresent(parentEntity)&&this.isFeaturePresent(childEntity)){if(parentEntity.childrenFeatureKeys!==undefined){if(this.isFeatureChildPresent(parentEntity,childEntity)){this.removeFeature(childEntity);delete parentEntity.childrenFeatureKeys[childEntity.id]}}}};EMPWorldWind.data.EmpLayer.prototype.deallocateFeatureChild=function(parentEntity,childEntity){if(this.isFeaturePresent(parentEntity)&&this.isFeaturePresent(childEntity)){if(parentEntity.childrenFeatureKeys!==undefined){if(this.isFeatureChildPresent(parentEntity,childEntity)){delete parentEntity.childrenFeatureKeys[childEntity.id];childEntity.parentFeature=undefined;childEntity.overlayId=undefined}}}};EMPWorldWind.data.EmpLayer.prototype.getFeatureChildrenEntityArray=function(entity){var featureChildrenEntityArray=[];if(this.isFeaturePresent(entity)){if(entity.childrenFeatureKeys!==undefined){for(var id in entity.childrenFeatureKeys){if(entity.childrenFeatureKeys.hasOwnProperty(id)){var childrenEntity=this.getFeature(id);if(childrenEntity){featureChildrenEntityArray.push(childrenEntity)}}}}}return featureChildrenEntityArray};EMPWorldWind.data.EmpLayer.prototype.removeFeatureById=function(id){var feature;if(this.isFeaturePresentById(id)){feature=this.getFeature(id);this.removeFeature(feature)}};EMPWorldWind.data.EmpLayer.prototype.removeSubLayer=function(subOverlay){if(this.isSubLayerPresent(subOverlay.id)){this.subLayer.removeFeatures();this.subLayer.removeSubLayers();delete this.SubLayers[this.subLayer.id]}};EMPWorldWind.data.EmpLayer.prototype.removeSubLayerById=function(id){if(this.isSubLayerPresent(id)){var subLayer=this.getLayer(id);this.removeSubLayer(subLayer)}};EMPWorldWind.data.EmpLayer.prototype.featuresLength=function(){return Object.keys(this.featureKeys).length};EMPWorldWind.data.EmpLayer.prototype.featureChildrenLength=function(entity){var length=0;if(entity.childrenFeatureKeys){length=Object.keys(entity.childrenFeatureKeys).length}return length};EMPWorldWind.data.EmpLayer.prototype.subLayersLength=function(){return Object.keys(this.subLayers).length};EMPWorldWind.data.EmpLayer.prototype.isFeaturePresentById=function(id){if(id)return id in this.featureKeys};EMPWorldWind.data.EmpLayer.prototype.isFeaturePresent=function(entity){if(entity&&entity.id){return entity.id in this.featureKeys}else{return false}};EMPWorldWind.data.EmpLayer.prototype.isSubLayerPresent=function(id){if(id){return id in this.subLayers}return false};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpWMSLayer=function(wms){var layerNames,config,url;this.id=wms.coreId;var _wms=wms;Object.defineProperty(this,"wms",{enumerable:true,value:_wms});layerNames=wms.activeLayers.join();if(wms.useProxy){url=emp3.api.global.configuration.urlProxy+"?url="+wms.url}else{url=wms.url}config={service:url,layerNames:layerNames,sector:WorldWind.Sector.FULL_SPHERE,levelZeroDelta:new WorldWind.Location(36,36),numLevels:15,format:"image/png",size:256};var timeString="";var _wmsLayer=new WorldWind.WmsLayer(config,timeString);Object.defineProperty(this,"layer",{enumerable:true,value:_wmsLayer})};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.data=EMPWorldWind.data||{};EMPWorldWind.data.EmpFeature=function(feature){this.shapes=[];this.feature=feature;var _id=feature.coreId;Object.defineProperty(this,"id",{enumerable:true,value:_id});var _altitudeMode=WorldWind.CLAMP_TO_GROUND;Object.defineProperty(this,"altitudeMode",{enumerable:true,get:function(){return _altitudeMode},set:function(altMode){var shapesCount=this.shapesCount();for(var i=0;i<shapesCount;i++){this.shapes[i].altitudeMode=altMode}_altitudeMode=altMode}});var _selected=false;Object.defineProperty(this,"selected",{enumerable:true,get:function(){return _selected},set:function(value){var shapesCount=this.shapesCount();for(var i=0;i<shapesCount;i++){this.shapes[i].highlighted=value}_selected=value}})};EMPWorldWind.data.EmpFeature.prototype.shapesCount=function(){return this.shapes.length};EMPWorldWind.data.EmpFeature.prototype.addShapes=function(primitives){if(!Array.isArray(primitives)){if(primitives instanceof WorldWind.RenderableLayer){primitives.renderables[0].userProperties.id=this.id}else{primitives.userProperties.id=this.id}this.shapes.push(primitives)}else{emp.util.each(primitives,function(primitive){primitive.userProperties.id=this.id;this.shapes.push(primitive)}.bind(this))}};EMPWorldWind.data.EmpFeature.prototype.clearShapes=function(){this.shapes=[]};EMPWorldWind.data.EmpFeature.prototype.setVisible=function(visible){emp.util.each(this.shapes,function(shape){shape.enabled=visible})};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.constants={view:{MAX_HEIGHT:1e7}};EMPWorldWind.constants.globeWasMoving=false;EMPWorldWind.constants.globeWasZooming=false;EMPWorldWind.constants.globeMoveTime=2e3;EMPWorldWind.constants.extentBufferFactor=.4;EMPWorldWind.constants.USE_DATA_SOURCE=false;EMPWorldWind.constants.WHITE_CONTRAST=0;EMPWorldWind.constants.BLACK_CONTRAST=1;EMPWorldWind.constants.NO_PANNING={step:0,up:false,down:false,right:false,left:false};EMPWorldWind.constants.METERS_PER_INCH=.0254;EMPWorldWind.constants.SCALE_LINE_LENGTH=50;EMPWorldWind.constants.propertyDefaults={FILL_COLOR_HEX:"ffffff",LINE_COLOR_HEX:"000000",LINE_WIDTH:3};EMPWorldWind.constants.selectionProperties={COLOR_HEX:"FFFF00",WIDTH:2,SCALE:.5};EMPWorldWind.constants.FeatureType={ENTITY:"entity",RENDERABLE:"renderable",PRIMITIVE:"primitive",GROUND_PRIMITIVE:"ground_primitive",DATA_SOURCE:"dataSource",COMPOUND_ENTITY:"compoundEntity",PRIMITIVE_COLLECTION:"primitiveCollection"};EMPWorldWind.constants.LayerType={OVERLAY_LAYER:"overlay",WMS_LAYER:"wms",IMAGE_LAYER:"image",BING_LAYER:"bing",ARCGIS_93_REST_LAYER:"arcgis93rest",OSM_LAYER:"osm",TMS_LAYER:"tms",TERRAIN_LAYER:"terrain",WMTS_LAYER:"wmts"};EMPWorldWind.constants.EntityType={BILLBOARD:"billboard",BOX:"box",CORRIDOR:"corridor",CYLINDER:"cylinder",DESCRIPTION:"description",ELLIPSE:"ellipse",ELLIPSOID:"ellipsoid",LABEL:"label",MODEL:"model",ORIENTATION:"orientation",PATH:"path",POLYGON:"polygon",POLYLINE:"polyline",POLYLINE_VOLUME:"polylineVolume",POSITION:"position",RECTANGLE:"rectangle",VIEW_FROM:"viewFrom",WALL:"wall",KML:"kml"};EMPWorldWind.constants.MultiPointRenderType={KML:0,JSON:1,GEOJSON:2,DATA_URL:4,CANVAS:3,CANVAS_LABEL_ONLY:5,SVG:6,SVG_LABEL_ONLY:7};EMPWorldWind.constants.SinglePointAltitudeRangeMode={LOW_RANGE:0,MID_RANGE:1,HIGHEST_RANGE:2};EMPWorldWind.constants.RendererWorker={A:1,B:2,C:3,D:4};EMPWorldWind.constants.LabelStyle={REQUIRED_LABELS:"required_labels",COMMON_LABELS:"common_labels",ALL_LABELS:"all_labels"};EMPWorldWind.constants.AllLabels={V:true,L:true,S:true,AA:true,AB:true,AC:true,H:true,M:true,T:true,T1:true,CN:true,C:true,F:true,G:true,H1:true,H2:true,J:true,K:true,N:true,P:true,W:true,W1:true,X:true,Y:true,Z:true};EMPWorldWind.constants.RendererSettings={};EMPWorldWind.constants.RendererSettings.standard={Symbology_2525Bch2_USAS_13_14:0,Symbology_2525C:1};EMPWorldWind.constants.RendererSettings.modifierLookup={QUANTITY:"quantity",REDUCED_OR_REINFORCED:"reinforcedOrReduced",STAFF_COMMENTS:"staffComments",ADDITIONAL_INFO_1:"additionalInfo1",ADDITIONAL_INFO_2:"additionalInfo2",ADDITIONAL_INFO_3:"additionalInfo3",EVALUATION_RATING:"evaluationRating",COMBAT_EFFECTIVENESS:"combatEffectiveness",SIGNATURE_EQUIPMENT:"signatureEquipment",HIGHER_FORMATION:"higherFormation",HOSTILE:"hostile",IFF_SIF:"iffSiff",DIRECTION_OF_MOVEMENT:"directionOfMovement",OFFSET_INDICATOR:"offsetIndicator",UNIQUE_DESIGNATOR_1:"uniqueDesignation1",UNIQUE_DESIGNATOR_2:"uniqueDesignation2",EQUIPMENT_TYPE:"equipmentType",DATE_TIME_GROUP:"dateTimeGroup1",DATE_TIME_GROUP_2:"dateTimeGroup2",ALTITUDE_DEPTH:"altitudeDepth",LOCATION:"location",SPEED:"speed",SPECIAL_C2_HEADQUARTERS:"specialC2Headquarters",DISTANCE:"distance",AZIMUTH:"azimuth",FILL_COLOR:"fillColor",LINE_COLOR:"lineColor",TEXT_COLOR:"textColor",X_OFFSET:"xOffset",X_UNITS:"xUnits",Y_OFFSET:"yOffset",Y_UNITS:"yUnits",NAME:"name",STANDARD:"standard"};EMPWorldWind.constants.highAltitudeRangeImage={};EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageRed="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle  cx="12" cy="12"  r="3" fill="red" stroke="red" stroke-width="1"  /></g></svg>');EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageBlue="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle cx="12" cy="12"  r="3" fill="blue" stroke="blue" stroke-width="1"  /></g></svg>');EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageGreen="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle  cx="12" cy="12" r="3" fill="green" stroke="green" stroke-width="1"  /></g></svg>');EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageYellow="data:image/svg+xml;base64,"+window.btoa('<svg preserveAspectRatio="none" width="25px" height="30px"   xmlns="http://www.w3.org/2000/svg" version="1.1"><g transform="translate(0,0)  "><circle  cx="12" cy="12" r="3" fill="yellow" stroke="yellow" stroke-width="1"  /></g></svg>');var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.utils={};EMPWorldWind.utils.getEventCoordinates=function(event){var pickPoint=this.worldWindow.canvasCoordinates(event.clientX,event.clientY);var terrainObject=this.worldWindow.pickTerrain(pickPoint).terrainObject();return{lat:terrainObject?terrainObject.position.latitude:undefined,lon:terrainObject?terrainObject.position.longitude:undefined,clientX:event.clientX,clientY:event.clientY,screenX:event.screenX,screenY:event.screenY}};EMPWorldWind.utils.defined=function(value){return value!==undefined&&value!==null};EMPWorldWind.utils.milstd={};EMPWorldWind.utils.milstd.updateModifierLabels=function(properties,name,iconLabels,iconPixelSize){var mod,modifiedModifiers={},property,size;for(property in properties){if(properties.hasOwnProperty(property)){switch(property){case"labelColor":modifiedModifiers["textColor"]=properties[property];break;case"fillColor":modifiedModifiers["fillColor"]=properties[property];break;case"lineColor":modifiedModifiers["lineColor"]=properties[property];break;case"modifiers":for(mod in properties[property]){if(properties[property].hasOwnProperty(mod)){switch(mod){case"quantity":if(iconLabels.C&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["quantity"]=properties[property][mod]}break;case"reinforcedOrReduced":if(iconLabels.F&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["reinforcedOrReduced"]=properties[property][mod]}break;case"staffComments":if(iconLabels.G&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["staffComments"]=properties[property][mod]}break;case"additionalInfo1":if(iconLabels.H&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["additionalInfo1"]=properties[property][mod]}break;case"additionalInfo2":if(iconLabels.H1&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["additionalInfo2"]=properties[property][mod]}break;case"additionalInfo3":if(iconLabels.H2&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["additionalInfo3"]=properties[property][mod]}break;case"evaluationRating":if(iconLabels.J&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["evaluationRating"]=properties[property][mod]}break;case"combatEffectiveness":if(iconLabels.K&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["combatEffectiveness"]=properties[property][mod]}break;case"signatureEquipment":if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["signatureEquipment"]=properties[property][mod]}break;case"higherFormation":if(iconLabels.M&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["higherFormation"]=properties[property][mod]}break;case"hostile":if(iconLabels.N&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["hostile"]=properties[property][mod]}break;case"iffSif":if(iconLabels.P&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["iffSif"]=properties[property][mod]}break;case"offsetIndicator":if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["offsetIndicator"]=properties[property][mod]}break;case"uniqueDesignation1":if(iconLabels.T&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["uniqueDesignation1"]=properties[property][mod]}break;case"uniqueDesignation2":if(iconLabels.T1&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["uniqueDesignation2"]=properties[property][mod]}break;case"equipmentType":if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["equipmentType"]=properties[property][mod]}break;case"dateTimeGroup1":if(iconLabels.W&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["dateTimeGroup1"]=properties[property][mod]}break;case"dateTimeGroup2":if(iconLabels.W1&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["dateTimeGroup2"]=properties[property][mod]}break;case"altitudeDepth":if(iconLabels.X){modifiedModifiers["altitudeDepth"]=properties[property][mod]}break;case"location":if(iconLabels.Y&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["location"]=properties[property][mod]}break;case"speed":if(iconLabels.Z&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["speed"]=properties[property][mod]}break;case"specialC2Headquarters":if(iconLabels.AA&&properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers["specialC2Headquarters"]=properties[property][mod]}break;case"distance":modifiedModifiers["distance"]=properties[property][mod];break;case"azimuth":modifiedModifiers["azimuth"]=properties[property][mod];break;case"standard":modifiedModifiers["standard"]=properties[property][mod];break;case"size":size=properties[property][mod];if(!size){size=iconPixelSize}modifiedModifiers["size"]=size;break;default:if(properties[property][mod]&&properties[property][mod]!==""){modifiedModifiers[mod]=properties[property][mod]}break}}}break}}}if(iconLabels.CN){modifiedModifiers["name"]=name}return modifiedModifiers};EMPWorldWind.utils.milstd.convertModifierStringTo2525=function(modifiers,showModLabels){var standardModifiers={};if(modifiers!==undefined&&modifiers!==null){for(var sModifier in modifiers){if(modifiers.hasOwnProperty(sModifier)){var modValue=modifiers[sModifier];if(modValue!==null&&modValue!=="null"&&modValue!==0){switch(sModifier){case EMPWorldWind.constants.RendererSettings.modifierLookup.QUANTITY:if(showModLabels){standardModifiers["C"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.REDUCED_OR_REINFORCED:if(showModLabels){standardModifiers["F"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.STAFF_COMMENTS:if(showModLabels){standardModifiers["G"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ADDITIONAL_INFO_1:if(showModLabels){standardModifiers["H"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ADDITIONAL_INFO_2:if(showModLabels){standardModifiers["H1"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ADDITIONAL_INFO_3:if(showModLabels){standardModifiers["H2"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.EVALUATION_RATING:if(showModLabels){standardModifiers["J"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.COMBAT_EFFECTIVENESS:if(showModLabels){standardModifiers["K"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.SIGNATURE_EQUIPMENT:if(showModLabels){standardModifiers["L"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.HIGHER_FORMATION:if(showModLabels){standardModifiers["M"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.HOSTILE:if(showModLabels){standardModifiers["N"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.IFF_SIF:if(showModLabels){standardModifiers["P"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.OFFSET_INDICATOR:standardModifiers["S"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.UNIQUE_DESIGNATOR_1:if(showModLabels){standardModifiers["T"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.UNIQUE_DESIGNATOR_2:if(showModLabels){standardModifiers["T1"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.EQUIPMENT_TYPE:if(showModLabels){standardModifiers["V"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.DATE_TIME_GROUP:if(showModLabels){standardModifiers["W"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.DATE_TIME_GROUP_2:if(showModLabels){standardModifiers["W1"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.ALTITUDE_DEPTH:if(showModLabels){standardModifiers["X"]=JSON.parse(JSON.stringify(modValue))}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.LOCATION:if(showModLabels){standardModifiers["Y"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.SPEED:if(showModLabels){standardModifiers["Z"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.SPECIAL_C2_HEADQUARTERS:if(showModLabels){standardModifiers["AA"]=modValue}break;case EMPWorldWind.constants.RendererSettings.modifierLookup.DISTANCE:standardModifiers["AM"]=JSON.parse(JSON.stringify(modValue));break;case EMPWorldWind.constants.RendererSettings.modifierLookup.AZIMUTH:standardModifiers["AN"]=JSON.parse(JSON.stringify(modValue));break;case EMPWorldWind.constants.RendererSettings.modifierLookup.FILL_COLOR:standardModifiers["FILLCOLOR"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.LINE_COLOR:standardModifiers["LINECOLOR"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.TEXT_COLOR:standardModifiers["TEXTCOLOR"]=modValue;break;case EMPWorldWind.constants.RendererSettings.modifierLookup.STANDARD:standardModifiers[emp.typeLibrary.utils.milstd.Modifiers.STANDARD]=EMPWorldWind.utils.convertSymbolStandardToRendererFormat(modifiers);break;case EMPWorldWind.constants.RendererSettings.modifierLookup.NAME:case"CN":if(showModLabels){standardModifiers["CN"]=modValue}break;default:standardModifiers[sModifier]=modValue;break}}}}}return standardModifiers};EMPWorldWind.utils.milstd.checkForRequiredModifiers=function(item){var result={},symbolCode,properties={},modifiers={},oAM=[],oAN=[],basicSymbolCode,standard,symbolDef,i,lonDistance,overrides={};if(item.data&&item.data.symbolCode){symbolCode=item.data.symbolCode}else if(item.symbolCode){symbolCode=item.symbolCode}if(item.properties){properties=item.properties;if(properties.modifiers){modifiers=properties.modifiers}else{properties.modifiers={};modifiers=properties.modifiers}}else{item.properties={modifiers:{}};modifiers=item.properties.modifiers}basicSymbolCode=armyc2.c2sd.renderer.utilities.SymbolUtilities.getBasicSymbolID(symbolCode);standard=EMPWorldWind.utils.milstd.checkSymbolStandard(item.properties.modifiers);symbolDef=armyc2.c2sd.renderer.utilities.SymbolDefTable.getSymbolDef(basicSymbolCode,standard);if(symbolDef===undefined||symbolDef===null){return result}if(modifiers.hasOwnProperty("distance")){if(modifiers.distance instanceof Array){oAM=modifiers.distance}}if(modifiers.hasOwnProperty("azimuth")){if(modifiers.azimuth instanceof Array){oAN=modifiers.azimuth}}switch(symbolDef.drawCategory){case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_CIRCULAR_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>0){oAM=oAM.slice(0,1)}else{oAM[0]=5e3}overrides={distance:oAM};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_RECTANGULAR_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>=2&&typeof oAM[0]==="number"&&typeof oAM[1]==="number"){oAM=oAM.slice(0,2)}else{if(oAM[0]===undefined||typeof oAM[0]!=="number"){oAM[0]=1e4}if(oAM[1]===undefined||typeof oAM[1]!=="number"){oAM[1]=5e3}oAM=oAM.slice(0,2)}if(oAN!==null&&oAN.length>=1&&typeof oAN[1]==="number"){oAN=oAN.slice(0,1)}else{if(oAN[0]===undefined||typeof oAN[0]!=="number"){oAN[0]=0}oAN=oAN.slice(0,1)}overrides={distance:oAM,azimuth:oAN};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_SECTOR_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>=2){for(i=0;i<oAM.length;){if(typeof oAM[i]!=="number"){oAM.splice(i,1)}else{i++}}}if(oAM.length>1){for(i=0;i<oAM.length;i++){if(oAM[i]===undefined){oAM[i]=i===0?2e3:oAM[i-1]+2e3}}}else{if(oAM[0]===undefined){oAM[0]=2e3}}if(oAN.length===0){oAN.push(315);oAN.push(45)}else if(oAN.length===1){var newVal=oAN[0]+90;if(newVal>360){newVal=newVal-360}oAN.push(newVal)}overrides={distance:oAM,azimuth:oAN};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_CIRCULAR_RANGEFAN_AUTOSHAPE:if(oAM!==null&&oAM.length>0){for(i=0;i<oAM.length;){if(typeof oAM[i]!=="number"){oAM.splice(i,1)}else{i++}}}if(oAM.length<2){for(i=0;i<2;i++){if(oAM[i]===undefined){oAM[i]=i===0?2e3:oAM[i-1]+2e3}}}overrides={distance:oAM};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_TWO_POINT_RECT_PARAMETERED_AUTOSHAPE:if(oAM!==null&&oAM.length>0){if(typeof oAM[0]!=="number"){oAM[0]=5e3}oAM=oAM.slice(0,1)}else{oAM[0]=5e3}overrides={distance:oAM};break;case armyc2.c2sd.renderer.utilities.SymbolDefTable.DRAW_CATEGORY_LINE:if(oAM===null||oAM.length===0||oAM.length>0&&(isNaN(oAM[0])||oAM[0]===null)){if(item.data&&item.data.coordinates&&item.data.coordinates.length>1){var coord0=item.data.coordinates[0];var coord1=item.data.coordinates[1];var pointCartographic0=new WorldWind.Location(coord0[0],coord0[1]);var pointCartographic1=new WorldWind.Location(coord1[0],coord1[1]);var dist=WorldWind.Location.greatCircleDistance(pointCartographic0,pointCartographic1);lonDistance=dist/4}else{lonDistance=lonDistance/34}oAM[0]=lonDistance;overrides={distance:oAM}}else{overrides={distance:oAM}}break}return overrides};EMPWorldWind.utils.milstd.checkSymbolStandard=function(modifiers){var standard=1,modifiersCopy,modValue;try{if(modifiers!==undefined&&modifiers!==null&&modifiers!==""){modifiersCopy=typeof modifiers==="string"?JSON.parse(modifiers):emp.helpers.copyObject(modifiers);if(modifiersCopy.hasOwnProperty("modifiers")){modifiersCopy=modifiersCopy.modifiers}if(modifiersCopy.hasOwnProperty("renderer")){modValue=modifiersCopy.renderer;if(modValue!==undefined&&modValue!==null&&modValue!==0){if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}else{standard=modValue}}}else if(modifiersCopy.hasOwnProperty("standard")){modValue=modifiersCopy.standard;if(modValue!==undefined&&modValue!==null&&modValue!==0){if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else if(modValue.toLowerCase().indexOf(emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase())>-1){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}else if(modValue.toLowerCase().indexOf(emp.typeLibrary.featureMilStdVersionType.MILSTD_2525B.toLowerCase())>-1){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}else{standard=modValue}}}}}catch(err){window.console.log("Error getting symbol standard")}return standard};EMPWorldWind.utils.convertSymbolStandardToRendererFormat=function(modifiers){var standard,modValue;modValue=modifiers.standard;if(modValue.toLowerCase()===emp.typeLibrary.featureMilStdVersionType.MILSTD_2525C.toLowerCase()){standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525C}else{standard=EMPWorldWind.constants.RendererSettings.standard.Symbology_2525Bch2_USAS_13_14}return standard};
function _hex6ToRGBA(hex){hex=hex.replace("#","");var r,g,b;r=parseInt(hex.substring(0,2),16);g=parseInt(hex.substring(2,4),16);b=parseInt(hex.substring(4,6),16);return{red:r,green:g,blue:b,alpha:1}}function _hex8ToRGBA(hex){var r,g,b,a;a=parseInt(hex.substring(0,2),16)/256;r=parseInt(hex.substring(2,4),16);g=parseInt(hex.substring(4,6),16);b=parseInt(hex.substring(6,8),16);return{red:r,green:g,blue:b,alpha:a}}EMPWorldWind.utils.hexToRGBA=function(hex,alpha,normalize){var newHex;if(!hex){return{red:0,green:0,blue:0,alpha:1}}normalize=EMPWorldWind.utils.defined(normalize)?normalize:true;alpha=EMPWorldWind.utils.defined(alpha)?alpha:1;if(hex.length===8){newHex=_hex8ToRGBA(hex)}else{newHex=_hex6ToRGBA(hex);newHex.alpha=alpha}if(normalize){newHex.red=newHex.red/256;newHex.green=newHex.green/256;newHex.blue=newHex.blue/256}return newHex};EMPWorldWind.utils.normalizeRGBAColor=function(color){var normalize,normalColor=Object.assign({},color);normalize=color.red.toString().indexOf(".")===-1||color.green.toString().indexOf(".")===-1||color.blue.toString().indexOf(".")===-1;if(normalize){normalColor.red=color.red/256;normalColor.green=color.green/256;normalColor.blue=color.blue/256}return normalColor};EMPWorldWind.utils.boundsWidth=function(bounds){return WorldWind.EARTH_RADIUS*WorldWind.Location.greatCircleDistance(new WorldWind.Location(0,bounds.west),new WorldWind.Location(0,bounds.east))};EMPWorldWind.utils.boundsHeight=function(bounds){return WorldWind.EARTH_RADIUS*WorldWind.Location.greatCircleDistance(new WorldWind.Location(bounds.south,0),new WorldWind.Location(bounds.north,0))};EMPWorldWind.utils.selectHighAltitudeRangeImage=function(symbolCode){var affiliationLetter,highAltitudeRangeImage;if(!EMPWorldWind.utils.defined(symbolCode)){return EMPWorldWind.constants.highAltitudeRangeImage.highScaleImageYellow}affiliationLetter=symbolCode.substring(1,2);switch(affiliationLetter.toLowerCase()){case"h":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageRed;break;case"f":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageBlue;break;case"n":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageGreen;break;case"u":highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageYellow;break;default:highAltitudeRangeImage=EMPWorldWind.constants.highAltitudeRangeImage.highRangeImageYellow;break}return highAltitudeRangeImage};EMPWorldWind.utils.getSinglePointAltitudeRangeMode=function(CameraAltitude,singlePointAltitudeRanges){if(CameraAltitude<singlePointAltitudeRanges.mid){return EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE}else if(CameraAltitude>=singlePointAltitudeRanges.mid&&CameraAltitude<singlePointAltitudeRanges.high){return EMPWorldWind.constants.SinglePointAltitudeRangeMode.MID_RANGE}else if(CameraAltitude>=singlePointAltitudeRanges.high){return EMPWorldWind.constants.SinglePointAltitudeRangeMode.HIGHEST_RANGE}else{return EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE}};EMPWorldWind.Math={};EMPWorldWind.Math.equalsEpsilon=function(left,right,relativeEpsilon,absoluteEpsilon){absoluteEpsilon=EMPWorldWind.Math.defaultValue(absoluteEpsilon,relativeEpsilon);var absDiff=Math.abs(left-right);return absDiff<=absoluteEpsilon||absDiff<=relativeEpsilon*Math.max(Math.abs(left),Math.abs(right))};EMPWorldWind.Math.defaultValue=function(a,b){if(a!==undefined){return a}return b};EMPWorldWind.Math.EPSILON1=.1;EMPWorldWind.Math.EPSILON2=.01;EMPWorldWind.Math.EPSILON3=.001;EMPWorldWind.Math.EPSILON4=1e-4;EMPWorldWind.Math.EPSILON5=1e-5;EMPWorldWind.Math.EPSILON6=1e-6;EMPWorldWind.Math.EPSILON7=1e-7;EMPWorldWind.Math.EPSILON8=1e-8;EMPWorldWind.Math.EPSILON9=1e-9;EMPWorldWind.Math.EPSILON10=1e-10;EMPWorldWind.Math.EPSILON11=1e-11;EMPWorldWind.Math.EPSILON12=1e-12;EMPWorldWind.Math.EPSILON13=1e-13;EMPWorldWind.Math.EPSILON14=1e-14;EMPWorldWind.Math.EPSILON15=1e-15;EMPWorldWind.Math.EPSILON16=1e-16;EMPWorldWind.Math.EPSILON17=1e-17;EMPWorldWind.Math.EPSILON18=1e-18;EMPWorldWind.Math.EPSILON19=1e-19;EMPWorldWind.Math.EPSILON20=1e-20;EMPWorldWind.Math.GRAVITATIONALPARAMETER=3986004418e5;EMPWorldWind.Math.SOLAR_RADIUS=6955e5;EMPWorldWind.Math.LUNAR_RADIUS=1737400;EMPWorldWind.Math.SIXTY_FOUR_KILOBYTES=64*1024;EMPWorldWind.Math.sign=function(value){if(value>0){return 1}if(value<0){return-1}return 0};EMPWorldWind.Math.signNotZero=function(value){return value<0?-1:1};var EMPWorldWind=window.EMPWorldWind||{};EMPWorldWind.editors=EMPWorldWind.editors||{};EMPWorldWind.editors.primitiveBuilders=EMPWorldWind.editors.primitiveBuilders||{};EMPWorldWind.editors.primitiveBuilders.createTextAttributes=function(feature){var textColor,size,attributes=new WorldWind.TextAttributes;attributes.offset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,(-.05),WorldWind.OFFSET_FRACTION,.5);attributes.depthTest=false;if(feature.properties.labelStyle&&feature.properties.labelStyle.color){textColor=EMPWorldWind.utils.normalizeRGBAColor(feature.properties.labelStyle.color)}else if(feature.properties.fontColor){textColor=EMPWorldWind.utils.hexToRGBA(feature.properties.fontColor)}else{textColor=EMPWorldWind.utils.hexToRGBA(EMPWorldWind.constants.propertyDefaults.FILL_COLOR_HEX)}attributes.color=new WorldWind.Color(textColor.red,textColor.green,textColor.blue,textColor.alpha);if(feature.properties.labelStyle&&feature.properties.labelStyle.family){attributes.font.family=feature.properties.labelStyle.family}else if(feature.properties.fontFamily){attributes.font.family=feature.properties.fontFamily}if(feature.properties.labelStyle&&feature.properties.labelStyle.justification){attributes.font.horizontalAlignment=feature.properties.labelStyle.justification}else if(feature.properties.labelAlign){attributes.font.horizontalAlignment=feature.properties.labelAlign}if(feature.properties.labelStyle&&feature.properties.labelStyle.size){attributes.font.size=feature.properties.labelStyle.size}else if(feature.properties.fontSize){size=feature.properties.fontSize;size=size.substring(0,size.length-2);if(!isNaN(size)){attributes.font.size=parseInt(feature.properties.fontSize)}}if(feature.properties.labelStyle&&feature.properties.labelStyle.scale){attributes.scale=feature.properties.labelStyle.scale}return attributes};EMPWorldWind.editors.primitiveBuilders.createShapeAttributes=function(feature,selectionStyle){var lineColor,fillColor,highlightAttributes,selectedLineColor,selectedFillColor,selectedLabelColor;var attributes=new WorldWind.ShapeAttributes;switch(feature.format){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:attributes=new WorldWind.PlacemarkAttributes;if(feature.properties.iconUrl){attributes.imageSource=feature.properties.iconUrl;if(feature.properties.useProxy){attributes.imageSource=emp3.api.global.configuration.urlProxy+"?url="+attributes.imageSource}}else{attributes.imageSource=WorldWind.configuration.baseUrl+"images/emp-default-icon.png"}attributes.labelAttributes=EMPWorldWind.editors.primitiveBuilders.createTextAttributes(feature);highlightAttributes=new WorldWind.PlacemarkAttributes(attributes);highlightAttributes.labelAttributes=new WorldWind.TextAttributes(attributes.labelAttributes);if(selectionStyle.scale){highlightAttributes.imageScale=selectionStyle.scale}if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.imageColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.imageColor=WorldWind.Color.YELLOW}highlightAttributes.labelAttributes.offset=attributes.labelAttributes.offset;highlightAttributes.labelAttributes.color=highlightAttributes.imageColor;break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:attributes=EMPWorldWind.editors.primitiveBuilders.createTextAttributes(feature);highlightAttributes=new WorldWind.TextAttributes(attributes);if(selectionStyle.lineColor){selectedLabelColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.color=new WorldWind.Color(selectedLabelColor.red,selectedLabelColor.green,selectedLabelColor.blue,selectedLabelColor.alpha)}else{highlightAttributes.color=WorldWind.Color.YELLOW}break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:default:if(feature.properties.strokeStyle&&feature.properties.strokeStyle.strokeColor){lineColor=EMPWorldWind.utils.normalizeRGBAColor(feature.properties.strokeStyle.strokeColor);attributes.outlineColor=new WorldWind.Color(lineColor.red,lineColor.green,lineColor.blue,lineColor.alpha)}else{attributes.outlineColor=WorldWind.Color.BLACK}if(feature.properties.fillColor){fillColor=EMPWorldWind.utils.hexToRGBA(feature.properties.fillColor);attributes.interiorColor=new WorldWind.Color(fillColor.red,fillColor.green,fillColor.blue,fillColor.alpha)}else{attributes.drawInterior=false}if(feature.properties.strokeWidth||feature.properties.lineWidth){attributes.outlineWidth=feature.properties.strokeWidth||feature.properties.lineWidth}attributes.outlineStippleFactor=feature.properties.stippleFactor||attributes.outlineStippleFactor;attributes.outlineStipplePattern=feature.properties.stipplePattern||attributes.outlineStipplePattern;highlightAttributes=new WorldWind.ShapeAttributes(attributes);if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.outlineColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.outlineColor=WorldWind.Color.YELLOW}if(selectionStyle.fillColor){selectedFillColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.fillColor);highlightAttributes.interiorColor=new WorldWind.Color(selectedFillColor.red,selectedFillColor.green,selectedFillColor.blue,selectedFillColor.alpha)}else{highlightAttributes.drawInterior=false}}return{attributes:attributes,highlightAttributes:highlightAttributes}};EMPWorldWind.editors.primitiveBuilders.constructAirControlMeasure=function(feature,selectionStyle){var primitivePolygon,boundaries,attributes,highlightAttributes,i,selectedFillColor,len=feature.data.coordinates.length;attributes=new WorldWind.ShapeAttributes;highlightAttributes=new WorldWind.ShapeAttributes;if(selectionStyle.fillColor){selectedFillColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.fillColor);highlightAttributes.interiorColor=new WorldWind.Color(selectedFillColor.red,selectedFillColor.green,selectedFillColor.blue,selectedFillColor.alpha)}else{highlightAttributes.interiorColor=WorldWind.Color.YELLOW}boundaries=[];for(i=0;i<len;i++){boundaries.push(new WorldWind.Position(feature.data.coordinates[i][1],feature.data.coordinates[i][0],feature.properties.attributes[0].maxAlt))}primitivePolygon=new WorldWind.Polygon(boundaries,attributes);primitivePolygon.altitudeMode=WorldWind.ABSOLUTE;primitivePolygon.extrude=true;primitivePolygon.highlightAttributes=new WorldWind.ShapeAttributes(highlightAttributes);return primitivePolygon};EMPWorldWind.editors.primitiveBuilders.constructSurfaceCircle=function(feature,selectionStyle){var attributes,location,circlePrimitive;attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);location=new WorldWind.Location(feature.coordinates[1],feature.coordinates[0]);circlePrimitive=new WorldWind.SurfaceCircle(location,feature.properties.radius,attributes.attributes);circlePrimitive.displayName=feature.name;circlePrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;circlePrimitive.highlightAttributes=attributes.highlightAttributes;return circlePrimitive};EMPWorldWind.editors.primitiveBuilders.constructSurfaceEllipse=function(feature,selectionStyle){var attributes,location,ellipsePrimitive;attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);location=new WorldWind.Location(feature.coordinates[1],feature.coordinates[0]);ellipsePrimitive=new WorldWind.SurfaceEllipse(location,feature.properties.semiMajor,feature.properties.semiMinor,feature.properties.azimuth,attributes.attributes);ellipsePrimitive.displayName=feature.name;ellipsePrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;ellipsePrimitive.highlightAttributes=attributes.highlightAttributes;return ellipsePrimitive};EMPWorldWind.editors.primitiveBuilders.constructSurfacePolyline=function(feature,selectionStyle){var i,pathPrimitive,attributes,len=feature.data.coordinates.length,locations=[];attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);for(i=0;i<len;i++){locations.push(new WorldWind.Location(feature.data.coordinates[i][1],feature.data.coordinates[i][0]))}pathPrimitive=new WorldWind.SurfacePolyline(locations,attributes.attributes);pathPrimitive.displayName=feature.name;pathPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;pathPrimitive.highlightAttributes=attributes.highlightAttributes;return pathPrimitive};EMPWorldWind.editors.primitiveBuilders.constructSurfacePolylineFromGeoJSON=function(geoJSON,selectionStyle){var i,color,attributes,highlightAttributes,polylinePrimitive,selectedLineColor,len=geoJSON.coordinates.length,locations=[];attributes=new WorldWind.ShapeAttributes;if(geoJSON.properties.strokeColor){color=EMPWorldWind.utils.hexToRGBA(geoJSON.properties.strokeColor,geoJSON.properties.lineOpacity);attributes.outlineColor=new WorldWind.Color(color.red,color.green,color.blue,color.alpha)}else{attributes.outlineColor=WorldWind.Color.BLACK}attributes.outlineWidth=geoJSON.properties.strokeWidth||attributes.outlineWidth;for(i=0;i<len;i++){locations.push(new WorldWind.Location(geoJSON.coordinates[i][1],geoJSON.coordinates[i][0]))}highlightAttributes=new WorldWind.ShapeAttributes;if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.outlineColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.outlineColor=WorldWind.Color.YELLOW}polylinePrimitive=new WorldWind.SurfacePolyline(locations,attributes);polylinePrimitive.altitudeMode=geoJSON.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;polylinePrimitive.highlightAttributes=new WorldWind.ShapeAttributes(highlightAttributes);return polylinePrimitive};EMPWorldWind.editors.primitiveBuilders.constructPlacemark=function(feature,selectionStyle){var position,placemark,attributes,eyeDistanceScaling=false;attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);position=new WorldWind.Position(feature.data.coordinates[1],feature.data.coordinates[0],feature.data.coordinates[2]||0);placemark=new WorldWind.Placemark(position,eyeDistanceScaling,attributes.attributes);placemark.alwaysOnTop=true;placemark.label=feature.name;placemark.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;placemark.highlightAttributes=new WorldWind.PlacemarkAttributes(attributes.highlightAttributes);return placemark};EMPWorldWind.editors.primitiveBuilders.constructSurfacePolygon=function(feature,selectionStyle){var polygonPrimitive,attributes,boundaryLen,i,j,boundaries=[],numBounds=feature.data.coordinates.length;attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);for(i=0;i<numBounds;i++){boundaryLen=feature.data.coordinates[i].length;var subBoundary=[];for(j=0;j<boundaryLen;j++){subBoundary.push(new WorldWind.Location(feature.data.coordinates[i][j][1],feature.data.coordinates[i][j][0]))}boundaries.push(subBoundary)}polygonPrimitive=new WorldWind.SurfacePolygon(boundaries,attributes.attributes);polygonPrimitive.displayName=feature.name;polygonPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;polygonPrimitive.highlightAttributes=attributes.highlightAttributes;return polygonPrimitive};EMPWorldWind.editors.primitiveBuilders.constructSurfacePolygonFromGeoJSON=function(geoJSON,selectionStyle){var attributes,interiorColor,outlineColor,boundaryLen,polygonPrimitive,selectedLineColor,selectedFillColor,highlightAttributes,i,j,boundaries=[],numBounds=geoJSON.geometry.coordinates.length;for(i=0;i<numBounds;i++){boundaryLen=geoJSON.geometry.coordinates[i].length;var subBoundary=[];for(j=0;j<boundaryLen;j++){subBoundary.push(new WorldWind.Location(geoJSON.geometry.coordinates[i][j][1],geoJSON.geometry.coordinates[i][j][0]))}boundaries.push(subBoundary)}attributes=new WorldWind.ShapeAttributes;if(geoJSON.properties.strokeColor){outlineColor=EMPWorldWind.utils.hexToRGBA(geoJSON.properties.strokeColor);attributes.outlineColor=new WorldWind.Color(outlineColor.red,outlineColor.green,outlineColor.blue,outlineColor.alpha)}else{attributes.outlineColor=WorldWind.Color.BLACK}if(geoJSON.properties.fillColor){interiorColor=EMPWorldWind.utils.hexToRGBA(geoJSON.properties.fillColor);attributes.interiorColor=new WorldWind.Color(interiorColor.red,interiorColor.green,interiorColor.blue,interiorColor.alpha)}else{attributes.drawInterior=false}attributes.outlineWidth=geoJSON.properties.strokeWidth||attributes.outlineWidth;attributes.outlineStippleFactor=geoJSON.properties.stippleFactor||attributes.outlineStippleFactor;attributes.outlineStipplePattern=geoJSON.properties.stipplePattern||attributes.outlineStipplePattern;highlightAttributes=new WorldWind.ShapeAttributes;if(selectionStyle.lineColor){selectedLineColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.outlineColor=new WorldWind.Color(selectedLineColor.red,selectedLineColor.green,selectedLineColor.blue,selectedLineColor.alpha)}else{highlightAttributes.outlineColor=WorldWind.Color.YELLOW}if(selectionStyle.fillColor){selectedFillColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.fillColor);highlightAttributes.interiorColor=new WorldWind.Color(selectedFillColor.red,selectedFillColor.green,selectedFillColor.blue,selectedFillColor.alpha)}else{highlightAttributes.drawInterior=false}polygonPrimitive=new WorldWind.SurfacePolygon(boundaries,attributes);polygonPrimitive.altitudeMode=geoJSON.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;polygonPrimitive.displayName=geoJSON.properties.name;polygonPrimitive.highlightAttributes=new WorldWind.ShapeAttributes(highlightAttributes);return polygonPrimitive};EMPWorldWind.editors.primitiveBuilders.constructSurfaceRectangle=function(feature,selectionStyle){var attributes,location,width,height,rectPrimitive;attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);location=new WorldWind.Location(feature.coordinates[1],feature.coordinates[0]);if(feature.format===emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE){width=feature.properties.width;height=feature.properties.height}else{width=feature.properties.width;height=feature.properties.width}rectPrimitive=new WorldWind.SurfaceRectangle(location,width,height,feature.properties.azimuth,attributes.attributes);rectPrimitive.displayName=feature.name;rectPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;rectPrimitive.highlightAttributes=attributes.highlightAttributes;return rectPrimitive};EMPWorldWind.editors.primitiveBuilders.constructText=function(feature,selectionStyle){var attributes,position,textPrimitive;attributes=EMPWorldWind.editors.primitiveBuilders.createShapeAttributes(feature,selectionStyle);position=new WorldWind.Position(feature.coordinates[1],feature.coordinates[0],feature.coordinates[2]?feature.coordinates[2]:0);textPrimitive=new WorldWind.GeographicText(position,feature.name);textPrimitive.attributes=attributes.attributes;textPrimitive.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;textPrimitive.highlightAttributes=attributes.highlightAttributes;return textPrimitive};EMPWorldWind.editors.primitiveBuilders.constructTextFromGeoJSON=function(geoJSON,selectionStyle){var textPrimitive,attributes,highlightAttributes,selectedColor,position;attributes=EMPWorldWind.editors.primitiveBuilders.createTextAttributes(geoJSON);highlightAttributes=new WorldWind.TextAttributes(attributes);if(selectionStyle.lineColor){selectedColor=EMPWorldWind.utils.hexToRGBA(selectionStyle.lineColor);highlightAttributes.color=new WorldWind.Color(selectedColor.red,selectedColor.green,selectedColor.blue,selectedColor.alpha)}else{highlightAttributes.color=WorldWind.Color.YELLOW}position=new WorldWind.Position(geoJSON.geometry.coordinates[1],geoJSON.geometry.coordinates[0],geoJSON.geometry.coordinates[2]?geoJSON.geometry.coordinates[0]:0);textPrimitive=new WorldWind.GeographicText(position,geoJSON.properties.label);textPrimitive.attributes=attributes;textPrimitive.altitudeMode=geoJSON.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;textPrimitive.highlightAttributes=highlightAttributes;return textPrimitive};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.editors=EMPWorldWind.editors||{};EMPWorldWind.editors.EditorController=function(){function _constructSinglePointMilStdSymbol(feature,modifiers,selectionStyle){var placemark,attributes,highlightAttributes,position,imageInfo,imageCenter,imageBounds,imageOffset,selectedImage,symbolCode,selectedModifiers,eyeDistanceScaling=false;attributes=new WorldWind.PlacemarkAttributes;attributes.drawLeaderLine=true;attributes.leaderLineAttributes.outlineColor=WorldWind.Color.RED;if(feature.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.HIGHEST_RANGE){attributes.imageScale=1;attributes.imageSource=EMPWorldWind.utils.selectHighAltitudeRangeImage(feature.symbolCode);highlightAttributes=new WorldWind.PlacemarkAttributes;highlightAttributes.imageColor=WorldWind.Color.WHITE;highlightAttributes.imageSource=attributes.imageSource}else{if(this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.MID_RANGE&&feature.symbolCode){symbolCode=feature.symbolCode.substr(0,12)+"--"+feature.symbolCode.substr(14)}else{symbolCode=feature.symbolCode}imageInfo=armyc2.c2sd.renderer.MilStdIconRenderer.Render(symbolCode,modifiers);imageCenter=imageInfo.getCenterPoint();imageBounds=imageInfo.getImageBounds();imageOffset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,imageCenter.x/imageBounds.width,WorldWind.OFFSET_FRACTION,1-imageCenter.y/imageBounds.height);attributes.imageScale=1;attributes.imageOffset=imageOffset;attributes.imageSource=imageInfo.toDataUrl();highlightAttributes=new WorldWind.PlacemarkAttributes(attributes);highlightAttributes.imageColor=WorldWind.Color.WHITE;highlightAttributes.imageOffset=imageOffset;selectedModifiers=Object.assign({},modifiers);selectedModifiers.LINECOLOR=selectionStyle.lineColor;selectedModifiers.FILLCOLOR=selectionStyle.fillColor;selectedImage=armyc2.c2sd.renderer.MilStdIconRenderer.Render(feature.symbolCode,selectedModifiers).toDataUrl();highlightAttributes.imageSource=selectedImage}position=new WorldWind.Position(feature.data.coordinates[1],feature.data.coordinates[0],EMPWorldWind.utils.defined(feature.data.coordinates[2])?feature.data.coordinates[2]:0);placemark=new WorldWind.Placemark(position,eyeDistanceScaling);placemark.alwaysOnTop=true;placemark.altitudeMode=feature.properties.altitudeMode||WorldWind.CLAMP_TO_GROUND;placemark.attributes=new WorldWind.PlacemarkAttributes(attributes);placemark.highlightAttributes=new WorldWind.PlacemarkAttributes(highlightAttributes);return placemark}function _constructMultiPointMilStdFeature(feature,modifiers,selectionStyle){var imageInfo,componentFeature,lineCount,subGeoJSON,bbox,bounds,scale,featureCoords,i,j,positions="",shapes=[];featureCoords=feature.data.coordinates.join().split(",");for(i=0;i<featureCoords.length;i+=2){positions+=featureCoords[i]+","+featureCoords[i+1]+" "}positions=positions.trim();bounds=this.getBounds();bbox=bounds.west+","+bounds.south+","+bounds.east+","+bounds.north;scale=EMPWorldWind.utils.boundsWidth(bounds)>>2;imageInfo=JSON.parse(sec.web.renderer.SECWebRenderer.RenderSymbol(feature.name,feature.coreId,feature.description,feature.symbolCode,positions,WorldWind.CLAMP_TO_GROUND,scale,bbox,modifiers,EMPWorldWind.constants.MultiPointRenderType.GEOJSON));feature.wasClipped=imageInfo.properties.wasClipped;for(i=0;i<imageInfo.features.length;i++){componentFeature=imageInfo.features[i];componentFeature.properties.strokeWidth=1;componentFeature.properties.strokeWeight=1;switch(componentFeature.geometry.type){case"MultiLineString":lineCount=componentFeature.geometry.coordinates.length;for(j=0;j<lineCount;j++){subGeoJSON={properties:componentFeature.properties,coordinates:componentFeature.geometry.coordinates[j]};shapes.push(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolylineFromGeoJSON(subGeoJSON,selectionStyle))}break;case"LineString":shapes.push(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolylineFromGeoJSON(componentFeature,selectionStyle));break;case"Point":shapes.push(EMPWorldWind.editors.primitiveBuilders.constructTextFromGeoJSON(componentFeature,selectionStyle));break;case"Polygon":shapes.push(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolygonFromGeoJSON(componentFeature,selectionStyle));break;default:window.console.error("Unable to render symbol with type "+componentFeature.geometry.type)}}return shapes}function processModifiers(feature){var modifiers,enhancedModifiers,override,lowRangeMode;if(feature.data.type==="Point"){modifiers=EMPWorldWind.utils.milstd.updateModifierLabels(feature.properties,feature.name,this.state.labelStyles,this.state.pixelSize)}else{modifiers=EMPWorldWind.utils.milstd.updateModifierLabels(feature.properties,feature.name,EMPWorldWind.constants.AllLabels,this.state.pixelSize)}lowRangeMode=feature.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE;modifiers=EMPWorldWind.utils.milstd.convertModifierStringTo2525(modifiers,this.state.labelStyles.CN===true&&lowRangeMode);enhancedModifiers=EMPWorldWind.utils.milstd.checkForRequiredModifiers(feature);for(override in enhancedModifiers){if(enhancedModifiers.hasOwnProperty(override)){modifiers[override]=enhancedModifiers[override]}}return modifiers}function constructMilStdSymbol(feature,selectionStyle){var modifiers,shapes=[];modifiers=processModifiers.call(this,feature);if(feature.data.type==="Point"){shapes.push(_constructSinglePointMilStdSymbol.call(this,feature,modifiers,selectionStyle))}else if(feature.data.type==="LineString"){shapes=shapes.concat(_constructMultiPointMilStdFeature.call(this,feature,modifiers,selectionStyle))}else{window.console.error("Unhandled feature type: "+feature.data.type+" in EMPWorldWind")}return shapes}function asyncPlotKMLFeature(feature,callback){var url,kmlFilePromise,kmlLayer,wwFeature,rc={success:false};url="data:text/xml,"+encodeURIComponent(feature.data);kmlFilePromise=new WorldWind.KmlFile(url);kmlFilePromise.then(function(kmlFile){kmlLayer=new WorldWind.RenderableLayer(feature.coreId);kmlLayer.addRenderable(kmlFile);this.worldWindow.addLayer(kmlLayer);wwFeature=new EMPWorldWind.data.EmpFeature(feature);wwFeature.addShapes(kmlLayer);this.layers[feature.coreId]=kmlLayer;rc.success=true;rc.feature=wwFeature;callback(rc)}.bind(this))}return{plotFeature:function(empFeature,callback){var wwFeature,layer,buildShapes,shapes;var rc={message:"",success:true,feature:undefined};switch(empFeature.format){case emp3.api.enums.FeatureTypeEnum.GEO_ACM:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructAirControlMeasure;break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructSurfaceCircle;break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructSurfaceEllipse;break;case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:buildShapes=constructMilStdSymbol.bind(this);break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructSurfacePolyline;break;case emp3.api.enums.FeatureTypeEnum.GEO_POINT:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructPlacemark;break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructSurfacePolygon;break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructSurfaceRectangle;break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:buildShapes=EMPWorldWind.editors.primitiveBuilders.constructText;break;case emp3.api.enums.FeatureTypeEnum.KML:return asyncPlotKMLFeature.call(this,empFeature,callback);default:rc.success=false;rc.message="Missing feature constructor for format: "+empFeature.format}if(!rc.success){callback(rc);return}wwFeature=new EMPWorldWind.data.EmpFeature(empFeature);wwFeature.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(this.worldWindow.navigator.range,this.singlePointAltitudeRanges);empFeature.singlePointAltitudeRangeMode=wwFeature.singlePointAltitudeRangeMode;empFeature.range=this.worldWindow.navigator.range;shapes=buildShapes(empFeature,this.state.selectionStyle);wwFeature.addShapes(shapes);layer=this.getLayer(empFeature.parentCoreId);layer.addFeature(wwFeature);rc.feature=wwFeature;rc.success=true;callback(rc)},updateFeature:function(wwFeature,empFeature,callback){var layer,rc={success:true,message:"",feature:wwFeature};if(empFeature.format!==emp3.api.enums.FeatureTypeEnum.KML){layer=this.getLayer(empFeature.parentCoreId);empFeature.singlePointAltitudeRangeMode=wwFeature.singlePointAltitudeRangeMode;layer.removeFeature(wwFeature)}else{this.worldWindow.removeLayer(this.layers[empFeature.coreId])}wwFeature.clearShapes();switch(empFeature.format){case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:wwFeature.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(this.worldWindow.navigator.range,this.singlePointAltitudeRanges);empFeature.singlePointAltitudeRangeMode=wwFeature.singlePointAltitudeRangeMode;wwFeature.addShapes(constructMilStdSymbol.call(this,empFeature,this.state.selectionStyle));break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructAirControlMeasure(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructSurfaceCircle(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructSurfaceEllipse(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_PATH:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolyline(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_POINT:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructPlacemark(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructSurfacePolygon(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructSurfaceRectangle(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:wwFeature.addShapes(EMPWorldWind.editors.primitiveBuilders.constructText(empFeature,this.state.labelStyles));break;case emp3.api.enums.FeatureTypeEnum.KML:return asyncPlotKMLFeature.call(this,empFeature,callback);default:rc.success=false;rc.message="Missing feature constructor for format: "+empFeature.format;
}if(rc.success){empFeature.range=this.worldWindow.navigator.range;wwFeature.feature=empFeature;wwFeature.selected=this.isFeatureSelected(wwFeature.id);layer.addFeature(wwFeature);rc.feature=wwFeature}callback(rc)},updateFeatureLabelStyle:function(wwFeature){var shapes,empLayer=this.getLayer(wwFeature.feature.parentCoreId);switch(wwFeature.feature.format){case emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL:empLayer.removeFeature(wwFeature);wwFeature.clearShapes();shapes=constructMilStdSymbol.call(this,wwFeature.feature,this.state.selectionStyle);wwFeature.addShapes(shapes);empLayer.addFeature(wwFeature);break;case emp3.api.enums.FeatureTypeEnum.GEO_ACM:case emp3.api.enums.FeatureTypeEnum.GEO_CIRCLE:case emp3.api.enums.FeatureTypeEnum.GEO_ELLIPSE:case emp3.api.enums.FeatureTypeEnum.GEO_PATH:case emp3.api.enums.FeatureTypeEnum.GEO_POINT:case emp3.api.enums.FeatureTypeEnum.GEO_POLYGON:case emp3.api.enums.FeatureTypeEnum.GEO_RECTANGLE:case emp3.api.enums.FeatureTypeEnum.GEO_SQUARE:case emp3.api.enums.FeatureTypeEnum.GEO_TEXT:default:}}}}();var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.throttle=function(fn,threshold,scope){threshold=threshold||20;var last,deferTimer;return function(){var context=scope||this;var now=+new Date,args=arguments;if(last&&now<last+threshold){clearTimeout(deferTimer);deferTimer=setTimeout(function(){last=now;fn.apply(context,args)},threshold)}else{last=now;fn.apply(context,args)}}};EMPWorldWind.eventHandlers.notifyViewChange=function(viewEventType){var view={range:this.worldWindow.navigator.range,tilt:this.worldWindow.navigator.tilt,roll:this.worldWindow.navigator.roll,heading:this.worldWindow.navigator.heading,altitude:this.worldWindow.navigator.range,location:{lat:this.worldWindow.navigator.lookAtLocation.latitude,lon:this.worldWindow.navigator.lookAtLocation.longitude},bounds:this.getBounds()};var lookAt={range:this.worldWindow.navigator.range,tilt:this.worldWindow.navigator.tilt,heading:this.worldWindow.navigator.heading,altitude:this.worldWindow.navigator.lookAtLocation.altitude||0,latitude:this.worldWindow.navigator.lookAtLocation.latitude,longitude:this.worldWindow.navigator.lookAtLocation.longitude};if(this.isMapMoving()){this.empMapInstance.eventing.ViewChange(view,lookAt,viewEventType);this.singlePointAltitudeRangeMode=EMPWorldWind.utils.getSinglePointAltitudeRangeMode(this.worldWindow.navigator.range,this.singlePointAltitudeRanges);this.bounds=this.getBounds();EMPWorldWind.eventHandlers.triggerRenderUpdate.call(this);this.lastNavigator.range=this.worldWindow.navigator.range;this.lastNavigator.tilt=this.worldWindow.navigator.tilt;this.lastNavigator.roll=this.worldWindow.navigator.roll;this.lastNavigator.heading=this.worldWindow.navigator.heading;this.lastNavigator.lookAtLocation=emp.helpers.copyObject(this.worldWindow.navigator.lookAtLocation)}};EMPWorldWind.eventHandlers.triggerRenderUpdate=function(){this.state.lastRender.bounds=this.getBounds();this.state.lastRender.altitude=this.worldWindow.navigator.range;emp.util.each(Object.keys(this.features),function(featureId){var feature=this.features[featureId];if(feature.feature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&feature.feature.data.type==="LineString"){if(this.isMilStdMultiPointShapeInViewRegion(feature.feature)&&(!EMPWorldWind.Math.equalsEpsilon(feature.feature.range,this.lastNavigator.range,EMPWorldWind.Math.EPSILON3)||feature.feature.wasClipped)){this.plotFeature(feature)}}else if(feature.feature.format===emp3.api.enums.FeatureTypeEnum.GEO_MIL_SYMBOL&&feature.feature.data.type==="Point"){var callRenderer=false;feature.singlePointAltitudeRangeChanged=feature.singlePointAltitudeRangeMode!==this.singlePointAltitudeRangeMode;if(feature.singlePointAltitudeRangeChanged&&this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.LOW_RANGE&&this.iconLabelOption!=="none"){callRenderer=true;feature.isHighAltitudeRangeImage=false;feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.singlePointAltitudeRangeChanged=false}else if(feature.singlePointAltitudeRangeChanged&&this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.MID_RANGE){callRenderer=true;feature.isHighAltitudeRangeImage=false;feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.singlePointAltitudeRangeChanged=false}else if(feature.singlePointAltitudeRangeChanged&&this.singlePointAltitudeRangeMode===EMPWorldWind.constants.SinglePointAltitudeRangeMode.HIGHEST_RANGE){feature.isHighAltitudeRangeImage=true;feature.shapes[0].attributes._imageSource=EMPWorldWind.utils.selectHighAltitudeRangeImage(feature.feature.symbolCode);feature.shapes[0].highlightAttributes._imageSource=feature.shapes[0].attributes._imageSource;feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.feature.singlePointAltitudeRangeMode=this.singlePointAltitudeRangeMode;feature.singlePointAltitudeRangeChanged=false}if(callRenderer){this.plotFeature(feature)}}}.bind(this));this.worldWindow.redraw()};EMPWorldWind.eventHandlers.extractFeatureFromEvent=function(mouseEvent,empEventingArgs){var obj,i,pickList=this.worldWindow.pick(this.worldWindow.canvasCoordinates(mouseEvent.clientX,mouseEvent.clientY)),len=pickList.objects.length;for(i=0;i<len;i++){obj=pickList.objects[i];if(!obj.isTerrain){if(obj.userObject.userProperties&&obj.userObject.userProperties.id){empEventingArgs.coreId=obj.userObject.userProperties.id;empEventingArgs.target="feature";break}}}};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.mouse={click:function(event){var clickEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);clickEvent.type=emp.typeLibrary.Pointer.EventType.SINGLE_CLICK;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,clickEvent);this.empMapInstance.eventing.Pointer(clickEvent)},dblclick:function(event){var dblClickEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);dblClickEvent.type=emp.typeLibrary.Pointer.EventType.DBL_CLICK;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,dblClickEvent);this.empMapInstance.eventing.Pointer(dblClickEvent)},wheel:function(event){if(event.wheelDeltaY<0&&this.worldWindow.navigator.range>EMPWorldWind.constants.view.MAX_HEIGHT){this.worldWindow.navigator.range=EMPWorldWind.constants.view.MAX_HEIGHT;event.preventDefault()}switch(this.state.lockState){case emp3.api.enums.MapMotionLockEnum.NO_MOTION:case emp3.api.enums.MapMotionLockEnum.NO_ZOOM_NO_PAN:case emp3.api.enums.MapMotionLockEnum.NO_ZOOM:event.preventDefault();break;default:}EMPWorldWind.eventHandlers.notifyViewChange.call(this)}};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.touch={touchstart:function(event){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event.touches[0]);coords.type=emp.typeLibrary.Pointer.EventType.MOUSEDOWN;this.state.lastInteractionEvent=event;this.empMapInstance.eventing.Pointer(coords)},touchend:function(){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,this.state.lastInteractionEvent.touches[0]);coords.type=emp.typeLibrary.Pointer.EventType.MOUSEUP;this.empMapInstance.eventing.Pointer(coords)},touchcancel:function(){},touchmove:function(event){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event.touches[0]);coords.type=emp.typeLibrary.Pointer.EventType.MOVE;if(coords.lat!==undefined){this.empMapInstance.eventing.Pointer(coords)}this.state.lastInteractionEvent=event;EMPWorldWind.eventHandlers.notifyViewChange.call(this)}};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.drag={began:function(){},changed:function(){},ended:function(){}};var EMPWorldWind=EMPWorldWind||{};EMPWorldWind.eventHandlers=EMPWorldWind.eventHandlers||{};EMPWorldWind.eventHandlers.pointer={pointerdown:function(event){var mousedownEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);mousedownEvent.type=emp.typeLibrary.Pointer.EventType.MOUSEDOWN;EMPWorldWind.eventHandlers.extractFeatureFromEvent.call(this,event,mousedownEvent);this.empMapInstance.eventing.Pointer(mousedownEvent)},pointerup:function(event){var mouseupEvent=EMPWorldWind.utils.getEventCoordinates.call(this,event);mouseupEvent.type=emp.typeLibrary.Pointer.EventType.MOUSEUP;if(this.state.dragging){this.state.dragging=false;EMPWorldWind.eventHandlers.notifyViewChange.call(this,emp3.api.enums.CameraEventEnum.CAMERA_MOTION_STOPPED)}this.state.autoPanning=EMPWorldWind.constants.NO_PANNING;this.empMapInstance.eventing.Pointer(mouseupEvent)},pointermove:function(event){var coords=EMPWorldWind.utils.getEventCoordinates.call(this,event);coords.type=emp.typeLibrary.Pointer.EventType.MOVE;if(coords.lat!==undefined){this.empMapInstance.eventing.Pointer(coords)}var element,elementBounds,smartAreaBuffer=.05,pan={up:false,down:false,left:false,right:false};switch(event.buttons){case 1:case 2:switch(this.state.lockState){case emp3.api.enums.MapMotionLockEnum.NO_MOTION:case emp3.api.enums.MapMotionLockEnum.NO_PAN:case emp3.api.enums.MapMotionLockEnum.NO_ZOOM_NO_PAN:this.state.dragging=true;event.preventDefault();break;case emp3.api.enums.MapMotionLockEnum.SMART_MOTION:event.preventDefault();element=event.srcElement||event.originalTarget;elementBounds=element.getBoundingClientRect();pan.left=event.offsetX<elementBounds.width*smartAreaBuffer;pan.right=event.offsetX>elementBounds.width-elementBounds.width*smartAreaBuffer;pan.up=event.offsetY<elementBounds.height*smartAreaBuffer;pan.down=event.offsetY>elementBounds.height-elementBounds.height*smartAreaBuffer;if(pan.up||pan.down||pan.left||pan.right){this.state.autoPanning=pan;this.spinGlobe()}else{this.state.autoPanning=EMPWorldWind.constants.NO_PANNING}break;case emp3.api.enums.MapMotionLockEnum.UNLOCKED:default:EMPWorldWind.eventHandlers.notifyViewChange.call(this)}break;case 4:case 8:case 16:default:}this.state.lastInteractionEvent=event}};
//# sourceMappingURL=emp3-worldwind.min.js.map