<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: package: armyc2.c5isr.JavaLineArray, class: lineutility">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">/*</span>
<span class="source-line-no">002</span><span id="line-2"> * To change this template, choose Tools | Templates</span>
<span class="source-line-no">003</span><span id="line-3"> * and open the template in the editor.</span>
<span class="source-line-no">004</span><span id="line-4"> */</span>
<span class="source-line-no">005</span><span id="line-5">package armyc2.c5isr.JavaLineArray;</span>
<span class="source-line-no">006</span><span id="line-6"></span>
<span class="source-line-no">007</span><span id="line-7">import java.util.ArrayList;</span>
<span class="source-line-no">008</span><span id="line-8"></span>
<span class="source-line-no">009</span><span id="line-9">import armyc2.c5isr.JavaTacticalRenderer.TGLight;</span>
<span class="source-line-no">010</span><span id="line-10">import armyc2.c5isr.renderer.utilities.ErrorLogger;</span>
<span class="source-line-no">011</span><span id="line-11">import armyc2.c5isr.renderer.utilities.RendererException;</span>
<span class="source-line-no">012</span><span id="line-12"></span>
<span class="source-line-no">013</span><span id="line-13">import java.io.*;</span>
<span class="source-line-no">014</span><span id="line-14">import armyc2.c5isr.graphics2d.*;</span>
<span class="source-line-no">015</span><span id="line-15">import armyc2.c5isr.renderer.utilities.IPointConversion;</span>
<span class="source-line-no">016</span><span id="line-16">import armyc2.c5isr.JavaTacticalRenderer.mdlGeodesic;</span>
<span class="source-line-no">017</span><span id="line-17">import armyc2.c5isr.graphics2d.GeneralPath;</span>
<span class="source-line-no">018</span><span id="line-18">import armyc2.c5isr.graphics2d.PathIterator;</span>
<span class="source-line-no">019</span><span id="line-19">import armyc2.c5isr.graphics2d.Point;</span>
<span class="source-line-no">020</span><span id="line-20">import armyc2.c5isr.graphics2d.Point2D;</span>
<span class="source-line-no">021</span><span id="line-21">import armyc2.c5isr.graphics2d.Shape;</span>
<span class="source-line-no">022</span><span id="line-22"></span>
<span class="source-line-no">023</span><span id="line-23">/**</span>
<span class="source-line-no">024</span><span id="line-24"> * A class to provide the utility functions required for calculating the line</span>
<span class="source-line-no">025</span><span id="line-25"> * points.</span>
<span class="source-line-no">026</span><span id="line-26"> *</span>
<span class="source-line-no">027</span><span id="line-27"> */</span>
<span class="source-line-no">028</span><span id="line-28">public final class lineutility {</span>
<span class="source-line-no">029</span><span id="line-29"></span>
<span class="source-line-no">030</span><span id="line-30">    private static final String _className = "lineutility";</span>
<span class="source-line-no">031</span><span id="line-31">    public static final int extend_left = 0;</span>
<span class="source-line-no">032</span><span id="line-32">    public static final int extend_right = 1;</span>
<span class="source-line-no">033</span><span id="line-33">    public static final int extend_above = 2;</span>
<span class="source-line-no">034</span><span id="line-34">    public static final int extend_below = 3;</span>
<span class="source-line-no">035</span><span id="line-35"></span>
<span class="source-line-no">036</span><span id="line-36">    /**</span>
<span class="source-line-no">037</span><span id="line-37">     * Resizes the array to the length speicifed, called by the Channels class.</span>
<span class="source-line-no">038</span><span id="line-38">     *</span>
<span class="source-line-no">039</span><span id="line-39">     * @param pLinePoints the array to resize</span>
<span class="source-line-no">040</span><span id="line-40">     * @param length the length to which to resize the array.</span>
<span class="source-line-no">041</span><span id="line-41">     * @return the resized array</span>
<span class="source-line-no">042</span><span id="line-42">     */</span>
<span class="source-line-no">043</span><span id="line-43">    protected static POINT2[] ResizeArray(POINT2[] pLinePoints, int length) {</span>
<span class="source-line-no">044</span><span id="line-44">        POINT2[] array = new POINT2[length];</span>
<span class="source-line-no">045</span><span id="line-45">        try {</span>
<span class="source-line-no">046</span><span id="line-46">            if (pLinePoints.length &lt;= length) {</span>
<span class="source-line-no">047</span><span id="line-47">                return pLinePoints;</span>
<span class="source-line-no">048</span><span id="line-48">            }</span>
<span class="source-line-no">049</span><span id="line-49"></span>
<span class="source-line-no">050</span><span id="line-50">            int j = 0;</span>
<span class="source-line-no">051</span><span id="line-51">            for (j = 0; j &lt; length; j++) {</span>
<span class="source-line-no">052</span><span id="line-52">                array[j] = new POINT2(pLinePoints[j]);</span>
<span class="source-line-no">053</span><span id="line-53">            }</span>
<span class="source-line-no">054</span><span id="line-54">        } catch (Exception exc) {</span>
<span class="source-line-no">055</span><span id="line-55">            ErrorLogger.LogException(_className, "ResizeArray",</span>
<span class="source-line-no">056</span><span id="line-56">                    new RendererException("Failed inside ResizeArray", exc));</span>
<span class="source-line-no">057</span><span id="line-57">        }</span>
<span class="source-line-no">058</span><span id="line-58">        return array;</span>
<span class="source-line-no">059</span><span id="line-59">    }</span>
<span class="source-line-no">060</span><span id="line-60"></span>
<span class="source-line-no">061</span><span id="line-61">    /**</span>
<span class="source-line-no">062</span><span id="line-62">     * post-segments a line segment into 50 pixel intervals</span>
<span class="source-line-no">063</span><span id="line-63">     *</span>
<span class="source-line-no">064</span><span id="line-64">     * @param pt0</span>
<span class="source-line-no">065</span><span id="line-65">     * @param pt1</span>
<span class="source-line-no">066</span><span id="line-66">     * @param shape</span>
<span class="source-line-no">067</span><span id="line-67">     */</span>
<span class="source-line-no">068</span><span id="line-68">    protected static void SegmentLineShape(POINT2 pt0, POINT2 pt1, Shape2 shape) {</span>
<span class="source-line-no">069</span><span id="line-69">        try {</span>
<span class="source-line-no">070</span><span id="line-70">            if (pt0 == null || pt1 == null) {</span>
<span class="source-line-no">071</span><span id="line-71">                return;</span>
<span class="source-line-no">072</span><span id="line-72">            }</span>
<span class="source-line-no">073</span><span id="line-73"></span>
<span class="source-line-no">074</span><span id="line-74">            int j = 0, n = 0;</span>
<span class="source-line-no">075</span><span id="line-75">            double dist = CalcDistanceDouble(pt0, pt1);</span>
<span class="source-line-no">076</span><span id="line-76">            n = (int) (dist / 25d);</span>
<span class="source-line-no">077</span><span id="line-77">            POINT2 pt = null;</span>
<span class="source-line-no">078</span><span id="line-78">            shape.lineTo(pt0);</span>
<span class="source-line-no">079</span><span id="line-79">            for (j = 1; j &lt;= n; j++) {</span>
<span class="source-line-no">080</span><span id="line-80">                pt = lineutility.ExtendAlongLineDouble(pt0, pt1, 25);</span>
<span class="source-line-no">081</span><span id="line-81">                shape.lineTo(pt);</span>
<span class="source-line-no">082</span><span id="line-82">            }</span>
<span class="source-line-no">083</span><span id="line-83">            shape.lineTo(pt1);</span>
<span class="source-line-no">084</span><span id="line-84">        } catch (Exception exc) {</span>
<span class="source-line-no">085</span><span id="line-85">            ErrorLogger.LogException(_className, "SegmentLineShape",</span>
<span class="source-line-no">086</span><span id="line-86">                    new RendererException("Failed inside SegmentLineShape", exc));</span>
<span class="source-line-no">087</span><span id="line-87">        }</span>
<span class="source-line-no">088</span><span id="line-88">    }</span>
<span class="source-line-no">089</span><span id="line-89"></span>
<span class="source-line-no">090</span><span id="line-90">    /**</span>
<span class="source-line-no">091</span><span id="line-91">     * Calculates the middle segment for the Direction of Attack Aviation symbol</span>
<span class="source-line-no">092</span><span id="line-92">     *</span>
<span class="source-line-no">093</span><span id="line-93">     * @param pLinePoints the point array</span>
<span class="source-line-no">094</span><span id="line-94">     * @param vblSaveCounter the size of the point array</span>
<span class="source-line-no">095</span><span id="line-95">     * @return the middle segment</span>
<span class="source-line-no">096</span><span id="line-96">     */</span>
<span class="source-line-no">097</span><span id="line-97">    public static int GetDirAtkAirMiddleSegment(POINT2[] pLinePoints,</span>
<span class="source-line-no">098</span><span id="line-98">            int vblSaveCounter) {</span>
<span class="source-line-no">099</span><span id="line-99">        int middleSegment = -1;</span>
<span class="source-line-no">100</span><span id="line-100">        try {</span>
<span class="source-line-no">101</span><span id="line-101">            double d = 0;</span>
<span class="source-line-no">102</span><span id="line-102">            int k = 0;</span>
<span class="source-line-no">103</span><span id="line-103">            for (k = vblSaveCounter - 1; k &gt; 0; k--) {</span>
<span class="source-line-no">104</span><span id="line-104">                d += lineutility.CalcDistanceDouble(pLinePoints[k], pLinePoints[k - 1]);</span>
<span class="source-line-no">105</span><span id="line-105">                if (d &gt; 60) {</span>
<span class="source-line-no">106</span><span id="line-106">                    break;</span>
<span class="source-line-no">107</span><span id="line-107">                }</span>
<span class="source-line-no">108</span><span id="line-108">            }</span>
<span class="source-line-no">109</span><span id="line-109">            if (d &gt; 60) {</span>
<span class="source-line-no">110</span><span id="line-110">                middleSegment = k;</span>
<span class="source-line-no">111</span><span id="line-111">            } else {</span>
<span class="source-line-no">112</span><span id="line-112">                if (vblSaveCounter &lt;= 3) {</span>
<span class="source-line-no">113</span><span id="line-113">                    middleSegment = 1;</span>
<span class="source-line-no">114</span><span id="line-114">                } else {</span>
<span class="source-line-no">115</span><span id="line-115">                    middleSegment = 2;</span>
<span class="source-line-no">116</span><span id="line-116">                }</span>
<span class="source-line-no">117</span><span id="line-117">            }</span>
<span class="source-line-no">118</span><span id="line-118">        } catch (Exception exc) {</span>
<span class="source-line-no">119</span><span id="line-119">            ErrorLogger.LogException(_className, "GetDirAtkAirMiddleSegment",</span>
<span class="source-line-no">120</span><span id="line-120">                    new RendererException("Failed inside GetDirAtkAirMiddleSegment", exc));</span>
<span class="source-line-no">121</span><span id="line-121">        }</span>
<span class="source-line-no">122</span><span id="line-122">        return middleSegment;</span>
<span class="source-line-no">123</span><span id="line-123">    }</span>
<span class="source-line-no">124</span><span id="line-124"></span>
<span class="source-line-no">125</span><span id="line-125">    /**</span>
<span class="source-line-no">126</span><span id="line-126">     * Computes the angle in radians between two points</span>
<span class="source-line-no">127</span><span id="line-127">     *</span>
<span class="source-line-no">128</span><span id="line-128">     * @param pt0 the first point</span>
<span class="source-line-no">129</span><span id="line-129">     * @param pt1 the last point</span>
<span class="source-line-no">130</span><span id="line-130">     *</span>
<span class="source-line-no">131</span><span id="line-131">     * @return the angle in radians</span>
<span class="source-line-no">132</span><span id="line-132">     */</span>
<span class="source-line-no">133</span><span id="line-133">    protected static double CalcSegmentAngleDouble(POINT2 pt0,</span>
<span class="source-line-no">134</span><span id="line-134">            POINT2 pt1) {</span>
<span class="source-line-no">135</span><span id="line-135">        double dAngle = 0;</span>
<span class="source-line-no">136</span><span id="line-136">        try {</span>
<span class="source-line-no">137</span><span id="line-137">            //declarations</span>
<span class="source-line-no">138</span><span id="line-138">            int nTemp = 0;</span>
<span class="source-line-no">139</span><span id="line-139">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">140</span><span id="line-140">            //end declarations</span>
<span class="source-line-no">141</span><span id="line-141"></span>
<span class="source-line-no">142</span><span id="line-142">            nTemp = CalcTrueSlopeDouble(pt0, pt1, m);</span>
<span class="source-line-no">143</span><span id="line-143">            if (nTemp == 0) {</span>
<span class="source-line-no">144</span><span id="line-144">                dAngle = Math.PI / 2;</span>
<span class="source-line-no">145</span><span id="line-145">            } else {</span>
<span class="source-line-no">146</span><span id="line-146">                dAngle = Math.atan(m.value[0]);</span>
<span class="source-line-no">147</span><span id="line-147">            }</span>
<span class="source-line-no">148</span><span id="line-148"></span>
<span class="source-line-no">149</span><span id="line-149">        } catch (Exception exc) {</span>
<span class="source-line-no">150</span><span id="line-150">            ErrorLogger.LogException(_className, "CalcSegmentAngleDouble",</span>
<span class="source-line-no">151</span><span id="line-151">                    new RendererException("Failed inside CalcSegmentAngleDouble", exc));</span>
<span class="source-line-no">152</span><span id="line-152">        }</span>
<span class="source-line-no">153</span><span id="line-153">        return dAngle;</span>
<span class="source-line-no">154</span><span id="line-154">    }</span>
<span class="source-line-no">155</span><span id="line-155"></span>
<span class="source-line-no">156</span><span id="line-156">    /**</span>
<span class="source-line-no">157</span><span id="line-157">     * POINT2 in previous applications has been a struct that did not require</span>
<span class="source-line-no">158</span><span id="line-158">     * initialization.</span>
<span class="source-line-no">159</span><span id="line-159">     *</span>
<span class="source-line-no">160</span><span id="line-160">     * @param pts array of points to instantiate.</span>
<span class="source-line-no">161</span><span id="line-161">     */</span>
<span class="source-line-no">162</span><span id="line-162">    protected static void InitializePOINT2Array(POINT2[] pts) {</span>
<span class="source-line-no">163</span><span id="line-163">        //int j=0;</span>
<span class="source-line-no">164</span><span id="line-164">        if (pts == null || pts.length == 0) {</span>
<span class="source-line-no">165</span><span id="line-165">            return;</span>
<span class="source-line-no">166</span><span id="line-166">        }</span>
<span class="source-line-no">167</span><span id="line-167">        int n=pts.length;</span>
<span class="source-line-no">168</span><span id="line-168">        //for (int j = 0; j &lt; pts.length; j++) </span>
<span class="source-line-no">169</span><span id="line-169">        for (int j = 0; j &lt; n; j++) </span>
<span class="source-line-no">170</span><span id="line-170">        {</span>
<span class="source-line-no">171</span><span id="line-171">            pts[j] = new POINT2();</span>
<span class="source-line-no">172</span><span id="line-172">        }</span>
<span class="source-line-no">173</span><span id="line-173">    }</span>
<span class="source-line-no">174</span><span id="line-174"></span>
<span class="source-line-no">175</span><span id="line-175">    /**</span>
<span class="source-line-no">176</span><span id="line-176">     * Calculates the center point of an area using the first vblCounter points</span>
<span class="source-line-no">177</span><span id="line-177">     * in the array.</span>
<span class="source-line-no">178</span><span id="line-178">     *</span>
<span class="source-line-no">179</span><span id="line-179">     * @param pLinePoints the client points</span>
<span class="source-line-no">180</span><span id="line-180">     * @param vblCounter the number of points in the array to use</span>
<span class="source-line-no">181</span><span id="line-181">     *</span>
<span class="source-line-no">182</span><span id="line-182">     * @return the center point</span>
<span class="source-line-no">183</span><span id="line-183">     */</span>
<span class="source-line-no">184</span><span id="line-184">    protected static POINT2 CalcCenterPointDouble(POINT2[] pLinePoints,</span>
<span class="source-line-no">185</span><span id="line-185">            int vblCounter) {</span>
<span class="source-line-no">186</span><span id="line-186">        POINT2 CenterLinePoint = new POINT2(pLinePoints[0]);</span>
<span class="source-line-no">187</span><span id="line-187">        try {</span>
<span class="source-line-no">188</span><span id="line-188">            //declarations</span>
<span class="source-line-no">189</span><span id="line-189">            int j = 0;</span>
<span class="source-line-no">190</span><span id="line-190">            double dMinX = pLinePoints[0].x,</span>
<span class="source-line-no">191</span><span id="line-191">                    dMinY = pLinePoints[0].y,</span>
<span class="source-line-no">192</span><span id="line-192">                    dMaxX = pLinePoints[0].x,</span>
<span class="source-line-no">193</span><span id="line-193">                    dMaxY = pLinePoints[0].y;</span>
<span class="source-line-no">194</span><span id="line-194"></span>
<span class="source-line-no">195</span><span id="line-195">            //end declarations</span>
<span class="source-line-no">196</span><span id="line-196">            dMinX = pLinePoints[0].x;</span>
<span class="source-line-no">197</span><span id="line-197">            dMinY = pLinePoints[0].y;</span>
<span class="source-line-no">198</span><span id="line-198">            dMaxX = pLinePoints[0].x;</span>
<span class="source-line-no">199</span><span id="line-199">            dMaxY = pLinePoints[0].y;</span>
<span class="source-line-no">200</span><span id="line-200"></span>
<span class="source-line-no">201</span><span id="line-201">            for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">202</span><span id="line-202">                if (pLinePoints[j].x &lt; dMinX) {</span>
<span class="source-line-no">203</span><span id="line-203">                    dMinX = pLinePoints[j].x;</span>
<span class="source-line-no">204</span><span id="line-204">                }</span>
<span class="source-line-no">205</span><span id="line-205"></span>
<span class="source-line-no">206</span><span id="line-206">                if (pLinePoints[j].y &lt; dMinY) {</span>
<span class="source-line-no">207</span><span id="line-207">                    dMinY = pLinePoints[j].y;</span>
<span class="source-line-no">208</span><span id="line-208">                }</span>
<span class="source-line-no">209</span><span id="line-209"></span>
<span class="source-line-no">210</span><span id="line-210">                if (pLinePoints[j].x &gt; dMaxX) {</span>
<span class="source-line-no">211</span><span id="line-211">                    dMaxX = pLinePoints[j].x;</span>
<span class="source-line-no">212</span><span id="line-212">                }</span>
<span class="source-line-no">213</span><span id="line-213"></span>
<span class="source-line-no">214</span><span id="line-214">                if (pLinePoints[j].y &gt; dMaxY) {</span>
<span class="source-line-no">215</span><span id="line-215">                    dMaxY = pLinePoints[j].y;</span>
<span class="source-line-no">216</span><span id="line-216">                }</span>
<span class="source-line-no">217</span><span id="line-217"></span>
<span class="source-line-no">218</span><span id="line-218">            }   //end for</span>
<span class="source-line-no">219</span><span id="line-219"></span>
<span class="source-line-no">220</span><span id="line-220">            CenterLinePoint.x = (dMinX + dMaxX) / 2;</span>
<span class="source-line-no">221</span><span id="line-221">            CenterLinePoint.y = (dMinY + dMaxY) / 2;</span>
<span class="source-line-no">222</span><span id="line-222">        } catch (Error exc) {</span>
<span class="source-line-no">223</span><span id="line-223">            ErrorLogger.LogException(_className, "CalcCenterPointDouble",</span>
<span class="source-line-no">224</span><span id="line-224">                    new RendererException("Failed inside CalcCenterPointDouble", exc));</span>
<span class="source-line-no">225</span><span id="line-225">        }</span>
<span class="source-line-no">226</span><span id="line-226">        return CenterLinePoint;</span>
<span class="source-line-no">227</span><span id="line-227">    }</span>
<span class="source-line-no">228</span><span id="line-228"></span>
<span class="source-line-no">229</span><span id="line-229">    /**</span>
<span class="source-line-no">230</span><span id="line-230">     * Called by renderer Modifier2 class after ArrayList.ToArray was called,</span>
<span class="source-line-no">231</span><span id="line-231">     * which produces an array of objects.</span>
<span class="source-line-no">232</span><span id="line-232">     *</span>
<span class="source-line-no">233</span><span id="line-233">     * @param pLinePoints</span>
<span class="source-line-no">234</span><span id="line-234">     * @param vblCounter</span>
<span class="source-line-no">235</span><span id="line-235">     * @return</span>
<span class="source-line-no">236</span><span id="line-236">     */</span>
<span class="source-line-no">237</span><span id="line-237">    public static POINT2 CalcCenterPointDouble2(Object[] pLinePoints,</span>
<span class="source-line-no">238</span><span id="line-238">            int vblCounter) {</span>
<span class="source-line-no">239</span><span id="line-239">        POINT2 pt0 = (POINT2) pLinePoints[0];</span>
<span class="source-line-no">240</span><span id="line-240">        POINT2 CenterLinePoint = new POINT2();</span>
<span class="source-line-no">241</span><span id="line-241">        try {</span>
<span class="source-line-no">242</span><span id="line-242">            //declarations</span>
<span class="source-line-no">243</span><span id="line-243">            int j = 0;</span>
<span class="source-line-no">244</span><span id="line-244">            double dMinX = pt0.x,</span>
<span class="source-line-no">245</span><span id="line-245">                    dMinY = pt0.y,</span>
<span class="source-line-no">246</span><span id="line-246">                    dMaxX = pt0.x,</span>
<span class="source-line-no">247</span><span id="line-247">                    dMaxY = pt0.y;</span>
<span class="source-line-no">248</span><span id="line-248"></span>
<span class="source-line-no">249</span><span id="line-249">            //end declarations</span>
<span class="source-line-no">250</span><span id="line-250">            dMinX = pt0.x;</span>
<span class="source-line-no">251</span><span id="line-251">            dMinY = pt0.y;</span>
<span class="source-line-no">252</span><span id="line-252">            dMaxX = pt0.x;</span>
<span class="source-line-no">253</span><span id="line-253">            dMaxY = pt0.y;</span>
<span class="source-line-no">254</span><span id="line-254"></span>
<span class="source-line-no">255</span><span id="line-255">            POINT2 pt;</span>
<span class="source-line-no">256</span><span id="line-256"></span>
<span class="source-line-no">257</span><span id="line-257">            for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">258</span><span id="line-258">                pt = (POINT2) pLinePoints[j];</span>
<span class="source-line-no">259</span><span id="line-259">                if (pt.x &lt; dMinX) {</span>
<span class="source-line-no">260</span><span id="line-260">                    dMinX = pt.x;</span>
<span class="source-line-no">261</span><span id="line-261">                }</span>
<span class="source-line-no">262</span><span id="line-262"></span>
<span class="source-line-no">263</span><span id="line-263">                if (pt.y &lt; dMinY) {</span>
<span class="source-line-no">264</span><span id="line-264">                    dMinY = pt.y;</span>
<span class="source-line-no">265</span><span id="line-265">                }</span>
<span class="source-line-no">266</span><span id="line-266"></span>
<span class="source-line-no">267</span><span id="line-267">                if (pt.x &gt; dMaxX) {</span>
<span class="source-line-no">268</span><span id="line-268">                    dMaxX = pt.x;</span>
<span class="source-line-no">269</span><span id="line-269">                }</span>
<span class="source-line-no">270</span><span id="line-270"></span>
<span class="source-line-no">271</span><span id="line-271">                if (pt.y &gt; dMaxY) {</span>
<span class="source-line-no">272</span><span id="line-272">                    dMaxY = pt.y;</span>
<span class="source-line-no">273</span><span id="line-273">                }</span>
<span class="source-line-no">274</span><span id="line-274"></span>
<span class="source-line-no">275</span><span id="line-275">            }   //end for</span>
<span class="source-line-no">276</span><span id="line-276"></span>
<span class="source-line-no">277</span><span id="line-277">            CenterLinePoint.x = (dMinX + dMaxX) / 2;</span>
<span class="source-line-no">278</span><span id="line-278">            CenterLinePoint.y = (dMinY + dMaxY) / 2;</span>
<span class="source-line-no">279</span><span id="line-279">        } catch (Error exc) {</span>
<span class="source-line-no">280</span><span id="line-280">            ErrorLogger.LogException(_className, "CalcCenterPointDouble2",</span>
<span class="source-line-no">281</span><span id="line-281">                    new RendererException("Failed inside CalcCenterPointDouble2", exc));</span>
<span class="source-line-no">282</span><span id="line-282">        }</span>
<span class="source-line-no">283</span><span id="line-283">        return CenterLinePoint;</span>
<span class="source-line-no">284</span><span id="line-284">    }</span>
<span class="source-line-no">285</span><span id="line-285"></span>
<span class="source-line-no">286</span><span id="line-286">    /**</span>
<span class="source-line-no">287</span><span id="line-287">     * Calculates the distance in pixels between two points</span>
<span class="source-line-no">288</span><span id="line-288">     *</span>
<span class="source-line-no">289</span><span id="line-289">     * @param p1 the first point</span>
<span class="source-line-no">290</span><span id="line-290">     * @param p2 the last point</span>
<span class="source-line-no">291</span><span id="line-291">     *</span>
<span class="source-line-no">292</span><span id="line-292">     * @return the distance between p1 and p2 in pixels</span>
<span class="source-line-no">293</span><span id="line-293">     */</span>
<span class="source-line-no">294</span><span id="line-294">    public static double CalcDistanceDouble(POINT2 p1,</span>
<span class="source-line-no">295</span><span id="line-295">            POINT2 p2) {</span>
<span class="source-line-no">296</span><span id="line-296">        double returnValue = 0;</span>
<span class="source-line-no">297</span><span id="line-297">        try {</span>
<span class="source-line-no">298</span><span id="line-298">            returnValue = Math.sqrt((p1.x - p2.x)</span>
<span class="source-line-no">299</span><span id="line-299">                    * (p1.x - p2.x)</span>
<span class="source-line-no">300</span><span id="line-300">                    + (p1.y - p2.y)</span>
<span class="source-line-no">301</span><span id="line-301">                    * (p1.y - p2.y));</span>
<span class="source-line-no">302</span><span id="line-302"></span>
<span class="source-line-no">303</span><span id="line-303">            //sanity check</span>
<span class="source-line-no">304</span><span id="line-304">            //return x or y distance if returnValue is 0 or infinity</span>
<span class="source-line-no">305</span><span id="line-305">            double xdist = Math.abs(p1.x - p2.x);</span>
<span class="source-line-no">306</span><span id="line-306">            double ydist = Math.abs(p1.y - p2.y);</span>
<span class="source-line-no">307</span><span id="line-307">            double max = xdist;</span>
<span class="source-line-no">308</span><span id="line-308">            if (ydist &gt; xdist) {</span>
<span class="source-line-no">309</span><span id="line-309">                max = ydist;</span>
<span class="source-line-no">310</span><span id="line-310">            }</span>
<span class="source-line-no">311</span><span id="line-311"></span>
<span class="source-line-no">312</span><span id="line-312">            if (returnValue == 0 || Double.isInfinite(returnValue)) {</span>
<span class="source-line-no">313</span><span id="line-313">                if (max &gt; 0) {</span>
<span class="source-line-no">314</span><span id="line-314">                    returnValue = max;</span>
<span class="source-line-no">315</span><span id="line-315">                }</span>
<span class="source-line-no">316</span><span id="line-316">            }</span>
<span class="source-line-no">317</span><span id="line-317">        } catch (Exception exc) {</span>
<span class="source-line-no">318</span><span id="line-318">            ErrorLogger.LogException(_className, "CalcDistanceDouble",</span>
<span class="source-line-no">319</span><span id="line-319">                    new RendererException("Failed inside CalcDistanceDouble", exc));</span>
<span class="source-line-no">320</span><span id="line-320">        }</span>
<span class="source-line-no">321</span><span id="line-321">        return returnValue;</span>
<span class="source-line-no">322</span><span id="line-322">    }</span>
<span class="source-line-no">323</span><span id="line-323"></span>
<span class="source-line-no">324</span><span id="line-324">    /**</span>
<span class="source-line-no">325</span><span id="line-325">     * Calculates the distance in pixels between two points</span>
<span class="source-line-no">326</span><span id="line-326">     *</span>
<span class="source-line-no">327</span><span id="line-327">     * @param p1 the first point</span>
<span class="source-line-no">328</span><span id="line-328">     * @param p2 the last point</span>
<span class="source-line-no">329</span><span id="line-329">     *</span>
<span class="source-line-no">330</span><span id="line-330">     * @return the distance between p1 and p2 in pixels</span>
<span class="source-line-no">331</span><span id="line-331">     */</span>
<span class="source-line-no">332</span><span id="line-332">    public static double CalcDistanceDouble(Point2D p1,</span>
<span class="source-line-no">333</span><span id="line-333">                                            Point2D p2) {</span>
<span class="source-line-no">334</span><span id="line-334">        double returnValue = 0;</span>
<span class="source-line-no">335</span><span id="line-335">        try {</span>
<span class="source-line-no">336</span><span id="line-336">            returnValue = Math.sqrt((p1.getX() - p2.getX())</span>
<span class="source-line-no">337</span><span id="line-337">                    * (p1.getX() - p2.getX())</span>
<span class="source-line-no">338</span><span id="line-338">                    + (p1.getY() - p2.getY())</span>
<span class="source-line-no">339</span><span id="line-339">                    * (p1.getY() - p2.getY()));</span>
<span class="source-line-no">340</span><span id="line-340"></span>
<span class="source-line-no">341</span><span id="line-341">            //sanity check</span>
<span class="source-line-no">342</span><span id="line-342">            //return x or y distance if returnValue is 0 or infinity</span>
<span class="source-line-no">343</span><span id="line-343">            double xdist = Math.abs(p1.getX() - p2.getX());</span>
<span class="source-line-no">344</span><span id="line-344">            double ydist = Math.abs(p1.getY() - p2.getY());</span>
<span class="source-line-no">345</span><span id="line-345">            double max = xdist;</span>
<span class="source-line-no">346</span><span id="line-346">            if (ydist &gt; xdist) {</span>
<span class="source-line-no">347</span><span id="line-347">                max = ydist;</span>
<span class="source-line-no">348</span><span id="line-348">            }</span>
<span class="source-line-no">349</span><span id="line-349"></span>
<span class="source-line-no">350</span><span id="line-350">            if (returnValue == 0 || Double.isInfinite(returnValue)) {</span>
<span class="source-line-no">351</span><span id="line-351">                if (max &gt; 0) {</span>
<span class="source-line-no">352</span><span id="line-352">                    returnValue = max;</span>
<span class="source-line-no">353</span><span id="line-353">                }</span>
<span class="source-line-no">354</span><span id="line-354">            }</span>
<span class="source-line-no">355</span><span id="line-355">        } catch (Exception exc) {</span>
<span class="source-line-no">356</span><span id="line-356">            ErrorLogger.LogException(_className, "CalcDistanceDouble",</span>
<span class="source-line-no">357</span><span id="line-357">                    new RendererException("Failed inside CalcDistanceDouble", exc));</span>
<span class="source-line-no">358</span><span id="line-358">        }</span>
<span class="source-line-no">359</span><span id="line-359">        return returnValue;</span>
<span class="source-line-no">360</span><span id="line-360">    }</span>
<span class="source-line-no">361</span><span id="line-361"></span>
<span class="source-line-no">362</span><span id="line-362">    /**</span>
<span class="source-line-no">363</span><span id="line-363">     * Computes the slope of a line</span>
<span class="source-line-no">364</span><span id="line-364">     *</span>
<span class="source-line-no">365</span><span id="line-365">     * @param firstLinePoint the first line point</span>
<span class="source-line-no">366</span><span id="line-366">     * @param lastLinePoint the last line point</span>
<span class="source-line-no">367</span><span id="line-367">     * @param slope OUT - object with member to hold the slope of the line</span>
<span class="source-line-no">368</span><span id="line-368">     *</span>
<span class="source-line-no">369</span><span id="line-369">     * @return 1 if successful, else return 0</span>
<span class="source-line-no">370</span><span id="line-370">     */</span>
<span class="source-line-no">371</span><span id="line-371">    protected static int CalcTrueSlopeDouble(POINT2 firstLinePoint,</span>
<span class="source-line-no">372</span><span id="line-372">            POINT2 lastLinePoint,</span>
<span class="source-line-no">373</span><span id="line-373">            ref&lt;double[]&gt; slope)//ref is a double</span>
<span class="source-line-no">374</span><span id="line-374">    {</span>
<span class="source-line-no">375</span><span id="line-375">        int result = 1;</span>
<span class="source-line-no">376</span><span id="line-376">        try {</span>
<span class="source-line-no">377</span><span id="line-377">            if (slope.value == null) {</span>
<span class="source-line-no">378</span><span id="line-378">                slope.value = new double[1];</span>
<span class="source-line-no">379</span><span id="line-379">            }</span>
<span class="source-line-no">380</span><span id="line-380"></span>
<span class="source-line-no">381</span><span id="line-381">            double deltaX = 0, deltaY = 0;</span>
<span class="source-line-no">382</span><span id="line-382">            deltaX = firstLinePoint.x - lastLinePoint.x;</span>
<span class="source-line-no">383</span><span id="line-383">            //if (deltaX == 0) </span>
<span class="source-line-no">384</span><span id="line-384">            if (Math.abs(deltaX) &lt; 1) </span>
<span class="source-line-no">385</span><span id="line-385">            {</span>
<span class="source-line-no">386</span><span id="line-386">                //deltaX = 1;</span>
<span class="source-line-no">387</span><span id="line-387">                if(deltaX&gt;=0)</span>
<span class="source-line-no">388</span><span id="line-388">                    deltaX=1;</span>
<span class="source-line-no">389</span><span id="line-389">                else</span>
<span class="source-line-no">390</span><span id="line-390">                    deltaX=-1;</span>
<span class="source-line-no">391</span><span id="line-391">                result = 1;</span>
<span class="source-line-no">392</span><span id="line-392">            }</span>
<span class="source-line-no">393</span><span id="line-393">            deltaY = firstLinePoint.y - lastLinePoint.y;</span>
<span class="source-line-no">394</span><span id="line-394"></span>
<span class="source-line-no">395</span><span id="line-395">            slope.value[0] = deltaY / deltaX;   //cannot blow up</span>
<span class="source-line-no">396</span><span id="line-396">        } catch (Error exc) {</span>
<span class="source-line-no">397</span><span id="line-397">            ErrorLogger.LogException(_className, "CalcTrueSlopeDouble",</span>
<span class="source-line-no">398</span><span id="line-398">                    new RendererException("Failed inside CalcTrueSlopeDouble", exc));</span>
<span class="source-line-no">399</span><span id="line-399">        }</span>
<span class="source-line-no">400</span><span id="line-400">        return result;</span>
<span class="source-line-no">401</span><span id="line-401">    }</span>
<span class="source-line-no">402</span><span id="line-402"></span>
<span class="source-line-no">403</span><span id="line-403">    public static void WriteFile(String str) {</span>
<span class="source-line-no">404</span><span id="line-404">        try {</span>
<span class="source-line-no">405</span><span id="line-405">            BufferedWriter bufferedWriter = new BufferedWriter(new FileWriter("Test.txt"));</span>
<span class="source-line-no">406</span><span id="line-406">            bufferedWriter.write(str);</span>
<span class="source-line-no">407</span><span id="line-407">            bufferedWriter.close();</span>
<span class="source-line-no">408</span><span id="line-408">            bufferedWriter = null;</span>
<span class="source-line-no">409</span><span id="line-409">        } catch (Exception exc) {</span>
<span class="source-line-no">410</span><span id="line-410">            ErrorLogger.LogException(_className, "WriteFile",</span>
<span class="source-line-no">411</span><span id="line-411">                    new RendererException("Failed inside WriteFile", exc));</span>
<span class="source-line-no">412</span><span id="line-412">        }</span>
<span class="source-line-no">413</span><span id="line-413">    }</span>
<span class="source-line-no">414</span><span id="line-414"></span>
<span class="source-line-no">415</span><span id="line-415">    /**</span>
<span class="source-line-no">416</span><span id="line-416">     * reverses the first vblCounter points</span>
<span class="source-line-no">417</span><span id="line-417">     *</span>
<span class="source-line-no">418</span><span id="line-418">     * @param pLowerLinePoints OUT - points to reverse</span>
<span class="source-line-no">419</span><span id="line-419">     * @param vblCounter</span>
<span class="source-line-no">420</span><span id="line-420">     */</span>
<span class="source-line-no">421</span><span id="line-421">    protected static void ReversePointsDouble2(POINT2[] pLowerLinePoints,</span>
<span class="source-line-no">422</span><span id="line-422">            int vblCounter) {</span>
<span class="source-line-no">423</span><span id="line-423">        try {</span>
<span class="source-line-no">424</span><span id="line-424">            POINT2[] pResultPoints = new POINT2[vblCounter];</span>
<span class="source-line-no">425</span><span id="line-425">            int k = 0;</span>
<span class="source-line-no">426</span><span id="line-426">            for (k = 0; k &lt; vblCounter; k++) {</span>
<span class="source-line-no">427</span><span id="line-427">                pResultPoints[k] = new POINT2(pLowerLinePoints[vblCounter - k - 1]);</span>
<span class="source-line-no">428</span><span id="line-428">            }</span>
<span class="source-line-no">429</span><span id="line-429">            for (k = 0; k &lt; vblCounter; k++) {</span>
<span class="source-line-no">430</span><span id="line-430">                pLowerLinePoints[k] = new POINT2(pResultPoints[k]);</span>
<span class="source-line-no">431</span><span id="line-431">            }</span>
<span class="source-line-no">432</span><span id="line-432">            pResultPoints = null;</span>
<span class="source-line-no">433</span><span id="line-433">        } catch (Exception exc) {</span>
<span class="source-line-no">434</span><span id="line-434">            ErrorLogger.LogException(_className, "ReversePointsDouble2",</span>
<span class="source-line-no">435</span><span id="line-435">                    new RendererException("Failed inside ReversePointsDouble2", exc));</span>
<span class="source-line-no">436</span><span id="line-436">        }</span>
<span class="source-line-no">437</span><span id="line-437">    }</span>
<span class="source-line-no">438</span><span id="line-438"></span>
<span class="source-line-no">439</span><span id="line-439">    public static boolean CalcTrueSlopeDoubleForRoutes(POINT2 firstLinePoint,</span>
<span class="source-line-no">440</span><span id="line-440">            POINT2 lastLinePoint,</span>
<span class="source-line-no">441</span><span id="line-441">            ref&lt;double[]&gt; slope) {</span>
<span class="source-line-no">442</span><span id="line-442">        try {</span>
<span class="source-line-no">443</span><span id="line-443">            double deltaX = 0, deltaY = 0;</span>
<span class="source-line-no">444</span><span id="line-444">            deltaX = (double) (firstLinePoint.x) - (double) (lastLinePoint.x);</span>
<span class="source-line-no">445</span><span id="line-445">            if (Math.abs(deltaX) &lt; 2) //was 2,infinite slope</span>
<span class="source-line-no">446</span><span id="line-446">            {</span>
<span class="source-line-no">447</span><span id="line-447">                return (false);</span>
<span class="source-line-no">448</span><span id="line-448">            }</span>
<span class="source-line-no">449</span><span id="line-449"></span>
<span class="source-line-no">450</span><span id="line-450">            deltaY = (double) (firstLinePoint.y) - (double) (lastLinePoint.y);</span>
<span class="source-line-no">451</span><span id="line-451">            if (slope.value == null) {</span>
<span class="source-line-no">452</span><span id="line-452">                slope.value = new double[1];</span>
<span class="source-line-no">453</span><span id="line-453">            }</span>
<span class="source-line-no">454</span><span id="line-454"></span>
<span class="source-line-no">455</span><span id="line-455">            slope.value[0] = deltaY / deltaX;</span>
<span class="source-line-no">456</span><span id="line-456">        } catch (Exception exc) {</span>
<span class="source-line-no">457</span><span id="line-457">            ErrorLogger.LogException(_className, "CalcTrueSlopeDoubleForRoutes",</span>
<span class="source-line-no">458</span><span id="line-458">                    new RendererException("Failed inside CalcTrueSlopeDoubleForRoutes", exc));</span>
<span class="source-line-no">459</span><span id="line-459">        }</span>
<span class="source-line-no">460</span><span id="line-460">        return true;</span>
<span class="source-line-no">461</span><span id="line-461">    }</span>
<span class="source-line-no">462</span><span id="line-462"></span>
<span class="source-line-no">463</span><span id="line-463">    /**</span>
<span class="source-line-no">464</span><span id="line-464">     * Computes the slope of a line</span>
<span class="source-line-no">465</span><span id="line-465">     *</span>
<span class="source-line-no">466</span><span id="line-466">     * @param firstLinePoint the first line point</span>
<span class="source-line-no">467</span><span id="line-467">     * @param lastLinePoint the last line point</span>
<span class="source-line-no">468</span><span id="line-468">     * @param slope OUT - object with member to hold the slope of the line</span>
<span class="source-line-no">469</span><span id="line-469">     *</span>
<span class="source-line-no">470</span><span id="line-470">     * @return true if successful</span>
<span class="source-line-no">471</span><span id="line-471">     */</span>
<span class="source-line-no">472</span><span id="line-472">    public static boolean CalcTrueSlopeDouble2(POINT2 firstLinePoint,</span>
<span class="source-line-no">473</span><span id="line-473">            POINT2 lastLinePoint,</span>
<span class="source-line-no">474</span><span id="line-474">            ref&lt;double[]&gt; slope) {</span>
<span class="source-line-no">475</span><span id="line-475">        Boolean result = true;</span>
<span class="source-line-no">476</span><span id="line-476">        try {</span>
<span class="source-line-no">477</span><span id="line-477">            double deltaX = 0, deltaY = 0;</span>
<span class="source-line-no">478</span><span id="line-478">            deltaX = (double) (firstLinePoint.x) - (double) (lastLinePoint.x);</span>
<span class="source-line-no">479</span><span id="line-479">            //if (deltaX == 0)</span>
<span class="source-line-no">480</span><span id="line-480">            if (Math.abs(deltaX) &lt; 1) </span>
<span class="source-line-no">481</span><span id="line-481">            {</span>
<span class="source-line-no">482</span><span id="line-482">                //deltaX = 1;</span>
<span class="source-line-no">483</span><span id="line-483">                if(deltaX&gt;=0)</span>
<span class="source-line-no">484</span><span id="line-484">                    deltaX=1;</span>
<span class="source-line-no">485</span><span id="line-485">                else</span>
<span class="source-line-no">486</span><span id="line-486">                    deltaX=-1;</span>
<span class="source-line-no">487</span><span id="line-487">                result = false;</span>
<span class="source-line-no">488</span><span id="line-488">            }</span>
<span class="source-line-no">489</span><span id="line-489"></span>
<span class="source-line-no">490</span><span id="line-490">            deltaY = (double) (firstLinePoint.y) - (double) (lastLinePoint.y);</span>
<span class="source-line-no">491</span><span id="line-491">            if (slope.value == null) {</span>
<span class="source-line-no">492</span><span id="line-492">                slope.value = new double[1];</span>
<span class="source-line-no">493</span><span id="line-493">            }</span>
<span class="source-line-no">494</span><span id="line-494"></span>
<span class="source-line-no">495</span><span id="line-495">            slope.value[0] = deltaY / deltaX;</span>
<span class="source-line-no">496</span><span id="line-496">        } catch (Exception exc) {</span>
<span class="source-line-no">497</span><span id="line-497">            ErrorLogger.LogException(_className, "CalcTrueSlopeDouble2",</span>
<span class="source-line-no">498</span><span id="line-498">                    new RendererException("Failed inside CalcTrueSlopeDouble2", exc));</span>
<span class="source-line-no">499</span><span id="line-499">        }</span>
<span class="source-line-no">500</span><span id="line-500">        return result;</span>
<span class="source-line-no">501</span><span id="line-501">    }</span>
<span class="source-line-no">502</span><span id="line-502"></span>
<span class="source-line-no">503</span><span id="line-503">    /**</span>
<span class="source-line-no">504</span><span id="line-504">     * Calculates the slopes and y intercepts in pixels for the line from pt1 to</span>
<span class="source-line-no">505</span><span id="line-505">     * pt2 and a parallel line a vertical distance from the line</span>
<span class="source-line-no">506</span><span id="line-506">     *</span>
<span class="source-line-no">507</span><span id="line-507">     * @param nDistance the distance in pixels</span>
<span class="source-line-no">508</span><span id="line-508">     * @param linePoint1 first point on the line</span>
<span class="source-line-no">509</span><span id="line-509">     * @param linePoint2 last point on the line</span>
<span class="source-line-no">510</span><span id="line-510">     * @param pdResult OUT - array to hold m, b for both lines</span>
<span class="source-line-no">511</span><span id="line-511">     *</span>
<span class="source-line-no">512</span><span id="line-512">     * @return 1 if the lines are not vertical, else return 0</span>
<span class="source-line-no">513</span><span id="line-513">     */</span>
<span class="source-line-no">514</span><span id="line-514">    protected static int CalcTrueLinesDouble(long nDistance,</span>
<span class="source-line-no">515</span><span id="line-515">            POINT2 linePoint1,</span>
<span class="source-line-no">516</span><span id="line-516">            POINT2 linePoint2,</span>
<span class="source-line-no">517</span><span id="line-517">            ref&lt;double[]&gt; pdResult) //for vertical line e.g. if line equation is x=7</span>
<span class="source-line-no">518</span><span id="line-518">    {</span>
<span class="source-line-no">519</span><span id="line-519">        try {</span>
<span class="source-line-no">520</span><span id="line-520">            //declarations</span>
<span class="source-line-no">521</span><span id="line-521">            int nTemp = 0;</span>
<span class="source-line-no">522</span><span id="line-522">            double b = 0;</span>
<span class="source-line-no">523</span><span id="line-523">            double delta = 0;</span>
<span class="source-line-no">524</span><span id="line-524">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">525</span><span id="line-525">            //end declarations</span>
<span class="source-line-no">526</span><span id="line-526">            nTemp = CalcTrueSlopeDouble(linePoint1, linePoint2, m);</span>
<span class="source-line-no">527</span><span id="line-527">            pdResult.value = new double[6];</span>
<span class="source-line-no">528</span><span id="line-528">            //Fill the result array with the line parameters</span>
<span class="source-line-no">529</span><span id="line-529">            if (nTemp == 0) //vertical lines</span>
<span class="source-line-no">530</span><span id="line-530">            {</span>
<span class="source-line-no">531</span><span id="line-531">                pdResult.value[3] = linePoint1.x + (double) nDistance;  //the lower line eqn, e.g. x=7</span>
<span class="source-line-no">532</span><span id="line-532">                pdResult.value[5] = linePoint1.x - (double) nDistance;  //the upper line eqn,</span>
<span class="source-line-no">533</span><span id="line-533">                return 0;</span>
<span class="source-line-no">534</span><span id="line-534">            } else {</span>
<span class="source-line-no">535</span><span id="line-535">                b = linePoint2.y - m.value[0] * linePoint2.x;</span>
<span class="source-line-no">536</span><span id="line-536">                delta = Math.sqrt(m.value[0] * m.value[0] * ((double) (nDistance) * (double) (nDistance))</span>
<span class="source-line-no">537</span><span id="line-537">                        + ((double) (nDistance) * (double) (nDistance)));</span>
<span class="source-line-no">538</span><span id="line-538">                pdResult.value[0] = m.value[0];    //original line eq'n: y = mx + b</span>
<span class="source-line-no">539</span><span id="line-539">                pdResult.value[1] = b;</span>
<span class="source-line-no">540</span><span id="line-540">                pdResult.value[2] = m.value[0];    //lower line eq'n: y = mx + (b+dDistance)</span>
<span class="source-line-no">541</span><span id="line-541">                pdResult.value[3] = b + delta;</span>
<span class="source-line-no">542</span><span id="line-542">                pdResult.value[4] = m.value[0];    //upper line eq'n: y = mx + (b-dDistance)</span>
<span class="source-line-no">543</span><span id="line-543">                pdResult.value[5] = b - delta;</span>
<span class="source-line-no">544</span><span id="line-544">            }</span>
<span class="source-line-no">545</span><span id="line-545">        } catch (Exception exc) {</span>
<span class="source-line-no">546</span><span id="line-546">            ErrorLogger.LogException(_className, "CalcTrueLinesDouble",</span>
<span class="source-line-no">547</span><span id="line-547">                    new RendererException("Failed inside CalcTrueLinesDouble", exc));</span>
<span class="source-line-no">548</span><span id="line-548">        }</span>
<span class="source-line-no">549</span><span id="line-549">        return 1;</span>
<span class="source-line-no">550</span><span id="line-550">    }</span>
<span class="source-line-no">551</span><span id="line-551"></span>
<span class="source-line-no">552</span><span id="line-552">    /**</span>
<span class="source-line-no">553</span><span id="line-553">     * Calculates the intersection of two lines.</span>
<span class="source-line-no">554</span><span id="line-554">     *</span>
<span class="source-line-no">555</span><span id="line-555">     * @param m1 slope of first line</span>
<span class="source-line-no">556</span><span id="line-556">     * @param b1 Y intercept of first line</span>
<span class="source-line-no">557</span><span id="line-557">     * @param m2 slope of second line</span>
<span class="source-line-no">558</span><span id="line-558">     * @param b2 Y intercept of second line</span>
<span class="source-line-no">559</span><span id="line-559">     * @param bolVertical1 0 if first line is vertical, else 1</span>
<span class="source-line-no">560</span><span id="line-560">     * @param bolVertical2 0 if second line is vertical, else 1</span>
<span class="source-line-no">561</span><span id="line-561">     * @param X1 X intercept if first line is vertical</span>
<span class="source-line-no">562</span><span id="line-562">     * @param X2 X intercept if 2nd line is vertical.</span>
<span class="source-line-no">563</span><span id="line-563">     *</span>
<span class="source-line-no">564</span><span id="line-564">     * @return intersection point</span>
<span class="source-line-no">565</span><span id="line-565">     */</span>
<span class="source-line-no">566</span><span id="line-566">    public static POINT2 CalcTrueIntersectDouble2(double m1,</span>
<span class="source-line-no">567</span><span id="line-567">            double b1,</span>
<span class="source-line-no">568</span><span id="line-568">            double m2,</span>
<span class="source-line-no">569</span><span id="line-569">            double b2,</span>
<span class="source-line-no">570</span><span id="line-570">            int bolVertical1,</span>
<span class="source-line-no">571</span><span id="line-571">            int bolVertical2,</span>
<span class="source-line-no">572</span><span id="line-572">            double X1, //x intercept if line1 is vertical</span>
<span class="source-line-no">573</span><span id="line-573">            double X2) {</span>
<span class="source-line-no">574</span><span id="line-574">        POINT2 ptIntersect = new POINT2();</span>
<span class="source-line-no">575</span><span id="line-575">        try {</span>
<span class="source-line-no">576</span><span id="line-576">            //declarations</span>
<span class="source-line-no">577</span><span id="line-577">            double x = 0, y = 0;</span>
<span class="source-line-no">578</span><span id="line-578">            //end declarations</span>
<span class="source-line-no">579</span><span id="line-579"></span>
<span class="source-line-no">580</span><span id="line-580">            //initialize ptIntersect</span>
<span class="source-line-no">581</span><span id="line-581">            ptIntersect.x = X1;</span>
<span class="source-line-no">582</span><span id="line-582">            ptIntersect.y = X2;</span>
<span class="source-line-no">583</span><span id="line-583">            if (bolVertical1 == 0 &amp;&amp; bolVertical2 == 0) //both lines vertical</span>
<span class="source-line-no">584</span><span id="line-584">            {</span>
<span class="source-line-no">585</span><span id="line-585">                return ptIntersect;</span>
<span class="source-line-no">586</span><span id="line-586">            }</span>
<span class="source-line-no">587</span><span id="line-587">            //the following 3 if blocks are the only ways to get an intersection</span>
<span class="source-line-no">588</span><span id="line-588">            if (bolVertical1 == 0 &amp;&amp; bolVertical2 == 1) //line1 vertical, line2 not</span>
<span class="source-line-no">589</span><span id="line-589">            {</span>
<span class="source-line-no">590</span><span id="line-590">                ptIntersect.x = X1;</span>
<span class="source-line-no">591</span><span id="line-591">                ptIntersect.y = m2 * X1 + b2;</span>
<span class="source-line-no">592</span><span id="line-592">                return ptIntersect;</span>
<span class="source-line-no">593</span><span id="line-593">            }</span>
<span class="source-line-no">594</span><span id="line-594">            if (bolVertical1 == 1 &amp;&amp; bolVertical2 == 0) //line2 vertical, line1 not</span>
<span class="source-line-no">595</span><span id="line-595">            {</span>
<span class="source-line-no">596</span><span id="line-596">                ptIntersect.x = X2;</span>
<span class="source-line-no">597</span><span id="line-597">                ptIntersect.y = m1 * X2 + b1;</span>
<span class="source-line-no">598</span><span id="line-598">                return ptIntersect;</span>
<span class="source-line-no">599</span><span id="line-599">            }</span>
<span class="source-line-no">600</span><span id="line-600">            //if either of the lines is vertical function has already returned</span>
<span class="source-line-no">601</span><span id="line-601">            //so both m1 and m2 should be valid</span>
<span class="source-line-no">602</span><span id="line-602">            if (m1 != m2) {</span>
<span class="source-line-no">603</span><span id="line-603">                x = (b2 - b1) / (m1 - m2);      //cannot blow up</span>
<span class="source-line-no">604</span><span id="line-604">                y = (m1 * x + b1);</span>
<span class="source-line-no">605</span><span id="line-605">                ptIntersect.x = x;</span>
<span class="source-line-no">606</span><span id="line-606">                ptIntersect.y = y;</span>
<span class="source-line-no">607</span><span id="line-607">                return ptIntersect;</span>
<span class="source-line-no">608</span><span id="line-608">            }</span>
<span class="source-line-no">609</span><span id="line-609">        } catch (Exception exc) {</span>
<span class="source-line-no">610</span><span id="line-610">            ErrorLogger.LogException(_className, "CalcTrueIntersectDouble2",</span>
<span class="source-line-no">611</span><span id="line-611">                    new RendererException("Failed inside CalcTrueIntersectDouble2", exc));</span>
<span class="source-line-no">612</span><span id="line-612">        }</span>
<span class="source-line-no">613</span><span id="line-613">        return ptIntersect;</span>
<span class="source-line-no">614</span><span id="line-614">    }</span>
<span class="source-line-no">615</span><span id="line-615"></span>
<span class="source-line-no">616</span><span id="line-616">    /**</span>
<span class="source-line-no">617</span><span id="line-617">     * Calculates an offset point for channel types which require arrows.</span>
<span class="source-line-no">618</span><span id="line-618">     *</span>
<span class="source-line-no">619</span><span id="line-619">     * @param startLinePoint the first point</span>
<span class="source-line-no">620</span><span id="line-620">     * @param endLinePoint the last point</span>
<span class="source-line-no">621</span><span id="line-621">     * @param nOffset the offset in pixels</span>
<span class="source-line-no">622</span><span id="line-622">     *</span>
<span class="source-line-no">623</span><span id="line-623">     * @return the offset point</span>
<span class="source-line-no">624</span><span id="line-624">     */</span>
<span class="source-line-no">625</span><span id="line-625">    protected static POINT2 GetOffsetPointDouble(POINT2 startLinePoint,</span>
<span class="source-line-no">626</span><span id="line-626">            POINT2 endLinePoint,</span>
<span class="source-line-no">627</span><span id="line-627">            long nOffset) {</span>
<span class="source-line-no">628</span><span id="line-628">        POINT2 tempLinePoint = new POINT2(startLinePoint);</span>
<span class="source-line-no">629</span><span id="line-629">        try {</span>
<span class="source-line-no">630</span><span id="line-630">            //declarations</span>
<span class="source-line-no">631</span><span id="line-631">            double dx = endLinePoint.x - startLinePoint.x,</span>
<span class="source-line-no">632</span><span id="line-632">                    dy = endLinePoint.y - startLinePoint.y,</span>
<span class="source-line-no">633</span><span id="line-633">                    dOffset = (double) nOffset,</span>
<span class="source-line-no">634</span><span id="line-634">                    dHypotenuse = 0,</span>
<span class="source-line-no">635</span><span id="line-635">                    dAngle = 0;</span>
<span class="source-line-no">636</span><span id="line-636"></span>
<span class="source-line-no">637</span><span id="line-637">            //end declarations</span>
<span class="source-line-no">638</span><span id="line-638">            if (dx == 0) {</span>
<span class="source-line-no">639</span><span id="line-639">                if (dy &gt; 0) {</span>
<span class="source-line-no">640</span><span id="line-640">                    tempLinePoint.x = endLinePoint.x;</span>
<span class="source-line-no">641</span><span id="line-641">                    tempLinePoint.y = endLinePoint.y + dOffset;</span>
<span class="source-line-no">642</span><span id="line-642">                } else {</span>
<span class="source-line-no">643</span><span id="line-643">                    tempLinePoint.x = endLinePoint.x;</span>
<span class="source-line-no">644</span><span id="line-644">                    tempLinePoint.y = endLinePoint.y - dOffset;</span>
<span class="source-line-no">645</span><span id="line-645">                }</span>
<span class="source-line-no">646</span><span id="line-646">                return tempLinePoint;</span>
<span class="source-line-no">647</span><span id="line-647">            }</span>
<span class="source-line-no">648</span><span id="line-648">            if (dy == 0) {</span>
<span class="source-line-no">649</span><span id="line-649">                if (dx &gt; 0) {</span>
<span class="source-line-no">650</span><span id="line-650">                    tempLinePoint.x = endLinePoint.x + dOffset;</span>
<span class="source-line-no">651</span><span id="line-651">                    tempLinePoint.y = endLinePoint.y;</span>
<span class="source-line-no">652</span><span id="line-652">                } else {</span>
<span class="source-line-no">653</span><span id="line-653">                    tempLinePoint.x = endLinePoint.x - dOffset;</span>
<span class="source-line-no">654</span><span id="line-654">                    tempLinePoint.y = endLinePoint.y;</span>
<span class="source-line-no">655</span><span id="line-655">                }</span>
<span class="source-line-no">656</span><span id="line-656">                return tempLinePoint;</span>
<span class="source-line-no">657</span><span id="line-657">            }</span>
<span class="source-line-no">658</span><span id="line-658"></span>
<span class="source-line-no">659</span><span id="line-659">            if (dy == 0) {</span>
<span class="source-line-no">660</span><span id="line-660">                dAngle = 0;</span>
<span class="source-line-no">661</span><span id="line-661">            } else {</span>
<span class="source-line-no">662</span><span id="line-662">                dAngle = Math.atan(dx / dy) + Math.PI / 2;//1.570795;</span>
<span class="source-line-no">663</span><span id="line-663">            }</span>
<span class="source-line-no">664</span><span id="line-664">            dHypotenuse = (double) nOffset;</span>
<span class="source-line-no">665</span><span id="line-665">            if (endLinePoint.x &gt; startLinePoint.x) {</span>
<span class="source-line-no">666</span><span id="line-666">                tempLinePoint.x = endLinePoint.x + dHypotenuse * Math.abs(Math.cos(dAngle));</span>
<span class="source-line-no">667</span><span id="line-667">            } else {</span>
<span class="source-line-no">668</span><span id="line-668">                tempLinePoint.x = endLinePoint.x - dHypotenuse * Math.abs(Math.cos(dAngle));</span>
<span class="source-line-no">669</span><span id="line-669">            }</span>
<span class="source-line-no">670</span><span id="line-670">            if (endLinePoint.y &gt; startLinePoint.y) {</span>
<span class="source-line-no">671</span><span id="line-671">                tempLinePoint.y = endLinePoint.y + dHypotenuse * Math.abs(Math.sin(dAngle));</span>
<span class="source-line-no">672</span><span id="line-672">            } else {</span>
<span class="source-line-no">673</span><span id="line-673">                tempLinePoint.y = endLinePoint.y - dHypotenuse * Math.abs(Math.sin(dAngle));</span>
<span class="source-line-no">674</span><span id="line-674">            }</span>
<span class="source-line-no">675</span><span id="line-675"></span>
<span class="source-line-no">676</span><span id="line-676">        } catch (Exception exc) {</span>
<span class="source-line-no">677</span><span id="line-677">            ErrorLogger.LogException(_className, "GetOffsetPointDouble",</span>
<span class="source-line-no">678</span><span id="line-678">                    new RendererException("Failed inside GetOffsetPointDouble", exc));</span>
<span class="source-line-no">679</span><span id="line-679">        }</span>
<span class="source-line-no">680</span><span id="line-680">        return (tempLinePoint);</span>
<span class="source-line-no">681</span><span id="line-681">    }</span>
<span class="source-line-no">682</span><span id="line-682"></span>
<span class="source-line-no">683</span><span id="line-683">    /**</span>
<span class="source-line-no">684</span><span id="line-684">     * Used for DMAF</span>
<span class="source-line-no">685</span><span id="line-685">     *</span>
<span class="source-line-no">686</span><span id="line-686">     * @param pLinePoints the client points</span>
<span class="source-line-no">687</span><span id="line-687">     * @return ArrayList of X points</span>
<span class="source-line-no">688</span><span id="line-688">     */</span>
<span class="source-line-no">689</span><span id="line-689">    protected static ArrayList LineOfXPoints(TGLight tg, POINT2[] pLinePoints) {</span>
<span class="source-line-no">690</span><span id="line-690">        ArrayList xPoints = new ArrayList();</span>
<span class="source-line-no">691</span><span id="line-691">        try {</span>
<span class="source-line-no">692</span><span id="line-692">            int j = 0, k = 0;</span>
<span class="source-line-no">693</span><span id="line-693">            double dist = 0;</span>
<span class="source-line-no">694</span><span id="line-694">            int iterations = 0;</span>
<span class="source-line-no">695</span><span id="line-695">            POINT2 frontPt = null, backPt = null;</span>
<span class="source-line-no">696</span><span id="line-696">            POINT2 extendFrontAbove = null, extendFrontBelow = null;</span>
<span class="source-line-no">697</span><span id="line-697">            POINT2 extendBackAbove = null, extendBackBelow = null;</span>
<span class="source-line-no">698</span><span id="line-698">            POINT2 xPoint1 = null, xPoint2 = null;</span>
<span class="source-line-no">699</span><span id="line-699">            int n=pLinePoints.length;</span>
<span class="source-line-no">700</span><span id="line-700">            final double xSize = arraysupport.getScaledSize(5, tg.get_LineThickness());</span>
<span class="source-line-no">701</span><span id="line-701">            final double dIncrement = xSize * 4;</span>
<span class="source-line-no">702</span><span id="line-702">            //for (j = 0; j &lt; pLinePoints.length - 1; j++) </span>
<span class="source-line-no">703</span><span id="line-703">            for (j = 0; j &lt; n - 1; j++) </span>
<span class="source-line-no">704</span><span id="line-704">            {</span>
<span class="source-line-no">705</span><span id="line-705">                dist = CalcDistanceDouble(pLinePoints[j], pLinePoints[j + 1]);</span>
<span class="source-line-no">706</span><span id="line-706">                iterations = (int) ((dist - xSize) / dIncrement);</span>
<span class="source-line-no">707</span><span id="line-707">                if (dist - iterations * dIncrement &gt; dIncrement / 2) {</span>
<span class="source-line-no">708</span><span id="line-708">                    iterations += 1;</span>
<span class="source-line-no">709</span><span id="line-709">                }</span>
<span class="source-line-no">710</span><span id="line-710"></span>
<span class="source-line-no">711</span><span id="line-711">                for (k = 0; k &lt; iterations; k++) {</span>
<span class="source-line-no">712</span><span id="line-712">                    frontPt = ExtendAlongLineDouble(pLinePoints[j], pLinePoints[j + 1], k * dIncrement - xSize);</span>
<span class="source-line-no">713</span><span id="line-713">                    backPt = ExtendAlongLineDouble(pLinePoints[j], pLinePoints[j + 1], k * dIncrement + xSize);</span>
<span class="source-line-no">714</span><span id="line-714">                    extendFrontAbove = ExtendDirectedLine(pLinePoints[j], pLinePoints[j + 1], frontPt, 2, xSize);</span>
<span class="source-line-no">715</span><span id="line-715">                    extendFrontBelow = ExtendDirectedLine(pLinePoints[j], pLinePoints[j + 1], frontPt, 3, xSize);</span>
<span class="source-line-no">716</span><span id="line-716">                    extendBackAbove = ExtendDirectedLine(pLinePoints[j], pLinePoints[j + 1], backPt, 2, xSize);</span>
<span class="source-line-no">717</span><span id="line-717">                    extendBackBelow = ExtendDirectedLine(pLinePoints[j], pLinePoints[j + 1], backPt, 3, xSize);</span>
<span class="source-line-no">718</span><span id="line-718">                    xPoints.add(extendFrontAbove);</span>
<span class="source-line-no">719</span><span id="line-719">                    extendBackBelow.style = 5;</span>
<span class="source-line-no">720</span><span id="line-720">                    xPoints.add(extendBackBelow);</span>
<span class="source-line-no">721</span><span id="line-721">                    xPoints.add(extendBackAbove);</span>
<span class="source-line-no">722</span><span id="line-722">                    extendFrontBelow.style = 5;</span>
<span class="source-line-no">723</span><span id="line-723">                    xPoints.add(extendFrontBelow);</span>
<span class="source-line-no">724</span><span id="line-724">                }</span>
<span class="source-line-no">725</span><span id="line-725">            }</span>
<span class="source-line-no">726</span><span id="line-726">        } catch (Exception exc) {</span>
<span class="source-line-no">727</span><span id="line-727">            ErrorLogger.LogException(_className, "LineOfXPoints",</span>
<span class="source-line-no">728</span><span id="line-728">                    new RendererException("Failed inside LineOfXPoints", exc));</span>
<span class="source-line-no">729</span><span id="line-729">        }</span>
<span class="source-line-no">730</span><span id="line-730">        return xPoints;</span>
<span class="source-line-no">731</span><span id="line-731">    }</span>
<span class="source-line-no">732</span><span id="line-732"></span>
<span class="source-line-no">733</span><span id="line-733">    /**</span>
<span class="source-line-no">734</span><span id="line-734">     * Computes the distance in pixels of pt3 to the line from pt1 to pt2.</span>
<span class="source-line-no">735</span><span id="line-735">     *</span>
<span class="source-line-no">736</span><span id="line-736">     * @param pt1 first line point</span>
<span class="source-line-no">737</span><span id="line-737">     * @param pt2 last line point</span>
<span class="source-line-no">738</span><span id="line-738">     * @param pt3 point distance to compute</span>
<span class="source-line-no">739</span><span id="line-739">     * @return distance to pt3</span>
<span class="source-line-no">740</span><span id="line-740">     */</span>
<span class="source-line-no">741</span><span id="line-741">    public static double CalcDistanceToLineDouble(POINT2 pt1,</span>
<span class="source-line-no">742</span><span id="line-742">            POINT2 pt2,</span>
<span class="source-line-no">743</span><span id="line-743">            POINT2 pt3) {</span>
<span class="source-line-no">744</span><span id="line-744">        double dResult = 0;</span>
<span class="source-line-no">745</span><span id="line-745">        try {</span>
<span class="source-line-no">746</span><span id="line-746">            //declarations</span>
<span class="source-line-no">747</span><span id="line-747">            double m1 = 1, b = 0, b1 = 0;</span>
<span class="source-line-no">748</span><span id="line-748">            POINT2 ptIntersect = new POINT2(pt1);</span>
<span class="source-line-no">749</span><span id="line-749">            int bolVertical = 0;</span>
<span class="source-line-no">750</span><span id="line-750">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">751</span><span id="line-751">            //end declarations</span>
<span class="source-line-no">752</span><span id="line-752"></span>
<span class="source-line-no">753</span><span id="line-753">            bolVertical = CalcTrueSlopeDouble(pt1, pt2, m);</span>
<span class="source-line-no">754</span><span id="line-754"></span>
<span class="source-line-no">755</span><span id="line-755">            //get line y intercepts</span>
<span class="source-line-no">756</span><span id="line-756">            if (bolVertical != 0 &amp;&amp; m.value[0] != 0) {</span>
<span class="source-line-no">757</span><span id="line-757">                m1 = -1 / m.value[0];</span>
<span class="source-line-no">758</span><span id="line-758">                b = pt1.y - m.value[0] * pt1.x;</span>
<span class="source-line-no">759</span><span id="line-759">                b1 = pt3.y - m1 * pt3.x;</span>
<span class="source-line-no">760</span><span id="line-760">                ptIntersect = CalcTrueIntersectDouble2(m.value[0], b, m1, b1, 1, 1, ptIntersect.x, ptIntersect.y);</span>
<span class="source-line-no">761</span><span id="line-761">            }</span>
<span class="source-line-no">762</span><span id="line-762">            if (bolVertical != 0 &amp;&amp; m.value[0] == 0) //horizontal line</span>
<span class="source-line-no">763</span><span id="line-763">            {</span>
<span class="source-line-no">764</span><span id="line-764">                ptIntersect.y = pt1.y;</span>
<span class="source-line-no">765</span><span id="line-765">                ptIntersect.x = pt3.x;</span>
<span class="source-line-no">766</span><span id="line-766">            }</span>
<span class="source-line-no">767</span><span id="line-767">            if (bolVertical == 0) //vertical line</span>
<span class="source-line-no">768</span><span id="line-768">            {</span>
<span class="source-line-no">769</span><span id="line-769">                ptIntersect.y = pt3.y;</span>
<span class="source-line-no">770</span><span id="line-770">                ptIntersect.x = pt1.x;</span>
<span class="source-line-no">771</span><span id="line-771">            }</span>
<span class="source-line-no">772</span><span id="line-772"></span>
<span class="source-line-no">773</span><span id="line-773">            dResult = CalcDistanceDouble(pt3, ptIntersect);</span>
<span class="source-line-no">774</span><span id="line-774">        } catch (Exception exc) {</span>
<span class="source-line-no">775</span><span id="line-775">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">776</span><span id="line-776">            ErrorLogger.LogException(_className, "CaclDistanceToLineDouble",</span>
<span class="source-line-no">777</span><span id="line-777">                    new RendererException("Failed inside CalcDistanceToLineDouble", exc));</span>
<span class="source-line-no">778</span><span id="line-778">        }</span>
<span class="source-line-no">779</span><span id="line-779">        return dResult;</span>
<span class="source-line-no">780</span><span id="line-780">    }</span>
<span class="source-line-no">781</span><span id="line-781"></span>
<span class="source-line-no">782</span><span id="line-782">    /**</span>
<span class="source-line-no">783</span><span id="line-783">     * Calculates a point along a line. Returns the past point if the distance</span>
<span class="source-line-no">784</span><span id="line-784">     * is 0.</span>
<span class="source-line-no">785</span><span id="line-785">     *</span>
<span class="source-line-no">786</span><span id="line-786">     * @param pt1 first line point</span>
<span class="source-line-no">787</span><span id="line-787">     * @param pt2 last line point</span>
<span class="source-line-no">788</span><span id="line-788">     * @param dist extension distance in pixels from the beginning of the line</span>
<span class="source-line-no">789</span><span id="line-789">     *</span>
<span class="source-line-no">790</span><span id="line-790">     * @return the extension point</span>
<span class="source-line-no">791</span><span id="line-791">     */</span>
<span class="source-line-no">792</span><span id="line-792">    public static POINT2 ExtendLineDouble(POINT2 pt1,</span>
<span class="source-line-no">793</span><span id="line-793">            POINT2 pt2,</span>
<span class="source-line-no">794</span><span id="line-794">            double dist) {</span>
<span class="source-line-no">795</span><span id="line-795">        POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">796</span><span id="line-796">        try {</span>
<span class="source-line-no">797</span><span id="line-797">            double dOriginalDistance = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">798</span><span id="line-798">            if (dOriginalDistance == 0 || dist == 0) {</span>
<span class="source-line-no">799</span><span id="line-799">                return pt2;</span>
<span class="source-line-no">800</span><span id="line-800">            }</span>
<span class="source-line-no">801</span><span id="line-801"></span>
<span class="source-line-no">802</span><span id="line-802">            pt3.x = (dOriginalDistance + dist) / dOriginalDistance * (pt2.x - pt1.x) + pt1.x;</span>
<span class="source-line-no">803</span><span id="line-803">            pt3.y = (dOriginalDistance + dist) / dOriginalDistance * (pt2.y - pt1.y) + pt1.y;</span>
<span class="source-line-no">804</span><span id="line-804">        } catch (Exception exc) {</span>
<span class="source-line-no">805</span><span id="line-805">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">806</span><span id="line-806">            ErrorLogger.LogException(_className, "ExtendLineDouble",</span>
<span class="source-line-no">807</span><span id="line-807">                    new RendererException("Failed inside ExtendLineDouble", exc));</span>
<span class="source-line-no">808</span><span id="line-808">        }</span>
<span class="source-line-no">809</span><span id="line-809">        return pt3;</span>
<span class="source-line-no">810</span><span id="line-810">    }</span>
<span class="source-line-no">811</span><span id="line-811"></span>
<span class="source-line-no">812</span><span id="line-812">    /**</span>
<span class="source-line-no">813</span><span id="line-813">     * Extends a point along a line. If dist is 0 returns last point.</span>
<span class="source-line-no">814</span><span id="line-814">     *</span>
<span class="source-line-no">815</span><span id="line-815">     * @param pt1 first point on the line</span>
<span class="source-line-no">816</span><span id="line-816">     * @param pt2 last point on the line</span>
<span class="source-line-no">817</span><span id="line-817">     * @param dist the distance in pixels from pt1</span>
<span class="source-line-no">818</span><span id="line-818">     *</span>
<span class="source-line-no">819</span><span id="line-819">     * @return the extended point</span>
<span class="source-line-no">820</span><span id="line-820">     */</span>
<span class="source-line-no">821</span><span id="line-821">    public static POINT2 ExtendAlongLineDouble(POINT2 pt1, POINT2 pt2, double dist) {</span>
<span class="source-line-no">822</span><span id="line-822">        POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">823</span><span id="line-823">        try {</span>
<span class="source-line-no">824</span><span id="line-824">            double dOriginalDistance = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">825</span><span id="line-825">            if (dOriginalDistance == 0 || dist == 0) {</span>
<span class="source-line-no">826</span><span id="line-826">                return pt2;</span>
<span class="source-line-no">827</span><span id="line-827">            }</span>
<span class="source-line-no">828</span><span id="line-828"></span>
<span class="source-line-no">829</span><span id="line-829">            pt3.x = ((dist / dOriginalDistance) * (pt2.x - pt1.x) + pt1.x);</span>
<span class="source-line-no">830</span><span id="line-830">            pt3.y = ((dist / dOriginalDistance) * (pt2.y - pt1.y) + pt1.y);</span>
<span class="source-line-no">831</span><span id="line-831">        } catch (Exception exc) {</span>
<span class="source-line-no">832</span><span id="line-832">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">833</span><span id="line-833">            ErrorLogger.LogException(_className, "ExtendAlongLineDouble",</span>
<span class="source-line-no">834</span><span id="line-834">                    new RendererException("Failed inside ExtendAlongLineDouble", exc));</span>
<span class="source-line-no">835</span><span id="line-835">        }</span>
<span class="source-line-no">836</span><span id="line-836">        return pt3;</span>
<span class="source-line-no">837</span><span id="line-837">    }</span>
<span class="source-line-no">838</span><span id="line-838"></span>
<span class="source-line-no">839</span><span id="line-839">    public static POINT2 ExtendAlongLineDouble2(POINT2 pt1, POINT2 pt2, double dist) {</span>
<span class="source-line-no">840</span><span id="line-840">        POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">841</span><span id="line-841">        try {</span>
<span class="source-line-no">842</span><span id="line-842">            double dOriginalDistance = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">843</span><span id="line-843">            if (dOriginalDistance == 0 || dist == 0) {</span>
<span class="source-line-no">844</span><span id="line-844">                return pt1;</span>
<span class="source-line-no">845</span><span id="line-845">            }</span>
<span class="source-line-no">846</span><span id="line-846"></span>
<span class="source-line-no">847</span><span id="line-847">            pt3.x = (dist / dOriginalDistance * (pt2.x - pt1.x) + pt1.x);</span>
<span class="source-line-no">848</span><span id="line-848">            pt3.y = (dist / dOriginalDistance * (pt2.y - pt1.y) + pt1.y);</span>
<span class="source-line-no">849</span><span id="line-849">        } catch (Exception exc) {</span>
<span class="source-line-no">850</span><span id="line-850">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">851</span><span id="line-851">            ErrorLogger.LogException(_className, "ExtendAlongLineDouble2",</span>
<span class="source-line-no">852</span><span id="line-852">                    new RendererException("Failed inside ExtendAlongLineDouble2", exc));</span>
<span class="source-line-no">853</span><span id="line-853">        }</span>
<span class="source-line-no">854</span><span id="line-854">        return pt3;</span>
<span class="source-line-no">855</span><span id="line-855">    }</span>
<span class="source-line-no">856</span><span id="line-856"></span>
<span class="source-line-no">857</span><span id="line-857">    public static Point2D ExtendAlongLineDouble2(Point2D pt1, Point2D pt2, double dist) {</span>
<span class="source-line-no">858</span><span id="line-858">        try {</span>
<span class="source-line-no">859</span><span id="line-859">            double dOriginalDistance = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">860</span><span id="line-860">            if (dOriginalDistance == 0 || dist == 0) {</span>
<span class="source-line-no">861</span><span id="line-861">                return new Point2D.Double(pt1.getX(), pt1.getY());</span>
<span class="source-line-no">862</span><span id="line-862">            }</span>
<span class="source-line-no">863</span><span id="line-863"></span>
<span class="source-line-no">864</span><span id="line-864">            double x = (dist / dOriginalDistance * (pt2.getX() - pt1.getX()) + pt1.getX());</span>
<span class="source-line-no">865</span><span id="line-865">            double y = (dist / dOriginalDistance * (pt2.getY() - pt1.getY()) + pt1.getY());</span>
<span class="source-line-no">866</span><span id="line-866">            return new Point2D.Double(x, y);</span>
<span class="source-line-no">867</span><span id="line-867">        } catch (Exception exc) {</span>
<span class="source-line-no">868</span><span id="line-868">            ErrorLogger.LogException(_className, "ExtendAlongLineDouble2",</span>
<span class="source-line-no">869</span><span id="line-869">                    new RendererException("Failed inside ExtendAlongLineDouble2", exc));</span>
<span class="source-line-no">870</span><span id="line-870">        }</span>
<span class="source-line-no">871</span><span id="line-871">        return new Point2D.Double(0, 0);</span>
<span class="source-line-no">872</span><span id="line-872">    }</span>
<span class="source-line-no">873</span><span id="line-873"></span>
<span class="source-line-no">874</span><span id="line-874">    public static POINT2 ExtendAlongLineDouble(POINT2 pt1, POINT2 pt2, double dist, int styl) {</span>
<span class="source-line-no">875</span><span id="line-875">        POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">876</span><span id="line-876">        try {</span>
<span class="source-line-no">877</span><span id="line-877">            double dOriginalDistance = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">878</span><span id="line-878">            if (dOriginalDistance == 0 || dist == 0) {</span>
<span class="source-line-no">879</span><span id="line-879">                return pt2;</span>
<span class="source-line-no">880</span><span id="line-880">            }</span>
<span class="source-line-no">881</span><span id="line-881"></span>
<span class="source-line-no">882</span><span id="line-882">            pt3.x = (dist / dOriginalDistance * (pt2.x - pt1.x) + pt1.x);</span>
<span class="source-line-no">883</span><span id="line-883">            pt3.y = (dist / dOriginalDistance * (pt2.y - pt1.y) + pt1.y);</span>
<span class="source-line-no">884</span><span id="line-884">            pt3.style = styl;</span>
<span class="source-line-no">885</span><span id="line-885">        } catch (Exception exc) {</span>
<span class="source-line-no">886</span><span id="line-886">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">887</span><span id="line-887">            ErrorLogger.LogException(_className, "ExtendAlongLineDouble",</span>
<span class="source-line-no">888</span><span id="line-888">                    new RendererException("Failed inside ExtendAlongLineDouble", exc));</span>
<span class="source-line-no">889</span><span id="line-889">        }</span>
<span class="source-line-no">890</span><span id="line-890">        return pt3;</span>
<span class="source-line-no">891</span><span id="line-891">    }</span>
<span class="source-line-no">892</span><span id="line-892"></span>
<span class="source-line-no">893</span><span id="line-893">    /**</span>
<span class="source-line-no">894</span><span id="line-894">     * Extends a point above a line</span>
<span class="source-line-no">895</span><span id="line-895">     *</span>
<span class="source-line-no">896</span><span id="line-896">     * @param pt1 first line point</span>
<span class="source-line-no">897</span><span id="line-897">     * @param pt2 last line point</span>
<span class="source-line-no">898</span><span id="line-898">     * @param pt3 point at which to extend</span>
<span class="source-line-no">899</span><span id="line-899">     * @param d distance in pixels to extend above the line</span>
<span class="source-line-no">900</span><span id="line-900">     * @param X OUT - extended point x value</span>
<span class="source-line-no">901</span><span id="line-901">     * @param Y OUT - extended point y value</span>
<span class="source-line-no">902</span><span id="line-902">     * @param direction direction to extend the line</span>
<span class="source-line-no">903</span><span id="line-903">     *</span>
<span class="source-line-no">904</span><span id="line-904">     * @return 1 if successful, else return 0</span>
<span class="source-line-no">905</span><span id="line-905">     */</span>
<span class="source-line-no">906</span><span id="line-906">    protected static int ExtendLineAbove(POINT2 pt1,</span>
<span class="source-line-no">907</span><span id="line-907">            POINT2 pt2,</span>
<span class="source-line-no">908</span><span id="line-908">            POINT2 pt3,</span>
<span class="source-line-no">909</span><span id="line-909">            double d,</span>
<span class="source-line-no">910</span><span id="line-910">            ref&lt;double[]&gt; X,</span>
<span class="source-line-no">911</span><span id="line-911">            ref&lt;double[]&gt; Y,</span>
<span class="source-line-no">912</span><span id="line-912">            int direction) {</span>
<span class="source-line-no">913</span><span id="line-913">        try {</span>
<span class="source-line-no">914</span><span id="line-914">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">915</span><span id="line-915">            double dx = 0, dy = 0;</span>
<span class="source-line-no">916</span><span id="line-916">            int bolVertical = 0;</span>
<span class="source-line-no">917</span><span id="line-917"></span>
<span class="source-line-no">918</span><span id="line-918">            X.value = new double[1];</span>
<span class="source-line-no">919</span><span id="line-919">            Y.value = new double[1];</span>
<span class="source-line-no">920</span><span id="line-920"></span>
<span class="source-line-no">921</span><span id="line-921">            bolVertical = CalcTrueSlopeDouble(pt1, pt2, m);</span>
<span class="source-line-no">922</span><span id="line-922">            if (bolVertical == 0) {</span>
<span class="source-line-no">923</span><span id="line-923">                return 0;       //cannot extend above a vertical line</span>
<span class="source-line-no">924</span><span id="line-924">            }</span>
<span class="source-line-no">925</span><span id="line-925">            if (m.value[0] == 0) {</span>
<span class="source-line-no">926</span><span id="line-926">                X.value[0] = pt3.x;</span>
<span class="source-line-no">927</span><span id="line-927">                if (direction == 0) //extend above the line</span>
<span class="source-line-no">928</span><span id="line-928">                {</span>
<span class="source-line-no">929</span><span id="line-929">                    Y.value[0] = pt3.y - Math.abs(d);</span>
<span class="source-line-no">930</span><span id="line-930">                } else //extend below the line</span>
<span class="source-line-no">931</span><span id="line-931">                {</span>
<span class="source-line-no">932</span><span id="line-932">                    Y.value[0] = pt3.y + Math.abs(d);</span>
<span class="source-line-no">933</span><span id="line-933">                }</span>
<span class="source-line-no">934</span><span id="line-934">                return 1;</span>
<span class="source-line-no">935</span><span id="line-935">            }</span>
<span class="source-line-no">936</span><span id="line-936">            //the line is neither vertical nor horizontal</span>
<span class="source-line-no">937</span><span id="line-937">            //else function would already have returned</span>
<span class="source-line-no">938</span><span id="line-938">            if (direction == 0) //extend above the line</span>
<span class="source-line-no">939</span><span id="line-939">            {</span>
<span class="source-line-no">940</span><span id="line-940">                dy = -Math.abs(d / (m.value[0] * Math.sqrt(1 + 1 / (m.value[0] * m.value[0]))));</span>
<span class="source-line-no">941</span><span id="line-941">            } else //extend below the line</span>
<span class="source-line-no">942</span><span id="line-942">            {</span>
<span class="source-line-no">943</span><span id="line-943">                dy = Math.abs(d / (m.value[0] * Math.sqrt(1 + 1 / (m.value[0] * m.value[0]))));</span>
<span class="source-line-no">944</span><span id="line-944">            }</span>
<span class="source-line-no">945</span><span id="line-945"></span>
<span class="source-line-no">946</span><span id="line-946">            dx = -m.value[0] * dy;</span>
<span class="source-line-no">947</span><span id="line-947">            X.value[0] = pt3.x + dx;</span>
<span class="source-line-no">948</span><span id="line-948">            Y.value[0] = pt3.y + dy;</span>
<span class="source-line-no">949</span><span id="line-949">        } catch (Exception exc) {</span>
<span class="source-line-no">950</span><span id="line-950">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">951</span><span id="line-951">            ErrorLogger.LogException(_className, "ExtendLineAbove",</span>
<span class="source-line-no">952</span><span id="line-952">                    new RendererException("Failed inside ExtendLineAbove", exc));</span>
<span class="source-line-no">953</span><span id="line-953">        }</span>
<span class="source-line-no">954</span><span id="line-954">        return 1;</span>
<span class="source-line-no">955</span><span id="line-955">    }</span>
<span class="source-line-no">956</span><span id="line-956"></span>
<span class="source-line-no">957</span><span id="line-957">    /**</span>
<span class="source-line-no">958</span><span id="line-958">     * Extends a point to the left of a line</span>
<span class="source-line-no">959</span><span id="line-959">     *</span>
<span class="source-line-no">960</span><span id="line-960">     * @param pt1 first line point</span>
<span class="source-line-no">961</span><span id="line-961">     * @param pt2 last line point</span>
<span class="source-line-no">962</span><span id="line-962">     * @param pt3 point at which to extend</span>
<span class="source-line-no">963</span><span id="line-963">     * @param d distance in pixels to extend above the line</span>
<span class="source-line-no">964</span><span id="line-964">     * @param X OUT - extended point x value</span>
<span class="source-line-no">965</span><span id="line-965">     * @param Y OUT - extended point y value</span>
<span class="source-line-no">966</span><span id="line-966">     * @param direction direction to extend the line</span>
<span class="source-line-no">967</span><span id="line-967">     *</span>
<span class="source-line-no">968</span><span id="line-968">     * @return 1 if successful, else return 0</span>
<span class="source-line-no">969</span><span id="line-969">     */</span>
<span class="source-line-no">970</span><span id="line-970">    protected static int ExtendLineLeft(POINT2 pt1,</span>
<span class="source-line-no">971</span><span id="line-971">            POINT2 pt2,</span>
<span class="source-line-no">972</span><span id="line-972">            POINT2 pt3,</span>
<span class="source-line-no">973</span><span id="line-973">            double d,</span>
<span class="source-line-no">974</span><span id="line-974">            ref&lt;double[]&gt; X,</span>
<span class="source-line-no">975</span><span id="line-975">            ref&lt;double[]&gt; Y,</span>
<span class="source-line-no">976</span><span id="line-976">            int direction) {</span>
<span class="source-line-no">977</span><span id="line-977">        try {</span>
<span class="source-line-no">978</span><span id="line-978">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">979</span><span id="line-979">            double dx = 0, dy = 0;</span>
<span class="source-line-no">980</span><span id="line-980">            int bolVertical = 0;</span>
<span class="source-line-no">981</span><span id="line-981"></span>
<span class="source-line-no">982</span><span id="line-982">            X.value = new double[1];</span>
<span class="source-line-no">983</span><span id="line-983">            Y.value = new double[1];</span>
<span class="source-line-no">984</span><span id="line-984"></span>
<span class="source-line-no">985</span><span id="line-985">            bolVertical = CalcTrueSlopeDouble(pt1, pt2, m);</span>
<span class="source-line-no">986</span><span id="line-986">            if (bolVertical != 0 &amp;&amp; m.value[0] == 0) {</span>
<span class="source-line-no">987</span><span id="line-987">                return 0;       //cannot left of horiz line</span>
<span class="source-line-no">988</span><span id="line-988">            }</span>
<span class="source-line-no">989</span><span id="line-989">            if (bolVertical == 0) //vertical line</span>
<span class="source-line-no">990</span><span id="line-990">            {</span>
<span class="source-line-no">991</span><span id="line-991">                Y.value[0] = pt3.y;</span>
<span class="source-line-no">992</span><span id="line-992">                if (direction == 0) //extend left of the line</span>
<span class="source-line-no">993</span><span id="line-993">                {</span>
<span class="source-line-no">994</span><span id="line-994">                    X.value[0] = pt3.x - Math.abs(d);</span>
<span class="source-line-no">995</span><span id="line-995">                } else //extend right of the line</span>
<span class="source-line-no">996</span><span id="line-996">                {</span>
<span class="source-line-no">997</span><span id="line-997">                    X.value[0] = pt3.x + Math.abs(d);</span>
<span class="source-line-no">998</span><span id="line-998">                }</span>
<span class="source-line-no">999</span><span id="line-999"></span>
<span class="source-line-no">1000</span><span id="line-1000">                return 1;</span>
<span class="source-line-no">1001</span><span id="line-1001">            }</span>
<span class="source-line-no">1002</span><span id="line-1002">            //the line is neither vertical nor horizontal</span>
<span class="source-line-no">1003</span><span id="line-1003">            //else function would already have returned</span>
<span class="source-line-no">1004</span><span id="line-1004">            if (direction == 0) //extend left of the line</span>
<span class="source-line-no">1005</span><span id="line-1005">            {</span>
<span class="source-line-no">1006</span><span id="line-1006">                dx = -Math.abs(d / Math.sqrt(1 + 1 / (m.value[0] * m.value[0])));</span>
<span class="source-line-no">1007</span><span id="line-1007">            } else //extend right of the line</span>
<span class="source-line-no">1008</span><span id="line-1008">            {</span>
<span class="source-line-no">1009</span><span id="line-1009">                dx = Math.abs(d / Math.sqrt(1 + 1 / (m.value[0] * m.value[0])));</span>
<span class="source-line-no">1010</span><span id="line-1010">            }</span>
<span class="source-line-no">1011</span><span id="line-1011"></span>
<span class="source-line-no">1012</span><span id="line-1012">            dy = -(1 / m.value[0]) * dx;</span>
<span class="source-line-no">1013</span><span id="line-1013"></span>
<span class="source-line-no">1014</span><span id="line-1014">            X.value[0] = pt3.x + dx;</span>
<span class="source-line-no">1015</span><span id="line-1015">            Y.value[0] = pt3.y + dy;</span>
<span class="source-line-no">1016</span><span id="line-1016">        } catch (Exception exc) {</span>
<span class="source-line-no">1017</span><span id="line-1017">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">1018</span><span id="line-1018">            ErrorLogger.LogException(_className, "ExtendLineLeft",</span>
<span class="source-line-no">1019</span><span id="line-1019">                    new RendererException("Failed inside ExtendLineLeft", exc));</span>
<span class="source-line-no">1020</span><span id="line-1020">        }</span>
<span class="source-line-no">1021</span><span id="line-1021">        return 1;</span>
<span class="source-line-no">1022</span><span id="line-1022">    }</span>
<span class="source-line-no">1023</span><span id="line-1023"></span>
<span class="source-line-no">1024</span><span id="line-1024">    /**</span>
<span class="source-line-no">1025</span><span id="line-1025">     * Calculates the direction of a point relative to a line</span>
<span class="source-line-no">1026</span><span id="line-1026">     *</span>
<span class="source-line-no">1027</span><span id="line-1027">     * @param pt0 first point fo the line</span>
<span class="source-line-no">1028</span><span id="line-1028">     * @param pt1 last point of the line</span>
<span class="source-line-no">1029</span><span id="line-1029">     * @param pt2 relative point</span>
<span class="source-line-no">1030</span><span id="line-1030">     * @deprecated</span>
<span class="source-line-no">1031</span><span id="line-1031">     * @return 0 if left, 1 if right, 2 if above, 3 if below</span>
<span class="source-line-no">1032</span><span id="line-1032">     */</span>
<span class="source-line-no">1033</span><span id="line-1033">    protected static int CalcDirectionFromLine(POINT2 pt0,</span>
<span class="source-line-no">1034</span><span id="line-1034">            POINT2 pt1,</span>
<span class="source-line-no">1035</span><span id="line-1035">            POINT2 pt2) {</span>
<span class="source-line-no">1036</span><span id="line-1036">        int result = -1;</span>
<span class="source-line-no">1037</span><span id="line-1037">        try {</span>
<span class="source-line-no">1038</span><span id="line-1038">            double m2 = 0, b1 = 0, b2 = 0;</span>
<span class="source-line-no">1039</span><span id="line-1039">            ref&lt;double[]&gt; m1 = new ref();</span>
<span class="source-line-no">1040</span><span id="line-1040">            POINT2 ptIntersect = new POINT2();</span>
<span class="source-line-no">1041</span><span id="line-1041">            //int direction=-1;</span>
<span class="source-line-no">1042</span><span id="line-1042">            //handle vertical line</span>
<span class="source-line-no">1043</span><span id="line-1043">            if (pt0.x == pt1.x) {</span>
<span class="source-line-no">1044</span><span id="line-1044">                if (pt2.x &lt; pt0.x) {</span>
<span class="source-line-no">1045</span><span id="line-1045">                    return 0;</span>
<span class="source-line-no">1046</span><span id="line-1046">                } else {</span>
<span class="source-line-no">1047</span><span id="line-1047">                    return 1;</span>
<span class="source-line-no">1048</span><span id="line-1048">                }</span>
<span class="source-line-no">1049</span><span id="line-1049">            }</span>
<span class="source-line-no">1050</span><span id="line-1050">            //handle horizontal line so that we do not have slope = 0.</span>
<span class="source-line-no">1051</span><span id="line-1051">            if (pt0.y == pt1.y) {</span>
<span class="source-line-no">1052</span><span id="line-1052">                if (pt2.y &lt; pt0.y) {</span>
<span class="source-line-no">1053</span><span id="line-1053">                    return 2;</span>
<span class="source-line-no">1054</span><span id="line-1054">                } else {</span>
<span class="source-line-no">1055</span><span id="line-1055">                    return 3;</span>
<span class="source-line-no">1056</span><span id="line-1056">                }</span>
<span class="source-line-no">1057</span><span id="line-1057">            }</span>
<span class="source-line-no">1058</span><span id="line-1058">            CalcTrueSlopeDouble(pt0, pt1, m1);</span>
<span class="source-line-no">1059</span><span id="line-1059">            m2 = -1 / m1.value[0];      //slope for the perpendicular line from the line to pt2</span>
<span class="source-line-no">1060</span><span id="line-1060">            //b=mx-y line equation for line</span>
<span class="source-line-no">1061</span><span id="line-1061">            b1 = pt0.y - m1.value[0] * pt0.x;</span>
<span class="source-line-no">1062</span><span id="line-1062">            //b=mx-y line equation for perpendicular line which contains pt2</span>
<span class="source-line-no">1063</span><span id="line-1063">            b2 = pt2.y - m2 * pt2.x;</span>
<span class="source-line-no">1064</span><span id="line-1064">            ptIntersect = CalcTrueIntersectDouble2(m1.value[0], b1, m2, b2, 1, 1, 0, 0);</span>
<span class="source-line-no">1065</span><span id="line-1065">            //compare the intersection point with pt2 to get the direction,</span>
<span class="source-line-no">1066</span><span id="line-1066">            //i.e. the direction from the line is the same as the direction</span>
<span class="source-line-no">1067</span><span id="line-1067">            //from the interseciton point.</span>
<span class="source-line-no">1068</span><span id="line-1068">            if (m1.value[0] &gt; 1) //line is steep, use left/right</span>
<span class="source-line-no">1069</span><span id="line-1069">            {</span>
<span class="source-line-no">1070</span><span id="line-1070">                if (pt2.x &lt; ptIntersect.x) {</span>
<span class="source-line-no">1071</span><span id="line-1071">                    return 0;</span>
<span class="source-line-no">1072</span><span id="line-1072">                } else {</span>
<span class="source-line-no">1073</span><span id="line-1073">                    return 1;</span>
<span class="source-line-no">1074</span><span id="line-1074">                }</span>
<span class="source-line-no">1075</span><span id="line-1075">            } else //line is not steep, use above/below</span>
<span class="source-line-no">1076</span><span id="line-1076">            {</span>
<span class="source-line-no">1077</span><span id="line-1077">                if (pt2.y &lt; ptIntersect.y) {</span>
<span class="source-line-no">1078</span><span id="line-1078">                    return 2;</span>
<span class="source-line-no">1079</span><span id="line-1079">                } else {</span>
<span class="source-line-no">1080</span><span id="line-1080">                    return 3;</span>
<span class="source-line-no">1081</span><span id="line-1081">                }</span>
<span class="source-line-no">1082</span><span id="line-1082">            }</span>
<span class="source-line-no">1083</span><span id="line-1083">            //should not reach this point</span>
<span class="source-line-no">1084</span><span id="line-1084">            //return direction;</span>
<span class="source-line-no">1085</span><span id="line-1085">        } catch (Exception e) {</span>
<span class="source-line-no">1086</span><span id="line-1086">            System.out.println(e.getMessage());</span>
<span class="source-line-no">1087</span><span id="line-1087">        }</span>
<span class="source-line-no">1088</span><span id="line-1088">        return result;</span>
<span class="source-line-no">1089</span><span id="line-1089">    }</span>
<span class="source-line-no">1090</span><span id="line-1090"></span>
<span class="source-line-no">1091</span><span id="line-1091">    /**</span>
<span class="source-line-no">1092</span><span id="line-1092">     * Returns a point extended perpendicularly from a line at a given direction</span>
<span class="source-line-no">1093</span><span id="line-1093">     *</span>
<span class="source-line-no">1094</span><span id="line-1094">     * @param pt1 first line point</span>
<span class="source-line-no">1095</span><span id="line-1095">     * @param pt2 last line point</span>
<span class="source-line-no">1096</span><span id="line-1096">     * @param pt0 on line from which to extend</span>
<span class="source-line-no">1097</span><span id="line-1097">     * @param direction the direction to extend: above, below, left, right</span>
<span class="source-line-no">1098</span><span id="line-1098">     * @param d the length to extend in pixels</span>
<span class="source-line-no">1099</span><span id="line-1099">     *</span>
<span class="source-line-no">1100</span><span id="line-1100">     */</span>
<span class="source-line-no">1101</span><span id="line-1101">    public static POINT2 ExtendDirectedLine(POINT2 pt1,</span>
<span class="source-line-no">1102</span><span id="line-1102">            POINT2 pt2,</span>
<span class="source-line-no">1103</span><span id="line-1103">            POINT2 pt0,</span>
<span class="source-line-no">1104</span><span id="line-1104">            int direction,</span>
<span class="source-line-no">1105</span><span id="line-1105">            double d) {</span>
<span class="source-line-no">1106</span><span id="line-1106">        POINT2 ptResult = new POINT2();</span>
<span class="source-line-no">1107</span><span id="line-1107">        try {</span>
<span class="source-line-no">1108</span><span id="line-1108">            ref&lt;double[]&gt; X = new ref(), Y = new ref();</span>
<span class="source-line-no">1109</span><span id="line-1109">            ptResult = new POINT2(pt0);</span>
<span class="source-line-no">1110</span><span id="line-1110">            switch (direction) {</span>
<span class="source-line-no">1111</span><span id="line-1111">                case 0: //extend left</span>
<span class="source-line-no">1112</span><span id="line-1112">                    ExtendLineLeft(pt1, pt2, pt0, d, X, Y, 0);</span>
<span class="source-line-no">1113</span><span id="line-1113">                    break;</span>
<span class="source-line-no">1114</span><span id="line-1114">                case 1: //extend right</span>
<span class="source-line-no">1115</span><span id="line-1115">                    ExtendLineLeft(pt1, pt2, pt0, d, X, Y, 1);</span>
<span class="source-line-no">1116</span><span id="line-1116">                    break;</span>
<span class="source-line-no">1117</span><span id="line-1117">                case 2: //extend above</span>
<span class="source-line-no">1118</span><span id="line-1118">                    ExtendLineAbove(pt1, pt2, pt0, d, X, Y, 0);</span>
<span class="source-line-no">1119</span><span id="line-1119">                    break;</span>
<span class="source-line-no">1120</span><span id="line-1120">                case 3: //extend below</span>
<span class="source-line-no">1121</span><span id="line-1121">                    ExtendLineAbove(pt1, pt2, pt0, d, X, Y, 1);</span>
<span class="source-line-no">1122</span><span id="line-1122">                    break;</span>
<span class="source-line-no">1123</span><span id="line-1123">                default:</span>
<span class="source-line-no">1124</span><span id="line-1124">                    break;</span>
<span class="source-line-no">1125</span><span id="line-1125">            }</span>
<span class="source-line-no">1126</span><span id="line-1126">            ptResult.x = X.value[0];</span>
<span class="source-line-no">1127</span><span id="line-1127">            ptResult.y = Y.value[0];</span>
<span class="source-line-no">1128</span><span id="line-1128">        } catch (Exception exc) {</span>
<span class="source-line-no">1129</span><span id="line-1129">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">1130</span><span id="line-1130">            ErrorLogger.LogException(_className, "ExtendDirectedLine",</span>
<span class="source-line-no">1131</span><span id="line-1131">                    new RendererException("Failed inside ExtendDirectedLine", exc));</span>
<span class="source-line-no">1132</span><span id="line-1132">        }</span>
<span class="source-line-no">1133</span><span id="line-1133">        return ptResult;</span>
<span class="source-line-no">1134</span><span id="line-1134">    }</span>
<span class="source-line-no">1135</span><span id="line-1135"></span>
<span class="source-line-no">1136</span><span id="line-1136">    /**</span>
<span class="source-line-no">1137</span><span id="line-1137">     * @deprecated Returns a point extended perpendicularly from a line at a</span>
<span class="source-line-no">1138</span><span id="line-1138">     * given direction same as original function except it accounts for vertical</span>
<span class="source-line-no">1139</span><span id="line-1139">     * lines and negative d values</span>
<span class="source-line-no">1140</span><span id="line-1140">     *</span>
<span class="source-line-no">1141</span><span id="line-1141">     * @param pt1 first line point</span>
<span class="source-line-no">1142</span><span id="line-1142">     * @param pt2 last line point</span>
<span class="source-line-no">1143</span><span id="line-1143">     * @param pt0 on line from which to extend</span>
<span class="source-line-no">1144</span><span id="line-1144">     * @param direction the direction to extend: above, below, left, right</span>
<span class="source-line-no">1145</span><span id="line-1145">     * @param d the length to extend in pixels</span>
<span class="source-line-no">1146</span><span id="line-1146">     *</span>
<span class="source-line-no">1147</span><span id="line-1147">     */</span>
<span class="source-line-no">1148</span><span id="line-1148">    public static POINT2 ExtendDirectedLineText(POINT2 pt1,</span>
<span class="source-line-no">1149</span><span id="line-1149">            POINT2 pt2,</span>
<span class="source-line-no">1150</span><span id="line-1150">            POINT2 pt0,</span>
<span class="source-line-no">1151</span><span id="line-1151">            int direction,</span>
<span class="source-line-no">1152</span><span id="line-1152">            double d) {</span>
<span class="source-line-no">1153</span><span id="line-1153">        POINT2 ptResult = new POINT2();</span>
<span class="source-line-no">1154</span><span id="line-1154">        try {</span>
<span class="source-line-no">1155</span><span id="line-1155">            ref&lt;double[]&gt; X = new ref(), Y = new ref();</span>
<span class="source-line-no">1156</span><span id="line-1156">            ptResult = new POINT2(pt0);</span>
<span class="source-line-no">1157</span><span id="line-1157">            if (d &lt; 0) {</span>
<span class="source-line-no">1158</span><span id="line-1158">                switch (direction) {</span>
<span class="source-line-no">1159</span><span id="line-1159">                    case 0:</span>
<span class="source-line-no">1160</span><span id="line-1160">                        direction = extend_right;</span>
<span class="source-line-no">1161</span><span id="line-1161">                        break;</span>
<span class="source-line-no">1162</span><span id="line-1162">                    case 1:</span>
<span class="source-line-no">1163</span><span id="line-1163">                        direction = extend_left;</span>
<span class="source-line-no">1164</span><span id="line-1164">                        break;</span>
<span class="source-line-no">1165</span><span id="line-1165">                    case 2:</span>
<span class="source-line-no">1166</span><span id="line-1166">                        direction = extend_below;</span>
<span class="source-line-no">1167</span><span id="line-1167">                        break;</span>
<span class="source-line-no">1168</span><span id="line-1168">                    case 3:</span>
<span class="source-line-no">1169</span><span id="line-1169">                        direction = extend_above;</span>
<span class="source-line-no">1170</span><span id="line-1170">                        break;</span>
<span class="source-line-no">1171</span><span id="line-1171">                    default:</span>
<span class="source-line-no">1172</span><span id="line-1172">                        break;</span>
<span class="source-line-no">1173</span><span id="line-1173">                }</span>
<span class="source-line-no">1174</span><span id="line-1174">                d = Math.abs(d);</span>
<span class="source-line-no">1175</span><span id="line-1175">            }</span>
<span class="source-line-no">1176</span><span id="line-1176">            if (pt1.y == pt2.y)//horizontal segment</span>
<span class="source-line-no">1177</span><span id="line-1177">            {</span>
<span class="source-line-no">1178</span><span id="line-1178">                switch (direction) {</span>
<span class="source-line-no">1179</span><span id="line-1179">                    case 0://left means above</span>
<span class="source-line-no">1180</span><span id="line-1180">                        direction = extend_above;</span>
<span class="source-line-no">1181</span><span id="line-1181">                        break;</span>
<span class="source-line-no">1182</span><span id="line-1182">                    case 1://right means below</span>
<span class="source-line-no">1183</span><span id="line-1183">                        direction = extend_below;</span>
<span class="source-line-no">1184</span><span id="line-1184">                        break;</span>
<span class="source-line-no">1185</span><span id="line-1185">                    default:</span>
<span class="source-line-no">1186</span><span id="line-1186">                        break;</span>
<span class="source-line-no">1187</span><span id="line-1187">                }</span>
<span class="source-line-no">1188</span><span id="line-1188">            }</span>
<span class="source-line-no">1189</span><span id="line-1189">            if (pt1.x == pt2.x)//vertical segment</span>
<span class="source-line-no">1190</span><span id="line-1190">            {</span>
<span class="source-line-no">1191</span><span id="line-1191">                switch (direction) {</span>
<span class="source-line-no">1192</span><span id="line-1192">                    case 2://above means left</span>
<span class="source-line-no">1193</span><span id="line-1193">                        direction = extend_left;</span>
<span class="source-line-no">1194</span><span id="line-1194">                        break;</span>
<span class="source-line-no">1195</span><span id="line-1195">                    case 3://below means right</span>
<span class="source-line-no">1196</span><span id="line-1196">                        direction = extend_right;</span>
<span class="source-line-no">1197</span><span id="line-1197">                        break;</span>
<span class="source-line-no">1198</span><span id="line-1198">                    default:</span>
<span class="source-line-no">1199</span><span id="line-1199">                        break;</span>
<span class="source-line-no">1200</span><span id="line-1200">                }</span>
<span class="source-line-no">1201</span><span id="line-1201">            }</span>
<span class="source-line-no">1202</span><span id="line-1202">            switch (direction) {</span>
<span class="source-line-no">1203</span><span id="line-1203">                case 0: //extend left</span>
<span class="source-line-no">1204</span><span id="line-1204">                    ExtendLineLeft(pt1, pt2, pt0, d, X, Y, 0);</span>
<span class="source-line-no">1205</span><span id="line-1205">                    break;</span>
<span class="source-line-no">1206</span><span id="line-1206">                case 1: //extend right</span>
<span class="source-line-no">1207</span><span id="line-1207">                    ExtendLineLeft(pt1, pt2, pt0, d, X, Y, 1);</span>
<span class="source-line-no">1208</span><span id="line-1208">                    break;</span>
<span class="source-line-no">1209</span><span id="line-1209">                case 2: //extend above</span>
<span class="source-line-no">1210</span><span id="line-1210">                    ExtendLineAbove(pt1, pt2, pt0, d, X, Y, 0);</span>
<span class="source-line-no">1211</span><span id="line-1211">                    break;</span>
<span class="source-line-no">1212</span><span id="line-1212">                case 3: //extend below</span>
<span class="source-line-no">1213</span><span id="line-1213">                    ExtendLineAbove(pt1, pt2, pt0, d, X, Y, 1);</span>
<span class="source-line-no">1214</span><span id="line-1214">                    break;</span>
<span class="source-line-no">1215</span><span id="line-1215">                default:</span>
<span class="source-line-no">1216</span><span id="line-1216">                    break;</span>
<span class="source-line-no">1217</span><span id="line-1217">            }</span>
<span class="source-line-no">1218</span><span id="line-1218">            ptResult.x = X.value[0];</span>
<span class="source-line-no">1219</span><span id="line-1219">            ptResult.y = Y.value[0];</span>
<span class="source-line-no">1220</span><span id="line-1220">        } catch (Exception exc) {</span>
<span class="source-line-no">1221</span><span id="line-1221">            //System.out.println(e.getMessage());</span>
<span class="source-line-no">1222</span><span id="line-1222">            ErrorLogger.LogException(_className, "ExtendDirectedLine",</span>
<span class="source-line-no">1223</span><span id="line-1223">                    new RendererException("Failed inside ExtendDirectedLine", exc));</span>
<span class="source-line-no">1224</span><span id="line-1224">        }</span>
<span class="source-line-no">1225</span><span id="line-1225">        return ptResult;</span>
<span class="source-line-no">1226</span><span id="line-1226">    }</span>
<span class="source-line-no">1227</span><span id="line-1227"></span>
<span class="source-line-no">1228</span><span id="line-1228">    /**</span>
<span class="source-line-no">1229</span><span id="line-1229">     * Returns a point extended perpendicularly from a line at a given direction</span>
<span class="source-line-no">1230</span><span id="line-1230">     *</span>
<span class="source-line-no">1231</span><span id="line-1231">     * @param pt1 first line point</span>
<span class="source-line-no">1232</span><span id="line-1232">     * @param pt2 last line point</span>
<span class="source-line-no">1233</span><span id="line-1233">     * @param pt0 on line from which to extend</span>
<span class="source-line-no">1234</span><span id="line-1234">     * @param direction the direction to extend: above, below, left, right</span>
<span class="source-line-no">1235</span><span id="line-1235">     * @param d the length to extend in pixels</span>
<span class="source-line-no">1236</span><span id="line-1236">     * @param style the style to assign the return point</span>
<span class="source-line-no">1237</span><span id="line-1237">     *</span>
<span class="source-line-no">1238</span><span id="line-1238">     */</span>
<span class="source-line-no">1239</span><span id="line-1239">    public static POINT2 ExtendDirectedLine(POINT2 pt1,</span>
<span class="source-line-no">1240</span><span id="line-1240">            POINT2 pt2,</span>
<span class="source-line-no">1241</span><span id="line-1241">            POINT2 pt0,</span>
<span class="source-line-no">1242</span><span id="line-1242">            int direction,</span>
<span class="source-line-no">1243</span><span id="line-1243">            double d,</span>
<span class="source-line-no">1244</span><span id="line-1244">            int style) {</span>
<span class="source-line-no">1245</span><span id="line-1245">        POINT2 ptResult = new POINT2(pt0);</span>
<span class="source-line-no">1246</span><span id="line-1246">        try {</span>
<span class="source-line-no">1247</span><span id="line-1247">            ref&lt;double[]&gt; X = new ref(), Y = new ref();</span>
<span class="source-line-no">1248</span><span id="line-1248">            //int bolResult=0;</span>
<span class="source-line-no">1249</span><span id="line-1249">            //handle parallel, perpendicular cases</span>
<span class="source-line-no">1250</span><span id="line-1250">            if (pt1.x == pt2.x) {</span>
<span class="source-line-no">1251</span><span id="line-1251">                if (direction == 2) {</span>
<span class="source-line-no">1252</span><span id="line-1252">                    direction = 0;</span>
<span class="source-line-no">1253</span><span id="line-1253">                }</span>
<span class="source-line-no">1254</span><span id="line-1254">                if (direction == 3) {</span>
<span class="source-line-no">1255</span><span id="line-1255">                    direction = 1;</span>
<span class="source-line-no">1256</span><span id="line-1256">                }</span>
<span class="source-line-no">1257</span><span id="line-1257">            }</span>
<span class="source-line-no">1258</span><span id="line-1258">            if (pt1.y == pt2.y) {</span>
<span class="source-line-no">1259</span><span id="line-1259">                if (direction == 0) {</span>
<span class="source-line-no">1260</span><span id="line-1260">                    direction = 2;</span>
<span class="source-line-no">1261</span><span id="line-1261">                }</span>
<span class="source-line-no">1262</span><span id="line-1262">                if (direction == 1) {</span>
<span class="source-line-no">1263</span><span id="line-1263">                    direction = 3;</span>
<span class="source-line-no">1264</span><span id="line-1264">                }</span>
<span class="source-line-no">1265</span><span id="line-1265">            }</span>
<span class="source-line-no">1266</span><span id="line-1266">            switch (direction) {</span>
<span class="source-line-no">1267</span><span id="line-1267">                case 0: //extend left</span>
<span class="source-line-no">1268</span><span id="line-1268">                    ExtendLineLeft(pt1, pt2, pt0, d, X, Y, 0);</span>
<span class="source-line-no">1269</span><span id="line-1269">                    break;</span>
<span class="source-line-no">1270</span><span id="line-1270">                case 1: //extend right</span>
<span class="source-line-no">1271</span><span id="line-1271">                    ExtendLineLeft(pt1, pt2, pt0, d, X, Y, 1);</span>
<span class="source-line-no">1272</span><span id="line-1272">                    break;</span>
<span class="source-line-no">1273</span><span id="line-1273">                case 2: //extend above</span>
<span class="source-line-no">1274</span><span id="line-1274">                    ExtendLineAbove(pt1, pt2, pt0, d, X, Y, 0);</span>
<span class="source-line-no">1275</span><span id="line-1275">                    break;</span>
<span class="source-line-no">1276</span><span id="line-1276">                case 3: //extend below</span>
<span class="source-line-no">1277</span><span id="line-1277">                    ExtendLineAbove(pt1, pt2, pt0, d, X, Y, 1);</span>
<span class="source-line-no">1278</span><span id="line-1278">                    break;</span>
<span class="source-line-no">1279</span><span id="line-1279">            }</span>
<span class="source-line-no">1280</span><span id="line-1280">            ptResult.x = X.value[0];</span>
<span class="source-line-no">1281</span><span id="line-1281">            ptResult.y = Y.value[0];</span>
<span class="source-line-no">1282</span><span id="line-1282">            ptResult.style = style;</span>
<span class="source-line-no">1283</span><span id="line-1283">        } catch (Exception exc) {</span>
<span class="source-line-no">1284</span><span id="line-1284">            ErrorLogger.LogException(_className, "ExtendDirectedLine",</span>
<span class="source-line-no">1285</span><span id="line-1285">                    new RendererException("Failed inside ExtendDirectedLine", exc));</span>
<span class="source-line-no">1286</span><span id="line-1286">        }</span>
<span class="source-line-no">1287</span><span id="line-1287">        return ptResult;</span>
<span class="source-line-no">1288</span><span id="line-1288">    }</span>
<span class="source-line-no">1289</span><span id="line-1289"></span>
<span class="source-line-no">1290</span><span id="line-1290">    /**</span>
<span class="source-line-no">1291</span><span id="line-1291">     * Calculates a point along a line</span>
<span class="source-line-no">1292</span><span id="line-1292">     *</span>
<span class="source-line-no">1293</span><span id="line-1293">     * @param pt1 first line point</span>
<span class="source-line-no">1294</span><span id="line-1294">     * @param pt2 last line point</span>
<span class="source-line-no">1295</span><span id="line-1295">     * @param dist extension distance in pixels from the beginning of the line</span>
<span class="source-line-no">1296</span><span id="line-1296">     * @param styl the line style to assign the point</span>
<span class="source-line-no">1297</span><span id="line-1297">     *</span>
<span class="source-line-no">1298</span><span id="line-1298">     * @return the extension point</span>
<span class="source-line-no">1299</span><span id="line-1299">     */</span>
<span class="source-line-no">1300</span><span id="line-1300">    protected static POINT2 ExtendLine2Double(POINT2 pt1,</span>
<span class="source-line-no">1301</span><span id="line-1301">            POINT2 pt2,</span>
<span class="source-line-no">1302</span><span id="line-1302">            double dist,</span>
<span class="source-line-no">1303</span><span id="line-1303">            int styl) {</span>
<span class="source-line-no">1304</span><span id="line-1304">        POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">1305</span><span id="line-1305">        try {</span>
<span class="source-line-no">1306</span><span id="line-1306">            double dOriginalDistance = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">1307</span><span id="line-1307"></span>
<span class="source-line-no">1308</span><span id="line-1308">            pt3.x = pt2.x;</span>
<span class="source-line-no">1309</span><span id="line-1309">            pt3.y = pt2.y;</span>
<span class="source-line-no">1310</span><span id="line-1310">            if (dOriginalDistance &gt; 0) {</span>
<span class="source-line-no">1311</span><span id="line-1311">                pt3.x = ((dOriginalDistance + dist) / dOriginalDistance * (pt2.x - pt1.x) + pt1.x);</span>
<span class="source-line-no">1312</span><span id="line-1312">                pt3.y = ((dOriginalDistance + dist) / dOriginalDistance * (pt2.y - pt1.y) + pt1.y);</span>
<span class="source-line-no">1313</span><span id="line-1313">                pt3.style = styl;</span>
<span class="source-line-no">1314</span><span id="line-1314">            }</span>
<span class="source-line-no">1315</span><span id="line-1315">        } catch (Exception exc) {</span>
<span class="source-line-no">1316</span><span id="line-1316">            ErrorLogger.LogException(_className, "ExtendLine2Double",</span>
<span class="source-line-no">1317</span><span id="line-1317">                    new RendererException("Failed inside ExtendLine2Double", exc));</span>
<span class="source-line-no">1318</span><span id="line-1318">        }</span>
<span class="source-line-no">1319</span><span id="line-1319">        return pt3;</span>
<span class="source-line-no">1320</span><span id="line-1320">    }</span>
<span class="source-line-no">1321</span><span id="line-1321"></span>
<span class="source-line-no">1322</span><span id="line-1322">    /**</span>
<span class="source-line-no">1323</span><span id="line-1323">     * Extends a point at an angle from a line.</span>
<span class="source-line-no">1324</span><span id="line-1324">     *</span>
<span class="source-line-no">1325</span><span id="line-1325">     * @param pt0 the first line point</span>
<span class="source-line-no">1326</span><span id="line-1326">     * @param pt1 the second line point</span>
<span class="source-line-no">1327</span><span id="line-1327">     * @param pt2 point on line from which to extend</span>
<span class="source-line-no">1328</span><span id="line-1328">     * @param alpha angle of extension in degrees</span>
<span class="source-line-no">1329</span><span id="line-1329">     * @param d the distance in pixels to extend</span>
<span class="source-line-no">1330</span><span id="line-1330">     *</span>
<span class="source-line-no">1331</span><span id="line-1331">     * @return the extension point</span>
<span class="source-line-no">1332</span><span id="line-1332">     */</span>
<span class="source-line-no">1333</span><span id="line-1333">    public static POINT2 ExtendAngledLine(POINT2 pt0,</span>
<span class="source-line-no">1334</span><span id="line-1334">            POINT2 pt1,</span>
<span class="source-line-no">1335</span><span id="line-1335">            POINT2 pt2,</span>
<span class="source-line-no">1336</span><span id="line-1336">            double alpha,</span>
<span class="source-line-no">1337</span><span id="line-1337">            double d) {</span>
<span class="source-line-no">1338</span><span id="line-1338">        POINT2 pt = new POINT2();</span>
<span class="source-line-no">1339</span><span id="line-1339">        try {</span>
<span class="source-line-no">1340</span><span id="line-1340">            //first get the angle psi between pt0 and pt1</span>
<span class="source-line-no">1341</span><span id="line-1341">            double psi = Math.atan((pt1.y - pt0.y) / (pt1.x - pt0.x));</span>
<span class="source-line-no">1342</span><span id="line-1342">            //convert alpha to radians</span>
<span class="source-line-no">1343</span><span id="line-1343">            double alpha1 = Math.PI * alpha / 180;</span>
<span class="source-line-no">1344</span><span id="line-1344"></span>
<span class="source-line-no">1345</span><span id="line-1345">            //theta is the angle of extension from the x axis</span>
<span class="source-line-no">1346</span><span id="line-1346">            double theta = psi + alpha1;</span>
<span class="source-line-no">1347</span><span id="line-1347">            //dx is the x extension from pt2</span>
<span class="source-line-no">1348</span><span id="line-1348">            double dx = d * Math.cos(theta);</span>
<span class="source-line-no">1349</span><span id="line-1349">            //dy is the y extension form pt2</span>
<span class="source-line-no">1350</span><span id="line-1350">            double dy = d * Math.sin(theta);</span>
<span class="source-line-no">1351</span><span id="line-1351">            pt.x = pt2.x + dx;</span>
<span class="source-line-no">1352</span><span id="line-1352">            pt.y = pt2.y + dy;</span>
<span class="source-line-no">1353</span><span id="line-1353">        } catch (Exception exc) {</span>
<span class="source-line-no">1354</span><span id="line-1354">            ErrorLogger.LogException(_className, "ExtendAngledLine",</span>
<span class="source-line-no">1355</span><span id="line-1355">                    new RendererException("Failed inside ExtendAngledLine", exc));</span>
<span class="source-line-no">1356</span><span id="line-1356">        }</span>
<span class="source-line-no">1357</span><span id="line-1357">        return pt;</span>
<span class="source-line-no">1358</span><span id="line-1358">    }</span>
<span class="source-line-no">1359</span><span id="line-1359"></span>
<span class="source-line-no">1360</span><span id="line-1360">    /**</span>
<span class="source-line-no">1361</span><span id="line-1361">     * Returns an integer indicating the quadrant for the direction of the line</span>
<span class="source-line-no">1362</span><span id="line-1362">     * from pt1 to pt2</span>
<span class="source-line-no">1363</span><span id="line-1363">     *</span>
<span class="source-line-no">1364</span><span id="line-1364">     * @param pt1 first line point</span>
<span class="source-line-no">1365</span><span id="line-1365">     * @param pt2 second line point</span>
<span class="source-line-no">1366</span><span id="line-1366">     *</span>
<span class="source-line-no">1367</span><span id="line-1367">     * @return the quadrant</span>
<span class="source-line-no">1368</span><span id="line-1368">     */</span>
<span class="source-line-no">1369</span><span id="line-1369">    public static int GetQuadrantDouble(POINT2 pt1,</span>
<span class="source-line-no">1370</span><span id="line-1370">            POINT2 pt2) {</span>
<span class="source-line-no">1371</span><span id="line-1371">        int nQuadrant = 1;</span>
<span class="source-line-no">1372</span><span id="line-1372">        try {</span>
<span class="source-line-no">1373</span><span id="line-1373">            if (pt2.x &gt;= pt1.x &amp;&amp; pt2.y &lt;= pt1.y) {</span>
<span class="source-line-no">1374</span><span id="line-1374">                nQuadrant = 1;</span>
<span class="source-line-no">1375</span><span id="line-1375">            }</span>
<span class="source-line-no">1376</span><span id="line-1376">            if (pt2.x &gt;= pt1.x &amp;&amp; pt2.y &gt;= pt1.y) {</span>
<span class="source-line-no">1377</span><span id="line-1377">                nQuadrant = 2;</span>
<span class="source-line-no">1378</span><span id="line-1378">            }</span>
<span class="source-line-no">1379</span><span id="line-1379">            if (pt2.x &lt;= pt1.x &amp;&amp; pt2.y &gt;= pt1.y) {</span>
<span class="source-line-no">1380</span><span id="line-1380">                nQuadrant = 3;</span>
<span class="source-line-no">1381</span><span id="line-1381">            }</span>
<span class="source-line-no">1382</span><span id="line-1382">            if (pt2.x &lt;= pt1.x &amp;&amp; pt2.y &lt;= pt1.y) {</span>
<span class="source-line-no">1383</span><span id="line-1383">                nQuadrant = 4;</span>
<span class="source-line-no">1384</span><span id="line-1384">            }</span>
<span class="source-line-no">1385</span><span id="line-1385"></span>
<span class="source-line-no">1386</span><span id="line-1386">        } catch (Exception exc) {</span>
<span class="source-line-no">1387</span><span id="line-1387">            ErrorLogger.LogException(_className, "GetQuadrantDouble",</span>
<span class="source-line-no">1388</span><span id="line-1388">                    new RendererException("Failed inside GetQuadrantDouble", exc));</span>
<span class="source-line-no">1389</span><span id="line-1389">        }</span>
<span class="source-line-no">1390</span><span id="line-1390">        return nQuadrant;</span>
<span class="source-line-no">1391</span><span id="line-1391">    }</span>
<span class="source-line-no">1392</span><span id="line-1392"></span>
<span class="source-line-no">1393</span><span id="line-1393">    public static int GetQuadrantDouble(double x1, double y1,</span>
<span class="source-line-no">1394</span><span id="line-1394">            double x2, double y2) {</span>
<span class="source-line-no">1395</span><span id="line-1395">        int nQuadrant = 1;</span>
<span class="source-line-no">1396</span><span id="line-1396">        try {</span>
<span class="source-line-no">1397</span><span id="line-1397">//            if(pt2.x&gt;=pt1.x &amp;&amp; pt2.y&lt;=pt1.y)</span>
<span class="source-line-no">1398</span><span id="line-1398">//                    nQuadrant=1;</span>
<span class="source-line-no">1399</span><span id="line-1399">//            if(pt2.x&gt;=pt1.x &amp;&amp; pt2.y&gt;=pt1.y)</span>
<span class="source-line-no">1400</span><span id="line-1400">//                    nQuadrant=2;</span>
<span class="source-line-no">1401</span><span id="line-1401">//            if(pt2.x&lt;=pt1.x &amp;&amp; pt2.y&gt;=pt1.y)</span>
<span class="source-line-no">1402</span><span id="line-1402">//                    nQuadrant=3;</span>
<span class="source-line-no">1403</span><span id="line-1403">//            if(pt2.x&lt;=pt1.x &amp;&amp; pt2.y&lt;=pt1.y)</span>
<span class="source-line-no">1404</span><span id="line-1404">//                    nQuadrant=4;</span>
<span class="source-line-no">1405</span><span id="line-1405"></span>
<span class="source-line-no">1406</span><span id="line-1406">            if (x2 &gt;= x1 &amp;&amp; y2 &lt;= y1) {</span>
<span class="source-line-no">1407</span><span id="line-1407">                nQuadrant = 1;</span>
<span class="source-line-no">1408</span><span id="line-1408">            }</span>
<span class="source-line-no">1409</span><span id="line-1409">            if (x2 &gt;= x1 &amp;&amp; y2 &gt;= y1) {</span>
<span class="source-line-no">1410</span><span id="line-1410">                nQuadrant = 2;</span>
<span class="source-line-no">1411</span><span id="line-1411">            }</span>
<span class="source-line-no">1412</span><span id="line-1412">            if (x2 &lt;= x1 &amp;&amp; y2 &gt;= y1) {</span>
<span class="source-line-no">1413</span><span id="line-1413">                nQuadrant = 3;</span>
<span class="source-line-no">1414</span><span id="line-1414">            }</span>
<span class="source-line-no">1415</span><span id="line-1415">            if (x2 &lt;= x1 &amp;&amp; y2 &lt;= y1) {</span>
<span class="source-line-no">1416</span><span id="line-1416">                nQuadrant = 4;</span>
<span class="source-line-no">1417</span><span id="line-1417">            }</span>
<span class="source-line-no">1418</span><span id="line-1418">        } catch (Exception exc) {</span>
<span class="source-line-no">1419</span><span id="line-1419">            ErrorLogger.LogException(_className, "GetQuadrantDouble",</span>
<span class="source-line-no">1420</span><span id="line-1420">                    new RendererException("Failed inside GetQuadrantDouble", exc));</span>
<span class="source-line-no">1421</span><span id="line-1421">        }</span>
<span class="source-line-no">1422</span><span id="line-1422">        return nQuadrant;</span>
<span class="source-line-no">1423</span><span id="line-1423">    }</span>
<span class="source-line-no">1424</span><span id="line-1424"></span>
<span class="source-line-no">1425</span><span id="line-1425">    /**</span>
<span class="source-line-no">1426</span><span id="line-1426">     * Returns the smallest x and y pixel values from an array of points</span>
<span class="source-line-no">1427</span><span id="line-1427">     *</span>
<span class="source-line-no">1428</span><span id="line-1428">     * @param ptsSeize array of points from which to find minimum vaules</span>
<span class="source-line-no">1429</span><span id="line-1429">     * @param vblCounter the number of points to test in the array</span>
<span class="source-line-no">1430</span><span id="line-1430">     * @param x OUT - an object with a member to hold the xminimum</span>
<span class="source-line-no">1431</span><span id="line-1431">     * @param y OUT - an object with a member to hold the y minimum value</span>
<span class="source-line-no">1432</span><span id="line-1432">     *</span>
<span class="source-line-no">1433</span><span id="line-1433">     */</span>
<span class="source-line-no">1434</span><span id="line-1434">    public static void GetPixelsMin(POINT2[] ptsSeize,</span>
<span class="source-line-no">1435</span><span id="line-1435">            int vblCounter,</span>
<span class="source-line-no">1436</span><span id="line-1436">            ref&lt;double[]&gt; x,</span>
<span class="source-line-no">1437</span><span id="line-1437">            ref&lt;double[]&gt; y) {</span>
<span class="source-line-no">1438</span><span id="line-1438">        try {</span>
<span class="source-line-no">1439</span><span id="line-1439">            double xmin = Double.POSITIVE_INFINITY;</span>
<span class="source-line-no">1440</span><span id="line-1440">            double ymin = Double.POSITIVE_INFINITY;</span>
<span class="source-line-no">1441</span><span id="line-1441">            int j = 0;</span>
<span class="source-line-no">1442</span><span id="line-1442"></span>
<span class="source-line-no">1443</span><span id="line-1443">            for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">1444</span><span id="line-1444">                if (ptsSeize[j].x &lt; xmin) {</span>
<span class="source-line-no">1445</span><span id="line-1445">                    xmin = ptsSeize[j].x;</span>
<span class="source-line-no">1446</span><span id="line-1446">                }</span>
<span class="source-line-no">1447</span><span id="line-1447">                if (ptsSeize[j].y &lt; ymin) {</span>
<span class="source-line-no">1448</span><span id="line-1448">                    ymin = ptsSeize[j].y;</span>
<span class="source-line-no">1449</span><span id="line-1449">                }</span>
<span class="source-line-no">1450</span><span id="line-1450">            }</span>
<span class="source-line-no">1451</span><span id="line-1451">            x.value = new double[1];</span>
<span class="source-line-no">1452</span><span id="line-1452">            y.value = new double[1];</span>
<span class="source-line-no">1453</span><span id="line-1453">            x.value[0] = xmin;</span>
<span class="source-line-no">1454</span><span id="line-1454">            y.value[0] = ymin;</span>
<span class="source-line-no">1455</span><span id="line-1455">        } catch (Exception exc) {</span>
<span class="source-line-no">1456</span><span id="line-1456">            ErrorLogger.LogException(_className, "GetPixelsMin",</span>
<span class="source-line-no">1457</span><span id="line-1457">                    new RendererException("Failed inside GetPixelsMin", exc));</span>
<span class="source-line-no">1458</span><span id="line-1458">        }</span>
<span class="source-line-no">1459</span><span id="line-1459">    }</span>
<span class="source-line-no">1460</span><span id="line-1460"></span>
<span class="source-line-no">1461</span><span id="line-1461">    /**</span>
<span class="source-line-no">1462</span><span id="line-1462">     * Returns the largest x and y pixel values from an array of points</span>
<span class="source-line-no">1463</span><span id="line-1463">     *</span>
<span class="source-line-no">1464</span><span id="line-1464">     * @param ptsSeize array of points from which to find maximum values</span>
<span class="source-line-no">1465</span><span id="line-1465">     * @param vblCounter the number of points to test in the array</span>
<span class="source-line-no">1466</span><span id="line-1466">     * @param x OUT - an object with a member to hold the x maximum value</span>
<span class="source-line-no">1467</span><span id="line-1467">     * @param y OUT - an object with a member to hold the y maximum value</span>
<span class="source-line-no">1468</span><span id="line-1468">     *</span>
<span class="source-line-no">1469</span><span id="line-1469">     */</span>
<span class="source-line-no">1470</span><span id="line-1470">    public static void GetPixelsMax(POINT2[] ptsSeize,</span>
<span class="source-line-no">1471</span><span id="line-1471">                                    int vblCounter,</span>
<span class="source-line-no">1472</span><span id="line-1472">                                    ref&lt;double[]&gt; x,</span>
<span class="source-line-no">1473</span><span id="line-1473">                                    ref&lt;double[]&gt; y) {</span>
<span class="source-line-no">1474</span><span id="line-1474">        try {</span>
<span class="source-line-no">1475</span><span id="line-1475">            double xmax = Double.NEGATIVE_INFINITY;</span>
<span class="source-line-no">1476</span><span id="line-1476">            double ymax = Double.NEGATIVE_INFINITY;</span>
<span class="source-line-no">1477</span><span id="line-1477">            int j = 0;</span>
<span class="source-line-no">1478</span><span id="line-1478"></span>
<span class="source-line-no">1479</span><span id="line-1479">            for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">1480</span><span id="line-1480">                if (ptsSeize[j].x &gt; xmax) {</span>
<span class="source-line-no">1481</span><span id="line-1481">                    xmax = ptsSeize[j].x;</span>
<span class="source-line-no">1482</span><span id="line-1482">                }</span>
<span class="source-line-no">1483</span><span id="line-1483">                if (ptsSeize[j].y &gt; ymax) {</span>
<span class="source-line-no">1484</span><span id="line-1484">                    ymax = ptsSeize[j].y;</span>
<span class="source-line-no">1485</span><span id="line-1485">                }</span>
<span class="source-line-no">1486</span><span id="line-1486">            }</span>
<span class="source-line-no">1487</span><span id="line-1487">            x.value = new double[1];</span>
<span class="source-line-no">1488</span><span id="line-1488">            y.value = new double[1];</span>
<span class="source-line-no">1489</span><span id="line-1489">            x.value[0] = xmax;</span>
<span class="source-line-no">1490</span><span id="line-1490">            y.value[0] = ymax;</span>
<span class="source-line-no">1491</span><span id="line-1491">        } catch (Exception exc) {</span>
<span class="source-line-no">1492</span><span id="line-1492">            ErrorLogger.LogException(_className, "GetPixelsMax",</span>
<span class="source-line-no">1493</span><span id="line-1493">                    new RendererException("Failed inside GetPixelsMax", exc));</span>
<span class="source-line-no">1494</span><span id="line-1494">        }</span>
<span class="source-line-no">1495</span><span id="line-1495">    }</span>
<span class="source-line-no">1496</span><span id="line-1496"></span>
<span class="source-line-no">1497</span><span id="line-1497">    /**</span>
<span class="source-line-no">1498</span><span id="line-1498">     * Returns center point for a clockwise arc to connect pts 1 and 2. Also</span>
<span class="source-line-no">1499</span><span id="line-1499">     * returns an extended point on the line between pt1 and the new center</span>
<span class="source-line-no">1500</span><span id="line-1500">     * Caller passes a POINT1 array of size 2 for ptsSeize, passes pt1 and pt2</span>
<span class="source-line-no">1501</span><span id="line-1501">     * in ptsSeize Returns the radius of the 90 degree arc between C (arc</span>
<span class="source-line-no">1502</span><span id="line-1502">     * center) and pt1</span>
<span class="source-line-no">1503</span><span id="line-1503">     *</span>
<span class="source-line-no">1504</span><span id="line-1504">     * @param ptsSeize OUT - two point array also used for the returned two</span>
<span class="source-line-no">1505</span><span id="line-1505">     * points</span>
<span class="source-line-no">1506</span><span id="line-1506">     *</span>
<span class="source-line-no">1507</span><span id="line-1507">     * @return the radius</span>
<span class="source-line-no">1508</span><span id="line-1508">     */</span>
<span class="source-line-no">1509</span><span id="line-1509">    protected static double CalcClockwiseCenterDouble(POINT2[] ptsSeize) {</span>
<span class="source-line-no">1510</span><span id="line-1510">        double dRadius = 0;</span>
<span class="source-line-no">1511</span><span id="line-1511">        try {</span>
<span class="source-line-no">1512</span><span id="line-1512">            //declarations</span>
<span class="source-line-no">1513</span><span id="line-1513">            POINT2 pt1 = new POINT2(ptsSeize[0]);</span>
<span class="source-line-no">1514</span><span id="line-1514">            POINT2 pt2 = new POINT2(ptsSeize[1]);</span>
<span class="source-line-no">1515</span><span id="line-1515">            POINT2 C = new POINT2(pt1), midPt = new POINT2(pt1);        //the center to calculate</span>
<span class="source-line-no">1516</span><span id="line-1516">            POINT2 E = new POINT2(pt1); //the extended point to calculate</span>
<span class="source-line-no">1517</span><span id="line-1517">            POINT2 ptYIntercept = new POINT2(pt1);</span>
<span class="source-line-no">1518</span><span id="line-1518">            int nQuadrant = 1;</span>
<span class="source-line-no">1519</span><span id="line-1519">            double b = 0, b1 = 0, b2 = 0, dLength = 0;</span>
<span class="source-line-no">1520</span><span id="line-1520">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">1521</span><span id="line-1521">            int bolVertical = 0;</span>
<span class="source-line-no">1522</span><span id="line-1522">            ref&lt;double[]&gt; offsetX = new ref(), offsetY = new ref();</span>
<span class="source-line-no">1523</span><span id="line-1523">            POINT2[] ptsTemp = new POINT2[2];</span>
<span class="source-line-no">1524</span><span id="line-1524">            //end declarations</span>
<span class="source-line-no">1525</span><span id="line-1525"></span>
<span class="source-line-no">1526</span><span id="line-1526">            //must offset the points if necessary because there will be calculations</span>
<span class="source-line-no">1527</span><span id="line-1527">            //extending from the Y Intercept</span>
<span class="source-line-no">1528</span><span id="line-1528">            ptsTemp[0] = new POINT2(pt1);</span>
<span class="source-line-no">1529</span><span id="line-1529">            ptsTemp[1] = new POINT2(pt2);</span>
<span class="source-line-no">1530</span><span id="line-1530">            GetPixelsMin(ptsTemp, 2, offsetX, offsetY);</span>
<span class="source-line-no">1531</span><span id="line-1531">            if (offsetX.value[0] &lt; 0) {</span>
<span class="source-line-no">1532</span><span id="line-1532">                offsetX.value[0] = offsetX.value[0] - 100;</span>
<span class="source-line-no">1533</span><span id="line-1533">            } else {</span>
<span class="source-line-no">1534</span><span id="line-1534">                offsetX.value[0] = 0;</span>
<span class="source-line-no">1535</span><span id="line-1535">            }</span>
<span class="source-line-no">1536</span><span id="line-1536">            //end section</span>
<span class="source-line-no">1537</span><span id="line-1537"></span>
<span class="source-line-no">1538</span><span id="line-1538">            midPt.x = (pt1.x + pt2.x) / 2;</span>
<span class="source-line-no">1539</span><span id="line-1539">            midPt.y = (pt1.y + pt2.y) / 2;</span>
<span class="source-line-no">1540</span><span id="line-1540">            dLength = CalcDistanceDouble(pt1, pt2);</span>
<span class="source-line-no">1541</span><span id="line-1541">            dRadius = dLength / Math.sqrt(2);</span>
<span class="source-line-no">1542</span><span id="line-1542">            nQuadrant = GetQuadrantDouble(pt1, pt2);</span>
<span class="source-line-no">1543</span><span id="line-1543"></span>
<span class="source-line-no">1544</span><span id="line-1544">            bolVertical = CalcTrueSlopeDouble(pt1, pt2, m);</span>
<span class="source-line-no">1545</span><span id="line-1545">            if (bolVertical != 0 &amp;&amp; m.value[0] != 0) //line not vertical or horizontal</span>
<span class="source-line-no">1546</span><span id="line-1546">            {</span>
<span class="source-line-no">1547</span><span id="line-1547">                b = pt1.y - m.value[0] * pt1.x;</span>
<span class="source-line-no">1548</span><span id="line-1548">                //y intercept of line perpendicular to midPt of pt,p2</span>
<span class="source-line-no">1549</span><span id="line-1549">                b1 = midPt.y + (1 / m.value[0]) * midPt.x;</span>
<span class="source-line-no">1550</span><span id="line-1550">                //we want to shift the Y axis to the left by offsetX</span>
<span class="source-line-no">1551</span><span id="line-1551">                //so we get the new Y intercept at x=offsetX</span>
<span class="source-line-no">1552</span><span id="line-1552">                b2 = (-1 / m.value[0]) * offsetX.value[0] + b1;</span>
<span class="source-line-no">1553</span><span id="line-1553">                ptYIntercept.x = offsetX.value[0];</span>
<span class="source-line-no">1554</span><span id="line-1554">                ptYIntercept.y = b2;</span>
<span class="source-line-no">1555</span><span id="line-1555">                switch (nQuadrant) {</span>
<span class="source-line-no">1556</span><span id="line-1556">                    case 1:</span>
<span class="source-line-no">1557</span><span id="line-1557">                    case 4:</span>
<span class="source-line-no">1558</span><span id="line-1558">                        C = ExtendLineDouble(ptYIntercept, midPt, dLength / 2);</span>
<span class="source-line-no">1559</span><span id="line-1559">                        break;</span>
<span class="source-line-no">1560</span><span id="line-1560">                    case 2:</span>
<span class="source-line-no">1561</span><span id="line-1561">                    case 3:</span>
<span class="source-line-no">1562</span><span id="line-1562">                        C = ExtendLineDouble(ptYIntercept, midPt, -dLength / 2);</span>
<span class="source-line-no">1563</span><span id="line-1563">                        break;</span>
<span class="source-line-no">1564</span><span id="line-1564">                    default:</span>
<span class="source-line-no">1565</span><span id="line-1565">                        break;</span>
<span class="source-line-no">1566</span><span id="line-1566">                }</span>
<span class="source-line-no">1567</span><span id="line-1567">            }</span>
<span class="source-line-no">1568</span><span id="line-1568">            if (bolVertical != 0 &amp;&amp; m.value[0] == 0) //horizontal line</span>
<span class="source-line-no">1569</span><span id="line-1569">            {</span>
<span class="source-line-no">1570</span><span id="line-1570">                C.x = midPt.x;</span>
<span class="source-line-no">1571</span><span id="line-1571">                if (pt1.x &lt; pt2.x) {</span>
<span class="source-line-no">1572</span><span id="line-1572">                    C.y = midPt.y + dLength / 2;</span>
<span class="source-line-no">1573</span><span id="line-1573">                } else {</span>
<span class="source-line-no">1574</span><span id="line-1574">                    C.y = midPt.y - dLength / 2;</span>
<span class="source-line-no">1575</span><span id="line-1575">                }</span>
<span class="source-line-no">1576</span><span id="line-1576">            }</span>
<span class="source-line-no">1577</span><span id="line-1577">            if (bolVertical == 0) //vertical line</span>
<span class="source-line-no">1578</span><span id="line-1578">            {</span>
<span class="source-line-no">1579</span><span id="line-1579">                ptYIntercept.x = offsetX.value[0];</span>
<span class="source-line-no">1580</span><span id="line-1580">                ptYIntercept.y = midPt.y;</span>
<span class="source-line-no">1581</span><span id="line-1581">                switch (nQuadrant) {</span>
<span class="source-line-no">1582</span><span id="line-1582">                    case 1:</span>
<span class="source-line-no">1583</span><span id="line-1583">                    case 4:</span>
<span class="source-line-no">1584</span><span id="line-1584">                        C = ExtendLineDouble(ptYIntercept, midPt, dLength / 2);</span>
<span class="source-line-no">1585</span><span id="line-1585">                        break;</span>
<span class="source-line-no">1586</span><span id="line-1586">                    case 2:</span>
<span class="source-line-no">1587</span><span id="line-1587">                    case 3:</span>
<span class="source-line-no">1588</span><span id="line-1588">                        C = ExtendLineDouble(ptYIntercept, midPt, -dLength / 2);</span>
<span class="source-line-no">1589</span><span id="line-1589">                        break;</span>
<span class="source-line-no">1590</span><span id="line-1590">                    default:</span>
<span class="source-line-no">1591</span><span id="line-1591">                        break;</span>
<span class="source-line-no">1592</span><span id="line-1592">                }</span>
<span class="source-line-no">1593</span><span id="line-1593">            }</span>
<span class="source-line-no">1594</span><span id="line-1594"></span>
<span class="source-line-no">1595</span><span id="line-1595">            E = ExtendLineDouble(C, pt1, 50);</span>
<span class="source-line-no">1596</span><span id="line-1596">            ptsSeize[0] = new POINT2(C);</span>
<span class="source-line-no">1597</span><span id="line-1597">            ptsSeize[1] = new POINT2(E);</span>
<span class="source-line-no">1598</span><span id="line-1598"></span>
<span class="source-line-no">1599</span><span id="line-1599">            ptsTemp = null;</span>
<span class="source-line-no">1600</span><span id="line-1600">        } catch (Exception exc) {</span>
<span class="source-line-no">1601</span><span id="line-1601">            ErrorLogger.LogException(_className, "CalcClockwiseCenterDouble",</span>
<span class="source-line-no">1602</span><span id="line-1602">                    new RendererException("Failed inside CalcClockwiseCenterDouble", exc));</span>
<span class="source-line-no">1603</span><span id="line-1603">        }</span>
<span class="source-line-no">1604</span><span id="line-1604">        return dRadius;</span>
<span class="source-line-no">1605</span><span id="line-1605">    }</span>
<span class="source-line-no">1606</span><span id="line-1606"></span>
<span class="source-line-no">1607</span><span id="line-1607">    /**</span>
<span class="source-line-no">1608</span><span id="line-1608">     * Computes the points for an arrowhead based on a line segment</span>
<span class="source-line-no">1609</span><span id="line-1609">     *</span>
<span class="source-line-no">1610</span><span id="line-1610">     * @param startLinePoint segment start point</span>
<span class="source-line-no">1611</span><span id="line-1611">     * @param endLinePoint segment end point</span>
<span class="source-line-no">1612</span><span id="line-1612">     * @param nBiSector bisecotr in pixels</span>
<span class="source-line-no">1613</span><span id="line-1613">     * @param nBase base size in pixels</span>
<span class="source-line-no">1614</span><span id="line-1614">     * @param pResultLinePoints OUT - the arrowhead points</span>
<span class="source-line-no">1615</span><span id="line-1615">     * @param styl the line style to assign the last aroowhead point</span>
<span class="source-line-no">1616</span><span id="line-1616">     */</span>
<span class="source-line-no">1617</span><span id="line-1617">    protected static void GetArrowHead4Double(POINT2 startLinePoint,</span>
<span class="source-line-no">1618</span><span id="line-1618">            POINT2 endLinePoint,</span>
<span class="source-line-no">1619</span><span id="line-1619">            int nBiSector,</span>
<span class="source-line-no">1620</span><span id="line-1620">            int nBase,</span>
<span class="source-line-no">1621</span><span id="line-1621">            POINT2[] pResultLinePoints,</span>
<span class="source-line-no">1622</span><span id="line-1622">            int styl) {</span>
<span class="source-line-no">1623</span><span id="line-1623">        try {</span>
<span class="source-line-no">1624</span><span id="line-1624">            //declarations</span>
<span class="source-line-no">1625</span><span id="line-1625">            int j = 0;</span>
<span class="source-line-no">1626</span><span id="line-1626">            double dy = (double) (endLinePoint.y - startLinePoint.y),</span>
<span class="source-line-no">1627</span><span id="line-1627">                    dx = (double) (endLinePoint.x - startLinePoint.x),</span>
<span class="source-line-no">1628</span><span id="line-1628">                    dSign = 1.0,</span>
<span class="source-line-no">1629</span><span id="line-1629">                    AHBY = 0,</span>
<span class="source-line-no">1630</span><span id="line-1630">                    AHBX = 0,</span>
<span class="source-line-no">1631</span><span id="line-1631">                    AHBLY = 0,</span>
<span class="source-line-no">1632</span><span id="line-1632">                    AHBLX = 0,</span>
<span class="source-line-no">1633</span><span id="line-1633">                    AHBRY = 0,</span>
<span class="source-line-no">1634</span><span id="line-1634">                    AHBRX = 0,</span>
<span class="source-line-no">1635</span><span id="line-1635">                    dAngle = 0,</span>
<span class="source-line-no">1636</span><span id="line-1636">                    dHypotenuse = 0;</span>
<span class="source-line-no">1637</span><span id="line-1637"></span>
<span class="source-line-no">1638</span><span id="line-1638">            POINT2 tempLinePoint = new POINT2(startLinePoint);</span>
<span class="source-line-no">1639</span><span id="line-1639">            //end declarations</span>
<span class="source-line-no">1640</span><span id="line-1640"></span>
<span class="source-line-no">1641</span><span id="line-1641">            if (dy == 0) {</span>
<span class="source-line-no">1642</span><span id="line-1642">                if (dx &gt; 0) {</span>
<span class="source-line-no">1643</span><span id="line-1643">                    dAngle = Math.PI;</span>
<span class="source-line-no">1644</span><span id="line-1644">                } else {</span>
<span class="source-line-no">1645</span><span id="line-1645">                    dAngle = 0;</span>
<span class="source-line-no">1646</span><span id="line-1646">                }</span>
<span class="source-line-no">1647</span><span id="line-1647">            } else {</span>
<span class="source-line-no">1648</span><span id="line-1648">                dAngle = Math.atan(dx / dy) + Math.PI / 2;</span>
<span class="source-line-no">1649</span><span id="line-1649">            }</span>
<span class="source-line-no">1650</span><span id="line-1650"></span>
<span class="source-line-no">1651</span><span id="line-1651">            tempLinePoint.style = 0;//PS_SOLID;</span>
<span class="source-line-no">1652</span><span id="line-1652"></span>
<span class="source-line-no">1653</span><span id="line-1653">            if (dx &lt;= 0.0 &amp;&amp; dy &lt;= 0.0) {</span>
<span class="source-line-no">1654</span><span id="line-1654">                dSign = -1.0;</span>
<span class="source-line-no">1655</span><span id="line-1655">            }</span>
<span class="source-line-no">1656</span><span id="line-1656">            if (dx &gt;= 0.0 &amp;&amp; dy &lt;= 0.0) {</span>
<span class="source-line-no">1657</span><span id="line-1657">                dSign = -1.0;</span>
<span class="source-line-no">1658</span><span id="line-1658">            }</span>
<span class="source-line-no">1659</span><span id="line-1659">            if (dx &lt;= 0.0 &amp;&amp; dy &gt;= 0.0) {</span>
<span class="source-line-no">1660</span><span id="line-1660">                dSign = 1.0;</span>
<span class="source-line-no">1661</span><span id="line-1661">            }</span>
<span class="source-line-no">1662</span><span id="line-1662">            if (dx &gt;= 0.0 &amp;&amp; dy &gt;= 0.0) {</span>
<span class="source-line-no">1663</span><span id="line-1663">                dSign = 1.0;</span>
<span class="source-line-no">1664</span><span id="line-1664">            }</span>
<span class="source-line-no">1665</span><span id="line-1665"></span>
<span class="source-line-no">1666</span><span id="line-1666">            dHypotenuse = dSign * (double) nBiSector;</span>
<span class="source-line-no">1667</span><span id="line-1667"></span>
<span class="source-line-no">1668</span><span id="line-1668">            //Find x, y for Arrow Head nBase startLinePoint POINT1</span>
<span class="source-line-no">1669</span><span id="line-1669">            AHBX = (double) endLinePoint.x + dHypotenuse * Math.cos(dAngle);</span>
<span class="source-line-no">1670</span><span id="line-1670">            AHBY = (double) endLinePoint.y - dHypotenuse * Math.sin(dAngle);</span>
<span class="source-line-no">1671</span><span id="line-1671"></span>
<span class="source-line-no">1672</span><span id="line-1672">            //Half of the arrow head's length will be 10 units</span>
<span class="source-line-no">1673</span><span id="line-1673">            dHypotenuse = dSign * (double) (nBase / 2.0);</span>
<span class="source-line-no">1674</span><span id="line-1674"></span>
<span class="source-line-no">1675</span><span id="line-1675">            //Find x, y of Arrow Head nBase Left side end POINT1</span>
<span class="source-line-no">1676</span><span id="line-1676">            AHBLX = AHBX - dHypotenuse * Math.sin(dAngle);</span>
<span class="source-line-no">1677</span><span id="line-1677">            AHBLY = AHBY - dHypotenuse * Math.cos(dAngle);</span>
<span class="source-line-no">1678</span><span id="line-1678"></span>
<span class="source-line-no">1679</span><span id="line-1679">            //Find x, y of Arrow Head nBase Right side end POINT1</span>
<span class="source-line-no">1680</span><span id="line-1680">            AHBRX = AHBX + dHypotenuse * Math.sin(dAngle);</span>
<span class="source-line-no">1681</span><span id="line-1681">            AHBRY = AHBY + dHypotenuse * Math.cos(dAngle);</span>
<span class="source-line-no">1682</span><span id="line-1682"></span>
<span class="source-line-no">1683</span><span id="line-1683">            //replacement, just trying to return the POINT1s</span>
<span class="source-line-no">1684</span><span id="line-1684">            tempLinePoint.x = (int) AHBLX;</span>
<span class="source-line-no">1685</span><span id="line-1685">            tempLinePoint.y = (int) AHBLY;</span>
<span class="source-line-no">1686</span><span id="line-1686">            pResultLinePoints[0] = new POINT2(tempLinePoint);</span>
<span class="source-line-no">1687</span><span id="line-1687">            pResultLinePoints[1] = new POINT2(endLinePoint);</span>
<span class="source-line-no">1688</span><span id="line-1688">            tempLinePoint.x = (int) AHBRX;</span>
<span class="source-line-no">1689</span><span id="line-1689">            tempLinePoint.y = (int) AHBRY;</span>
<span class="source-line-no">1690</span><span id="line-1690">            pResultLinePoints[2] = new POINT2(tempLinePoint);</span>
<span class="source-line-no">1691</span><span id="line-1691">            switch (styl) {</span>
<span class="source-line-no">1692</span><span id="line-1692">                case 0:</span>
<span class="source-line-no">1693</span><span id="line-1693">                    for (j = 0; j &lt; 2; j++) {</span>
<span class="source-line-no">1694</span><span id="line-1694">                        pResultLinePoints[j].style = 0;</span>
<span class="source-line-no">1695</span><span id="line-1695">                    }</span>
<span class="source-line-no">1696</span><span id="line-1696">                    pResultLinePoints[2].style = 5;</span>
<span class="source-line-no">1697</span><span id="line-1697">                    break;</span>
<span class="source-line-no">1698</span><span id="line-1698">                case 9:</span>
<span class="source-line-no">1699</span><span id="line-1699">                    for (j = 0; j &lt; 2; j++) {</span>
<span class="source-line-no">1700</span><span id="line-1700">                        pResultLinePoints[j].style = 9;</span>
<span class="source-line-no">1701</span><span id="line-1701">                    }</span>
<span class="source-line-no">1702</span><span id="line-1702">                    pResultLinePoints[2].style = 10;</span>
<span class="source-line-no">1703</span><span id="line-1703">                    break;</span>
<span class="source-line-no">1704</span><span id="line-1704">                case 18:</span>
<span class="source-line-no">1705</span><span id="line-1705">                    for (j = 0; j &lt; 2; j++) {</span>
<span class="source-line-no">1706</span><span id="line-1706">                        pResultLinePoints[j].style = 18;</span>
<span class="source-line-no">1707</span><span id="line-1707">                    }</span>
<span class="source-line-no">1708</span><span id="line-1708">                    pResultLinePoints[2].style = 5;</span>
<span class="source-line-no">1709</span><span id="line-1709">                    break;</span>
<span class="source-line-no">1710</span><span id="line-1710">                default:</span>
<span class="source-line-no">1711</span><span id="line-1711">                    for (j = 0; j &lt; 2; j++) {</span>
<span class="source-line-no">1712</span><span id="line-1712">                        pResultLinePoints[j].style = styl;</span>
<span class="source-line-no">1713</span><span id="line-1713">                    }</span>
<span class="source-line-no">1714</span><span id="line-1714">                    pResultLinePoints[2].style = 5;</span>
<span class="source-line-no">1715</span><span id="line-1715">                    break;</span>
<span class="source-line-no">1716</span><span id="line-1716">            }</span>
<span class="source-line-no">1717</span><span id="line-1717">        } catch (Exception exc) {</span>
<span class="source-line-no">1718</span><span id="line-1718">            ErrorLogger.LogException(_className, "GetArrowhead4Double",</span>
<span class="source-line-no">1719</span><span id="line-1719">                    new RendererException("Failed inside GetArrowhead4Double", exc));</span>
<span class="source-line-no">1720</span><span id="line-1720">        }</span>
<span class="source-line-no">1721</span><span id="line-1721">    }</span>
<span class="source-line-no">1722</span><span id="line-1722"></span>
<span class="source-line-no">1723</span><span id="line-1723">    /**</span>
<span class="source-line-no">1724</span><span id="line-1724">     * Returns the midpoint between two points.</span>
<span class="source-line-no">1725</span><span id="line-1725">     *</span>
<span class="source-line-no">1726</span><span id="line-1726">     * @param pt0 the first point</span>
<span class="source-line-no">1727</span><span id="line-1727">     * @param pt1 the second point</span>
<span class="source-line-no">1728</span><span id="line-1728">     * @param styl the style to assign the mid point</span>
<span class="source-line-no">1729</span><span id="line-1729">     *</span>
<span class="source-line-no">1730</span><span id="line-1730">     * @return the mid point</span>
<span class="source-line-no">1731</span><span id="line-1731">     */</span>
<span class="source-line-no">1732</span><span id="line-1732">    public static POINT2 MidPointDouble(POINT2 pt0,</span>
<span class="source-line-no">1733</span><span id="line-1733">            POINT2 pt1,</span>
<span class="source-line-no">1734</span><span id="line-1734">            int styl) {</span>
<span class="source-line-no">1735</span><span id="line-1735">        POINT2 ptResult = new POINT2(pt0);</span>
<span class="source-line-no">1736</span><span id="line-1736">        try {</span>
<span class="source-line-no">1737</span><span id="line-1737">            ptResult.x = (pt0.x + pt1.x) / 2;</span>
<span class="source-line-no">1738</span><span id="line-1738">            ptResult.y = (pt0.y + pt1.y) / 2;</span>
<span class="source-line-no">1739</span><span id="line-1739">            ptResult.style = styl;</span>
<span class="source-line-no">1740</span><span id="line-1740">        } catch (Exception exc) {</span>
<span class="source-line-no">1741</span><span id="line-1741">            ErrorLogger.LogException(_className, "MidPointDouble",</span>
<span class="source-line-no">1742</span><span id="line-1742">                    new RendererException("Failed inside MidPointDouble", exc));</span>
<span class="source-line-no">1743</span><span id="line-1743">        }</span>
<span class="source-line-no">1744</span><span id="line-1744">        return ptResult;</span>
<span class="source-line-no">1745</span><span id="line-1745">    }</span>
<span class="source-line-no">1746</span><span id="line-1746"></span>
<span class="source-line-no">1747</span><span id="line-1747">    /**</span>
<span class="source-line-no">1748</span><span id="line-1748">     * Rotates an the first vblCounter points in the array about its first point</span>
<span class="source-line-no">1749</span><span id="line-1749">     *</span>
<span class="source-line-no">1750</span><span id="line-1750">     * @param pLinePoints OUT - the points to rotate</span>
<span class="source-line-no">1751</span><span id="line-1751">     * @param vblCounter the number of points to rotate</span>
<span class="source-line-no">1752</span><span id="line-1752">     * @param lAngle the angle in degrees to rotate</span>
<span class="source-line-no">1753</span><span id="line-1753">     *</span>
<span class="source-line-no">1754</span><span id="line-1754">     * @return pLinePoints</span>
<span class="source-line-no">1755</span><span id="line-1755">     */</span>
<span class="source-line-no">1756</span><span id="line-1756">    protected static POINT2[] RotateGeometryDoubleOrigin(POINT2[] pLinePoints,</span>
<span class="source-line-no">1757</span><span id="line-1757">            int vblCounter,</span>
<span class="source-line-no">1758</span><span id="line-1758">            int lAngle) {</span>
<span class="source-line-no">1759</span><span id="line-1759">        try {</span>
<span class="source-line-no">1760</span><span id="line-1760">            //declarations</span>
<span class="source-line-no">1761</span><span id="line-1761">            int j = 0;</span>
<span class="source-line-no">1762</span><span id="line-1762">            double dRotate = 0,</span>
<span class="source-line-no">1763</span><span id="line-1763">                    dTheta = 0,</span>
<span class="source-line-no">1764</span><span id="line-1764">                    dGamma = 0,</span>
<span class="source-line-no">1765</span><span id="line-1765">                    x = 0,</span>
<span class="source-line-no">1766</span><span id="line-1766">                    y = 0;</span>
<span class="source-line-no">1767</span><span id="line-1767">            //end declarations</span>
<span class="source-line-no">1768</span><span id="line-1768"></span>
<span class="source-line-no">1769</span><span id="line-1769">            if (lAngle != 0) {</span>
<span class="source-line-no">1770</span><span id="line-1770">                POINT2 pdCenter = new POINT2();</span>
<span class="source-line-no">1771</span><span id="line-1771">                dRotate = (double) lAngle * Math.PI / 180d;</span>
<span class="source-line-no">1772</span><span id="line-1772">                //pdCenter = CalcCenterPointDouble(pLinePoints,vblCounter);</span>
<span class="source-line-no">1773</span><span id="line-1773">                pdCenter = new POINT2(pLinePoints[0]);</span>
<span class="source-line-no">1774</span><span id="line-1774"></span>
<span class="source-line-no">1775</span><span id="line-1775">                for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">1776</span><span id="line-1776">                    dGamma = Math.PI + Math.atan((pLinePoints[j].y - pdCenter.y)</span>
<span class="source-line-no">1777</span><span id="line-1777">                            / (pLinePoints[j].x - pdCenter.x));</span>
<span class="source-line-no">1778</span><span id="line-1778"></span>
<span class="source-line-no">1779</span><span id="line-1779">                    if (pLinePoints[j].x &gt;= pdCenter.x) {</span>
<span class="source-line-no">1780</span><span id="line-1780">                        dGamma = dGamma + Math.PI;</span>
<span class="source-line-no">1781</span><span id="line-1781">                    }</span>
<span class="source-line-no">1782</span><span id="line-1782"></span>
<span class="source-line-no">1783</span><span id="line-1783">                    dTheta = dRotate + dGamma;</span>
<span class="source-line-no">1784</span><span id="line-1784">                    y = CalcDistanceDouble(pLinePoints[j], pdCenter) * Math.sin(dTheta);</span>
<span class="source-line-no">1785</span><span id="line-1785">                    x = CalcDistanceDouble(pLinePoints[j], pdCenter) * Math.cos(dTheta);</span>
<span class="source-line-no">1786</span><span id="line-1786">                    pLinePoints[j].y = pdCenter.y + y;</span>
<span class="source-line-no">1787</span><span id="line-1787">                    pLinePoints[j].x = pdCenter.x + x;</span>
<span class="source-line-no">1788</span><span id="line-1788">                }       //end for</span>
<span class="source-line-no">1789</span><span id="line-1789"></span>
<span class="source-line-no">1790</span><span id="line-1790">                return pLinePoints;</span>
<span class="source-line-no">1791</span><span id="line-1791">            }   //end if</span>
<span class="source-line-no">1792</span><span id="line-1792">        } catch (Exception exc) {</span>
<span class="source-line-no">1793</span><span id="line-1793">            ErrorLogger.LogException(_className, "RotateGeometryDoubleOrigin",</span>
<span class="source-line-no">1794</span><span id="line-1794">                    new RendererException("Failed inside RotateGeometryDoubleOrigin", exc));</span>
<span class="source-line-no">1795</span><span id="line-1795">        }</span>
<span class="source-line-no">1796</span><span id="line-1796">        return pLinePoints;</span>
<span class="source-line-no">1797</span><span id="line-1797">    }  // end function</span>
<span class="source-line-no">1798</span><span id="line-1798"></span>
<span class="source-line-no">1799</span><span id="line-1799">    /**</span>
<span class="source-line-no">1800</span><span id="line-1800">     * Returns a point a distance d pixels perpendicular to the pt0-pt1 line and</span>
<span class="source-line-no">1801</span><span id="line-1801">     * going toward pt2</span>
<span class="source-line-no">1802</span><span id="line-1802">     *</span>
<span class="source-line-no">1803</span><span id="line-1803">     * @param pt0 the first line point</span>
<span class="source-line-no">1804</span><span id="line-1804">     * @param pt1 the second line point</span>
<span class="source-line-no">1805</span><span id="line-1805">     * @param pt2 the relative line point</span>
<span class="source-line-no">1806</span><span id="line-1806">     * @param d the distance in pixels</span>
<span class="source-line-no">1807</span><span id="line-1807">     * @param styl the linestyle to assign the computed point</span>
<span class="source-line-no">1808</span><span id="line-1808">     *</span>
<span class="source-line-no">1809</span><span id="line-1809">     * @return the extended point</span>
<span class="source-line-no">1810</span><span id="line-1810">     */</span>
<span class="source-line-no">1811</span><span id="line-1811">    public static POINT2 ExtendTrueLinePerpDouble(POINT2 pt0,</span>
<span class="source-line-no">1812</span><span id="line-1812">            POINT2 pt1,</span>
<span class="source-line-no">1813</span><span id="line-1813">            POINT2 pt2,</span>
<span class="source-line-no">1814</span><span id="line-1814">            double d,</span>
<span class="source-line-no">1815</span><span id="line-1815">            int styl) {</span>
<span class="source-line-no">1816</span><span id="line-1816">        POINT2 ptResult = new POINT2(pt0);</span>
<span class="source-line-no">1817</span><span id="line-1817">        try {</span>
<span class="source-line-no">1818</span><span id="line-1818">            POINT2 ptYIntercept = new POINT2(pt0);</span>
<span class="source-line-no">1819</span><span id="line-1819">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">1820</span><span id="line-1820">            double b = 0, b1 = 0;       //b is the normal Y intercept (at 0)</span>
<span class="source-line-no">1821</span><span id="line-1821">            int nTemp = 0;                      //b1 is the y intercept at offsetX</span>
<span class="source-line-no">1822</span><span id="line-1822"></span>
<span class="source-line-no">1823</span><span id="line-1823">            //must obtain x minimum to get the y-intercept to the left of</span>
<span class="source-line-no">1824</span><span id="line-1824">            //the left-most point</span>
<span class="source-line-no">1825</span><span id="line-1825">            ref&lt;double[]&gt; offsetX = new ref(), offsetY = new ref();</span>
<span class="source-line-no">1826</span><span id="line-1826">            POINT2[] pts = new POINT2[3];</span>
<span class="source-line-no">1827</span><span id="line-1827">            pts[0] = new POINT2(pt0);</span>
<span class="source-line-no">1828</span><span id="line-1828">            pts[1] = new POINT2(pt1);</span>
<span class="source-line-no">1829</span><span id="line-1829">            pts[2] = new POINT2(pt2);</span>
<span class="source-line-no">1830</span><span id="line-1830">            GetPixelsMin(pts, 3, offsetX, offsetY);</span>
<span class="source-line-no">1831</span><span id="line-1831"></span>
<span class="source-line-no">1832</span><span id="line-1832">            if (offsetX.value[0] &lt;= 0) //was &lt; 0</span>
<span class="source-line-no">1833</span><span id="line-1833">            {</span>
<span class="source-line-no">1834</span><span id="line-1834">                offsetX.value[0] = offsetX.value[0] - 100;</span>
<span class="source-line-no">1835</span><span id="line-1835">            } else {</span>
<span class="source-line-no">1836</span><span id="line-1836">                offsetX.value[0] = 0;</span>
<span class="source-line-no">1837</span><span id="line-1837">            }</span>
<span class="source-line-no">1838</span><span id="line-1838">            //end section</span>
<span class="source-line-no">1839</span><span id="line-1839"></span>
<span class="source-line-no">1840</span><span id="line-1840">            nTemp = CalcTrueSlopeDouble(pt0, pt1, m);</span>
<span class="source-line-no">1841</span><span id="line-1841">            switch (nTemp) {</span>
<span class="source-line-no">1842</span><span id="line-1842">                case 0: //vertical line</span>
<span class="source-line-no">1843</span><span id="line-1843">                    if (pt0.y &lt; pt1.y) {</span>
<span class="source-line-no">1844</span><span id="line-1844">                        ptResult.x = pt2.x - d;</span>
<span class="source-line-no">1845</span><span id="line-1845">                        ptResult.y = pt2.y;</span>
<span class="source-line-no">1846</span><span id="line-1846">                    } else {</span>
<span class="source-line-no">1847</span><span id="line-1847">                        ptResult.x = pt2.x + d;</span>
<span class="source-line-no">1848</span><span id="line-1848">                        ptResult.y = pt2.y;</span>
<span class="source-line-no">1849</span><span id="line-1849">                    }</span>
<span class="source-line-no">1850</span><span id="line-1850">                    break;</span>
<span class="source-line-no">1851</span><span id="line-1851">                default:        //non-vertical line</span>
<span class="source-line-no">1852</span><span id="line-1852">                    if (m.value[0] == 0) {</span>
<span class="source-line-no">1853</span><span id="line-1853">                        ptResult.x = pt2.x;</span>
<span class="source-line-no">1854</span><span id="line-1854">                        ptResult.y = pt2.y + d;</span>
<span class="source-line-no">1855</span><span id="line-1855">                    } else {</span>
<span class="source-line-no">1856</span><span id="line-1856">                        b = (double) pt2.y + (1 / m.value[0]) * (double) pt2.x;</span>
<span class="source-line-no">1857</span><span id="line-1857">                        //we need the y-intercept at the -offset</span>
<span class="source-line-no">1858</span><span id="line-1858">                        b1 = (-1 / m.value[0]) * offsetX.value[0] + b;</span>
<span class="source-line-no">1859</span><span id="line-1859">                        ptYIntercept.x = offsetX.value[0];</span>
<span class="source-line-no">1860</span><span id="line-1860">                        ptYIntercept.y = b1;</span>
<span class="source-line-no">1861</span><span id="line-1861">                        ptResult = ExtendLineDouble(ptYIntercept, pt2, d);</span>
<span class="source-line-no">1862</span><span id="line-1862">                    }</span>
<span class="source-line-no">1863</span><span id="line-1863">                    break;</span>
<span class="source-line-no">1864</span><span id="line-1864">            }</span>
<span class="source-line-no">1865</span><span id="line-1865">            ptResult.style = styl;</span>
<span class="source-line-no">1866</span><span id="line-1866">            pts = null;</span>
<span class="source-line-no">1867</span><span id="line-1867">        } catch (Exception exc) {</span>
<span class="source-line-no">1868</span><span id="line-1868">            ErrorLogger.LogException(_className, "ExtendTrueLinePerpDouble",</span>
<span class="source-line-no">1869</span><span id="line-1869">                    new RendererException("Failed inside ExtendTrueLinePerpDouble", exc));</span>
<span class="source-line-no">1870</span><span id="line-1870">        }</span>
<span class="source-line-no">1871</span><span id="line-1871">        return ptResult;</span>
<span class="source-line-no">1872</span><span id="line-1872">    }</span>
<span class="source-line-no">1873</span><span id="line-1873"></span>
<span class="source-line-no">1874</span><span id="line-1874">    /**</span>
<span class="source-line-no">1875</span><span id="line-1875">     * Calculates the intersection of 2 lines pelative to a point. if one of the</span>
<span class="source-line-no">1876</span><span id="line-1876">     * lines is vertical use a distance dWidth above or below the line. pass</span>
<span class="source-line-no">1877</span><span id="line-1877">     * bolVertical1 = 1, or bolVertical2 = 1 if either line segment is vertical,</span>
<span class="source-line-no">1878</span><span id="line-1878">     * else pass 0. return the unique intersection in X,Y pointers. p2 is the</span>
<span class="source-line-no">1879</span><span id="line-1879">     * point that connects the 2 line segments to which the intersecting lines</span>
<span class="source-line-no">1880</span><span id="line-1880">     * are related, i.e. the intersecting lines are a distance dWidth pixels</span>
<span class="source-line-no">1881</span><span id="line-1881">     * above or below p2. uses dWidth and lOrient for cases in which at least</span>
<span class="source-line-no">1882</span><span id="line-1882">     * one of the lines is vertical. for normal lines this function assumes the</span>
<span class="source-line-no">1883</span><span id="line-1883">     * caller has passed the m, b for the appropriate upper or lower lines to</span>
<span class="source-line-no">1884</span><span id="line-1884">     * get the desired intgercept. this function is used for calculating the</span>
<span class="source-line-no">1885</span><span id="line-1885">     * upper and lower channel lines for channel types. For lOrient: see</span>
<span class="source-line-no">1886</span><span id="line-1886">     * comments in Channels.ConnectTrueDouble2</span>
<span class="source-line-no">1887</span><span id="line-1887">     *</span>
<span class="source-line-no">1888</span><span id="line-1888">     * @param m1 slope of the first line</span>
<span class="source-line-no">1889</span><span id="line-1889">     * @param b1 intercept of the first line</span>
<span class="source-line-no">1890</span><span id="line-1890">     * @param m2 slope of the second line</span>
<span class="source-line-no">1891</span><span id="line-1891">     * @param b2 y intercept of the second line</span>
<span class="source-line-no">1892</span><span id="line-1892">     * @param p2 point that connects the 2 line segments to which the</span>
<span class="source-line-no">1893</span><span id="line-1893">     * intersecting lines are related</span>
<span class="source-line-no">1894</span><span id="line-1894">     * @param bolVerticalSlope1 1 if first segment is vertical, else 0</span>
<span class="source-line-no">1895</span><span id="line-1895">     * @param bolVerticalSlope2 1 if second line segment is vertical, else 0</span>
<span class="source-line-no">1896</span><span id="line-1896">     * @param dWidth the distance of the intersecting lines from p2 in pixels</span>
<span class="source-line-no">1897</span><span id="line-1897">     * @param lOrient the orientation of the intersecting lines relative to the</span>
<span class="source-line-no">1898</span><span id="line-1898">     * segments connecting p2</span>
<span class="source-line-no">1899</span><span id="line-1899">     * @param X OUT - object holds the x value of the intersection point</span>
<span class="source-line-no">1900</span><span id="line-1900">     * @param Y OUT - object holds the y value of the intersection point</span>
<span class="source-line-no">1901</span><span id="line-1901">     */</span>
<span class="source-line-no">1902</span><span id="line-1902">    protected static int CalcTrueIntersectDouble(double m1,</span>
<span class="source-line-no">1903</span><span id="line-1903">            double b1,</span>
<span class="source-line-no">1904</span><span id="line-1904">            double m2,</span>
<span class="source-line-no">1905</span><span id="line-1905">            double b2,</span>
<span class="source-line-no">1906</span><span id="line-1906">            POINT2 p2, //can use for vertical lines</span>
<span class="source-line-no">1907</span><span id="line-1907">            int bolVerticalSlope1,</span>
<span class="source-line-no">1908</span><span id="line-1908">            int bolVerticalSlope2,</span>
<span class="source-line-no">1909</span><span id="line-1909">            double dWidth, //use for vertical lines, use + for upper line, - for lower line</span>
<span class="source-line-no">1910</span><span id="line-1910">            int lOrient,</span>
<span class="source-line-no">1911</span><span id="line-1911">            ref&lt;double[]&gt; X, //intersection x value</span>
<span class="source-line-no">1912</span><span id="line-1912">            ref&lt;double[]&gt; Y) //intersection y value</span>
<span class="source-line-no">1913</span><span id="line-1913">    {</span>
<span class="source-line-no">1914</span><span id="line-1914"></span>
<span class="source-line-no">1915</span><span id="line-1915">        try {</span>
<span class="source-line-no">1916</span><span id="line-1916">            //case both lines are vertical</span>
<span class="source-line-no">1917</span><span id="line-1917">            double dWidth2 = Math.abs(dWidth);</span>
<span class="source-line-no">1918</span><span id="line-1918">            double b = 0;</span>
<span class="source-line-no">1919</span><span id="line-1919">            double dx = 0, dy = 0, m = 0;</span>
<span class="source-line-no">1920</span><span id="line-1920">            X.value = new double[1];</span>
<span class="source-line-no">1921</span><span id="line-1921">            Y.value = new double[1];</span>
<span class="source-line-no">1922</span><span id="line-1922"></span>
<span class="source-line-no">1923</span><span id="line-1923">            //cannot get out of having to do this</span>
<span class="source-line-no">1924</span><span id="line-1924">            //the problem is caused by inexact slopes which are created by</span>
<span class="source-line-no">1925</span><span id="line-1925">            //clsLineUtility.DisplayIntersectPixels. This occurs when setting</span>
<span class="source-line-no">1926</span><span id="line-1926">            //pt2 or pt3 with X or Y on the boundary +/-maxPixels</span>
<span class="source-line-no">1927</span><span id="line-1927">            //if you try to walk out until you get exactly the same slope</span>
<span class="source-line-no">1928</span><span id="line-1928">            //it can be thousands of pixels, so you have to accept an arbitrary</span>
<span class="source-line-no">1929</span><span id="line-1929">            //and, unfortuantely, inexact slope</span>
<span class="source-line-no">1930</span><span id="line-1930">            if (m1 != m2 &amp;&amp; Math.abs(m1 - m2) &lt;= Double.MIN_VALUE) {</span>
<span class="source-line-no">1931</span><span id="line-1931">                m1 = m2;</span>
<span class="source-line-no">1932</span><span id="line-1932">            }</span>
<span class="source-line-no">1933</span><span id="line-1933">            if (b1 != b2 &amp;&amp; Math.abs(b1 - b2) &lt;= Double.MIN_VALUE) {</span>
<span class="source-line-no">1934</span><span id="line-1934">                b1 = b2;</span>
<span class="source-line-no">1935</span><span id="line-1935">            }</span>
<span class="source-line-no">1936</span><span id="line-1936"></span>
<span class="source-line-no">1937</span><span id="line-1937">            //M. Deutch 10-24-11</span>
<span class="source-line-no">1938</span><span id="line-1938">            if (b1 == b2 &amp;&amp; m1 + b1 == m2 + b2) {</span>
<span class="source-line-no">1939</span><span id="line-1939">                m1 = m2;</span>
<span class="source-line-no">1940</span><span id="line-1940">            }</span>
<span class="source-line-no">1941</span><span id="line-1941"></span>
<span class="source-line-no">1942</span><span id="line-1942">            if (bolVerticalSlope1 == 0 &amp;&amp; bolVerticalSlope2 == 0) //both lines vertical</span>
<span class="source-line-no">1943</span><span id="line-1943">            {</span>
<span class="source-line-no">1944</span><span id="line-1944">                switch (lOrient) {</span>
<span class="source-line-no">1945</span><span id="line-1945">                    case 0:</span>
<span class="source-line-no">1946</span><span id="line-1946">                        X.value[0] = p2.x - dWidth2;</span>
<span class="source-line-no">1947</span><span id="line-1947">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">1948</span><span id="line-1948">                        break;</span>
<span class="source-line-no">1949</span><span id="line-1949">                    case 3:</span>
<span class="source-line-no">1950</span><span id="line-1950">                        X.value[0] = p2.x + dWidth2;</span>
<span class="source-line-no">1951</span><span id="line-1951">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">1952</span><span id="line-1952">                        break;</span>
<span class="source-line-no">1953</span><span id="line-1953">                    default:    //can never occur</span>
<span class="source-line-no">1954</span><span id="line-1954">                        X.value[0] = p2.x;</span>
<span class="source-line-no">1955</span><span id="line-1955">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">1956</span><span id="line-1956">                        break;</span>
<span class="source-line-no">1957</span><span id="line-1957">                }</span>
<span class="source-line-no">1958</span><span id="line-1958">                return 1;</span>
<span class="source-line-no">1959</span><span id="line-1959">            }</span>
<span class="source-line-no">1960</span><span id="line-1960">            if (bolVerticalSlope1 == 0 &amp;&amp; bolVerticalSlope2 != 0) //line1 vertical, line2 is not</span>
<span class="source-line-no">1961</span><span id="line-1961">            {   //there is a unique intersection</span>
<span class="source-line-no">1962</span><span id="line-1962">                switch (lOrient) {</span>
<span class="source-line-no">1963</span><span id="line-1963">                    case 0:     //Line1 above segment1</span>
<span class="source-line-no">1964</span><span id="line-1964">                    case 1:</span>
<span class="source-line-no">1965</span><span id="line-1965">                        X.value[0] = p2.x - dWidth2;</span>
<span class="source-line-no">1966</span><span id="line-1966">                        Y.value[0] = m2 * X.value[0] + b2;</span>
<span class="source-line-no">1967</span><span id="line-1967">                        break;</span>
<span class="source-line-no">1968</span><span id="line-1968">                    case 2:     //Line1 below segment1</span>
<span class="source-line-no">1969</span><span id="line-1969">                    case 3:</span>
<span class="source-line-no">1970</span><span id="line-1970">                        X.value[0] = p2.x + dWidth2;</span>
<span class="source-line-no">1971</span><span id="line-1971">                        Y.value[0] = m2 * X.value[0] + b2;</span>
<span class="source-line-no">1972</span><span id="line-1972">                        break;</span>
<span class="source-line-no">1973</span><span id="line-1973">                    default:    //can not occur</span>
<span class="source-line-no">1974</span><span id="line-1974">                        X.value[0] = p2.x;</span>
<span class="source-line-no">1975</span><span id="line-1975">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">1976</span><span id="line-1976">                        break;</span>
<span class="source-line-no">1977</span><span id="line-1977">                }</span>
<span class="source-line-no">1978</span><span id="line-1978">                return 1;</span>
<span class="source-line-no">1979</span><span id="line-1979">            }</span>
<span class="source-line-no">1980</span><span id="line-1980">            if (bolVerticalSlope2 == 0 &amp;&amp; bolVerticalSlope1 != 0) //line2 vertical, line1 is not</span>
<span class="source-line-no">1981</span><span id="line-1981">            {   //there is a unique intersection</span>
<span class="source-line-no">1982</span><span id="line-1982">                switch (lOrient) {</span>
<span class="source-line-no">1983</span><span id="line-1983">                    case 0:     //Line1 above segment2</span>
<span class="source-line-no">1984</span><span id="line-1984">                    case 2:</span>
<span class="source-line-no">1985</span><span id="line-1985">                        X.value[0] = p2.x - dWidth2;</span>
<span class="source-line-no">1986</span><span id="line-1986">                        Y.value[0] = m1 * (X.value[0]) + b1;</span>
<span class="source-line-no">1987</span><span id="line-1987">                        break;</span>
<span class="source-line-no">1988</span><span id="line-1988">                    case 1:     //Line1 below segment2</span>
<span class="source-line-no">1989</span><span id="line-1989">                    case 3:</span>
<span class="source-line-no">1990</span><span id="line-1990">                        X.value[0] = p2.x + dWidth2;</span>
<span class="source-line-no">1991</span><span id="line-1991">                        Y.value[0] = m1 * (X.value[0]) + b1;</span>
<span class="source-line-no">1992</span><span id="line-1992">                        break;</span>
<span class="source-line-no">1993</span><span id="line-1993">                    default:    //can not occur</span>
<span class="source-line-no">1994</span><span id="line-1994">                        X.value[0] = p2.x;</span>
<span class="source-line-no">1995</span><span id="line-1995">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">1996</span><span id="line-1996">                        break;</span>
<span class="source-line-no">1997</span><span id="line-1997">                }</span>
<span class="source-line-no">1998</span><span id="line-1998">                return 1;</span>
<span class="source-line-no">1999</span><span id="line-1999">            }//end if</span>
<span class="source-line-no">2000</span><span id="line-2000"></span>
<span class="source-line-no">2001</span><span id="line-2001">            //must deal with this case separately because normal lines use m1-m2 as a denominator</span>
<span class="source-line-no">2002</span><span id="line-2002">            //but we've handled all the vertical cases above so can assume it's not vertical</span>
<span class="source-line-no">2003</span><span id="line-2003">            //if the b's are different then one is an upper line, the other is a lower, no intersection</span>
<span class="source-line-no">2004</span><span id="line-2004">            //m and b will be used to build the perpendicular line thru p2 which we will use to</span>
<span class="source-line-no">2005</span><span id="line-2005">            //build the intersection, so must assume slopes are not 0, handle separately</span>
<span class="source-line-no">2006</span><span id="line-2006">            if (m1 == m2 &amp;&amp; m1 != 0) {</span>
<span class="source-line-no">2007</span><span id="line-2007">                if (b1 == b2) //then the intercept is the point joining the 2 segments</span>
<span class="source-line-no">2008</span><span id="line-2008">                {</span>
<span class="source-line-no">2009</span><span id="line-2009">                    //build the perpendicular line</span>
<span class="source-line-no">2010</span><span id="line-2010">                    m = -1 / m1;</span>
<span class="source-line-no">2011</span><span id="line-2011">                    b = p2.y - m * p2.x;</span>
<span class="source-line-no">2012</span><span id="line-2012">                    X.value[0] = (b2 - b) / (m - m2);   //intersect the lines (cannot blow up, m = m2 not possible)</span>
<span class="source-line-no">2013</span><span id="line-2013">                    Y.value[0] = (m1 * (X.value[0]) + b1);</span>
<span class="source-line-no">2014</span><span id="line-2014">                    return 1;</span>
<span class="source-line-no">2015</span><span id="line-2015">                } else //can not occur</span>
<span class="source-line-no">2016</span><span id="line-2016">                {</span>
<span class="source-line-no">2017</span><span id="line-2017">                    X.value[0] = p2.x;</span>
<span class="source-line-no">2018</span><span id="line-2018">                    Y.value[0] = p2.y;</span>
<span class="source-line-no">2019</span><span id="line-2019">                    return 1;</span>
<span class="source-line-no">2020</span><span id="line-2020">                }</span>
<span class="source-line-no">2021</span><span id="line-2021">            }</span>
<span class="source-line-no">2022</span><span id="line-2022">            //slope is zero</span>
<span class="source-line-no">2023</span><span id="line-2023">            if (m1 == m2 &amp;&amp; m1 == 0) {</span>
<span class="source-line-no">2024</span><span id="line-2024">                switch (lOrient) {</span>
<span class="source-line-no">2025</span><span id="line-2025">                    case 0:     //Line1 above the line</span>
<span class="source-line-no">2026</span><span id="line-2026">                    case 1:     //should never happen</span>
<span class="source-line-no">2027</span><span id="line-2027">                        X.value[0] = p2.x;</span>
<span class="source-line-no">2028</span><span id="line-2028">                        Y.value[0] = p2.y - dWidth2;</span>
<span class="source-line-no">2029</span><span id="line-2029">                        break;</span>
<span class="source-line-no">2030</span><span id="line-2030">                    case 3:     //Line1 below the line</span>
<span class="source-line-no">2031</span><span id="line-2031">                    case 2:     //should never happen</span>
<span class="source-line-no">2032</span><span id="line-2032">                        X.value[0] = p2.x;</span>
<span class="source-line-no">2033</span><span id="line-2033">                        Y.value[0] = p2.y + dWidth2;</span>
<span class="source-line-no">2034</span><span id="line-2034">                        break;</span>
<span class="source-line-no">2035</span><span id="line-2035">                    default:    //can not occur</span>
<span class="source-line-no">2036</span><span id="line-2036">                        X.value[0] = p2.x;</span>
<span class="source-line-no">2037</span><span id="line-2037">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">2038</span><span id="line-2038">                        break;</span>
<span class="source-line-no">2039</span><span id="line-2039">                }</span>
<span class="source-line-no">2040</span><span id="line-2040">                return 1;</span>
<span class="source-line-no">2041</span><span id="line-2041">            }</span>
<span class="source-line-no">2042</span><span id="line-2042"></span>
<span class="source-line-no">2043</span><span id="line-2043">            if (m1 == m2 &amp;&amp; b1 == b2 &amp;&amp; bolVerticalSlope1 != 0 &amp;&amp; bolVerticalSlope2 != 0) {</span>
<span class="source-line-no">2044</span><span id="line-2044">                switch (lOrient) {</span>
<span class="source-line-no">2045</span><span id="line-2045">                    case 0:     //Line1 is above the line</span>
<span class="source-line-no">2046</span><span id="line-2046">                        if (m1 &lt; 0) {</span>
<span class="source-line-no">2047</span><span id="line-2047">                            dy = m1 * dWidth / Math.sqrt(1 + m1 * m1);  //dy is negative</span>
<span class="source-line-no">2048</span><span id="line-2048">                            dx = dy / m1;       //dx is negative</span>
<span class="source-line-no">2049</span><span id="line-2049">                            X.value[0] = p2.x + dx;</span>
<span class="source-line-no">2050</span><span id="line-2050">                            Y.value[0] = p2.y + dy;</span>
<span class="source-line-no">2051</span><span id="line-2051">                        }</span>
<span class="source-line-no">2052</span><span id="line-2052">                        if (m1 &gt; 0) //slope is positive</span>
<span class="source-line-no">2053</span><span id="line-2053">                        {</span>
<span class="source-line-no">2054</span><span id="line-2054">                            dy = -m1 * dWidth / Math.sqrt(1 + m1 * m1); //dy is negative</span>
<span class="source-line-no">2055</span><span id="line-2055">                            dx = -dy / m1;      //dx is positive</span>
<span class="source-line-no">2056</span><span id="line-2056">                            X.value[0] = p2.x + dx;</span>
<span class="source-line-no">2057</span><span id="line-2057">                            Y.value[0] = p2.y + dy;</span>
<span class="source-line-no">2058</span><span id="line-2058">                        }</span>
<span class="source-line-no">2059</span><span id="line-2059">                        break;</span>
<span class="source-line-no">2060</span><span id="line-2060">                    case 3:     //Line1 is below the line</span>
<span class="source-line-no">2061</span><span id="line-2061">                        if (m1 &lt;= 0) {</span>
<span class="source-line-no">2062</span><span id="line-2062">                            dy = -m1 * dWidth / Math.sqrt(1 + m1 * m1); //dy is positive</span>
<span class="source-line-no">2063</span><span id="line-2063">                            dx = dy / m1;       //dx is positive</span>
<span class="source-line-no">2064</span><span id="line-2064">                            X.value[0] = p2.x + dx;</span>
<span class="source-line-no">2065</span><span id="line-2065">                            Y.value[0] = p2.y + dy;</span>
<span class="source-line-no">2066</span><span id="line-2066">                        } else {</span>
<span class="source-line-no">2067</span><span id="line-2067">                            dy = m1 * dWidth / Math.sqrt(1 + m1 * m1);  //dy is positive</span>
<span class="source-line-no">2068</span><span id="line-2068">                            dx = -dy / m1;      //dx is negative</span>
<span class="source-line-no">2069</span><span id="line-2069">                            X.value[0] = p2.x + dx;</span>
<span class="source-line-no">2070</span><span id="line-2070">                            Y.value[0] = p2.y + dy;</span>
<span class="source-line-no">2071</span><span id="line-2071">                        }</span>
<span class="source-line-no">2072</span><span id="line-2072">                        break;</span>
<span class="source-line-no">2073</span><span id="line-2073">                    default:</span>
<span class="source-line-no">2074</span><span id="line-2074">                        X.value[0] = p2.x;</span>
<span class="source-line-no">2075</span><span id="line-2075">                        Y.value[0] = p2.y;</span>
<span class="source-line-no">2076</span><span id="line-2076">                        break;</span>
<span class="source-line-no">2077</span><span id="line-2077">                }</span>
<span class="source-line-no">2078</span><span id="line-2078">                return 1;</span>
<span class="source-line-no">2079</span><span id="line-2079">            }//end if</span>
<span class="source-line-no">2080</span><span id="line-2080"></span>
<span class="source-line-no">2081</span><span id="line-2081">            //a normal line. no vertical or identical slopes</span>
<span class="source-line-no">2082</span><span id="line-2082">            //if m1=m2 function will not reach this point</span>
<span class="source-line-no">2083</span><span id="line-2083">            X.value[0] = (b2 - b1) / (m1 - m2); //intersect the lines</span>
<span class="source-line-no">2084</span><span id="line-2084">            Y.value[0] = (m1 * (X.value[0]) + b1);</span>
<span class="source-line-no">2085</span><span id="line-2085">            return 1;</span>
<span class="source-line-no">2086</span><span id="line-2086">        }//end try</span>
<span class="source-line-no">2087</span><span id="line-2087">        catch (Exception exc) {</span>
<span class="source-line-no">2088</span><span id="line-2088">            X.value[0] = p2.x;</span>
<span class="source-line-no">2089</span><span id="line-2089">            Y.value[0] = p2.y;</span>
<span class="source-line-no">2090</span><span id="line-2090">            ErrorLogger.LogException(_className, "CalcTrueIntersectDouble",</span>
<span class="source-line-no">2091</span><span id="line-2091">                    new RendererException("Failed inside ExtendTrueIntersectDouble", exc));</span>
<span class="source-line-no">2092</span><span id="line-2092">        }</span>
<span class="source-line-no">2093</span><span id="line-2093">        return 1;</span>
<span class="source-line-no">2094</span><span id="line-2094">    }</span>
<span class="source-line-no">2095</span><span id="line-2095"></span>
<span class="source-line-no">2096</span><span id="line-2096">    /**</span>
<span class="source-line-no">2097</span><span id="line-2097">     * Returns the distance in pixels from x1,y1 to x2,y2</span>
<span class="source-line-no">2098</span><span id="line-2098">     *</span>
<span class="source-line-no">2099</span><span id="line-2099">     * @param x1 first point x location in pixels</span>
<span class="source-line-no">2100</span><span id="line-2100">     * @param y1 first point y location in pixels</span>
<span class="source-line-no">2101</span><span id="line-2101">     * @param x2 second point x location in pixels</span>
<span class="source-line-no">2102</span><span id="line-2102">     * @param y2 second point y location in pixels</span>
<span class="source-line-no">2103</span><span id="line-2103">     *</span>
<span class="source-line-no">2104</span><span id="line-2104">     * @return the distance</span>
<span class="source-line-no">2105</span><span id="line-2105">     */</span>
<span class="source-line-no">2106</span><span id="line-2106">    protected static double CalcDistance2(long x1,</span>
<span class="source-line-no">2107</span><span id="line-2107">            long y1,</span>
<span class="source-line-no">2108</span><span id="line-2108">            long x2,</span>
<span class="source-line-no">2109</span><span id="line-2109">            long y2) {</span>
<span class="source-line-no">2110</span><span id="line-2110">        double dResult = 0;</span>
<span class="source-line-no">2111</span><span id="line-2111">        try {</span>
<span class="source-line-no">2112</span><span id="line-2112">            dResult = Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));</span>
<span class="source-line-no">2113</span><span id="line-2113"></span>
<span class="source-line-no">2114</span><span id="line-2114">            //sanity check</span>
<span class="source-line-no">2115</span><span id="line-2115">            //return x or y distance if return value is 0 or infinity</span>
<span class="source-line-no">2116</span><span id="line-2116">            double xdist = Math.abs(x1 - x2);</span>
<span class="source-line-no">2117</span><span id="line-2117">            double ydist = Math.abs(y1 - y2);</span>
<span class="source-line-no">2118</span><span id="line-2118">            double max = xdist;</span>
<span class="source-line-no">2119</span><span id="line-2119">            if (ydist &gt; xdist) {</span>
<span class="source-line-no">2120</span><span id="line-2120">                max = ydist;</span>
<span class="source-line-no">2121</span><span id="line-2121">            }</span>
<span class="source-line-no">2122</span><span id="line-2122">            if (dResult == 0 || Double.isInfinite(dResult)) {</span>
<span class="source-line-no">2123</span><span id="line-2123">                if (max &gt; 0) {</span>
<span class="source-line-no">2124</span><span id="line-2124">                    dResult = max;</span>
<span class="source-line-no">2125</span><span id="line-2125">                }</span>
<span class="source-line-no">2126</span><span id="line-2126">            }</span>
<span class="source-line-no">2127</span><span id="line-2127">        } catch (Exception exc) {</span>
<span class="source-line-no">2128</span><span id="line-2128">            ErrorLogger.LogException(_className, "CalcDistance2",</span>
<span class="source-line-no">2129</span><span id="line-2129">                    new RendererException("Failed inside CalcDistance2", exc));</span>
<span class="source-line-no">2130</span><span id="line-2130">        }</span>
<span class="source-line-no">2131</span><span id="line-2131">        return dResult;</span>
<span class="source-line-no">2132</span><span id="line-2132">    }</span>
<span class="source-line-no">2133</span><span id="line-2133">    /**</span>
<span class="source-line-no">2134</span><span id="line-2134">     * gets the middle line for Rev B air corridors AC, LLTR, MRR, UAV</span>
<span class="source-line-no">2135</span><span id="line-2135">     * Middle line is handled separately now because the line may have been segmented</span>
<span class="source-line-no">2136</span><span id="line-2136">     * @param pLinePoints</span>
<span class="source-line-no">2137</span><span id="line-2137">     * @return </span>
<span class="source-line-no">2138</span><span id="line-2138">     */</span>
<span class="source-line-no">2139</span><span id="line-2139">    protected static POINT2[] GetSAAFRMiddleLine(POINT2[] pLinePoints) {</span>
<span class="source-line-no">2140</span><span id="line-2140">        POINT2[] pts = null;</span>
<span class="source-line-no">2141</span><span id="line-2141">        try {</span>
<span class="source-line-no">2142</span><span id="line-2142">            int j = 0, count = 0;</span>
<span class="source-line-no">2143</span><span id="line-2143">            for (j = 0; j &lt; pLinePoints.length-1; j++) {</span>
<span class="source-line-no">2144</span><span id="line-2144">                if (pLinePoints[j].style &gt; 0) {</span>
<span class="source-line-no">2145</span><span id="line-2145">                    count++;</span>
<span class="source-line-no">2146</span><span id="line-2146">                }</span>
<span class="source-line-no">2147</span><span id="line-2147">            }</span>
<span class="source-line-no">2148</span><span id="line-2148">            pts = new POINT2[count*2];</span>
<span class="source-line-no">2149</span><span id="line-2149">            count=0;</span>
<span class="source-line-no">2150</span><span id="line-2150">            double dMRR=0;</span>
<span class="source-line-no">2151</span><span id="line-2151">            POINT2 firstSegPt=null,lastSegPt=null,pt0=null,pt1=null;</span>
<span class="source-line-no">2152</span><span id="line-2152">            for (j = 0; j &lt; pLinePoints.length; j++) {</span>
<span class="source-line-no">2153</span><span id="line-2153">                if(pLinePoints[j].style&gt;=0 || j==pLinePoints.length-1)</span>
<span class="source-line-no">2154</span><span id="line-2154">                {</span>
<span class="source-line-no">2155</span><span id="line-2155">                    if(lastSegPt != null)</span>
<span class="source-line-no">2156</span><span id="line-2156">                    {</span>
<span class="source-line-no">2157</span><span id="line-2157">                        firstSegPt=new POINT2(lastSegPt);</span>
<span class="source-line-no">2158</span><span id="line-2158">                        lastSegPt=new POINT2(pLinePoints[j]);</span>
<span class="source-line-no">2159</span><span id="line-2159">                        dMRR=firstSegPt.style;</span>
<span class="source-line-no">2160</span><span id="line-2160">                        pt0 = ExtendLine2Double(lastSegPt, firstSegPt, -dMRR, 0);</span>
<span class="source-line-no">2161</span><span id="line-2161">                        pt1 = ExtendLine2Double(firstSegPt, lastSegPt, -dMRR, 5);                        </span>
<span class="source-line-no">2162</span><span id="line-2162">                        pts[count++]=pt0;</span>
<span class="source-line-no">2163</span><span id="line-2163">                        pts[count++]=pt1;</span>
<span class="source-line-no">2164</span><span id="line-2164">                    }</span>
<span class="source-line-no">2165</span><span id="line-2165">                    else</span>
<span class="source-line-no">2166</span><span id="line-2166">                    {</span>
<span class="source-line-no">2167</span><span id="line-2167">                        lastSegPt=new POINT2(pLinePoints[j]);</span>
<span class="source-line-no">2168</span><span id="line-2168">                    }</span>
<span class="source-line-no">2169</span><span id="line-2169">                }</span>
<span class="source-line-no">2170</span><span id="line-2170">            }            </span>
<span class="source-line-no">2171</span><span id="line-2171">        } catch (Exception exc) {</span>
<span class="source-line-no">2172</span><span id="line-2172">            ErrorLogger.LogException(_className, "GetSAAFRMiddleLine",</span>
<span class="source-line-no">2173</span><span id="line-2173">                    new RendererException("Failed inside GetSAAFRMiddleLine", exc));</span>
<span class="source-line-no">2174</span><span id="line-2174">        }</span>
<span class="source-line-no">2175</span><span id="line-2175">        return pts;</span>
<span class="source-line-no">2176</span><span id="line-2176">    }</span>
<span class="source-line-no">2177</span><span id="line-2177">    /**</span>
<span class="source-line-no">2178</span><span id="line-2178">     * Computes the points for a SAAFR segment</span>
<span class="source-line-no">2179</span><span id="line-2179">     *</span>
<span class="source-line-no">2180</span><span id="line-2180">     * @param pLinePoints OUT - the client points also used for the returned</span>
<span class="source-line-no">2181</span><span id="line-2181">     * points</span>
<span class="source-line-no">2182</span><span id="line-2182">     * @param lineType the line type</span>
<span class="source-line-no">2183</span><span id="line-2183">     * @param dMRR the symbol width</span>
<span class="source-line-no">2184</span><span id="line-2184">     */</span>
<span class="source-line-no">2185</span><span id="line-2185">    protected static void GetSAAFRSegment(POINT2[] pLinePoints,</span>
<span class="source-line-no">2186</span><span id="line-2186">            int lineType,</span>
<span class="source-line-no">2187</span><span id="line-2187">            double dMRR) {</span>
<span class="source-line-no">2188</span><span id="line-2188">        try {</span>
<span class="source-line-no">2189</span><span id="line-2189">            POINT2 pt0 = new POINT2();</span>
<span class="source-line-no">2190</span><span id="line-2190">            POINT2 pt1 = new POINT2();</span>
<span class="source-line-no">2191</span><span id="line-2191">            POINT2 pt2 = new POINT2();</span>
<span class="source-line-no">2192</span><span id="line-2192">            POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">2193</span><span id="line-2193">            POINT2 pt4 = new POINT2();</span>
<span class="source-line-no">2194</span><span id="line-2194">            POINT2 pt5 = new POINT2();</span>
<span class="source-line-no">2195</span><span id="line-2195">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">2196</span><span id="line-2196">            int bolVertical = CalcTrueSlopeDouble(pLinePoints[0], pLinePoints[1], m);</span>
<span class="source-line-no">2197</span><span id="line-2197">            //shortened line</span>
<span class="source-line-no">2198</span><span id="line-2198">            //pt1=ExtendLine2Double(pLinePoints[0],pLinePoints[1],-dMRR/2,5);</span>
<span class="source-line-no">2199</span><span id="line-2199">            //pt0=ExtendLine2Double(pLinePoints[1],pLinePoints[0],-dMRR/2,0);</span>
<span class="source-line-no">2200</span><span id="line-2200">            pt1 = ExtendLine2Double(pLinePoints[0], pLinePoints[1], -dMRR, 5);</span>
<span class="source-line-no">2201</span><span id="line-2201">            pt0 = ExtendLine2Double(pLinePoints[1], pLinePoints[0], -dMRR, 0);</span>
<span class="source-line-no">2202</span><span id="line-2202">            if (bolVertical != 0 &amp;&amp; m.value[0] &lt; 1) {</span>
<span class="source-line-no">2203</span><span id="line-2203">                //upper line</span>
<span class="source-line-no">2204</span><span id="line-2204">                pt2 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 2, dMRR);</span>
<span class="source-line-no">2205</span><span id="line-2205">                pt2.style = 0;</span>
<span class="source-line-no">2206</span><span id="line-2206">                pt3 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 2, dMRR);</span>
<span class="source-line-no">2207</span><span id="line-2207">                pt3.style = 5;</span>
<span class="source-line-no">2208</span><span id="line-2208">                //lower line</span>
<span class="source-line-no">2209</span><span id="line-2209">                pt4 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 3, dMRR);</span>
<span class="source-line-no">2210</span><span id="line-2210">                pt4.style = 0;</span>
<span class="source-line-no">2211</span><span id="line-2211">                pt5 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 3, dMRR);</span>
<span class="source-line-no">2212</span><span id="line-2212">                pt5.style = 5;</span>
<span class="source-line-no">2213</span><span id="line-2213">            } //if( (bolVertical!=0 &amp;&amp; m&gt;1) || bolVertical==0)</span>
<span class="source-line-no">2214</span><span id="line-2214">            else {</span>
<span class="source-line-no">2215</span><span id="line-2215">                //left line</span>
<span class="source-line-no">2216</span><span id="line-2216">                pt2 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 0, dMRR);</span>
<span class="source-line-no">2217</span><span id="line-2217">                pt2.style = 0;</span>
<span class="source-line-no">2218</span><span id="line-2218">                pt3 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 0, dMRR);</span>
<span class="source-line-no">2219</span><span id="line-2219">                pt3.style = 5;</span>
<span class="source-line-no">2220</span><span id="line-2220">                //right line</span>
<span class="source-line-no">2221</span><span id="line-2221">                pt4 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 1, dMRR);</span>
<span class="source-line-no">2222</span><span id="line-2222">                pt4.style = 0;</span>
<span class="source-line-no">2223</span><span id="line-2223">                pt5 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 1, dMRR);</span>
<span class="source-line-no">2224</span><span id="line-2224">                pt5.style = 5;</span>
<span class="source-line-no">2225</span><span id="line-2225">            }</span>
<span class="source-line-no">2226</span><span id="line-2226">            //load the line points</span>
<span class="source-line-no">2227</span><span id="line-2227">            pLinePoints[0] = new POINT2(pt0);</span>
<span class="source-line-no">2228</span><span id="line-2228">            pLinePoints[1] = new POINT2(pt1);</span>
<span class="source-line-no">2229</span><span id="line-2229">            pLinePoints[2] = new POINT2(pt2);</span>
<span class="source-line-no">2230</span><span id="line-2230">            pLinePoints[3] = new POINT2(pt3);</span>
<span class="source-line-no">2231</span><span id="line-2231">            pLinePoints[4] = new POINT2(pt4);</span>
<span class="source-line-no">2232</span><span id="line-2232">            pLinePoints[5] = new POINT2(pt5);</span>
<span class="source-line-no">2233</span><span id="line-2233">            pLinePoints[5].style = 5;</span>
<span class="source-line-no">2234</span><span id="line-2234">            pLinePoints[0].style = 5;</span>
<span class="source-line-no">2235</span><span id="line-2235">        } catch (Exception exc) {</span>
<span class="source-line-no">2236</span><span id="line-2236">            ErrorLogger.LogException(_className, "GetSAAFRSegment",</span>
<span class="source-line-no">2237</span><span id="line-2237">                    new RendererException("Failed inside GetSAAFRSegment", exc));</span>
<span class="source-line-no">2238</span><span id="line-2238">        }</span>
<span class="source-line-no">2239</span><span id="line-2239">    }</span>
<span class="source-line-no">2240</span><span id="line-2240">    /**</span>
<span class="source-line-no">2241</span><span id="line-2241">     * Called by arraysupport for SAAFR and AC fill shapes</span>
<span class="source-line-no">2242</span><span id="line-2242">     * @param pLinePoints</span>
<span class="source-line-no">2243</span><span id="line-2243">     * @param dMRR</span>
<span class="source-line-no">2244</span><span id="line-2244">     */</span>
<span class="source-line-no">2245</span><span id="line-2245">    protected static void GetSAAFRFillSegment(POINT2[] pLinePoints,</span>
<span class="source-line-no">2246</span><span id="line-2246">            double dMRR) {</span>
<span class="source-line-no">2247</span><span id="line-2247">        try {</span>
<span class="source-line-no">2248</span><span id="line-2248">            POINT2 pt2 = new POINT2();</span>
<span class="source-line-no">2249</span><span id="line-2249">            POINT2 pt3 = new POINT2();</span>
<span class="source-line-no">2250</span><span id="line-2250">            POINT2 pt4 = new POINT2();</span>
<span class="source-line-no">2251</span><span id="line-2251">            POINT2 pt5 = new POINT2();</span>
<span class="source-line-no">2252</span><span id="line-2252">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">2253</span><span id="line-2253">            int bolVertical = CalcTrueSlopeDouble(pLinePoints[0], pLinePoints[1], m);</span>
<span class="source-line-no">2254</span><span id="line-2254">            if (bolVertical != 0 &amp;&amp; m.value[0] &lt; 1) {</span>
<span class="source-line-no">2255</span><span id="line-2255">                //upper line</span>
<span class="source-line-no">2256</span><span id="line-2256">                pt2 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 2, dMRR);</span>
<span class="source-line-no">2257</span><span id="line-2257">                pt3 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 2, dMRR);</span>
<span class="source-line-no">2258</span><span id="line-2258">                //lower line</span>
<span class="source-line-no">2259</span><span id="line-2259">                pt4 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 3, dMRR);</span>
<span class="source-line-no">2260</span><span id="line-2260">                pt5 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 3, dMRR);</span>
<span class="source-line-no">2261</span><span id="line-2261">            } //if( (bolVertical!=0 &amp;&amp; m&gt;1) || bolVertical==0)</span>
<span class="source-line-no">2262</span><span id="line-2262">            else {</span>
<span class="source-line-no">2263</span><span id="line-2263">                //left line</span>
<span class="source-line-no">2264</span><span id="line-2264">                pt2 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 0, dMRR);</span>
<span class="source-line-no">2265</span><span id="line-2265">                pt3 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 0, dMRR);</span>
<span class="source-line-no">2266</span><span id="line-2266">                //right line</span>
<span class="source-line-no">2267</span><span id="line-2267">                pt4 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[0], 1, dMRR);</span>
<span class="source-line-no">2268</span><span id="line-2268">                pt5 = ExtendDirectedLine(pLinePoints[0], pLinePoints[1], pLinePoints[1], 1, dMRR);</span>
<span class="source-line-no">2269</span><span id="line-2269">            }</span>
<span class="source-line-no">2270</span><span id="line-2270">            //load the line points</span>
<span class="source-line-no">2271</span><span id="line-2271">            pLinePoints[0] = new POINT2(pt2);</span>
<span class="source-line-no">2272</span><span id="line-2272">            pLinePoints[1] = new POINT2(pt3);</span>
<span class="source-line-no">2273</span><span id="line-2273">            pLinePoints[2] = new POINT2(pt5);</span>
<span class="source-line-no">2274</span><span id="line-2274">            pLinePoints[3] = new POINT2(pt4);</span>
<span class="source-line-no">2275</span><span id="line-2275">        } catch (Exception exc) {</span>
<span class="source-line-no">2276</span><span id="line-2276">            ErrorLogger.LogException(_className, "GetSAAFRFillSegment",</span>
<span class="source-line-no">2277</span><span id="line-2277">                    new RendererException("Failed inside GetSAAFRFillSegment", exc));</span>
<span class="source-line-no">2278</span><span id="line-2278">        }</span>
<span class="source-line-no">2279</span><span id="line-2279">        //return;</span>
<span class="source-line-no">2280</span><span id="line-2280">    }</span>
<span class="source-line-no">2281</span><span id="line-2281">    /**</span>
<span class="source-line-no">2282</span><span id="line-2282">     * Computes an arc.</span>
<span class="source-line-no">2283</span><span id="line-2283">     *</span>
<span class="source-line-no">2284</span><span id="line-2284">     * @param pResultLinePoints OUT - contains center and start point and holds</span>
<span class="source-line-no">2285</span><span id="line-2285">     * the result arc points</span>
<span class="source-line-no">2286</span><span id="line-2286">     * @param vblCounter the number of client points</span>
<span class="source-line-no">2287</span><span id="line-2287">     * @param dRadius the arc radius in pixels</span>
<span class="source-line-no">2288</span><span id="line-2288">     * @param linetype the linetype determines start andgle and end angle for</span>
<span class="source-line-no">2289</span><span id="line-2289">     * the arc</span>
<span class="source-line-no">2290</span><span id="line-2290">     *</span>
<span class="source-line-no">2291</span><span id="line-2291">     */</span>
<span class="source-line-no">2292</span><span id="line-2292">    protected static POINT2[] ArcArrayDouble(POINT2[] pResultLinePoints,</span>
<span class="source-line-no">2293</span><span id="line-2293">            int vblCounter,</span>
<span class="source-line-no">2294</span><span id="line-2294">            double dRadius,</span>
<span class="source-line-no">2295</span><span id="line-2295">            int linetype,</span>
<span class="source-line-no">2296</span><span id="line-2296">            IPointConversion converter) {</span>
<span class="source-line-no">2297</span><span id="line-2297">        try {</span>
<span class="source-line-no">2298</span><span id="line-2298">            //declarations</span>
<span class="source-line-no">2299</span><span id="line-2299">            double startangle = 0, //start of pArcLinePoints</span>
<span class="source-line-no">2300</span><span id="line-2300">                    endangle = 0, //end of the pArcLinePoints</span>
<span class="source-line-no">2301</span><span id="line-2301">                    increment = 0,</span>
<span class="source-line-no">2302</span><span id="line-2302">                    //m = 0,</span>
<span class="source-line-no">2303</span><span id="line-2303">                    length = 0, //length of a to e</span>
<span class="source-line-no">2304</span><span id="line-2304">                    M = 0;</span>
<span class="source-line-no">2305</span><span id="line-2305"></span>
<span class="source-line-no">2306</span><span id="line-2306">            int j, numarcpts = 0, bolVertical = 0;</span>
<span class="source-line-no">2307</span><span id="line-2307">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">2308</span><span id="line-2308">            //C is the center of the pArcLinePoints derived from a and e</span>
<span class="source-line-no">2309</span><span id="line-2309">            POINT2 C = new POINT2(pResultLinePoints[0]),</span>
<span class="source-line-no">2310</span><span id="line-2310">                    a = new POINT2(pResultLinePoints[1]),</span>
<span class="source-line-no">2311</span><span id="line-2311">                    e = new POINT2(pResultLinePoints[0]);</span>
<span class="source-line-no">2312</span><span id="line-2312"></span>
<span class="source-line-no">2313</span><span id="line-2313">            POINT2[] pArcLinePoints = null;</span>
<span class="source-line-no">2314</span><span id="line-2314">            //end declarations</span>
<span class="source-line-no">2315</span><span id="line-2315"></span>
<span class="source-line-no">2316</span><span id="line-2316">            bolVertical = CalcTrueSlopeDouble(a, e, m);</span>
<span class="source-line-no">2317</span><span id="line-2317">            if (bolVertical != 0) {</span>
<span class="source-line-no">2318</span><span id="line-2318">                M = Math.atan(m.value[0]);</span>
<span class="source-line-no">2319</span><span id="line-2319">            } else {</span>
<span class="source-line-no">2320</span><span id="line-2320">                if (a.y &lt; e.y) {</span>
<span class="source-line-no">2321</span><span id="line-2321">                    M = -Math.PI / 2;</span>
<span class="source-line-no">2322</span><span id="line-2322">                } else {</span>
<span class="source-line-no">2323</span><span id="line-2323">                    M = Math.PI / 2;</span>
<span class="source-line-no">2324</span><span id="line-2324">                }</span>
<span class="source-line-no">2325</span><span id="line-2325">            }</span>
<span class="source-line-no">2326</span><span id="line-2326">            if(converter != null)</span>
<span class="source-line-no">2327</span><span id="line-2327">            {</span>
<span class="source-line-no">2328</span><span id="line-2328">                Point2D pt02d=new Point2D.Double(pResultLinePoints[0].x,pResultLinePoints[0].y);</span>
<span class="source-line-no">2329</span><span id="line-2329">                Point2D pt12d=new Point2D.Double(pResultLinePoints[1].x,pResultLinePoints[1].y);</span>
<span class="source-line-no">2330</span><span id="line-2330">                //boolean reverseM=false;</span>
<span class="source-line-no">2331</span><span id="line-2331">                pt02d=converter.PixelsToGeo(pt02d);</span>
<span class="source-line-no">2332</span><span id="line-2332">                pt12d=converter.PixelsToGeo(pt12d);</span>
<span class="source-line-no">2333</span><span id="line-2333">                //M=mdlGeodesic.GetAzimuth(pt02d,pt12d);</span>
<span class="source-line-no">2334</span><span id="line-2334">                M= mdlGeodesic.GetAzimuth(new POINT2(pt02d.getX(),pt02d.getY()),new POINT2(pt12d.getX(),pt12d.getY()  )  );</span>
<span class="source-line-no">2335</span><span id="line-2335">                M*=(Math.PI/180);</span>
<span class="source-line-no">2336</span><span id="line-2336">                if(M&lt;0)</span>
<span class="source-line-no">2337</span><span id="line-2337">                    M+=Math.PI;</span>
<span class="source-line-no">2338</span><span id="line-2338">            }</span>
<span class="source-line-no">2339</span><span id="line-2339">            length = CalcDistanceDouble(a, e);</span>
<span class="source-line-no">2340</span><span id="line-2340">            if(converter != null)</span>
<span class="source-line-no">2341</span><span id="line-2341">            {</span>
<span class="source-line-no">2342</span><span id="line-2342">                Point2D pt02d=new Point2D.Double(pResultLinePoints[0].x,pResultLinePoints[0].y);</span>
<span class="source-line-no">2343</span><span id="line-2343">                Point2D pt12d=new Point2D.Double(pResultLinePoints[1].x,pResultLinePoints[1].y);</span>
<span class="source-line-no">2344</span><span id="line-2344">                pt02d=converter.PixelsToGeo(pt02d);</span>
<span class="source-line-no">2345</span><span id="line-2345">                pt12d=converter.PixelsToGeo(pt12d);</span>
<span class="source-line-no">2346</span><span id="line-2346">                //length=mdlGeodesic.geodesic_distance(pt02d,pt12d,null,null);</span>
<span class="source-line-no">2347</span><span id="line-2347">                length=mdlGeodesic.geodesic_distance(new POINT2(pt02d.getX(),pt02d.getY()),new POINT2(pt12d.getX(),pt12d.getY()),null,null);</span>
<span class="source-line-no">2348</span><span id="line-2348">            }</span>
<span class="source-line-no">2349</span><span id="line-2349">            switch (linetype) {</span>
<span class="source-line-no">2350</span><span id="line-2350">                case TacticalLines.CLUSTER:</span>
<span class="source-line-no">2351</span><span id="line-2351">                    startangle = M - 90 * Math.PI / 180.0;</span>
<span class="source-line-no">2352</span><span id="line-2352">                    endangle = startangle + 2 * 90 * Math.PI / 180.0;</span>
<span class="source-line-no">2353</span><span id="line-2353">                    break;</span>
<span class="source-line-no">2354</span><span id="line-2354">                case TacticalLines.TRIP:</span>
<span class="source-line-no">2355</span><span id="line-2355">                    startangle = M - 45 * Math.PI / 180.0;</span>
<span class="source-line-no">2356</span><span id="line-2356">                    endangle = startangle + 2 * 45 * Math.PI / 180.0;</span>
<span class="source-line-no">2357</span><span id="line-2357">                    break;</span>
<span class="source-line-no">2358</span><span id="line-2358">                case TacticalLines.ISOLATE:</span>
<span class="source-line-no">2359</span><span id="line-2359">                case TacticalLines.CORDONKNOCK:</span>
<span class="source-line-no">2360</span><span id="line-2360">                case TacticalLines.CORDONSEARCH:</span>
<span class="source-line-no">2361</span><span id="line-2361">                    startangle = M;</span>
<span class="source-line-no">2362</span><span id="line-2362">                    endangle = startangle + 330 * Math.PI / 180;</span>
<span class="source-line-no">2363</span><span id="line-2363">                    break;</span>
<span class="source-line-no">2364</span><span id="line-2364">                case TacticalLines.TURN:</span>
<span class="source-line-no">2365</span><span id="line-2365">                    startangle = M;</span>
<span class="source-line-no">2366</span><span id="line-2366">                    endangle = startangle + 90 * Math.PI / 180;</span>
<span class="source-line-no">2367</span><span id="line-2367">                    break;</span>
<span class="source-line-no">2368</span><span id="line-2368">                case TacticalLines.OCCUPY:</span>
<span class="source-line-no">2369</span><span id="line-2369">                case TacticalLines.RETAIN:</span>
<span class="source-line-no">2370</span><span id="line-2370">                case TacticalLines.SECURE:</span>
<span class="source-line-no">2371</span><span id="line-2371">                    startangle = M;</span>
<span class="source-line-no">2372</span><span id="line-2372">                    //if(CELineArrayGlobals.Change1==false)</span>
<span class="source-line-no">2373</span><span id="line-2373">                    endangle = startangle + 338 * Math.PI / 180;</span>
<span class="source-line-no">2374</span><span id="line-2374">                    //else</span>
<span class="source-line-no">2375</span><span id="line-2375">                    //  endangle=startangle+330*pi/180;</span>
<span class="source-line-no">2376</span><span id="line-2376">                    break;</span>
<span class="source-line-no">2377</span><span id="line-2377">                default:</span>
<span class="source-line-no">2378</span><span id="line-2378">                    startangle = 0;</span>
<span class="source-line-no">2379</span><span id="line-2379">                    endangle = 2 * Math.PI;</span>
<span class="source-line-no">2380</span><span id="line-2380">                    break;</span>
<span class="source-line-no">2381</span><span id="line-2381">            }</span>
<span class="source-line-no">2382</span><span id="line-2382"></span>
<span class="source-line-no">2383</span><span id="line-2383">            if (a.x &lt; e.x) {</span>
<span class="source-line-no">2384</span><span id="line-2384">                switch (linetype) {</span>
<span class="source-line-no">2385</span><span id="line-2385">                    case TacticalLines.ISOLATE:</span>
<span class="source-line-no">2386</span><span id="line-2386">                    case TacticalLines.CORDONKNOCK:</span>
<span class="source-line-no">2387</span><span id="line-2387">                    case TacticalLines.CORDONSEARCH:</span>
<span class="source-line-no">2388</span><span id="line-2388">                        startangle = M - Math.PI;</span>
<span class="source-line-no">2389</span><span id="line-2389">                        endangle = startangle + 330 * Math.PI / 180;</span>
<span class="source-line-no">2390</span><span id="line-2390">                        break;</span>
<span class="source-line-no">2391</span><span id="line-2391">                    case TacticalLines.OCCUPY:</span>
<span class="source-line-no">2392</span><span id="line-2392">                    case TacticalLines.RETAIN:</span>
<span class="source-line-no">2393</span><span id="line-2393">                    case TacticalLines.SECURE:</span>
<span class="source-line-no">2394</span><span id="line-2394">                        startangle = M - Math.PI;</span>
<span class="source-line-no">2395</span><span id="line-2395">                        //if(CELineArrayGlobals.Change1==false)</span>
<span class="source-line-no">2396</span><span id="line-2396">                        endangle = startangle + 338 * Math.PI / 180;</span>
<span class="source-line-no">2397</span><span id="line-2397">                        //else</span>
<span class="source-line-no">2398</span><span id="line-2398">                        //      endangle=startangle+330*pi/180;</span>
<span class="source-line-no">2399</span><span id="line-2399">                        break;</span>
<span class="source-line-no">2400</span><span id="line-2400">                    case TacticalLines.TURN:</span>
<span class="source-line-no">2401</span><span id="line-2401">                        startangle = M - Math.PI;</span>
<span class="source-line-no">2402</span><span id="line-2402">                        endangle = startangle + 90 * Math.PI / 180;</span>
<span class="source-line-no">2403</span><span id="line-2403">                        break;</span>
<span class="source-line-no">2404</span><span id="line-2404">                    case TacticalLines.CLUSTER:</span>
<span class="source-line-no">2405</span><span id="line-2405">                        startangle = M - Math.PI + 90 * Math.PI / 180.0;</span>
<span class="source-line-no">2406</span><span id="line-2406">                        endangle = startangle - 2 * 90 * Math.PI / 180.0;</span>
<span class="source-line-no">2407</span><span id="line-2407">                        break;</span>
<span class="source-line-no">2408</span><span id="line-2408">                    case TacticalLines.TRIP:</span>
<span class="source-line-no">2409</span><span id="line-2409">                        startangle = M - Math.PI + 45 * Math.PI / 180.0;</span>
<span class="source-line-no">2410</span><span id="line-2410">                        endangle = startangle - 2 * 45 * Math.PI / 180.0;</span>
<span class="source-line-no">2411</span><span id="line-2411">                        break;</span>
<span class="source-line-no">2412</span><span id="line-2412">                    default:</span>
<span class="source-line-no">2413</span><span id="line-2413">                        break;</span>
<span class="source-line-no">2414</span><span id="line-2414">                }</span>
<span class="source-line-no">2415</span><span id="line-2415">            }</span>
<span class="source-line-no">2416</span><span id="line-2416"></span>
<span class="source-line-no">2417</span><span id="line-2417">            numarcpts = 26;</span>
<span class="source-line-no">2418</span><span id="line-2418">            pArcLinePoints = new POINT2[numarcpts];</span>
<span class="source-line-no">2419</span><span id="line-2419">            InitializePOINT2Array(pArcLinePoints);</span>
<span class="source-line-no">2420</span><span id="line-2420">            increment = (endangle - startangle) / (numarcpts - 1);</span>
<span class="source-line-no">2421</span><span id="line-2421">            if(dRadius != 0 &amp;&amp; length != 0)</span>
<span class="source-line-no">2422</span><span id="line-2422">            {</span>
<span class="source-line-no">2423</span><span id="line-2423">                C.x = (int) ((double) e.x - (dRadius / length)</span>
<span class="source-line-no">2424</span><span id="line-2424">                        * ((double) a.x - (double) e.x));</span>
<span class="source-line-no">2425</span><span id="line-2425">                C.y = (int) ((double) e.y - (dRadius / length)</span>
<span class="source-line-no">2426</span><span id="line-2426">                        * ((double) a.y - (double) e.y));</span>
<span class="source-line-no">2427</span><span id="line-2427">            }</span>
<span class="source-line-no">2428</span><span id="line-2428">            else</span>
<span class="source-line-no">2429</span><span id="line-2429">            {</span>
<span class="source-line-no">2430</span><span id="line-2430">                C.x=e.x;</span>
<span class="source-line-no">2431</span><span id="line-2431">                C.y=e.y;</span>
<span class="source-line-no">2432</span><span id="line-2432">            }</span>
<span class="source-line-no">2433</span><span id="line-2433">            if (converter != null)</span>
<span class="source-line-no">2434</span><span id="line-2434">            {</span>
<span class="source-line-no">2435</span><span id="line-2435">                Point2D C2d=new Point2D.Double(pResultLinePoints[0].x,pResultLinePoints[0].y);</span>
<span class="source-line-no">2436</span><span id="line-2436">                C2d=converter.PixelsToGeo(C2d);    </span>
<span class="source-line-no">2437</span><span id="line-2437">                double az=0;</span>
<span class="source-line-no">2438</span><span id="line-2438">                Point2D ptGeo2d=null;</span>
<span class="source-line-no">2439</span><span id="line-2439">                POINT2 ptGeo=null;</span>
<span class="source-line-no">2440</span><span id="line-2440">                POINT2 ptPixels=null;</span>
<span class="source-line-no">2441</span><span id="line-2441">                for (j = 0; j &lt; numarcpts; j++) {</span>
<span class="source-line-no">2442</span><span id="line-2442">                    az=startangle*180/Math.PI+j*increment*180/Math.PI;</span>
<span class="source-line-no">2443</span><span id="line-2443">                    //ptGeo=mdlGeodesic.geodesic_coordinate(C2d,length,az);</span>
<span class="source-line-no">2444</span><span id="line-2444">                    ptGeo=mdlGeodesic.geodesic_coordinate(new POINT2(C2d.getX(),C2d.getY()),length,az);</span>
<span class="source-line-no">2445</span><span id="line-2445">                    ptGeo2d=new Point2D.Double(ptGeo.x,ptGeo.y);</span>
<span class="source-line-no">2446</span><span id="line-2446">                    ptGeo2d=converter.GeoToPixels(ptGeo2d);</span>
<span class="source-line-no">2447</span><span id="line-2447">                    ptPixels=new POINT2(ptGeo2d.getX(),ptGeo2d.getY());</span>
<span class="source-line-no">2448</span><span id="line-2448">                    pArcLinePoints[j].x = ptPixels.x;</span>
<span class="source-line-no">2449</span><span id="line-2449">                    pArcLinePoints[j].y = ptPixels.y;                            </span>
<span class="source-line-no">2450</span><span id="line-2450">                }</span>
<span class="source-line-no">2451</span><span id="line-2451">            }</span>
<span class="source-line-no">2452</span><span id="line-2452">            else</span>
<span class="source-line-no">2453</span><span id="line-2453">            {</span>
<span class="source-line-no">2454</span><span id="line-2454">                for (j = 0; j &lt; numarcpts; j++) {</span>
<span class="source-line-no">2455</span><span id="line-2455">                    //pArcLinePoints[j]=pResultLinePoints[0];   //initialize</span>
<span class="source-line-no">2456</span><span id="line-2456">                    pArcLinePoints[j].x = (int) (dRadius * Math.cos(startangle + j * increment));</span>
<span class="source-line-no">2457</span><span id="line-2457">                    pArcLinePoints[j].y = (int) (dRadius * Math.sin(startangle + j * increment));</span>
<span class="source-line-no">2458</span><span id="line-2458">                }</span>
<span class="source-line-no">2459</span><span id="line-2459"></span>
<span class="source-line-no">2460</span><span id="line-2460">                for (j = 0; j &lt; numarcpts; j++) {</span>
<span class="source-line-no">2461</span><span id="line-2461">                    pArcLinePoints[j].x += C.x;</span>
<span class="source-line-no">2462</span><span id="line-2462">                    pArcLinePoints[j].y += C.y;</span>
<span class="source-line-no">2463</span><span id="line-2463">                }</span>
<span class="source-line-no">2464</span><span id="line-2464">            }</span>
<span class="source-line-no">2465</span><span id="line-2465">            for (j = 0; j &lt; numarcpts; j++) {</span>
<span class="source-line-no">2466</span><span id="line-2466">                pResultLinePoints[j] = new POINT2(pArcLinePoints[j]);</span>
<span class="source-line-no">2467</span><span id="line-2467">            }</span>
<span class="source-line-no">2468</span><span id="line-2468">            pArcLinePoints = null;</span>
<span class="source-line-no">2469</span><span id="line-2469">        } catch (Exception exc) {</span>
<span class="source-line-no">2470</span><span id="line-2470">            ErrorLogger.LogException(_className, "ArcArrayDouble",</span>
<span class="source-line-no">2471</span><span id="line-2471">                    new RendererException("Failed inside ArcArrayDouble", exc));</span>
<span class="source-line-no">2472</span><span id="line-2472">        }</span>
<span class="source-line-no">2473</span><span id="line-2473">        return pResultLinePoints;</span>
<span class="source-line-no">2474</span><span id="line-2474">    }</span>
<span class="source-line-no">2475</span><span id="line-2475">    /**</span>
<span class="source-line-no">2476</span><span id="line-2476">     * Gets geodesic circle using the converter</span>
<span class="source-line-no">2477</span><span id="line-2477">     * @param Center in pixels</span>
<span class="source-line-no">2478</span><span id="line-2478">     * @param pt1 a point on the radius in pixels</span>
<span class="source-line-no">2479</span><span id="line-2479">     * @param numpts number of points to return</span>
<span class="source-line-no">2480</span><span id="line-2480">     * @param CirclePoints the result points</span>
<span class="source-line-no">2481</span><span id="line-2481">     * @param converter </span>
<span class="source-line-no">2482</span><span id="line-2482">     */</span>
<span class="source-line-no">2483</span><span id="line-2483">    protected static void CalcCircleDouble2(POINT2 Center,</span>
<span class="source-line-no">2484</span><span id="line-2484">            POINT2 pt1,</span>
<span class="source-line-no">2485</span><span id="line-2485">            int numpts,</span>
<span class="source-line-no">2486</span><span id="line-2486">            POINT2[] CirclePoints,</span>
<span class="source-line-no">2487</span><span id="line-2487">            IPointConversion converter) {</span>
<span class="source-line-no">2488</span><span id="line-2488">        try {</span>
<span class="source-line-no">2489</span><span id="line-2489">            int j = 0;</span>
<span class="source-line-no">2490</span><span id="line-2490">            double increment = (Math.PI * 2) / (numpts - 1);</span>
<span class="source-line-no">2491</span><span id="line-2491">            Point2D ptCenter2d=new Point2D.Double(Center.x,Center.y);</span>
<span class="source-line-no">2492</span><span id="line-2492">            ptCenter2d=converter.PixelsToGeo(ptCenter2d);</span>
<span class="source-line-no">2493</span><span id="line-2493">            Point2D pt12d=new Point2D.Double(pt1.x,pt1.y);</span>
<span class="source-line-no">2494</span><span id="line-2494">            pt12d=converter.PixelsToGeo(pt12d);</span>
<span class="source-line-no">2495</span><span id="line-2495">            Center=new POINT2(ptCenter2d.getX(),ptCenter2d.getY());</span>
<span class="source-line-no">2496</span><span id="line-2496">            pt1=new POINT2(pt12d.getX(),pt12d.getY());</span>
<span class="source-line-no">2497</span><span id="line-2497">            double dist=mdlGeodesic.geodesic_distance(Center, pt1, null, null);</span>
<span class="source-line-no">2498</span><span id="line-2498">            </span>
<span class="source-line-no">2499</span><span id="line-2499">            //double dSegmentAngle = 2 * Math.PI / numpts;</span>
<span class="source-line-no">2500</span><span id="line-2500">            double az=0;</span>
<span class="source-line-no">2501</span><span id="line-2501">            double startangle=0,endAngle=Math.PI*2;</span>
<span class="source-line-no">2502</span><span id="line-2502">            POINT2 ptGeo=null,ptPixels=null;</span>
<span class="source-line-no">2503</span><span id="line-2503">            Point2D ptGeo2d=null;           </span>
<span class="source-line-no">2504</span><span id="line-2504">            for (j = 0; j &lt; numpts - 1; j++) {</span>
<span class="source-line-no">2505</span><span id="line-2505">                az=startangle*180/Math.PI+j*increment*180/Math.PI;</span>
<span class="source-line-no">2506</span><span id="line-2506">                //ptGeo=mdlGeodesic.geodesic_coordinate(C2d,length,az);</span>
<span class="source-line-no">2507</span><span id="line-2507">                ptGeo=mdlGeodesic.geodesic_coordinate(Center,dist,az);</span>
<span class="source-line-no">2508</span><span id="line-2508">                ptGeo2d=new Point2D.Double(ptGeo.x,ptGeo.y);</span>
<span class="source-line-no">2509</span><span id="line-2509">                ptGeo2d=converter.GeoToPixels(ptGeo2d);</span>
<span class="source-line-no">2510</span><span id="line-2510">                ptPixels=new POINT2(ptGeo2d.getX(),ptGeo2d.getY());</span>
<span class="source-line-no">2511</span><span id="line-2511">                CirclePoints[j].x = ptPixels.x;</span>
<span class="source-line-no">2512</span><span id="line-2512">                CirclePoints[j].y = ptPixels.y;                            </span>
<span class="source-line-no">2513</span><span id="line-2513">            }</span>
<span class="source-line-no">2514</span><span id="line-2514">            CirclePoints[numpts - 1] = new POINT2(CirclePoints[0]);</span>
<span class="source-line-no">2515</span><span id="line-2515"></span>
<span class="source-line-no">2516</span><span id="line-2516">        } catch (Exception exc) {</span>
<span class="source-line-no">2517</span><span id="line-2517">            ErrorLogger.LogException(_className, "CalcCircleDouble2",</span>
<span class="source-line-no">2518</span><span id="line-2518">                    new RendererException("Failed inside CalcCircleDouble2", exc));</span>
<span class="source-line-no">2519</span><span id="line-2519">        }</span>
<span class="source-line-no">2520</span><span id="line-2520">        return;</span>
<span class="source-line-no">2521</span><span id="line-2521">    }</span>
<span class="source-line-no">2522</span><span id="line-2522">    /**</span>
<span class="source-line-no">2523</span><span id="line-2523">     * Computes the points for a circle. Assumes CirclePoints has been allocated</span>
<span class="source-line-no">2524</span><span id="line-2524">     * with size numpts.</span>
<span class="source-line-no">2525</span><span id="line-2525">     *</span>
<span class="source-line-no">2526</span><span id="line-2526">     * @param Center the cicle center</span>
<span class="source-line-no">2527</span><span id="line-2527">     * @param radius the circle radius in pixels</span>
<span class="source-line-no">2528</span><span id="line-2528">     * @param numpts the number of circle points</span>
<span class="source-line-no">2529</span><span id="line-2529">     * @param CirclePoints - OUT - array of circle points</span>
<span class="source-line-no">2530</span><span id="line-2530">     * @param styl the style to set the last circle point</span>
<span class="source-line-no">2531</span><span id="line-2531">     */</span>
<span class="source-line-no">2532</span><span id="line-2532">    protected static void CalcCircleDouble(POINT2 Center,</span>
<span class="source-line-no">2533</span><span id="line-2533">            double radius,</span>
<span class="source-line-no">2534</span><span id="line-2534">            int numpts,</span>
<span class="source-line-no">2535</span><span id="line-2535">            POINT2[] CirclePoints,</span>
<span class="source-line-no">2536</span><span id="line-2536">            int styl) {</span>
<span class="source-line-no">2537</span><span id="line-2537">        try {</span>
<span class="source-line-no">2538</span><span id="line-2538">            int j = 0;</span>
<span class="source-line-no">2539</span><span id="line-2539">            double dSegmentAngle = 2 * Math.PI / (numpts - 1);</span>
<span class="source-line-no">2540</span><span id="line-2540">            double x = 0, y = 0;</span>
<span class="source-line-no">2541</span><span id="line-2541">            for (j = 0; j &lt; numpts - 1; j++) {</span>
<span class="source-line-no">2542</span><span id="line-2542">                x = Center.x + (radius * Math.cos((double) j * dSegmentAngle));</span>
<span class="source-line-no">2543</span><span id="line-2543">                y = Center.y + (radius * Math.sin((double) j * dSegmentAngle));</span>
<span class="source-line-no">2544</span><span id="line-2544">                CirclePoints[j] = new POINT2(x, y);</span>
<span class="source-line-no">2545</span><span id="line-2545">                CirclePoints[j].style = styl;</span>
<span class="source-line-no">2546</span><span id="line-2546">            }</span>
<span class="source-line-no">2547</span><span id="line-2547">            CirclePoints[numpts - 1] = new POINT2(CirclePoints[0]);</span>
<span class="source-line-no">2548</span><span id="line-2548"></span>
<span class="source-line-no">2549</span><span id="line-2549">            switch (styl) {</span>
<span class="source-line-no">2550</span><span id="line-2550">                case 0:</span>
<span class="source-line-no">2551</span><span id="line-2551">                    CirclePoints[numpts - 1].style = 0;</span>
<span class="source-line-no">2552</span><span id="line-2552">                    break;</span>
<span class="source-line-no">2553</span><span id="line-2553">                case 9:</span>
<span class="source-line-no">2554</span><span id="line-2554">                    CirclePoints[numpts - 1].style = 10;</span>
<span class="source-line-no">2555</span><span id="line-2555">                    break;</span>
<span class="source-line-no">2556</span><span id="line-2556">                case 11:</span>
<span class="source-line-no">2557</span><span id="line-2557">                    CirclePoints[numpts - 1].style = 12;</span>
<span class="source-line-no">2558</span><span id="line-2558">                    break;</span>
<span class="source-line-no">2559</span><span id="line-2559">                default:</span>
<span class="source-line-no">2560</span><span id="line-2560">                    CirclePoints[numpts - 1].style = 5;</span>
<span class="source-line-no">2561</span><span id="line-2561">                    break;</span>
<span class="source-line-no">2562</span><span id="line-2562">            }</span>
<span class="source-line-no">2563</span><span id="line-2563">        } catch (Exception exc) {</span>
<span class="source-line-no">2564</span><span id="line-2564">            ErrorLogger.LogException(_className, "CalcCircleDouble",</span>
<span class="source-line-no">2565</span><span id="line-2565">                    new RendererException("Failed inside CalcCircleDouble", exc));</span>
<span class="source-line-no">2566</span><span id="line-2566">        }</span>
<span class="source-line-no">2567</span><span id="line-2567">    }</span>
<span class="source-line-no">2568</span><span id="line-2568"></span>
<span class="source-line-no">2569</span><span id="line-2569">    protected static Shape2 CalcCircleShape(POINT2 Center,</span>
<span class="source-line-no">2570</span><span id="line-2570">            double radius,</span>
<span class="source-line-no">2571</span><span id="line-2571">            int numpts,</span>
<span class="source-line-no">2572</span><span id="line-2572">            POINT2[] CirclePoints,</span>
<span class="source-line-no">2573</span><span id="line-2573">            int styl) {</span>
<span class="source-line-no">2574</span><span id="line-2574">        Shape2 shape;</span>
<span class="source-line-no">2575</span><span id="line-2575">        if (styl == 9) {</span>
<span class="source-line-no">2576</span><span id="line-2576">            shape = new Shape2(Shape2.SHAPE_TYPE_FILL);</span>
<span class="source-line-no">2577</span><span id="line-2577">        } else {</span>
<span class="source-line-no">2578</span><span id="line-2578">            shape = new Shape2(Shape2.SHAPE_TYPE_POLYLINE);</span>
<span class="source-line-no">2579</span><span id="line-2579">        }</span>
<span class="source-line-no">2580</span><span id="line-2580"></span>
<span class="source-line-no">2581</span><span id="line-2581">        shape.set_Style(styl);</span>
<span class="source-line-no">2582</span><span id="line-2582">        try {</span>
<span class="source-line-no">2583</span><span id="line-2583">            int j = 0;</span>
<span class="source-line-no">2584</span><span id="line-2584">            CalcCircleDouble(Center, radius, numpts, CirclePoints, styl);</span>
<span class="source-line-no">2585</span><span id="line-2585">            shape.moveTo(CirclePoints[0]);</span>
<span class="source-line-no">2586</span><span id="line-2586">            for (j = 1; j &lt; numpts; j++) {</span>
<span class="source-line-no">2587</span><span id="line-2587">                shape.lineTo(CirclePoints[j]);</span>
<span class="source-line-no">2588</span><span id="line-2588">            }</span>
<span class="source-line-no">2589</span><span id="line-2589">        } catch (Exception exc) {</span>
<span class="source-line-no">2590</span><span id="line-2590">            ErrorLogger.LogException(_className, "CalcCircleShape",</span>
<span class="source-line-no">2591</span><span id="line-2591">                    new RendererException("Failed inside CalcCircleShape", exc));</span>
<span class="source-line-no">2592</span><span id="line-2592">        }</span>
<span class="source-line-no">2593</span><span id="line-2593">        return shape;</span>
<span class="source-line-no">2594</span><span id="line-2594">    }</span>
<span class="source-line-no">2595</span><span id="line-2595"></span>
<span class="source-line-no">2596</span><span id="line-2596">    private static void GetSquallCurve(POINT2 StartPt,</span>
<span class="source-line-no">2597</span><span id="line-2597">            POINT2 EndPt,</span>
<span class="source-line-no">2598</span><span id="line-2598">            POINT2[] pSquallPts,</span>
<span class="source-line-no">2599</span><span id="line-2599">            int sign,</span>
<span class="source-line-no">2600</span><span id="line-2600">            double amplitude,</span>
<span class="source-line-no">2601</span><span id="line-2601">            int quantity) {</span>
<span class="source-line-no">2602</span><span id="line-2602">        try {</span>
<span class="source-line-no">2603</span><span id="line-2603">            double dist = CalcDistanceDouble(StartPt, EndPt);</span>
<span class="source-line-no">2604</span><span id="line-2604">            POINT2 ptTemp = new POINT2();</span>
<span class="source-line-no">2605</span><span id="line-2605">            int j = 0;</span>
<span class="source-line-no">2606</span><span id="line-2606">                //end declarations</span>
<span class="source-line-no">2607</span><span id="line-2607"></span>
<span class="source-line-no">2608</span><span id="line-2608">            //get points along the horizontal segment between StartPt and EndPt2;</span>
<span class="source-line-no">2609</span><span id="line-2609">            for (j = 0; j &lt; quantity; j++) {</span>
<span class="source-line-no">2610</span><span id="line-2610">                ptTemp = ExtendLineDouble(EndPt, StartPt, -dist * (double) j / (double) quantity);</span>
<span class="source-line-no">2611</span><span id="line-2611">                pSquallPts[j].x = ptTemp.x;</span>
<span class="source-line-no">2612</span><span id="line-2612">                //calculate the sin value along the x axis</span>
<span class="source-line-no">2613</span><span id="line-2613">                pSquallPts[j].y = ptTemp.y + amplitude * sign * Math.sin((double) j * 180 / (double) quantity * Math.PI / 180);</span>
<span class="source-line-no">2614</span><span id="line-2614">            }</span>
<span class="source-line-no">2615</span><span id="line-2615">        } catch (Exception exc) {</span>
<span class="source-line-no">2616</span><span id="line-2616">            ErrorLogger.LogException(_className, "GetSquallShape",</span>
<span class="source-line-no">2617</span><span id="line-2617">                    new RendererException("Failed inside GeSquallShape", exc));</span>
<span class="source-line-no">2618</span><span id="line-2618">        }</span>
<span class="source-line-no">2619</span><span id="line-2619">    }</span>
<span class="source-line-no">2620</span><span id="line-2620">    //caller needs to instantiate sign.value</span>
<span class="source-line-no">2621</span><span id="line-2621">    /**</span>
<span class="source-line-no">2622</span><span id="line-2622">     * Gets the squall curves for a line segment Assumes pSquallPts has been</span>
<span class="source-line-no">2623</span><span id="line-2623">     * allocated the proper number of points.</span>
<span class="source-line-no">2624</span><span id="line-2624">     *</span>
<span class="source-line-no">2625</span><span id="line-2625">     * @param StartPt segment start point</span>
<span class="source-line-no">2626</span><span id="line-2626">     * @param EndPt segment end point</span>
<span class="source-line-no">2627</span><span id="line-2627">     * @param pSquallPts OUT - the squall points</span>
<span class="source-line-no">2628</span><span id="line-2628">     * @param sign OUT - an object with a member to hold the starting curve sign</span>
<span class="source-line-no">2629</span><span id="line-2629">     * for the segment.</span>
<span class="source-line-no">2630</span><span id="line-2630">     * @param amplitude the sin curve amplitutde</span>
<span class="source-line-no">2631</span><span id="line-2631">     * @param quantity the number of points for each sin curve</span>
<span class="source-line-no">2632</span><span id="line-2632">     * @param length the desired length of the curve along the segment for each</span>
<span class="source-line-no">2633</span><span id="line-2633">     * sin curve</span>
<span class="source-line-no">2634</span><span id="line-2634">     *</span>
<span class="source-line-no">2635</span><span id="line-2635">     * @return segment squall points count</span>
<span class="source-line-no">2636</span><span id="line-2636">     */</span>
<span class="source-line-no">2637</span><span id="line-2637">    protected static int GetSquallSegment(POINT2 StartPt,</span>
<span class="source-line-no">2638</span><span id="line-2638">            POINT2 EndPt,</span>
<span class="source-line-no">2639</span><span id="line-2639">            POINT2[] pSquallPts,</span>
<span class="source-line-no">2640</span><span id="line-2640">            ref&lt;int[]&gt; sign,</span>
<span class="source-line-no">2641</span><span id="line-2641">            double amplitude,</span>
<span class="source-line-no">2642</span><span id="line-2642">            int quantity,</span>
<span class="source-line-no">2643</span><span id="line-2643">            double length) {</span>
<span class="source-line-no">2644</span><span id="line-2644">        int counter = 0;</span>
<span class="source-line-no">2645</span><span id="line-2645">        try {</span>
<span class="source-line-no">2646</span><span id="line-2646">            POINT2 StartCurvePt, EndCurvePt;    //use these for the curve points</span>
<span class="source-line-no">2647</span><span id="line-2647">            POINT2[] pSquallPts2 = new POINT2[quantity];</span>
<span class="source-line-no">2648</span><span id="line-2648">            double dist = CalcDistanceDouble(StartPt, EndPt);</span>
<span class="source-line-no">2649</span><span id="line-2649">            int numCurves = (int) (dist / (double) length);</span>
<span class="source-line-no">2650</span><span id="line-2650">            int j = 0, k = 0;</span>
<span class="source-line-no">2651</span><span id="line-2651">            POINT2 EndPt2 = new POINT2();</span>
<span class="source-line-no">2652</span><span id="line-2652">            double angle = Math.atan((StartPt.y - EndPt.y) / (StartPt.x - EndPt.x));</span>
<span class="source-line-no">2653</span><span id="line-2653">            int lAngle = (int) ((180 / Math.PI) * angle);</span>
<span class="source-line-no">2654</span><span id="line-2654">            InitializePOINT2Array(pSquallPts2);</span>
<span class="source-line-no">2655</span><span id="line-2655">            //define EndPt2 to be the point dist from StartPt along the x axis</span>
<span class="source-line-no">2656</span><span id="line-2656">            if (StartPt.x &lt; EndPt.x) {</span>
<span class="source-line-no">2657</span><span id="line-2657">                EndPt2.x = StartPt.x + dist;</span>
<span class="source-line-no">2658</span><span id="line-2658">            } else {</span>
<span class="source-line-no">2659</span><span id="line-2659">                EndPt2.x = StartPt.x - dist;</span>
<span class="source-line-no">2660</span><span id="line-2660">            }</span>
<span class="source-line-no">2661</span><span id="line-2661"></span>
<span class="source-line-no">2662</span><span id="line-2662">            EndPt2.y = StartPt.y;</span>
<span class="source-line-no">2663</span><span id="line-2663"></span>
<span class="source-line-no">2664</span><span id="line-2664">            EndCurvePt = StartPt;</span>
<span class="source-line-no">2665</span><span id="line-2665">            for (j = 0; j &lt; numCurves; j++) {</span>
<span class="source-line-no">2666</span><span id="line-2666">                StartCurvePt = ExtendLineDouble(EndPt2, StartPt, -(double) (j * length));</span>
<span class="source-line-no">2667</span><span id="line-2667">                EndCurvePt = ExtendLineDouble(EndPt2, StartPt, -(double) ((j + 1) * length));</span>
<span class="source-line-no">2668</span><span id="line-2668"></span>
<span class="source-line-no">2669</span><span id="line-2669">                //get the curve points</span>
<span class="source-line-no">2670</span><span id="line-2670">                GetSquallCurve(StartCurvePt, EndCurvePt, pSquallPts2, sign.value[0], amplitude, quantity);</span>
<span class="source-line-no">2671</span><span id="line-2671"></span>
<span class="source-line-no">2672</span><span id="line-2672">                //fill the segment points with the curve points</span>
<span class="source-line-no">2673</span><span id="line-2673">                for (k = 0; k &lt; quantity; k++) {</span>
<span class="source-line-no">2674</span><span id="line-2674">                    //pSquallPts[counter].x=pSquallPts2[k].x;</span>
<span class="source-line-no">2675</span><span id="line-2675">                    //pSquallPts[counter].y=pSquallPts2[k].y;</span>
<span class="source-line-no">2676</span><span id="line-2676">                    pSquallPts[counter] = new POINT2(pSquallPts2[k]);</span>
<span class="source-line-no">2677</span><span id="line-2677">                    counter++;</span>
<span class="source-line-no">2678</span><span id="line-2678">                }</span>
<span class="source-line-no">2679</span><span id="line-2679">                //reverse the sign</span>
<span class="source-line-no">2680</span><span id="line-2680"></span>
<span class="source-line-no">2681</span><span id="line-2681">                sign.value[0] = -sign.value[0];</span>
<span class="source-line-no">2682</span><span id="line-2682">            }</span>
<span class="source-line-no">2683</span><span id="line-2683">            if (numCurves == 0) {</span>
<span class="source-line-no">2684</span><span id="line-2684">                pSquallPts[counter] = new POINT2(StartPt);</span>
<span class="source-line-no">2685</span><span id="line-2685">                counter++;</span>
<span class="source-line-no">2686</span><span id="line-2686">                pSquallPts[counter] = new POINT2(EndPt);</span>
<span class="source-line-no">2687</span><span id="line-2687">                counter++;</span>
<span class="source-line-no">2688</span><span id="line-2688">            }</span>
<span class="source-line-no">2689</span><span id="line-2689">            //the points are along the x axis. Rotate them about the first point as the origin</span>
<span class="source-line-no">2690</span><span id="line-2690">            RotateGeometryDoubleOrigin(pSquallPts, counter, lAngle);</span>
<span class="source-line-no">2691</span><span id="line-2691">            pSquallPts2 = null;</span>
<span class="source-line-no">2692</span><span id="line-2692">        } catch (Exception exc) {</span>
<span class="source-line-no">2693</span><span id="line-2693">            ErrorLogger.LogException(_className, "GetSquallSegment",</span>
<span class="source-line-no">2694</span><span id="line-2694">                    new RendererException("Failed inside GetSquallSegment", exc));</span>
<span class="source-line-no">2695</span><span id="line-2695">        }</span>
<span class="source-line-no">2696</span><span id="line-2696">        return counter;</span>
<span class="source-line-no">2697</span><span id="line-2697">    }</span>
<span class="source-line-no">2698</span><span id="line-2698"></span>
<span class="source-line-no">2699</span><span id="line-2699">    //temporarily using 2000 pixels</span>
<span class="source-line-no">2700</span><span id="line-2700">    private static int PointInBounds(POINT2 pt) {</span>
<span class="source-line-no">2701</span><span id="line-2701">        try {</span>
<span class="source-line-no">2702</span><span id="line-2702">            //double maxPixels=CELineArrayGlobals.MaxPixels2;</span>
<span class="source-line-no">2703</span><span id="line-2703">            double maxPixels = 100000;//was 2000</span>
<span class="source-line-no">2704</span><span id="line-2704">            if (Math.abs(pt.x) &lt;= maxPixels &amp;&amp; Math.abs(pt.y) &lt;= maxPixels) {</span>
<span class="source-line-no">2705</span><span id="line-2705">                return 1;</span>
<span class="source-line-no">2706</span><span id="line-2706">            } else {</span>
<span class="source-line-no">2707</span><span id="line-2707">                return 0;</span>
<span class="source-line-no">2708</span><span id="line-2708">            }</span>
<span class="source-line-no">2709</span><span id="line-2709">        } catch (Exception exc) {</span>
<span class="source-line-no">2710</span><span id="line-2710">            ErrorLogger.LogException(_className, "PointInBounds",</span>
<span class="source-line-no">2711</span><span id="line-2711">                    new RendererException("Failed inside PointInBounds", exc));</span>
<span class="source-line-no">2712</span><span id="line-2712">        }</span>
<span class="source-line-no">2713</span><span id="line-2713">        return 1;</span>
<span class="source-line-no">2714</span><span id="line-2714">    }</span>
<span class="source-line-no">2715</span><span id="line-2715"></span>
<span class="source-line-no">2716</span><span id="line-2716">    /**</span>
<span class="source-line-no">2717</span><span id="line-2717">     * @param pt</span>
<span class="source-line-no">2718</span><span id="line-2718">     * @param ul</span>
<span class="source-line-no">2719</span><span id="line-2719">     * @param lr</span>
<span class="source-line-no">2720</span><span id="line-2720">     * @return</span>
<span class="source-line-no">2721</span><span id="line-2721">     */</span>
<span class="source-line-no">2722</span><span id="line-2722">    private static int PointInBounds2(POINT2 pt, POINT2 ul, POINT2 lr) {</span>
<span class="source-line-no">2723</span><span id="line-2723">        try {</span>
<span class="source-line-no">2724</span><span id="line-2724">            double maxX = lr.x, minX = ul.x, maxY = lr.y, minY = ul.y;</span>
<span class="source-line-no">2725</span><span id="line-2725">            if (pt.x &lt;= maxX &amp;&amp; pt.x &gt;= minX &amp;&amp; pt.y &lt;= maxY &amp;&amp; pt.y &gt;= minY) {</span>
<span class="source-line-no">2726</span><span id="line-2726">                return 1;</span>
<span class="source-line-no">2727</span><span id="line-2727">            } else {</span>
<span class="source-line-no">2728</span><span id="line-2728">                return 0;</span>
<span class="source-line-no">2729</span><span id="line-2729">            }</span>
<span class="source-line-no">2730</span><span id="line-2730">        } catch (Exception exc) {</span>
<span class="source-line-no">2731</span><span id="line-2731">            ErrorLogger.LogException(_className, "PointInBounds2",</span>
<span class="source-line-no">2732</span><span id="line-2732">                    new RendererException("Failed inside PointInBounds2", exc));</span>
<span class="source-line-no">2733</span><span id="line-2733">        }</span>
<span class="source-line-no">2734</span><span id="line-2734">        return 1;</span>
<span class="source-line-no">2735</span><span id="line-2735">    }</span>
<span class="source-line-no">2736</span><span id="line-2736"></span>
<span class="source-line-no">2737</span><span id="line-2737">    /**</span>
<span class="source-line-no">2738</span><span id="line-2738">     * Analyzes if line from pt0 to pt 1 intersects a side and returns the</span>
<span class="source-line-no">2739</span><span id="line-2739">     * intersection or null assumes pt0 to pt1 is not vertical. the caller will</span>
<span class="source-line-no">2740</span><span id="line-2740">     * replace pt0 with the intersection point if it is not null</span>
<span class="source-line-no">2741</span><span id="line-2741">     *</span>
<span class="source-line-no">2742</span><span id="line-2742">     * @param pt0</span>
<span class="source-line-no">2743</span><span id="line-2743">     * @param pt1</span>
<span class="source-line-no">2744</span><span id="line-2744">     * @param sidePt0 vertical or horizontal side first point</span>
<span class="source-line-no">2745</span><span id="line-2745">     * @param sidePt1</span>
<span class="source-line-no">2746</span><span id="line-2746">     * @return null if it does not intersect the side</span>
<span class="source-line-no">2747</span><span id="line-2747">     */</span>
<span class="source-line-no">2748</span><span id="line-2748">    private static POINT2 intersectSegment(POINT2 pt0, POINT2 pt1, POINT2 sidePt0, POINT2 sidePt1) {</span>
<span class="source-line-no">2749</span><span id="line-2749">        POINT2 pt = null;</span>
<span class="source-line-no">2750</span><span id="line-2750">        try {</span>
<span class="source-line-no">2751</span><span id="line-2751">            if (pt0.x == pt1.x) {</span>
<span class="source-line-no">2752</span><span id="line-2752">                return null;</span>
<span class="source-line-no">2753</span><span id="line-2753">            }</span>
<span class="source-line-no">2754</span><span id="line-2754">            double m = (pt1.y - pt0.y) / (pt1.x - pt0.x);</span>
<span class="source-line-no">2755</span><span id="line-2755">            double dx = 0, dy = 0, x = 0, y = 0;</span>
<span class="source-line-no">2756</span><span id="line-2756">            POINT2 upper = null, lower = null, left = null, right = null;</span>
<span class="source-line-no">2757</span><span id="line-2757">            Boolean bolVertical = false;</span>
<span class="source-line-no">2758</span><span id="line-2758">            //the side is either vertical or horizontal</span>
<span class="source-line-no">2759</span><span id="line-2759">            if (sidePt0.x == sidePt1.x) //vertical side</span>
<span class="source-line-no">2760</span><span id="line-2760">            {</span>
<span class="source-line-no">2761</span><span id="line-2761">                bolVertical = true;</span>
<span class="source-line-no">2762</span><span id="line-2762">                if (sidePt0.y &lt; sidePt1.y) {</span>
<span class="source-line-no">2763</span><span id="line-2763">                    upper = sidePt0;</span>
<span class="source-line-no">2764</span><span id="line-2764">                    lower = sidePt1;</span>
<span class="source-line-no">2765</span><span id="line-2765">                } else {</span>
<span class="source-line-no">2766</span><span id="line-2766">                    upper = sidePt1;</span>
<span class="source-line-no">2767</span><span id="line-2767">                    lower = sidePt0;</span>
<span class="source-line-no">2768</span><span id="line-2768">                }</span>
<span class="source-line-no">2769</span><span id="line-2769">            } else //horizontal side</span>
<span class="source-line-no">2770</span><span id="line-2770">            {</span>
<span class="source-line-no">2771</span><span id="line-2771">                if (sidePt0.x &lt; sidePt1.x) {</span>
<span class="source-line-no">2772</span><span id="line-2772">                    left = sidePt0;</span>
<span class="source-line-no">2773</span><span id="line-2773">                    right = sidePt1;</span>
<span class="source-line-no">2774</span><span id="line-2774">                } else {</span>
<span class="source-line-no">2775</span><span id="line-2775">                    left = sidePt1;</span>
<span class="source-line-no">2776</span><span id="line-2776">                    right = sidePt0;</span>
<span class="source-line-no">2777</span><span id="line-2777">                }</span>
<span class="source-line-no">2778</span><span id="line-2778">            }</span>
<span class="source-line-no">2779</span><span id="line-2779">            //travel in the direction from pt0 to pt1 to find the pt0 intersect</span>
<span class="source-line-no">2780</span><span id="line-2780">            if (bolVertical) {  //the side to intersect is vertical</span>
<span class="source-line-no">2781</span><span id="line-2781">                dx = upper.x - pt0.x;</span>
<span class="source-line-no">2782</span><span id="line-2782">                dy = m * dx;</span>
<span class="source-line-no">2783</span><span id="line-2783">                x = upper.x;</span>
<span class="source-line-no">2784</span><span id="line-2784">                y = pt0.y + dy;</span>
<span class="source-line-no">2785</span><span id="line-2785">                //the potential intersection point</span>
<span class="source-line-no">2786</span><span id="line-2786">                pt = new POINT2(x, y);</span>
<span class="source-line-no">2787</span><span id="line-2787"></span>
<span class="source-line-no">2788</span><span id="line-2788">                if (pt0.x &lt;= pt.x &amp;&amp; pt.x &lt;= pt1.x) //left to right</span>
<span class="source-line-no">2789</span><span id="line-2789">                {</span>
<span class="source-line-no">2790</span><span id="line-2790">                    if (upper.y &lt;= pt.y &amp;&amp; pt.y &lt;= lower.y) {</span>
<span class="source-line-no">2791</span><span id="line-2791">                        return pt;</span>
<span class="source-line-no">2792</span><span id="line-2792">                    }</span>
<span class="source-line-no">2793</span><span id="line-2793">                } else if (pt0.x &gt;= pt.x &amp;&amp; pt.x &gt;= pt1.x) //right to left</span>
<span class="source-line-no">2794</span><span id="line-2794">                {</span>
<span class="source-line-no">2795</span><span id="line-2795">                    if (upper.y &lt;= pt.y &amp;&amp; pt.y &lt;= lower.y) {</span>
<span class="source-line-no">2796</span><span id="line-2796">                        return pt;</span>
<span class="source-line-no">2797</span><span id="line-2797">                    }</span>
<span class="source-line-no">2798</span><span id="line-2798">                }</span>
<span class="source-line-no">2799</span><span id="line-2799">            } else //horizontal side</span>
<span class="source-line-no">2800</span><span id="line-2800">            {</span>
<span class="source-line-no">2801</span><span id="line-2801">                dy = left.y - pt0.y;</span>
<span class="source-line-no">2802</span><span id="line-2802">                dx = dy / m;</span>
<span class="source-line-no">2803</span><span id="line-2803">                x = pt0.x + dx;</span>
<span class="source-line-no">2804</span><span id="line-2804">                y = left.y;</span>
<span class="source-line-no">2805</span><span id="line-2805">                //the potential intersection point</span>
<span class="source-line-no">2806</span><span id="line-2806">                pt = new POINT2(x, y);</span>
<span class="source-line-no">2807</span><span id="line-2807"></span>
<span class="source-line-no">2808</span><span id="line-2808">                if (pt0.y &lt;= pt.y &amp;&amp; pt.y &lt;= pt1.y) {</span>
<span class="source-line-no">2809</span><span id="line-2809">                    if (left.x &lt;= pt.x &amp;&amp; pt.x &lt;= right.x) {</span>
<span class="source-line-no">2810</span><span id="line-2810">                        return pt;</span>
<span class="source-line-no">2811</span><span id="line-2811">                    }</span>
<span class="source-line-no">2812</span><span id="line-2812">                } else if (pt0.y &gt;= pt.y &amp;&amp; pt.y &gt;= pt1.y) {</span>
<span class="source-line-no">2813</span><span id="line-2813">                    if (left.x &lt;= pt.x &amp;&amp; pt.x &lt;= right.x) {</span>
<span class="source-line-no">2814</span><span id="line-2814">                        return pt;</span>
<span class="source-line-no">2815</span><span id="line-2815">                    }</span>
<span class="source-line-no">2816</span><span id="line-2816">                }</span>
<span class="source-line-no">2817</span><span id="line-2817">            }</span>
<span class="source-line-no">2818</span><span id="line-2818">        } catch (Exception exc) {</span>
<span class="source-line-no">2819</span><span id="line-2819">            ErrorLogger.LogException(_className, "intersectSegment",</span>
<span class="source-line-no">2820</span><span id="line-2820">                    new RendererException("Failed inside intersectSegment", exc));</span>
<span class="source-line-no">2821</span><span id="line-2821">        }</span>
<span class="source-line-no">2822</span><span id="line-2822">        return null;</span>
<span class="source-line-no">2823</span><span id="line-2823">    }</span>
<span class="source-line-no">2824</span><span id="line-2824"></span>
<span class="source-line-no">2825</span><span id="line-2825">    /**</span>
<span class="source-line-no">2826</span><span id="line-2826">     * side 1 ----- | | side 0 | | side 2 | | ------ side 3 bounds one segment</span>
<span class="source-line-no">2827</span><span id="line-2827">     * for autoshapes that need it: bydif, fordif, fix, mnfldfix if null is</span>
<span class="source-line-no">2828</span><span id="line-2828">     * returned the client should conect the original line points (i.e. no</span>
<span class="source-line-no">2829</span><span id="line-2829">     * jaggies)</span>
<span class="source-line-no">2830</span><span id="line-2830">     *</span>
<span class="source-line-no">2831</span><span id="line-2831">     * @param pt0</span>
<span class="source-line-no">2832</span><span id="line-2832">     * @param pt1</span>
<span class="source-line-no">2833</span><span id="line-2833">     * @param ul</span>
<span class="source-line-no">2834</span><span id="line-2834">     * @param lr</span>
<span class="source-line-no">2835</span><span id="line-2835">     * @return bounded segment or null</span>
<span class="source-line-no">2836</span><span id="line-2836">     */</span>
<span class="source-line-no">2837</span><span id="line-2837">    public static POINT2[] BoundOneSegment(POINT2 pt0, POINT2 pt1, POINT2 ul, POINT2 lr) {</span>
<span class="source-line-no">2838</span><span id="line-2838">        POINT2[] line = new POINT2[2];</span>
<span class="source-line-no">2839</span><span id="line-2839">        try {</span>
<span class="source-line-no">2840</span><span id="line-2840">            if (pt0.y &lt; ul.y &amp;&amp; pt1.y &lt; ul.y) {</span>
<span class="source-line-no">2841</span><span id="line-2841">                return null;</span>
<span class="source-line-no">2842</span><span id="line-2842">            }</span>
<span class="source-line-no">2843</span><span id="line-2843">            if (pt0.y &gt; lr.y &amp;&amp; pt1.y &gt; lr.y) {</span>
<span class="source-line-no">2844</span><span id="line-2844">                return null;</span>
<span class="source-line-no">2845</span><span id="line-2845">            }</span>
<span class="source-line-no">2846</span><span id="line-2846">            if (pt0.x &lt; ul.x &amp;&amp; pt1.x &lt; ul.x) {</span>
<span class="source-line-no">2847</span><span id="line-2847">                return null;</span>
<span class="source-line-no">2848</span><span id="line-2848">            }</span>
<span class="source-line-no">2849</span><span id="line-2849">            if (pt0.x &gt; lr.x &amp;&amp; pt1.x &gt; lr.x) {</span>
<span class="source-line-no">2850</span><span id="line-2850">                return null;</span>
<span class="source-line-no">2851</span><span id="line-2851">            }</span>
<span class="source-line-no">2852</span><span id="line-2852"></span>
<span class="source-line-no">2853</span><span id="line-2853">            Boolean bolVertical = false;</span>
<span class="source-line-no">2854</span><span id="line-2854">            InitializePOINT2Array(line);</span>
<span class="source-line-no">2855</span><span id="line-2855">            if (pt0.x == pt1.x) {</span>
<span class="source-line-no">2856</span><span id="line-2856">                bolVertical = true;</span>
<span class="source-line-no">2857</span><span id="line-2857">            }</span>
<span class="source-line-no">2858</span><span id="line-2858"></span>
<span class="source-line-no">2859</span><span id="line-2859">            if (bolVertical) {</span>
<span class="source-line-no">2860</span><span id="line-2860">                line[0] = new POINT2(pt0);</span>
<span class="source-line-no">2861</span><span id="line-2861">                if (line[0].y &lt; ul.y) {</span>
<span class="source-line-no">2862</span><span id="line-2862">                    line[0].y = ul.y;</span>
<span class="source-line-no">2863</span><span id="line-2863">                }</span>
<span class="source-line-no">2864</span><span id="line-2864">                if (line[0].y &gt; lr.y) {</span>
<span class="source-line-no">2865</span><span id="line-2865">                    line[0].y = lr.y;</span>
<span class="source-line-no">2866</span><span id="line-2866">                }</span>
<span class="source-line-no">2867</span><span id="line-2867"></span>
<span class="source-line-no">2868</span><span id="line-2868">                line[1] = new POINT2(pt1);</span>
<span class="source-line-no">2869</span><span id="line-2869">                if (line[1].y &lt; ul.y) {</span>
<span class="source-line-no">2870</span><span id="line-2870">                    line[1].y = ul.y;</span>
<span class="source-line-no">2871</span><span id="line-2871">                }</span>
<span class="source-line-no">2872</span><span id="line-2872">                if (line[1].y &gt; lr.y) {</span>
<span class="source-line-no">2873</span><span id="line-2873">                    line[1].y = lr.y;</span>
<span class="source-line-no">2874</span><span id="line-2874">                }</span>
<span class="source-line-no">2875</span><span id="line-2875"></span>
<span class="source-line-no">2876</span><span id="line-2876">                return line;</span>
<span class="source-line-no">2877</span><span id="line-2877">            }</span>
<span class="source-line-no">2878</span><span id="line-2878"></span>
<span class="source-line-no">2879</span><span id="line-2879">            double dx = 0, dy = 0, x = 0, y = 0;</span>
<span class="source-line-no">2880</span><span id="line-2880">            double m = (pt1.y - pt0.y) / (pt1.x - pt0.x);</span>
<span class="source-line-no">2881</span><span id="line-2881">            Boolean side0Intersect = false,</span>
<span class="source-line-no">2882</span><span id="line-2882">                    side1Intersect = false,</span>
<span class="source-line-no">2883</span><span id="line-2883">                    side2Intersect = false,</span>
<span class="source-line-no">2884</span><span id="line-2884">                    side3Intersect = false;</span>
<span class="source-line-no">2885</span><span id="line-2885">            //travel in the direction from pt0 to pt1 to find pt0 intersect</span>
<span class="source-line-no">2886</span><span id="line-2886">            POINT2 ur = new POINT2(lr.x, ul.y);</span>
<span class="source-line-no">2887</span><span id="line-2887">            POINT2 ll = new POINT2(ul.x, lr.y);</span>
<span class="source-line-no">2888</span><span id="line-2888"></span>
<span class="source-line-no">2889</span><span id="line-2889">            POINT2 pt0Intersect = null;</span>
<span class="source-line-no">2890</span><span id="line-2890">            if (PointInBounds2(pt0, ul, lr) == 1) {</span>
<span class="source-line-no">2891</span><span id="line-2891">                pt0Intersect = pt0;</span>
<span class="source-line-no">2892</span><span id="line-2892">            }</span>
<span class="source-line-no">2893</span><span id="line-2893">            if (pt0Intersect == null) {</span>
<span class="source-line-no">2894</span><span id="line-2894">                pt0Intersect = intersectSegment(pt0, pt1, ll, ul);  //interesect side 0</span>
<span class="source-line-no">2895</span><span id="line-2895">                side0Intersect = true;</span>
<span class="source-line-no">2896</span><span id="line-2896">            }</span>
<span class="source-line-no">2897</span><span id="line-2897">            if (pt0Intersect == null) {</span>
<span class="source-line-no">2898</span><span id="line-2898">                pt0Intersect = intersectSegment(pt0, pt1, ul, ur);  //interesect side 1</span>
<span class="source-line-no">2899</span><span id="line-2899">                side1Intersect = true;</span>
<span class="source-line-no">2900</span><span id="line-2900">            }</span>
<span class="source-line-no">2901</span><span id="line-2901">            if (pt0Intersect == null) {</span>
<span class="source-line-no">2902</span><span id="line-2902">                pt0Intersect = intersectSegment(pt0, pt1, ur, lr);  //interesect side 2</span>
<span class="source-line-no">2903</span><span id="line-2903">                side2Intersect = true;</span>
<span class="source-line-no">2904</span><span id="line-2904">            }</span>
<span class="source-line-no">2905</span><span id="line-2905">            if (pt0Intersect == null) {</span>
<span class="source-line-no">2906</span><span id="line-2906">                pt0Intersect = intersectSegment(pt0, pt1, ll, lr);  //interesect side 3</span>
<span class="source-line-no">2907</span><span id="line-2907">                side3Intersect = true;</span>
<span class="source-line-no">2908</span><span id="line-2908">            }</span>
<span class="source-line-no">2909</span><span id="line-2909"></span>
<span class="source-line-no">2910</span><span id="line-2910">            //travel in the direction from pt1 to pt0 to find pt1 intersect</span>
<span class="source-line-no">2911</span><span id="line-2911">            POINT2 pt1Intersect = null;</span>
<span class="source-line-no">2912</span><span id="line-2912">            if (PointInBounds2(pt1, ul, lr) == 1) {</span>
<span class="source-line-no">2913</span><span id="line-2913">                pt1Intersect = pt1;</span>
<span class="source-line-no">2914</span><span id="line-2914">            }</span>
<span class="source-line-no">2915</span><span id="line-2915">            if (pt1Intersect == null &amp;&amp; side0Intersect == false) {</span>
<span class="source-line-no">2916</span><span id="line-2916">                pt1Intersect = intersectSegment(pt1, pt0, ll, ul);  //interesect side 0</span>
<span class="source-line-no">2917</span><span id="line-2917">            }</span>
<span class="source-line-no">2918</span><span id="line-2918">            if (pt1Intersect == null &amp;&amp; side1Intersect == false) {</span>
<span class="source-line-no">2919</span><span id="line-2919">                pt1Intersect = intersectSegment(pt1, pt0, ul, ur);  //interesect side 1</span>
<span class="source-line-no">2920</span><span id="line-2920">            }</span>
<span class="source-line-no">2921</span><span id="line-2921">            if (pt1Intersect == null &amp;&amp; side2Intersect == false) {</span>
<span class="source-line-no">2922</span><span id="line-2922">                pt1Intersect = intersectSegment(pt1, pt0, ur, lr);  //interesect side 2</span>
<span class="source-line-no">2923</span><span id="line-2923">            }</span>
<span class="source-line-no">2924</span><span id="line-2924">            if (pt1Intersect == null &amp;&amp; side3Intersect == false) {</span>
<span class="source-line-no">2925</span><span id="line-2925">                pt1Intersect = intersectSegment(pt1, pt0, ll, lr);  //interesect side 3</span>
<span class="source-line-no">2926</span><span id="line-2926">            }</span>
<span class="source-line-no">2927</span><span id="line-2927"></span>
<span class="source-line-no">2928</span><span id="line-2928">            if (pt0Intersect != null &amp;&amp; pt1Intersect != null) {</span>
<span class="source-line-no">2929</span><span id="line-2929">                line[0] = pt0Intersect;</span>
<span class="source-line-no">2930</span><span id="line-2930">                line[1] = pt1Intersect;</span>
<span class="source-line-no">2931</span><span id="line-2931">                //return line;</span>
<span class="source-line-no">2932</span><span id="line-2932">            } else {</span>
<span class="source-line-no">2933</span><span id="line-2933">                line = null;</span>
<span class="source-line-no">2934</span><span id="line-2934">            }</span>
<span class="source-line-no">2935</span><span id="line-2935">        } catch (Exception exc) {</span>
<span class="source-line-no">2936</span><span id="line-2936">            ErrorLogger.LogException(_className, "BoundOneSegment",</span>
<span class="source-line-no">2937</span><span id="line-2937">                    new RendererException("Failed inside BoundOneSegment", exc));</span>
<span class="source-line-no">2938</span><span id="line-2938">        }</span>
<span class="source-line-no">2939</span><span id="line-2939">        return line;</span>
<span class="source-line-no">2940</span><span id="line-2940">    }</span>
<span class="source-line-no">2941</span><span id="line-2941"></span>
<span class="source-line-no">2942</span><span id="line-2942">    private static int DisplayIntersectPixels(POINT2 pt0,</span>
<span class="source-line-no">2943</span><span id="line-2943">            POINT2 pt1,</span>
<span class="source-line-no">2944</span><span id="line-2944">            ref&lt;double[]&gt; pt2x,</span>
<span class="source-line-no">2945</span><span id="line-2945">            ref&lt;double[]&gt; pt2y,</span>
<span class="source-line-no">2946</span><span id="line-2946">            ref&lt;double[]&gt; pt3x,</span>
<span class="source-line-no">2947</span><span id="line-2947">            ref&lt;double[]&gt; pt3y) //POINT2 ul,</span>
<span class="source-line-no">2948</span><span id="line-2948">    //POINT2 lr)</span>
<span class="source-line-no">2949</span><span id="line-2949">    {</span>
<span class="source-line-no">2950</span><span id="line-2950">        int nResult = -1;</span>
<span class="source-line-no">2951</span><span id="line-2951">        try {</span>
<span class="source-line-no">2952</span><span id="line-2952">            //declarations</span>
<span class="source-line-no">2953</span><span id="line-2953">            double X = 0, Y = 0;</span>
<span class="source-line-no">2954</span><span id="line-2954">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">2955</span><span id="line-2955">            //double maxPixels=CELineArrayGlobals.MaxPixels2;</span>
<span class="source-line-no">2956</span><span id="line-2956">            double maxPixels = 2000;</span>
<span class="source-line-no">2957</span><span id="line-2957">            //double maxX=lr.x,minX=ul.x,maxY=lr.y,minY=ul.y;</span>
<span class="source-line-no">2958</span><span id="line-2958"></span>
<span class="source-line-no">2959</span><span id="line-2959">            int bol0Inside = 0, bol1Inside = 0;</span>
<span class="source-line-no">2960</span><span id="line-2960">            int bolVertical = CalcTrueSlopeDouble(pt0, pt1, m);</span>
<span class="source-line-no">2961</span><span id="line-2961">            double b = pt0.y - m.value[0] * pt0.x;      //the y intercept for the segment line</span>
<span class="source-line-no">2962</span><span id="line-2962">            POINT2 pt2, pt3;</span>
<span class="source-line-no">2963</span><span id="line-2963">            //end declarations</span>
<span class="source-line-no">2964</span><span id="line-2964"></span>
<span class="source-line-no">2965</span><span id="line-2965">            pt2x.value = new double[1];</span>
<span class="source-line-no">2966</span><span id="line-2966">            pt2y.value = new double[1];</span>
<span class="source-line-no">2967</span><span id="line-2967">            pt3x.value = new double[1];</span>
<span class="source-line-no">2968</span><span id="line-2968">            pt3y.value = new double[1];</span>
<span class="source-line-no">2969</span><span id="line-2969">            pt2 = new POINT2(pt0);</span>
<span class="source-line-no">2970</span><span id="line-2970">            pt3 = new POINT2(pt1);</span>
<span class="source-line-no">2971</span><span id="line-2971"></span>
<span class="source-line-no">2972</span><span id="line-2972">            //diagnostic</span>
<span class="source-line-no">2973</span><span id="line-2973">            if (pt0.x &lt;= maxPixels &amp;&amp; pt0.x &gt;= -maxPixels</span>
<span class="source-line-no">2974</span><span id="line-2974">                    &amp;&amp; pt0.y &lt;= maxPixels &amp;&amp; pt0.y &gt;= -maxPixels) {</span>
<span class="source-line-no">2975</span><span id="line-2975">                bol0Inside = 1;</span>
<span class="source-line-no">2976</span><span id="line-2976">            }</span>
<span class="source-line-no">2977</span><span id="line-2977">            if (pt1.x &lt;= maxPixels &amp;&amp; pt1.x &gt;= -maxPixels</span>
<span class="source-line-no">2978</span><span id="line-2978">                    &amp;&amp; pt1.y &lt;= maxPixels &amp;&amp; pt1.y &gt;= -maxPixels) {</span>
<span class="source-line-no">2979</span><span id="line-2979">                bol1Inside = 1;</span>
<span class="source-line-no">2980</span><span id="line-2980">            }</span>
<span class="source-line-no">2981</span><span id="line-2981">            //if both points are inside the area then use the whole segment</span>
<span class="source-line-no">2982</span><span id="line-2982">            if (bol0Inside == 1 &amp;&amp; bol1Inside == 1) {</span>
<span class="source-line-no">2983</span><span id="line-2983">                return 0;</span>
<span class="source-line-no">2984</span><span id="line-2984">            }</span>
<span class="source-line-no">2985</span><span id="line-2985">            //if at leat one of the points is inside the area then use some of the segment</span>
<span class="source-line-no">2986</span><span id="line-2986">            if (bol0Inside == 1 || bol1Inside == 1) {</span>
<span class="source-line-no">2987</span><span id="line-2987">                nResult = 1;</span>
<span class="source-line-no">2988</span><span id="line-2988">            }</span>
<span class="source-line-no">2989</span><span id="line-2989"></span>
<span class="source-line-no">2990</span><span id="line-2990">            //segment is not vertical</span>
<span class="source-line-no">2991</span><span id="line-2991">            if (bolVertical != 0) {</span>
<span class="source-line-no">2992</span><span id="line-2992">                //analysis for side 0, get the intersection for either point if it exists</span>
<span class="source-line-no">2993</span><span id="line-2993">                //diagnostic</span>
<span class="source-line-no">2994</span><span id="line-2994">                X = -maxPixels;</span>
<span class="source-line-no">2995</span><span id="line-2995">                //X=minX;</span>
<span class="source-line-no">2996</span><span id="line-2996"></span>
<span class="source-line-no">2997</span><span id="line-2997">                Y = m.value[0] * X + b;</span>
<span class="source-line-no">2998</span><span id="line-2998">                if (pt0.x &lt; -maxPixels &amp;&amp; -maxPixels &lt; pt1.x) //pt0 is outside the area</span>
<span class="source-line-no">2999</span><span id="line-2999">                {</span>
<span class="source-line-no">3000</span><span id="line-3000">                    if (-maxPixels &lt;= Y &amp;&amp; Y &lt;= maxPixels) //intersection is on side 0</span>
<span class="source-line-no">3001</span><span id="line-3001">                    //if(minY&lt;=Y &amp;&amp; Y&lt;=maxY)    //intersection is on side 0</span>
<span class="source-line-no">3002</span><span id="line-3002">                    {</span>
<span class="source-line-no">3003</span><span id="line-3003">                        pt2.x = X;</span>
<span class="source-line-no">3004</span><span id="line-3004">                        pt2.y = Y;</span>
<span class="source-line-no">3005</span><span id="line-3005">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3006</span><span id="line-3006">                    }</span>
<span class="source-line-no">3007</span><span id="line-3007">                }</span>
<span class="source-line-no">3008</span><span id="line-3008">                if (pt1.x &lt; -maxPixels &amp;&amp; -maxPixels &lt; pt0.x) //pt1 is outside the area</span>
<span class="source-line-no">3009</span><span id="line-3009">                //if(pt1.x&lt;minX &amp;&amp; minX&lt;pt0.x)  //pt1 is outside the area</span>
<span class="source-line-no">3010</span><span id="line-3010">                {</span>
<span class="source-line-no">3011</span><span id="line-3011">                    if (-maxPixels &lt;= Y &amp;&amp; Y &lt;= maxPixels) //intersection is on side 0</span>
<span class="source-line-no">3012</span><span id="line-3012">                    {</span>
<span class="source-line-no">3013</span><span id="line-3013">                        pt3.x = X;</span>
<span class="source-line-no">3014</span><span id="line-3014">                        pt3.y = Y;</span>
<span class="source-line-no">3015</span><span id="line-3015">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3016</span><span id="line-3016">                    }</span>
<span class="source-line-no">3017</span><span id="line-3017">                }</span>
<span class="source-line-no">3018</span><span id="line-3018"></span>
<span class="source-line-no">3019</span><span id="line-3019">                //analysis for side 1, get the intersection for either point if it exists</span>
<span class="source-line-no">3020</span><span id="line-3020">                Y = -maxPixels;</span>
<span class="source-line-no">3021</span><span id="line-3021">                if (m.value[0] != 0) {</span>
<span class="source-line-no">3022</span><span id="line-3022">                    X = (Y - b) / m.value[0];</span>
<span class="source-line-no">3023</span><span id="line-3023">                    if (pt0.y &lt; -maxPixels &amp;&amp; -maxPixels &lt; pt1.y) //pt0 is outside the area</span>
<span class="source-line-no">3024</span><span id="line-3024">                    {</span>
<span class="source-line-no">3025</span><span id="line-3025">                        if (-maxPixels &lt;= X &amp;&amp; X &lt;= maxPixels) //intersection is on side 1</span>
<span class="source-line-no">3026</span><span id="line-3026">                        {</span>
<span class="source-line-no">3027</span><span id="line-3027">                            pt2.x = X;</span>
<span class="source-line-no">3028</span><span id="line-3028">                            pt2.y = Y;</span>
<span class="source-line-no">3029</span><span id="line-3029">                            nResult = 1;        //use at least some of the pixels</span>
<span class="source-line-no">3030</span><span id="line-3030">                        }</span>
<span class="source-line-no">3031</span><span id="line-3031">                    }</span>
<span class="source-line-no">3032</span><span id="line-3032">                    if (pt1.y &lt;= -maxPixels &amp;&amp; -maxPixels &lt;= pt0.y) //pt1 is outside the area</span>
<span class="source-line-no">3033</span><span id="line-3033">                    {</span>
<span class="source-line-no">3034</span><span id="line-3034">                        if (-maxPixels &lt; X &amp;&amp; X &lt; maxPixels) //intersection is on the boundary</span>
<span class="source-line-no">3035</span><span id="line-3035">                        {</span>
<span class="source-line-no">3036</span><span id="line-3036">                            pt3.x = X;</span>
<span class="source-line-no">3037</span><span id="line-3037">                            pt3.y = Y;</span>
<span class="source-line-no">3038</span><span id="line-3038">                            nResult = 1;        //use at least some of the pixels</span>
<span class="source-line-no">3039</span><span id="line-3039">                        }</span>
<span class="source-line-no">3040</span><span id="line-3040">                    }</span>
<span class="source-line-no">3041</span><span id="line-3041">                }</span>
<span class="source-line-no">3042</span><span id="line-3042">                //analysis for side 2, get the intersection for either point if it exists</span>
<span class="source-line-no">3043</span><span id="line-3043">                X = maxPixels;</span>
<span class="source-line-no">3044</span><span id="line-3044">                Y = m.value[0] * X + b;</span>
<span class="source-line-no">3045</span><span id="line-3045">                if (pt0.x &lt; maxPixels &amp;&amp; maxPixels &lt; pt1.x) //pt1 is outside the area</span>
<span class="source-line-no">3046</span><span id="line-3046">                {</span>
<span class="source-line-no">3047</span><span id="line-3047">                    if (-maxPixels &lt;= Y &amp;&amp; Y &lt;= maxPixels) //intersection is on the boundary</span>
<span class="source-line-no">3048</span><span id="line-3048">                    {</span>
<span class="source-line-no">3049</span><span id="line-3049">                        pt3.x = X;</span>
<span class="source-line-no">3050</span><span id="line-3050">                        pt3.y = Y;</span>
<span class="source-line-no">3051</span><span id="line-3051">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3052</span><span id="line-3052">                    }</span>
<span class="source-line-no">3053</span><span id="line-3053">                }</span>
<span class="source-line-no">3054</span><span id="line-3054">                if (pt1.x &lt; maxPixels &amp;&amp; maxPixels &lt; pt0.x) //pt0 is outside the area</span>
<span class="source-line-no">3055</span><span id="line-3055">                {</span>
<span class="source-line-no">3056</span><span id="line-3056">                    if (-maxPixels &lt;= Y &amp;&amp; Y &lt;= maxPixels) //intersection is on the boundary</span>
<span class="source-line-no">3057</span><span id="line-3057">                    {</span>
<span class="source-line-no">3058</span><span id="line-3058">                        pt2.x = X;</span>
<span class="source-line-no">3059</span><span id="line-3059">                        pt2.y = Y;</span>
<span class="source-line-no">3060</span><span id="line-3060">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3061</span><span id="line-3061">                    }</span>
<span class="source-line-no">3062</span><span id="line-3062">                }</span>
<span class="source-line-no">3063</span><span id="line-3063"></span>
<span class="source-line-no">3064</span><span id="line-3064">                //analysis for side 3, get the intersection for either point if it exists</span>
<span class="source-line-no">3065</span><span id="line-3065">                Y = maxPixels;</span>
<span class="source-line-no">3066</span><span id="line-3066">                if (m.value[0] != 0) {</span>
<span class="source-line-no">3067</span><span id="line-3067">                    X = (Y - b) / m.value[0];</span>
<span class="source-line-no">3068</span><span id="line-3068">                    if (pt0.y &lt; maxPixels &amp;&amp; maxPixels &lt; pt1.y) //pt1 is outside the area</span>
<span class="source-line-no">3069</span><span id="line-3069">                    {</span>
<span class="source-line-no">3070</span><span id="line-3070">                        if (-maxPixels &lt;= X &amp;&amp; X &lt;= maxPixels) //intersection is on the boundary</span>
<span class="source-line-no">3071</span><span id="line-3071">                        {</span>
<span class="source-line-no">3072</span><span id="line-3072">                            pt3.x = X;</span>
<span class="source-line-no">3073</span><span id="line-3073">                            pt3.y = Y;</span>
<span class="source-line-no">3074</span><span id="line-3074">                            nResult = 1;        //use at least some of the pixels</span>
<span class="source-line-no">3075</span><span id="line-3075">                        }</span>
<span class="source-line-no">3076</span><span id="line-3076">                    }</span>
<span class="source-line-no">3077</span><span id="line-3077">                    if (pt1.y &lt; maxPixels &amp;&amp; maxPixels &lt; pt0.y) //pt0 is outside the area</span>
<span class="source-line-no">3078</span><span id="line-3078">                    {</span>
<span class="source-line-no">3079</span><span id="line-3079">                        if (-maxPixels &lt;= X &amp;&amp; X &lt;= maxPixels) //intersection is on the boundary</span>
<span class="source-line-no">3080</span><span id="line-3080">                        {</span>
<span class="source-line-no">3081</span><span id="line-3081">                            pt2.x = X;</span>
<span class="source-line-no">3082</span><span id="line-3082">                            pt2.y = Y;</span>
<span class="source-line-no">3083</span><span id="line-3083">                            nResult = 1;        //use at least some of the pixels</span>
<span class="source-line-no">3084</span><span id="line-3084">                        }</span>
<span class="source-line-no">3085</span><span id="line-3085">                    }</span>
<span class="source-line-no">3086</span><span id="line-3086">                }</span>
<span class="source-line-no">3087</span><span id="line-3087">            }</span>
<span class="source-line-no">3088</span><span id="line-3088"></span>
<span class="source-line-no">3089</span><span id="line-3089">            //segment is vertical</span>
<span class="source-line-no">3090</span><span id="line-3090">            if (bolVertical == 0) {</span>
<span class="source-line-no">3091</span><span id="line-3091">                //analysis for side 1</span>
<span class="source-line-no">3092</span><span id="line-3092">                X = pt0.x;</span>
<span class="source-line-no">3093</span><span id="line-3093">                Y = -maxPixels;</span>
<span class="source-line-no">3094</span><span id="line-3094">                if (-maxPixels &lt; pt0.x &amp;&amp; pt0.x &lt; maxPixels) {</span>
<span class="source-line-no">3095</span><span id="line-3095">                    if (pt0.y &lt;= -maxPixels &amp;&amp; -maxPixels &lt;= pt1.y) //pt0 outside the area</span>
<span class="source-line-no">3096</span><span id="line-3096">                    {</span>
<span class="source-line-no">3097</span><span id="line-3097">                        pt2.x = X;</span>
<span class="source-line-no">3098</span><span id="line-3098">                        pt2.y = Y;</span>
<span class="source-line-no">3099</span><span id="line-3099">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3100</span><span id="line-3100">                    }</span>
<span class="source-line-no">3101</span><span id="line-3101">                    if (pt1.y &lt;= -maxPixels &amp;&amp; -maxPixels &lt;= pt0.y) //pt1 outside the area</span>
<span class="source-line-no">3102</span><span id="line-3102">                    {</span>
<span class="source-line-no">3103</span><span id="line-3103">                        pt3.x = X;</span>
<span class="source-line-no">3104</span><span id="line-3104">                        pt3.y = Y;</span>
<span class="source-line-no">3105</span><span id="line-3105">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3106</span><span id="line-3106">                    }</span>
<span class="source-line-no">3107</span><span id="line-3107">                }</span>
<span class="source-line-no">3108</span><span id="line-3108"></span>
<span class="source-line-no">3109</span><span id="line-3109">                //analysis for side 3</span>
<span class="source-line-no">3110</span><span id="line-3110">                X = pt0.x;</span>
<span class="source-line-no">3111</span><span id="line-3111">                Y = maxPixels;</span>
<span class="source-line-no">3112</span><span id="line-3112">                if (-maxPixels &lt; pt0.x &amp;&amp; pt0.x &lt; maxPixels) {</span>
<span class="source-line-no">3113</span><span id="line-3113">                    if (pt0.y &lt;= maxPixels &amp;&amp; maxPixels &lt;= pt1.y) //pt1 outside the area</span>
<span class="source-line-no">3114</span><span id="line-3114">                    {</span>
<span class="source-line-no">3115</span><span id="line-3115">                        pt3.x = X;</span>
<span class="source-line-no">3116</span><span id="line-3116">                        pt3.y = Y;</span>
<span class="source-line-no">3117</span><span id="line-3117">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3118</span><span id="line-3118">                    }</span>
<span class="source-line-no">3119</span><span id="line-3119">                    if (pt1.y &lt;= maxPixels &amp;&amp; maxPixels &lt;= pt0.y) //pt0 outside the area</span>
<span class="source-line-no">3120</span><span id="line-3120">                    {</span>
<span class="source-line-no">3121</span><span id="line-3121">                        pt2.x = X;</span>
<span class="source-line-no">3122</span><span id="line-3122">                        pt2.y = Y;</span>
<span class="source-line-no">3123</span><span id="line-3123">                        nResult = 1;    //use at least some of the pixels</span>
<span class="source-line-no">3124</span><span id="line-3124">                    }</span>
<span class="source-line-no">3125</span><span id="line-3125">                }</span>
<span class="source-line-no">3126</span><span id="line-3126">            }</span>
<span class="source-line-no">3127</span><span id="line-3127"></span>
<span class="source-line-no">3128</span><span id="line-3128">            pt2x.value[0] = pt2.x;</span>
<span class="source-line-no">3129</span><span id="line-3129">            pt2y.value[0] = pt2.y;</span>
<span class="source-line-no">3130</span><span id="line-3130">            pt3x.value[0] = pt3.x;</span>
<span class="source-line-no">3131</span><span id="line-3131">            pt3y.value[0] = pt3.y;</span>
<span class="source-line-no">3132</span><span id="line-3132">        } catch (Exception exc) {</span>
<span class="source-line-no">3133</span><span id="line-3133">            ErrorLogger.LogException(_className, "DisplayIntersectPixels",</span>
<span class="source-line-no">3134</span><span id="line-3134">                    new RendererException("Failed inside DisplayIntersectPixels", exc));</span>
<span class="source-line-no">3135</span><span id="line-3135">        }</span>
<span class="source-line-no">3136</span><span id="line-3136">        return nResult;</span>
<span class="source-line-no">3137</span><span id="line-3137">    }</span>
<span class="source-line-no">3138</span><span id="line-3138">    /**</span>
<span class="source-line-no">3139</span><span id="line-3139">     * Computes Ditch spikes for the ATDITCH line types. This function uses</span>
<span class="source-line-no">3140</span><span id="line-3140">     * linestyles provided by the caller to skip segments.</span>
<span class="source-line-no">3141</span><span id="line-3141">     *</span>
<span class="source-line-no">3142</span><span id="line-3142">     * @param pLinePoints OUT - the client points also used for the return</span>
<span class="source-line-no">3143</span><span id="line-3143">     * points</span>
<span class="source-line-no">3144</span><span id="line-3144">     * @param nOldCounter the number of client points</span>
<span class="source-line-no">3145</span><span id="line-3145">     * @param bWayIs the parallel line to use (0) for inner or outer spikes</span>
<span class="source-line-no">3146</span><span id="line-3146">     * @param linetype the line type</span>
<span class="source-line-no">3147</span><span id="line-3147">     *</span>
<span class="source-line-no">3148</span><span id="line-3148">     * @return the symbol point count</span>
<span class="source-line-no">3149</span><span id="line-3149">     */</span>
<span class="source-line-no">3150</span><span id="line-3150">    protected static int GetDitchSpikeDouble(TGLight tg, POINT2[] pLinePoints,</span>
<span class="source-line-no">3151</span><span id="line-3151">            int nOldCounter,</span>
<span class="source-line-no">3152</span><span id="line-3152">            int bWayIs) {</span>
<span class="source-line-no">3153</span><span id="line-3153">        int nSpikeCounter = 0;</span>
<span class="source-line-no">3154</span><span id="line-3154">        try {</span>
<span class="source-line-no">3155</span><span id="line-3155">            //declarations</span>
<span class="source-line-no">3156</span><span id="line-3156">            int linetype = tg.get_LineType();</span>
<span class="source-line-no">3157</span><span id="line-3157">            int nNumberOfSegments = 0,</span>
<span class="source-line-no">3158</span><span id="line-3158">                    lCircleCounter = 0,</span>
<span class="source-line-no">3159</span><span id="line-3159">                    bolVertical = 0,</span>
<span class="source-line-no">3160</span><span id="line-3160">                    nTemp = 0,</span>
<span class="source-line-no">3161</span><span id="line-3161">                    i,</span>
<span class="source-line-no">3162</span><span id="line-3162">                    j;</span>
<span class="source-line-no">3163</span><span id="line-3163">            double dPrinter = 1.0;</span>
<span class="source-line-no">3164</span><span id="line-3164">            double dIntLocation1x = 0,</span>
<span class="source-line-no">3165</span><span id="line-3165">                    dIntLocation2x = 0,</span>
<span class="source-line-no">3166</span><span id="line-3166">                    dIntLocation1y = 0,</span>
<span class="source-line-no">3167</span><span id="line-3167">                    dIntLocation2y = 0,</span>
<span class="source-line-no">3168</span><span id="line-3168">                    r = 0,</span>
<span class="source-line-no">3169</span><span id="line-3169">                    s = 0,</span>
<span class="source-line-no">3170</span><span id="line-3170">                    use = 0,</span>
<span class="source-line-no">3171</span><span id="line-3171">                    length = 0,</span>
<span class="source-line-no">3172</span><span id="line-3172">                    k = 0,</span>
<span class="source-line-no">3173</span><span id="line-3173">                    bint = 0;</span>
<span class="source-line-no">3174</span><span id="line-3174">            ref&lt;double[]&gt; pdAnswer = new ref();//new double[6];</span>
<span class="source-line-no">3175</span><span id="line-3175">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">3176</span><span id="line-3176"></span>
<span class="source-line-no">3177</span><span id="line-3177">            POINT2 UpperLinePoint = new POINT2(pLinePoints[0]),</span>
<span class="source-line-no">3178</span><span id="line-3178">                    Lower1LinePoint = new POINT2(pLinePoints[0]),</span>
<span class="source-line-no">3179</span><span id="line-3179">                    Lower2LinePoint = new POINT2(pLinePoints[0]),</span>
<span class="source-line-no">3180</span><span id="line-3180">                    a = new POINT2(pLinePoints[0]),</span>
<span class="source-line-no">3181</span><span id="line-3181">                    b = new POINT2(pLinePoints[0]);</span>
<span class="source-line-no">3182</span><span id="line-3182">            POINT2[] pCirclePoints = new POINT2[pLinePoints.length];</span>
<span class="source-line-no">3183</span><span id="line-3183">            POINT2 averagePoint = new POINT2();</span>
<span class="source-line-no">3184</span><span id="line-3184">            POINT2 lastAveragePoint = new POINT2();</span>
<span class="source-line-no">3185</span><span id="line-3185">            POINT2[] pTempLinePoints = null;</span>
<span class="source-line-no">3186</span><span id="line-3186">            //end declarations</span>
<span class="source-line-no">3187</span><span id="line-3187"></span>
<span class="source-line-no">3188</span><span id="line-3188">            pTempLinePoints = new POINT2[nOldCounter];</span>
<span class="source-line-no">3189</span><span id="line-3189">            for (j = 0; j &lt; nOldCounter; j++) {</span>
<span class="source-line-no">3190</span><span id="line-3190">                pTempLinePoints[j] = new POINT2(pLinePoints[j]);</span>
<span class="source-line-no">3191</span><span id="line-3191">            }</span>
<span class="source-line-no">3192</span><span id="line-3192"></span>
<span class="source-line-no">3193</span><span id="line-3193">            ArrayList&lt;POINT2&gt; basePoints = new ArrayList();</span>
<span class="source-line-no">3194</span><span id="line-3194"></span>
<span class="source-line-no">3195</span><span id="line-3195">            InitializePOINT2Array(pCirclePoints);</span>
<span class="source-line-no">3196</span><span id="line-3196">            nSpikeCounter = nOldCounter;</span>
<span class="source-line-no">3197</span><span id="line-3197">            double spikeLength = arraysupport.getScaledSize(12, tg.get_LineThickness());</span>
<span class="source-line-no">3198</span><span id="line-3198">            double spikeHeight = spikeLength * 1.25;</span>
<span class="source-line-no">3199</span><span id="line-3199">            double minLength = 2 * spikeLength;</span>
<span class="source-line-no">3200</span><span id="line-3200">            for (i = 0; i &lt; nOldCounter - 1; i++) {</span>
<span class="source-line-no">3201</span><span id="line-3201">                if (linetype == TacticalLines.ATDITCHM &amp;&amp; i == 0) {</span>
<span class="source-line-no">3202</span><span id="line-3202">                    double radius = arraysupport.getScaledSize(4, tg.get_LineThickness());</span>
<span class="source-line-no">3203</span><span id="line-3203">                    minLength = spikeLength * 2.5 + radius * 2;</span>
<span class="source-line-no">3204</span><span id="line-3204">                }</span>
<span class="source-line-no">3205</span><span id="line-3205"></span>
<span class="source-line-no">3206</span><span id="line-3206">                nTemp = CalcTrueLinesDouble((long) (spikeHeight * dPrinter), pLinePoints[i], pLinePoints[i + 1], pdAnswer);</span>
<span class="source-line-no">3207</span><span id="line-3207">                r = pdAnswer.value[3];</span>
<span class="source-line-no">3208</span><span id="line-3208">                s = pdAnswer.value[5];</span>
<span class="source-line-no">3209</span><span id="line-3209">                length = CalcDistanceDouble(pLinePoints[i], pLinePoints[i + 1]);</span>
<span class="source-line-no">3210</span><span id="line-3210">                bolVertical = CalcTrueSlopeDouble(pLinePoints[i], pLinePoints[i + 1], m);</span>
<span class="source-line-no">3211</span><span id="line-3211">                nNumberOfSegments = (int) ((length - 1) / (spikeLength * dPrinter));</span>
<span class="source-line-no">3212</span><span id="line-3212"></span>
<span class="source-line-no">3213</span><span id="line-3213">                if (length &gt; minLength * dPrinter) {    //minLength was 24</span>
<span class="source-line-no">3214</span><span id="line-3214">                    if (bWayIs != 0) {</span>
<span class="source-line-no">3215</span><span id="line-3215">                        if (pLinePoints[i].x &lt;= pLinePoints[i + 1].x) {</span>
<span class="source-line-no">3216</span><span id="line-3216">                            use = r;</span>
<span class="source-line-no">3217</span><span id="line-3217">                        }</span>
<span class="source-line-no">3218</span><span id="line-3218">                        if (pLinePoints[i].x &gt;= pLinePoints[i + 1].x) {</span>
<span class="source-line-no">3219</span><span id="line-3219">                            use = s;</span>
<span class="source-line-no">3220</span><span id="line-3220">                        }</span>
<span class="source-line-no">3221</span><span id="line-3221">                    } //end if</span>
<span class="source-line-no">3222</span><span id="line-3222">                    else {</span>
<span class="source-line-no">3223</span><span id="line-3223">                        if (pLinePoints[i].x &lt;= pLinePoints[i + 1].x) {</span>
<span class="source-line-no">3224</span><span id="line-3224">                            use = s;</span>
<span class="source-line-no">3225</span><span id="line-3225">                        }</span>
<span class="source-line-no">3226</span><span id="line-3226">                        if (pLinePoints[i].x &gt;= pLinePoints[i + 1].x) {</span>
<span class="source-line-no">3227</span><span id="line-3227">                            use = r;</span>
<span class="source-line-no">3228</span><span id="line-3228">                        }</span>
<span class="source-line-no">3229</span><span id="line-3229">                    }   //end else</span>
<span class="source-line-no">3230</span><span id="line-3230"></span>
<span class="source-line-no">3231</span><span id="line-3231">                    for (j = 1; j &lt;= nNumberOfSegments; j++) {</span>
<span class="source-line-no">3232</span><span id="line-3232">                        k = (double) j;</span>
<span class="source-line-no">3233</span><span id="line-3233">                        a = new POINT2(pLinePoints[i]);</span>
<span class="source-line-no">3234</span><span id="line-3234">                        b = new POINT2(pLinePoints[i + 1]);</span>
<span class="source-line-no">3235</span><span id="line-3235"></span>
<span class="source-line-no">3236</span><span id="line-3236">                        if (j &gt; 1) {</span>
<span class="source-line-no">3237</span><span id="line-3237">                            dIntLocation1x = dIntLocation2x;</span>
<span class="source-line-no">3238</span><span id="line-3238">                        } else {</span>
<span class="source-line-no">3239</span><span id="line-3239">                            dIntLocation1x</span>
<span class="source-line-no">3240</span><span id="line-3240">                                    = (double) pLinePoints[i].x + ((k * spikeLength - spikeLength) * dPrinter / length)</span>
<span class="source-line-no">3241</span><span id="line-3241">                                    * (double) (pLinePoints[i + 1].x - pLinePoints[i].x);</span>
<span class="source-line-no">3242</span><span id="line-3242">                        }</span>
<span class="source-line-no">3243</span><span id="line-3243"></span>
<span class="source-line-no">3244</span><span id="line-3244">                        if (j &gt; 1) //added M. Deutch 2-23-99</span>
<span class="source-line-no">3245</span><span id="line-3245">                        {</span>
<span class="source-line-no">3246</span><span id="line-3246">                            dIntLocation1y = dIntLocation2y;</span>
<span class="source-line-no">3247</span><span id="line-3247">                        } else {</span>
<span class="source-line-no">3248</span><span id="line-3248">                            dIntLocation1y</span>
<span class="source-line-no">3249</span><span id="line-3249">                                    = (double) pLinePoints[i].y + ((k * spikeLength - spikeLength / 2) * dPrinter / length)</span>
<span class="source-line-no">3250</span><span id="line-3250">                                    * (double) (pLinePoints[i + 1].y - pLinePoints[i].y);</span>
<span class="source-line-no">3251</span><span id="line-3251">                        }</span>
<span class="source-line-no">3252</span><span id="line-3252"></span>
<span class="source-line-no">3253</span><span id="line-3253">                        dIntLocation2x = (double) pLinePoints[i].x</span>
<span class="source-line-no">3254</span><span id="line-3254">                                + ((k * spikeLength + spikeLength / 2) * dPrinter / length)</span>
<span class="source-line-no">3255</span><span id="line-3255">                                * (double) (pLinePoints[i + 1].x</span>
<span class="source-line-no">3256</span><span id="line-3256">                                - pLinePoints[i].x);</span>
<span class="source-line-no">3257</span><span id="line-3257"></span>
<span class="source-line-no">3258</span><span id="line-3258">                        dIntLocation2y = (double) pLinePoints[i].y</span>
<span class="source-line-no">3259</span><span id="line-3259">                                + ((k * spikeLength + spikeLength / 2) * dPrinter / length)</span>
<span class="source-line-no">3260</span><span id="line-3260">                                * (double) (pLinePoints[i + 1].y</span>
<span class="source-line-no">3261</span><span id="line-3261">                                - pLinePoints[i].y);</span>
<span class="source-line-no">3262</span><span id="line-3262"></span>
<span class="source-line-no">3263</span><span id="line-3263">                        if (m.value[0] != 0 &amp;&amp; bolVertical != 0) {</span>
<span class="source-line-no">3264</span><span id="line-3264">                            bint = (dIntLocation1y + dIntLocation2y) / 2.0</span>
<span class="source-line-no">3265</span><span id="line-3265">                                    + (1 / m.value[0]) * (dIntLocation1x + dIntLocation2x) / 2.0;</span>
<span class="source-line-no">3266</span><span id="line-3266">                            //independent of direction</span>
<span class="source-line-no">3267</span><span id="line-3267">                            UpperLinePoint = CalcTrueIntersectDouble2(m.value[0], use, -1 / m.value[0], bint, 1, 1, pLinePoints[0].x, pLinePoints[0].y);</span>
<span class="source-line-no">3268</span><span id="line-3268">                        }</span>
<span class="source-line-no">3269</span><span id="line-3269"></span>
<span class="source-line-no">3270</span><span id="line-3270">                        if (bolVertical == 0) //vertical segment</span>
<span class="source-line-no">3271</span><span id="line-3271">                        {</span>
<span class="source-line-no">3272</span><span id="line-3272">                            if (dIntLocation1y &lt; dIntLocation2y) {</span>
<span class="source-line-no">3273</span><span id="line-3273">                                UpperLinePoint.y = (int) dIntLocation1y + (int) (length / nNumberOfSegments / 2);</span>
<span class="source-line-no">3274</span><span id="line-3274">                            } else {</span>
<span class="source-line-no">3275</span><span id="line-3275">                                UpperLinePoint.y = (int) dIntLocation1y - (int) (length / nNumberOfSegments / 2);</span>
<span class="source-line-no">3276</span><span id="line-3276">                            }</span>
<span class="source-line-no">3277</span><span id="line-3277">                            if (pLinePoints[i].y &lt; pLinePoints[i + 1].y) {</span>
<span class="source-line-no">3278</span><span id="line-3278">                                UpperLinePoint.x = (int) dIntLocation1x + (int) (length / nNumberOfSegments);</span>
<span class="source-line-no">3279</span><span id="line-3279">                            } else {</span>
<span class="source-line-no">3280</span><span id="line-3280">                                UpperLinePoint.x = (int) dIntLocation1x - (int) (length / nNumberOfSegments);</span>
<span class="source-line-no">3281</span><span id="line-3281">                            }</span>
<span class="source-line-no">3282</span><span id="line-3282">                        }</span>
<span class="source-line-no">3283</span><span id="line-3283">                        if (m.value[0] == 0 &amp;&amp; bolVertical != 0) {</span>
<span class="source-line-no">3284</span><span id="line-3284">                            if (dIntLocation1x &lt; dIntLocation2x) {</span>
<span class="source-line-no">3285</span><span id="line-3285">                                UpperLinePoint.x = (int) dIntLocation1x + (int) (length / nNumberOfSegments / 2);</span>
<span class="source-line-no">3286</span><span id="line-3286">                            } else {</span>
<span class="source-line-no">3287</span><span id="line-3287">                                UpperLinePoint.x = (int) dIntLocation1x - (int) (length / nNumberOfSegments / 2);</span>
<span class="source-line-no">3288</span><span id="line-3288">                            }</span>
<span class="source-line-no">3289</span><span id="line-3289">                            if (pLinePoints[i + 1].x &lt; pLinePoints[i].x) {</span>
<span class="source-line-no">3290</span><span id="line-3290">                                UpperLinePoint.y = (int) dIntLocation1y + (int) (length / nNumberOfSegments);</span>
<span class="source-line-no">3291</span><span id="line-3291">                            } else {</span>
<span class="source-line-no">3292</span><span id="line-3292">                                UpperLinePoint.y = (int) dIntLocation1y - (int) (length / nNumberOfSegments);</span>
<span class="source-line-no">3293</span><span id="line-3293">                            }</span>
<span class="source-line-no">3294</span><span id="line-3294">                        }</span>
<span class="source-line-no">3295</span><span id="line-3295">                        //end section</span>
<span class="source-line-no">3296</span><span id="line-3296"></span>
<span class="source-line-no">3297</span><span id="line-3297">                        Lower1LinePoint.x = dIntLocation1x;</span>
<span class="source-line-no">3298</span><span id="line-3298">                        Lower1LinePoint.y = dIntLocation1y;</span>
<span class="source-line-no">3299</span><span id="line-3299">                        Lower2LinePoint.x = dIntLocation2x;</span>
<span class="source-line-no">3300</span><span id="line-3300">                        Lower2LinePoint.y = dIntLocation2y;</span>
<span class="source-line-no">3301</span><span id="line-3301"></span>
<span class="source-line-no">3302</span><span id="line-3302">                        pLinePoints[nSpikeCounter] = new POINT2(Lower1LinePoint);</span>
<span class="source-line-no">3303</span><span id="line-3303">                        if (linetype == TacticalLines.ATDITCHC || linetype == TacticalLines.ATDITCHM) {</span>
<span class="source-line-no">3304</span><span id="line-3304">                            pLinePoints[nSpikeCounter].style = 9;</span>
<span class="source-line-no">3305</span><span id="line-3305">                        }</span>
<span class="source-line-no">3306</span><span id="line-3306">                        if (j % 2 == 1 &amp;&amp; linetype == TacticalLines.ATDITCHM)//diagnostic 1-8-13</span>
<span class="source-line-no">3307</span><span id="line-3307">                        {</span>
<span class="source-line-no">3308</span><span id="line-3308">                            pLinePoints[nSpikeCounter].style = 5;</span>
<span class="source-line-no">3309</span><span id="line-3309">                        }</span>
<span class="source-line-no">3310</span><span id="line-3310"></span>
<span class="source-line-no">3311</span><span id="line-3311">                        nSpikeCounter++;</span>
<span class="source-line-no">3312</span><span id="line-3312"></span>
<span class="source-line-no">3313</span><span id="line-3313">                        pLinePoints[nSpikeCounter] = new POINT2(UpperLinePoint);</span>
<span class="source-line-no">3314</span><span id="line-3314">                        if (linetype == (long) TacticalLines.ATDITCHC || linetype == (long) TacticalLines.ATDITCHM) {</span>
<span class="source-line-no">3315</span><span id="line-3315">                            pLinePoints[nSpikeCounter].style = 9;</span>
<span class="source-line-no">3316</span><span id="line-3316">                        }</span>
<span class="source-line-no">3317</span><span id="line-3317">                        if (j % 2 == 1 &amp;&amp; linetype == TacticalLines.ATDITCHM)//diagnostic 1-8-13</span>
<span class="source-line-no">3318</span><span id="line-3318">                        {</span>
<span class="source-line-no">3319</span><span id="line-3319">                            pLinePoints[nSpikeCounter].style = 5;</span>
<span class="source-line-no">3320</span><span id="line-3320">                        }</span>
<span class="source-line-no">3321</span><span id="line-3321"></span>
<span class="source-line-no">3322</span><span id="line-3322">                        nSpikeCounter++;</span>
<span class="source-line-no">3323</span><span id="line-3323"></span>
<span class="source-line-no">3324</span><span id="line-3324">                        pLinePoints[nSpikeCounter] = new POINT2(Lower2LinePoint);</span>
<span class="source-line-no">3325</span><span id="line-3325">                        if (linetype == (long) TacticalLines.ATDITCHC || linetype == (long) TacticalLines.ATDITCHM) {</span>
<span class="source-line-no">3326</span><span id="line-3326">                            pLinePoints[nSpikeCounter].style = 10;</span>
<span class="source-line-no">3327</span><span id="line-3327">                        }</span>
<span class="source-line-no">3328</span><span id="line-3328">                        if (j % 2 == 1 &amp;&amp; linetype == TacticalLines.ATDITCHM)//diagnostic 1-8-13</span>
<span class="source-line-no">3329</span><span id="line-3329">                        {</span>
<span class="source-line-no">3330</span><span id="line-3330">                            pLinePoints[nSpikeCounter].style = 5;</span>
<span class="source-line-no">3331</span><span id="line-3331">                        }</span>
<span class="source-line-no">3332</span><span id="line-3332"></span>
<span class="source-line-no">3333</span><span id="line-3333">                        nSpikeCounter++;</span>
<span class="source-line-no">3334</span><span id="line-3334"></span>
<span class="source-line-no">3335</span><span id="line-3335">                        if (linetype == TacticalLines.ATDITCHM) {</span>
<span class="source-line-no">3336</span><span id="line-3336">                            if (j % 2 == 0) {</span>
<span class="source-line-no">3337</span><span id="line-3337">                                averagePoint = lineutility.MidPointDouble(Lower1LinePoint, Lower2LinePoint, 0);</span>
<span class="source-line-no">3338</span><span id="line-3338">                                averagePoint = lineutility.MidPointDouble(averagePoint, UpperLinePoint, 0);</span>
<span class="source-line-no">3339</span><span id="line-3339">                            } else if (j == 1) {</span>
<span class="source-line-no">3340</span><span id="line-3340">                                averagePoint = lineutility.ExtendLineDouble(Lower2LinePoint, Lower1LinePoint, 5);</span>
<span class="source-line-no">3341</span><span id="line-3341">                                averagePoint = lineutility.MidPointDouble(averagePoint, UpperLinePoint, 0);</span>
<span class="source-line-no">3342</span><span id="line-3342">                            }</span>
<span class="source-line-no">3343</span><span id="line-3343">                        }</span>
<span class="source-line-no">3344</span><span id="line-3344">                        //end section</span>
<span class="source-line-no">3345</span><span id="line-3345">                        if (j &gt; 1 &amp;&amp; j &lt; nNumberOfSegments) {</span>
<span class="source-line-no">3346</span><span id="line-3346">                            basePoints.add(new POINT2(Lower1LinePoint));</span>
<span class="source-line-no">3347</span><span id="line-3347">                            //if(j==nNumberOfSegments-1)</span>
<span class="source-line-no">3348</span><span id="line-3348">                            //  basePoints.get(basePoints.size()-1).style=5;</span>
<span class="source-line-no">3349</span><span id="line-3349">                        } else if (j == 1) {</span>
<span class="source-line-no">3350</span><span id="line-3350">                            basePoints.add(new POINT2(pLinePoints[i]));</span>
<span class="source-line-no">3351</span><span id="line-3351">                        } else if (j == nNumberOfSegments) {</span>
<span class="source-line-no">3352</span><span id="line-3352">                            basePoints.add(new POINT2(pLinePoints[i + 1]));</span>
<span class="source-line-no">3353</span><span id="line-3353">                            basePoints.get(basePoints.size() - 1).style = 5;</span>
<span class="source-line-no">3354</span><span id="line-3354">                        }</span>
<span class="source-line-no">3355</span><span id="line-3355">                        if (linetype == TacticalLines.ATDITCHM &amp;&amp; j &gt; 1) {</span>
<span class="source-line-no">3356</span><span id="line-3356">                            if (j % 2 == 0) {</span>
<span class="source-line-no">3357</span><span id="line-3357">                                pCirclePoints[lCircleCounter] = lineutility.MidPointDouble(averagePoint, lastAveragePoint, 20);</span>
<span class="source-line-no">3358</span><span id="line-3358">                                lCircleCounter++;</span>
<span class="source-line-no">3359</span><span id="line-3359">                            }</span>
<span class="source-line-no">3360</span><span id="line-3360">                            //end section</span>
<span class="source-line-no">3361</span><span id="line-3361">                        }</span>
<span class="source-line-no">3362</span><span id="line-3362">                        if (j &lt; nNumberOfSegments &amp;&amp; linetype == TacticalLines.ATDITCHM) {</span>
<span class="source-line-no">3363</span><span id="line-3363">                            if (j == 1 || j % 2 == 0) {</span>
<span class="source-line-no">3364</span><span id="line-3364">                                //LastUpperLinePoint = new POINT2(UpperLinePoint);</span>
<span class="source-line-no">3365</span><span id="line-3365">                                lastAveragePoint = new POINT2(averagePoint);</span>
<span class="source-line-no">3366</span><span id="line-3366">                            }</span>
<span class="source-line-no">3367</span><span id="line-3367">                            //end section</span>
<span class="source-line-no">3368</span><span id="line-3368">                        }</span>
<span class="source-line-no">3369</span><span id="line-3369">                    }//end for j&lt;numberOfsegments</span>
<span class="source-line-no">3370</span><span id="line-3370">                } //end if length big enough</span>
<span class="source-line-no">3371</span><span id="line-3371">                else {</span>
<span class="source-line-no">3372</span><span id="line-3372">                    //diagnostic</span>
<span class="source-line-no">3373</span><span id="line-3373">                    pLinePoints[nSpikeCounter].x = pLinePoints[i].x;</span>
<span class="source-line-no">3374</span><span id="line-3374">                    pLinePoints[nSpikeCounter].y = pLinePoints[i].y;</span>
<span class="source-line-no">3375</span><span id="line-3375">                    pLinePoints[nSpikeCounter].style = 0;</span>
<span class="source-line-no">3376</span><span id="line-3376">                    nSpikeCounter++;</span>
<span class="source-line-no">3377</span><span id="line-3377">                    pLinePoints[nSpikeCounter].x = pLinePoints[i + 1].x;</span>
<span class="source-line-no">3378</span><span id="line-3378">                    pLinePoints[nSpikeCounter].y = pLinePoints[i + 1].y;</span>
<span class="source-line-no">3379</span><span id="line-3379">                    pLinePoints[nSpikeCounter].style = 5;</span>
<span class="source-line-no">3380</span><span id="line-3380">                    nSpikeCounter++;</span>
<span class="source-line-no">3381</span><span id="line-3381">                }</span>
<span class="source-line-no">3382</span><span id="line-3382">            }</span>
<span class="source-line-no">3383</span><span id="line-3383"></span>
<span class="source-line-no">3384</span><span id="line-3384">            for (j = 0; j &lt; nOldCounter; j++) //reverse the first nOldCounter points for</span>
<span class="source-line-no">3385</span><span id="line-3385">            {</span>
<span class="source-line-no">3386</span><span id="line-3386">                pLinePoints[j] = new POINT2(pTempLinePoints[nOldCounter - j - 1]); //purpose of drawing</span>
<span class="source-line-no">3387</span><span id="line-3387">                pLinePoints[j].style = 5;</span>
<span class="source-line-no">3388</span><span id="line-3388">            }</span>
<span class="source-line-no">3389</span><span id="line-3389"></span>
<span class="source-line-no">3390</span><span id="line-3390">            if (pLinePoints[nSpikeCounter - 1].style == 0) {</span>
<span class="source-line-no">3391</span><span id="line-3391">                pLinePoints[nSpikeCounter - 1].style = 5;</span>
<span class="source-line-no">3392</span><span id="line-3392">            }</span>
<span class="source-line-no">3393</span><span id="line-3393">            int t=basePoints.size();</span>
<span class="source-line-no">3394</span><span id="line-3394">            //for (j = nSpikeCounter; j &lt; nSpikeCounter + basePoints.size(); j++) </span>
<span class="source-line-no">3395</span><span id="line-3395">            for (j = nSpikeCounter; j &lt; nSpikeCounter + t; j++) </span>
<span class="source-line-no">3396</span><span id="line-3396">            {</span>
<span class="source-line-no">3397</span><span id="line-3397">                pLinePoints[j] = new POINT2(basePoints.get(j - nSpikeCounter));</span>
<span class="source-line-no">3398</span><span id="line-3398">                //if(linetype == TacticalLines.ATDITCHM &amp;&amp; pLinePoints[j].style != 5)</span>
<span class="source-line-no">3399</span><span id="line-3399">                if (pLinePoints[j].style != 5) {</span>
<span class="source-line-no">3400</span><span id="line-3400">                    pLinePoints[j].style = 0;</span>
<span class="source-line-no">3401</span><span id="line-3401">                }</span>
<span class="source-line-no">3402</span><span id="line-3402">            }</span>
<span class="source-line-no">3403</span><span id="line-3403">            nSpikeCounter += basePoints.size();</span>
<span class="source-line-no">3404</span><span id="line-3404"></span>
<span class="source-line-no">3405</span><span id="line-3405">            if (linetype == (int) TacticalLines.ATDITCHM) {</span>
<span class="source-line-no">3406</span><span id="line-3406">                pLinePoints[nSpikeCounter - 1].style = 5;//was 10</span>
<span class="source-line-no">3407</span><span id="line-3407">                for (j = nSpikeCounter; j &lt; nSpikeCounter + lCircleCounter; j++) {</span>
<span class="source-line-no">3408</span><span id="line-3408">                    pLinePoints[j] = new POINT2(pCirclePoints[j - nSpikeCounter]);</span>
<span class="source-line-no">3409</span><span id="line-3409">                    pLinePoints[j].style = 20;</span>
<span class="source-line-no">3410</span><span id="line-3410">                }</span>
<span class="source-line-no">3411</span><span id="line-3411">                nSpikeCounter += lCircleCounter;</span>
<span class="source-line-no">3412</span><span id="line-3412">            }</span>
<span class="source-line-no">3413</span><span id="line-3413"></span>
<span class="source-line-no">3414</span><span id="line-3414">        } catch (Exception exc) {</span>
<span class="source-line-no">3415</span><span id="line-3415">            ErrorLogger.LogException(_className, "GetDitchSpikeDouble",</span>
<span class="source-line-no">3416</span><span id="line-3416">                    new RendererException("Failed inside GetDitchSpikeDouble", exc));</span>
<span class="source-line-no">3417</span><span id="line-3417">        }</span>
<span class="source-line-no">3418</span><span id="line-3418">        return nSpikeCounter;</span>
<span class="source-line-no">3419</span><span id="line-3419">    }</span>
<span class="source-line-no">3420</span><span id="line-3420"></span>
<span class="source-line-no">3421</span><span id="line-3421">    /**</span>
<span class="source-line-no">3422</span><span id="line-3422">     * Moves pixels if points are identical, used for the channel types</span>
<span class="source-line-no">3423</span><span id="line-3423">     *</span>
<span class="source-line-no">3424</span><span id="line-3424">     * @param pLinePoints OUT - client points also for returned points</span>
<span class="source-line-no">3425</span><span id="line-3425">     */</span>
<span class="source-line-no">3426</span><span id="line-3426">    protected static void MoveChannelPixels(POINT2[] pLinePoints) {</span>
<span class="source-line-no">3427</span><span id="line-3427">        try {</span>
<span class="source-line-no">3428</span><span id="line-3428">            if (pLinePoints == null || pLinePoints.length &lt;= 0) {</span>
<span class="source-line-no">3429</span><span id="line-3429">                return;</span>
<span class="source-line-no">3430</span><span id="line-3430">            }</span>
<span class="source-line-no">3431</span><span id="line-3431"></span>
<span class="source-line-no">3432</span><span id="line-3432">            double[] pixels = new double[pLinePoints.length * 2];</span>
<span class="source-line-no">3433</span><span id="line-3433">            boolean bolNoRepeats;</span>
<span class="source-line-no">3434</span><span id="line-3434">            int j, k = 0;</span>
<span class="source-line-no">3435</span><span id="line-3435">            double x1;</span>
<span class="source-line-no">3436</span><span id="line-3436">            double y1;</span>
<span class="source-line-no">3437</span><span id="line-3437">            double x2;</span>
<span class="source-line-no">3438</span><span id="line-3438">            double y2;</span>
<span class="source-line-no">3439</span><span id="line-3439">            int count = pLinePoints.length;</span>
<span class="source-line-no">3440</span><span id="line-3440">            //stuff pixels</span>
<span class="source-line-no">3441</span><span id="line-3441">            for (j = 0; j &lt; count; j++) {</span>
<span class="source-line-no">3442</span><span id="line-3442">                pixels[k++] = pLinePoints[j].x;</span>
<span class="source-line-no">3443</span><span id="line-3443">                pixels[k++] = pLinePoints[j].y;</span>
<span class="source-line-no">3444</span><span id="line-3444">            }</span>
<span class="source-line-no">3445</span><span id="line-3445"></span>
<span class="source-line-no">3446</span><span id="line-3446">            bolNoRepeats = false;</span>
<span class="source-line-no">3447</span><span id="line-3447">            do {</span>
<span class="source-line-no">3448</span><span id="line-3448">                bolNoRepeats = true;</span>
<span class="source-line-no">3449</span><span id="line-3449">                for (j = 0; j &lt; count - 1; j++) {</span>
<span class="source-line-no">3450</span><span id="line-3450">                    x1 = pixels[2 * j];</span>
<span class="source-line-no">3451</span><span id="line-3451">                    y1 = pixels[2 * j + 1];</span>
<span class="source-line-no">3452</span><span id="line-3452">                    x2 = pixels[2 * j + 2];</span>
<span class="source-line-no">3453</span><span id="line-3453">                    y2 = pixels[2 * j + 3];</span>
<span class="source-line-no">3454</span><span id="line-3454">                    if (x1 == x2 &amp;&amp; y1 == y2) //it's the same point</span>
<span class="source-line-no">3455</span><span id="line-3455">                    {</span>
<span class="source-line-no">3456</span><span id="line-3456">                        bolNoRepeats = false;</span>
<span class="source-line-no">3457</span><span id="line-3457">                        pixels[2 * j + 2] = (long) x2 + 1; //move the point</span>
<span class="source-line-no">3458</span><span id="line-3458">                        break;</span>
<span class="source-line-no">3459</span><span id="line-3459">                    }</span>
<span class="source-line-no">3460</span><span id="line-3460">                }</span>
<span class="source-line-no">3461</span><span id="line-3461">            } while (bolNoRepeats == false);</span>
<span class="source-line-no">3462</span><span id="line-3462">            //stuff pLinePoints</span>
<span class="source-line-no">3463</span><span id="line-3463">            k = 0;</span>
<span class="source-line-no">3464</span><span id="line-3464">            for (j = 0; j &lt; count; j++) {</span>
<span class="source-line-no">3465</span><span id="line-3465">                pLinePoints[j].x = pixels[k++];</span>
<span class="source-line-no">3466</span><span id="line-3466">                pLinePoints[j].y = pixels[k++];</span>
<span class="source-line-no">3467</span><span id="line-3467">            }</span>
<span class="source-line-no">3468</span><span id="line-3468">        } catch (Exception exc) {</span>
<span class="source-line-no">3469</span><span id="line-3469">            ErrorLogger.LogException(_className, "MoveChannelPixels",</span>
<span class="source-line-no">3470</span><span id="line-3470">                    new RendererException("Failed inside MoveChannelPixels", exc));</span>
<span class="source-line-no">3471</span><span id="line-3471">        }</span>
<span class="source-line-no">3472</span><span id="line-3472">    }</span>
<span class="source-line-no">3473</span><span id="line-3473"></span>
<span class="source-line-no">3474</span><span id="line-3474">    /**</span>
<span class="source-line-no">3475</span><span id="line-3475">     * Single Concertina cannot have horizontal first segment</span>
<span class="source-line-no">3476</span><span id="line-3476">     *</span>
<span class="source-line-no">3477</span><span id="line-3477">     * @param linetype</span>
<span class="source-line-no">3478</span><span id="line-3478">     * @param pLinePoints</span>
<span class="source-line-no">3479</span><span id="line-3479">     */</span>
<span class="source-line-no">3480</span><span id="line-3480">    protected static void moveSingleCPixels(int linetype, POINT2[] pLinePoints) {</span>
<span class="source-line-no">3481</span><span id="line-3481">        try {</span>
<span class="source-line-no">3482</span><span id="line-3482">            switch (linetype) {</span>
<span class="source-line-no">3483</span><span id="line-3483">                case TacticalLines.SINGLEC:</span>
<span class="source-line-no">3484</span><span id="line-3484">                    break;</span>
<span class="source-line-no">3485</span><span id="line-3485">                default:</span>
<span class="source-line-no">3486</span><span id="line-3486">                    return;</span>
<span class="source-line-no">3487</span><span id="line-3487">            }</span>
<span class="source-line-no">3488</span><span id="line-3488">            if (pLinePoints.length &gt; 1) {</span>
<span class="source-line-no">3489</span><span id="line-3489">                if (pLinePoints[1].y == pLinePoints[0].y) {</span>
<span class="source-line-no">3490</span><span id="line-3490">                    pLinePoints[1].y++;</span>
<span class="source-line-no">3491</span><span id="line-3491">                }</span>
<span class="source-line-no">3492</span><span id="line-3492">            }</span>
<span class="source-line-no">3493</span><span id="line-3493">        } catch (Exception exc) {</span>
<span class="source-line-no">3494</span><span id="line-3494">            ErrorLogger.LogException(_className, "MoveSingleCPixels",</span>
<span class="source-line-no">3495</span><span id="line-3495">                    new RendererException("Failed inside MoveSingleCPixels", exc));</span>
<span class="source-line-no">3496</span><span id="line-3496">        }</span>
<span class="source-line-no">3497</span><span id="line-3497">    }</span>
<span class="source-line-no">3498</span><span id="line-3498"></span>
<span class="source-line-no">3499</span><span id="line-3499">    /**</span>
<span class="source-line-no">3500</span><span id="line-3500">     * Rotates an the first vblCounter points in the array about its first point</span>
<span class="source-line-no">3501</span><span id="line-3501">     *</span>
<span class="source-line-no">3502</span><span id="line-3502">     * @param pLinePoints OUT - the points to rotate</span>
<span class="source-line-no">3503</span><span id="line-3503">     * @param vblCounter the number of points to rotate</span>
<span class="source-line-no">3504</span><span id="line-3504">     * @param lAngle the angle in degrees to rotate</span>
<span class="source-line-no">3505</span><span id="line-3505">     */</span>
<span class="source-line-no">3506</span><span id="line-3506">    protected static void RotateGeometryDouble(POINT2[] pLinePoints,</span>
<span class="source-line-no">3507</span><span id="line-3507">            int vblCounter,</span>
<span class="source-line-no">3508</span><span id="line-3508">            double lAngle) {</span>
<span class="source-line-no">3509</span><span id="line-3509">        try {</span>
<span class="source-line-no">3510</span><span id="line-3510">            int j = 0;</span>
<span class="source-line-no">3511</span><span id="line-3511">            double dRotate = 0,</span>
<span class="source-line-no">3512</span><span id="line-3512">                    dTheta = 0,</span>
<span class="source-line-no">3513</span><span id="line-3513">                    dGamma = 0,</span>
<span class="source-line-no">3514</span><span id="line-3514">                    x = 0,</span>
<span class="source-line-no">3515</span><span id="line-3515">                    y = 0;</span>
<span class="source-line-no">3516</span><span id="line-3516"></span>
<span class="source-line-no">3517</span><span id="line-3517">            if (lAngle != 0) //if the angle is 0 no rotation occurs</span>
<span class="source-line-no">3518</span><span id="line-3518">            {</span>
<span class="source-line-no">3519</span><span id="line-3519">                POINT2 pdCenter;</span>
<span class="source-line-no">3520</span><span id="line-3520">                dRotate = lAngle * Math.PI / 180d;</span>
<span class="source-line-no">3521</span><span id="line-3521">                pdCenter = CalcCenterPointDouble(pLinePoints, vblCounter);</span>
<span class="source-line-no">3522</span><span id="line-3522"></span>
<span class="source-line-no">3523</span><span id="line-3523">                for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">3524</span><span id="line-3524">                    //added if/else to get rid of divide by zero error 5/12/04 M. Deutch</span>
<span class="source-line-no">3525</span><span id="line-3525">                    if (pLinePoints[j].x == pdCenter.x) {</span>
<span class="source-line-no">3526</span><span id="line-3526">                        if ((pLinePoints[j].y &gt; pdCenter.y)) {</span>
<span class="source-line-no">3527</span><span id="line-3527">                            dGamma = Math.PI + Math.PI / 2;</span>
<span class="source-line-no">3528</span><span id="line-3528">                        } else {</span>
<span class="source-line-no">3529</span><span id="line-3529">                            dGamma = Math.PI / 2;</span>
<span class="source-line-no">3530</span><span id="line-3530">                        }</span>
<span class="source-line-no">3531</span><span id="line-3531">                    } else {</span>
<span class="source-line-no">3532</span><span id="line-3532">                        dGamma = Math.PI + Math.atan((pLinePoints[j].y - pdCenter.y)</span>
<span class="source-line-no">3533</span><span id="line-3533">                                / (pLinePoints[j].x - pdCenter.x));</span>
<span class="source-line-no">3534</span><span id="line-3534">                    }</span>
<span class="source-line-no">3535</span><span id="line-3535"></span>
<span class="source-line-no">3536</span><span id="line-3536">                    if ((double) pLinePoints[j].x &gt;= pdCenter.x) {</span>
<span class="source-line-no">3537</span><span id="line-3537">                        dGamma = dGamma + Math.PI;</span>
<span class="source-line-no">3538</span><span id="line-3538">                    }</span>
<span class="source-line-no">3539</span><span id="line-3539"></span>
<span class="source-line-no">3540</span><span id="line-3540">                    dTheta = dRotate + dGamma;</span>
<span class="source-line-no">3541</span><span id="line-3541">                    y = CalcDistanceDouble(pLinePoints[j], pdCenter) * Math.sin(dTheta);</span>
<span class="source-line-no">3542</span><span id="line-3542">                    x = CalcDistanceDouble(pLinePoints[j], pdCenter) * Math.cos(dTheta);</span>
<span class="source-line-no">3543</span><span id="line-3543">                    pLinePoints[j].y = pdCenter.y + y;</span>
<span class="source-line-no">3544</span><span id="line-3544">                    pLinePoints[j].x = pdCenter.x + x;</span>
<span class="source-line-no">3545</span><span id="line-3545">                }       //end for</span>
<span class="source-line-no">3546</span><span id="line-3546"></span>
<span class="source-line-no">3547</span><span id="line-3547">                return;</span>
<span class="source-line-no">3548</span><span id="line-3548">            }   //end if</span>
<span class="source-line-no">3549</span><span id="line-3549">        } catch (Exception exc) {</span>
<span class="source-line-no">3550</span><span id="line-3550">            ErrorLogger.LogException(_className, "RotateGeometryDouble",</span>
<span class="source-line-no">3551</span><span id="line-3551">                    new RendererException("Failed inside RotateGeometryDouble", exc));</span>
<span class="source-line-no">3552</span><span id="line-3552">        }</span>
<span class="source-line-no">3553</span><span id="line-3553">    }  // end</span>
<span class="source-line-no">3554</span><span id="line-3554"></span>
<span class="source-line-no">3555</span><span id="line-3555">    /**</span>
<span class="source-line-no">3556</span><span id="line-3556">     * Returns the point perpendicular to the line (pt0 to pt1) at the midpoint</span>
<span class="source-line-no">3557</span><span id="line-3557">     * the same distance from (and on the same side of) the the line as</span>
<span class="source-line-no">3558</span><span id="line-3558">     * ptRelative.</span>
<span class="source-line-no">3559</span><span id="line-3559">     *</span>
<span class="source-line-no">3560</span><span id="line-3560">     * @param pt0 the first point</span>
<span class="source-line-no">3561</span><span id="line-3561">     * @param pt1 the second point</span>
<span class="source-line-no">3562</span><span id="line-3562">     * @param ptRelative the point to use for computing the return point</span>
<span class="source-line-no">3563</span><span id="line-3563">     *</span>
<span class="source-line-no">3564</span><span id="line-3564">     * @return the point perpendicular to the line at the midpoint</span>
<span class="source-line-no">3565</span><span id="line-3565">     */</span>
<span class="source-line-no">3566</span><span id="line-3566">    protected static POINT2 PointRelativeToLine(POINT2 pt0,</span>
<span class="source-line-no">3567</span><span id="line-3567">            POINT2 pt1,</span>
<span class="source-line-no">3568</span><span id="line-3568">            POINT2 ptRelative) {</span>
<span class="source-line-no">3569</span><span id="line-3569">        POINT2 ptResult = new POINT2(pt0);</span>
<span class="source-line-no">3570</span><span id="line-3570">        try {</span>
<span class="source-line-no">3571</span><span id="line-3571">            int bolVertical = 0;</span>
<span class="source-line-no">3572</span><span id="line-3572">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">3573</span><span id="line-3573">            POINT2 midPt = MidPointDouble(pt0, pt1, 0);</span>
<span class="source-line-no">3574</span><span id="line-3574">            double b1 = 0, b2 = 0;</span>
<span class="source-line-no">3575</span><span id="line-3575">            //end declarations</span>
<span class="source-line-no">3576</span><span id="line-3576"></span>
<span class="source-line-no">3577</span><span id="line-3577">            bolVertical = CalcTrueSlopeDouble(pt0, pt1, m);</span>
<span class="source-line-no">3578</span><span id="line-3578">            if (bolVertical == 0) //line is vertical</span>
<span class="source-line-no">3579</span><span id="line-3579">            {</span>
<span class="source-line-no">3580</span><span id="line-3580">                ptResult.x = ptRelative.x;</span>
<span class="source-line-no">3581</span><span id="line-3581">                ptResult.y = midPt.y;</span>
<span class="source-line-no">3582</span><span id="line-3582">            }</span>
<span class="source-line-no">3583</span><span id="line-3583">            if (bolVertical != 0 &amp;&amp; m.value[0] == 0) {</span>
<span class="source-line-no">3584</span><span id="line-3584">                ptResult.x = midPt.x;</span>
<span class="source-line-no">3585</span><span id="line-3585">                ptResult.y = ptRelative.y;</span>
<span class="source-line-no">3586</span><span id="line-3586">            }</span>
<span class="source-line-no">3587</span><span id="line-3587">            if (bolVertical != 0 &amp;&amp; m.value[0] != 0) {</span>
<span class="source-line-no">3588</span><span id="line-3588">                b1 = midPt.y + (1 / m.value[0]) * midPt.x;      //the line perp to midPt</span>
<span class="source-line-no">3589</span><span id="line-3589">                b2 = ptRelative.y - m.value[0] * ptRelative.x;  //the line  ptRelative with the slope of pt1-pt2</span>
<span class="source-line-no">3590</span><span id="line-3590">                ptResult = CalcTrueIntersectDouble2(-1 / m.value[0], b1, m.value[0], b2, 1, 1, 0, 0);</span>
<span class="source-line-no">3591</span><span id="line-3591">            }</span>
<span class="source-line-no">3592</span><span id="line-3592">        } catch (Exception exc) {</span>
<span class="source-line-no">3593</span><span id="line-3593">            ErrorLogger.LogException(_className, "PointRelativeToLine",</span>
<span class="source-line-no">3594</span><span id="line-3594">                    new RendererException("Failed inside PointRelativeToLine", exc));</span>
<span class="source-line-no">3595</span><span id="line-3595">        }</span>
<span class="source-line-no">3596</span><span id="line-3596">        return ptResult;</span>
<span class="source-line-no">3597</span><span id="line-3597">    }</span>
<span class="source-line-no">3598</span><span id="line-3598"></span>
<span class="source-line-no">3599</span><span id="line-3599">    /**</span>
<span class="source-line-no">3600</span><span id="line-3600">     * shift the control point to match the shift that occurs in</span>
<span class="source-line-no">3601</span><span id="line-3601">     * Channels.GetAXADDouble for CATKBYFIRE. This is because the rotary feature</span>
<span class="source-line-no">3602</span><span id="line-3602">     * arrow tip must align with the anchor point</span>
<span class="source-line-no">3603</span><span id="line-3603">     *</span>
<span class="source-line-no">3604</span><span id="line-3604">     * @param linetype</span>
<span class="source-line-no">3605</span><span id="line-3605">     * @param pLinePoints the anchor points including the control point</span>
<span class="source-line-no">3606</span><span id="line-3606">     * @param dist the minimum required distance from the front of the rotary</span>
<span class="source-line-no">3607</span><span id="line-3607">     * arrow</span>
<span class="source-line-no">3608</span><span id="line-3608">     */</span>
<span class="source-line-no">3609</span><span id="line-3609">    public static void adjustCATKBYFIREControlPoint(int linetype,</span>
<span class="source-line-no">3610</span><span id="line-3610">            ArrayList&lt;POINT2&gt; pLinePoints,</span>
<span class="source-line-no">3611</span><span id="line-3611">            double dist) {</span>
<span class="source-line-no">3612</span><span id="line-3612">        try {</span>
<span class="source-line-no">3613</span><span id="line-3613">            if (linetype != TacticalLines.CATKBYFIRE) {</span>
<span class="source-line-no">3614</span><span id="line-3614">                return;</span>
<span class="source-line-no">3615</span><span id="line-3615">            }</span>
<span class="source-line-no">3616</span><span id="line-3616"></span>
<span class="source-line-no">3617</span><span id="line-3617">            double dist2 = lineutility.CalcDistanceDouble(pLinePoints.get(0), pLinePoints.get(1));</span>
<span class="source-line-no">3618</span><span id="line-3618">            if (dist2 &lt;= dist) {</span>
<span class="source-line-no">3619</span><span id="line-3619">                return;</span>
<span class="source-line-no">3620</span><span id="line-3620">            }</span>
<span class="source-line-no">3621</span><span id="line-3621"></span>
<span class="source-line-no">3622</span><span id="line-3622">            POINT2 pt = null;</span>
<span class="source-line-no">3623</span><span id="line-3623">            int count = pLinePoints.size();</span>
<span class="source-line-no">3624</span><span id="line-3624">            POINT2 pt0 = new POINT2(pLinePoints.get(0));</span>
<span class="source-line-no">3625</span><span id="line-3625">            POINT2 pt1 = new POINT2(pLinePoints.get(1));</span>
<span class="source-line-no">3626</span><span id="line-3626">            POINT2 controlPt = new POINT2(pLinePoints.get(count - 1));</span>
<span class="source-line-no">3627</span><span id="line-3627">            POINT2 pt4 = PointRelativeToLine(pt0, pt1, pt1, controlPt);</span>
<span class="source-line-no">3628</span><span id="line-3628">            pt = lineutility.ExtendLineDouble(pt4, controlPt, dist);</span>
<span class="source-line-no">3629</span><span id="line-3629">            pLinePoints.set(count - 1, pt);</span>
<span class="source-line-no">3630</span><span id="line-3630">        } catch (Exception exc) {</span>
<span class="source-line-no">3631</span><span id="line-3631">            ErrorLogger.LogException(_className, "adjustCATKBYFIREControlPoint",</span>
<span class="source-line-no">3632</span><span id="line-3632">                    new RendererException("Failed inside adjustCATKBYFIREControlPoint", exc));</span>
<span class="source-line-no">3633</span><span id="line-3633">        }</span>
<span class="source-line-no">3634</span><span id="line-3634">    }</span>
<span class="source-line-no">3635</span><span id="line-3635"></span>
<span class="source-line-no">3636</span><span id="line-3636">    /**</span>
<span class="source-line-no">3637</span><span id="line-3637">     * Returns the point perpendicular to the line (pt0 to pt1) at atPoint the</span>
<span class="source-line-no">3638</span><span id="line-3638">     * same distance from (and on the same side of) the the line as ptRelative.</span>
<span class="source-line-no">3639</span><span id="line-3639">     *</span>
<span class="source-line-no">3640</span><span id="line-3640">     * @param pt0 the first point</span>
<span class="source-line-no">3641</span><span id="line-3641">     * @param pt1 the second point</span>
<span class="source-line-no">3642</span><span id="line-3642">     * @param atPoint the point on the line at which to compute the extended</span>
<span class="source-line-no">3643</span><span id="line-3643">     * point</span>
<span class="source-line-no">3644</span><span id="line-3644">     * @param ptRelative the point to use for computing the return point</span>
<span class="source-line-no">3645</span><span id="line-3645">     *</span>
<span class="source-line-no">3646</span><span id="line-3646">     * @return the point perpendicular to the line at ptRelative</span>
<span class="source-line-no">3647</span><span id="line-3647">     */</span>
<span class="source-line-no">3648</span><span id="line-3648">    public static POINT2 PointRelativeToLine(POINT2 pt0,</span>
<span class="source-line-no">3649</span><span id="line-3649">            POINT2 pt1,</span>
<span class="source-line-no">3650</span><span id="line-3650">            POINT2 atPoint,</span>
<span class="source-line-no">3651</span><span id="line-3651">            POINT2 ptRelative) {</span>
<span class="source-line-no">3652</span><span id="line-3652">        POINT2 ptResult = new POINT2(pt0);</span>
<span class="source-line-no">3653</span><span id="line-3653">        try {</span>
<span class="source-line-no">3654</span><span id="line-3654">            int bolVertical = 0;</span>
<span class="source-line-no">3655</span><span id="line-3655">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">3656</span><span id="line-3656">            double b1 = 0, b2 = 0;</span>
<span class="source-line-no">3657</span><span id="line-3657"></span>
<span class="source-line-no">3658</span><span id="line-3658">            bolVertical = CalcTrueSlopeDouble(pt0, pt1, m);</span>
<span class="source-line-no">3659</span><span id="line-3659">            if (bolVertical == 0) //line is vertical</span>
<span class="source-line-no">3660</span><span id="line-3660">            {</span>
<span class="source-line-no">3661</span><span id="line-3661">                ptResult.x = ptRelative.x;</span>
<span class="source-line-no">3662</span><span id="line-3662">                ptResult.y = atPoint.y;</span>
<span class="source-line-no">3663</span><span id="line-3663">            }</span>
<span class="source-line-no">3664</span><span id="line-3664">            if (bolVertical != 0 &amp;&amp; m.value[0] == 0) {</span>
<span class="source-line-no">3665</span><span id="line-3665">                ptResult.x = atPoint.x;</span>
<span class="source-line-no">3666</span><span id="line-3666">                ptResult.y = ptRelative.y;</span>
<span class="source-line-no">3667</span><span id="line-3667">            }</span>
<span class="source-line-no">3668</span><span id="line-3668">            if (bolVertical != 0 &amp;&amp; m.value[0] != 0) {</span>
<span class="source-line-no">3669</span><span id="line-3669">                b1 = atPoint.y + (1 / m.value[0]) * atPoint.x;  //the line perp to midPt</span>
<span class="source-line-no">3670</span><span id="line-3670">                b2 = ptRelative.y - m.value[0] * ptRelative.x;  //the line  ptRelative with the slope of pt1-pt2</span>
<span class="source-line-no">3671</span><span id="line-3671">                ptResult = CalcTrueIntersectDouble2(-1 / m.value[0], b1, m.value[0], b2, 1, 1, 0, 0);</span>
<span class="source-line-no">3672</span><span id="line-3672">            }</span>
<span class="source-line-no">3673</span><span id="line-3673">        } catch (Exception exc) {</span>
<span class="source-line-no">3674</span><span id="line-3674">            ErrorLogger.LogException(_className, "PointRelativeToLine",</span>
<span class="source-line-no">3675</span><span id="line-3675">                    new RendererException("Failed inside PointRelativeToLine", exc));</span>
<span class="source-line-no">3676</span><span id="line-3676">        }</span>
<span class="source-line-no">3677</span><span id="line-3677">        return ptResult;</span>
<span class="source-line-no">3678</span><span id="line-3678">    }</span>
<span class="source-line-no">3679</span><span id="line-3679"></span>
<span class="source-line-no">3680</span><span id="line-3680">    /**</span>
<span class="source-line-no">3681</span><span id="line-3681">     * Returns in pt2 and pt3 the line segment parallel to segment pt0-pt1 which</span>
<span class="source-line-no">3682</span><span id="line-3682">     * would contain ptRelative. pt2 corresponds to pt0 and pt3 corresponds to</span>
<span class="source-line-no">3683</span><span id="line-3683">     * pt1.</span>
<span class="source-line-no">3684</span><span id="line-3684">     *</span>
<span class="source-line-no">3685</span><span id="line-3685">     * @param pt0 first line point</span>
<span class="source-line-no">3686</span><span id="line-3686">     * @param pt1 second line point</span>
<span class="source-line-no">3687</span><span id="line-3687">     * @param ptRelative relative line point</span>
<span class="source-line-no">3688</span><span id="line-3688">     * @param pt2 OUT - first computed relative line point</span>
<span class="source-line-no">3689</span><span id="line-3689">     * @param pt3 OUT - second computed relative line point</span>
<span class="source-line-no">3690</span><span id="line-3690">     */</span>
<span class="source-line-no">3691</span><span id="line-3691">    public static void LineRelativeToLine(POINT2 pt0,</span>
<span class="source-line-no">3692</span><span id="line-3692">            POINT2 pt1,</span>
<span class="source-line-no">3693</span><span id="line-3693">            POINT2 ptRelative,</span>
<span class="source-line-no">3694</span><span id="line-3694">            POINT2 pt2,</span>
<span class="source-line-no">3695</span><span id="line-3695">            POINT2 pt3) {</span>
<span class="source-line-no">3696</span><span id="line-3696">        try {</span>
<span class="source-line-no">3697</span><span id="line-3697">            int bolVertical = 0;</span>
<span class="source-line-no">3698</span><span id="line-3698">            ref&lt;double[]&gt; m = new ref();</span>
<span class="source-line-no">3699</span><span id="line-3699">            double b1 = 0, b2 = 0;</span>
<span class="source-line-no">3700</span><span id="line-3700">            POINT2 pt2Temp = null;</span>
<span class="source-line-no">3701</span><span id="line-3701">            POINT2 pt3Temp = null;</span>
<span class="source-line-no">3702</span><span id="line-3702"></span>
<span class="source-line-no">3703</span><span id="line-3703">            bolVertical = CalcTrueSlopeDouble(pt0, pt1, m);</span>
<span class="source-line-no">3704</span><span id="line-3704">            if (bolVertical == 0) //line is vertical</span>
<span class="source-line-no">3705</span><span id="line-3705">            {</span>
<span class="source-line-no">3706</span><span id="line-3706">                pt2.x = ptRelative.x;</span>
<span class="source-line-no">3707</span><span id="line-3707">                pt2.y = pt0.y;</span>
<span class="source-line-no">3708</span><span id="line-3708">                pt3.x = ptRelative.x;</span>
<span class="source-line-no">3709</span><span id="line-3709">                pt3.y = pt1.y;</span>
<span class="source-line-no">3710</span><span id="line-3710">            }</span>
<span class="source-line-no">3711</span><span id="line-3711">            if (bolVertical != 0 &amp;&amp; m.value[0] == 0) //line is horizontal</span>
<span class="source-line-no">3712</span><span id="line-3712">            {</span>
<span class="source-line-no">3713</span><span id="line-3713">                pt2.x = pt0.x;</span>
<span class="source-line-no">3714</span><span id="line-3714">                pt2.y = ptRelative.y;</span>
<span class="source-line-no">3715</span><span id="line-3715">                pt3.x = pt1.x;</span>
<span class="source-line-no">3716</span><span id="line-3716">                pt3.y = ptRelative.y;</span>
<span class="source-line-no">3717</span><span id="line-3717">            }</span>
<span class="source-line-no">3718</span><span id="line-3718">            if (bolVertical != 0 &amp;&amp; m.value[0] != 0) {</span>
<span class="source-line-no">3719</span><span id="line-3719">                b1 = pt0.y + (1 / m.value[0]) * pt0.x;  //the line perp to pt0</span>
<span class="source-line-no">3720</span><span id="line-3720">                b2 = ptRelative.y - m.value[0] * ptRelative.x;  //the line the ptRelative with the slope of pt0-pt1</span>
<span class="source-line-no">3721</span><span id="line-3721">                pt2Temp = CalcTrueIntersectDouble2(-1 / m.value[0], b1, m.value[0], b2, 1, 1, 0, 0);</span>
<span class="source-line-no">3722</span><span id="line-3722"></span>
<span class="source-line-no">3723</span><span id="line-3723">                b1 = pt1.y + (1 / m.value[0]) * pt1.x;  //the line perp to pt1</span>
<span class="source-line-no">3724</span><span id="line-3724">                //b2=ptRelative.y-m*ptRelative.x;       //the line the ptRelative with the slope of pt0-pt1</span>
<span class="source-line-no">3725</span><span id="line-3725">                pt3Temp = CalcTrueIntersectDouble2(-1 / m.value[0], b1, m.value[0], b2, 1, 1, 0, 0);</span>
<span class="source-line-no">3726</span><span id="line-3726"></span>
<span class="source-line-no">3727</span><span id="line-3727">                pt2.x = pt2Temp.x;</span>
<span class="source-line-no">3728</span><span id="line-3728">                pt2.y = pt2Temp.y;</span>
<span class="source-line-no">3729</span><span id="line-3729">                pt3.x = pt3Temp.x;</span>
<span class="source-line-no">3730</span><span id="line-3730">                pt3.y = pt3Temp.y;</span>
<span class="source-line-no">3731</span><span id="line-3731">            }</span>
<span class="source-line-no">3732</span><span id="line-3732">        } catch (Exception exc) {</span>
<span class="source-line-no">3733</span><span id="line-3733">            ErrorLogger.LogException(_className, "LineRelativeToLine",</span>
<span class="source-line-no">3734</span><span id="line-3734">                    new RendererException("Failed inside LineRelativeToLine", exc));</span>
<span class="source-line-no">3735</span><span id="line-3735">        }</span>
<span class="source-line-no">3736</span><span id="line-3736">    }</span>
<span class="source-line-no">3737</span><span id="line-3737"></span>
<span class="source-line-no">3738</span><span id="line-3738">    private static void CalcMBR(POINT2[] pLinePoints,</span>
<span class="source-line-no">3739</span><span id="line-3739">            int numpts,</span>
<span class="source-line-no">3740</span><span id="line-3740">            ref&lt;double[]&gt; ulx,</span>
<span class="source-line-no">3741</span><span id="line-3741">            ref&lt;double[]&gt; uly,</span>
<span class="source-line-no">3742</span><span id="line-3742">            ref&lt;double[]&gt; lrx,</span>
<span class="source-line-no">3743</span><span id="line-3743">            ref&lt;double[]&gt; lry) {</span>
<span class="source-line-no">3744</span><span id="line-3744">        try {</span>
<span class="source-line-no">3745</span><span id="line-3745">            int j = 0;</span>
<span class="source-line-no">3746</span><span id="line-3746">            //initialize the MBR</span>
<span class="source-line-no">3747</span><span id="line-3747">            ulx.value = new double[1];</span>
<span class="source-line-no">3748</span><span id="line-3748">            uly.value = new double[1];</span>
<span class="source-line-no">3749</span><span id="line-3749">            lrx.value = new double[1];</span>
<span class="source-line-no">3750</span><span id="line-3750">            lry.value = new double[1];</span>
<span class="source-line-no">3751</span><span id="line-3751">            ulx.value[0] = Double.MAX_VALUE;//was 99999</span>
<span class="source-line-no">3752</span><span id="line-3752">            uly.value[0] = Double.MAX_VALUE;//was 99999</span>
<span class="source-line-no">3753</span><span id="line-3753">            lrx.value[0] = -Double.MAX_VALUE;//was -99999</span>
<span class="source-line-no">3754</span><span id="line-3754">            lry.value[0] = -Double.MAX_VALUE;//was -99999</span>
<span class="source-line-no">3755</span><span id="line-3755">            for (j = 0; j &lt; numpts; j++) {</span>
<span class="source-line-no">3756</span><span id="line-3756">                if (pLinePoints[j].x &gt; lrx.value[0]) {</span>
<span class="source-line-no">3757</span><span id="line-3757">                    lrx.value[0] = pLinePoints[j].x;</span>
<span class="source-line-no">3758</span><span id="line-3758">                }</span>
<span class="source-line-no">3759</span><span id="line-3759">                if (pLinePoints[j].y &gt; lry.value[0]) {</span>
<span class="source-line-no">3760</span><span id="line-3760">                    lry.value[0] = pLinePoints[j].y;</span>
<span class="source-line-no">3761</span><span id="line-3761">                }</span>
<span class="source-line-no">3762</span><span id="line-3762">                if (pLinePoints[j].x &lt; ulx.value[0]) {</span>
<span class="source-line-no">3763</span><span id="line-3763">                    ulx.value[0] = pLinePoints[j].x;</span>
<span class="source-line-no">3764</span><span id="line-3764">                }</span>
<span class="source-line-no">3765</span><span id="line-3765">                if (pLinePoints[j].y &lt; uly.value[0]) {</span>
<span class="source-line-no">3766</span><span id="line-3766">                    uly.value[0] = pLinePoints[j].y;</span>
<span class="source-line-no">3767</span><span id="line-3767">                }</span>
<span class="source-line-no">3768</span><span id="line-3768">            }</span>
<span class="source-line-no">3769</span><span id="line-3769">        } catch (Exception exc) {</span>
<span class="source-line-no">3770</span><span id="line-3770">            ErrorLogger.LogException(_className, "CalcMBR",</span>
<span class="source-line-no">3771</span><span id="line-3771">                    new RendererException("Failed inside CalcMBR", exc));</span>
<span class="source-line-no">3772</span><span id="line-3772">        }</span>
<span class="source-line-no">3773</span><span id="line-3773">        return;</span>
<span class="source-line-no">3774</span><span id="line-3774">    }</span>
<span class="source-line-no">3775</span><span id="line-3775"></span>
<span class="source-line-no">3776</span><span id="line-3776">    public static void CalcMBRPoints(POINT2[] pLinePoints,</span>
<span class="source-line-no">3777</span><span id="line-3777">            int numpts,</span>
<span class="source-line-no">3778</span><span id="line-3778">            POINT2 ul,</span>
<span class="source-line-no">3779</span><span id="line-3779">            POINT2 lr) {</span>
<span class="source-line-no">3780</span><span id="line-3780">        try {</span>
<span class="source-line-no">3781</span><span id="line-3781">            int j = 0;</span>
<span class="source-line-no">3782</span><span id="line-3782">            ul.x = Double.MAX_VALUE;</span>
<span class="source-line-no">3783</span><span id="line-3783">            ul.y = Double.MAX_VALUE;</span>
<span class="source-line-no">3784</span><span id="line-3784">            lr.x = -Double.MAX_VALUE;</span>
<span class="source-line-no">3785</span><span id="line-3785">            lr.y = -Double.MAX_VALUE;</span>
<span class="source-line-no">3786</span><span id="line-3786">            for (j = 0; j &lt; numpts; j++) {</span>
<span class="source-line-no">3787</span><span id="line-3787">                if (pLinePoints[j].x &gt; lr.x) {</span>
<span class="source-line-no">3788</span><span id="line-3788">                    lr.x = pLinePoints[j].x;</span>
<span class="source-line-no">3789</span><span id="line-3789">                }</span>
<span class="source-line-no">3790</span><span id="line-3790">                if (pLinePoints[j].y &gt; lr.y) {</span>
<span class="source-line-no">3791</span><span id="line-3791">                    lr.y = pLinePoints[j].y;</span>
<span class="source-line-no">3792</span><span id="line-3792">                }</span>
<span class="source-line-no">3793</span><span id="line-3793">                if (pLinePoints[j].x &lt; ul.x) {</span>
<span class="source-line-no">3794</span><span id="line-3794">                    ul.x = pLinePoints[j].x;</span>
<span class="source-line-no">3795</span><span id="line-3795">                }</span>
<span class="source-line-no">3796</span><span id="line-3796">                if (pLinePoints[j].y &lt; ul.y) {</span>
<span class="source-line-no">3797</span><span id="line-3797">                    ul.y = pLinePoints[j].y;</span>
<span class="source-line-no">3798</span><span id="line-3798">                }</span>
<span class="source-line-no">3799</span><span id="line-3799">            }</span>
<span class="source-line-no">3800</span><span id="line-3800">        } catch (Exception exc) {</span>
<span class="source-line-no">3801</span><span id="line-3801">            ErrorLogger.LogException(_className, "CalcMBRPoints",</span>
<span class="source-line-no">3802</span><span id="line-3802">                    new RendererException("Failed inside CalcMBRPoints", exc));</span>
<span class="source-line-no">3803</span><span id="line-3803">        }</span>
<span class="source-line-no">3804</span><span id="line-3804">    }</span>
<span class="source-line-no">3805</span><span id="line-3805"></span>
<span class="source-line-no">3806</span><span id="line-3806">    /**</span>
<span class="source-line-no">3807</span><span id="line-3807">     * Computes the distance in pixels from upper left to lower right of the</span>
<span class="source-line-no">3808</span><span id="line-3808">     * minimum bounding rectangle for the first numpts of pLinePoints</span>
<span class="source-line-no">3809</span><span id="line-3809">     *</span>
<span class="source-line-no">3810</span><span id="line-3810">     * @param pLinePoints the inpupt point array</span>
<span class="source-line-no">3811</span><span id="line-3811">     * @param numpts the number of points to use</span>
<span class="source-line-no">3812</span><span id="line-3812">     *</span>
<span class="source-line-no">3813</span><span id="line-3813">     * @return the distance in pixels</span>
<span class="source-line-no">3814</span><span id="line-3814">     */</span>
<span class="source-line-no">3815</span><span id="line-3815">    protected static double MBRDistance(POINT2[] pLinePoints,</span>
<span class="source-line-no">3816</span><span id="line-3816">            int numpts) {</span>
<span class="source-line-no">3817</span><span id="line-3817">        double result = 0;</span>
<span class="source-line-no">3818</span><span id="line-3818">        try {</span>
<span class="source-line-no">3819</span><span id="line-3819">            ref&lt;double[]&gt; ulx = new ref(), uly = new ref(), lrx = new ref(), lry = new ref();</span>
<span class="source-line-no">3820</span><span id="line-3820">            CalcMBR(pLinePoints, numpts, ulx, uly, lrx, lry);</span>
<span class="source-line-no">3821</span><span id="line-3821">            result = Math.sqrt((lrx.value[0] - ulx.value[0]) * (lrx.value[0] - ulx.value[0]) + (lry.value[0] - uly.value[0]) * (lry.value[0] - uly.value[0]));</span>
<span class="source-line-no">3822</span><span id="line-3822">            //sanity check</span>
<span class="source-line-no">3823</span><span id="line-3823"></span>
<span class="source-line-no">3824</span><span id="line-3824">            //return x or y distance if returnValue is 0 or infinity</span>
<span class="source-line-no">3825</span><span id="line-3825">            double xdist = Math.abs(lrx.value[0] - ulx.value[0]);</span>
<span class="source-line-no">3826</span><span id="line-3826">            double ydist = Math.abs(lry.value[0] - uly.value[0]);</span>
<span class="source-line-no">3827</span><span id="line-3827">            double max = xdist;</span>
<span class="source-line-no">3828</span><span id="line-3828">            if (ydist &gt; xdist) {</span>
<span class="source-line-no">3829</span><span id="line-3829">                max = ydist;</span>
<span class="source-line-no">3830</span><span id="line-3830">            }</span>
<span class="source-line-no">3831</span><span id="line-3831"></span>
<span class="source-line-no">3832</span><span id="line-3832">            if (result == 0 || Double.isInfinite(result)) {</span>
<span class="source-line-no">3833</span><span id="line-3833">                if (max &gt; 0) {</span>
<span class="source-line-no">3834</span><span id="line-3834">                    result = max;</span>
<span class="source-line-no">3835</span><span id="line-3835">                }</span>
<span class="source-line-no">3836</span><span id="line-3836">            }</span>
<span class="source-line-no">3837</span><span id="line-3837"></span>
<span class="source-line-no">3838</span><span id="line-3838">        } catch (Exception exc) {</span>
<span class="source-line-no">3839</span><span id="line-3839">            ErrorLogger.LogException(_className, "MBRDistance",</span>
<span class="source-line-no">3840</span><span id="line-3840">                    new RendererException("Failed inside MBRDistance", exc));</span>
<span class="source-line-no">3841</span><span id="line-3841">        }</span>
<span class="source-line-no">3842</span><span id="line-3842">        return result;</span>
<span class="source-line-no">3843</span><span id="line-3843">    }</span>
<span class="source-line-no">3844</span><span id="line-3844"></span>
<span class="source-line-no">3845</span><span id="line-3845">    /**</span>
<span class="source-line-no">3846</span><span id="line-3846">     * Swaps two points.</span>
<span class="source-line-no">3847</span><span id="line-3847">     *</span>
<span class="source-line-no">3848</span><span id="line-3848">     * @param pt1 OUT - first point</span>
<span class="source-line-no">3849</span><span id="line-3849">     * @param pt2 OUT - second point</span>
<span class="source-line-no">3850</span><span id="line-3850">     *</span>
<span class="source-line-no">3851</span><span id="line-3851">     */</span>
<span class="source-line-no">3852</span><span id="line-3852">    protected static void Reverse2Points(POINT2 pt1, POINT2 pt2) {</span>
<span class="source-line-no">3853</span><span id="line-3853">        try {</span>
<span class="source-line-no">3854</span><span id="line-3854">            POINT2 tempPt = new POINT2();</span>
<span class="source-line-no">3855</span><span id="line-3855">            //store pt1</span>
<span class="source-line-no">3856</span><span id="line-3856">            tempPt.x = pt1.x;</span>
<span class="source-line-no">3857</span><span id="line-3857">            tempPt.y = pt1.y;</span>
<span class="source-line-no">3858</span><span id="line-3858">            pt1.x = pt2.x;</span>
<span class="source-line-no">3859</span><span id="line-3859">            pt1.y = pt2.y;</span>
<span class="source-line-no">3860</span><span id="line-3860">            pt2.x = tempPt.x;</span>
<span class="source-line-no">3861</span><span id="line-3861">            pt2.y = tempPt.y;</span>
<span class="source-line-no">3862</span><span id="line-3862">        } catch (Exception exc) {</span>
<span class="source-line-no">3863</span><span id="line-3863">            ErrorLogger.LogException(_className, "Reverse2Points",</span>
<span class="source-line-no">3864</span><span id="line-3864">                    new RendererException("Failed inside Reverse2Points", exc));</span>
<span class="source-line-no">3865</span><span id="line-3865">        }</span>
<span class="source-line-no">3866</span><span id="line-3866">    }</span>
<span class="source-line-no">3867</span><span id="line-3867">    /**</span>
<span class="source-line-no">3868</span><span id="line-3868">     * Creates a GeneralPath from a Path2D</span>
<span class="source-line-no">3869</span><span id="line-3869">     *</span>
<span class="source-line-no">3870</span><span id="line-3870">     * @param shape</span>
<span class="source-line-no">3871</span><span id="line-3871">     * @return</span>
<span class="source-line-no">3872</span><span id="line-3872">     */</span>
<span class="source-line-no">3873</span><span id="line-3873">    public static Shape createStrokedShape(Shape shape) {</span>
<span class="source-line-no">3874</span><span id="line-3874">        GeneralPath newshape = new GeneralPath(); // Start with an empty shape</span>
<span class="source-line-no">3875</span><span id="line-3875">        try {</span>
<span class="source-line-no">3876</span><span id="line-3876">            // Iterate through the specified shape, perturb its coordinates, and</span>
<span class="source-line-no">3877</span><span id="line-3877">            // use them to build up the new shape.</span>
<span class="source-line-no">3878</span><span id="line-3878">            double[] coords = new double[6];</span>
<span class="source-line-no">3879</span><span id="line-3879">            for (PathIterator i = shape.getPathIterator(null); !i.isDone(); i.next()) {</span>
<span class="source-line-no">3880</span><span id="line-3880">                int type = i.currentSegment(coords);</span>
<span class="source-line-no">3881</span><span id="line-3881">                switch (type) {</span>
<span class="source-line-no">3882</span><span id="line-3882">                    case PathIterator.SEG_MOVETO:</span>
<span class="source-line-no">3883</span><span id="line-3883">                        //perturb(coords, 2);</span>
<span class="source-line-no">3884</span><span id="line-3884">                        newshape.moveTo(coords[0], coords[1]);</span>
<span class="source-line-no">3885</span><span id="line-3885">                        break;</span>
<span class="source-line-no">3886</span><span id="line-3886">                    case PathIterator.SEG_LINETO:</span>
<span class="source-line-no">3887</span><span id="line-3887">                        //perturb(coords, 2);</span>
<span class="source-line-no">3888</span><span id="line-3888">                        newshape.lineTo(coords[0], coords[1]);</span>
<span class="source-line-no">3889</span><span id="line-3889">                        break;</span>
<span class="source-line-no">3890</span><span id="line-3890">                    case PathIterator.SEG_QUADTO:</span>
<span class="source-line-no">3891</span><span id="line-3891">                        //perturb(coords, 4);</span>
<span class="source-line-no">3892</span><span id="line-3892">                        newshape.quadTo(coords[0], coords[1], coords[2], coords[3]);</span>
<span class="source-line-no">3893</span><span id="line-3893">                        break;</span>
<span class="source-line-no">3894</span><span id="line-3894">                    case PathIterator.SEG_CUBICTO:</span>
<span class="source-line-no">3895</span><span id="line-3895">                        //perturb(coords, 6);</span>
<span class="source-line-no">3896</span><span id="line-3896">                        newshape.curveTo(coords[0], coords[1], coords[2], coords[3],</span>
<span class="source-line-no">3897</span><span id="line-3897">                                coords[4], coords[5]);</span>
<span class="source-line-no">3898</span><span id="line-3898">                        break;</span>
<span class="source-line-no">3899</span><span id="line-3899">                    case PathIterator.SEG_CLOSE:</span>
<span class="source-line-no">3900</span><span id="line-3900">                        newshape.closePath();</span>
<span class="source-line-no">3901</span><span id="line-3901">                        break;</span>
<span class="source-line-no">3902</span><span id="line-3902">                }</span>
<span class="source-line-no">3903</span><span id="line-3903"></span>
<span class="source-line-no">3904</span><span id="line-3904">            }</span>
<span class="source-line-no">3905</span><span id="line-3905">        } catch (Exception exc) {</span>
<span class="source-line-no">3906</span><span id="line-3906">            ErrorLogger.LogException(_className, "createStrokedShape",</span>
<span class="source-line-no">3907</span><span id="line-3907">                    new RendererException("Failed inside createStrokedShape", exc));</span>
<span class="source-line-no">3908</span><span id="line-3908">        }</span>
<span class="source-line-no">3909</span><span id="line-3909">        return newshape;</span>
<span class="source-line-no">3910</span><span id="line-3910">    }</span>
<span class="source-line-no">3911</span><span id="line-3911">    //These functions were added to create a minimum bounding polygon</span>
<span class="source-line-no">3912</span><span id="line-3912">    /**</span>
<span class="source-line-no">3913</span><span id="line-3913">     * @deprecated Returns the determinant of the point matrix This determinant</span>
<span class="source-line-no">3914</span><span id="line-3914">     * tells how far p3 is from vector p1p2 and on which side it is</span>
<span class="source-line-no">3915</span><span id="line-3915">     * @param p1</span>
<span class="source-line-no">3916</span><span id="line-3916">     * @param p2</span>
<span class="source-line-no">3917</span><span id="line-3917">     * @param p3</span>
<span class="source-line-no">3918</span><span id="line-3918">     * @return</span>
<span class="source-line-no">3919</span><span id="line-3919">     */</span>
<span class="source-line-no">3920</span><span id="line-3920">    static private int distance(Point p1, Point p2, Point p3) {</span>
<span class="source-line-no">3921</span><span id="line-3921">        try {</span>
<span class="source-line-no">3922</span><span id="line-3922">            int x1 = p1.x;</span>
<span class="source-line-no">3923</span><span id="line-3923">            int x2 = p2.x;</span>
<span class="source-line-no">3924</span><span id="line-3924">            int x3 = p3.x;</span>
<span class="source-line-no">3925</span><span id="line-3925">            int y1 = p1.y;</span>
<span class="source-line-no">3926</span><span id="line-3926">            int y2 = p2.y;</span>
<span class="source-line-no">3927</span><span id="line-3927">            int y3 = p3.y;</span>
<span class="source-line-no">3928</span><span id="line-3928">            return x1 * y2 + x3 * y1 + x2 * y3 - x3 * y2 - x2 * y1 - x1 * y3;</span>
<span class="source-line-no">3929</span><span id="line-3929">        } catch (Exception exc) {</span>
<span class="source-line-no">3930</span><span id="line-3930">            ErrorLogger.LogException(_className, "distance",</span>
<span class="source-line-no">3931</span><span id="line-3931">                    new RendererException("Failed inside distance", exc));</span>
<span class="source-line-no">3932</span><span id="line-3932">        }</span>
<span class="source-line-no">3933</span><span id="line-3933">        return 0;</span>
<span class="source-line-no">3934</span><span id="line-3934">    }</span>
<span class="source-line-no">3935</span><span id="line-3935"></span>
<span class="source-line-no">3936</span><span id="line-3936">    /**</span>
<span class="source-line-no">3937</span><span id="line-3937">     * @deprecated Returns the determinant of the point matrix This determinant</span>
<span class="source-line-no">3938</span><span id="line-3938">     * tells how far p3 is from vector p1p2 and on which side it is</span>
<span class="source-line-no">3939</span><span id="line-3939">     * @param p1</span>
<span class="source-line-no">3940</span><span id="line-3940">     * @param p2</span>
<span class="source-line-no">3941</span><span id="line-3941">     * @param p3</span>
<span class="source-line-no">3942</span><span id="line-3942">     * @return</span>
<span class="source-line-no">3943</span><span id="line-3943">     */</span>
<span class="source-line-no">3944</span><span id="line-3944">    static private double distance2(POINT2 p1, POINT2 p2, POINT2 p3) {</span>
<span class="source-line-no">3945</span><span id="line-3945">        try {</span>
<span class="source-line-no">3946</span><span id="line-3946">            double x1 = p1.x;</span>
<span class="source-line-no">3947</span><span id="line-3947">            double x2 = p2.x;</span>
<span class="source-line-no">3948</span><span id="line-3948">            double x3 = p3.x;</span>
<span class="source-line-no">3949</span><span id="line-3949">            double y1 = p1.y;</span>
<span class="source-line-no">3950</span><span id="line-3950">            double y2 = p2.y;</span>
<span class="source-line-no">3951</span><span id="line-3951">            double y3 = p3.y;</span>
<span class="source-line-no">3952</span><span id="line-3952">            return x1 * y2 + x3 * y1 + x2 * y3 - x3 * y2 - x2 * y1 - x1 * y3;</span>
<span class="source-line-no">3953</span><span id="line-3953">        } catch (Exception exc) {</span>
<span class="source-line-no">3954</span><span id="line-3954">            ErrorLogger.LogException(_className, "distance2",</span>
<span class="source-line-no">3955</span><span id="line-3955">                    new RendererException("Failed inside distance2", exc));</span>
<span class="source-line-no">3956</span><span id="line-3956">        }</span>
<span class="source-line-no">3957</span><span id="line-3957">        return 0;</span>
<span class="source-line-no">3958</span><span id="line-3958">    }</span>
<span class="source-line-no">3959</span><span id="line-3959"></span>
<span class="source-line-no">3960</span><span id="line-3960">    /**</span>
<span class="source-line-no">3961</span><span id="line-3961">     * @deprecated @param points</span>
<span class="source-line-no">3962</span><span id="line-3962">     * @param l</span>
<span class="source-line-no">3963</span><span id="line-3963">     * @param r</span>
<span class="source-line-no">3964</span><span id="line-3964">     * @param path</span>
<span class="source-line-no">3965</span><span id="line-3965">     */</span>
<span class="source-line-no">3966</span><span id="line-3966">    static private void cHull(ArrayList&lt;Point&gt; points, Point l, Point r, ArrayList&lt;Point&gt; path) {</span>
<span class="source-line-no">3967</span><span id="line-3967"></span>
<span class="source-line-no">3968</span><span id="line-3968">        if (points.size() &lt; 3) {</span>
<span class="source-line-no">3969</span><span id="line-3969">            return;</span>
<span class="source-line-no">3970</span><span id="line-3970">        }</span>
<span class="source-line-no">3971</span><span id="line-3971"></span>
<span class="source-line-no">3972</span><span id="line-3972">        int maxDist = 0;</span>
<span class="source-line-no">3973</span><span id="line-3973">        int tmp;</span>
<span class="source-line-no">3974</span><span id="line-3974">        Point p = null;</span>
<span class="source-line-no">3975</span><span id="line-3975"></span>
<span class="source-line-no">3976</span><span id="line-3976">        for (Point pt : points) {</span>
<span class="source-line-no">3977</span><span id="line-3977">            if (pt != l &amp;&amp; pt != r) {</span>
<span class="source-line-no">3978</span><span id="line-3978">                tmp = distance(l, r, pt);</span>
<span class="source-line-no">3979</span><span id="line-3979"></span>
<span class="source-line-no">3980</span><span id="line-3980">                if (tmp &gt; maxDist) {</span>
<span class="source-line-no">3981</span><span id="line-3981">                    maxDist = tmp;</span>
<span class="source-line-no">3982</span><span id="line-3982">                    p = pt;</span>
<span class="source-line-no">3983</span><span id="line-3983">                }</span>
<span class="source-line-no">3984</span><span id="line-3984">            }</span>
<span class="source-line-no">3985</span><span id="line-3985">        }</span>
<span class="source-line-no">3986</span><span id="line-3986"></span>
<span class="source-line-no">3987</span><span id="line-3987">        ArrayList&lt;Point&gt; left = new ArrayList&lt;Point&gt;();</span>
<span class="source-line-no">3988</span><span id="line-3988">        ArrayList&lt;Point&gt; right = new ArrayList&lt;Point&gt;();</span>
<span class="source-line-no">3989</span><span id="line-3989">        left.add(l);</span>
<span class="source-line-no">3990</span><span id="line-3990">        right.add(p);</span>
<span class="source-line-no">3991</span><span id="line-3991"></span>
<span class="source-line-no">3992</span><span id="line-3992">        for (Point pt : points) {</span>
<span class="source-line-no">3993</span><span id="line-3993">            if (distance(l, p, pt) &gt; 0) {</span>
<span class="source-line-no">3994</span><span id="line-3994">                left.add(pt);</span>
<span class="source-line-no">3995</span><span id="line-3995">            } else if (distance(p, r, pt) &gt; 0) {</span>
<span class="source-line-no">3996</span><span id="line-3996">                right.add(pt);</span>
<span class="source-line-no">3997</span><span id="line-3997">            }</span>
<span class="source-line-no">3998</span><span id="line-3998">        }</span>
<span class="source-line-no">3999</span><span id="line-3999"></span>
<span class="source-line-no">4000</span><span id="line-4000">        left.add(p);</span>
<span class="source-line-no">4001</span><span id="line-4001">        right.add(r);</span>
<span class="source-line-no">4002</span><span id="line-4002">        cHull(left, l, p, path);</span>
<span class="source-line-no">4003</span><span id="line-4003">        path.add(p);</span>
<span class="source-line-no">4004</span><span id="line-4004">        cHull(right, p, r, path);</span>
<span class="source-line-no">4005</span><span id="line-4005">    }</span>
<span class="source-line-no">4006</span><span id="line-4006"></span>
<span class="source-line-no">4007</span><span id="line-4007">    /**</span>
<span class="source-line-no">4008</span><span id="line-4008">     * @deprecated @param points</span>
<span class="source-line-no">4009</span><span id="line-4009">     * @param l</span>
<span class="source-line-no">4010</span><span id="line-4010">     * @param r</span>
<span class="source-line-no">4011</span><span id="line-4011">     * @param path</span>
<span class="source-line-no">4012</span><span id="line-4012">     */</span>
<span class="source-line-no">4013</span><span id="line-4013">    static private void cHull2(ArrayList&lt;POINT2&gt; points, POINT2 l, POINT2 r, ArrayList&lt;POINT2&gt; path) {</span>
<span class="source-line-no">4014</span><span id="line-4014"></span>
<span class="source-line-no">4015</span><span id="line-4015">        if (points.size() &lt; 3) {</span>
<span class="source-line-no">4016</span><span id="line-4016">            return;</span>
<span class="source-line-no">4017</span><span id="line-4017">        }</span>
<span class="source-line-no">4018</span><span id="line-4018"></span>
<span class="source-line-no">4019</span><span id="line-4019">        double maxDist = 0;</span>
<span class="source-line-no">4020</span><span id="line-4020">        double tmp;</span>
<span class="source-line-no">4021</span><span id="line-4021">        POINT2 p = null;</span>
<span class="source-line-no">4022</span><span id="line-4022"></span>
<span class="source-line-no">4023</span><span id="line-4023">        for (POINT2 pt : points) {</span>
<span class="source-line-no">4024</span><span id="line-4024">            if (pt != l &amp;&amp; pt != r) {</span>
<span class="source-line-no">4025</span><span id="line-4025">                tmp = distance2(l, r, pt);</span>
<span class="source-line-no">4026</span><span id="line-4026"></span>
<span class="source-line-no">4027</span><span id="line-4027">                if (tmp &gt; maxDist) {</span>
<span class="source-line-no">4028</span><span id="line-4028">                    maxDist = tmp;</span>
<span class="source-line-no">4029</span><span id="line-4029">                    p = pt;</span>
<span class="source-line-no">4030</span><span id="line-4030">                }</span>
<span class="source-line-no">4031</span><span id="line-4031">            }</span>
<span class="source-line-no">4032</span><span id="line-4032">        }</span>
<span class="source-line-no">4033</span><span id="line-4033"></span>
<span class="source-line-no">4034</span><span id="line-4034">        ArrayList&lt;POINT2&gt; left = new ArrayList&lt;POINT2&gt;();</span>
<span class="source-line-no">4035</span><span id="line-4035">        ArrayList&lt;POINT2&gt; right = new ArrayList&lt;POINT2&gt;();</span>
<span class="source-line-no">4036</span><span id="line-4036">        left.add(l);</span>
<span class="source-line-no">4037</span><span id="line-4037">        right.add(p);</span>
<span class="source-line-no">4038</span><span id="line-4038"></span>
<span class="source-line-no">4039</span><span id="line-4039">        for (POINT2 pt : points) {</span>
<span class="source-line-no">4040</span><span id="line-4040">            if (distance2(l, p, pt) &gt; 0) {</span>
<span class="source-line-no">4041</span><span id="line-4041">                left.add(pt);</span>
<span class="source-line-no">4042</span><span id="line-4042">            } else if (distance2(p, r, pt) &gt; 0) {</span>
<span class="source-line-no">4043</span><span id="line-4043">                right.add(pt);</span>
<span class="source-line-no">4044</span><span id="line-4044">            }</span>
<span class="source-line-no">4045</span><span id="line-4045">        }</span>
<span class="source-line-no">4046</span><span id="line-4046"></span>
<span class="source-line-no">4047</span><span id="line-4047">        left.add(p);</span>
<span class="source-line-no">4048</span><span id="line-4048">        right.add(r);</span>
<span class="source-line-no">4049</span><span id="line-4049">        cHull2(left, l, p, path);</span>
<span class="source-line-no">4050</span><span id="line-4050">        path.add(p);</span>
<span class="source-line-no">4051</span><span id="line-4051">        cHull2(right, p, r, path);</span>
<span class="source-line-no">4052</span><span id="line-4052">    }</span>
<span class="source-line-no">4053</span><span id="line-4053">    //Returns the points of convex hull in the correct order</span>
<span class="source-line-no">4054</span><span id="line-4054">    /**</span>
<span class="source-line-no">4055</span><span id="line-4055">     * @deprecated @param array</span>
<span class="source-line-no">4056</span><span id="line-4056">     * @return</span>
<span class="source-line-no">4057</span><span id="line-4057">     */</span>
<span class="source-line-no">4058</span><span id="line-4058">    static public ArrayList&lt;Point&gt; cHull(ArrayList&lt;Point&gt; array) {</span>
<span class="source-line-no">4059</span><span id="line-4059">        int size = array.size();</span>
<span class="source-line-no">4060</span><span id="line-4060">        if (size &lt; 2) {</span>
<span class="source-line-no">4061</span><span id="line-4061">            return null;</span>
<span class="source-line-no">4062</span><span id="line-4062">        }</span>
<span class="source-line-no">4063</span><span id="line-4063"></span>
<span class="source-line-no">4064</span><span id="line-4064">        Point l = array.get(0);</span>
<span class="source-line-no">4065</span><span id="line-4065">        Point r = array.get(size - 1);</span>
<span class="source-line-no">4066</span><span id="line-4066">        ArrayList&lt;Point&gt; path = new ArrayList&lt;Point&gt;();</span>
<span class="source-line-no">4067</span><span id="line-4067">        path.add(l);</span>
<span class="source-line-no">4068</span><span id="line-4068">        cHull(array, l, r, path);</span>
<span class="source-line-no">4069</span><span id="line-4069">        path.add(r);</span>
<span class="source-line-no">4070</span><span id="line-4070">        cHull(array, r, l, path);</span>
<span class="source-line-no">4071</span><span id="line-4071">        return path;</span>
<span class="source-line-no">4072</span><span id="line-4072">    }</span>
<span class="source-line-no">4073</span><span id="line-4073"></span>
<span class="source-line-no">4074</span><span id="line-4074">    /**</span>
<span class="source-line-no">4075</span><span id="line-4075">     * @deprecated @param array</span>
<span class="source-line-no">4076</span><span id="line-4076">     * @return</span>
<span class="source-line-no">4077</span><span id="line-4077">     */</span>
<span class="source-line-no">4078</span><span id="line-4078">    static public ArrayList&lt;POINT2&gt; cHull2(ArrayList&lt;POINT2&gt; array) {</span>
<span class="source-line-no">4079</span><span id="line-4079">        try {</span>
<span class="source-line-no">4080</span><span id="line-4080">            int size = array.size();</span>
<span class="source-line-no">4081</span><span id="line-4081">            if (size &lt; 2) {</span>
<span class="source-line-no">4082</span><span id="line-4082">                return null;</span>
<span class="source-line-no">4083</span><span id="line-4083">            }</span>
<span class="source-line-no">4084</span><span id="line-4084"></span>
<span class="source-line-no">4085</span><span id="line-4085">            POINT2 l = array.get(0);</span>
<span class="source-line-no">4086</span><span id="line-4086">            POINT2 r = array.get(size - 1);</span>
<span class="source-line-no">4087</span><span id="line-4087">            ArrayList&lt;POINT2&gt; path = new ArrayList&lt;POINT2&gt;();</span>
<span class="source-line-no">4088</span><span id="line-4088">            path.add(l);</span>
<span class="source-line-no">4089</span><span id="line-4089">            cHull2(array, l, r, path);</span>
<span class="source-line-no">4090</span><span id="line-4090">            path.add(r);</span>
<span class="source-line-no">4091</span><span id="line-4091">            cHull2(array, r, l, path);</span>
<span class="source-line-no">4092</span><span id="line-4092">            return path;</span>
<span class="source-line-no">4093</span><span id="line-4093">        } catch (Exception exc) {</span>
<span class="source-line-no">4094</span><span id="line-4094">            ErrorLogger.LogException(_className, "cHull2",</span>
<span class="source-line-no">4095</span><span id="line-4095">                    new RendererException("Failed inside cHull2", exc));</span>
<span class="source-line-no">4096</span><span id="line-4096">        }</span>
<span class="source-line-no">4097</span><span id="line-4097">        return null;</span>
<span class="source-line-no">4098</span><span id="line-4098">    }</span>
<span class="source-line-no">4099</span><span id="line-4099"></span>
<span class="source-line-no">4100</span><span id="line-4100">    public static void getExteriorPoints(POINT2[] pLinePoints,</span>
<span class="source-line-no">4101</span><span id="line-4101">            int vblCounter,</span>
<span class="source-line-no">4102</span><span id="line-4102">            int lineType,</span>
<span class="source-line-no">4103</span><span id="line-4103">            boolean interior</span>
<span class="source-line-no">4104</span><span id="line-4104">    ) {</span>
<span class="source-line-no">4105</span><span id="line-4105">        int j;</span>
<span class="source-line-no">4106</span><span id="line-4106">        int index;</span>
<span class="source-line-no">4107</span><span id="line-4107">        POINT2 pt0, pt1, pt2;</span>
<span class="source-line-no">4108</span><span id="line-4108">        ref&lt;double[]&gt; m01 = new ref(), m12 = new ref();</span>
<span class="source-line-no">4109</span><span id="line-4109">        int direction;</span>
<span class="source-line-no">4110</span><span id="line-4110">        POINT2 intersectPt;</span>
<span class="source-line-no">4111</span><span id="line-4111">        //ref&lt;double[]&gt; m1 = new ref(), m2 = new ref();</span>
<span class="source-line-no">4112</span><span id="line-4112">        ArrayList&lt;POINT2&gt; intersectPoints = new ArrayList();</span>
<span class="source-line-no">4113</span><span id="line-4113">        double b01, b12;        //the y intercepts for the lines corresponding to m1,m2 </span>
<span class="source-line-no">4114</span><span id="line-4114">        double dist = pLinePoints[0].style;</span>
<span class="source-line-no">4115</span><span id="line-4115">        for (j = 0; j &lt; vblCounter; j++) {</span>
<span class="source-line-no">4116</span><span id="line-4116">            if (j == 0 || j == vblCounter - 1) {</span>
<span class="source-line-no">4117</span><span id="line-4117">                pt0 = new POINT2(pLinePoints[vblCounter - 2]);</span>
<span class="source-line-no">4118</span><span id="line-4118">                pt1 = new POINT2(pLinePoints[0]);</span>
<span class="source-line-no">4119</span><span id="line-4119">                pt2 = new POINT2(pLinePoints[1]);</span>
<span class="source-line-no">4120</span><span id="line-4120">            } else {</span>
<span class="source-line-no">4121</span><span id="line-4121">                pt0 = new POINT2(pLinePoints[j - 1]);</span>
<span class="source-line-no">4122</span><span id="line-4122">                pt1 = new POINT2(pLinePoints[j]);</span>
<span class="source-line-no">4123</span><span id="line-4123">                pt2 = new POINT2(pLinePoints[j + 1]);</span>
<span class="source-line-no">4124</span><span id="line-4124">            }</span>
<span class="source-line-no">4125</span><span id="line-4125">            if (pt1.style &gt; 0) {</span>
<span class="source-line-no">4126</span><span id="line-4126">                dist = pt1.style;</span>
<span class="source-line-no">4127</span><span id="line-4127">            }</span>
<span class="source-line-no">4128</span><span id="line-4128">            //the exterior/interior points</span>
<span class="source-line-no">4129</span><span id="line-4129">            POINT2 pt00, pt01, pt10, pt11;</span>
<span class="source-line-no">4130</span><span id="line-4130"></span>
<span class="source-line-no">4131</span><span id="line-4131">            index = j - 1;</span>
<span class="source-line-no">4132</span><span id="line-4132">            if (index &lt; 0) {</span>
<span class="source-line-no">4133</span><span id="line-4133">                index = vblCounter - 1;</span>
<span class="source-line-no">4134</span><span id="line-4134">            }</span>
<span class="source-line-no">4135</span><span id="line-4135">            POINT2[] pts = new POINT2[pLinePoints.length];</span>
<span class="source-line-no">4136</span><span id="line-4136">            int n=pLinePoints.length;</span>
<span class="source-line-no">4137</span><span id="line-4137">            //for (int k = 0; k &lt; pLinePoints.length; k++) </span>
<span class="source-line-no">4138</span><span id="line-4138">            for (int k = 0; k &lt; n; k++) </span>
<span class="source-line-no">4139</span><span id="line-4139">            {</span>
<span class="source-line-no">4140</span><span id="line-4140">                pts[k] = pLinePoints[k];</span>
<span class="source-line-no">4141</span><span id="line-4141">            }</span>
<span class="source-line-no">4142</span><span id="line-4142"></span>
<span class="source-line-no">4143</span><span id="line-4143">            direction = arraysupport.GetInsideOutsideDouble2(pt0, pt1, pts, vblCounter, index, lineType);</span>
<span class="source-line-no">4144</span><span id="line-4144">            //reverse the direction if these are interior points</span>
<span class="source-line-no">4145</span><span id="line-4145">            if (interior == true) {</span>
<span class="source-line-no">4146</span><span id="line-4146">                switch (direction) {</span>
<span class="source-line-no">4147</span><span id="line-4147">                    case 0:</span>
<span class="source-line-no">4148</span><span id="line-4148">                        direction = 1;</span>
<span class="source-line-no">4149</span><span id="line-4149">                        break;</span>
<span class="source-line-no">4150</span><span id="line-4150">                    case 1:</span>
<span class="source-line-no">4151</span><span id="line-4151">                        direction = 0;</span>
<span class="source-line-no">4152</span><span id="line-4152">                        break;</span>
<span class="source-line-no">4153</span><span id="line-4153">                    case 2:</span>
<span class="source-line-no">4154</span><span id="line-4154">                        direction = 3;</span>
<span class="source-line-no">4155</span><span id="line-4155">                        break;</span>
<span class="source-line-no">4156</span><span id="line-4156">                    case 3:</span>
<span class="source-line-no">4157</span><span id="line-4157">                        direction = 2;</span>
<span class="source-line-no">4158</span><span id="line-4158">                        break;</span>
<span class="source-line-no">4159</span><span id="line-4159">                    default:</span>
<span class="source-line-no">4160</span><span id="line-4160">                        break;</span>
<span class="source-line-no">4161</span><span id="line-4161">                }</span>
<span class="source-line-no">4162</span><span id="line-4162">            }</span>
<span class="source-line-no">4163</span><span id="line-4163">            //pt00-pt01 will be the interior line inside line pt0-pt1</span>
<span class="source-line-no">4164</span><span id="line-4164">            //pt00 is inside pt0, pt01 is inside pt1</span>
<span class="source-line-no">4165</span><span id="line-4165">            pt00 = lineutility.ExtendDirectedLine(pt0, pt1, pt0, direction, dist);</span>
<span class="source-line-no">4166</span><span id="line-4166">            pt01 = lineutility.ExtendDirectedLine(pt0, pt1, pt1, direction, dist);</span>
<span class="source-line-no">4167</span><span id="line-4167"></span>
<span class="source-line-no">4168</span><span id="line-4168">            //pt10-pt11 will be the interior line inside line pt1-pt2</span>
<span class="source-line-no">4169</span><span id="line-4169">            //pt10 is inside pt1, pt11 is inside pt2</span>
<span class="source-line-no">4170</span><span id="line-4170">            index = j;</span>
<span class="source-line-no">4171</span><span id="line-4171">            if (j == vblCounter - 1) {</span>
<span class="source-line-no">4172</span><span id="line-4172">                index = 0;</span>
<span class="source-line-no">4173</span><span id="line-4173">            }</span>
<span class="source-line-no">4174</span><span id="line-4174">            direction = arraysupport.GetInsideOutsideDouble2(pt1, pt2, (POINT2[]) pts, vblCounter, index, lineType);</span>
<span class="source-line-no">4175</span><span id="line-4175">            //reverse the direction if these are interior points</span>
<span class="source-line-no">4176</span><span id="line-4176">            if (interior == true) {</span>
<span class="source-line-no">4177</span><span id="line-4177">                switch (direction) {</span>
<span class="source-line-no">4178</span><span id="line-4178">                    case 0:</span>
<span class="source-line-no">4179</span><span id="line-4179">                        direction = 1;</span>
<span class="source-line-no">4180</span><span id="line-4180">                        break;</span>
<span class="source-line-no">4181</span><span id="line-4181">                    case 1:</span>
<span class="source-line-no">4182</span><span id="line-4182">                        direction = 0;</span>
<span class="source-line-no">4183</span><span id="line-4183">                        break;</span>
<span class="source-line-no">4184</span><span id="line-4184">                    case 2:</span>
<span class="source-line-no">4185</span><span id="line-4185">                        direction = 3;</span>
<span class="source-line-no">4186</span><span id="line-4186">                        break;</span>
<span class="source-line-no">4187</span><span id="line-4187">                    case 3:</span>
<span class="source-line-no">4188</span><span id="line-4188">                        direction = 2;</span>
<span class="source-line-no">4189</span><span id="line-4189">                        break;</span>
<span class="source-line-no">4190</span><span id="line-4190">                    default:</span>
<span class="source-line-no">4191</span><span id="line-4191">                        break;</span>
<span class="source-line-no">4192</span><span id="line-4192">                }</span>
<span class="source-line-no">4193</span><span id="line-4193">            }</span>
<span class="source-line-no">4194</span><span id="line-4194">            pt10 = lineutility.ExtendDirectedLine(pt1, pt2, pt1, direction, dist);</span>
<span class="source-line-no">4195</span><span id="line-4195">            pt11 = lineutility.ExtendDirectedLine(pt1, pt2, pt2, direction, dist);</span>
<span class="source-line-no">4196</span><span id="line-4196">            //intersectPt=new POINT2(null);</span>
<span class="source-line-no">4197</span><span id="line-4197">            //get the intersection of pt01-p00 and pt10-pt11</span>
<span class="source-line-no">4198</span><span id="line-4198">            //so it it is the interior intersection of pt0-pt1 and pt1-pt2</span>
<span class="source-line-no">4199</span><span id="line-4199"></span>
<span class="source-line-no">4200</span><span id="line-4200">            //first handle the case of vertical lines.</span>
<span class="source-line-no">4201</span><span id="line-4201">            if (pt0.x == pt1.x &amp;&amp; pt1.x == pt2.x) {</span>
<span class="source-line-no">4202</span><span id="line-4202">                intersectPt = new POINT2(pt01);</span>
<span class="source-line-no">4203</span><span id="line-4203">                intersectPoints.add(intersectPt);</span>
<span class="source-line-no">4204</span><span id="line-4204">                continue;</span>
<span class="source-line-no">4205</span><span id="line-4205">            }</span>
<span class="source-line-no">4206</span><span id="line-4206">            //it's the same situation if the slopes are identical,</span>
<span class="source-line-no">4207</span><span id="line-4207">            //simply use pt01 or pt10 since they already uniquely define the intesection</span>
<span class="source-line-no">4208</span><span id="line-4208">            lineutility.CalcTrueSlopeDouble2(pt00, pt01, m01);</span>
<span class="source-line-no">4209</span><span id="line-4209">            lineutility.CalcTrueSlopeDouble2(pt10, pt11, m12);</span>
<span class="source-line-no">4210</span><span id="line-4210">            //if(m01.dbl==m12.dbl)                                      </span>
<span class="source-line-no">4211</span><span id="line-4211">            if (m01.value[0] == m12.value[0]) {</span>
<span class="source-line-no">4212</span><span id="line-4212">                intersectPt = new POINT2(pt01);</span>
<span class="source-line-no">4213</span><span id="line-4213">                intersectPoints.add(intersectPt);</span>
<span class="source-line-no">4214</span><span id="line-4214">                continue;</span>
<span class="source-line-no">4215</span><span id="line-4215">            }</span>
<span class="source-line-no">4216</span><span id="line-4216">            //now we are assuming a non-trivial intersection</span>
<span class="source-line-no">4217</span><span id="line-4217">            //calculate the y-intercepts using y=mx+b (use b=y-mx)</span>
<span class="source-line-no">4218</span><span id="line-4218">            b01 = pt01.y - m01.value[0] * pt01.x;</span>
<span class="source-line-no">4219</span><span id="line-4219">            b12 = pt11.y - m12.value[0] * pt11.x;</span>
<span class="source-line-no">4220</span><span id="line-4220">            intersectPt = lineutility.CalcTrueIntersectDouble2(m01.value[0], b01, m12.value[0], b12, 1, 1, 0, 0);</span>
<span class="source-line-no">4221</span><span id="line-4221">            intersectPoints.add(intersectPt);</span>
<span class="source-line-no">4222</span><span id="line-4222">        }//end for</span>
<span class="source-line-no">4223</span><span id="line-4223">        int n=intersectPoints.size();</span>
<span class="source-line-no">4224</span><span id="line-4224">        //for (j = 0; j &lt; intersectPoints.size(); j++) </span>
<span class="source-line-no">4225</span><span id="line-4225">        for (j = 0; j &lt; n; j++) </span>
<span class="source-line-no">4226</span><span id="line-4226">        {</span>
<span class="source-line-no">4227</span><span id="line-4227">            pLinePoints[j] = intersectPoints.get(j);</span>
<span class="source-line-no">4228</span><span id="line-4228">        }</span>
<span class="source-line-no">4229</span><span id="line-4229">    }</span>
<span class="source-line-no">4230</span><span id="line-4230">    public static ArrayList&lt;POINT2&gt; getDeepCopy(ArrayList&lt;POINT2&gt;pts)</span>
<span class="source-line-no">4231</span><span id="line-4231">    {</span>
<span class="source-line-no">4232</span><span id="line-4232">        ArrayList&lt;POINT2&gt;deepCopy=null;</span>
<span class="source-line-no">4233</span><span id="line-4233">        try</span>
<span class="source-line-no">4234</span><span id="line-4234">        {</span>
<span class="source-line-no">4235</span><span id="line-4235">            if(pts == null || pts.isEmpty())</span>
<span class="source-line-no">4236</span><span id="line-4236">                return pts;</span>
<span class="source-line-no">4237</span><span id="line-4237">            deepCopy=new ArrayList();</span>
<span class="source-line-no">4238</span><span id="line-4238">            int j=0;</span>
<span class="source-line-no">4239</span><span id="line-4239">            POINT2 pt=null;</span>
<span class="source-line-no">4240</span><span id="line-4240">            for(j=0;j&lt;pts.size();j++)</span>
<span class="source-line-no">4241</span><span id="line-4241">            {                </span>
<span class="source-line-no">4242</span><span id="line-4242">                pt=new POINT2(pts.get(j).x,pts.get(j).y,pts.get(j).style);</span>
<span class="source-line-no">4243</span><span id="line-4243">                deepCopy.add(pt);</span>
<span class="source-line-no">4244</span><span id="line-4244">            }</span>
<span class="source-line-no">4245</span><span id="line-4245">        }</span>
<span class="source-line-no">4246</span><span id="line-4246">        catch (Exception exc) {</span>
<span class="source-line-no">4247</span><span id="line-4247">            ErrorLogger.LogException(_className, "getDeepCopy",</span>
<span class="source-line-no">4248</span><span id="line-4248">                    new RendererException("Failed inside getDeepCopy", exc));</span>
<span class="source-line-no">4249</span><span id="line-4249">        }</span>
<span class="source-line-no">4250</span><span id="line-4250">        return deepCopy;</span>
<span class="source-line-no">4251</span><span id="line-4251">    }</span>
<span class="source-line-no">4252</span><span id="line-4252"></span>
<span class="source-line-no">4253</span><span id="line-4253">}//end lineutility</span>




























































</pre>
</div>
</main>
</body>
</html>
